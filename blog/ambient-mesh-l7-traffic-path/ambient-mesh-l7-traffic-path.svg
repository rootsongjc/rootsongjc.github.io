<svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" width="2250" height="1153" version="1.1" viewBox="1933 176 2250 1153"><defs><marker id="FilledArrow_Marker" stroke-linejoin="miter" stroke-miterlimit="10" color="#000" markerHeight="8" markerUnits="strokeWidth" markerWidth="10" orient="auto" overflow="visible" viewBox="-1 -4 10 8"><g><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M 8 0 L 0 -3 L 0 3 Z"/></g></marker></defs><g id="Canvas__-L7" fill="none" fill-opacity="1" stroke="none" stroke-dasharray="none" stroke-opacity="1"><title>博客-L7</title><rect width="2250" height="1153" x="1933" y="176" fill="#fff"/><g id="Canvas__-L7_Layer_1"><title>Layer 1</title><g id="Graphic_149"><rect width="2249.645" height="1151.614" x="1933.228" y="176.791" fill="#fff"/></g><g id="Graphic_87"><rect width="566.929" height="1105.512" x="1964.409" y="199.843" stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(1969.4095 1280.8902)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Node A</tspan></text></g><g id="Graphic_86"><rect width="566.929" height="1105.512" x="3577.146" y="199.843" stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3582.1457 1280.8902)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Node B</tspan></text></g><g id="Graphic_89"><title>ztunnel a pod</title><rect width="501.732" height="588.431" x="1997.008" y="518.499" fill="#f3f9ff"/><rect width="501.732" height="588.431" x="1997.008" y="518.499" stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2002.008 1082.465)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Ztunnel A Pod</tspan></text></g><g id="Graphic_88"><rect width="501.732" height="529.769" x="3611.87" y="422.362" fill="#f3f9ff"/><rect width="501.732" height="529.769" x="3611.87" y="422.362" stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3616.87 927.6668)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Ztunnel B Pod</tspan></text></g><g id="Graphic_85"><rect width="391.181" height="68.031" x="2050.834" y="236.693" fill="#333"/><rect width="391.181" height="68.031" x="2050.834" y="236.693" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#fff" transform="translate(2055.8342 241.69292)"><tspan x="137.247" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Service A Pod</tspan></text></g><g id="Graphic_84"><rect width="391.181" height="46.772" x="2050.834" y="422.362" fill="#dadada"/><rect width="391.181" height="46.772" x="2050.834" y="422.362" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2055.8342 426.792)"><tspan x="162.015" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">istioout</tspan> <tspan x="139.439" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">192.168.127.1</tspan></text></g><g id="Graphic_83"><rect width="245.969" height="46.772" x="2123.44" y="518.499" fill="#dadada"/><rect width="245.969" height="46.772" x="2123.44" y="518.499" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2128.44 522.9284)"><tspan x="84.521" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">pistioout</tspan> <tspan x="66.833" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">192.168.127.2</tspan></text></g><g id="Graphic_82"><rect width="391.181" height="365.669" x="2052.284" y="630.709" fill="#fff"/><rect width="391.181" height="365.669" x="2052.284" y="630.709" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2057.2835 971.9139)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Envoy Proxy</tspan></text></g><g id="Line_81"><line x1="2246.425" x2="2246.425" y1="304.724" y2="322.03" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_80"><line x1="2246.425" x2="2246.425" y1="469.134" y2="508.599" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_79"><line x1="2246.55" x2="2246.846" y1="565.27" y2="620.809" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_78"><rect width="391.181" height="68.031" x="3665.02" y="236.693" fill="#333"/><rect width="391.181" height="68.031" x="3665.02" y="236.693" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#fff" transform="translate(3670.0197 241.69292)"><tspan x="137.095" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Service B Pod</tspan></text></g><g id="Graphic_77"><rect width="391.181" height="57.734" x="3665.02" y="1024.724" fill="#dadada"/><rect width="391.181" height="57.734" x="3665.02" y="1024.724" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3670.0197 1034.6352)"><tspan x="167.655" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">istioin</tspan> <tspan x="139.439" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">192.168.126.1</tspan></text></g><g id="Graphic_76"><rect width="391.181" height="199.755" x="3665.02" y="462.576" fill="#fff"/><rect width="391.181" height="199.755" x="3665.02" y="462.576" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3670.0197 637.8667)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Envoy Proxy</tspan></text></g><g id="Graphic_75"><rect width="232.441" height="34.99" x="3744.39" y="554.51" fill="#0a55a8"/><text fill="#fff" transform="translate(3749.39 562.27267)"><tspan x="14.188" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Ztunnel_inbound Listener</tspan></text></g><g id="Graphic_74"><rect width="232.441" height="34.99" x="3744.39" y="494.017" fill="#0a55a8"/><text fill="#fff" transform="translate(3749.39 501.7796)"><tspan x="22.196" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Virtual_inbound Cluster</tspan></text></g><g id="Line_73"><line x1="3860.61" x2="3860.61" y1="1249.911" y2="1092.358" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_72"><line x1="3860.61" x2="3860.61" y1="1024.724" y2="836.305" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_71"><line x1="3860.61" x2="3860.61" y1="768.671" y2="750.977" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><g id="Line_70"><line x1="3860.61" x2="3860.61" y1="554.51" y2="538.907" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_69"><line x1="3860.61" x2="3860.61" y1="422.362" y2="408.165" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_67"><rect width="232.441" height="28.346" x="2131.654" y="688.532" fill="#0a55a8"/><text fill="#fff" transform="translate(2136.6536 692.9728)"><tspan x="8.548" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Ztunnel_outbound Listener</tspan></text></g><g id="Graphic_66"><rect width="232.441" height="28.346" x="2131.654" y="768.671" fill="#0a55a8"/><text fill="#fff" transform="translate(2136.6536 773.1124)"><tspan x="45.436" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Service A Cluster</tspan></text></g><g id="Graphic_65"><rect width="232.441" height="28.346" x="2131.654" y="848.811" fill="#0a55a8"/><text fill="#fff" transform="translate(2136.6536 853.2519)"><tspan x="9.316" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Internal Upstream Listener</tspan></text></g><g id="Line_64"><line x1="2247.874" x2="2247.874" y1="716.878" y2="758.771" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_63"><rect width="243.071" height="24.336" x="2123.44" y="727.566" fill="#fff"/><text fill="#000" transform="translate(2128.44 732.5661)"><tspan x="7.173" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">Match the destination port and cluster IP</tspan></text></g><g id="Graphic_62"><rect width="232.441" height="28.346" x="2131.654" y="928.95" fill="#0a55a8"/><text fill="#fff" transform="translate(2136.6536 933.3915)"><tspan x="16.244" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Outbound Tunnel Cluster</tspan></text></g><g id="Line_61"><line x1="2247.874" x2="2247.874" y1="797.018" y2="838.911" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_60"><line x1="2247.874" x2="2247.874" y1="877.157" y2="919.05" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_59"><rect width="243.071" height="24.336" x="2126.339" y="477.448" fill="#fff"/><text fill="#000" transform="translate(2131.3386 482.44794)"><tspan x="77.859" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">Geneva tunnel</tspan></text></g><g id="Graphic_58"><rect width="42.608" height="24.336" x="2226.57" y="805.756" fill="#fff"/><text fill="#000" transform="translate(2231.57 810.7558)"><tspan x="4.526" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">EDS</tspan></text></g><g id="Graphic_57"><rect width="391.181" height="28.346" x="2052.284" y="1250.079" fill="#dadada"/><rect width="391.181" height="28.346" x="2052.284" y="1250.079" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2057.2835 1254.5199)"><tspan x="173.991" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_56"><rect width="391.181" height="25.348" x="2052.284" y="581.985" fill="#f3f9ff"/><text fill="#000" transform="translate(2057.2835 584.927)"><tspan x="166.583" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">tproxy</tspan></text></g><g id="Graphic_55"><rect width="98.922" height="28.346" x="2196.964" y="276.378" fill="#dadada"/><text fill="#000" transform="translate(2201.9637 280.81913)"><tspan x="27.861" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_54"><rect width="391.181" height="28.346" x="2050.834" y="331.93" fill="#dadada"/><rect width="391.181" height="28.346" x="2050.834" y="331.93" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2055.8342 336.37154)"><tspan x="161.391" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">vethxxx</tspan></text></g><g id="Line_53"><line x1="2246.425" x2="2246.425" y1="360.277" y2="412.462" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_52"><rect width="289.936" height="39.684" x="2101.457" y="366.63" fill="#fff"/><text fill="#000" transform="translate(2106.4568 371.6295)"><tspan x="34.992" y="12" fill="#000" font-family="Helvetica Neue" font-size="12" font-weight="bold">iptables chain ztunnel-PREROUTING</tspan> <tspan x="89.946" y="26.348" fill="#000" font-family="Helvetica Neue" font-size="12">mark 0x100/0x100</tspan></text></g><g id="Graphic_51"><rect width="70.752" height="28.346" x="2212.498" y="630.709" fill="#0a55a8"/><text fill="#fff" transform="translate(2217.498 635.14984)"><tspan x="8.136" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">15001</tspan></text></g><g id="Graphic_50"><rect width="136.772" height="24.336" x="2179.488" y="886.542" fill="#fff"/><text fill="#000" transform="translate(2184.4882 891.5422)"><tspan x="10.934" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">HTTP Tunnel config</tspan></text></g><g id="Graphic_49"><rect width="219.685" height="28.346" x="2138.032" y="1078.583" fill="#dadada"/><rect width="219.685" height="28.346" x="2138.032" y="1078.583" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2143.0315 1083.0239)"><tspan x="88.243" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_48"><rect width="391.181" height="28.346" x="2052.284" y="1132.441" fill="#dadada"/><rect width="391.181" height="28.346" x="2052.284" y="1132.441" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2057.2835 1136.8821)"><tspan x="161.391" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">vethxxx</tspan></text></g><g id="Line_47"><line x1="2247.874" x2="2247.874" y1="659.055" y2="678.632" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_46"><line x1="2247.874" x2="2247.874" y1="957.297" y2="1068.683" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_45"><rect width="391.181" height="46.772" x="2052.284" y="1008.32" fill="#f3f9ff"/><path stroke="gray" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 2052.2835 1008.3204 L 2443.4646 1008.3204 L 2443.4646 1055.092 L 2052.2835 1055.092 Z"/><text fill="#000" transform="translate(2057.2835 1012.7501)"><tspan x="140.535" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">init container</tspan> <tspan x="79.767" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">Setup iptables rules for ztunnel</tspan></text></g><g id="Line_44"><line x1="2247.874" x2="2247.874" y1="1106.929" y2="1122.541" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_43"><line x1="2247.874" x2="2247.874" y1="1160.787" y2="1240.179" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_42"><rect width="391.181" height="50.616" x="2052.284" y="1180.011" fill="#fff"/><path stroke="gray" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 2052.2835 1180.0114 L 2443.4646 1180.0114 L 2443.4646 1230.6273 L 2052.2835 1230.6273 Z"/><text fill="#000" transform="translate(2057.2835 1186.3633)"><tspan x="157.727" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Istio CNI</tspan> <tspan x="38.559" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">Setup iptables rules and veth pair for node</tspan></text></g><g id="Graphic_41"><rect width="391.181" height="28.514" x="3665.02" y="1249.911" fill="#dadada"/><rect width="391.181" height="28.514" x="3665.02" y="1249.911" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3670.0197 1254.436)"><tspan x="173.991" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_40"><rect width="391.181" height="57.734" x="3665.02" y="1172.894" fill="#fff"/><path stroke="gray" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 3665.0197 1172.8936 L 4056.201 1172.8936 L 4056.201 1230.6273 L 3665.0197 1230.6273 Z"/><text fill="#000" transform="translate(3670.0197 1182.8044)"><tspan x="157.727" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Istio CNI</tspan> <tspan x="38.559" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">Setup iptables rules and veth pair for node</tspan></text></g><g id="Graphic_39"><rect width="391.181" height="57.734" x="3665.02" y="768.671" fill="#dadada"/><rect width="391.181" height="57.734" x="3665.02" y="768.671" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3670.0197 778.582)"><tspan x="162.767" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">pistioin</tspan> <tspan x="139.439" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">192.168.126.2</tspan></text></g><g id="Graphic_38"><rect width="391.181" height="57.734" x="3665.02" y="849.785" fill="#f3f9ff"/><path stroke="gray" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 3665.0197 849.7847 L 4056.201 849.7847 L 4056.201 907.5185 L 3665.0197 907.5185 Z"/><text fill="#000" transform="translate(3670.0197 859.6955)"><tspan x="140.535" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">init container</tspan> <tspan x="79.767" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">Setup iptables rules for ztunnel</tspan></text></g><g id="Graphic_37"><rect width="70" height="28" x="3788.988" y="634" fill="#0a55a8"/><text fill="#fff" transform="translate(3793.988 638.26794)"><tspan x="7.76" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">15006</tspan></text></g><g id="Graphic_36"><rect width="391.181" height="19.355" x="3665.02" y="731.622" fill="#f3f9ff"/><text fill="#000" transform="translate(3670.0197 731.5674)"><tspan x="166.583" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">tproxy</tspan></text></g><g id="Graphic_35"><rect width="289.936" height="39.684" x="3717.768" y="1113.926" fill="#fff"/><text fill="#000" transform="translate(3722.7683 1118.9259)"><tspan x="34.992" y="12" fill="#000" font-family="Helvetica Neue" font-size="12" font-weight="bold">iptables chain ztunnel-PREROUTING</tspan> <tspan x="89.946" y="26.348" fill="#000" font-family="Helvetica Neue" font-size="12">mark 0x200/0x200</tspan></text></g><g id="Graphic_34"><rect width="243.071" height="24.336" x="3739.075" y="972.042" fill="#fff"/><text fill="#000" transform="translate(3744.075 977.042)"><tspan x="77.859" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">Geneva tunnel</tspan></text></g><g id="Graphic_33"><rect width="136.772" height="21.258" x="3792.224" y="422.362" fill="#dadada"/><rect width="136.772" height="21.258" x="3792.224" y="422.362" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3797.2244 423.2589)"><tspan x="46.786" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_32"><rect width="98.922" height="28.346" x="3811.149" y="276.378" fill="#dadada"/><text fill="#000" transform="translate(3816.149 280.81913)"><tspan x="27.861" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_31"><rect width="391.181" height="21.258" x="3665.02" y="377.008" fill="#dadada"/><rect width="391.181" height="21.258" x="3665.02" y="377.008" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3670.0197 377.9046)"><tspan x="161.391" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">vethxxx</tspan></text></g><g id="Graphic_30"><rect width="391.181" height="21.258" x="3665.02" y="330.237" fill="#dadada"/><rect width="391.181" height="21.258" x="3665.02" y="330.237" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(3670.0197 331.1341)"><tspan x="161.391" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">vethxxx</tspan></text></g><g id="Line_29"><line x1="3860.61" x2="3860.61" y1="377.008" y2="361.395" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_28"><line x1="3860.61" x2="3860.61" y1="330.237" y2="314.624" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_26"><rect width="70.752" height="28.346" x="3859.307" y="633.984" fill="#0a55a8"/><text fill="#fff" transform="translate(3864.307 638.4255)"><tspan x="8.136" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">15008</tspan></text></g><g id="Line_25"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 3860.6103 731.622 L 3860.6103 711.835 L 3894.683 711.835 L 3894.683 672.2308"/></g><g id="Graphic_24"><rect width="58.11" height="24.336" x="3865.628" y="682.527" fill="#f3f9ff"/><text fill="#000" transform="translate(3870.628 687.527)"><tspan x="13.387" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">TLS</tspan></text></g><g id="Line_23"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 3823.988 634 L 3823.988 611.7499 L 3860.6103 611.7499 L 3860.6103 599.3998"/></g><g id="Line_22"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 3894.683 633.9843 L 3894.683 611.74206 L 3860.6103 611.74206 L 3860.6103 599.3998"/></g><g id="Line_21"><line x1="3860.61" x2="3860.61" y1="494.017" y2="453.52" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_20"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 3860.6103 731.622 L 3860.6103 711.8641 L 3823.988 711.8641 L 3823.988 671.9"/></g><g id="Graphic_19"><rect width="58.11" height="24.336" x="3794.933" y="681.946" fill="#f3f9ff"/><text fill="#000" transform="translate(3799.933 686.9459)"><tspan x="10.945" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">Plain</tspan></text></g><g id="Line_5"><line x1="2443.465" x2="2837.146" y1="1264.231" y2="1264.19" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_4"><text fill="#000" transform="translate(2560.722 1244.7475)"><tspan x="13.624" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">HBONE Tunnel</tspan> <tspan x="0" y="35.464" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Waypoint IP:15006</tspan></text></g><g id="Line_3"><line x1="3238.227" x2="3655.12" y1="1264.168" y2="1264.168" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_2"><text fill="#000" transform="translate(3396.1964 1244.7039)"><tspan x="1.192" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">HBONE Tunnel</tspan> <tspan x="0" y="35.464" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Pod B IP:15008</tspan></text></g><g id="Graphic_130"><rect width="566.929" height="1105.512" x="2754.478" y="199.843" stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2759.4784 1280.8902)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Node C</tspan></text></g><g id="Graphic_129"><rect width="501.732" height="719.737" x="2787.077" y="284.882" fill="#f3f9ff"/><rect width="501.732" height="719.737" x="2787.077" y="284.882" stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2792.0768 980.1543)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Waypoint Proxy B Pod</tspan></text></g><g id="Graphic_127"><rect width="391.181" height="57.734" x="2847.046" y="1049.848" fill="#dadada"/><rect width="391.181" height="57.734" x="2847.046" y="1049.848" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2852.0463 1059.7586)"><tspan x="167.655" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">istioin</tspan> <tspan x="139.439" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">192.168.126.1</tspan></text></g><g id="Line_123"><line x1="3042.637" x2="3042.637" y1="1249.911" y2="1117.482" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_122"><line x1="3042.637" x2="3042.637" y1="1049.848" y2="916.444" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_121"><line x1="3042.637" x2="3042.637" y1="848.811" y2="832.592" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><g id="Graphic_118"><rect width="391.181" height="28.514" x="2847.046" y="1249.911" fill="#dadada"/><rect width="391.181" height="28.514" x="2847.046" y="1249.911" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2852.0463 1254.436)"><tspan x="173.991" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_116"><rect width="391.181" height="57.734" x="2847.046" y="848.811" fill="#dadada"/><rect width="391.181" height="57.734" x="2847.046" y="848.811" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2852.0463 858.7216)"><tspan x="162.767" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">pistioin</tspan> <tspan x="139.439" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">192.168.126.2</tspan></text></g><g id="Graphic_115"><rect width="391.181" height="43.04" x="2847.046" y="928.95" fill="#f3f9ff"/><path stroke="gray" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 2847.0463 928.9503 L 3238.2274 928.9503 L 3238.2274 971.9904 L 2847.0463 971.9904 Z"/><text fill="#000" transform="translate(2852.0463 931.5143)"><tspan x="140.535" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">init container</tspan> <tspan x="79.767" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">Setup iptables rules for ztunnel</tspan></text></g><g id="Graphic_113"><rect width="391.181" height="19.355" x="2847.046" y="813.237" fill="#f3f9ff"/><text fill="#000" transform="translate(2852.0463 813.1821)"><tspan x="166.583" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">tproxy</tspan></text></g><g id="Graphic_112"><rect width="289.936" height="39.684" x="2899.795" y="1126.772" fill="#fff"/><text fill="#000" transform="translate(2904.795 1131.7721)"><tspan x="34.992" y="12" fill="#000" font-family="Helvetica Neue" font-size="12" font-weight="bold">iptables chain ztunnel-PREROUTING</tspan> <tspan x="89.946" y="26.348" fill="#000" font-family="Helvetica Neue" font-size="12">mark 0x200/0x200</tspan></text></g><g id="Graphic_111"><rect width="243.071" height="24.336" x="2921.102" y="1015.065" fill="#fff"/><text fill="#000" transform="translate(2926.1015 1020.0651)"><tspan x="77.859" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">Geneva tunnel</tspan></text></g><g id="Graphic_107"><rect width="289.936" height="28.514" x="2897.669" y="284.798" fill="#dadada"/><rect width="289.936" height="28.514" x="2897.669" y="284.798" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2902.669 289.32307)"><tspan x="123.368" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">eth0</tspan></text></g><g id="Graphic_17"><rect width="391.181" height="463.567" x="2847.046" y="333.071" fill="#fff"/><rect width="391.181" height="463.567" x="2847.046" y="333.071" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2852.0463 769.6374)"><tspan x="0" y="17" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">E</tspan> <tspan y="17" fill="#000" font-family="PingFang SC" font-size="16" font-weight="bold">nvoy Proxy</tspan></text></g><g id="Graphic_16"><rect width="322.616" height="27.67" x="2881.329" y="723.677" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 727.77975)"><tspan x="2.836" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">inbound_CONNECT_terminate Listnener</tspan></text></g><g id="Graphic_15"><rect width="322.616" height="27.67" x="2881.329" y="677.668" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 681.7705)"><tspan x="48.924" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Internal Inbound VIP Cluster</tspan></text></g><g id="Graphic_14"><rect width="322.616" height="27.67" x="2881.329" y="622.06" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 626.16274)"><tspan x="76.908" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Inbound VIP Listener</tspan></text></g><g id="Graphic_13"><rect width="322.616" height="27.67" x="2881.329" y="566.452" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 570.555)"><tspan x="80.316" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Inbound VIP Cluster</tspan></text></g><g id="Graphic_12"><rect width="322.616" height="27.833" x="2881.329" y="409.064" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 414.0636)"><tspan x="10.396" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">inbound_CONNECT_originate Listener</tspan></text></g><g id="Graphic_11"><rect width="322.616" height="27.833" x="2881.329" y="356.328" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 361.32757)"><tspan x="13.804" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">inbound_CONNECT_originate Cluster</tspan></text></g><g id="Line_10"><line x1="3042.637" x2="3042.637" y1="723.677" y2="715.237" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_9"><line x1="3042.637" x2="3042.637" y1="677.668" y2="659.63" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_8"><line x1="3042.637" x2="3042.637" y1="622.06" y2="604.022" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_6"><line x1="3042.637" x2="3042.637" y1="409.064" y2="394.061" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_90"><rect width="322.616" height="27.67" x="2881.329" y="514.044" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 518.14673)"><tspan x="74.532" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Inbound Pod Listener</tspan></text></g><g id="Graphic_91"><rect width="322.616" height="27.67" x="2881.329" y="461.636" fill="#0a55a8"/><text fill="#fff" transform="translate(2886.3288 465.7385)"><tspan x="77.94" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">Inbound Pod Cluster</tspan></text></g><g id="Graphic_93"><rect width="135.968" height="27.331" x="2974.251" y="769.686" fill="#0a55a8"/><text fill="#fff" transform="translate(2979.251 773.6199)"><tspan x="40.744" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" font-weight="bold">15006</tspan></text></g><g id="Line_132"><line x1="3042.637" x2="3042.637" y1="813.237" y2="806.909" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_133"><line x1="3042.637" x2="3042.637" y1="566.452" y2="551.614" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_134"><line x1="3042.637" x2="3042.637" y1="514.044" y2="499.205" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_135"><line x1="3042.637" x2="3042.637" y1="461.636" y2="446.797" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_136"><line x1="3042.235" x2="3042.235" y1="769.686" y2="761.238" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Line_137"><line x1="3042.637" x2="3042.637" y1="356.328" y2="323.212" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)"/></g><g id="Graphic_138"><rect width="391.181" height="28.346" x="2847.046" y="236.693" fill="#dadada"/><rect width="391.181" height="28.346" x="2847.046" y="236.693" stroke="gray" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text fill="#000" transform="translate(2852.0463 241.1341)"><tspan x="161.391" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">vethxxx</tspan></text></g><g id="Line_139"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 3042.637 284.79794 L 3042.637 274.91866 L 3042.637 274.96063 L 3042.637 274.93937"/></g><g id="Line_143"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 3238.2274 250.86614 L 3305.0946 250.86614 L 3305.0946 1145.3704 L 3202.2765 1145.3704 L 3202.2765 1240.0109"/></g><g id="Graphic_144"><text fill="#000" transform="translate(3256.2716 232.41815)"><tspan x="7.416" y="15" fill="#000" font-family="Helvetica Neue" font-size="16">To</tspan> <tspan x="0" y="33.448" fill="#000" font-family="Helvetica Neue" font-size="16">eth0</tspan></text></g><g id="Graphic_145"><text fill="#000" transform="translate(3052.8642 658.3318)"><tspan x="2.483" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">STATIC</tspan></text></g><g id="Graphic_146"><text fill="#000" transform="translate(3052.8642 547.83465)"><tspan x="4.526" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">EDS</tspan></text></g><g id="Graphic_147"><text fill="#000" transform="translate(3052.8642 442.95276)"><tspan x="2.483" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">STATIC</tspan></text></g><g id="Graphic_148"><text fill="#000" transform="translate(3048.6122 338.07087)"><tspan x="4.967" y="11" fill="#000" font-family="Helvetica Neue" font-size="12">ORIGINAL_DST</tspan></text></g><g id="Graphic_117"><rect width="391.181" height="57.734" x="2847.046" y="1172.894" fill="#fff"/><path stroke="gray" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 2847.0463 1172.8936 L 3238.2274 1172.8936 L 3238.2274 1230.6273 L 2847.0463 1230.6273 Z"/><text fill="#000" transform="translate(2852.0463 1182.8044)"><tspan x="157.727" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold">Istio CNI</tspan> <tspan x="38.559" y="34.464" fill="#000" font-family="Helvetica Neue" font-size="16">Setup iptables rules and veth pair for node</tspan></text></g></g></g></svg>