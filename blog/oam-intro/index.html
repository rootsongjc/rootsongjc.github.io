<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>OAM（开放应用模型）——定义云原生应用标准的野望 · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="本文是对 OAM 及 Rudr 的初探，主要介绍了 OAM 诞生的背景和要解决的问题，同时介绍了它在云原生生态中的作用。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.123.7">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.38ab4e47c5642975d2df8e2aaf513aff41a8914f7e6cc83b4e2b29eaf4e7e41d.css" as="style">
  <link rel="stylesheet" href="/css/combined.38ab4e47c5642975d2df8e2aaf513aff41a8914f7e6cc83b4e2b29eaf4e7e41d.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.f007e9552bf2d2bfdf2bfedcbc91080f86f0baba7b29ddee9201b922567030d0.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.f007e9552bf2d2bfdf2bfedcbc91080f86f0baba7b29ddee9201b922567030d0.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/blog/oam-intro/" />
  <meta property="og:title" content="OAM（开放应用模型）——定义云原生应用标准的野望 | Jimmy Song" />
  <meta property="twitter:title" content="OAM（开放应用模型）——定义云原生应用标准的野望 | Jimmy Song" />

  
  <meta property="og:description" content="本文是对 OAM 及 Rudr 的初探，主要介绍了 OAM 诞生的背景和要解决的问题，同时介绍了它在云原生生态中的作用。" />
  <meta property="twitter:description" content="本文是对 OAM 及 Rudr 的初探，主要介绍了 OAM 诞生的背景和要解决的问题，同时介绍了它在云原生生态中的作用。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/oam.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/oam.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                导航
              </a>
              <div class="dropdown-menu">
                
                <a class="dropdown-item" href="/categories">分类</a>
                
                <a class="dropdown-item" href="/tags">标签</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://cloudnative.to" target="_blank" rel="noopener">社区 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            <input type="radio" id="blog" name="search_type" value="blog">
            <label for="blog">博客</label>
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    OAM（开放应用模型）——定义云原生应用标准的野望
                </p>
                <p class="page-description">
                    本文是对 OAM 及 Rudr 的初探，主要介绍了 OAM 诞生的背景和要解决的问题，同时介绍了它在云原生生态中的作用。
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>2020/04/22</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f"> 
                        云原生</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>12 分钟</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>2673 字</li>
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">
            
            <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>查看本文大纲</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#takeaways">Takeaways</a></li>
    <li><a href="#oam-简介">OAM 简介</a>
      <ul>
        <li><a href="#oam-基本对象">OAM 基本对象</a></li>
        <li><a href="#oam-api-的演变">OAM API 的演变</a></li>
        <li><a href="#oam-工作原理">OAM 工作原理</a></li>
      </ul>
    </li>
    <li><a href="#rudr">Rudr</a>
      <ul>
        <li><a href="#安装-rudr">安装 Rudr</a></li>
      </ul>
    </li>
    <li><a href="#部署示例">部署示例</a>
      <ul>
        <li><a href="#创建应用配置">创建应用配置</a></li>
        <li><a href="#测试">测试</a></li>
      </ul>
    </li>
    <li><a href="#未来">未来</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
</details>

            
            <p><a href="https://oam.dev/" title="OAM（Open Application Model）" target="_blank" rel="noopener">OAM（Open Application Model）</a>是阿里巴巴和微软共同开源的云原生应用规范模型，同时开源了基于 OAM 的实现 <a href="https://github.com/oam-dev/rudr" title="Rudr" target="_blank" rel="noopener">Rudr</a>，自 2019 年 10 月宣布开源以来截止本文发稿已经有快半年时间了。</p>
<p>当前可能大部分人才刚刚开始了解 OAM，所以这篇文章将从最基础出发，为大家介绍 OAM 的诞生背景和要解决的问题，以及它在云原生生态中的作用。</p>
<h2 id="takeaways">Takeaways</h2>
<p>如果你没有兴趣或者时间阅读下面的全文，那么建议阅读下面这些核心观点：</p>
<ul>
<li>OAM 的本质是根据软件设计的“兴趣点分离”原则对负责的 DevOps 流程的高度抽象和封装，这背后还是“<strong>康威定律</strong>”在起作用。</li>
<li>OAM 仅定义云原生应用的规范，目前推出的 <a href="https://github.com/oam-dev/rudr" title="Rudr" target="_blank" rel="noopener">Rudr</a> 可以看做是 OAM 规范的 Kubernetes 解释器（实验实现），将云原生应用定义翻译成 Kubernetes 的资源对象。</li>
<li>OAM 与 <a href="https://crossplane.io/" title="Crossplane" target="_blank" rel="noopener">Crossplane</a> 将展开合作，就 Kubernetes 式以 API 为中心的应用定义发扬光大，并深度参与 <a href="https://github.com/cncf/sig-app-delivery" title="CNCF SIG App Delivery" target="_blank" rel="noopener">CNCF SIG App Delivery</a>，以共同定义云原生应用标准。</li>
</ul>
<blockquote>
<p><strong>康威定律（Conway’s Law）</strong></p>
<p><a href="https://zh.wikipedia.org/zh-hans/%E5%BA%B7%E5%A8%81%E5%AE%9A%E5%BE%8B" title="康威定律" target="_blank" rel="noopener">康威定律</a>是马尔文·康威（Melvin Conway）1967 年提出的： &ldquo;设计系统的架构受制于产生这些设计的组织的沟通结构。&rdquo;</p>
</blockquote>
<h2 id="oam-简介">OAM 简介</h2>
<p>OAM 全称是 Open Application Model，从名称上来看它所定义的就是一种模型，同时也实现了基于 OAM 的我认为这种模型旨在定义了云原生应用的标准。</p>
<ul>
<li>开放（Open）：支持异构的平台、容器运行时、调度系统、云供应商、硬件配置等，总之与底层无关</li>
<li>应用（Application）：云原生应用</li>
<li>模型（Model）：定义标准，以使其与底层平台无关</li>
</ul>
<p>顺便说下 CNCF 中的也有几个定义标准的「开源项目」，其中有的项目都已经毕业。</p>
<ul>
<li><a href="https://github.com/servicemeshinterface/smi-spec" title="SMI（Service Mesh Interface）" target="_blank" rel="noopener">SMI（Service Mesh Interface）</a>：服务网格接口</li>
<li><a href="https://github.com/cloudevents/spec" title="Cloud Events" target="_blank" rel="noopener">Cloud Events</a>：Serverless 中的事件标准</li>
<li><a href="https://github.com/theupdateframework/specification" title="TUF" target="_blank" rel="noopener">TUF</a>：更新框架标准</li>
<li><a href="https://github.com/spiffe/spiffe" title="SPIFFE" target="_blank" rel="noopener">SPIFFE</a>：身份安全标准</li>
</ul>
<p>这其中唯独没有应用标准的定义，<a href="https://github.com/cncf/sig-app-delivery" title="CNCF SIG App delivery" target="_blank" rel="noopener">CNCF SIG App delivery</a> 即是要做这个的。当然既然要制定标准，自然要对不同平台和场景的逻辑做出更高级别的抽象（这也意味着你在掌握了底层逻辑的情况下还要学习更多的概念），这样才能屏蔽底层差异。本文将默认底层平台为 Kubernetes。</p>
<ul>
<li>是从管理大量 CRD 中汲取的经验。</li>
<li>业务和研发的沟通成本，比如 YAML 配置中很多字段是开发人员不关心的。</li>
</ul>
<h3 id="oam-基本对象">OAM 基本对象</h3>
<p>OAM 模型中包含以下基本对象，以本文发稿时的最新 API 版本 <code>core.oam.dev/v1alpha2</code> 为准：</p>
<ul>
<li><a href="https://github.com/oam-dev/spec/blob/master/4.component.md" title="&lt;strong&gt;Component&lt;/strong&gt;" target="_blank" rel="noopener"><strong>Component</strong></a>：OAM 中最基础的对象，该配置与基础设施无关，定义负载实例的运维特性。例如一个微服务 <a href="https://github.com/oam-dev/spec/blob/master/3.workload.md" title="workload" target="_blank" rel="noopener">workload</a> 的定义。</li>
<li><a href="https://github.com/oam-dev/spec/blob/master/6.traits.md" title="&lt;strong&gt;TraitDefinition&lt;/strong&gt;" target="_blank" rel="noopener"><strong>TraitDefinition</strong></a>：一个组件所需的<strong>运维策略与配置</strong>，例如环境变量、Ingress、AutoScaler、Volume 等。（注意：该对象在 <code>apiVersion: core.oam.dev/v1alpha1</code> 中的名称为 <code>Trait</code>）。</li>
<li><a href="https://github.com/oam-dev/spec/blob/master/5.application_scopes.md" title="&lt;strong&gt;ScopeDefinition&lt;/strong&gt;" target="_blank" rel="noopener"><strong>ScopeDefinition</strong></a>：多个 Component 的共同边界。可以根据组件的特性或者作用域来划分 Scope，一个 Component 可能同时属于多个 Scope。</li>
<li><a href="https://github.com/oam-dev/spec/blob/master/7.application_configuration.md" title="&lt;strong&gt;ApplicationConfiguration&lt;/strong&gt;" target="_blank" rel="noopener"><strong>ApplicationConfiguration</strong></a>：将 Component（必须）、Trait（必须）、Scope（非必须）等组合到一起形成一个完整的应用配置。</li>
</ul>
<h3 id="oam-api-的演变">OAM API 的演变</h3>
<p>因为 OAM 还处在发展早起，API 变化较快，以上四个对象在不同的 API 版本中的 <code>kind</code> 名称不同，请大家使用时注意区别。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>core.oam.dev/v1alpha1</th>
<th>core.oam.dev/v1alpha2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Component</td>
<td>ComponentSchematic</td>
<td>Component</td>
</tr>
<tr>
<td>Trait</td>
<td>Trait</td>
<td>TraitDefinition</td>
</tr>
<tr>
<td>Scope</td>
<td>Scope</td>
<td>ScopeDefinition</td>
</tr>
<tr>
<td>Application configuration</td>
<td>ApplicationConfiguration</td>
<td>ApplicationConfiguration</td>
</tr>
</tbody>
</table>
<p>总的来说，OAM 模型对象的定义格式与 <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/#required-fields" title="Kubernetes 对象的类型字段" target="_blank" rel="noopener">Kubernetes 对象的类型字段</a>相似。关于 OAM 的基本概念模型的更多信息请访问 <a href="https://github.com/oam-dev/spec/blob/master/2.overview_and_terminology.md" title="Overview and Terminology" target="_blank" rel="noopener">Overview and Terminology</a>。</p>
<h3 id="oam-工作原理">OAM 工作原理</h3>
<p>下图来自阿里云原生应用平台团队孙健波在 <strong>《OAM:云原生时代的应用模型与 下一代 DevOps 技术》</strong> 中的分享，OAM 的工作原理如下图所示，OAM Spec 定义了云原生应用的规范（使用一些列 CRD 定义），Rudr 可以看做是 OAM 规范的解析器，将应用定义翻译为 Kubernetes 中的资源对象。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/blog/oam-intro/oam-principle_hub75a06e7c0e9c57522eb7daa50de56f7_189219_2568x1388_resize_q75_h2_lanczos_3.webp" type="image/webp">
           <img src="/blog/oam-intro/oam-principle.png" data-img="/blog/oam-intro/oam-principle.png" data-width="2568" data-height="1388" alt="image" data-caption="OAM 的原理">
          </picture>
        
      
    
  
  
  <figcaption>OAM 的原理</figcaption>
  
</figure>
<p>可以将上图分为三个层次：</p>
<ul>
<li><strong>汇编层</strong>：即人工或者使用工具来根据 OAM 规范定义汇编出一个云原生应用的定义，其中包含了该应用的工作负载和运维能力配置。</li>
<li><strong>转义层</strong>：汇编好的文件将打包为 YAML 文件，由 Rudr 或其他 OAM 的实现将其转义为 Kubernetes 或其他云服务（例如 Istio）上可运行的资源对象。</li>
<li><strong>执行层</strong>：执行经过转义好的云平台上的资源对象并执行资源配置。</li>
</ul>
<h2 id="rudr">Rudr</h2>
<p>Rudr 是对  <a href="https://github.com/oam-dev/spec/releases/tag/v1.0.0-alpha.1" title="OAM v1alpha1" target="_blank" rel="noopener">OAM v1alpha1</a> 在 Kubernetes 环境下的实现，OAM 正在与 <a href="https://github.com/crossplane/" title="Crossplane" target="_blank" rel="noopener">Crossplane</a> 合作</p>
<blockquote>
<p><strong>Crossplane</strong></p>
<p>使用 Kubernetes 社区开创的以 API 为中心的声明式配置和自动化方法，使基础设施和应用管理标准化。官方网站：<a href="https://crossplane.io/" title="https://crossplane.io/" target="_blank" rel="noopener">https://crossplane.io/</a>。</p>
</blockquote>
<h3 id="安装-rudr">安装 Rudr</h3>
<p>请参考 <a href="https://github.com/oam-dev/rudr/blob/master/docs/setup/install.md" title="Rudr 文档" target="_blank" rel="noopener">Rudr 文档</a>安装，主要依赖以下组件：</p>
<ul>
<li>kubectl</li>
<li>helm 3</li>
<li>Kubernetes 1.15+</li>
</ul>
<p>执行下面的命令安装 Rudr 和需要的 trait。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 克隆项目</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/oam-dev/rudr.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> rudr
</span></span><span class="line"><span class="cl"><span class="c1"># 创建一个名为 oam 的 namespace</span>
</span></span><span class="line"><span class="cl">kubectl create namespace oam
</span></span><span class="line"><span class="cl"><span class="c1"># 安装 Rudr</span>
</span></span><span class="line"><span class="cl">helm install rudr ./charts/rudr --wait -n oam
</span></span><span class="line"><span class="cl"><span class="c1"># 要使用 ingress trait，推荐安装 Nginx ingress</span>
</span></span><span class="line"><span class="cl">helm repo add stable https://kubernetes-charts.storage.googleapis.com/
</span></span><span class="line"><span class="cl">helm install nginx-ingress stable/nginx-ingress
</span></span><span class="line"><span class="cl"><span class="c1"># 要使用 autoscaler trait，安装 HorizontalPodAutoscaler</span>
</span></span><span class="line"><span class="cl">helm repo add kedacore https://kedacore.github.io/charts
</span></span><span class="line"><span class="cl">helm repo update
</span></span><span class="line"><span class="cl">helm install keda kedacore/keda -n oam
</span></span></code></pre></div><p>查看当前 oam namespace 下的所有 pod，你会发现已创建了以下 pod。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pod -n oam
</span></span><span class="line"><span class="cl">NAME                                              READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">keda-operator-b6466c989-pn25n                     1/1     Running   <span class="m">0</span>          63m
</span></span><span class="line"><span class="cl">keda-operator-metrics-apiserver-6cf88c468-k5wd8   1/1     Running   <span class="m">0</span>          63m
</span></span><span class="line"><span class="cl">nginx-ingress-controller-787bd69d8-n6v8c          1/1     Running   <span class="m">15</span>         7d
</span></span><span class="line"><span class="cl">nginx-ingress-default-backend-7c868597f4-vvddn    1/1     Running   <span class="m">2</span>          7d
</span></span><span class="line"><span class="cl">rudr-c648c9b7b-knj9b                              1/1     Running   <span class="m">7</span>          7d
</span></span></code></pre></div><h2 id="部署示例">部署示例</h2>
<p>我们使用 OAM 官方提供的教程 <a href="https://github.com/oam-dev/rudr/blob/master/docs/tutorials/deploy_and_update.md" title="Tutorial: Deploy, inspect, and update a Rudr application and its components" target="_blank" rel="noopener">Tutorial: Deploy, inspect, and update a Rudr application and its components</a> 中的 Python <a href="https://palletsprojects.com/p/flask/" title="flask" target="_blank" rel="noopener">flask</a> 示例，该示例基于 OAM v1alpha1 API，最新版 API 的示例可以参考 <a href="https://github.com/oam-dev/crossplane-oam-sample" title="crossplane-oam-sample" target="_blank" rel="noopener">crossplane-oam-sample</a>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 部署 Component</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl apply -f examples/helloworld-python-component.yaml
</span></span></code></pre></div><p>此时 get pod 会发现并没有创建任何新的 pod，因为 <a href="https://github.com/oam-dev/rudr/blob/master/examples/helloworld-python-component.yaml" title="examples/helloworld-python-component.yaml" target="_blank" rel="noopener">examples/helloworld-python-component.yaml</a> 文件中只定义了一个名为 <code>helloworld-python-v1</code> 的 <code>ComponentSchematic</code>，但是 <code>ComponentSchematic</code> 是仅仅是定义了一个组件而已，还无法直接创建 pod 的，还需要创建一个 <code>ApplicationConfiguration</code> 将其与 <code>Trait</code> 绑定才可以创建应用的 pod。</p>
<p>关于该示例的详细信息请参考 <a href="https://github.com/oam-dev/rudr/blob/master/docs/how-to/create_component_from_scratch.md" title="Python flask 示例" target="_blank" rel="noopener">Python flask 示例</a>的创建步骤。</p>
<h3 id="创建应用配置">创建应用配置</h3>
<p>在部署了 <code>ComponentSchematic</code> 之后我们还需要创建一个 <code>ApplicationConfiguration</code> 将其与 <code>Trait</code> 资源绑定才可以创建应用。</p>
<p><strong>当前已有的 Trait</strong></p>
<p>在安装 Rudr 时已在 oam namespace 中部署了一些 trait，使用下面的命令查看。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get trait -n oam
</span></span><span class="line"><span class="cl">NAME             AGE
</span></span><span class="line"><span class="cl">auto-scaler      7d1h
</span></span><span class="line"><span class="cl">empty            7d1h
</span></span><span class="line"><span class="cl">ingress          7d1h
</span></span><span class="line"><span class="cl">manual-scaler    7d1h
</span></span><span class="line"><span class="cl">volume-mounter   7d1h
</span></span></code></pre></div><p>在 <a href="https://github.com/oam-dev/rudr/blob/master/examples/first-app-config.yaml" title="examples/first-app-config.yaml" target="_blank" rel="noopener">examples/first-app-config.yaml</a> 中将 <code>ComponentSchematic</code> 与 ingress <code>Trait</code> 联系起来。一个完整的可部署的应用配置 <a href="https://github.com/oam-dev/rudr/blob/master/examples/first-app-config.yaml" title="examples/first-app-config.yaml" target="_blank" rel="noopener">examples/first-app-config.yaml</a> 的内容如下所示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ApplicationConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">first-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">components</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">componentName</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-python-v1</span><span class="w"> </span><span class="c"># 引用了上文中的 Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">instanceName</span><span class="p">:</span><span class="w"> </span><span class="l">first-app-helloworld-python-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">parameterValues</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">Rudr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;9999&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">traits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress</span><span class="w"> </span><span class="c"># Ingress 引用，Rudr 已默认创建</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">9999</span><span class="w">
</span></span></span></code></pre></div><p>执行下面的命令部署应用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f examples/first-app-config.yaml -n oam
</span></span></code></pre></div><p>若此时查看 oam namespace 下的 pod 将发现有一个新的 pod 创建。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pod -o oam
</span></span><span class="line"><span class="cl">NAME                                              READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">first-app-helloworld-python-v1-69945684c7-wfd82   1/1     Running   <span class="m">0</span>          16m
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><h3 id="测试">测试</h3>
<p>执行下面的命令可以测试刚安装的应用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 将 Python flask 应用的 pod 暴露到本机</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods -l <span class="s2">&#34;oam.dev/instance-name=first-app-helloworld-python-v1,app.kubernetes.io/name=first-app&#34;</span> -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[0].metadata.name}&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">kubectl port-forward <span class="nv">$POD_NAME</span> 9999:9999
</span></span><span class="line"><span class="cl">Forwarding from 127.0.0.1:9999 -&gt; <span class="m">9999</span>
</span></span><span class="line"><span class="cl">Forwarding from <span class="o">[</span>::1<span class="o">]</span>:9999 -&gt; <span class="m">9999</span>
</span></span></code></pre></div><p>在浏览器中访问 <a href="http://127.0.0.1:9999" title="http://127.0.0.1:9999" target="_blank" rel="noopener">http://127.0.0.1:9999</a> 将看到 <code>Hello Rudr!</code> 的输出，这表示测试成功。</p>
<h2 id="未来">未来</h2>
<p>从以上描述中可以看出 OAM 对于定义云原生应用标准的野望，其目标不仅限于 Kubernetes 之上的又一上层抽象，而是对于一切云服务，在基于资源对象的基础上，Trait 来控制 Kubernetes 中的一众高层次非可调度的资源对象，如 AutoScaler、Volume、Ingress，Istio 中的流量配置对象 VirtualService、DestinationRule 等，还可容纳更多的云服务，对于 Serverless 时代的去基础设施化的思想不谋而合，OAM 与 Crossplane 的合作及 CNCF SIG App Delivery 的未来可期。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://oam.dev" title="OAM 官方网站 - oam.dev" target="_blank" rel="noopener">OAM 官方网站 - oam.dev</a></li>
</ul>

            <div class="border-bottom mb-2"></div>
          </div>

          <div class="col-12">
            <p>最后更新于 2024/07/17</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/tags/oam" class="badge"> 
                  Oam</a> </div>
          </div>

          
          <div class="col-12">
            
<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/blog/post-kubernetes-era/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; 上一篇</span>
            <span class="text-align-left">Kubernetes 次世代的云原生应用</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/" class="d-flex flex-column align-items-end">
           <span class="nav mb-2 text-color-dark">下一篇 &rarr;</span>
           <span class="text-align-right">Service Mesh——后 Kubernetes 时代的微服务</span>
         </a>
    </div>
     
</div>

          </div>

          
          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="zh-CN"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          






          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      目录
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#takeaways">Takeaways</a></li>
    <li><a href="#oam-简介">OAM 简介</a>
      <ul>
        <li><a href="#oam-基本对象">OAM 基本对象</a></li>
        <li><a href="#oam-api-的演变">OAM API 的演变</a></li>
        <li><a href="#oam-工作原理">OAM 工作原理</a></li>
      </ul>
    </li>
    <li><a href="#rudr">Rudr</a>
      <ul>
        <li><a href="#安装-rudr">安装 Rudr</a></li>
      </ul>
    </li>
    <li><a href="#部署示例">部署示例</a>
      <ul>
        <li><a href="#创建应用配置">创建应用配置</a></li>
        <li><a href="#测试">测试</a></li>
      </ul>
    </li>
    <li><a href="#未来">未来</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

<div class="sticky-top aside-toc loaded subscribe-module mt-4">
     <p class="subscribe-module-title">极客时间推荐课程 </p>
     <div class="d-flex">
     <span class="mr-2"><img src="/images/ads/01-baiyuan-sre.png" alt="QR Code"></span>
     <span>
          <p class="subscribe-module-subtitle"><a href="https://time.geekbang.org/column/intro/100781001?code=XmuoNVuXRItKfdqt5AvDrB8cA9iWZ5hQ1v82J1J8Hqw%3D" title="SRE 实践：服务可靠性案例课" target="_blank" rel="noopener">SRE 实践：服务可靠性案例课</a></p>
          <p class="subscribe-module-author">讲师：白园，前百度资深运维专家</p>
          <p class="subscribe-module-description">搞定 SRE，为你的系统保驾护航。</p>
     </span>
     </div>
</div>


          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h4 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/envoy-gateway-contributor-guide/">如何参与 Envoy Gateway 社区：贡献或提交代码</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/exploring-fantastic-planet/">Fantastic Planet：权力、解放与文明间的微妙平衡 — 深入探索原始星球中知识和自由的力量</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/seamless-cross-cluster-access-istio/">多集群 Istio 服务网格的跨集群无缝访问指南</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024 圆桌论坛预告：Istio 和现代 API 网关——引领服务网格的未来</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">网站改版通知</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-meetup-dalian-2024/">2024 大连云原生技术开放日</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.9c8ded6698ae4b17bd14af25c6ac17b9f277a2bd53a3e4b463bf982b764c522f.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.1cfcfe652ddcffb2f20c4854df30e36e.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
