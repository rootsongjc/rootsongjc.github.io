<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>博客 - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="专注开源技术、云原生与生活随笔的分享与思考。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/blog/" />
  <meta property="og:title" content="博客 | Jimmy Song" />
  <meta property="twitter:title" content="博客 | Jimmy Song" />

  
  <meta property="og:description" content="专注开源技术、云原生与生活随笔的分享与思考。" />
  <meta property="twitter:description" content="专注开源技术、云原生与生活随笔的分享与思考。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    <a class="nav-link" href="/en/blog/">English</a>
                    
                  
                
              
              
              
                
                  
                    
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    博客
                </p>
                <p class="page-description">
                    专注开源技术、云原生与生活随笔的分享与思考。
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/service-mesh-data-plane-deployment-modes/">深入解析服务网格的四种数据平面部署模式：性能、安全性与成本分析</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/09/10</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('深入解析服务网格的四种数据平面部署模式：性能、安全性与成本分析', '本文解析四种服务网格数据平面部署模式：Sidecar、Ambient、Cilium mesh 和 gRPC。分析架构、性能、安全、管理复杂性和资源成本，提供选择建议，助你在不同场景做最优决策，无论追求高性能、低资源消耗还是高安全保障，都能找到合适模式。', '\n本文将向你介绍 Istio 服务网格的四种平面部署模式，通过分析它们的优缺点，根据他们的性能、可靠性和安全性给出选择建议。\n\n## 什么是服务网格？\n\n服务网格是一种基础设施层，通常使用应用代理来实现各种功能。以 Istio 为例，它通过应用代理让用户能够将应用感知的流量管理、强大的可观测性和稳健的安全能力编程到网络中。Istio 确保云原生和分布式系统具有弹性，使现代企业能够在不同平台上维护其工作负载，同时保持连接和受保护。它的功能包括零信任安全、策略管理和访问控制等安全和治理控制，以及金丝雀部署、A\/B 测试、负载均衡和故障恢复等网络功能，还能提供对整个网络流量的可观测性。Istio 不受单一集群、网络或运行时的限制，可以将在 Kubernetes 或虚拟机上运行的服务、多云、混合或本地的服务包含在单个网格中。其设计可扩展，并得到广泛生态系统的支持。\n\n服务网格的架构分为控制平面和数据平面，以 Istio 为例，\u0060istiod\u0060 是它的控制平面，而数据平面有两种部署模式，用户可以选择 sidecar 或 ambient 模式。\n\n![Istio 服务网格的架构图（来源 [istio.io](https:\/\/istio.io\/latest\/about\/service-mesh\/)）](service-mesh.svg)\n\n实际上服务网格的数据平面的部署模式不止这两种，加上 Istio 支持的 [gRPC 无 sidecar 的服务网格](https:\/\/istio.io\/latest\/blog\/2021\/proxyless-grpc\/)，以及 [Cilium service mesh](https:\/\/cilium.io\/use-cases\/service-mesh\/)，一共有四种部署模式。\n\n## 数据平面部署模式\n\n下表格从多个维度对服务网格数据平面的部署模式进行了比较。\n\n{{\u003ctable \u0022服务网格的四种部署模式对比\u0022\u003e}}\n\n| **数据平面模式**                          | **平台安全性** 威胁评估、风险                                | **资源效率** – 基础设施\/资源消耗等             | **可管理性** – 升级、漏洞等                                | **性能** – 延迟等                                          |\n| ----------------------------------------- | ------------------------------------------------------------ | ---------------------------------------------- | ---------------------------------------------------------- | ---------------------------------------------------------- |\n| **Sidecar模式**：每个服务实例的L4和L7代理 | 高安全性，因为每个服务实例都有独立的代理，减少了攻击面。风险管理取决于控制平面配置。 | 较高的资源消耗，因为每个实例需要独立的代理。   | 需要集中管理和配置，升级相对复杂，但可以通过控制平面简化。 | 请求需要通过代理转发，可能增加延迟。                       |\n| **Ambient模式**：共享L4 – L7每个服务模型  | 通过ztunnel进行本地路由设计的安全性。然而，共享代理可能会带来风险，其整体安全成熟度仍在发展中。 | 效率较高，因为多个服务共享相同的代理。         | 管理相对简单，但可能因共享代理而面临漏洞。                 | 本地路由性能良好，但在waypoint代理下可能会产生跨AZ的成本。 |\n| **Cilium Mesh模式**：共享L4和L7模型       | 中等安全性，专注于eBPF和细粒度访问控制。然而，身份和信任模型方面存在已知问题。 | 内核级处理提高效率，减少基础设施开销。         | 管理更复杂，需要处理多个服务的配置。                       | 性能可变；某些场景可能会引入显著的延迟。                   |\n| **gRPC模式**：L4和L7集成在应用模型中      | 虽然gRPC将代理功能集成在应用程序中，理论上减少了攻击面，但应用程序的复杂性和多样性实际上可能扩大它。gRPC模式的安全性依赖于具体的用例，需要对潜在威胁和攻击面进行仔细评估。 | 更高的效率，因为代理在与应用相同的进程中实现。 | 管理复杂，需要定期更新和维护应用层代理。                   | 性能优越，延迟低，适合实时应用。                           |\n\n{{\u003c\/table\u003e}}\n\n你可以从下图中更直观地看到这四种模式在成本和安全性方面的比较：\n\n![服务网格部署模式对比](istio-data-plane-deployment-modes.svg)\n\n下图说明了服务网格数据平面的不同部署模式中代理的潜在位置。\n\n![服务网格数据平面的不同部署模式中的代理位置](overview.svg)\n\n- **Sidecar 模式**：代理与应用程序容器位于同一个 Pod 中\n- **Ambient 模式**：L4 代理与应用程序容器位于同一个节点上，L7 代理不一定跟应用程序容器在同一个节点上\n- **Cilium 模式**：L4 和 L7 代理作为一个整体与应用程序容器在同一个节点上\n- **gRPC 模式**：gRPC 框架集成到应用程序中，共同部署在一个容器中\n\n## Sidecar 模式：每个服务实例一个 L4 和 L7 的代理\n\n下面展示的是 sidecar 模式中 Application 1 访问同节点上的 Application 2 及跨节点上的 Application 3 的通信路径。\n\n![Sidecar 模式：每个服务实例一个 L4 和 L7 代理](sidecar-mode.svg)\n\n这是最常见的服务网格部署模式，也是 [Istio](https:\/\/istio.io) 服务网格起初支持的模式。每个服务实例旁边部署一个代理（如 [Envoy](https:\/\/envoyproxy.io)），该代理处理进出该服务的所有网络通信，包括 L4 和 L7 网络通信。\n\n- **优点**：安全性高，因为每个服务实例都是隔离的，减少了潜在的攻击面。\n- **缺点**：资源消耗较高，因为每个服务实例都需要单独的代理，增加了基础设施成本。\n- **成熟度**：Istio Sidecar 模式的成熟度已经达到生产级别，它们经过广泛测试并准备好在实际环境中使用。\n\n## Ambient 模式：节点共享 L4 代理，服务账户共享 L7 代理\n\n下面展示的是 ambient 模式中 Application 1 访问同节点上的 Application 2 及跨节点上的 Application 3 的通信路径。\n\n![Ambient 模式：节点共享 L4 代理，服务账户共享 L7 代理](ambient-mode.svg)\n\n在这种模式下，每个节点上的共享L4代理为同一物理主机上的所有服务实例提供服务，而每个服务账户都有一个专用的L7代理。\n\n- **优点**：成本较低，因为多个服务共享同一个代理。\n- **缺点**：尽管ztunnel（Istio网格中）组件是为安全性设计的，共享代理可能会带来风险。此模型的安全成熟度仍在发展中。\n- **成熟度**：Istio的Ambient模式目前处于beta阶段，没有大规模的生产级最佳实践，也不支持多集群。\n\n## Cilium mesh 模式：共享的 L4 和 L7 代理\n\n下面展示的是 Cilium mesh 模式中 Application 1 访问同节点上的 Application 2 及跨节点上的 Application 3 的通信路径。\n\n![Cilium mesh 模式：共享的 L4 和 L7 代理](cilium-mesh-mode.svg)\n\n这种模式介于完全独立和完全共享之间，每个节点都有一个共享的L7代理。然而，身份和信任模型方面存在已知问题。使用eBPF的Cilium服务网格允许通过内核程序实现无需代理的网络策略。\n\n- **优点**：在特定场景下，内核级效率可以降低基础设施成本。\n- **缺点**：管理更复杂，某些场景可能会导致延迟增加。\n- **成熟度**：Cilium Mesh通过eBPF直接管理L4流量，并在每个节点上配置Envoy代理以通过CRD（如CiliumEnvoyConfig）控制L7流量。然而，由于身份模型不一致，其安全性令人担忧。该[代理](https:\/\/github.com\/cilium\/proxy)是经过定制过的，它具有最少的 Envoy 扩展和 Cilium 策略执行过滤器。因此，该 Cilium mesh 可能无法支持 Envoy 代理的全部功能。\n\n**注意**：该模式并非 Istio 的数据平面。\n\n## gRPC 模式：L4 和 L7 代理集成到应用程序内\n\n在gRPC模式中，没有部署外部代理；而是通过RPC框架将代理功能直接集成到应用程序中，导致对应用程序的显著侵入。服务网格控制平面使用一组称为xDS API的发现API来动态配置应用程序。应用程序中的gRPC客户端库提供对xDS API的广泛支持。利用这种能力，服务网格控制平面可以在服务容器内的这个库中直接编程L4和L7代理功能。\n\n下图展示了在 Istio 的 gRPC 模式中，控制平面如何与应用程序通信。\n\n![gRPC 模式：L4 和 L7 代理集成到应用程序内](grpc-mode.svg)\n\n在这种模式下，当gRPC服务与控制平面通信时，不需要传统的Sidecar代理，而是使用特定的代理进行初始化和与控制平面的通信。此设计减少了资源消耗和部署复杂性，同时仍能实现服务发现、流量管理等功能。\n\n- **优点**：高性能，由于代理与应用程序紧密集成，减少了网络跳跃和额外的开销。\n- **缺点**：高复杂性，需要在应用程序内部实现复杂的网络处理功能，这可能增加开发成本。\n- **安全性考虑**：这种模式的安全性存在争议。虽然将代理功能集成在应用程序中理论上减少了外部攻击面，但应用程序的多样性和复杂性可能会扩大整体攻击面。因此，在考虑gRPC模式的安全性时，必须仔细分析其具体用例中的安全威胁模型和攻击风险。\n- **成熟度**：Istio的gRPC模式仍处于实验阶段。\n\n## 如何选择？\n\n如前所述，选择服务网格数据平面部署模式的决定因素有多个：\n\n- 成熟度\n- 企业的安全需求\n- 资源限制\n- 性能要求\n- 网络开销\n- 管理复杂性的容忍度\n\n### 成熟度\n\n在考虑服务网格数据平面部署模式时，成熟度是一个关键因素。每种模式的成熟度都会影响其在生产环境中的可靠性和支持程度：\n\n- **Sidecar模式**：这是最成熟的服务网格部署模式，广泛应用于生产环境，并得到良好支持。\n- **Ambient模式**：尽管该模式提供了一些成本和性能优势，但它仍处于早期阶段，可能缺乏成熟的最佳实践和广泛的生态系统支持。\n- **Cilium Mesh模式**：作为一个相对较新的选择，它在使用eBPF的场景中提供了独特的技术优势。然而，其安全模型和身份管理的担忧表明，它可能不像其他模式那样成熟或可靠。\n- **gRPC模式**：尽管性能出色，但这种模式的复杂性和侵入性意味着它可能需要更多的定制开发，目前仍处于实验阶段。\n\n### 安全需求\n\n如果您的业务有较高的安全需求，如金融或医疗行业，那么**Sidecar模式**可能是最佳选择。这种模式通过确保每个服务实例都有自己独立的代理，从而最大限度地实现服务隔离。对于那些探索较新模式（如**Ambient模式**）的用户来说，必须了解虽然ztunnel旨在实现安全的本地路由，但该模式的整体安全策略仍在发展中。\n\n### 资源限制\n\n在资源受限的环境中，为每个服务实例部署一个单独的代理可能不切实际。在这种情况下，可以考虑**gRPC模式**或**Ambient模式**。**gRPC模式**特别适合已经广泛使用gRPC且愿意在应用程序内部处理复杂网络功能的组织。另一方面，**Ambient模式**通过共享代理来减少资源消耗。\n\n### 性能要求\n\n对于需要高性能和低延迟的应用程序，**gRPC模式**提供了最佳性能，因为它消除了传统代理引入的额外网络跳跃。然而，值得注意的是，gRPC模式仍处于实验阶段，可能不支持Istio的所有功能。请根据您的服务网格功能需求进行考虑。\n\n### 网络开销\n\n每种数据平面模式对网络开销都有不同的影响。**Sidecar模式**通过本地化路由减少了跨区域流量，但增加了网络跳跃，增加了延迟和计算使用。**Ambient模式**使用ztunnel进行本地路由，但在waypoint代理下可能会产生跨AZ的成本。**Cilium模式**将代理放置在与应用程序相同的节点上，可能减少节点间的流量，但可能引入更多的延迟。**gRPC模式**将RPC框架集成到应用程序中，最小化网络跳跃和开销，适用于高性能、低延迟的需求。\n\n### 对管理复杂性的容忍度\n\n选择服务网格数据平面模式时，管理复杂性也是一个重要的考虑因素。**Sidecar模式**和**gRPC模式**可能需要更复杂的配置和维护，而在某些部署环境中，**Ambient模式**可能提供更简化的管理体验。**Cilium模式**由于依赖于eBPF和多个配置点，可能需要更复杂的管理。\n\n## 结论\n\n选择正确的服务网格数据平面部署模式取决于多个特定因素，包括成熟度、安全性、资源限制、性能和管理复杂性。以下是一个快速指南：\n\n- **Sidecar模式**：最适合高安全需求，提供最大的隔离性。\n- **gRPC模式**：适用于高性能需求且已在使用gRPC的环境。\n- **Ambient模式**：适合成本效益和较低隔离需求，但安全模型正在演变中。\n- **Cilium Mesh模式**：可能适用于利用eBPF技术的基础设施，但需考虑安全性和管理复杂性。\n\n最佳选择将与您的应用程序需求、安全策略和技术熟悉度相一致。理解每种模式的优势和局限性，以做出平衡收益、风险和成本的明智决策。\n\n## 参考文献\n\n- [云原生应用的服务网格代理模型](https:\/\/csrc.nist.gov\/pubs\/sp\/800\/233\/ipd)\n', '\/blog\/service-mesh-data-plane-deployment-modes\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文解析四种服务网格数据平面部署模式：Sidecar、Ambient、Cilium mesh 和 gRPC。分析架构、性能、安全、管理复杂性和资源成本，提供选择建议，助你在不同场景做最优决策，无论追求高性能、低资源消耗还是高安全保障，都能找到合适模式。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/service-mesh-sidecar-vs-sidecarless-debate/">服务网格架构：Sidecar vs. Sidecarless，谁才是未来？</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/09/09</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('服务网格架构：Sidecar vs. Sidecarless，谁才是未来？', '探讨服务网格架构中 sidecar 与 sidecarless 的争论，比较 Cilium、Istio 和 Linkerd 在安全性、性能和架构复杂性方面的不同观点，帮助读者理解这些技术专家的看法和背后的争议。', '\n服务网格已经成为现代云原生应用架构中至关重要的一部分，帮助团队在大规模分布式系统中管理微服务通信、提高安全性并优化性能。然而，随着技术的不断演进，关于服务网格架构的最佳实践出现了激烈的争论，尤其是关于 sidecar 与 sidecarless 模式的选择问题。这场争论的核心在于如何在性能、资源利用、安全性和操作复杂性之间取得最佳平衡。近年来，Cilium 引入了无 sidecar 架构的 eBPF 技术，而 Istio 也推出了 Ambient 模式，结合了传统 sidecar 与无 sidecar 的优点。与此同时，Linkerd 则坚守 sidecar 架构，并对新兴的无 sidecar 方法持保守态度。这篇文章将深入探讨这些服务网格架构的主要观点和争议，并分析每种方法的优势与挑战。\n\n## 关于服务网格有无 sidecar 的争论\n\n关于服务网格的 sidecar 与无 sidecar 的争论是随着 Cilium 的推出和各大服务网格技术的演变而逐渐加剧的，尤其是在 2021 年之后：\n\n1. **Cilium Service Mesh 的推出（2021 年 12 月）**  ：Cilium 通过 eBPF 技术引入了无 sidecar 的服务网格架构，开始引发对传统 sidecar 模式的讨论。这一概念的提出标志着无 sidecar 架构的兴起。\n   \n2. **Linkerd 与 Istio 的反应（2021 年 12 月至 2022 年初）** ：Linkerd 的创始人 William Morgan 及其团队对 Cilium 的无 sidecar 方法表示担忧，认为这种方法可能会带来安全和性能上的问题。这一讨论逐渐演变为对 sidecar 与无 sidecar 架构的更广泛争辩。\n   \n3. **Istio 的 Ambient 概念（2022 年 5 月）** ：Istio 提出了 Ambient Mesh，尝试结合 sidecar 和主机级代理的优势，这进一步加剧了各方对服务网格架构的讨论。此时，业界对不同服务网格架构的看法开始分化。\n   \n4. **专家观点的发表（2021 年 12 月至 2023 年）**  ：多位行业专家如 Thomas Graf 和 William Morgan 等在不同场合发表了对 sidecar 与无 sidecar 架构的看法，形成了更为系统的争论。这些观点在多个会议和文章中被广泛讨论，推动了对服务网格架构的深入理解。\n\n## 各方观点\n\n下表摘录了各服务网格提供商及用户的公开观点。\n\n{{\u003ctable \u0022关于服务网格技术选型的公开观点\u0022\u003e}}\n\n| **人物**            | **职位\/公司**                             | **观点**                                                     |\n| ------------------- | ----------------------------------------- | ------------------------------------------------------------ |\n| **Andrey Rybka**    | Bloomberg                                 | 倾向于选择成熟度更高的 Istio，特别是在有 Google 等大公司支持的情况下。 |\n| **Ara Pulido**      | Datadog 开发者关系专家                     | 认为 eBPF 工具（如 Cilium）是 Kubernetes 网络扩展问题的解决方案，使用 Cilium 可以完全替代 kube-proxy，实现更细粒度的容器安全特性；移除 kube-proxy 后，操作简化，性能提升。 |\n| **Dale Ragan**      | SAP Concur Technologies 首席软件设计工程师 | 认为 eBPF 在安全方面提供了更好的优势，可同时应用于整个集群和各个服务；正在使用 Cilium 替代 Flannel 作为其生产环境中的容器网络接口（CNI）插件，并测试 Isovalent 的专有 SecOps 插件。 |\n| **Dan Wendlandt**   | Isovalent CEO                             | 认为 eBPF 和服务网格是互补的技术，eBPF 可作为服务网格的基础，为服务网格代理（如 Envoy）提供高效的数据进出服务。 |\n| **David Ortiz**     | Constant Contact 首席软件工程师            | 对 Istio 的 Ambient Mesh 非常感兴趣，认为其显著简化了 Istio 的操作流程，尤其是在升级方面，计划尽快采用这一技术。 |\n| **Filip Nikolic**   | PostFinance                               | 认为 eBPF 基础的无 sidecar 服务网格具有更高的网络性能和效率，并且安全实践也在不断进化。 |\n| **Greg Otto**       | Comcast 云服务执行董事                     | 对 Istio Ambient Mesh 感兴趣，计划在其成熟后进行评估；希望能够分别扩展和服务第 7 层（L7）和第 4 层（L4）功能，认为减少不必要的 L7 过滤可以减少安全暴露面和漏洞风险。 |\n| **John Mitchell**   | 独立数字化转型顾问                        | 认为 eBPF 正经历一个炒作周期，但它确实有潜力为 Kubernetes 提供高级网络安全特性，而无需改变应用程序代码。 |\n| **Kasper Nissen**   | Lunar 的首席平台架构师                     | 支持 sidecar 架构，认为它简单易用，并与其他容器技术相同；在全面部署服务网格后，资源消耗增加不多但功能增多；指出 sidecar 同步问题源于 Kubernetes 网络层的问题，建议在 Kubernetes 层面进行修复。 |\n| **Louis Ryan**      | Solo.io CTO                               | 强调 Istio 1.23 版引入的 Ambient Mesh 的优势，包括减少 sidecar 的使用，简化架构，提高性能，降低复杂性，并增强了灵活性与可扩展性。他认为，Ambient Mesh 能够帮助团队更轻松地管理微服务架构。 |\n| **Thomas Graf**     | Isovalent CTO                             | 主张通过 eBPF 和 Cilium 提供无边车的服务网格，优化 mTLS 认证，消除 sidecar 的使用，从而提高性能和安全性。认为分离认证握手和数据传输的模式能够实现更高效、更灵活的服务间认证，同时减少管理复杂性，并提供对多种网络协议的支持。 |\n| **William Morgan**  | Linkerd 创始人兼 Buoyant CEO                | 强烈批评无 sidecar 的 eBPF 方法，认为 sidecar 提供了更好的安全隔离和性能预测性，指出 sidecarless 架构可能重蹈 Linkerd 1 的覆辙。他认为，eBPF 和 sidecar 不是对立的，eBPF 可以用于网络优化，但不应替代 sidecar。主张继续使用更轻量的 sidecar 代理。 |\n| **Zachary Butcher** | Tetrate 创始工程师                         | 对 Ambient Mesh 持审慎乐观态度，认为它有助于降低服务网格的采用难度，但当前性能表现较差、功能有限，距离生产就绪还有很长的路要走。他建议用户暂时不要在生产环境中使用 Ambient Mesh，直到其成熟度提高。 |\n\n{{\u003c\/table\u003e}}\n\n## 个人观点\n\n近年来，我有幸见证并参与了许多关于服务网格架构选择的讨论和实践。我认为服务网格选择不应仅仅基于技术特性的比较，更应考虑到团队的具体需求、现有技术栈的兼容性以及未来的扩展性。\n\n在 sidecar 与 sidecarless 的选择问题上，我的看法是两者各有千秋。Sidecar 模型虽然在某些情况下可能会带来资源占用和管理复杂性的增加，但它提供了更细粒度的流量控制和安全策略实施，这对于需要高度精细化管理的企业环境是非常宝贵的。与此同时，sidecarless 模型，尤其是通过 eBPF 技术实现的，为服务网格带来了前所未有的性能优化和资源利用率提升，它对于构建高效率的大规模服务网格同样具有重要价值。\n\n因此，我的建议是，企业在选择服务网格架构时，应该从自身的业务需求出发，综合考虑安全性、性能、成本以及团队的运维能力，选择最适合自己的服务网格解决方案。\n\n## 总结\n\n总结下目前关于这三个流行的服务网格项目的主流看法：\n\n1. **Linkerd**：强调 sidecar 的安全隔离和性能稳定性，对 eBPF 无 sidecar 模式持批评态度，认为其复杂性和安全风险增加。\n2. **Istio**：引入 Ambient Mesh，部分采用无 sidecar 方法，以降低复杂性和提高性能，但仍保留 sidecar 的部分功能，体现出对现有 sidecar 架构的保留与创新。\n3. **Cilium**：主张通过 eBPF 无 sidecar 模式来优化网络性能和安全性，简化操作，同时保持对多种协议的支持，推动服务网格功能集成到 Linux 内核中。\n\n不同的观点反映了各自对服务网格架构设计的偏好与关注点，不同企业应根据自身需求和技术背景选择合适的服务网格方案。\n\n## 参考\n\n- [Sidecarless eBPF service mesh sparks debate](https:\/\/www.techtarget.com\/searchitoperations\/news\/365535362\/Sidecarless-eBPF-service-mesh-sparks-debate)\n\n- [eBPF or not: Sidecars are the future of the service mesh](https:\/\/thenewstack.io\/ebpf-or-not-sidecars-are-the-future-of-the-service-mesh\/)\n\n- [eBPF Service Mesh](https:\/\/isovalent.com\/blog\/post\/2021-12-08-ebpf-servicemesh\/)\n\n- [Linux kernel utility could solve Kubernetes networking woes](https:\/\/www.techtarget.com\/searchitoperations\/news\/252483517\/Linux-kernel-utility-could-solve-Kubernetes-networking-woes)\n\n- [Service Mesh Security](https:\/\/isovalent.com\/blog\/post\/2022-05-03-servicemesh-security\/)\n\n- [Istio 1.23 drops the sidecars for a simpler ambient mesh](https:\/\/thenewstack.io\/istio-1-23-drops-the-sidecars-for-a-simpler-ambient-mesh)\n\n- [Ambient Mesh: What you need to know about this experimental new deployment model for Istio](https:\/\/tetrate.io\/blog\/ambient-mesh-what-you-need-to-know-about-this-experimental-new-deployment-model-for-istio\/)\n\n- [Sidecarless service mesh: fad or the future?](https:\/\/www.techtarget.com\/searchitoperations\/news\/252526651\/Sidecarless-service-mesh-fad-or-the-future)\n', '\/blog\/service-mesh-sidecar-vs-sidecarless-debate\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">探讨服务网格架构中 sidecar 与 sidecarless 的争论，比较 Cilium、Istio 和 Linkerd 在安全性、性能和架构复杂性方面的不同观点，帮助读者理解这些技术专家的看法和背后的争议。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/hong-kong-trip/">香港——内地的一面的镜子</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/09/06</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e6%97%85%e8%a1%8c"> 
             旅行
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('香港——内地的一面的镜子', '上个月，因为参加 KubeCon China，我第一次前往香港，这让我有机会近距离审视这颗“东方明珠”。', '\n上个月，因为参加 KubeCon China，我第一次前往香港，这让我有机会近距离审视这颗“东方明珠”。\n\n![从尖沙咀眺望香港岛](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/jianshazui.webp)\n\n我不记得之前在哪里看到一个说法，说是“香港是中国内地的一面镜子”。香港因其特殊的历史背景、经济发展轨迹以及在回归后的一系列表现等，许多人都在分析研究过程中会将香港的发展情况、社会治理经验教训等与内地进行关联和比较，认为其在某些方面可以为内地提供参考借鉴，就如同镜子一样反映出一些现象和问题的不同侧面及解决路径的可能性等。比如一些研究区域发展和社会治理的专家学者在相关论述中可能就会涉及到类似的观点表达。\n\n## 香港与内地的不同\n\n香港与内地存在着诸多不同，这些不同不光是表面上的：\n\n| 维度         | 香港                                        | 内地                                          |\n|--------------|---------------------------------------------|-----------------------------------------------|\n| 政治制度     | 资本主义制度，行政长官是特别行政区首长。     | 社会主义制度，人民代表大会制度。               |\n| 法律体系     | 英美法系，判例法重要。                       | 大陆法系，以成文法为主。                       |\n| 经济体制     | 自由市场经济，服务业和金融为主。              | 社会主义市场经济，公有制为主体，多种所有制发展。|\n| 文化方面     | 中西文化交融，保留大量中华传统文化。           | 以中华文化为主，地域文化多样。                 |\n| 教育体系     | 推行“三三四”学制，多语言教学，注重素质教育。    | 国家指导，地方负责，应试教育为主，统一教材。    |\n| 医疗体系     | 公立私立并存，谨慎用药，社区医院为主。          | 医疗体系多元，大医院资源紧张，用药依据病情。    |\n| 税收制度     | 地域来源征税，税种少，税率低。                 | 居民身份征税，税种多，税负较高。               |\n| 养老保障     | 强积金制度，雇主和雇员共同供款。               | 职工和居民基本养老保险，缴费比例不同。         |\n| 语言使用     | 粤语为主，英语广泛使用。                      | 普通话为主，各地方言众多。                     |\n| 文字形式     | 使用繁体中文。                                | 使用简体中文。                                 |\n| 生活习惯     | 饮食清淡，煲汤文化，部分西方生活习惯。           | 饮食丰富多样，生活习惯因地域文化不同。          |\n| 消费观念     | 消费多元化，注重品质，高端品牌接受度高。          | 消费观念多样化，与经济水平有关。               |\n| 交通规则     | 靠左行驶，驾驶位在右侧。                      | 靠右行驶，驾驶位在左侧。                       |\n| 住房情况     | 土地少，房价高，公屋制度完善。                  | 住房类型多样，房价差异大。                     |\n| 电影分级     | 有明确的电影分级制度。                         | 无明确电影分级，审查严格。                     |\n| 新闻出版审查   | 新闻出版较自由，但有监管。                     | 严格的新闻出版审查制度。                       |\n| 网络开放度     | 互联网相对开放，全球大多数网站可访问。           | 互联网监管严格，部分国外网站被屏蔽。            |\n| 护照含金量     | 可免签或落地签前往约 170 个国家和地区。             | 可免签或落地签前往约 80 个国家和地区。           |\n| 计量单位使用   | 使用英制和公制单位。                          | 主要使用公制单位。                             |\n| 电压和插座类型 | 220V，英式三插（G 型）。                      | 220V，双孔和三孔插座（A 型、I 型）。              |\n| 手机支付普及度 | 现金和信用卡普及，八达通卡使用广泛。             | 手机支付非常普及，微信支付和支付宝常用。         |\n| 购物和零售模式 | 国际品牌与本地品牌并存，夜市和街边小店常见。       | 大型购物中心、超市、夜市、电商平台多样。         |\n| 社交习惯       | 英语使用普遍，西方社交礼仪。                   | 普通话为主，传统社交礼仪。                     |\n| 宗教信仰       | 多元宗教环境，宗教自由。                       | 宗教信仰有限制，信仰自由受法律保护。            |\n| 食品安全标准   | 食品进口和监控严格，国际标准。                 | 标准逐渐完善，偶有问题。                       |\n| 工作时间和假期 | 每周 44 小时，公共假期多。                       | 每周 40 小时，法定节假日较少。                    |\n\n## 香港拥挤的交通\n\n香港岛是香港最繁华的地方，面积约 78.10 平方公里，这里集中了大量的商业、办公和住宅区域，吸引了众多人口和车辆，交通压力较大。在香港岛上，有一种极具特色的交通工具——叮当车，它也被称为有轨电车。叮当车全部分布在港岛北部狭长的地带，共有 6 条线路，全都经过港岛繁华热闹的地区，如铜锣湾、跑马地、中环等。它的车身通常为双层，造型古朴，当司机踩到踏脚时，车子会发出“叮当、叮当”的声响，故而得名。\n\n![香港岛上的叮当车](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/dingdingche.webp)\n\n在香港旺角的街头，人群如潮水般涌动。这里是繁华都市的缩影，喧嚣与热闹交织成一幅独特的画卷。摩肩接踵的人们，怀揣着各自的梦想与故事，在这个充满活力的地方穿梭。时尚的店铺、美味的小吃、璀璨的灯光，共同构成了旺角的魅力。每一个匆忙的脚步，每一张洋溢着笑容的脸庞，都在诉说着这座城市的无限可能。旺角，一个让人感受香港脉搏跳动的地方，永远充满着生机与活力。\n\n![旺角的夜晚街景](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/wangjiao.webp)\n\n香港岛地形以山地为主，地势较高，自北向南地势渐缓，环岛沿岸曲折，多美景港湾。岛上的主要山峰包括太平山、柏架山、奇力山等，其中太平山是香港岛的最高峰，海拔 554 米。\n\n兰桂坊位于香港岛中西区中环，是一个聚集大小酒吧与餐馆的中高档消费区。它由德己立街、威灵顿街、云咸街、和安里、仁寿里及荣华里构成，宽约 20 米，长约 300 米。20 世纪中期，香港经济腾飞，商业高速发展，夜总会文化开始在香港流行，很多在香港工作或暂居的外国人渴求适合他们品味和要求的娱乐场所，兰桂坊便应运而生。每当夜幕降临，这里便会灯红酒绿，觥筹交错，置身这里让我仿佛置身东南亚，感觉跟泰国很像。\n\n![兰桂坊周边的街道夜景](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/languifang.jpg)\n\n## 本地特色\n\n我在香港 City walk 的时候发现的一些本地特色。\n\n我发现很多建筑使用竹子搭建的脚手架，现在竹子脚手架在大城市中很少见到了。\n\n![堆放在地上的竹子](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/zhuzi.webp)\n\n![使用竹子搭建的脚手架](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/jiaoshoujia.webp)\n\n我还在庙街看到算命一条街，还有一家店代客烧香。\n\n![算命一条街](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/suanming.webp)\n\n![代客拜先人](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/baozhi.webp)\n\n最后本地的粤菜真的很好吃，我吃了一道炸猪排，外焦里嫩，口水直流。\n\n![炸猪排](https:\/\/jimmysong.io\/img\/blog\/hong-kong-trip\/zhazhupai.jpg)\n\n## 总结\n\n在香港的这次旅行中，我不仅领略了这座城市的繁华与多样性，还感受到了它作为一面“镜子”所带来的思考。香港的独特之处在于它东西方文化的交融、现代与传统的结合，以及其与内地在政治、经济、文化等方面的显著差异。无论是乘坐叮当车穿行在港岛繁华的街道，还是漫步在兰桂坊体验夜生活的丰富多彩，亦或是在街头巷尾发现本地的特色文化，这一切都让我更加理解为什么有人说香港是中国内地的一面镜子。通过这面镜子，我们可以看到一个不同的视角，这不仅让我们更好地理解香港，也能反思内地的许多方面，为未来的社会和经济发展提供更多的借鉴和启示。\n', '\/blog\/hong-kong-trip\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">上个月，因为参加 KubeCon China，我第一次前往香港，这让我有机会近距离审视这颗“东方明珠”。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/ambient-mesh-can-sidecar-less-istio-make-applications-faster/">[译] Istio Ambient 模式：无 Sidecar Istio 如何让应用更快？</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/09/05</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://thenewstack.io/ambient-mesh-can-sidecar-less-istio-make-applications-faster/" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Istio Ambient 模式：无 Sidecar Istio 如何让应用更快？', '探索如何使用 Fortio 与 Istio 集成，在使用 Bookinfo 应用和流行的 DevOps 工具如 Kubernetes、Prometheus 和 Grafana 的微服务架构中进行高效的性能测试和监控。', '\nAmbient 模式是 2022 年在 [Istio](https:\/\/thenewstack.io\/simplifying-cluster-connectivity-with-istio-service-mesh\/) 中引入的新型无 sidecar 数据平面。当今年 5 月 [Ambient 模式](https:\/\/thenewstack.io\/ambient-mesh-sidestepping-the-sidecar\/) 达到 [Beta](https:\/\/istio.io\/latest\/blog\/2024\/ambient-reaches-beta\/) 阶段时，我观察到用户开始试用并运行负载测试，以理解将应用添加到网格后的性能影响。\n\n受到 [Quentin Joly 的博客](https:\/\/a-cup-of.coffee\/blog\/istio\/#with-istio-ambient) 关于 Istio 在 Ambient 模式下的惊人性能的启发，以及来自社区其他用户有时应用在 [Ambient 模式](https:\/\/thenewstack.io\/istio-1-23-drops-the-sidecars-for-a-simpler-ambient-mesh\/) 下稍快的反馈，我决定自己验证这些结果。\n\n## 测试环境\n\n我使用了一个拥有 256GB RAM 和每个节点 32 核 CPU 的三节点 Kubernetes 集群。\n\n![](f1.webp)\n\nIstio 使用了一些工具来简化一致性的基准测试。首先，我们使用一个叫做 [Fortio](https:\/\/github.com\/fortio\/fortio) 的负载测试工具，它以指定的每秒请求数 (RPS) 运行，记录执行时间的直方图并计算百分位数，例如 P99，即 99% 的请求在此时间内完成。\n\n我们还提供了一个叫做 [Bookinfo](https:\/\/istio.io\/latest\/docs\/examples\/bookinfo\/) 的示例应用，其中包括用 Python、Java、Node.js 和 Ruby 编写的微服务。\n\n每个 Bookinfo 部署都有两个副本，这些副本均匀分布在三个工作节点上。使用 [pod anti-affinity rule](https:\/\/kubernetes.io\/docs\/concepts\/scheduling-eviction\/assign-pod-node\/#affinity-and-anti-affinity)，我确保 Fortio 被放置在与 [details](https:\/\/github.com\/istio\/istio\/tree\/master\/samples\/bookinfo\/src\/details) 服务不同的节点上。\n\n## 初始测试结果\n\n我从 Istio v1.22.3 版本安装了 Bookinfo 应用。使用 Fortio 工具对单个 Bookinfo 服务（例如 details）或完整的 Bookinfo 应用进行负载驱动，我注意到在将所有服务添加到 ambient 网格后，延迟影响 **接近零**。大多数时间它们的增加范围在 0-5% 之间，用于平均值或 P90。我一致注意到 Istio 的 details 服务在 ambient 模式下稍微快一点，就像 Quentin 在他的博客中报告的那样。\n\n### 对 Details 服务进行负载测试\n\n我进行了与 Quentin 相同的测试，通过 10 个连接发送 100 RPS 到 details 服务，并收集了无网格和 ambient 的结果。\n\n![无网格：details 服务 100 RPS。](f2.webp)\n\n![Ambient：details 服务 100 RPS。](f3.webp)\n\n就像 Quentin 一样，我不得不进行多次测试以验证 ambient 模式比无网格模式略有性能提升——这很难让人相信！对于 Bookinfo 的 details 服务来说，加入 ambient 模式平均降低了 6-11% 的延迟——以及添加了 mTLS 和 L4 观测！\n\n| **Fortio 对 details** | **平均** | **P50** | **P75** | **P90** | **P99** | **差异**                  |\n| --------------------- | -------- | ------- | ------- | ------- | ------- | ------------------------- |\n| **无网格运行 1**      | 0.89ms   | 0.64ms  | 0.74ms  | 0.85ms  | 2.67ms  | **平均慢 11%，P90 慢 5%** |\n| **Ambient 运行 1**    | 0.80ms   | 0.6ms   | 0.71ms  | 0.81ms  | 1.4ms   |                           |\n| **无网格运行 2**      | 0.86ms   | 0.65ms  | 0.75ms  | 0.86ms  | 1.71ms  | **平均慢 6%，P90 慢 4%**  |\n| **Ambient 运行 2**    | 0.81ms   | 0.61ms  | 0.72ms  | 0.83ms  | 1.56ms  |                           |\n| **无网格运行 3**      | 0.90ms   | 0.65ms  | 0.76ms  | 0.88ms  | 1.92ms  | **平均慢 10%，P90 慢 5%** |\n| **Ambient 运行 3**    | 0.82ms   | 0.63ms  | 0.72ms  | 0.84ms  | 1.5ms   |                           |\n\n*表 1: Fortio 对 details 服务 100 RPS 10 连接。*\n\n## 为什么应用有时在 Ambient Mesh 中更快？\n\n我们被教导说服务网格会增加延迟。Quentin 的结果，这里复制的结果，展示了一个工作负载在通过服务网格运行时*更快*的案例。这是怎么回事？\n\n### 第一种理论\n\n当您的应用位于 ambient 模式 中时，负载请求首先通过一个轻量级的本地节点代理叫做 [ztunnel](https:\/\/istio.io\/latest\/docs\/ambient\/overview\/#ztunnel)，然后传送到目的地 ztunnel，再向服务传送。details 服务使用带有 Webrick 库的 HTTP\/1.1，我们已经看到旧的或配置不良的 HTTP 库中存在连接管理和保持活动状态的行为不佳。我的第一个假设是，当客户端和服务器位于不同节点时，通过客户端和服务器 ztunnels 代理实际上可能更快，如果应用没有使用高效的 HTTP\/2 连接的话。Ztunnel 使用连接池和 [HTTP Connect](https:\/\/en.wikipedia.org\/wiki\/HTTP_tunnel) 建立节点之间的安全通道，以在负载下利用并行性和 HTTP\/2 流多路复用。\n\n![](f4.webp)\n\n然而，这个理论有一些挑战。为什么我只在 details 服务上一致观察到这个，而不是任何其他 Bookinfo 服务？\n\n进一步研究，我发现我们的 Fortio 负载工具默认启用了[连接保持活动](https:\/\/github.com\/fortio\/fortio\/blob\/8a7d9112667e637139c788b68cb063f456d20cb4\/bincommon\/commonflags.go#L55)。使用 10 个来自 Fortio 的连接到 details 服务和 details 服务（使用 WEBrick Ruby 库）尊重连接保持活动设置，连接可以有效地被重用，无需 ambient。\n\n### 用 Connection Close 进行负载测试\n\n接下来，我探索了使用设置 \u0060Connection: close\u0060 标头的同样负载测试。这强制禁用任何 HTTP 连接池，这是测试这个假设的好方法。\n\n\u0060\u0060\u0060bash\ncurl -v -d \u0027{\u0022metadata\u0022: {\u0022url\u0022:\u0022http:\/\/details:9080\/details\/0\u0022, \u0022c\u0022:\u002210\u0022, \u0022qps\u0022: \u0022100\u0022, \u0022n\u0022: \u00222000\u0022, \u0022async\u0022:\u0022on\u0022, \u0022save\u0022:\u0022on\u0022}}\u0027 \u0022localhost:8081\/fortio\/rest\/run?jsonPath=.metadata\u0022 -H \u0022Connection: close\u0022\n\u0060\u0060\u0060\n\n![无网格：details 服务 100 RPS 10 连接带有 connection close。](f5.webp)\n\n![Ambient：details 服务 100 RPS 10 连接带有 connection close。](f6.webp)\n\n| **Fortio 对** **details** | **平均** | **P50** | **P75** | **P90** | **P99** | **差异**                 |\n| ------------------------- | -------- | ------- | ------- | ------- | ------- | ------------------------ |\n| **无网格**                | 1.90ms   | 1.72ms  | 2.28ms  | 2.77ms  | 3.98ms  |                          |\n| **Ambient**               | 2.06ms   | 2.15ms  | 2.65ms  | 2.94ms  | 4ms     | **平均慢 8%，P90 慢 6%** |\n\n*表 2: Fortio 对 details 服务 100 RPS 10 连接带有 connection close。*\n\n与表 1 的结果相比，表 2 的响应时间明显更高，这是预期的，因为每个连接在 details 服务响应后立即关闭。考虑到 P50、P75、P90 和 P99 都从带有 connection close 的 ambient 运行中变慢，似乎可以安全排除第一理论中的 ztunnel 连接池可能使请求更快。\n\n### 第二种理论\n\n我注意到在我们新的 Istio v1.23 版本中的 details 和 productpage 服务中有一个与性能相关的 [PR](https:\/\/github.com\/istio\/istio\/pull\/51428\/files)。对于 details 服务，PR 为 details WEBrick 服务器启用了 [TCP_NODELAY](https:\/\/brooker.co.za\/blog\/2024\/05\/09\/nagle.html) 标志，这将减少来自 details 服务响应时间的不必要延迟（高达 [40ms](https:\/\/vorner.github.io\/2020\/11\/06\/40-ms-bug.html)）。对于 productpage 服务，PR 在传入请求上启用了保持活动状态，这将重用现有的传入连接，从而提高性能。\n\n包含修复的新更新的 details 部署中，我重复了通过 10 个连接发送 100 RPS 到 details 服务的相同测试。无网格和 ambient 的结果非常接近，所以我进行了三次测试以确保结果的一致性。下面是每个场景的第一次运行的截图：\n\n![无网格：新 details 服务 100 RPS 10 连接。](f7.webp)\n\n![Ambient：新 details 服务 100 RPS 10 连接。](f8.webp)\n\n我为每个场景的三次运行建立了一个表格：\n\n![](t1.webp)\n\n*表 3: Fortio 对新 details 服务 100 RPS 10 连接。*\n\n与表 1 的先前结果相比，表 3 的无网格数字有了相当大的改进（在更高百分比下更显著地超过 ambient 数字），现在接近于 ambient 数字。Ztunnel 默认启用了 [TCP_NODELAY](https:\/\/github.com\/istio\/ztunnel\/pulls?q=is%3Apr\u002bis%3Aclosed\u002bTCP_NODELAY)，这有助于 ambient 性能在表 1 中超过无网格，当旧的 details 服务没有启用 TCP_NODELAY 时。当新的 details 服务启用了 TCP_NODELAY 时，它也稍微提高了 ambient 的响应时间。\n\n表 3 还显示，在此类型的负载测试中，无网格和 ambient 运行之间的平均、P50、P75 和 P90 几乎没有差异。这些运行之间的差异可能只是噪音，除了 P99，无网格始终比 ambient 慢 8% 或更多。\n\n### 第三种理论\n\n继续审查表 3 的测试结果，为什么在有额外跳转到 ztunnel pod 和 ambient 提供的如 mTLS 和 L4 观测等显著优势时，无网格和 ambient 之间的延迟相似？对于 P99 情况，为什么 details 服务在 ambient 模式下始终更快？\n\nZtunnel 提供了出色的读写缓冲管理，并通过 HTTP\/2 多路复用，可以有效地最小化或有时甚至消除通过客户端和服务器 ztunnel pod 的额外跳转所增加的开销。我决定通过在两个 Fortio 和 details 服务的 Kubernetes 工作节点上进入并附加 strace 来测量这一点，同时过滤掉无关的跟踪：\n\n\u0060\u0060\u0060bash\nstrace -fp {pid} -e trace=write,writev,read,recvfrom,sendto,readv\n\u0060\u0060\u0060\n\n无网格和 ambient 情况下的 details 服务的 strace 输出是相似的：\n\n\u0060\u0060\u0060\n…read(9, \u0022GET \/details\/0 HTTP\/1.1\\r\\nHost: d\u0022..., 8192) = 118write(9, \u0022HTTP\/1.1 200 OK\\r\\nContent-Type: a\u0022..., 180) = 180write(9, \u0022{\u0022id\u0022:0,\u0022author\u0022:\u0022William Shakes\u0022..., 178) = 178write(2, \u0022192.168.239.19 - - [13\/Aug\/2024:\u0022..., 80) = 80…\n\u0060\u0060\u0060\n\n*输出 1: 无网格或 ambient —— 附加 strace 到 details 服务的 PID。*\n\n无网格和 ambient 情况下的 Fortio 服务的 strace 输出不同。在无网格情况下，我们看到 Fortio 执行了两次读取，一次用于 HTTP 头部，另一次用于正文。\n\n\u0060\u0060\u0060\n…read(13, \u0022HTTP\/1.1 200 OK\\r\\nContent-Type: a\u0022..., 4096) = 180read(13, \u0022{\u0022id\u0022:0,\u0022author\u0022:\u0022William Shakes\u0022..., 4096) = 178…write(19, \u0022GET \/details\/0 HTTP\/1.1\\r\\nHost: d\u0022..., 118) = 118 …\n\u0060\u0060\u0060\n\n*输出 2: 无网格 —— 附加 strace 到 Fortio 的 PID。*\n\n在 ambient 情况下，我们始终只看到一个读取，用于同时获取头部和正文。\n\n\u0060\u0060\u0060\n…read(19, \u0022HTTP\/1.1 200 OK\\r\\nContent-Type: a\u0022..., 4096) = 358…write(19, \u0022GET \/details\/0 HTTP\/1.1\\r\\nHost: d\u0022..., 118) = 118…\n\u0060\u0060\u0060\n\n*输出 3: Ambient 模式 —— 附加 strace 到 Fortio 的 PID。*\n\n为什么会这样？这是有道理的，因为 write 调用完全基于应用行为，而这在这种情况下没有变化。Ambient 将这些多个应用写入合并为单个网络写入，并隐含地在对等端进行单个读取。\n\n在上述测试场景中，我观察到 Fortio 服务在启用 ambient 时系统调用总数减少了 60%。这非常**重要**，并解释了在 peak 时 Fortio pod 的延迟和 CPU 使用量减少约 25% 的大部分原因。系统调用的减少超过了 mTLS 和 ztunnel 的其他功能的成本。我预计这种模式在企业中会相当常见，因为一些 HTTP 库和应用在缓冲和刷新方面做得更好，而一些则不太好。这通常与应用的年龄和它们构建时使用的 SDK 相关。\n\n![无网格和 ambient 运行：details 服务 100 QPS 10 连接。](f9.webp)\n\n## 整个 Bookinfo 应用怎么样？\n\n在更新了 details 和 productpage 部署之后，我开始通过 100 个连接发送 1000 RPS 到 Bookinfo 应用，并观察到无网格和 ambient 的优异结果。\n\n![无网格：新 Bookinfo 应用 1000 RPS 100 连接。](f10.webp)\n\n![无网格：新 Bookinfo 应用 1000 RPS 100 连接。](f11.webp)\n\n| **Fortio 对 Bookinfo** | **平均** | **P50** | **P75** | **P90** | **P99** | **平均差异**               |\n| ---------------------- | -------- | ------- | ------- | ------- | ------- | -------------------------- |\n| **无网格**             | 1.39ms   | 1.32ms  | 1.42ms  | 1.67ms  | 2.19ms  |                            |\n| **Ambient**            | 1.40ms   | 1.34ms  | 1.48ms  | 1.68ms  | 2.94ms  | **平均和 P90 均慢不到 1%** |\n\n*表 4: Fortio 对新 Bookinfo 应用 1000 RPS 100 连接。*\n\n作为对比，我还针对 v1.22.3 版本中附带的旧 Bookinfo 示例进行了同样的测试，你可以看到新 Bookinfo 在响应时间上取得了 **5-10 倍** 的提升，无论是无网格还是 ambient！\n\n| **Fortio 对 Bookinfo** | **平均** | **P50** | **P75** | **P90** | **P99** | **平均差异** |\n| ---------------------- | -------- | ------- | ------- | ------- | ------- | ------------ |\n| **无网格**             | 6.35ms   | 4.68ms  | 7.44ms  | 11.4ms  | 36.63ms |              |\n| **Ambient**            | 6.74ms   | 4.9ms   | 7.79ms  | 12.12ms | 41.14ms | **慢 6%**    |\n\n*表 5: Fortio 对旧 Bookinfo 应用 1000 RPS 100 连接。*\n\n将负载增加到 4000 RPS 和 400 连接，并使用新 Bookinfo 部署：\n\n![Ambient：新 Bookinfo 应用 4000 RPS 400 连接。](f12.webp)\n\n![Ambient：新 Bookinfo 应用 4000 RPS 400 连接。](f13.webp)\n\n响应时间依然很好，远远优于只有 1000 RPS 和 100 连接的旧 Bookinfo 应用（表 5）：\n\n| **Fortio 对 Bookinfo** | **平均** | **P50** | **P75** | **P90** | **P99** | **平均差异**             |\n| ---------------------- | -------- | ------- | ------- | ------- | ------- | ------------------------ |\n| **无网格**             | 1.54ms   | 1.33ms  | 1.54ms  | 2.25ms  | 3.98ms  |                          |\n| **Ambient**            | 1.58ms   | 1.37ms  | 1.57ms  | 2.33ms  | 4.9ms   | **平均慢 3%，P90 慢 4%** |\n\n*表 6: Fortio 对新 Bookinfo 应用 4000 RPS 400 连接。*\n\n很高兴看到 Bookinfo 能够在 4000 RPS 下无错误地运行，而且 ambient 模式比无网格慢 3-4%，但带来了传输中加密的 mTLS 和 L4 观测的所有好处。我记得我之前只能在旧 Bookinfo 应用中达到最高 1200 RPS，这已经导致了少量的错误。现在我可以增加到 4000 或更高 RPS 而不出现错误。\n\n## 总结\n\n在 L4 上，Ambient 模式只引入了非常微小的影响——偶尔甚至可以自动**改善**！— 用户应用的延迟。结合简单的用户体验，通过标记命名空间以将您的应用注册到 ambient 而无需重启任何工作负载，它为用户提供了我们初衷中预期的愉快体验。\n\n我想感谢所有 Istio 维护者，他们构建了这样一个令人愉快的项目，以及为 Istio 项目提供测试基础设施的 [CNCF](https:\/\/www.cncf.io\/community-infrastructure-lab\/)。我还要感谢 Quentin Joly 和许多提供了“ambient 有时比无网格稍快”的反馈的用户，这促使我进行了上述基准测试，亲身体验了在负载下的改善或微小的延迟影响。\n', '\/trans\/ambient-mesh-can-sidecar-less-istio-make-applications-faster\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">探索如何使用 Fortio 与 Istio 集成，在使用 Bookinfo 应用和流行的 DevOps 工具如 Kubernetes、Prometheus 和 Grafana 的微服务架构中进行高效的性能测试和监控。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/kubecon-china-2024-recap/">KubeCon China 2024 回顾：引领云原生技术的前沿动态</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/08/27</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f"> 
             云原生
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('KubeCon China 2024 回顾：引领云原生技术的前沿动态', '深入剖析 KubeCon China 2024 中的云原生技术进展，聚焦 Istio 的 Ambient 模式和 API 网关的融合及其对行业的深远影响。', '\n今年的[KubeCon China](https:\/\/events.linuxfoundation.org\/kubecon-cloudnativecon-open-source-summit-ai-dev-china\/)是首次在香港举办的盛会，持续了三天。作为会议的参与者及一个论坛的主持人，我在这篇文章中将分享会议的精彩内容和对服务网格及网关技术的深入讨论。\n\n![KubeCon China 现场画面](https:\/\/jimmysong.io\/img\/blog\/kubecon-china-2024-recap\/kubecon-china-2024-hall.webp)\n\n## 主题焦点\n\n本次 KubeCon 新增了 AI 与开发者主题，以下是部分重点内容：\n\n1. **云原生技术在行业中的实际应用**：特别是电动汽车和网络安全领域，如 Huawei 和 NIO 的共同探讨云原生技术如何加速电动汽车创新。\n\n2. **Kubernetes 社区的力量**：详细讨论了中国 Kubernetes 社区的影响力及其在推动区域云原生活动中的角色。\n\n3. **开源技术与人工智能的融合**：探讨了中国及香港在开源与 AI 技术领域的先进地位及对区域技术创新的推动。\n\n4. **服务网格与 API 网关的最新进展**：包括服务网格的最新技术更新及其与 Kubernetes 调度器的协同工作提高系统吞吐量的策略。\n\n5. **供应链安全的新策略**：关注保障供应链安全的最新动态，特别是 SLSA 合规性的实践指南。\n\n6. **多集群管理与边缘计算**：探讨了在不同架构下进行有效管理与创新的策略。\n\n7. **AI 大模型的推理性能优化**：讨论了无服务器架构下的 AI 大模型推理性能优化及相关技术进展。\n\n## Istio 与现代 API 网关：探索服务网格的未来\n\n我与来自 Tetrate、阿里云和 Kong Inc.的行业领袖共同参与的[圆桌讨论](https:\/\/kccncossaidevchn2024.sched.com\/event\/1eYY6\/istio-and-modern-api-gateways-navigating-the-future-of-service-meshes-istiorejiong-apijie-daepqiu-jie-zha-jimmy-song-jianpeng-he-tetrate-jiaqi-zhang-alibaba-cloud-jintao-zhang-kong-inc-xunzhuo-liu-tencent)，深入探讨了 Istio 和 API 网关的最新进展及其融合带来的革新。\n\n![KubeCon China 2024 Istio 和现代 API 网关的圆桌论坛](https:\/\/jimmysong.io\/img\/blog\/kubecon-china-2024-recap\/kubecon-china-2024-panel.webp)\n\n1. **Istio 的革新**：介绍了 Istio 1.123 版本中的 Ambient 模式优化，此模式作为新的架构选择，减少资源消耗同时提升性能。\n\n2. **Ambient 模式与 Sidecar 模式的实用对比**：\n   - **何时选择 Sidecar**：需要高度隔离与详尽流量管理时。\n   - **何时选择 Ambient**：追求极致性能与资源效率时。\n\n3. **Ambient 模式的发展挑战**：尽管有诸多优势，Ambient 模式在复杂流量管理与多租户环境中仍面临挑战。\n\n4. **服务网格优化策略**：讨论了服务网格的优化方法，如何提升云应用的性能与效率。\n\n5. **服务网格与 API 网关的整合**：展示了这两大技术如何共同作用，支持更复杂的部署与运维模式。\n\n## Istio 的未来展望\n\n在[徐中虎和何建鹏的分享](https:\/\/kccncossaidevchn2024.sched.com\/event\/1eYcG\/what-is-the-future-of-service-mesh-sidecar-or-sidecarless-jie-zha-dyagsyi-wu-pi-yi-wu-zhonghu-xu-huawei)中，我们了解到了 Istio 未来的可能发展方向：\n\n- **双模驱动**：Istio 将同时支持 Ambient 模式和传统的 Sidecar 模式。Ambient 模式适合追求性能和资源成本优化的用户，而 Sidecar 模式将为需要更全面功能的用户长期支持。\n\n- **Gateway API 的支持**：Istio 对 Gateway API 的支持，为用户提供了更灵活的路由与策略配置选项。\n\n- **Waypoints 的策略应用**：Waypoints 不必局限于 Istio 或 Envoy。通过使用 Gateway API 和 GAMMA，任何符合标准的实现都可以作为 Waypoint，这为服务网格提供了更大的灵活性和扩展性。\n\n### Sandwich Waypoint\n\n他们着重介绍了 Sandwich Waypoint，这是一种在 Istio 内管理和引导流量的复杂方法，特别是在环境模式下。这种 Waypoint 代理模式旨在通过充当处理、转换和转发客户端和服务器之间流量的中介层来简化和提高流量路由的效率。它利用了双 zTunnel 设置，其中位于通信通道两端的每个 zTunnel 协作封装和解码流量。Waypoint 本身负责执行额外的功能，如流量整形、安全检查和协议转换，从而在没有传统边车开销的情况下丰富服务网格功能。这种方法允许 Istio 保持强大的流量管理和安全功能，同时优化资源利用率并减少延迟。\n\nSandwich Waypoint 支持：\n\n- **流量重定向**：可通过设置  \u0060istio.io\/use-waypoint: {namespace}\/{gateway-name}\u0060 注解，将目标服务、Pod 或命名空间内的流量重定向到同一个 Waypoint。\n- **Waypoint 部署**：用户可以通过创建一个 Gateway 对象来部署 Waypoint。与原始的 Waypoint 实现不同，新的部署方式将包括相关联的服务和服务账户，不仅仅是 Waypoint 实例。\n- **路由与政策配置**：使用 Gateway API 进行路由和政策配置，这为用户和供应商提供了更多的自定义选项。\n\n这是一种 Istio Ambient 模式中捕获七层流量模式，如下图所示。\n\n![Sandwich Waypoint 捕获流量](istio-ambient-traffic-capture.svg)\n\nIstio Sandwich Waypoint 捕获七层流量的步骤如下：\n\n1. 通过 zTunnel 终止 HBONE 连接，到达 Waypoint，zTunnel 负责解码 HBONE 协议。 \n2. Waypoint 提取目的地地址、源地址等信息用于处理流量及确定转发位置。 \n3. Waypoint 扩展或解析传输层封装（TLV）数据，代理支持处理 TLV 以提供更多上下文。\n4. Waypoint 与同位 zTunnel 通信，与服务端 zTunnel 协调确保流量正确转移。\n5. 封装 HBONE，由服务端 zTunnel 发送到最终服务器目的地。实现 Istio 环境中服务的细粒度流量管理和路由并保持与现有网络协议兼容性。\n\n## Envoy Gateway 的前沿扩展\n\n赵化冰在 KubeCon 上介绍了 Envoy Gateway 如何通过扩展 Kubernetes Gateway API 来增强功能与灵活性的[演讲](https:\/\/kccncossaidevchn2024.sched.com\/event\/1eYcX\/gateway-api-and-beyond-introducing-envoy-gateways-gateway-api-extensions-jie-api-daeptao-envoyjie-zha-jie-api-huabing-zhao-tetrate)，涵盖了多种匹配与路由能力的扩展、新的资源和策略模型以及安全策略的细节。\n\n- **网关 API 兼容性**：Envoy 网关完全兼容网关 API，并提供了广泛的匹配和路由选项。这些包括 HTTP 主机和路径匹配、基于 HTTP 头的操作、权重负载均衡，以及对 gRPC、UDP 和 TCP 路由的支持。\n- **高级流量管理策略**：引入的 \u0060ClientTrafficPolicy\u0060 和 \u0060BackendTrafficPolicy\u0060 为用户提供了更细粒度的流量管理控制，适用于上游和下游连接，包括如限速、重试、负载均衡、断路器等功能。\n- **安全与认证增强**：新引入的 \u0060SecurityPolicy\u0060 支持 CORS、HTTP 基础认证、OIDC、JWT 认证，并能与各种身份提供商集成。它还提供了详细的访问控制，允许根据请求者的原始 IP、JWT 声明等进行授权。\n- **自定义扩展功能**：Envoy 网关支持通过 WASM（WebAssembly）和外部进程扩展来支持自定义扩展。这允许用户通过集成他们自己为特定用例和操作需求量身定制的扩展来增强网关的功能。\n- **未来探索**：未来版本预计将支持非 Kubernetes 环境部署，优化控制平面的内存使用，并扩展授权能力。\n\n## 总结\n\n通过本次会议我们了解了 Istio 的 Ambient 模式和 Envoy Gateway 的进展。这些技术的讨论不仅展望了未来趋势，也提供了实用的洞察，助力技术实施与创新。\n', '\/blog\/kubecon-china-2024-recap\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">深入剖析 KubeCon China 2024 中的云原生技术进展，聚焦 Istio 的 Ambient 模式和 API 网关的融合及其对行业的深远影响。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/integrating-dapr-with-cilium/">[译] 使用 Dapr 与 Cilium 打造无 Sidecar 服务网格</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/08/26</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://www.codecentric.de/wissens-hub/blog/integrating-dapr-with-cilium-a-sidecar-less-service-mesh-approach-combined-with-a-powerful-distributed-application-runtime" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('使用 Dapr 与 Cilium 打造无 Sidecar 服务网格：新一代分布式应用运行时', '本文探讨了将 Dapr 与 Cilium 集成的无 Sidecar 服务网格方法，强调了其高性能和安全性。', '\n几周前，我们介绍了 Dapr，并讨论了它与服务网格的重叠功能，尽管 Dapr 本身并不是一个服务网格。如之前的博客所述，近年来服务网格已成为现代云原生应用的关键组成部分，提供了诸如流量管理、安全性和可观测性等关键功能。传统的服务网格依赖于 sidecar 代理，这可能会引入复杂性和性能开销。而 Cilium 的无 sidecar 服务网格功能通过利用 eBPF 实现高效的内核级网络处理，结合 Dapr 这一强大的分布式应用运行时，这种集成承诺提供高性能、增强的安全性和简化的操作。\n\n## 无 Sidecar 服务网格的需求\n\n正如[这篇文章](https:\/\/www.codecentric.de\/wissens-hub\/blog\/sidecars-sidecarless-evolution-service-mesh-technologies-istio-cilium)所讨论的，Cilium 最初作为 Kubernetes 的一种 eBPF 驱动的容器网络接口（CNI）开始。随着时间的推移，Cilium 演变成了 Kubernetes 内部网络的多功能工具。2022 年 7 月，Cilium 服务网格的首个版本发布，引入了一种利用 eBPF 并在 Linux 内核中运行的无 sidecar 服务网格。\n\n![基于 Cilium 的服务网格](cilium-mesh.webp)\n\n这种服务网格旨在广泛利用 eBPF，专注于较低层次的网络（直到第 4 层）以提供其功能。然而，对于一个功能齐全的服务网格，较高层次的功能如服务调用依赖于第 7 层。通常，这些功能需要一个代理来实现重试和断路等功能。\n\n考虑到 Dapr 及其第 7 层功能，它传统上运行在基于 sidecar 的模型上。虽然这是准确的，但有一个与无 sidecar 架构相一致的替代方法。\n\n## 介绍 Dapr 共享\n\n[Dapr 共享](https:\/\/github.com\/dapr\/dapr-shared\/)提供了 Dapr 的另一种部署模型。虽然默认的方法仍然使用 sidecars，但 Dapr 共享允许用户轻松地将 Dapr 运行时（Daprd）部署为 Kubernetes 内的 DaemonSet（每个节点一个）或 Deployment（每个集群一个）。这种方法的显著优势在于，它在一定程度上将 Daprd 实例的生命周期与实际应用的生命周期解耦。你可能会问：这有什么好处？有几种情况下，这种方法是有利的：\n\n- 函数即服务（FaaS）集成：在 FaaS 中，实际函数的一个实例可能只在执行期间存在几秒钟。然而，你可能仍然希望使用 PubSub 进行异步消息传递。\n- 无 Sidecar 服务网格集成：当主要使用 Dapr 的构建模块时，类似于 FaaS 的示例，将 Daprd 的生命周期与其应用解耦是有益的。通过控制 Daprd 实例（\u0022代理\u0022）的数量，这种方法与无 sidecar 服务网格很好地集成。\n\n通过在这些情况下使用 Dapr 共享，我们仍然可以利用所有构建块和高级功能，如 mTLS 与服务调用结合使用。\n\n## 我们的示例案例和架构\n\n理论介绍完毕，现在是时候进行实践了。我们将设置一个简单而强大的架构，以演示 Dapr 和 Cilium 服务网格如何协同工作。\n\n![架构图](arch.webp)\n\n在这个设置中，我们将采用前沿技术。Cilium 将处理一般的网络层，并使用其 Gateway API 实现来管理流入我们演示集群的南北流量。对于东西流量，我们将利用 Cilium GAMMA 实现，通过 Dapr 共享运行时进行增强，以确保全面的集成。\n\n通过整合这些技术，我们将能够为我们的设置添加弹性和其他高级功能。这种架构将展示 Dapr 和 Cilium 之间的无缝协作，为 Kubernetes 环境提供强大而可扩展的网络解决方案。\n\n### 要求\n\n如果你想跟进，你将需要访问一个 Kubernetes 集群。这个集群应该安装了 Cilium 版本 1.16，配置如下：\n\n- 替换 Kube-proxy 或 NodePort 服务\n- 启用 GatewayAPI\n- 可访问的 Hubble 和 Hubble UI\n\n你可以按照[官方文档](https:\/\/docs.cilium.io\/en\/stable\/gettingstarted\/k8s-install-default\/)安装 Cilium。\n\n### 设置 Gateway API 和网关\n\n如前所述，我们将使用 GatewayAPI 来路由流量进入我们的集群。这可以通过定义一个 Gateway 资源轻松实现，如下所示：\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1\nkind: Gateway\nmetadata:\n  name: default-gateway\n  namespace: default\nspec:\n  gatewayClassName: cilium\n  listeners:\n  - allowedRoutes:\n      namespaces:\n        from: All\n    name: default-http\n    port: 80\n    protocol: HTTP\n\u0060\u0060\u0060\n\n有了这个资源并正确安装 Cilium，你可以运行以下命令来验证 Gateway 是否已成功编程并具有外部 IP：\n\n\u0060\u0060\u0060bash\nkubectl get gateway default-gateway\n\u0060\u0060\u0060\n\n这应该输出类似于：\n\n\u0060\u0060\u0060\nNAME              CLASS    ADDRESS          PROGRAMMED   AGE\ndefault-gateway   cilium   18.192.114.200   True         27h\n\u0060\u0060\u0060\n\n现在我们已经设置好了 Gateway，我们可以继续运行一个虚拟应用。\n\n### 虚拟应用和简单路由\n\n为了测试我们的设置，我们将部署由 Traefik Labs 创建的 whoami 镜像。这个应用显示 HTTP 请求头和其他相关信息，这对于验证我们的配置非常有用。让我们开始部署并使虚拟应用可访问。\n\n为 whoami 应用创建一个服务、部署和 HTTPRoute：\n\n\u0060\u0060\u0060yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: whoami\n  labels:\n    app: whoami\nspec:\n  ports:\n    - name: http\n      targetPort: 80\n      port: 80\n  selector:\n    app: whoami\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: whoami-v1\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: whoami\n      version: v1\n  template:\n    metadata:\n      labels:\n        app: whoami\n        version: v1\n    spec:\n      serviceAccountName: whoami\n      containers:\n        - image: traefik\/whoami\n          imagePullPolicy: IfNotPresent\n          name: whoami\n          ports:\n            - containerPort: 80\n          env:\n            - name: WHOAMI_NAME\n              value: \u0022v1\u0022\n---\napiVersion: gateway.networking.k8s.io\/v1\nkind: HTTPRoute\nmetadata:\n  name: whoami-route-service\nspec:\n  parentRefs:\n  - group: \u0022\u0022\n    kind: Service\n    name: whoami\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: \/\n    backendRefs:\n    - name: whoami\n      port: 80\n\u0060\u0060\u0060\n\n部署这些资源后，你可以使用一个简单的 curl 命令来验证设置：\n\n\u0060\u0060\u0060\ncurl -v http:\/\/18.192.114.200\n\u0060\u0060\u0060\n\n预期输出应类似于：\n\n\u0060\u0060\u0060\n*   Trying 18.192.114.200:80...\n* Connected to 18.192.114.200 (18.192.114.200) port 80\n\u003e GET \/ HTTP\/1.1\n\u003e Host: 18.192.114.200\n\u003e User-Agent: curl\/8.4.0\n\u003e Accept: *\/*\n\u003e\n\u003c HTTP\/1.1 200 OK\n\u003c date: Tue, 30 Jul 2024 14:16:41 GMT\n\u003c content-length: 350\n\u003c content-type: text\/plain; charset=utf-8\n\u003c x-envoy-upstream-service-time: 6\n\u003c server: envoy\n\u003c\nName: v1\nHostname: whoami-v1-cd9b4bdf7-ht6dc\nIP: 127.0.0.1\nIP: ::1\nIP: 10.42.0.101\nIP: fe80::e0d3:4fff:fe30:95ef\nRemoteAddr: 10.42.1.170:35911\nGET \/ HTTP\/1.1\nHost: 18.192.114.200\nUser-Agent: curl\/8.4.0\nAccept: *\/*\nX-Envoy-Internal: true\nX-Forwarded-For: 10.42.1.82\nX-Forwarded-Proto: http\nX-Request-Id: bc928d69-06e2-427b-89f1-fab7c8bfb7e9\n\n* Connection #0 to host 18.192.114.200 left intact\n\u0060\u0060\u0060\n\n这确认了 whoami 应用是可访问的，且 GatewayAPI 正确路由流量进入我们的集群。\n\n### 安装 Dapr 运行时\n\n接下来，我们需要在我们的 Kubernetes 集群中安装 Dapr 运行时。这可以通过使用现有的 Helm chart 快速完成。执行以下命令安装 Dapr：\n\n\u0060\u0060\u0060bash\nhelm upgrade --install dapr dapr\/dapr \\\n--version=1.13 \\\n--namespace dapr-system \\\n--create-namespace \\\n--wait\n\u0060\u0060\u0060\n\n成功安装的输出看起来像这样：\n\n\u0060\u0060\u0060\nRelease \u0022dapr\u0022 has been upgraded. Happy Helming!\nNAME: dapr\nLAST DEPLOYED: Tue Jul 30 16:09:45 2024\nNAMESPACE: dapr-system\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nThank you for installing Dapr: High-performance, lightweight serverless runtime for cloud and edge\n\nYour release is named dapr.\n\nTo get started with Dapr, we recommend using our quickstarts:\nhttps:\/\/github.com\/dapr\/quickstarts\n\nFor more information on running Dapr, visit:\nhttps:\/\/dapr.io\n\u0060\u0060\u0060\n\n要验证所有 Dapr 组件是否正确运行，检查 dapr-system 命名空间中的 pods：\n\n\u0060\u0060\u0060bash\nkubectl get pods -n dapr-system\n\u0060\u0060\u0060\n\n典型的输出应显示所有 Dapr 组件处于运行状态：\n\n\u0060\u0060\u0060\nNAME                                    READY   STATUS    RESTARTS   AGE\ndapr-operator-c449df54-px8q2            1\/1     Running   0          25h\ndapr-placement-server-0                 1\/1     Running   0          25h\ndapr-sentry-774c876df5-h2nhh            1\/1     Running   0          25h\ndapr-sidecar-injector-78769c6d9-zh2jw   1\/1     Running   0          25h\n\u0060\u0060\u0060\n\nDapr 成功安装并且所有组件健康后，我们可以继续安装我们的共享实例。\n\n### 部署 Dapr 共享实例\n\n现在，让我们设置我们的 Dapr 共享实例。我们需要部署两个实例：一个用于入口（Cilium Gateway）和一个用于虚拟的 whoami 应用。入口实例将作为 DaemonSet 部署，而 whoami 实例将作为 Deployment 部署。\n\n\u0060\u0060\u0060bash\nhelm upgrade --install ingress-shared oci:\/\/registry-1.docker.io\/daprio\/dapr-shared-chart --set shared.appId=ingress --set shared.strategy=daemonset --set shared.remoteURL=cilium-gateway-default-gateway.default.svc.cluster.local --set shared.remotePort=80 --set shared.daprd.mtls.enabled=true --namespace default\n\nhelm upgrade --install whoami-shared  oci:\/\/registry-1.docker.io\/daprio\/dapr-shared-chart --set shared.appId=whoami --set shared.strategy=deployment --set shared.remoteURL=whoami.default.svc.cluster.local --set shared.remotePort=80 --set shared.daprd.mtls.enabled=true --namespace default\n\u0060\u0060\u0060\n\n执行这些命令后，你可以使用以下命令验证 Dapr 共享实例是否正在正确运行：\n\n\u0060\u0060\u0060bash\nkubectl get pods\n\u0060\u0060\u0060\n\n你应该看到类似于这样的输出：\n\n\u0060\u0060\u0060\nNAME                                               READY   STATUS    RESTARTS   AGE\ningress-shared-dapr-shared-chart-bfnxc             1\/1     Running   0          29s\ningress-shared-dapr-shared-chart-lg62n             1\/1     Running   0          21s\nwhoami-shared-dapr-shared-chart-69fd8658db-kmzph   1\/1     Running   0          26s\n\u0060\u0060\u0060\n\n有了这些共享实例的运行，我们已经成功建立了一个强大的设置来处理应用流量和服务调用。\n\n### Daprise 操作\n\n现在来到了有趣的部分：\u0022Dapr 化\u0022我们的设置！我们将 Dapr 与 Cilium Gateway 和 whoami 应用整合，充分利用 Dapr 的功能。为了确保所有请求都通过专门的网关的 Dapr 共享实例流动，我们将配置 HTTPRoute 以针对这个 Dapr 实例。Dapr 期望特定的 URL 格式用于服务调用，因此我们将使用 Gateway API 中的 URLRewrite 过滤器来调整请求路径。\n\n使用以下配置更新之前的 HTTPRoute 资源：\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1\nkind: HTTPRoute\nmetadata:\n  name: whoami-route\nspec:\n  parentRefs:\n  - name: default-gateway\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: \/\n    filters:\n    - type: URLRewrite\n      urlRewrite:\n        path: \n          type: ReplacePrefixMatch\n          replacePrefixMatch: \/v1.0\/invoke\/whoami.default\/method\/\/\n    backendRefs:\n    - name: ingress-dapr\n      port: 3500\n\u0060\u0060\u0060\n\n我们是如何\u0022Dapr 化\u0022它的？\n\n- filters: URLRewrite 过滤器重写 URL 以匹配 Dapr 的服务调用格式。（是的，\/\/是正确的）\n- backendRefs: 指向处理网关请求的 ingress-dapr 实例。\n\n为了验证一切是否正常工作，对网关的外部 IP 执行 curl 请求：\n\n\u0060\u0060\u0060bash\ncurl -v http:\/\/18.192.114.200\n\u0060\u0060\u0060\n\n你应该看到类似于这样的输出：\n\n\u0060\u0060\u0060\n*   Trying 18.192.114.200:80...\n* Connected to 18.192.114.200 (18.192.114.200) port 80\n\u003e GET \/ HTTP\/1.1\n\u003e Host: 18.192.114.200\n\u003e User-Agent: curl\/8.4.0\n\u003e Accept: *\/*\n\u003e\n\u003c HTTP\/1.1 200 OK\n\u003c content-length: 719\n\u003c content-type: text\/plain; charset=utf-8\n\u003c date: Tue, 30 Jul 2024 14:38:18 GMT\n\u003c traceparent: 00-00000000000000000000000000000000-0000000000000000-00\n\u003c x-envoy-upstream-service-time: 18\n\u003c server: envoy\n\u003c\nName: v1\nHostname: whoami-v1-cd9b4bdf7-4tmvr\nIP: 127.0.0.1\nIP: ::1\nIP: 10.42.1.30\nIP: fe80::7f:66ff:fe14:15ad\nRemoteAddr: 10.42.0.60:55178\nGET \/ HTTP\/1.1\nHost: whoami.default.svc.cluster.local:80\nUser-Agent: curl\/8.4.0\nAccept: *\/*\nAccept-Encoding: gzip\nDapr-Callee-App-Id: whoami\nDapr-Caller-App-Id: ingress\nForwarded: for=10.42.0.131;by=10.42\n\n.0.131;host=ingress-shared-dapr-shared-chart-bfnxc\nTraceparent: 00-00000000000000000000000000000000-0000000000000000-00\nX-Envoy-Internal: true\nX-Envoy-Original-Path: \/\nX-Forwarded-For: 10.42.1.110\nX-Forwarded-For: 10.42.0.131\nX-Forwarded-Host: ingress-shared-dapr-shared-chart-bfnxc\nX-Forwarded-Proto: http\nX-Request-Id: 5556df41-f78f-4c98-9526-f5025a787a1e\n\n* Connection #0 to host 18.192.114.200 left intact\n\u0060\u0060\u0060\n\n从头文件中，你可以看到\u0060Dapr-Callee-App-Id\u0060和\u0060Dapr-Caller-App-Id\u0060，表明流量正确通过 Dapr 实例路由。这个设置确保连接默认通过 mTLS（传输）加密，为我们的通信增加了额外的安全层。我们已经成功地将 Dapr 与 Cilium 的服务网格整合在一起，利用其先进的功能增强了应用的网络和服务调用。\n\n### 实现流量转移使用 Gamma\n\nDapr 不提供的一个功能，但 Cilium 提供的是流量转移。幸运的是，通过我们的集成，我们可以利用 Cilium 的 GAMMA（服务网格的 Gateway API）来启用这个功能。GAMMA 扩展了 Gateway API 以支持集群内的东西向流量管理，补充其用于南北向流量的用途。要设置流量转移，我们需要创建一个 HTTPRoute 配置，以便在应用的不同版本之间进行负载平衡。通过利用 GAMMA，你可以在不同版本的应用之间转移流量，使得部署新功能或进行金丝雀发布更容易，最小化中断。首先，我们将部署 whoami 应用的新版本并为其创建额外的服务。以下是部署 whoami 版本 2 并设置必要服务的 YAML 配置：\n\n\u0060\u0060\u0060yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: whoami-v1\n  labels:\n    app: whoami\n    version: v1\nspec:\n  ports:\n    - name: http\n      targetPort: 80\n      port: 80\n  selector:\n    app: whoami\n    version: v1\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: whoami-v2\n  labels:\n    app: whoami\n    version: v2\nspec:\n  ports:\n    - name: http\n      targetPort: 80\n      port: 80\n  selector:\n    app: whoami\n    version: v2\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: whoami-v2\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: whoami\n      version: v2\n  template:\n    metadata:\n      labels:\n        app: whoami\n        version: v2\n    spec:\n      serviceAccountName: whoami\n      containers:\n        - image: traefik\/whoami\n          imagePullPolicy: IfNotPresent\n          name: whoami\n          ports:\n            - containerPort: 80\n          env:\n            - name: WHOAMI_NAME\n              value: \u0022v2\u0022\n\u0060\u0060\u0060\n\n接下来，我们配置一个 HTTPRoute 来启用在 whoami-v1 和 whoami-v2 之间的流量转移。HTTPRoute 将根据定义的权重将一定比例的流量路由到每个应用版本。\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1\nkind: HTTPRoute\nmetadata:\n  name: whoami-route-service\nspec:\n  parentRefs:\n  - group: \u0022\u0022\n    kind: Service\n    name: whoami\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: \/\n    backendRefs:\n    - name: whoami-v1\n      port: 80\n      weight: 50\n    - name: whoami-v2\n      port: 80\n      weight: 50\n\u0060\u0060\u0060\n\n这里重要的部分是\u0060parentRefs\u0060。虽然在传统的 Gateway API 中，我们使用这个来绑定该 \u0060HTTPRoute\u0060 到一个网关，我们在这里将其绑定到\u0060whoami\u0060服务，启用 GAMMA 案例。\n\n此外，通过在\u0060backendRef\u0060中定义\u0060weight\u0060，我们可以调整我们希望如何转移流量。为了确保流量转移工作正确，你可以进行多次 curl 请求并检查响应，以验证流量是否按照指定在 whoami-v1 和 whoami-v2 之间分配。\n\n\u0060\u0060\u0060\ncurl http:\/\/18.192.114.200\nName: v1\nHostname: whoami-v1-cd9b4bdf7-4tmvr\nIP: 127.0.0.1\nIP: ::1\nIP: 10.42.1.30\nIP: fe80::7f:66ff:fe14:15ad\nRemoteAddr: 10.42.0.60:55178\nGET \/ HTTP\/1.1\nHost: whoami.default.svc.cluster.local:80\nUser-Agent: curl\/8.4.0\nAccept: *\/*\nAccept-Encoding: gzip\nDapr-Callee-App-Id: whoami\nDapr-Caller-App-Id: ingress\nForwarded: for=10.42.0.131;by=10.42.0.131;host=ingress-shared-dapr-shared-chart-bfnxc\nTraceparent: 00-00000000000000000000000000000000-0000000000000000-00\nX-Envoy-Internal: true\nX-Envoy-Original-Path: \/\nX-Forwarded-For: 10.42.1.110\nX-Forwarded-For: 10.42.0.131\nX-Forwarded-Host: ingress-shared-dapr-shared-chart-bfnxc\nX-Forwarded-Proto: http\nX-Request-Id: e9d8ab85-8ae7-46a9-8b44-42240d1d6833\n---\ncurl http:\/\/18.192.114.200\nName: v2\nHostname: whoami-v2-766bb5fbd5-bfx9j\nIP: 127.0.0.1\nIP: ::1\nIP: 10.42.1.181\nIP: fe80::d441:87ff:fea1:d123\nRemoteAddr: 10.42.1.27:32774\nGET \/ HTTP\/1.1\nHost: whoami.default.svc.cluster.local:80\nUser-Agent: curl\/8.4.0\nAccept: *\/*\nAccept-Encoding: gzip\nDapr-Callee-App-Id: whoami\nDapr-Caller-App-Id: ingress\nForwarded: for=10.42.0.131;by=10.42.0.131;host=ingress-shared-dapr-shared-chart-bfnxc\nTraceparent: 00-00000000000000000000000000000000-0000000000000000-00\nX-Envoy-Internal: true\nX-Envoy-Original-Path: \/\nX-Forwarded-For: 10.42.1.64\nX-Forwarded-For: 10.42.0.131\nX-Forwarded-Host: ingress-shared-dapr-shared-chart-bfnxc\nX-Forwarded-Proto: http\nX-Request-Id: f1df7207-098c-4a98-8a97-858ce1f9c0ed\n\u0060\u0060\u0060\n\n你应该会看到基于配置的流量权重，从两个应用版本收到响应。此外，我们可以查阅\u0060hubble flow\u0060日志来检查实际连接情况：\n\n\u0060\u0060\u0060\nJul 29 15:18:13.883: kube-system\/svclb-cilium-gateway-default-gateway-f455e04d-jljl8:54047 (ingress) -\u003e default\/ingress-shared-dapr-shared-chart-g2596:3500 (ID:33809) http-request FORWARDED (HTTP\/1.1 GET http:\/\/whoami.cloud-native.rocks\/v1.0\/invoke\/whoami.default\/method\/something)\nJul 29 15:18:13.884: 10.42.1.170:39105 (ingress) \u003c\u003e default\/ingress-shared-dapr-shared-chart-g2596:3500 (ID:33809) to-overlay FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:13.884: 10.42.1.170:39105 (ingress)\n\n -\u003e default\/ingress-shared-dapr-shared-chart-g2596:3500 (ID:33809) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:13.890: default\/ingress-shared-dapr-shared-chart-g2596:55194 (ID:33809) -\u003e default\/whoami-shared-dapr-shared-chart-crmxz:50002 (ID:14274) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:13.890: default\/ingress-shared-dapr-shared-chart-g2596:55194 (ID:33809) \u003c- default\/whoami-shared-dapr-shared-chart-crmxz:50002 (ID:14274) to-endpoint FORWARDED (TCP Flags: ACK)\nJul 29 15:18:13.891: default\/whoami-shared-dapr-shared-chart-crmxz:46028 (ID:14274) -\u003e default\/whoami-v1-cd9b4bdf7-gxkvt:80 (ID:26920) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:13.891: default\/whoami-shared-dapr-shared-chart-crmxz:46028 (ID:14274) \u003c- default\/whoami-v1-cd9b4bdf7-gxkvt:80 (ID:26920) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:13.893: 10.42.1.170:39105 (ingress) \u003c\u003e default\/ingress-shared-dapr-shared-chart-g2596:3500 (ID:33809) to-overlay FORWARDED (TCP Flags: ACK)\nJul 29 15:18:13.895: kube-system\/svclb-cilium-gateway-default-gateway-f455e04d-jljl8:54047 (ingress) \u003c- default\/ingress-shared-dapr-shared-chart-g2596:3500 (ID:33809) http-response FORWARDED (HTTP\/1.1 200 15ms (GET http:\/\/whoami.cloud-native.rocks\/v1.0\/invoke\/whoami.default\/method\/something))\nJul 29 15:18:14.405: kube-system\/svclb-cilium-gateway-default-gateway-f455e04d-jljl8:54048 (ingress) -\u003e default\/ingress-shared-dapr-shared-chart-zxv74:3500 (ID:33809) http-request FORWARDED (HTTP\/1.1 GET http:\/\/whoami.cloud-native.rocks\/v1.0\/invoke\/whoami.default\/method\/something)\nJul 29 15:18:14.406: 10.42.1.170:38391 (ingress) -\u003e default\/ingress-shared-dapr-shared-chart-zxv74:3500 (ID:33809) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:14.414: default\/ingress-shared-dapr-shared-chart-zxv74:55876 (ID:33809) -\u003e default\/whoami-shared-dapr-shared-chart-g572c:50002 (ID:14274) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:14.414: default\/whoami-shared-dapr-shared-chart-g572c:58854 (ID:14274) -\u003e default\/whoami-v2-766bb5fbd5-jvtcd:80 (ID:2184) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:14.414: default\/ingress-shared-dapr-shared-chart-zxv74:55876 (ID:33809) \u003c- default\/whoami-shared-dapr-shared-chart-g572c:50002 (ID:14274) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\nJul 29 15:18:14.415: default\/whoami-shared-dapr-shared-chart-g572c:58854 (ID:14274) \u003c- default\/whoami-v2-766bb5fbd5-jvtcd:80 (ID:2184) to-endpoint FORWARDED (TCP Flags: ACK, PSH)\n\u0060\u0060\u0060\n\n这个日志显示，流量被重定向到\u0060whoami-v1\u0060以及\u0060whoami-v2\u0060。在 hubble UI 中，这也是可见的。\n\n![流量拓扑图](topo.webp)\n\n## 使用网络策略进行访问控制\n\n有了 Cilium 处理到 Dapr 的流量，我们可以利用 Cilium 的网络策略来配置访问控制。与 Dapr 的访问控制在第 7 层（应用层）操作不同，Cilium 的方法在更低的网络堆栈层次上工作，提供更细粒度的控制。\n\n下面是如何使用 Cilium 的 CiliumNetworkPolicy 配置访问控制：\n\n\u0060\u0060\u0060yaml\napiVersion: cilium.io\/v2\nkind: CiliumNetworkPolicy\nmetadata:\n  name: \u0022allow-ingress-shared-to-whoami\u0022\nspec:\n  endpointSelector:\n    matchLabels:\n      dapr.io\/app-id: whoami\n  ingress:\n  - fromEndpoints:\n    - matchLabels:\n         dapr.io\/app-id: ingress\n    toPorts:\n    - ports:\n      - port: \u002250002\u0022\n        protocol: TCP\n---\napiVersion: \u0022cilium.io\/v2\u0022\nkind: CiliumNetworkPolicy\nmetadata:\n  name: \u0022allow-ingress-to-ingress-shared\u0022\nspec:\n  endpointSelector:\n    matchLabels:\n      dapr.io\/app-id: ingress\n  ingress:\n  - fromEntities:\n    - ingress\n    toPorts:\n    - ports:\n      - port: \u00223500\u0022\n        protocol: TCP\n\u0060\u0060\u0060\n\n这两个策略将限制我们集群中的流量流向。它们确保只允许 cilium-gateway 连接到 ingress-dapr 实例。类似地，ingress-dapr 实例是唯一允许与 whoami-dapr 实例通信的实体。这个设置确保 Dapr 共享实例是彼此唯一的通信者，增强了安全性和控制。Cilium 在第 3 层和第 4 层应用网络策略，提供了在流量到达应用层之前的更细粒度控制。这通过在网络堆栈的早期阻止未经授权的访问来减少不必要的流量，并通过提升性能来增强性能。\n\n## 优势 1 - 本地重定向策略\n\nCilium 1.16 引入了一个名为 Local Redirect Policy 的 beta 功能。这个功能允许你将流量重定向到同一节点上的本地端点，而不是在整个集群中路由。这对于优化流量流和确保某些连接保持本地特别有用。\n\n\u0060\u0060\u0060yaml\napiVersion: \u0022cilium.io\/v2\u0022\nkind: CiliumLocalRedirectPolicy\nmetadata:\n  name: \u0022redirect-ingress\u0022\nspec:\n  redirectFrontend:\n    serviceMatcher:\n      serviceName: ingress-dapr\n      namespace: default\n  redirectBackend:\n    localEndpointSelector:\n      matchLabels:\n        dapr.io\/app-id: ingress\n    toPorts:\n      - port: \u00223500\u0022\n        protocol: TCP\n\u0060\u0060\u0060\n\n我们将使用这个策略确保从\u0060cilium-gateway\u0060到其 Dapr 共享实例的流量保持在节点上。这种方法将连接保持在同一节点上，确保在流量离开节点之前建立并维持 mTLS。请注意，由于这是一个 beta 功能，你需要在 Cilium 中启用它。有关启用此功能的指南，请参阅 Cilium 文档。\n\n## 优势 2 - mTLS 和强身份\n\n将 Cilium 整合到你的设置中的另一个优势是使用 Cilium 的 mTLS 功能，而不是 Dapr 的。Cilium 通过节点间的 Wireguard 或 IPSec 隧道提供 mTLS，与 Dapr 通过双向 gRPC 连接使用 mTLS 的方法相比，提供了明显的好处。\n\n- 内核级执行：Cilium 的 mTLS 可以直接在 Linux 内核中执行，利用 Wireguard 或 IPSec。这种方法通常比 Dapr 通过 gRPC 的用户空间实现的 mTLS 提供更好的性能。\n- 广泛的加密覆盖：Cilium 确保所有服务到服务的连接都\n- 加密，而不仅仅是那些通过 Dapr 进行的。这提供了一个更全面的安全模型。\n\n一旦在 Cilium 本身启用了 mTLS，你可以通过将其附加到\u0060CiliumNetworkPolicy\u0060来在 Cilium 中强制执行 mTLS：\n\n  \u0060\u0060\u0060yaml\n  authentication:\n      mode: \u0022required\u0022\n  \u0060\u0060\u0060\n\nCilium 将检查匹配的强身份以及 mTLS 验证。\n\n## 总结\n\n总之，Dapr 与 Cilium 的无 sidecar 服务网格的整合为微服务架构打开了新的可能性。通过利用 Dapr 共享，我们可以将 Dapr 运行时的生命周期与应用解耦，允许更灵活的部署。Dapr 的强大服务调用能力与 Cilium 的高效、基于 eBPF 的网络和服务网格功能的结合，使得微服务交互具有高性能、安全性和弹性。\n\n这次演示展示了这些技术如何协调一致，创造了一个简化服务管理的前沿基础设施，同时增强了可扩展性和可靠性。Dapr 和 Cilium 的整合代表了构建下一代分布式应用的重要一步。\n', '\/trans\/integrating-dapr-with-cilium\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文探讨了将 Dapr 与 Cilium 集成的无 Sidecar 服务网格方法，强调了其高性能和安全性。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/black-myth-wukong-game-life/">从黑神话悟空聊起：我心目中的 3A 大作</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/08/23</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e9%9a%8f%e7%ac%94"> 
             随笔
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('从黑神话悟空聊起：我心目中的 3A 大作', '在《黑神话：悟空》的璀璨光芒下，回顾我的游戏旅程，探讨何为我心目中的 3A 游戏巅峰之作。', '\n随着 8 月 20 日《黑神话：悟空》的正式发售，瞬间点燃了玩家们对 3A 游戏无尽的热情与讨论。在这篇随笔中，我将漫步于记忆的长廊，从孩提时代的掌中世界到今日的次世代主机，细数那些陪伴我的游戏时光，并深入探讨我心目中 3A 大作的独特魅力。\n\n## 我的游戏养成史\n\n在中国，游戏曾一度被视为教育的绊脚石，是家长眼中的洪水猛兽。然而，正是这些看似微不足道的游戏机，悄然开启了我探索未知世界的奇妙之旅。\n\n### 掌上游戏机\n\n在我十岁左右，我获得了一个第一台游戏机，一台类似 Gameboy 的掌上游戏机。\n\n![90 年代的掌上游戏机（图片来自网络，复古游戏机）](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/gameboy.webp)\n\n这是我最早接触的游戏机，还有我最早接触的游戏《俄罗斯方块》。\n\n### 游戏机厅\n\n也进过游戏机厅，小学时每年寒暑假前都要写保证书，名叫《暑\/寒假公约》，其中一定会有一条——“不去游戏机厅”。我只去过一两次，这些游戏机需要投币。\n\n![九十年代游戏机厅里的游戏机（图片来自网络）](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/game-machine.webp)\n\n这类游戏机上常玩的游戏是《街头霸王（Street Fighters）》。\n\n![FC 游戏：街头霸王](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/street-fighter.webp)\n\n### 小霸王学习机\n\n小霸王学习机，可以更换卡带，接上电视就能玩，那时候经常用它玩高桥名人的《冒险岛》。\n\n![小霸王学习机](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/xiaobawang.webp)\n\n虽然号称是学习机，但是我没有见过有谁用它来学习的。\n\n![FC 游戏：冒险岛](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/maoxiandao.webp)\n\n### 网吧\n\n世纪之交的时候，网吧开始兴起，2000 年的时候我才第一次接触电脑，暑期的时候还参加电脑培训，练习过五笔打字，那时候也没学会，光顾着玩游戏了，我记得那时候还使用的是 3.5 英寸软盘，操作系统还是 Windows 98，使用的是笨重的 CRT 显示器。\n\n![90 年代末 2000 年初的网吧（图片来自网络）](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/netbar.webp)\n\n2000 年左右，电脑上的游戏有《红色警戒》、《暴力摩托》、《三角洲部队》、《拳皇》，但是我最喜欢的还是《红色警戒 2》，从 2000 年一直到 2008 年。\n\n![红色警戒（红警 2）](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/red-alert.webp)\n\n最开始玩红警的时候年纪还小，是我自己一个人探索着玩，一开始做任务，甚至不知道怎样展开基地车，因为游戏是繁体字，很多我还看不懂。\n\n### 单机游戏：2000 - 2008\n\n除了红色警戒之外，我玩过的游戏还有《反恐精英》、《半条命》、《暗黑破坏神》、《仙剑奇侠传》、《魔兽争霸》，但这些游戏都不是我的菜，大多也玩不好，我还是钟情于红警，还有它的各种 mod。\n\n### 网络游戏：2005 - 2008\n\n在开始玩网络游戏之前，从来没有为玩游戏花过钱，因为中国的各种盗版游戏泛滥，网上到处都可以下载到。\n\n在此之后就是网游的时代了，什么《传奇》、《大话西游》，腾讯的各种游戏比如《泡泡堂》、《劲舞团》、《地下城与勇士》、《QQ 飞车》这些我都玩过。\n\n### 休闲游戏：2009 - 2013\n\n曾经有一段时间，大概 2008 到 2013 年，校友网、QQ 空间上诞生的网页游戏，比如《抢车位》、《开心农场》等火爆一时，很多人定闹钟偷菜，也诞生了一些做网页游戏的网站。\n\n还有一些流行的休闲游戏，比如《植物大战僵尸》也是我特别喜欢的一款游戏。跟它同时期的一些游戏也不错。\n\n### 手机游戏：2014 - 2023\n\n《开心消消乐》、《原神》、《辐射：避难所》。不过很多流行的手机游戏比如《绝地求生》、《穿越火线》我都没有玩过。\n\n### 主机游戏：2023 至今\n\n从 2009 年到 2023 年可以说我就没有再接触主机游戏和网游了，平时也很少玩游戏，直到 2023 年 12 月，我获得了我的第一台游戏主机 PS5，情况才发生了改变。\n\n在此之前我曾玩过朋友的任天堂主机，但是并不是很喜欢任天堂主机的游戏，画面质量，游戏类型都不是我喜爱的。\n\n但是从我接触的第一个 PS5 主机游戏《双人成行》开始，我对主机游戏甚至说对电子游戏的看法大大改观了。一起我对大部分游戏都提不起兴趣，感觉那些游戏就是打发打发时间，玩久了就很无聊，但是接下来的几款游戏让我体验到了什么是 3A 大作。\n\n## 3A 大作\n\n在拥有了 PS5 之后，玩什么游戏就是一个问题了。我订阅了二挡会员，所以起初我下载和玩了一些游戏库里的游戏。\n\n### 双人成行\n\n《双人成行》这是一个必须两个人配合才能完成的游戏，通过 PS5 的手柄来操控，终于让我体会到玩游戏的快感。这也是我第一次购买的实体游戏，我购买了游戏光盘。\n\n![双人成行](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/it-takes-two.webp)\n\n### 地平线：西之绝境\n\n《地平线：西之绝境》在 PlayStation 的二挡会员库里，所以我也下载和游玩了这款游戏。这款游戏以废土世界的旧金山为背景，里面有很多奇思妙想的未来机械生物。但是我对它的剧情和部落完全不感兴趣，只是享受其中打斗的乐趣，因为主角可以使用的武器和技能有很多。\n\n![地平线：西之绝境](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/horizontal.webp)\n\n### 对马岛之魂\n\n《对马岛之魂》，故事发生在古代日本的对马岛，虽然景色很美，但是打斗风格及剧情让我提不起兴趣，一个日本人反抗蒙古侵略者的故事，我只玩了几个小时就卸载了游戏。\n\n![对马岛之魂](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/ghost-of-tsushima.webp)\n\n### 蜘蛛侠：Miles Morales\n\n《蜘蛛侠：Miles Morales》，以纽约为背景，化身蜘蛛侠在纽约的城市上空飞来飞去，还有爽快的打斗，确实是一款很刺激的游戏，但是我对漫画人物为主角的游戏也不是特别喜欢，这款游戏的故事也比较简单，很快就通关了。\n\n![蜘蛛侠：Miles Morales](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/spiderman.webp)\n\n### 极地战嚎 6\n\n《极地战嚎 6》，是一个虚构的现代国家 Yara 为背景（实际上是映射古巴）的游击队反抗政府军的故事，这是育碧旗下的游戏，已经出到第六代，有点像罐头游戏，完成主线任务也很快，我喜欢里面的各种枪械和野路子武器，剧情能够发人深省。\n\n![极地战嚎 6](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/far-cry.webp)\n\n### 荒野大镖客 2\n\n《荒野大镖客 2》是以 19 世纪末的美国西部为背景，玩了不到 1 个小时，实在无法带入剧情，对这个的故事和背景也不感兴趣，索性不玩了。\n\n![荒野大镖客 2](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/red-dead-2.webp)\n\n### 艾尔登法环\n\n我玩过的最后一个 3A 大作是《艾尔登法环》，这是我第一次玩魂系游戏，其中的世界观，复杂的技能点加成，庞大的地图，开放世界都给我造成很大的困惑，尤其是强大的怪物，我一开始玩了几个小时，就死过无数次，被大树守卫很轻易就秒杀，甚至一个普通怪物三两下就把我干掉，我感觉玩这个游戏很痛苦，完全无法体会其中的乐趣，直到我了解可以购买卢恩，将角色升级到满级，然后玩这个游戏就可以轻松很多。\n\n![艾尔登法环](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/elden-ring.webp)\n\n不过这个游戏偶尔还是会让人感觉很不适，尤其是各种迷宫一样的墓地，阴暗的环境，下水道，恶心的怪物。但是面对那些强大的怪物，当时死亡无数次后将其打败，可以体会到其中的快感，以及游戏庞大的地图，琳琅满目的武器，是我坚持玩下去的动力。\n\n## 什么是我想要的 3A 游戏\n\n在《黑神话：悟空》诞生之前，并没有一个让我眼前一亮的 3A 大作，它的出现就像一颗闪耀的新星。下面我将谈谈什么是我心目中的 3A 大作。\n\n### 深入灵魂的叙事篇章\n\n我心目中的 3A 大作，首先必须拥有一段深入人心的故事。它应当如同一部宏大的史诗，让玩家在跌宕起伏的剧情中与角色同悲共喜，体验一段段难忘的旅程。《黑神话：悟空》以其独特的中国神话背景，正是我所期待的那一抹亮色。\n\n### 视觉与听觉的双重盛宴\n\n高质量的美术与音乐是 3A 大作的另一大亮点。精美的画面、逼真的场景、细腻的角色设计，以及动人心弦的背景音乐和音效，共同构建了一个令人向往的虚拟世界。《黑神话：悟空》的预告片已经展现出了其在这方面的非凡实力。\n\n### 流畅操作与无限玩法\n\n流畅的操作手感与丰富的游戏玩法是 3A 大作的基石。无论是战斗系统的爽快感、解谜机制的巧妙设计，还是探索元素的无限可能，都应让玩家在享受游戏的过程中感受到无尽的乐趣与挑战。《黑神话：悟空》作为动作冒险游戏，其在这方面的表现无疑值得期待。\n\n### 文化内涵的深度挖掘\n\n对于国内玩家而言，游戏中融入的文化内涵往往能引发更深的共鸣与认同。《黑神话：悟空》以中国神话为背景，不仅展现了丰富的传统文化元素，更通过游戏这一载体将中华文化的魅力传播至世界各地。\n\n### 持续的创新与支持\n\n一款优秀的 3A 大作不仅需要在发布时惊艳四座，更需要在后续的开发与运营中保持活力与创新。持续的更新与支持不仅能够为玩家带来新鲜感与惊喜，更是游戏生命力的体现。《黑神话：悟空》作为国产 3A 的佼佼者，其后续的更新与支持同样值得我们期待。\n\n## 结语\n\n《黑神话：悟空》的发布不仅是对国产游戏的一次重大突破，更是对全球游戏界的一次震撼宣言。它让我看到了国产 3A 大作的无限可能。\n\n![黑神话：悟空](https:\/\/jimmysong.io\/img\/blog\/black-myth-wukong-game-life\/black-myth.webp)\n\n今天我就购入了《黑神话：悟空》，在游玩一段时间后我会发布新的博客谈谈我的游玩体验。\n', '\/blog\/black-myth-wukong-game-life\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">在《黑神话：悟空》的璀璨光芒下，回顾我的游戏旅程，探讨何为我心目中的 3A 游戏巅峰之作。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/envoy-gateway-integration-istio-mesh/">集成 Envoy Gateway 作为 Istio 服务网格中的入口网关</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/08/13</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/envoy"> 
             Envoy
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('集成 Envoy Gateway 作为 Istio 服务网格中的入口网关', '本文介绍了如何将 Envoy Gateway 作为 Istio 服务网格中的入口网关集成，增强应用的安全性和可访问性。', '\n[Istio](https:\/\/istio.io) 提供了对入口网关的强大而灵活的支持，利用 Envoy 代理在其 sidecar 模式下运行。尽管 Istio 专注于管理集群内服务之间的通信，[Envoy Gateway](https:\/\/gateway.envoyproxy.io) 旨在将应用程序暴露给外部世界，处理用户请求，并支持高级功能，如 OIDC 单点登录。通过结合 Istio 服务网格的功能和 Envoy Gateway 的高级网关功能，可以增强整体应用程序的可访问性和安全性。\n\n下图显示了 Istio 网格中入口网关的流量路径。\n\n![Istio 入口网关流量路径](https:\/\/jimmysong.io\/blog\/explore-tetrate-enterprise-gateway\/istio-ingress-sidecar.svg)\n\n下一个图表显示了在引入 Envoy Gateway 后，流量如何从 Istio 网格的边缘流入内部网络。\n\n![引入 Envoy Gateway 后的流量路径](https:\/\/jimmysong.io\/blog\/explore-tetrate-enterprise-gateway\/istio-teg-integration.svg)\n\n### 准备 Envoy Gateway 与 Istio 之间的互操作性\n\n要将 Envoy Gateway 用作 Istio 的入口网关，请考虑以下关键点：\n\n- 在 Istio 安装期间避免启用入口网关。我们将手动安装并配置 Envoy Gateway 作为入口网关。\n- 由于 Istio 和 Envoy Gateway 都使用 Envoy 作为代理，确保 Istio 将 Envoy sidecar 注入到 Envoy Gateway 的网关 Pod 中，以允许与 Istio 的数据平面安全通信。\n- 配置由 Envoy Gateway 创建的 Envoy 代理的路由类型为 \u0060Service\u0060 而不是 \u0060Endpoint\u0060，以确保正确路由。\n\n按照 [快速启动文档](https:\/\/gateway.envoyproxy.io\/docs\/tasks\/quickstart\/) 安装 Envoy Gateway。标记 Envoy Gateway 的命名空间以确保数据平面获得 Istio sidecar 注入：\n\n\u0060\u0060\u0060bash\nkubectl label namespace envoy-gateway-system --overwrite=true istio-injection=enabled\n\u0060\u0060\u0060\n\n配置 Envoy Gateway 的 sidecar 以不拦截进入网关的流量。注入的 sidecar 确保 Envoy Gateway 的组件及其创建的代理被包含在 Istio 网格中，并安装正确的证书以进行安全通信。\n\n{{\u003cinclude_code file=\u0022control-plane-tls.yaml\u0022\u003e}}\n\n应用补丁：\n\n\u0060\u0060\u0060bash\nkubectl patch service -n envoy-gateway-system envoy-gateway --type strategic --patch-file control-plane-tls.yaml\n\u0060\u0060\u0060\n\n配置 Envoy Gateway 不拦截入站流量：\n\n{{\u003cinclude_code file=\u0022teg-sidecars-no-inbound.yaml\u0022\u003e}}\n\n应用配置：\n\n\u0060\u0060\u0060bash\nkubectl apply -f teg-sidecars-no-inbound.yaml\n\u0060\u0060\u0060\n\n修改 GatewayClass 配置以将 sidecar 配置应用于 Envoy Gateway 数据平面中的所有 \u0060EnvoyProxy\u0060：\n\n{{\u003cinclude_code file=\u0022gtwcls-use-envoyproxy.yaml\u0022\u003e}}\n\n应用补丁：\n\n\u0060\u0060\u0060bash\nkubectl patch gatewayclass teg --patch-file gtwcls-use-envoyproxy.yaml --type merge\n\u0060\u0060\u0060\n\n### 安装 Istio\n\n使用 minimal 配置文件部署 Istio 以避免部署入口网关：\n\n\u0060\u0060\u0060bash\nistioctl install --set profile=minimal -y\n\u0060\u0060\u0060\n\n### 重启 Envoy Gateway 控制平面\n\n在 Istio 的 sidecar 注入准备好后，重启所有 Envoy Gateway 控制平面的 pod：\n\n\u0060\u0060\u0060bash\nfor d in envoy-gateway envoy-ratelimit teg-envoy-gateway teg-redis;\n\tdo kubectl rollout restart deployment -n envoy-gateway-system $d;\ndone\n\u0060\u0060\u0060\n\n### 部署测试应用程序\n\n在安装 Istio 后部署测试应用程序，以确保它们也接收到 sidecar 注入：\n\n\u0060\u0060\u0060bash\nkubectl create namespace httpbin\nkubectl label namespace httpbin --overwrite=true istio-injection=enabled\nkubectl apply -n httpbin -f https:\/\/raw.githubusercontent.com\/istio\/istio\/master\/samples\/httpbin\/httpbin.yaml\n\u0060\u0060\u0060\n\n### 配置 Envoy Gateway\n\n现在配置 Envoy Gateway 以处理边缘流量：\n\n{{\u003cinclude_code file=\u0022apps-gateway.yaml\u0022\u003e}}\n\n应用配置：\n\n\u0060\u0060\u0060bash\nkubectl apply -f apps-gateway.yaml\n\u0060\u0060\u0060\n\n部署应用网关，包括以下容器：\n\n- \u0060istio-init\u0060：由 Istio 注入以修改 pod iptables。\n- \u0060envoy\u0060：由 Envoy Gateway 控制，充当入口网关。\n- \u0060istio-proxy\u0060：由 Istio 注入，负责与内部集群 pod 的通信。\n- \u0060shutdown-manager\u0060：由 Envoy Gateway 控制，负责 pod 生命周期管理。\n\n创建一个 HTTP 路由：\n\n{{\u003cinclude_code file=\u0022httpbin-route.yaml\u0022\u003e}}\n\n应用路由配置：\n\n\u0060\u0060\u0060bash\nkubectl apply -f httpbin-route.yaml\n\u0060\u0060\u0060\n\n### 发送测试请求\n\n获取网关的负载平衡器 IP 地址并发送测试请求：\n\n\u0060\u0060\u0060bash\nexport GATEWAY_URL=$(kubectl get svc -n envoy-gateway-system -l gateway.envoyproxy.io\/owning-gateway-name=apps -o jsonpath=\u0027{.items[0].status.loadBalancer.ingress[0].ip}\u0027)\ncurl -v -H Host:www.example.com http:\/\/$GATEWAY_URL\/httpbin\/get\n\u0060\u0060\u0060\n\n你应该能看到来自 \u0060httpbin\u0060 服务的正确响应：\n\n\u0060\u0060\u0060\n*   Trying 34.41.0.90:80...\n* Connected to 34.41.0.90 (34.41.0.90) port 80\n\u003e GET \/httpbin\/get HTTP\/1.1\n\u003e Host:www.example.com\n\u003e User-Agent: curl\/8.7.1\n\u003e Accept: *\/*\n\u003e\n* Request completely sent off\n\u003c HTTP\/1.1 200 OK\n\u003c server: envoy\n\u003c date: Wed, 31 Jul 2024 08:21:58 GMT\n\u003c content-type: application\/json\n\u003c content-length: 282\n\u003c access-control-allow-origin: *\n\u003c access-control-allow-credentials: true\n\u003c x-envoy-upstream-service-time: 11\n\u003c\n{\n  \u0022args\u0022: {},\n  \u0022headers\u0022: {\n    \u0022Accept\u0022: \u0022*\/*\u0022,\n    \u0022Host\u0022: \u0022www.example.com\u0022,\n    \u0022User-Agent\u0022: \u0022curl\/8.7.1\u0022,\n    \u0022X-Envoy-Attempt-Count\u0022: \u00221\u0022,\n    \u0022X-Envoy-External-Address\u0022: \u0022123.120.227.173\u0022\n  },\n  \u0022origin\u0022: \u0022123.120.227.173\u0022,\n  \u0022url\u0022: \u0022http:\/\/www.example.com\/get\u0022\n}\n* Connection #0 to host 34.41.0.90 left intact\n\u0060\u0060\u0060\n\n### 启用严格 mTLS\n\n通过应用以下配置启用严格 mTLS：\n\n{{\u003cinclude_code file=\u0022strict-mtls.yaml\u0022\u003e}}\n\n应用配置：\n\n\u0060\u0060\u0060bash\nkubectl apply -f strict-mtls.yaml\n\u0060\u0060\u0060\n\n### 为网关启用 TLS\n\n创建服务签名的根证书和私钥：\n\n\u0060\u0060\u0060bash\nmkdir example_certs\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -subj \u0027\/O=example Inc.\/CN=example.com\u0027 -keyout example_certs\/example.com.key -out example_certs\/example.com.crt\n\u0060\u0060\u0060\n\n为 \u0060www.example.com\u0060 创建证书和私钥：\n\n\u0060\u0060\u0060bash\nopenssl req -out example_certs\/www.example.com.csr -newkey rsa:2048 -nodes -keyout example_certs\/www.example.com.key -subj \u0022\/CN=www.example.com\/O=www organization\u0022\nopenssl x509 -req -sha256 -days 365 -CA example_certs\/example.com.crt -CAkey example_certs\/example.com.key -set_serial 0 -in example_certs\/www.example.com.csr -out example_certs\/www.example.com.crt\n\u0060\u0060\u0060\n\n为入口网关创建一个密钥：\n\n\u0060\u0060\u0060bash\nkubectl create -n httpbin secret tls httpbin-credential --key=example_certs\/www.example.com.key --cert=example_certs\/www.example.com.crt\n\u0060\u0060\u0060\n\n配置入口网关：\n\n{{\u003cinclude_code file=\u0022tls-apps-gateway.yaml\u0022\u003e}}\n\n应用配置：\n\n\u0060\u0060\u0060bash\nkubectl apply -f tls-apps-gateway.yaml\n\u0060\u0060\u0060\n\n发送测试请求：\n\n\u0060\u0060\u0060bash\ncurl -v -H Host:www.example.com --resolve \u0022www.example.com:443:$GATEWAY_URL\u0022 --cacert example_certs\/example.com.crt \u0022https:\/\/www.example.com:443\/httpbin\/get\u0022\n\u0060\u0060\u0060\n\n你应该可以通过 HTTPS 在网格内访问 \u0060httpbin\u0060 服务。\n\n### 结论\n\n通过将 Envoy Gateway 集成为 Istio 服务网格中的入口网关，你可以利用两者的优势：Istio 的强大服务网格能力和 Envoy Gateway 的高级网关功能。这种设置增强了你的应用程序的安全性、可扩展性和灵活性，提供了无缝且安全的用户体验。通过仔细的配置和正确的工具，管理服务网格内外的流量变得更加高效和有效，确保你的应用程序始终可访问并且安全。\n', '\/blog\/envoy-gateway-integration-istio-mesh\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文介绍了如何将 Envoy Gateway 作为 Istio 服务网格中的入口网关集成，增强应用的安全性和可访问性。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/cilium-native-authentication/">[译] 解密 Cilium 原生认证功能</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/08/08</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%ae%89%e5%85%a8"> 
             安全
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://blog.teknews.cloud/aks/security/network/2024/07/30/About_Cilium_native_authentication_feature.html" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('解密 Cilium 原生认证功能', '在本文中，我们更深入地探讨了 Cilium 的功能，特别是它从服务网格获得的相互认证功能。', '\n我们已经讨论了 Cilium 一段时间了，但是这个话题有很多值得关注的地方，我们知道我们会再次回到这个话题。今天，我建议我们探索一个用于认证工作负载的功能。在讨论这个话题之前，我们需要一些定义。\n\n我们的议程将按照以下顺序进行：\n\n1. 了解 Cilium 认证功能\n2. 尝试认证功能\n\n## Cilium 认证功能\n\n### 为什么我们需要认证\n\n在基于微服务的架构中，安全是一个巨大的话题。在 Kubernetes 环境中，我们可以查看网络，并通过限制只允许必要端口和协议的流量来实施最小权限原则。在这种情况下，我们可以依赖网络策略。例如，这个策略拒绝 \u0060basic\u0060 命名空间中的所有入站流量：\n\n\u0060\u0060\u0060yaml\nkind: NetworkPolicy\napiVersion: networking.k8s.io\/v1\nmetadata:\n  name: default-deny-all\n  namespace: basics\nspec:\n  podSelector: {}\n  ingress: []\n\u0060\u0060\u0060\n\n这个策略仅允许标有 \u0060app=userprofile\u0060 标签的 pod 在端口 \u00608082\u0060 上从带有标签 \u0060tier=front\u0060 和 \u0060app=tripsinsights\u0060 的命名空间中的 pod 接收流量。\n\n\u0060\u0060\u0060yaml\napiVersion: networking.k8s.io\/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-tripviewer-ingress-apiprofile\n  namespace: api\nspec:\n  podSelector: \n    matchLabels:\n      app: userprofile\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          tier: front\n          app: tripinsights\n    ports:\n    - protocol: TCP\n      port: 8082   \n\u0060\u0060\u0060\n\n但这可能还不够，全局管理也相当困难，这是分布式安全的悖论。\n\n我们在之前的文章中谈到了服务网格，其目的是为网络流量提供一个集中的控制平面。我们还看到，在标准化的倡议中，我们有一些特定的流量控制对象，其中包括了认证功能。\n\n\u0060\u0060\u0060yaml\napiVersion: access.smi-spec.io\/v1alpha4\nkind: IdentityBinding\nmetadata:\n name: service-a\n namespace: default\nspec:\n schemes:\n   podLabelSelector:\n    matchLabels:\n      app: service-a\n   spiffeIdentities:\n     - \u0022cluster.local\/ns\/default\/sa\/service-a\u0022\n     - \u0022federated.trustdomain\/boundary\/boundaryName\/identifierType\/identifier\u0022\n   serviceAccount: service-a\n\u0060\u0060\u0060\n\n我们将在 Cilium 服务网格中，尤其是基于身份的安全性方面探讨这一点。在基础设施层拥有这样的功能是有趣的，因为应用层不总是能够包含认证功能，尤其是当我们考虑多服务时。最多，不幸的是，我们可能在前端获得认证，但不会更多。这里，我们提出了增加基于身份的安全性的建议。\n\n让我们看看它是如何工作的。\n\n### Cilium 认证功能的底层原理\n\n认证意味着，某种程度上，身份。正如之前在 smi 规范中暗示的，并在 [Cilium 文档](https:\/\/docs.cilium.io\/en\/stable\/network\/servicemesh\/mutual-authentication\/mutual-authentication\/#identity-management)中记录的，所使用的技术是 [SPIFFE](https:\/\/spiffe.io\/)，即每个人的安全生产身份框架。它也是 [CNCF](https:\/\/www.cncf.io\/projects\/spiffe\/) 中的一个毕业项目，自 2022 年 8 月以来。Spiffe 规范在一个 [专用的 github](https:\/\/github.com\/spiffe\/spiffe)上定义。\n\n此时，我们将在 github 仓库中描述的 SPIFFE 标准的高层概述，其中包括：\n\n- SPIFFE ID，一个结构化的字符串（表示为 URI），用作实体的“名称”。\n- SPIFFE 可验证身份文档（SVID）是携带 SPIFFE ID 的文档。它是护照的功能等同物 - 一个携带提供者身份的文档。\n- 工作负载 API 是工作负载或计算过程获取其 SVID 的方法。它通常在本地暴露（例如，通过 Unix 域套接字），并且明确不包括来自工作负载的认证握手或认证令牌。\n\n此外，重要的是要提到信任域，这是一个身份命名空间，由一组加密密钥支持的发行机构支持。这些密钥共同作为居住在信任域中的所有身份的加密锚点。\n\n再次强调，由于 SPIFFE 是一组规范，所有这些概念\/标准实际上都在 [github 仓库](https:\/\/github.com\/spiffe\/spiffe\/tree\/main\/standards)中详细说明。\n\n现在我们知道了规范和标准，但还有很多工作要做，因为，毕竟，这只是规范。幸运的是，还有 [SPIRE 项目](https:\/\/spiffe.io\/docs\/latest\/spire-about\/spire-concepts\/)，[另一个毕业的 CNCF 项目](https:\/\/www.cncf.io\/projects\/spire\/)，这是 SPIFFE 规范的一个生产就绪实现。\n\n在 Cilium 中，SPIFFE 的实现基于 SPIRE 中央服务器。这个 SPIRE 服务器扮演我们之前在规范和标准中提到的信任域的角色。它与每个节点的 SPIRE 代理一起工作，这些代理从服务器获取自己的身份，然后验证工作负载的身份请求。\n\n要了解 SPIRE 是如何工作的，我们需要再次一些概念：\n\n- **工作负载注册**是 SPIRE 将能够识别所述工作负载的过程。它告诉 SPIRE 如何识别工作负载以及给它分配哪个 SPIFFE ID。\n- SPIRE 实现工作负载的**认证**，即断言其身份，通过收集来自工作负载和运行 SPIRE 代理的节点的属性。还值得注意的是，认证是由称为 *认证器* 的软件完成的。在我们的案例中，我们将有一个 Kubernetes 认证器用于托管在 Kubernetes 上的工作负载，但也有节点认证器用于需要首先注册的 SPIRE 代理，然后才能进行工作负载认证。在 Azure 上，节点认证\/注册依赖于具有托管身份的 Azure VMs。\n\n节点认证遵循以下步骤：\n\n1. 代理节点认证器插件查询平台以获取节点身份的证明，并将该信息提供给代理。\n2. 代理将这个身份证明传递给服务器。服务器将这些数据传递给其节点认证器。\n3. 服务器节点认证器通过调用平台 API 验证身份证明，使用它在第 2 步中获得的信息。节点认证器还为代理创建一个 SPIFFE ID，并将此 ID 以及它发现的任何节点选择器一起传回服务器进程。\n4. 服务器为代理节点发送回一个 SVID。\n\n![图 1：节点认证流程](nodeattestation.webp)\n\n一个请求身份的工作负载遵循以下步骤：\n\n1. 它调用代理公开的工作负载 API 请求一个 SVID。\n2. 代理询问调用工作负载认证器插件，向其提供有关工作负载的信息。\n3. 工作负载认证器通过查询邻近的平台特定组件（如 Kubernetes kubelet）发现有关工作负载的额外信息。\n4. 认证器将发现的信息以选择器的形式返回给代理。\n5. 代理通过将发现的选择器与注册条目进行比较来确定工作负载的身份，并将正确的缓存 SVID 返回给工作负载。\n\n![图 2：工作负载认证流程](wlattest.webp)\n\n好了，这就是这个概述的全部内容。SPIFFE 规范中还有更多细节，我只能建议进行更彻底的阅读以获得更好的理解。让我们看看当我们在 AKS 集群中部署时情况如何。\n\n## 尝试 Cilium 认证\n\n### 准备环境\n\n为了尝试这个功能，我们将使用一个仅包含 AKS 集群及其默认节点池的环境，位于虚拟网络中。\n\n**shcemainfra**\n\n认证需要在安装 Cilium 时指定，参数 \u0060authentication.mutual.spire.enabled\u0060 和 \u0060authentication.mutual.spire.install.enabled\u0060 必须设置为 true。\n\n我们使用的 Helm 参数的完整列表如下所示\n\n| Helm 参数                                   | 值                                                           | 描述                                                         |\n| ------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| hubble.relay.enabled                        | true                                                         | 启用 Hubble Relay                                            |\n| hubble.ui.enabled                           | true                                                         | 是否启用 Hubble UI                                           |\n| aksbyocni.enabled                           | true                                                         | 启用 AKS BYOCNI 集成。注意，这与未在 BYOCNI 模式下创建的 AKS 集群不兼容：改用 Azure 集成（azure.enabled）。 |\n| nodeinit.enabled                            | true                                                         | 启用节点初始化 DaemonSet                                     |\n| kubeProxyReplacement                        | true                                                         | 替换 kubeproxy                                               |\n| k8sServiceHost                              | “\u0022                                                           | Kubernetes 服务主机 - 使用“auto”从集群信息 ConfigMap 中自动查找（仅限基于 kubeadm 的集群） |\n| k8sServicePort                              | 443                                                          | Kubernetes 服务端口                                          |\n| cluster.id                                  | 1                                                            | 集群的唯一 ID。必须在所有连接的集群中是唯一的，并且在 1 到 255 的范围内。只有在使用 Cluster Mesh 时才需要，如果不使用 Cluster Mesh 可以为 0。 |\n| cluster.name                                | “\u0022                                                           | 集群的名称。只有在使用 Cluster Mesh 和与 SPIRE 的互相认证时才需要。它必须满足以下限制：* 最多包含 32 个字符；* 必须以小写字母或数字字符开头和结尾；* 之间可以包含小写字母或数字字符和破折号。如果集群 ID 不同于 0，则不能使用“default”名称。 |\n| azure.resourceGroup                         | “\u0022                                                           | AKS 资源组                                                   |\n| ipam.operator.clusterPoolIPv4PodCIDRList    | “{Ip_Range}”                                                 | PoolIPv4PodCIDRList 列表 [“10.0.0.0\/8”] IPv4 CIDR 范围列表，分配给单个节点用于 IPAM。 |\n| prometheus.enabled                          | true                                                         | 启用 prometheus 指标                                         |\n| operator.prometheus.enabled                 | true                                                         | 启用以 OpenMetrics 格式导出 hubble 指标。                    |\n| hubble.metrics.enableOpenMetrics            | false                                                        | 启用以 OpenMetrics 格式导出 hubble 指标。                    |\n| hubble.metrics.enabled                      | “{dns,drop,tcp,flow,port-distribution,icmp,httpV2:exemplars=true;labelsContext=source_ip,source_namespace,source_workload,destination_ip,destination_namespace,destination_workload,traffic_direction}” | 配置要收集的指标列表。如果为空或 null，则禁用指标。示例：enabled: - dns:query;ignoreAAAA - drop - tcp - flow - icmp - http 您可以从 helm CLI 指定指标列表：–set hubble.metrics.enabled=”{dns:query;ignoreAAAA,drop,tcp,flow,icmp,http}” |\n| authentication.mutual.spire.enabled         | true                                                         | mutual.spire.enabled bool false 启用 SPIRE 集成（beta）      |\n| authentication.mutual.spire.install.enabled | true                                                         | ion.mutual.spire.install.enabled bool true 启用 SPIRE 安装。这将仅在 authentication.mutual.spire.enabled 为 true 时生效 |\n\n安装完成后，我们可以查看 Cilium 的状态。\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ cilium status\n    \/¯¯\\\n \/¯¯\\__\/¯¯\\    Cilium:             OK\n \\__\/¯¯\\__\/    Operator:           OK\n \/¯¯\\__\/¯¯\\    Envoy DaemonSet:    OK\n \\__\/¯¯\\__\/    Hubble Relay:       OK\n    \\__\/       ClusterMesh:        disabled\n\nDeployment             hubble-ui          Desired: 1, Ready: 1\/1, Available: 1\/1\nDaemonSet              cilium-envoy       Desired: 3, Ready: 3\/3, Available: 3\/3\nDaemonSet              cilium             Desired: 3, Ready: 3\/3, Available: 3\/3\nDeployment             hubble-relay       Desired: 1, Ready: 1\/1, Available: 1\/1\nDeployment             cilium-operator    Desired: 2, Ready: 2\/2, Available: 2\/2\nContainers:            cilium             Running: 3\n                       hubble-ui          Running: 1\n                       cilium-envoy       Running: 3\n                       cilium-operator    Running: 2\n                       hubble-relay       Running: 1\nCluster Pods:          29\/29 managed by Cilium\nHelm chart version:    1.16.0\nImage versions         cilium             quay.io\/cilium\/cilium:v1.16.0@sha256:46ffa4ef3cf6d8885dcc4af5963b0683f7d59daa90d49ed9fb68d3b1627fe058: 3\n                       hubble-ui          quay.io\/cilium\/hubble-ui:v0.13.1@sha256:e2e9313eb7caf64b0061d9da0efbdad59c6c461f6ca1752768942bfeda0796c6: 1\n                       hubble-ui          quay.io\/cilium\/hubble-ui-backend:v0.13.1@sha256:0e0eed917653441fded4e7cdb096b7be6a3bddded5a2dd10812a27b1fc6ed95b: 1\n                       cilium-envoy       quay.io\/cilium\/cilium-envoy:v1.29.7-39a2a56bbd5b3a591f69dbca51d3e30ef97e0e51@sha256:bd5ff8c66716080028f414ec1cb4f7dc66f40d2fb5a009fff187f4a9b90b566b: 3\n                       cilium-operator    quay.io\/cilium\/operator-generic:v1.16.0@sha256:d6621c11c4e4943bf2998af7febe05be5ed6fdcf812b27ad4388f47022190316: 2\n                       hubble-relay       quay.io\/cilium\/hubble-relay:v1.16.0@sha256:33fca7776fc3d7b2abe08873319353806dc1c5e07e12011d7da4da05f836ce8d: 1\n\u0060\u0060\u0060\n\n我们还可以查看其他 Kubernetes 对象：\n\n- 一个 SPIRE 服务器的部署\n- 在每个节点上运行的代理的守护进程集。\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ k get all -n cilium-spire \nNAME                    READY   STATUS    RESTARTS   AGE\npod\/spire-agent-65sh2   1\/1     Running   0          7h2m\npod\/spire-agent-hqnsm   1\/1     Running   0          7h2m\npod\/spire-agent-lcqrz   1\/1     Running   0          7h2m\npod\/spire-server-0      2\/2     Running   0          24h\n\nNAME                   TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE\nservice\/spire-server   ClusterIP   100.65.61.5   \u003cnone\u003e        8081\/TCP   27h\n\nNAME                         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\ndaemonset.apps\/spire-agent   3         3         3       3            3           \u003cnone\u003e          27h\n\nNAME                            READY   AGE\nstatefulset.apps\/spire-server   1\/1     27h\n\u0060\u0060\u0060\n\n在进行一些测试之前，让我们看看我们的 SPIRE 服务器。我们可以在[相应文档](https:\/\/docs.cilium.io\/en\/stable\/network\/servicemesh\/mutual-authentication\/mutual-authentication-example\/)中找到查看它的命令。\n\n首先我们可以检查 SPIRE 服务器的健康状况：\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ kubectl exec -n cilium-spire spire-server-0 -c spire-server -- \/opt\/spire\/bin\/spire-server healthcheck\nServer is healthy.\n\u0060\u0060\u0060\n\n然后我们可以看看 SPIRE 代理及其认证状态。因为我们有 3 个节点，所以在守护进程集中有 3 个 pod\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ k get ds -n cilium-spire \nNAME          DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\nspire-agent   3         3         3       3            3           \u003cnone\u003e          27h\n\nyumemaru@azure:~$ kubectl exec -n cilium-spire spire-server-0 -c spire-server -- \/opt\/spire\/bin\/spire-server agent list\nFound 3 attested agents:\n\nSPIFFE ID         : spiffe:\/\/spiffe.cilium\/spire\/agent\/k8s_psat\/cluster1\/c0c6afc3-1e0a-4ffb-b61e-18442b04123d\nAttestation type  : k8s_psat\nExpiration time   : 2024-07-30 17:27:15 \u002b0000 UTC\nSerial number     : 8338212869267325996294354393424215766\nCan re-attest     : true\n\nSPIFFE ID         : spiffe:\/\/spiffe.cilium\/spire\/agent\/k8s_psat\/cluster1\/08af80d6-0166-4f46-b575-0aa0dc6a5152\nAttestation type  : k8s_psat\nExpiration time   : 2024-07-30 17:27:15 \u002b0000 UTC\nSerial number     : 317183292034746089049553637864798125627\nCan re-attest     : true\n\nSPIFFE ID         : spiffe:\/\/spiffe.cilium\/spire\/agent\/k8s_psat\/cluster1\/bdd0dfa9-20ec-4f24-a82f-c646754588ce\nAttestation type  : k8s_psat\nExpiration time   : 2024-07-30 17:27:15 \u002b0000 UTC\nSerial number     : 215301213544348190052950735212628656167\nCan re-attest     : true\n\u0060\u0060\u0060\n\n接下来我们可以检查 SPIFFE 身份。\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ kubectl exec -n cilium-spire spire-server-0 -c spire-server -- \/opt\/spire\/bin\/spire-server entry show -parentID spiffe:\/\/spiffe.cilium\/ns\/cilium-spire\/sa\/spire-agent\nFound 2 entries\nEntry ID         : 53b6506b-ebe3-4cd8-89b4-9647fa535c37\nSPIFFE ID        : spiffe:\/\/spiffe.cilium\/cilium-agent\nParent ID        : spiffe:\/\/spiffe.cilium\/ns\/cilium-spire\/sa\/spire-agent\nRevision         : 0\nX509-SVID TTL    : default\nJWT-SVID TTL     : default\nSelector         : k8s:ns:kube-system\nSelector         : k8s:sa:cilium\n\nEntry ID         : 8c361104-31a1-480e-b97d-83673a63ce72\nSPIFFE ID        : spiffe:\/\/spiffe.cilium\/cilium-operator\nParent ID        : spiffe:\/\/spiffe.cilium\/ns\/cilium-spire\/sa\/spire-agent\nRevision         : 0\nX509-SVID TTL    : default\nJWT-SVID TTL     : default\nSelector         : k8s:ns:kube-system\n\u0060\u0060\u0060\n### 使用相互认证\n\n现在让我们部署一些工作负载。为了简单起见，我们将创建一系列基于 nginx 的部署：\n\n一个目标应用：\n\n\u0060\u0060\u0060yaml\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: demodeployment\n  name: demodeployment\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: demodeployment\n  strategy: {}\n  template:\n    metadata:\n      labels:\n        app: demodeployment\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n        resources: {}\nstatus: {}\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: demodeployment\n  name: demodeployment\nspec:\n  ports:\n  - port: 80\n    protocol: TCP\n    targetPort: 80\n  selector:\n    app: demodeployment\nstatus:\n  loadBalancer: {}\n\u0060\u0060\u0060\n\n以及客户端：\n\n\u0060\u0060\u0060yaml\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: client1\n  name: client1\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: client1\n  strategy: {}\n  template:\n    metadata:\n      labels:\n        app: client1\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n        resources: {}\nstatus: {}\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: client2\n  name: client2\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: client2\n  strategy: {}\n  template:\n    metadata:\n      labels:\n        app: client2\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n        resources: {}\nstatus: {}\n\u0060\u0060\u0060\n\n如果我们查看 Cilium 端点，我们应该能看到关联身份的信息：\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ k get ciliumendpoint -o wide\nNAME                             SECURITY IDENTITY   INGRESS ENFORCEMENT   EGRESS ENFORCEMENT   VISIBILITY POLICY   ENDPOINT STATE   IPV4           IPV6\nclient1-599c487979-dqm4v         76513                                                                              ready            100.64.1.197   \nclient1-599c487979-qqzvl         76513                                                                              ready            100.64.0.206   \nclient1-599c487979-t8728         76513                                                                              ready            100.64.2.214   \nclient2-d64dd865b-cj56m          77602                                                                              ready            100.64.0.77    \nclient2-d64dd865b-kb7cs          77602                                                                              ready            100.64.1.51    \nclient2-d64dd865b-qskqc          77602                                                                              ready            100.64.2.25    \ndemodeployment-bf5d895b5-6s4xn   108597                                                                             ready            100.64.0.124   \ndemodeployment-bf5d895b5-pmzkm   108597                                                                             ready            100.64.1.244   \ndemodeployment-bf5d895b5-vz4gq   108597                                                                             ready            100.64.2.127   \n\u0060\u0060\u0060\n\n使用安全身份值，我们可以在 SPIRE 服务器上检查相应的身份。我们将使用 \u0060\u0027{.items[0].status.identity.id}\u0027\u0060 作为 jsonpath 值来提取安全身份作为变量。\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ k get deployment --show-labels \nNAME             READY   UP-TO-DATE   AVAILABLE   AGE   LABELS\nclient1          3\/3     3            3           14h   app=client1\nclient2          3\/3     3            3           14h   app=client2\ndemodeployment   3\/3     3            3           15h   app=demodeployment\nyumemaru@azure:~$ export client1=$(k get ciliumendpoints.cilium.io -l app=client1 -o=jsonpath=\u0027{.items[0].status.identity.id}\u0027)id}\u0027)\nyumemaru@azure:~$ export client2Id=$(k get ciliumendpoints.cilium.io -l app=client2 -o=jsonpath=\u0027{.items[0].status.identity.id}\u0027)\nyumemaru@azure:~$ export demoId=$(k get ciliumendpoints.cilium.io -l app=demodeployment -o=jsonpath=\u0027{.items[0].status.identity.id}\u0027)\n\u0060\u0060\u0060\n\n在 SPIRE 服务器 pod 内部，我们现在可以检查每个工作负载对应的身份：\n\n\u0060\u0060\u0060bash\nyumemaru@azure:~$ kubectl exec -n cilium-spire spire-server-0 -c spire-server -- \/opt\/spire\/bin\/spire-server entry show -spiffeID spiffe:\/\/spiffe.cilium\/identity\/$client1Id\nFound 1 entry\nEntry ID         : 7bf9a3b0-a06c-480e-8f0c-1fd654d3ec56\nSPIFFE ID        : spiffe:\/\/spiffe.cilium\/identity\/76513\nParent ID        : spiffe:\/\/spiffe.cilium\/cilium-operator\nRevision         : 0\nX509-SVID TTL    : default\nJWT-SVID TTL     : default\nSelector         : cilium:mutual-auth\n\nyumemaru@azure:~$ kubectl exec -n cilium-spire spire-server-0 -c spire-server -- \/opt\/spire\/bin\/spire-server entry show -spiffeID spiffe:\/\/spiffe.cilium\/identity\/$client2Id\nFound 1 entry\nEntry ID         : 62b158d0-c90b-449a-9b30-a8a24ba012ba\nSPIFFE ID        : spiffe:\/\/spiffe.cilium\/identity\/77602\nParent ID        : spiffe:\/\/spiffe.cilium\/cilium-operator\nRevision         : 0\nX509-SVID TTL    : default\nJWT-SVID TTL     : default\nSelector         : cilium:mutual-auth\n\nyumemaru@azure:~$ kubectl exec -n cilium-spire spire-server-0 -c spire-server -- \/opt\/spire\/bin\/spire-server entry show -spiffeID spiffe:\/\/spiffe.cilium\/identity\/$demoId\nFound 1 entry\nEntry ID         : 07f27f3c-7a94-450b-aecc-bb006f57b97e\nSPIFFE ID        : spiffe:\/\/spiffe.cilium\/identity\/108597\nParent ID        : spiffe:\/\/spiffe.cilium\/cilium-operator\nRevision         : 0\nX509-SVID TTL    : default\nJWT-SVID TTL     : default\nSelector         : cilium:mutual-auth\n\u0060\u0060\u0060\n\n但也可以直接作为 cilium api 对象查看身份。以下是 \u0060client1\u0060 应用的结果：\n\n\u0060\u0060\u0060bash\nyumemary@azure:~$ k describe ciliumidentities.cilium.io $client1Id \nName:         76513\nNamespace:    \nLabels:       app=client1\n              io.cilium.k8s.policy.cluster=cluster1\n              io.cilium.k8s.policy.serviceaccount=default\n              io.kubernetes.pod.namespace=default\nAnnotations:  \u003cnone\u003e\nAPI Version:  cilium.io\/v2\nKind:         CiliumIdentity\nMetadata:\n  Creation Timestamp:  2024-07-30T16:46:43Z\n  Generation:          1\n  Resource Version:    224640\n  UID:                 433dd70b-58ba-41c0-abef-c9d5785eaddb\nSecurity - Labels:\n  k8s:app:                                                         client1\n  k8s:io.cilium.k8s.namespace.labels.kubernetes.io\/metadata.name:  default\n  k8s:io.cilium.k8s.policy.cluster:                                cluster1\n  k8s:io.cilium.k8s.policy.serviceaccount:                         default\n  k8s:io.kubernetes.pod.namespace:                                 default\nEvents:                                                            \u003cnone\u003e\n\u0060\u0060\u0060\n\n我们会注意到 Cilium 身份名称、Cilium 端点上显示的安全身份和我们在 SPIRE 服务器上得到的 SPIFFE ID \u0060spiffe:\/\/spiffe.cilium\/identity\/76513\u0060 之间的对应关系。\n\n那很好。现在，我们如何强制执行相互认证呢？实际上很简单，我们只需要在 Cilium 网络策略中添加适当的参数：\n\n\u0060\u0060\u0060yaml\nauthentication:\n    mode: \u0022required\u0022\n\u0060\u0060\u0060\n\n让我们编写 3 个网络策略：\n\n- 首先，按应有的方式，一个拒绝所有策略。\n\n\u0060\u0060\u0060yaml\napiVersion: \u0022cilium.io\/v2\u0022\nkind: CiliumNetworkPolicy\nmetadata:\n  name: \u0022demo1-default-deny\u0022\n  namespace: default\nspec:\n  description: \u0022Default-deny ingress policy for demo app\u0022\n  endpointSelector:\n    matchLabels:\n      app: demodeployment\n  ingress:\n  - {}\n\u0060\u0060\u0060\n\n- 其次，一个允许 app1 流量到 demo 应用的策略。\n- 第三，一个网络策略允许 app2 到 demo 应用，但这次需要认证。\n\n如果我们仅应用第一个策略，我们应该无法再访问 demo 应用。这可以通过 \u0060hubble observe\u0060 命令看到\n\n\u0060\u0060\u0060bash\nyumemary@azure:~$ k exec deployments\/client1 -- curl -i -X GET http:\/\/demodeployment\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:--  0:02:09 --:--:--     0\ncurl: (28) Failed to connect to demodeployment port 80 after 129180 ms: Couldn\u0027t connect to server\ncommand terminated with exit code 28\nyumemary@azure:~$ hubble observe --to-label app=demodeployment\nJul 31 09:54:42.541: default\/client1-599c487979-t8728:54548 (ID:76513) -\u003e default\/demodeployment-bf5d895b5-pmzkm:80 (ID:108597) to-overlay FORWARDED (TCP Flags: SYN)\n\u0060\u0060\u0060\n\n然而，我们仍然可以访问 client2 部署的一个 pod，因为我们只针对其标签的 demo 应用。\n\n\u0060\u0060\u0060bash\nyumemary@azure:~$ k get pod -o custom-columns=Name:.metadata.name,PodIp:.status.podIP,HostIp:.status.hostIP\nName                             PodIp          HostIp\nclient1-599c487979-dqm4v         100.64.1.197   172.21.14.69\nclient1-599c487979-qqzvl         100.64.0.206   172.21.14.68\nclient1-599c487979-t8728         100.64.2.214   172.21.14.70\nclient2-d64dd865b-cj56m          100.64.0.77    172.21.14.68\nclient2-d64dd865b-kb7cs          100.64.1.51    172.21.14.69\nclient2-d64dd865b-qskqc          100.64.2.25    172.21.14.70\nclient3-6fbfd96c6f-bwhqh         100.64.1.150   172.21.14.69\nclient3-6fbfd96c6f-cfhhv         100.64.0.91    172.21.14.68\nclient3-6fbfd96c6f-wldx5         100.64.2.95    172.21.14.70\ndemodeployment-bf5d895b5-6s4xn   100.64.0.124   172.21.14.68\ndemodeployment-bf5d895b5-pmzkm   100.64.1.244   172.21.14.69\ndemodeployment-bf5d895b5-vz4gq   100.64.2.127   172.21.14.70\nyumemary@azure:~$ k exec deployments\/client1 -- curl -i -X GET http:\/\/100.64.2.25\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   615  100   615    0     0   499k      0 --:--:-- --:--:-- --:--:--  600k\nHTTP\/1.1 200 OK\nServer: nginx\/1.27.0\nDate: Wed, 31 Jul 2024 10:01:58 GMT\nContent-Type: text\/html\nContent-Length: 615\nLast-Modified: Tue, 28 May 2024 13:22:30 GMT\nConnection: keep-alive\nETag: \u00226655da96-267\u0022\nAccept-Ranges: bytes\n\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n\u003ctitle\u003eWelcome to nginx!\u003c\/title\u003e\n\u003cstyle\u003e\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; }\n\u003c\/style\u003e\n\u003c\/head\u003e\n\u003cbody\u003e\n\u003ch1\u003eWelcome to nginx!\u003c\/h1\u003e\n\u003cp\u003eIf you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.\u003c\/p\u003e\n\n\u003cp\u003eFor online documentation and support please refer to\n\u003ca href=\u0022http:\/\/nginx.org\/\u0022\u003enginx.org\u003c\/a\u003e.\u003cbr\/\u003e\nCommercial support is available at\n\u003ca href=\u0022http:\/\/nginx.com\/\u0022\u003enginx.com\u003c\/a\u003e.\u003c\/p\u003e\n\n\u003cp\u003e\u003cem\u003eThank you for using nginx.\u003c\/em\u003e\u003c\/p\u003e\n\u003c\/body\u003e\n\u003c\/html\u003e\n\u0060\u0060\u0060\n\n### 实施策略 2 和 3\n\n现在我们来从客户端 1 和客户端 2 使用命令 \u0060kubectl exec deployments\/\u003cdeploymentname\u003e -- curl -i -X GET http:\/\/demodeployment\u0060 访问 demo 应用，我们可以通过 hubble 观察到客户端 1 的流量被授权：\n\n\u0060\u0060\u0060bash\nyumemary@azure:~$ hubble observe --to-label app=demodeployment --from-label app=client1\nJul 31 11:33:48.647: default\/client1-599c487979-t8728:54594 (ID:76513) \u003c\u003e default\/demodeployment-bf5d895b5-vz4gq (ID:108597) pre-xlate-rev TRACED (TCP)\nJul 31 11:33:48.647: default\/client1-599c487979-t8728 (ID:76513) \u003c\u003e default\/demodeployment-bf5d895b5-vz4gq:80 (ID:108597) post-xlate-fwd TRANSLATED (TCP)\nJul 31 11:33:48.647: default\/client1-599c487979-t8728:54594 (ID:76513) -\u003e default\/demodeployment-bf5d895b5-vz4gq:80 (ID:108597) policy-verdict:L3-L4 INGRESS ALLOWED (TCP Flags: SYN)\nJul 31 11:33:48.647: default\/client1-599c487979-t8728:54594 (ID:76513) -\u003e default\/demodeployment-bf5d895b5-vz4gq:80 (ID:108597) to-endpoint FORWARDED (TCP Flags: SYN)\nJul 31 11:33:48.647: default\/client1-599c487979-t8728:54594 (ID:76513) -\u003e default\/demodeployment-bf5d895b5-vz4gq:80 (ID:108597) to-endpoint FORWARDED (TCP Flags: ACK)\n\u0060\u0060\u0060\n\n以及客户端 2 的认证步骤：\n\n\u0060\u0060\u0060bash\nyumemary@azure:~$ hubble observe --to-label app=demodeployment --from-label app=client2\nJul 31 11:35:18.651: default\/client2-d64dd865b-qskqc (ID:77602) \u003c\u003e default\/demodeployment-bf5d895b5-6s4xn:80 (ID:108597) post-xlate-fwd TRANSLATED (TCP)\nJul 31 11:35:18.651: default\/client2-d64dd865b-qskqc:50986 (ID:77602) -\u003e default\/demodeployment-bf5d895b5-6s4xn:80 (ID:108597) to-overlay FORWARDED (TCP Flags: SYN)\nJul 31 11:35:18.651: default\/client2-d64dd865b-qskqc:50986 (ID:77602) \u003c\u003e default\/demodeployment-bf5d895b5-6s4xn:80 (ID:108597) policy-verdict:L3-L4 INGRESS DENIED (TCP Flags: SYN; Auth: SPIRE)\nJul 31 11:35:18.651: default\/client2-d64dd865b-qskqc:50986 (ID:77602) \u003c\u003e default\/demodeployment-bf5d895b5-6s4xn:80 (ID:108597) Authentication required DROPPED (TCP Flags: SYN)\nJul 31 11:35:19.661: default\/client2-d64dd865b-qskqc:50986 (ID:77602) -\u003e default\/demodeployment-bf5d895b5-6s4xn:80 (ID:108597) policy-verdict:L3-L4 INGRESS ALLOWED (TCP Flags: SYN; Auth: SPIRE)\nJul 31 11:35:19.661: default\/client2-d64dd865b-qskqc:50986 (ID:77602) -\u003e default\/demodeployment-bf5d895b5-6s4xn:80 (ID:108597) to-endpoint FORWARDED (TCP Flags: SYN)\n\u0060\u0060\u0060\n\n到此为止就是所有的内容了。让我们来总结一下。\n\n## 总结\n\n在本文中，我们更深入地探讨了 Cilium 的功能，特别是它从服务网格获得的相互认证功能。这一功能依赖于实现 SPIFFE 框架的 SPIRE 服务器部署。之后，实际上非常简单。网络策略中的简单规范确保了工作负载间的身份验证。而且在 hubble 上也很容易看到这一点。下一步应该是在 hubble 部分以及 SPIRE 服务器上配置更多的监控。这就是为什么在图表配置中添加了与指标相关的值。目前这对我来说还不起作用，所以我稍后还得回来处理这个问题。还需要对 SPIRE 服务器的可观测性进行一些思考。可能查看 loki 或类似工具的日志会很不错。但那将是下一次的内容。\n', '\/trans\/cilium-native-authentication\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">在本文中，我们更深入地探讨了 Cilium 的功能，特别是它从服务网格获得的相互认证功能。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/istio-configuration-safety-common-misconfigurations/">Istio 配置安全：如何避免错误配置</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/08/06</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Istio 配置安全：如何避免错误配置', '探索常见的 Istio 配置错误及其解决方法，提高服务网格的安全性和稳定性。', '\nIstio 是一个功能强大的服务网格解决方案，提供零信任安全性、可观测性和高级流量管理等功能，且无需修改代码即可实现。然而，由于配置错误，我们经常会遇到意料之外的行为。本文将介绍几种常见的 Istio 配置错误，解析其背后的原理，并通过示意图展示如何识别和解决这些问题。我们还将介绍 Tetrate 提供的工具——[TIS Config Analyzer](https:\/\/docs.tetrate.io\/istio-subscription\/dashboard\/analyzers\/config)，这是一种优化 Istio 操作效率和安全性的工具。\n\n## 配置错误导致的事故案例\n\n以下是两个由于配置错误导致的典型事故案例：\n\n1. **[Amazon Web Services 2017 年停机事件](https:\/\/www.theverge.com\/2017\/3\/2\/14792442\/amazon-s3-outage-cause-typo-internet-server)**：一次简单的输入错误导致了广泛的服务中断，影响了数千个在线服务和应用，突显了即使在成熟的云基础设施中，一个小小的配置错误也会引发严重后果。\n\n2. **[GitLab 2017 年数据丢失事故](https:\/\/about.gitlab.com\/blog\/2017\/02\/01\/gitlab-dot-com-database-incident\/)**：由于配置错误，GitLab 在进行数据库维护时误删除了大量生产数据。尽管备份机制被配置好，但错误的配置阻止了数据的及时恢复。\n\n这些案例表明，正确的配置管理对于防止服务中断和数据丢失至关重要。\n\n## 常见的 Istio 配置错误类型\n\nIstio 配置错误主要分为以下几大类：\n\n1. **AuthorizationPolicy（授权策略）**：命名空间不存在、仅允许 HTTP 方法和完全限定的 gRPC 名称、主机没有匹配的服务注册表条目、字段需要启用 mTLS、未找到服务帐户等。\n2. **DestinationRule（目标规则）**：同一主机子集组合的多个目标规则、主机在服务注册表中没有匹配条目、子集标签在任何匹配主机中未找到等。\n3. **Gateway（网关）**：同一主机端口组合的多个网关、网关选择器在命名空间中未找到匹配的工作负载等。\n4. **Port（端口）**：端口名称必须遵循特定格式、端口的应用协议必须遵循特定格式等。\n5. **Service（服务）**：未找到暴露与服务相同端口的部署等。\n6. **VirtualService（虚拟服务）**：目标权重的路由没有有效的服务、指向不存在网关的虚拟服务等。\n\n## 常见的 Istio 配置错误示例\n\n在 Istio 的日常使用中，以下是一些最常见的配置错误：\n\n1. **虚拟服务指向不存在的网关：**\n\n    \u0060\u0060\u0060yaml\n    apiVersion: networking.istio.io\/v1beta1\n    kind: VirtualService\n    metadata:\n      name: details\n      namespace: bookinfo\n    spec:\n      hosts:\n        - details\n      gateways:\n        - non-existent-gateway\n    \u0060\u0060\u0060\n    在这种情况下，\u0060details\u0060 虚拟服务试图通过一个不存在的 \u0060non-existent-gateway\u0060 进行路由，导致流量管理失败。\n\n2. **虚拟服务引用不存在的服务子集：**\n\n    \u0060\u0060\u0060yaml\n    apiVersion: networking.istio.io\/v1beta1\n    kind: VirtualService\n    metadata:\n      name: details\n      namespace: bookinfo\n    spec:\n      hosts:\n        - details\n    \u0060\u0060\u0060\n    如果 \u0060details\u0060 服务没有定义相应的子集，请求将因无法找到正确的服务实例而被拒绝。\n\n3. **网关找不到指定的服务器凭证：**\n\n    \u0060\u0060\u0060yaml\n    apiVersion: networking.istio.io\/v1beta1\n    kind: Gateway\n    metadata:\n      name: cert-not-found-gateway\n      namespace: bookinfo\n    spec:\n      selector:\n        istio: ingressgateway\n      servers:\n        - port:\n            number: 443\n            name: https\n            protocol: HTTPS\n          tls:\n            mode: SIMPLE\n            credentialName: \u0022not-exist\u0022\n    \u0060\u0060\u0060\n    这会导致 TLS 握手失败，因为指定的凭证 \u0060not-exist\u0060 不存在。\n\n## 配置验证\n\n为了减少由于配置错误而导致的服务中断风险，配置验证成为了一个不可或缺的步骤。配置验证可以分为以下两种：\n\n- **静态配置验证**：在配置应用到系统之前进行验证。这包括检查语法错误、完整性以及配置项的有效性。\n- **按需配置验证**：在配置已经应用但可能需要根据实时数据进行调整时进行验证。这种类型的验证有助于适应动态环境中的变化，确保配置的持续正确性。\n\n### 推荐的配置验证工具\n\n#### \u0060istioctl validate\u0060\n\n\u0060istioctl validate\u0060 用于验证 Istio 配置文件（如 YAML 文件）的语法和基本结构，确保配置文件符合 Istio API 的规范。它可以在配置应用到集群之前检测出语法错误和格式问题，是一个静态分析工具，通常结合 CI 流程使用，防止无效配置文件应用到集群中。\n\n#### \u0060istioctl analyze\u0060\n\n[\u0060istioctl analyze\u0060](https:\/\/istio.io\/latest\/docs\/ops\/diagnostic-tools\/istioctl-analyze\/) 是一个强大的诊断工具，用于分析 Istio 集群的运行状态和配置一致性。它不仅检查配置文件的语法，还可以检查集群中实际应用的配置，找出潜在的问题和冲突。\u0060istioctl analyze\u0060 提供动态分析功能，能够识别集群运行时的配置错误和潜在问题。\n\n\u0060istioctl analyze\u0060 的配置流程如下：\n\n1. **收集配置数据**：首先，\u0060istioctl analyze\u0060 收集来自指定源的 Istio 配置数据。这些源可以是活动的 Kubernetes 集群，也可以是本地的配置文件。\n2. **解析和构建模型**：工具解析收集的配置数据，构建一个内部表示 Istio 配置的模型。\n3. **应用分析规则**：随后，它应用一系列预定义的规则来分析这个模型，检测潜在的配置问题。这些规则涵盖从安全漏洞到性能问题的各种潜在问题。\n4. **生成报告**：分析完成后，\u0060istioctl analyze\u0060 输出一个包含所有发现问题的详细报告。如果没有发现问题，它会通知用户配置看起来没有问题。\n\n下面是 \u0060istioctl analyze\u0060 的工作流程图：\n\n\u0060\u0060\u0060mermaid istio analyze 的工作流程\nflowchart TD\n    A[开始] --\u003e B[选择配置源]\n    B --本地文件--\u003e C[加载本地配置文件]\n    B --实时集群--\u003e D[连接 Kubernetes 集群]\n    B --两者--\u003e E[组合本地文件和集群配置]\n    C --\u003e F[解析配置数据]\n    D --\u003e F\n    E --\u003e F\n    F --\u003e G[构建内部配置模型]\n    G --\u003e H[应用分析规则]\n    H --\u003e I{发现问题?}\n    I --是--\u003e J[生成问题报告]\n    I --否--\u003e K[输出配置无问题]\n    J --\u003e L[结束]\n    K --\u003e L\n\u0060\u0060\u0060\n\n![istioctl analyze 的工作流程](4eb4d5bbb7c8856d609944835aa03993.svg)\n\n#### Kiali\n\n[Kiali](https:\/\/kiali.io) 是管理和可视化 Istio 服务网格的重要工具，提供对网格健康状况、性能和配置状态的实时洞察。通过将 Kiali 集成到 Istio 环境中，可以通过以下方式增强配置安全性：\n\n- **可视化**：Kiali 提供服务网格的图形表示，更容易发现配置错误，如路由错误或缺失的策略。\n- **验证**：有助于验证 Istio 配置，突出显示如配置错误的网关或目标规则等问题，以防这些问题引起麻烦。\n- **安全洞察**：Kiali 提供对安全策略的可见性，确保 mTLS 和授权设置正确实施。\n\n将 Kiali 与 \u0060istioctl validate\u0060 和 \u0060istioctl analyze\u0060 等工具结合使用，能确保更为稳健的方法来预防和解决 Istio 配置错误，进而提升服务网格的安全性和效率。\n\n## Tetrate 的 TIS 中的 Config Analyzer 工具介绍\n\n为了帮助开发者和运维人员避免常见的配置失误，Tetrate 开发了 TIS Dashboard 中的 [Config Analyzer](https:\/\/docs.tetrate.io\/istio-subscription\/dashboard\/analyzers\/config) 工具。该工具能够自动验证 Istio 的配置，根据最佳实践分析服务网格的配置问题，并提供优化建议。Config Analyzer 可以自动检测 Istio 服务网格中的配置问题，提供解释及解决方案，支持按需检测配置中的错误。\n\n![TIS Config Analyzer 可以按需检测配置中的问题](config-validate.png)\n\n## 总结\n\n正确配置 Istio 是确保服务网格健康运行的关键。通过了解和避免常见配置错误，以及利用如 Tetrate 的 TIS Config Analyzer 这样的高级工具，您可以确保 Istio 环境的稳定性和安全性。记住，一个小小的配置错误可能导致整个服务网格的故障，因此持续监控和审核配置是非常必要的。\n\n## 参考\n\n- [Validation - kiali.io](https:\/\/kiali.io\/docs\/features\/validations\/)', '\/blog\/istio-configuration-safety-common-misconfigurations\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">探索常见的 Istio 配置错误及其解决方法，提高服务网格的安全性和稳定性。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
 <nav aria-label="Page navigation">
   <ul class="pagination justify-content-center">
     
     
     <li class="page-item">
       <a class="page-link" href="/blog/">
         ««
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a href="/blog/page/3/" class="page-link">
         «
       </a>
     </li>
     
     
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/2/" class="page-link">
             2
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/3/" class="page-link">
             3
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item page-item active ">
           <a href="/blog/page/4/" class="page-link">
             4
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/5/" class="page-link">
             5
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/6/" class="page-link">
             6
           </a>
         </li>
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
     
     
     <li class="page-item">
       <a href="/blog/page/5/" class="page-link">
         »
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a class="page-link" href="/blog/page/29/">
         »»
       </a>
     </li>
     
   </ul>
 </nav>
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      专栏
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(83)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(42)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(25)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>随笔</span>
            <span>(22)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>其他</span>
            <span>(20)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(18)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>业态</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>云原生</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>安全</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>开源</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>旅行</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e5%b7%a5%e5%85%b7" class="sidebar-item">
            <span>工具</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>可观测性</span>
            <span>(5)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      资料
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>出版物</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>翻译电子书</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>翻译文档</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>翻译图书</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>原创图书</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>教程手册</span>
            <span>(2)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/napkin-ai-visualization-tool/">AI 工具推荐 Napkin.ai：让复杂想法一键变成直观图表</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/cilium-annual-report-2024/">Cilium 2024 年度报告解读</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-ambient-packet-lifecycle-optimization/">Istio Ambient 模式中的数据包生命周期及流量优化</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  简明 Envoy 教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-community-domain-migration/">云原生社区网站域名变更通知</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024（香港）</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
