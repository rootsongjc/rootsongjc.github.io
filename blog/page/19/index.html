<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>博客 · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="Jimmy Song 的原创博客及译文。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.129.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/blog/" />
  <meta property="og:title" content="博客 | Jimmy Song" />
  <meta property="twitter:title" content="博客 | Jimmy Song" />

  
  <meta property="og:description" content="Jimmy Song 的原创博客及译文。" />
  <meta property="twitter:description" content="Jimmy Song 的原创博客及译文。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    <a class="nav-link" href="/en/blog/">English</a>
                    
                  
                
              
              
              
                
                  
                    
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    博客
                </p>
                <p class="page-description">
                    Jimmy Song 的原创博客及译文。
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/introducing-policy-as-code-the-open-policy-agent-opa/">[译] 策略即代码——Open Policy Agent（开放策略代理 OPA）简介</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/06/29</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             其他
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('策略即代码——Open Policy Agent（开放策略代理 OPA）简介', '本文将带你初步了解开放策略代理 OPA，一个平台无关的策略执行工具。', '\n## 什么是 OPA？\n\n这是一个始于 2016 年的项目，旨在统一不同技术和系统的策略执行。今天，OPA 被科技行业内的巨头们所使用。例如，Netflix 使用 OPA 来控制对其内部 API 资源的访问。Chef 用它来为他们的终端用户产品提供 IAM 功能。此外，许多其他公司，如 Cloudflare、Pinterest 等，都使用 OPA 在他们的平台上执行策略（如 Kubernetes 集群）。目前，OPA 已从 CNCF 中毕业。\n\n## OPA 有什么用？\n\n你可能想知道 OPA 是怎样诞生的？它试图解决什么问题？事实上，API 和微服务的策略执行就如同微服务本身一样古老。没有一个生产级别的应用程序不执行访问控制、授权和策略。为了理解 OPA 的作用，考虑以下用例：你的公司通过一个在线门户销售笔记本电脑。像所有其他类似的应用程序一样，该门户由一个首页组成，客户在这里看到最新的产品，也许还有一些限时促销活动。如果客户想买东西，他们需要登录或创建一个账户。接下来，使用信用卡或其他方法付款。为了确保客户会反复访问，需要支持客户订阅，其中可能包含特别折扣信息。另外，他们可以选择在新产品公布后立即接收浏览器通知。一个非常典型的网上购物应用程序，对吗？现在，让我们用一张图来描述一下这个工作流程是什么样子的，以使这个过程可视化。\n\n![](008i3skNly1gryvk70h04j30wm0u0x2v.jpg)\n\n上图显示了我们系统内部可能的样子。我们有一些微服务，它们相互沟通，为我们的客户提供服务。现在，显然，Bob 不应该看到系统的任何内部运作。例如，他不能查看（或甚至不知道）归档付款的 S3 Bucket，或通知 API 可以与哪些服务联络。但是，John 呢？他是应用开发者，他需要访问所有的微服务，以便在问题发生时能够进行故障排除和调试。要是他不小心（或故意）对数据库服务进行了一个 API 调用，把客户的送货地址改到了别的地方，怎么办？更糟糕的是，如果他对客户的信用卡号码有读取权限怎么办？为了解决这些风险，我们在每个微服务的之前放置了一个授权控制。该控件检查认证用户是否有必要的权限来执行请求的操作。这样的授权系统可以是内部的、自制的程序，也可以是 AWS IAM 提供的外部程序。这就是一个典型的微服务应用程序的构建和安全。但是，看看使用几种不同的授权系统的缺点，特别是随着应用程序的增长而带来的麻烦。\n\n- 修改现有的策略，或引入新的策略，是一场噩梦。试想一下，你需要访问多少地方才能让 Alice 拥有对所有存储相关系统的读取权限。这意味着 S3、MySQL、MongoDB，也许还有一个外部 API，仅此而已。\n- 开发者没有办法在他们自己的系统上执行策略。他们显然可以在应用程序中硬编码他们的授权逻辑，但这使事情变得错综复杂：试图在不同的微服务中统一策略是非常复杂的。\n- 补充前一点，为本地服务引入一个新的策略可能需要改变代码，从而引入所有微服务的新版本。\n- 如果你想将策略与现有的用户数据库集成，该怎么办？例如，与人力资源数据库整合。\n- 我们需要将策略可视化，以确保它正在做它应该做的事情。随着你的策略变得越来越复杂，这一点变得越来越重要。\n- 现代系统由多种技术和服务组成，这些技术和服务是用不同的语言编写的。例如，你可能有运行在 Kubernetes 上的系统核心，以及一堆不属于集群的用 Java、Ruby 和 PHP 编写的传统 API。每个平台都有自己的授权机制。\n\n让我们以 Kubernetes 为例来看看。如果所有用户都被授权访问整个集群，很多讨厌的事情就会发生，比如：\n\n- 给所有的 pod 提供无限的请求和限制，可能会导致随机的 pod 被从节点上驱逐。\n- 拉取和使用未经测试的、杂乱无章的镜像，可能包含安全漏洞或恶意内容。\n- 使用没有 TLS 的 Ingress 控制器，允许未加密的、不安全的流量进入应用程序。\n- 由于整体的复杂性，还有许多其他不可预见的风险。\n- 你肯定可以使用 RBAC 和 Pod 安全策略来对集群进行细粒度的控制。但同样，这只适用于集群。在 Kubernetes 集群之外，Kubernetes RBAC 是没有用的。\n\n这就是开放策略代理（OPA）发挥作用的地方。引入 OPA 是为了创建一个统一的方法来执行堆栈中的安全策略。\n\n## OPA 如何工作？\n\n上文中，我们探讨了策略执行和 OPA 试图解决的问题，现在，让我们来看看它是如何工作的。\n\n假设你正在实现我们示例应用程序的支付服务。这个服务负责处理客户的付款。它暴露了一个 API，接受客户的付款。它还允许用户查询特定客户的付款情况。因此，为了获得一个包含 Jane 所做购买的数组，她是公司的一个客户，你向 API 发送一个 GET 请求，路径为 \u0060\/payment\/jane\u0060。你在授权头中提供你的证书信息并发送请求。响应将是一个 JSON 数组，包含你所要求的数据。然而，由于你不希望所有有网络访问权限的人都能够访问支付 API，看到这样的敏感数据，你需要执行一个授权策略。OPA 以如下方式解决这个问题：\n\n1. 支付 API 向 OPA 查询一个 decision。它伴随着这个查询的一些属性，如请求中使用的 HTTP 方法，路径，用户，等等。\n2. OPA 根据已经提供给它的数据来验证这些属性。\n3. 在验证之后，OPA 向请求的 API 发送一个 decision，要么允许，要么拒绝。\n\n这里需要注意的是，OPA 将我们的策略决策与执行解耦。OPA 的工作流程可以用下面的图来描述。\n\n![OPAd 的工作流程](008i3skNly1gryw7x0q6gj30u00xt7td.jpg)\n\nOPA 是一个通用的、与领域无关的策略执行工具。它可以与 API、Linux SSH 守护程序、像 CEPH 这样的对象存储等集成。OPA 的设计者有意避免将其建立在任何其他项目的基础上。因此，策略查询和决定不遵循特定的格式。也就是说，你可以使用任何有效的 JSON 数据作为请求属性，只要它提供所需的数据。同样地，来自 OPA 的策略决策也可以是任何有效的 JSON 数据。你选择什么被输入，什么被输出。例如，你可以选择让 OPA 返回一个 TRUE 或 FALSE 的 JSON 对象，一个数字，一个字符串，甚至是一个复杂的数据对象。\n\n## OPA 内部\n\n为了充分理解 OPA 并开始在自己的项目中实施它，你必须熟悉它的功能和组件。让我们从如何定义你的策略开始。\n\n### 策略语言 Rego\n\nRego 是一种高级的声明性语言，是专门为 OPA 建立的。它使定义策略和解决以下问题变得非常容易：Bob 是否被允许对 \u0060\/api\/v1\/products\u0060 执行 GET 请求？他实际上被允许查看哪些记录？\n\n### 部署\n\n当涉及到部署 OPA 时，你有多个选择，这取决于你的具体场景。\n\n- **作为 Go 库**：如果你的应用程序是用 Golang 写的，你可以把 OPA 作为应用程序中的第三方库来实现。\n- **作为守护程序**：如果你不使用 Go，那么你可以像其他服务一样，把 OPA 作为一个守护程序来部署。在这种情况下，建议你使用一个 sidecar 容器或在主机上运行。原因是，这种设计可以提高性能和可用性。想象一下，你把 OPA 部署在 Kubernetes 的一个单独的 pod 中，而这个 pod 恰好位于一个单独的节点上，而你的应用 pod 正在那里运行。现在，每当你的服务需要咨询 OPA 的策略决策时，它必须通过网络进行调用，以达到 OPA 运行的 pod。这引入了不必要的延迟，并可能在高峰期导致应用程序的迟滞。\n\n![](008i3skNly1grywfo32k9j30u01drtl3.jpg)\n\n### 如何管理和控制 OPA？\n\n为了进一步减少延迟，设计者决定 OPA 应该把所有的策略数据保存在内存中。这确保了 OPA 不会去查询另一个服务来请求数据。为了处理 OPA，你有一组 API，用于不同的目的。\n\n- **捆绑服务 API**：用于向 OPA 发送策略数据。OPA 不断轮询 Bundle 服务 API，搜索新版本的策略。一旦发现，它就拉取并应用新的版本。\n- **状态服务 API**：用于确定服务的状态。它告诉你当前在 OPA 上激活的策略版本。\n- **决策日志服务 API**：每当 OPA 做出一个策略决策，它都会记录下来。后来，它把这些日志的批次发送到日志服务 API。这对于审计和故障排除特别有用。\n- **构建、测试和调试策略的工具** ：一组命令行工具，你可以使用，如 opa test、opa run、opa check 等。还有一个 [VS Code 插件](https:\/\/marketplace.visualstudio.com\/items?itemName=tsandall.opa)，可以方便开发。\n\n## 初试 OPA 策略\n\n到现在为止，你应该对 OPA 诞生的原因，它试图解决的问题，以及它的设计和管理方式有了相当清晰的认识。现在是试水的时候了，看看用 Rego 语言创建一个策略是什么样子。第一步是用简单的英语定义你的策略。比如说：“客户应该能够查看自己的付款。财务部门的工作人员应该能够查看任何客户的付款。”\n\n下一步是将策略转换为 Rego 代码。我们可以使用 [Rego playground](https:\/\/play.openpolicyagent.org\/) 来做这件事。因此，在主面板中，清除那里已经添加的代码，并添加以下内容。\n\n\u0060\u0060\u0060\npackage play\n\n# Customers should be able to view their own payments\nallow = true {\n\tinput.method = \u0022GET\u0022\n      input.path = [\u0022payments\u0022, customer_id]\n      input.user = customer_id\n}\n\u0060\u0060\u0060\n\n让我们逐行回顾这个片段。\n\n1. 任何以哈希符号（#）开头的行都是注释。把你的策略应该做的事情写成连贯的、可供人类阅读的注释，总是一个好的做法。\n2. allow = true 意味着如果以下的“评估“为真，决策将被允许。\n3. 输入方法是 GET。任何其他 HTTP 方法（POST、PUT 等）都会违反策略。\n4. 路径是 \u0060\/payments\/customer_id\u0060。注意，customer_id 没有加引号，这意味着它是一个变量，需要在调用时被替换。\n5. 用户也应该是 customer_id。\n\n如果我们把这段代码翻译成普通英语，它看起来就像这样。\n\n“如果请求使用的方法是 GET，路径是 \u0060\/payments\/customer_id\u0060，并且用户是同一个 customer_id，则允许该请求。这实际上允许客户查看自己的支付数据。”\n\nRego playground 还允许你评估你的代码，并确保该策略将按预期工作。在 INPUT 面板中，我们可以通过添加以下代码来伪造一个合法请求。\n\n\u0060\u0060\u0060json\n{\n    \u0022method\u0022: \u0022GET\u0022,\n    \u0022path\u0022: [\u0022payments\u0022,\u0022bob\u0022],\n    \u0022user\u0022: \u0022bob\u0022\n}\n\u0060\u0060\u0060\n\n注意，INPUT 使用的是任意的 JSON。在提供请求时，没有特定的规则可以遵循。现在，让我们看看 OPA 将如何通过按下 Evaluate 按钮来响应这个决策请求。OUTPUT 面板应该显示如下内容。\n\n\u0060\u0060\u0060json\n{\n    \u0022allow\u0022: true\n}\n\u0060\u0060\u0060\n\n下面是执行上述步骤后的 playground 截图。\n\n![](008i3skNly1gryelon0ufj318g0epabz.jpg)\n\n现在，让我们试着把请求中的用户改为 alice，这意味着一个客户正试图查看另一个客户的付款。如果我们按 Evaluate 键，你会发现输出显示一个空的 JSON 对象 {}。原因是，OPA 不知道当策略不匹配时应该发送什么。要改变这种行为，在策略的主体前添加以下语句。\n\n\u0060\u0060\u0060\ndefault allow = false\n\u0060\u0060\u0060\n\n因此，整个策略应该是这样的。\n\n\u0060\u0060\u0060\npackage play\n\n# Customers should be able to view their own payments\ndefault allow = false\nallow = true {\n\tinput.method = \u0022GET\u0022\n      input.path = [\u0022payments\u0022, customer_id]\n      input.user = customer_id\n}\n\u0060\u0060\u0060\n\n现在，如果你按下 Evaluate，你会看到预期的输出。\n\n\u0060\u0060\u0060json\n{\n    \u0022allow\u0022: false\n}\n\u0060\u0060\u0060\n\n请注意，这个 playground 非常强大，你可以选择策略的一部分，并独立于策略的其他部分进行评估。当你有一个复杂的策略，当它不应该被评估为假时，这可能是超级有用的。在这种情况下，你可以选择策略的部分内容，看看到底哪里出现了缺陷。\n\n好了，现在我们已经执行了策略的第一部分，让我们继续第二部分：财务部门的工作人员应该能够查看任何客户的付款。\n\n在我们之前定义的策略后面添加以下几行。\n\n财务部门的工作人员可以查看任何客户的付款。\n\n\u0060\u0060\u0060\nallow = true {\n    input.method = \u0022GET\u0022\n    input.path = [\u0022payments\u0022, customer_id]\n    finance[input.user]\n}\n\nfinance = {\u0022john\u0022,\u0022mary\u0022,\u0022peter\u0022,\u0022vivian\u0022}\n\u0060\u0060\u0060\n\n这个策略的大部分内容与之前的相似，除了第 4 行。我们不是评估用户 ID 是否与客户 ID 相同，而是评估用户是否是财务 JSON 对象的一部分。Rego 有很多内置结构，允许你做很多有用的事情，包括查找。最后，我们定义财务对象并添加在该组中工作的员工的用户名。在现实世界中，这个 JSON 对象将作为 INPUT 请求的一部分或作为一个标记传递。现在，让我们通过将用户和客户设置为相同的名字（例如，Bob）来测试该策略。该策略应该返回 true。将用户改为 john（他是财务部门的一部分），并测试该策略。同样，它应该返回真。最后，将用户改为不在财务部门工作的任何名字（比方说，jane），该策略应该返回错误。\n\n你可以参考[官方文档](https:\/\/www.openpolicyagent.org\/docs\/latest\/policy-language\/)，阅读更多关于 Rego 语言和你能用它做什么。\n\n## 将 OPA 与其他系统集成\n\n如前所述，OPA 可以与当今的许多平台集成。让我们来看看 OPA 可以为你做什么的几个例子。\n\n**Kubernetes**\n\n- 确保入口主机名只由前端团队改变。\n- 拒绝拉取任何镜像，除了来自企业 Docker 注册中心的镜像。\n- 对集群上创建的任何 pod 强制使用请求和限制。\n\n**API 授权**\n\n你可以将 OPA 与 Envoy、Istio 和其他平台一起使用，强制执行 IAM 控制。例如，你可以轻松控制安全人员对敏感数据的访问。\n\n**Linux PAM**\n\n可插拔认证模块（PAM）长期以来一直被用于 Linux，为包括 SSH 和 sudo 在内的多种服务提供细粒度的控制。OPA 有一个 PAM 插件，使其能够与 PAM 集成并执行策略。例如，你可以限制 SSH 对你的生产机器的访问，除非在非工作时间，或者除非用户有一个支持工单。\n\n还有许多其他产品可以与 OPA 集成，提供无穷的可能性。例如，Kafka、ElasticSearch、SQLite 和 CEPH，仅举几例。\n\n## 概要总结\n\n- 对授权的需求和软件本身一样古老。\n- 由于缺乏一个可以在不同系统和平台之间使用的中央授权系统，导致了许多问题。例如，API 可能有自己的授权逻辑内置于代码中，其他微服务可能依赖于一个或多个外部授权系统。这使得推出新的策略，检查现有策略的版本，甚至引入小的变化都是非常具有挑战性的操作。\n- OPA 就像一个服务顾问，为需要的服务做出授权决策。服务向 OPA 提出决策查询，然后 OPA 根据已经存储在其中的策略审查查询，并作出决策回应。\n- OPA 的设计是通用的，与平台无关。因此，在发送查询或定义输出的样子时，你不需要遵循任何规则。请求和响应是以 JSON 格式发送的。\n- 策略可以用 Rego 编写，这是一种专门为 OPA 设计的语言。类似于 JavaScript，OPA 使其非常容易将纯英语规则转换为有效的 OPA 策略。\n- Rego playground 工具是一个很好的方法，可以在实施策略之前尝试你的策略。\n- OPA 可以作为 Go 库部署，成为应用程序二进制的一部分，也可以作为独立的守护程序。\n- 由于策略决策发生在每个 API 请求中，强烈建议将 OPA 守护程序尽可能紧密地放在应用程序中。例如，作为 Kubernetes pod 中的一个 sidecar 容器，或者作为一个运行在节点上的守护程序。这种做法有助于减少延迟和减少网络流量。\n- OPA 使用了许多 API，可以很容易地注入新策略，检查现有策略的版本和状态，或收集审计和日志数据。\n- 在这篇文章中，我们看了一个简单的演示，即如何使用 Rego 语言来执行一个策略。在这个例子中，我们展示了通过 Rego 语言和 playground 工具来执行一个复杂的策略并对其进行测试是多么容易。\n- OPA 可以与许多现代的系统和平台集成，如 Kubernetes、Kafka、SQLite、CEPH 和 Terraform。通过 PAM 插件，它还可以与 Linux PAM 集成，对使用 PAM 的 Linux 守护进程（如 sshd 和 sudo）实施高级策略控制。\n', '\/trans\/introducing-policy-as-code-the-open-policy-agent-opa\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文将带你初步了解开放策略代理 OPA，一个平台无关的策略执行工具。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/community-marketing-why-we-need-go-to-community-not-just-go-to-market/">[译] 社区不等于营销——为什么我们要社区化，而不仅是市场化？</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/06/18</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e4%b8%9a%e6%80%81"> 
             业态
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('社区不等于营销——为什么我们要社区化，而不仅是市场化？', '社区是新的护城河，市场化（GTM）和社区化（GTC）战略中激励机制的关键区别可以概括为价值获取与价值创造之间的区别。', '\n## 译者注\n\n本文作者 [Patrick Woods](https:\/\/twitter.com\/patrickjwoods) 是 Orbit 公司的创始人和 CEO。[Orbit](https:\/\/orbit.love\/) 是一个 SaaS 服务，可以为你的社区提供任务控制，在任何平台上发展和衡量你的社区。\n\n## 前言\n\n[有人说](https:\/\/twitter.com\/firstround\/status\/1207335261685702656)社区是新的[护城河](https:\/\/a16z.com\/2016\/03\/07\/network-effects_critical-mass\/)，这是真的：拥有一个社区有助于防止竞争对手的公司或产品进入你的领域。无论这个社区是一群强大的用户、开源贡献者、创造者，甚至只是一个品牌（或特许经营）的超级粉丝，它都能带来更大的品牌知名度、更高的转换成本和规模经济。\n\n在今天的市场上，买家有无尽的选择，所以公司不能只依靠功能和价格来赢得商业。这就是为什么像 Figma、Lululemon、Salesforce、Sephora 和 Twilio 这样的公司 —— 从开发者平台和 CRM 到消费者品牌 —— 都把社区放在他们战略的首位。还有无数其他公司的例子，他们也有社区，即使他们还没有积极地参与其中。\n\n不过，社区的好处不仅仅是捍卫自己的行业地位。在当今[软件](https:\/\/orbit.love\/blog\/software-is-no-longer-sold-its-adopted)不再被出售，而是被采用的世界里，比以往任何时候都有更多的公司正在拥抱他们以前所忽视的客户、贡献者和粉丝。但是，虽然他们中的一些人确实认识到了社区在他们的 Go To Market（市场化，下文中简称 \u0060GTM\u0060）中的重要性，但我在这里要更进一步，认为他们需要一种相关但不同的能力：Go To Community（社区化，下文中简称 \u0060GTC\u0060）。\n\n在我与早期 B2B 公司、大型开源项目和全球消费者品牌的领导人进行的数百次对话中，所有试图定义或建立社区项目的人都清楚，通往社区的道路充满了危险。投资不足，缺乏内部协调，以及对社区本质的误解，导致许多公司在尝试了社区项目后又迅速关闭。但我所看到的最大挑战是，他们缺少一个 GTC 的战略。太多关于社区的讨论都集中在高层次的概念（如移情和归属感）或社区管理的战术方面（如职位或渠道）。\n\n那么，当我们考虑到 GTC，并使社区成为公司的一流能力时，会发生什么变化？\n\n## 什么是社区？\n\n“自下而上“的市场策略和以产品为主导的增长正在改变游戏规则，迫使企业在销售和其他方面重新思考以漏斗为重点的传统流程。在过去的世界里，软件工具被强加给没有什么发言权的工人，而在这个世界里，购买力已经分散；用户对工作产品的期望和对个人应用的期望一样高；付费墙和“给我们打电话“的定价已经被试用、免费层级和自助服务所取代。\n\n那么，社区的作用在哪里？强大的 GTC 能力不仅可以帮助公司在这个新环境中积极主动地竞争，而且还可以提供框架和工具，从自上而下转向自下而上。GTC 有助于建立超越销售的正和关系。也许最重要的是，它将社区的概念从纯粹的以公司为中心和交易性的东西（例如，“有利于转移支持票”）提升到影响组织的每个部分。\n\n换句话说，社区可以成为整个企业的力量倍增器。\n\n但首先，我说的“社区”是什么意思？这个词可以有很多含义 —— 一个支持论坛、一个网络小组、一个开源项目，甚至一个体育迷的部落都可以被视为社区。一个更有用的分类法是将社区分为以下几种：\n\n- **产品社区** ：这些社区的成员主要专注于讨论和学习特定的产品，比如丝芙兰的 [Beauty Insiders](https:\/\/community.sephora.com\/)，Twilio 的 [Champions](https:\/\/www.twilio.com\/champions) 计划，或者 Salesforce 的 [Trailblazers](https:\/\/trailblazers.salesforce.com\/)。\n- **实践社区** ：成员都是为了提高一个学科或工艺的水平，并与其他从业者联系，不受任何工具或平台影响。这方面的例子包括基于群组的学习社区 [On Deck](https:\/\/www.beondeck.com\/)，或设计社区，如 [Dribbble](https:\/\/dribbble.com\/)。\n- **游戏社区**：这一类的成员围绕共同的兴趣走到一起，如体育、游戏、竞技、艺术等等。可以想想 Discord 上的游戏社区，或 NBA 顶级球星。\n\n我们还可以更多不同的社区划分，但上述划分的关键[区别](https:\/\/orbit.love\/blog\/classifying-communities-with-the-3ps-product-practice-and-play)是什么激励了社区成员？这个问题涉及到社区聚集的核心原因，这种理解将影响公司与这些社区成员的互动方式。请注意，他们互动或聚集的具体渠道 —— 论坛、Facebook 群组、个人聚会、Slack 群组，这些都没有社区的基本动机重要。渠道本身只是社区聚会地点的一种战术表现。\n\n还有一个方面是你信任谁，Corinne Riley 将其[区分](https:\/\/corinneriley.medium.com\/community-led-growth-the-product-led-growth-expansion-pack-b474ab9a7940)为在寻求指导或作出决定时信任销售人员（在销售驱动的世界中）、信任自己（在产品主导的世界中）或信任同行 \/ 朋友的社区（在社区主导的成长世界中）。正如我们将看到的，建立信任是 GTC 的一个基本要素。\n\n我在这篇文章中提供的大多数思维方式都集中在围绕特定公司或品牌形成的、与之相关的或由其赞助的社区。这些社区往往融合了产品和实践社区的动机 —— 你可以想象 Photoshop 社区的成员讨论 Photoshop 本身，以及设计趋势和原则，但下面分享的思维方式也可以帮助其他类型的社区。\n\n## GTC vs GTM—— 对社区化和市场化的关注\n\n每个企业都有一个 GTM 的战略，以指导他们的细分市场、目标定位、定价和包装、分销等等，他们的 GTM，从字面上看是这样的，然而，当涉及到他们公司的社区战略时，他们却没有采用任何接近这种水平的严格和纪律…… 即使上述社区对他们的业务至关重要。\n\n很多时候，公司把社区看作是一个很好的东西，是 GTM 工作的一个附加部分。在这种方法中，社区项目不是被提升到一个具有独特影响力的角色，而是经常被其他团队的目标所收编，并被期望影响核心业务成果。但是，商业指标的视角并不是看待社区成功的最好或唯一的方式。\n\n对于试图建立社区的公司来说，这是一个太过常见的失败案例。当公司把他们对社区活动的概念限制在“漏斗顶部 \u0022 时 —— 我经常听到“社区 = 营销”，这意味着衡量社区成功的唯一方法是通过产生的线索或驱动的意识等指标，尽管其影响远远超出这些。我认为人们真正的意思是，“有时社区经理坐在营销部门里面，他们的活动看起来就像其他的意识生成战术”。\n\n它们在外表上看起来很相似，但社区和营销有不同的投入和产出。这就是为什么 GTC 的战略和战术应该被看作是它自己的系统，有它自己的过程、结果和不同于“走向市场“战略的激励机制。通过区分经典的 GTM 和 GTC 的概念，企业领导人不仅可以更准确地推理出社区在公司整体战略中的作用，还可以更有意识地界定哪些团队在为哪些成果而努力。\n\n例如，优化销售线索流程（在 GTM 项目中很典型）与举办聚会和创建教育内容（在 GTC 项目中很关键）是完全不同的 —— 然而今天，这些活动往往被归入同一个团队和战略，导致出现这样的情况：收入主管可以为聚会项目定义目标，或者公司将社区经理雇用到营销组织中，然后根据该团队中其他人的目标来衡量他们的成功。这些都是常见的失败模式。\n\nGTC 的结果需要通过社区本身的增长和保留来衡量，也需要通过不太明显但同样重要的品质来衡量，比如新关系的数量，发展的信任度，甚至是自我实现的程度。激励措施是一切的基础；“给我看激励措施，我就给你看结果”（引用查理・芒格的话）。**GTM 和 GTC 战略中激励机制的关键区别可以概括为价值获取与价值创造之间的区别。**\n\n这一切的逻辑含义是，GTC 和 GTM 之间的关系是协同的，而不是同义的。社区必须被视为一个独立的组织实体，有自己的举措和自己的人。但是，在社区和公司的其他部分之间也需要有可渗透的边界，这样社区就不会自生自灭，孤立无援，与业务没有联系。\n\n## 从漏斗到中心\n\n经典的“漏斗”比喻定义了大多数 GTM 的策略。它专注于优化流程的每一步 —— 从认识和发现到评估、参与、转换 \/ 销售、忠诚度和宣传 —— 通过线性推送线索，在每个阶段提取价值。另一方面，社区并不是要把人们推向一个二元的终点，而是要创造一个非常有吸引力的环境，自然地吸引人们走向它的中心。\n\n换句话说，健康和活跃的社区有**引力**一个“高引力 \u0022 的社区是一个擅长吸引和保留社区成员的社区。社区战略是帮助建立和维持这种引力，同时将利益与公司目标联系起来。而且，对公司来说，有各种各样的好处。\n\n## 社区资产可以帮助推动认知、采用和留存\n\n社区现在是”[新的售前](https:\/\/orbit.love\/blog\/community-is-the-new-presales)\u0022。更多的非雇员愿意在你的博客上发表客座文章，导致更多的思想领导力材料，从而推动知名度的提高。在社会上，现有用户与潜在用户交谈，导致有机的自我鉴定和异议处理，从而影响到用户的获取。如果你的社区有一个论坛，你的产品的用户以及潜在用户都聚集在这里，他们会自然地分享想法和最佳实践，有经验的用户会向新用户伸出援手。在这种情况下，成功的用户与陷入困境的用户交谈，导致了社区主导的支持讨论，这反过来又导致了产品采用和保留的改善。\n\n因此，一个参与社区的产出是对以产品为主导的 GTM 的完美补充。\n\n这里还有一个单独但相关的好处：增加社区成员和公司员工之间的信任。当员工围绕着为社区创造价值而保持一致时，他们就可以把精力放在正和互动上，做对每个人最有利的事情，而不是像产生的线索这样的目标。社区经理的角色是倾听、学习和联系成员，有时，适当的经验是介绍给销售人员。当时间到了，信任也建立起来了，这个潜在客户就会进入漏斗，与另一个线索来源相比，它更有资格，也更晚进入。\n\n## 社区可以降低 GTM 战略的风险\n\n社区中出现的对话、内容和联系，揭示了对他们来说什么是重要的，他们在什么地方挣扎，他们需要什么来取得成功，以及在他们的世界中什么是重要的。如果你关注社区并与社区中的人交谈，你就会有一个明确的观点，可以使你公司中的其他人有能力以坚定和清晰的方式行事。\n\n**但关键是将这些洞察力真正反馈到公司。** GTC 战略有助于将这些洞察力从社区反馈给产品、市场和销售团队。更好的是，这些见解是由社区更“自然的声音”提供的 —— 相比之下，沮丧的支持对话或通过礼品卡激励客户提供的反馈是有偏差的。这类似于评论，在那里只有讨厌的人或其他高度积极的人留下评论，而沉默的大多数人什么都不说。\n\n与更正式的反馈项目相比，社区的学习在整体上将更加频繁和一致，允许公司在扩大有效的想法和方法之前快速迭代。\n\n## 社区战略可以帮助团队调整\n\n社区战略有助于调整团队，因为它使组织的优先事项和谁拥有什么变得清晰 —— 谁在从事价值获取，谁在从事价值创造？今天，营销团队可能会有一些人同时从事这两方面的工作，这可能会导致活动与预期影响之间的不匹配。\n\n当每个人都对利害关系怀有不同的基本假设时，就很难定义成功。例如，你不会要求客户经理花时间在论坛上与社区成员聊天，因为他们应该专注于完成交易和获取价值。然而，有人问社区经理或开发者倡导者这样的问题并不罕见，“我们从昨晚的聚会中得到了多少线索？”这个人是在问一个关于价值创造活动的价值获取问题。\n\n## 要引金凤凰，先栽梧桐树\n\n正如我们所看到的，从一个充满活力的社区中产生的对话、内容和联系往往会导致认识的提高、采用、自我鉴定、保留，以及最终为公司带来收入。\n\n这一切听起来很好，但重要的是要注意，这些类型的结果只是建立一个高引力社区的二阶效应。你不能只是把收入、营销或产品指标直接与你的社区战略联系起来。相反，目标是培养和促进社区成员之间富有成效的讨论，创造价值，并了解这些活动对该业务的二阶影响。\n\n换句话说，你不能强迫一朵花生长，但你可以为其生长创造理想的环境。\n\n现在有人会问，为什么我们甚至需要 GTC？我们就不能叫它“社区”吗？\n\n社区这个词的挑战在于其广泛的范围。Kubernetes 和我当地的跑步俱乐部都可以被称为社区，但它们只是在最抽象的方面相似，这就是为什么我认为我们需要一个重新规划。GTC 的概念和术语（向 [Sam Ramji](https:\/\/twitter.com\/sramji) 致敬，他是我的早期天使投资人之一，是他发明了这个短语）是有用的，有以下几个原因。\n\n- 它借用了人们已经熟悉的 GTM 概念，并以商业影响为框架进行社区讨论。从历史上看，大多数社区团队都在努力争取预算和权力，解决社区项目资金不足，利用率不高的问题。如果你确信社区可以为你的客户和你的公司带来价值，那么将社区项目提升到 GTC 战略将有助于确定社区的战略重要性，并有助于防止资金不足和缺乏授权的常见失败案例。\n- 它为以前看似不同的想法和团队提供了一个概念性的包装，如社区、内容和活动。那么，社区功能的理想组织结构图的位置是什么？我们还没有看到一个明确的共识，但理想的情况是，社区团队 —— 就像运营部门一样，最好作为一个跨职能的乘数，而不是作为一个垂直的职能领域，在团队之间进行线性交接。\n- 它是精炼和直接的。GTC 是一个全公司都能团结起来的备忘录，甚至包括销售团队。\n\n但 GTC 不仅仅是一个概念；它也是一个将社区纳入战略的路线图。它将“上周论坛产生了多少线索”这样的问题转变为“我们帮助了多少人”这样的问题。同样，**GTC 和 GTM 的关键区别在于对价值创造和价值获取的关注。**\n\n理想情况下，GTC 和 GTM 计划应该相互补充。通过将 GTC 与 GTM 同时明确，并详细描述这两个计划，公司可以减少协调成本，并享受两者的所有好处。\n\n虽然社区建设可能与人类一样古老，但在商业环境中的 GTC 实践相对较新；现代 GTM 已经有几十年的发展和完善，但 GTC 的旅程才刚刚开始。现在还没有什么游戏规则，所以我认为现在讨论它对大家是有帮助的。为了帮助使这个概念更加具体，这里有一些问题，可以围绕 GTC 在你公司的潜力，增加更多的细微差别和严谨性。\n\n- 谁在我们的社区里，他们为什么在这里？谁不在社区里？\n- 我们将为社区创造什么价值，无论他们是否是付费客户？\n- 成员之间将相互提供什么价值？\n- 我们将如何倾听、交谈并接受客户的指导？\n- 我们将如何以及在哪里将这些对话的见解传递给公司的其他部门？\n- 我们将如何激励、认可和奖励参与？\n- 我们将树立什么样的价值观和规范，我们对社区的期望是什么？\n- 我们怎样才能使我们的社区更智能、更快乐、更富有？通过哪些项目，哪些渠道？\n\n基于上述问题，下一步是定义和测试关于 GTC 计划如何影响 GTM 的假设。\n\n- 我们认为活跃的社区成员会比非成员保留 50% 的时间。\n- 我们认为，通过每月产生四篇由社区创建的文章，我们可以将现有博客的产出增加一倍，从而使试用注册人数增加 20%。\n\n假设是一个很好的开始，主要是因为社区应该被理解为复杂的系统，这意味着努力和结果之间的联系可能在很长一段时间内不会显现出来。但是，讨论和辩论这些假设和问题的行为，将使 GTC 和 GTM 团队的目的和影响更加清晰和一致，并使每个人参与到关于如何以不同形式创造价值的创造性讨论中。价值创造的思维方式对企业的每个领域都有影响，对客户、非客户和受众成员都有好处–这就是所有的社区，而社区从开始到结束跨越了客户旅程。\n\n## 非零和世界里的一流能力\n\n我相信公司和客户之间的关系正朝着正和的方向发展，而不是只关注单方面的价值提取。拥有 GTC 战略的公司将更有动力和能力参与这种关系，确保他们为社区提供持续的价值（同时也从二阶上升中受益）。\n\n在一个公司的轨道上，每个人都有好处，而不仅仅是“线索”。通过创造，而不仅仅是获取价值，公司赢得了信任，可以进入这些对话，并与任何对他们所建立的东西感兴趣的人建立关系：现有的客户、潜在的客户，或者只是进来学习新东西的人。通过首先提供价值，这些公司将自己定位为领导者，而不是那些仍然在玩只知获取的零和游戏的公司。\n\n那么，拥有一个 GTC 的战略是否意味着只有公司能从一个活跃的社区中受益？很难说。对社区来说，好消息是，当 GTC 被提升到公司层面的关注时，社区成员自己会看到更多的好处：更多定期和高质量的活动、教育、培训，以及与他人联系的机会。这也意味着社区成员自己更有能力去共同创造他们想要参与的社区和文化。公司也可以提供一个更高质量、更安全、更有活力的社区体验，因为社区团队将获得工具和人员资源，以接纳新成员，调节社区和处理有害行为，并促进成员之间的联系。\n\n这意味着 GTC 需要成为一种一流的能力：有团队、有预算、有工具，并且在领导层的桌子上有一个位置。当公司创造的价值超过他们所获取的价值时，人们就会学习新的东西，认识新的人，并发现新的机会 —— 当然，公司也会享受到这种好处。\n', '\/trans\/community-marketing-why-we-need-go-to-community-not-just-go-to-market\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">社区是新的护城河，市场化（GTM）和社区化（GTC）战略中激励机制的关键区别可以概括为价值获取与价值创造之间的区别。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/cloudera-to-go-private-as-kkr-cdr-grab-it-for-5-3b/">[译] Hadoop 时代或将落幕，Cloudera 将被私有化</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/06/01</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e4%b8%9a%e6%80%81"> 
             业态
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://techcrunch.com/2021/06/01/cloudera-to-go-private-as-kkr-cdr-grab-it-for-5-3b/" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Hadoop 时代或将落幕，Cloudera 将被私有化', '北京时间 6 月 1 日晚，据 TechCrunch 报道，KKR 和 CD\u0026R 将以 53 亿美元收购 Cloudera，Cloudera 将被私有化。', '\n北京时间 6 月 1 日晚，据 [TechCrunch 报道](https:\/\/techcrunch.com\/2021\/06\/01\/cloudera-to-go-private-as-kkr-cdr-grab-it-for-5-3b\/)，KKR 和 CD\u0026R 将以 53 亿美元收购 Cloudera，Cloudera 将被私有化。截止到本文发稿，11 点 49 分，Cloudera 股票报价 15.94 美元，涨幅 23.95%。\n\n![Cloudera 股价](008i3skNly1gr379cnii9j30u01fh1ee.jpg)\n\n[Cloudera](http:\/\/cloudera.com\/)曾经是最热门的 Hadoop 初创公司之一，但是随着时间的推移，这个市场的光芒不再，今天它将被私有化，因为 KKR 和 Clayton Dubilier \u0026 Rice 这两家私募股权公司宣布他们打算以 53 亿美元收购 Cloudera。目前该公司的市值约为 37 亿美元。\n\nCloudera 和 Hortonworks 是 Hadoop 领域的两家重要初创公司，于[2018 年以 52 亿美元的价格合并](https:\/\/techcrunch.com\/2018\/10\/03\/cloudera-and-hortonworks-announce-5-2-billion-merger\/)。Cloudera 可能受到激进投资者 Carl Icahn 的压力，他在 2019 年持有该公司[18% 的股份](https:\/\/siliconangle.com\/2019\/08\/12\/activist-investor-carl-icahn-shakes-cloudera\/)，现在可以从这次出售中获益，该公司表示，每股 16 美元的价格对股东有 24% 的溢价。今早开市前，该公司的股价为 12.86 美元。\n\n早在十年前，当 Hadoop 成为处理大数据的方式时，风险资金就涌入了这个领域。随着时间的推移，它失去了一些光辉。因为它是高度劳动密集型的，公司开始转移到云端，并寻找能为他们做更多工作的软件服务。像数据湖这样的更现代的技术开始取代它，该公司认识到它必须改变其方法以在现代数据处理市场中生存。\n\nCloudera 首席执行官 Rob Bearden 认为这项交易正是实现这一目标的一种方式。\u0022Bearden 在一份声明中说：\u0022我们相信，作为一家拥有 CD\u0026R 和 KKR 等经验丰富的投资者的专业知识和支持的私营公司，Cloudera 将拥有资源和灵活性来推动以产品为主导的增长，并扩大我们的市场机会。\n\n虽然该声明中有很多行政术语，但它基本上意味着该公司希望这些私募股权公司能够给它一些额外的财政资源，以便向处理大量数据的更现代的方法前进。\n\n在此过程中，Cloudera 还宣布了自己的几项收购，以帮助其实现现代化的目标。首先，Cloudera 收购了[Datacoral](https:\/\/techcrunch.com\/2018\/11\/08\/datacoral-raises-10m-series-a-for-its-data-infrastructure-service\/)，这家初创公司将构建数据管道所需的基础设施抽象化，而无需使用代码。它还收购了[Cazena](https:\/\/techcrunch.com\/tag\/cazena\/)，一家帮助客户建立云数据湖的初创公司，为公司提供了处理大数据的更现代的方法。Bearden 认为这两项服务有助于 Cloudera 在大数据自助服务市场上重新定位。\n\n\u0022这两项业务将使我们合并后的客户享受到复杂性的降低和更快的数据计划价值实现时间，从而提高洞察力，加快创新，并与客户和合作伙伴进行更有力的合作，\u0022Bearden 在一份声明中说。\n\nCloudera 在[2018 年上市](https:\/\/techcrunch.com\/2017\/04\/28\/cloudera-finishes-up-20-in-stock-market-debut\/)，在筹集了 10 亿美元后以每股 18.09 美元的价格收盘。其中绝大部分是英特尔资本在 2014 年的[7.4 亿美元的投资](https:\/\/techcrunch.com\/2014\/03\/31\/intel-pours-740m-into-cloudera-in-exchange-for-an-18-stake\/)。值得注意的是，Cloudera 在去年年底以 3.14 亿美元收购了英特尔在该公司的股份。\n\nHortonworks 又筹集了 2.48 亿美元。第三家 Hadoop 创业公司，MapR 筹集了 2.8 亿美元。该公司的资产在 2019 年以低于 5000 万美元的价格相当惨淡地卖给了 HPE，这表明 Hadoop 市场[早已落幕](https:\/\/techcrunch.com\/2019\/08\/07\/with-mapr-fire-sale-hadoops-promise-has-fallen-on-hard-times\/)。\n\nCloudera 的交易包括一个简短的 \u0022go shop\u0022条款，允许它继续寻找一个更好的交易。它是否能找到这样的交易值得怀疑，如果找不到，与 KKR 和 CD\u0026R 的交易预计将在今年下半年完成，但需要经过监管审查。该公司将在今天晚些时候公布收益。\n', '\/trans\/cloudera-to-go-private-as-kkr-cdr-grab-it-for-5-3b\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">北京时间 6 月 1 日晚，据 TechCrunch 报道，KKR 和 CD&amp;R 将以 53 亿美元收购 Cloudera，Cloudera 将被私有化。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/zoom-obs-bilibili-broadcast/">Zoom &#43; OBS &#43; B 站直播配置手册</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/05/25</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e9%9a%8f%e7%ac%94"> 
             随笔
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Zoom \u002b OBS \u002b B 站直播配置手册', '本文将指导你如何配置和使用 OBS \u002b zoom 在 Bilibili 上直播。', '\n今晚我第一次使用 Zoom \u002b OBS 和马若飞在 B 站上进行了[《Istio 大咖说》](https:\/\/space.bilibili.com\/1698576814)栏目的第一期分享——「Istio 开源四周年回顾与展望」。考虑到很多社区、主播、调音台会有在 B 站或其他平台上直播的需求，特别将我的个人经验分享给大家，欢迎大家补充，我会不断优化直播体验。\n\n下图是我直播时桌面的情况，使用的设备有：\n\n- MacBook Pro，这个自不必说\n- USB 麦克风博雅 BY-500，作为音频输入麦克风\n- 海康威视外接摄像头，用作第二机位\n- iPad，作为直播监视器，同时回答观众的弹幕\n- 环形补光灯，直播通常是在晚上，光线太暗需要补光\n- AirPods Pro，用于监听声音的，不作为音频输入\n- 静音蓝牙键盘，防止键盘敲击声音影响直播的声音体验\n- iPhone，用于和直播讲师私下沟通，这样不会被直播出去\n\n以上这些不是全部都需要的，只要你有一台电脑和一个耳机就可以直播。\n\n![我的桌面](desktop.jpg)\n\n上面是直播时的桌面（请忽略我杂乱的被各种设备占满空间的桌面），下面是我的配置参考。\n\n## 硬件准备\n\n- 电脑：macOS、Windows 都可以，我是用的是 Macbook Pro 2016 年产，配置如下：\n\n![系统配置](008i3skNly1gqv0t9gubjj30wk0jiwl1.jpg) \n\n- 外接麦克风：切勿直接使用电脑机身上自带的麦克风，那样会收录电脑风扇的声音，我使用的是博雅 BY-500（400 多块钱）麦克风，电容式麦克风，指向性比较好，基本没有噪音。\n- 摄像头：保证电脑上的摄像头可用，因为会议的时候需要开摄像头，或者用外接摄像头也可以。\n- 网络：确保网速至少 100MB\/s 的宽带，因为推流还是比较占用带宽的，而且还需要同时查看直播效果，对下行带宽也有要求。\n- 另一台可联网设备：用来监控直播效果，可以是手机、iPad 等\n\n## 软件准备\n\n- Zoom：需要 Pro 版，这样才可以举行超过 45 分钟的线上会议，否则会在超时后打断再重新加入，需要准备好账号，中国大陆用户貌似不能再注册？如果没有 zoom，换成其他任何一个会议软件都可以，比如腾讯会议。\n- OBS：用来做推流，到[官网](https:\/\/obsproject.com\/)下载最新的版本。\n- 音频插件 Sunflower：[点击跳转到下载页面](https:\/\/github.com\/mattingalls\/Soundflower\/releases)，如果安装时遇到系统权限问题，请在命令行中执行 \u0060sudo spctl --master-disable\u0060 并在电脑的 \u0060系统首选项\u0060 的 \u0060安全与隐私\u0060 中批准来自任意途径的软件安装，如果看到有详情页面，点击进去批准软件发行商。\n- Bilibili：需要一个 B 站账号，并开通直播间，经过实名认证。\n\n## OBS 配置\n\n下面是在 Macbook 中安装的 OBS 配置截图。\n\n需要注意的是输出、音频和视频的配置。请参考图中的配置，尤其注意编码控制、比特率的配置。\n\n![OBS 输出配置](008i3skNly1gqv0t9tppnj312t0u0gpv.jpg)\n\n![OBS 音频配置](008i3skNly1gqv0tbb4g8j313m0u0jv1.jpg)\n\n请注意分辨率的配置，同时调整电脑屏幕的分辨率为 1440x900，**不要使用太大的分辨率，否则可能导致直播画面黑屏**。\n\n![OBS 视频配置](008i3skNly1gqv0tarnvoj31is0p276g.jpg)\n\n![Macbook 显示配置](008i3skNly1gqv0tbrclhj31140pkjxy.jpg)\n\n## 会议直播\n\n以上场景是仅限于本机画面的直播，还有中场景就是现场会议直播，你还需要录制现场画面，这时候你最好制作一个直播底板，例如下图。\n\n![OBS 直播底板](diban.jpg)\n\n该底板用于布局 PPT 和摄像头画面，同时底板上也包括了活动 logo 和主办方、赞助商信息。该图最好是 PNG 透明的格式，把图片放在布局最上层，这样就能很好地展示布局。\n\n## 音频配置\n\n安装 sunflower 后，在 Midi 设备中创建一个多输出设备，如图。\n\n![MacBook 音频配置](008i3skNly1gqv0ta93jfj31060q0n28.jpg) \n\n选择 Sunflower（2ch）和你想要用来监听系统声音的设备，我是用的是 AirPods，你也可以选择其他耳机，总之不要让麦克风录到这个系统输出的即可。\n\n还要在 OBS 的麦克风配置里增加下新创建的这个输出设备，这样直播的时候就可以收录你的系统，也就是你的耳机听到的声音了，比如在视频会议中，所有人讲话的声音都会被直播出去。\n\n### 使用独立音频硬件\n\n如果安装 sunflower 有问题的话，你也可以购买一款独立的音频设备，要知道一台电脑是可以安装多块声卡的，这些声卡可以通过 USB 接口转接，而且价格都很便宜（只要几十块钱），一旦有了多个声卡，你就可以为不同的音频源选择不同的输出，而且可以对它们的音量进行单独单独控制。例如下面这款 USB 外置声卡（非利益相关），即插即用，不需要安装任何软件。\n\n![USB 外置声卡](ugreen.jpg)\n\n你也可以用 USB 外置声卡来转接其他的无线麦克风，比如我就转接了 Rode Wireless Go（你还需要买一根转接的音频线，红色的那根，用于连接声卡）。\n\n## 多路推流（多渠道同步直播）\n\n因为我们在直播时往往有多个渠道，比如多个 B 站直播间、微信视频号等，如何使用 OBS 同步推流到多个渠道呢？可以使用 [sorayuki\/obs-multi-rtmp](https:\/\/github.com\/sorayuki\/obs-multi-rtmp) 插件（支持 Windows 和 macOS），注意需要将 OBS 升级到最新版本（至少 27.0.1 版本）。安装完插件，重启 OBS 后就可以看到一个窗口新建多路推流，如下图所示。\n\n![OBS 新建多路推流](008i3skNly1gu39v42dlkj60ia0hl0tj02.jpg)\n\n如果没有看到该窗口，请点击【视图】-【停靠部件】-【多路推流】即可显示。\n\n![OBS 多路推流选项](008i3skNly1gu39u3zpknj60f3096gmh02.jpg)\n\n## 直播效果\n\n下面是当晚直播的 zoom 录制的视频直出，已上传到 [B 站](https:\/\/www.bilibili.com\/video\/BV1jK4y1R7Tk)，大家可以感受下画面的清晰度还有声音效果，我还是比较满意的。\n\n![Bilibili](bilibili.jpg)\n\n其中只有几个小插曲：\n\n- 因为我是用的是 AirPods 蓝牙耳机，戴上耳机的时候我无法确定它要连那个设备（我有两个 iPhone、1 个 iPad、1 个 MacBook 都有可能被脸上）活动开始的时候总是连不上 MacBook，一气之下把其他的苹果设备的蓝牙全关掉，只留下 MacBook 的蓝牙开启，这样可以保证连上 MacBook\n- 说话的时候忘记了把麦克风静音了\n- 直播大概进行了 1 个小时的时候，zoom 突然断开了 10 几秒钟后又自动重连，总体来说 zoom 会议还是比较稳定的，1 个小时左右的会议应该不会断连\n\n## 直播开始前的检查\n\n- 电脑屏幕分辨率调整为 1440 x 900\n- 关闭与直播无关的 APP，减少系统资源占用\n- 电脑设置为勿扰模式\n- 使用外接麦克风，切勿直接使用电脑内置的麦克风，会收录风扇及键盘杂音，影响音质\n- 使用外接耳机，如 AirPods\n- 音频输出调整为多设备输出，其中包括 Sunflower（2ch）和耳机\n- Zoom 会议开始前记得点击录像\n- 会议开始后检查 B 站直播间，确保声音和画质没有问题\n- OBS 推流的时候不用录像，因为 zoom 已经在录了\n- 直播完成后检查 zoom 生成的视频文件并备份\n\n## 优化项\n\n直接直播屏幕内容也会造成多重布局的问题，以上方案还是有可优化的地方。比如将视频会议中的共享桌面与摄像头画面分开布局到 OBS 上。\n\n## 最后\n\n直播是除了在线下面对面交流以外，可以跟社区及开源爱好者交流最直接最友好的方式，我会时常发起，感谢大家的关注我主持的直播间：\n\n- [云原生社区](https:\/\/live.bilibili.com\/22230973)\n- [Istio Service Mesh](https:\/\/live.bilibili.com\/23095515)\n\n关注上面的 B 站账号，获取直播推送提醒。关于 B 站直播，如果你有任何问题或者建议请在下面留言。\n', '\/blog\/zoom-obs-bilibili-broadcast\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文将指导你如何配置和使用 OBS &#43; zoom 在 Bilibili 上直播。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/istio-4-year-birthday/">Istio 开源四周年回顾与展望</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/05/24</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Istio 开源四周年回顾与展望', '今天是 Istio 开源四周年，让我们一起来回顾一下 Istio 四年来的发展并展望一下它的未来。', '\nIstio 是由 [Tetrate](https:\/\/tetrate.io\/) 创始人 Varun Talwar 和谷歌首席工程师 Louis Ryan 命名并在 2017 年 5 月 24 日开源。今天是 Istio 开源四周年，让我们一起来回顾一下 Istio 四年来的发展并展望一下它的未来。\n\n## Istio 的开源历史\n\n2017 年是 Kubernetes 结束容器编排之战的一年，Google 为了巩固在云原生领域的优势，并弥补 Kubernetes 在服务间流量管理方面的劣势，趁势开源了 Istio。下面是截止目前 Istio 历史上最重要的几次版本发布。\n\n| **日期**   | 版本 | 说明                                                         |\n| ---------- | ---- | ------------------------------------------------------------ |\n| 2017-05-24 | 0.1  | 正式开源，该版本发布时仅一个命令行工具。确立了功能范围和 sidecar 部署模式，确立的 Envoy 作为默认 sidecar proxy 的地位。 |\n| 2017-10-10 | 0.2  | 支持多运行时环境，如虚拟机。                                 |\n| 2018-06-01 | 0.8  | API 重构。                                                   |\n| 2018-07-31 | 1.0  | 生产就绪，此后 Istio 团队被大规模重组。                      |\n| 2019-03-19 | 1.1  | 企业就绪，支持多 Kubernetes 集群，性能优化。                 |\n| 2020-03-03 | 1.5  | 回归单体架构，支持 WebAssembly 扩展，使得 Istio 的生态更加强大。 |\n| 2020-11-18 | 1.8  | 正式放弃 Mixer，进一步完善对虚拟机的支持。                   |\n\nIstio 开源后经过了一年时间的发展，在 1.0 发布的前两个月发布了 0.8 版本，这是对 API 的一次大规模重构。而在 2018 年 7 月底发布 1.0 时，Istio 达到了生产可用的临界点，此后 Google 对 Istio 团队进行了大规模重组，多家以 Istio 为基础的 Service Mesh [创业公司](https:\/\/istio.io\/latest\/about\/ecosystem\/#providers)诞生，可以说 2018 年是服务网格行业诞生的元年。\n\n2019 年 3 月 Istio 1.1 发布，而这距离 1.0 发布已经过去了近 9 个月，这已经远远超出一个开源项目的平均发布周期。我们知道迭代和进化速度是基础软件的核心竞争力，此后 Istio 开始以每个季度一个版本的固定[发布节奏](https:\/\/istio.io\/v1.7\/about\/release-cadence\/)，并在 2019 年成为了 [GitHub 增长最快的十大项目中排名第 4 名](https:\/\/octoverse.github.com\/#fastest-growing-oss-projects-by-contributors)！\n\n## Istio 社区\n\nIstio 开源四年来，已经在 GitHub 上收获了 2.7 万颗星，获得了大量的[社区用户](https:\/\/istio.io\/latest\/about\/case-studies\/)。下图是 [Istio](https:\/\/github.com\/istio\/istio) 的 GitHub star 数增长情况。\n\n![](008i3skNly1gqtm7n2hm1j31me0n2tag.jpg)\n\n2020 年 Istio 的项目管理开始走向成熟，治理方式也到了进化的阶段。2020 年，Istio 社区进行了第一次[管委会选举](https:\/\/istio.io\/latest\/blog\/2020\/steering-election-results\/)，还把商标转让给了 [Open Usage Commons](https:\/\/istio.io\/latest\/blog\/2020\/open-usage\/)。首届 [IstioCon](https:\/\/events.istio.io\/istiocon-2021\/) 在 2021 年 2 月份成功举办，几千人参加了线上会议。在中国也有大量的 Istio 社区用户，2021 年也会有线下面对面的 Istio 社区 meetup 在中国举办。\n\n![](008i3skNly1gquicfqg14j31lw0smwl2.jpg)\n\n根据 CNCF 2020 年调查，46% 的组织在生产中使用服务网格或计划在未来 12 个月内使用。Istio 是在生产中使用的最多的网格。\n\n## 未来\n\n经过 4 年的发展，围绕 Istio 不仅形成了庞大的用户群，还诞生了多家 Istio 供应商，你可以在最近改版的 [Istio 的官网首页](https:\/\/istio.io)中看到。在最近几个版本中，Istio 已经将发展中心转移到了提升 Day 2 Operation 体验上来了。我们还希望看到更多的 Istio 的采纳路径建议、案例研究、学习资料、培训及认证（例如来自 Tetrate 的业界的第一个 [Istio 管理员认证](https:\/\/academy.tetrate.io\/courses\/certified-istio-administrator)），这些都将有利于 Istio 的推广和采用。\n', '\/blog\/istio-4-year-birthday\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">今天是 Istio 开源四周年，让我们一起来回顾一下 Istio 四年来的发展并展望一下它的未来。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/what-is-istio-and-why-does-kubernetes-need-it/">什么是 Istio？为什么 Kubernetes 需要 Istio？</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/04/28</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('什么是 Istio？为什么 Kubernetes 需要 Istio？', '本文将解释 Istio 是如何产生的，以及它与 Kubernetes 的关系。', '\nIstio 是当前[最流行的服务网格实现](https:\/\/www.cncf.io\/blog\/2020\/03\/04\/2019-cncf-survey-results-are-here-deployments-are-growing-in-size-and-speed-as-cloud-native-adoption-becomes-mainstream\/)，它是在 Kubernetes 的基础上开发的，它跟 Kubernetes 在云原生应用的生态中拥有着不同的定位。本文不是直接为你介绍 Istio 具有哪些功能，而是先向你介绍 Istio 诞生的历史条件，然后带你从 Kubernetes 与 Istio 的分工开始，了解什么是 Istio。\n\n要想解释什么是 Istio，还得先了解 Istio 是在什么样的情况下出现的——即为什么会有 Istio？\n\n容器作为云原生应用的交付物，既解决了环境一致性的问题，又可以更细粒度的限制应用资源，但是随着微服务和 DevOps 的流行，容器作为微服务的载体得以广泛应用。2014 年，Google 开源了 Kubernetes，随后几年得到迅猛发展，在 2017 年奠定了容器编排调度标准的地位。Kubernetes 作为一种容器编排调度工具，解决了分布式应用程序的部署和调度问题。因为一台单机的资源有限，而互联网应用可能因为用户规模的急速扩张，或用户属性的不同在不同时间段会出现流量洪峰，因此对计算资源的弹性要求比较高。而一台单机显然无法满足一个如何规模庞大的应用，反之，对于一个规模很小的应用也没必要占用整台主机，那将导致巨大的浪费。\n\n简而言之，Kubernetes 定义服务的最终状态，并使系统自动地达到和维持在该状态。那么在应用部署完成后，如何管理服务上的流量呢？下面我们将看下 Kubernetes 中如何做服务管理，及在 Istio 中的变化。\n\n## Kubernetes 中如何做服务管理？\n\n下图展示的是 Kubernetes 中的服务模型。\n\n![Kubernetes 服务模型](service-model.jpg)\n\n从上图中我们可以看出：\n\n- 同一个服务的的不同示例可能被调度到不同的节点上；\n- Kubernetes 通过 Service 对象将一个服务的多个实例组合在了一起，统一对外服务；\n- Kubernetes 在每个 node 中安装了 \u0060kube-proxy\u0060  组件来转发流量，它拥有的简单的负载均衡功能；\n- Kubernetes 集群外部流量可以通过 Ingress 进入集群中（Kubernetes 还有其他几种暴露服务的方式，如 NodePort、LoadBalancer 等）；\n\nKubernetes 是用于资源集约管理的工具。但在为应用分配好资源后，如何保证应用的健壮性、冗余性，如何实现更细粒度的流量划分（不是根据服务中实例个数来实现），如何保障服务的安全性，如何进行多集群管理等，这些问题 Kubernetes 都不能很好地解决。\n\n服务具有多个版本，需要迭代和上线，在新版发布的时候需要切分流量，实现金丝雀发布；同时我们应该假定服务是不可靠的，可能因为各种原因导致请求失败，需要面向失败来编程，如何监控应用程序的指标，了解每个请求的耗时和状态？Istio 的发起这们就想到了在每个 pod 中注入一个代理，将代理的配置通过一个控制平面集中分发，然后将从 pod 中应用容器发起的每个请求都劫持到 sidecar 代理中，然后转发，这样不就可以完美的解决以上问题了吗？Kubernetes 优秀的架构和可扩展性，例如 CRD，pod 内的部署模式，可以完美的解决大量 sidecar 的注入和管理问题，使得 Istio 的实现成为可能。\n\n## Istio 的基本原理\n\n下图是 Istio 中的服务模型，它既可以支持 Kubernetes 中的工作负载，又可以支持虚拟机。\n\n![Istio](istio.jpg)\n\n从图中我们可以看出：\n\n- Istiod 作为控制平面，将配置下发给所有的 sidecar proxy 和 gateway（为了美观，图中没有画 Istiod 及 sidecar 之间的连接）\n- Istio 不再使用 \u0060kube-proxy\u0060 组件做流量转发，而是依托在每个 pod 中注入的 sidecar proxy，所有的 proxy 组成了 Istio 的数据平面；\n- 应用程序管理员可以和管理 Kubernetes 中的工作负载一样，通过声明式 API 操作 Istio mesh 中流量的行为；\n- Ingress 被 Gateway 资源所替代，Gateway 是一种特殊的 proxy，实际上也是复用的 Sidecar proxy；\n- 可以在虚拟机中安装 sidecar proxy，将虚拟机引入的 Istio mesh 中；\n\n实际上在 Istio 之前，人们可以使用 SpringCloud、Netflix OSS 等，通过在应用程序中集成 SDK，编程的方式来管理应用程序中的流量。但是这通常会有编程语言限制，而且在 SDK 升级的时候，需要修改代码并重新上线应用，会增大人力负担。Istio 使得流量管理变得对应用程序透明，使这部分功能从应用程序中转移到了平台层，成为了云原生基础设施。\n\n正是因为 Istio 补足了 Kubernetes 对于云原生应用的流量管理、可观测性和安全方面的短板，在 2017 年由 Google、IBM 和 Lyft 共同发起的这个服务网格开源项目，并在三年来取得了长足的发展。关于 Istio 核心功能的介绍可以参考 [Istio 文档](https:\/\/istio.io\/latest\/docs\/concepts\/what-is-istio\/)。\n\n## 总结\n\n- Service Mesh 相当于云原生时代的 TCP\/IP，解决应用程序网络通信、安全及可见性问题；\n- Istio 是目前最流行的 service mesh 实现，依托于 Kubernetes，但也可以扩展到虚拟机负载；\n- Istio 的核心由控制平面和数据平面组成，Envoy 是默认的数据平面代理；\n- Istio 作为云原生基础设施的网络层，对应用透明。\n\n  ', '\/blog\/what-is-istio-and-why-does-kubernetes-need-it\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文将解释 Istio 是如何产生的，以及它与 Kubernetes 的关系。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/zero-trust-architecture/">[译] 零信任架构白皮书</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/04/22</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%ae%89%e5%85%a8"> 
             安全
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://www.tetrate.io/white-paper-zero-trust-architecture/" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('零信任架构白皮书', '本文译自 Tetrate 发布的《零信任架构白皮书》。', '\n## 背景介绍\n\n传统的数据中心网络安全架构试图在一个优美的内部花园周围建立强大的围墙。这种堡垒模型长久以来存在一个固有的弱点，即当（而不是如果）入侵者渗透到周边时，他们就可以控制整个花园。虽然这个弱点早就存在，但随着进入数据中心的入口的增加及工作负载的扩展的趋势增加，这个弱点越发严重。\n\n零信任网络架构提供了一条前进的道路，它解决了基于周界安全的弱点，采取的立场是网络本身就是敌对的；周界背后的安全是一种幻觉，野蛮人已经撞开了大门。\n\n虽然零信任需要对现状进行重大反思，但它远不是一个崇高的、不可实现的目标。现在就有一些工具可以开始实施零信任网络架构。这些工具和实践可以逐步实施，以满足你的需要，而不是要求你全盘重新构建你的整个网络安全基础设施。\n\n## 传统安全模式的弱点\n\n周边安全薄弱的原因与现代军队放弃大规模固定防御的原因类似：一旦被渗透，战斗就会失败；而周边安全最终也会被渗透。\n\n**单纯的周边安全提供了糟糕的控制粒度。**如果周界内的所有流量都是可信的，那么一个漏洞就会使周界内的一切都变得脆弱。当网络服务只有几十种时，这可能是可控的，而且可以通过物理位置严格限制访问，但服务激增到几十万种，而且都是以相同的访问水平相互通信，这使得目前的技术状态无法维持，特别是由于一个被破坏的服务可以转移到许多其他服务。\n\n多年来，业务需求已经削弱了外围的完整性。出于需要，防火墙上被打了很多洞，导致了多个暴露的入口点和难以管理的防火墙规则的扩散，使外围更像是一条马奇诺防线，而不是围墙和城堡。\n\n面对周界几乎消失的情况，为改善周界安全模式所做的新努力，如微分割和软件定义网络，有助于减少服务周围的攻击面。但是，它们也只是部分解决方案，其代价是复杂性的增加和配置规则的爆炸。分割仍然提供了糟糕的粒度。例如，隔离网络服务器和数据库服务器可以减少这些服务周围的攻击面，但网络服务器可能支持许多应用程序，它们各自可能引入的漏洞仍然是不透明的。\n\n## 零信任的信条\n\n\u0022*信任不是理想的状态，信任是你想避免的失败点*\u0022——约翰·金德瓦格\n\n零信任是一种方法，一种对网络安全的思考方式，而不是任何特定的架构或实现。它从一个假设开始，即网络上没有安全的地方。你应该把你的数据中心，不管它是否喜欢，当作它所有的数据和服务都暴露在公共互联网上。\n\n在零信任模式中，与传统的周边安全不同，可及性并不意味着授权。零信任旨在缩小资源周围的隐性信任区域，最好是缩小到零。在一个零信任的网络中，所有对资源的访问都应该是这样的。\n\n- **经过认证和动态授权**：不仅在网络层和服务间层，而且在应用层。网络位置并不意味着信任。在允许任何访问之前，服务身份和终端用户凭证是经过认证和动态授权的。\n- **有时间限制**：认证和授权被约束在一个短暂的会话中，之后必须重新建立。\n- **在空间上有界限**：一个服务周围的信任周界应该尽可能小。加密，既是为了防止窃听，也是为了确保信息的真实性和未被篡改。\n- **可观察**：所以所有资产的完整性和安全态势可以被持续监控，策略的执行可以持续得到保证。另外，从观察中获得的洞察力应该被反馈到改进策略上。\n\n### 为什么它更好？\n\n- 可访问性不是授权——与周边安全不同，对一个服务的访问并不仅仅是因为该服务是可以到达的，它还必须经过明确的认证和授权。\n\n- 经过认证和授权的工作负载受到保护，不受周边漏洞的影响。\n- 在时间上的约束限制了凭证受损的风险。\n- 在空间上的约束允许策略执行的高颗粒度。\n- 动态策略执行确保授权策略是最新的。\n- 加密限制了侦查，并提供了通信的真实性。\n- 细粒度的可观测性允许实时保证策略的执行，以及对历史上如何执行策略的事后审计，还有用于故障排除和分析的必要数据。\n\n零信任系统的试金石是，部署在该系统中的应用程序在公开曝光时不会有任何变化。如果实施得当，一个零信任的安全架构在公开的互联网上运行时与在防火墙后面运行时一样安全。\n\n### 我什么时候需要它？\n\n虽然每个组织都可能从采用零信任原则中受益，但期望几十年的基础设施和业务流程全盘转变为新模式是不现实的。\n\n特定的压力可能会促使你尽早这样做。当你的基础设施跨越不同的供应商时，例如，分裂的企业内部和云部署或混合云部署，在这些扩展的网络上大规模应用 VPN 和 NAT 的复杂性和脆弱性可能使得在短期内对这些部署应用零信任网络原则具有成本效益和风险效率。\n\n## ZTA 组件\n\nNIST 提出了三个逻辑组件来实现动态授权和认证。\n\n1.    一个策略引擎（Policy Engine，简称 PE），负责确定授权。\n2.    一个策略管理员（Policy Aadminstrator，简称 PA），用于根据策略引擎的结果建立和\/或关闭通往资源的通信路径。\n3.    策略执行点（Policy Enforcement Point，简称 PEP），位于提出请求的主体和目标资源之间，启用、监测和终止它们之间的连接。\n\n![图一](008i3skNly1gpsrzpm3cvj31n40u0whm.jpg)\n\n在这种模式下，主体要求的所有工作负载必须有一个身份，可以在 PEP 进行认证和授权。策略决策点对这些身份执行策略，并在允许访问之前执行认证和授权。在这里，授权是基于细粒度的策略；可及性不算作授权。数据平面的 PEP 允许在运行时对系统进行观察，并确保持续的合规性和治理控制。\n\n## 实施\n\n由于零信任不是一个蓝图，而更像是一种设计理念，因此有许多潜在的方法来实现零信任架构。作为服务网格和下一代访问控制（NGAC）技术的创始人和实施者，我们认为服务网格与 NGAC 相结合，为建立零信任架构网络提供了最佳基础。\n\n服务网格提供了你所需要的重要基元：\n\n- 集中管理的策略授权\n- 分布式策略执行点——PEP 与资源访问点（RAP 共同部署）\n- 内置支持基于运行时身份而非网络位置的工作负载身份\n- 内置支持终端用户的应用级认证和授权，允许对网状结构中的每个应用进行全局和一致的策略执行\n- 对线上数据进行加密\n- 内置可观测性\n\n网格提供了操作上的保证，你可以在部署认证和授权系统时使用网格，使它们更安全，更容易管理。我们可以很容易地用服务网格中的组件来重新绘制图一中所代表的 NIST 的逻辑架构。\n\n![图二](008i3skNly1gpsrzq4xikj31da0u0acq.jpg)\n\n\n服务网格的透明性允许我们逐步采用，而不需要对你的安全基础设施和业务流程全面推倒重建。网格对应用程序、部署和安全问题的解耦意味着你可以开始在现有的基础设施上建立一个零信任的架构，而不扰乱你的业务流程和应用程序交付生命周期。\n\n\n## 案例研究——美国国防部 Platform One\n\n\u0022老实说，我任务在没有服务网格的情况下无法获得任何有意义的成功；也许在 2018 年可以，但在 2020 年和这以后不可能。\u0022 ——美国空军首席软件官尼古拉斯·M·查兰（Nicolas M. Chaillan）。\n\n美国国防部在空军首席软件官 Nicolas M. Chaillan 的主持下，对其开发和运营软件的方式进行了革新。由 Chaillan 领导的在整个国防部发展 DevSecOps 实践的团队 Platform One，提供了多种企业服务，将 \u0022自动化的软件工具、服务和标准带到国防部的项目中，使作战人员能够在安全、灵活的情况下创建、部署和操作软件应用。\n\n这些服务包括他们的 DevSecOps 平台（DSOP），这是一个经批准的、符合 CNCF 标准的 Kubernetes 发行版的集合，还有 Istio、基础设施即代码的手册和加固的容器。\n\n根据 Chaillan 的说法，\u0022拥有一个集中的、由政府提供的、团队可以来使用的 DevSecOps 堆栈，这改变了游戏规则。\u0022过去，软件更新周期长达数年，而现在国防部 \u0022每天都在推送代码，一天推送多次......每个项目的初始计划时间每 5 年平均节省 12 至 18 个月。\u0022\n\nIstio 是他们架构的一个主要支柱，它提供了服务网格的能力，特别是它实现零信任模型的方式。当被问及为什么他们使用服务网格而不是仅使用入口控制器时，他不仅提到每个应用程序默认都有 mTLS 传输加密，而且 \u0022一旦你转向微服务和容器，你必须管理东西向流量，这与南北向完全不同……你需要确保横向移动受到限制。你不希望一个坏人获得一个容器的访问权，并能够......横向移动到其他容器。除了 SSO 和 mTLS，Platform One 的架构使用 Istio 来执行东西向白名单，并在容器之间提供策略执行点。\n\n该网格将策略执行从应用堆栈中剥离出来，并将其透明地转移到 sidecar 代理上。Platform One 能够将不同应用团队独立构建的多个 \u0022雪花 \u0022应用级 SSO 和加密实现整合为一个加固的单点登录和授权库，可供企业范围内所有应用使用。这就减轻了开发团队在每个应用中构建安全的负担。它还通过对单一的、经过严格审查的实施方案进行标准化，大大降低了漏洞风险。\n\nChaillan 说，\u0022如果你不使用服务网格，你最终不得不按语言、按微服务来做。而现在你是紧密耦合的。而且，比方说，在过去如果你想要更新加密位数，你就必须更新所有容器，而现在只需要更新服务网格中的 sidecar，现在你已经解耦了。仅此一点，就值得使用服务网格。”\n\n## 总结\n\n周边安全模式及其渐进式的后继者过于脆弱和复杂，无法满足现代应用开发和部署的需要。现在应用程序的构建方式需要一个动态的、灵活的安全解决方案，一个既能集中管理又能普遍适用于所有应用程序开发团队的解决方案。零信任架构在网络和应用层面提供了急需的安全改进，而服务网格为实现零信任提供了最强大、动态和灵活的方式。\n\n在所有服务和所有应用之间部署全局管理的策略执行点，服务网格提供了插入零信任功能的模拟点，如 SSO、mTLS 和动态授权。通过在全局范围内将安全责任从单个应用程序抽离到服务网格，企业有可能逐步采用零信任原则，而无需重写应用程序或改变现有流程。\n', '\/trans\/zero-trust-architecture\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文译自 Tetrate 发布的《零信任架构白皮书》。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/evolving-kubernetes-networking-with-the-gateway-api/">[译] 利用 Gateway API 发展 Kubernetes 网络</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/04/22</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://kubernetes.io/blog/2021/04/22/evolving-kubernetes-networking-with-the-gateway-api/" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('利用 Gateway API 发展 Kubernetes 网络', 'Gateway API 的出现解决了 Ingress 的可移植性问题，且有利于基于角色的访问设计。', '\nIngress 资源是 Kubernetes 众多成功案例中的一个。它创造了一个[多样化的 Ingress 控制器的生态系统](https:\/\/kubernetes.io\/docs\/concepts\/services-networking\/ingress-controllers\/)，这些控制器以标准化和一致的方式在数十万个集群中使用。这种标准化有助于用户采用 Kubernetes。然而，在 Ingress 创建五年后，有迹象表明它被分割成不同但[惊人相似的 CRD](https:\/\/dave.cheney.net\/paste\/ingress-is-dead-long-live-ingressroute.pdf) 和 [过载的注释](https:\/\/kubernetes.github.io\/ingress-nginx\/user-guide\/nginx-configuration\/annotations\/)。Ingress 普遍存在的可移植性问题也限制了它的未来。\n\n那是在 2019 年圣地亚哥的 Kubecon 上，一群充满激情的贡献者聚集在一起，讨论 [Ingress 的发展](https:\/\/static.sched.com\/hosted_files\/kccncna19\/a5\/Kubecon%20San%20Diego%202019%20-%20Evolving%20the%20Kubernetes%20Ingress%20APIs%20to%20GA%20and%20Beyond%20%5BPUBLIC%5D.pdf)。拥挤的人群溢出到了街对面的酒店大堂，而讨论出来的东西后来被称为 [Gateway API](https:\/\/gateway-api.sigs.k8s.io\/)。这次讨论是基于几个关键的假设：\n\n1. 路由匹配、流量管理和服务暴露所依据的 API 标准已经商业化，对其实施者和用户提供的定制 API 的价值很小。\n2. 可以通过共同的核心 API 资源来表示 L4\/L7 的路由和流量管理。\n3. 可以在不牺牲核心 API 的用户体验的前提下，为更复杂的功能提供扩展性。\n\n## Gateway API 介绍\n\n这产出了一些设计原则，使 Gateway API 能够在 Ingress 的基础上进行改进。\n\n- **表达性**：除了 HTTP 主机 \/ 路径匹配和 TLS 之外，Gateway API 还可以表达 HTTP 头操作、流量加权和镜像、TCP\/UDP 路由等能力，以及其他只有在 Ingress 中通过自定义注释才能实现的能力。\n- **面向角色的设计**：API 资源模型反映了路由和 Kubernetes 服务网络中常见的责任分离。\n- **可扩展性**：这些资源允许在 API 的各个层面上进行任意的配置附加。这使得在最适当的地方进行细化的定制成为可能。\n- **灵活的一致性**：Gateway API 定义了不同的一致性级别 —— 核心（强制支持）、扩展（支持时可移植）和自定义（不保证可移植性），一起被称为[灵活的一致性](https:\/\/gateway-api.sigs.k8s.io\/concepts\/guidelines\/#conformance)。这促进了高度可移植的核心 API（如 Ingress），仍然为 Gateway 控制器实施者提供了灵活性。\n\n### Gateway API 是什么样子的？\n\nGateway API 引入了一些新的资源类型：\n\n- [**GatewayClasses**](https:\/\/gateway-api.sigs.k8s.io\/references\/spec\/#networking.x-k8s.io\/v1alpha1.GatewayClass) 是集群范围内的资源，作为模板，明确地定义由其衍生的网关的行为。这与 StorageClasses 的概念类似，但用于网络数据平面。\n- [**Gateway**](https:\/\/gateway-api.sigs.k8s.io\/references\/spec\/#networking.x-k8s.io\/v1alpha1.Gateway) 是 GatewayClasses 的部署实例。它们是执行路由的数据平面的逻辑表示，它可能是集群内的代理、硬件 LB 或云 LB。\n- **路由** 不是一个单一的资源，而是代表许多不同的特定协议的路由资源。[HTTPRoute](https:\/\/gateway-api.sigs.k8s.io\/references\/spec\/#networking.x-k8s.io\/v1alpha1.HTTPRoute) 有匹配、过滤和路由规则，这些规则被应用到可以处理 HTTP 和 HTTPS 流量的网关。同样，还有 [TCPRoutes](https:\/\/gateway-api.sigs.k8s.io\/references\/spec\/#networking.x-k8s.io\/v1alpha1.TCPRoute)、[UDPRoutes](https:\/\/gateway-api.sigs.k8s.io\/references\/spec\/#networking.x-k8s.io\/v1alpha1.UDPRoute) 和 [TLSRoutes](https:\/\/gateway-api.sigs.k8s.io\/references\/spec\/#networking.x-k8s.io\/v1alpha1.TLSRoute)，它们也有协议特定的语义。这种模式也允许网关 API 在未来逐步扩展其协议支持。\n\n![Gateway API 资源](008i3skNly1gpsl6ut5jlj31ed0u0jyp.jpg)\n\n### Gateway 控制器的实现\n\n好消息是，虽然 Gateway 还在 [Alpha](https:\/\/github.com\/kubernetes-sigs\/gateway-api\/releases) 阶段，但已经有几个 Gateway 控制器实现，你可以运行。由于它是一个标准化的规格，下面的例子都可以运行，而且功能应该完全相同。我们来看看如何安装和使用这些 Gateway 控制器。\n\n## 实践 Gateway API\n\n在下面的例子中，我们将展示不同的 API 资源之间的关系，并引导你完成一个常见的使用案例。\n\n- foo 团队在 foo 命名空间中部署了他们的应用程序。他们需要控制其应用程序的不同页面的路由逻辑。\n- Team bar 正在 bar 命名空间中运行。他们希望能够对他们的应用程序进行蓝绿部署以减少风险。\n- 平台团队负责管理 Kubernetes 集群中所有应用程序的负载均衡器和网络安全。\n\n下面的 foo-route 对 foo 命名空间中的各种服务进行路径匹配，并且有一个到 404 服务器的默认路由。这通过 \u0060foo.example.com\/login\u0060 和 \u0060foo.example.com\/home\u0060 分别暴露了 foo-auth 和 foo-home 服务。\n\n\u0060\u0060\u0060yaml\nkind: HTTPRoute\napiVersion: networking.x-k8s.io\/v1alpha1\nmetadata:\n  name: foo-route\n  namespace: foo\n  labels:\n    gateway: external-https-prod\nspec:\n  hostnames:\n  - \u0022foo.example.com\u0022\n  rules:\n  - matches:\n    - path:\n        type: Prefix\n        value: \/login\n    forwardTo:\n    - serviceName: foo-auth\n      port: 8080\n  - matches:\n    - path:\n        type: Prefix\n        value: \/home\n    forwardTo:\n    - serviceName: foo-home\n      port: 8080\n  - matches:\n    - path:\n        type: Prefix\n        value: \/\n    forwardTo:\n    - serviceName: foo-404\n      port: 8080\n\u0060\u0060\u0060\n\n在同一个 Kubernetes 集群的 bar 命名空间中运行的 bar 团队也希望将他们的应用程序暴露在互联网上，但他们也希望控制自己的金丝雀发布和蓝绿部署。下面的 HTTPRoute 被配置为以下行为。\n\n- 对于访问 \u0060bar.example.com\u0060的流量：\n  - 将 90% 的流量发送到 bar-v1\n  - 将 10% 的流量发送到 bar-v2\n- 对于访问 \u0060bar.example.com\u0060 的流量，HTTP header 为 \u0060env: canary\u0060：\n  - 将所有的流量发送到 bar-v2\n\n\n![The routing rules configured for the bar-v1 and bar-v2 Services](008i3skNly1gpsl6via0rj31np0fxq5x.jpg)\n\n\u0060\u0060\u0060yaml\nkind: HTTPRoute\napiVersion: networking.x-k8s.io\/v1alpha1\nmetadata:\n  name: bar-route\n  namespace: bar\n  labels:\n    gateway: external-https-prod\nspec:\n  hostnames:\n  - \u0022bar.example.com\u0022\n  rules:\n  - forwardTo:\n    - serviceName: bar-v1\n      port: 8080\n      weight: 90\n    - serviceName: bar-v2\n      port: 8080\n      weight: 10\n  - matches:\n    - headers:\n        values:\n          env: canary\n    forwardTo:\n    - serviceName: bar-v2\n      port: 8080\n\u0060\u0060\u0060\n\n### 路由和网关绑定\n\n因此，我们有两个 HTTPRoute 匹配并将流量路由到不同的服务。你可能想知道，这些服务在哪里可以访问？它们是通过哪些网络或 IP 暴露的？\n\n路由如何暴露给客户是由[路由绑定](https:\/\/gateway-api.sigs.k8s.io\/concepts\/api-overview\/#route-binding)管理的，它描述了路由和网关如何在彼此之间建立双向关系。当路由与网关绑定时，意味着它们的集体路由规则被配置在底层负载均衡器或代理上，并且路由可以通过网关访问。因此，网关是一个网络数据平面的逻辑表示，可以通过路由配置。\n\n![路由如何绑定到网关](008i3skNly1gpsl6w3e9aj31fo0gotay.jpg)\n\n### 行政授权\n\n网关和路由资源之间的分割允许集群管理员将一些路由配置委托给各个团队，同时仍然保留集中控制。下面的网关资源在 443 端口暴露 HTTPS，并用集群管理员控制的证书终止该端口的所有流量。\n\n\u0060\u0060\u0060yaml\nkind: Gateway\napiVersion: networking.x-k8s.io\/v1alpha1\nmetadata:\n  name: prod-web\nspec:\n  gatewayClassName: acme-lb\n  listeners:  \n  - protocol: HTTPS\n    port: 443\n    routes:\n      kind: HTTPRoute\n      selector:\n        matchLabels:\n          gateway: external-https-prod\n      namespaces:\n        from: All\n    tls:\n      certificateRef:\n        name: admin-controlled-cert\n\u0060\u0060\u0060\n\n下面的 HTTPRoute 显示了 Route 如何通过它的 \u0060kind\u0060（HTTPRoute）和资源标签（\u0060gateway=external-https-prod\u0060）确保它与 Gateway 的选择器相匹配。\n\n\u0060\u0060\u0060yaml\n# 匹配网关上所需的 kind 选择器\nkind: HTTPRoute\napiVersion: networking.x-k8s.io\/v1alpha1\nmetadata:\n  name: foo-route\n  namespace: foo-ns\n  labels:\n    # 匹配网关上所需的标签选择器\n    gateway: external-https-prod\n...\n\u0060\u0060\u0060\n\n### 以角色为导向的设计\n\n当你把它放在一起时，你有一个单一的负载均衡基础设施，可以被多个团队安全地共享。Gateway API 不仅是一个用于高级路由的更具表现力的 API，而且是一个面向角色的 API，为多用户基础设施而设计。它的可扩展性确保了它在保持可移植性的同时，还能为未来的使用场景而发展。最终，这些特性将使 Gateway API 在未来适应不同的组织模式和实施方式。\n\n### 尝试和参与\n有许多资源可供查阅，以了解更多。\n\n- 查阅[用户指南](https:\/\/gateway-api.sigs.k8s.io\/guides\/getting-started\/)，看看可以解决哪些用例。\n- 试用现有的网关控制器。\n- 或者[参与进来](https:\/\/gateway-api.sigs.k8s.io\/contributing\/community\/)，帮助设计并影响 Kubernetes 服务网络的未来！\n', '\/trans\/evolving-kubernetes-networking-with-the-gateway-api\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">Gateway API 的出现解决了 Ingress 的可移植性问题，且有利于基于角色的访问设计。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/introducing-getenvoy-extension-toolkit-for-webassembly-based-envoy-extensions/">[译] 使用基于 WebAssembly 的 GetEnvoy 工具包扩展 Envoy</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/04/21</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/envoy"> 
             Envoy
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('使用基于 WebAssembly 的 GetEnvoy 工具包扩展 Envoy', '本文为大家介绍了如何使用开源项目 GetEnvoy 来扩展 Envoy。', '\n说一说来龙去脉，Envoy 是一个非常注重规模化业务的底层网络组件，令人激动且功能强大。然而它在用户体验方面一直很欠缺。\n\n当用户开始使用一个新工具时，必然会从“如何在自己的环境中安装”这一问题开始。而 Envoy 之前并没有给出答案。\n\n为了填补这一空白，Tetrate [启动了](https:\/\/www.getenvoy.io\/blog\/announcing-the-getenvoy-project\/) GetEnvoy 项目并且 [推出了](https:\/\/www.getenvoy.io\/blog\/introducing-the-getenvoy-cli\/) getenvoy CLI，作为提供给用户的组件。\n\n### 新挑战\n\n下一个关于 Envoy 的常见需求是“如何扩展”。\n\n截止目前，如果想扩展或定制 Envoy，你将不得不“越界”成为实质上的 Envoy 开发者。 \n\n幸运的是，这种情况即将改变。一种名为 [WebAssembly（Wasm）](https:\/\/webassembly.org\/) 的新技术即将纳入 Envoy。Wasm 让使用不同编程语言开发 Envoy 扩展成为可能。更重要的是，能以完全动态的方式部署这些扩展。\n\n### GetEnvoy 扩展工具包\n\n[GetEnvoy 扩展工具包](https:\/\/www.getenvoy.io\/reference\/getenvoy_extension_toolkit_reference\/) 的目的在于帮助有扩展 Envoy 需求的开发者，在短时间内完成扩展开发并启动运行。\n\n作为开发者，你很可能想：\n\n- 从工作中的典型示例入手\n- 从开始就建立有效的开发工作流\n- 利用最佳实践，自动避免常见陷阱\n\nGetEnvoy 扩展工具包将帮助您解决以上所有问题！\n\n### 使用 Rust 创建 Envoy HTTP Filter\n\n让我们使用 Rust 开发一个 Envoy HTTP Filter 来试试 GetEnvoy 扩展工具包吧！\n\n#### 1. 前置要求\n\n[安装](https:\/\/www.getenvoy.io\/install\/) getenvoy CLI，例如：\n\n\u0060\u0060\u0060shell\n$ curl -L https:\/\/getenvoy.io\/cli | bash -s -- -b \/usr\/local\/bin\n\u0060\u0060\u0060\n\n[安装](https:\/\/docs.docker.com\/engine\/install\/) Docker。 \n\n检查\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ getenvoy --version\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\ngetenvoy version 0.2.0\n\u0060\u0060\u0060\n运行\n\u0060\u0060\u0060shell\n$ docker --version\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\nDocker version 19.03.8, build afacb8b\n\u0060\u0060\u0060\n\n#### 2. 安装新的 HTTP Filter 扩展包的脚手架\n\n如果想在交互模式下构建一个新扩展，运行命令：\n\n\u0060\u0060\u0060shell\n$ getenvoy extension init\n\u0060\u0060\u0060\n此外，如果想跳过向导，需要在命令行提供参数，比如：\n\u0060\u0060\u0060shell\n$ getenvoy extension init \\\n    --category envoy.filters.http \\\n    --language rust \\\n    --name me.filters.http.my_http_filter \\\n    my_http_filter \n\u0060\u0060\u0060\n\n检查\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ tree -a my_http_filter\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\nmy_http_filter\n├── .cargo\n│   └── config\n├── .getenvoy\n│   └── extension\n│       └── extension.yaml\n├── .gitignore\n├── Cargo.toml\n├── README.md\n├── src\n│   ├── config.rs\n│   ├── factory.rs\n│   ├── filter.rs\n│   ├── lib.rs\n│   └── stats.rs\n└── wasm\n    └── module\n        ├── Cargo.toml\n        └── src\n            └── lib.rs\n\u0060\u0060\u0060\n\n#### 3. 构建扩展\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ getenvoy extension build\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\nUpdating crates.io index\nDownloaded envoy-sdk v0.1.0\n...\nCompiling envoy-sdk v0.1.0\n...\nFinished dev [unoptimized \u002b debuginfo] target (s) in 23.57s\nCopying *.wasm file to \u0027target\/getenvoy\/extension.wasm\u0027\n\u0060\u0060\u0060\n\n检查\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ tree target\/getenvoy\/\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\ntarget\/getenvoy\n└── extension.wasm\n\u0060\u0060\u0060\n\n#### 4. 运行单元测试\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ getenvoy extension test\n\u0060\u0060\u0060\n\n检查\n\n应该看到类似于以下的输出：\n\n\u0060\u0060\u0060shell\nrunning 1 test\ntest tests::should_initialize ... ok\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n\u0060\u0060\u0060\n\n#### 5. 在 Envoy 中运行扩展\n\n让我们用较困难的方式完成这部分工作。与其使用一条简单的自动化命令，不如手动完成每一步。\n\n##### 1. 下载 Envoy 二进制文件\n\n需要去下载和扩展开发版本相同的 Envoy\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ cat .getenvoy\/extension\/extension.yaml\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\n…\n\n# Runtime the extension is being developed against.\n\nruntime:\n  envoy:\n    version: wasm:1.15\n\u0060\u0060\u0060\n为了下载该版本的 Envoy，运行命令：\n\u0060\u0060\u0060shell\n$ getenvoy fetch wasm:1.15\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\nfetching wasm:1.15\/darwin\n[Fetching Envoy] 100%\n\u0060\u0060\u0060\n\n##### 2. 创建一个示例 Envoy 配置\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ getenvoy extension examples add\n\u0060\u0060\u0060\n检查一下，运行命令：\n\u0060\u0060\u0060shell\n$ tree .getenvoy\/extension\/examples\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\n.getenvoy\/extension\/examples\n└── default\n  ├── README.md\n  ├── envoy.tmpl.yaml\n  ├── example.yaml\n  └── extension.json\n\u0060\u0060\u0060\n\n##### 3. 通过查看 README.md 文件了解更多关于示例配置的信息\n\n##### 4. 快速浏览示例 Envoy 配置\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$  cat .getenvoy\/extension\/examples\/default\/envoy.tmpl.yaml\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060yaml\n...\nhttp_filters:\n- name: envoy.filters.http.wasm\n  typed_config:\n    \u0022@type\u0022: type.googleapis.com\/envoy.extensions.filters.http.wasm.v3.Wasm\n    config:\n      configuration: {{.GetEnvoy.Extension.Config}}\n      name: {{.GetEnvoy.Extension.Name}}\n      root_id: {{.GetEnvoy.Extension.Name}}\n      vm_config:\n        vm_id: {{.GetEnvoy.Extension.Name}}\n        runtime: envoy.wasm.runtime.v8\n        code: {{.GetEnvoy.Extension.Code}}\n- name: envoy.filters.http.router\n...\n\u0060\u0060\u0060\n\n注意，示例 Envoy 配置中包含了占位符 {{…}}，这些占位符会由 getenvoy CLI 解决。\n\n##### 5. 使用该示例配置启动 Envoy\n\n运行命令：\n\n\u0060\u0060\u0060shell\n$ getenvoy extension run\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\ninfo Envoy command: [$HOME\/.getenvoy\/builds\/wasm\/1.15\/darwin\/bin\/envoy -c \/tmp\/getenvoy_extension_run732371719\/envoy.tmpl.yaml]\n...\n[info][main] [external\/envoy\/source\/server\/server.cc:339] admin address: 127.0.0.1:9901\n...\n[info][config] [external\/envoy\/source\/server\/listener_manager_impl.cc:700] all dependencies initialized. starting workers\n[info][main] [external\/envoy\/source\/server\/server.cc:575] starting main dispatch loop\n\u0060\u0060\u0060\n\n此时 Envoy 已启动，扩展也可以使用了。\n\n检查\n\n为了测试 HTTP Filter 扩展，运行命令：\n\n\u0060\u0060\u0060shell\n$ curl -i http:\/\/0.0.0.0:10000\n\u0060\u0060\u0060\n在 Envoy 的输出中，应该看到类似于以下的输出：\n\u0060\u0060\u0060shell\nmy_http_filter: #2 new http exchange starts at 2020-07-01T18:22:51.623813\u002b00:00 with config:\nmy_http_filter: #2 observing request headers\nmy_http_filter: #2 -\u003e :authority: 0.0.0.0:10000\nmy_http_filter: #2 -\u003e :path: \/\nmy_http_filter: #2 -\u003e :method: GET\nmy_http_filter: #2 -\u003e user-agent: curl\/7.64.1\nmy_http_filter: #2 -\u003e accept: *\/*\nmy_http_filter: #2 -\u003e x-forwarded-proto: http\nmy_http_filter: #2 -\u003e x-request-id: 8902ca62-75a7-40e7-9b2e-cd7dc983b091\nmy_http_filter: #2 http exchange complete\n\u0060\u0060\u0060\n由于现在你知道了运行扩展的背后都发生了什么，下次就可以用以下命令简单启动扩展：\n\u0060\u0060\u0060shell\n$ getenvoy extension run\n\u0060\u0060\u0060\n\n#### 增加一个新特性\n\n让我们为扩展添加一个新特性：在代理的 HTTP 响应中注入一个额外的标头。\n\n首先，更新扩展配置以保存注入的标头的名称（添加的行后添加了注释）：\n\n在 src\/config.rs 文件中\n\n\u0060\u0060\u0060rust\n\/\/\/ Configuration for a Sample HTTP Filter.\n#[derive (Debug, Default, Deserialize)]\npub struct SampleHttpFilterConfig {#[serde (default)]{\n#[serde(default)]\npub response_header_name: String, \/\/ 添加的代码\n}\n\u0060\u0060\u0060\n\n接着，添加 on_response_headers 方法到 SampleHttpFilter 中：\n\n在 src\/filter.rs 文件中\n\n\u0060\u0060\u0060rust\n\/\/\/ Called when HTTP response headers have been received. 当 HTTP 响应头被接收时调用\n\/\/\/\n\/\/\/ Use \u0060filter_ops\u0060 to access and mutate response headers. 使用 filter_ops 访问和变异响应头\nfn on_response_headers (\n    \u0026mut self,\n    _num_headers: usize,\n    _end_of_stream: bool,\n    filter_ops: \u0026dyn http::ResponseHeadersOps,\n) -\u003e Result\u003chttp::FilterHeadersStatus\u003e {if !self.config.response_header_name.is_empty () {\n        filter_ops.set_response_header (\n            \u0026self.config.response_header_name,\n            \u0022injected by WebAssembly extension\u0022\n        )?;\n    }\n    Ok (http::FilterHeadersStatus::Continue)\n}\n\u0060\u0060\u0060\n\n最后，在默认的示例设置中更新扩展配置。\n\n在 \u0060.getenvoy\/extension\/examples\/default\/extension.json\u0060 文件中\n\n\u0060\u0060\u0060{\u0022response_header_name\u0022:\u0022my-header\u0022}\u0060\u0060\u0060\n\n检查\n\n为了确认变更，重启示例设置：\n\n\u0060\u0060\u0060shell\n$ getenvoy extension run\n\u0060\u0060\u0060\n发出以下示例请求：\n\u0060\u0060\u0060sh\n$ curl -i localhost:10000\n\u0060\u0060\u0060\n应该看到类似于下面的输出：\n\u0060\u0060\u0060sh\nHTTP\/1.1 200 OK\ncontent-length: 22\ncontent-type: text\/plain\ndate: Tue, 07 Jul 2020 18:36:23 GMT\nserver: envoy\nx-envoy-upstream-service-time: 0\nmy-header: injected by WebAssembly extension\n \nHi from mock service!\n\u0060\u0060\u0060\n\n注意到一条额外的标头被注入到响应中。\n\n#### 增加一个新指标\n\nEnvoy 大力支持对新行为的可观测性。\n\n让我们更新扩展以暴露关于其新行为的度量。具体来说，提供一个计数器，显示被额外的标头注入了的 HTTP 响应的数量。 \n\n编辑源码如下（添加的行后加入了注释）：\n\n在 src\/stats.rs 文件中\n\n\u0060\u0060\u0060rust\nuse envoy::host::stats::Counter;\n\n\/\/\/ Sample stats.\npub struct SampleHttpFilterStats {requests_total: Box\u003cdyn Counter\u003e,\n   responses_injected_total: Box\u003cdyn Counter\u003e,              \/\/added code 新增行\n} \n\nimpl SampleHttpFilterStats {\n   pub fn new (requests_total: Box\u003cdyn Counter\u003e,\n       responses_injected_total: Box\u003cdyn Counter\u003e,          \/\/added code 新增行\n   ) -\u003e Self {\n       SampleHttpFilterStats {\n           requests_total,\n           responses_injected_total,                        \/\/added code 新增行\n       }\n   }\n\n   pub fn requests_total (\u0026self) -\u003e \u0026dyn Counter {\u0026*self.requests_total}\n\n   pub fn responses_injected_total (\u0026self) -\u003e \u0026dyn Counter { \/\/added code 新增行\n       \u0026*self.responses_injected_total\n   }\n}\n\u0060\u0060\u0060\n在 src\/factory.rs 中\n\u0060\u0060\u0060rust\n\/\/\/ Creates a new factory.\npub fn new (clock: \u0026\u0027a dyn Clock, stats: \u0026dyn Stats) -\u003e Result\u003cSelf\u003e {\n    let stats = SampleHttpFilterStats::new (stats.counter (\u0022examples.http_filter.requests_total\u0022)?,\n        stats.counter (\u0022examples.http_filter.responses_injected_total\u0022)?, \/\/added code 新增行\n    );\n    \/\/ Inject dependencies on Envoy host APIs\n    Ok (SampleHttpFilterFactory {config: Rc::new (SampleHttpFilterConfig::default ()),\n        stats: Rc::new (stats),\n        clock,\n    })\n}\n\u0060\u0060\u0060\n在 src\/filter.rs 中\n\u0060\u0060\u0060rust\n\/\/\/ Called when HTTP response headers have been received.\n\/\/\/\n\/\/\/ Use \u0060filter_ops\u0060 to access and mutate response headers.\nfn on_response_headers (\n    \u0026mut self,\n    _num_headers: usize,\n    _end_of_stream: bool,\n    filter_ops: \u0026dyn http::ResponseHeadersOps,\n) -\u003e Result\u003chttp::FilterHeadersStatus\u003e {if !self.config.response_header_name.is_empty () {\n        filter_ops.set_response_header (\n            \u0026self.config.response_header_name,\n           \u0022injected by WebAssembly extension\u0022,\n        )?;\n        self.stats.responses_injected_total ().inc ()?; \/\/added code\n    }\n    Ok (http::FilterHeadersStatus::Continue)\n}\n\u0060\u0060\u0060\n\n检查\n\n重启示例设置，发出示例请求并检查 Envoy 的指标：\n\n\u0060\u0060\u0060$ getenvoy extension run\u0060\u0060\u0060\n\n\u0060\u0060\u0060sh\n$ curl -i localhost:10000\n$ curl -i localhost:10000\n\n$ curl -s localhost:9901\/stats | grep responses_injected_total\n\u0060\u0060\u0060\n应该看到类似于以下的输出：\n\u0060\u0060\u0060\nexamples.http_filter.responses_injected_total: 2\n\u0060\u0060\u0060\n\n我们对使用 [GetEnvoy 扩展工具包](https:\/\/www.getenvoy.io\/reference\/getenvoy_extension_toolkit_reference\/) 的开发流程的简单介绍到此结束。\n\n### 结束语\n\n目前为止，我们展示了使用 GetEnvoy 开发 Envoy 扩展是多么容易。\n\n结合 [getenvoy CLI](https:\/\/www.getenvoy.io\/) 的便利和 [Envoy Rust SDK](https:\/\/docs.rs\/envoy-sdk\/) 的指引，你可以轻松胜任这些工作。\n\n除了上面演示的 [HTTP Filter](https:\/\/docs.rs\/envoy-sdk\/0.1.0\/envoy_sdk\/extension\/filter\/http\/index.html) 扩展外，你还可以使用该工具包开发其他类型的 Envoy 扩展，比如 [Network Filter](https:\/\/docs.rs\/envoy-sdk\/0.1.0\/envoy_sdk\/extension\/filter\/network\/index.html) 和 [Access Logger](https:\/\/docs.rs\/envoy-sdk\/0.1.0\/envoy_sdk\/extension\/access_logger\/index.html)。\n\n### 未来计划\n\n在未来的几个月里，我们将为 GetEnvoy 添加一些新特性。\n\n一方面，我们将把重点转移到扩展用户体验上，为用户提供能够轻松发现和使用扩展的方法。 \n\n另一方面，我们将继续改善开发者流程的用户体验。对更多编程语言和更多扩展类型的支持将会到来。 \n\n敬请关注 GetEnvoy 的进一步更新！请与我们分享你在 Rust 中的 Envoy 扩展！\n\n', '\/trans\/introducing-getenvoy-extension-toolkit-for-webassembly-based-envoy-extensions\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文为大家介绍了如何使用开源项目 GetEnvoy 来扩展 Envoy。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/why-do-you-need-istio-when-you-already-have-kubernetes/">为什么在使用了 Kubernetes 后你可能还需要 Istio？</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2021/04/07</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('为什么在使用了 Kubernetes 后你可能还需要 Istio？', '本文将带大家了解 Kubernetes 和 Istio 的内部工作原理。此外，我会介绍 Kubernetes 中的负载均衡方法，并解释为什么有了 Kubernetes 后可能还需要 Istio。', '\n如果你听说过服务网格，并尝试过 [Istio](https:\/\/istio.io\/)，你可能有以下问题。\n\n1. 为什么 Istio 要在 Kubernetes 上运行？\n2. Kubernetes 和服务网格在云原生应用架构中分别扮演什么角色？\n3. Istio 扩展了 Kubernetes 的哪些方面？它解决了哪些问题？\n4. Kubernetes、Envoy 和 Istio 之间是什么关系？\n\n本文将带大家了解 Kubernetes 和 Istio 的内部工作原理。此外，我会介绍 Kubernetes 中的负载均衡方法，并解释为什么有了 Kubernetes 后还需要 Istio。\n\nKubernetes 本质上是通过声明式配置来实现应用生命周期管理，而服务网格本质上是提供应用间的流量、安全管理和可观测性。如果你已经使用 Kubernetes 搭建了一个稳定的应用平台，那么如何设置服务间调用的负载均衡和流量控制？是否有这样一个通用的工具或者说平台（非 SDK），可以实现？这就需要用到服务网格了。\n\nEnvoy 引入了 xDS 协议，这个协议得到了各种开源软件的支持，比如 Istio、[MOSN](https:\/\/mosn.io\/) 等。Envoy 将 xDS 贡献给服务网格或云原生基础设施。Envoy 本质上是一个现代版的代理，可以通过 API 进行配置，在此基础上衍生出许多不同的使用场景–比如 API Gateway、服务网格中的 sidecar 代理和边缘代理。\n\n本文包含以下内容。\n\n- kube-proxy 的作用描述。\n- Kubernetes 在微服务管理方面的局限性。\n- Istio 服务网格的功能介绍。\n- Kubernetes、Envoy 和 Istio 服务网格中一些概念的比较。\n\n## Kubernetes vs Service Mesh\n\n下图显示了 Kubernetes 中的服务访问关系和服务网格（每个 pod 模型一个 sidecar）。\n\n![Kubernetes vs Service Mesh](008eGmZEly1gpb7knfo4dj31hk0redrz.jpg)\n\n### 流量转发\n\nKubernetes 集群中的每个节点都部署了一个 kube-proxy 组件，该组件与 Kubernetes API Server 进行通信，获取集群中的服务信息，然后设置 iptables 规则，将服务请求直接发送到对应的 Endpoint（属于同一组服务的 pod）。\n\n### 服务发现\n\n![Service Discovery](008eGmZEly1gpb7knwb79j30kq0fcjs9.jpg)\n\nIstio 可以跟踪 Kubernetes 中的服务注册，也可以在控制平面中通过平台适配器与其他服务发现系统对接；然后生成数据平面的配置（使用 CRD，这些配置存储在 etcd 中），数据平面的透明代理。数据平面的透明代理以 sidecar 容器的形式部署在每个应用服务的 pod 中，这些代理都需要请求控制平面同步代理配置。代理之所以“透明”，是因为应用容器完全不知道代理的存在。过程中的 kube-proxy 组件也需要拦截流量，只不过 kube-proxy 拦截的是进出 Kubernetes 节点的流量–而 sidecar 代理拦截的是进出 pod 的流量。\n\n### 服务网格的劣势\n\n由于 Kubernetes 的每个节点上都运行着很多 pod，所以在每个 pod 中放入原有的 kube-proxy 路由转发功能，会增加响应延迟–由于 sidecar 拦截流量时跳数更多，消耗更多的资源。为了对流量进行精细化管理，将增加一系列新的抽象功能。这将进一步增加用户的学习成本，但随着技术的普及，这种情况会慢慢得到缓解。\n\n### 服务网格的优势\n\nkube-proxy 的设置是全局的，无法对每个服务进行细粒度的控制，而 service mesh 通过 sidecar proxy 的方式将 Kubernetes 中的流量控制从服务层中抽离出来–可以实现更大的弹性。\n\n### Kube-proxy 的不足之处\n\n首先，如果转发的 pod 不能正常服务，它不会自动尝试其他 pod。每个 pod 都有一个健康检查机制，当一个 pod 出现健康问题时，kubelet 会重启 pod，kube-proxy 会删除相应的转发规则。另外，节点 Port 类型的服务不能添加 TLS 或更复杂的消息路由机制。\n\nKube-proxy 实现了一个 Kubernetes 服务的多个 pod 实例之间的流量负载均衡，但如何对这些服务之间的流量进行精细化控制–比如将流量按百分比划分给不同的应用版本（这些应用版本都是同一个服务的一部分，但在不同的部署上），或者做金丝雀发布（灰度发布）和蓝绿发布？\n\nKubernetes 社区给出了一个使用 Deployment 做[金丝雀发布](https:\/\/kubernetes.io\/docs\/concepts\/cluster-administration\/manage-deployment\/#canary-deployments)的方法，本质上是通过修改 pod 的标签来给部署的服务分配不同的 pod。\n\n### Kubernetes Ingress vs Istio Gateway\n\n如上所述，kube-proxy 只能在 Kubernetes 集群内路由流量。Kubernetes 集群的 pod 位于 CNI 创建的网络中。Ingress 是在 Kubernetes 中创建的资源对象，用于集群外部的通信。它由位于 Kubernetes 边缘节点上的入口控制器驱动，负责管理南北向流量。Ingress 必须与各种 Ingress 控制器对接，比如 [nginx ingress 控制器](https:\/\/github.com\/kubernetes\/ingress-nginx)和 [traefik](https:\/\/traefik.io\/)。Ingress 只适用于 HTTP 流量，使用简单。它只能通过匹配有限的字段来路由流量——如服务、端口、HTTP 路径等。这使得它无法对 TCP 流量进行路由，如 MySQL、Redis 和各种 RPC。这就是为什么你会看到人们在 ingress 资源注释中写 Nginx 配置语言的原因（注：使用 Nginx Ingress Controller 可以通过 [配置 ConfigMap 和 Service 的方式](https:\/\/kubernetes.github.io\/ingress-nginx\/user-guide\/exposing-tcp-udp-services\/)来变通支持 TCP 和 UDP  流量转发）。直接路由南北流量的唯一通行方法是使用服务的 LoadBalancer 或 NodePort，前者需要云厂商支持，后者需要额外的端口管理。\n\nIstio Gateway 的功能与 Kubernetes Ingress 类似，它负责进出集群的南北流量。Istio Gateway 描述了一个负载均衡器，用于承载进出服务网格边缘的连接。该规范描述了一组开放端口和这些端口所使用的协议，以及用于负载均衡的 SNI 配置等。Gateway 是一个 CRD 扩展，它也重用了 sidecar 代理的功能；详细配置请参见 [Istio 网站](https:\/\/istio.io\/latest\/docs\/reference\/config\/networking\/gateway\/)。\n\n## Envoy\n\nEnvoy 是 Istio 中默认的 sidecar 代理。Istio 基于 Envoy 的 xDS 协议扩展了其控制平面。在讨论 Envoy 的 xDS 协议之前，我们需要先熟悉 Envoy 的基本术语。下面是 Envoy 的架构图。\n\n![Envoy 架构图](envoy-arch.jpg)\n\n### 基础概念\n\n以下是 Envoy 中你应该知道的基本术语。\n\n- 下游。下游主机连接到 Envoy，发送请求，并接收响应，即发送请求的主机。\n- 上游：上游主机。上游主机接收来自 Envoy 的连接和请求，并返回响应；即接收请求的主机。\n- Listener：监听器。监听器是一个命名的网络地址（如端口、UNIX 域套接字等）；下游客户端可以连接到这些监听器。Envoy 将一个或多个监听器暴露给下游主机进行连接。\n- 集群。集群是一组逻辑上相同的上游主机，Envoy 连接到它们。Envoy 通过服务发现来发现集群的成员。可以选择通过主动的健康检查来确定集群成员的健康状态。Envoy 通过负载均衡策略来决定集群中哪个成员的请求路由。\n\n在 Envoy 中可以设置多个监听器，每个监听器可以设置一个过滤链（过滤链表），而且过滤链是可扩展的，这样我们可以更方便地操纵流量的行为–比如设置加密、私有 RPC 等。\n\nxDS 协议是由 Envoy 提出的，是 Istio 中默认的 sidecar 代理，但只要实现了 xDS 协议，理论上也可以作为 Istio 中的 sidecar 代理 —— 比如蚂蚁集团开源的 [MOSN](https:\/\/mosn.io)。\n\n![Istio 的架构](arch.png)\n\nIstio 是一个功能非常丰富的服务网格，包括以下功能。\n\n- 流量管理。这是 Istio 最基本的功能。\n- 策略控制。实现访问控制系统、遥测采集、配额管理、计费等功能。\n- 可观测性。在 sidecar 代理中实现。\n- 安全认证。由 Citadel 组件进行密钥和证书管理。\n\n## Istio 中的流量管理\n\nIstio 中定义了以下 CRD 来帮助用户进行流量管理。\n\n- 网关。网关描述了一个运行在网络边缘的负载均衡器，用于接收传入或传出的 HTTP\/TCP 连接。\n- 虚拟服务（VirtualService）。VirtualService 实际上是将 Kubernetes 服务连接到 Istio 网关。它还可以执行额外的操作，例如定义一组流量路由规则，以便在主机寻址时应用。\n- DestinationRule。DestinationRule 定义的策略决定了流量被路由后的访问策略。简单来说，它定义了流量的路由方式。其中，这些策略可以定义为负载均衡配置、连接池大小和外部检测（用于识别和驱逐负载均衡池中不健康的主机）配置。\n- EnvoyFilter。EnvoyFilter 对象描述了代理服务的过滤器，可以自定义 Istio Pilot 生成的代理配置。这种配置一般很少被主用户使用。\n- ServiceEntry。默认情况下，Istio 服务 Mesh 中的服务无法发现 Mesh 之外的服务。ServiceEntry 可以在 Istio 内部的服务注册表中添加额外的条目，从而允许 Mesh 中自动发现的服务访问并路由到这些手动添加的服务。\n\n## Kubernetes vs xDS vs Istio\n\n在回顾了 Kubernetes 的 kube-proxy 组件、xDS 和 Istio 对流量管理的抽象后，现在我们仅从流量管理的角度来看看这三个组件 \/ 协议的比较（注意，三者并不完全等同）。\n\n| **Kubernetes** | **xDS**  | **Istio service mesh** |\n| -------------- | -------- | ---------------------- |\n| Endpoint       | Endpoint | WorkloadEntry          |\n| Service        | Route    | VirtualService         |\n| kube-proxy     | Route    | DestinationRule        |\n| kube-proxy     | Listener | EnvoyFilter            |\n| Ingress        | Listener | Gateway                |\n| Service        | Cluster  | ServiceEntry           |\n\n## 核心观点\n\n- Kubernetes 的本质是应用生命周期管理，具体来说就是部署和管理（伸缩、自动恢复、发布）。\n- Kubernetes 为微服务提供了一个可扩展、高弹性的部署和管理平台。\n- 服务网格是基于透明代理，通过 sidecar 代理拦截服务之间的流量，然后通过控制平面配置管理它们的行为。\n- 服务网格将流量管理与 Kubernetes 解耦，不需要 kube-proxy 组件来支持服务网格内的流量；通过提供更接近微服务应用层的抽象来管理服务间的流量、安全性和可观测性。\n- xDS 是服务网格的协议标准之一。\n- 服务网格是 Kubernetes 中服务的一个更高层次的抽象。\n\n## 总结\n\n如果说 Kubernetes 管理的对象是一个 pod，那么服务网格管理的对象就是一个服务，所以用 Kubernetes 管理微服务，然后应用服务网格就可以了。如果你连服务都不想管理，那就用 [Knative](https:\/\/knative.dev\/) 这样的无服务器平台，不过这是后话。\n', '\/blog\/why-do-you-need-istio-when-you-already-have-kubernetes\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文将带大家了解 Kubernetes 和 Istio 的内部工作原理。此外，我会介绍 Kubernetes 中的负载均衡方法，并解释为什么有了 Kubernetes 后可能还需要 Istio。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
 <nav aria-label="Page navigation">
   <ul class="pagination justify-content-center">
     
     
     <li class="page-item">
       <a class="page-link" href="/blog/">
         ««
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a href="/blog/page/18/" class="page-link">
         «
       </a>
     </li>
     
     
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/17/" class="page-link">
             17
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/18/" class="page-link">
             18
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item page-item active ">
           <a href="/blog/page/19/" class="page-link">
             19
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/20/" class="page-link">
             20
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/21/" class="page-link">
             21
           </a>
         </li>
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
     
     
     <li class="page-item">
       <a href="/blog/page/20/" class="page-link">
         »
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a class="page-link" href="/blog/page/25/">
         »»
       </a>
     </li>
     
   </ul>
 </nav>
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      专栏
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(69)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(38)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(24)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>随笔</span>
            <span>(20)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>业态</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(16)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>云原生</span>
            <span>(13)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>其他</span>
            <span>(13)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>安全</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>开源</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>可观测性</span>
            <span>(5)</span>
        </a>
      
        <a href="/categories/%e5%ae%b9%e5%99%a8" class="sidebar-item">
            <span>容器</span>
            <span>(4)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>旅行</span>
            <span>(4)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      资料
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>出版物</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>翻译电子书</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>翻译文档</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>翻译图书</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>原创图书</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>教程手册</span>
            <span>(1)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/envoy-gateway-integration-istio-mesh/">集成 Envoy Gateway 作为 Istio 服务网格中的入口网关</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-configuration-safety-common-misconfigurations/">Istio 配置安全：如何避免错误配置</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/securing-istio-addressing-critical-security-gaps-and-best-practices/">保障 Istio 安全：解决关键安全漏洞及最佳实践</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024 圆桌论坛预告：Istio 和现代 API 网关——引领服务网格的未来</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">网站改版通知</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-meetup-dalian-2024/">2024 大连云原生技术开放日</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
