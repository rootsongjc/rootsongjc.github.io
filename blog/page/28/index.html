<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>博客 - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="专注开源技术、云原生与生活随笔的分享与思考。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.f6911c0ac7d2b5b69c3f2d9f2a2b3b496b5da0608580347fdb4dc11ef74f3ec5.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.f6911c0ac7d2b5b69c3f2d9f2a2b3b496b5da0608580347fdb4dc11ef74f3ec5.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/blog/" />
  <meta property="og:title" content="博客 | Jimmy Song" />
  <meta property="twitter:title" content="博客 | Jimmy Song" />

  
  <meta property="og:description" content="专注开源技术、云原生与生活随笔的分享与思考。" />
  <meta property="twitter:description" content="专注开源技术、云原生与生活随笔的分享与思考。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    <a class="nav-link" href="/en/blog/">English</a>
                    
                  
                
              
              
              
                
                  
                    
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    博客
                </p>
                <p class="page-description">
                    专注开源技术、云原生与生活随笔的分享与思考。
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/keuc-china-2017/">记 Kubernetes 中国用户大会 KEUC 2017</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/10/14</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e9%9a%8f%e7%ac%94"> 
             随笔
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('记 Kubernetes 中国用户大会 KEUC 2017', '2017 年 10 月 15 日，杭州，一场顶级的 Kubernetes 行业用户落地大会。', '\n今天受 k8smeetup 社区邀请来到杭州，参加 Kubernetes 中国用户大会简称 [KEUC](http:\/\/keuc.k8smeetup.com\/)，这已经是我第三次来杭州了，算是再续前缘吧！\n\n其实今年 6 月 19 日 LinuxCon \u002b ContainerCon \u002b CloudOpen 简称 [L3 大会](https:\/\/www.bagevent.com\/event\/561769)在北京国家会议中心召开，那是我跟 [CNCF](https:\/\/cncf.io) 首次相会，也获得了我的首批贴纸，该社区的一系列活动吸引了我浓浓的兴趣，自那以后开始持续关注 CNCF 的社区活动。\n\n借用孙中山先生在黄埔军校的训词，愿 Kubernetes 携手云原生应用，让 IT 基础设施和软件开发流程进入新的纪元。\n\n**云原生主义歌**\n\n\u003e 库巴内提，吾辈所宗；携云原生，以进大同。\n\u003e 咨尔多士，为民前锋；夙夜匪懈，主义是从。\n\u003e 创业维艰，矢勤矢勇；同心共德，贯彻始终。\n\n祝愿明天的大会圆满成功！\n\n---\n\n今天不小心获得了 k8smeetup 最佳技术专栏作者和社区最佳译者奖，感谢 CNCF 和 k8smeetup 社区。\n\n![k8smeetup 译者合影](kubc-translator.jpg)\n\n然后跟 CNCF 执行副总裁 Dan Kohn 探讨了下云原生技术在中国的推广，明年在中国会有云原生相关大会。\n\n![Jimmy 和 CNCF 执行副总裁 Dan Kohn 在一起](keuc-with-dan-kohn.jpg)\n\n欢迎大家持续关注云原生的发展。\n', '\/blog\/keuc-china-2017\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">2017 年 10 月 15 日，杭州，一场顶级的 Kubernetes 行业用户落地大会。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/what-is-a-service-mesh/">什么是 Service Mesh（服务网格）？</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/09/20</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('什么是 Service Mesh（服务网格）？', '本文介绍了 Service Mesh 是什么，其工作原理并提供了一些有用的链接。', '\nService Mesh 又译作“服务网格”，作为服务间通信的基础设施层。Buoyant 公司的 CEO Willian Morgan 在他的这篇文章 WHAT’S A Service Mesh? AND WHY DO I NEED ONE? 中解释了什么是 Service Mesh，为什么云原生应用需要 Service Mesh。\n\n下面是 [Willian Morgan](https:\/\/twitter.com\/wm) 对 Service Mesh 的解释。\n\n\u003e A Service Mesh is a dedicated infrastructure layer for handling service-to-service communication. It’s responsible for the reliable delivery of requests through the complex topology of services that comprise a modern, cloud native application. In practice, the Service Mesh is typically implemented as an array of lightweight network proxies that are deployed alongside application code, without the application needing to be aware.\n\n翻译成中文是：\n\n\u003e 服务网格（Service Mesh）是处理服务间通信的基础设施层。它负责构成现代云原生应用程序的复杂服务拓扑来可靠地交付请求。在实践中，Service Mesh 通常以轻量级网络代理阵列的形式实现，这些代理与应用程序代码部署在一起，对应用程序来说无需感知代理的存在。\n\n## Service Mesh 的特点\n\nService Mesh 有如下几个特点：\n\n- 应用程序间通信的中间层\n- 轻量级网络代理\n- 应用程序无感知\n- 解耦应用程序的重试\/超时、监控、追踪和服务发现\n\n目前两款流行的 Service Mesh 开源软件 [Istio](https:\/\/istio.io) 和 [Linkerd](https:\/\/linkerd.io) 都可以直接在 Kubernetes 中集成，其中 Linkerd 已经成为 CNCF 中的项目。\n\n## 理解 Service Mesh\n\n如果用一句话来解释什么是 Service Mesh，可以将它比作是应用程序或者说微服务间的 TCP\/IP，负责服务之间的网络调用、限流、熔断和监控。对于编写应用程序来说一般无须关心 TCP\/IP 这一层（比如通过 HTTP 协议的 RESTful 应用），同样使用 Service Mesh 也就无须关心服务之间的那些原本通过服务框架实现的事情，比如 Spring Cloud、Netflix OSS 和其他中间件，现在只要交给 Service Mesh 就可以了。\n\n[Phil Calçado](http:\/\/philcalcado.com\/) 在他的这篇博客 [Pattern: Service Mesh](http:\/\/philcalcado.com\/2017\/08\/03\/pattern_service_mesh.html) 中详细解释了 Service Mesh 的来龙去脉：\n\n1. 从最原始的主机之间直接使用网线相连\n2. 网络层的出现\n3. 集成到应用程序内部的控制流\n4. 分解到应用程序外部的控制流\n5. 应用程序的中集成服务发现和断路器\n6. 出现了专门用于服务发现和断路器的软件包\/库，如 [Twitter 的 Finagle](https:\/\/finagle.github.io\/) 和 [Facebook  的 Proxygen](https:\/\/code.facebook.com\/posts\/1503205539947302)，这时候还是集成在应用程序内部\n7. 出现了专门用于服务发现和断路器的开源软件，如 [Netflix OSS](http:\/\/netflix.github.io\/)、Airbnb 的 [synapse](https:\/\/github.com\/airbnb\/synapse) 和 [nerve](https:\/\/github.com\/airbnb\/nerve)\n8. 最后作为微服务的中间层 Service Mesh 出现\n\nService Mesh 的架构如下图所示：\n\n![Service Mesh 架构图](service-mesh-arch.png)\n\n图片来自：[Pattern: Service Mesh](http:\/\/philcalcado.com\/2017\/08\/03\/pattern_service_mesh.html)\n\nService Mesh 作为 sidecar 运行，对应用程序来说是透明，所有应用程序间的流量都会通过它，所以对应用程序流量的控制都可以在 Service mesh 中实现。\n\n## Service Mesh 如何工作？\n\n下面以 Istio 为例讲解 Service Mesh 如何工作，后续文章将会详解 Istio 如何在 Kubernetes 中工作。\n\n1. Sidecar（Istio 中使用 [Envoy](https:\/\/envoyproxy.io) 作为 sidecar 代理）将服务请求路由到目的地址，根据请求中的参数判断是到生产环境、测试环境还是 staging 环境中的服务（服务可能同时部署在这三个环境中），是路由到本地环境还是公有云环境？所有的这些路由信息可以动态配置，可以是全局配置也可以为某些服务单独配置。这些配置是由服务网格的控制平面推送给各个 sidecar 的，\n2. 当 sidecar 确认了目的地址后，将流量发送到相应服务发现端点，在 Kubernetes 中是 service，然后 service 会将服务转发给后端的实例。\n3. Sidecar 根据它观测到最近请求的延迟时间，选择出所有应用程序的实例中响应最快的实例。\n4. Sidecar 将请求发送给该实例，同时记录响应类型和延迟数据。\n5. 如果该实例挂了、不响应了或者进程不工作了，sidecar 会将把请求发送到其他实例上重试。\n6. 如果该实例持续返回 error，sidecar 会将该实例从负载均衡池中移除，稍后再周期性得重试。\n7. 如果请求的截止时间已过，sidecar 主动标记该请求为失败，而不是再次尝试添加负载。\n8. SIdecar 以 metric 和分布式追踪的形式捕获上述行为的各个方面，这些追踪信息将发送到集中 metric 系统。\n\n## 为何使用 Service Mesh？\n\nService Mesh 并没有给我们带来新功能，它是用于解决其他工具已经解决过的问题，只不过这次是在以 Kubernetes 为基础的云原生生态环境下的实现。\n\n在传统的 MVC 三层 Web 应用程序架构下，服务之间的通讯并不复杂，在应用程序内部自己管理即可，但是在现今的复杂的大型网站情况下，单体应用被分解为众多的微服务，服务之间的依赖和通讯十分复杂，出现了 twitter 开发的 [Finagle](https:\/\/twitter.github.io\/finagle\/)、Netflix 开发的 [Hystrix](https:\/\/github.com\/Netflix\/Hystrix) 和 Google 的 Stubby 这样的“胖客户端”库，这些就是早期的 Service Mesh，但是它们都仅适用于特定的环境和特定的开发语言，并不能作为平台级的 Service Mesh 支持。\n\n在 Cloud Native 架构下，容器的使用赋予了异构应用程序更多的可能性，Kubernetes 增强了应用的横向扩容能力，用户可以快速的编排出复杂环境、复杂依赖关系的应用程序，同时开发者又无须过分关心应用程序的监控、扩展性、服务发现和分布式追踪这些繁琐的事情，进而专注于程序开发，赋予开发者更多的创造性。\n\n## 参考\n\n- What\u0027s a Service Mesh? And why do I need one?\n- [So what even is a Service Mesh? Hot take on Istio and Linkerd](http:\/\/redmonk.com\/jgovernor\/2017\/05\/31\/so-what-even-is-a-service-mesh-hot-take-on-istio-and-linkerd)\n- [linkerd: A Service Mesh for AWS ECS](https:\/\/medium.com\/attest-engineering\/linkerd-a-service-mesh-for-aws-ecs-937f201f847a)\n- [Introducing Istio: A robust Service Mesh for microservices](https:\/\/istio.io\/blog\/istio-service-mesh-for-microservices.html)\n- [Application Network Functions With ESBs, API Management, and Now.. Service Mesh?](http:\/\/blog.christianposta.com\/microservices\/application-network-functions-with-esbs-api-management-and-now-service-mesh\/)\n- [Pattern: Service Mesh](http:\/\/philcalcado.com\/2017\/08\/03\/pattern_service_mesh.html)\n- [Envoy 官方文档](https:\/\/envoyproxy.io)\n- [Istio 官方文档](https:\/\/istio.io\/)\n\n', '\/blog\/what-is-a-service-mesh\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文介绍了 Service Mesh 是什么，其工作原理并提供了一些有用的链接。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/deploy-applications-in-kubernetes/">适用于 Kubernetes 的应用开发与部署流程详解</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/07/20</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('适用于 Kubernetes 的应用开发与部署流程详解', '本文以在 Kubernetes 中部署两个应用来说明。', '\n本文已归档在[kubernetes-handbook](https:\/\/github.com\/rootsongjc\/kubernetes-handbook)中的第 3 章【用户指南】中，一切更新以 kubernetes-handbook 中为准。\n\n为了详细说明，我特意写了两个示例程序放在 GitHub 中，模拟应用开发流程：\n\n- [k8s-app-monitor-test](https:\/\/github.com\/rootsongjc\/k8s-app-monitor-test)：生成模拟的监控数据，发送 http 请求，获取 json 返回值\n- [K8s-app-monitor-agent](https:\/\/github.com\/rootsongjc\/k8s-app-monitor-agent)：获取监控数据并绘图，访问浏览器获取图表\n\nAPI 文档见[k8s-app-monitor-test](https:\/\/github.com\/rootsongjc\/k8s-app-monitor-test)中的\u0060api.html\u0060文件，该文档在 API blueprint 中定义，使用[aglio](https:\/\/github.com\/danielgtaylor\/aglio)生成，打开后如图所示：\n\n![API 文档](k8s-app-monitor-test-api-doc.jpg)\n\n**关于服务发现**\n\n\u0060K8s-app-monitor-agent\u0060服务需要访问\u0060k8s-app-monitor-test\u0060服务，这就涉及到服务发现的问题，我们在代码中直接写死了要访问的服务的内网 DNS 地址（kubedns 中的地址，即\u0060k8s-app-monitor-test.default.svc.cluster.local\u0060）。\n\n我们知道 Kubernetes 在启动 Pod 的时候为容器注入环境变量，这些环境变量在所有的 namespace 中共享（环境变量是不断追加的，新启动的 Pod 中将拥有老的 Pod 中所有的环境变量，而老的 Pod 中的环境变量不变）。但是既然使用这些环境变量就已经可以访问到对应的 service，那么获取应用的地址信息，究竟是使用变量呢？还是直接使用 DNS 解析来发现？\n\n答案是使用 DNS，详细说明见[Kubernetes 中的服务发现与 Docker 容器间的环境变量传递源码探究](\/blog\/exploring-kubernetes-env-with-docker\/)。\n\n**打包镜像**\n\n因为我使用 wercker 自动构建，构建完成后自动打包成 docker 镜像并上传到 docker hub 中（需要提前在 docker hub 中创建 repo），如何使用 wercker 做持续构建与发布，并集成 docker hub 插件请参考[使用 Wercker 进行持续构建与发布](\/blog\/continuous-integration-with-wercker\/)。\n\n[查看详细构建流程](https:\/\/app.wercker.com\/jimmysong\/k8s-app-monitor-agent\/)\n\n![wercker](k8s-app-monitor-agent-wercker.jpg)\n\n生成了如下两个 docker 镜像：\n\n- jimmysong\/k8s-app-monitor-test:latest\n- jimmysong\/k8s-app-monitor-agent:latest\n\n**启动服务**\n\n所有的 kubernetes 应用启动所用的 yaml 配置文件都保存在那两个 GitHub 仓库的\u0060manifest.yaml\u0060文件中。\n\n分别在两个 GitHub 目录下执行\u0060kubectl create -f manifest.yaml\u0060即可启动服务。\n\n**外部访问**\n\n服务启动后需要更新 ingress 配置，在[ingress.yaml](https:\/\/github.com\/rootsongjc\/kubernetes-handbook\/blob\/master\/manifests\/traefik-ingress\/ingress.yaml)文件中增加以下几行：\n\n\u0060\u0060\u0060Yaml\n  - host: k8s-app-monitor-agent.jimmysong.io\n    http:\n      paths:\n      - path: \/\n        backend:\n          serviceName: k8s-app-monitor-agent\n          servicePort: 8080\n\u0060\u0060\u0060\n\n保存后，然后执行\u0060kubectl replace -f ingress.yaml\u0060即可刷新 ingress。\n\n修改本机的\u0060\/etc\/hosts\u0060文件，在其中加入以下一行：\n\n\u0060\u0060\u0060ini\n172.20.0.119 k8s-app-monitor-agent.jimmysong.io\n\u0060\u0060\u0060\n\n当然你也可以加入到 DNS 中，为了简单起见我使用 hosts。\n\n详见[边缘节点配置](https:\/\/github.com\/rootsongjc\/kubernetes-handbook\/blob\/master\/practice\/edge-node-configuration.md)。\n\n在浏览器中访问 http:\/\/k8s-app-monitor-agent.jimmysong.io\n\n![图表](k8s-app-monitor-agent.jpg)\n\n刷新页面将获得新的图表。\n\n## 参考\n\n- [使用 Wercker 进行持续构建与发布](\/blog\/continuous-integration-with-wercker\/)\n- [示例的项目代码服务器端](https:\/\/app.wercker.com\/jimmysong\/k8s-app-monitor-agent\/)\n- [示例项目代码前端](https:\/\/github.com\/rootsongjc\/k8s-app-monitor-agent)\n- [kubernetes-handbok](\/book\/kubernetes-handbook\/)\n- [边缘节点配置](https:\/\/github.com\/rootsongjc\/kubernetes-handbook\/blob\/master\/practice\/edge-node-configuration.md)\n', '\/blog\/deploy-applications-in-kubernetes\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文以在 Kubernetes 中部署两个应用来说明。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/book-kubernetes-management-design-patterns/">记一本关于 kubernetes management design patterns 的书</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/07/20</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('记一本关于 kubernetes management design patterns 的书', '本书有两个优点，一个是每个章节都给出了问题的起因和 kubernetes 的解决方案，二是几乎所有的命令和操作都附有截图，说明很详细。', '\n下面是这本书的基本信息。\n\n- 书名：Kubernetes Management Design Patterns: With Docker, CoreOS Linux, and Other Platforms\n- Amazon 购买链接：[链接](https:\/\/www.amazon.com\/Kubernetes-Management-Design-Patterns-Platforms-ebook\/dp\/B01MZDO0BD\/ref=pd_sbs_351_4?_encoding=UTF8\u0026psc=1\u0026refRID=79F47CR67EEESD35S2VF)\n- 作者：Deepak Vohra\n- 发行日期：2017 年 1 月 20 日\n- 出版社：Apress\n- 页数：399\n\n### 简介\n\nKubernetes 引领容器集群管理进入一个全新的阶段；学习如何在 CoreOS 上配置和管理 kubernetes 集群；使用适当的管理模式，如 ConfigMaps、Autoscaling、弹性资源使用和高可用性配置。讨论了 kubernetes 的一些其他特性，如日志、调度、滚动升级、volume、服务类型和跨多个云供应商 zone。\n\nKubernetes 中的最小模块化单位是 Pod，它是拥有共同的文件系统和网络的系列容器的集合。Pod 的抽象层可以对容器使用设计模式，就像面向对象设计模式一样。容器能够提供与软件对象（如模块化或包装，抽象和重用）相同的优势。\n\n在大多数章节中使用的都是 CoreOS Linux，其他讨论的平台有 CentOS，OpenShift，Debian 8（jessie），AWS 和 Debian 7 for Google Container Engine。\n\n使用 CoreOS 主要是因为 Docker 已经在 CoreOS 上开箱即用。CoreOS：\n\n- 支持大多数云提供商（包括 Amazon AWS EC2 和 Google Cloud Platform）和虚拟化平台（如 VMWare 和 VirtualBox）\n- 提供 Cloud-Config，用于声明式配置 OS，如网络配置（flannel），存储（etcd）和用户帐户\n- 为容器化应用提供生产级基础架构，包括自动化，安全性和可扩展性\n- 引领容器行业标准，并建立了应用程序标准\n- 提供最先进的容器仓库，Quay\n\nDocker 于 2013 年 3 月开源，现已称为最流行的容器平台。kubernetes 于 2014 年 6 月开源，现在已经成为最流行的容器集群管理平台。第一个稳定版 CoreOS Linux 于 2014 年 7 月发行，现已成为最流行的容器操作系统之一。\n\n### 你将学到什么\n\n- 使用 docker 和 kubernetes\n- 在 AWS 和 CoreOS 上创建 kubernetes 集群\n- 应用集群管理设计模式\n- 使用多个云供应商 zone\n- 使用 Ansible 管理 kubernetes\n- 基于 kubernetes 的 PAAS 平台 OpenShift\n- 创建高可用网站\n- 构建高可用用的 kubernetes master 集群\n- 使用 volume、configmap、Service、autoscaling 和 rolling update\n- 管理计算资源\n- 配置日志和调度\n\n### 谁适合读这本书\n\nLinux 管理员、CoreOS 管理员、应用程序开发者、容器即服务（CAAS）开发者。阅读这本书需要 Linux 和 Docker 的前置知识。介绍 Kubernetes 的知识，例如创建集群，创建 Pod，创建 service 以及创建和缩放 replication controller。还需要一些关于使用 Amazon Web Services（AWS）EC2，CloudFormation 和 VPC 的必备知识。\n\n### 关于作者\n\n**Deepak Vohra** is an Oracle Certified Associate and a Sun Certified Java Programmer. Deepak has published in Oracle Magazine, OTN, IBM developerWorks, ONJava, DevSource,  WebLogic Developer’s Journal, XML Journal, Java Developer’s Journal, FTPOnline, and devx.\n\n### 目录\n\n- 第一部分：平台\n  - 第 1 章：Kuberentes on AWS\n  - 第 2 章：kubernetes on CoreOS on AWS\n  - 第 3 章：kubernetes on Google Cloud Platform\n- 第二部分：管理和配置\n  - 第 4 章：使用多个可用区\n  - 第 5 章：使用 Tectonic Console\n  - 第 6 章：使用 volume\n  - 第 7 章：使用 service\n  - 第 8 章：使用 Rolling updte\n  - 第 9 章：在 node 上调度 pod\n  - 第 10 章：配置计算资源\n  - 第 11 章：使用 ConfigMap\n  - 第 12 章：使用资源配额\n  - 第 13 章：使用 Autoscaling\n  - 第 14 章：配置 logging\n- 第三部分：高可用\n  - 第 15 章：在 OpenShift 中使用 HA master\n  - 第 16 章：开发高可用网站\n\n### 个人评价\n\n本书更像是一本参考手册，对于想在公有云中（如 AWS、Google Cloud Platform）中尝试 Kubernetes 的人会有所帮助，而对于想使用 kubernetes 进行自己的私有云建设，或想了解 kubernetes 的实现原理和技术细节的人来说，就不适合了。对我来说，本书中有个别几个章节可以参考，如高可用，但还是使用 OpenShift 实现的。总之，如果你使用 AWS 这样的公有云，对操作系统没有特别要求，可以接受 CoreOS 的话，那么可以看看这本书。本来本书会对 kubernetes 中的各种应用模式能够有个详解，但是从书中我并没有找到。\n\n本书有两个优点，一个是每个章节都给出了问题的起因和 kubernetes 的解决方案，二是几乎所有的命令和操作都附有截图，说明很详细。\n\n', '\/blog\/book-kubernetes-management-design-patterns\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本书有两个优点，一个是每个章节都给出了问题的起因和 kubernetes 的解决方案，二是几乎所有的命令和操作都附有截图，说明很详细。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/exploring-kubernetes-env-with-docker/">Kubernetes 中的服务发现与 docker 容器间的环境变量传递源码探究</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/07/19</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Kubernetes 中的服务发现与 docker 容器间的环境变量传递源码探究', '基于实际应用研究。', '\n## 前言\n\n今天创建了两个 kubernetes 示例应用：\n\n- [k8s-app-monitor-test](https:\/\/github.com\/rootsongjc\/k8s-app-monitor-test)：启动 server 用来产生 metrics\n- [k8s-app-monitor-agent](https:\/\/github.com\/rootsongjc\/k8s-app-monitor-agent)：获取 metrics 并绘图，显示在 web 上\n\n*注：相关的 kubernetes 应用\u0060manifest.yaml\u0060文件分别见以上两个应用的 GitHub。*\n\n当我查看 Pod 中的环境变量信息时，例如 kubernetes 中的 service \u0060k8s-app-monitor-test\u0060注入的环境变量时，包括了以下变量：\n\n\u0060\u0060\u0060ini\nK8S_APP_MONITOR_TEST_PORT_3000_TCP_ADDR=10.254.56.68\nK8S_APP_MONITOR_TEST_PORT=tcp:\/\/10.254.56.68:3000\nK8S_APP_MONITOR_TEST_PORT_3000_TCP_PROTO=tcp\nK8S_APP_MONITOR_TEST_SERVICE_PORT_HTTP=3000\nK8S_APP_MONITOR_TEST_PORT_3000_TCP_PORT=3000\nK8S_APP_MONITOR_TEST_PORT_3000_TCP=tcp:\/\/10.254.56.68:3000\nK8S_APP_MONITOR_TEST_SERVICE_HOST=10.254.56.68\nK8S_APP_MONITOR_TEST_SERVICE_PORT=3000\n\u0060\u0060\u0060\n\n我们知道 Kubernetes 在启动 Pod 的时候为容器注入环境变量，这些环境变量将在该 Pod 所在的 namespace 中共享。但是既然使用这些环境变量就已经可以访问到对应的 service，那么获取应用的地址信息，究竟是使用变量呢？还是直接使用 DNS 解析来发现？下面我们从代码中来寻求答案。\n\n如果不想看下面的文字，可以直接看图。\n\n![kubernetes 中传递 ENV 的探索过程](kubernetes-service-discovery-with-dns-or-env.png)\n\n## 探索\n\ndocker 的\u0060docker\/engine-api\/types\/container\/config.go\u0060中的\u0060Config\u0060结构体中有对环境变量的定义：\n\n\u0060\u0060\u0060Go\n\/\/ Config contains the configuration data about a container.\n\/\/ It should hold only portable information about the container.\n\/\/ Here, \u0022portable\u0022 means \u0022independent from the host we are running on\u0022.\n\/\/ Non-portable information *should* appear in HostConfig.\n\/\/ All fields added to this struct must be marked \u0060omitempty\u0060 to keep getting\n\/\/ predictable hashes from the old \u0060v1Compatibility\u0060 configuration.\ntype Config struct {\n\tHostname        string                \/\/ Hostname\n\tDomainname      string                \/\/ Domainname\n\tUser            string                \/\/ User that will run the command(s) inside the container\n...\n\tEnv             []string              \/\/ List of environment variable to set in the container\n\tCmd             strslice.StrSlice     \/\/ Command to run when starting the container\n\t...\n}\n\u0060\u0060\u0060\n\nKubernetes 中在\u0060pkg\/kubelet\/container\/runtime.go\u0060中的\u0060RunContainerOptions\u0060结构体中定义：\n\n\u0060\u0060\u0060go\n\/\/ RunContainerOptions specify the options which are necessary for running containers\ntype RunContainerOptions struct {\n\t\/\/ The environment variables list.\n\tEnvs []EnvVar\n  \t\/\/ The mounts for the containers.\n\tMounts []Mount\n\t\/\/ The host devices mapped into the containers.\n...\n}\n\u0060\u0060\u0060\n\nKubelet 向容器中注入环境变量的配置是在下面的方法中定义：\n\n\u0060\u0060\u0060ini\npkg\/kubelet\/kuberuntime\/kuberuntime_container.go\n\u0060\u0060\u0060\n\n\u0060\u0060\u0060Go\n\/\/ generateContainerConfig generates container config for kubelet runtime v1.\nfunc (m *kubeGenericRuntimeManager) generateContainerConfig(container *v1.Container, pod *v1.Pod, restartCount int, podIP, imageRef string) (*runtimeapi.ContainerConfig, error) {\n    opts, _, err := m.runtimeHelper.GenerateRunContainerOptions(pod, container, podIP)\n    ...\n\t\/\/ set environment variables\n\tenvs := make([]*runtimeapi.KeyValue, len(opts.Envs))\n\tfor idx := range opts.Envs {\n\t\te := opts.Envs[idx]\n\t\tenvs[idx] = \u0026runtimeapi.KeyValue{\n\t\t\tKey:   e.Name,\n\t\t\tValue: e.Value,\n\t\t}\n\t}\n\tconfig.Envs = envs\n\n\treturn config, nil\n}\n\u0060\u0060\u0060\n\nkubelet 的\u0060pkg\/kubelet\/kubelet_pods.go\u0060的如下方法中生成了\u0060RunContainerOptions\u0060：\n\n\u0060\u0060\u0060Go\n\/\/ GenerateRunContainerOptions generates the RunContainerOptions, which can be used by\n\/\/ the container runtime to set parameters for launching a container.\nfunc (kl *Kubelet) GenerateRunContainerOptions(pod *v1.Pod, container *v1.Container, podIP string) (*kubecontainer.RunContainerOptions, bool, error) {\n\t...\n\topts := \u0026kubecontainer.RunContainerOptions{CgroupParent: cgroupParent}\n\t...\n\topts.Envs, err = kl.makeEnvironmentVariables(pod, container, podIP)\n    return opts, useClusterFirstPolicy, nil\n}\n\u0060\u0060\u0060\n\n我们再看下\u0060makeEnvironmentVariables(pod, container, podIP)\u0060方法中又做了什么（该方法也在\u0060pkg\/kubelet\/kubelet_pods.go\u0060文件中）。\n\n\u0060\u0060\u0060Go\n\/\/ Make the environment variables for a pod in the given namespace.\nfunc (kl *Kubelet) makeEnvironmentVariables(pod *v1.Pod, container *v1.Container, podIP string) ([]kubecontainer.EnvVar, error) {\n\tvar result []kubecontainer.EnvVar\n\t\/\/ Note:  These are added to the docker Config, but are not included in the checksum computed\n\t\/\/ by dockertools.BuildDockerName(...).  That way, we can still determine whether an\n\t\/\/ v1.Container is already running by its hash. (We don\u0027t want to restart a container just\n\t\/\/ because some service changed.)\n\t\/\/\n\t\/\/ Note that there is a race between Kubelet seeing the pod and kubelet seeing the service.\n\t\/\/ To avoid this users can: (1) wait between starting a service and starting; or (2) detect\n\t\/\/ missing service env var and exit and be restarted; or (3) use DNS instead of env vars\n\t\/\/ and keep trying to resolve the DNS name of the service (recommended).\n\t...\n}\n\u0060\u0060\u0060\n\n该代码段比较长，kubernetes 究竟如何将环境变量注入到 docker 容器中的奥秘就在这里，按图索骥到了这里，从代码注释中已经可以得出结论，使用 DNS 解析而不要使用环境变量来做服务发现，究竟为何这样做，改天我们再详细解读。\n', '\/blog\/exploring-kubernetes-env-with-docker\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">基于实际应用研究。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/distributed-load-testing-using-kubernetes/">使用 Kubernetes 进行分布式负载测试</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/04/24</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('使用 Kubernetes 进行分布式负载测试', '该教程描述如何在 Kubernetes 中进行分布式负载均衡测试。', '\n## 前言\n\n本示例来自 [GitHub - distributed-load-testing-using-kubernetes](https:\/\/github.com\/rootsongjc\/distributed-load-testing-using-kubernetes)。\n\n该教程描述如何在[Kubernetes](http:\/\/kubernetes.io)中进行分布式负载均衡测试，包括一个 web 应用、docker 镜像和 Kubernetes controllers\/services。更多资料请查看[Distributed Load Testing Using Kubernetes](http:\/\/cloud.google.com\/solutions\/distributed-load-testing-using-kubernetes) 。\n\n**注意：该测试是在我自己本地搭建的 kubernetes 集群上测试的，不需要使用 Google Cloud Platform。**\n\n## 准备\n\n**不需要 GCE 及其他组件，你只需要有一个 kubernetes 集群即可。**\n\n## 部署 Web 应用\n\n \u0060sample-webapp\u0060 目录下包含一个简单的 web 测试应用。我们将其构建为 docker 镜像，在 kubernetes 中运行。你可以自己构建，也可以直接用这个我构建好的镜像\u0060index.tenxcloud.com\/jimmy\/k8s-sample-webapp:latest\u0060。\n\n在 kubernetes 上部署 sample-webapp。\n\n\u0060\u0060\u0060bash\n$ cd kubernetes-config\n$ kubectl create -f sample-webapp-controller.yaml\n$ kubectl create -f kubectl create -f sample-webapp-service.yaml\n\u0060\u0060\u0060\n\n## 部署 Locust 的 Controller 和 Service\n\n\u0060locust-master\u0060和\u0060locust-work\u0060使用同样的 docker 镜像，修改 cotnroller 中\u0060spec.template.spec.containers.env\u0060字段中的 value 为你\u0060sample-webapp\u0060 service 的名字。\n\n\u0060\u0060\u0060yaml\n- name: TARGET_HOST\n  value: http:\/\/sample-webapp:8000\n\u0060\u0060\u0060\n\n### 创建 Controller Docker 镜像（可选）\n\n\u0060locust-master\u0060和\u0060locust-work\u0060 controller 使用的都是\u0060locust-tasks\u0060 docker 镜像。你可以直接下载，也可以自己编译。自己编译大概要花几分钟时间，镜像大小为 820M。\n\n\u0060\u0060\u0060bash\n$ docker build -t index.tenxcloud.com\/jimmy\/locust-tasks:latest .\n$ docker push index.tenxcloud.com\/jimmy\/locust-tasks:latest\n\u0060\u0060\u0060\n\n**注意**：我使用的是时速云的镜像仓库。\n\n每个 controller 的 yaml 的\u0060spec.template.spec.containers.image\u0060 字段指定的是我的镜像：\n\n\u0060\u0060\u0060yaml\nimage: index.tenxcloud.com\/jimmy\/locust-tasks:latest\n\u0060\u0060\u0060\n\n### 部署 locust-master\n\n\u0060\u0060\u0060bash\n$ kubectl create -f locust-master-controller.yaml\n$ kubectl create -f locust-master-service.yaml\n\u0060\u0060\u0060\n\n### 部署 locust-worker\n\nNow deploy \u0060locust-worker-controller\u0060:\n\n\u0060\u0060\u0060bash\n$ kubectl create -f locust-worker-controller.yaml\n\u0060\u0060\u0060\n\n你可以很轻易的给 work 扩容，通过命令行方式：\n\n\u0060\u0060\u0060bash\n$ kubectl scale --replicas=20 replicationcontrollers locust-worker\n\u0060\u0060\u0060\n\n当然你也可以通过 WebUI：Dashboard - Workloads - Replication Controllers - **ServiceName** - Scale 来扩容。\n\n![Dashboard](dashbaord-scale.jpg)\n\n### 配置 Traefik\n\n参考[kubernetes 的 traefik ingress 安装](https:\/\/jimmysong.io\/posts\/traefik-ingress-installation\/)，在\u0060ingress.yaml\u0060中加入如下配置：\n\n\u0060\u0060\u0060Yaml\n  - host: traefik.locust.io\n    http:\n      paths:\n      - path: \/\n        backend:\n          serviceName: locust-master\n          servicePort: 8089\n\u0060\u0060\u0060\n\n然后执行\u0060kubectl replace -f ingress.yaml\u0060即可更新 traefik。\n\n通过 Traefik 的 dashboard 就可以看到刚增加的\u0060traefik.locust.io\u0060节点。\n\n![Traefik dashboard](traefik-dashboard-locust.jpg)\n\n## 执行测试\n\n打开\u0060http:\/\/traefik.locust.io\u0060页面，点击\u0060Edit\u0060输入伪造的用户数和用户每秒发送的请求个数，点击\u0060Start Swarming\u0060就可以开始测试了。\n\n![启动 locust](locust-start-swarming.jpg)\n\n在测试过程中调整\u0060sample-webapp\u0060的 pod 个数（默认设置了 1 个 pod），观察 pod 的负载变化情况。\n\n![示例 Web 应用](sample-webapp-rc.jpg)\n\n从一段时间的观察中可以看到负载被平均分配给了 3 个 pod。\n\n在 locust 的页面中可以实时观察也可以下载测试结果。\n\n![Locust dashboard](locust-dashboard.jpg)\n\n## 参考\n\n- [Distributed Load Testing Using Kubernetes](https:\/\/cloud.google.com\/solutions\/distributed-load-testing-using-kubernetes)\n- [运用 Kubernetes 进行分布式负载测试](http:\/\/www.csdn.net\/article\/2015-07-07\/2825155)\n', '\/blog\/distributed-load-testing-using-kubernetes\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">该教程描述如何在 Kubernetes 中进行分布式负载均衡测试。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/yarn-on-docker/">容器技术在大数据场景下的应用——YARN on Docker</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/04/04</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             其他
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('容器技术在大数据场景下的应用——YARN on Docker', '基于 docker swarm。', '\n## 前言\n\n我已就该话题已在 2016 年上海 Qcon 上发表过演讲。另外 InfoQ 网站上的文字版[数据中心的 YARN on Docker 集群方案](https:\/\/www.infoq.cn\/article\/YARNOnDocker-forDCCluster\/)，即本文。\n\n项目代码开源在 Github 上：[Magpie](https:\/\/github.com\/rootsongjc\/magpie)\n\n## 当前数据中心存在的问题\n\n数据中心中的应用一般独立部署，为了保证环境隔离与方便管理，保证应用最大资源  数据中心中普遍存在如下问题：\n\n1. 主机资源利用率低\n2. 部署和扩展复杂\n3. 资源隔离无法动态调整\n4. 无法快速响应业务\n\n## 为何使用 YARN on Docker\n\n**彻底隔离队列**\n\n- 为了合理利用 Hadoop YARN 的资源，队列间会互相抢占计算资源，造成重要任务阻塞\n- 根据部门申请的机器数量划分 YARN 集群方便财务管理\n- 更细粒度的资源分配 \n\n**统一的资源分配**\n\n- 每个 NodeManager 和容器都可以限定 CPU、内存资源\n- YARN 资源划分精确到 CPU 核数和内存大小 \n\n**弹性伸缩性服务**\n\n- 每个容器中运行一个 NodeManager，增减 YARN 资源只需增减容器个数\n- 可以指定每个 NodeManager 拥有的计算资源多少，按需申请资源 \n\n## 给我们带来什么好处？ \n\n**Swarm 统一集群资源调度**\n\n- 统一资源\n- 增加 Docker 虚拟化层，降低运维成本\n\n**增加 Hadoop 集群资源利用率**\n\n- 对于数据中心：避免了静态资源隔离\n\n- 对于集群：加强集群内部资源隔离\n\n## 系统架构\n\n![YARN 在 swarm 上运行的架构](td_yarn_arch.jpg)\n\n比如数据中心中运行的 Hadoop 集群，我们将 HDFS 依然运行在物理机上，即 DataNode 依然部署在实体机器上，将 YARN 计算层运行在 Docker 容器中，整个系统使用二层资源调度，Spark、Flink、MapReduce 等应用运行在 YARN 上。\n\nSwarm 调度最底层的主机硬件资源，CPU 和内存封装为 Docker 容器，容器中运行 NodeManager，提供给 YARN 集群，一个 Swarm 集群中可以运行多个 YARN 集群，形成圈地式的 YARN 计算集群。\n\n![YARN 在 Swarm 上的架构之资源分配](td_yarn_arch2.jpg)\n\n**具体流程**\n\n1. swarm node 向 swarm master 注册主机资源并加入到 swarm cluster 中\n2. swarm master 向 cluster 申请资源请求启动容器\n3. swarm 根据调度策略选择在某个 node 上启动 docker container\n4. swarm node 的 docker daemon 根据容器启动参数启动相应资源大小的 NodeManager\n5. NodeManager 自动向 YARN 的 ResourceManager 注册资源一个 NodeManager 资源添加完成。\n\nSwarm 为数据中心做容器即主机资源调度，每个 swarmnode 的节点结构如图：\n\n![YARN 在 swarm 上的架构之单节点资源分配](td_yarn_arch3.jpg)\n\n一个 Swarm node 就是一台物理机，每台主机上可以起多个同类型的 docker container，每个 container 的资源都有限制包括 CPU、内存 NodeManager 容器只需要考虑本身进程占用的资源和需要给主机预留资源。假如主机是 24 核 64G，我们可以分给一个容器 5 核 12G，NodeManager 占用 4 核 10G 的资源提供给 YARN。\n\n**Kubernetes VS Swarm**\n\n关于容器集群管理系统的选型，用 Kubernetes 还是 Swarm？我们结合自己的经验和业务需求，对比如下：\n\n![Kubernetes vs Swarm](td_yarn_compare.jpg)\n\n基于以上四点，我们当时选择了 Swarm，它基本满足我们的需求，掌握和开发时常较短。\n\n## 镜像制作与发布\n\n镜像制作和发布流程如下图：\n\n![CI 流程](td_yarn_ci.jpg)\n\n用户从客户端提交代码到 Gitlab 中，需要包含 Dockerfile 文件，通过集成了 docker 插件的 Jenkins 的自动编译发布机制，自动 build 镜像后 push 到 docker 镜像仓库中，同一个项目每提交一次代码都会重新 build 一次镜像，生成不同的 tag 来标识镜像，Swarm 集群使用该镜像仓库就可以直接拉取镜像。\n\n### Dockerfile 的编写技巧\n\n![Dockerfile 编写技巧](td_yarn_dockerfile.jpg)\n\nDockerfile 相当于 docker 镜像的编译打包流程说明，其中也不乏一些技巧。     \n\n很多应用需要配置文件，如果想为每次启动容器的时候使用不同的配置参数，可以通过传递环境变量的方式来修改配置文件，前提是需要写一个 bash 脚本，脚本中来处理配置文件，再将这个脚本作为 entrypoint 入口，每当容器启动时就会执行这个脚本从而替换配置文件中的参数，也可以通过 CMD 传递参数给该脚本。\n\n启动容器的时候通过传递环境变量的方式修改配置文件：\n\n\u0060\u0060\u0060Shell\ndocker run -d \n--net=mynet \n-e NAMESERVICE=nameservice \n-e ACTIVE_NAMENODE_ID=namenode29 \\\n-e STANDBY_NAMENODE_ID=namenode63 \\\n-e HA_ZOOKEEPER_QUORUM=zk1:2181,zk2:2181,zk3:2181 \\\n-e YARN_ZK_DIR=rmstore \\\n-e YARN_CLUSTER_ID=yarnRM \\\n-e YARN_RM1_IP=rm1 \\\n-e YARN_RM2_IP=rm2 \\\n-e CPU_CORE_NUM=5\n-e NODEMANAGER_MEMORY_MB=12288 \\\n-e YARN_JOBHISTORY_IP=jobhistory \\\n-e ACTIVE_NAMENODE_IP=active-namenode \\\n-e STANDBY_NAMENODE_IP=standby-namenode \\\n-e HA=yes \\\ndocker-registry\/library\/hadoop-yarn:v0.1 resourcemanager\n\u0060\u0060\u0060\n\n最后传递 Resource Manager 或者 Node Manager 参数指定启动相应的服务。\n\n## 集群管理\n\n我开发的命令行工具[magpie](https:\/\/github.com\/rootsongjc\/magpie)，也可以通过其他开源可视化页面来管理集群，比如 shipyard。\n\n![Shipyard](td_yarn_shipyard.jpg)\n\n## 自定义网络\n\nDocker 容器跨主机互访一直是一个问题，Docker 官方为了避免网络上带来的诸多麻烦，故将跨主机网络开了比较大的口子，而由用户自己去实现。我们开发并开源了 Shrike 这个 docker 网络插件，大家可以在这里下载到：[GitHub - docker-ipam-plugin](https:\/\/github.com\/rootsongjc\/docker-ipam-plugin)\n\n目前 Docker 跨主机的网络实现方案也有很多种，主要包括端口映射、ovs、fannel 等。但是这些方案都无法满足我们的需求，端口映射服务内的内网 IP 会映射成外网的 IP，这样会给开发带来困惑，因为他们往往在跨网络交互时是不需要内网 IP 的，而 ovs 与 fannel 则是在基础网络协议上又包装了一层自定义协议，这样当网络流量大时，却又无端的增加了网络负载，最后我们采取了自主研发扁平化网络插件，也就是说让所有的容器统统在大二层上互通。架构如下：\n\n![YARN 网络](td_yarn_network.jpg)\n\n \n\n我们首先需要创建一个 br0 自定义网桥，这个网桥并不是通过系统命令手动建立的原始 Linux 网桥，而是通过 Docker 的 cerate network 命令来建立的自定义网桥，这样避免了一个很重要的问题就是我们可以通过设置 DefaultGatewayIPv4 参数来设置容器的默认路由，这个解决了原始 Linux 自建网桥不能解决的问题。用 Docker 创建网络时我们可以通过设置 subnet 参数来设置子网 IP 范围，默认我们可以把整个网段给这个子网，后面可以用 ipamdriver（地址管理插件）来进行控制。还有一个参数 gateway 是用来设置 br0 自定义网桥地址的，其实也就是你这台宿主机的地址。\n\n\u0060\u0060\u0060Shell\ndocker network create \n--opt=com.docker.network.bridge.enable_icc=true\n--opt=com.docker.network.bridge.enable_ip_masquerade=false\n--opt=com.docker.network.bridge.host_binding_ipv4=0.0.0.0\n--opt=com.docker.network.bridge.name=br0\n--opt=com.docker.network.driver.mtu=1500\n--ipam-driver=talkingdata\n--subnet=容器IP的子网范围\n--gateway=br0网桥使用的IP,也就是宿主机的地址\n--aux-address=DefaultGatewayIPv4=容器使用的网关地址\nmynet\n\u0060\u0060\u0060\n\n![IPAM 插件](td_yarn_ipam.jpg)\n\nIPAM 驱动是专门管理 Docker 容器 IP 的，Docker 每次启停与删除容器都会调用这个驱动提供的 IP 管理接口，然后 IP 接口会对存储 IP 地址的 Etcd 有一个增删改查的操作。此插件运行时会起一个 UnixSocket, 然后会在\u0060docker\/run\/plugins\u0060目录下生成一个.sock 文件，Dockerdaemon 之后会和这个 sock 文件进行沟通去调用我们之前实现好的几个接口进行 IP 管理，以此来达到 IP 管理的目的，防止 IP 冲突。 \n\n通过 Docker 命令去创建一个自定义的网络起名为\u0060mynet\u0060，同时会产生一个网桥 br0，之后通过更改网络配置文件（在\u0060\/etc\/sysconfig\/network-scripts\/\u0060下 ifcfg-br0、ifcfg-默认网络接口名）将默认网络接口桥接到 br0 上，重启网络后，桥接网络就会生效。Docker 默认在每次启动容器时都会将容器内的默认网卡桥接到 br0 上，而且宿主机的物理网卡也同样桥接到了 br0 上了。其实桥接的原理就好像是一台交换机，Docker 容器和宿主机物理网络接口都是服务器，通过 vethpair 这个网络设备像一根网线插到交换机上。至此，所有的容器网络已经在同一个网络上可以通信了，每一个 Docker 容器就好比是一台独立的虚拟机，拥有和宿主机同一网段的 IP，可以实现跨主机访问了。\n\n## 性能瓶颈与优化\n\n大家可能会担心自定义网络的性能问题，为此我们用 iperf 进行了网络性能测试。我们对比了不同主机容器间的网速，同一主机上的不同容器和不同主机间的网速，结果如下表：\n\n![网络性能对比](td_yarn_iperf.jpg)\n\n从表中我们可以看到，在这一组测试中，容器间的网速与容器是在想通主机还是在不同主机上的差别不大，说明我们的网络插件性能还是很优异的。 \n\n## Hadoop 配置优化 \n\n因为使用 docker 将原来一台机器一个 nodemanager 给细化为了多个，会造成 nodemanager 个数的成倍增加，因此 hadoop 的一些配置需要相应优化。\n\u0060\u0060\u0060ini\n- yarn.nodemanager.localizer.fetch.thread-count 随着容器数量增加，需要相应调整该参数\n- yarn.resourcemanager.amliveliness-monitor.interval-ms 默认1秒，改为10秒，否则时间太短可能导致有些节点无法注册\n- yarn.resourcemanager.resource-tracker.client.thread-count 默认50，改为100，随着容器数量增加，需要相应调整该参数\n- yarn.nodemanager.pmem-check-enabled 默认true，改为false，不检查任务正在使用的物理内存量\n- 容器中hadoop ulimit值修改，默认4096，改成655350\n\u0060\u0060\u0060\n\n**集群监控** \n\n如果使用 shipyard 管理集群会有一个单独的监控页面，可以看到一定时间段内的 CPU、内存、IO、网络使用状况。\n\n![集群监控](td_yarn_monitor.jpg)\n\n## 关于未来\n\n![YARN 的未来](td_yarn_os.jpg) \n\n我们未来规划做的是 DC\/OS，基于 Docker 的应用自动打包编译分发系统，让开发人员可以很便捷的申请资源，上下线服务，管理应用。要达到这个目标还有很多事情要做：\n\n-  Service Control Panel：统一的根据服务来管理的 web 页面\n-  Loadbalance：容器根据机器负载情况自动迁移\n-  Scheduler：swarm 调度策略优化\n-  服务配置文件：提供镜像启动参数的配置文件，所有启动参数可通过文件配置\n-  监控：服务级别的监控\n\n## 后记\n\n这篇文章写好的时候是 2016 年 10 月，距离现在我添加**前言**和**后记**的已经快半年时间了，这段时间内业界也发生了很多变化，比如 docker 推出 CE 和 SE 版本，Kubernetes 发布了 1.6 版本，人工智能依然大热，在可预见的未来，可以说\u003cu\u003eKubernetes 一定会远远超越 Docker 成为容器编排领域的王者\u003c\/u\u003e，这是毋庸置疑的，对于 docker 17.03-CE 我也研究过了一段时间，其 disgusting 的 plugin 让我对于 Docker 的编排已经失去信心。\n\n其实当时容器在大数据场景下的应用并不是很多，毕竟 Hadoop 那套笨重的东西放在容器下运行，上生产环境实属不易。如果说做原型验证、研发测试那还可以。这样就大大限制了容器技术在大数据场景下的应用场景。使用容器的编排调度来实现大数据集群的资源优化有点舍本逐末，\u003cu\u003e如果真的要优化集群资源利用率的话，应该让不同的应用混跑，而不应该让集群之间资源隔离，比如 Web 应用跟大数据应用混布。\u003c\/u\u003e目前的这种**YARN on Docker**方案实质上是将原来的整体 Hadoop YARN 集群划分成多个不同的 YARN，将存储和计算分离了。其实这跟**Nutanix**的超融合架构有点像，Nutanix 是由前 Google 的工程师创立的，解决虚拟化计算环境下的存储问题，也是将存储和计算分离，共享存储，计算根据需要调度。事实上 Yahoo 已经有解决 Hadoop 集群的资源细粒度分配和调度问题的方案，这应该是从 YARN 的 scheduler 层来处理。\n\nSwarm 已死，Swarmkit 将继续发展，Docker 的 Swarm Mode 还会在艰难中前行，目前看到的趋势仍然是模仿 Kubernentes 为主，没有自己鲜明的特色（除了部署管理方便意外，谁让它就集成在了 Docker 里呢，就像当年 Windows 集成 IE 打败 Netscape，不过这不会再此上演了），Kubernentes 又是一个通用的资源调度框架，它的最小资源划分是**Pod**而不是 Docker，它还可以运行 rkt、containerd。\n\n上周起我开始将注意力全部转移到了 Kubernentes，以后请关注我的[Kuberentes 实践](https:\/\/jimmysong.io\/tags\/kubernetes\/)相关文章。\n', '\/blog\/yarn-on-docker\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">基于 docker swarm。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/picture-process/">两款开源图片处理工具对比</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/04/02</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e9%9a%8f%e7%ac%94"> 
             随笔
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('两款开源图片处理工具对比', 'Google Guetzli 和基于 AI 的 Deep Photo Style Transfer。', '\n如果你看过美剧「硅谷」会记得剧中主角们所在的创业公司 PiedPipper，他们就是靠自己发明的视频压缩算法来跟大公司 Hooli 竞争的，这部剧现在已经发展到第 4 季，在[腾讯视频](http:\/\/v.qq.com\/detail\/d\/dr2zn76oez8tyt4.html?ptag=baidu.aladdin.tv)上可以免费观看。\n\n最近关注了两个**图像处理**的 Open Source Projects。\n\n- [Google Guetzli](https:\/\/github.com\/google\/guetzli) 图像压缩工具\n- [Luan Fujun\u0027s Deep Photo Style Transfer](https:\/\/github.com\/luanfujun\/deep-photo-styletransfer) 图像 style 转换工具\n\n另外对于图像处理还处于 Photoshop、Lightroom 这种摄影后期和图像处理命令行工具[ImageMagick](https:\/\/www.imagemagick.org\/script\/index.php)的我来说，图像压缩，智能图像风格转换实乃上乘武功，不是我等凡夫俗子驾驭的了，但是乘兴而来，总不能败兴而归吧，下面我们来一探究竟。\n\n## Google Guetzli\n\n聊聊架构微信公众号上有一篇介绍[Google 开源新算法，可将 JPEG 文件缩小 35%](https:\/\/mp.weixin.qq.com\/s?__biz=MzA5Nzc4OTA1Mw==\u0026mid=2659599074\u0026idx=1\u0026sn=a26ae2a8becdc1f2cfbddf44d8ca1495\u0026chksm=8be997f0bc9e1ee6e33f3e33c73d11884ad66085c0aedc9dd5e482063482887d0733d8e7d187#rd)文章。\n\n我在 Mac 上试用了一下，安装很简单，只要一条命令：\n\n\u0060\u0060\u0060Bash\nbrew install guetzli\n\u0060\u0060\u0060\n\n但是当我拿一张\u006022M\u0060大小的照片使用 guetzli 压缩的时候，我是绝望的，先后三次 kill 掉了进程。\n\n**因为实在是太慢了**，也能是我软件对内存和 CPU 的利用率不高，效果你们自己看看。\n\n原图是这个样子的，拍摄地点在景山上的，俯瞰紫禁城的绝佳位置。\n\n![原图](IMG_5430.JPG)\n\n\u0060\u0060\u0060bash\nguetzli --quality 84 --verbose 20160403052.jpg output.jpg\n\u0060\u0060\u0060\n\n为什么 quality 要设置成 84 呢？因为只能设置为 84\u002b 的 quality，如果要设置的更低的话需要自己修改代码。\n\n![process](IMG_5429.JPG)\n\n耗时了一个小时，后台进程信息。\n\n![后台进程](IMG_5428.JPG)\n\n这个是使用**Squash**压缩后的大小效果，压缩每张照片差不多只要 3 秒钟。\n\n\u003e Squash 的 logo 就是个正在被剥皮的🍊，这是[下载地址](http:\/\/xclient.info\/s\/squash.html)。\n\n压缩比分别为\u006070%\u0060和\u006030%\u0060。\n\nIMG_5434.JPG)\n\n**压缩比 70% 后的细节放大图**\n\n![70](IMG_5432.JPG)\n\n**压缩比 30% 的细节放大图**\n\n![30](IMG_5433.JPG)\n\n你看出什么区别了吗？反正我是没有。\n\n下面再来看看耗时一个小时，千呼万唤始出来的 guetzli 压缩后的效果和使用 squash 压缩比为 30% 的效果对比。\n\n![对比](FullSizeRender.jpg)\n\n左面是使用 guetzli 压缩后（4.1M），右面使用的 squash 压缩后（3.1M）的照片。\n\n*似乎还是没有什么区别啊？你看出来了吗？*\n\n### Guetzli 总结\n\n可能是我使用 Guetzli 的方式不对，但是命令行里确实没有设置 CPU 和内存资源的选项啊，为啥压缩照片会这么慢呢？效果也并不出彩，不改代码的话照片质量只能设置成 84 以上，但是这个是**Open Source**的，使用的 C\u002b\u002b 开发，可以研究下它的图像压缩算法。\n\n# Deep Photo Style Transfer \n\n来自康奈尔大学的 Luan Fujun 开源的图像 sytle 转换工具，看了[README](https:\/\/github.com\/luanfujun\/deep-photo-styletransfer)的介绍，上面有很多图像风格转换的例子，真的很惊艳，市面上好像还没有这种能够在给定任意一张照片的情况下，自动将另一张照片转换成该照片的 style。\n\n这个工具使用 Matlab 和 Lua 开发，基于[Torch](https:\/\/github.com\/torch\/torch7)运行的时候需要[CUDA](https:\/\/developer.nvidia.com\/cuda-downloads)，[cudnn](https:\/\/developer.nvidia.com\/cudnn)，[Matlab](https:\/\/www.mathworks.com\/)，环境实在太复杂，就没折腾，启动有人发布[Docker 镜像](https:\/\/github.com\/luanfujun\/deep-photo-styletransfer\/issues\/29)，已经有人提了 issue。\n\n如果它能够被商用，绝对是继**Prisma**后又一人工智能照片处理应用利器。\n\n## 后记\n\n是不是有了照片风格转换这个东西就不需要做照片后期了？只要选几张自己喜欢的风格照片，再鼠标点几下就可以完成照片处理了？摄影师要失业了？非也！照片风格东西本来就是很主观性的，每个人都有自己喜欢的风格，照相机发明后就有人说画家要失业了，其实不然，画画依然是创造性地劳动，只能说很多写实风格的画家要失业了。Deep Photo Style Transfer 也许会成为 Lightroom 或者手机上一款 app 的功能，是一个不错的工具。也许还会成为像 Prisma 一样的现象级产品，who knows?🤷‍♂️\n', '\/blog\/picture-process\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">Google Guetzli 和基于 AI 的 Deep Photo Style Transfer。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/building-github-pages-with-hugo/">从零开始：使用 Hugo 和 GitHub Pages 构建个人博客</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/03/17</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e9%9a%8f%e7%ac%94"> 
             随笔
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('从零开始：使用 Hugo 和 GitHub Pages 构建个人博客', '本文详细介绍如何利用 Hugo 和 GitHub Pages 快速搭建个人博客。', '\n## 引言\n\n在信息爆炸的今天，拥有一个个人博客不仅是分享知识、记录生活的平台，也是技术人员品牌建设的重要工具。如果你希望以最小的成本开始你的数字化表达之旅，那么本文介绍的 Hugo 和 GitHub Pages 将是你的理想选择。接下来，让我们一步步探索如何利用这两款工具快速搭建和部署你的个人博客。\n\n## 准备工作\n\n开始之前，你需要准备以下几样工具和账号：\n\n- **GitHub 账号**：访问 [GitHub](https:\/\/www.github.com) 创建账号。GitHub Pages 将托管你的网站，因此你需要在 GitHub 上创建一个以 \u0060username.github.io\u0060 命名的项目。\n- **Hugo**：Hugo 是一个高效的静态网站生成器。你可以从 [Hugo 官网](https:\/\/gohugo.io) 下载并安装它。\n- **百度统计或 Google Analytics**：在网站中集成在线统计，可以帮助你了解网站访问情况，帮助你优化网站。\n- **Typora**：强烈推荐的 Markdown 编辑器。\n\n## Hugo 简介\n\nHugo 是一款开源的静态网站生成器，以其构建速度快而闻名。它将 Markdown 或其他格式的内容文件转换成完整的 HTML 网站。静态网站意味着所有页面在部署前就已经生成，极大地提升了访问速度并降低了服务器负担。\n\nHugo 有下面的特性：\n\n- **速度快**：即使是上千页面的网站也能在几秒内生成。\n- **无需数据库**：增强安全性，降低维护复杂性。\n- **易于使用**：简单的命令行操作可以快速生成和部署网站。\n\n## 开始搭建\n\n首先建立自己的网站，mysite 是网站的路径\n\n\u0060\u0060\u0060bash\n$ hugo new site mysite\n\u0060\u0060\u0060\n\n然后进入该路径\n\n\u0060\u0060\u0060bash\n$ cd mysite\n\u0060\u0060\u0060\n\n在该目录下你可以看到以下几个目录和 \u0060config.toml\u0060 文件\n\n\u0060\u0060\u0060bash\n ▸ archetypes\/ \n ▸ content\/\n ▸ layouts\/\n ▸ static\/\n   config.toml\n\u0060\u0060\u0060\n\n\u0060config.toml\u0060是网站的配置文件，包括\u0060baseurl\u0060、 \u0060title\u0060、\u0060copyright\u0060等等网站参数。\n\n这几个文件夹的作用分别是：\n\n- archetypes：包括内容类型，在创建新内容时自动生成内容的配置\n- content：包括网站内容，全部使用 markdown 格式\n- layouts：包括了网站的模版，决定内容如何呈现\n- static：包括了 css, js, fonts, media 等，决定网站的外观\n\nHugo 提供了一些完整的主题可以使用，下载这些主题：\n\n\u0060\u0060\u0060bash\n$ git clone --recursive https:\/\/github.com\/spf13\/hugoThemes themes\n\u0060\u0060\u0060\n\n此时现成的主题存放在\u0060themes\/\u0060文件夹中。\n\n现在我们先熟悉一下 Hugo，创建新页面：\n\n\u0060\u0060\u0060bash\n$ hugo new about.md\n\u0060\u0060\u0060\n\n进入\u0060content\/\u0060文件夹可以看到，此时多了一个 markdown 格式的文件\u0060about.md\u0060，打开文件可以看到时间和文件名等信息已经自动加到文件开头，包括创建时间，页面名，是否为草稿等。\n\n\u0060\u0060\u0060markdown\n---\ndate: \u00222015-02-01T18:19:54\u002b08:00\u0022\ndraft: false\ntitle: \u0022about\u0022\ncategories: [\u0022github-pages\u0022]\ntag: [\u0022blog\u0022,\u0022post\u0022]\n---\n\n# About me\n- Jimmy Song\n\u0060\u0060\u0060\n\n我在页面中加入了一些内容，然后运行 Hugo:\n\n\u0060\u0060\u0060bash\n$ hugo server -t hyde --buildDrafts\n\u0060\u0060\u0060\n\n\u0060-t\u0060 参数的意思是使用 hyde 主题渲染我们的页面，注意到 \u0060about.md\u0060 目前是作为草稿，即 \u0060draft\u0060 参数设置为 \u0060true\u0060，运行 Hugo 时要加上 \u0060--buildDrafts\u0060 参数才会生成被标记为草稿的页面。在浏览器输入 \u0060localhost:1313\u0060，就可以看到我们刚刚创建的页面。\n\n注意观察当前目录下多了一个文件夹 \u0060public\/\u0060，这里面是 Hugo 生成的整个静态网站，如果使用 Github pages 来作为博客的 Host，你只需要将 \u0060public\/\u0060 里的文件上传就可以，这相当于是 Hugo 的输出。\n\n**说明**\n\n使用 \u0060hugo new\u0060 命令生成的文章前面的加号中包括的那几行，是用来设置文章属性的，这些属性使用的是 yaml 语法。\n\n- **date** 自动增加时间标签，页面上默认显示 n 篇最新的文章。\n- **draft** 设置为 false 的时候会被编译为 HTML，true 则不会编译和发表，在本地修改文章时候用 true。\n- **title** 设置文章标题\n- **tags** 数组，可以设置多个标签，都好隔开，hugo 会自动在你博客主页下生成标签的子 URL，通过这个 URL 可以看到所有具有该标签的文章。\n- **categories** 文章分类，跟 Tag 功能差不多，只能设置一个字符串。\n\n你可以在[这里](http:\/\/themes.gohugo.io)找到更多模版。\n\n## 自定义域名\n\n如果你希望使用自定义域名，可以在诸如 Namecheap 或 GoDaddy 的网站注册域名，然后配置 DNS 解析到你的 GitHub 页面。\n\n## 结语\n\n利用 Hugo 和 GitHub Pages，你不仅能快速搭建个人博客，还能享受编写、部署的便捷与乐趣。希望本文能帮助你迈出建立个人在线品牌的第一步。\n', '\/blog\/building-github-pages-with-hugo\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文详细介绍如何利用 Hugo 和 GitHub Pages 快速搭建个人博客。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/microservice-reading-notes/">微服务设计读书笔记</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2017/03/11</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e9%9a%8f%e7%ac%94"> 
             随笔
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('微服务设计读书笔记', '这本书中包括很多业界是用案例，比如 Netflix 和亚马逊。有兴趣的话大家一起看看讨论一下。', '\n最近在看 **《微服务设计（Sam Newman 著）》** 这本书。作者是 **ThoughtWorks** 的 Sam Newman。这本书中包括很多业界是用案例，比如 **Netflix** 和 **亚马逊**。有兴趣的话大家一起看看讨论一下。😄\n\nP.S 这本书比较偏理论，另外还有一本中国人写的书，**《微服务架构与实践，王磊著，电子工业出版社》** 。这个人同样也是 **ThoughtWorks** 的，两个人的观点不谋而合，依然是便理论的东西。\n\n**Cloud Native Go - 基于 Go 和 React 的 web 云服务构建指南**\n\n这本书是我最近在翻译的，将由 **电子工业出版社** 出版，本书根据实际案例教你如何构建一个 web 微服务，是实践为服务架构的很好的参考。[查看本书介绍](\/book\/cloud-native-go\/)。\n\n## 1.微服务初探\n\n### 什么是微服务？\n\n微服务（Microservices）这个词比较新颖，但是其实这种架构设计理念早就有了。微服务是一种分布式架构设计理念，为了推动细粒度服务的使用，这些服务要能协同工作，每个服务都有自己的生命周期。一个微服务就是一个独立的实体，可以独立的部署在 PAAS 平台上，也可以作为一个独立的进程在主机中运行。服务之间通过 API 访问，修改一个服务不会影响其它服务。\n\n### 微服务的好处\n\n微服务的好处有很多，包括：\n\n- 帮助你更快的采用新技术\n- 解决技术异构的问题，因为是用 API 网络通信，可以使用不同的语言和技术开发不同的服务\n- 增强系统弹性，服务的边界比较清晰，便于故障处理\n- 方便扩展，比如使用容器技术，可以很方便的一次性启动很多个微服务\n- 方便部署，因为微服务之间彼此独立，所以能够独立的部署单个服务而不影响其它服务，如果部署失败的话还可以回滚\n- **别忘了康威定律，微服务可以很好契合解决组织架构问题**\n- 可重用，可随意组合\n- 便于维护，可以随时重写服务，不必担心历史遗留问题\n\n### 与面向服务架构 SOA 的关系\n\n可以说微服务架构师 SOA 的一种，但是目前的大多数 SOA 做的都不好，在\u0060通信协议的选择\u0060、\u0060第三方中间件的选择\u0060、\u0060服务力度如何划分\u0060方面做的都不够好。\n\n**微服务与 SOA 的共同点**\n\n- 都使用共享库，比如可重用的代码库\n- 模块化，比如 Java 中的 OSGI(Open Source Gateway Initiative)、Erlang 中的模块化\n\n## 2.架构师的职责\n\n### 架构师应该关心是什么\n\n**架构师（Architect）**在英文中和**建筑师**是同一个词，他们之间也有很多相同之处，架构师构建的是软件，而建筑师构建的是建筑。\n\n终于看到了我翻译的*Cloud Native Go*第 14 章中引用的这本书的原话了。\n\n![原话](building-microservices-reference.jpg)\n\n软件的需求变更是**来的那么快来的那么直接**，不像建筑那样可以在设计好后按照设计图纸一步步的去建设。\n\n架构师应该关心的是什么呢？\n\n- 保证系统适合开发人员在上面工作\n- 关注服务之间的交互，不需要过于关注各个服务内部发生的事情，比如服务之间互相调用的接口，是使用\u0060protocol buffer\u0060呢，还是使用\u0060RESTful API\u0060，还是使用\u0060Java RMI\u0060，这个才是架构师需要关注的问题，至于服务内部究竟使用什么，那就看开发人员自己了，**架构师更需要关注系统的边界和分区**。\n- 架构师应该与团队在一起，**结对编程** 🤓🤓 了解普通工作，知道普通的工作是什么样子，做一个*代码架构师* 😂\n\n\n### 架构师应该做什么\n\n- 提供原则指导实践，比如 Heroku 的[12 因素法则](https:\/\/jimmysong.io\/posts\/12-factor-app\/)用来指导 SAAS 应用架构一样，微服务架构设计也要有一套原则。\n- 提供要求标准，通过日志功能和监控对服务进行集中式管理，明确接口标准，提供安全性建议。\n- 代码治理。为开发人员提供范例和服务代码模板。\n- 解决技术债务。\n- 集中治理和领导。维持良好的团队关系，当团队跑偏的时候及时纠正。\n\n## 3.服务建模\n\n以**MusicCorp**这家公司的服务为例子讲解。\n\n服务建模的两个指导原则：\n\n- 高内聚：关键是找出问题的边界，把相关的问题放在同一个服务中。\n- 松耦合：修改一个服务不需要修改另一个。\n\n使用**限定上下文**（一个由显示边界限定的特定指责）的方法将服务拆分，比如 MusicCorp 的服务可以拆分为：\n\n- 财务部门\n- 仓库\n\n他们都不需要知道各自的具体实现，只要给它们提供特定的输入就会有你想要的产出。\n\n过早的将一个系统划分成微服务的代价非常高，尤其是在面对新领域时，将一个已有的代码库划分成微服务会比葱头开始建设微服务要简单的多。\n\n## 4.集成\n\n使用共享数据库，为用户创建好接口，可以使用 RPC（protocol buffer、thrift）或者 REST。服务端和客户端消息格式可以用 Json 或 XML。当然每种技术都有各自的适用场景，结合自己的业务选择。\n\n微服务的协作方式是什么样的呢？基于事件的异步通信，使用消息中间件来实现事件发布和消费者接收机制。比如用 Kafka 或 RabbitMQ。\n\n## 5.分解单块系统\n\n分解巨大无比没人感动的单块系统，首先要做的是理清代码库，找到**接缝**。\n\n分解系统带来的好处：\n\n- 加快以后系统开发速度\n- 划清了团队结构（又是康威定律）\n- 增加安全审计功能后，保障安全性\n- 利于开展新技术\n\n## 6. 部署\n\n这一块跟传统服务的部署并没有太大的不同，无非是微服务的短平快，加快了 CI（持续集成）的速度。如果将微服务打包为 docker 镜像，使用 Jenkins、ansible、puppet 等技术来部署微服务可以实现部署自动和效率的显著提高。\n\n## 其它\n\n该书的后面还讲了**测试**、**监控**、**安全**、**康威定律**、最后还上升到**人本**，给予广大的软件开发人员强烈的人文关怀，可见提倡架构师要融入团队，最一个**代码架构师**和**结对编程**的作者是多么博爱❤️。\n\n该书的核心部分是**第 11 章规模化微服务**，为将在下篇中来探讨一下。\n', '\/blog\/microservice-reading-notes\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">这本书中包括很多业界是用案例，比如 Netflix 和亚马逊。有兴趣的话大家一起看看讨论一下。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
 <nav aria-label="Page navigation">
   <ul class="pagination justify-content-center">
     
     
     <li class="page-item">
       <a class="page-link" href="/blog/">
         ««
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a href="/blog/page/27/" class="page-link">
         «
       </a>
     </li>
     
     
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
         
         
       
       
       
       
     
       
       
       
         
         
         
           
           
             
           
         
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/24/" class="page-link">
             24
           </a>
         </li>
       
     
       
       
       
         
         
         
           
           
             
           
         
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/25/" class="page-link">
             25
           </a>
         </li>
       
     
       
       
       
         
         
         
           
           
             
           
         
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/26/" class="page-link">
             26
           </a>
         </li>
       
     
       
       
       
         
         
         
           
           
             
           
         
         
       
       
       
       
         <li class="page-item">
           <a href="/blog/page/27/" class="page-link">
             27
           </a>
         </li>
       
     
       
       
       
         
         
         
           
           
             
           
         
         
       
       
       
       
         <li class="page-item page-item active ">
           <a href="/blog/page/28/" class="page-link">
             28
           </a>
         </li>
       
     
     
     
     
     
   </ul>
 </nav>
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      专栏
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(79)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(42)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(25)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>随笔</span>
            <span>(22)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>其他</span>
            <span>(19)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>业态</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>云原生</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>安全</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>开源</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>旅行</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>可观测性</span>
            <span>(5)</span>
        </a>
      
        <a href="/categories/%e5%b7%a5%e5%85%b7" class="sidebar-item">
            <span>工具</span>
            <span>(5)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      资料
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>出版物</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>翻译电子书</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>翻译文档</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>翻译图书</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>原创图书</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>教程手册</span>
            <span>(2)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/south-korea-trip/">韩国旅行回忆：首尔、釜山与仁川的真实体验</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-sidecar-vs-ambient-network-cost-performance/">Istio sidecar 和 ambient 模式的网络成本对比</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/mindmap-review/">思维导图工具评测：为什么我选择 Whimsical</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  简明 Envoy 教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024（香港）</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">网站改版通知</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
