<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>Istio ä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ Â· Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.98.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/plugins/slick/slick.css">
  
  <link rel="stylesheet" href="/plugins/animate/animate.css">
  
  <link rel="stylesheet" href="/plugins/venobox/venobox.css">
  
  <link rel="stylesheet" href="/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/plugins/hightlight/syntax.css">
  
  <link rel="stylesheet" href="/plugins/fontawesome/font-awesome.min.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/scss/style.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Algolia-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css">
  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/blog/istio-service-and-traffic-model/" />
  <meta property="og:title" content="Istio ä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹" />
  <meta property="twitter:title" content="Istio ä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹" />
  
  <meta property="og:description" content="æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚" />
  <meta property="twitter:description" content="æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚" />
  
  
  <meta property="og:image" content="https://jimmysong.io/images/banner/istio-logo.webp" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/istio-logo.webp" />
  
  
  
</head>
<body>
    <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>

<header class="fixed-top header">
  
  
  <div class="top-header py-2 bg-white">
    <div class="container">
      <div class="row no-gutters align-items-center">
        <div class="col-12 text-center">
          <ul class="list-inline">
            <li class="list-inline-item">
                ğŸ“£ äº‘åŸç”Ÿç¤¾åŒºè‘—çš„ã€Šæ·±å…¥ç†è§£ Istioã€‹å‡ºç‰ˆå•¦ï¼Œ<a href="https://item.jd.com/13200745.html" title="å‰å¾€è´­ä¹°" target="_blank" rel="noopener">å‰å¾€è´­ä¹°</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  
  <div class="navigation w-100  top-hider ">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/"><img class="img-fluid" width="200px"
            src="/images/logo.svg" alt="Jimmy Song - ä¸“æ³¨äºæ¢ç´¢å Kubernetes æ—¶ä»£çš„äº‘åŸç”Ÿæ–°èŒƒå¼"></a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">åšå®¢</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://lib.jimmysong.io/" target="_blank" rel="noopener">å›¾ä¹¦</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://lib.jimmysong.io/blog/" target="_blank" rel="noopener">è¯‘æ–‡</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://cloudnative.to" target="_blank" rel="noopener">ç¤¾åŒº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://lib.jimmysong.io/event/" target="_blank" rel="noopener">æ´»åŠ¨</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">è”ç³»</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">é€šçŸ¥</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">å…³äº</a>
              
            </li>
            
            

          
          
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


	
<section class="bg-cover page-title-section overlay" style="background-image: url('/'),url('/images/backgrounds/page-title.webp');" >
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <ul class="list-inline custom-breadcrumb">
            <li class="list-inline-item h2"><a class="text-white font-secondary" href="/blog">
            
            
              
              åšå®¢
              
            
          </a></li>
          <li class="list-inline-item"><i class="ti-angle-right text-white"></i></li>
          <li class="list-inline-item text-white h3 font-secondary">Istio ä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹</li>
        </ul>
        <p class="text-white">æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚</p>
      </div>
    </div>
  </div>
</section>

	


<section class="section-sm">
  <div class="container blog">
    <div class="row">
      <div class="col-lg-8 article-content">
        <div class="row">
          <div class="col-12">
            <ul class="list-inline">
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">æ—¥æœŸ
                  :</span>2018å¹´12æœˆ17æ—¥</li>

              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">åˆ†ç±»
                  :</span><a
                  href="/categories/service-mesh"> 
                  Service Mesh</a> </li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">å­—æ•°
                  :</span>2451 å­—</li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">é˜…è¯»å¤§çº¦éœ€è¦
                  :</span>11 åˆ†é’Ÿ</li>
            </ul>
          </div>
          
          <div class="col-12 my-4">
            <div class="border-bottom"></div>
          </div>
          
          <div class="col-12 content">
            <p>æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚è™½ç„¶ Istio ä¸€å¼€å§‹ç¡®å®šçš„æŠ½è±¡æ¨¡å‹ä¸å¯¹æ¥çš„åº•å±‚å¹³å°æ— å…³ï¼Œä½†ç›®å‰æ¥çœ‹åŸºæœ¬ç»‘å®š Kubernetesï¼Œæœ¬æ–‡ä»…ä»¥ Kubernetes è¯´æ˜ã€‚å¦å¤–åœ¨ <a href="http://www.servicemesher.com" title="ServiceMesher ç¤¾åŒº" target="_blank" rel="noopener">ServiceMesher ç¤¾åŒº</a>
ä¸­æœ€è¿‘æœ‰å¾ˆå¤šå…³äº Istioã€Envoyã€Kubernetes ä¹‹ä¸­çš„æœåŠ¡æ¨¡å‹å…³ç³»çš„è®¨è®ºï¼Œæœ¬æ–‡ä½œä¸ºä¸€ä¸ªå¼€ç¯‡è¯´æ˜ï¼ŒKubernetes å’Œ Isito ä¹‹é—´æœ‰å“ªäº›å…±æœ‰çš„æœåŠ¡æ¨¡å‹ï¼ŒIstio åœ¨ Kubernetes çš„æœåŠ¡æ¨¡å‹ä¹‹ä¸Šåˆå¢åŠ äº†ä»€ä¹ˆã€‚</p>
<p><strong>æœåŠ¡å…·æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚</strong> åœ¨ CI/CD è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªæœåŠ¡å¯èƒ½åŒæ—¶éƒ¨ç½²åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œå¦‚å¼€å‘ã€ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒç­‰ï¼Œè¿™äº›æœåŠ¡ç‰ˆæœ¬ä¸ä¸€å®šå…·æœ‰ä¸åŒçš„ APIï¼Œå¯èƒ½åªæ˜¯ä¸€äº›å°çš„æ›´æ”¹å¯¼è‡´çš„è¿­ä»£ç‰ˆæœ¬ã€‚åœ¨ A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒä¸­ç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚</p>
<h2 id="kubernetes-ä¸-istio-ä¸­å…±æœ‰çš„æ¨¡å‹">Kubernetes ä¸ Istio ä¸­å…±æœ‰çš„æ¨¡å‹</h2>
<p>å› ä¸º Istio åŸºæœ¬å°±æ˜¯ç»‘å®šåœ¨ Kubernetes ä¸Šï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ Kubernetes åŠ Istio ä¸­å…±æœ‰çš„æœåŠ¡æ¨¡å‹ã€‚</p>
<p>Kubernetes ä¸­ iptables ä»£ç†æ¨¡å¼ï¼ˆå¦å¤–è¿˜æœ‰ IPVS æ¨¡å¼ï¼‰ä¸‹çš„ service ï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨ kube-proxy ä¸­é…ç½®ç®€å•çš„è´Ÿè½½å‡è¡¡ï¼Œå¯¹æ•´ä¸ª node ç”Ÿæ•ˆï¼Œæ— æ³•é…ç½®åˆ°å•ä¸ªæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œå…¶ä»–å¾®æœåŠ¡çš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚ç†”æ–­ã€é™æµã€è¿½è¸ªç­‰ï¼Œè¿™äº›åŠŸèƒ½åªèƒ½åœ¨åº”ç”¨ä¸­å®ç°äº†ï¼Œè€Œåœ¨ Istio çš„æ¦‚å¿µæ¨¡å‹ä¸­å®Œå…¨å»æ‰äº† <code>kube-proxy</code>  è¿™ä¸ªç»„ä»¶ï¼Œå°†å…¶åˆ†æ•£åˆ°æ¯ä¸ªåº”ç”¨ Pod ä¸­åŒæ—¶éƒ¨ç½²çš„ Envoy ä¸­å®ç°ã€‚</p>
<p>ä¸‹é¢åˆ—ä¸¾çš„æ˜¯ Kubernetes å’Œ Istio ä¸­å…±æœ‰çš„æ¨¡å‹ã€‚</p>
<h3 id="service">Service</h3>
<p>è¿™å®é™…ä¸Šè·Ÿ Kubernetes ä¸­çš„ service æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼Œè¯·å‚è€ƒ <a href="https://jimmysong.io/kubernetes-handbook/concepts/service.html" title="Kubernetes ä¸­çš„ service" target="_blank" rel="noopener">Kubernetes ä¸­çš„ service</a>
ã€‚Istio æ¨å‡ºäº†æ¯” service æ›´å¤æ‚çš„æ¨¡å‹ <code>VirtualService</code>ï¼Œè¿™ä¸å•çº¯æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡äº†ï¼Œè€Œæ˜¯åœ¨æœåŠ¡ä¹‹ä¸Šå®šä¹‰äº†è·¯ç”±è§„åˆ™ã€‚</p>
<p>æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå®Œå…¨é™å®šçš„åŸŸåï¼ˆFQDNï¼‰ï¼Œç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ã€‚æœåŠ¡è¿˜å¯ä»¥æœ‰ä¸å…¶ç›¸å…³è”çš„å•ä¸ªè´Ÿè½½å‡è¡¡å™¨æˆ–è™šæ‹Ÿ IP åœ°å€ã€‚é’ˆå¯¹ FQDN çš„ DNS æŸ¥è¯¢å°†è§£æä¸ºè¯¥è´Ÿè½½å‡è¡¡å™¨æˆ–è€…è™šæ‹Ÿ IP çš„åœ°å€ã€‚</p>
<p>ä¾‹å¦‚ Kubernetes ä¸­ä¸€ä¸ªæœåŠ¡ä¸º <code>foo.default.svc.cluster.local</code> ï¼Œè™šæ‹Ÿ IP /ClusterIP æ˜¯ 10.0.1.1ï¼Œç›‘å¬çš„ç«¯å£æ˜¯ 80 å’Œ 8080ã€‚</p>
<h3 id="endpoint">Endpoint</h3>
<p>è¿™é‡ŒæŒ‡çš„æ˜¯ Kubernetes ä¸­çš„ endpointï¼Œä¸€ä¸ª endpoint æ˜¯å®ç°äº†æŸæœåŠ¡çš„å…·ä½“å®ä¾‹ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª Endpointï¼Œè¡¨ç¤ºä¸º IP åœ°å€åŠ ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä¸º DNS åç§°åŠ ç«¯å£ã€‚</p>
<p>å…¶å®åˆ°åº•å“ªäº›å®ä¾‹å±äºåŒä¸€ä¸ª serviceï¼Œè¿˜æ˜¯éœ€è¦ é€šè¿‡ label åŒ¹é…æ¥é€‰æ‹©ã€‚</p>
<h3 id="label">Label</h3>
<p>æœåŠ¡çš„ç‰ˆæœ¬ã€å¯¹åº”çš„å¼•ç”¨åç§°ç­‰æ˜¯é€šè¿‡ label æ¥æ ‡è®°çš„ï¼Œä¾‹å¦‚ä¸‹é¢ Kubernetes ä¸­ä¸€ä¸ªåº”ç”¨çš„ YAML é…ç½®ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ratings-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">ratings</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ratings</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">istio/examples-bookinfo-ratings-v1:1.8.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">9080</span><span class="w">
</span></span></span></code></pre></div><p><code>version: v1</code> æ ‡è®°è¯¥æœåŠ¡æ˜¯ v1 ç‰ˆæœ¬ï¼Œ<code>version</code> æ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„æ ‡ç­¾ï¼Œå»ºè®®å¤§å®¶çš„æœåŠ¡ä¸Šéƒ½å¸¦ä¸Šè¯¥æ ‡ç­¾ã€‚</p>
<p>å½“ç„¶æœåŠ¡çš„ label å¯ä»¥è®¾ç½®ä»»æ„å¤šä¸ªï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨åšè·¯ç”±çš„æ—¶å€™å¯ä»¥æ ¹æ®æ ‡ç­¾åŒ¹é…æ¥åšç»†ç²’åº¦çš„æµé‡åˆ’åˆ†ã€‚</p>
<h2 id="æ•°æ®å¹³é¢-envoy">æ•°æ®å¹³é¢ Envoy</h2>
<p>Envoy æ˜¯ Istio ä¸­é»˜è®¤çš„ sidecar proxyï¼Œè´Ÿè´£æœåŠ¡é—´çš„æµé‡ç®¡æ§ã€è®¤è¯ä¸å®‰å…¨åŠ å¯†ã€å¯è§‚å¯Ÿæ€§ç­‰ã€‚</p>
<p>ä¸‹é¢æ˜¯ Envoy çš„æ¶æ„å›¾ã€‚</p>
<p>
  <figure>
  <img src="envoy-arch-20190114.png" alt="Envoyæ¶æ„å›¾">
  
  <figcaption class="text-center">Envoyæ¶æ„å›¾</figcaption>
  
  </figure>

</p>
<p>æˆ‘å†ç»™å¤§å®¶ä»‹ç» Envoy ä¸­çš„å¦‚ä¸‹å‡ ä¸ªé‡è¦æ¦‚å¿µã€‚</p>
<h3 id="cluster">Cluster</h3>
<p>é›†ç¾¤ï¼ˆclusterï¼‰æ˜¯ Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡<a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery" title="æœåŠ¡å‘ç°" target="_blank" rel="noopener">æœåŠ¡å‘ç°</a>
å‘ç°é›†ç¾¤ä¸­çš„æˆå‘˜ã€‚Envoy å¯ä»¥é€šè¿‡<a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking#arch-overview-health-checking" title="ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥" target="_blank" rel="noopener">ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥</a>
æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶å†µã€‚Envoy å¦‚ä½•å°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤æˆå‘˜ç”±<a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing#arch-overview-load-balancing" title="è´Ÿè½½å‡è¡¡ç­–ç•¥" target="_blank" rel="noopener">è´Ÿè½½å‡è¡¡ç­–ç•¥</a>
ç¡®å®šã€‚</p>
<p>è¿™ä¸ªä¸ Kubernetes ä¸­çš„ Service æ¦‚å¿µç±»ä¼¼ï¼Œåªä¸è¿‡ Kubernetes ä¸­çš„æœåŠ¡å‘ç°ä¸­å¹¶ä¸åŒ…å«å¥åº·çŠ¶å†µæ£€æŸ¥ï¼Œè€Œæ˜¯é€šè¿‡<a href="https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html" title="é…ç½® Pod çš„ liveness å’Œ readiness æ¢é’ˆ" target="_blank" rel="noopener">é…ç½® Pod çš„ liveness å’Œ readiness æ¢é’ˆ</a>
æ¥å®ç°ï¼ŒæœåŠ¡å‘ç°é»˜è®¤ä¹Ÿæ˜¯é€šè¿‡ DNS æ¥å®ç°ã€‚</p>
<h3 id="listener">Listener</h3>
<p>ç›‘å¬å™¨ï¼ˆlistenerï¼‰æ˜¯å¯ä»¥ç”±ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥çš„å‘½åç½‘ç»œä½ç½®ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unixåŸŸå¥—æ¥å­—ç­‰ï¼‰ã€‚Envoy å…¬å¼€ä¸€ä¸ªæˆ–å¤šä¸ªä¸‹æ¸¸ä¸»æœºè¿æ¥çš„ä¾¦å¬å™¨ã€‚ä¸€èˆ¬æ˜¯æ¯å°ä¸»æœºè¿è¡Œä¸€ä¸ª Envoyï¼Œä½¿ç”¨å•è¿›ç¨‹è¿è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨ä»»æ„æ•°é‡çš„ Listenerï¼ˆç›‘å¬å™¨ï¼‰ï¼Œç›®å‰åªç›‘å¬ TCPï¼Œæ¯ä¸ªç›‘å¬å™¨éƒ½ç‹¬ç«‹é…ç½®ä¸€å®šæ•°é‡çš„ï¼ˆL3/L4ï¼‰ç½‘ç»œè¿‡æ»¤å™¨ã€‚Listenter ä¹Ÿå¯ä»¥é€šè¿‡ Listener Discovery Serviceï¼ˆ<strong>LDS</strong>ï¼‰åŠ¨æ€è·å–ã€‚</p>
<h3 id="listener-filter">Listener filter</h3>
<p>Listener ä½¿ç”¨ listener filterï¼ˆç›‘å¬å™¨è¿‡æ»¤å™¨ï¼‰æ¥æ“ä½œé“¾æ¥çš„å…ƒæ•°æ®ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨ä¸æ›´æ”¹ Envoy çš„æ ¸å¿ƒåŠŸèƒ½çš„æƒ…å†µä¸‹æ·»åŠ æ›´å¤šçš„é›†æˆåŠŸèƒ½ã€‚Listener filter çš„ API ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºè¿™äº›è¿‡æ»¤å™¨æœ€ç»ˆæ˜¯åœ¨æ–°æ¥å—çš„å¥—æ¥å­—ä¸Šè¿è¡Œã€‚åœ¨é“¾ä¸­å¯ä»¥äº’ç›¸è¡”æ¥ä»¥æ”¯æŒæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚è°ƒç”¨é€Ÿç‡é™åˆ¶ã€‚Envoy å·²ç»åŒ…å«äº†å¤šä¸ªç›‘å¬å™¨è¿‡æ»¤å™¨ã€‚</p>
<h2 id="istio-ä¸­å¢åŠ çš„æµé‡æ¨¡å‹">Istio ä¸­å¢åŠ çš„æµé‡æ¨¡å‹</h2>
<p><code>VirtualService</code>ã€<code>DestinationRule</code>ã€<code>Gateway</code>ã€<code>ServiceEntry</code> å’Œ <code>EnvoyFilter</code> éƒ½æ˜¯ Istio ä¸­ä¸ºæµé‡ç®¡ç†æ‰€åˆ›å»ºçš„ CRDï¼Œè¿™äº›æ¦‚å¿µå…¶å®æ˜¯åšè·¯ç”±é…ç½®å’Œæµé‡ç®¡ç†çš„ï¼Œè€Œ Kubernetes ä¸­çš„ service åªæ˜¯ç”¨æ¥åšæœåŠ¡å‘ç°ã€‚Service Mesh ä¸­çœŸæ­£çš„æœåŠ¡æ¨¡å‹åº”è¯¥æ˜¯ Envoy çš„ <a href="https://cloudnative.to/blog/envoy-xds-protocol/" title="xDS åè®®" target="_blank" rel="noopener">xDS åè®®</a>
ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æœåŠ¡çš„æµé‡æ²»ç†ï¼ŒæœåŠ¡çš„ç«¯ç‚¹æ˜¯é€šè¿‡ EDS æ¥é…ç½®çš„ã€‚</p>
<p>
  <figure>
  <img src="istio-pilot.png" alt="Istio pilot æ¶æ„å›¾">
  
  <figcaption class="text-center">Istio pilot æ¶æ„å›¾</figcaption>
  
  </figure>

</p>
<p>ä¸Šå›¾æ˜¯ Pilot è®¾è®¡å›¾ï¼Œæ¥è‡ª<a href="https://github.com/istio/old_pilot_repo/blob/master/doc/design.md" title="Istio Pilot design overview" target="_blank" rel="noopener">Istio Pilot design overview</a>
ã€‚</p>
<h3 id="routing">Routing</h3>
<p>Kubernetes ä¸­çš„ service æ˜¯æ²¡æœ‰ä»»ä½•è·¯ç”±å±æ€§å¯ä»¥é…ç½®çš„ï¼ŒIstio åœ¨è®¾è®¡ä¹‹åˆå°±é€šè¿‡åœ¨åŒä¸€ä¸ª Pod ä¸­ï¼Œåœ¨åº”ç”¨å®¹å™¨æ—è¿è¡Œä¸€ä¸ª sidecar proxy æ¥é€æ˜å¾—å®ç°ç»†ç²’åº¦çš„è·¯ç”±æ§åˆ¶ã€‚</p>
<h3 id="virtualservice">VirtualService</h3>
<p><code>VirtualService</code> å®šä¹‰é’ˆå¯¹æŒ‡å®šæœåŠ¡æµé‡çš„è·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½é’ˆå¯¹ç‰¹å®šåè®®çš„åŒ¹é…è§„åˆ™ã€‚å¦‚æœæµé‡ç¬¦åˆè¿™äº›ç‰¹å¾ï¼Œå°±ä¼šæ ¹æ®è§„åˆ™å‘é€åˆ°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ç›®æ ‡æœåŠ¡ï¼ˆæˆ–è€…ç›®æ ‡æœåŠ¡çš„å­é›†æˆ–ç‰ˆæœ¬ï¼‰ã€‚å¯¹äº A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒç­‰åœºæ™¯ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨åˆ’åˆ† <code>subset</code>ï¼ŒVirtualService ä¸­æ ¹æ® destination ä¸­çš„ subset é…ç½®æ¥é€‰æ‹©è·¯ç”±ï¼Œä½†æ˜¯è¿™äº› subset ç©¶ç«Ÿå¯¹åº”å“ªäº›æœåŠ¡ç¤ºä¾‹ï¼Œè¿™å°±éœ€è¦ <code>DestionationRule</code>ã€‚</p>
<h3 id="destinationrule">DestinationRule</h3>
<p><code>DestinationRule</code> æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚</p>
<h3 id="gateway">Gateway</h3>
<p><code>Gateway</code> æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½ç½‘æ ¼è¾¹ç¼˜çš„è¿›å…¥å’Œå‘å‡ºè¿æ¥ã€‚è¿™ä¸€è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£ï¼Œä»¥åŠè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚</p>
<p>è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯å®šä¹‰æœåŠ¡ç½‘æ ¼çš„è¾¹ç¼˜è·¯ç”±ã€‚</p>
<h3 id="serviceentry">ServiceEntry</h3>
<p><code>ServiceEntry</code> èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚<code>ServiceEntry</code> æè¿°äº†æœåŠ¡çš„å±æ€§ï¼ˆDNS åç§°ã€VIPã€ç«¯å£ã€åè®®ä»¥åŠç«¯ç‚¹ï¼‰ã€‚è¿™ç±»æœåŠ¡å¯èƒ½æ˜¯ç½‘æ ¼å¤–çš„ APIï¼Œæˆ–è€…æ˜¯å¤„äºç½‘æ ¼å†…éƒ¨ä½†å´ä¸å­˜åœ¨äºå¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ¡ç›®ï¼ˆä¾‹å¦‚éœ€è¦å’Œ Kubernetes æœåŠ¡æ²Ÿé€šçš„ä¸€ç»„è™šæ‹ŸæœºæœåŠ¡ï¼‰ã€‚</p>
<p>å¦‚æœæ²¡æœ‰é…ç½® ServiceEntry çš„è¯ï¼ŒIstio å®é™…ä¸Šæ˜¯æ— æ³•å‘ç°æœåŠ¡ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡çš„ã€‚</p>
<h3 id="envoyfilter">EnvoyFilter</h3>
<p><code>EnvoyFilter</code> å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸€åŠŸèƒ½ä¸€å®šè¦è°¨æ…ä½¿ç”¨ã€‚é”™è¯¯çš„é…ç½®å†…å®¹ä¸€æ—¦å®Œæˆä¼ æ’­ï¼Œå¯èƒ½ä¼šä»¤æ•´ä¸ªæœåŠ¡ç½‘æ ¼è¿›å…¥ç˜«ç—ªçŠ¶æ€ã€‚</p>
<p>Envoy ä¸­çš„ listener å¯ä»¥é…ç½®å¤šä¸ª <a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listener_filters" title="filter" target="_blank" rel="noopener">filter</a>
ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é€šè¿‡ Istio æ¥æ‰©å±• Envoy çš„æœºåˆ¶ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a href="https://jimmysong.io/kubernetes-handbook/concepts/service.html" title="Kubernetes ä¸­çš„ service - jimmysong.io" target="_blank" rel="noopener">Kubernetes ä¸­çš„ service - jimmysong.io</a>
</li>
<li><a href="https://github.com/istio/old_pilot_repo/blob/master/doc/service-registry.md" title="Istio services model - github.com" target="_blank" rel="noopener">Istio services model - github.com</a>
</li>
<li><a href="https://istio.io" title="Istio æ–‡æ¡£ - istio.io" target="_blank" rel="noopener">Istio æ–‡æ¡£ - istio.io</a>
</li>
</ul>

          </div>

          <div class="col-12 my-4">
            <div class="border-bottom"></div>
          </div>
          
          <div class="col-12">
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light">
              
              <a href="/tags/istio" class="badge"> 
                  Istio</a> </li>
          </div>

          
          
<div class="col-12">
<ul class="pager blog-pager">

<li class="previous">
<a href="https://jimmysong.io/blog/docker-exec-bug-on-centos7/" data-toggle="tooltip" data-placement="top" title="CentOS7å®˜æ–¹Dockerå‘è¡Œç‰ˆç°é‡å¤§Bugå¯è‡´Kubernetesä¸­çš„å¥åº·æ£€æµ‹æ¢é’ˆå¤±è´¥å¹¶å½±å“å®¹å™¨äº¤äº’">&larr; ä¸Šä¸€ç¯‡</a>
</li>
 
<li class="next">
<a href="https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/" data-toggle="tooltip" data-placement="top" title="ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘">ä¸‹ä¸€ç¯‡ &rarr;</a>
</li>

</ul>
</div>


          
          
          <div class="col-12">
          
           <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="zh-CN"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

          
          </div>
        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 sidebar">
      <!-- categories -->
<div class="bg-white mb-4">
  <p class="sidebar-title">
      åˆ†ç±»
  </p>
  <ul class="list-unstyled">
    <li class="border-bottom"><a href="/categories/istio" class="d-block pb-3 mt-3 text-capitalize">Istio</a></li>
    <li class="border-bottom"><a href="/categories/kubernetes" class="d-block pb-3 mt-3 text-capitalize">Kubernetes</a></li>
    <li class="border-bottom"><a href="/categories/service-mesh" class="d-block pb-3 mt-3 text-capitalize">Service mesh</a></li>
    <li class="border-bottom"><a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="d-block pb-3 mt-3 text-capitalize">äº‘åŸç”Ÿ</a></li>
    <li class="border-bottom"><a href="/categories/%e5%85%b6%e4%bb%96" class="d-block pb-3 mt-3 text-capitalize">å…¶ä»–</a></li>
    <li class="border-bottom"><a href="/categories/%e5%ae%b9%e5%99%a8" class="d-block pb-3 mt-3 text-capitalize">å®¹å™¨</a></li>
    <li class="border-bottom"><a href="/categories/%e5%bc%80%e6%ba%90" class="d-block pb-3 mt-3 text-capitalize">å¼€æº</a></li>
    <li class="border-bottom"><a href="/categories/%e6%96%87%e5%8c%96" class="d-block pb-3 mt-3 text-capitalize">æ–‡åŒ–</a></li>
    <li class="border-bottom"><a href="/categories/%e6%97%85%e8%a1%8c" class="d-block pb-3 mt-3 text-capitalize">æ—…è¡Œ</a></li>
  </ul>
</div>

<!-- tags -->
<div class="bg-white mb-4">
    <p class="sidebar-title">
    æ ‡ç­¾
    </p>
    
    
    
    
    
    
    
    
    

    <div id="tag-cloud">
        
            
            
            
            
            
            
            <a href="/tags/abac" style="font-size:0.8rem">Abac</a>
        
            
            
            
            
            
            
            <a href="/tags/aeraki" style="font-size:0.8rem">Aeraki</a>
        
            
            
            
            
            
            
            <a href="/tags/api-gateway" style="font-size:0.8rem">API gateway</a>
        
            
            
            
            
            
            
            <a href="/tags/aws" style="font-size:0.8rem">Aws</a>
        
            
            
            
            
            
            
            <a href="/tags/cloudfoundry" style="font-size:0.8rem">Cloudfoundry</a>
        
            
            
            
            
            
            
            <a href="/tags/cncf" style="font-size:1.1770432991281177rem">Cncf</a>
        
            
            
            
            
            
            
            <a href="/tags/contiv" style="font-size:1.1770432991281177rem">Contiv</a>
        
            
            
            
            
            
            
            <a href="/tags/day2" style="font-size:0.8rem">Day2</a>
        
            
            
            
            
            
            
            <a href="/tags/devops" style="font-size:0.8rem">Devops</a>
        
            
            
            
            
            
            
            <a href="/tags/docker" style="font-size:1.7057234225485516rem">Docker</a>
        
            
            
            
            
            
            
            <a href="/tags/ebpf" style="font-size:0.8rem">Ebpf</a>
        
            
            
            
            
            
            
            <a href="/tags/envoy" style="font-size:1.4149311349327904rem">Envoy</a>
        
            
            
            
            
            
            
            <a href="/tags/github" style="font-size:0.8rem">Github</a>
        
            
            
            
            
            
            
            <a href="/tags/hadoop" style="font-size:0.8rem">Hadoop</a>
        
            
            
            
            
            
            
            <a href="/tags/helm" style="font-size:0.8rem">Helm</a>
        
            
            
            
            
            
            
            <a href="/tags/how-to" style="font-size:0.8rem">How to</a>
        
            
            
            
            
            
            
            <a href="/tags/hugo" style="font-size:0.8rem">Hugo</a>
        
            
            
            
            
            
            
            <a href="/tags/infoq" style="font-size:0.8rem">Infoq</a>
        
            
            
            
            
            
            
            <a href="/tags/iptables" style="font-size:1.1770432991281177rem">Iptables</a>
        
            
            
            
            
            
            
            <a href="/tags/istio" style="font-size:1.9894391790233632rem">Istio</a>
        
            
            
            
            
            
            
            <a href="/tags/katacoda" style="font-size:0.8rem">Katacoda</a>
        
            
            
            
            
            
            
            <a href="/tags/kubernetes" style="font-size:1.6229567008718824rem">Kubernetes</a>
        
            
            
            
            
            
            
            <a href="/tags/multicluster" style="font-size:0.8rem">Multicluster</a>
        
            
            
            
            
            
            
            <a href="/tags/ngac" style="font-size:0.8rem">Ngac</a>
        
            
            
            
            
            
            
            <a href="/tags/nocalhost" style="font-size:0.8rem">Nocalhost</a>
        
            
            
            
            
            
            
            <a href="/tags/oam" style="font-size:0.8rem">Oam</a>
        
            
            
            
            
            
            
            <a href="/tags/obs" style="font-size:0.8rem">Obs</a>
        
            
            
            
            
            
            
            <a href="/tags/rbac" style="font-size:0.8rem">Rbac</a>
        
            
            
            
            
            
            
            <a href="/tags/service-mesh" style="font-size:1.6528189707374632rem">Service mesh</a>
        
            
            
            
            
            
            
            <a href="/tags/sidecar" style="font-size:1.3523584493868213rem">Sidecar</a>
        
            
            
            
            
            
            
            <a href="/tags/slime" style="font-size:1.0378878358046726rem">Slime</a>
        
            
            
            
            
            
            
            <a href="/tags/spiffe" style="font-size:1.0378878358046726rem">Spiffe</a>
        
            
            
            
            
            
            
            <a href="/tags/spire" style="font-size:1.0378878358046726rem">Spire</a>
        
            
            
            
            
            
            
            <a href="/tags/swarm" style="font-size:0.8rem">Swarm</a>
        
            
            
            
            
            
            
            <a href="/tags/telepresence" style="font-size:0.8rem">Telepresence</a>
        
            
            
            
            
            
            
            <a href="/tags/tetrate" style="font-size:1.0378878358046726rem">Tetrate</a>
        
            
            
            
            
            
            
            <a href="/tags/thenewstack" style="font-size:1.0378878358046726rem">Thenewstack</a>
        
            
            
            
            
            
            
            <a href="/tags/tsb" style="font-size:0.8rem">Tsb</a>
        
            
            
            
            
            
            
            <a href="/tags/vagrant" style="font-size:0.8rem">Vagrant</a>
        
            
            
            
            
            
            
            <a href="/tags/wercker" style="font-size:0.8rem">Wercker</a>
        
            
            
            
            
            
            
            <a href="/tags/yarn" style="font-size:0.8rem">Yarn</a>
        
            
            
            
            
            
            
            <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F" style="font-size:1.1770432991281177rem">äº‘åŸç”Ÿ</a>
        
            
            
            
            
            
            
            <a href="/tags/%E5%9B%BE%E4%B9%A6" style="font-size:1.513663507414018rem">å›¾ä¹¦</a>
        
            
            
            
            
            
            
            <a href="/tags/%E5%AE%89%E5%85%A8" style="font-size:1.0378878358046726rem">å®‰å…¨</a>
        
            
            
            
            
            
            
            <a href="/tags/%E5%BC%80%E6%BA%90" style="font-size:0.8rem">å¼€æº</a>
        
            
            
            
            
            
            
            <a href="/tags/%E6%96%87%E5%8C%96" style="font-size:1.0378878358046726rem">æ–‡åŒ–</a>
        
            
            
            
            
            
            
            <a href="/tags/%E6%97%85%E8%A1%8C" style="font-size:0.8rem">æ—…è¡Œ</a>
        
            
            
            
            
            
            
            <a href="/tags/%E7%9B%B4%E6%92%AD" style="font-size:0.8rem">ç›´æ’­</a>
        
            
            
            
            
            
            
            <a href="/tags/%E8%B6%8B%E5%8A%BF" style="font-size:0.8rem">è¶‹åŠ¿</a>
        
            
            
            
            
            
            
            <a href="/tags/%E8%BA%AB%E4%BB%BD" style="font-size:0.8rem">èº«ä»½</a>
        
            
            
            
            
            
            
            <a href="/tags/%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81" style="font-size:0.8rem">èº«ä»½è®¤è¯</a>
        
            
            
            
            
            
            
            <a href="/tags/%E9%9B%B6%E4%BF%A1%E4%BB%BB" style="font-size:1.0378878358046726rem">é›¶ä¿¡ä»»</a>
        
    </div>

</div>

      <!-- recommend -->
      

<div class="bg-white md-4">
  <p class="sidebar-title">
  ç›¸å…³æ–‡ç« 
  </p>
  <!-- post-item -->
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <a href="/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/"><img class="mr-3 post-thumb-sm" src="/images/banner/istio-logo.webp" alt="blog banner"></a>
    <div class="media-body">
      <a href="/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/">
        <p class="mt-0">ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ</p>
      </a>
      2018å¹´9æœˆ11æ—¥
    </div>
  </div>
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <a href="/blog/istio-tutorial/"><img class="mr-3 post-thumb-sm" src="/images/banner/istio-logo.webp" alt="blog banner"></a>
    <div class="media-body">
      <a href="/blog/istio-tutorial/">
        <p class="mt-0">Istio Service Mesh æ•™ç¨‹</p>
      </a>
      2018å¹´4æœˆ18æ—¥
    </div>
  </div>
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <a href="/blog/istio-community-tips/"><img class="mr-3 post-thumb-sm" src="/images/banner/istio-logo.webp" alt="blog banner"></a>
    <div class="media-body">
      <a href="/blog/istio-community-tips/">
        <p class="mt-0">Istio ç¤¾åŒºä»‹ç»ä¸ç¤¾åŒºå‚ä¸æ³¨æ„äº‹é¡¹</p>
      </a>
      2018å¹´4æœˆ14æ—¥
    </div>
  </div>
  
</div>


      <!-- /recommend -->
      <!-- toc -->
      
<div class="bg-white py-5 box-shadow mb-4 sticky-top aside-toc d-none d-sm-block">
    <p class="sidebar-title">
    ç›®å½•
    </p>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#kubernetes-ä¸-istio-ä¸­å…±æœ‰çš„æ¨¡å‹">Kubernetes ä¸ Istio ä¸­å…±æœ‰çš„æ¨¡å‹</a>
      <ul>
        <li><a href="#service">Service</a></li>
        <li><a href="#endpoint">Endpoint</a></li>
        <li><a href="#label">Label</a></li>
      </ul>
    </li>
    <li><a href="#æ•°æ®å¹³é¢-envoy">æ•°æ®å¹³é¢ Envoy</a>
      <ul>
        <li><a href="#cluster">Cluster</a></li>
        <li><a href="#listener">Listener</a></li>
        <li><a href="#listener-filter">Listener filter</a></li>
      </ul>
    </li>
    <li><a href="#istio-ä¸­å¢åŠ çš„æµé‡æ¨¡å‹">Istio ä¸­å¢åŠ çš„æµé‡æ¨¡å‹</a>
      <ul>
        <li><a href="#routing">Routing</a></li>
        <li><a href="#virtualservice">VirtualService</a></li>
        <li><a href="#destinationrule">DestinationRule</a></li>
        <li><a href="#gateway">Gateway</a></li>
        <li><a href="#serviceentry">ServiceEntry</a></li>
        <li><a href="#envoyfilter">EnvoyFilter</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>
</div>

      <!-- /toc -->
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>



      
    

<footer>
  
  <div class="footer bg-footer section-sm border-bottom">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-sm-8 mb-5 mb-lg-0">
          
          <h4 class="text-white mb-5 text-uppercase">å…³æ³¨æˆ‘</h4>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">æ‰«ç å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="128px" alt="footer image"></li>
            
            
            
          
        </div>
        
        

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">åšå®¢</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/how-to-integrate-spire-with-istio/">å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIREï¼Ÿ</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/cloud-and-devops-trend-2022/">2022 å¹´äº‘å’Œ DevOps è¶‹åŠ¿æŠ¥å‘Š</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/what-is-zero-trust/">ä»€ä¹ˆæ˜¯é›¶ä¿¡ä»»ï¼Ÿ</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">é“¾æ¥</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener">Tetrate å…¬å¸</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">äº‘åŸç”Ÿå­¦é™¢|Bilibili</a></li>
            
            <li class="mb-3"><a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener">äº‘åŸç”Ÿå¼€æºé¡¹ç›®å¤§å…¨</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener">äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://lib.jimmysong.io" target="_blank" rel="noopener">äº‘åŸç”Ÿèµ„æ–™åº“</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">å›¾ä¹¦</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="https://lib.jimmysong.io/envoy-handbook/" target="_blank" rel="noopener">Envoy åŸºç¡€æ•™ç¨‹</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://lib.jimmysong.io/istio-handbook/" target="_blank" rel="noopener">Istio åŸºç¡€æ•™ç¨‹</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://lib.jimmysong.io/kubernetes-handbook/" target="_blank" rel="noopener">Kubernetes åŸºç¡€æ•™ç¨‹</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-service-mesh-book/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Istio</a></li>
            
          </ul>
        </div>
        
        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">é€šçŸ¥</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/cilium-handbook/">ã€ŠCilium ä¸­æ–‡æŒ‡å—ã€‹å‘å¸ƒ</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/what-is-ebpf/">ã€Šä»€ä¹ˆæ˜¯ eBPFã€‹ç¿»è¯‘ç”µå­ä¹¦</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-public-library/">äº‘åŸç”Ÿèµ„æ–™åº“å‘å¸ƒ</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 text-sm-left text-center">
          <p class="mb-0 text-color">Â© 2017-2022 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
        </div>
        <div class="col-sm-3 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" rel="noopener"><i class="fa fa-twitter "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" rel="noopener"><i class="fa fa-github "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" rel="noopener"><i class="fa fa-linkedin "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="mailto:jimmysong@jimmysong.io" target="_blank" rel="noopener"><i class="fa fa-envelope "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="/blog/index.xml" target="_blank" rel="noopener"><i class="fa fa-rss "></i></a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>




<!-- JS Plugins -->

<script src="/plugins/jQuery/jquery.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/venobox/venobox.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/search/search.js"></script>

<script src="/plugins/bigPicture/bigPicture.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.js"></script>

<!-- google analitycs -->

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-93485976-1', 'auto');
  ga('send', 'pageview');
</script>



<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


<!-- Algolia -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.js"></script>
<script>
  docsearch({
    apiKey: 'd7f7189aef2be4e5be6a6b9f44897f61',
    indexName: 'DocSearch',
    appId: 'CRNDR5CNMU',
    inputSelector: '#js-algolia-btn',
    debug: false,
  });
</script>

<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>



<script>
    anchors.add()
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();

        flashCopyMessage(copyBtn, 'OK')
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>
</body>

</html>
