<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>使用 Envoy 实现 HTTP/2 CONNECT 隧道：原理与实践 - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="深入讲解如何利用 HTTP/2 CONNECT 方法创建隧道，涵盖技术原理、实践流程与示例代码。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/blog/http2-envoy-tunnel-demo/" />
  <meta property="og:title" content="使用 Envoy 实现 HTTP/2 CONNECT 隧道：原理与实践 | Jimmy Song" />
  <meta property="twitter:title" content="使用 Envoy 实现 HTTP/2 CONNECT 隧道：原理与实践 | Jimmy Song" />

  
  <meta property="og:description" content="深入讲解如何利用 HTTP/2 CONNECT 方法创建隧道，涵盖技术原理、实践流程与示例代码。" />
  <meta property="twitter:description" content="深入讲解如何利用 HTTP/2 CONNECT 方法创建隧道，涵盖技术原理、实践流程与示例代码。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />
  <meta property="twitter:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    使用 Envoy 实现 HTTP/2 CONNECT 隧道：原理与实践
                </p>
                <p class="page-description">
                    深入讲解如何利用 HTTP/2 CONNECT 方法创建隧道，涵盖技术原理、实践流程与示例代码。
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>2025/01/14</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/categories/istio"> 
                        Istio</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>16 分钟</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>3526 字</li>
                    
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">

            
            
            
              <div class="alert alert-note-container mt-2">
    <div class="alert-note-title px-2 py-2">
      版权声明
    </div>
    <div class="alert-tip px-2">
      本文为 Jimmy Song 原创。转载请注明来源： <a title=https://jimmysong.io/blog/http2-envoy-tunnel-demo/>https://jimmysong.io/blog/http2-envoy-tunnel-demo/</a>
     </div>
  </div>
            

            
              <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>查看本文大纲</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是-http2-connect-方法以及-hbone-隧道">什么是 HTTP2 Connect 方法以及 HBONE 隧道？</a></li>
    <li><a href="#使用-http2-connect-建立隧道的基本原理">使用 HTTP2 Connect 建立隧道的基本原理</a></li>
    <li><a href="#demo使用-envoy-与上游-server-建立-http2-connect-隧道">Demo：使用 Envoy 与上游 Server 建立 HTTP/2 Connect 隧道</a>
      <ul>
        <li><a href="#核心功能展示">核心功能展示</a></li>
        <li><a href="#环境准备">环境准备</a></li>
        <li><a href="#生成自签名证书">生成自签名证书</a></li>
        <li><a href="#配置-envoy-代理">配置 Envoy 代理</a></li>
        <li><a href="#实现服务器">实现服务器</a></li>
        <li><a href="#实现客户端">实现客户端</a></li>
        <li><a href="#创建-docker-compose-文件">创建 Docker Compose 文件</a></li>
        <li><a href="#运行示例">运行示例</a></li>
        <li><a href="#测试通信">测试通信</a></li>
        <li><a href="#注意事项">注意事项</a></li>
      </ul>
    </li>
    <li><a href="#隧道建立过程">隧道建立过程</a></li>
    <li><a href="#结语">结语</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
</details>

            
            <p>在最近对 Istio Ambient 模式的研究中，我发现 HTTP2 Connect 方法被用作创建隧道的核心技术，以实现透明流量的拦截和转发。HTTP/2 CONNECT 隧道是一种强大的工具，可以在已有的 HTTP/2 连接中创建高效的隧道，用于传输原始的 TCP 数据。这篇文章通过一个简单的 Demo，展示了如何使用 Envoy 来实现 HTTP/2 CONNECT 隧道的基本功能。</p>
<h2 id="什么是-http2-connect-方法以及-hbone-隧道">什么是 HTTP2 Connect 方法以及 HBONE 隧道？</h2>
<p>HTTP2 Connect 方法是一种标准化的方式来创建隧道，用于透明地传输数据。特别是在 Istio 的 Ambient 模式中，它为代理数据平面之间的通信提供了一种高效的手段。HBONE（HTTP-Based Overlay Network Environment）隧道则是基于这种 HTTP2 Connect 技术的实现，用于 Istio 中的透明流量拦截和转发。通过使用 HBONE，数据可以有效地通过 HTTP2 隧道安全传输，替代了传统的 Sidecar 模式。这一创新设计极大地简化了服务网格的管理和部署。</p>
<p>HBONE 是 Istio 特有的术语，它是一种安全隧道协议，用于在 Istio 组件之间进行通信。在当前的 Istio 实现中，HBONE 协议包含了三个开放标准：</p>
<ul>
<li><strong>HTTP/2</strong></li>
<li><strong>HTTP CONNECT</strong></li>
<li><strong>Mutual TLS (mTLS)</strong></li>
</ul>
<p>HTTP CONNECT 用于建立隧道连接，mTLS 用于安全地加密连接，而 HTTP/2 用于在单一安全隧道中多路复用应用连接流并传输附加的流级元数据。更多关于 HBONE 隧道的细节可以参考官方文档：<a href="https://istio.io/latest/docs/ambient/architecture/hbone/" title="HBONE 详细介绍" target="_blank" rel="noopener">HBONE 详细介绍</a>。</p>
<h2 id="使用-http2-connect-建立隧道的基本原理">使用 HTTP2 Connect 建立隧道的基本原理</h2>
<p>HTTP2 Connect 方法允许我们创建一个类似于 VPN 的隧道，通过这个隧道可以安全地传递数据。建立隧道的基本步骤如下：</p>
<ol>
<li>首先，客户端向代理发送一个普通的 TCP 或 HTTP 链接请求。</li>
<li>代理接收到请求后，代表客户端向目标服务器发送一个带有 CONNECT 方法的 HTTP2 请求。</li>
<li>如果服务器允许建立隧道，那么它会返回一个 HTTP2 200 OK 的响应给代理。</li>
<li>随后，客户端、代理和服务器之间的双向流数据就可以通过这个隧道进行传输。</li>
</ol>
<p>这种方法能够使得数据的传输过程更加透明且安全，特别适用于需要高效通信和端到端加密的场景。</p>
<p>下图展示了 HTTP2 Connect 方法建立隧道的基本过程。</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/blog/http2-envoy-tunnel-demo/1f4003a92425618f8bf5b9c1403169a7.svg" data-img="/blog/http2-envoy-tunnel-demo/1f4003a92425618f8bf5b9c1403169a7.svg" alt="image" data-caption="HTTP2 Connect 方法建立隧道的基本过程">
        
      
    
  
  
  <figcaption>HTTP2 Connect 方法建立隧道的基本过程</figcaption>
  
</figure>
<h2 id="demo使用-envoy-与上游-server-建立-http2-connect-隧道">Demo：使用 Envoy 与上游 Server 建立 HTTP/2 Connect 隧道</h2>
<p>本示例展示了一个基础场景：</p>
<ol>
<li><strong>客户端</strong>：向 Envoy 代理发送文本消息。</li>
<li><strong>Envoy</strong>：接收客户端的 TCP 数据，将其封装为 HTTP/2 CONNECT 请求，并与上游服务器建立加密隧道。</li>
<li><strong>服务器</strong>：接收来自 Envoy 的 HTTP/2 CONNECT 流量，解封装并返回响应给客户端。</li>
</ol>
<p>架构图如下：</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/blog/http2-envoy-tunnel-demo/b25a0e3bb0f015f7a0c8b280d1025f88.svg" data-img="/blog/http2-envoy-tunnel-demo/b25a0e3bb0f015f7a0c8b280d1025f88.svg" alt="image" data-caption="架构图">
        
      
    
  
  
  <figcaption>架构图</figcaption>
  
</figure>
<p>我们将使用 Node.js 来编写客户端和服务端，并将服务端和 Envoy 代理运行在容器中，在本地通过客户端访问 Envoy 代理从而达到访问客户端的目的。</p>
<p>完整的目录结构如下：</p>
<pre tabindex="0"><code>envoy-http2-tunnel/
├── certs/
│   ├── openssl.cnf
│   ├── server.crt
│   ├── server.key
├── client/
│   └── client.js
├── docker-compose.yml
├── envoy.yaml
└── server/
    ├── Dockerfile
    └── server.js
</code></pre><h3 id="核心功能展示">核心功能展示</h3>
<h4 id="1-http2-connect-隧道的基本实现"><strong>1. HTTP/2 CONNECT 隧道的基本实现</strong></h4>
<ul>
<li>客户端通过普通的 TCP 连接与 Envoy 通信。</li>
<li>Envoy 将 TCP 数据封装为 HTTP/2 CONNECT 请求，发送到上游服务器。</li>
<li>服务器接收并解封装隧道中的数据，进行处理后返回响应。</li>
<li>隧道通信对客户端完全透明。</li>
</ul>
<h4 id="2-envoy-的透明代理能力"><strong>2. Envoy 的透明代理能力</strong></h4>
<ul>
<li>Envoy 作为中间代理，将客户端与服务器之间的通信逻辑完全封装。</li>
<li>客户端无需支持复杂的协议（如 HTTP/2 或 TLS），Envoy 代理完成所有协议转换。</li>
</ul>
<h4 id="3-加密通信的实现"><strong>3. 加密通信的实现</strong></h4>
<ul>
<li>Envoy 与服务器之间的通信通过 TLS 加密，确保隧道内的数据安全。</li>
<li>服务器终止 TLS，处理解密后的数据。</li>
</ul>
<h4 id="4-隧道的简化使用场景"><strong>4. 隧道的简化使用场景</strong></h4>
<ul>
<li>通过该 Demo，可以快速理解 HTTP/2 CONNECT 隧道的建立和基本数据传输流程。</li>
</ul>
<h3 id="环境准备">环境准备</h3>
<h4 id="1-安装-nodejs">1. 安装 Node.js</h4>
<p>确保你的系统已安装 <strong>Node.js</strong>（版本 &gt;= <strong>10.10.0</strong>），因为 <code>http2</code> 模块在该版本后稳定。</p>
<ul>
<li><strong>下载链接：</strong> <a href="https://nodejs.org/" title="Node.js 官方网站" target="_blank" rel="noopener">Node.js 官方网站</a></li>
</ul>
<h4 id="2-安装-docker-和-docker-compose">2. 安装 Docker 和 Docker Compose</h4>
<ul>
<li><strong>Docker 下载链接：</strong> <a href="https://www.docker.com/get-started" title="Docker 官方网站" target="_blank" rel="noopener">Docker 官方网站</a></li>
<li><strong>Docker Compose 下载链接：</strong> <a href="https://docs.docker.com/compose/install/" title="Docker Compose 官方文档" target="_blank" rel="noopener">Docker Compose 官方文档</a></li>
</ul>
<h4 id="3-创建项目目录">3. 创建项目目录</h4>
<p>在你的工作空间中创建一个新目录并进入：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir envoy-http2-tunnel
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> envoy-http2-tunnel
</span></span></code></pre></div><h3 id="生成自签名证书">生成自签名证书</h3>
<p>由于 Envoy 和服务器之间需要加密通信，我们需要生成包含正确配置的自签名证书。</p>
<h4 id="1-创建证书目录和-openssl-配置文件">1. 创建证书目录和 OpenSSL 配置文件</h4>
<p>创建 <code>certs</code> 目录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir certs
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> certs
</span></span></code></pre></div><p>创建 <code>openssl.cnf</code>，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[ req ]</span>
</span></span><span class="line"><span class="cl"><span class="na">default_bits</span>       <span class="o">=</span> <span class="s">2048</span>
</span></span><span class="line"><span class="cl"><span class="na">default_md</span>         <span class="o">=</span> <span class="s">sha256</span>
</span></span><span class="line"><span class="cl"><span class="na">prompt</span>             <span class="o">=</span> <span class="s">no</span>
</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span> <span class="o">=</span> <span class="s">dn</span>
</span></span><span class="line"><span class="cl"><span class="na">req_extensions</span>     <span class="o">=</span> <span class="s">req_ext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ dn ]</span>
</span></span><span class="line"><span class="cl"><span class="na">C</span>            <span class="o">=</span> <span class="s">US</span>
</span></span><span class="line"><span class="cl"><span class="na">ST</span>           <span class="o">=</span> <span class="s">California</span>
</span></span><span class="line"><span class="cl"><span class="na">L</span>            <span class="o">=</span> <span class="s">San Francisco</span>
</span></span><span class="line"><span class="cl"><span class="na">O</span>            <span class="o">=</span> <span class="s">My Company</span>
</span></span><span class="line"><span class="cl"><span class="na">OU</span>           <span class="o">=</span> <span class="s">My Division</span>
</span></span><span class="line"><span class="cl"><span class="na">CN</span>           <span class="o">=</span> <span class="s">server</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ req_ext ]</span>
</span></span><span class="line"><span class="cl"><span class="na">subjectAltName</span> <span class="o">=</span> <span class="s">@alt_names</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ alt_names ]</span>
</span></span><span class="line"><span class="cl"><span class="na">DNS.1</span>   <span class="o">=</span> <span class="s">server</span>
</span></span><span class="line"><span class="cl"><span class="na">DNS.2</span>   <span class="o">=</span> <span class="s">localhost</span>
</span></span></code></pre></div><h4 id="2-生成密钥和证书">2. 生成密钥和证书</h4>
<p>运行以下命令生成密钥和证书：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl req -x509 -nodes -days <span class="m">365</span> -newkey rsa:2048 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -keyout server.key -out server.crt -config openssl.cnf
</span></span></code></pre></div><p>这将在 <code>certs</code> 目录中生成 <code>server.key</code> 和 <code>server.crt</code> 文件。</p>
<h3 id="配置-envoy-代理">配置 Envoy 代理</h3>
<p>我们需要配置 Envoy，使其能够接受客户端的普通 TCP 连接，将数据通过 HTTP/2 CONNECT 隧道传递给服务器。</p>
<h4 id="1-创建-envoy-配置文件">1. 创建 Envoy 配置文件</h4>
<p>在项目根目录创建 <code>envoy.yaml</code>，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">static_resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">listener_0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">socket_address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">filter_chains</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envoy.filters.network.tcp_proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">typed_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">&#34;@type&#34;: </span><span class="l">type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">stat_prefix</span><span class="p">:</span><span class="w"> </span><span class="l">tcp_stats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel_cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">tunneling_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">server:8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">access_log</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envoy.access_loggers.stdout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">&#34;@type&#34;: </span><span class="l">type.googleapis.com/envoy.extensions.access_loggers.stream.v3.StdoutAccessLog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">log_format</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">json_format</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">start_time</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%START_TIME%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(:METHOD)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%PROTOCOL%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">response_code</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%RESPONSE_CODE%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">response_flags</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%RESPONSE_FLAGS%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">bytes_received</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%BYTES_RECEIVED%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">bytes_sent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%BYTES_SENT%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%DURATION%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">upstream_service_time</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">x_forwarded_for</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(X-FORWARDED-FOR)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">user_agent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(USER-AGENT)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">request_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(X-REQUEST-ID)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">upstream_host</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%UPSTREAM_HOST%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">upstream_cluster</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%UPSTREAM_CLUSTER%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">downstream_local_address</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%DOWNSTREAM_LOCAL_ADDRESS%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">downstream_remote_address</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%DOWNSTREAM_REMOTE_ADDRESS%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel_cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">connect_timeout</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LOGICAL_DNS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">lb_policy</span><span class="p">:</span><span class="w"> </span><span class="l">ROUND_ROBIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">transport_socket</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envoy.transport_sockets.tls</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">typed_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;@type&#34;: </span><span class="l">type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sni</span><span class="p">:</span><span class="w"> </span><span class="l">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">common_tls_context</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">validation_context</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">trusted_ca</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/certs/server.crt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">alpn_protocols</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&#34;h2&#34;</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http2_protocol_options</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">load_assignment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel_cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">lb_endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">endpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">socket_address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></div><h4 id="2-关键点">2. 关键点</h4>
<ul>
<li><strong>Envoy 监听 TCP 连接</strong>，将流量通过 <strong>HTTP/2 CONNECT 隧道</strong>转发到服务器。</li>
<li><strong>客户端</strong>只需与 <strong>Envoy</strong> 建立 TCP 连接，发送文本消息。</li>
<li><strong>Envoy</strong>负责隧道的建立和加密，<strong>客户端</strong>无需感知。</li>
</ul>
<h3 id="实现服务器">实现服务器</h3>
<h4 id="1-创建服务器目录和文件">1. 创建服务器目录和文件</h4>
<p>在项目根目录创建 <code>server</code> 目录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir server
</span></span></code></pre></div><p>在 <code>server</code> 目录中创建 <code>server.js</code> 和 <code>Dockerfile</code>。</p>
<h4 id="2-编写-serverjs">2. 编写 <code>server.js</code></h4>
<p>在 <code>server/server.js</code> 中添加以下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">http2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http2&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http2</span><span class="p">.</span><span class="nx">createSecureServer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">key</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/certs/server.key&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cert</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/certs/server.crt&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;:method&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;:path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">&#39;CONNECT&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received CONNECT request for </span><span class="si">${</span><span class="nx">path</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 响应 200，建立隧道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">stream</span><span class="p">.</span><span class="nx">respond</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;:status&#39;</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 在隧道内处理数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received from client: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// 回应客户端
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="sb">`Echo from server: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">stream</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Stream ended by client.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">stream</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 对于非 CONNECT 请求，返回 404
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">stream</span><span class="p">.</span><span class="nx">respond</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;:status&#39;</span><span class="o">:</span> <span class="mi">404</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">stream</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Secure HTTP/2 server is listening on port 8080&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p><strong>注意：</strong></p>
<ul>
<li>监听 <code>secureConnection</code> 事件，直接处理 TLS 连接后的 socket。</li>
<li>在 socket 上接收数据，处理来自客户端的文本消息，并回复。</li>
</ul>
<h4 id="3-创建-dockerfile">3. 创建 <code>Dockerfile</code></h4>
<p>在 <code>server/Dockerfile</code> 中添加以下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> node:14</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> server.js .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;node&#34;</span><span class="p">,</span> <span class="s2">&#34;server.js&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><h3 id="实现客户端">实现客户端</h3>
<h4 id="1-创建客户端目录和文件">1. 创建客户端目录和文件</h4>
<p>在项目根目录创建 <code>client</code> 目录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir client
</span></span></code></pre></div><p>在 <code>client</code> 目录中创建 <code>client.js</code>。</p>
<h4 id="2-编写-clientjs">2. 编写 <code>client.js</code></h4>
<p>在 <code>client/client.js</code> 中添加以下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">net</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 创建与 Envoy 的 TCP 连接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span> <span class="nx">port</span><span class="o">:</span> <span class="mi">10000</span> <span class="p">},</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected to Envoy.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 发送消息给服务器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="sb">`Message </span><span class="si">${</span><span class="nx">counter</span><span class="si">}</span><span class="sb"> from client!`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">counter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 关闭连接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received from server: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Disconnected from server.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Client error:&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p><strong>说明：</strong></p>
<ul>
<li><strong>客户端</strong>与 <strong>Envoy</strong> 建立普通的 TCP 连接，发送文本消息。</li>
<li>该客户端的存在只是为了触发 Envoy 与服务器建立隧道。</li>
</ul>
<h3 id="创建-docker-compose-文件">创建 Docker Compose 文件</h3>
<p>在项目根目录创建 <code>docker-compose.yml</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">envoy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">envoyproxy/envoy:v1.32.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./envoy.yaml:/etc/envoy/envoy.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./certs:/certs </span><span class="w"> </span><span class="c"># 挂载证书目录</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;10000:10000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">envoy_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/local/bin/envoy -c /etc/envoy/envoy.yaml --service-cluster envoy --log-level debug</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l">./server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">envoy_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8080&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./certs:/certs </span><span class="w"> </span><span class="c"># 挂载证书目录</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">envoy_network</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><h3 id="运行示例">运行示例</h3>
<h4 id="1-启动-docker-compose">1. 启动 Docker Compose</h4>
<p>在项目根目录下，运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose up --build
</span></span></code></pre></div><p><strong>预期输出：</strong></p>
<ul>
<li><strong>Envoy 容器：</strong> 显示启动信息和调试日志。</li>
<li><strong>服务器容器：</strong> 显示 <code>Secure HTTP/2 server is listening on port 8080</code>。</li>
</ul>
<h4 id="2-运行客户端">2. 运行客户端</h4>
<p>打开新的终端窗口，进入 <code>client</code> 目录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> client
</span></span></code></pre></div><p>运行客户端：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">node client.js
</span></span></code></pre></div><p><strong>预期输出：</strong></p>
<pre tabindex="0"><code>Connected to Envoy.
Received from server: Echo from server: Message 1 from client!
Received from server: Echo from server: Message 2 from client!
Received from server: Echo from server: Message 3 from client!
Received from server: Echo from server: Message 4 from client!
Received from server: Echo from server: Message 5 from client!
Disconnected from server.
</code></pre><h4 id="3-检查服务器日志">3. 检查服务器日志</h4>
<p>在 Docker Compose 的输出中，你应该能看到服务器的日志：</p>
<pre tabindex="0"><code>envoy_1   | {&#34;downstream_remote_address&#34;:&#34;192.168.65.1:46306&#34;,&#34;path&#34;:null,&#34;request_id&#34;:null,&#34;bytes_sent&#34;:160,&#34;protocol&#34;:null,&#34;upstream_service_time&#34;:null,&#34;bytes_received&#34;:88,&#34;response_code&#34;:0,&#34;user_agent&#34;:null,&#34;downstream_local_address&#34;:&#34;172.21.0.3:10000&#34;,&#34;upstream_host&#34;:&#34;172.21.0.2:8080&#34;,&#34;start_time&#34;:&#34;2024-12-03T11:37:59.542Z&#34;,&#34;upstream_cluster&#34;:&#34;tunnel_cluster&#34;,&#34;duration&#34;:5012,&#34;response_flags&#34;:&#34;-&#34;,&#34;method&#34;:null,&#34;x_forwarded_for&#34;:null}
server_1  | Secure HTTP/2 server is listening on port 8080
server_1  | New secure connection established.
server_1  | Received from client: Message 1 from client!
server_1  | Received from client: Message 2 from client!
server_1  | Received from client: Message 3 from client!
server_1  | Received from client: Message 4 from client!
server_1  | Received from client: Message 5 from client!
server_1  | Connection ended by client.
</code></pre><h4 id="4-检查-envoy-日志">4. 检查 Envoy 日志</h4>
<p>在 Envoy 的日志中，你可以看到它使用 <strong>HTTP/2 CONNECT 隧道</strong>与服务器建立连接的记录。</p>
<h3 id="测试通信">测试通信</h3>
<ul>
<li><strong>客户端</strong>通过 TCP 连接向 <strong>Envoy 代理</strong>发送文本消息。</li>
<li><strong>Envoy</strong>将客户端的 TCP 流量通过 <strong>HTTP/2 CONNECT 隧道</strong>转发给 <strong>服务器</strong>。</li>
<li><strong>服务器</strong>接收到来自客户端的消息，处理并回复。</li>
<li><strong>Envoy</strong>将服务器的回复通过隧道传回给 <strong>客户端</strong>。</li>
<li><strong>客户端</strong>收到服务器的回复。</li>
</ul>
<h3 id="注意事项">注意事项</h3>
<ul>
<li><strong>证书管理：</strong> 确保证书正确配置，并在 Envoy 和服务器中正确使用。</li>
<li><strong>Docker 网络：</strong> 使用 Docker Compose 定义的网络，容器可以通过服务名称互相通信。</li>
<li><strong>端口冲突：</strong> 确保端口 <code>10000</code>（Envoy）和 <code>8080</code>（服务器）未被占用。</li>
<li><strong>TLS 配置：</strong> 在示例中，Envoy 与服务器之间的通信使用 TLS 和 HTTP/2，确保了安全性。</li>
</ul>
<h2 id="隧道建立过程">隧道建立过程</h2>
<p>下图展示了客户端、Envoy 代理和服务器之间的交互，反映了数据的传递和隧道连接的建立的流程。</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/blog/http2-envoy-tunnel-demo/f426fb19b797e505aed4758bdc372f45.svg" data-img="/blog/http2-envoy-tunnel-demo/f426fb19b797e505aed4758bdc372f45.svg" alt="image" data-caption="隧道建立流程">
        
      
    
  
  
  <figcaption>隧道建立流程</figcaption>
  
</figure>
<p>说明：</p>
<ol>
<li>
<p><strong>客户端与 Envoy 建立 TCP 连接</strong>：</p>
<ul>
<li>客户端向 Envoy 发起 TCP 连接请求。</li>
<li>Envoy 接受连接，建立新的 TCP 代理会话（ConnectionId: 0）。</li>
</ul>
</li>
<li>
<p><strong>Envoy 创建到服务器的连接</strong>：</p>
<ul>
<li>Envoy 尝试连接上游集群 <code>tunnel_cluster</code>，创建新的连接（ConnectionId: 1）。</li>
</ul>
</li>
<li>
<p><strong>建立 HTTP/2 CONNECT 隧道</strong>：</p>
<ul>
<li>Envoy 与服务器建立 HTTP/2 连接。</li>
<li>Envoy 发送 HTTP/2 CONNECT 请求，目标主机名为 <code>server:8080</code>。</li>
<li>服务器响应 <code>200 OK</code>，隧道建立成功。</li>
</ul>
</li>
<li>
<p><strong>数据传输</strong>：</p>
<ul>
<li><strong>消息传递循环</strong>：
<ul>
<li>客户端发送数据（<code>Message N</code>）到 Envoy。</li>
<li>Envoy 将数据通过隧道转发给服务器。</li>
<li>服务器处理数据并返回响应（<code>Echo Message N</code>）给 Envoy。</li>
<li>Envoy 将响应转发给客户端。</li>
</ul>
</li>
<li><strong>日志记录</strong>：
<ul>
<li>服务器记录收到的消息，例如 <code>Received from client: Message N from client!</code>。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>连接关闭</strong>：</p>
<ul>
<li>客户端发送 FIN 请求，通知关闭连接。</li>
<li>Envoy 将 FIN 转发给服务器，关闭隧道。</li>
<li>服务器响应 ACK 确认关闭。</li>
<li>Envoy 向客户端发送 ACK，完成连接关闭。</li>
</ul>
</li>
<li>
<p><strong>日志记录</strong>：</p>
<ul>
<li>Envoy 记录连接关闭日志，包括 ConnectionId 和统计信息。</li>
<li>服务器记录日志，显示流已由客户端结束，例如 <code>Stream ended by client.</code>。</li>
</ul>
</li>
</ol>
<h2 id="结语">结语</h2>
<p>虽然这是一个入门示例，但它为理解和进一步探索 HTTP/2 CONNECT 隧道功能提供了坚实的基础。在下一篇博客中讲解通过两个 Envoy 代理实现的隧道，带你进一步了解 Istio ambient 模式中的 HBONE 透明隧道。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/upgrades" title="HTTP upgrades — envoy 1.33.0-dev-6d8d0b documentation" target="_blank" rel="noopener">HTTP upgrades — envoy 1.33.0-dev-6d8d0b documentation</a></li>
<li><a href="https://github.com/envoyproxy/envoy/blob/6d8d0b0ee2cc267b2cd9f57eb952863ddc8e49c3/configs/proxy_connect.yaml" title="envoy/configs/proxy_connect.yaml at 6d8d0b0ee2cc267b2cd9f57eb952863ddc8e49c3 · envoyproxy/envoy · GitHub" target="_blank" rel="noopener">envoy/configs/proxy_connect.yaml at 6d8d0b0ee2cc267b2cd9f57eb952863ddc8e49c3 · envoyproxy/envoy · GitHub</a></li>
<li><a href="https://www.zhaohuabing.com/post/2022-09-11-ambient-deep-dive-1/" title="Istio Ambient 模式流量管理实现机制详解（一）- 赵化冰的博客 | Zhaohuabing Blog" target="_blank" rel="noopener">Istio Ambient 模式流量管理实现机制详解（一）- 赵化冰的博客 | Zhaohuabing Blog</a></li>
</ul>

            <div class="border-bottom mb-2"></div>
          </div>
          <div class="col-12">
            <p>最后更新于 2025/01/31</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/tags/ambient" class="badge">  
                  Ambient</a> 
              <a href="/tags/hbone" class="badge">  
                  HBONE</a> 
              <a href="/tags/http2" class="badge">  
                  HTTP2</a> 
              <a href="/tags/http-connect" class="badge">  
                  HTTP Connect</a> 
              <a href="/tags/%e9%9a%a7%e9%81%93" class="badge">  
                  隧道</a> 
              <a href="/tags/envoy" class="badge">  
                  Envoy</a> </div>
          </div>
          
          <div class="col-12">
            









    

    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    


<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/blog/cloud-native-observability-devops/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; 上一篇</span>
            <span class="text-align-left">探索云原生可观测性：技术与团队协作的深度结合</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/blog/napkin-ai-visualization-tool/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">下一篇 &rarr;</span>
            <span class="text-align-right">AI 工具推荐 Napkin.ai：让复杂想法一键变成直观图表</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="zh-CN"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  相关文章
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/blog/ambient-mesh-l4-traffic-path/">
            Istio Ambient 模式中的透明流量劫持四层网络路由路径详解
          </a>
      </li>
    
      <li>
          <a href="/blog/ambient-mesh-l7-traffic-path/">
            Istio Ambient 模式中的七层流量路由路径详解
          </a>
      </li>
    
      <li>
          <a href="/blog/istio-ambient-l7-flow-analysis/">
            深入 Istio Ambient 模式：从 ztunnel 到 Waypoint 代理的 L7 流量路径解析
          </a>
      </li>
    
      <li>
          <a href="/blog/istio-sidecar-vs-ambient-network-cost-performance/">
            Istio sidecar 和 ambient 模式的网络成本对比
          </a>
      </li>
    
      <li>
          <a href="/blog/istio-ambient-traffic-interception/">
            Istio Ambient 模式中的透明流量拦截过程详解
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      目录
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是-http2-connect-方法以及-hbone-隧道">什么是 HTTP2 Connect 方法以及 HBONE 隧道？</a></li>
    <li><a href="#使用-http2-connect-建立隧道的基本原理">使用 HTTP2 Connect 建立隧道的基本原理</a></li>
    <li><a href="#demo使用-envoy-与上游-server-建立-http2-connect-隧道">Demo：使用 Envoy 与上游 Server 建立 HTTP/2 Connect 隧道</a>
      <ul>
        <li><a href="#核心功能展示">核心功能展示</a></li>
        <li><a href="#环境准备">环境准备</a></li>
        <li><a href="#生成自签名证书">生成自签名证书</a></li>
        <li><a href="#配置-envoy-代理">配置 Envoy 代理</a></li>
        <li><a href="#实现服务器">实现服务器</a></li>
        <li><a href="#实现客户端">实现客户端</a></li>
        <li><a href="#创建-docker-compose-文件">创建 Docker Compose 文件</a></li>
        <li><a href="#运行示例">运行示例</a></li>
        <li><a href="#测试通信">测试通信</a></li>
        <li><a href="#注意事项">注意事项</a></li>
      </ul>
    </li>
    <li><a href="#隧道建立过程">隧道建立过程</a></li>
    <li><a href="#结语">结语</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/free-ai-drawing-tool-raphael/">免费的 AI 绘图工具推荐：Raphael.app</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/cloud-native-observability-devops/">探索云原生可观测性：技术与团队协作的深度结合</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/http2-envoy-tunnel-demo/">使用 Envoy 实现 HTTP/2 CONNECT 隧道：原理与实践</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  简明 Envoy 教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/kcd-beijing-2025/">KCD Beijing 2025 - 提交议题开启！</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-community-domain-migration/">云原生社区网站域名变更通知</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2025 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
