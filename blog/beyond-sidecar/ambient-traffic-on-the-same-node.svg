<svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" width="1725" height="559" version="1.1" viewBox="40 -88 1725 559"><defs><marker id="FilledArrow_Marker" stroke-linejoin="miter" stroke-miterlimit="10" color="#000" markerHeight="8" markerUnits="strokeWidth" markerWidth="10" orient="auto" overflow="visible" viewBox="-1 -4 10 8"><g><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M 8 0 L 0 -3 L 0 3 Z"/></g></marker><marker id="FilledArrow_Marker_2" stroke-linejoin="miter" stroke-miterlimit="10" color="#00fa00" markerHeight="6" markerUnits="strokeWidth" markerWidth="7" orient="auto" overflow="visible" viewBox="-1 -3 7 6"><g><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M 4.8 0 L 0 -1.8 L 0 1.8 Z"/></g></marker></defs><g id="ambient-traffic-on-the-same-node" fill="none" fill-opacity="1" stroke="none" stroke-dasharray="none" stroke-opacity="1"><title>ambient-traffic-on-the-same-node</title><rect width="1725" height="559" x="40" y="-88" fill="#fff"/><g id="ambient-traffic-on-the-same-node_Layer_1"><title>Layer 1</title><g id="Graphic_27"><path stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 965 -12 L 1711.5285 -12 C 1713.7376 -12 1715.5285 -10.209139 1715.5285 -8 L 1715.5285 376.5 C 1715.5285 378.70914 1713.7376 380.5 1711.5285 380.5 L 965 380.5 C 962.7909 380.5 961 378.70914 961 376.5 L 961 -8 C 961 -10.209139 962.7909 -12 965 -12 Z"/><text fill="#000" transform="translate(966 -7)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Node A</tspan></text></g><g id="Graphic_46"><path stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 79 -12 L 825.5285 -12 C 827.7376 -12 829.5285 -10.209139 829.5285 -8 L 829.5285 376.5 C 829.5285 378.70914 827.7376 380.5 825.5285 380.5 L 79 380.5 C 76.79086 380.5 75 378.70914 75 376.5 L 75 -8 C 75 -10.209139 76.79086 -12 79 -12 Z"/><text fill="#000" transform="translate(80 -7)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Node A</tspan></text></g><g id="Graphic_45"><rect width="660.495" height="34.275" x="131.966" y="321.256" fill="#dadada"/><text fill="#000" transform="translate(136.9661 329.16983)"><tspan x="268.208" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Kubernetes CNI</tspan></text></g><g id="Graphic_44"><rect width="660.495" height="34.275" x="131.966" y="275.12" fill="#dadada"/><text fill="#000" transform="translate(136.9661 283.03324)"><tspan x="294.44" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Istio CNI</tspan></text></g><g id="Graphic_43"><rect width="315.175" height="38.672" x="131.966" y="218.208" fill="#666"/><text fill="#fff" transform="translate(136.9661 228.32005)"><tspan x="130.659" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod A</tspan></text></g><g id="Graphic_42"><path fill="#456bb0" d="M 404.21383 37 L 520.21383 37 C 522.423 37 524.21383 38.79086 524.21383 41 L 524.21383 85 C 524.21383 87.20914 522.423 89 520.21383 89 L 404.21383 89 C 402.0047 89 400.21383 87.20914 400.21383 85 L 400.21383 41 C 400.21383 38.79086 402.0047 37 404.21383 37 Z"/><text fill="#fff" transform="translate(405.21383 53.267944)"><tspan x="22.624" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">ztunnel A</tspan></text></g><g id="Graphic_33"><rect width="315.175" height="38.672" x="477.287" y="218.208" fill="#666"/><text fill="#fff" transform="translate(482.28674 228.32005)"><tspan x="130.363" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod B</tspan></text></g><g id="Group_30"><g id="Graphic_32"><path fill="#ff8080" d="M 729.9187 218.20806 L 729.9187 195.34652 L 761.1901 183.9329 L 792.4616 195.34652 L 792.4616 218.20806 Z"/></g><g id="Graphic_31"><text fill="#fff" transform="translate(743.3981 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">9080</tspan></text></g></g><g id="Line_29"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 524.21383 73.88294 C 576.1633 84.1466 649.63005 101.47018 699.5283 125 C 742.4037 145.21816 757.6723 165.20599 762.2969 180.01611"/></g><g id="Graphic_28"><rect width="134.48" height="28.448" x="597.437" y="96.524" fill="#fff"/><text fill="#000" transform="translate(602.43734 101.52365)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">To Pod B IP:9080</tspan></text></g><g id="Graphic_26"><rect width="660.495" height="34.275" x="1017.966" y="321.256" fill="#dadada"/><text fill="#000" transform="translate(1022.9661 329.16983)"><tspan x="268.208" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Kubernetes CNI</tspan></text></g><g id="Graphic_25"><rect width="660.495" height="34.275" x="1017.966" y="275.12" fill="#dadada"/><text fill="#000" transform="translate(1022.9661 283.03324)"><tspan x="294.44" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Istio CNI</tspan></text></g><g id="Graphic_24"><rect width="315.175" height="38.672" x="1017.966" y="218.208" fill="#666"/><text fill="#fff" transform="translate(1022.9661 228.32005)"><tspan x="130.659" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod A</tspan></text></g><g id="Graphic_23"><path fill="#456bb0" d="M 1062.4941 35.676214 L 1178.4941 35.676214 C 1180.7032 35.676214 1182.4941 37.467075 1182.4941 39.676214 L 1182.4941 83.67621 C 1182.4941 85.88535 1180.7032 87.67621 1178.4941 87.67621 L 1062.4941 87.67621 C 1060.285 87.67621 1058.4941 85.88535 1058.4941 83.67621 L 1058.4941 39.676214 C 1058.4941 37.467075 1060.285 35.676214 1062.4941 35.676214 Z"/><text fill="#fff" transform="translate(1063.4941 51.94416)"><tspan x="22.624" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">ztunnel A</tspan></text></g><g id="Line_20"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 1022.8233 194.093 C 1014.3242 187.50805 1009.2061 176.67425 1017.9661 158.97436 C 1028.1648 138.36757 1054.7232 113.40705 1078.2532 93.92689"/></g><g id="Group_17"><g id="Graphic_19"><path fill="#ff8080" d="M 1270.5981 218.20806 L 1270.5981 195.34652 L 1301.8695 183.9329 L 1333.141 195.34652 L 1333.141 218.20806 Z"/></g><g id="Graphic_18"><text fill="#fff" transform="translate(1284.0775 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">9080</tspan></text></g></g><g id="Graphic_15"><rect width="146.624" height="28.448" x="967.172" y="114.565" fill="#fff"/><text fill="#000" transform="translate(972.1717 119.56461)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">cross-netns socket</tspan></text></g><g id="Graphic_14"><rect width="315.175" height="38.672" x="1363.287" y="218.208" fill="#666"/><text fill="#fff" transform="translate(1368.2867 228.32005)"><tspan x="130.363" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod B</tspan></text></g><g id="Group_11"><g id="Graphic_13"><path fill="#ff8080" d="M 1615.9187 218.20806 L 1615.9187 195.34652 L 1647.1901 183.9329 L 1678.4616 195.34652 L 1678.4616 218.20806 Z"/></g><g id="Graphic_12"><text fill="#fff" transform="translate(1629.3981 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">9080</tspan></text></g></g><g id="Group_74"><g id="Graphic_8"><path fill="#456bb0" d="M 1558.4616 35.676214 L 1674.4616 35.676214 C 1676.6707 35.676214 1678.4616 37.467075 1678.4616 39.676214 L 1678.4616 83.67621 C 1678.4616 85.88535 1676.6707 87.67621 1674.4616 87.67621 L 1558.4616 87.67621 C 1556.2524 87.67621 1554.4616 85.88535 1554.4616 83.67621 L 1554.4616 39.676214 C 1554.4616 37.467075 1556.2524 35.676214 1558.4616 35.676214 Z"/><text fill="#fff" transform="translate(1559.4616 39.676214)"><tspan x="21.928" y="17" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Way</tspan> <tspan y="17" fill="#fff" font-family="PingFang SC" font-size="16" xml:space="preserve">point </tspan> <tspan x="35.64" y="39" fill="#fff" font-family="PingFang SC" font-size="16" xml:space="preserve">Proxy</tspan></text></g><g id="Graphic_7"><path fill="#ff8080" d="M 1554.4616 86.36921 L 1531.6 86.36921 L 1520.1864 61.676214 L 1531.6 36.983214 L 1554.4616 36.983214 Z"/><text fill="#fff" transform="translate(1534.8177 81.369215) rotate(-90)"><tspan x=".233" y="13" fill="#fff" font-family="Helvetica Neue" font-size="14" xml:space="preserve">15008</tspan></text></g></g><g id="Line_6"><path stroke="#00fa00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" marker-end="url(#FilledArrow_Marker_2)" d="M 1182.4941 54.26958 C 1232.572 48.97535 1305.5913 42.783505 1373.1959 42.783505 C 1440.513 42.783505 1484.4163 48.9228 1509.7249 54.20199"/></g><g id="Graphic_5"><rect width="67.792" height="29.464" x="1295.506" y="28.83" fill="#fff"/><text fill="#000" transform="translate(1300.5059 33.830144)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold" xml:space="preserve">HBONE</tspan></text></g><g id="Line_4"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 1182.4941 68.770196 C 1231.5293 75.53407 1305.4447 88.06123 1388.764 110.11236 C 1491.0471 137.18238 1574.5329 169.87954 1616.9315 187.76993"/></g><g id="Graphic_47"><text fill="#000" transform="translate(80.00001 -58.5)"><tspan x="0" y="23" fill="#000" font-family="Helvetica Neue" font-size="24" font-weight="bold" xml:space="preserve">Encrypted L4 Traffic on the Same Node</tspan></text></g><g id="Graphic_48"><text fill="#000" transform="translate(966 -58.5)"><tspan x="0" y="23" fill="#000" font-family="Helvetica Neue" font-size="24" font-weight="bold" xml:space="preserve">Encrypted L7 Traffic on the Same Node</tspan></text></g><g id="Graphic_49"><text fill="#000" transform="translate(80 396)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Iptables redirect the packets to the ports that ztunnel listening.</tspan></text></g><g id="Group_51"><g id="Graphic_53"><path fill="#ff8080" d="M 131.9661 218.10963 L 131.9661 195.2481 L 163.23752 183.83447 L 194.50894 195.2481 L 194.50894 218.10963 Z"/></g><g id="Graphic_52"><text fill="#fff" transform="translate(140.99752 194.66164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Graphic_54"><text fill="#000" transform="translate(80 424.448)"><tspan x="0" y="17" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Istio CNI will create a cross-netns socket for each Pod that listen on port 15001 </tspan> <tspan y="17" fill="#000" font-family="PingFang SC" font-size="16" xml:space="preserve">(outbound socket), 15006 (plaintext socket) and 15008 (HBONE socket).</tspan></text></g><g id="Line_55"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 168.21104 185.64974 C 176.87079 165.37517 199.72294 129.08385 257.64706 102.35294 C 299.5419 83.01925 350.0394 73.18356 390.38014 68.18004"/></g><g id="Graphic_56"><rect width="111.952" height="28.448" x="406.238" y="89.578" fill="#fff"/><text fill="#000" transform="translate(411.23784 94.57822)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Encap&amp;Decap</tspan></text></g><g id="Graphic_59"><rect width="146.624" height="28.448" x="179.461" y="90.44" fill="#fff"/><text fill="#000" transform="translate(184.46143 95.44011)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">cross-netns socket</tspan></text></g><g id="Group_60"><g id="Graphic_62"><path fill="#ff8080" d="M 1018.7919 218.20806 L 1018.7919 195.34652 L 1050.0633 183.9329 L 1081.3347 195.34652 L 1081.3347 218.20806 Z"/></g><g id="Graphic_61"><text fill="#fff" transform="translate(1027.8233 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Line_72"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 1301 184 C 1301 184 1260.7823 148.71643 1189.6907 153.55258 C 1146.396 156.49779 1104.0493 173.47913 1077.553 186.30832"/></g><g id="Graphic_73"><rect width="66.304" height="28.448" x="1118.182" y="145.29" fill="#fff"/><text fill="#000" transform="translate(1123.1825 150.28954)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">iptables</tspan></text></g><g id="Graphic_9"><rect width="134.48" height="28.448" x="1437.869" y="131.142" fill="#fff"/><text fill="#000" transform="translate(1442.869 136.14231)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">To Pod B IP:9080</tspan></text></g><g id="Graphic_75"><path fill="#ff8080" d="M 1182.4941 86.66464 L 1182.4941 109.52617 L 1157.8011 120.9398 L 1133.1081 109.52617 L 1133.1081 86.66464 Z"/><text fill="#fff" transform="translate(1177.4941 106.30854) rotate(180)"><tspan x=".233" y="13" fill="#fff" font-family="Helvetica Neue" font-size="14" xml:space="preserve">15008</tspan></text></g><g id="Line_76"><path stroke="#00fa00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" marker-end="url(#FilledArrow_Marker_2)" d="M 1572.2215 87.67621 C 1544.716 99.40067 1502.8349 111.84736 1442.383 117.39961 C 1351.7484 125.724 1249.0967 115.82042 1195.2871 109.06718"/></g><g id="Graphic_77"><rect width="67.792" height="29.464" x="1284.801" y="104.798" fill="#fff"/><text fill="#000" transform="translate(1289.8012 109.79793)"><tspan x="0" y="16" fill="#000" font-family="Helvetica Neue" font-size="16" font-weight="bold" xml:space="preserve">HBONE</tspan></text></g><g id="Group_78"><g id="Graphic_80"><path fill="#ff8080" d="M 211.93778 218.20806 L 211.93778 195.34652 L 243.2092 183.9329 L 274.4806 195.34652 L 274.4806 218.20806 Z"/></g><g id="Graphic_79"><text fill="#fff" transform="translate(220.9692 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_81"><g id="Graphic_83"><path fill="#ff8080" d="M 1096.1526 218.20806 L 1096.1526 195.34652 L 1127.424 183.9329 L 1158.6954 195.34652 L 1158.6954 218.20806 Z"/></g><g id="Graphic_82"><text fill="#fff" transform="translate(1105.184 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_84"><g id="Graphic_86"><path fill="#ff8080" d="M 291.90945 218.10963 L 291.90945 195.2481 L 323.18087 183.83447 L 354.4523 195.2481 L 354.4523 218.10963 Z"/></g><g id="Graphic_85"><text fill="#fff" transform="translate(300.94086 194.66164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g><g id="Group_87"><g id="Graphic_89"><path fill="#ff8080" d="M 1173.5133 218.20806 L 1173.5133 195.34652 L 1204.7847 183.9329 L 1236.0561 195.34652 L 1236.0561 218.20806 Z"/></g><g id="Graphic_88"><text fill="#fff" transform="translate(1182.5447 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g><g id="Group_96"><g id="Graphic_98"><path fill="#ff8080" d="M 132.3361 218.47963 L 132.3361 195.6181 L 163.60752 184.20447 L 194.87894 195.6181 L 194.87894 218.47963 Z"/></g><g id="Graphic_97"><text fill="#fff" transform="translate(141.36752 195.03164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Group_93"><g id="Graphic_95"><path fill="#ff8080" d="M 212.30778 218.57806 L 212.30778 195.71652 L 243.5792 184.3029 L 274.8506 195.71652 L 274.8506 218.57806 Z"/></g><g id="Graphic_94"><text fill="#fff" transform="translate(221.3392 195.13006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_90"><g id="Graphic_92"><path fill="#ff8080" d="M 292.27945 218.47963 L 292.27945 195.6181 L 323.55087 184.20447 L 354.8223 195.6181 L 354.8223 218.47963 Z"/></g><g id="Graphic_91"><text fill="#fff" transform="translate(301.31086 195.03164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g><g id="Group_109"><g id="Graphic_111"><path fill="#ff8080" d="M 477.28674 218.43042 L 477.28674 195.5689 L 508.55816 184.15526 L 539.8296 195.5689 L 539.8296 218.43042 Z"/></g><g id="Graphic_110"><text fill="#fff" transform="translate(486.31816 194.98242)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Group_106"><g id="Graphic_108"><path fill="#ff8080" d="M 557.2584 218.52884 L 557.2584 195.66731 L 588.5298 184.25368 L 619.80124 195.66731 L 619.80124 218.52884 Z"/></g><g id="Graphic_107"><text fill="#fff" transform="translate(566.2898 195.08085)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_103"><g id="Graphic_105"><path fill="#ff8080" d="M 637.2301 218.43042 L 637.2301 195.5689 L 668.5015 184.15526 L 699.7729 195.5689 L 699.7729 218.43042 Z"/></g><g id="Graphic_104"><text fill="#fff" transform="translate(646.2615 194.98242)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g><g id="Group_118"><g id="Graphic_120"><path fill="#ff8080" d="M 1363.2867 218.43042 L 1363.2867 195.5689 L 1394.5582 184.15526 L 1425.8296 195.5689 L 1425.8296 218.43042 Z"/></g><g id="Graphic_119"><text fill="#fff" transform="translate(1372.3182 194.98242)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Group_115"><g id="Graphic_117"><path fill="#ff8080" d="M 1440.6474 218.43042 L 1440.6474 195.5689 L 1471.9189 184.15526 L 1503.1903 195.5689 L 1503.1903 218.43042 Z"/></g><g id="Graphic_116"><text fill="#fff" transform="translate(1449.6789 194.98242)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_112"><g id="Graphic_114"><path fill="#ff8080" d="M 1518.0081 218.43042 L 1518.0081 195.5689 L 1549.2796 184.15526 L 1580.551 195.5689 L 1580.551 218.43042 Z"/></g><g id="Graphic_113"><text fill="#fff" transform="translate(1527.0396 194.98242)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g></g></g></svg>