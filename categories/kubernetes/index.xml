<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song - Cloud Native | Open Source | Community â€“ Kubernetes</title>
    <link>https://jimmysong.io/categories/kubernetes/</link>
    <description>Recent content in Kubernetes on Jimmy Song - Cloud Native | Open Source | Community</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <copyright>Copyright &amp;copy; 2020 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©ï¼›åŸºäº Hugo [educenter](https://github.com/themefisher/educenter-hugo)  ä¸»é¢˜æ„å»º</copyright>
    <lastBuildDate>Tue, 23 Oct 2018 21:21:07 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/categories/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Kubernetesé¡¹ç›®è”åˆåˆ›å§‹äººBrendan Burnsæ–°ä¹¦Managing Kubernetesä»‹ç»åŠè¯„è®º</title>
      <link>https://jimmysong.io/blog/the-book-managing-kubernetes-by-brendan-burns/</link>
      <pubDate>Tue, 23 Oct 2018 21:21:07 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/the-book-managing-kubernetes-by-brendan-burns/</guid>
      <description>
        
        
        

&lt;p&gt;&lt;em&gt;&lt;code&gt;Managing Kubernetes - Operating Kubernetes Cluster in the Real World&lt;/code&gt;&lt;/em&gt; ã€Šç®¡ç† Kubernetes â€”â€”è¿ç»´çœŸå®çš„ Kubernetes é›†ç¾¤ã€‹è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Brendan Burns&lt;/strong&gt;ï¼šKubernetes é¡¹ç›®çš„ä¸‰ä½è”åˆåˆ›å§‹äººä¹‹ä¸€ï¼Œç°å°±èŒäºå¾®è½¯ Azureã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Craig Tracey&lt;/strong&gt;ï¼šHeptio å…¬å¸çš„å·¥ç¨‹å¸ˆï¼Œä¹Ÿæ˜¯æœ¬ä¹¦å‘è¡Œçš„èµåŠ©å…¬å¸ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬ä¹¦ç”± &lt;code&gt;Oâ€™Reilly&lt;/code&gt; å‡ºç‰ˆï¼Œå¯ä»¥ä»ç½‘ä¸Šå…è´¹è·å¾—ï¼ˆä¾‹å¦‚ &lt;code&gt;Heptio&lt;/code&gt; å’Œ &lt;code&gt;Oâ€™Reilly&lt;/code&gt; çš„å®˜ç½‘ä¸Šï¼‰ï¼Œå¹¶åœ¨&lt;a href=&#34;https://www.amazon.com/Managing-Kubernetes-Operating-Clusters-World/dp/149203391X/ref=sr_1_1?ie=UTF8&amp;amp;qid=1540304199&amp;amp;sr=8-1&amp;amp;keywords=managing+kubernetes&#34;&gt;äºšé©¬é€Š&lt;/a&gt;ä¸Šé¢„å”®ï¼ˆ2018å¹´12æœˆ3æ—¥æ­£å¼å‘å”®ï¼‰ï¼Œè¯¥ä¹¦å·²ç»ç”±å›½å†…æŸå‡ºç‰ˆç¤¾å¼•è¿›ï¼Œå°†å‘è¡Œç®€ä½“ä¸­æ–‡ç‰ˆã€‚&lt;/p&gt;

&lt;p&gt;è‹±æ–‡ç”µå­ç‰ˆ PDF ä¸‹è½½ï¼Œè¯·ç¿»é¡µé¢åº•éƒ¨å…³æ³¨&lt;code&gt;äº‘åŸç”Ÿåº”ç”¨æ¶æ„&lt;/code&gt;å…¬ä¼—å·å¹¶åœ¨åå°å›å¤&lt;code&gt;ç®¡ç†Kubernetes&lt;/code&gt;å³å¯è·å¾—ä¸‹è½½åœ°å€ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes é¡¹ç›®çš„å¦å¤–ä¸¤ä½è”åˆåˆ›å§‹äººç›®å‰éƒ½å°±èŒåœ¨ &lt;a href=&#34;https://heptio.com&#34;&gt;Heptio&lt;/a&gt;ï¼Œè¯¥å…¬å¸äº 2018 å¹´ 11 æœˆ 6 æ—¥è¢« VMWare æ”¶è´­ï¼Œè¯¦è§&lt;a href=&#34;https://mp.weixin.qq.com/s/8_DDCOAk1spYHPB7LsLe5Q&#34;&gt;Kubernetesä¸¤ä½è”åˆåˆ›å§‹äººåˆ›åŠçš„Heptioå…¬å¸è¢«VMWareæ”¶è´­&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ä¸ªäººè¯„è®º&#34;&gt;ä¸ªäººè¯„è®º&lt;/h3&gt;

&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘ä¸ªäººçœ‹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ æƒ³é€šè¿‡æœ¬ä¹¦çœ‹åˆ°å¾ˆå¤šç”Ÿäº§ä¸Šè¶Ÿå‘å¾—å®è·µï¼Œé‚£ä¹ˆä½ ä¼šæ„Ÿåˆ°å¾ˆå¤±æœ›ã€‚åœ¨çœ‹è¿™æœ¬ä¹¦çš„ç›®å½•çš„æ—¶å€™æˆ‘åˆ°æ˜¯çœ‹çš„çƒ­è¡€æ²¸è…¾ï¼Œä½†æ˜¯æœ¬ä¹¦åªæœ‰å¯¥å¯¥ 187 é¡µå´åŒ…å«äº†å¦‚æ­¤å¤šçš„å†…å®¹ï¼Œè¿™å°±æ³¨å®šå®ƒä¸æ˜¯ä¸€æœ¬å‚è€ƒä¹¦ï¼Œä½ ä¹Ÿä¸èƒ½æŒ‡æœ›é€šè¿‡å®ƒå­¦åˆ°å¤šå°‘è¿ç»´ç”Ÿäº§ç¯å¢ƒ Kubernetes é›†ç¾¤çš„çŸ¥è¯†ã€‚æ¯ä¸€ç« ä¸­çš„æ¯ä¸€èŠ‚éƒ½æ˜¯ä¸€ä¸¤æ®µæ€»ç»“æ€§çš„è¯è¯­ï¼Œå¦‚æœä½ çœ‹è¿‡ &lt;a href=&#34;https://kubernetes.io&#34;&gt;Kubernetes çš„å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ä¼šè§‰å¾—è¿™æœ¬ä¹¦å†™çš„å¤ªç®€ç•¥äº†ï¼Œäº‹å®ç¡®å®å¦‚æ­¤ã€‚å› æ­¤å¯ä»¥å°†æ­¤ä¹¦ä½œä¸ºä¸€ä¸ªå¤§çº²ï¼Œå†ç»“åˆå®˜æ–¹æ–‡æ¡£å’Œå®è·µå­¦ä¹ æ•ˆæœæ›´ä½³ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–å¯¹æœ¬ä¹¦æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥&lt;a href=&#34;https://jimmysong.io/about&#34;&gt;è”ç³»æˆ‘&lt;/a&gt;åŠ å…¥è¯»è€…äº¤æµç¾¤ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„CI/CD</title>
      <link>https://jimmysong.io/blog/ci-cd-in-kubernetes/</link>
      <pubDate>Thu, 14 Jun 2018 20:33:24 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/ci-cd-in-kubernetes/</guid>
      <description>
        
        
        

&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥Kuberneteså¹¶ä¸æä¾›ä»£ç æ„å»ºã€å‘å¸ƒå’Œéƒ¨ç½²ï¼Œæ‰€æœ‰çš„è¿™äº›å·¥ä½œéƒ½æ˜¯ç”±CI/CDå·¥ä½œæµå®Œæˆçš„ï¼Œæœ€è¿‘TheNewStackåˆå‡ºäº†æœ¬å°å†Œå­ï¼ˆ117é¡µï¼‰ä»‹ç»äº†Kubernetesä¸­CI/CDçš„ç°çŠ¶ã€‚ä¸‹è½½æœ¬ä¹¦çš„PDFè¯·è®¿é—®ï¼š&lt;a href=&#34;https://thenewstack.io/ebooks/kubernetes/ci-cd-with-kubernetes/&#34;&gt;https://thenewstack.io/ebooks/kubernetes/ci-cd-with-kubernetes/&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬ä¹¦çš„ä½œè€…æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Rob Scottï¼šReactiveOpså…¬å¸çš„SRE&lt;/li&gt;
&lt;li&gt;Janakiram MSVï¼šJanakiram &amp;amp; Associates çš„é¦–å¸­åˆ†æå¸ˆ&lt;/li&gt;
&lt;li&gt;Craig Martinï¼šKenzançš„é«˜çº§å‰¯æ€»è£&lt;/li&gt;
&lt;li&gt;Container Solutions&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™æœ¬å°å†Œå­é‡Œä¸»è¦ä¸»è¦ä»‹ç»äº†ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;DevOpsæ¨¡å¼&lt;/li&gt;
&lt;li&gt;äº‘åŸç”Ÿåº”ç”¨æ¨¡å¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨SpinnakeråšæŒç»­äº¤ä»˜&lt;/li&gt;
&lt;li&gt;äº‘åŸç”Ÿæ—¶ä»£çš„ç›‘æ§&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;devopsæ¨¡å¼&#34;&gt;DevOpsæ¨¡å¼&lt;/h3&gt;

&lt;p&gt;è¿™ä¸€ç« ä»ä¸€äº›æµè¡Œçš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·è®²èµ·ï¼Œæ¯”å¦‚Chefã€Puppetç­‰ï¼Œå¼•ç”³å‡ºCI/CDæµæ°´çº¿ï¼Œè¿›è€Œå¼•å‡ºDockerå’ŒDevOpsï¼Œå°†å®¹å™¨å¦‚ä½•è§£é™¤å¼€å‘å’Œè¿ç»´ä¹‹é—´çš„éš”é˜‚ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›æŒ‘æˆ˜ï¼Œæ¯”å¦‚é¢‘ç¹çš„å‘å¸ƒå˜æ›´å¦‚ä½•æ§åˆ¶ï¼Œå¦‚ä½•æ§åˆ¶å®¹å™¨é›†ç¾¤çš„è¡Œä¸ºï¼Œå¦‚ä½•æ‹†åˆ†åº”ç”¨åˆ°å®¹å™¨ä¹‹ä¸­ç­‰ã€‚è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå®¹å™¨ç¼–æ’è°ƒåº¦çš„å·¥å…·å‘¼ä¹‹æ¬²å‡ºï¼ŒKubernetesçš„å‡ºç°å½»åº•æ”¹å˜äº†å±€é¢ï¼Œå¯ä»¥è¯´å®ƒç›´æ¥æ”¹å˜äº†åº”ç”¨çš„åŸºç¡€æ¶æ„ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesç»†åŒ–çš„åº”ç”¨ç¨‹åºçš„åˆ†è§£ç²’åº¦ï¼ŒåŒæ—¶å°†æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡å’Œå¥åº·æ£€æŸ¥ç­‰ä½œä¸ºåŸºç¡€è®¾æ–½çš„åŠŸèƒ½ï¼Œç®€åŒ–äº†åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚&lt;/p&gt;

&lt;p&gt;è€ŒKubernetesè¿™ç§å£°æ˜å¼é…ç½®å°¤å…¶é€‚åˆCI/CDæµç¨‹ï¼Œå†µä¸”ç°åœ¨è¿˜æœ‰å¦‚Helmã€Draftã€Spinnakerã€Skaffoldç­‰å¼€æºå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘å¸ƒKuberentesåº”ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰äº†åŸºäºKubernetesçš„CI/CDæµç¨‹åï¼Œåˆè¯ç”Ÿäº†GitOpsï¼ˆ&lt;a href=&#34;http://weave.works&#34;&gt;http://weave.works&lt;/a&gt;çš„åšå®¢ä¸­æœ‰å¾ˆå¤šç›¸å…³æ–‡ç« ï¼‰å’ŒSecOpsï¼ˆSecurity Operationï¼‰ã€‚&lt;/p&gt;

&lt;h3 id=&#34;äº‘åŸç”Ÿåº”ç”¨æ¨¡å¼&#34;&gt;äº‘åŸç”Ÿåº”ç”¨æ¨¡å¼&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;äº‘åŸç”Ÿæ˜¯é€šè¿‡æ„å»ºå›¢é˜Ÿã€æ–‡åŒ–å’ŒæŠ€æœ¯ï¼Œåˆ©ç”¨è‡ªåŠ¨åŒ–å’Œæ¶æ„æ¥ç®¡ç†ç³»ç»Ÿçš„å¤æ‚æ€§å’Œè§£æ”¾ç”Ÿäº§åŠ›ã€‚â€”â€”Joe Bedaï¼ŒHeptio CTOï¼Œè”åˆåˆ›å§‹äºº&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™ä¸€ç« çš„é‡ç‚¹æ˜¯ç»™å‡ºäº†äº‘åŸç”Ÿåº”ç”¨çš„10æ¡å…³é”®å±æ€§ã€‚&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨è½»é‡çº§çš„å®¹å™¨æ‰“åŒ…&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æœ€åˆé€‚çš„è¯­è¨€å’Œæ¡†æ¶å¼€å‘&lt;/li&gt;
&lt;li&gt;ä»¥æ¾è€¦åˆçš„å¾®æœåŠ¡æ–¹å¼è®¾è®¡&lt;/li&gt;
&lt;li&gt;ä»¥APIä¸ºä¸­å¿ƒçš„äº¤äº’å’Œåä½œ&lt;/li&gt;
&lt;li&gt;æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€æœåŠ¡åœ¨æ¶æ„ä¸Šç•Œé™æ¸…æ™°&lt;/li&gt;
&lt;li&gt;ä¸ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿå’ŒæœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²åœ¨è‡ªæœåŠ¡ã€å¼¹æ€§çš„äº‘åŸºç¡€è®¾æ–½ä¸Š&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ•æ·çš„DevOpsæµç¨‹ç®¡ç†&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;é€šè¿‡å®šä¹‰å’Œç­–ç•¥é©±åŠ¨çš„èµ„æºåˆ†é…&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä½œè€…ç„¶åå°†åº”ç”¨ç¨‹åºæ¶æ„ä¸­çš„ä¸åŒç»„ä»¶æ˜ å°„åˆ°äº‘åŸç”Ÿçš„å·¥ä½œè´Ÿè½½ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¹Ÿæ˜¯DevOpséœ€è¦å…³æ³¨çš„éƒ¨åˆ†ï¼Œå¦‚ä½•å°†äº‘åŸç”Ÿçš„ç»„ä»¶æ˜ å°„ä¸ºKubernetesçš„åŸè¯­ï¼ˆå³Kubernetesé‡Œçš„å„ç§èµ„æºå¯¹è±¡å’Œæ¦‚å¿µç»„åˆï¼‰å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æ€»ç»“æ¦‚æ‹¬ä¸ºä»¥ä¸‹10æ¡ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ä¸è¦ç›´æ¥éƒ¨ç½²è£¸çš„Podã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºå·¥ä½œè´Ÿè½½é€‰æ‹©åˆé€‚çš„Controllerã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Initå®¹å™¨ç¡®ä¿åº”ç”¨ç¨‹åºè¢«æ­£ç¡®çš„åˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åº”ç”¨ç¨‹åºå·¥ä½œè´Ÿè½½å¯åŠ¨ä¹‹å‰å…ˆå¯åŠ¨serviceã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Deployment historyæ¥å›æ»šåˆ°å†å²ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ConfigMapå’ŒSecretæ¥å­˜å‚¨é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨Podé‡Œå¢åŠ Readinesså’ŒLivenessæ¢é’ˆã€‚&lt;/li&gt;
&lt;li&gt;ç»™Podè¿™åªCPUå’Œå†…å­˜èµ„æºé™é¢ã€‚&lt;/li&gt;
&lt;li&gt;å®šä¹‰å¤šä¸ªnamespaceæ¥é™åˆ¶é»˜è®¤serviceèŒƒå›´çš„å¯è§†æ€§ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®HPAæ¥åŠ¨æ€æ‰©å±•æ— çŠ¶æ€å·¥ä½œè´Ÿè½½ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;ä½¿ç”¨spinnakerè¿›è¡ŒæŒç»­äº¤ä»˜&#34;&gt;ä½¿ç”¨Spinnakerè¿›è¡ŒæŒç»­äº¤ä»˜&lt;/h3&gt;

&lt;p&gt;ä½œè€…é¦–å…ˆè®²åˆ°äº†Spinnakerçš„å„ç§ç‰¹æ€§ï¼Œæ¯”å¦‚é¢å‘å¾®æœåŠ¡å•¦ï¼Œäº‘åŸç”Ÿçš„äº¤ä»˜å·¥å…·å•¦ï¼Œå¯è§†åŒ–çš„äº¤ä»˜å’ŒåŸºç¡€è®¾æ–½å•¦ï¼Œæ”¯æŒå¤šä¸ªregionï¼Œæ”¯æŒå®¹å™¨å’ŒKubernetesç­‰ç­‰ï¼Œä¸ä¸€è€Œè¶³ï¼Œæ„Ÿå…´è¶£å¤§å®¶å¯ä»¥è‡ªå·±çœ‹ä¸‹æŠ¥å‘Šæˆ–è€…ç™»é™†Spinnakerå®˜ç½‘&lt;a href=&#34;https://www.spinnaker.io&#34;&gt;https://www.spinnaker.io&lt;/a&gt;æŸ¥çœ‹ã€‚&lt;/p&gt;

&lt;p&gt;æ€»ä¹‹ä½œè€…å°±æ˜¯æƒ³è¯´Spinnakerå¾ˆå¥½å¾ˆå¼ºå¤§å•¦ï¼Œè¶³ä»¥æ»¡è¶³æ‚¨å¯¹äº‘åŸç”Ÿåº”ç”¨CI/CDçš„éœ€æ±‚ã€‚&lt;/p&gt;

&lt;h3 id=&#34;äº‘åŸç”Ÿæ—¶ä»£çš„ç›‘æ§&#34;&gt;äº‘åŸç”Ÿæ—¶ä»£çš„ç›‘æ§&lt;/h3&gt;

&lt;p&gt;ç›‘æ§æ˜¯ä¸ºäº†å®ç°ç³»ç»Ÿçš„å¯è§‚å¯Ÿæ€§ï¼Œä¸è¦ä»¥ä¸ºç›‘æ§å°±æ˜¯ç®€å•çš„å‡ºä¸ªç›‘æ§é¡µé¢ï¼Œç›‘æ§å…¶å®åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ—¥å¿—æ”¶é›†&lt;/li&gt;
&lt;li&gt;ç›‘æ§å’ŒæŒ‡æ ‡åº¦é‡&lt;/li&gt;
&lt;li&gt;è¿½è¸ª&lt;/li&gt;
&lt;li&gt;å‘Šè­¦å’Œå¯è§†åŒ–&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¦æŠŠå…¶ä¸­ä»»ä½•ä¸€ä¸ªæ–¹é¢åšå¥½éƒ½ä¸å®¹æ˜“ã€‚ä½œè€…ä¸»è¦è®²è¿°çš„Prometheuså’ŒGrafanaçš„å¼€æºç›‘æ§æ–¹æ¡ˆã€‚è¿™ä¸€ç« æˆ‘ä¸è¯¦è¿°ï¼Œæ„Ÿå…´è¶£å¤§å®¶å¯ä»¥æŸ¥çœ‹æŠ¥å‘ŠåŸæ–‡ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>é€‚ç”¨äºkubernetesçš„åº”ç”¨å¼€å‘éƒ¨ç½²æµç¨‹åŒæ—¶é›†æˆIstio service mesh</title>
      <link>https://jimmysong.io/blog/creating-cloud-native-app-with-kubernetes/</link>
      <pubDate>Mon, 26 Mar 2018 22:48:44 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/creating-cloud-native-app-with-kubernetes/</guid>
      <description>
        
        
        

&lt;p&gt;æœ¬æ–‡è®²è§£äº†å¦‚ä½•å¼€å‘å®¹å™¨åŒ–åº”ç”¨ï¼Œå¹¶ä½¿ç”¨WerckeræŒç»­é›†æˆå·¥å…·æ„å»ºdockeré•œåƒä¸Šä¼ åˆ°dockeré•œåƒä»“åº“ä¸­ï¼Œç„¶ååœ¨æœ¬åœ°ä½¿ç”¨&lt;code&gt;docker-compose&lt;/code&gt;æµ‹è¯•åï¼Œå†ä½¿ç”¨&lt;code&gt;kompose&lt;/code&gt;è‡ªåŠ¨ç”Ÿæˆkubernetesçš„yamlæ–‡ä»¶ï¼Œå†å°†æ³¨å…¥Envoy sidecarå®¹å™¨ï¼Œé›†æˆIstio service meshä¸­çš„è¯¦ç»†è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;å½“æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªkubernetesé›†ç¾¤åï¼Œå¦‚ä½•åœ¨ä¸Šé¢å¼€å‘å’Œéƒ¨ç½²åº”ç”¨ï¼Œåº”è¯¥éµå¾ªæ€æ ·çš„æµç¨‹ï¼Ÿæœ¬æ¬¡åˆ†äº«å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨goè¯­è¨€å¼€å‘å’Œéƒ¨ç½²ä¸€ä¸ªkubernetes nativeåº”ç”¨ï¼Œä½¿ç”¨werckerè¿›è¡ŒæŒç»­é›†æˆä¸æŒç»­å‘å¸ƒï¼Œæˆ‘å°†ä»¥ä¸€ä¸ªå¾ˆç®€å•çš„å‰åç«¯è®¿é—®ï¼Œè·å–ä¼ªé€ æ•°æ®å¹¶å±•ç¤ºçš„ä¾‹å­æ¥è¯´æ˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šæœ¬æ–‡éƒ¨åˆ†å†…å®¹æ›¾æ˜¯æˆ‘2017å¹´9æœˆ14æ—¥åœ¨DockOneç¤¾åŒºåˆ†äº«çš„å†…å®¹ï¼Œæœ¬æ–‡åŒæ—¶å½’æ¡£åˆ°&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/how-to-use-kubernetes-with-istio.jpg&#34; alt=&#34;æµç¨‹å›¾&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸»è¦å†…å®¹&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æœåŠ¡APIçš„å®šä¹‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Goè¯­è¨€å¼€å‘kubernetesåŸç”Ÿåº”ç”¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨werckeråšæŒç»­æ„å»ºä¸å‘å¸ƒ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨traefikå’ŒVIPåšè¾¹ç¼˜èŠ‚ç‚¹æä¾›å¤–éƒ¨è®¿é—®è·¯ç”±&lt;/li&gt;
&lt;li&gt;é›†æˆIstio Service Mesh&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ç¯å¢ƒå£°æ˜&#34;&gt;ç¯å¢ƒå£°æ˜&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆå£°æ˜ä¸‹æˆ‘ä»¬ä½¿ç”¨çš„é›†ç¾¤ç¯å¢ƒï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Docker1.12.5&lt;/li&gt;
&lt;li&gt;flannel network host-gw&lt;/li&gt;
&lt;li&gt;kubernetes 1.6.0+&lt;/li&gt;
&lt;li&gt;TLS enabled&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£å’Œæ›´å¤šèµ„æ–™è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;åº”ç”¨ç¤ºä¾‹&#34;&gt;åº”ç”¨ç¤ºä¾‹&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬çš„è¿™ä¸¤ä¸ªç¤ºä¾‹ä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œå¼€å‘éƒ¨ç½²ä¸€ä¸ªä¼ªé€ çš„ metric å¹¶æ˜¾ç¤ºåœ¨ web é¡µé¢ä¸Šï¼ŒåŒ…æ‹¬ä¸¤ä¸ªserviceï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-test&#34;&gt;k8s-app-monitor-test&lt;/a&gt;ï¼šç”Ÿæˆæ¨¡æ‹Ÿçš„ç›‘æ§æ•°æ®ï¼Œå‘é€httpè¯·æ±‚ï¼Œè·å–jsonè¿”å›å€¼&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-agent&#34;&gt;K8s-app-monitor-agent&lt;/a&gt;ï¼šè·å–ç›‘æ§æ•°æ®å¹¶ç»˜å›¾ï¼Œè®¿é—®æµè§ˆå™¨è·å–å›¾è¡¨&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™ä¸¤ä¸ªé•œåƒå¯ä»¥ç›´æ¥ä»docker hubä¸Šä¸‹è½½&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;jimmysong/k8s-app-monitor-test:latest&lt;/li&gt;
&lt;li&gt;jimmysong/k8s-app-monitor-agent:latest&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å®šä¹‰api&#34;&gt;å®šä¹‰API&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-test&#34;&gt;APIæ–‡æ¡£&lt;/a&gt; ä¸­çš„&lt;code&gt;api.html&lt;/code&gt;æ–‡ä»¶ï¼Œè¯¥æ–‡æ¡£åœ¨API blueprintä¸­å®šä¹‰ï¼Œä½¿ç”¨&lt;a href=&#34;https://github.com/danielgtaylor/aglio&#34;&gt;aglio&lt;/a&gt; ç”Ÿæˆï¼Œæ‰“å¼€åå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/k8s-app-monitor-test-api-doc.jpg&#34; alt=&#34;APIæ–‡æ¡£&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;å…³äºæœåŠ¡å‘ç°&#34;&gt;å…³äºæœåŠ¡å‘ç°&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;K8s-app-monitor-agent&lt;/code&gt;æœåŠ¡éœ€è¦è®¿é—®&lt;code&gt;k8s-app-monitor-test&lt;/code&gt;æœåŠ¡ï¼Œè¿™å°±æ¶‰åŠåˆ°æœåŠ¡å‘ç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥å†™æ­»äº†è¦è®¿é—®çš„æœåŠ¡çš„å†…ç½‘DNSåœ°å€ï¼ˆkubednsä¸­çš„åœ°å€ï¼Œå³&lt;code&gt;k8s-app-monitor-test.default.svc.cluster.local&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çŸ¥é“Kubernetesåœ¨å¯åŠ¨Podçš„æ—¶å€™ä¸ºå®¹å™¨æ³¨å…¥ç¯å¢ƒå˜é‡ï¼Œè¿™äº›ç¯å¢ƒå˜é‡åœ¨æ‰€æœ‰çš„ namespace ä¸­å…±äº«ï¼ˆç¯å¢ƒå˜é‡æ˜¯ä¸æ–­è¿½åŠ çš„ï¼Œæ–°å¯åŠ¨çš„Podä¸­å°†æ‹¥æœ‰è€çš„Podä¸­æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼Œè€Œè€çš„Podä¸­çš„ç¯å¢ƒå˜é‡ä¸å˜ï¼‰ã€‚ä½†æ˜¯æ—¢ç„¶ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡å°±å·²ç»å¯ä»¥è®¿é—®åˆ°å¯¹åº”çš„serviceï¼Œé‚£ä¹ˆè·å–åº”ç”¨çš„åœ°å€ä¿¡æ¯ï¼Œç©¶ç«Ÿæ˜¯ä½¿ç”¨å˜é‡å‘¢ï¼Ÿè¿˜æ˜¯ç›´æ¥ä½¿ç”¨DNSè§£ææ¥å‘ç°ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ç­”æ¡ˆæ˜¯ä½¿ç”¨DNSï¼Œè¯¦ç»†è¯´æ˜è§&lt;a href=&#34;http://jimmysong.io/posts/exploring-kubernetes-env-with-docker/&#34;&gt;Kubernetesä¸­çš„æœåŠ¡å‘ç°ä¸Dockerå®¹å™¨é—´çš„ç¯å¢ƒå˜é‡ä¼ é€’æºç æ¢ç©¶&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;æŒç»­é›†æˆ&#34;&gt;æŒç»­é›†æˆ&lt;/h2&gt;

&lt;p&gt;å¼€æºé¡¹ç›®çš„æ„å»ºç¦»ä¸å¼€CIå·¥å…·ï¼Œä½ å¯èƒ½ç»å¸¸ä¼šåœ¨å¾ˆå¤šGitHubçš„å¼€æºé¡¹ç›®é¦–é¡µä¸Šçœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/wercker-budget.jpg&#34; alt=&#34;wercker status badge&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™äº›å›¾æ ‡éƒ½æ˜¯CIå·¥å…·æä¾›çš„ï¼Œå¯ä»¥ç›´è§‚çš„çœ‹åˆ°å½“å‰çš„æ„å»ºçŠ¶æ€ï¼Œä¾‹å¦‚werckerä¸­å¯ä»¥åœ¨&lt;code&gt;Application&lt;/code&gt;-&lt;code&gt;magpie&lt;/code&gt;-&lt;code&gt;options&lt;/code&gt;ä¸­çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/wercker-status-budge-setting.jpg&#34; alt=&#34;wercker status badgeè®¾ç½®&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å°†æ–‡æœ¬æ¡†ä¸­çš„ä»£ç å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®çš„&lt;code&gt;README&lt;/code&gt;æ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®ä¸»é¡µä¸Šçœ‹åˆ°è¿™æ ·çš„æ ‡å¿—äº†ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨å¸‚é¢ä¸Šæœ‰å¾ˆå¤šæµè¡Œçš„CI/CDå·¥å…·å’ŒDevOpså·¥å…·æœ‰å¾ˆå¤šï¼Œè¿™äº›å·¥å…·æé«˜äº†è½¯ä»¶å¼€å‘çš„æ•ˆç‡ï¼Œå¢åŠ äº†å¼€å‘äººå‘˜çš„å¹¸ç¦æ„Ÿã€‚è¿™äº›å·¥å…·æœ‰ï¼š&lt;/p&gt;

&lt;p&gt;é€‚ç”¨äºGitHubä¸Šçš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨GitHubè´¦æˆ·ç™»é™†ï¼Œå¯¹äºå…¬å¼€é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š&lt;a href=&#34;https://travis-ci.org/&#34;&gt;Travis-ci&lt;/a&gt;ã€&lt;a href=&#34;https://circleci.com/&#34;&gt;CircleCI&lt;/a&gt;ã€&lt;a href=&#34;http://www.wercker.com/&#34;&gt;Wercker&lt;/a&gt;ã€‚ä»ç›®å‰GitHubä¸Šå¼€æºé¡¹ç›®çš„ä½¿ç”¨æƒ…å†µæ¥çœ‹ï¼ŒTravis-ciçš„ä½¿ç”¨ç‡æ›´é«˜ä¸€äº›ã€‚&lt;/p&gt;

&lt;p&gt;é€‚ç”¨äºä¼ä¸šçº§çš„ï¼š&lt;a href=&#34;https://jenkins.io/&#34;&gt;Jenkins&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸ä»…åŒ…æ‹¬CI/CDåŠŸèƒ½çš„DevOpså¹³å°ï¼š&lt;a href=&#34;https://www.jfrog.com/&#34;&gt;JFrog&lt;/a&gt;ã€&lt;a href=&#34;https://spinnaker.io/&#34;&gt;Spinnaker&lt;/a&gt;ã€&lt;a href=&#34;https://fabric8.io/&#34;&gt;Fabric8&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;werckerç®€ä»‹&#34;&gt;Werckerç®€ä»‹&lt;/h4&gt;

&lt;p&gt;Werckeræ˜¯ä¸€å®¶ä¸ºç°ä»£äº‘æœåŠ¡æä¾›å®¹å™¨åŒ–åº”ç”¨åŠå¾®æœåŠ¡çš„å¿«é€Ÿå¼€å‘ã€éƒ¨ç½²å·¥å…·çš„åˆåˆ›ä¼ä¸šï¼Œæˆç«‹äº2012å¹´ï¼Œæ€»éƒ¨ä½äºè·å…°é˜¿å§†æ–¯ç‰¹ä¸¹ã€‚å…¶ä»¥å®¹å™¨ä¸ºä¸­å¿ƒçš„å¹³å°å¯ä»¥å¯¹å¾®æœåŠ¡å’Œåº”ç”¨çš„å¼€å‘è¿›è¡Œè‡ªåŠ¨åŒ–ã€‚å¼€å‘è€…é€šè¿‡åˆ©ç”¨å…¶å‘½ä»¤è¡Œå·¥å…·èƒ½å¤Ÿç”Ÿæˆå®¹å™¨åˆ°æ¡Œé¢ï¼Œç„¶åè‡ªåŠ¨ç”Ÿæˆåº”ç”¨å¹¶éƒ¨ç½²åˆ°å„ç§äº‘å¹³å°ä¸Šé¢ã€‚å…¶æ”¯æŒçš„å¹³å°åŒ…æ‹¬Herokuã€AWSä»¥åŠRackspaceç­‰ã€‚&lt;/p&gt;

&lt;p&gt;Werckeräº2016å¹´è·å¾—450ä¸‡ç¾å…ƒAè½®èèµ„ï¼Œæ­¤è½®èèµ„ç”±Inkef Capitalé¢†æŠ•ï¼ŒNotion Capitalè·ŸæŠ•ï¼Œèèµ„æ‰€å¾—å°†ç”¨äºå•†ä¸šç‰ˆäº§å“çš„å¼€å‘ã€‚æ­¤è½®èèµ„è¿‡åå…¶æ€»èèµ„é¢ä¸º750ä¸‡ç¾å…ƒã€‚&lt;/p&gt;

&lt;p&gt;Werckeräº2017å¹´4æœˆè¢«Oracleç”²éª¨æ–‡äºæ”¶è´­ã€‚&lt;/p&gt;

&lt;h4 id=&#34;å¦‚ä½•ä½¿ç”¨&#34;&gt;å¦‚ä½•ä½¿ç”¨&lt;/h4&gt;

&lt;p&gt;é€šè¿‡Werckeræ­å»ºCIç¯å¢ƒåªéœ€ç»è¿‡ä¸‰ä¸ªåŸºæœ¬æ­¥éª¤ã€‚&lt;/p&gt;

&lt;p&gt;1ï¼åœ¨Werckerç½‘ç«™ä¸­åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;p&gt;2ï¼å°†wercker.ymlæ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ä»£ç åº“ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;3ï¼é€‰æ‹©æ‰“åŒ…å’Œéƒ¨ç½²æ„å»ºçš„ä½ç½®ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥ä½¿ç”¨GitHubå¸å·ç›´æ¥ç™»å½•&lt;a href=&#34;http://www.wercker.com/&#34;&gt;Wercker&lt;/a&gt;ï¼Œæ•´ä¸ªåˆ›å»ºåº”ç”¨CIçš„æµç¨‹ä¸€å…±3æ­¥ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€æ—¦æ‹¥æœ‰äº†è´¦æˆ·ï¼Œé‚£ä¹ˆåªéœ€ç®€å•åœ°ç‚¹å‡»ä½äºé¡¶éƒ¨çš„&lt;strong&gt;åº”ç”¨ç¨‹åº&lt;/strong&gt;èœå•ï¼Œç„¶åé€‰æ‹©&lt;strong&gt;åˆ›å»º&lt;/strong&gt;é€‰é¡¹å³å¯ã€‚å¦‚æœç³»ç»Ÿæç¤ºæ˜¯å¦è¦åˆ›å»ºç»„ç»‡æˆ–åº”ç”¨ç¨‹åºï¼Œè¯·é€‰æ‹©&lt;strong&gt;åº”ç”¨ç¨‹åº&lt;/strong&gt;ã€‚Werckerç»„ç»‡å…è®¸å¤šä¸ªWerckerç”¨æˆ·ä¹‹é—´è¿›è¡Œåä½œï¼Œè€Œæ— é¡»æä¾›ä¿¡ç”¨å¡ã€‚ä¸‹å›¾ä¸ºè®¾ç½®æ–°åº”ç”¨ç¨‹åºçš„å‘å¯¼é¡µé¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/wercker-create-application.jpg&#34; alt=&#34;å‘å¯¼é¡µé¢&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é€‰æ‹©äº†GitHubä¸­çš„repoä¹‹åï¼Œç¬¬äºŒæ­¥é…ç½®è®¿é—®æƒé™ï¼Œæœ€åä¸€æ­¥Werckerä¼šå°è¯•ç”Ÿæˆä¸€ä¸ªwercker.ymlæ–‡ä»¶ï¼ˆåé¢ä¼šè®¨è®ºï¼‰ã€‚ä¸è¿‡è‡³å°‘å¯¹äºGoåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™ä¸ªé…ç½®å¾ˆå°‘ä¼šæ»¡è¶³è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æ€»æ˜¯éœ€è¦åˆ›å»ºè‡ªå·±çš„Werckeré…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h4 id=&#34;åˆ›å»ºwerckeré…ç½®æ–‡ä»¶wercker-yaml&#34;&gt;åˆ›å»ºWerckeré…ç½®æ–‡ä»¶Wercker.yaml&lt;/h4&gt;

&lt;p&gt;Werckeré…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¿…é¡»åœ¨GitHub repoçš„æœ€é¡¶å±‚ç›®å½•ï¼Œè¯¥æ–‡ä»¶ä¸»è¦åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¯¹åº”å¯ç”¨çš„ä¸‰ä¸ªä¸»è¦ç®¡é“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Dev&lt;/strong&gt;ï¼šå®šä¹‰äº†å¼€å‘ç®¡é“çš„æ­¥éª¤åˆ—è¡¨ã€‚ä¸æ‰€æœ‰ç®¡é“ä¸€æ ·ï¼Œå¯ä»¥é€‰å®šä¸€ä¸ª&lt;strong&gt;box&lt;/strong&gt;ç”¨äºæ„å»ºï¼Œä¹Ÿå¯ä»¥å…¨å±€æŒ‡å®šä¸€ä¸ªboxåº”ç”¨äºæ‰€æœ‰ç®¡é“ã€‚boxå¯ä»¥æ˜¯Werckerå†…ç½®çš„é¢„åˆ¶Dockeré•œåƒä¹‹ä¸€ï¼Œä¹Ÿå¯ä»¥æ˜¯Docker Hubæ‰˜ç®¡çš„ä»»ä½•Dockeré•œåƒã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Build&lt;/strong&gt;ï¼šå®šä¹‰äº†åœ¨Werckeræ„å»ºæœŸé—´è¦æ‰§è¡Œçš„æ­¥éª¤å’Œè„šæœ¬çš„åˆ—è¡¨ã€‚ä¸è®¸å¤šå…¶ä»–æœåŠ¡ï¼ˆå¦‚Jenkinså’ŒTeamCityï¼‰ä¸åŒï¼Œæ„å»ºæ­¥éª¤ä½äºä»£ç åº“çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯éšè—åœ¨æœåŠ¡é…ç½®é‡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Deploy&lt;/strong&gt;ï¼šåœ¨è¿™é‡Œå¯ä»¥å®šä¹‰æ„å»ºçš„éƒ¨ç½²æ–¹å¼å’Œä½ç½®ã€‚&lt;/p&gt;

&lt;p&gt;Werckerä¸­è¿˜æœ‰&lt;strong&gt;å·¥ä½œæµ&lt;/strong&gt;çš„æ¦‚å¿µï¼Œé€šè¿‡ä½¿ç”¨åˆ†æ”¯ã€æ¡ä»¶æ„å»ºã€å¤šä¸ªéƒ¨ç½²ç›®æ ‡å’Œå…¶ä»–é«˜çº§åŠŸèƒ½æ‰©å±•äº†ç®¡é“çš„åŠŸèƒ½ï¼Œè¿™äº›é«˜çº§åŠŸèƒ½è¯»ç€å¯ä»¥è‡ªå·±åœ¨werckerçš„ç½‘ç«™ä¸­æ¢ç´¢ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºæˆ‘ä½¿ç”¨werckerè‡ªåŠ¨æ„å»ºï¼Œæ„å»ºå®Œæˆåè‡ªåŠ¨æ‰“åŒ…æˆdockeré•œåƒå¹¶ä¸Šä¼ åˆ°docker hubä¸­ï¼ˆéœ€è¦å…ˆåœ¨docker hubä¸­åˆ›å»ºrepoï¼‰ï¼Œå¦‚ä½•ä½¿ç”¨ wercker åšæŒç»­æ„å»ºä¸å‘å¸ƒï¼Œå¹¶é›†æˆdocker hubæ’ä»¶è¯·å‚è€ƒï¼š&lt;a href=&#34;https://jimmysong.io/posts/continuous-integration-with-wercker/&#34;&gt;werckeræ„å»º&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;K8s-app-monitor-agentçš„werckeré…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;box: golang

build:

  steps:
    - setup-go-workspace

    - script:
        name: go get
        code: |
          cd $WERCKER_SOURCE_DIR
          go version
          go get -u github.com/Masterminds/glide
          export PATH=$WERCKER_SOURCE_DIR/bin:$PATH
          glide install
    # Build the project
    - script:
        name: go build
        code: |
          go build
    - script:
        name: copy files to wercker output 
        code: |
          cp -R ./ ${WERCKER_OUTPUT_DIR}
deploy:
 steps:
   - internal/docker-push:
       username: $USERNAME
       password: $PASSWORD
       cmd: /pipeline/source/k8s-app-monitor-agent
       port: &amp;quot;3000&amp;quot;
       tag: latest
       repository: jimmysong/k8s-app-monitor-agent
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…¶ä¸­çš„&lt;code&gt;$USERNAME&lt;/code&gt;å’Œ&lt;code&gt;$PASSWORD&lt;/code&gt;æ˜¯docker hubçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™äº›æ˜¯ä½œä¸ºwerckeræ„å»ºæ—¶å€™çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨werckerçš„webç«¯è¿›è¡Œé…ç½®çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤æ–‡ä»¶åŒ…å«ä¸¤ä¸ªç®¡é“ï¼šbuildå’Œdeployã€‚åœ¨å¼€å‘æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Werckerå’ŒDockeråˆ›å»ºä¸€ä¸ªå¹²å‡€çš„Dockeré•œåƒï¼Œç„¶åå°†å®ƒpushåˆ°Docker Hubä¸­ã€‚WerckeråŒ…å«ä¸€ä¸ªå«åš&lt;code&gt;Internal/docker-push&lt;/code&gt;çš„deploy pluginï¼Œå¯ä»¥å°†æ„å»ºå¥½çš„dockeré•œåƒpushåˆ°é•œåƒä»“åº“ä¸­ï¼Œé»˜è®¤æ˜¯Docker Hubï¼Œä¹Ÿå¯ä»¥é…ç½®æˆç§æœ‰é•œåƒä»“åº“ã€‚&lt;/p&gt;

&lt;p&gt;boxé”®çš„å€¼æ˜¯golangã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªåŸºç¡€çš„Dockeré•œåƒï¼Œå®ƒå·²ç»å®‰è£…äº†Goç¯å¢ƒã€‚è¿™ä¸€ç‚¹è‡³å…³é‡è¦ï¼Œå› ä¸ºæ‰§è¡ŒWerckeræ„å»ºçš„åŸºå‡†Dockeré•œåƒéœ€è¦åŒ…å«åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ„å»ºå·¥å…·ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://app.wercker.com/jimmysong/k8s-app-monitor-agent&#34;&gt;æŸ¥çœ‹è¯¦ç»†æ„å»ºæµç¨‹&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å½“ç„¶ä½ è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„CIå·¥å…·ï¼Œå› ä¸ºwerckerçš„æ’ä»¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥æ„å»ºæˆdockeré•œåƒä¸Šä¼ åˆ°docker hubä¸­ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†werckerï¼Œä½œä¸ºä¸ªäººé¡¹ç›®å’Œå¼€æºé¡¹ç›®çš„è¯å¯ä»¥é€‰æ‹©å®ƒï¼Œä¼ä¸šå†…éƒ¨å»ºè®®é€‰æ‹©Jenkinsã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç”Ÿæˆäº†å¦‚ä¸‹ä¸¤ä¸ªdockeré•œåƒï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;jimmysong/k8s-app-monitor-test:latest&lt;/li&gt;
&lt;li&gt;jimmysong/k8s-app-monitor-agent:latest&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;æœ¬åœ°æµ‹è¯•&#34;&gt;æœ¬åœ°æµ‹è¯•&lt;/h2&gt;

&lt;p&gt;åœ¨å°†æœåŠ¡å‘å¸ƒåˆ°çº¿ä¸Šä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨&lt;code&gt;docker-compose&lt;/code&gt;åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™ä¸¤ä¸ªåº”ç”¨çš„&lt;code&gt;docker-compose.yaml&lt;/code&gt;æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;version: &#39;2&#39;
services:
  k8s-app-monitor-agent:
    image: jimmysong/k8s-app-monitor-agent:234d51c
    container_name: monitor-agent
    depends_on:
      - k8s-app-monitor-test
    ports:
      - 8888:8888
    environment:
      - SERVICE_NAME=k8s-app-monitor-test
  k8s-app-monitor-test:
    image: jimmysong/k8s-app-monitor-test:9c935dd
    container_name: monitor-test
    ports:
      - 3000:3000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæµ‹è¯•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker-compose up
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—®&lt;a href=&#34;http://localhost:8888/k8s-app-monitor-test&#34;&gt;http://localhost:8888/k8s-app-monitor-test&lt;/a&gt;å°±å¯ä»¥çœ‹åˆ°ç›‘æ§é¡µé¢ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å¯åŠ¨æœåŠ¡&#34;&gt;å¯åŠ¨æœåŠ¡&lt;/h2&gt;

&lt;p&gt;æ‰€æœ‰çš„kubernetesåº”ç”¨å¯åŠ¨æ‰€ç”¨çš„yamlé…ç½®æ–‡ä»¶éƒ½ä¿å­˜åœ¨é‚£ä¸¤ä¸ªGitHubä»“åº“çš„&lt;code&gt;manifest.yaml&lt;/code&gt;æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚&lt;code&gt;k8s-app-monitor-agent&lt;/code&gt;çš„&lt;code&gt;manifest.yaml&lt;/code&gt;æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: k8s-app-monitor-agent
  namespace: default
spec:
  replicas: 1
  template:
    metadata:
      labels:
        k8s-app: k8s-app-monitor-agent
    spec:
      containers:
      - image: jimmysong/k8s-app-monitor-agent:latest
        imagePullPolicy: Always
        name: app
        ports:
        - containerPort: 8080
        env: 
        - name: APP_PORT
          value: &amp;quot;3000&amp;quot;
        - name: SERVICE_NAME
          value: &amp;quot;k8s-app-monitor-test&amp;quot;
---
apiVersion: v1
kind: Service
metadata:
  name: k8s-app-monitor-agent
  labels:
    k8s-svc: k8s-app-monitor-agent
spec:
  ports:
  - port: 8080
    protocol: TCP
    name: http
  selector:
    k8s-app: k8s-app-monitor-agent
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„å…¶ä¸­çš„&lt;code&gt;env&lt;/code&gt;ï¼ŒåŒ…æ‹¬äº†ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼ˆæ³¨æ„ï¼šç¯å¢ƒå˜é‡åç§°å¿…é¡»ä¸ºå¤§å†™å­—æ¯ï¼‰ï¼š&lt;code&gt;APP_PORT&lt;/code&gt;å’Œ&lt;code&gt;SERVICE_NAME&lt;/code&gt;ï¼Œè¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨ &lt;code&gt;main.go&lt;/code&gt;çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func drawChart(res http.ResponseWriter, req *http.Request) {
	port := os.Getenv(&amp;quot;APP_PORT&amp;quot;)
	service := os.Getenv(&amp;quot;SERVICE_NAME&amp;quot;)
	if len(port) == 0 {
		port = &amp;quot;3000&amp;quot;
	}
	if len(service) == 0 {
		service = &amp;quot;localhost&amp;quot;
	}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœç¨‹åºå¯åŠ¨çš„æ—¶å€™æ‰¾ä¸åˆ°è¯¥ç¯å¢ƒå˜é‡ï¼Œå°†ä¼šä½¿ç”¨ç¨‹åºå†…ç½®çš„é»˜è®¤å€¼ï¼Œå½“ç„¶æˆ‘ä»¬ä¸è¯¥å°†æœåŠ¡åœ°å€å†™æ­»åœ¨ç¨‹åºå†…éƒ¨ï¼Œè€Œåº”è¯¥æ˜¯å¯é…ç½®çš„ï¼Œåœ¨kubernetesä¸­æœ€ä½³é…ç½®æ–¹å¼æ˜¯ç¯å¢ƒå˜é‡æˆ–è€…ConfigMapã€‚&lt;/p&gt;

&lt;p&gt;åˆ†åˆ«åœ¨ä¸¤ä¸ªGitHubç›®å½•ä¸‹æ‰§è¡Œ&lt;code&gt;kubectl create -f manifest.yaml&lt;/code&gt;å³å¯å¯åŠ¨æœåŠ¡ã€‚&lt;/p&gt;

&lt;h2 id=&#34;è¾¹ç¼˜èŠ‚ç‚¹é…ç½®&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹é…ç½®&lt;/h2&gt;

&lt;p&gt;è¾¹ç¼˜èŠ‚ç‚¹æ¶æ„å›¾&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/kubernetes-edge-node-architecture.png&#34; alt=&#34;è¾¹ç¼˜èŠ‚ç‚¹æ¶æ„å›¾&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é€‰æ‹©Kubernetesçš„ä¸‰ä¸ªnodeä½œä¸ºè¾¹ç¼˜èŠ‚ç‚¹ï¼Œå¹¶å®‰è£…keepalivedï¼Œä¸Šå›¾å±•ç¤ºäº†è¾¹ç¼˜èŠ‚ç‚¹çš„é…ç½®ï¼ŒåŒæ—¶å±•ç¤ºäº†å‘Kubernetesä¸­æ·»åŠ æœåŠ¡çš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¾¹ç¼˜èŠ‚ç‚¹å®šä¹‰&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆè§£é‡Šä¸‹ä»€ä¹ˆå«è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆEdge Nodeï¼‰ï¼Œæ‰€è°“çš„è¾¹ç¼˜èŠ‚ç‚¹å³é›†ç¾¤å†…éƒ¨ç”¨æ¥å‘é›†ç¾¤å¤–æš´éœ²æœåŠ¡èƒ½åŠ›çš„èŠ‚ç‚¹ï¼Œé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡é€šè¿‡è¯¥èŠ‚ç‚¹æ¥è°ƒç”¨é›†ç¾¤å†…éƒ¨çš„æœåŠ¡ï¼Œè¾¹ç¼˜èŠ‚ç‚¹æ˜¯é›†ç¾¤å†…å¤–äº¤æµçš„ä¸€ä¸ªEndpointã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¾¹ç¼˜èŠ‚ç‚¹è¦è€ƒè™‘ä¸¤ä¸ªé—®é¢˜&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è¾¹ç¼˜èŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œä¸èƒ½æœ‰å•ç‚¹æ•…éšœï¼Œå¦åˆ™æ•´ä¸ªkubernetesé›†ç¾¤çš„å¤–éƒ¨è®¿é—®å°†ä¸å¯ç”¨&lt;/li&gt;
&lt;li&gt;å¯¹å¤–çš„ä¸€è‡´æš´éœ²ç«¯å£ï¼Œå³åªèƒ½æœ‰ä¸€ä¸ªå¤–ç½‘è®¿é—®IPå’Œç«¯å£&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸ºäº†æ»¡è¶³è¾¹ç¼˜èŠ‚ç‚¹çš„ä»¥ä¸Šéœ€æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;http://www.keepalived.org/&#34;&gt;keepalived&lt;/a&gt;æ¥å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨Kubernetesä¸­æ·»åŠ äº†serviceçš„åŒæ—¶ï¼Œåœ¨DNSä¸­å¢åŠ ä¸€ä¸ªè®°å½•ï¼Œè¿™æ¡è®°å½•éœ€è¦è·Ÿingressä¸­çš„&lt;code&gt;host&lt;/code&gt;å­—æ®µç›¸åŒï¼ŒIPåœ°å€å³VIPçš„åœ°å€ï¼Œæœ¬ç¤ºä¾‹ä¸­æ˜¯&lt;code&gt;172.20.0.119&lt;/code&gt;ï¼Œè¿™æ ·é›†ç¾¤å¤–éƒ¨å°±å¯ä»¥é€šè¿‡serviceçš„DNSåç§°æ¥è®¿é—®æœåŠ¡äº†ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/blob/master/practice/edge-node-configuration.md&#34;&gt;è¯¦ç»†æ“ä½œæ­¥éª¤å’Œé…ç½®&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‘å¸ƒ&#34;&gt;å‘å¸ƒ&lt;/h2&gt;

&lt;p&gt;æ‰€æœ‰çš„kubernetesåº”ç”¨å¯åŠ¨æ‰€ç”¨çš„yamlé…ç½®æ–‡ä»¶éƒ½ä¿å­˜åœ¨é‚£ä¸¤ä¸ªGitHubä»“åº“çš„&lt;code&gt;manifest.yaml&lt;/code&gt;æ–‡ä»¶ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://github.com/kubernetes/kompose&#34;&gt;kompose&lt;/a&gt;è¿™ä¸ªå·¥å…·ï¼Œå¯ä»¥å°†*docker-compose*çš„YAMLæ–‡ä»¶è½¬æ¢æˆkubernetesè§„æ ¼çš„YAMLæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†åˆ«åœ¨ä¸¤ä¸ªGitHubç›®å½•ä¸‹æ‰§è¡Œ&lt;code&gt;kubectl create -f manifest.yaml&lt;/code&gt;å³å¯å¯åŠ¨æœåŠ¡ã€‚ä¹Ÿå¯ä»¥ç›´æ¥åœ¨*k8s-app-monitor-agent*ä»£ç åº“çš„&lt;code&gt;k8s&lt;/code&gt;ç›®å½•ä¸‹æ‰§è¡Œ&lt;code&gt;kubectl apply -f kompose&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä»¥ä¸ŠYAMLæ–‡ä»¶ä¸­æœ‰åŒ…å«äº†Ingressé…ç½®ï¼Œæ˜¯ä¸ºäº†å°†*k8s-app-monitor-agent*æœåŠ¡æš´éœ²ç»™é›†ç¾¤å¤–éƒ¨è®¿é—®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–¹å¼ä¸€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœåŠ¡å¯åŠ¨åéœ€è¦æ›´æ–°ingressé…ç½®ï¼Œåœ¨&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/manifests/traefik-ingress/ingress.yaml&#34;&gt;ingress.yaml&lt;/a&gt;æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å‡ è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;  - host: k8s-app-monitor-agent.jimmysong.io
    http:
      paths:
      - path: /k8s-app-monitor-agent
        backend:
          serviceName: k8s-app-monitor-agent
          servicePort: 8888
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿å­˜åï¼Œç„¶åæ‰§è¡Œ&lt;code&gt;kubectl replace -f ingress.yaml&lt;/code&gt;å³å¯åˆ·æ–°ingressã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹æœ¬æœºçš„&lt;code&gt;/etc/hosts&lt;/code&gt;æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åŠ å…¥ä»¥ä¸‹ä¸€è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;172.20.0.119 k8s-app-monitor-agent.jimmysong.io
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°†è¯¥åŸŸååŠ å…¥åˆ°å†…ç½‘çš„DNSä¸­ï¼Œä¸ºäº†ç®€å•èµ·è§æˆ‘ä½¿ç”¨hostsã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–¹å¼äºŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ–è€…ä¸ä¿®æ”¹å·²æœ‰çš„Ingressï¼Œè€Œæ˜¯ä¸ºè¯¥é˜Ÿå¤–æš´éœ²çš„æœåŠ¡å•ç‹¬åˆ›å»ºä¸€ä¸ªIngressï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: k8s-app-monitor-agent-ingress
  annotations:
    kubernetes.io/ingress.class: &amp;quot;treafik&amp;quot;
spec:
  rules:
  - host: k8s-app-monitor-agent.jimmysong.io
    http:
      paths:
      - path: /
        backend:
          serviceName: k8s-app-monitor-agent
          servicePort: 8888
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¦è§&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/practice/edge-node-configuration.html&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é›†æˆistio-service-mesh&#34;&gt;é›†æˆIstio service mesh&lt;/h2&gt;

&lt;p&gt;ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬ç”Ÿæˆäº†kuberneteså¯è¯»å–çš„åº”ç”¨çš„YAMLé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„YAMLé…ç½®å’Œå¹¶åˆ°åŒä¸€ä¸ªYAMLæ–‡ä»¶ä¸­å‡å¦‚æ–‡ä»¶åä¸º&lt;code&gt;k8s-app-monitor-istio-all-in-one.yaml&lt;/code&gt;ï¼Œå¦‚æœè¦å°†å…¶é›†æˆåˆ°Istio service meshï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl apply -n default -f &amp;lt;(istioctl kube-inject -f k8s-app-monitor-istio-all-in-one.yaml)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·å°±ä¼šåœ¨æ¯ä¸ªPodä¸­æ³¨å…¥ä¸€ä¸ªsidecarå®¹å™¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;éªŒè¯&#34;&gt;éªŒè¯&lt;/h2&gt;

&lt;p&gt;å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Traefik ingressæ¥æš´éœ²çš„æœåŠ¡ï¼Œé‚£ä¹ˆåœ¨æµè§ˆå™¨ä¸­è®¿é—®&lt;a href=&#34;http://k8s-app-monitor-agent.jimmysong.io/k8s-app-monitor-agent&#34;&gt;http://k8s-app-monitor-agent.jimmysong.io/k8s-app-monitor-agent&lt;/a&gt;ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ç”»é¢ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢å°†çœ‹åˆ°æ–°çš„æŸ±çŠ¶å›¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/k8s-app-monitor-agent.jpg&#34; alt=&#34;å›¾è¡¨&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt;æ¥éƒ¨ç½²çš„kubernetesé›†ç¾¤ï¼Œè¯¥åº”ç”¨é›†æˆäº†Istio service meshåå¯ä»¥é€šè¿‡&lt;a href=&#34;http://172.17.8.101:32000/k8s-app-monitor-agent&#34;&gt;http://172.17.8.101:32000/k8s-app-monitor-agent&lt;/a&gt;æ¥è®¿é—®ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å¯¹&lt;code&gt;k8s-app-monitor-agent&lt;/code&gt;æœåŠ¡è¿›è¡Œäº†Næ­¤è®¿é—®ä¹‹åï¼Œå†è®¿é—®&lt;a href=&#34;http://grafana.istio.jimmysong.io/&#34;&gt;http://grafana.istio.jimmysong.io&lt;/a&gt;å¯ä»¥çœ‹åˆ°Service Meshçš„ç›‘æ§ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/k8s-app-monitor-istio-grafana.png&#34; alt=&#34;Grafanaé¡µé¢&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è®¿é—®&lt;a href=&#34;http://servicegraph.istio.jimmysong.io/dotviz&#34;&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/a&gt;å¯ä»¥çœ‹åˆ°æœåŠ¡çš„ä¾èµ–å’ŒQPSä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/k8s-app-monitor-istio-servicegraph-dotviz.png&#34; alt=&#34;servicegraphé¡µé¢&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è®¿é—®&lt;a href=&#34;http://zipkin.istio.jimmysong.io/&#34;&gt;http://zipkin.istio.jimmysong.io&lt;/a&gt;å¯ä»¥é€‰æ‹©æŸ¥çœ‹&lt;code&gt;k8s-app-monitor-agent&lt;/code&gt;åº”ç”¨çš„è¿½è¸ªä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/k8s-app-monitor-istio-zipkin.png&#34; alt=&#34;Zipkiné¡µé¢&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è‡³æ­¤ä»ä»£ç æäº¤åˆ°ä¸Šçº¿åˆ°Kubernetesé›†ç¾¤ä¸Šå¹¶é›†æˆIstio service meshçš„è¿‡ç¨‹å°±å…¨éƒ¨å®Œæˆäº†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡é¦–å‘äº2017å¹´9æœˆ14æ—¥ï¼Œæ›´æ–°äº2018å¹´3æœˆ26æ—¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/deploy-applications-in-kubernetes/&#34;&gt;é€‚ç”¨äºKubernetesçš„åº”ç”¨å¼€å‘ä¸éƒ¨ç½²æµç¨‹è¯¦è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://app.wercker.com/jimmysong/k8s-app-monitor-agent/&#34;&gt;ç¤ºä¾‹çš„é¡¹ç›®ä»£ç æœåŠ¡å™¨ç«¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-agent&#34;&gt;ç¤ºä¾‹é¡¹ç›®ä»£ç å‰ç«¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/&#34;&gt;kubernetes-handbok&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/blob/master/practice/edge-node-configuration.md&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹é…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>æ‰“é€ é«˜æ•ˆçš„Kuberneteså‘½ä»¤è¡Œç»ˆç«¯</title>
      <link>https://jimmysong.io/blog/configuring-efficient-kubernetes-cli-terminal/</link>
      <pubDate>Sun, 11 Mar 2018 09:36:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/configuring-efficient-kubernetes-cli-terminal/</guid>
      <description>
        
        
        

&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•æ‰“é€ ä¸€ä¸ªé«˜æ•ˆçš„Kuberneteså‘½ä»¤è¡Œç»ˆç«¯ä»¥åŠKuberneteså‘½ä»¤è¡Œæ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æ‰“é€ é«˜æ•ˆçš„Kuberneteså‘½ä»¤è¡Œç»ˆç«¯å‘¢ï¼Ÿå› ä¸ºä¸‹é¢çš„ä¸‰ç‚¹åŸå› ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetesä½œä¸ºäº‘åŸç”Ÿæ—¶ä»£çš„â€œæ“ä½œç³»ç»Ÿâ€ï¼Œç†Ÿæ‚‰å’Œæ˜¯ç”¨å®ƒæ˜¯æ¯åç”¨æˆ·ï¼ˆUserï¼‰çš„å¿…å¤‡æŠ€èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å‘½ä»¤è¡Œæ˜¯æœ€é«˜æ•ˆï¼Œæœ€æœ‰â€œé€¼æ ¼â€çš„æ“ä½œæ–¹å¼ï¼Œåœ¨å–œæ¬¢å‘½ä»¤çš„äººçœ¼é‡Œdashboardä¸æ˜¯ç»™å¼€å‘è€…å’Œç®¡ç†å‘˜ç”¨çš„ã€‚&lt;/li&gt;
&lt;li&gt;kubenetesåŸç”Ÿæä¾›äº†kubectlå‘½ä»¤å°±å¾ˆå¥½ç”¨ï¼Œå†é€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨å¾ˆæ–¹ä¾¿çš„è¯´å•Šï¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å‰å‡ å¤©çœ‹åˆ°&lt;a href=&#34;https://dev.to/&#34;&gt;dev.to&lt;/a&gt;ç½‘ç«™é‡Œæœ‰äººè®¨è®º&lt;a href=&#34;https://dev.to/itsjzt/can-i-see-your-terminal--62e&#34;&gt;Can I see your terminal?&lt;/a&gt; æˆ‘å¿ƒæƒ³å‘½ä»¤è¡Œè¿™ä¹ˆâ€œç§äººâ€œçš„ä¸œè¥¿æ€ä¹ˆèƒ½éšä¾¿ç»™äººçœ‹å‘¢ğŸ˜„æ‰€ä»¥æˆ‘ä¹Ÿå‘äº†ä¸€ä¸ªã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªé«˜æ•ˆçš„å‘½ä»¤è¡Œç»ˆç«¯ç”±é‚£äº›è½¯ä»¶ç»„æˆå‘¢ï¼Ÿ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;iTerm2&lt;/li&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;li&gt;kube-ps1&lt;/li&gt;
&lt;li&gt;kubectx&lt;/li&gt;
&lt;li&gt;oh-my-zsh&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;kubectlå‘½ä»¤æ¦‚è§ˆ&#34;&gt;Kubectlå‘½ä»¤æ¦‚è§ˆ&lt;/h2&gt;

&lt;p&gt;Kubernetesæä¾›çš„kubectlå‘½ä»¤æ˜¯ä¸é›†ç¾¤äº¤äº’æœ€ç›´æ¥çš„æ–¹å¼ï¼Œv1.6ç‰ˆæœ¬çš„kubectlå‘½ä»¤å‚è€ƒå›¾å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/kubernetes-kubectl-cheatsheet.png&#34; alt=&#34;kubectl cheatsheet&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Kubectlçš„å­å‘½ä»¤ä¸»è¦åˆ†ä¸º8ä¸ªç±»åˆ«ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åŸºç¡€å‘½ä»¤ï¼ˆåˆå­¦è€…éƒ½ä¼šä½¿ç”¨çš„ï¼‰&lt;/li&gt;
&lt;li&gt;åŸºç¡€å‘½ä»¤ï¼ˆä¸­çº§ï¼‰&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å‘½ä»¤&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç®¡ç†å‘½ä»¤&lt;/li&gt;
&lt;li&gt;æ•…éšœæ’æŸ¥å’Œè°ƒè¯•å‘½ä»¤&lt;/li&gt;
&lt;li&gt;é«˜çº§å‘½ä»¤&lt;/li&gt;
&lt;li&gt;è®¾ç½®å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å…¶ä»–å‘½ä»¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç†Ÿæ‚‰è¿™äº›å‘½ä»¤æœ‰åŠ©äºå¤§å®¶æ¥æ“ä½œå’Œç®¡ç†kubernetesé›†ç¾¤ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‘½ä»¤è¡Œæç¤º&#34;&gt;å‘½ä»¤è¡Œæç¤º&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†ä½¿ç”¨kubectlå‘½ä»¤æ›´åŠ é«˜æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å®‰è£…ä¸€ä¸‹å¼€æºè½¯ä»¶æ¥å¢åŠ æ“ä½œkubectlå‘½ä»¤çš„å¿«æ·æ–¹å¼ï¼ŒåŒæ—¶ä¸ºkubectlå‘½ä»¤å¢åŠ å‘½ä»¤æç¤ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/tools-to-supercharge-kubectl.jpg&#34; alt=&#34;å¢åŠ kubecltå‘½ä»¤çš„å·¥å…·ï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ahmetb/kubectx&#34;&gt;kubectx&lt;/a&gt;ï¼šç”¨äºåˆ‡æ¢kubernetes context&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/jonmosco/kube-ps1&#34;&gt;kube-ps1&lt;/a&gt;ï¼šä¸ºå‘½ä»¤è¡Œç»ˆç«¯å¢åŠ &lt;code&gt;$PROMPT&lt;/code&gt;å­—æ®µ&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cloudnativelabs/kube-shell&#34;&gt;kube-shell&lt;/a&gt;ï¼šäº¤äº’å¼å¸¦å‘½ä»¤æç¤ºçš„kubectlç»ˆç«¯&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¨éƒ¨é…ç½®å®Œæˆåçš„kubectlç»ˆç«¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/supercharged-kubectl.jpg&#34; alt=&#34;å¢å¼ºçš„kubectlå‘½ä»¤&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;kube-shell&#34;&gt;kube-shell&lt;/h3&gt;

&lt;p&gt;å¼€æºé¡¹ç›®&lt;a href=&#34;https://github.com/cloudnativelabs/kube-shell&#34;&gt;kube-shell&lt;/a&gt;å¯ä»¥ä¸ºkubectlæä¾›è‡ªåŠ¨çš„å‘½ä»¤æç¤ºå’Œè¡¥å…¨ï¼Œä½¿ç”¨èµ·æ¥ç‰¹åˆ«æ–¹ä¾¿ï¼Œæ¨èç»™å¤§å®¶ã€‚&lt;/p&gt;

&lt;p&gt;Kube-shellæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å‘½ä»¤æç¤ºï¼Œç»™å‡ºå‘½ä»¤çš„ä½¿ç”¨è¯´æ˜&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨è¡¥å…¨ï¼Œåˆ—å‡ºå¯é€‰å‘½ä»¤å¹¶å¯ä»¥é€šè¿‡tabé”®è‡ªåŠ¨è¡¥å…¨ï¼Œæ”¯æŒæ¨¡ç³Šæœç´¢&lt;/li&gt;
&lt;li&gt;é«˜äº®&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨tabé”®å¯ä»¥åˆ—å‡ºå¯é€‰çš„å¯¹è±¡&lt;/li&gt;
&lt;li&gt;vimæ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Macä¸‹å®‰è£…&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip install kube-shell --user -U
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/kube-shell.jpg&#34; alt=&#34;kube-shellé¡µé¢&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;kubectlçš„èº«ä»½è®¤è¯&#34;&gt;kubectlçš„èº«ä»½è®¤è¯&lt;/h2&gt;

&lt;p&gt;Kubernetesä¸­å­˜åœ¨ä¸‰ç§å®‰å…¨è®¤è¯æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CAè¯ä¹¦&lt;/strong&gt;ï¼šAPI serverä¸å…¶å®ƒå‡ ä¸ªç»„ä»¶ä¹‹é—´éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è®¤è¯çš„&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP base&lt;/strong&gt;ï¼šå³åœ¨API serverçš„å¯åŠ¨å‚æ•°ä¸­æŒ‡å®šçš„&lt;code&gt;--token-auth-file=/etc/kubernetes/token.csv&lt;/code&gt;æ–‡ä»¶ä¸­æ˜æ–‡çš„ç”¨æˆ·ã€ç»„ã€å¯†ç å’ŒUIDé…ç½®&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bearer token&lt;/strong&gt;ï¼šHTTPè¯·æ±‚ä¸­&lt;code&gt;header&lt;/code&gt;ä¸­ä¼ é€’çš„&lt;code&gt;Autorization:Bearer token&lt;/code&gt;ï¼Œè¿™ä¸ªtokené€šå¸¸ä¿å­˜åœ¨åˆ›å»ºè§’è‰²è·Ÿ&lt;code&gt;serviceaccount&lt;/code&gt;ç»‘å®šçš„æ—¶å€™ç”Ÿæˆçš„secretä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;kubectlé€šè¿‡è¯»å–&lt;code&gt;kubeconfig&lt;/code&gt;æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åœ¨å‘API serverå‘é€è¯·æ±‚çš„æ—¶å€™åŒæ—¶ä¼ é€’è®¤è¯ä¿¡æ¯ï¼ŒåŒæ—¶æ”¯æŒCAè¯ä¹¦å’Œbearer tokençš„è®¤è¯æ–¹å¼ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html&#34;&gt;ä½¿ç”¨kubeconfigæ–‡ä»¶é…ç½®è·¨é›†ç¾¤è®¤è¯&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»ˆç«¯ä¸‹kubectlå‘½ä»¤è‡ªåŠ¨è¡¥å…¨&#34;&gt;ç»ˆç«¯ä¸‹kubectlå‘½ä»¤è‡ªåŠ¨è¡¥å…¨&lt;/h2&gt;

&lt;p&gt;å»ºè®®ä½¿ç”¨&lt;a href=&#34;http://ohmyz.sh/&#34;&gt;oh-my-zsh&lt;/a&gt;ï¼Œå¢åŠ å¯¹kubectlå‘½ä»¤è‡ªåŠ¨è¡¥å…¨æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹&lt;code&gt;~/.zshrc&lt;/code&gt;æ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹ä¸¤è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;plugins=(kubectl)
source &amp;lt;(kubectl completion zsh)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿å­˜åé‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;a href=&#34;https://kubernetes.io/docs/tasks/tools/install-kubectl/#using-zsh&#34;&gt;Install and Set Up kubectl&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>é…ç½®Kubernetes DNSæœåŠ¡kube-dns</title>
      <link>https://jimmysong.io/blog/configuring-kubernetes-kube-dns/</link>
      <pubDate>Wed, 03 Jan 2018 16:16:01 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/configuring-kubernetes-kube-dns/</guid>
      <description>
        
        
        

&lt;p&gt;åœ¨æˆ‘ä»¬å®‰è£…Kubernetesé›†ç¾¤çš„æ—¶å€™å°±å·²ç»å®‰è£…äº†kube-dnsæ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶ä¹Ÿæ˜¯å®˜æ–¹æ¨èå®‰è£…çš„ã€‚é€šè¿‡å°† Service æ³¨å†Œåˆ° DNS ä¸­ï¼ŒKuberentes å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸€ç§ç®€å•çš„æœåŠ¡æ³¨å†Œå‘ç°ä¸è´Ÿè½½å‡è¡¡æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://coredns.io&#34;&gt;CoreDNS&lt;/a&gt;ä½œä¸ºCNCFä¸­çš„æ‰˜ç®¡çš„ä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨Kuberentes1.9ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨kubeadmæ–¹å¼å®‰è£…çš„é›†ç¾¤å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç›´æ¥å®‰è£…CoreDNSã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubeadm init --feature-gates=CoreDNS=true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨CoreDNSæ›¿æ¢Kubernetesæ’ä»¶kube-dnsï¼Œå¯ä»¥ä½¿ç”¨ Pod éƒ¨ç½²ä¹Ÿå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/coredns/&#34;&gt;Using CoreDNS for Service Discovery&lt;/a&gt;ï¼Œä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•é…ç½®kube-dnsã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡å·²å½’æ¡£åˆ°&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­ã€‚&lt;/p&gt;

&lt;h2 id=&#34;kube-dns&#34;&gt;kube-dns&lt;/h2&gt;

&lt;p&gt;kube-dnsæ˜¯Kubernetesä¸­çš„ä¸€ä¸ªå†…ç½®æ’ä»¶ï¼Œç›®å‰ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¼€æºé¡¹ç›®ç»´æŠ¤ï¼Œè§&lt;a href=&#34;https://github.com/kubernetes/dnsã€‚&#34;&gt;https://github.com/kubernetes/dnsã€‚&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹æ–‡ä¸­ç»™å‡ºäº†é…ç½® DNS Pod çš„æç¤ºå’Œå®šä¹‰ DNS è§£æè¿‡ç¨‹ä»¥åŠè¯Šæ–­ DNS é—®é¢˜çš„æŒ‡å—ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‰æè¦æ±‚&#34;&gt;å‰æè¦æ±‚&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetes 1.6 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å¿…é¡»ä½¿ç”¨ &lt;code&gt;kube-dns&lt;/code&gt; æ’ä»¶è¿›è¡Œé…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;kube-dns-ä»‹ç»&#34;&gt;kube-dns ä»‹ç»&lt;/h2&gt;

&lt;p&gt;ä» Kubernetes v1.3 ç‰ˆæœ¬å¼€å§‹ï¼Œä½¿ç”¨ [cluster add-on æ’ä»¶ç®¡ç†å™¨å›è‡ªåŠ¨å¯åŠ¨å†…ç½®çš„ DNSã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes DNS pod ä¸­åŒ…æ‹¬ 3 ä¸ªå®¹å™¨ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kubedns&lt;/code&gt;ï¼š&lt;code&gt;kubedns&lt;/code&gt; è¿›ç¨‹ç›‘è§† Kubernetes master ä¸­çš„ Service å’Œ Endpoint çš„å˜åŒ–ï¼Œå¹¶ç»´æŠ¤å†…å­˜æŸ¥æ‰¾ç»“æ„æ¥æœåŠ¡DNSè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dnsmasq&lt;/code&gt;ï¼š&lt;code&gt;dnsmasq&lt;/code&gt; å®¹å™¨æ·»åŠ  DNS ç¼“å­˜ä»¥æé«˜æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sidecar&lt;/code&gt;ï¼š&lt;code&gt;sidecar&lt;/code&gt; å®¹å™¨åœ¨æ‰§è¡ŒåŒé‡å¥åº·æ£€æŸ¥ï¼ˆé’ˆå¯¹ &lt;code&gt;dnsmasq&lt;/code&gt; å’Œ &lt;code&gt;kubedns&lt;/code&gt;ï¼‰æ—¶æä¾›å•ä¸ªå¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆç›‘å¬åœ¨10054ç«¯å£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;DNS  pod å…·æœ‰é™æ€ IP å¹¶ä½œä¸º Kubernetes æœåŠ¡æš´éœ²å‡ºæ¥ã€‚è¯¥é™æ€ IP åˆ†é…åï¼Œkubelet ä¼šå°†ä½¿ç”¨ &lt;code&gt;--cluster-dns = &amp;lt;dns-service-ip&amp;gt;&lt;/code&gt; æ ‡å¿—é…ç½®çš„ DNS ä¼ é€’ç»™æ¯ä¸ªå®¹å™¨ã€‚&lt;/p&gt;

&lt;p&gt;DNS åç§°ä¹Ÿéœ€è¦åŸŸåã€‚æœ¬åœ°åŸŸå¯ä»¥ä½¿ç”¨æ ‡å¿— &lt;code&gt;--cluster-domain = &amp;lt;default-local-domain&amp;gt;&lt;/code&gt; åœ¨ kubelet ä¸­é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesé›†ç¾¤DNSæœåŠ¡å™¨åŸºäº &lt;a href=&#34;https://github.com/skynetservices/skydns&#34;&gt;SkyDNS&lt;/a&gt; åº“ã€‚å®ƒæ”¯æŒæ­£å‘æŸ¥æ‰¾ï¼ˆA è®°å½•ï¼‰ï¼ŒæœåŠ¡æŸ¥æ‰¾ï¼ˆSRV è®°å½•ï¼‰å’Œåå‘ IP åœ°å€æŸ¥æ‰¾ï¼ˆPTR è®°å½•ï¼‰&lt;/p&gt;

&lt;h2 id=&#34;kube-dns-æ”¯æŒçš„-dns-æ ¼å¼&#34;&gt;kube-dns æ”¯æŒçš„ DNS æ ¼å¼&lt;/h2&gt;

&lt;p&gt;kube-dns å°†åˆ†åˆ«ä¸º service å’Œ pod ç”Ÿæˆä¸åŒæ ¼å¼çš„ DNS è®°å½•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Aè®°å½•ï¼šç”Ÿæˆ&lt;code&gt;my-svc.my-namespace.svc.cluster.local&lt;/code&gt;åŸŸåï¼Œè§£ææˆ IP åœ°å€ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š

&lt;ul&gt;
&lt;li&gt;æ™®é€š Serviceï¼šè§£ææˆ ClusterIP&lt;/li&gt;
&lt;li&gt;Headless Serviceï¼šè§£æä¸ºæŒ‡å®š Pod çš„ IP åˆ—è¡¨&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;SRVè®°å½•ï¼šä¸ºå‘½åçš„ç«¯å£ï¼ˆæ™®é€š Service æˆ– Headless Serviceï¼‰ç”Ÿæˆ &lt;code&gt;_my-port-name._my-port-protocol.my-svc.my-namespace.svc.cluster.local&lt;/code&gt; çš„åŸŸå&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Pod&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Aè®°å½•ï¼šç”ŸæˆåŸŸå &lt;code&gt;pod-ip.my-namespace.pod.cluster.local&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;kube-dns-å­˜æ ¹åŸŸå&#34;&gt;kube-dns å­˜æ ¹åŸŸå&lt;/h2&gt;

&lt;p&gt;å¯ä»¥åœ¨ Pod ä¸­æŒ‡å®š hostname å’Œ subdomainï¼š&lt;code&gt;hostname.custom-subdomain.default.svc.cluster.local&lt;/code&gt;ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: busybox
  labels:
    name: busybox
spec:
  hostname: busybox-1
  subdomain: busybox-subdomain
  containers:
  name: busybox
  - image: busybox
    command:
    - sleep
    - &amp;quot;3600&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥ Pod çš„åŸŸåæ˜¯ &lt;code&gt;busybox-1.busybox-subdomain.default.svc.cluster.local&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»§æ‰¿èŠ‚ç‚¹çš„-dns&#34;&gt;ç»§æ‰¿èŠ‚ç‚¹çš„ DNS&lt;/h2&gt;

&lt;p&gt;è¿è¡Œ Pod æ—¶ï¼Œkubelet å°†é¢„å…ˆé…ç½®é›†ç¾¤ DNS æœåŠ¡å™¨åˆ° Pod ä¸­ï¼Œå¹¶æœç´¢èŠ‚ç‚¹è‡ªå·±çš„ DNS è®¾ç½®è·¯å¾„ã€‚å¦‚æœèŠ‚ç‚¹èƒ½å¤Ÿè§£æç‰¹å®šäºè¾ƒå¤§ç¯å¢ƒçš„ DNS åç§°ï¼Œé‚£ä¹ˆ Pod åº”è¯¥ä¹Ÿèƒ½å¤Ÿè§£æã€‚è¯·å‚é˜…ä¸‹é¢çš„&lt;a href=&#34;#known-issues&#34;&gt;å·²çŸ¥é—®é¢˜&lt;/a&gt;ä»¥äº†è§£è­¦å‘Šã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ‚¨ä¸æƒ³è¦è¿™ä¸ªï¼Œæˆ–è€…æ‚¨æƒ³è¦ä¸º Pod è®¾ç½®ä¸åŒçš„ DNS é…ç½®ï¼Œæ‚¨å¯ä»¥ç»™ kubelet æŒ‡å®š &lt;code&gt;--resolv-conf&lt;/code&gt; æ ‡å¿—ã€‚å°†è¯¥å€¼è®¾ç½®ä¸º &amp;ldquo;&amp;rdquo; æ„å‘³ç€ Pod ä¸ç»§æ‰¿ DNSã€‚å°†å…¶è®¾ç½®ä¸ºæœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„æ„å‘³ç€ kubelet å°†ä½¿ç”¨æ­¤æ–‡ä»¶è€Œä¸æ˜¯ &lt;code&gt;/etc/resolv.conf&lt;/code&gt; ç”¨äº DNS ç»§æ‰¿ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®å­˜æ ¹åŸŸå’Œä¸Šæ¸¸-dns-æœåŠ¡å™¨&#34;&gt;é…ç½®å­˜æ ¹åŸŸå’Œä¸Šæ¸¸ DNS æœåŠ¡å™¨&lt;/h2&gt;

&lt;p&gt;é€šè¿‡ä¸º kube-dns ï¼ˆ&lt;code&gt;kube-system:kube-dns&lt;/code&gt;ï¼‰æä¾›ä¸€ä¸ª ConfigMapï¼Œé›†ç¾¤ç®¡ç†å‘˜èƒ½å¤ŸæŒ‡å®šè‡ªå®šä¹‰å­˜æ ¹åŸŸå’Œä¸Šæ¸¸ nameserverã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œä¸‹é¢çš„ ConfigMap å»ºç«‹äº†ä¸€ä¸ª DNS é…ç½®ï¼Œå®ƒå…·æœ‰ä¸€ä¸ªå•ç‹¬çš„å­˜æ ¹åŸŸå’Œä¸¤ä¸ªä¸Šæ¸¸ nameserverï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: kube-dns
  namespace: kube-system
data:
  stubDomains: |
    {â€œacme.localâ€: [â€œ1.2.3.4â€]}
  upstreamNameservers: |
    [â€œ8.8.8.8â€, â€œ8.8.4.4â€]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚ä¸Šé¢æŒ‡å®šçš„é‚£æ ·ï¼Œå¸¦æœ‰â€œ.acme.localâ€åç¼€çš„ DNS è¯·æ±‚è¢«è½¬å‘åˆ° 1.2.3.4 å¤„ç›‘å¬çš„ DNSã€‚Google Public DNS ä¸ºä¸Šæ¸¸æŸ¥è¯¢æä¾›æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹è¡¨æè¿°äº†å¦‚ä½•å°†å…·æœ‰ç‰¹å®šåŸŸåçš„æŸ¥è¯¢æ˜ å°„åˆ°å…¶ç›®æ ‡DNSæœåŠ¡å™¨ï¼š&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åŸŸå&lt;/th&gt;
&lt;th&gt;å“åº”æŸ¥è¯¢çš„æœåŠ¡å™¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.default.svc.cluster.local&lt;/td&gt;
&lt;td&gt;kube-dns&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;foo.acme.local&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰ DNS (1.2.3.4)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;widget.com&lt;/td&gt;
&lt;td&gt;ä¸Šæ¸¸ DNS (8.8.8.8 æˆ– 8.8.4.4)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;æŸ¥çœ‹ &lt;a href=&#34;#configmap-options&#34;&gt;ConfigMap é€‰é¡¹&lt;/a&gt; è·å–æ›´å¤šå…³äºé…ç½®é€‰é¡¹æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å¯¹-pod-çš„å½±å“&#34;&gt;å¯¹ Pod çš„å½±å“&lt;/h3&gt;

&lt;p&gt;è‡ªå®šä¹‰çš„ä¸Šæ¸¸åç§°æœåŠ¡å™¨å’Œå­˜æ ¹åŸŸä¸ä¼šå½±å“é‚£äº›å°†è‡ªå·±çš„ &lt;code&gt;dnsPolicy&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;Default&lt;/code&gt; æˆ–è€… &lt;code&gt;None&lt;/code&gt; çš„ Podã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœ Pod çš„ &lt;code&gt;dnsPolicy&lt;/code&gt; è®¾ç½®ä¸º â€œ&lt;code&gt;ClusterFirst&lt;/code&gt;â€ï¼Œåˆ™å…¶åç§°è§£æå°†æŒ‰å…¶ä»–æ–¹å¼å¤„ç†ï¼Œå…·ä½“å–å†³äºå­˜æ ¹åŸŸå’Œä¸Šæ¸¸ DNS æœåŠ¡å™¨çš„é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœªè¿›è¡Œè‡ªå®šä¹‰é…ç½®&lt;/strong&gt;ï¼šæ²¡æœ‰åŒ¹é…ä¸Šé…ç½®çš„é›†ç¾¤åŸŸååç¼€çš„ä»»ä½•è¯·æ±‚ï¼Œä¾‹å¦‚ â€œwww.kubernetes.ioâ€ï¼Œå°†ä¼šè¢«è½¬å‘åˆ°ç»§æ‰¿è‡ªèŠ‚ç‚¹çš„ä¸Šæ¸¸ nameserverã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¿›è¡Œè‡ªå®šä¹‰é…ç½®&lt;/strong&gt;ï¼šå¦‚æœé…ç½®äº†å­˜æ ¹åŸŸå’Œä¸Šæ¸¸ DNS æœåŠ¡å™¨ï¼ˆå’Œåœ¨ &lt;a href=&#34;#configuring-stub-domain-and-upstream-dns-servers&#34;&gt;å‰é¢ä¾‹å­&lt;/a&gt; é…ç½®çš„ä¸€æ ·ï¼‰ï¼ŒDNS æŸ¥è¯¢å°†æ ¹æ®ä¸‹é¢çš„æµç¨‹è¿›è¡Œè·¯ç”±ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;æŸ¥è¯¢é¦–å…ˆè¢«å‘é€åˆ° kube-dns ä¸­çš„ DNS ç¼“å­˜å±‚ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä»ç¼“å­˜å±‚ï¼Œæ£€æŸ¥è¯·æ±‚çš„åç¼€ï¼Œå¹¶è½¬å‘åˆ°åˆé€‚çš„ DNS ä¸Šï¼ŒåŸºäºå¦‚ä¸‹çš„ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;å…·æœ‰é›†ç¾¤åç¼€çš„åå­—&lt;/em&gt; ï¼ˆä¾‹å¦‚ â€œ.cluster.localâ€ï¼‰ï¼šè¯·æ±‚è¢«å‘é€åˆ° kube-dnsã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;å…·æœ‰å­˜æ ¹åŸŸåç¼€çš„åå­—&lt;/em&gt; ï¼ˆä¾‹å¦‚ â€œ.acme.localâ€ï¼‰ï¼šè¯·æ±‚è¢«å‘é€åˆ°é…ç½®çš„è‡ªå®šä¹‰ DNS è§£æå™¨ï¼ˆä¾‹å¦‚ï¼šç›‘å¬åœ¨ 1.2.3.4ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ä¸å…·æœ‰èƒ½åŒ¹é…ä¸Šåç¼€çš„åå­—&lt;/em&gt; ï¼ˆä¾‹å¦‚ â€œwidget.comâ€ï¼‰ï¼šè¯·æ±‚è¢«è½¬å‘åˆ°ä¸Šæ¸¸ DNSï¼ˆä¾‹å¦‚ï¼šGoogle å…¬å…± DNS æœåŠ¡å™¨ï¼Œ8.8.8.8 å’Œ 8.8.4.4ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&#34;https://d33wubrfki0l68.cloudfront.net/340889cb80e81dcd19a16bc34697a7907e2b229a/24ad0/docs/tasks/administer-cluster/dns-custom-nameservers/dns.png&#34; alt=&#34;DNS lookup flow&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;configmap-é€‰é¡¹&#34;&gt;ConfigMap é€‰é¡¹&lt;/h2&gt;

&lt;p&gt;kube-dns &lt;code&gt;kube-system:kube-dns&lt;/code&gt; ConfigMap çš„é€‰é¡¹å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;æ ¼å¼&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;stubDomains&lt;/code&gt;ï¼ˆå¯é€‰ï¼‰&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ DNS åç¼€ key çš„ JSON mapï¼ˆä¾‹å¦‚ â€œacme.localâ€ï¼‰ï¼Œä»¥åŠ DNS IP çš„ JSON æ•°ç»„ä½œä¸º valueã€‚&lt;/td&gt;
&lt;td&gt;ç›®æ ‡ nameserver å¯èƒ½æ˜¯ä¸€ä¸ª Kubernetes Serviceã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è¿è¡Œè‡ªå·±çš„ dnsmasq å‰¯æœ¬ï¼Œå°† DNS åå­—æš´éœ²åˆ° ClusterDNS namespace ä¸­ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;upstreamNameservers&lt;/code&gt;ï¼ˆå¯é€‰ï¼‰&lt;/td&gt;
&lt;td&gt;DNS IP çš„ JSON æ•°ç»„ã€‚&lt;/td&gt;
&lt;td&gt;æ³¨æ„ï¼šå¦‚æœæŒ‡å®šï¼Œåˆ™æŒ‡å®šçš„å€¼ä¼šæ›¿æ¢æ‰è¢«é»˜è®¤ä»èŠ‚ç‚¹çš„ &lt;code&gt;/etc/resolv.conf&lt;/code&gt; ä¸­è·å–åˆ°çš„ nameserverã€‚é™åˆ¶ï¼šæœ€å¤šå¯ä»¥æŒ‡å®šä¸‰ä¸ªä¸Šæ¸¸ nameserverã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;ç¤ºä¾‹&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;

&lt;h4 id=&#34;ç¤ºä¾‹-å­˜æ ¹åŸŸ&#34;&gt;ç¤ºä¾‹ï¼šå­˜æ ¹åŸŸ&lt;/h4&gt;

&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·æœ‰ä¸€ä¸ª Consul DNS æœåŠ¡å‘ç°ç³»ç»Ÿï¼Œä»–ä»¬å¸Œæœ›èƒ½å¤Ÿä¸ kube-dns é›†æˆèµ·æ¥ã€‚ Consul åŸŸåæœåŠ¡å™¨åœ°å€ä¸º 10.150.0.1ï¼Œæ‰€æœ‰çš„ Consul åå­—å…·æœ‰åç¼€ â€œ.consul.localâ€ã€‚ è¦é…ç½® Kubernetesï¼Œé›†ç¾¤ç®¡ç†å‘˜åªéœ€è¦ç®€å•åœ°åˆ›å»ºä¸€ä¸ª ConfigMap å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: kube-dns
  namespace: kube-system
data:
  stubDomains: |
    {â€œconsul.localâ€: [â€œ10.150.0.1â€]}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸å¸Œæœ›è¦†ç›–èŠ‚ç‚¹çš„ä¸Šæ¸¸ nameserverï¼Œæ‰€ä»¥ä»–ä»¬ä¸ä¼šæŒ‡å®šå¯é€‰çš„ &lt;code&gt;upstreamNameservers&lt;/code&gt; å­—æ®µã€‚&lt;/p&gt;

&lt;h4 id=&#34;ç¤ºä¾‹-ä¸Šæ¸¸-nameserver&#34;&gt;ç¤ºä¾‹ï¼šä¸Šæ¸¸ nameserver&lt;/h4&gt;

&lt;p&gt;åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸å¸Œæœ›æ˜¾å¼åœ°å¼ºåˆ¶æ‰€æœ‰éé›†ç¾¤ DNS æŸ¥è¯¢è¿›å…¥åˆ°ä»–ä»¬è‡ªå·±çš„ nameserver 172.16.0.1ã€‚ è€Œä¸”è¿™å¾ˆå®¹æ˜“å®ç°ï¼šä»–ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ª ConfigMapï¼Œ&lt;code&gt;upstreamNameservers&lt;/code&gt; å­—æ®µæŒ‡å®šæœŸæœ›çš„ nameserver å³å¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: kube-dns
  namespace: kube-system
data:
  upstreamNameservers: |
    [â€œ172.16.0.1â€]
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;è°ƒè¯•-dns-è§£æ&#34;&gt;è°ƒè¯• DNS è§£æ&lt;/h2&gt;

&lt;h3 id=&#34;åˆ›å»ºä¸€ä¸ªç®€å•çš„-pod-ç”¨ä½œæµ‹è¯•ç¯å¢ƒ&#34;&gt;åˆ›å»ºä¸€ä¸ªç®€å•çš„ Pod ç”¨ä½œæµ‹è¯•ç¯å¢ƒ&lt;/h3&gt;

&lt;p&gt;åˆ›å»ºä¸€ä¸ªåä¸º busybox.yaml çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: busybox
  namespace: default
spec:
  containers:
  - name: busybox
    image: busybox
    command:
      - sleep
      - &amp;quot;3600&amp;quot;
    imagePullPolicy: IfNotPresent
  restartPolicy: Always
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨è¯¥æ–‡ä»¶åˆ›å»º Pod å¹¶éªŒè¯å…¶çŠ¶æ€ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl create -f busybox.yaml
pod &amp;quot;busybox&amp;quot; created

$ kubectl get pods busybox
NAME      READY     STATUS    RESTARTS   AGE
busybox   1/1       Running   0          &amp;lt;some-time&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥ Pod è¿è¡Œåï¼Œæ‚¨å¯ä»¥åœ¨å®ƒçš„ç¯å¢ƒä¸­æ‰§è¡Œ &lt;code&gt;nslookup&lt;/code&gt;ã€‚å¦‚æœæ‚¨çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œè¡¨ç¤º DNS æ­£åœ¨æ­£ç¡®å·¥ä½œã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl exec -ti busybox -- nslookup kubernetes.default
Server:    10.0.0.10
Address 1: 10.0.0.10

Name:      kubernetes.default
Address 1: 10.0.0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœ &lt;code&gt;nslookup&lt;/code&gt; å‘½ä»¤å¤±è´¥ï¼Œæ£€æŸ¥å¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;h3 id=&#34;é¦–å…ˆæ£€æŸ¥æœ¬åœ°-dns-é…ç½®&#34;&gt;é¦–å…ˆæ£€æŸ¥æœ¬åœ° DNS é…ç½®&lt;/h3&gt;

&lt;p&gt;æŸ¥çœ‹ä¸‹ resolv.conf æ–‡ä»¶ã€‚ï¼ˆå‚è€ƒ&lt;a href=&#34;#inheriting-dns-from-the-node&#34;&gt;é›†æˆèŠ‚ç‚¹çš„ DNS&lt;/a&gt;å’Œ ä¸‹é¢çš„&lt;a href=&#34;#known-issues&#34;&gt;å·²çŸ¥é—®é¢˜&lt;/a&gt;è·å–æ›´å¤šä¿¡æ¯ï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl exec busybox cat /etc/resolv.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;éªŒè¯æœç´¢è·¯å¾„å’Œåç§°æœåŠ¡å™¨è®¾ç½®å¦‚ä¸‹ï¼ˆè¯·æ³¨æ„ï¼Œæœç´¢è·¯å¾„å¯èƒ½å› ä¸åŒçš„äº‘æä¾›å•†è€Œå¼‚ï¼‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;search default.svc.cluster.local svc.cluster.local cluster.local google.internal c.gce_project_id.internal
nameserver 10.0.0.10
options ndots:5
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœçœ‹åˆ°å¦‚ä¸‹é”™è¯¯è¡¨æ˜é”™è¯¯æ¥è‡ª kube-dns æˆ–ç›¸å…³æœåŠ¡ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl exec -ti busybox -- nslookup kubernetes.default
Server:    10.0.0.10
Address 1: 10.0.0.10

nslookup: can&#39;t resolve &#39;kubernetes.default&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ–è€…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl exec -ti busybox -- nslookup kubernetes.default
Server:    10.0.0.10
Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local

nslookup: can&#39;t resolve &#39;kubernetes.default&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æ£€æŸ¥-dns-pod-æ˜¯å¦åœ¨è¿è¡Œ&#34;&gt;æ£€æŸ¥ DNS pod æ˜¯å¦åœ¨è¿è¡Œ&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;kubectl get pods&lt;/code&gt; å‘½ä»¤éªŒè¯ DNS pod æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl get pods --namespace=kube-system -l k8s-app=kube-dns
NAME                    READY     STATUS    RESTARTS   AGE
...
kube-dns-v19-ezo1y      3/3       Running   0           1h
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæ‚¨çœ‹åˆ°æ²¡æœ‰ Pod è¿è¡Œæˆ–è€… Pod å¤„äº å¤±è´¥/å®Œæˆ çŠ¶æ€ï¼ŒDNS æ’ä»¶å¯èƒ½æ²¡æœ‰éƒ¨ç½²åˆ°æ‚¨çš„å½“å‰ç¯å¢ƒä¸­ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨éƒ¨ç½²ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ£€æŸ¥-dns-pod-ä¸­çš„é”™è¯¯&#34;&gt;æ£€æŸ¥ DNS pod ä¸­çš„é”™è¯¯&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;kubectl logs&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹ DNS å®ˆæŠ¤è¿›ç¨‹çš„æ—¥å¿—ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl logs --namespace=kube-system $(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns -o name) -c kubedns
$ kubectl logs --namespace=kube-system $(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns -o name) -c dnsmasq
$ kubectl logs --namespace=kube-system $(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns -o name) -c sidecar
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;çœ‹çœ‹æœ‰æ²¡æœ‰å¯ç–‘çš„æ—¥å¿—ã€‚ä»¥å­—æ¯â€œ&lt;code&gt;W&lt;/code&gt;â€ï¼Œâ€œ&lt;code&gt;E&lt;/code&gt;â€ï¼Œâ€œ&lt;code&gt;F&lt;/code&gt;â€å¼€å¤´çš„ä»£è¡¨è­¦å‘Šã€é”™è¯¯å’Œå¤±è´¥ã€‚è¯·æœç´¢å…·æœ‰è¿™äº›æ—¥å¿—çº§åˆ«çš„æ¡ç›®ï¼Œå¹¶ä½¿ç”¨ &lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues&#34;&gt;kubernetes issues&lt;/a&gt;æ¥æŠ¥å‘Šæ„å¤–é”™è¯¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;dns-æœåŠ¡å¯åŠ¨äº†å—&#34;&gt;DNS æœåŠ¡å¯åŠ¨äº†å—ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;kubectl get service&lt;/code&gt; å‘½ä»¤éªŒè¯ DNS æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl get svc --namespace=kube-system
NAME          CLUSTER-IP     EXTERNAL-IP   PORT(S)             AGE
...
kube-dns      10.0.0.10      &amp;lt;none&amp;gt;        53/UDP,53/TCP        1h
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæ‚¨å·²ç»åˆ›å»ºäº†è¯¥æœåŠ¡æˆ–å®ƒæœ¬åº”è¯¥é»˜è®¤åˆ›å»ºä½†æ²¡æœ‰å‡ºç°ï¼Œå‚è€ƒ&lt;a href=&#34;https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/&#34;&gt;è°ƒè¯•æœåŠ¡&lt;/a&gt;è·å–æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;dns-ç«¯ç‚¹æš´éœ²å‡ºæ¥äº†å—&#34;&gt;DNS ç«¯ç‚¹æš´éœ²å‡ºæ¥äº†å—ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æ‚¨å¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl get endpoints&lt;/code&gt;å‘½ä»¤éªŒè¯ DNS ç«¯ç‚¹æ˜¯å¦è¢«æš´éœ²ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ kubectl get ep kube-dns --namespace=kube-system
NAME       ENDPOINTS                       AGE
kube-dns   10.180.3.17:53,10.180.3.17:53    1h
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°ç«¯ç‚¹ï¼ŒæŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/&#34;&gt;è°ƒè¯•æœåŠ¡&lt;/a&gt;æ–‡æ¡£ä¸­çš„ç«¯ç‚¹éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;è·å–æ›´å¤šçš„ Kubernetes DNS ç¤ºä¾‹ï¼Œè¯·å‚è€ƒ Kubernetes GitHub ä»“åº“ä¸­çš„&lt;a href=&#34;https://github.com/kubernetes/examples/tree/master/staging/cluster-dns&#34;&gt;cluster-dnsç¤ºä¾‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å·²çŸ¥é—®é¢˜&#34;&gt;å·²çŸ¥é—®é¢˜&lt;/h2&gt;

&lt;p&gt;Kuberneteså®‰è£…æ—¶ä¸ä¼šå°†èŠ‚ç‚¹çš„ resolv.conf æ–‡ä»¶é…ç½®ä¸ºé»˜è®¤ä½¿ç”¨é›†ç¾¤ DNSï¼Œå› ä¸ºè¯¥è¿‡ç¨‹æœ¬èº«æ˜¯ç‰¹å®šäºå‘è¡Œç‰ˆçš„ã€‚è¿™ä¸€æ­¥åº”è¯¥æ”¾åˆ°æœ€åå®ç°ã€‚&lt;/p&gt;

&lt;p&gt;Linux çš„ libc ä¸å¯æ€è®®çš„å¡ä½ï¼ˆ&lt;a href=&#34;https://bugzilla.redhat.com/show_bug.cgi?id=168253&#34;&gt;æŸ¥çœ‹è¯¥2005å¹´èµ·æš´å‡ºæ¥çš„bug&lt;/a&gt;ï¼‰é™åˆ¶åªèƒ½æœ‰ 3 ä¸ª DNS &lt;code&gt;nameserver&lt;/code&gt; è®°å½•å’Œ 6 ä¸ª DNS &lt;code&gt;search&lt;/code&gt; è®°å½•ã€‚Kubernetes éœ€è¦æ¶ˆè€— 1 ä¸ª &lt;code&gt;nameserver&lt;/code&gt; è®°å½•å’Œ 3 ä¸ª &lt;code&gt;search&lt;/code&gt; è®°å½•ã€‚è¿™æ„å‘³ç€å¦‚æœæœ¬åœ°å®‰è£…å·²ç»ä½¿ç”¨ 3 ä¸ª &lt;code&gt;nameserver&lt;/code&gt; æˆ–ä½¿ç”¨ 3 ä¸ªä»¥ä¸Šçš„ &lt;code&gt;search&lt;/code&gt; è®°å½•ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€äº›è®¾ç½®å°†ä¼šä¸¢å¤±ã€‚æœ‰ä¸ªéƒ¨åˆ†è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•ï¼Œå°±æ˜¯èŠ‚ç‚¹å¯ä»¥è¿è¡Œ &lt;code&gt;dnsmasq&lt;/code&gt;ï¼Œå®ƒå°†æä¾›æ›´å¤šçš„ &lt;code&gt;nameserver&lt;/code&gt; æ¡ç›®ï¼Œä½†ä¸ä¼šæœ‰æ›´å¤šçš„ &lt;code&gt;search&lt;/code&gt; æ¡ç›®ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ kubelet çš„ &lt;code&gt;--resolv-conf&lt;/code&gt; æ ‡å¿—ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Alpine 3.3 æˆ–æ›´ä½ç‰ˆæœ¬ä½œä¸ºåŸºç¡€æ˜ åƒï¼Œç”±äºå·²çŸ¥çš„ Alpine é—®é¢˜ï¼ŒDNS å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚ç‚¹å‡»&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/30215&#34;&gt;è¿™é‡Œ&lt;/a&gt;æŸ¥çœ‹æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-é›†ç¾¤è”é‚¦-å¤šå¯ç”¨åŒºæ”¯æŒ&#34;&gt;Kubernetes é›†ç¾¤è”é‚¦ï¼ˆå¤šå¯ç”¨åŒºæ”¯æŒï¼‰&lt;/h2&gt;

&lt;p&gt;Kubernetes 1.3 ç‰ˆæœ¬èµ·å¼•å…¥äº†æ”¯æŒå¤šç«™ç‚¹ Kubernetes å®‰è£…çš„é›†ç¾¤è”é‚¦æ”¯æŒã€‚è¿™éœ€è¦å¯¹ Kubernetes é›†ç¾¤ DNS æœåŠ¡å™¨å¤„ç† DNS æŸ¥è¯¢çš„æ–¹å¼è¿›è¡Œä¸€äº›å°çš„ï¼ˆå‘åå…¼å®¹çš„ï¼‰æ›´æ”¹ï¼Œä»¥ä¾¿äºæŸ¥æ‰¾è”é‚¦æœåŠ¡ï¼ˆè·¨å¤šä¸ª Kubernetes é›†ç¾¤ï¼‰ã€‚æœ‰å…³é›†ç¾¤è”é‚¦å’Œå¤šç«™ç‚¹æ”¯æŒçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/federation/&#34;&gt;é›†ç¾¤è”é‚¦ç®¡ç†å‘˜æŒ‡å—&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/&#34;&gt;Configure DNS Service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/&#34;&gt;Service å’Œ Pod çš„ DNS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/dns-horizontal-autoscaling/&#34;&gt;è‡ªåŠ¨æ‰©å®¹é›†ç¾¤ä¸­çš„ DNS æœåŠ¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/coredns/&#34;&gt;Using CoreDNS for Service Discovery&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>ä»å¤–éƒ¨è®¿é—®Kubernetesä¸­çš„Pod</title>
      <link>https://jimmysong.io/blog/accessing-kubernetes-pods-from-outside-of-the-cluster/</link>
      <pubDate>Tue, 21 Nov 2017 20:13:01 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/accessing-kubernetes-pods-from-outside-of-the-cluster/</guid>
      <description>
        
        
        

&lt;p&gt;æœ¬æ–‡ä¸»è¦è®²è§£è®¿é—®kubenretesä¸­çš„Podå’ŒSerivceçš„å‡ ç§æ–¹å¼ï¼ŒåŒ…æ‹¬å¦‚ä¸‹å‡ ç§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;hostNetwork&lt;/li&gt;
&lt;li&gt;hostPort&lt;/li&gt;
&lt;li&gt;NodePort&lt;/li&gt;
&lt;li&gt;LoadBalancer&lt;/li&gt;
&lt;li&gt;Ingress&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¯´æ˜¯æš´éœ²Podå…¶å®è·Ÿæš´éœ²Serviceæ˜¯ä¸€å›äº‹ï¼Œå› ä¸ºPodå°±æ˜¯Serviceçš„backendã€‚&lt;/p&gt;

&lt;h2 id=&#34;hostnetwork-true&#34;&gt;hostNetwork: true&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ç§ç›´æ¥å®šä¹‰Podç½‘ç»œçš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœåœ¨Podä¸­ä½¿ç”¨&lt;code&gt;hostNetwork:true&lt;/code&gt;é…ç½®çš„è¯ï¼Œåœ¨è¿™ç§podä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥çœ‹åˆ°podå¯åŠ¨çš„ä¸»æœºçš„ç½‘ç»œæ¥å£ã€‚åœ¨ä¸»æœºçš„æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Šéƒ½å¯ä»¥è®¿é—®åˆ°è¯¥åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¸»æœºç½‘ç»œçš„podçš„ç¤ºä¾‹å®šä¹‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: influxdb
spec:
  hostNetwork: true
  containers:
    - name: influxdb
      image: influxdb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;éƒ¨ç½²è¯¥Podï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f influxdb-hostnetwork.yml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è®¿é—®è¯¥podæ‰€åœ¨ä¸»æœºçš„8086ç«¯å£ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;curl -v http://$POD_IP:8086/ping
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°†çœ‹åˆ°204 No Contentçš„204è¿”å›ç ï¼Œè¯´æ˜å¯ä»¥æ­£å¸¸è®¿é—®ã€‚&lt;/p&gt;

&lt;p&gt;æ³¨æ„æ¯æ¬¡å¯åŠ¨è¿™ä¸ªPodçš„æ—¶å€™éƒ½å¯èƒ½è¢«è°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰å¤–éƒ¨è®¿é—®Podçš„IPä¹Ÿæ˜¯å˜åŒ–çš„ï¼Œè€Œä¸”è°ƒåº¦Podçš„æ—¶å€™è¿˜éœ€è¦è€ƒè™‘æ˜¯å¦ä¸å®¿ä¸»æœºä¸Šçš„ç«¯å£å†²çªï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹é™¤éæ‚¨çŸ¥é“éœ€è¦æŸä¸ªç‰¹å®šåº”ç”¨å ç”¨ç‰¹å®šå®¿ä¸»æœºä¸Šçš„ç‰¹å®šç«¯å£æ—¶æ‰ä½¿ç”¨&lt;code&gt;hostNetwork: true&lt;/code&gt;çš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§Podçš„ç½‘ç»œæ¨¡å¼æœ‰ä¸€ä¸ªç”¨å¤„å°±æ˜¯å¯ä»¥å°†ç½‘ç»œæ’ä»¶åŒ…è£…åœ¨Podä¸­ç„¶åéƒ¨ç½²åœ¨æ¯ä¸ªå®¿ä¸»æœºä¸Šï¼Œè¿™æ ·è¯¥Podå°±å¯ä»¥æ§åˆ¶è¯¥å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰ç½‘ç»œã€‚&lt;/p&gt;

&lt;h2 id=&#34;hostport&#34;&gt;hostPort&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ç§ç›´æ¥å®šä¹‰Podç½‘ç»œçš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hostPort&lt;/code&gt;æ˜¯ç›´æ¥å°†å®¹å™¨çš„ç«¯å£ä¸æ‰€è°ƒåº¦çš„èŠ‚ç‚¹ä¸Šçš„ç«¯å£è·¯ç”±ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡å®¿ä¸»æœºçš„IPåŠ ä¸Š&lt;hostPort&gt;æ¥è®¿é—®Podäº†ï¼Œå¦‚&lt;hostIP&gt;:&lt;hostPort&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: influxdb
spec:
  containers:
    - name: influxdb
      image: influxdb
      ports:
        - containerPort: 8086
          hostPort: 8086
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·åšæœ‰ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºPodé‡æ–°è°ƒåº¦çš„æ—¶å€™è¯¥Podè¢«è°ƒåº¦åˆ°çš„å®¿ä¸»æœºå¯èƒ½ä¼šå˜åŠ¨ï¼Œè¿™æ ·&lt;hostIP&gt;å°±å˜åŒ–äº†ï¼Œç”¨æˆ·å¿…é¡»è‡ªå·±ç»´æŠ¤ä¸€ä¸ªPodä¸æ‰€åœ¨å®¿ä¸»æœºçš„å¯¹åº”å…³ç³»ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§ç½‘ç»œæ–¹å¼å¯ä»¥ç”¨æ¥åš nginx &lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers/nginx&#34;&gt;Ingress controller&lt;/a&gt;ã€‚å¤–éƒ¨æµé‡éƒ½éœ€è¦é€šè¿‡kubenretes nodeèŠ‚ç‚¹çš„80å’Œ443ç«¯å£ã€‚&lt;/p&gt;

&lt;h2 id=&#34;nodeport&#34;&gt;NodePort&lt;/h2&gt;

&lt;p&gt;NodePortåœ¨kubenretesé‡Œæ˜¯ä¸€ä¸ªå¹¿æ³›åº”ç”¨çš„æœåŠ¡æš´éœ²æ–¹å¼ã€‚Kubernetesä¸­çš„serviceé»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä½¿ç”¨çš„&lt;code&gt;ClusterIP&lt;/code&gt;è¿™ç§ç±»å‹ï¼Œè¿™æ ·çš„serviceä¼šäº§ç”Ÿä¸€ä¸ªClusterIPï¼Œè¿™ä¸ªIPåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œè¦æƒ³è®©å¤–éƒ¨èƒ½å¤Ÿç›´æ¥è®¿é—®serviceï¼Œéœ€è¦å°†service typeä¿®æ”¹ä¸º &lt;code&gt;nodePort&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: influxdb
  labels:
    name: influxdb
spec:
  containers:
    - name: influxdb
      image: influxdb
      ports:
        - containerPort: 8086
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åŒæ—¶è¿˜å¯ä»¥ç»™serviceæŒ‡å®šä¸€ä¸ª&lt;code&gt;nodePort&lt;/code&gt;å€¼ï¼ŒèŒƒå›´æ˜¯30000-32767ï¼Œè¿™ä¸ªå€¼åœ¨API serverçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç”¨&lt;code&gt;--service-node-port-range&lt;/code&gt;å®šä¹‰ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;kind: Service
apiVersion: v1
metadata:
  name: influxdb
spec:
  type: NodePort
  ports:
    - port: 8086
      nodePort: 30000
  selector:
    name: influxdb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é›†ç¾¤å¤–å°±å¯ä»¥ä½¿ç”¨kubernetesä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„IPåŠ ä¸Š30000ç«¯å£è®¿é—®è¯¥æœåŠ¡äº†ã€‚kube-proxyä¼šè‡ªåŠ¨å°†æµé‡ä»¥round-robinçš„æ–¹å¼è½¬å‘ç»™è¯¥serviceçš„æ¯ä¸€ä¸ªpodã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§æœåŠ¡æš´éœ²æ–¹å¼ï¼Œæ— æ³•è®©ä½ æŒ‡å®šè‡ªå·±æƒ³è¦çš„åº”ç”¨å¸¸ç”¨ç«¯å£ï¼Œä¸è¿‡å¯ä»¥åœ¨é›†ç¾¤ä¸Šå†éƒ¨ç½²ä¸€ä¸ªåå‘ä»£ç†ä½œä¸ºæµé‡å…¥å£ã€‚&lt;/p&gt;

&lt;h2 id=&#34;loadbalancer&#34;&gt;LoadBalancer&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;LoadBalancer&lt;/code&gt; åªèƒ½åœ¨serviceä¸Šå®šä¹‰ã€‚è¿™æ˜¯å…¬æœ‰äº‘æä¾›çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå¦‚AWSã€Azureã€CloudStackã€GCEç­‰ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;kind: Service
apiVersion: v1
metadata:
  name: influxdb
spec:
  type: LoadBalancer
  ports:
    - port: 8086
  selector:
    name: influxdb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹æœåŠ¡ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get svc influxdb
NAME       CLUSTER-IP     EXTERNAL-IP     PORT(S)          AGE
influxdb   10.97.121.42   10.13.242.236   8086:30051/TCP   39s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å†…éƒ¨å¯ä»¥ä½¿ç”¨ClusterIPåŠ ç«¯å£æ¥è®¿é—®æœåŠ¡ï¼Œå¦‚19.97.121.42:8086ã€‚&lt;/p&gt;

&lt;p&gt;å¤–éƒ¨å¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼è®¿é—®è¯¥æœåŠ¡ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä»»ä¸€èŠ‚ç‚¹çš„IPåŠ 30051ç«¯å£è®¿é—®è¯¥æœåŠ¡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;EXTERNAL-IP&lt;/code&gt;æ¥è®¿é—®ï¼Œè¿™æ˜¯ä¸€ä¸ªVIPï¼Œæ˜¯äº‘ä¾›åº”å•†æä¾›çš„è´Ÿè½½å‡è¡¡å™¨IPï¼Œå¦‚10.13.242.236:8086ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ingress&#34;&gt;Ingress&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;Ingress&lt;/code&gt;æ˜¯è‡ªkubernetes1.1ç‰ˆæœ¬åå¼•å…¥çš„èµ„æºç±»å‹ã€‚å¿…é¡»è¦éƒ¨ç½²&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers/nginx&#34;&gt;Ingress controller&lt;/a&gt;æ‰èƒ½åˆ›å»ºIngressèµ„æºï¼ŒIngress controlleræ˜¯ä»¥ä¸€ç§æ’ä»¶çš„å½¢å¼æä¾›ã€‚Ingress controller æ˜¯éƒ¨ç½²åœ¨Kubernetesä¹‹ä¸Šçš„Dockerå®¹å™¨ã€‚å®ƒçš„Dockeré•œåƒåŒ…å«ä¸€ä¸ªåƒnginxæˆ–HAProxyçš„è´Ÿè½½å‡è¡¡å™¨å’Œä¸€ä¸ªæ§åˆ¶å™¨å®ˆæŠ¤è¿›ç¨‹ã€‚æ§åˆ¶å™¨å®ˆæŠ¤ç¨‹åºä»Kubernetesæ¥æ”¶æ‰€éœ€çš„Ingressé…ç½®ã€‚å®ƒä¼šç”Ÿæˆä¸€ä¸ªnginxæˆ–HAProxyé…ç½®æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯åŠ¨è´Ÿè½½å¹³è¡¡å™¨è¿›ç¨‹ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚æ¢å¥è¯è¯´ï¼ŒIngress controlleræ˜¯ç”±Kubernetesç®¡ç†çš„è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes Ingressæä¾›äº†è´Ÿè½½å¹³è¡¡å™¨çš„å…¸å‹ç‰¹æ€§ï¼šHTTPè·¯ç”±ï¼Œç²˜æ€§ä¼šè¯ï¼ŒSSLç»ˆæ­¢ï¼ŒSSLç›´é€šï¼ŒTCPå’ŒUDPè´Ÿè½½å¹³è¡¡ç­‰ã€‚ç›®å‰å¹¶ä¸æ˜¯æ‰€æœ‰çš„Ingress controlleréƒ½å®ç°äº†è¿™äº›åŠŸèƒ½ï¼Œéœ€è¦æŸ¥çœ‹å…·ä½“çš„Ingress controlleræ–‡æ¡£ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: influxdb
spec:
  rules:
    - host: influxdb.kube.example.com
      http:
        paths:
          - backend:
              serviceName: influxdb
              servicePort: 8086
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¤–éƒ¨è®¿é—®URL &lt;a href=&#34;http://influxdb.kube.example.com/ping&#34;&gt;http://influxdb.kube.example.com/ping&lt;/a&gt; è®¿é—®è¯¥æœåŠ¡ï¼Œå…¥å£å°±æ˜¯80ç«¯å£ï¼Œç„¶åIngress controllerç›´æ¥å°†æµé‡è½¬å‘ç»™åç«¯Podï¼Œä¸éœ€å†ç»è¿‡kube-proxyçš„è½¬å‘ï¼Œæ¯”LoadBalanceræ–¹å¼æ›´é«˜æ•ˆã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æ€»çš„æ¥è¯´Ingressæ˜¯ä¸€ä¸ªéå¸¸çµæ´»å’Œè¶Šæ¥è¶Šå¾—åˆ°å‚å•†æ”¯æŒçš„æœåŠ¡æš´éœ²æ–¹å¼ï¼ŒåŒ…æ‹¬Nginxã€HAProxyã€Traefikï¼Œè¿˜æœ‰å„ç§Service Meshï¼Œè€Œå…¶å®ƒæœåŠ¡æš´éœ²æ–¹å¼å¯ä»¥æ›´é€‚ç”¨äºæœåŠ¡è°ƒè¯•ã€ç‰¹æ®Šåº”ç”¨çš„éƒ¨ç½²ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://alesnosek.com/blog/2017/02/14/accessing-kubernetes-pods-from-outside-of-the-cluster/&#34;&gt;Accessing Kubernetes Pods from Outside of the Cluster - alesnosek.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Helmå®‰è£…Nginx ingress</title>
      <link>https://jimmysong.io/blog/install-nginx-ingress-with-helm/</link>
      <pubDate>Fri, 27 Oct 2017 19:10:59 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/install-nginx-ingress-with-helm/</guid>
      <description>
        
        
        

&lt;h1 id=&#34;ä½¿ç”¨helmå®‰è£…nginx-ingress&#34;&gt;ä½¿ç”¨Helmå®‰è£…Nginx ingress&lt;/h1&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34;&gt;Nginx ingress&lt;/a&gt; ä½¿ç”¨ConfigMapæ¥ç®¡ç†Nginxé…ç½®ï¼Œnginxæ˜¯å¤§å®¶ç†ŸçŸ¥çš„ä»£ç†å’Œè´Ÿè½½å‡è¡¡è½¯ä»¶ï¼Œæ¯”èµ·&lt;a href=&#34;https://traefik.io&#34;&gt;Traefik&lt;/a&gt;æ¥è¯´åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;http://helm.sh&#34;&gt;helm&lt;/a&gt;æ¥éƒ¨ç½²ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/charts&#34;&gt;chart&lt;/a&gt;ä¿å­˜åœ¨ç§æœ‰çš„ä»“åº“ä¸­ï¼Œhelmå®‰è£…ä½¿ç”¨è§&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/practice/helm.html&#34;&gt;ä½¿ç”¨Helmç®¡ç†kubernetesåº”ç”¨&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å®‰è£…æ—¶éœ€è¦ç”¨åˆ°çš„é•œåƒæœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;sophos/nginx-vts-exporter:v0.6&lt;/li&gt;
&lt;li&gt;gcr.io/google_containers/nginx-ingress-controller:0.9.0-beta.15&lt;/li&gt;
&lt;li&gt;gcr.io/google_containers/defaultbackend:1.3&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;gcr.ioä¸­çš„é‚£ä¸ªä¸¤ä¸ªé•œåƒæˆ‘å¤åˆ¶äº†ä¸€ä»½åˆ°æ—¶é€Ÿäº‘ï¼Œå¯ä¾›å¤§å®¶ä¸‹è½½ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/defaultbackend:1.3&lt;/li&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/nginx-ingress-controller:0.9.0-beta.15&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Docker hubä¸Šçš„é‚£ä¸ªé•œåƒå¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œæ‰€æœ‰çš„å®‰è£…æ—¶éœ€è¦çš„é…ç½®ä¿å­˜åœ¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/blob/master/manifests/nginx-ingress&#34;&gt;../manifests/nginx-ingress&lt;/a&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…nginx-ingress chartåˆ°æœ¬åœ°repoä¸­&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹&lt;code&gt;values.yaml&lt;/code&gt;é…ç½®ï¼Œå¯ç”¨RBACæ”¯æŒï¼Œç›¸å…³é…ç½®è§&lt;a href=&#34;https://github.com/kubernetes/charts/tree/master/stable/nginx-ingress#configuration&#34;&gt;nginx-ingress chart&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;helm package .
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹niginx-ingress&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ helm search nginx-ingress
NAME                	VERSION	DESCRIPTION
local/nginx-ingress 	0.8.9  	An nginx Ingress controller that uses ConfigMap...
stable/nginx-ingress	0.8.9  	An nginx Ingress controller that uses ConfigMap...
stable/nginx-lego   	0.3.0  	Chart for nginx-ingress-controller and kube-lego
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä½¿ç”¨helméƒ¨ç½²nginx-ingress&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ helm install --name nginx-ingress local/nginx-ingress
NAME:   nginx-ingress
LAST DEPLOYED: Fri Oct 27 18:26:58 2017
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==&amp;gt; rbac.authorization.k8s.io/v1beta1/Role
NAME                         KIND
nginx-ingress-nginx-ingress  Role.v1beta1.rbac.authorization.k8s.io

==&amp;gt; rbac.authorization.k8s.io/v1beta1/RoleBinding
nginx-ingress-nginx-ingress  RoleBinding.v1beta1.rbac.authorization.k8s.io

==&amp;gt; v1/Service
NAME                                         CLUSTER-IP      EXTERNAL-IP  PORT(S)                     AGE
nginx-ingress-nginx-ingress-controller       10.254.100.108  &amp;lt;nodes&amp;gt;      80:30484/TCP,443:31053/TCP  1s
nginx-ingress-nginx-ingress-default-backend  10.254.58.156   &amp;lt;none&amp;gt;       80/TCP                      1s

==&amp;gt; extensions/v1beta1/Deployment
NAME                                         DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE
nginx-ingress-nginx-ingress-default-backend  1        1        1           0          1s
nginx-ingress-nginx-ingress-controller       1        1        1           0          1s

==&amp;gt; v1/ConfigMap
NAME                                    DATA  AGE
nginx-ingress-nginx-ingress-controller  1     1s

==&amp;gt; v1/ServiceAccount
NAME                         SECRETS  AGE
nginx-ingress-nginx-ingress  1        1s

==&amp;gt; rbac.authorization.k8s.io/v1beta1/ClusterRole
NAME                         KIND
nginx-ingress-nginx-ingress  ClusterRole.v1beta1.rbac.authorization.k8s.io

==&amp;gt; rbac.authorization.k8s.io/v1beta1/ClusterRoleBinding
nginx-ingress-nginx-ingress  ClusterRoleBinding.v1beta1.rbac.authorization.k8s.io


NOTES:
The nginx-ingress controller has been installed.
Get the application URL by running these commands:
  export HTTP_NODE_PORT=$(kubectl --namespace default get services -o jsonpath=&amp;quot;{.spec.ports[0].nodePort}&amp;quot; nginx-ingress-nginx-ingress-controller)
  export HTTPS_NODE_PORT=$(kubectl --namespace default get services -o jsonpath=&amp;quot;{.spec.ports[1].nodePort}&amp;quot; nginx-ingress-nginx-ingress-controller)
  export NODE_IP=$(kubectl --namespace default get nodes -o jsonpath=&amp;quot;{.items[0].status.addresses[1].address}&amp;quot;)

  echo &amp;quot;Visit http://$NODE_IP:$HTTP_NODE_PORT to access your application via HTTP.&amp;quot;
  echo &amp;quot;Visit https://$NODE_IP:$HTTPS_NODE_PORT to access your application via HTTPS.&amp;quot;

An example Ingress that makes use of the controller:

  apiVersion: extensions/v1beta1
  kind: Ingress
  metadata:
    annotations:
      kubernetes.io/ingress.class: nginx
    name: example
    namespace: foo
  spec:
    rules:
      - host: www.example.com
        http:
          paths:
            - backend:
                serviceName: exampleService
                servicePort: 80
              path: /
    # This section is only required if TLS is to be enabled for the Ingress
    tls:
        - hosts:
            - www.example.com
          secretName: example-tls

If TLS is enabled for the Ingress, a Secret containing the certificate and key must also be provided:

  apiVersion: v1
  kind: Secret
  metadata:
    name: example-tls
    namespace: foo
  data:
    tls.crt: &amp;lt;base64 encoded cert&amp;gt;
    tls.key: &amp;lt;base64 encoded key&amp;gt;
  type: kubernetes.io/tls
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è®¿é—®Nginx&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆè·å–Nginxçš„åœ°å€ï¼Œä»æˆ‘ä»¬ä½¿ç”¨helmå®‰è£…nginx-ingresså‘½ä»¤çš„è¾“å‡ºä¸­é‚£ä¸ªå¯ä»¥çœ‹åˆ°æç¤ºï¼Œæ ¹æ®æç¤ºæ‰§è¡Œå¯ä»¥çœ‹åˆ°nginxçš„httpå’Œhttpsåœ°å€ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;  export HTTP_NODE_PORT=$(kubectl --namespace default get services -o jsonpath=&amp;quot;{.spec.ports[0].nodePort}&amp;quot; nginx-ingress-nginx-ingress-controller)
  export HTTPS_NODE_PORT=$(kubectl --namespace default get services -o jsonpath=&amp;quot;{.spec.ports[1].nodePort}&amp;quot; nginx-ingress-nginx-ingress-controller)
  export NODE_IP=$(kubectl --namespace default get nodes -o jsonpath=&amp;quot;{.items[0].status.addresses[1].address}&amp;quot;)

  echo &amp;quot;Visit http://$NODE_IP:$HTTP_NODE_PORT to access your application via HTTP.&amp;quot;
  echo &amp;quot;Visit https://$NODE_IP:$HTTPS_NODE_PORT to access your application via HTTPS.&amp;quot;
  Visit http://172.20.0.113:30484 to access your application via HTTP.
  Visit https://172.20.0.113:31053 to access your application via HTTPS.
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;httpåœ°å€ï¼š&lt;a href=&#34;http://172.20.0.113:30484&#34;&gt;http://172.20.0.113:30484&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;httpsåœ°å€ï¼š&lt;a href=&#34;https://172.20.0.113:31053&#34;&gt;https://172.20.0.113:31053&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬åˆ†åˆ«åœ¨httpå’Œhttpsåœ°å€ä¸Šæµ‹è¯•ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/healthz&lt;/code&gt;è¿”å›200&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/&lt;/code&gt;è¿”å›404é”™è¯¯&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;curl -v http://172.20.0.113:30484/healthz
# è¿”å›200
curl -v http://172.20.0.113:30484/
# è¿”å›404
curl -v --insecure http://172.20.0.113:30484/healthz
# è¿”å›200
curl -v --insecure http://172.20.0.113:30484/
# è¿”å›404
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;åˆ é™¤nginx-ingress&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;helm delete --purge nginx-ingress
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;--purge&lt;/code&gt;å‚æ•°å¯ä»¥å½»åº•åˆ é™¤releaseä¸ç•™ä¸‹è®°å½•ï¼Œå¦åˆ™ä¸‹ä¸€æ¬¡éƒ¨ç½²çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨é‡åçš„releaseã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34;&gt;Ingress-nginx github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/charts/tree/master/stable/nginx-ingress&#34;&gt;Nginx chart configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/practice/helm.html&#34;&gt;ä½¿ç”¨Helmç®¡ç†kubernetesåº”ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>dockerç”¨æˆ·è¿‡æ¸¡åˆ°kubectlå‘½ä»¤è¡ŒæŒ‡å—</title>
      <link>https://jimmysong.io/blog/docker-cli-to-kubectl/</link>
      <pubDate>Sat, 16 Sep 2017 20:54:06 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-cli-to-kubectl/</guid>
      <description>
        
        
        

&lt;p&gt;å¯¹äºæ²¡æœ‰ä½¿ç”¨è¿‡ kubernetes çš„ docker ç”¨æˆ·ï¼Œå¦‚ä½•å¿«é€ŸæŒæ¡ kubectl å‘½ä»¤ï¼Ÿkubectl è·Ÿ docker å‘½ä»¤ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘ docker-cli ç”¨æˆ·ä»‹ç» Kubernetes å‘½ä»¤è¡Œå¦‚ä½•ä¸ api è¿›è¡Œäº¤äº’ã€‚è¯¥å‘½ä»¤è¡Œå·¥å…·â€”â€”kubectlï¼Œè¢«è®¾è®¡æˆ docker-cli ç”¨æˆ·æ‰€ç†Ÿæ‚‰çš„æ ·å­ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´åˆå­˜åœ¨ä¸€äº›å¿…è¦çš„å·®å¼‚ã€‚è¯¥æ–‡æ¡£å°†å‘æ‚¨å±•ç¤ºæ¯ä¸ª docker å­å‘½ä»¤å’Œ kubectl ä¸å…¶ç­‰æ•ˆçš„å‘½ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä½¿ç”¨ kubernetes é›†ç¾¤çš„æ—¶å€™ï¼Œdocker å‘½ä»¤é€šå¸¸æƒ…å†µæ˜¯ä¸éœ€è¦ç”¨åˆ°çš„ï¼Œåªæœ‰åœ¨è°ƒè¯•ç¨‹åºæˆ–è€…å®¹å™¨çš„æ—¶å€™ç”¨åˆ°ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä½¿ç”¨ kubectl å‘½ä»¤å³å¯ï¼Œæ‰€ä»¥åœ¨æ“ä½œ kubernetes çš„æ—¶å€™æˆ‘ä»¬æŠ›å¼ƒåŸå…ˆä½¿ç”¨ docker æ—¶çš„ä¸€äº›è§‚å¿µã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-run&#34;&gt;docker run&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è¿è¡Œä¸€ä¸ª nginx Deployment å¹¶å°†å…¶æš´éœ²å‡ºæ¥ï¼Ÿ æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl&#34;&gt;kubectl run&lt;/a&gt; ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker run -d --restart=always -e DOMAIN=cluster --name nginx-app -p 80:80 nginx
a9ec34d9878748d2f33dc20cb25c714ff21da8d40558b45bfaec9955859075d0
$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   2 seconds ago       Up 2 seconds        0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# start the pod running nginx
$ kubectl run --image=nginx nginx-app --port=80 --env=&amp;quot;DOMAIN=cluster&amp;quot;
deployment &amp;quot;nginx-app&amp;quot; created
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨å¤§äºç­‰äº 1.2 ç‰ˆæœ¬ Kubernetes é›†ç¾¤ä¸­ï¼Œä½¿ç”¨&lt;code&gt;kubectl run&lt;/code&gt; å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º &amp;ldquo;nginx-app&amp;rdquo; çš„ Deploymentã€‚å¦‚æœæ‚¨è¿è¡Œçš„æ˜¯è€ç‰ˆæœ¬ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ª replication controllerã€‚ å¦‚æœæ‚¨æƒ³æ²¿ç”¨æ—§çš„è¡Œä¸ºï¼Œä½¿ç”¨ &lt;code&gt;--generation=run/v1&lt;/code&gt; å‚æ•°ï¼Œè¿™æ ·å°±ä¼šåˆ›å»º replication controllerã€‚æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;&lt;code&gt;kubectl run&lt;/code&gt;&lt;/a&gt; è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# expose a port through with a service
$ kubectl expose deployment nginx-app --port=80 --name=nginx-http
service &amp;quot;nginx-http&amp;quot; exposed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ kubectl å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/deployment&#34;&gt;Deployment&lt;/a&gt;ï¼Œè¿™å°†ä¿è¯æœ‰ N ä¸ªè¿è¡Œ nginx çš„ podï¼ˆN ä»£è¡¨ spec ä¸­å£°æ˜çš„ replica æ•°ï¼Œé»˜è®¤ä¸º 1ï¼‰ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/user-guide/services&#34;&gt;service&lt;/a&gt;ï¼Œä½¿ç”¨ selector åŒ¹é…å…·æœ‰ç›¸åº”çš„ selector çš„ Deploymentã€‚æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/quick-start&#34;&gt;å¿«é€Ÿå¼€å§‹&lt;/a&gt; è·å–æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹é•œåƒä¼šåœ¨åå°è¿è¡Œï¼Œä¸&lt;code&gt;docker run -d ...&lt;/code&gt; ç±»ä¼¼ï¼Œå¦‚æœæ‚¨æƒ³åœ¨å‰å°è¿è¡Œï¼Œä½¿ç”¨ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl run [-i] [--tty] --attach &amp;lt;name&amp;gt; --image=&amp;lt;image&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸ &lt;code&gt;docker run ...&lt;/code&gt; ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæŒ‡å®šäº† &lt;code&gt;--attach&lt;/code&gt; ï¼Œæˆ‘ä»¬å°†è¿æ¥åˆ° &lt;code&gt;stdin&lt;/code&gt;ï¼Œ&lt;code&gt;stdout&lt;/code&gt; å’Œ &lt;code&gt;stderr&lt;/code&gt;ï¼Œè€Œä¸èƒ½æ§åˆ¶å…·ä½“è¿æ¥åˆ°å“ªä¸ªè¾“å‡ºæµï¼ˆ&lt;code&gt;docker -a ...&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ Deployment å¯åŠ¨äº†å®¹å™¨ï¼Œå¦‚æœæ‚¨ç»ˆæ­¢äº†è¿æ¥åˆ°çš„è¿›ç¨‹ï¼ˆä¾‹å¦‚ &lt;code&gt;ctrl-c&lt;/code&gt;ï¼‰ï¼Œå®¹å™¨å°†ä¼šé‡å¯ï¼Œè¿™è·Ÿ &lt;code&gt;docker run -it&lt;/code&gt;ä¸åŒã€‚ å¦‚æœæƒ³é”€æ¯è¯¥ Deploymentï¼ˆå’Œå®ƒçš„ podï¼‰ï¼Œæ‚¨éœ€è¦è¿è¡Œ &lt;code&gt;kubeclt delete deployment &amp;lt;name&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-ps&#34;&gt;docker ps&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•åˆ—å‡ºå“ªäº›æ­£åœ¨è¿è¡Œï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl&#34;&gt;kubectl get&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   About an hour ago   Up About an hour    0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get po
NAME              READY     STATUS    RESTARTS   AGE
nginx-app-5jyvm   1/1       Running   0          1h
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;docker-attach&#34;&gt;docker attach&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è¿æ¥åˆ°å·²ç»è¿è¡Œåœ¨å®¹å™¨ä¸­çš„è¿›ç¨‹ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl&#34;&gt;kubectl attach&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   8 minutes ago       Up 8 minutes        0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
$ docker attach a9ec34d98787
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get pods
NAME              READY     STATUS    RESTARTS   AGE
nginx-app-5jyvm   1/1       Running   0          10m
$ kubectl attach -it nginx-app-5jyvm
...
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;docker-exec&#34;&gt;docker exec&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl exec&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   8 minutes ago       Up 8 minutes        0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
$ docker exec a9ec34d98787 cat /etc/hostname
a9ec34d98787
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get po
NAME              READY     STATUS    RESTARTS   AGE
nginx-app-5jyvm   1/1       Running   0          10m
$ kubectl exec nginx-app-5jyvm -- cat /etc/hostname
nginx-app-5jyvm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œäº¤äº’å¼å‘½ä»¤æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker exec -ti a9ec34d98787 /bin/sh
# exit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl exec -ti nginx-app-5jyvm -- /bin/sh      
# exit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/tasks/kubectl/get-shell-running-container&#34;&gt;è·å–è¿è¡Œä¸­å®¹å™¨çš„ Shell ç¯å¢ƒ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-logs&#34;&gt;docker logs&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•æŸ¥çœ‹è¿è¡Œä¸­è¿›ç¨‹çš„ stdout/stderrï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl logs&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker logs -f a9e
192.168.9.1 - - [14/Jul/2015:01:04:02 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.35.0&amp;quot; &amp;quot;-&amp;quot;
192.168.9.1 - - [14/Jul/2015:01:04:03 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.35.0&amp;quot; &amp;quot;-&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl logs -f nginx-app-zibvs
10.240.63.110 - - [14/Jul/2015:01:09:01 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
10.240.63.110 - - [14/Jul/2015:01:09:02 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨æ˜¯æ—¶å€™æä¸€ä¸‹ pod å’Œå®¹å™¨ä¹‹é—´çš„ç»†å¾®å·®åˆ«äº†ï¼›é»˜è®¤æƒ…å†µä¸‹å¦‚æœ pod ä¸­çš„è¿›ç¨‹é€€å‡º pod ä¹Ÿä¸ä¼šç»ˆæ­¢ï¼Œç›¸åå®ƒå°†ä¼šé‡å¯è¯¥è¿›ç¨‹ã€‚è¿™ç±»ä¼¼äº docker run æ—¶çš„ &lt;code&gt;--restart=always&lt;/code&gt; é€‰é¡¹ï¼Œ è¿™æ˜¯ä¸»è¦å·®åˆ«ã€‚åœ¨ docker ä¸­ï¼Œè¿›ç¨‹çš„æ¯ä¸ªè°ƒç”¨çš„è¾“å‡ºéƒ½æ˜¯è¢«è¿æ¥èµ·æ¥çš„ï¼Œä½†æ˜¯å¯¹äº kubernetesï¼Œæ¯ä¸ªè°ƒç”¨éƒ½æ˜¯åˆ†å¼€çš„ã€‚è¦æŸ¥çœ‹ä»¥å‰åœ¨ kubernetes ä¸­æ‰§è¡Œçš„è¾“å‡ºï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl logs --previous nginx-app-zibvs
10.240.63.110 - - [14/Jul/2015:01:09:01 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
10.240.63.110 - - [14/Jul/2015:01:09:02 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/logging&#34;&gt;è®°å½•å’Œç›‘æ§é›†ç¾¤æ´»åŠ¨&lt;/a&gt; è·å–æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-stop-å’Œ-docker-rm&#34;&gt;docker stop å’Œ docker rm&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•åœæ­¢å’Œåˆ é™¤è¿è¡Œä¸­çš„è¿›ç¨‹ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl delete&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   22 hours ago        Up 22 hours         0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
$ docker stop a9ec34d98787
a9ec34d98787
$ docker rm a9ec34d98787
a9ec34d98787
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get deployment nginx-app
NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-app   1         1         1            1           2m
$ kubectl get po -l run=nginx-app
NAME                         READY     STATUS    RESTARTS   AGE
nginx-app-2883164633-aklf7   1/1       Running   0          2m
$ kubectl delete deployment nginx-app
deployment &amp;quot;nginx-app&amp;quot; deleted
$ kubectl get po -l run=nginx-app
# Return nothing
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ç›´æ¥åˆ é™¤ podã€‚ä½¿ç”¨ kubectl å‘½ä»¤ï¼Œæˆ‘ä»¬è¦åˆ é™¤æ‹¥æœ‰è¯¥ pod çš„ Deploymentã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥åˆ é™¤podï¼ŒDeployment å°†ä¼šé‡æ–°åˆ›å»ºè¯¥ podã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-login&#34;&gt;docker login&lt;/h4&gt;

&lt;p&gt;åœ¨ kubectl ä¸­æ²¡æœ‰å¯¹ &lt;code&gt;docker login&lt;/code&gt; çš„ç›´æ¥æ¨¡æ‹Ÿã€‚å¦‚æœæ‚¨æœ‰å…´è¶£åœ¨ç§æœ‰é•œåƒä»“åº“ä¸­ä½¿ç”¨ Kubernetesï¼Œè¯·å‚é˜… &lt;a href=&#34;https://kubernetes.io/docs/concepts/containers/images/#using-a-private-registry&#34;&gt;ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-version&#34;&gt;docker version&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç‰ˆæœ¬ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl version&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker version
Client version: 1.7.0
Client API version: 1.19
Go version (client): go1.4.2
Git commit (client): 0baf609
OS/Arch (client): linux/amd64
Server version: 1.7.0
Server API version: 1.19
Go version (server): go1.4.2
Git commit (server): 0baf609
OS/Arch (server): linux/amd64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl version
Client Version: version.Info{Major:&amp;quot;1&amp;quot;, Minor:&amp;quot;6&amp;quot;, GitVersion:&amp;quot;v1.6.9+a3d1dfa6f4335&amp;quot;, GitCommit:&amp;quot;9b77fed11a9843ce3780f70dd251e92901c43072&amp;quot;, GitTreeState:&amp;quot;dirty&amp;quot;, BuildDate:&amp;quot;2017-08-29T20:32:58Z&amp;quot;, OpenPaasKubernetesVersion:&amp;quot;v1.03.02&amp;quot;, GoVersion:&amp;quot;go1.7.5&amp;quot;, Compiler:&amp;quot;gc&amp;quot;, Platform:&amp;quot;linux/amd64&amp;quot;}
Server Version: version.Info{Major:&amp;quot;1&amp;quot;, Minor:&amp;quot;6&amp;quot;, GitVersion:&amp;quot;v1.6.9+a3d1dfa6f4335&amp;quot;, GitCommit:&amp;quot;9b77fed11a9843ce3780f70dd251e92901c43072&amp;quot;, GitTreeState:&amp;quot;dirty&amp;quot;, BuildDate:&amp;quot;2017-08-29T20:32:58Z&amp;quot;, OpenPaasKubernetesVersion:&amp;quot;v1.03.02&amp;quot;, GoVersion:&amp;quot;go1.7.5&amp;quot;, Compiler:&amp;quot;gc&amp;quot;, Platform:&amp;quot;linux/amd64&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;docker-info&#34;&gt;docker info&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è·å–æœ‰å…³ç¯å¢ƒå’Œé…ç½®çš„å„ç§ä¿¡æ¯ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl cluster-info&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker info
Containers: 40
Images: 168
Storage Driver: aufs
 Root Dir: /usr/local/google/docker/aufs
 Backing Filesystem: extfs
 Dirs: 248
 Dirperm1 Supported: false
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 3.13.0-53-generic
Operating System: Ubuntu 14.04.2 LTS
CPUs: 12
Total Memory: 31.32 GiB
Name: k8s-is-fun.mtv.corp.google.com
ID: ADUV:GCYR:B3VJ:HMPO:LNPQ:KD5S:YKFQ:76VN:IANZ:7TFV:ZBF4:BYJO
WARNING: No swap limit support
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl cluster-info
Kubernetes master is running at https://108.59.85.141
KubeDNS is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/kube-dns/proxy
KubeUI is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/kube-ui/proxy
Grafana is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy
Heapster is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/monitoring-heapster/proxy
InfluxDB is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/monitoring-influxdb/proxy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ¬æ–‡åŒæ—¶å½’æ¡£åˆ° &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/rootsongjc/kubernetes.github.io/blob/master/docs/user-guide/docker-cli-to-kubectl.md&#34;&gt;é˜…è¯»åŸæ–‡&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>æ¯ä½CTOéƒ½è¯¥çŸ¥é“çš„å…³äºKubernetesçš„ä¸‰ä»¶äº‹</title>
      <link>https://jimmysong.io/blog/3-things-every-cto-should-know-about-kubernetes/</link>
      <pubDate>Sun, 10 Sep 2017 16:43:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/3-things-every-cto-should-know-about-kubernetes/</guid>
      <description>
        
        
        

&lt;p&gt;Kubernetes æ˜¯ä¸€ä¸ªè‡ªåŠ¨å‘å¸ƒã€æ‰©ç¼©å®¹å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨çš„å¼€æºè½¯ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å°½ç®¡kuberneteséå¸¸å¼ºå¤§ï¼Œæœ‰å¦‚æ­¤å¤šæœ‰ç”¨çš„æŠ€æœ¯ç‰¹æ€§ï¼Œä½†æ˜¯å·¥å…·ä»æ¥éƒ½ä¸ä¼šè¢«éš”ç¦»èµ·æ¥å•ç‹¬ä½¿ç”¨ï¼Œè¿™è¦å–å†³ä¸åº•å±‚åŸºç¡€æ¶æ„ï¼Œä½¿ç”¨å®ƒçš„å›¢é˜Ÿç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å°†kubernetesåº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆå¦‚æœæƒ³æˆåŠŸçš„å¼•å…¥ç”Ÿäº§çš„è¯ï¼‰ä¹‹å‰ï¼Œæ¯ä¸ªCTOéƒ½åº”è¯¥äº†è§£è¿™ä¸‰ä»¶äº‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;1-ä½ éœ€è¦æœ‰åšå®çš„åŸºç¡€è®¾æ–½&#34;&gt;1. ä½ éœ€è¦æœ‰åšå®çš„åŸºç¡€è®¾æ–½&lt;/h3&gt;

&lt;p&gt;å¤§å¤šæ•°ç»„ç»‡åœ¨è¿è¡Œkubernetesæ—¶é‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯åœ¨å…¶ä¸‹è¿è¡Œçš„å¹³å°ã€‚æ— è®ºæ˜¯åŸºäºVMwareçš„ç§æœ‰äº‘è¿˜æ˜¯åƒAWSè¿™æ ·çš„å…¬å…±äº‘ï¼Œæ‚¨çš„å¹³å°éœ€è¦ç¨³å®šè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå¹¶ä¸”å…·å¤‡ä»¥ä¸‹åŸºç¡€è®¾æ–½åŸºç¡€çŸ¥è¯†ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é…ç½®ï¼šæ ¹æ®éœ€è¦åˆ›å»ºè™šæ‹Ÿæœºï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨è£¸æœº&lt;/li&gt;
&lt;li&gt;ç½‘ç»œï¼šDNSã€è´Ÿè½½å‡è¡¡ã€VPC/VLANã€é˜²ç«å¢™ã€å®‰å…¨ç»„ç­‰&lt;/li&gt;
&lt;li&gt;å­˜å‚¨ï¼šNFS/EFS/EBS/Cephç­‰ï¼Œé€šè¿‡APIåˆ›å»º&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœè¿™äº›åŸºç¡€è®¾æ–½å»ºè®¾ä¸åˆ°ä½ï¼Œé‚£ä¹ˆåœ¨å°è¯•éƒ¨ç½²å’Œè¿è¡Œkubernetesç¾¤é›†æ—¶ï¼Œæ‚¨å°†ä¼šé‡åˆ°è®¸å¤šé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ®ç»éªŒï¼Œæˆ‘ä»¬é€šå¸¸å‘å®¢æˆ·æ¨èä»åƒAWSè¿™æ ·çš„å…¬å…±äº‘æä¾›å•†å¼€å§‹ï¼Œç„¶åé…å¤‡äº†ä¸€äº›Hashicorpå·¥å…·ï¼Œå¦‚Terraformå’ŒPackerï¼Œä»¥å®ç°åšå®çš„åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;

&lt;h3 id=&#34;2-æ‚¨éœ€è¦æ‰“é€ ä¸€æ”¯å¼ºå¤§çš„å›¢é˜Ÿ&#34;&gt;2. æ‚¨éœ€è¦æ‰“é€ ä¸€æ”¯å¼ºå¤§çš„å›¢é˜Ÿ&lt;/h3&gt;

&lt;p&gt;è®©ä¼ä¸šå†…éƒ¨å®ç°å®¹å™¨ç¼–æ’çš„èƒ½åŠ›å¾ˆä¸€ä¸ªå¾ˆæœ‰æŒ‘æˆ˜çš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;æ‰“é€ æ˜¯ä¸€ä¸ªå…¨é¢çš„å›¢é˜Ÿï¼ŒåŒ…æ‹¬ä¸€äº›å…·æœ‰éå¸¸å¼ºå¤§çš„OpsèƒŒæ™¯çš„æˆå‘˜ï¼Œå¯ä»¥è®©ä»–ä»¬å»è°ƒè¯•ä¸€äº›åº•å±‚çš„ä¸œè¥¿ï¼Œè¿˜æœ‰ä¸€äº›è‡ªåŠ¨åŒ–å·¥ç¨‹å¸ˆå°†è´Ÿè´£è®¾ç½®å’Œé›†ç¾¤ç®¡ç†çš„æ—¥å¸¸å·¥ä½œï¼Œæ›´å¤šçš„ç ”ç©¶äººå‘˜å°†ç¡®ä¿CI/CDæµæ°´çº¿é¡ºåˆ©è¿è¡Œä»¥ä¿è¯å¼€å‘äººå‘˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä½“éªŒã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯æ„å»ºå›¢é˜Ÿçš„å‡ ä¸ªå»ºè®®ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ‰¾åˆ°å·²ç»åœ¨å°è¯•ä½¿ç”¨å®¹å™¨çš„å›¢é˜Ÿï¼Œä¹Ÿè®¸ä»–ä»¬ä»¥å‰ç”¨è¿‡Docker Swarmæˆ–Rancherã€‚ä»–ä»¬å¯èƒ½å·²ç»æ¸´æœ›ä½¿ç”¨Kubernetesï¼Œå¹¶ä¸”æ„¿æ„åŠªåŠ›å®æ–½ã€‚&lt;/li&gt;
&lt;li&gt;ç»™æ‚¨çš„å¼€å‘å’Œè¿ç»´å›¢é˜Ÿåšå…³äºå®¹å™¨å’Œå®¹å™¨ç¼–æ’æ–¹é¢çš„åŸ¹è®­ã€‚&lt;/li&gt;
&lt;li&gt;è˜è¯·æ–°äººæ‰ã€‚æœ‰æ—¶å€™ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯å»ºç«‹ä¸€ä¸ªå…¨æ–°çš„å›¢é˜Ÿï¼Œè¿™æ ·ä»–ä»¬å°±ä¸ä¼šè¢«å½“å‰æµç¨‹æ‰€æ·¹æ²¡ï¼Œè¿˜å¯ä»¥å‘å…¶ä»–å›¢é˜Ÿå±•ç¤ºæœªæ¥çš„æ ·å­ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;3-ä¾æ‰˜ç¤¾åŒº&#34;&gt;3. ä¾æ‰˜ç¤¾åŒº&lt;/h3&gt;

&lt;p&gt;Kubernetesèƒ½å¤Ÿåä¸Šäº†å®¹å™¨ç¼–æ’ç³»ç»Ÿçš„å¤´æŠŠäº¤æ¤…çš„ä¸»è¦åŸå› æ˜¯ç¤¾åŒºçš„æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesæœ€åˆæ˜¯åŸºäºGoogleçš„borgï¼Œborgå…·æœ‰éå¸¸ä¸°å¯Œçš„åŠŸèƒ½é›†ï¼Œç°åœ¨å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æ¡†æ¶â€”â€”è¿™å¯¹kubernetesæ¥è¯´æ˜¯éå¸¸æœ‰åˆ©çš„ ï¼Œä½†å…¶æˆåŠŸçš„ä¸»è¦åŸå› æ˜¯å·²ç»å½¢æˆäº†ç§¯ææ”¯æŒå®ƒçš„ç¤¾åŒºã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ä¸€äº›å…³äºå¦‚ä½•å‚ä¸ç¤¾åŒºçš„å°è´´å£«ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åŠ å…¥kubernetes slack channelï¼Œç°åœ¨é‡Œé¢å·²ç»æœ‰21,000äººï¼Œ&lt;a href=&#34;http://slack.k8s.io&#34;&gt;http://slack.k8s.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å‚ä¸ä¸€ä¸ªSIGï¼ˆç‰¹åˆ«å…´è¶£å°ç»„ï¼‰ï¼Œè¿™é‡Œé¢åŒ…æ‹¬ä»åœ¨AWSä¸Šè¿è¡Œkubernetesåˆ°ç®¡ç†å¤§æ•°æ®é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.meetup.com/topics/kubernetes/&#34;&gt;å‚åŠ meetup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://twitter.com/hashtag/kubernetes&#34;&gt;å…³æ³¨#kubernetes&lt;/a&gt; å…³æ³¨é‚£äº›ä¸»æµä¼ é“è€…ï¼Œæœ‰ä¸ªäººè¦ç‰¹åˆ«å…³æ³¨ä¸‹é‚£å°±æ˜¯&lt;a href=&#34;https://twitter.com/kelseyhightower&#34;&gt;Kelsey Hightower&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;èµ°å‘æˆåŠŸ&#34;&gt;èµ°å‘æˆåŠŸ&lt;/h3&gt;

&lt;p&gt;åœ¨æ‹¥æœ‰äº†åšå¦‚ç£çŸ³çš„å¹³å°ï¼Œç†Ÿç»ƒå’Œå¤šæ ·åŒ–çš„å›¢é˜Ÿï¼Œä»¥åŠä¸Kubernetesç¤¾åŒºä¸æ–­å¢é•¿çš„å…³ç³»åï¼Œæ‚¨å°†æœ‰å¤„ç†é€šå‘æˆåŠŸé“è·¯ä¸Šçš„é‡åˆ°çš„ä»»ä½•é—®é¢˜çš„èµ„æœ¬ï¼Œå…‹æœæˆé•¿è¿‡ç¨‹ä¸­çš„ç—›è‹¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.contino.io/insights/3-things-every-cto-should-know-about-kubernets&#34;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä½œè€…: Marcus Maxwell&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>é€‚ç”¨äºkubernetesçš„åº”ç”¨å¼€å‘ä¸éƒ¨ç½²æµç¨‹è¯¦è§£</title>
      <link>https://jimmysong.io/blog/deploy-applications-in-kubernetes/</link>
      <pubDate>Thu, 20 Jul 2017 19:41:53 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/deploy-applications-in-kubernetes/</guid>
      <description>
        
        
        

&lt;p&gt;æœ¬æ–‡å·²å½’æ¡£åœ¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­çš„ç¬¬3ç« ã€ç”¨æˆ·æŒ‡å—ã€‘ä¸­ï¼Œä¸€åˆ‡æ›´æ–°ä»¥kubernetes-handbookä¸­ä¸ºå‡†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†è¯¦ç»†è¯´æ˜ï¼Œæˆ‘ç‰¹æ„å†™äº†ä¸¤ä¸ªç¤ºä¾‹ç¨‹åºæ”¾åœ¨GitHubä¸­ï¼Œæ¨¡æ‹Ÿåº”ç”¨å¼€å‘æµç¨‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-test&#34;&gt;k8s-app-monitor-test&lt;/a&gt;ï¼šç”Ÿæˆæ¨¡æ‹Ÿçš„ç›‘æ§æ•°æ®ï¼Œå‘é€httpè¯·æ±‚ï¼Œè·å–jsonè¿”å›å€¼&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-agent&#34;&gt;K8s-app-monitor-agent&lt;/a&gt;ï¼šè·å–ç›‘æ§æ•°æ®å¹¶ç»˜å›¾ï¼Œè®¿é—®æµè§ˆå™¨è·å–å›¾è¡¨&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;APIæ–‡æ¡£è§&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-test&#34;&gt;k8s-app-monitor-test&lt;/a&gt;ä¸­çš„&lt;code&gt;api.html&lt;/code&gt;æ–‡ä»¶ï¼Œè¯¥æ–‡æ¡£åœ¨API blueprintä¸­å®šä¹‰ï¼Œä½¿ç”¨&lt;a href=&#34;https://github.com/danielgtaylor/aglio&#34;&gt;aglio&lt;/a&gt;ç”Ÿæˆï¼Œæ‰“å¼€åå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/k8s-app-monitor-test-api-doc.jpg&#34; alt=&#34;APIæ–‡æ¡£&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å…³äºæœåŠ¡å‘ç°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;K8s-app-monitor-agent&lt;/code&gt;æœåŠ¡éœ€è¦è®¿é—®&lt;code&gt;k8s-app-monitor-test&lt;/code&gt;æœåŠ¡ï¼Œè¿™å°±æ¶‰åŠåˆ°æœåŠ¡å‘ç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥å†™æ­»äº†è¦è®¿é—®çš„æœåŠ¡çš„å†…ç½‘DNSåœ°å€ï¼ˆkubednsä¸­çš„åœ°å€ï¼Œå³&lt;code&gt;k8s-app-monitor-test.default.svc.cluster.local&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çŸ¥é“Kubernetesåœ¨å¯åŠ¨Podçš„æ—¶å€™ä¸ºå®¹å™¨æ³¨å…¥ç¯å¢ƒå˜é‡ï¼Œè¿™äº›ç¯å¢ƒå˜é‡åœ¨æ‰€æœ‰çš„ namespace ä¸­å…±äº«ï¼ˆç¯å¢ƒå˜é‡æ˜¯ä¸æ–­è¿½åŠ çš„ï¼Œæ–°å¯åŠ¨çš„Podä¸­å°†æ‹¥æœ‰è€çš„Podä¸­æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼Œè€Œè€çš„Podä¸­çš„ç¯å¢ƒå˜é‡ä¸å˜ï¼‰ã€‚ä½†æ˜¯æ—¢ç„¶ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡å°±å·²ç»å¯ä»¥è®¿é—®åˆ°å¯¹åº”çš„serviceï¼Œé‚£ä¹ˆè·å–åº”ç”¨çš„åœ°å€ä¿¡æ¯ï¼Œç©¶ç«Ÿæ˜¯ä½¿ç”¨å˜é‡å‘¢ï¼Ÿè¿˜æ˜¯ç›´æ¥ä½¿ç”¨DNSè§£ææ¥å‘ç°ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ç­”æ¡ˆæ˜¯ä½¿ç”¨DNSï¼Œè¯¦ç»†è¯´æ˜è§&lt;a href=&#34;https://jimmysong.io/posts/exploring-kubernetes-env-with-docker/&#34;&gt;Kubernetesä¸­çš„æœåŠ¡å‘ç°ä¸Dockerå®¹å™¨é—´çš„ç¯å¢ƒå˜é‡ä¼ é€’æºç æ¢ç©¶&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ‰“åŒ…é•œåƒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å› ä¸ºæˆ‘ä½¿ç”¨werckerè‡ªåŠ¨æ„å»ºï¼Œæ„å»ºå®Œæˆåè‡ªåŠ¨æ‰“åŒ…æˆdockeré•œåƒå¹¶ä¸Šä¼ åˆ°docker hubä¸­ï¼ˆéœ€è¦æå‰åœ¨docker hubä¸­åˆ›å»ºrepoï¼‰ï¼Œå¦‚ä½•ä½¿ç”¨ wercker åšæŒç»­æ„å»ºä¸å‘å¸ƒï¼Œå¹¶é›†æˆdocker hubæ’ä»¶è¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/posts/continuous-integration-with-wercker/&#34;&gt;ä½¿ç”¨Werckerè¿›è¡ŒæŒç»­æ„å»ºä¸å‘å¸ƒ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://app.wercker.com/jimmysong/k8s-app-monitor-agent/&#34;&gt;æŸ¥çœ‹è¯¦ç»†æ„å»ºæµç¨‹&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/k8s-app-monitor-agent-wercker.jpg&#34; alt=&#34;wercker&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç”Ÿæˆäº†å¦‚ä¸‹ä¸¤ä¸ªdockeré•œåƒï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;jimmysong/k8s-app-monitor-test:latest&lt;/li&gt;
&lt;li&gt;jimmysong/k8s-app-monitor-agent:latest&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨æœåŠ¡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰çš„kubernetesåº”ç”¨å¯åŠ¨æ‰€ç”¨çš„yamlé…ç½®æ–‡ä»¶éƒ½ä¿å­˜åœ¨é‚£ä¸¤ä¸ªGitHubä»“åº“çš„&lt;code&gt;manifest.yaml&lt;/code&gt;æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†åˆ«åœ¨ä¸¤ä¸ªGitHubç›®å½•ä¸‹æ‰§è¡Œ&lt;code&gt;kubectl create -f manifest.yaml&lt;/code&gt;å³å¯å¯åŠ¨æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¤–éƒ¨è®¿é—®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœåŠ¡å¯åŠ¨åéœ€è¦æ›´æ–°ingressé…ç½®ï¼Œåœ¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/blob/master/manifests/traefik-ingress/ingress.yaml&#34;&gt;ingress.yaml&lt;/a&gt;æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å‡ è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;  - host: k8s-app-monitor-agent.jimmysong.io
    http:
      paths:
      - path: /
        backend:
          serviceName: k8s-app-monitor-agent
          servicePort: 8080
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿å­˜åï¼Œç„¶åæ‰§è¡Œ&lt;code&gt;kubectl replace -f ingress.yaml&lt;/code&gt;å³å¯åˆ·æ–°ingressã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹æœ¬æœºçš„&lt;code&gt;/etc/hosts&lt;/code&gt;æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åŠ å…¥ä»¥ä¸‹ä¸€è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;172.20.0.119 k8s-app-monitor-agent.jimmysong.io
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç„¶ä½ ä¹Ÿå¯ä»¥åŠ å…¥åˆ°DNSä¸­ï¼Œä¸ºäº†ç®€å•èµ·è§æˆ‘ä½¿ç”¨hostsã€‚&lt;/p&gt;

&lt;p&gt;è¯¦è§&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/blob/master/practice/edge-node-configuration.md&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—®&lt;a href=&#34;http://k8s-app-monitor-agent.jimmysong.io&#34;&gt;http://k8s-app-monitor-agent.jimmysong.io&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/k8s-app-monitor-agent.jpg&#34; alt=&#34;å›¾è¡¨&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ·æ–°é¡µé¢å°†è·å¾—æ–°çš„å›¾è¡¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/continuous-integration-with-wercker/&#34;&gt;ä½¿ç”¨Werckerè¿›è¡ŒæŒç»­æ„å»ºä¸å‘å¸ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://app.wercker.com/jimmysong/k8s-app-monitor-agent/&#34;&gt;ç¤ºä¾‹çš„é¡¹ç›®ä»£ç æœåŠ¡å™¨ç«¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-agent&#34;&gt;ç¤ºä¾‹é¡¹ç›®ä»£ç å‰ç«¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/&#34;&gt;kubernetes-handbok&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/blob/master/practice/edge-node-configuration.md&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹é…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>è®°ä¸€æœ¬å…³äºkubernetes management design patternsçš„ä¹¦</title>
      <link>https://jimmysong.io/blog/book-kubernetes-management-design-patterns/</link>
      <pubDate>Thu, 20 Jul 2017 18:21:18 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/book-kubernetes-management-design-patterns/</guid>
      <description>
        
        
        

&lt;p&gt;ä¸‹é¢æ˜¯è¿™æœ¬ä¹¦çš„åŸºæœ¬ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä¹¦åï¼š Kubernetes Management Design Patterns: With Docker, CoreOS Linux, and Other Platforms&lt;/li&gt;
&lt;li&gt;Amazonè´­ä¹°é“¾æ¥ï¼š&lt;a href=&#34;https://www.amazon.com/Kubernetes-Management-Design-Patterns-Platforms-ebook/dp/B01MZDO0BD/ref=pd_sbs_351_4?_encoding=UTF8&amp;amp;psc=1&amp;amp;refRID=79F47CR67EEESD35S2VF&#34;&gt;é“¾æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€…ï¼šDeepak Vohra&lt;/li&gt;
&lt;li&gt;å‘è¡Œæ—¥æœŸï¼š2017å¹´1æœˆ20æ—¥&lt;/li&gt;
&lt;li&gt;å‡ºç‰ˆç¤¾ï¼šApress&lt;/li&gt;
&lt;li&gt;é¡µæ•°ï¼š399&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h3&gt;

&lt;p&gt;Kuberneteså¼•é¢†å®¹å™¨é›†ç¾¤ç®¡ç†è¿›å…¥ä¸€ä¸ªå…¨æ–°çš„é˜¶æ®µï¼›å­¦ä¹ å¦‚ä½•åœ¨CoreOSä¸Šé…ç½®å’Œç®¡ç†kubernetesé›†ç¾¤ï¼›ä½¿ç”¨é€‚å½“çš„ç®¡ç†æ¨¡å¼ï¼Œå¦‚ConfigMapsã€Autoscalingã€å¼¹æ€§èµ„æºä½¿ç”¨å’Œé«˜å¯ç”¨æ€§é…ç½®ã€‚è®¨è®ºäº†kubernetesçš„ä¸€äº›å…¶ä»–ç‰¹æ€§ï¼Œå¦‚æ—¥å¿—ã€è°ƒåº¦ã€æ»šåŠ¨å‡çº§ã€volumeã€æœåŠ¡ç±»å‹å’Œè·¨å¤šä¸ªäº‘ä¾›åº”å•†zoneã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesä¸­çš„æœ€å°æ¨¡å—åŒ–å•ä½æ˜¯Podï¼Œå®ƒæ˜¯æ‹¥æœ‰å…±åŒçš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œçš„ç³»åˆ—å®¹å™¨çš„é›†åˆã€‚Podçš„æŠ½è±¡å±‚å¯ä»¥å¯¹å®¹å™¨ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œå°±åƒé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ä¸€æ ·ã€‚å®¹å™¨èƒ½å¤Ÿæä¾›ä¸è½¯ä»¶å¯¹è±¡ï¼ˆå¦‚æ¨¡å—åŒ–æˆ–åŒ…è£…ï¼ŒæŠ½è±¡å’Œé‡ç”¨ï¼‰ç›¸åŒçš„ä¼˜åŠ¿ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å¤§å¤šæ•°ç« èŠ‚ä¸­ä½¿ç”¨çš„éƒ½æ˜¯CoreOS Linuxï¼Œå…¶ä»–è®¨è®ºçš„å¹³å°æœ‰CentOSï¼ŒOpenShiftï¼ŒDebian 8ï¼ˆjessieï¼‰ï¼ŒAWSå’ŒDebian 7 for Google Container Engineã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨CoreOSä¸»è¦æ˜¯å› ä¸ºDockerå·²ç»åœ¨CoreOSä¸Šå¼€ç®±å³ç”¨ã€‚CoreOSï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤§å¤šæ•°äº‘æä¾›å•†ï¼ˆåŒ…æ‹¬Amazon AWS EC2å’ŒGoogle Cloud Platformï¼‰å’Œè™šæ‹ŸåŒ–å¹³å°ï¼ˆå¦‚VMWareå’ŒVirtualBoxï¼‰&lt;/li&gt;
&lt;li&gt;æä¾›Cloud-Configï¼Œç”¨äºå£°æ˜å¼é…ç½®OSï¼Œå¦‚ç½‘ç»œé…ç½®ï¼ˆflannelï¼‰ï¼Œå­˜å‚¨ï¼ˆetcdï¼‰å’Œç”¨æˆ·å¸æˆ·&lt;/li&gt;
&lt;li&gt;ä¸ºå®¹å™¨åŒ–åº”ç”¨æä¾›ç”Ÿäº§çº§åŸºç¡€æ¶æ„ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–ï¼Œå®‰å…¨æ€§å’Œå¯æ‰©å±•æ€§&lt;/li&gt;
&lt;li&gt;å¼•é¢†å®¹å™¨è¡Œä¸šæ ‡å‡†ï¼Œå¹¶å»ºç«‹äº†åº”ç”¨ç¨‹åºæ ‡å‡†&lt;/li&gt;
&lt;li&gt;æä¾›æœ€å…ˆè¿›çš„å®¹å™¨ä»“åº“ï¼ŒQuay&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Dockeräº2013å¹´3æœˆå¼€æºï¼Œç°å·²ç§°ä¸ºæœ€æµè¡Œçš„å®¹å™¨å¹³å°ã€‚kubernetesäº2014å¹´6æœˆå¼€æºï¼Œç°åœ¨å·²ç»æˆä¸ºæœ€æµè¡Œçš„å®¹å™¨é›†ç¾¤ç®¡ç†å¹³å°ã€‚ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆCoreOS Linuxäº2014å¹´7æœˆå‘è¡Œï¼Œç°å·²æˆä¸ºæœ€æµè¡Œçš„å®¹å™¨æ“ä½œç³»ç»Ÿä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ä½ å°†å­¦åˆ°ä»€ä¹ˆ&#34;&gt;ä½ å°†å­¦åˆ°ä»€ä¹ˆ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨dockerå’Œkubernetes&lt;/li&gt;
&lt;li&gt;åœ¨AWSå’ŒCoreOSä¸Šåˆ›å»ºkubernetesé›†ç¾¤&lt;/li&gt;
&lt;li&gt;åº”ç”¨é›†ç¾¤ç®¡ç†è®¾è®¡æ¨¡å¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¤šä¸ªäº‘ä¾›åº”å•†zone&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Ansibleç®¡ç†kubernetes&lt;/li&gt;
&lt;li&gt;åŸºäºkubernetesçš„PAASå¹³å°OpenShift&lt;/li&gt;
&lt;li&gt;åˆ›å»ºé«˜å¯ç”¨ç½‘ç«™&lt;/li&gt;
&lt;li&gt;æ„å»ºé«˜å¯ç”¨ç”¨çš„kubernetes masteré›†ç¾¤&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨volumeã€configmapã€serivceã€autoscalingå’Œrolling update&lt;/li&gt;
&lt;li&gt;ç®¡ç†è®¡ç®—èµ„æº&lt;/li&gt;
&lt;li&gt;é…ç½®æ—¥å¿—å’Œè°ƒåº¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;è°é€‚åˆè¯»è¿™æœ¬ä¹¦&#34;&gt;è°é€‚åˆè¯»è¿™æœ¬ä¹¦&lt;/h3&gt;

&lt;p&gt;Linuxç®¡ç†å‘˜ã€CoreOSç®¡ç†å‘˜ã€åº”ç”¨ç¨‹åºå¼€å‘è€…ã€å®¹å™¨å³æœåŠ¡ï¼ˆCAASï¼‰å¼€å‘è€…ã€‚é˜…è¯»è¿™æœ¬ä¹¦éœ€è¦Linuxå’ŒDockerçš„å‰ç½®çŸ¥è¯†ã€‚ä»‹ç»Kubernetesçš„çŸ¥è¯†ï¼Œä¾‹å¦‚åˆ›å»ºé›†ç¾¤ï¼Œåˆ›å»ºPodï¼Œåˆ›å»ºserviceä»¥åŠåˆ›å»ºå’Œç¼©æ”¾replication controllerã€‚è¿˜éœ€è¦ä¸€äº›å…³äºä½¿ç”¨Amazon Web Servicesï¼ˆAWSï¼‰EC2ï¼ŒCloudFormationå’ŒVPCçš„å¿…å¤‡çŸ¥è¯†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³äºä½œè€…&#34;&gt;å…³äºä½œè€…&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Deepak Vohra&lt;/strong&gt; is an Oracle Certified Associate and a Sun Certified Java Programmer. Deepak has published in Oracle Magazine, OTN, IBM developerWorks, ONJava, DevSource,  WebLogic Developerâ€™s Journal, XML Journal, Java Developerâ€™s Journal, FTPOnline, and devx.&lt;/p&gt;

&lt;h3 id=&#34;ç›®å½•&#34;&gt;ç›®å½•&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹³å°

&lt;ul&gt;
&lt;li&gt;ç¬¬1ç« ï¼šKuberentes on AWS&lt;/li&gt;
&lt;li&gt;ç¬¬2ç« ï¼škubernetes on CoreOS on AWS&lt;/li&gt;
&lt;li&gt;ç¬¬3ç« ï¼škubernetes on Google Cloud Platform&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒéƒ¨åˆ†ï¼šç®¡ç†å’Œé…ç½®

&lt;ul&gt;
&lt;li&gt;ç¬¬4ç« ï¼šä½¿ç”¨å¤šä¸ªå¯ç”¨åŒº&lt;/li&gt;
&lt;li&gt;ç¬¬5ç« ï¼šä½¿ç”¨Tectonic Console&lt;/li&gt;
&lt;li&gt;ç¬¬6ç« ï¼šä½¿ç”¨volume&lt;/li&gt;
&lt;li&gt;ç¬¬7ç« ï¼šä½¿ç”¨service&lt;/li&gt;
&lt;li&gt;ç¬¬8ç« ï¼šä½¿ç”¨Rolling updte&lt;/li&gt;
&lt;li&gt;ç¬¬9ç« ï¼šåœ¨nodeä¸Šè°ƒåº¦pod&lt;/li&gt;
&lt;li&gt;ç¬¬10ç« ï¼šé…ç½®è®¡ç®—èµ„æº&lt;/li&gt;
&lt;li&gt;ç¬¬11ç« ï¼šä½¿ç”¨ConfigMap&lt;/li&gt;
&lt;li&gt;ç¬¬12ç« ï¼šä½¿ç”¨èµ„æºé…é¢&lt;/li&gt;
&lt;li&gt;ç¬¬13ç« ï¼šä½¿ç”¨Autoscaling&lt;/li&gt;
&lt;li&gt;ç¬¬14ç« ï¼šé…ç½®logging&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜å¯ç”¨

&lt;ul&gt;
&lt;li&gt;ç¬¬15ç« ï¼šåœ¨OpenShiftä¸­ä½¿ç”¨HA master&lt;/li&gt;
&lt;li&gt;ç¬¬16ç« ï¼šå¼€å‘é«˜å¯ç”¨ç½‘ç«™&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ä¸ªäººè¯„ä»·&#34;&gt;ä¸ªäººè¯„ä»·&lt;/h3&gt;

&lt;p&gt;æœ¬ä¹¦æ›´åƒæ˜¯ä¸€æœ¬å‚è€ƒæ‰‹å†Œï¼Œå¯¹äºæƒ³åœ¨å…¬æœ‰äº‘ä¸­ï¼ˆå¦‚AWSã€Google Cloud Platformï¼‰ä¸­å°è¯•Kubernetesçš„äººä¼šæœ‰æ‰€å¸®åŠ©ï¼Œè€Œå¯¹äºæƒ³ä½¿ç”¨kubernetesè¿›è¡Œè‡ªå·±çš„ç§æœ‰äº‘å»ºè®¾ï¼Œæˆ–æƒ³äº†è§£kubernetesçš„å®ç°åŸç†å’ŒæŠ€æœ¯ç»†èŠ‚çš„äººæ¥è¯´ï¼Œå°±ä¸é€‚åˆäº†ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œæœ¬ä¹¦ä¸­æœ‰ä¸ªåˆ«å‡ ä¸ªç« èŠ‚å¯ä»¥å‚è€ƒï¼Œå¦‚é«˜å¯ç”¨ï¼Œä½†è¿˜æ˜¯ä½¿ç”¨OpenShiftå®ç°çš„ã€‚æ€»ä¹‹ï¼Œå¦‚æœä½ ä½¿ç”¨AWSè¿™æ ·çš„å…¬æœ‰äº‘ï¼Œå¯¹æ“ä½œç³»ç»Ÿæ²¡æœ‰ç‰¹åˆ«è¦æ±‚ï¼Œå¯ä»¥æ¥å—CoreOSçš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹çœ‹è¿™æœ¬ä¹¦ã€‚æœ¬æ¥æœ¬ä¹¦ä¼šå¯¹kubernetesä¸­çš„å„ç§åº”ç”¨æ¨¡å¼èƒ½å¤Ÿæœ‰ä¸ªè¯¦è§£ï¼Œä½†æ˜¯ä»ä¹¦ä¸­æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬ä¹¦æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼Œä¸€ä¸ªæ˜¯æ¯ä¸ªç« èŠ‚éƒ½ç»™å‡ºäº†é—®é¢˜çš„èµ·å› å’Œkubernetesçš„è§£å†³æ–¹æ¡ˆï¼ŒäºŒæ˜¯å‡ ä¹æ‰€æœ‰çš„å‘½ä»¤å’Œæ“ä½œéƒ½é™„æœ‰æˆªå›¾ï¼Œè¯´æ˜å¾ˆè¯¦ç»†ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„æœåŠ¡å‘ç°ä¸dockerå®¹å™¨é—´çš„ç¯å¢ƒå˜é‡ä¼ é€’æºç æ¢ç©¶</title>
      <link>https://jimmysong.io/blog/exploring-kubernetes-env-with-docker/</link>
      <pubDate>Wed, 19 Jul 2017 23:15:01 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/exploring-kubernetes-env-with-docker/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ä»Šå¤©åˆ›å»ºäº†ä¸¤ä¸ªkubernetesç¤ºä¾‹åº”ç”¨ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-test&#34;&gt;k8s-app-monitor-test&lt;/a&gt;ï¼šå¯åŠ¨serverç”¨æ¥äº§ç”Ÿmetrics&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/k8s-app-monitor-agent&#34;&gt;k8s-app-monitor-agent&lt;/a&gt;ï¼šè·å–metricså¹¶ç»˜å›¾ï¼Œæ˜¾ç¤ºåœ¨webä¸Š&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;æ³¨ï¼šç›¸å…³çš„kubernetesåº”ç”¨&lt;code&gt;manifest.yaml&lt;/code&gt;æ–‡ä»¶åˆ†åˆ«è§ä»¥ä¸Šä¸¤ä¸ªåº”ç”¨çš„GitHub ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;å½“æˆ‘æŸ¥çœ‹Podä¸­çš„ç¯å¢ƒå˜é‡ä¿¡æ¯æ—¶ï¼Œä¾‹å¦‚kubernetesä¸­çš„service &lt;code&gt;k8s-app-monitor-test&lt;/code&gt;æ³¨å…¥çš„ç¯å¢ƒå˜é‡æ—¶ï¼ŒåŒ…æ‹¬äº†ä»¥ä¸‹å˜é‡ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;K8S_APP_MONITOR_TEST_PORT_3000_TCP_ADDR=10.254.56.68
K8S_APP_MONITOR_TEST_PORT=tcp://10.254.56.68:3000
K8S_APP_MONITOR_TEST_PORT_3000_TCP_PROTO=tcp
K8S_APP_MONITOR_TEST_SERVICE_PORT_HTTP=3000
K8S_APP_MONITOR_TEST_PORT_3000_TCP_PORT=3000
K8S_APP_MONITOR_TEST_PORT_3000_TCP=tcp://10.254.56.68:3000
K8S_APP_MONITOR_TEST_SERVICE_HOST=10.254.56.68
K8S_APP_MONITOR_TEST_SERVICE_PORT=3000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬çŸ¥é“Kubernetesåœ¨å¯åŠ¨Podçš„æ—¶å€™ä¸ºå®¹å™¨æ³¨å…¥ç¯å¢ƒå˜é‡ï¼Œè¿™äº›ç¯å¢ƒå˜é‡å°†åœ¨è¯¥Podæ‰€åœ¨çš„namespaceä¸­å…±äº«ã€‚ä½†æ˜¯æ—¢ç„¶ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡å°±å·²ç»å¯ä»¥è®¿é—®åˆ°å¯¹åº”çš„serviceï¼Œé‚£ä¹ˆè·å–åº”ç”¨çš„åœ°å€ä¿¡æ¯ï¼Œç©¶ç«Ÿæ˜¯ä½¿ç”¨å˜é‡å‘¢ï¼Ÿè¿˜æ˜¯ç›´æ¥ä½¿ç”¨DNSè§£ææ¥å‘ç°ï¼Ÿä¸‹é¢æˆ‘ä»¬ä»ä»£ç ä¸­æ¥å¯»æ±‚ç­”æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸æƒ³çœ‹ä¸‹é¢çš„æ–‡å­—ï¼Œå¯ä»¥ç›´æ¥çœ‹å›¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/kubernetes-service-discovery-with-dns-or-env.png&#34; alt=&#34;kubernetesä¸­ä¼ é€’ENVçš„æ¢ç´¢è¿‡ç¨‹&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ¢ç´¢&#34;&gt;æ¢ç´¢&lt;/h2&gt;

&lt;p&gt;dockerçš„&lt;code&gt;docker/engine-api/types/container/config.go&lt;/code&gt;ä¸­çš„&lt;code&gt;Config&lt;/code&gt;ç»“æ„ä½“ä¸­æœ‰å¯¹ç¯å¢ƒå˜é‡çš„å®šä¹‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// Config contains the configuration data about a container.
// It should hold only portable information about the container.
// Here, &amp;quot;portable&amp;quot; means &amp;quot;independent from the host we are running on&amp;quot;.
// Non-portable information *should* appear in HostConfig.
// All fields added to this struct must be marked `omitempty` to keep getting
// predictable hashes from the old `v1Compatibility` configuration.
type Config struct {
	Hostname        string                // Hostname
	Domainname      string                // Domainname
	User            string                // User that will run the command(s) inside the container
...
	Env             []string              // List of environment variable to set in the container
	Cmd             strslice.StrSlice     // Command to run when starting the container
	...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Kubernetesä¸­åœ¨&lt;code&gt;pkg/kubelet/container/runtime.go&lt;/code&gt;ä¸­çš„&lt;code&gt;RunContainerOptions&lt;/code&gt;ç»“æ„ä½“ä¸­å®šä¹‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// RunContainerOptions specify the options which are necessary for running containers
type RunContainerOptions struct {
	// The environment variables list.
	Envs []EnvVar
  	// The mounts for the containers.
	Mounts []Mount
	// The host devices mapped into the containers.
...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Kubeletå‘å®¹å™¨ä¸­æ³¨å…¥ç¯å¢ƒå˜é‡çš„é…ç½®æ˜¯åœ¨ä¸‹é¢çš„æ–¹æ³•ä¸­å®šä¹‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;pkg/kubelet/kuberuntime/kuberuntime_container.go
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// generateContainerConfig generates container config for kubelet runtime v1.
func (m *kubeGenericRuntimeManager) generateContainerConfig(container *v1.Container, pod *v1.Pod, restartCount int, podIP, imageRef string) (*runtimeapi.ContainerConfig, error) {
    opts, _, err := m.runtimeHelper.GenerateRunContainerOptions(pod, container, podIP)
    ...
	// set environment variables
	envs := make([]*runtimeapi.KeyValue, len(opts.Envs))
	for idx := range opts.Envs {
		e := opts.Envs[idx]
		envs[idx] = &amp;amp;runtimeapi.KeyValue{
			Key:   e.Name,
			Value: e.Value,
		}
	}
	config.Envs = envs

	return config, nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;kubeletçš„&lt;code&gt;pkg/kubelet/kubelet_pods.go&lt;/code&gt;çš„å¦‚ä¸‹æ–¹æ³•ä¸­ç”Ÿæˆäº†&lt;code&gt;RunContainerOptions&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// GenerateRunContainerOptions generates the RunContainerOptions, which can be used by
// the container runtime to set parameters for launching a container.
func (kl *Kubelet) GenerateRunContainerOptions(pod *v1.Pod, container *v1.Container, podIP string) (*kubecontainer.RunContainerOptions, bool, error) {
	...
	opts := &amp;amp;kubecontainer.RunContainerOptions{CgroupParent: cgroupParent}
	...
	opts.Envs, err = kl.makeEnvironmentVariables(pod, container, podIP)
    return opts, useClusterFirstPolicy, nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å†çœ‹ä¸‹&lt;code&gt;makeEnvironmentVariables(pod, container, podIP)&lt;/code&gt;æ–¹æ³•ä¸­åˆåšäº†ä»€ä¹ˆï¼ˆè¯¥æ–¹æ³•ä¹Ÿåœ¨&lt;code&gt;pkg/kubelet/kubelet_pods.go&lt;/code&gt;æ–‡ä»¶ä¸­ï¼‰ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// Make the environment variables for a pod in the given namespace.
func (kl *Kubelet) makeEnvironmentVariables(pod *v1.Pod, container *v1.Container, podIP string) ([]kubecontainer.EnvVar, error) {
	var result []kubecontainer.EnvVar
	// Note:  These are added to the docker Config, but are not included in the checksum computed
	// by dockertools.BuildDockerName(...).  That way, we can still determine whether an
	// v1.Container is already running by its hash. (We don&#39;t want to restart a container just
	// because some service changed.)
	//
	// Note that there is a race between Kubelet seeing the pod and kubelet seeing the service.
	// To avoid this users can: (1) wait between starting a service and starting; or (2) detect
	// missing service env var and exit and be restarted; or (3) use DNS instead of env vars
	// and keep trying to resolve the DNS name of the service (recommended).
	...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥ä»£ç æ®µæ¯”è¾ƒé•¿ï¼Œkubernetesç©¶ç«Ÿå¦‚ä½•å°†ç¯å¢ƒå˜é‡æ³¨å…¥åˆ°dockerå®¹å™¨ä¸­çš„å¥¥ç§˜å°±åœ¨è¿™é‡Œï¼ŒæŒ‰å›¾ç´¢éª¥åˆ°äº†è¿™é‡Œï¼Œä»ä»£ç æ³¨é‡Šä¸­å·²ç»å¯ä»¥å¾—å‡ºç»“è®ºï¼Œä½¿ç”¨DNSè§£æè€Œä¸è¦ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥åšæœåŠ¡å‘ç°ï¼Œç©¶ç«Ÿä¸ºä½•è¿™æ ·åšï¼Œæ”¹å¤©æˆ‘ä»¬å†è¯¦ç»†è§£è¯»ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„æ•°æ®æŒä¹…åŒ–é—®é¢˜</title>
      <link>https://jimmysong.io/blog/data-persistence-problem/</link>
      <pubDate>Tue, 11 Jul 2017 20:33:21 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/data-persistence-problem/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;æ•°æ®è½ç›˜é—®é¢˜çš„ç”±æ¥&#34;&gt;æ•°æ®è½ç›˜é—®é¢˜çš„ç”±æ¥&lt;/h2&gt;

&lt;p&gt;è¿™æœ¬è´¨ä¸Šæ˜¯æ•°æ®æŒä¹…åŒ–é—®é¢˜ï¼Œå¯¹äºæœ‰äº›åº”ç”¨ä¾èµ–æŒä¹…åŒ–æ•°æ®ï¼Œæ¯”å¦‚åº”ç”¨è‡ªèº«äº§ç”Ÿçš„æ—¥å¿—éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„æƒ…å†µï¼Œéœ€è¦ä¿è¯å®¹å™¨é‡Œçš„æ•°æ®ä¸ä¸¢å¤±ï¼Œåœ¨PodæŒ‚æ‰åï¼Œå…¶ä»–åº”ç”¨ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è¿™äº›æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†æ•°æ®æŒä¹…åŒ–å­˜å‚¨èµ·æ¥ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ•°æ®è½ç›˜é—®é¢˜è§£å†³æ–¹æ¡ˆ&#34;&gt;æ•°æ®è½ç›˜é—®é¢˜è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;

&lt;p&gt;ä¸‹é¢ä»¥ä¸€ä¸ªåº”ç”¨çš„æ—¥å¿—æ”¶é›†ä¸ºä¾‹ï¼Œè¯¥æ—¥å¿—éœ€è¦æŒä¹…åŒ–æ”¶é›†åˆ°ElasticSearché›†ç¾¤ä¸­ï¼Œå¦‚æœä¸è€ƒè™‘æ•°æ®ä¸¢å¤±çš„æƒ…å½¢ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­ã€åº”ç”¨æ—¥å¿—æ”¶é›†ã€‘ä¸€èŠ‚ä¸­çš„æ–¹æ³•ï¼Œä½†è€ƒè™‘åˆ°PodæŒ‚æ‰æ—¶logstashï¼ˆæˆ–filebeatï¼‰å¹¶æ²¡æœ‰æ”¶é›†å®Œè¯¥podå†…æ—¥å¿—çš„æƒ…å½¢ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†å¦‚ä¸‹è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/log-persistence-logstash.png&#34; alt=&#34;æ—¥å¿—æŒä¹…åŒ–æ”¶é›†è§£å†³æ–¹æ¡ˆç¤ºæ„å›¾&#34; /&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;é¦–å…ˆéœ€è¦ç»™æ•°æ®è½ç›˜çš„åº”ç”¨åˆ’åˆ†nodeï¼Œå³è¿™äº›åº”ç”¨åªè°ƒç”¨åˆ°è‹¥å¹²å°ä¸»æœºä¸Š&lt;/li&gt;
&lt;li&gt;ç»™è¿™è‹¥å¹²å°ä¸»æœºå¢åŠ label&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;deamonset&lt;/code&gt;æ–¹å¼åœ¨è¿™è‹¥å¹²å°ä¸»æœºä¸Šå¯åŠ¨logstashçš„Podï¼ˆä½¿ç”¨nodeSelectoræ¥é™å®šåœ¨è¿™å‡ å°ä¸»æœºä¸Šï¼Œæˆ‘ä»¬åœ¨è¾¹ç¼˜èŠ‚ç‚¹å¯åŠ¨çš„&lt;code&gt;treafik&lt;/code&gt;ä¹Ÿæ˜¯è¿™ç§æ¨¡å¼ï¼‰&lt;/li&gt;
&lt;li&gt;å°†åº”ç”¨çš„æ•°æ®é€šè¿‡volumeæŒ‚è½½åˆ°å®¿ä¸»æœºä¸Š&lt;/li&gt;
&lt;li&gt;Logstashï¼ˆæˆ–è€…filebeatï¼‰æ”¶é›†å®¿ä¸»æœºä¸Šçš„æ•°æ®ï¼Œæ•°æ®æŒä¹…åŒ–ä¸ä¼šä¸¢å¤±&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;side-effect&#34;&gt;Side-effect&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;é¦–å…ˆkubernetesæœ¬èº«å°±æä¾›äº†æ•°æ®æŒä¹…åŒ–çš„è§£å†³æ–¹æ¡ˆstatefulsetï¼Œä¸è¿‡éœ€è¦ç”¨åˆ°å…¬æœ‰äº‘çš„å­˜å‚¨è´§å…¶ä»–åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ä¸€ç‚¹åœ¨æˆ‘ä»¬çš„ç§æœ‰äº‘ç¯å¢ƒé‡Œè¢«å¦å®šäº†ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ç®¡ç†ä¸»æœºçš„labelï¼Œå¢åŠ è¿ç»´å¤æ‚åº¦ï¼Œä½†æ˜¯å…·ä½“é—®é¢˜å…·ä½“å¯¹å¾…&lt;/li&gt;
&lt;li&gt;å¿…é¡»ä¿è¯åº”ç”¨å¯åŠ¨é¡ºåºï¼Œéœ€è¦å…ˆå¯åŠ¨logstash&lt;/li&gt;
&lt;li&gt;ä¸ºä¸»æœºæ‰“labelä½¿ç”¨nodeSelectorçš„æ–¹å¼é™åˆ¶äº†èµ„æºè°ƒåº¦çš„èŒƒå›´&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;p&gt;æœ¬æ–‡å·²å½’æ¡£åˆ°&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook/&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­çš„ã€æœ€ä½³å®è·µâ€”è¿ç»´ç®¡ç†ã€‘ç« èŠ‚ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥kubernetes-handbookä¸ºå‡†ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetesé…ç½®æœ€ä½³å®è·µ</title>
      <link>https://jimmysong.io/blog/configuration-best-practice/</link>
      <pubDate>Wed, 14 Jun 2017 20:03:09 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/configuration-best-practice/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡æ¡£æ—¨åœ¨æ±‡æ€»å’Œå¼ºè°ƒç”¨æˆ·æŒ‡å—ã€å¿«é€Ÿå¼€å§‹æ–‡æ¡£å’Œç¤ºä¾‹ä¸­çš„æœ€ä½³å®è·µã€‚è¯¥æ–‡æ¡£ä¼šå¾ˆå¾ˆæ´»è·ƒå¹¶æŒç»­æ›´æ–°ä¸­ã€‚å¦‚æœä½ è§‰å¾—å¾ˆæœ‰ç”¨çš„æœ€ä½³å®è·µä½†æ˜¯æœ¬æ–‡æ¡£ä¸­æ²¡æœ‰åŒ…å«ï¼Œæ¬¢è¿ç»™æˆ‘ä»¬æPull Requestã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡å·²ä¸Šä¼ åˆ°&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­çš„ç¬¬å››ç« æœ€ä½³å®è·µç« èŠ‚ï¼Œæœ¬æ–‡ä»…ä½œå½’æ¡£ï¼Œæ›´æ–°ä»¥&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸ºå‡†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é€šç”¨é…ç½®å»ºè®®&#34;&gt;é€šç”¨é…ç½®å»ºè®®&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å®šä¹‰é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŒ‡å®šæœ€æ–°çš„ç¨³å®šAPIç‰ˆæœ¬ï¼ˆç›®å‰æ˜¯V1ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨é…ç½®æ–‡ä»¶pushåˆ°é›†ç¾¤ä¹‹å‰åº”è¯¥ä¿å­˜åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚è¿™æ ·å½“éœ€è¦çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿå›æ»šï¼Œå¿…è¦çš„æ—¶å€™ä¹Ÿå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºé›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨YAMLæ ¼å¼è€Œä¸æ˜¯JSONæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å®ƒä»¬éƒ½å¯ä»¥ä½œä¸ºæ•°æ®äº¤æ¢æ ¼å¼ï¼Œä½†æ˜¯YAMLæ ¼å¼æ¯”èµ·JSONæ›´æ˜“è¯»å’Œé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å°½é‡å°†ç›¸å…³çš„å¯¹è±¡æ”¾åœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œã€‚è¿™æ ·æ¯”åˆ†æˆå¤šä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†ã€‚å‚è€ƒ&lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook/all-in-one/guestbook-all-in-one.yaml&#34;&gt;guestbook-all-in-one.yaml&lt;/a&gt;æ–‡ä»¶ä¸­çš„é…ç½®ï¼ˆæ³¨æ„ï¼Œå°½ç®¡ä½ å¯ä»¥åœ¨ä½¿ç”¨&lt;code&gt;kubectl&lt;/code&gt;å‘½ä»¤æ—¶æŒ‡å®šé…ç½®æ–‡ä»¶ç›®å½•ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œ&lt;code&gt;kubectl create&lt;/code&gt;â€”â€”æŸ¥çœ‹ä¸‹é¢çš„è¯¦ç»†ä¿¡æ¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ç®€åŒ–å’Œæœ€å°åŒ–é…ç½®ï¼Œä¹Ÿä¸ºäº†é˜²æ­¢é”™è¯¯å‘ç”Ÿï¼Œä¸è¦æŒ‡å®šä¸å¿…è¦çš„é»˜è®¤é…ç½®ã€‚ä¾‹å¦‚ï¼Œçœç•¥æ‰&lt;code&gt;ReplicationController&lt;/code&gt;çš„selectorå’Œlabelï¼Œå¦‚æœä½ å¸Œæœ›å®ƒä»¬è·Ÿ&lt;code&gt;podTemplate&lt;/code&gt;ä¸­çš„labelä¸€æ ·çš„è¯ï¼Œå› ä¸ºé‚£äº›é…ç½®é»˜è®¤æ˜¯&lt;code&gt;podTemplate&lt;/code&gt;çš„labeläº§ç”Ÿçš„ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ &lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook/&#34;&gt;guestbook app&lt;/a&gt; çš„yamlæ–‡ä»¶å’Œ &lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook/frontend-deployment.yaml&#34;&gt;examples&lt;/a&gt; ã€‚&lt;/li&gt;
&lt;li&gt;å°†èµ„æºå¯¹è±¡çš„æè¿°æ”¾åœ¨ä¸€ä¸ªannotationä¸­å¯ä»¥æ›´å¥½çš„å†…çœã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;è£¸å¥”çš„pods-vs-replication-controllerså’Œ-jobs&#34;&gt;è£¸å¥”çš„Pods vs Replication Controllerså’Œ Jobs&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰å…¶ä»–æ–¹å¼æ›¿ä»£â€œè£¸å¥”çš„podâ€ï¼ˆå¦‚æ²¡æœ‰ç»‘å®šåˆ°&lt;a href=&#34;https://kubernetes.io/docs/user-guide/replication-controller&#34;&gt;replication controller &lt;/a&gt;ä¸Šçš„podï¼‰ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å…¶ä»–é€‰æ‹©ã€‚åœ¨nodeèŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œè£¸å¥”çš„podä¸ä¼šè¢«é‡æ–°è°ƒåº¦ã€‚Replication Controlleræ€»æ˜¯ä¼šé‡æ–°åˆ›å»ºpodï¼Œé™¤äº†æ˜ç¡®æŒ‡å®šäº†&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy&#34;&gt;&lt;code&gt;restartPolicy: Never&lt;/code&gt;&lt;/a&gt; çš„åœºæ™¯ã€‚&lt;a href=&#34;https://kubernetes.io/docs/concepts/jobs/run-to-completion-finite-workloads/&#34;&gt;Job&lt;/a&gt; ä¹Ÿè®¸æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;services&#34;&gt;Services&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;é€šå¸¸æœ€å¥½åœ¨åˆ›å»ºç›¸å…³çš„&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/&#34;&gt;replication controllers&lt;/a&gt;ä¹‹å‰å…ˆåˆ›å»º&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/&#34;&gt;service&lt;/a&gt;ï¼ˆæ²¡æœ‰è¿™ä¸ªå¿…è¦å§ï¼Ÿï¼‰ä½ ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºReplication Controllerçš„æ—¶å€™ä¸æŒ‡å®šreplicaæ•°é‡ï¼ˆé»˜è®¤æ˜¯1ï¼‰ï¼Œåˆ›å»ºserviceåï¼Œåœ¨é€šè¿‡Replication Controlleræ¥æ‰©å®¹ã€‚è¿™æ ·å¯ä»¥åœ¨æ‰©å®¹å¾ˆå¤šä¸ªreplicaä¹‹å‰å…ˆç¡®è®¤podæ˜¯æ­£å¸¸çš„ã€‚&lt;/li&gt;
&lt;li&gt;é™¤éæ—¶åˆ†å¿…è¦çš„æƒ…å†µä¸‹ï¼ˆå¦‚è¿è¡Œä¸€ä¸ªnode daemonï¼‰ï¼Œä¸è¦ä½¿ç”¨&lt;code&gt;hostPort&lt;/code&gt;ï¼ˆç”¨æ¥æŒ‡å®šæš´éœ²åœ¨ä¸»æœºä¸Šçš„ç«¯å£å·ï¼‰ã€‚å½“ä½ ç»™Podç»‘å®šäº†ä¸€ä¸ª&lt;code&gt;hostPort&lt;/code&gt;ï¼Œè¯¥podå¯è¢«è°ƒåº¦åˆ°çš„ä¸»æœºçš„å—é™äº†ï¼Œå› ä¸ºç«¯å£å†²çªã€‚å¦‚æœæ˜¯ä¸ºäº†è°ƒè¯•ç›®çš„æ¥é€šè¿‡ç«¯å£è®¿é—®çš„è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/tasks/access-kubernetes-api/http-proxy-access-api/&#34;&gt;kubectl proxy and apiserver proxy&lt;/a&gt; æˆ–è€… &lt;a href=&#34;https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/&#34;&gt;kubectl port-forward&lt;/a&gt;ã€‚ä½ å¯ä½¿ç”¨ Service æ¥å¯¹å¤–æš´éœ²æœåŠ¡ã€‚å¦‚æœä½ ç¡®å®éœ€è¦å°†podçš„ç«¯å£æš´éœ²åˆ°ä¸»æœºä¸Šï¼Œè€ƒè™‘ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/#type-nodeport&#34;&gt;NodePort&lt;/a&gt; serviceã€‚&lt;/li&gt;
&lt;li&gt;è·Ÿ&lt;code&gt;hostPort&lt;/code&gt;ä¸€æ ·çš„åŸå› ï¼Œé¿å…ä½¿ç”¨ &lt;code&gt;hostNetwork&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ ä¸éœ€è¦kube-proxyçš„è´Ÿè½½å‡è¡¡çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä½¿ç”¨&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/#headless-services&#34;&gt;headless services&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ä½¿ç”¨label&#34;&gt;ä½¿ç”¨Label&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å®šä¹‰ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/labels/&#34;&gt;labels&lt;/a&gt; æ¥æŒ‡å®šåº”ç”¨æˆ–Deploymentçš„ &lt;strong&gt;semantic attributes&lt;/strong&gt; ã€‚ä¾‹å¦‚ï¼Œä¸æ˜¯å°†labelé™„åŠ åˆ°ä¸€ç»„podæ¥æ˜¾å¼è¡¨ç¤ºæŸäº›æœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œ&lt;code&gt;service:myservice&lt;/code&gt;ï¼‰ï¼Œæˆ–è€…æ˜¾å¼åœ°è¡¨ç¤ºç®¡ç†podçš„replication controllerï¼ˆä¾‹å¦‚ï¼Œ&lt;code&gt;controller:mycontroller&lt;/code&gt;ï¼‰ï¼Œé™„åŠ labelåº”è¯¥æ˜¯æ ‡ç¤ºè¯­ä¹‰å±æ€§çš„æ ‡ç­¾ï¼Œ ä¾‹å¦‚&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;{app:myapp,tier:frontend,phase:test,deployment:v3}
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;è¿™å°†å…è®¸æ‚¨é€‰æ‹©é€‚åˆä¸Šä¸‹æ–‡çš„å¯¹è±¡ç»„â€”â€”ä¾‹å¦‚ï¼Œæ‰€æœ‰çš„â€tier:frontendâ€œpodçš„æœåŠ¡æˆ–appæ˜¯â€œmyappâ€çš„æ‰€æœ‰â€œæµ‹è¯•â€é˜¶æ®µç»„ä»¶ã€‚ æœ‰å…³æ­¤æ–¹æ³•çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook/&#34;&gt;guestbook&lt;/a&gt;åº”ç”¨ç¨‹åºã€‚å¯ä»¥é€šè¿‡ç®€å•åœ°ä»å…¶serviceçš„é€‰æ‹©å™¨ä¸­çœç•¥ç‰¹å®šäºå‘è¡Œç‰ˆæœ¬çš„æ ‡ç­¾ï¼Œè€Œä¸æ˜¯æ›´æ–°æœåŠ¡çš„é€‰æ‹©å™¨æ¥å®Œå…¨åŒ¹é…replication controllerçš„é€‰æ‹©å™¨ï¼Œæ¥å®ç°è·¨è¶Šå¤šä¸ªéƒ¨ç½²çš„æœåŠ¡ï¼Œä¾‹å¦‚æ»šåŠ¨æ›´æ–°ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä¸ºäº†æ»šåŠ¨å‡çº§çš„æ–¹ä¾¿ï¼Œåœ¨Replication Controllerçš„åå­—ä¸­åŒ…å«ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ä½œä¸ºåå­—çš„åç¼€ã€‚è®¾ç½®ä¸€ä¸ª&lt;code&gt;version&lt;/code&gt;æ ‡ç­¾é¡µæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚æ»šåŠ¨æ›´æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„controllerè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„controllerã€‚å› æ­¤ï¼Œversionå«æ··ä¸æ¸…çš„controlleråå­—å°±å¯èƒ½å¸¦æ¥é—®é¢˜ã€‚æŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/&#34;&gt;Rolling Update Replication Controller&lt;/a&gt;æ–‡æ¡£è·å–æ›´å¤šå…³äºæ»šåŠ¨å‡çº§å‘½ä»¤çš„ä¿¡æ¯ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ³¨æ„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&#34;&gt;Deployment&lt;/a&gt; å¯¹è±¡ä¸éœ€è¦å†ç®¡ç† replication controller çš„ç‰ˆæœ¬åã€‚Deployment ä¸­æè¿°äº†å¯¹è±¡çš„æœŸæœ›çŠ¶æ€ï¼Œå¦‚æœå¯¹specçš„æ›´æ”¹è¢«åº”ç”¨äº†è¯ï¼ŒDeployment controller ä¼šä»¥æ§åˆ¶çš„é€Ÿç‡æ¥æ›´æ”¹å®é™…çŠ¶æ€åˆ°æœŸæœ›çŠ¶æ€ã€‚ï¼ˆDeploymentç›®å‰æ˜¯ &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/kubernetes-api/#api-groups&#34;&gt;&lt;code&gt;extensions&lt;/code&gt; API Group&lt;/a&gt;çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨labelåšè°ƒè¯•ã€‚å› ä¸ºKubernetes replication controllerå’Œserviceä½¿ç”¨labelæ¥åŒ¹é…podsï¼Œè¿™å…è®¸ä½ é€šè¿‡ç§»é™¤podä¸­çš„labelçš„æ–¹å¼å°†å…¶ä»ä¸€ä¸ªcontrolleræˆ–è€…serviceä¸­ç§»é™¤ï¼ŒåŸæ¥çš„controllerä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„podæ¥å–ä»£ç§»é™¤çš„podã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æ–¹å¼ï¼Œå¸®ä½ åœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒä¸­è°ƒè¯•ä¹‹å‰çš„â€œæ´»ç€çš„â€ podã€‚æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/&#34;&gt;&lt;code&gt;kubectl label&lt;/code&gt;&lt;/a&gt; å‘½ä»¤ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å®¹å™¨é•œåƒ&#34;&gt;å®¹å™¨é•œåƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/containers/images/&#34;&gt;é»˜è®¤å®¹å™¨é•œåƒæ‹‰å–ç­–ç•¥&lt;/a&gt; æ˜¯ &lt;code&gt;IfNotPresent&lt;/code&gt;, å½“æœ¬åœ°å·²å­˜åœ¨è¯¥é•œåƒçš„æ—¶å€™ &lt;a href=&#34;https://kubernetes.io/docs/admin/kubelet/&#34;&gt;Kubelet&lt;/a&gt; ä¸ä¼šå†ä»é•œåƒä»“åº“æ‹‰å–ã€‚å¦‚æœä½ å¸Œæœ›æ€»æ˜¯ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒçš„è¯ï¼Œåœ¨yamlæ–‡ä»¶ä¸­æŒ‡å®šé•œåƒæ‹‰å–ç­–ç•¥ä¸º&lt;code&gt;Always&lt;/code&gt;ï¼ˆ &lt;code&gt;imagePullPolicy: Always&lt;/code&gt;ï¼‰æˆ–è€…æŒ‡å®šé•œåƒçš„tagä¸º &lt;code&gt;:latest&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœä½ æ²¡æœ‰å°†é•œåƒæ ‡ç­¾æŒ‡å®šä¸º&lt;code&gt;:latest&lt;/code&gt;ï¼Œä¾‹å¦‚æŒ‡å®šä¸º&lt;code&gt;myimage:v1&lt;/code&gt;ï¼Œå½“è¯¥æ ‡ç­¾çš„é•œåƒè¿›è¡Œäº†æ›´æ–°ï¼Œkubeletä¹Ÿä¸ä¼šæ‹‰å–è¯¥é•œåƒã€‚ä½ å¯ä»¥åœ¨æ¯æ¬¡é•œåƒæ›´æ–°åéƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„tagï¼ˆä¾‹å¦‚&lt;code&gt;myimage:v2&lt;/code&gt;ï¼‰ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ˜ç¡®æŒ‡å®šè¯¥ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt; åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹éƒ¨ç½²å®¹å™¨åº”è¯¥å°½é‡é¿å…ä½¿ç”¨&lt;code&gt;:latest&lt;/code&gt;æ ‡ç­¾ï¼Œå› ä¸ºè¿™æ ·å¾ˆéš¾è¿½æº¯åˆ°åº•è¿è¡Œçš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„å®¹å™¨å’Œå›æ»šã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä½¿ç”¨kubectl&#34;&gt;ä½¿ç”¨kubectl&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å°½é‡ä½¿ç”¨ &lt;code&gt;kubectl create -f &amp;lt;directory&amp;gt;&lt;/code&gt;  ã€‚kubecltä¼šè‡ªåŠ¨æŸ¥æ‰¾è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰åç¼€åä¸º&lt;code&gt;.yaml&lt;/code&gt;ã€&lt;code&gt;.yml&lt;/code&gt;å’Œ&lt;code&gt;.json&lt;/code&gt;æ–‡ä»¶å¹¶å°†å®ƒä»¬ä¼ é€’ç»™&lt;code&gt;create&lt;/code&gt;å‘½ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;kubectl delete&lt;/code&gt; è€Œä¸æ˜¯ &lt;code&gt;stop&lt;/code&gt;. &lt;code&gt;Delete&lt;/code&gt; æ˜¯ &lt;code&gt;stop&lt;/code&gt;çš„è¶…é›†ï¼Œ&lt;code&gt;stop&lt;/code&gt; å·²ç»è¢«å¼ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ kubectl bulk æ“ä½œï¼ˆé€šè¿‡æ–‡ä»¶æˆ–è€…labelï¼‰æ¥getå’Œdeleteã€‚æŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/user-guide/labels/#label-selectors&#34;&gt;label selectors &lt;/a&gt;å’Œ &lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#using-labels-effectively&#34;&gt;using labels effectively&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;kubectl run&lt;/code&gt; å’Œ &lt;code&gt;expose&lt;/code&gt; å‘½ä»¤å¿«é€Ÿåˆ›å»ºç›´æœ‰è€½æå®¹å™¨çš„Deploymentã€‚æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/quick-start/&#34;&gt;quick start guide&lt;/a&gt;ä¸­çš„ç¤ºä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/overview/&#34;&gt;Configuration Best Practices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>è¿ç”¨kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•</title>
      <link>https://jimmysong.io/blog/distributed-load-testing-using-kubernetes/</link>
      <pubDate>Mon, 24 Apr 2017 21:32:52 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/distributed-load-testing-using-kubernetes/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æœ¬ç¤ºä¾‹æ¥è‡ª &lt;a href=&#34;https://github.com/rootsongjc/distributed-load-testing-using-kubernetes&#34;&gt;GitHub - distributed-load-testing-using-kubernetes&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¯¥æ•™ç¨‹æè¿°å¦‚ä½•åœ¨&lt;a href=&#34;http://kubernetes.io&#34;&gt;Kubernetes&lt;/a&gt;ä¸­è¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡æµ‹è¯•ï¼ŒåŒ…æ‹¬ä¸€ä¸ªwebåº”ç”¨ã€dockeré•œåƒå’ŒKubernetes controllers/servicesã€‚æ›´å¤šèµ„æ–™è¯·æŸ¥çœ‹&lt;a href=&#34;http://cloud.google.com/solutions/distributed-load-testing-using-kubernetes&#34;&gt;Distributed Load Testing Using Kubernetes&lt;/a&gt; ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šè¯¥æµ‹è¯•æ˜¯åœ¨æˆ‘è‡ªå·±æœ¬åœ°æ­å»ºçš„kubernetesé›†ç¾¤ä¸Šæµ‹è¯•çš„ï¼Œä¸éœ€è¦ä½¿ç”¨Google Cloud Platformã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä¸éœ€è¦GCEåŠå…¶ä»–ç»„ä»¶ï¼Œä½ åªéœ€è¦æœ‰ä¸€ä¸ªkubernetesé›†ç¾¤å³å¯ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ è¿˜æ²¡æœ‰kubernetesé›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;https://www.gitbook.com/book/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;éƒ¨ç½²ä¸€ä¸ªã€‚&lt;/p&gt;

&lt;h2 id=&#34;éƒ¨ç½²webåº”ç”¨&#34;&gt;éƒ¨ç½²Webåº”ç”¨&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;sample-webapp&lt;/code&gt; ç›®å½•ä¸‹åŒ…å«ä¸€ä¸ªç®€å•çš„webæµ‹è¯•åº”ç”¨ã€‚æˆ‘ä»¬å°†å…¶æ„å»ºä¸ºdockeré•œåƒï¼Œåœ¨kubernetesä¸­è¿è¡Œã€‚ä½ å¯ä»¥è‡ªå·±æ„å»ºï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªæˆ‘æ„å»ºå¥½çš„é•œåƒ&lt;code&gt;index.tenxcloud.com/jimmy/k8s-sample-webapp:latest&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨kubernetesä¸Šéƒ¨ç½²sample-webappã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cd kubernetes-config
$ kubectl create -f sample-webapp-controller.yaml
$ kubectl create -f kubectl create -f sample-webapp-service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;éƒ¨ç½²locustçš„controllerå’Œservice&#34;&gt;éƒ¨ç½²Locustçš„Controllerå’ŒService&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;locust-master&lt;/code&gt;å’Œ&lt;code&gt;locust-work&lt;/code&gt;ä½¿ç”¨åŒæ ·çš„dockeré•œåƒï¼Œä¿®æ”¹cotnrollerä¸­&lt;code&gt;spec.template.spec.containers.env&lt;/code&gt;å­—æ®µä¸­çš„valueä¸ºä½ &lt;code&gt;sample-webapp&lt;/code&gt; serviceçš„åå­—ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- name: TARGET_HOST
  value: http://sample-webapp:8000
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;åˆ›å»ºcontroller-dockeré•œåƒ-å¯é€‰&#34;&gt;åˆ›å»ºController Dockeré•œåƒï¼ˆå¯é€‰ï¼‰&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;locust-master&lt;/code&gt;å’Œ&lt;code&gt;locust-work&lt;/code&gt; controllerä½¿ç”¨çš„éƒ½æ˜¯&lt;code&gt;locust-tasks&lt;/code&gt; dockeré•œåƒã€‚ä½ å¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–è¯‘ã€‚è‡ªå·±ç¼–è¯‘å¤§æ¦‚è¦èŠ±å‡ åˆ†é’Ÿæ—¶é—´ï¼Œé•œåƒå¤§å°ä¸º820Mã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker build -t index.tenxcloud.com/jimmy/locust-tasks:latest .
$ docker push index.tenxcloud.com/jimmy/locust-tasks:latest
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæˆ‘ä½¿ç”¨çš„æ˜¯æ—¶é€Ÿäº‘çš„é•œåƒä»“åº“ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªcontrollerçš„yamlçš„&lt;code&gt;spec.template.spec.containers.image&lt;/code&gt; å­—æ®µæŒ‡å®šçš„æ˜¯æˆ‘çš„é•œåƒï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;image: index.tenxcloud.com/jimmy/locust-tasks:latest
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;éƒ¨ç½²locust-master&#34;&gt;éƒ¨ç½²locust-master&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f locust-master-controller.yaml
$ kubectl create -f locust-master-service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;éƒ¨ç½²locust-worker&#34;&gt;éƒ¨ç½²locust-worker&lt;/h3&gt;

&lt;p&gt;Now deploy &lt;code&gt;locust-worker-controller&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f locust-worker-controller.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯ä»¥å¾ˆè½»æ˜“çš„ç»™workæ‰©å®¹ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl scale --replicas=20 replicationcontrollers locust-worker
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡WebUIï¼šDashboard - Workloads - Replication Controllers - &lt;strong&gt;ServiceName&lt;/strong&gt; - Scaleæ¥æ‰©å®¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/dashbaord-scale.jpg&#34; alt=&#34;dashboard-scale&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;é…ç½®traefik&#34;&gt;é…ç½®Traefik&lt;/h3&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/posts/traefik-ingress-installation/&#34;&gt;kubernetesçš„traefik ingresså®‰è£…&lt;/a&gt;ï¼Œåœ¨&lt;code&gt;ingress.yaml&lt;/code&gt;ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;  - host: traefik.locust.io
    http:
      paths:
      - path: /
        backend:
          serviceName: locust-master
          servicePort: 8089
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åæ‰§è¡Œ&lt;code&gt;kubectl replace -f ingress.yaml&lt;/code&gt;å³å¯æ›´æ–°traefikã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡Traefikçš„dashboardå°±å¯ä»¥çœ‹åˆ°åˆšå¢åŠ çš„&lt;code&gt;traefik.locust.io&lt;/code&gt;èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/traefik-dashboard-locust.jpg&#34; alt=&#34;traefik-dashboard-locust&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ‰§è¡Œæµ‹è¯•&#34;&gt;æ‰§è¡Œæµ‹è¯•&lt;/h2&gt;

&lt;p&gt;æ‰“å¼€&lt;code&gt;http://traefik.locust.io&lt;/code&gt;é¡µé¢ï¼Œç‚¹å‡»&lt;code&gt;Edit&lt;/code&gt;è¾“å…¥ä¼ªé€ çš„ç”¨æˆ·æ•°å’Œç”¨æˆ·æ¯ç§’å‘é€çš„è¯·æ±‚ä¸ªæ•°ï¼Œç‚¹å‡»&lt;code&gt;Start Swarming&lt;/code&gt;å°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/locust-start-swarming.jpg&#34; alt=&#34;locust-start-swarming&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è°ƒæ•´&lt;code&gt;sample-webapp&lt;/code&gt;çš„podä¸ªæ•°ï¼ˆé»˜è®¤è®¾ç½®äº†1ä¸ªpodï¼‰ï¼Œè§‚å¯Ÿpodçš„è´Ÿè½½å˜åŒ–æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/sample-webapp-rc.jpg&#34; alt=&#34;sample-webapp-rc&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä»ä¸€æ®µæ—¶é—´çš„è§‚å¯Ÿä¸­å¯ä»¥çœ‹åˆ°è´Ÿè½½è¢«å¹³å‡åˆ†é…ç»™äº†3ä¸ªpodã€‚&lt;/p&gt;

&lt;p&gt;åœ¨locustçš„é¡µé¢ä¸­å¯ä»¥å®æ—¶è§‚å¯Ÿä¹Ÿå¯ä»¥ä¸‹è½½æµ‹è¯•ç»“æœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/locust-dashboard.jpg&#34; alt=&#34;locust-dashboard&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/solutions/distributed-load-testing-using-kubernetes&#34;&gt;Distributed Load Testing Using Kubernetes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.csdn.net/article/2015-07-07/2825155&#34;&gt;è¿ç”¨Kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„IPå’ŒæœåŠ¡å‘ç°ä½“ç³»</title>
      <link>https://jimmysong.io/blog/ip-and-service-discovry-in-kubernetes/</link>
      <pubDate>Mon, 24 Apr 2017 16:11:16 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/ip-and-service-discovry-in-kubernetes/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;cluster-ip&#34;&gt;Cluster IP&lt;/h2&gt;

&lt;p&gt;å³Serviceçš„IPï¼Œé€šå¸¸åœ¨é›†ç¾¤å†…éƒ¨ä½¿ç”¨Service Nameæ¥è®¿é—®æœåŠ¡ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“è¯¥IPåœ°å€ï¼Œkubednsä¼šè‡ªåŠ¨æ ¹æ®service nameè§£æåˆ°æœåŠ¡çš„IPåœ°å€ï¼Œå°†æµé‡åˆ†å‘ç»™Podã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Service Nameæ‰æ˜¯å¯¹å¤–æš´éœ²æœåŠ¡çš„å…³é”®ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨kubeapiçš„é…ç½®ä¸­æŒ‡å®šè¯¥åœ°å€èŒƒå›´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é»˜è®¤é…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;--service-cluster-ip-range=10.254.0.0/16
--service-node-port-range=30000-32767
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;pod-ip&#34;&gt;Pod IP&lt;/h2&gt;

&lt;p&gt;é€šè¿‡é…ç½®flannelçš„&lt;code&gt;network&lt;/code&gt;å’Œ&lt;code&gt;subnet&lt;/code&gt;æ¥å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é»˜è®¤é…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;FLANNEL_NETWORK=172.30.0.0/16
FLANNEL_SUBNET=172.30.46.1/24
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podçš„IPåœ°å€&lt;u&gt;ä¸å›ºå®š&lt;/u&gt;ï¼Œå½“podé‡å¯æ—¶IPåœ°å€ä¼šå˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¯¥IPåœ°å€ä¹Ÿæ˜¯ç”¨æˆ·æ— éœ€å…³å¿ƒçš„ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯Flannelä¼šåœ¨æœ¬åœ°ç”Ÿæˆç›¸åº”IPæ®µçš„è™šæ‹Ÿç½‘å¡ï¼Œä¸ºäº†é˜²æ­¢å’Œé›†ç¾¤ä¸­çš„å…¶ä»–IPåœ°å€å†²çªï¼Œéœ€è¦è§„åˆ’IPæ®µã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä¸»æœº-node-ip&#34;&gt;ä¸»æœº/Node IP&lt;/h2&gt;

&lt;p&gt;ç‰©ç†æœºçš„IPåœ°å€ï¼Œå³kubernetesç®¡ç†çš„ç‰©ç†æœºçš„IPåœ°å€ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get nodes
NAME           STATUS    AGE       VERSION
172.20.0.113   Ready     12d       v1.6.0
172.20.0.114   Ready     12d       v1.6.0
172.20.0.115   Ready     12d       v1.6.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æœåŠ¡å‘ç°&#34;&gt;æœåŠ¡å‘ç°&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡DNSå³å¯å‘ç°ï¼Œkubendsæ˜¯kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä¸åŒæœåŠ¡ä¹‹é—´å¯ä»¥ç›´æ¥ä½¿ç”¨service nameè®¿é—®ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡&lt;code&gt;sericename:port&lt;/code&gt;å³å¯è°ƒç”¨æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœåŠ¡å¤–éƒ¨çš„æœåŠ¡å‘ç°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡Ingressæ¥å®ç°ï¼Œæˆ‘ä»¬æ˜¯ç”¨çš„&lt;strong&gt;Traefik&lt;/strong&gt;æ¥å®ç°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/kubernetes-ingress-resource/&#34;&gt;Ingressè§£æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/traefik-ingress-installation/&#34;&gt;Kubernetes Traefik Ingresså®‰è£…è¯•ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>
