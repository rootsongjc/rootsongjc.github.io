<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>å…¶ä»– - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="å®‹å‡€è¶…çš„åšå®¢">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.f6911c0ac7d2b5b69c3f2d9f2a2b3b496b5da0608580347fdb4dc11ef74f3ec5.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.f6911c0ac7d2b5b69c3f2d9f2a2b3b496b5da0608580347fdb4dc11ef74f3ec5.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/categories/%E5%85%B6%E4%BB%96/" />
  <meta property="og:title" content="å…¶ä»– | Jimmy Song" />
  <meta property="twitter:title" content="å…¶ä»– | Jimmy Song" />

  
  <meta property="og:description" content="å®‹å‡€è¶…çš„åšå®¢" />
  <meta property="twitter:description" content="å®‹å‡€è¶…çš„åšå®¢" />

  
  <meta property="og:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />
  <meta property="twitter:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">åšå®¢</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">èµ„æ–™</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">æ ‡ç­¾</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">å…¬å‘Š</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">è”ç³»</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">å…³äº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">ç¤¾åŒº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">è§†é¢‘ <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>æœç´¢</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">âŒ˜</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>ç«™å†…æœç´¢</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="å…³é—­"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="è¯·è¾“å…¥æœç´¢è¯" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="è¯·è¾“å…¥æœç´¢è¯">
        
        <div class="mt-4">
          <span>æœç´¢ç±»å‹: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">æ‰€æœ‰</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">åŸåˆ›</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">è¯‘æ–‡</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">èµ„æ–™</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">å…¬å‘Š</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    å…¶ä»–
                </p>
                <p class="page-description">
                    
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/cross-network-namespace-socket/">è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—ï¼šæ¢ç´¢ Linux å¥—æ¥å­—çš„ä½¿ç”¨</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/11/07</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—ï¼šæ¢ç´¢ Linux å¥—æ¥å­—çš„ä½¿ç”¨', 'ä»‹ç»å¦‚ä½•åœ¨ Linux ä¸­è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—ï¼Œå¹¶ä½¿ç”¨ Docker è¿›è¡Œæ¼”ç¤ºã€‚', '\næœ€è¿‘æˆ‘åœ¨ç ”ç©¶ Istio Ambient æ¨¡å¼ä¸­çš„é€æ˜æµé‡åŠ«æŒï¼Œè¿‡ç¨‹ä¸­æ¶‰åŠäº†è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—çš„åŠŸèƒ½ã€‚åœ¨ Istio å®˜æ–¹çš„åšå®¢ [Maturing Istio Ambient: Compatibility Across Various Kubernetes Providers and CNIs](https:\/\/istio.io\/latest\/blog\/2024\/inpod-traffic-redirection-ambient\/) ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘å¯¹ Linux å¥—æ¥å­— API çš„è¿™ä¸ªåŠŸèƒ½äº§ç”Ÿäº†æµ“åšçš„å…´è¶£ã€‚æ‰€ä»¥ï¼Œæˆ‘å†³å®šå†™ä¸‹è¿™ç¯‡åšå®¢ï¼Œåˆ†äº«å¦‚ä½•åœ¨ Linux ç³»ç»Ÿä¸­è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—çš„ç»†èŠ‚ã€‚\n\n## ç½‘ç»œå‘½åç©ºé—´ç®€ä»‹\n\nç½‘ç»œå‘½åç©ºé—´æ˜¯ä¸€ç§ Linux å†…æ ¸ç‰¹æ€§ï¼Œå¯ä»¥æŠŠç³»ç»Ÿçš„ç½‘ç»œèµ„æºï¼ˆä¾‹å¦‚ IP åœ°å€ã€è·¯ç”±è¡¨ç­‰ï¼‰åˆ†å‰²æˆå¤šä¸ªç‹¬ç«‹çš„å®ä¾‹ã€‚è¿™æ ·æ¯ä¸ªå®ä¾‹å°±å¯ä»¥ä¸ºä¸åŒçš„è¿›ç¨‹æä¾›ç‹¬ç«‹çš„ç½‘ç»œç¯å¢ƒã€‚æ¯”å¦‚ï¼ŒDocker ä½¿ç”¨ç½‘ç»œå‘½åç©ºé—´ä¸ºæ¯ä¸ªå®¹å™¨æä¾›ç‹¬ç«‹çš„ç½‘ç»œæ ˆï¼Œè®©å®ƒä»¬ä¹‹é—´çš„ç½‘ç»œèµ„æºäº’ç›¸éš”ç¦»ã€‚\n\né€šè¿‡ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸åŒçš„è¿›ç¨‹å¯ä»¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œé…ç½®ï¼Œæ¯”å¦‚ä¸åŒçš„ IP åœ°å€å’Œè·¯ç”±è®¾ç½®ã€‚ä½†å³ä½¿ç½‘ç»œå‘½åç©ºé—´å®ç°äº†éš”ç¦»ï¼ŒLinux çš„å¥—æ¥å­— API ä»ç„¶å¯ä»¥è®©è¿›ç¨‹è·¨ç½‘ç»œå‘½åç©ºé—´æ“ä½œå¥—æ¥å­—ã€‚\n\n## è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—\n\nåœ¨ä¸€ä¸ªå‘½åç©ºé—´ä¸­è¿è¡Œçš„è¿›ç¨‹å¯ä»¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶å°†å®ƒæ”¾åˆ°å¦ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ä¸­ï¼Œè¿™è®©æˆ‘ä»¬å¯ä»¥å®ç°éå¸¸çµæ´»çš„ç½‘ç»œé€šä¿¡ã€‚æ¯”å¦‚ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œå‘½åç©ºé—´ä¸­åˆ›å»ºç›‘å¬å¥—æ¥å­—ï¼Œè®©å…¶ä»–å‘½åç©ºé—´ä¸­çš„è¿›ç¨‹å…±äº«è¿™ä¸ªå¥—æ¥å­—ã€‚è¿™ç§åŠŸèƒ½åœ¨å®¹å™¨ç¼–æ’å’Œå¾®æœåŠ¡æ¶æ„ä¸­éå¸¸æœ‰ç”¨ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½¿ç”¨ \u0060nc\u0060 å‘½ä»¤åˆ›å»ºå¥—æ¥å­—ï¼Œä½¿å…¶ç»‘å®šåˆ°æŒ‡å®šçš„ç½‘ç»œè®¾å¤‡æˆ–å‘½åç©ºé—´ã€‚\n\n\u0060\u0060\u0060mermaid\ngraph TD;\n    A[åˆ›å»ºç›‘å¬å¥—æ¥å­—] --\u003e B[è·¨ç½‘ç»œå‘½åç©ºé—´ä¼ é€’]\n    B --\u003e C[å…¶ä»–å‘½åç©ºé—´ä¸­çš„è¿›ç¨‹å…±äº«å¥—æ¥å­—]\n\u0060\u0060\u0060\n\n![Mermaid Diagram](f04c2c199e66b82ef451c2e3c2be99e1.svg)\n\n## ä½¿ç”¨ Docker æ¼”ç¤ºè¿™ä¸€åŠŸèƒ½\n\nå› ä¸ºæˆ‘ä½¿ç”¨çš„ macOS ä¸æ”¯æŒ Linux çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œä½†å¯ä»¥ä½¿ç”¨ Docker Desktop æ¨¡æ‹Ÿç›¸åº”çš„ç¯å¢ƒã€‚ä¸‹é¢æ˜¯åœ¨ macOS ä¸Šä½¿ç”¨ Docker æ¥æ¼”ç¤ºçš„æ–¹æ³•ï¼š\n\n\u0060\u0060\u0060mermaid\ngraph LR;\n    A[Docker Desktop] --\u003e B[åˆ›å»ºä¸€ä¸ªç½‘ç»œæ¥å£]\n    B --\u003e C[åˆ›å»ºä¸¤ä¸ªå®¹å™¨]\n    C --\u003e D[è¿æ¥åˆ°åŒä¸€ä¸ªè™šæ‹Ÿç½‘ç»œ]\n    D --\u003e E[å®¹å™¨é—´ç›¸äº’é€šä¿¡]\n\u0060\u0060\u0060\n\n![Mermaid Diagram](73a1a7081b41c63c1e7f98a87e4f8580.svg)\n\n1. **å®‰è£… Docker Desktop**\n\n   - ä¸‹è½½å¹¶å®‰è£… Docker Desktopï¼Œå¯ä»¥åœ¨ macOS ä¸Šè¿è¡Œ Linux å®¹å™¨ã€‚\n   - å¯åŠ¨ Docker Desktop åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨ä¸­æ¨¡æ‹Ÿç½‘ç»œå‘½åç©ºé—´çš„ç›¸å…³æ“ä½œã€‚\n\n2. **é…ç½®è™šæ‹Ÿç½‘ç»œ**\n\n   - åˆ›å»ºè™šæ‹Ÿç½‘ç»œæ¥å£\n     \u0060\u0060\u0060bash\n     docker network create --driver bridge my_bridge\n     \u0060\u0060\u0060\n   - ä¸ºæ¯ä¸ªå®¹å™¨åˆ†é… IP åœ°å€ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ã€‚\n\n3. **åˆ›å»ºç½‘ç»œå‘½åç©ºé—´ï¼ˆä½¿ç”¨ Docker å®¹å™¨æ¨¡æ‹Ÿï¼‰**\n\n   - ä½¿ç”¨ Docker åˆ›å»ºä¸¤ä¸ªå®¹å™¨ï¼Œåˆ†åˆ«æ¨¡æ‹Ÿä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼š\n     \u0060\u0060\u0060bash\n     docker run -d --name ns1 --network my_bridge --privileged alpine sleep infinity\n     docker run -d --name ns2 --network my_bridge --privileged alpine sleep infinity\n     \u0060\u0060\u0060\n     \n   - åˆ›å»ºå®¹å™¨æ—¶ç›´æ¥å°†å®ƒä»¬è¿æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ã€‚\n\n4. **è·¨å‘½åç©ºé—´åˆ›å»ºå¥—æ¥å­—**\n\n   ä½¿ç”¨ \u0060docker exec\u0060 å‘½ä»¤è¿›å…¥å®¹å™¨å¹¶é…ç½®ç½‘ç»œæ¥å£ï¼š\n\n   - åœ¨ \u0060ns1\u0060 å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªç›‘å¬å¥—æ¥å­—ï¼š\n     \u0060\u0060\u0060bash\n     docker exec ns1 sh -c \u0022nc -l -k -p 8080\u0022\n     \u0060\u0060\u0060\n     \n   - è·å– \u0060ns1\u0060 å®¹å™¨çš„ IP åœ°å€ï¼š\n     \n     \u0060\u0060\u0060bash\n     export NS1_IP=$(docker inspect -f \u0027{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}\u0027 ns1)\n     \u0060\u0060\u0060\n     \n   - åœ¨ \u0060ns2\u0060 å®¹å™¨ä¸­ï¼Œä½¿ç”¨ \u0060nc\u0060 å‘½ä»¤è®¿é—® \u0060ns1\u0060 å®¹å™¨ä¸­çš„å¥—æ¥å­—ï¼š\n     \u0060\u0060\u0060bash\n     docker exec ns2 sh -c \u0022echo \u0027Hello from ns2\u0027 | nc $NS1_IP 8080\u0022\n     \u0060\u0060\u0060\n     \n   - æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ \u0060ns1\u0060 å®¹å™¨çš„ç•Œé¢ä¸­çœ‹åˆ°æ¥è‡ª \u0060ns2\u0060 å®¹å™¨çš„ \u0060Hello from ns2\u0060 å­—ç¬¦ä¸²ã€‚å°½ç®¡ \u0060ns1\u0060 å’Œ \u0060ns2\u0060 å±äºä¸åŒçš„å®¹å™¨ï¼Œä½†é€šè¿‡æ­£ç¡®çš„é…ç½®ï¼Œ\u0060ns2\u0060 ä»ç„¶å¯ä»¥è®¿é—® \u0060ns1\u0060 ä¸­çš„å¥—æ¥å­—ã€‚\n\nå¯ä»¥ç†è§£ä¸ºé€šè¿‡åœ¨ \u0060ns2\u0060 ç›‘å¬ \u0060ns1\u0060 çš„å¥—æ¥å­—ï¼Œç±»ä¼¼äºå»ºç«‹äº†ä¸€ä¸ªâ€œéš§é“â€æ¥å®ç°é€šä¿¡ã€‚è¿™ç§æ–¹å¼å®é™…ä¸Šæ˜¯å»ºç«‹äº†ä¸€æ¡ç›´æ¥çš„é€šä¿¡é€šé“ï¼Œä½¿å¾—ä¸¤ä¸ªå®¹å™¨ä¹‹é—´èƒ½å¤Ÿè¿›è¡Œæ•°æ®äº¤æ¢ã€‚è™½ç„¶å®ƒæ²¡æœ‰çœŸæ­£æ„å»º VPN é‚£æ ·å¤æ‚çš„éš§é“ï¼Œä½†ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œ\u0060ns2\u0060 å’Œ \u0060ns1\u0060 ä¹‹é—´å¯ä»¥é€šè¿‡è¿™ä¸ªå¥—æ¥å­—æ¥ä¼ é€’æ•°æ®ï¼Œç›¸å½“äºå»ºç«‹äº†ä¸€ä¸ªè½»é‡çº§çš„ç‚¹å¯¹ç‚¹è¿æ¥é€šé“ã€‚\n\n## å®é™…åº”ç”¨åœºæ™¯\n\nè¿™ç§â€œéš§é“â€å¼çš„é€šä¿¡åœ¨è®¸å¤šå®é™…åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\n1. **é€æ˜ä»£ç†å’Œè´Ÿè½½å‡è¡¡**ï¼šé€šè¿‡å¥—æ¥å­—éš§é“å¯ä»¥å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°æœåŠ¡å®¹å™¨ä¸­ï¼Œå¸¸ç”¨äºé€æ˜ä»£ç†æˆ–è´Ÿè½½å‡è¡¡ã€‚Istioã€**Envoy Proxy** å’Œ **HAProxy** ç­‰å·¥å…·åˆ©ç”¨ç±»ä¼¼æœºåˆ¶æ¥ç®¡ç†æœåŠ¡é—´æµé‡ã€‚\n2. **è·¨å®¹å™¨æ—¥å¿—æ”¶é›†**ï¼šé€šè¿‡å¥—æ¥å­—éš§é“ï¼Œå¯ä»¥å°†å¤šä¸ªå®¹å™¨çš„æ—¥å¿—é›†ä¸­æ”¶é›†åˆ°ä¸€ä¸ªå¤„ç†å®¹å™¨ä¸­ã€‚**Fluentd** å’Œ **Logstash** æ˜¯å¸¸ç”¨çš„æ—¥å¿—æ”¶é›†å·¥å…·ï¼Œç”¨äºç®€åŒ–æ—¥å¿—å¤„ç†ã€‚\n3. **å®‰å…¨å®¡æŸ¥å’Œå…¥ä¾µæ£€æµ‹**ï¼šå°†å¤šä¸ªå‘½åç©ºé—´çš„æµé‡é›†ä¸­åˆ°ä¸€ä¸ªç›‘æ§å®¹å™¨ä¸­è¿›è¡Œç»Ÿä¸€æ£€æµ‹ã€‚**Suricata**ã€**Snort** å’Œ **Zeek** ç­‰å¼€æºå·¥å…·å¯ç”¨äºç½‘ç»œå®‰å…¨åˆ†æå’Œå®¡æŸ¥ã€‚\n4. **è°ƒè¯•å’Œæµ‹è¯•**ï¼šå¼€å‘äººå‘˜å¯ä»¥å°†æµ‹è¯•æµé‡è½¬å‘åˆ°å…¶ä»–å‘½åç©ºé—´çš„æœåŠ¡ï¼Œç”¨äºéªŒè¯å’Œè°ƒè¯•ã€‚**Wireshark** å¯ä»¥ç”¨äºæ•è·ç½‘ç»œåŒ…ï¼Œä»¥ä¾¿è¿›è¡Œæ·±å…¥çš„ç½‘ç»œè°ƒè¯•å’Œåˆ†æã€‚\n\n## æ€»ç»“\n\nè·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—åœ¨å®¹å™¨ç®¡ç†ã€è°ƒåº¦ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„ä¸­æœ‰å¾ˆå¤šåº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹å¼å®ç°æœåŠ¡çš„é€æ˜è´Ÿè½½å‡è¡¡ï¼Œå»ºç«‹éš§é“æˆ–è¿›è¡Œç½‘ç»œæµé‡è°ƒè¯•ã€‚ä½†è¿™ç§çµæ´»æ€§ä¹Ÿè¦æ±‚æˆ‘ä»¬åœ¨è®¾è®¡ç½‘ç»œå®‰å…¨ç­–ç•¥æ—¶æ›´åŠ è°¨æ…ï¼Œä»¥é˜²æ­¢ä¸åŒå‘½åç©ºé—´ä¹‹é—´çš„æ½œåœ¨é€šä¿¡å¸¦æ¥çš„å®‰å…¨é—®é¢˜ã€‚\n', '\/blog\/cross-network-namespace-socket\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">ä»‹ç»å¦‚ä½•åœ¨ Linux ä¸­è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—ï¼Œå¹¶ä½¿ç”¨ Docker è¿›è¡Œæ¼”ç¤ºã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/noisy-neighbor-detection-with-ebpf/">[è¯‘] ä½¿ç”¨ eBPF æ£€æµ‹å’Œä¼˜åŒ– Linux å®¹å™¨çš„å™ªå£°é‚»å±…é—®é¢˜</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/09/12</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://netflixtechblog.com/noisy-neighbor-detection-with-ebpf-64b1f4b3bbdd" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä½¿ç”¨ eBPF æ£€æµ‹å’Œä¼˜åŒ– Linux å®¹å™¨çš„å™ªå£°é‚»å±…é—®é¢˜', 'Netflix åˆ©ç”¨ eBPF æŠ€æœ¯å®ç°äº† Linux è°ƒåº¦å™¨çš„ä½å¼€é”€æŒç»­æ£€æµ‹ï¼Œæœ‰æ•ˆåœ°ç›‘æ§å’Œä¼˜åŒ–äº†å¤šç§Ÿæˆ·ç¯å¢ƒä¸­å®¹å™¨çš„å™ªå£°é‚»å±…é—®é¢˜ã€‚', '\nNetflix çš„è®¡ç®—ä¸æ€§èƒ½å·¥ç¨‹å›¢é˜Ÿå®šæœŸè°ƒæŸ¥æˆ‘ä»¬å¤šç§Ÿæˆ·ç¯å¢ƒä¸­çš„æ€§èƒ½é—®é¢˜ã€‚é¦–å…ˆæ˜¯ç¡®å®šé—®é¢˜æ˜¯æºè‡ªåº”ç”¨ç¨‹åºè¿˜æ˜¯åº•å±‚åŸºç¡€è®¾æ–½ã€‚ä¸€ä¸ªç»å¸¸å¤æ‚åŒ–è¿™ä¸€è¿‡ç¨‹çš„é—®é¢˜æ˜¯â€œå™ªå£°é‚»å±…â€é—®é¢˜ã€‚åœ¨æˆ‘ä»¬çš„å¤šç§Ÿæˆ·è®¡ç®—å¹³å° [Titus](https:\/\/netflixtechblog.com\/titus-the-netflix-container-management-platform-is-now-open-source-f868c9fb5436)ï¼Œâ€œå™ªå£°é‚»å±…â€æŒ‡çš„æ˜¯å¤§é‡ä½¿ç”¨æœåŠ¡å™¨èµ„æºçš„å®¹å™¨æˆ–ç³»ç»ŸæœåŠ¡ï¼Œå¯¼è‡´ç›¸é‚»å®¹å™¨çš„æ€§èƒ½ä¸‹é™ã€‚æˆ‘ä»¬é€šå¸¸å…³æ³¨ CPU åˆ©ç”¨ç‡ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬å·¥ä½œè´Ÿè½½ä¸­å™ªå£°é‚»å±…é—®é¢˜çš„æœ€å¸¸è§æ¥æºã€‚\n\næ£€æµ‹å™ªå£°é‚»å±…çš„å½±å“æ˜¯å¤æ‚çš„ã€‚ä¼ ç»Ÿçš„æ€§èƒ½åˆ†æå·¥å…·å¦‚ [perf](https:\/\/www.brendangregg.com\/perf.html) å¯èƒ½ä¼šå¼•å…¥æ˜¾è‘—çš„å¼€é”€ï¼Œä»è€ŒåŠ å‰§æ€§èƒ½ä¸‹é™ã€‚æ­¤å¤–ï¼Œè¿™äº›å·¥å…·é€šå¸¸åœ¨äº‹åéƒ¨ç½²ï¼Œå¯¹æœ‰æ•ˆè°ƒæŸ¥æ¥è¯´å·²ç»å¤ªè¿Ÿäº†ã€‚å¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼Œè°ƒè¯•å™ªå£°é‚»å±…é—®é¢˜éœ€è¦ç›¸å½“çš„åº•å±‚ä¸“ä¸šçŸ¥è¯†å’Œä¸“é—¨çš„å·¥å…·ã€‚åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨ [eBPF](https:\/\/ebpf.io\/) å®ç° Linux è°ƒåº¦å™¨çš„æŒç»­ã€ä½å¼€é”€çš„æ£€æµ‹ï¼Œæœ‰æ•ˆåœ°è‡ªåŠ©ç›‘æ§å™ªå£°é‚»å±…é—®é¢˜ã€‚ä½ å°†å­¦ä¹ åˆ° Linux å†…æ ¸æ£€æµ‹å¦‚ä½•æ”¹å–„ä½ çš„åŸºç¡€è®¾æ–½å¯è§‚æµ‹æ€§ï¼Œå¹¶å¸¦æ¥æ›´æ·±å…¥çš„æ´å¯Ÿå’Œå¢å¼ºçš„ç›‘æ§ã€‚\n\n## æŒç»­æ£€æµ‹ Linux è°ƒåº¦å™¨\n\nä¸ºäº†ç¡®ä¿æˆ‘ä»¬ä¾èµ–ä½å»¶è¿Ÿå“åº”çš„å·¥ä½œè´Ÿè½½çš„å¯é æ€§ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªå®¹å™¨çš„ [run queue](https:\/\/en.wikipedia.org\/wiki\/Run_queue) å»¶è¿Ÿè¿›è¡Œäº†æ£€æµ‹ï¼Œè¿™ä¸ªæŒ‡æ ‡è¡¡é‡è¿›ç¨‹åœ¨è°ƒåº¦é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ´¾å‘åˆ° CPU çš„æ—¶é—´ã€‚åœ¨æ­¤é˜Ÿåˆ—ä¸­çš„é•¿æ—¶é—´ç­‰å¾…å¯èƒ½æ˜¯æ€§èƒ½é—®é¢˜çš„å¾å…†ï¼Œå°¤å…¶æ˜¯å½“å®¹å™¨æ²¡æœ‰ä½¿ç”¨å…¶å…¨éƒ¨ CPU åˆ†é…æ—¶ã€‚æŒç»­çš„æ£€æµ‹å¯¹äºæŠ“ä½è¿™ç±»é—®é¢˜è‡³å…³é‡è¦ï¼Œè€Œ eBPF é€šè¿‡æœ€å°çš„å¼€é”€è¿›å…¥ Linux è°ƒåº¦å™¨ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°ç›‘æ§ run queue å»¶è¿Ÿã€‚\n\nä¸ºäº†å‘å‡º run queue å»¶è¿ŸæŒ‡æ ‡ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†ä¸‰ä¸ª eBPF é’©å­ï¼š\u0060sched_wakeup\u0060ã€\u0060sched_wakeup_new\u0060 å’Œ \u0060sched_switch\u0060ã€‚\n\n![å›¾ 1ï¼šæµ‹é‡å’Œæ£€æµ‹ run queue å»¶è¿Ÿçš„å›¾ç¤º](f1.png)\n\n\u0060sched_wakeup\u0060 å’Œ \u0060sched_wakeup_new\u0060 é’©å­åœ¨è¿›ç¨‹çŠ¶æ€ä»â€œç¡çœ â€å˜ä¸ºâ€œå¯è¿è¡Œâ€æ—¶è°ƒç”¨ã€‚å®ƒä»¬è®©æˆ‘ä»¬è¯†åˆ«å‡ºè¿›ç¨‹å‡†å¤‡è¿è¡Œå¹¶ç­‰å¾… CPU æ—¶é—´çš„æ—¶åˆ»ã€‚åœ¨æ­¤äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå¹¶ä½¿ç”¨è¿›ç¨‹ ID ä½œä¸ºé”®ï¼Œå°†å…¶å­˜å‚¨åœ¨ eBPF å“ˆå¸Œå›¾ä¸­ã€‚\n\n\u0060\u0060\u0060c\u002b\u002b\nstruct {\n    __uint(type, BPF_MAP_TYPE_HASH);\n    __uint(max_entries, MAX_TASK_ENTRIES);\n    __uint(key_size, sizeof(u32));\n    __uint(value_size, sizeof(u64));\n} runq_enqueued SEC(\u0022.maps\u0022);\n\nSEC(\u0022tp_btf\/sched_wakeup\u0022)\nint tp_sched_wakeup(u64 *ctx)\n{\n    struct task_struct *task = (void *)ctx[0];\n    u32 pid = task-\u003epid;\n    u64 ts = bpf_ktime_get_ns();\n\n    bpf_map_update_elem(\u0026runq_enqueued, \u0026pid, \u0026ts, BPF_NOEXIST);\n    return 0;\n}\n\u0060\u0060\u0060\n\nç›¸åï¼Œ\u0060sched_switch\u0060 é’©å­åœ¨ CPU åœ¨è¿›ç¨‹é—´åˆ‡æ¢æ—¶è§¦å‘ã€‚è¿™ä¸ªé’©å­æä¾›äº†å½“å‰åˆ©ç”¨ CPU çš„è¿›ç¨‹å’Œå³å°†æ¥ç®¡çš„è¿›ç¨‹çš„æŒ‡é’ˆã€‚æˆ‘ä»¬ä½¿ç”¨å³å°†æ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹ ID (PID) æ¥è·å–ä¹‹å‰å­˜å‚¨çš„æ—¶é—´æˆ³ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ç®€å•åœ°å‡å»æ—¶é—´æˆ³æ¥è®¡ç®— run queue å»¶è¿Ÿã€‚\n\n\u0060\u0060\u0060c\u002b\u002b\nSEC(\u0022tp_btf\/sched_switch\u0022)\nint tp_sched_switch(u64 *ctx)\n{\n    struct task_struct *prev = (struct task_struct *)ctx[1];\n    struct task_struct *next = (struct task_struct *)ctx[2];\n    u32 prev_pid = prev-\u003epid;\n    u32 next_pid = next-\u003epid;\n \n    \/\/ è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡å…¥é˜Ÿçš„æ—¶é—´æˆ³\n    u64 *tsp = bpf_map_lookup_elem(\u0026runq_enqueued, \u0026next_pid);\n    if (tsp == NULL) {\n        return 0; \/\/ æœªè®°å½•å…¥é˜Ÿ\n    }\n\n    \/\/ åœ¨åˆ é™¤å­˜å‚¨çš„æ—¶é—´æˆ³å‰è®¡ç®— runq å»¶è¿Ÿ\n    u64 now = bpf_ktime_get_ns();\n    u64 runq_lat = now - *tsp;\n\n    \/\/ ä» enqueued å›¾ä¸­åˆ é™¤ PID\n    bpf_map_delete_elem(\u0026runq_enqueued, \u0026next_pid);\n    ....\n\u0060\u0060\u0060\n\neBPF çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯å®ƒèƒ½æä¾›æŒ‡å‘å®é™…å†…æ ¸æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼Œè¿™äº›ç»“æ„ä»£è¡¨è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œä¹Ÿç§°ä¸ºå†…æ ¸æœ¯è¯­ä¸­çš„ä»»åŠ¡ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®å…³äºè¿›ç¨‹å­˜å‚¨çš„å¤§é‡ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦è¿›ç¨‹çš„ cgroup ID ä»¥å°†å…¶ä¸å®¹å™¨å…³è”ï¼Œä½†æ˜¯è¿›ç¨‹ç»“æ„ä¸­çš„ cgroup ä¿¡æ¯å—åˆ° [RCU (Read Copy Update) é”](https:\/\/elixir.bootlin.com\/linux\/v6.6.16\/source\/include\/linux\/sched.h#L1225) çš„ä¿æŠ¤ã€‚\n\nä¸ºäº†å®‰å…¨åœ°è®¿é—®è¿™äº›å— RCU ä¿æŠ¤çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ eBPF ä¸­çš„ [kfuncs](https:\/\/docs.kernel.org\/bpf\/kfuncs.html)ã€‚kfuncs æ˜¯å¯ä»¥ä» eBPF ç¨‹åºè°ƒç”¨çš„å†…æ ¸å‡½æ•°ã€‚è¿™äº›å‡½æ•°ç¡®ä¿æˆ‘ä»¬çš„ eBPF ç¨‹åºåœ¨æ£€ç´¢ä»»åŠ¡ç»“æ„ä¸­çš„ cgroup ID æ—¶ä¿æŒå®‰å…¨å’Œé«˜æ•ˆã€‚\n\n\u0060\u0060\u0060c\u002b\u002b\nvoid bpf_rcu_read_lock(void) __ksym;\nvoid bpf_rcu_read_unlock(void) __ksym;\n\nu64 get_task_cgroup_id(struct task_struct *task)\n{\n    struct css_set *cgroups;\n    u64 cgroup_id;\n    bpf_rcu_read_lock();\n    cgroups = task-\u003ecgroups;\n    cgroup_id = cgroups-\u003edfl_cgrp-\u003ekn-\u003eid;\n    bpf_rcu_read_unlock();\n    return cgroup_id;\n}\n\u0060\u0060\u0060\n\næ•°æ®å‡†å¤‡å¥½åï¼Œæˆ‘ä»¬å¿…é¡»å°†å…¶æ‰“åŒ…å¹¶å‘é€åˆ°ç”¨æˆ·ç©ºé—´ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©äº† eBPF [ç¯å½¢ç¼“å†²åŒº](https:\/\/nakryiko.com\/posts\/bpf-ringbuf\/)ã€‚å®ƒæ—¢é«˜æ•ˆåˆé«˜æ€§èƒ½ï¼Œä¸”ç”¨æˆ·å‹å¥½ã€‚å®ƒå¯ä»¥å¤„ç†å˜é•¿æ•°æ®è®°å½•ï¼Œå¹¶å…è®¸æ•°æ®è¯»å–è€Œæ— éœ€é¢å¤–çš„å†…å­˜å¤åˆ¶æˆ–ç³»ç»Ÿè°ƒç”¨ã€‚ç„¶è€Œï¼Œå¤§é‡æ•°æ®ç‚¹ä½¿å¾—ç”¨æˆ·ç©ºé—´ç¨‹åºçš„ CPU ä½¿ç”¨è¿‡å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ eBPF ä¸­å®æ–½äº†é€Ÿç‡é™åˆ¶ä»¥é‡‡æ ·æ•°æ®ã€‚\n\n\u0060\u0060\u0060c\u002b\u002b\nstruct {\n    __uint(type, BPF_MAP_TYPE_RINGBUF);\n    __uint(max_entries, RINGBUF_SIZE_BYTES);\n} events SEC(\u0022.maps\u0022);\n\nstruct {\n    __uint(type, BPF_MAP_TYPE_PERCPU_HASH);\n    __uint(max_entries, MAX_TASK_ENTRIES);\n    __uint(key_size, sizeof(u64));\n    __uint(value_size, sizeof(u64));\n} cgroup_id_to_last_event_ts SEC(\u0022.maps\u0022);\n\nstruct\n\n runq_event {\n    u64 prev_cgroup_id;\n    u64 cgroup_id;\n    u64 runq_lat;\n    u64 ts;\n};\n\nSEC(\u0022tp_btf\/sched_switch\u0022)\nint tp_sched_switch(u64 *ctx)\n{\n    \/\/ ....\n    \/\/ ä¸Šè¿°ä»£ç \n    \/\/ ....\n \n    u64 prev_cgroup_id = get_task_cgroup_id(prev);\n    u64 cgroup_id = get_task_cgroup_id(next);\n \n    \/\/ æŒ‰æ¯ä¸ª cgroup ID æ¯ä¸ª CPU è¿›è¡Œé€Ÿç‡é™åˆ¶\n    \/\/ å¹³è¡¡å¯è§‚æµ‹æ€§ä¸æ€§èƒ½å¼€é”€\n    u64 *last_ts = \n        bpf_map_lookup_elem(\u0026cgroup_id_to_last_event_ts, \u0026cgroup_id);\n    u64 last_ts_val = last_ts == NULL ? 0 : *last_ts;\n\n    \/\/ åœ¨è¿›è¡Œæ›´å¤šå·¥ä½œä¹‹å‰æ£€æŸ¥è€ƒè™‘ä¸­çš„ cgroup ID çš„é€Ÿç‡é™åˆ¶\n    if (now - last_ts_val \u003c RATE_LIMIT_NS) {\n        \/\/ é€Ÿç‡é™åˆ¶è¶…å‡ºï¼Œä¸¢å¼ƒäº‹ä»¶\n        return 0;\n    }\n\n    struct runq_event *event;\n    event = bpf_ringbuf_reserve(\u0026events, sizeof(*event), 0);\n  \n    if (event) {\n        event-\u003eprev_cgroup_id = prev_cgroup_id;\n        event-\u003ecgroup_id = cgroup_id;\n        event-\u003erunq_lat = runq_lat;\n        event-\u003ets = now;\n        bpf_ringbuf_submit(event, 0);\n        \/\/ æ›´æ–°å½“å‰ cgroup ID çš„æœ€åä¸€ä¸ªäº‹ä»¶æ—¶é—´æˆ³\n        bpf_map_update_elem(\u0026cgroup_id_to_last_event_ts, \u0026cgroup_id,\n            \u0026now, BPF_ANY);\n\n    }\n\n    return 0;\n}\n\u0060\u0060\u0060\n\næˆ‘ä»¬åœ¨ Go å¼€å‘çš„ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºå¤„ç†ç¯å½¢ç¼“å†²åŒºä¸­çš„äº‹ä»¶ï¼Œä»¥å‘æˆ‘ä»¬çš„åº¦é‡åç«¯ [Atlas](https:\/\/netflixtechblog.com\/introducing-atlas-netflixs-primary-telemetry-platform-bd31f4d8ed9a) å‘å‡ºåº¦é‡ã€‚æ¯ä¸ªäº‹ä»¶åŒ…å«ä¸€ä¸ªå¸¦æœ‰ cgroup ID çš„ run queue å»¶è¿Ÿæ ·æœ¬ï¼Œæˆ‘ä»¬å°†å…¶ä¸ä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨å…³è”ã€‚å¦‚æœæ²¡æœ‰å‘ç°è¿™ç§å…³è”ï¼Œæˆ‘ä»¬ä¼šå°†å…¶åˆ†ç±»ä¸ºç³»ç»ŸæœåŠ¡ã€‚å½“ cgroup ID ä¸å®¹å™¨å…³è”æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸ºè¯¥å®¹å™¨å‘å‡ºç™¾åˆ†ä½è®¡æ—¶å™¨ Atlas åº¦é‡ï¼ˆ\u0060runq.latency\u0060ï¼‰ã€‚æˆ‘ä»¬è¿˜å¢åŠ äº†ä¸€ä¸ªè®¡æ•°å™¨åº¦é‡ï¼ˆ\u0060sched.switch.out\u0060ï¼‰æ¥ç›‘æ§å®¹å™¨è¿›ç¨‹çš„æŠ¢å æƒ…å†µã€‚é€šè¿‡è®¿é—®è¢«æŠ¢å è¿›ç¨‹çš„ \u0060prev_cgroup_id\u0060ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåº¦é‡æ ‡è®°æŠ¢å çš„åŸå› ï¼Œæ— è®ºæ˜¯åŒä¸€å®¹å™¨ï¼ˆæˆ– cgroupï¼‰å†…çš„è¿›ç¨‹ã€å¦ä¸€ä¸ªå®¹å™¨çš„è¿›ç¨‹è¿˜æ˜¯ç³»ç»ŸæœåŠ¡çš„è¿›ç¨‹ã€‚\n\nå€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œ\u0060runq.latency\u0060 åº¦é‡å’Œ \u0060sched.switch.out\u0060 åº¦é‡éƒ½éœ€è¦ç¡®å®šå®¹å™¨æ˜¯å¦å—åˆ°å™ªå£°é‚»å±…çš„å½±å“ï¼Œè¿™æ˜¯æˆ‘ä»¬æ—¨åœ¨å®ç°çš„ç›®æ ‡ã€‚å•ç‹¬ä¾èµ– \u0060runq.latency\u0060 åº¦é‡å¯èƒ½ä¼šå¯¼è‡´è¯¯è§£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¹å™¨å¤„äºæˆ–è¶…è¿‡å…¶ cgroup CPU é™åˆ¶ï¼Œè°ƒåº¦å™¨å°†å¯¹å…¶è¿›è¡Œé™åˆ¶ï¼Œå¯¼è‡´é˜Ÿåˆ—ä¸­çš„å»¶è¿Ÿæ˜æ˜¾å¢åŠ ã€‚å¦‚æœæˆ‘ä»¬åªè€ƒè™‘è¿™ä¸ªåº¦é‡ï¼Œæˆ‘ä»¬å¯èƒ½é”™è¯¯åœ°å°†æ€§èƒ½ä¸‹é™å½’å’äºå™ªå£°é‚»å±…ï¼Œè€Œå®é™…ä¸Šæ˜¯å› ä¸ºå®¹å™¨è§¦åŠäº†å…¶ CPU é…é¢ã€‚ç„¶è€Œï¼Œå½“ä¸¤ä¸ªåº¦é‡åŒæ—¶å‡ºç°å°–å³°ï¼Œå°¤å…¶æ˜¯å½“åŸå› æ˜¯ä¸åŒå®¹å™¨æˆ–ç³»ç»Ÿè¿›ç¨‹æ—¶ï¼Œæ˜æ˜¾è¡¨æ˜äº†å™ªå£°é‚»å±…é—®é¢˜ã€‚\n\n## å™ªå£°é‚»å±…çš„æ•…äº‹\n\nä»¥ä¸‹æ˜¯ä¸€å°è¿è¡Œå•ä¸ªå®¹å™¨çš„æœåŠ¡å™¨çš„ \u0060runq.latency\u0060 åº¦é‡ï¼Œè¯¥å®¹å™¨æ‹¥æœ‰å……è¶³çš„ CPU å®¹é‡ã€‚99 ç™¾åˆ†ä½å¹³å‡ä¸º 83.4 å¾®ç§’ï¼ˆå¾®ç§’ï¼‰ï¼Œä½œä¸ºæˆ‘ä»¬çš„åŸºå‡†ã€‚å°½ç®¡æœ‰äº›å°–å³°è¾¾åˆ° 400 å¾®ç§’ï¼Œä½†å»¶è¿Ÿä»åœ¨å¯æ¥å—çš„å‚æ•°èŒƒå›´å†…ã€‚\n\n![](f2.png)\n\ncontainer1 çš„ 99 ç™¾åˆ†ä½ runq.latency å¹³å‡ä¸º 83 å¾®ç§’ï¼ˆå¾®ç§’ï¼‰ï¼Œå°–å³°å¯è¾¾ 400 å¾®ç§’ï¼Œæ²¡æœ‰ç›¸é‚»å®¹å™¨ã€‚è¿™ä½œä¸ºä¸€ä¸ªå®¹å™¨åœ¨ä¸»æœºä¸Šæœªäº‰å¤º CPU çš„åŸºå‡†ã€‚\n\nåœ¨ 10:35ï¼Œå¯åŠ¨ \u0060container2\u0060ï¼Œå®ƒå……åˆ†åˆ©ç”¨äº†ä¸»æœºä¸Šçš„æ‰€æœ‰ CPUï¼Œå¯¼è‡´ \u0060container1\u0060 çš„ P99 run queue å»¶è¿Ÿå‡ºç°äº† 131 æ¯«ç§’çš„å°–å³°ï¼ˆ131,000 å¾®ç§’ï¼‰ã€‚å¦‚æœç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºæ­£åœ¨æœåŠ¡ HTTP æµé‡ï¼Œåˆ™è¿™ä¸€å°–å³°å°†åœ¨ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºä¸­å¯è§ã€‚å¦‚æœç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºæ‰€æœ‰è€…æŠ¥å‘Šäº†æ— æ³•è§£é‡Šçš„å»¶è¿Ÿå°–å³°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ run queue å»¶è¿Ÿåº¦é‡è¿…é€Ÿè¯†åˆ«å™ªå£°é‚»å±…é—®é¢˜ã€‚\n\n![](f3.png)\n\nåœ¨ 10:35 å¯åŠ¨çš„ container2 å……åˆ†åˆ©ç”¨äº†ä¸»æœºä¸Šçš„æ‰€æœ‰ CPUï¼Œ**å¯¼è‡´ container1 çš„ P99 run queue å»¶è¿Ÿå‡ºç°äº† 131 æ¯«ç§’çš„å°–å³°**ï¼Œå› ä¸ºç³»ç»Ÿè¿›ç¨‹çš„æŠ¢å å¢åŠ ã€‚è¿™è¡¨æ˜å­˜åœ¨ä¸€ä¸ªå™ªå£°é‚»å±…é—®é¢˜ï¼Œå³ç³»ç»ŸæœåŠ¡ä¸å®¹å™¨ç«äº‰ CPU æ—¶é—´ã€‚æˆ‘ä»¬çš„åº¦é‡æ˜¾ç¤ºï¼Œå™ªå£°é‚»å±…å®é™…ä¸Šæ˜¯ç³»ç»Ÿè¿›ç¨‹ï¼Œå¯èƒ½æ˜¯ç”± \u0060container2\u0060 æ¶ˆè€—æ‰€æœ‰å¯ç”¨ CPU å®¹é‡è§¦å‘çš„ã€‚\n\n## ä¼˜åŒ– eBPF ä»£ç \n\næˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªåä¸º [bpftop](https:\/\/netflixtechblog.com\/announcing-bpftop-streamlining-ebpf-performance-optimization-6a727c1ae2e5) çš„å¼€æº eBPF è¿›ç¨‹ç›‘æ§å·¥å…·ï¼Œç”¨æ¥æµ‹é‡æ­¤å†…æ ¸çƒ­è·¯å¾„ä¸­ eBPF ä»£ç çš„å¼€é”€ã€‚æˆ‘ä»¬ä½¿ç”¨ \u0060bpftop\u0060 è¿›è¡Œçš„æ€§èƒ½åˆ†ææ˜¾ç¤ºï¼Œæ£€æµ‹ä»ªå¢åŠ çš„å¼€é”€ä¸åˆ°æ¯ä¸ª \u0060sched_*\u0060 é’©å­ 600 çº³ç§’ã€‚æˆ‘ä»¬å¯¹åœ¨å®¹å™¨ä¸­è¿è¡Œçš„ Java æœåŠ¡è¿›è¡Œäº†æ€§èƒ½åˆ†æï¼Œå‘ç°æ£€æµ‹ä»£ç æœªå¼•å…¥æ˜¾è‘—å¼€é”€ã€‚å¼€å¯ä¸å…³é—­ run queue æ£€æµ‹ä»£ç çš„æ€§èƒ½å·®å¼‚åœ¨æ¯«ç§’çº§ä¸å¯æµ‹ã€‚\n\nåœ¨æˆ‘ä»¬å¯¹å†…æ ¸ä¸­å¦‚ä½•æµ‹é‡ eBPF ç»Ÿè®¡ä¿¡æ¯çš„ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæ”¹è¿›è®¡ç®—çš„æœºä¼šã€‚æˆ‘ä»¬æäº¤äº†è¿™ä¸ª [patch](https:\/\/git.kernel.org\/pub\/scm\/linux\/kernel\/git\/torvalds\/linux.git\/commit\/?id=ce09cbdd988887662546a1175bcfdfc6c8fdd150)ï¼Œå¹¶åŒ…æ‹¬åœ¨ Linux å†…æ ¸ 6.10 ç‰ˆæœ¬ä¸­ã€‚\n\n![](f4.gif)\n\né€šè¿‡è¯•é”™å’Œä½¿ç”¨ \u0060bpftop\u0060ï¼Œæˆ‘ä»¬ç¡®å®šäº†å‡ ç§ä¼˜åŒ–ï¼Œå¸®åŠ©ä¿æŒäº†æˆ‘ä»¬ eBPF ä»£ç çš„ä½å¼€é”€ï¼š\n\n- æˆ‘ä»¬å‘ç° \u0060BPF_MAP_TYPE_HASH\u0060 å­˜å‚¨å…¥é˜Ÿæ—¶é—´æˆ³æ—¶æœ€ä¸ºé«˜æ•ˆã€‚ä½¿ç”¨ \u0060BPF_MAP_TYPE_TASK_STORAGE\u0060 ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™è¿‘ä¸€å€ã€‚\u0060BPF_MAP_TYPE_PERCPU_HASH\u0060 çš„æ€§èƒ½ç•¥ä½äº \u0060BPF_MAP_TYPE_HASH\u0060ï¼Œè¿™æ˜¯æ„æ–™ä¹‹å¤–çš„ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚\n- \u0060BPF_MAP_TYPE_LRU_HASH\u0060 æ˜ å°„çš„æ“ä½œæ¯”å¸¸è§„å“ˆå¸Œæ˜ å°„æ…¢ 40-50 çº³ç§’ã€‚ç”±äº PID æµå¤±å¼•èµ·çš„ç©ºé—´é—®é¢˜ï¼Œæˆ‘ä»¬æœ€åˆä½¿ç”¨äº†å®ƒä»¬æ¥å­˜å‚¨å…¥é˜Ÿæ—¶é—´æˆ³ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬é€‰æ‹©äº†å¢å¤§å°ºå¯¸çš„ \u0060BPF_MAP_TYPE_HASH\u0060ï¼Œä»¥é™ä½è¿™ä¸€é£é™©ã€‚\n- \u0060BPF_CORE_READ\u0060 å¸®åŠ©æ¯æ¬¡è°ƒç”¨å¢åŠ  20-30 çº³ç§’ã€‚åœ¨ç‰¹åˆ«æ˜¯é‚£äº›â€œBTF å¯ç”¨â€çš„åŸå§‹è·Ÿè¸ªç‚¹ï¼ˆ\u0060tp_btf\/*\u0060ï¼‰çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è®¿é—®ä»»åŠ¡ç»“æ„æˆå‘˜æ˜¯å®‰å…¨ä¸”æ›´é«˜æ•ˆçš„ã€‚Andrii Nakryiko åœ¨è¿™ç¯‡ [åšå®¢æ–‡ç« ](https:\/\/nakryiko.com\/posts\/bpf-core-reference-guide\/#btf-enabled-bpf-program-types-with-direct-memory-reads) ä¸­æ¨èäº†è¿™ç§æ–¹æ³•ã€‚\n- \u0060sched_switch\u0060ã€\u0060sched_wakeup\u0060 å’Œ \u0060sched_wakeup_new\u0060 éƒ½ä¼šå› å†…æ ¸ä»»åŠ¡è§¦å‘ï¼Œè¿™äº›ä»»åŠ¡çš„ PID ä¸º 0ã€‚æˆ‘ä»¬å‘ç°ç›‘æ§è¿™äº›ä»»åŠ¡æ˜¯ä¸å¿…è¦çš„ï¼Œå› æ­¤æˆ‘ä»¬å®æ–½äº†å‡ ç§æå‰é€€å‡ºæ¡ä»¶å’Œæ¡ä»¶é€»è¾‘ï¼Œä»¥é˜²åœ¨å¤„ç†å†…æ ¸ä»»åŠ¡æ—¶æ‰§è¡Œä»£ä»·é«˜æ˜‚çš„æ“ä½œï¼Œå¦‚è®¿é—® BPF æ˜ å°„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå†…æ ¸ä»»åŠ¡å°±åƒä»»ä½•å¸¸è§„è¿›ç¨‹ä¸€æ ·é€šè¿‡è°ƒåº¦é˜Ÿåˆ—æ“ä½œã€‚\n\n## ç»“è®º\n\næˆ‘ä»¬çš„å‘ç°çªå‡ºäº†ä½¿ç”¨ eBPF å¯¹ Linux å†…æ ¸è¿›è¡Œä½å¼€é”€æŒç»­æ£€æµ‹çš„ä»·å€¼ã€‚æˆ‘ä»¬å·²å°†è¿™äº›åº¦é‡æ•´åˆåˆ°å®¢æˆ·ä»ªè¡¨æ¿ä¸­ï¼Œä½¿å…¶èƒ½å¤Ÿæä¾›å¯æ“ä½œçš„æ´å¯Ÿï¼Œå¹¶æŒ‡å¯¼å¤šç§Ÿæˆ·æ€§èƒ½è®¨è®ºã€‚æˆ‘ä»¬ç°åœ¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›åº¦é‡æ¥å®Œå–„ CPU éš”ç¦»ç­–ç•¥ï¼Œä»¥æœ€å°åŒ–å™ªå£°é‚»å±…çš„å½±å“ã€‚æ­¤å¤–ï¼Œè¿™äº›åº¦é‡ä½¿æˆ‘ä»¬æ·±å…¥äº†è§£äº† Linux è°ƒåº¦å™¨ã€‚\n\nè¿™é¡¹å·¥ä½œè¿˜åŠ æ·±äº†æˆ‘ä»¬å¯¹ eBPF æŠ€æœ¯çš„ç†è§£ï¼Œå¹¶å¼ºè°ƒäº†åƒ \u0060bpftop\u0060 è¿™æ ·çš„å·¥å…·å¯¹ä¼˜åŒ– eBPF ä»£ç çš„é‡è¦æ€§ã€‚éšç€ eBPF çš„é‡‡ç”¨å¢åŠ ï¼Œæˆ‘ä»¬é¢„è§æ›´å¤šçš„åŸºç¡€è®¾æ–½å¯è§‚æµ‹æ€§å’Œä¸šåŠ¡é€»è¾‘å°†è½¬å‘ä½¿ç”¨å®ƒã€‚åœ¨è¿™æ–¹é¢æœ‰ä¸€ä¸ªå‰æ™¯å¹¿é˜”çš„é¡¹ç›®æ˜¯ [sched_ext](https:\/\/github.com\/sched-ext\/scx)ï¼Œå®ƒæœ‰æ½œåŠ›é©æ–°è°ƒåº¦å†³ç­–çš„åˆ¶å®šæ–¹å¼ï¼Œå¹¶æ ¹æ®ç‰¹å®šå·¥ä½œè´Ÿè½½éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚\n', '\/trans\/noisy-neighbor-detection-with-ebpf\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">Netflix åˆ©ç”¨ eBPF æŠ€æœ¯å®ç°äº† Linux è°ƒåº¦å™¨çš„ä½å¼€é”€æŒç»­æ£€æµ‹ï¼Œæœ‰æ•ˆåœ°ç›‘æ§å’Œä¼˜åŒ–äº†å¤šç§Ÿæˆ·ç¯å¢ƒä¸­å®¹å™¨çš„å™ªå£°é‚»å±…é—®é¢˜ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/application-traffic-with-ebpf/">[è¯‘] ç”¨ eBPF æ´å¯Ÿåº”ç”¨å±‚ç½‘ç»œæµé‡</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/01/10</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://thebsdbox.co.uk/2023/12/08/Application-traffic-with-eBPF/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ç”¨ eBPF æ´å¯Ÿåº”ç”¨å±‚ç½‘ç»œæµé‡', 'æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ eBPF ç¨‹åºæ•è·ã€åˆ†æå’Œä¿®æ”¹åº”ç”¨å±‚çš„ç½‘ç»œæ•°æ®ï¼ŒåŒ…æ‹¬ HTTP å¤´éƒ¨å’Œ URL è·¯å¾„ã€‚ä½œè€…è¿˜å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ eBPF map åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¼ é€’æ•°æ®ã€‚', 'åœ¨[å…ˆå‰çš„å¸–å­](..\/ebpf-adventures-in-networking\/)ä¸­ï¼Œæˆ‘ç¨å¾®è°ˆåˆ°äº†å»ºç«‹ eBPF çŸ¥è¯†ï¼Œä»¥å¼€å§‹æ›´å¤šåœ°äº†è§£ç½‘ç»œé€‚é…å™¨çš„è¾“å…¥å’Œè¾“å‡ºæƒ…å†µã€‚åŸºæœ¬ä¸Šï¼Œå°†ä»¥å¤ªç½‘å¸§å¹¶å‰¥ç¦»æ ‡å¤´ï¼ˆä»¥å¤ªç½‘æ ‡å¤´\u002bIP æ ‡å¤´\u002bTCP\/UDP æ ‡å¤´ï¼‰ï¼Œæœ€ç»ˆä½ å°†å¾—åˆ°æ¥è‡ªåº”ç”¨ç¨‹åºæˆ–æ•°æ®è§’åº¦çš„æ•°æ®åŒ…ä¸­å‰©ä½™çš„å†…å®¹ã€‚\n\næ‰€æœ‰çš„ä»£ç éƒ½åœ¨â€œå­¦ä¹  eBPFâ€å­˜å‚¨åº“ä¸­ï¼Œå…·ä½“çš„ eBPF ä»£ç åœ¨[è¿™é‡Œ](https:\/\/github.com\/thebsdbox\/learning-ebpf\/blob\/main\/ebpf\/http\/http.c)ã€‚è¿™ç¯‡æ–‡ç« çš„è®¡åˆ’æ˜¯é€æ­¥ä»‹ç»æˆ‘è®¤ä¸ºæœ‰ç”¨æˆ–å¯èƒ½é‡è¦çš„éƒ¨åˆ†...\n\n**æ³¨æ„**ï¼šæ­¤ä»£ç ç¡®å®å¯¹å…¥å£\/å‡ºå£æ•°æ®åŒ…è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦ 6.1\u002b çš„ Linux å†…æ ¸æ‰èƒ½ä½¿ç”¨ä¸€äº› eBPF åŠ©æ‰‹å‡½æ•°ã€‚\n\n## æ˜ å°„ï¼\n\nä½ å¯èƒ½ä»¥å‰é‡åˆ°è¿‡è¿™äº›å§ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œä¸ç”¨æ‹…å¿ƒï¼ç®€è€Œè¨€ä¹‹ï¼ŒeBPF æ˜ å°„æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ä¸­çš„ eBPF ç¨‹åºä¹‹é—´é€šä¿¡çš„æœºåˆ¶ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œéå¸¸é…·çš„ä¸€ç‚¹æ˜¯è¿™äº›æ˜ å°„ä½¿ç”¨é”®å’Œå€¼...æ‰€ä»¥æˆ‘ä¸å¿…å¾ªç¯æ¯”è¾ƒæ•°æ®å¹¶å¯»æ‰¾åŒ¹é…çš„å†…å®¹ï¼Œæˆ‘ä¼ é€’ä¸€ä¸ªé”®ï¼Œå¦‚æœæœ‰åŒ¹é…çš„å†…å®¹ï¼Œæˆ‘å°±å¾—åˆ°ç›¸åº”çš„æ•°æ®:D\n\nä¸‹é¢æ˜¯æˆ‘å°†è¦ä½¿ç”¨çš„æ˜ å°„ï¼Œç§°ä¸º\u0060url_map\u0060ï¼Œé”®æ˜¯ 20 ä¸ªå­—ç¬¦é•¿ï¼ˆå¯ä»¥è¯´æ˜¯æœ‰ç•Œçš„â€œå­—ç¬¦ä¸²â€ï¼‰ï¼Œåˆ†é…ç»™è¯¥é”®çš„å€¼æ˜¯æˆ‘åœ¨ä¸Šé¢å®šä¹‰çš„ç»“æ„ä½“ã€‚\n\n\u0060\u0060\u0060\n\/\/ å®šä¹‰ä¸é”®å…³è”çš„ä¸åŒURL\nstruct url_path {\n  __u8 path_len;\n  __u8 path[max_path_len]; \/\/ è¿™åº”è¯¥æ˜¯ä¸€ä¸ªcharï¼Œä½†åœ¨è¿™é‡Œå’ŒGoä¹‹é—´çš„ä»£ç ç”Ÿæˆæœ‰ç‚¹ä¸åŒ...\n};\n\n\/\/ å®šä¹‰æˆ‘çš„URLæ˜ å°„\nstruct {\n  __uint(type, BPF_MAP_TYPE_HASH);\n  __uint(max_entries, 1024);\n  __type(key, char[max_path_len]);\n  __type(value, struct url_path);\n}\nurl_map SEC(\u0022.maps\u0022);\n\u0060\u0060\u0060\n\n## eBPF ç¨‹åºï¼\n\nä»£ç ä¸­å®šä¹‰äº†ä¸¤ä¸ª eBPF ç¨‹åº\u0060tc_egress\u0060å’Œ\u0060tc_ingress\u0060ï¼Œå¦‚æœä½ èƒ½çŒœåˆ°å®ƒä»¬æ˜¯å¦‚ä½•è¿æ¥çš„ï¼Œé‚£å°±åŠ åˆ†ï¼åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨\u0060tc_ingress\u0060ç¨‹åºã€‚\n\nå°±åƒæˆ‘ä»¬åœ¨å·²ç»å­˜åœ¨çš„ä¼—å¤šç¤ºä¾‹ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ ‡å¤´è¯†åˆ«çš„æ“ä½œã€‚\n\n1. è¿›è¡Œåˆç†æ€§æ£€æŸ¥ï¼Œå¹¶å°†\u0060data\u0060å¼ºåˆ¶è½¬æ¢ä¸º\u0060ethhdr\u0060ç±»å‹ï¼ˆ[ä»¥å¤ªç½‘æ ‡å¤´](https:\/\/en.wikipedia.org\/wiki\/Ethernet_frame)ï¼‰ã€‚\n2. é€šè¿‡è¯»å–ä»¥å¤ªç½‘æ ‡å¤´å†…éƒ¨çš„\u0060h_proto\u0060ï¼ˆä¹Ÿç§°ä¸º\u0060Ethertype\u0060ï¼‰æ¥æŸ¥æ‰¾ä»¥å¤ªç½‘å¸§å†…éƒ¨çš„åè®®ã€‚\n3. å°†ä»¥å¤ªç½‘æ ‡å¤´åçš„æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º\u0060iphdr\u0060ç±»å‹ï¼ˆ[IP æ ‡å¤´](https:\/\/en.wikipedia.org\/wiki\/Internet_Protocol_version_4#Header)ï¼‰ã€‚\n4. åœ¨ IP æ ‡å¤´å†…æŸ¥æ‰¾åè®®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®å®š IP æ ‡å¤´çš„å¤§å°ï¼ˆåŸæ¥å®ƒä»¬å¯ä»¥æœ‰ä¸åŒçš„å¤§å°ï¼\u0060Â¯\\_(ãƒ„)_\/Â¯\u0060ï¼‰ã€‚\n5. ä¸ºäº†ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼Œæˆ‘ä»¬å°†å…¶å€¼ä¹˜ä»¥å››ï¼Œä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆï¼å¥½å§ï¼Œè¿™ä¸ªå€¼ä¹˜ä»¥ 32 ä½ä»¥ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼Œæ‰€ä»¥å¦‚æœå€¼ä¸º 6ï¼Œé‚£ä¹ˆæ ‡å¤´å°†æ˜¯ 192 ä½ï¼ˆæˆ– 24 å­—èŠ‚ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ç®€å•åœ°ç¡®å®š IP æ ‡å¤´çš„å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå€¼ä¹˜ä»¥ 4ï¼\n6. å°†ä»¥ IP æ ‡å¤´åçš„æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º\u0060tcphdr\u0060ç±»å‹ï¼ˆ[TCP æ ‡å¤´](https:\/\/en.wikipedia.org\/wiki\/Transmission_Control_Protocol#TCP_segment_structure)ï¼‰ã€‚\n7. åƒæ­¥éª¤ï¼ˆ5ï¼‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®š TCP æ ‡å¤´çš„å¤§å°ï¼ˆå®ƒä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€çš„ï¼‰ï¼Œåœ¨è¿™é‡Œçš„æ­¥éª¤ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å€¼\u0060doff\u0060ä¹˜ä»¥å››æ¥ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚\n8. é€šè¿‡è®¡ç®—æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¨æ–­å‡ºæ•°æ®ä½äºä»¥å¤ªç½‘æ ‡å¤´å¤§å°ã€IP æ ‡å¤´å¤§å°å’Œ TCP æ ‡å¤´å¤§å°çš„æœ«å°¾ã€‚\n9. æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä» IP æ ‡å¤´ä¸­å‡å» IP å’Œ TCP æ ‡å¤´çš„å¤§å°æ¥ç¡®å®šåº”ç”¨ç¨‹åºæ•°æ®çš„å¤§å°ï¼Œä½¿ç”¨\u0060tot_len\u0060ï¼ˆæ€»é•¿åº¦ï¼‰ã€‚\n\n### åº”ç”¨æ•°æ®ï¼ï¼\n\nä¸ºäº†è¯»å–è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸Šé¢æåˆ°çš„ä¸€äº›ä¸œè¥¿ï¼\n\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ•°æ®åç§»é‡ï¼ˆæ•°æ®èµ·å§‹ä½ç½®ï¼‰ï¼Œå®ƒä½äºä»¥å¤ªç½‘æ ‡å¤´\u002bIP æ ‡å¤´å¤§å°ï¼ˆä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼‰å’Œ TCP æ ‡å¤´ï¼ˆå†æ¬¡ï¼Œä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼‰ä¹‹åã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç¼“å†²åŒºæ¥å­˜å‚¨æˆ‘ä»¬å°†ä»å¥—æ¥å­—ç¼“å†²åŒºä¸­è¯»å–çš„æ•°æ®ã€‚\n\n\u0060\u0060\u0060c\n\/\/ ç”¨äºå­˜å‚¨æˆ‘ä»¬åº”ç”¨ç¨‹åºæ•°æ®çš„æ•°æ®ç¼“å†²åŒº\nchar pdata[60];\n\n\/\/ è®¡ç®—æ•°æ®å®é™…ä½ç½®çš„åç§»é‡\npoffset = ETH_HLEN \u002b ip_hlen \u002b tcp_hlen;\n\n\/\/ ä»å¥—æ¥å­—ç¼“å†²åŒºåŠ è½½æ•°æ®ï¼Œpoffset ä» TCP æ ‡å¤´çš„æœ«å°¾å¼€å§‹\nint ret = bpf_skb_load_bytes(skb, poffset, pdata, 60);\nif (ret != 0) {\n   return 0;\n}\n\u0060\u0060\u0060\n\næˆ‘ä»¬ä½¿ç”¨\u0060bpf_skb_load_bytes\u0060ä»å¥—æ¥å­—ç¼“å†²åŒºï¼ˆ\u0060skb\u0060ï¼‰ä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ï¼ˆ60 ä¸ªå­—èŠ‚ï¼‰åˆ°æˆ‘ä»¬çš„ç¼“å†²åŒºï¼ˆ\u0060pdata\u0060ï¼‰ï¼Œèµ·å§‹ä½ç½®æ˜¯æˆ‘ä»¬çŸ¥é“æ•°æ®ä½äºçš„åç§»é‡ï¼ˆ\u0060poffset\u0060ï¼‰ï¼\n\næ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰äº† 60 å­—èŠ‚çš„æ•°æ®ï¼Œåº”è¯¥è¶³å¤Ÿè®©æˆ‘ä»¬ç¼–å†™ä¸€äº›ä»£ç æ¥ç†è§£å®ƒã€‚\n\n### HTTP æ•°æ® :-)\n\nè®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬å°è¯•è¿›è¡Œ HTTP è¯·æ±‚æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼\n\n\u0060\u0060\u0060plaintext\n ~ curl code\/test -vvv\n*   Trying 192.168.0.22:80...\n* Connected to code (192.168.0.22) port 80 (#0)\n\u003e GET \/test HTTP\/1.1\n\u003e Host: code\n\u003e User-Agent: curl\/7.87.0\n\u003e Accept: *\/*\n\n...\n\u0060\u0060\u0060\n\næˆ‘æ­£åœ¨ä½¿ç”¨\u0060curl\u0060ä»ä¸»æœº\u0060code\u0060ï¼ˆcode æ˜¯æˆ‘çš„å¼€å‘ VMï¼Œè¿è¡Œ code-serverï¼‰è¯·æ±‚ URL \u0060\/test\u0060ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼ˆæ¯è¡Œä»¥\u0060\u003e\u0060å¼€å¤´ï¼Œç”¨äºç¡®å®šé€šä¿¡çš„æ–¹å‘ï¼‰ã€‚HTTP è¯·æ±‚ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®é€šå¸¸æ˜¯ä¸€ä¸ª*åŠ¨è¯*ï¼Œåé¢æ˜¯æˆ‘ä»¬å¸Œæœ›ä¸ä¹‹äº¤äº’çš„èµ„æºï¼Œç„¶åæ˜¯ HTTP è§„èŒƒå’Œå›è½¦ç¬¦ï¼Œå¦‚[HTTP æ ‡å‡†](https:\/\/en.wikipedia.org\/wiki\/HTTP#HTTP\/1.1_request_messages)ä¸­å®šä¹‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…³å¿ƒçš„è¡Œæ˜¯\u0060GET \/test\u0060ï¼ˆåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬\/æˆ‘ä¸å¤ªå…³å¿ƒ HTTP è§„èŒƒ:Dï¼‰ã€‚\n\nç¬¬ä¸€æ­¥æ˜¯è¯»å–\u0060pdata\u0060çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ŒæŸ¥æ‰¾\u0060pdata[0] == G\u0060ï¼Œ\u0060pdata[1] == E\u0060å’Œ\u0060pdata[2] == T\u0060ï¼Œè¿™å°†æœ‰æ•ˆåœ°å¸®åŠ©æˆ‘ä»¬ç¡®å®šé¦–å…ˆæ˜¯å¦æ˜¯ HTTP è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯æ˜¯å¦æ˜¯ HTTP è¯·æ±‚ï¼\n\nä¸€æ—¦æˆ‘ä»¬éªŒè¯äº†è¿™å‰ 3 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°†æƒ³è¦ä»ç¬¬ 4 ä¸ªå­—èŠ‚ï¼ˆè¯·æ±‚çš„å‰ä¸‰ä¸ªå­—èŠ‚åŠ ä¸Šä¸€ä¸ªç”¨äºåˆ†éš”çš„ç©ºæ ¼ï¼‰å¼€å§‹è¯»å–æ›´å¤šæ•°æ®ï¼\n\n\u0060\u0060\u0060c\nchar path[max_path_len];\nmemset(\u0026path, 0, sizeof(path));\n\nint path_len = 0;\n\n\/\/ æŸ¥æ‰¾è¯·æ±‚ URIï¼ˆä»åç§»é‡ 4 å¼€å§‹ï¼‰ï¼Œä»¥ç©ºæ ¼ç»“æŸ\nfor (int i = 4; i \u003c sizeof(pdata) ; i\u002b\u002b)\n{\n    if (pdata[i] != \u0027 \u0027) {\n        path[i-4] = pdata[i];\n    } else {\n        path[i-4] = \u0027\\0\u0027;\n        path_len = i-4;\n        break;\n    }\n}\n\u0060\u0060\u0060\n\nä¸Šé¢çš„å‡½æ•°å°†ä» HTTP æ•°æ®çš„ç¬¬ 4 ä¸ªå­—èŠ‚å¼€å§‹ï¼ˆä»ç¬¬ 4 ä¸ªå­—èŠ‚å¼€å§‹ï¼‰è¯»å–å…¶ä½™çš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ç©ºæ ¼ä¸ºæ­¢ï¼Œç•™ä¸‹æˆ‘ä»¬è¦\u0060GET\u0060çš„ URLï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªè°ƒè¯•æ‰“å°è¯­å¥æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š\n\n\u0060\u0060\u0060c\nbpf_printk(\u0022\u003c- incoming path [%s], length [%d]\u0022, path, path_len);\n\u0060\u0060\u0060\n\nè¿™å°†åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºå¦‚ä¸‹ï¼š\n\n\u0060\u0060\u0060plaintext\n\u003cidle\u003e-0       [001] dNs3. 2252901.017812: bpf_trace_printk: \u003c- incoming path [\/test], length [5]\n\u0060\u0060\u0060\n\n### å¯¹ HTTP åº”ç”¨ç¨‹åºè¯·æ±‚é‡‡å–è¡ŒåŠ¨\n\nä¸Šè¿°è§£é‡Šè¯¦ç»†è¯´æ˜äº†æˆ‘ä»¬å¦‚ä½•è¯»å–æ•°æ®ä»¥åŠå¦‚ä½•è¯»å–æ•°æ®ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦â€œåŠ¨æ€â€æŸ¥æ‰¾ HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨ eBPF æ˜ å°„ã€‚\n\nåœ¨æˆ‘ä»¬çš„ Go ç”¨æˆ·ç©ºé—´ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n\n\u0060\u0060\u0060go\npath := flag.String(\u0022path\u0022, \u0022\u0022, \u0022The URL Path to watch for\u0022)\nflag.Parse()\n\n\/\/ ...\n\n\/\/ åˆ›å»ºä¸€ä¸ª uint8 æ•°ç»„\nvar urlPath [20]uint8\n\/\/ å°†æˆ‘ä»¬çš„å­—èŠ‚å¤åˆ¶åˆ° uint8 æ•°ç»„ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢ï¼‰\ncopy(urlPath[:], *path)\n\n\/\/ å°†æˆ‘ä»¬çš„ urlPath ä½œä¸ºé”®\nerr = objs.UrlMap.Put(urlPath,\n  bpfUrlPath{\n    Path:    urlPath,\n    PathLen: uint8(len(urlPath)),\n  })\nif err != nil {\n  panic(err)\n}\n\u0060\u0060\u0060\n\næ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­çœ‹åˆ°çš„ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ Go ç¨‹åºæ—¶ï¼Œå®ƒå°†ä»æ ‡å¿—\u0060-path\u0060ä¸­è¯»å–ï¼Œå¹¶å°†å…¶ç”¨ä½œæˆ‘ä»¬ eBPF æ˜ å°„ä¸­çš„**é”®**ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥å€¼ã€‚\n\n\u0060\u0060\u0060c\nstruct url_path *found_path = bpf_map_lookup_elem(\u0026url_map, path);\nif (found_path \u003e 0) {\n    bpf_printk(\u0022Looks like we\u0027ve found your path [%s]\u0022, path);\n    \/\/ å¯èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼Œé˜»æ­¢æµé‡æˆ–é‡å®šå‘ï¼Ÿ\n}\n\u0060\u0060\u0060\n\nåœ¨æˆ‘ä»¬çš„ eBPF ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ HTTP è¯·æ±‚è¿›è¡Œæ˜ å°„æŸ¥æ‰¾ï¼Œå¦‚æœè¯¥è¯·æ±‚ä½œä¸º char æ•°ç»„å­˜åœ¨äº**é”®**ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œï¼\n\nç°åœ¨å¯åŠ¨æˆ‘ä»¬çš„ Go ç¨‹åº \u0060sudo .\/http -interface ens160 -path \/test\u0060 å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\n\n\u0060\u0060\u0060plaintext\nINFO[0000] Starting ğŸ the eBPF HTTP watcher, on interface [ens160] for path [\/test]\nINFO[0000] Loaded TC QDisc\nINFO[0000] Press Ctrl-C to exit and remove the program\n          \u003cidle\u003e-0       [001] d.s3. 2252901.015575: bpf_trace_printk: \u003c- 0.0.0.0:56345 -\u003e 0.0.0.0:80\n          \u003cidle\u003e-0       [001] D.s3\n\n. 2252901.015642: bpf_trace_printk: -\u003e 192.168.0.22:80 -\u003e 192.168.0.180:56345\n          \u003cidle\u003e-0       [001] d.s3. 2252901.017552: bpf_trace_printk: \u003c- 0.0.0.0:56345 -\u003e 0.0.0.0:80\n          \u003cidle\u003e-0       [001] d.s3. 2252901.017793: bpf_trace_printk: \u003c- 0.0.0.0:56345 -\u003e 0.0.0.0:80\n          \u003cidle\u003e-0       [001] dNs3. 2252901.017812: bpf_trace_printk: \u003c- incoming path [\/test], length [5]\n          \u003cidle\u003e-0       [001] dNs3. 2252901.017814: bpf_trace_printk: Looks like we\u0027ve found your path [\/test]\n\u0060\u0060\u0060\n\n## ç»“è®º\n\nè§£æ HTTP å¹¶ä¸å¤ªå›°éš¾ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„åè®®ï¼Œå®ƒä½¿ç”¨ç®€å•çš„åŠ¨è¯å’Œç»“æ„çš„ç®€å•æ–¹æ³•ï¼Œä½¿ç”¨ç©ºæ ¼å’Œå›è½¦ç¬¦æ¥åŒºåˆ†ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¹Ÿé€‚ç”¨äºå…¶ä»–åè®®ï¼Œå¦‚ DNSã€POP3 æˆ– SMTPã€‚å½“æ•°æ®åŠ å¯†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§è§£å¯†çš„æ–¹æ³•ï¼Œç„¶åæ‰èƒ½è§£ææ•°æ®ï¼ˆè¿™è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›...ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›è¿™ä¼šæ¿€å‘ä½ æ›´å¤šåœ°å°è¯•ä½¿ç”¨ eBPF æ¥è§£æå’Œæ“ä½œåº”ç”¨ç¨‹åºçš„æƒ³æ³•ï¼\n\næˆ‘ä¸€ç›´æƒ³å†™ä¸€äº›æœ‰å¸Œæœ›æœ‰ç”¨çš„å…³äº eBPF çš„å¸–å­ï¼Œå°½ç®¡é€šå¸¸åœ¨æˆ‘æƒ³å‡ºå¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿ä¹‹åï¼Œåˆ«äººå·²ç»æŠ¢å…ˆä¸€æ­¥ã€‚é‰´äºæˆ‘å·²ç»åœ¨ä¸€æ®µæ—¶é—´é‡Œä»¥æŸç§æ–¹å¼å…³æ³¨ç½‘ç»œï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘å…³æ³¨çš„é¢†åŸŸï¼Œå°½ç®¡æˆ‘ç¡®å®ä¸ºæœ€è¿‘çš„ eBPF å³°ä¼š 2023 ç¼–å†™äº†ä¸€äº›æœ‰è¶£çš„å†…å®¹ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæœ‰å¾ˆå¤šäººå¼€å§‹æ’°å†™ eBPF å†…å®¹ï¼Œæ‰€ä»¥æˆ‘å¯èƒ½ä¼šå‚è€ƒä»–ä»¬çš„å¸–å­ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹ã€‚\n', '\/trans\/application-traffic-with-ebpf\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ eBPF ç¨‹åºæ•è·ã€åˆ†æå’Œä¿®æ”¹åº”ç”¨å±‚çš„ç½‘ç»œæ•°æ®ï¼ŒåŒ…æ‹¬ HTTP å¤´éƒ¨å’Œ URL è·¯å¾„ã€‚ä½œè€…è¿˜å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ eBPF map åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¼ é€’æ•°æ®ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/ebpf-adventures-in-networking/">[è¯‘] å¦‚ä½•ç”¨ eBPF æ”¹å˜ç½‘ç»œç¼–ç¨‹çš„æ¸¸æˆè§„åˆ™</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/01/10</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://thebsdbox.co.uk/2023/11/18/eBPF-adventures-in-networking/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('å¦‚ä½•ç”¨ eBPF æ”¹å˜ç½‘ç»œç¼–ç¨‹çš„æ¸¸æˆè§„åˆ™', 'è¿™ç¯‡æ–‡ç« ä»‹ç»äº† eBPF åœ¨ç½‘ç»œé¢†åŸŸçš„ä¸€äº›åº”ç”¨å’Œå®è·µï¼ŒåŒ…æ‹¬ XDPã€TC å’Œ sysprobes ä¸‰ç§ä¸åŒçš„ eBPF ç¨‹åºæŒ‚è½½æ–¹å¼çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ eBPF å®ç°ç½‘ç»œæ•°æ®çš„æ•è·ã€åˆ†æå’Œä¿®æ”¹ã€‚ä½œè€…è¿˜åˆ†äº«äº†ä¸€äº›æœ‰ç”¨çš„ eBPF å·¥å…·å’Œèµ„æºï¼Œä»¥åŠè‡ªå·±å¼€å‘çš„ä¸€ä¸ª eBPF ç½‘ç»œä»£ç†çš„é¡¹ç›®ã€‚', '\næˆ‘ä¸€ç›´æƒ³å†™ä¸€äº›å…³äº eBPF çš„å¸–å­ï¼Œå¸Œæœ›å®ƒä»¬èƒ½æœ‰æ‰€å¸®åŠ©ï¼Œå°½ç®¡é€šå¸¸åœ¨æˆ‘æƒ³åˆ°å¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿æ—¶ï¼Œå…¶ä»–äººå·²ç»å…ˆæˆ‘ä¸€æ­¥äº†ã€‚é‰´äºæˆ‘å·²ç»åœ¨ç½‘ç»œæ–¹é¢é›†ä¸­ç²¾åŠ›ä¸€æ®µæ—¶é—´ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä¸“æ³¨çš„é¢†åŸŸï¼Œå°½ç®¡æˆ‘ç¡®å®è®¾æ³•ä¸ºæœ€è¿‘çš„ eBPF å³°ä¼š 2023 å‡†å¤‡äº†ä¸€äº›æˆ‘è®¤ä¸ºå¾ˆæœ‰è¶£çš„ä¸œè¥¿ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæœ‰å¾ˆå¤šäººå¼€å§‹æ’°å†™å…³äº eBPF çš„å†…å®¹ï¼Œå› æ­¤æˆ‘å¯èƒ½ä¼šå‚è€ƒä»–ä»¬çš„å¸–å­ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹ã€‚\n\næˆ‘å°†ä»ä¸€äº›åœ¨ Linux å†…æ ¸ä¸­å¯èƒ½æˆ–å¯èƒ½ä¸ä¼šé‡åˆ°çš„é¦–å­—æ¯ç¼©å†™æˆ–æŠ€æœ¯å¼€å§‹ã€‚ä½†åŸºæœ¬ä¸Šä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›æ˜¯ä½ ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿä»¥ä¸ç½‘ç»œæ•°æ®äº¤äº’çš„ä¸»è¦é€‰é¡¹ã€‚\n\n### XDP\n\nå…³äº eXpress Data Plane å·²ç»å­˜åœ¨å¤§é‡ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä¸ä¼šæ·±å…¥æ¢è®¨å¤ªå¤šç»†èŠ‚ã€‚\u0060tl;dr\u0060æ˜¯ XDP eBPF ç¨‹åºæŒ‚é’©åˆ° XDP å°†ä½¿å…¶èƒ½å¤Ÿè®¿é—®ç”±å†…æ ¸è‡ªèº«å¤„ç†ä¹‹å‰çš„ä¼ å…¥ç½‘ç»œå¸§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒeBPF ç¨‹åºå°†åŠ è½½åˆ° NIC é©±åŠ¨ç¨‹åºæœ¬èº«ä¸­ï¼Œè¿™å°†æœ‰æ•ˆåœ°å°†ç¨‹åºå¸è½½åˆ° NIC æœ¬èº«ã€‚\n\n### ä¼˜ç‚¹\n\n- æœ€ä½³æ€§èƒ½\n- éå¸¸é€‚ç”¨äºé˜²ç«å¢™ã€DDoS é˜²æŠ¤æˆ–è´Ÿè½½å‡è¡¡ç­‰ç”¨ä¾‹\n- åœ¨ä»»ä½•å…¶ä»–å†…å®¹è¿›è¡Œä¿®æ”¹ä¹‹å‰çœ‹åˆ°ä¼ å…¥çš„æµé‡\n\n### ç¼ºç‚¹\n\n- ä»…æ”¯æŒå…¥ç«™æµé‡ï¼Œä½¿ç”¨ XDP ç¨‹åºçœ‹åˆ°çš„ä»»ä½•æµé‡éƒ½åªæ˜¯ä¼ å…¥æµé‡ï¼Œç›®å‰æ— æ³•çœ‹åˆ°å‡ºç«™æµé‡\n- ä½¿ç”¨\u0060XDP\u0060æ•°æ®ç»“æ„ï¼Œä¸å¤§å¤šæ•°å¥—æ¥å­—ç¼–ç¨‹çš„é»˜è®¤æ•°æ®ç»“æ„\u0060SKB\u0060æœ‰ä¸€äº›ä¸åŒã€‚\n\n### TCï¼ˆTraffic Controlï¼‰æˆ–æµé‡æ§åˆ¶\n\nTraffic Control æ˜¯å†…æ ¸ç½‘ç»œç»“æ„çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬æ·»åŠ è¯¸å¦‚ qdisc å’Œè¿‡æ»¤å™¨ä¹‹ç±»çš„åŠŸèƒ½åˆ°æ¥å£çš„èƒ½åŠ›ã€‚qdisc ä¸»è¦é›†ä¸­åœ¨ä¸º TBDï¼ˆå¾…å®šï¼‰æä¾›æœåŠ¡ï¼Œè€Œè¿‡æ»¤å™¨é€šå¸¸åœ¨åº•å±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ª eBPF ç¨‹åºã€‚\n\nå¸¸è§çš„å·¥ä½œæµç¨‹æ˜¯ï¼š\n\n1. åˆ›å»ºä¸€ä¸ªå…³æ³¨å…¥å£æˆ–å‡ºå£çš„ qdiscï¼Œæˆ–è€…æ›¿æ¢ä¸€ä¸ªç°æœ‰çš„ qdiscã€‚qdisc å°†é™„åŠ åˆ°æ¥å£ä¸Šã€‚\n2. åŠ è½½ä½ çš„ eBPF ç¨‹åºã€‚\n3. åˆ›å»ºä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå°†å…¶é™„åŠ åˆ°é€šè¿‡æ¥å£ä¸Šçš„ qdisc ä¸Šçš„å…¥å£æˆ–å‡ºå£ä¹‹ä¸€ã€‚è¯¥è¿‡æ»¤å™¨å°†ä¸ eBPF ç¨‹åºç›¸å…³è”ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ä¼ å…¥æˆ–ä¼ å‡ºçš„æµé‡ç°åœ¨éƒ½ä¼šé€šè¿‡ä¸€ä¸ªç¨‹åºè¿è¡Œï¼ˆå¦‚æœè¿æ¥ï¼‰ã€‚\n4. è·åˆ© ğŸ’°\n\n### ä¼˜ç‚¹\n\n- æä¾›å…¥å£å’Œå‡ºå£çš„æŒ‚é’©ç‚¹\n- ä½¿ç”¨ä¼ ç»Ÿçš„\u0060SKB\u0060æ•°æ®ç»“æ„\n\n### ç¼ºç‚¹\n\n- å°† TC ç¨‹åºé™„åŠ åˆ°å…¥å£æˆ–å‡ºå£é˜Ÿåˆ—ç¨å¾®å¤æ‚ä¸€äº›ã€‚ç”¨æˆ·éœ€è¦ä½¿ç”¨ qdisc æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒæŸäº› eBPF SDK ä¸ä¼šåŸç”Ÿæ”¯æŒ TC ç¨‹åºçš„ä½¿ç”¨ã€‚\n- TC eBPF ç¨‹åºçœ‹åˆ°çš„æµé‡å¯èƒ½å·²ç»è¢«ä¹‹å‰çš„ XDP ç¨‹åºæˆ–å†…æ ¸æœ¬èº«ä¿®æ”¹ã€‚\n\n### ç³»ç»Ÿè°ƒç”¨\n\nä¸å…¶ä»–ä¸¤ç§ä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†ç½‘ç»œçš„æ–¹æ³•ç›¸æ¯”ï¼Œè¿™å¯èƒ½ä¼šæ˜¾å¾—æœ‰äº›å¥‡æ€ªï¼Œå› ä¸ºå®ƒæ˜¯å°†ä¸€äº› eBPF ä»£ç é™„åŠ åˆ°å†…æ ¸ä¸­çš„ç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œå…·ä½“æ¥è¯´æ˜¯\u0060tcp4_connect()\u0060 \/ \u0060tcp6_connect()\u0060ç­‰è°ƒç”¨ã€‚è¿™åœ¨åè®®æ ˆä¸­ç•¥å¾®é åï¼Œå› ä¸ºåœ¨æ­¤æ—¶ï¼Œä¼ å…¥æ•°æ®åŒ…å·²ç»ç»è¿‡äº†å¾ˆå¤šå†…æ ¸é€»è¾‘ï¼Œè€Œ eBPF å†…çœç‚¹æ˜¯å½“æµé‡å³å°†ä¸åº”ç”¨ç¨‹åºæœ¬èº«äº¤äº’æ—¶ã€‚\n\n## ç¼–å†™ç½‘ç»œç¨‹åºï¼\n\næ‰€ä»¥åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬ï¼ˆå¸Œæœ›ï¼‰æ„è¯†åˆ°æˆ‘ä»¬æœ‰è®¸å¤šä¸åŒçš„å…¥å£ç‚¹ï¼Œå…è®¸æˆ‘ä»¬åœ¨â€œä¼ é€å¸¦â€ä¸Šæ³¨å…¥æˆ‘ä»¬çš„ä»£ç ï¼Œè¿™ä¸ªä¼ é€å¸¦ä» NIC å¼€å§‹ï¼Œä¸€ç›´åˆ°åº”ç”¨ç¨‹åºï¼ˆä»¥åŠåœ¨å‡ºç«™çš„æƒ…å†µä¸‹ï¼‰ã€‚\n\n### å›é¡¾\n\nåœ¨æˆ‘ä»¬æ‰€è°“çš„â€œä¼ é€å¸¦â€çš„å¼€å¤´ï¼Œæˆ‘ä»¬å¯ä»¥é™„åŠ æˆ‘ä»¬çš„ XDP ç¨‹åºå¹¶è·å¾—æœªç»è§¦ç¢°çš„åŸå§‹ç½‘ç»œæ•°æ®ã€‚åœ¨â€œä¼ é€å¸¦â€çš„ä¸­é—´ï¼Œæˆ‘ä»¬çš„ TC ç¨‹åºå°†æˆä¸ºé€šè¿‡å†…æ ¸çš„è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶æ¥æ”¶å¯èƒ½è¢«ä¿®æ”¹çš„ç½‘ç»œæ•°æ®ã€‚åœ¨ä¼ é€å¸¦çš„æœ«ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç é™„åŠ åˆ°åº”ç”¨ç¨‹åºå°†åœ¨å®ƒè¢«è¿è¡Œä¹‹å‰è·å–ç½‘ç»œæ•°æ®çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥åœ¨ä¼ é€å¸¦çš„æœ«ç«¯è¿›è¡Œé™„åŠ ã€‚\n\n### æ•°æ®è¡¨ç¤º\n\nä½ çš„ç¨‹åºé™„åŠ åˆ°çš„ä½ç½®å†³å®šäº†ä¸¤ä¸ªä¸»è¦äº‹ç‰©ï¼Œä¸€ä¸ªæ˜¯æ½œåœ¨çš„æµé‡ä¿®æ”¹çš„ç›¸å¯¹çº§åˆ«ï¼Œå¦ä¸€ä¸ªæ˜¯æµé‡çš„è¡¨ç¤ºæ–¹å¼ã€‚\n\n### XDP ç»“æ„\n\næˆ‘ä¼šå†™å…³äºå®ƒçš„å†…å®¹ï¼Œä½†æ˜¯ DataDog å·²ç»åšäº†ï¼Œä½ å¯ä»¥åœ¨[è¿™é‡Œ](https:\/\/www.datadoghq.com\/blog\/xdp-intro\/#the-flow-of-an-xdp-program)é˜…è¯»ã€‚\n\n### SKBï¼ˆå¥—æ¥å­—ç¼“å†²åŒºï¼‰\n\nSKB æ˜¯åœ¨ eBPF æ·»åŠ åˆ°å†…æ ¸ä¹‹å‰å°±å­˜åœ¨äºå†…æ ¸ä¸­çš„æ•°æ®ç±»å‹ï¼Œå®ƒå·²ç»å…·å¤‡äº†ä¸€äº›ä½¿ä¸ SKB å¯¹è±¡äº¤äº’å˜å¾—ç¨å¾®å®¹æ˜“ä¸€äº›çš„è¾…åŠ©åŠŸèƒ½ã€‚æœ‰å…³æ›´æ·±å…¥çš„ SKB ä»‹ç»ï¼Œä½ å¯ä»¥é˜…è¯»æ­¤æ–‡ -\u003e http:\/\/vger.kernel.org\/~davem\/skb_data.html\n\n### è§£ææ•°æ®\n\næ— è®ºä¸å“ªä¸ªç»“æ„è¿›è¡Œäº¤äº’ï¼Œå®ƒä»¬éƒ½å…±äº«ä¸€äº›å…±åŒä¹‹å¤„ï¼Œè¿™ä¸»è¦æ˜¯ä¸¤ä¸ªå˜é‡ï¼Œå¯¹äºè¿™ä¸¤ç§æ•°æ®ç±»å‹æ¥è¯´æ˜¯ç›¸åŒçš„ã€‚\n\nè¿™äº›å˜é‡æ˜¯ï¼š\n\n- \u0060data\u0060ï¼Œå®ƒæ˜¯ eBPF ç¨‹åºæ¥æ”¶åˆ°çš„æ•°æ®çš„æŒ‡é’ˆ\n\n- \u0060data_len\u0060ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šäº†æœ‰å¤šå°‘æ•°æ®å¯ç”¨ï¼ˆä»¥å¸®åŠ©ç¡®ä¿ä½ æ°¸è¿œä¸ä¼šè®¿é—®\u0060data\u0060è¶…è¿‡\u0060data_len\u0060ï¼ˆæ˜¾è€Œæ˜“è§çš„çœŸç† ğŸ¤“ï¼‰ï¼‰\n\næ‰€ä»¥è¿™ä¸€åˆ‡ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†ç­‰ç­‰... \u0060*data\u0060ä¸­å®é™…ä¸Šæœ‰ä»€ä¹ˆï¼Ÿï¼ˆè¿™å–å†³äºä½ çš„å‘ç°ï¼‰\n\né€šè¿‡ä¸æ–­â€œè½¬æ¢â€\u0060*data\u0060å¹¶æ²¿ç€å®ƒç§»åŠ¨ä»¥å‰¥ç¦»å„ç§æ ‡å¤´ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£å’ŒæŸ¥æ‰¾åº•å±‚æ•°æ®ï¼\n\n### è½¬æ¢ï¼Ÿ\n\nå¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥è·³è¿‡æ­¤éƒ¨åˆ†ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿï¼ˆä¸”ç³Ÿç³•ï¼‰çš„ç¤ºä¾‹ï¼Œè¯´æ˜äº†æˆ‘ä»¬é€šå¸¸å¦‚ä½•å°†ä¸€äº›åŸå§‹æ•°æ®è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ä¸œè¥¿ã€‚ç›®å‰ï¼Œ\u0060*data\u0060å°†åªæ˜¯ä¸€ä¸²éšæœºæ•°æ®ï¼Œæ¯«æ— æ„ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦æœ‰æ•ˆåœ°ä¸ºå…¶æ·»åŠ â€œæ ¼å¼â€ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç†è§£å…¶å¤–è§‚ã€‚\n\nè€ƒè™‘ä¸€ä¸‹éšæœºæ•°æ®è¡Œï¼šâ€œBobby0004500100.503 Harvard Drive90210â€ï¼Œå…¶ä¸­ä¸€äº›å¯¹è£¸çœ¼æ¥è¯´æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æœ‰äº›æ˜¯ä¸æ¸…æ¥šçš„ã€‚\n\næƒ³è±¡ä¸€ä¸‹åä¸ºâ€œpersonâ€çš„æ•°æ®ç»“æ„ï¼š\n\n\u0060\u0060\u0060bash\nName: string\nAge: number\nBalance: float\nStreet: string\nZipCode: number\n\u0060\u0060\u0060\n\nå¦‚æœæˆ‘ä»¬è¦å°†æˆ‘ä»¬çš„éšæœºæ•°æ®â€œè½¬æ¢â€ä¸ºä¸Šé¢çš„â€œpersonâ€ç»“æ„ï¼Œå®ƒå°†çªç„¶å˜æˆï¼š\n\n\u0060\u0060\u0060bash\nName: Bobby\nAge: 45\nBalance: 100.50\nStreet: 3 Harvard Drive\nZipCode: 90210\n\u0060\u0060\u0060\n\nç°åœ¨çªç„¶é—´ï¼Œæˆ‘èƒ½å¤Ÿç†è§£å¹¶è®¿é—®ç»“æ„ä¸­çš„åº•å±‚å˜é‡ï¼Œå› ä¸ºå®ƒä»¬ç°åœ¨æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå³ person-\u003eNameï¼Œå¹¶ä¸”å‘ç°æ­¤ç‰¹å®šçš„ person ç±»å‹å¯¹è±¡å…·æœ‰åç§°å˜é‡â€œBobbyâ€ï¼\n\nè¿™æ­£æ˜¯æˆ‘ä»¬å°†å¯¹æˆ‘ä»¬çš„\u0060*data\u0060æ‰€åšçš„ï¼\n\n### æ•°æ®ä¸­åŒ…å«ä»€ä¹ˆï¼Ÿ\n\nå› æ­¤ï¼Œç¬¬ä¸€æ­¥æ˜¯ç¡®å®šæ•°æ®æ˜¯å¦ä»¥ä»¥å¤ªç½‘å¸§å¼€å¤´ï¼å‡ ä¹æ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½ä»¥ä»¥å¤ªç½‘å¸§å¼€å¤´ï¼Œè¿™ç›¸å½“ç®€å•ï¼Œä½†å…¶ä½œç”¨æ˜¯å…·æœ‰æºå’Œç›®æ ‡ç¡¬ä»¶åœ°å€ï¼ˆæ— è®ºè™šæ‹ŸåŒ–\/å®¹å™¨åŒ–\/æœ‰çº¿ç½‘ç»œè¿˜æ˜¯ WiFi å¦‚ä½•ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€æ­¥æ˜¯å°†æˆ‘ä»¬çš„\u0060*data\u0060è½¬æ¢ä¸ºç±»å‹\u0060ETHHDR\u0060ï¼Œå¦‚æœæˆåŠŸï¼Œæˆ‘ä»¬ç°åœ¨å°†èƒ½å¤Ÿäº†è§£ç»„æˆä»¥å¤ªç½‘å¤´æ•°æ®ç±»å‹çš„å˜é‡ã€‚è¿™äº›åŒ…æ‹¬æºå’Œç›®æ ‡ MAC åœ°å€ï¼Œä½†æ›´é‡è¦çš„æ˜¯å‰©ä½™æ•°æ®çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚å†æ¬¡ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»¥å¤ªç½‘å¤´ä¹‹åçš„\u0060*data\u0060å†…å®¹é€šå¸¸æ˜¯ IP å¤´ï¼Œä½†æˆ‘ä»¬å°†é€šè¿‡æ£€æŸ¥ä»¥å¤ªç½‘å¸§çš„ TBD å˜é‡æ¥éªŒè¯ã€‚\n\nä¸€æ—¦æˆ‘ä»¬éªŒè¯ä¸‹ä¸€ç»„æ•°æ®æ˜¯ IP å¤´ï¼Œæˆ‘ä»¬å°†éœ€è¦å°†ä»¥å¤ªç½‘å¤´ä¹‹åçš„æ•°æ®è½¬æ¢ä¸º IPHDR ç±»å‹ã€‚ä¸€æ—¦æˆ‘ä»¬è¿™æ ·åšï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿè®¿é—® IP ç‰¹å®šçš„æ•°æ®ï¼Œä¾‹å¦‚æº IPï¼ˆ\u0060saddr\u0060ï¼‰æˆ–ç›®æ ‡åœ°å€ï¼ˆ\u0060daddr\u0060ï¼‰ï¼Œå†æ¬¡é‡è¦çš„æ˜¯ IP å¤´åŒ…å«ä¸€ä¸ªå˜é‡ï¼Œè¯¦ç»†è¯´æ˜äº† IP å¤´ä¹‹åçš„æ•°æ®æ˜¯ä»€ä¹ˆã€‚è¿™é€šå¸¸æ˜¯ TCP å¤´æˆ– UDP å¤´ï¼Œä½†è¿˜æœ‰å…¶ä»–é€‰æ‹©ï¼Œä¾‹å¦‚ sctp ç­‰ã€‚\n\nä¸€æ—¦æˆ‘ä»¬æŸ¥çœ‹äº† IP å¤´çš„å†…éƒ¨å¹¶ç¡®å®šæ•°æ®ç±»å‹æ˜¯ TCPï¼ˆä¹Ÿå¯èƒ½æ˜¯ UDP æˆ–å…¶ä»–å†…å®¹ï¼‰ï¼Œæˆ‘ä»¬å°†æŠŠä»¥å¤ªç½‘å¤´å’Œ IP å¤´ä¹‹åçš„æ•°æ®éƒ½è½¬æ¢ä¸º TCP å¤´ç±»å‹ï¼ï¼ˆå‡ ä¹å®Œæˆäº†ï¼‰ã€‚é€šè¿‡è®¿é—® TCP å¤´çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— TCP ç‰¹å®šçš„æ•°æ®ï¼Œä¾‹å¦‚æºç«¯å£æˆ–ç›®æ ‡ç«¯å£ï¼Œç”¨äºéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§çš„æ ¡éªŒå’Œä»¥åŠå…¶ä»–æœ‰ç”¨çš„å˜é‡ã€‚\n\nç°åœ¨æˆ‘ä»¬å‡ ä¹æ‹¥æœ‰ä¸€åˆ‡ï¼Œä½†æ˜¯ TCP å¤´çš„é•¿åº¦å¯èƒ½æ˜¯å¯å˜çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡æŸ¥çœ‹ tcl_len å˜é‡æ¥ç¡®å®šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¹˜ä»¥ 4ã€‚ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†è®¿é—®æœ€ç»ˆæ•°æ®æ‰€éœ€çš„ä¸€åˆ‡ï¼\n\nå› æ­¤ï¼Œ\u0060*data\u0060æŒ‡å‘æ•°æ®çš„å¼€å¤´ï¼æˆ‘ä»¬å·²ç»ç¡®å®šäº†ä»¥å¤ªç½‘å¤´ä¹‹åæ˜¯ IP å¤´ï¼Œæœ€åæ˜¯ TCP å¤´ï¼Œè¿™æ„å‘³ç€\u0060*data \u002b ä»¥å¤ªç½‘å¤´ \u002b IP å¤´ \u002b TCP å¤´ = å®é™…åº”ç”¨ç¨‹åºæ•°æ®ï¼\n\n### æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›ä¿¡æ¯åšä»€ä¹ˆï¼Ÿ\n\nå½“æˆ‘ä»¬è§£æå„ç§æ ‡å¤´æ—¶ï¼Œå®é™…ä¸Šåœ¨ OSI æ¨¡å‹çš„ä¸åŒå±‚æ¬¡ä¸Šè§£é”äº†è¶Šæ¥è¶Šå¤šçš„ä¿¡æ¯ï¼\n\n**[ç¬¬ 2 å±‚]** ä»¥å¤ªç½‘å¤´ä¸ºæˆ‘ä»¬æä¾›äº†æºå’Œç›®æ ‡ç¡¬ä»¶åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥æ½œåœ¨åœ°é˜»æ­¢ä»æˆ‘ä»¬çŸ¥é“å±é™©çš„æº MAC åœ°å€å¤„ç†çš„å¸§ã€‚\n\n**[ç¬¬ 3 å±‚]** IP å¤´åŒ…å«æºå’Œç›®æ ‡ IP åœ°å€ï¼Œå†æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥åƒé˜²ç«å¢™ä¸€æ ·è¿ä½œï¼Œé€šè¿‡ä½¿ç”¨ eBPF ç¨‹åºä¸¢å¼ƒç‰¹å®š IP åœ°å€çš„æ‰€æœ‰æµé‡ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® IP åœ°å€é‡å®šå‘æµé‡ï¼Œæˆ–è€…ç”šè‡³åœ¨è¿™ä¸€å±‚å®æ–½è´Ÿè½½å‡è¡¡é€»è¾‘ï¼Œä»¥å°†æµé‡é‡å®šå‘åˆ°å…¶ä»–åº•å±‚ IP åœ°å€é›†åˆã€‚\n\n**[ç¬¬ 4 å±‚]** TCP æˆ– UDP æ ‡å¤´å®šä¹‰äº†ç›®æ ‡ç«¯å£å·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥ç¡®å®šåº”ç”¨ç¨‹åºåè®®æ˜¯ä»€ä¹ˆï¼ˆå³ç«¯å£ 80 é€šå¸¸æ„å‘³ç€å‰©ä½™çš„*data å¯èƒ½æ˜¯ HTTP æ•°æ®ï¼‰ã€‚åœ¨è¿™ä¸€å±‚ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ‰§è¡Œè´Ÿè½½å‡è¡¡ç­‰æ“ä½œï¼ŒåŸºäºç›®æ ‡ï¼ˆå³åœ¨å¤šä¸ªå…¶ä»–è´Ÿè½½å‡è¡¡å™¨åœ°å€ä¹‹é—´å¹³è¡¡ï¼‰ã€‚\n\n**[ç¬¬ 7 å±‚]** æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œå„ç§æ ‡å¤´é›†åˆçš„æœ«å°¾çš„æ•°æ®æ˜¯å®é™…çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“æ ¼å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è§£æå®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤–éƒ¨ Web æµè§ˆå™¨å°è¯•è®¿é—®æˆ‘çš„è®¡ç®—æœºä¸Šçš„\u0060\/index.html\u0060å¹¶é™„åŠ äº† eBPF ç¨‹åºï¼Œæˆ‘ä¼šè§£æåˆ° TCPï¼Œç„¶åç¡®å®šå®ƒæ˜¯ç«¯å£ 80ï¼Œç„¶ååº”ç”¨ç¨‹åºæ•°æ®åº”è¯¥æ˜¯ HTTP æ ¼å¼ã€‚æˆ‘å¯ä»¥é€šè¿‡æŸ¥çœ‹åº”ç”¨ç¨‹åºæ•°æ®çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ˆåœ¨æ‰€æœ‰æ ‡å¤´ä¹‹åï¼‰æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç ï¼š\n\n\u0060\u0060\u0060bash\nApplicationData = EthernetHDR \u002b IPHDR \u002b TCPHDR \/\/ å°†æ‰€æœ‰æ ‡å¤´é•¿åº¦ç›¸åŠ ä»¥æ‰¾åˆ°æ•°æ®\nIf ( data[ApplicationData] = \u0022G\u0022 \u0026\u0026 data[ApplicationData\u002b1] = \u0022E\u0022 \u0026\u0026 data[ApplicationData\u002b2] = \u0022T\u0022 ) {\n\t\/\/ è¿™æ˜¯ä¸€ä¸ªHTTP GETè¯·æ±‚\n\t\/\/ åšä¸€äº›ä»¤äººå…´å¥‹çš„äº‹æƒ…\n}\n\u0060\u0060\u0060\n\n## æ€»ç»“\n\nç°åœ¨æˆ‘ä»¬â€œæœ‰ç‚¹â€ç†è§£äº†è¿™ä¸ªé€»è¾‘ï¼Œä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥è€ƒè™‘å®æ–½ä¸€äº›ä»£ç æ¥å®Œæˆæ‰€æœ‰è¿™äº›...ä½†è¿™å°†æ˜¯å¦ä¸€å¤©çš„äº‹æƒ…ã€‚\n', '\/trans\/ebpf-adventures-in-networking\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">è¿™ç¯‡æ–‡ç« ä»‹ç»äº† eBPF åœ¨ç½‘ç»œé¢†åŸŸçš„ä¸€äº›åº”ç”¨å’Œå®è·µï¼ŒåŒ…æ‹¬ XDPã€TC å’Œ sysprobes ä¸‰ç§ä¸åŒçš„ eBPF ç¨‹åºæŒ‚è½½æ–¹å¼çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ eBPF å®ç°ç½‘ç»œæ•°æ®çš„æ•è·ã€åˆ†æå’Œä¿®æ”¹ã€‚ä½œè€…è¿˜åˆ†äº«äº†ä¸€äº›æœ‰ç”¨çš„ eBPF å·¥å…·å’Œèµ„æºï¼Œä»¥åŠè‡ªå·±å¼€å‘çš„ä¸€ä¸ª eBPF ç½‘ç»œä»£ç†çš„é¡¹ç›®ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/cilium-gateway-api/">[è¯‘] ä½¿ç”¨ Cilium å®ç° Gateway API æŒ‡å—</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/01/04</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://blog.ogenki.io/post/cilium-gateway-api/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä½¿ç”¨ Cilium å®ç° Gateway API æŒ‡å—', 'è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Cilium éƒ¨ç½²å’Œé…ç½® Gateway APIï¼Œä¸€ä¸ªæ–°çš„æœåŠ¡ç½‘æ ¼ APIï¼Œç”¨äºç®¡ç† Kubernetes ä¸­çš„æœåŠ¡é—´é€šä¿¡ã€‚æ–‡ç« è¯¦ç»†è¯´æ˜äº† Gateway API çš„æ¦‚å¿µå’Œç»„ä»¶ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Cilium çš„ç‰¹æ€§å’Œå·¥å…·ï¼Œå®ç°é«˜æ•ˆå’Œçµæ´»çš„è·¯ç”±ç­–ç•¥ã€‚', '\nåœ¨ Kubernetes ä¸Šéƒ¨ç½²åº”ç”¨ç¨‹åºåï¼Œé€šå¸¸çš„ä¸‹ä¸€æ­¥æ˜¯è®©ç”¨æˆ·å¯ä»¥è®¿é—®å®ƒã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨[**Ingress æ§åˆ¶å™¨**](https:\/\/kubernetes.io\/docs\/concepts\/services-networking\/ingress-controllers\/)ï¼Œä¾‹å¦‚ Nginxã€Haproxyã€Traefik æˆ–æ¥è‡ªäº‘æä¾›å•†çš„æ§åˆ¶å™¨ï¼Œæ¥å¼•å¯¼ä¼ å…¥çš„æµé‡åˆ°åº”ç”¨ç¨‹åºï¼Œç®¡ç†è´Ÿè½½å¹³è¡¡ã€TLS ç»ˆæ­¢ç­‰ç­‰ã€‚\n\nç„¶åï¼Œæˆ‘ä»¬å¿…é¡»ä»ä¼—å¤š[å¯ç”¨çš„é€‰é¡¹](https:\/\/kubernetes.io\/docs\/concepts\/services-networking\/ingress-controllers\/) ä¸­è¿›è¡Œé€‰æ‹©ã€‚Cilium æ˜¯å…¶ä¸­ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„é€‰é¡¹ï¼Œæ—¨åœ¨å¤„ç†æ‰€æœ‰è¿™äº›ç½‘ç»œæ–¹é¢çš„é—®é¢˜ã€‚\n\n[**Cilium**](https:\/\/cilium.io\/) æ˜¯ä¸€ä¸ªåŸºäº eBPF çš„å¼€æºç½‘ç»œå’Œå®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œå…¶é‡‡ç”¨é€Ÿåº¦å¢é•¿è¿…çŒ›ã€‚å®ƒå¯èƒ½æ˜¯æä¾›æœ€å¤šåŠŸèƒ½çš„ç½‘ç»œæ’ä»¶ä¹‹ä¸€ã€‚æˆ‘ä»¬ä¸ä¼šæ¶µç›–æ‰€æœ‰åŠŸèƒ½ï¼Œä½†å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½æ¶‰åŠä½¿ç”¨[**Gateway API**](https:\/\/gateway-api.sigs.k8s.io\/) (\u0060GAPI\u0060) ç®¡ç†ä¼ å…¥æµé‡ã€‚\n\n## æˆ‘ä»¬çš„ç›®æ ‡\n\n- å‡†ç¡®äº†è§£ **Gateway API** æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒå¦‚ä½•ä»£è¡¨ä» \u0060Ingress\u0060 API è¿›åŒ–è€Œæ¥ã€‚\n- æ¼”ç¤ºä»¥ GitOps æ–¹å¼éƒ¨ç½²çš„çœŸå®åœºæ™¯ã€‚\n- å½“å‰çš„é™åˆ¶å’Œå³å°†æ¨å‡ºçš„æ–°åŠŸèƒ½ã€‚\n\n{{\u003ccallout note æç¤º\u003e}}\n\næœ¬æ–‡ä¸­æ‰§è¡Œçš„æ‰€æœ‰æ­¥éª¤éƒ½æ¥è‡ªè¿™ä¸ª[**git å­˜å‚¨åº“**](https:\/\/github.com\/Smana\/cilium-gateway-api)ã€‚\n\næˆ‘é¼“åŠ±ä½ æ¢ç´¢å®ƒï¼Œå› ä¸ºå®ƒè¿œè¿œè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼š\n\n- ä½¿ç”¨å¯ç”¨äº† kube-proxy æ›¿ä»£å¹¶å…·æœ‰ä¸“ç”¨ Daemonset ç”¨äº \u0060Envoy\u0060 çš„ \u0060Cilium\u0060 é…ç½®çš„ **EKS** é›†ç¾¤çš„å®‰è£…ã€‚\n- æå‡ºäº†å…·æœ‰ä¾èµ–å…³ç³»ç®¡ç†å’Œæˆ‘è®¤ä¸ºéå¸¸é«˜æ•ˆçš„ DRY ä»£ç çš„ \u0060Flux\u0060 ç»“æ„ã€‚\n- ç®€åŒ–äº†ç”¨äºå¹³å°ç»„ä»¶çš„ IAM æƒé™ç®¡ç†çš„ \u0060Crossplane\u0060 å’Œ [IRSA](https:\/\/docs.aws.amazon.com\/eks\/latest\/userguide\/iam-roles-for-service-accounts.html) ç»„åˆã€‚\n- ä½¿ç”¨ \u0060External-DNS\u0060 å’Œ \u0060Let\u0027s Encrypt\u0060 è‡ªåŠ¨ç®¡ç†åŸŸåå’Œè¯ä¹¦ã€‚\n\nè¿™ä¸ªæƒ³æ³•æ˜¯åªéœ€å‡ åˆ†é’Ÿå†…è®¾ç½®å¥½ä¸€åˆ‡ï¼Œåªéœ€ä¸€ä¸ªå‘½ä»¤è¡Œã€‚\n\n{{\u003c\/callout\u003e}}\n\n## ä»‹ç» Gateway API\n\næ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæœ‰è®¸å¤š**Ingress æ§åˆ¶å™¨**é€‰é¡¹ï¼Œæ¯ä¸ªéƒ½æœ‰å…¶ç‰¹å®šæ€§å’Œç‰¹æ®ŠåŠŸèƒ½ï¼Œæœ‰æ—¶ä¼šä½¿å®ƒä»¬çš„ä½¿ç”¨å˜å¾—å¤æ‚ã€‚æ­¤å¤–ï¼ŒKubernetes ä¸­ä¼ ç»Ÿçš„ \u0060Ingress\u0060 API å…·æœ‰éå¸¸æœ‰é™çš„å‚æ•°ã€‚ä¸€äº›è§£å†³æ–¹æ¡ˆç”šè‡³åˆ›å»ºäº†è‡ªå·±çš„[CRDs](https:\/\/kubernetes.io\/docs\/concepts\/extend-kubernetes\/api-extension\/custom-resources\/)ï¼ˆKubernetes è‡ªå®šä¹‰èµ„æºï¼‰ï¼Œè€Œå…¶ä»–è§£å†³æ–¹æ¡ˆåˆ™ä½¿ç”¨ \u0060annotations\u0060 æ¥å…‹æœè¿™äº›é™åˆ¶ã€‚\n\nè¿™å°±æ˜¯**Gateway API**çš„ç”¨æ­¦ä¹‹åœ°ï¼å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§**æ ‡å‡†**ï¼Œå…è®¸å£°æ˜é«˜çº§ç½‘ç»œåŠŸèƒ½ï¼Œè€Œæ— éœ€å¯¹åº•å±‚æ§åˆ¶å™¨è¿›è¡Œç‰¹å®šæ‰©å±•ã€‚è€Œä¸”ï¼Œç”±äºæ‰€æœ‰æ§åˆ¶å™¨éƒ½ä½¿ç”¨ç›¸åŒçš„ APIï¼Œå› æ­¤å¯ä»¥åœ¨ä¸æ”¹å˜é…ç½®çš„æƒ…å†µä¸‹ä»ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ˆKubernetes æ¸…å•æè¿°äº†å¦‚ä½•è·¯ç”±ä¼ å…¥æµé‡ï¼‰ã€‚\n\nåœ¨æˆ‘ä»¬å°†è¦æ¢è®¨çš„æ¦‚å¿µä¸­ï¼ŒGAPI å¼•å…¥äº†ä¸€ä¸ªç²¾ç»†çš„æˆæƒæ¨¡å‹ï¼Œå®šä¹‰äº†å…·æœ‰ä¸åŒæƒé™çš„**æ˜¾å¼è§’è‰²**ï¼ˆæœ‰å…³ GAPI å®‰å…¨æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[è¿™é‡Œ](https:\/\/gateway-api.sigs.k8s.io\/concepts\/security-model\/#roles-and-personas)ï¼‰ã€‚\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¯¥é¡¹ç›®ç”±[sig-network-kubernetes](https:\/\/github.com\/kubernetes\/community\/tree\/master\/sig-network)å·¥ä½œç»„æ¨åŠ¨ï¼Œè¿˜æœ‰ä¸€ä¸ª Slack [é¢‘é“](https:\/\/kubernetes.slack.com\/archives\/CR0H13KGA)ï¼Œä½ å¯ä»¥åœ¨éœ€è¦æ—¶è”ç³»ä»–ä»¬ã€‚\n\nè®©æˆ‘ä»¬çœ‹çœ‹åœ¨å®è·µä¸­å¦‚ä½•ä½¿ç”¨ GAPI ä¸ Ciliumï¼\n\n## å…ˆå†³æ¡ä»¶\n\nåœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å‡è®¾å·²éƒ¨ç½²äº†ä¸€ä¸ª EKS é›†ç¾¤ã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨[æ¼”ç¤ºå­˜å‚¨åº“ä¸­å»ºè®®çš„æ–¹æ³•](https:\/\/github.com\/Smana\/cilium-gateway-api\/tree\/main\/terraform\/eks)ä½œä¸ºæœ¬æ–‡çš„åŸºç¡€ï¼Œé‚£ä¹ˆæœ‰ä¸€äº›**è¦æ£€æŸ¥çš„è¦ç‚¹**ï¼Œä»¥ä¾¿ä½¿ç”¨ GAPIã€‚\n\næ­¤å¤„æè¿°çš„å®‰è£…æ–¹æ³•åŸºäº \u0060Helm\u0060ï¼Œæ‰€æœ‰çš„ \u0060values\u0060 å¯ä»¥åœ¨[è¿™é‡Œ](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/terraform\/eks\/helm_values\/cilium.yaml)æŸ¥çœ‹ã€‚\n\n- åœ¨[Gateway API](https:\/\/github.com\/kubernetes-sigs\/gateway-api\/tree\/main\/config\/crd)å­˜å‚¨åº“ä¸­**å®‰è£…**å¯ç”¨çš„ \u0060CRDs\u0060ã€‚\n\n  {{\u003ccallout note æ³¨æ„\u003e}}\n\n  å¦‚æœ Cilium è®¾ç½®ä¸ºæ”¯æŒ \u0060GAPI\u0060ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œå¹¶ä¸”ç¼ºå°‘ CRDsï¼Œåˆ™å®ƒå°†æ— æ³•å¯åŠ¨ã€‚åœ¨[æ¼”ç¤ºå­˜å‚¨åº“](https:\/\/github.com\/Smana\/cilium-gateway-api)ä¸­ï¼Œ**GAPI CRDs**åœ¨é›†ç¾¤åˆ›å»ºæœŸé—´å®‰è£…ä¸€æ¬¡ï¼Œä»¥ä¾¿ Cilium å¯ä»¥å¯åŠ¨ï¼Œç„¶åç”± Flux ç®¡ç†ã€‚\n\n  {{\u003c\/callout\u003e}}\n\n- ä½¿ç”¨ Cilium å’Œ \u0060eBPF\u0060 çš„ç½‘ç»œè½¬å‘åŠŸèƒ½**æ›¿æ¢** \u0060kube-proxy\u0060ã€‚\n\n  \u0060\u0060\u0060yaml\n  kubeProxyReplacement: true\n  \u0060\u0060\u0060\n\n- **å¯ç”¨** Gateway API æ”¯æŒã€‚\n\n  \u0060\u0060\u0060yaml\n  gatewayAPI:\n    enabled: true\n  \u0060\u0060\u0060\n\n- **æ£€æŸ¥**å®‰è£…ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å®‰è£…åä¸º \u0060cilium\u0060 çš„å‘½ä»¤è¡Œå·¥å…·ã€‚æˆ‘ä¸ªäººä½¿ç”¨ [asdf](https:\/\/blog.ogenki.io\/post\/asdf\/asdf\/)ï¼š\n\n  \u0060\u0060\u0060console\n  asdf plugin-add cilium-cli\n  asdf install cilium-cli 0.15.7\n  asdf global cilium 0.15.7\n  \u0060\u0060\u0060\n\n  ä»¥ä¸‹å‘½ä»¤å…è®¸ç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½æ­£å¸¸è¿è¡Œï¼š\n\n  \u0060\u0060\u0060console\n  cilium status --wait\n     \/Â¯Â¯\\\n  \/Â¯Â¯\\__\/Â¯Â¯\\    Cilium:             OK\n  \\__\/Â¯Â¯\\__\/    Operator:           OK\n  \/Â¯Â¯\\__\/Â¯Â¯\\    Envoy DaemonSet:    OK\n  \\__\/Â¯Â¯\\__\/    Hubble Relay:       disabled\n     \\__\/       ClusterMesh:        disabled\n  \n  Deployment             cilium-operator    Desired: 2, Ready: 2\/2, Available: 2\/2\n  DaemonSet              cilium             Desired: 2, Ready: 2\/2, Available: 2\/2\n  DaemonSet              cilium-envoy       Desired: 2, Ready: 2\/2, Available: 2\/2\n  Containers:            cilium             Running: 2\n                        cilium-operator    Running: 2\n                        cilium-envoy       Running: 2\n  Cluster Pods:          33\/33 managed by Cilium\n  Helm chart version:    1.14.2\n  Image versions         cilium             quay.io\/cilium\/cilium:v1.14.2@sha256:6263f3a3d5d63b267b538298dbeb5ae87da3efacf09a2c620446c873ba807d35: 2\n                        cilium-operator    quay.io\/cilium\/operator-aws:v1.14.2@sha256:8d514a9eaa06b7a704d1ccead8c7e663334975e6584a815efe2b8c15244493f1: 2\n                        cilium-envoy       quay.io\/cilium\/cilium-envoy:v1.25.9-e198a2824d309024cb91fb6a984445e73033291d@sha256:52541e1726041b050c5d475b3c527ca4b8da487a0bbb0309f72247e8127af0ec: 2\n  \u0060\u0060\u0060\n\n  æœ€åï¼Œä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† Gateway API æ”¯æŒï¼š\n\n  \u0060\u0060\u0060console\n  cilium config view | grep -w \u0022enable-gateway-api\u0022\n  enable-gateway-api                                true\n  enable-gateway-api-secrets-sync                   true\n  \u0060\u0060\u0060\n\n  ä½ è¿˜å¯ä»¥è¿è¡Œä»¥ä¸‹ç«¯åˆ°ç«¯æµ‹è¯•ï¼š\n\n  \u0060\u0060\u0060console\n  cilium connectivity test\n  \u0060\u0060\u0060\n\n  ä½†æ˜¯ï¼Œæ­¤å‘½ä»¤ï¼ˆ\u0060connectivity test\u0060ï¼‰å½“å‰åœ¨å¯ç”¨ Envoy ä½œä¸º DaemonSet æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚([Github Issue](https:\/\/github.com\/cilium\/cilium\/issues\/28057))ã€‚\n\n{{\u003ccallout note æç¤º\u003e}}\n  **Envoy ä½œä¸º DaemonSet**\n\n  é»˜è®¤æƒ…å†µä¸‹ï¼ŒCilium ä»£ç†è¿˜åœ¨åŒä¸€ Pod ä¸­è¿è¡Œ \u0060Envoy\u0060ï¼Œå¹¶å§”æ‰˜ç»™å®ƒçº§åˆ« 7 çš„ç½‘ç»œæ“ä½œã€‚ä»ç‰ˆæœ¬ \u0060v1.14\u0060 å¼€å§‹ï¼Œå¯ä»¥å°† Envoy å•ç‹¬éƒ¨ç½²ï¼Œè¿™å¸¦æ¥äº†ä¸€äº›å¥½å¤„ï¼š\n\n  - å¦‚æœä¿®æ”¹\/é‡æ–°å¯åŠ¨ä¸€ä¸ªç»„ä»¶ï¼ˆæ— è®ºæ˜¯ Cilium è¿˜æ˜¯ Envoyï¼‰ï¼Œéƒ½ä¸ä¼šå½±å“å¦ä¸€ä¸ªç»„ä»¶ã€‚\n  - æ›´å¥½åœ°åˆ†é…èµ„æºç»™æ¯ä¸ªç»„ä»¶ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚\n  - åœ¨æŸä¸ª Pod è¢«æ”»å‡»çš„æƒ…å†µä¸‹é™åˆ¶æ”»å‡»é¢ã€‚\n  - Envoy æ—¥å¿—å’Œ Cilium ä»£ç†æ—¥å¿—ä¸ä¼šæ··åˆåœ¨ä¸€èµ·ã€‚\n\n  ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ­¤åŠŸèƒ½æ˜¯å¦å·²å¯ç”¨ï¼š\n\n  \u0060\u0060\u0060console\n  cilium status\n      \/Â¯Â¯\\\n   \/Â¯Â¯\\__\/Â¯Â¯\\    Cilium:             OK\n   \\__\/Â¯Â¯\\__\/    Operator:           OK\n   \/Â¯Â¯\\__\/Â¯Â¯\\    Envoy DaemonSet:    OK\n   \\__\/Â¯Â¯\\__\/    Hubble Relay:       disabled\n      \\__\/       ClusterMesh:        disabled\n  \u0060\u0060\u0060\n\n  [æ›´å¤šä¿¡æ¯](https:\/\/isovalent.com\/blog\/post\/cilium-release-114\/#h-envoy-daemonset)ã€‚\n{{\u003c\/callout\u003e}}\n\n## å…¥å£ç‚¹ï¼šGatewayClass å’Œ Gateway\n\n![ç½‘å…³](gateway.jpg)\n\nä¸€æ—¦æ»¡è¶³å…ˆå†³æ¡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®å¤šä¸ªå…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Gateway API CRDs å®šä¹‰çš„è‡ªå®šä¹‰èµ„æºã€‚è€Œä¸”ï¼Œåœ¨å®‰è£… Cilium åï¼Œä¸€ä¸ª \u0060GatewayClass\u0060 ç«‹å³å¯ç”¨ã€‚\n\n\u0060\u0060\u0060console\nkubectl get gatewayclasses.gateway.networking.k8s.io\nNAME     CONTROLLER                     ACCEPTED   AGE\ncilium   io.cilium\/gateway-controller   True       7m59s\n\u0060\u0060\u0060\n\nåœ¨ Kubernetes é›†ç¾¤ä¸Šï¼Œä½ å¯ä»¥é…ç½®å¤šä¸ª \u0060GatewayClasses\u0060ï¼Œä»è€Œèƒ½å¤Ÿä½¿ç”¨ä¸åŒçš„å®ç°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ \u0060Gateway\u0060 é…ç½®ä¸­å¼•ç”¨ GatewayClass æ¥ä½¿ç”¨ \u0060Linkerd\u0060ã€‚\n\n\u0060Gateway\u0060 æ˜¯å…è®¸è§¦å‘åœ¨äº‘æä¾›å•†ä¸­åˆ›å»ºè´Ÿè½½å‡è¡¡ç»„ä»¶çš„èµ„æºã€‚\n\nè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š[apps\/base\/echo\/gateway.yaml](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/apps\/base\/echo\/gateway.yaml)\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1beta1\nkind: Gateway\nmetadata:\n  name: echo-gateway\n  namespace: echo\nspec:\n  gatewayClassName: cilium\n  listeners:\n    - protocol: HTTP\n      port: 80\n      name: echo-1-echo-server\n      allowedRoutes:\n        namespaces:\n          from: Same\n\u0060\u0060\u0060\n\nåœ¨ AWSï¼ˆEKSï¼‰ä¸Šï¼Œé…ç½® \u0060Gateway\u0060 æ—¶ï¼ŒCilium ä¼šåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º \u0060LoadBalancer\u0060 çš„ \u0060Service\u0060ã€‚ç„¶åï¼Œå¦ä¸€ä¸ªæ§åˆ¶å™¨ï¼ˆ[AWS Load Balancer Controller](https:\/\/kubernetes-sigs.github.io\/aws-load-balancer-controller)ï¼‰å¤„ç†äº‘è´Ÿè½½å‡è¡¡å™¨ï¼ˆ[NLB](https:\/\/docs.aws.amazon.com\/elasticloadbalancing\/latest\/network\/introduction.html)ï¼‰çš„åˆ›å»ºã€‚\n\n\u0060\u0060\u0060console\nkubectl get svc -n echo cilium-gateway-echo\nNAME                  TYPE           CLUSTER-IP     EXTERNAL-IP                                                                 PORT(S)        AGE\ncilium-gateway-echo   LoadBalancer   172.20.19.82   k8s-echo-ciliumga-64708ec85c-fcb7661f1ae4e4a4.elb.eu-west-3.amazonaws.com   80:30395\/TCP   2m58s\n\u0060\u0060\u0060\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè´Ÿè½½å‡è¡¡å™¨åœ°å€ä¹Ÿä¸ \u0060Gateway\u0060 ç›¸å…³è”ã€‚\n\n\u0060\u0060\u0060console\nkubectl get gateway -n echo echo\nNAME   CLASS    ADDRESS                                                                     PROGRAMMED   AGE\necho   cilium   k8s-echo-ciliumga-64708ec85c-fcb7661f1ae4e4a4.elb.eu-west-3.amazonaws.com   True         16m\n\u0060\u0060\u0060\n\n## è·¯ç”±è§„åˆ™ï¼šHTTPRoute\n\n### åŸºæœ¬è§„åˆ™\n\n![HTTPRoute](httproute.jpg)\n\nç®€è€Œè¨€ä¹‹ï¼Œä¸Šé¢çš„å›¾è¡¨å¯æ€»ç»“ä¸ºå‡ å¥è¯ï¼š\u0060HTTPRoute\u0060 å…è®¸é€šè¿‡å¼•ç”¨ Gateway å¹¶å®šä¹‰æ‰€éœ€çš„è·¯ç”±å‚æ•°æ¥é…ç½®åˆ°æœåŠ¡çš„è·¯ç”±ã€‚\n\n{{\u003ccallout note æç¤º\u003e}}\n**Kyverno**\n\næˆªæ­¢ç›®å‰ï¼Œæ— æ³•é…ç½®ç”± \u0060Gateways\u0060 ç”Ÿæˆçš„æœåŠ¡çš„æ³¨é‡Šï¼ˆ[Github Issue](https:\/\/github.com\/cilium\/cilium\/issues\/25357)ï¼‰ã€‚å·²æå‡ºä¸€ç§è§£å†³æ–¹æ³•ï¼Œå³åœ¨åˆ›å»º \u0060Gateway\u0060 åç«‹å³ä¿®æ”¹ç”± \u0060Gateway\u0060 åˆ›å»ºçš„æœåŠ¡ã€‚\n\nKyverno æ˜¯ä¸€ç§ç¡®ä¿é…ç½®ç¬¦åˆæœ€ä½³å®è·µå’Œå®‰å…¨è¦æ±‚çš„å·¥å…·ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä»…ä»…ä½¿ç”¨å®ƒæ¥è½»æ¾æè¿°[çªå˜](https:\/\/kyverno.io\/docs\/writing-policies\/mutate\/)è§„åˆ™ã€‚\n\n[security\/mycluster-0\/echo-gw-clusterpolicy.yaml](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/security\/mycluster-0\/echo-gw-clusterpolicy.yaml)\n\n\u0060\u0060\u0060yaml\nspec:\n  rules:\n    - name: mutate-svc-annotations\n      match:\n        any:\n          - resources:\n              kinds:\n                - Service\n              namespaces:\n                - echo\n              name: cilium-gateway-echo\n      mutate:\n        patchStrategicMerge:\n          metadata:\n            annotations:\n              external-dns.alpha.kubernetes.io\/hostname: echo.${domain_name}\n              service.beta.kubernetes.io\/aws-load-balancer-scheme: \u0022internet-facing\u0022\n              service.beta.kubernetes.io\/aws-load-balancer-backend-protocol: tcp\n          spec:\n            loadBalancerClass: service.k8s.aws\/nlb\n\u0060\u0060\u0060\n\nå› æ­¤ï¼ŒæœåŠ¡ \u0060cilium-gateway-echo\u0060 å°†æ·»åŠ  AWS æ§åˆ¶å™¨çš„æ³¨é‡Šï¼Œä»¥åŠä¸€ä¸ªå…è®¸è‡ªåŠ¨ DNS è®°å½•é…ç½®çš„æ³¨é‡Šã€‚\n{{\u003c\/callout\u003e}}\n\n[apps\/base\/echo\/httproute.yaml](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/apps\/base\/echo\/httproute.yaml)\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: echo-1\n  namespace: echo\nspec:\n  parentRefs:\n    - name: echo\n      namespace: echo\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: \/\n      backendRefs:\n        - name: echo-1-echo-server\n          port: 80\n\u0060\u0060\u0060\n\nä¸Šé¢ä½¿ç”¨çš„ç¤ºä¾‹éå¸¸ç®€å•ï¼šæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ° \u0060echo-1-echo-server\u0060 æœåŠ¡ã€‚\n\n\u0060parentRefs\u0060 æŒ‡ç¤ºä½¿ç”¨å“ªä¸ª \u0060Gateway\u0060ï¼Œç„¶ååœ¨ \u0060rules\u0060 éƒ¨åˆ†å®šä¹‰äº†è·¯ç”±è§„åˆ™ã€‚\n\nè·¯ç”±è§„åˆ™è¿˜å¯ä»¥åŸºäº \u0060path\u0060ã€‚\n\n\u0060\u0060\u0060yaml\n...\nspec:\n  hostnames:\n  - foo.bar.com\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: \/login\n\u0060\u0060\u0060\n\næˆ–è€…åŸºäº HTTP æ ‡å¤´\n\n\u0060\u0060\u0060yaml\n...\nspec:\n  rules:\n  - matches:\n      headers:\n      - name: \u0022version\u0022\n        value: \u00222\u0022\n...\n\u0060\u0060\u0060\n\nè®©æˆ‘ä»¬æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯è®¿é—®ã€‚\n\n\u0060\u0060\u0060console\ncurl -s http:\/\/echo.cloud.ogenki.io | jq -rc \u0027.environment.HOSTNAME\u0027\necho-1-echo-server-fd88497d-w6sgn\n\u0060\u0060\u0060\n\næ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¯¥æœåŠ¡ä»¥ HTTP æ–¹å¼æš´éœ²ï¼Œæ²¡æœ‰è¯ä¹¦ã€‚è®©æˆ‘ä»¬å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n### é…ç½® TLS è¯ä¹¦\n\næœ‰å¤šç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ GAPI é…ç½® TLSã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ€å¸¸è§çš„æƒ…å†µï¼šHTTPS åè®®å’Œåœ¨ Gateway ä¸Šç»ˆæ­¢ TLSã€‚\n\nå‡è®¾æˆ‘ä»¬æƒ³è¦é…ç½®ä¹‹å‰ä½¿ç”¨çš„åŸŸå \u0060echo.cloud.ogenki.io\u0060ã€‚é…ç½®ä¸»è¦é€šè¿‡é…ç½® \u0060Gateway\u0060 æ¥å®Œæˆã€‚\n\n[apps\/base\/echo\/tls-gateway.yaml](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/apps\/base\/echo\/tls-gateway.yaml)\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1beta1\nkind: Gateway\nmetadata:\n  name: echo\n  namespace: echo\n  annotations:\n    cert-manager.io\/cluster-issuer: letsencrypt-prod\nspec:\n  gatewayClassName: cilium\n  listeners:\n    - name: http\n      hostname: \u0022echo.${domain_name}\u0022\n      port: 443\n      protocol: HTTPS\n      allowedRoutes:\n        namespaces:\n          from: Same\n      tls:\n        mode: Terminate\n        certificateRefs:\n          - name: echo-tls\n\u0060\u0060\u0060\n\nè¿™é‡Œçš„å…³é”®ç‚¹æ˜¯å¼•ç”¨ä¸€ä¸ªåŒ…å«åç§°ä¸º \u0060echo-tls\u0060 çš„è¯ä¹¦çš„å¯†é’¥ã€‚è¿™ä¸ªè¯ä¹¦å¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œä½†æ˜¯ä¸ºäº†æœ¬æ–‡ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ **Let\u0027s Encrypt** å’Œ \u0060cert-manager\u0060 æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚\n\n{{\u003ccallout note æç¤º\u003e}}}\n**cert-manager**\n\nä½¿ç”¨ \u0060cert-manager\u0060ï¼Œè‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°ç”± \u0060Gateway\u0060 æš´éœ²çš„è¯ä¹¦éå¸¸ç®€å•ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å…è®¸æ§åˆ¶å™¨è®¿é—® [route53](https:\/\/aws.amazon.com\/route53\/)ï¼Œä»¥è§£å†³ DNS01 æŒ‘æˆ˜ï¼ˆè¿™æ˜¯ä¸€ç§ç¡®ä¿å®¢æˆ·ç«¯åªèƒ½ä¸ºè‡ªå·±æ‹¥æœ‰çš„åŸŸè¯·æ±‚è¯ä¹¦çš„æœºåˆ¶ï¼‰ã€‚\n\n[ClusterIssuer](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/security\/base\/cert-manager\/cluster-issuer-staging.yaml) èµ„æºæè¿°äº†ä½¿ç”¨ cert-manager ç”Ÿæˆè¯ä¹¦æ‰€éœ€çš„é…ç½®ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Š \u0060cert-manager.io\/cluster-issuer\u0060 å¹¶è®¾ç½®å­˜å‚¨è¯ä¹¦çš„ Kubernetes å¯†é’¥ã€‚\n\n[æ›´å¤šä¿¡æ¯](https:\/\/cert-manager.io\/docs\/usage\/gateway\/)\n\nåœ¨æ¼”ç¤ºå­˜å‚¨åº“ä¸­ï¼Œæƒé™æ˜¯ä½¿ç”¨ \u0060Crossplane\u0060 åˆ†é…çš„ï¼Œå®ƒè´Ÿè´£åœ¨ AWS ä¸­é…ç½®è¿™äº› IAM æƒé™ã€‚\n{{\u003c\/callout\u003e}}\n\nä¸ºäº†ä½¿è·¯ç”±æ­£å¸¸å·¥ä½œï¼Œä½ è¿˜éœ€è¦å°† \u0060HTTPRoute\u0060 é™„åŠ åˆ°æ­£ç¡®çš„ \u0060Gateway\u0060 å¹¶æŒ‡å®šåŸŸåã€‚\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: echo-1\n  namespace: echo\nspec:\n  parentRefs:\n    - name: echo\n      namespace: echo\n  hostnames:\n    - \u0022echo.${domain_name}\u0022\n...\n\u0060\u0060\u0060\n\nå‡ ç§’é’Ÿåï¼Œè¯ä¹¦å°†è¢«åˆ›å»ºã€‚\n\n\u0060\u0060\u0060console\nkubectl get cert -n echo\nNAME       READY   SECRET     AGE\necho-tls   True    echo-tls   43m\n\u0060\u0060\u0060\n\næœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥è¯ä¹¦ç¡®å®æ¥è‡ª Let\u0027s Encryptï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n\u0060\u0060\u0060console\ncurl https:\/\/echo.cloud.ogenki.io -v 2\u003e\u00261 | grep -A 6 \u0027Server certificate\u0027\n* Server certificate:\n*  subject: CN=echo.cloud.ogenki.io\n*  start date: Sep 15 14:43:00 2023 GMT\n*  expire date: Dec 14 14:42:59 2023 GMT\n*  subjectAltName: host \u0022echo.cloud.ogenki.io\u0022 matched cert\u0027s \u0022echo.cloud.ogenki.io\u0022\n*  issuer: C=US; O=Let\u0027s Encrypt; CN=R3\n*  SSL certificate verify ok.\n\u0060\u0060\u0060\n\n{{\u003ccallout note æç¤º\u003e}}\nGAPI è¿˜å…è®¸ä½ é…ç½® **ç«¯åˆ°ç«¯çš„ TLS**ï¼Œä¸€ç›´åˆ°å®¹å™¨ã€‚è¿™æ˜¯é€šè¿‡é…ç½® \u0060Gateway\u0060 ä¸º \u0060Passthrough\u0060 æ¨¡å¼å¹¶ä½¿ç”¨ \u0060TLSRoute\u0060 èµ„æºæ¥å®Œæˆçš„ã€‚è¯ä¹¦ä¹Ÿå¿…é¡»ç”±æ‰§è¡Œ TLS ç»ˆæ­¢çš„ pod æºå¸¦ã€‚\n{{\u003c\/callout\u003e}}\n\n### åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å…±äº« Gateway\n\n![å…±äº«ç½‘å…³](shared-gateway.jpg)\n\nä½¿ç”¨ \u0060GAPI\u0060ï¼Œä½ å¯ä»¥åœ¨ \u0060å‘½åç©ºé—´\u0060 ä¹‹é—´è·¯ç”±æµé‡ã€‚è¿™å¾—ç›Šäºæ¯ä¸ªåŠŸèƒ½çš„ä¸åŒèµ„æºï¼šä¸€ä¸ª \u0060Gateway\u0060 å…è®¸é…ç½®åŸºç¡€è®¾æ–½ï¼Œä»¥åŠ \u0060*Routes\u0060ã€‚è¿™äº›è·¯ç”±å¯ä»¥é™„åŠ åˆ°ä½äºå¦ä¸€ä¸ªå‘½åç©ºé—´ä¸­çš„ Gatewayã€‚å› æ­¤ï¼Œä¸åŒçš„å›¢é˜Ÿ\/é¡¹ç›®å¯ä»¥å…±äº«ç›¸åŒçš„åŸºç¡€è®¾æ–½ç»„ä»¶ã€‚\n\nä½†æ˜¯ï¼Œè¿™éœ€è¦æŒ‡å®šå“ªä¸ªè·¯ç”±å…è®¸å¼•ç”¨è¯¥ Gatewayã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºå†…éƒ¨å·¥å…·çš„ Gatewayï¼Œåä¸º \u0060platform\u0060ã€‚é€šè¿‡ä½¿ç”¨ \u0060allowedRoutes\u0060 å‚æ•°ï¼Œæˆ‘ä»¬æ˜ç¡®æŒ‡å®šäº†å“ªäº›å‘½åç©ºé—´å…è®¸é™„åŠ åˆ°æ­¤ Gatewayã€‚\n\n[infrastructure\/base\/gapi\/platform-gateway.yaml](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/infrastructure\/base\/gapi\/platform-gateway.yaml)\n\n\u0060\u0060\u0060yaml\n...\n      allowedRoutes:\n        namespaces:\n          from: Selector\n          selector:\n            matchExpressions:\n              - key: kubernetes.io\/metadata.name\n                operator: In\n                values:\n                  - observability\n                  - flux-system\n      tls:\n        mode: Terminate\n        certificateRefs:\n          - name: platform-tls\n\u0060\u0060\u0060\n\nåœ¨å‘½åç©ºé—´ \u0060observability\u0060 å’Œ \u0060flux-system\u0060 ä¸­é…ç½®çš„ \u0060HTTPRoutes\u0060 é™„åŠ åˆ°æ­¤å”¯ä¸€çš„ \u0060Gateway\u0060ã€‚\n\n\u0060\u0060\u0060yaml\n...\nspec:\n  parentRefs:\n    - name: platform\n      namespace: infrastructure\n\u0060\u0060\u0060\n\nå› æ­¤ï¼Œä½¿ç”¨æ¥è‡ªäº‘æä¾›å•†çš„ç›¸åŒè´Ÿè½½å‡è¡¡å™¨ã€‚\n\n\u0060\u0060\u0060console\nNLB_DOMAIN=$(kubectl get svc -n infrastructure cilium-gateway-platform -o jsonpath={.status.loadBalancer.ingress[0].hostname})\n\ndig \u002bshort ${NLB_DOMAIN}\n13.36.89.108\n\ndig \u002bshort grafana-mycluster-0.cloud.ogenki.io\n13.36.89.108\n\ndig \u002bshort gitops-mycluster-0.cloud.ogenki.io\n13.36.89.108\n\u0060\u0060\u0060\n\n{{\u003ccallout note æ³¨æ„\u003e}}\nè¿™äº›å†…éƒ¨å·¥å…·ä¸åº”è¯¥æš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œä½†æ˜¯ä½ çŸ¥é“ï¼šè¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…éƒ¨ Gatewayï¼ˆç§æœ‰ IPï¼‰é€šè¿‡è°ƒæ•´æ³¨é‡Šå¹¶ä½¿ç”¨ç§æœ‰è¿æ¥ç³»ç»Ÿï¼ˆVPNã€éš§é“ç­‰ï¼‰æ¥å®ç°ã€‚\n{{\u003c\/callout\u003e}}\n\n### æµé‡åˆ†æµ\n\n![åˆ†æµ](split.jpg)\n\nç”±æœåŠ¡ç½‘æ ¼å¸¸å¸¸æä¾›çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯åœ¨æœ‰æ–°ç‰ˆæœ¬å¯ç”¨æ—¶ï¼ˆA\/B æµ‹è¯•æˆ–é‡‘ä¸é›€éƒ¨ç½²ï¼‰å¯¹éƒ¨åˆ†æµé‡æµ‹è¯•åº”ç”¨ç¨‹åºçš„èƒ½åŠ›ã€‚\u0060GAPI\u0060é€šè¿‡ä½¿ç”¨æƒé‡æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä½¿å…¶å˜å¾—éå¸¸ç®€å•ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªå°† 5% çš„æµé‡è½¬å‘åˆ°æœåŠ¡ \u0060echo-2-echo-server\u0060 çš„ç¤ºä¾‹ï¼š\n\n[apps\/base\/echo\/httproute-split.yaml](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/apps\/base\/echo\/httproute-split.yaml)\n\n\u0060\u0060\u0060yaml\n...\n  hostnames:\n    - \u0022split-echo.${domain_name}\u0022\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: \/\n      backendRefs:\n        - name: echo-1-echo-server\n          port: 80\n          weight: 95\n        - name: echo-2-echo-server\n          port: 80\n          weight: 5\n\u0060\u0060\u0060\n\nè®©æˆ‘ä»¬æ£€æŸ¥åˆ†å‘æ˜¯å¦æŒ‰é¢„æœŸè¿›è¡Œï¼š\n\n[scripts\/check-split.sh](https:\/\/github.com\/Smana\/cilium-gateway-api\/blob\/main\/scripts\/check-split.sh)\n\n\u0060\u0060\u0060console\n.\/scripts\/check-split.sh https:\/\/split-echo.cloud.ogenki.io\necho-1 çš„è¯·æ±‚æ¬¡æ•°ï¼š95\necho-2 çš„è¯·æ±‚æ¬¡æ•°ï¼š5\n\u0060\u0060\u0060\n\n### ä¿®æ”¹æ ‡å¤´\n\nè¿˜å¯ä»¥æ›´æ”¹ HTTP **æ ‡å¤´**ï¼šæ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å®ƒä»¬ã€‚è¿™äº›ä¿®æ”¹å¯ä»¥é€šè¿‡åœ¨ \u0060HTTPRoute\u0060 æ¸…å•ä¸­ä½¿ç”¨ [filters](https:\/\/gateway-api.sigs.k8s.io\/api-types\/httproute#filters-optional) åº”ç”¨äºè¯·æ±‚æ ‡å¤´æˆ–å“åº”æ ‡å¤´ã€‚\n\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†åœ¨ **è¯·æ±‚** ä¸­æ·»åŠ ä¸€ä¸ªæ ‡å¤´ã€‚\n\n\u0060\u0060\u0060yaml\napiVersion: gateway.networking.k8s.io\/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: echo-1\n  namespace: echo\nspec:\n...\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: \/req-header-add\n      filters:\n        - type: RequestHeaderModifier\n          requestHeaderModifier:\n            add:\n              - name: foo\n                value: bar\n      backendRefs:\n        - name: echo-1-echo-server\n          port: 80\n...\n\u0060\u0060\u0060\n\næ­¤å‘½ä»¤å…è®¸æŸ¥çœ‹æ ‡å¤´æ˜¯å¦ç¡®å®å·²æ·»åŠ ï¼š\n\n\u0060\u0060\u0060console\ncurl -s https:\/\/echo.cloud.ogenki.io\/req-header-add | jq \u0027.request.headers\u0027\n{\n  \u0022host\u0022: \u0022echo.cloud.ogenki.io\u0022,\n  \u0022user-agent\u0022: \u0022curl\/8.2.1\u0022,\n  \u0022accept\u0022: \u0022*\/*\u0022,\n  \u0022x-forwarded-for\u0022: \u002281.220.234.254\u0022,\n  \u0022x-forwarded-proto\u0022: \u0022https\u0022,\n  \u0022x-envoy-external-address\u0022: \u002281.220.234.254\u0022,\n  \u0022x-request-id\u0022: \u0022320ba4d2-3bd6-4c2f-8a97-74296a9f3f26\u0022,\n  \u0022foo\u0022: \u0022bar\u0022\n}\n\u0060\u0060\u0060\n\n## åˆ†é…é€‚å½“çš„æƒé™\n\n\u0060GAPI\u0060 æä¾›äº†ä¸€ç§æ¸…æ™°çš„æƒé™å…±äº«æ¨¡å‹ï¼Œç”¨äºç®¡ç†æµé‡è·¯ç”±åŸºç¡€è®¾æ–½ï¼ˆç”±é›†ç¾¤ç®¡ç†å‘˜ç®¡ç†ï¼‰å’Œåº”ç”¨ç¨‹åºï¼ˆç”±å¼€å‘äººå‘˜ç®¡ç†ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚\n\nå¤šä¸ªè‡ªå®šä¹‰èµ„æºçš„å¯ç”¨æ€§å…è®¸ä½¿ç”¨ Kubernetes çš„ **RBAC** é…ç½®ä»¥å£°æ˜æ€§æ–¹å¼åˆ†é…æƒé™ã€‚æˆ‘å·²ç»æ·»åŠ äº†ä¸€äº›ç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹åœ¨æˆ‘çš„æ¼”ç¤ºé›†ç¾¤ä¸­æ²¡æœ‰æ•ˆæœï¼Œä½†å¯èƒ½ä¼šç»™ä½ ä¸€ä¸ªæƒ³æ³•ã€‚\n\nä¸‹é¢çš„é…ç½®æˆäºˆ \u0060developers\u0060 ç»„çš„æˆå‘˜åœ¨ echo å‘½åç©ºé—´å†…ç®¡ç† \u0060HTTPRoutes\u0060 çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä»…æä¾›å¯¹ \u0060Gateways\u0060 çš„è¯»å–æƒé™ã€‚\n\n\u0060\u0060\u0060yaml\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: Role\nmetadata:\n  namespace: echo\n  name: gapi-developer\nrules:\n  - apiGroups: [\u0022gateway.networking.k8s.io\u0022]\n    resources: [\u0022httproutes\u0022]\n    verbs: [\u0022*\u0022]\n  - apiGroups: [\u0022gateway.networking.k8s.io\u0022]\n    resources: [\u0022gateways\u0022]\n    verbs: [\u0022get\u0022, \u0022list\u0022]\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: RoleBinding\nmetadata:\n  name: gapi-developer\n  namespace: echo\nsubjects:\n  - kind: Group\n    name: \u0022developers\u0022\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: gapi-developer\n  apiGroup: rbac.authorization.k8s.io\n\u0060\u0060\u0060\n\n## ä¹ä¸€çœ‹æœ‰ç‚¹æ¨¡ç³Š\n\näººä»¬å¯èƒ½ä¼šå¯¹é€šå¸¸ç§°ä¸º \u0060API ç½‘å…³\u0060 çš„ä¸œè¥¿æ„Ÿåˆ°å›°æƒ‘ã€‚å·²ç»åˆ›å»ºäº† [FAQ](https:\/\/gateway-api.sigs.k8s.io\/faq\/) çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä»¥æ¾„æ¸…å®ƒä¸ \u0060Gateway API\u0060 çš„ä¸åŒä¹‹å¤„ã€‚å°½ç®¡ GAPI æä¾›äº†é€šå¸¸åœ¨ API ç½‘å…³ä¸­æ‰¾åˆ°çš„åŠŸèƒ½ï¼Œä½†å®ƒä¸»è¦æ˜¯ Kubernetes çš„ä¸€ä¸ªç‰¹å®šå®ç°ã€‚ç„¶è€Œï¼Œé€‰æ‹©è¿™ä¸ªåç§°ç¡®å®å¯èƒ½å¼•èµ· **æ··æ·†**ã€‚\n\næ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œæœ¬æ–‡ä»…å…³æ³¨å…¥ç«™æµé‡ï¼Œé€šå¸¸ç”± *Ingress Controllers* ç®¡ç†ï¼Œç§°ä¸º [å—åŒ—](https:\/\/gateway-api.sigs.k8s.io\/concepts\/glossary\/#northsouth-traffic)ï¼Œè¿™å®é™…ä¸Šæ˜¯ GAPI çš„åˆå§‹èŒƒå›´ã€‚æœ€è¿‘çš„ä¸€ä¸ªåä¸º [**GAMMA**](https:\/\/gateway-api.sigs.k8s.io\/concepts\/gamma\/) çš„å€¡è®®æ—¨åœ¨å¤„ç† [ä¸œè¥¿æµé‡](https:\/\/gateway-api.sigs.k8s.io\/concepts\/glossary\/#eastwest-traffic) è·¯ç”±ï¼Œè¿™å°†åœ¨å°†æ¥æ ‡å‡†åŒ–æŸäº›å¸¸è§çš„åŠŸèƒ½ï¼Œé€šå¸¸ç”± \u0060Service Meshes\u0060 è§£å†³æ–¹æ¡ˆæä¾›ã€‚ï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… [æ­¤æ–‡ç« ](https:\/\/kubernetes.io\/blog\/2023\/08\/29\/gateway-api-v0-8\/)ï¼‰ã€‚\n\n## æœ€åçš„æƒ³æ³•\n\nè€å®è¯´ï¼Œæˆ‘å·²ç»çŸ¥é“ **Gateway API** æœ‰ä¸€æ®µæ—¶é—´äº†ã€‚å°½ç®¡æˆ‘è¯»äº†ä¸€äº›æ–‡ç« ï¼Œä½†æˆ‘å¹¶æ²¡æœ‰çœŸæ­£æ·±å…¥ç ”ç©¶è¿‡ã€‚æˆ‘ä¼šæƒ³ï¼šâ€œä¸ºä»€ä¹ˆè¦éº»çƒ¦å‘¢ï¼Ÿæˆ‘çš„ *Ingress Controller* å¯ä»¥å·¥ä½œï¼Œè€Œä¸”è¿™éœ€è¦å­¦ä¹ æ›²çº¿ã€‚â€\n\nGAPI æ­£åœ¨å´­éœ²å¤´è§’ï¼Œå³å°†å‘å¸ƒ GA ç‰ˆæœ¬ã€‚å¤šä¸ª [é¡¹ç›®](https:\/\/gateway-api.sigs.k8s.io\/implementations\/) å·²ç»æ‹¥æŠ±å®ƒï¼Œè¿™ä¸ªç”¨äºç®¡ç† Kubernetes å†…æµé‡çš„ API å°†è¿…é€Ÿæˆä¸ºæ ‡å‡†ã€‚\n\næˆ‘å¿…é¡»è¯´ï¼Œé…ç½® GAPI æ„Ÿè§‰ç›´è§‚è€Œæ˜ç¡®ã€‚å®ƒçš„å®‰å…¨æ¨¡å‹å–å¾—äº†å¹³è¡¡ï¼Œèµ‹äºˆå¼€å‘äººå‘˜æƒåŠ›è€Œä¸ä¼šæŸå®³å®‰å…¨æ€§ã€‚è€Œä¸”æ— ç¼çš„åŸºç¡€è®¾æ–½ç®¡ç†ï¼Ÿä½ å¯ä»¥åœ¨ä¸è§¦åŠ \u0060*Routes\u0060 çš„æƒ…å†µä¸‹åœ¨ä¸åŒçš„å®ç°ä¹‹é—´åˆ‡æ¢ã€‚\n\nç°åœ¨å°±ç”¨ \u0060Cilium\u0060 äº¤æ¢æˆ‘çš„ Ingress Controller å—ï¼Ÿ**è¿˜æ²¡æœ‰ï¼Œä½†å®ƒå³å°†åˆ°æ¥**ã€‚\n\nå€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼ŒCilium çš„åŠŸèƒ½éå¸¸å¹¿æ³›ï¼šåœ¨ Kubernetes å‘¨å›´æœ‰å¤§é‡çš„å·¥å…·ï¼ŒCilium è„±é¢–è€Œå‡ºï¼Œæ‰¿è¯ºæä¾›æŒ‡æ ‡ã€è·Ÿè¸ªã€æœåŠ¡ç½‘æ ¼ã€å®‰å…¨æ€§ï¼Œä»¥åŠ *Ingress Controller* ä¸ GAPIã€‚\n\nç„¶è€Œï¼Œéœ€è¦æ³¨æ„ä¸€äº›æŒ‘æˆ˜ï¼š\n\n- [TCP å’Œ UDP æ”¯æŒ](https:\/\/github.com\/cilium\/cilium\/issues\/21929)\n- [GRPC æ”¯æŒ](https:\/\/github.com\/cilium\/cilium\/issues\/21928)\n- éœ€è¦ä½¿ç”¨å˜å¼‚è§„åˆ™æ¥é…ç½®äº‘ç»„ä»¶ï¼ˆ[Github Issue](https:\/\/github.com\/cilium\/cilium\/issues\/25357)ï¼‰ã€‚\n- æœ¬æ–‡è®¨è®ºçš„è®¸å¤šåŠŸèƒ½ä»å¤„äºå®éªŒé˜¶æ®µã€‚ä¾‹å¦‚ï¼Œæœ€æ–°ç‰ˆæœ¬ï¼ˆæˆ‘å†™ä½œæ—¶çš„ \u0060v1.14.2\u0060ï¼‰æ”¯æŒçš„ [æ‰©å±•åŠŸèƒ½](https:\/\/github.com\/cilium\/cilium\/pull\/27472)ã€‚æˆ‘å°è¯•è®¾ç½®ä¸€ä¸ªç®€å•çš„ HTTP\u003eHTTPS é‡å®šå‘ï¼Œä½†é‡åˆ°äº† [è¿™ä¸ªé—®é¢˜](https:\/\/github.com\/kubernetes-sigs\/gateway-api\/issues\/1185)ã€‚å› æ­¤ï¼Œæˆ‘é¢„è®¡ API å°†æ¥ä¼šæœ‰ä¸€äº›ä¿®æ”¹ã€‚\n\nè™½ç„¶æˆ‘åªæ˜¯æ¶‰åŠäº† Cilium çš„ GAPI èƒ½å¤Ÿæä¾›çš„ä¸€å°éƒ¨åˆ†å†…å®¹ï¼ˆè€å®è¯´ï¼Œè¿™ç¯‡æ–‡ç« å·²ç»ç›¸å½“é•¿äº†ï¼‰ï¼Œä½†æˆ‘å¸Œæœ›æˆ‘ä»¬å¯ä»¥å¾ˆå¿«åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒã€‚ä½†è€ƒè™‘åˆ°å‰é¢æåˆ°çš„å‡ ç‚¹ï¼Œæˆ‘å»ºè®®ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚ä¸è¿‡ï¼Œå¦‚æœä½ æƒ³ä¸ºæœªæ¥åšå‡†å¤‡ï¼Œé‚£ä¹ˆç°åœ¨æ˜¯æ—¶å€™äº†ï¼\n\n## å‚è€ƒèµ„æ–™\n\n- https:\/\/gateway-api.sigs.k8s.io\/\n- https:\/\/docs.cilium.io\/en\/latest\/network\/servicemesh\/gateway-api\/gateway-api\/#gs-gateway-api\n- https:\/\/isovalent.com\/blog\/post\/cilium-gateway-api\/\n- https:\/\/isovalent.com\/blog\/post\/tutorial-getting-started-with-the-cilium-gateway-api\/\n- Isovalent çš„ [labs](https:\/\/isovalent.com\/resource-library\/labs\/) æ˜¯å¼€å§‹ä½¿ç”¨ Gateway API å¹¶ä¸”ä½ å°†è·å¾—æ–°çš„å¾½ç« ä»¥æ·»åŠ åˆ°ä½ çš„æ”¶è—ä¸­çš„å¥½æ–¹æ³•\n', '\/trans\/cilium-gateway-api\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Cilium éƒ¨ç½²å’Œé…ç½® Gateway APIï¼Œä¸€ä¸ªæ–°çš„æœåŠ¡ç½‘æ ¼ APIï¼Œç”¨äºç®¡ç† Kubernetes ä¸­çš„æœåŠ¡é—´é€šä¿¡ã€‚æ–‡ç« è¯¦ç»†è¯´æ˜äº† Gateway API çš„æ¦‚å¿µå’Œç»„ä»¶ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Cilium çš„ç‰¹æ€§å’Œå·¥å…·ï¼Œå®ç°é«˜æ•ˆå’Œçµæ´»çš„è·¯ç”±ç­–ç•¥ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/jwts-authenticate-services-api-gateways/">[è¯‘] JWT åœ¨ API ç½‘å…³ä¸­çš„è§’è‰²ï¼šæœåŠ¡é—´è®¤è¯çš„æ–°è§†è§’</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/12/08</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://www.solo.io/blog/jwts-authenticate-services-api-gateways/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('JWT åœ¨ API ç½‘å…³ä¸­çš„è§’è‰²ï¼šæœåŠ¡é—´è®¤è¯çš„æ–°è§†è§’', 'è¿™ç¯‡åšå®¢æ¢è®¨äº†åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­ä½¿ç”¨ JSON Web Tokensï¼ˆJWTï¼‰è¿›è¡ŒæœåŠ¡é—´é€šä¿¡çš„å¤æ‚æ€§ã€‚å®ƒè¯¦ç»†è®¨è®ºäº†é€šè¿‡ API ç½‘å…³å’ŒæœåŠ¡ç½‘æ ¼å®ç°å®‰å…¨è®¤è¯çš„ä¸¤ç§æ–¹æ³•ï¼Œå¼ºè°ƒäº†ä½¿ç”¨ JWT çš„æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬å®‰å…¨æ€§ã€å¯†é’¥ç®¡ç†å’Œæ€§èƒ½é—®é¢˜ã€‚', '\näº‘åŸç”Ÿæ¶æ„ä¸­çš„ API ç½‘å…³ç»„ä»¶è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå°†å…³é”®çš„ API å®‰å…¨æ€§å’Œç­–ç•¥åŠŸèƒ½å¸è½½åˆ°ä¸€ä¸ªå…¬å…±ä½ç½®ï¼Œä½¿åç«¯ API å’ŒæœåŠ¡èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚API èº«ä»½éªŒè¯ã€æˆæƒã€å®¡è®¡ã€é™æµç­‰ä»»åŠ¡å¯èƒ½ä¼šéå¸¸å¤æ‚ä¸”éš¾ä»¥æ­£ç¡®å®ç°ï¼Œå› æ­¤è®¸å¤šç»„ç»‡é€‰æ‹©ä½¿ç”¨ API ç½‘å…³æ¥å¤„ç†å®ƒä»¬ã€‚\n\né‚£ä¹ˆå¯¹äºæœåŠ¡ä¸æœåŠ¡ï¼ˆS2Sï¼‰æˆ–å†…éƒ¨ä¸œ\/è¥¿æµé‡å‘¢ï¼Ÿå¼ºåˆ¶ S2S æµé‡â€œå›å¤´â€é€šè¿‡ API ç½‘å…³ä¼šå¼•å…¥é¢å¤–çš„è·³è·ƒã€æ›´å¤šçš„å»¶è¿Ÿã€å¢åŠ çš„æµé‡ä»¥åŠæ•ˆç‡é™ä½ã€‚\n\n![é€šè¿‡ API ç½‘å…³çš„ S2S æµé‡â€œå›å¤´â€ç¤ºæ„å›¾](hairpin-api-gateway-calls.png)\n\nä½†æ˜¯ï¼Œå¦‚æœæ‚¨è·³è¿‡ API ç½‘å…³ç›´æ¥è°ƒç”¨æœåŠ¡ï¼Œå¦‚ä½•ç¡®ä¿æµé‡çš„å®‰å…¨æ€§ï¼Ÿæ¥æ”¶æœåŠ¡å¦‚ä½•è¿›è¡Œèº«ä»½éªŒè¯å¹¶çŸ¥é“æ˜¯è°åœ¨è°ƒç”¨å®ƒï¼Ÿ\n\n![æ˜¾ç¤º Service B éœ€è¦å¯¹ Service A è¿›è¡Œèº«ä»½éªŒè¯çš„ç¤ºæ„å›¾](service-a-b.png)\n\nä¿éšœ S2S é€šä¿¡çš„ä¸¤ç§å¸¸è§æ–¹å¼æ˜¯ï¼š\n\n1. ä½¿ç”¨ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTLSï¼‰å’Œå®¢æˆ·ç«¯è¯ä¹¦ï¼ˆåŒå‘ TLS æˆ– mTLSï¼‰ã€‚\n2. ä½¿ç”¨ç­¾åçš„ JSON Web Tokensï¼ˆJWTï¼‰ã€‚\n\n[æœåŠ¡ç½‘æ ¼](https:\/\/www.solo.io\/topics\/service-mesh\/)é€šè¿‡ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•è‡ªåŠ¨åŒ–äº†è®¸å¤šæœ€ä½³å®è·µå¹¶å‡è½»äº†ä¸ä¹‹ç›¸å…³çš„[é—®é¢˜](https:\/\/istio.io\/latest\/blog\/2023\/secure-apps-with-istio\/)ã€‚\n\nå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ JWT è¿›è¡Œ S2S èº«ä»½éªŒè¯ï¼Œä½†è¿™ä¼šâ€œå‰Šå¼±â€API ç½‘å…³çš„é¢„æœŸåŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨æ›¾æœŸæœ› API ç½‘å…³å¤„ç†çš„æ‰€æœ‰å®‰å…¨æ€§å¤æ‚æ€§å’Œè„†å¼±æ€§å¿…é¡»åœ¨æ¯ä¸ª S2S é€šä¿¡çš„å¾®æœåŠ¡ä¸­é‡æ–°åˆ›å»ºå’Œå¤åˆ¶ã€‚è¿™æ˜¯ä¸€ä¸ªé‡å¤§é—®é¢˜ï¼Œå› ä¸ºä½¿ç”¨ JWT è¿›è¡Œ S2S èº«ä»½éªŒè¯ä¼šå¼•å…¥å¤æ‚æ€§å’Œå¯¹ç»†èŠ‚çš„ä¸¥æ ¼è¦æ±‚ã€‚ï¼ˆæœ‰å…³æ­¤ä¸»é¢˜å’Œä¸‹é¢çš„åœºæ™¯çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è§‚çœ‹ Hoot ç¬¬ 59 é›†ï¼šâ€œ[JWT ä¸ Service-to-Service èº«ä»½éªŒè¯çš„æ¯”è¾ƒ](https:\/\/youtu.be\/Q2KfNUBfnjo)â€ã€‚æ‰€æœ‰æ¼”ç¤ºéƒ½å¯ä»¥åœ¨æˆ‘ä»¬çš„[GitHub ä»“åº“](https:\/\/github.com\/peterj\/jwts-for-services\/tree\/main)ä¸­æ‰¾åˆ°ã€‚ï¼‰\n\nè™½ç„¶æœ‰ä¸€äº›å‡ºè‰²çš„å¤„ç† JWT çš„æ¡†æ¶å’Œåº“ï¼Œè€Œ JWT ç¡®å®æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ï¼Œä½†å°† JWT ç”¨äº S2S æµé‡çš„èº«ä»½éªŒè¯æ˜¯å¤æ‚ä¸”ç¹é‡çš„ï¼Œå¹¶ä¸”éœ€è¦å¼€å‘äººå‘˜éå¸¸å‡†ç¡®åœ°å®Œæˆå·¥ä½œã€‚è¿™ç§å¤æ‚æ€§ï¼ˆæˆ–ç¼ºä¹æ„è¯†ï¼‰å¯èƒ½ä¼šé™ä½æ€»ä½“å®‰å…¨æ€§ï¼Œå¦‚æœå¼€å‘äººå‘˜é‡‡å–æ·å¾„æˆ–å¿½è§†å…³é”®å±æ€§ï¼Œå¯èƒ½ä¼šé™ä½æ€»ä½“å®‰å…¨æ€§ã€‚å¼€å‘äººå‘˜è¿˜éœ€è¦ä»¥ç‰¹å®šäºè¯­è¨€å’Œæ¡†æ¶çš„æ–¹å¼æ‰§è¡Œæ­¤æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ Java è§£å†³æ­¤é—®é¢˜ä¸ä½¿ç”¨ Go æˆ– Node.js ä¸åŒï¼‰ã€‚åœ¨æ‰€æœ‰ä»£ç åº“ä¸­ç»´æŠ¤ã€æ‰“è¡¥ä¸å’Œå®¡æ ¸æ¯ä¸ªå®ç°éƒ½éœ€è¦ä»˜å‡ºæˆæœ¬ã€‚\n\n## å¦‚ä½•ä½¿ç”¨ JWT è¿›è¡Œ S2S é€šä¿¡èº«ä»½éªŒè¯\n\næœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åˆ›å»º JWT ä»¥è¿›è¡Œ S2S é€šä¿¡èº«ä»½éªŒè¯ï¼šä½¿ç”¨èº«ä»½æä¾›è€…ï¼ˆIdPï¼‰ï¼ˆä¹Ÿç§°ä¸ºå®‰å…¨ä»¤ç‰ŒæœåŠ¡æˆ– STSï¼‰æˆ–å…è®¸å„ä¸ªæœåŠ¡è‡ªè¡Œç­¾ç½² JWTã€‚ï¼ˆå¦‚æœæ‚¨å¯¹ JWT æ¦‚å¿µä¸ç†Ÿæ‚‰æˆ–éœ€è¦å¤ä¹ ï¼Œè¯·æŸ¥çœ‹ Auth0 æä¾›çš„[JWT æ¦‚è¿°](https:\/\/auth0.com\/docs\/secure\/tokens\/json-web-tokens)ã€‚ï¼‰\n\n### é€‰é¡¹ 1ï¼šä½¿ç”¨ STS å‘æ”¾ä»¤ç‰Œ\n\nç¬¬ä¸€ç§æ–¹æ³•æ¶‰åŠä½¿ç”¨å®‰å…¨ä»¤ç‰ŒæœåŠ¡ï¼ˆSTSï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä¿¡ä»»çš„èº«ä»½æˆ–ä»¤ç‰Œæä¾›è€…ï¼Œä¾‹å¦‚[Keycloak](https:\/\/www.keycloak.org\/)ã€[Okta](https:\/\/www.okta.com\/)æˆ–[Auth0](https:\/\/auth0.com\/)ï¼Œç”¨äºå‘æ”¾ä»£è¡¨ç‰¹å®šæœåŠ¡çš„ä»¤ç‰Œã€‚\n\nåœ¨æ­¤æ–¹æ³•ä¸­ï¼ŒæœåŠ¡ä½¿ç”¨é•¿æœŸå‡­æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·åå’Œå¯†ç æˆ– OAuth2.0 å®¢æˆ·ç«¯å‡­æ®ï¼‰ä¸ STS äº¤æ¢ JWTï¼Œè¡¨æ˜â€œæˆ‘æ˜¯ Service Aâ€ã€‚\n\næ³¨æ„ï¼šé•¿æœŸå‡­æ®åº”å®‰å…¨å­˜å‚¨å¹¶æœ‰é™ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨å¯åŠ¨æ—¶ä½¿ç”¨å®ƒä¸€æ¬¡æ¥å¼•å¯¼èº«ä»½ï¼Œå¹¶ä¸”ä»¥åä¸å†ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œè¿™äº›å‡­æ®åº”ä»…å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚\n\nSTS ä½¿ç”¨å…¶ç§é’¥ç­¾ç½² JWTï¼Œå¯ä»¥ä½¿ç”¨å…¶å…¬é’¥éªŒè¯ JWTã€‚ç„¶åï¼ŒService A å°† JWT é™„åŠ åˆ°å‘é€ç»™ Service B çš„è¯·æ±‚ä¸­ã€‚ä»è¿™é‡Œï¼ŒService B å¯ä»¥é€šè¿‡ä½¿ç”¨ STS çš„å…¬é’¥éªŒè¯ JWT çš„ç­¾åæ¥éªŒè¯ JWT æ˜¯ç”± STS ç­¾å‘çš„ã€‚\n\n![æ˜¾ç¤ºæœåŠ¡å¦‚ä½•ç›¸äº’éªŒè¯çš„ç¤ºæ„å›¾](authentication.png)\n\nä¸ºäº†ä½¿æ­¤å·¥ä½œæ­£å¸¸è¿è¡Œï¼š\n\n1. æµé‡å¿…é¡»åŠ å¯†ã€‚\n2. æœåŠ¡ B å¿…é¡»æ£€æŸ¥ JWT çš„\u0060aud\u0060å£°æ˜ã€è¿‡æœŸæ—¶é—´ã€é¢å‘æ—¶é—´ä»¥åŠä¸æ—©äºæ—¶é—´ã€‚\n3. å½“ STS ç­¾å‘çš„ JWT ç­¾åå¯†é’¥è½®æ¢æ—¶ï¼ŒæœåŠ¡ B å¿…é¡»å‡†å¤‡å¥½æ›´æ–° STS çš„å…¬é’¥ã€‚\n\nåŠ å¯†æµé‡è‡³å…³é‡è¦ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ JWT æ—¶ï¼Œå®ƒä»¬ä»£è¡¨äº†ä¸€ä¸ªâ€œæ‰¿è½½ä»¤ç‰Œâ€ï¼Œå› æ­¤æ‹¥æœ‰ä»¤ç‰Œçš„ä»»ä½•äººéƒ½å¯ä»¥å†’å…… Service Aã€‚åœ¨ Service A å’Œ Service B ä¹‹é—´åŠ å¯†æµé‡ï¼ˆä¾‹å¦‚ä½¿ç”¨å•å‘æœåŠ¡å™¨ TLSï¼‰æœ‰åŠ©äºå‡è½»è¿™ä¸ªé—®é¢˜ã€‚\n\nService B è¿˜å¿…é¡»æ£€æŸ¥ JWT çš„è¿‡æœŸæ—¶é—´ï¼ˆ\u0060exp\u0060ï¼‰ã€é¢å‘æ—¶é—´ï¼ˆ\u0060iat\u0060ï¼‰ã€ä¸æ—©äºæ—¶é—´ï¼ˆ\u0060nbf\u0060ï¼‰ä»¥åŠç‰¹åˆ«æ˜¯\u0060aud\u0060å£°æ˜ï¼Œä»¥éªŒè¯ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆï¼ˆæœªè¿‡æœŸï¼Œä½äºå…¶æ—¶é—´çª—å£å†…å¹¶ç”¨äº Service B çš„ä½¿ç”¨ï¼‰ã€‚JWT ä½¿ç”¨è¿™ä¸ªçº¦å®šæ¥é˜²èŒƒé‡æ”¾æ”»å‡»ï¼Œå…¶ä¸­æ”»å‡»è€…å†’å…… Service Bï¼Œä» Service A è·å–ä»¤ç‰Œï¼Œç„¶åå†’å…… Service A æ¥è°ƒç”¨ Service Cã€‚æœ‰æ•ˆçš„ Service C ä¼šæ£€æŸ¥\u0060aud\u0060å£°æ˜ï¼Œçœ‹åˆ°ä»£è¡¨ Service A çš„ JWT æ˜¯ä¸º Service B è€Œè®¾è®¡çš„ï¼Œç„¶åæ‹’ç»å®ƒã€‚\n\næ¯æ¬¡è°ƒç”¨æœåŠ¡ A éƒ½å¿…é¡»ä½¿ç”¨ä¸åŒçš„ JWTï¼Œå› ä¸º\u0060aud\u0060å£°æ˜ä¼šä¸åŒã€‚å°è¯•ä½¿ç”¨æ²¡æœ‰\u0060aud\u0060å£°æ˜çš„ JWT æˆ–ä½¿ç”¨é€šé…ç¬¦\u0060aud\u0060å£°æ˜ä¼šå¢åŠ  JWT è¢«ç ´åçš„é£é™©ã€‚é¿å…è¿™æ ·åšã€‚\n\næœ€åï¼Œå¸¸å¸¸è¢«å¿½ç•¥çš„æ˜¯è½®æ¢ STS çš„å…¬é’¥ã€‚åœ¨è®¡åˆ’çš„å¯†é’¥è½®æ¢æˆ–è®¡åˆ’çš„æ’¤é”€ STS ç”¨äºç­¾ç½² JWT çš„å¯†é’¥æ—¶ï¼ŒService Bï¼ˆæˆ–ä»»ä½•ä¾èµ– STS è¿›è¡ŒéªŒè¯çš„æœåŠ¡ï¼‰å¿…é¡»èƒ½å¤Ÿå¤„ç†æ›´æ–°çš„ç­¾åå…¬é’¥ã€‚\n\n### é€‰é¡¹ 2ï¼šè®©æœåŠ¡è‡ªè¡Œç­¾ç½²å…¶ä»¤ç‰Œ\n\nç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨æœåŠ¡ç‰¹å®šçš„å¯†é’¥æ¥ç­¾ç½² JWTã€‚å¯ä»¥ä½¿ç”¨å¯¹ç§°å¯†é’¥æˆ–éå¯¹ç§°å¯†é’¥ã€‚\n\n![ä½¿ç”¨ç‰¹å®šäºæœåŠ¡çš„å¯†é’¥è¿›è¡Œ S2S èº«ä»½éªŒè¯çš„ç¤ºæ„å›¾](authentication-service-specific-keys.png)\n\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒService A ä½¿ç”¨è‡ªå·±çš„å¯†é’¥æ¥ç­¾ç½²å‘é€ç»™ Service Bï¼ˆæˆ–ä»»ä½•å…¶ä»–æœåŠ¡ï¼‰çš„ JWTã€‚Service B å°†éœ€è¦ Service A çš„å…¬é’¥ï¼ˆæˆ–å¯¹ç§°å¯†é’¥ï¼Œç”±äºå¯†é’¥äº¤æ¢å’Œå†’å……é—®é¢˜æ›´åŠ å±é™©ï¼‰æ¥éªŒè¯ Service A å‘é€çš„ JWTã€‚å®é™…ä¸Šï¼ŒService B å°†éœ€è¦æ¯ä¸ªè°ƒç”¨å®ƒçš„æœåŠ¡çš„å…¬é’¥ï¼Œè¿™äº›æœåŠ¡ä½¿ç”¨ JWT ä½œä¸ºèº«ä»½éªŒè¯ä¸»ä½“ã€‚\n\nä¸ STS ç­¾å‘çš„ JWT ç¤ºä¾‹ä¸€æ ·ï¼ŒæœåŠ¡ä¹‹é—´çš„æµé‡å¿…é¡»åŠ å¯†ï¼ŒService B è¿˜å¿…é¡»æ£€æŸ¥\u0060aud\u0060å£°æ˜ï¼Œå¹¶ä¸”æ‚¨éœ€è¦ä¸€ç§ç­¾ç½²å…¬é’¥è½®æ¢çš„æ–¹æ³•ã€‚æ‚¨è¿˜å¿…é¡»ä¸ºæ¯ä¸ªè°ƒç”¨çš„æœåŠ¡ä½¿ç”¨ä¸åŒçš„ JWTã€‚\n\n![æœåŠ¡ B æ£€æŸ¥ aud å£°æ˜](different-jwt-dependent-services.png)\n\nå¼€å‘äººå‘˜å¿…é¡»é‡‡å–æªæ–½å¹¶è·Ÿè¸ªè®¸å¤šå†…å®¹ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡æ­£ç¡®ã€‚è¯ä¹¦è¿˜å¿…é¡»è‡³å°‘åˆ†å‘ç»™ä¸€åŠçš„æœåŠ¡ï¼ˆæ¥æ”¶ç«¯çš„æœåŠ¡ï¼‰ä»¥æä¾›è‡³å°‘å•å‘ TLSã€‚æ­¤å¤–ï¼Œæ•´ä¸ªè¿‡ç¨‹çš„å…³é”®æ˜¯å¯†é’¥ç®¡ç†ã€è½®æ¢å’Œå®‰å…¨ä¿ç®¡å¯†é’¥ã€‚\n\n## JWT å¯èƒ½å‡ºç°é—®é¢˜çš„åœ°æ–¹\n\næˆ‘ä»¬å·²ç»ä»‹ç»äº† JWT å¯ç”¨äºè¡¨ç¤ºæœåŠ¡èº«ä»½çš„ä¸€äº›æ–¹å¼ï¼Œå¹¶æå‡ºäº†å…³æ³¨çš„é¢†åŸŸã€‚åœ¨æœåŠ¡æ¶æ„ä¸­ï¼Œæœ‰å‡ ä¸ªéœ€è¦å¯†åˆ‡å…³æ³¨çš„é¢†åŸŸï¼Œä»¥é¿å…å®‰å…¨æ¼æ´ã€‚å¦‚æœè¿™äº›ä¸æ˜¯ç‰¢ä¸å¯ç ´çš„ï¼Œæ‚¨å°†ä¸ºæ”»å‡»è€…æä¾›æœºä¼šæ¥ç ´åæ‚¨çš„ç³»ç»Ÿã€‚\n\nåœ¨ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦\/mTLSï¼ˆä¾‹å¦‚æœåŠ¡ç½‘æ ¼ï¼‰å’Œ JWT è¿›è¡Œèº«ä»½éªŒè¯ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼šJWT é€šè¿‡ç½‘ç»œå‘é€æ•æ„Ÿçš„æ‰¿è½½ä»¤ç‰Œææ–™ï¼Œè€Œ mTLS ä¸ä¼šã€‚ä½¿ç”¨ mTLS æ—¶ï¼Œåªä¼šå‘é€å…¬é’¥ï¼Œè€Œä¸ä¼šå‘é€ç§é’¥ï¼Œä¼šåå•†ä¼šè¯å¯†é’¥ã€‚å¦‚æœ JWT æ³„éœ²ï¼ŒJWT æ˜¯ç§å¯†ææ–™ï¼Œå¯ä»¥è¢«é‡æ”¾ã€‚å¯¹äºè¯ä¹¦ï¼Œåªæœ‰å…¬å…±è¯ä¹¦è¢«å…±äº«ã€‚\n\nä¸ºé˜²æ­¢é‡æ’­æ‰¿è½½ä»¤ç‰Œï¼Œæ‚¨å¿…é¡»é€šè¿‡è®¾ç½®çŸ­æš‚çš„åˆ°æœŸæ—¶é—´ï¼Œç†æƒ³æƒ…å†µä¸‹åªæœ‰å‡ åˆ†é’Ÿï¼Œæ¥é™åˆ¶å…¶æš´éœ²ã€‚è¿™ä¼šå¢åŠ æœåŠ¡åˆ·æ–°å…¶ JWT ä»¥è¿›è¡Œè¯·æ±‚çš„è´£ä»»ã€‚è®¾ç½®æ•°å°æ—¶ã€æ•°å¤©æˆ–æ•°æœˆçš„åˆ°æœŸæ—¶é—´å‘ç”Ÿå¾—å¤ªé¢‘ç¹ã€‚è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨éšæ‚£ã€‚\n\nå¦ä¸€ä¸ªé‡å¤§çš„å®‰å…¨æ¼æ´æ˜¯ï¼Œåœ¨ä½¿ç”¨ STS è·å– JWT ææ–™æ—¶ï¼Œæ‚¨ä¼šå¤šæ¬¡é€šè¿‡ç½‘ç»œå‘é€é•¿æœŸå‡­æ®ï¼ˆä¾‹å¦‚å®¢æˆ·ç«¯å‡­è¯æµç¨‹ï¼‰ã€‚è¿™äº›é•¿æœŸå‡­æ®éå¸¸æ•æ„Ÿï¼Œåº”è°¨æ…ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¯åŠ¨æ—¶ä½¿ç”¨ï¼‰ï¼Œè€Œä¸åº”è¿ç»­ä½¿ç”¨ã€‚\n\næ­¤å¤–ï¼Œä½¿ç”¨é€šé…ç¬¦\u0060aud\u0060å£°æ˜æˆ–å®Œå…¨çœç•¥\u0060aud\u0060å£°æ˜ä¹Ÿæ˜¯ä¸€ä¸ªé‡å¤§é—®é¢˜ã€‚æœªèƒ½åœ¨æœåŠ¡ä¹‹é—´ä¸€è‡´ä½¿ç”¨è¿™äº›çº¦å®šä»¥è¿›è¡Œèº«ä»½éªŒè¯ä¼šå¯¼è‡´ä¸¥é‡é—®é¢˜ã€‚ç¡®ä¿ä¸º*æ¯ä¸ª*è°ƒç”¨çš„æœåŠ¡åˆ›å»ºå…·æœ‰æ­£ç¡®\u0060aud\u0060å£°æ˜çš„ JWTã€‚\n\næœ€åï¼Œå¯†é’¥è½®æ¢ä¸çŸ­æš‚åˆ°æœŸæ—¶é—´å’Œ aud å£°æ˜æ£€æŸ¥åŒæ ·é‡è¦ã€‚åœ¨å‘ç”Ÿè¿è§„äº‹ä»¶æ—¶ï¼Œä½¿å¯†é’¥æ— æ•ˆæ˜¯æœ€åçš„åŠªåŠ›ï¼Œåº”å°½å¿«ä¸”é«˜æ•ˆåœ°å¤„ç†ã€‚\n\n## JWT çš„å¤æ‚æ€§æ˜¯æœåŠ¡ç½‘æ ¼ç®€åŒ–äº‹ç‰©çš„åœ°æ–¹\n\næœåŠ¡ç½‘æ ¼ç®€åŒ–äº†æœåŠ¡ä¹‹é—´çš„èº«ä»½éªŒè¯ï¼Œå¹¶å…è®¸å¼€å‘äººå‘˜ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯æ­£ç¡®åœ°å¤„ç† JWT å’Œç§˜å¯†ææ–™ï¼ˆå¸Œæœ›å¦‚æ­¤ï¼‰ã€‚å°±åƒ API ç½‘å…³åº”ç”¨äºå¤„ç†åŒ—\/å—å’Œå…¥å£æµé‡çš„å®‰å…¨æ€§ä¸€æ ·ï¼ŒæœåŠ¡ç½‘æ ¼åº”ç”¨äºå¤„ç†ä¸œ\/è¥¿å’Œ S2S æµé‡çš„å®‰å…¨æ€§ã€‚ä¿æŒæœåŠ¡å’Œ API ä¸“æ³¨äºå®ƒä»¬å¯ä»¥æä¾›çš„ä¸åŒ iating ä¸šåŠ¡ä»·å€¼ï¼Œè€Œä¸æ˜¯æ¨¡æ¿ï¼ˆä½†æå…¶é‡è¦çš„ï¼‰çš„å®‰å…¨æ€§ä»£ç ã€‚\n', '\/trans\/jwts-authenticate-services-api-gateways\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">è¿™ç¯‡åšå®¢æ¢è®¨äº†åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­ä½¿ç”¨ JSON Web Tokensï¼ˆJWTï¼‰è¿›è¡ŒæœåŠ¡é—´é€šä¿¡çš„å¤æ‚æ€§ã€‚å®ƒè¯¦ç»†è®¨è®ºäº†é€šè¿‡ API ç½‘å…³å’ŒæœåŠ¡ç½‘æ ¼å®ç°å®‰å…¨è®¤è¯çš„ä¸¤ç§æ–¹æ³•ï¼Œå¼ºè°ƒäº†ä½¿ç”¨ JWT çš„æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬å®‰å…¨æ€§ã€å¯†é’¥ç®¡ç†å’Œæ€§èƒ½é—®é¢˜ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/is-it-too-early-to-leverage-ai-for-webassembly/">[è¯‘] å°† AI åº”ç”¨äº WebAssembly è¿˜ä¸ºæ—¶è¿‡æ—©å—ï¼Ÿ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/09/07</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://thenewstack.io/is-it-too-early-to-leverage-ai-for-webassembly/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('å°† AI åº”ç”¨äº WebAssembly è¿˜ä¸ºæ—¶è¿‡æ—©å—ï¼Ÿ', 'Fermyon Technologies è®¤ä¸ºï¼Œå°† AI åº”ç”¨äº WebAssembly å¹¶ä¸ä¸ºæ—¶è¿‡æ—©ã€‚', '\næ‘˜è¦ï¼šFermyon Technologies è®¤ä¸ºï¼Œå°† AI åº”ç”¨äº WebAssembly å¹¶ä¸ä¸ºæ—¶è¿‡æ—©ã€‚WebAssembly ä¸ºåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ¨ç†æä¾›äº†åšå®çš„åŸºç¡€ï¼Œè€Œä¸”åœ¨è®¸å¤šä¸åŒçš„ç¯å¢ƒä¸­ï¼Œå¦‚æµè§ˆå™¨å’Œç‰©è”ç½‘è®¾å¤‡ç­‰ï¼Œé€šè¿‡å°†è¿™äº›å·¥ä½œè´Ÿè½½ç§»åŠ¨åˆ°ç»ˆç«¯ç”¨æˆ·è®¾å¤‡ä¸Šï¼Œå¯ä»¥æ¶ˆé™¤å»¶è¿Ÿå¹¶é¿å…å°†æ•°æ®å‘é€åˆ°é›†ä¸­å¼æœåŠ¡å™¨ï¼ŒåŒæ—¶èƒ½å¤Ÿåœ¨è¾¹ç¼˜å‘ç°çš„å¤šç§å¼‚æ„è®¾å¤‡ä¸Šè¿è¡Œã€‚Fermyon Serverless AI é€šè¿‡æä¾›è¶…è¿‡ 100 å€äºå…¶ä»–æŒ‰éœ€ AI åŸºç¡€è®¾æ–½æœåŠ¡çš„äºšç§’å†·å¯åŠ¨æ—¶é—´æ¥è§£å†³äº†ä¼ä¸šçº§ AI åº”ç”¨ç¨‹åºæˆæœ¬é«˜çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ç§å…±ç”Ÿå…³ç³»ã€‚\n\n---\n\näººå·¥æ™ºèƒ½åŠå…¶åœ¨ ITã€è½¯ä»¶å¼€å‘å’Œè¿è¥æ–¹é¢çš„åº”ç”¨åˆšå¼€å§‹å‘æŒ¥ä½œç”¨ï¼Œé¢„ç¤ºç€äººç±»è§’è‰²å°†å¦‚ä½•åœ¨è¿‘æœŸå’Œé•¿æœŸå†…æ¼”å˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾ƒå°çš„è§„æ¨¡ä¸Šï¼ŒWebAssembly ä»£è¡¨ç€ä¸€ç§æ­£åœ¨å¼•èµ·é‡å¤§å…³æ³¨çš„æŠ€æœ¯ï¼ŒåŒæ—¶è¯æ˜äº†å…¶å¯è¡Œæ€§ï¼Œä½†æˆåŠŸçš„å•†ä¸šæ¨¡å‹å°šæœªå®ç°ï¼Œä¸»è¦æ˜¯ç”±äºæœ€ç»ˆç«¯ç‚¹çš„ç¼ºä¹æ ‡å‡†åŒ–ã€‚ä¸æ­¤åŒæ—¶ï¼Œè‡³å°‘æœ‰ä¸€å®¶ä¾›åº”å•† Fermyon è®¤ä¸ºï¼Œåœ¨è¿™ä¸ªé˜¶æ®µåº”ç”¨ AI äº WebAssembly å¹¶ä¸ä¸ºæ—¶è¿‡æ—©ã€‚\n\né‚£ä¹ˆï¼ŒAI å¦‚ä½•æ½œåœ¨åœ°å¸®åŠ© Wasm çš„å¼€å‘å’Œé‡‡ç”¨ï¼Œè¿™æ˜¯å¦ä¸ºæ—¶è¿‡æ—©ï¼Ÿæ­£å¦‚ VMware CTO åŠå…¬å®¤çš„é«˜çº§å·¥ç¨‹å¸ˆ Angel M De Miguel Meana æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œè‡ªä» ChatGPT æ¨å‡ºä»¥æ¥ï¼ŒAI ç”Ÿæ€ç³»ç»Ÿå·²ç»å‘ç”Ÿäº†å·¨å¤§çš„å˜åŒ–ï¼ŒWebAssembly ä¸ºåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ¨ç†æä¾›äº†åšå®çš„åŸºç¡€ï¼Œè€Œä¸”åœ¨è®¸å¤šä¸åŒçš„ç¯å¢ƒä¸­ï¼Œå¦‚æµè§ˆå™¨å’Œç‰©è”ç½‘è®¾å¤‡ç­‰ï¼Œé€šè¿‡å°†è¿™äº›å·¥ä½œè´Ÿè½½ç§»åŠ¨åˆ°ç»ˆç«¯ç”¨æˆ·è®¾å¤‡ä¸Šï¼Œå¯ä»¥æ¶ˆé™¤å»¶è¿Ÿå¹¶é¿å…å°†æ•°æ®å‘é€åˆ°é›†ä¸­å¼æœåŠ¡å™¨ï¼ŒåŒæ—¶èƒ½å¤Ÿåœ¨è¾¹ç¼˜å‘ç°çš„å¤šç§å¼‚æ„è®¾å¤‡ä¸Šè¿è¡Œã€‚ç”±äº Wasm ç”Ÿæ€ç³»ç»Ÿä»åœ¨å…´èµ·ï¼Œå› æ­¤åœ¨æ—©æœŸé˜¶æ®µé›†æˆ AI å°†æœ‰åŠ©äºæ¨åŠ¨æ–°çš„å’Œç°æœ‰çš„ä¸ AI ç›¸å…³çš„æ ‡å‡†ã€‚è¿™æ˜¯ä¸€ç§å…±ç”Ÿå…³ç³»ã€‚\n\n## å®Œç¾çš„åŒ¹é…\n\nFermyon Technologies çš„è”åˆåˆ›å§‹äººå…¼é¦–å¸­æ‰§è¡Œå®˜ Matt Butcher å‘Šè¯‰ The New Stackï¼šâ€œæˆ‘ä»¬æˆç«‹ Fermyon çš„ç›®æ ‡æ˜¯æ‰“é€ ä¸‹ä¸€ä»£æ— æœåŠ¡å™¨å¹³å°ã€‚AI æ˜¾ç„¶æ˜¯è¿™ä¸€ä¸‹ä¸€ä»£çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æˆ‘ä»¬çš„è¡Œä¸šä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°é©å‘½æ€§çš„æŠ€æœ¯ä¸€èµ·æˆé•¿ï¼šJava å’Œ Webã€äº‘å’Œå¾®æœåŠ¡ã€Docker å’Œ Kubernetesã€‚WebAssembly å’Œ AI æ˜¯ä¸€å¯¹å®Œç¾çš„ç»„åˆã€‚æˆ‘çœ‹åˆ°å®ƒä»¬ä¸€èµ·æˆé•¿ï¼ˆå¹¶å˜è€ï¼‰ã€‚â€\n\nâ€œçƒ˜ç„™â€AI æ¨¡å‹ï¼Œå¦‚ LLMï¼ˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰æˆ–è½¬æ¢å™¨ï¼Œåˆ° WebAssembly è¿è¡Œæ—¶ä¸­ï¼Œæ˜¯åŠ é€Ÿé‡‡ç”¨ WebAssembly çš„é€»è¾‘ä¸‹ä¸€æ­¥ï¼ŒEnterprise Management Associates (EMA) çš„åˆ†æå¸ˆ Torsten Volk å‘Šè¯‰ The New Stackã€‚ä¸è°ƒç”¨è¯¸å¦‚é€šè¿‡ API çš„æ•°æ®åº“æœåŠ¡ç±»ä¼¼ï¼Œç¼–è¯‘ WebAssembly åº”ç”¨ç¨‹åºï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰å¯ä»¥å°†å…¶ API è¯·æ±‚å‘é€åˆ° WebAssembly è¿è¡Œæ—¶ï¼Œè¯¥è¿è¡Œæ—¶å°†è¯¥è°ƒç”¨ä¸­ç»§åˆ° AI æ¨¡å‹å¹¶å°†æ¨¡å‹å“åº”è¿”å›ç»™å‘èµ·è€…ï¼ŒVolk è¯´ã€‚\n\nâ€œä¸€æ—¦æˆ‘ä»¬æœ‰ä¸€ä¸ªæä¾›å¼€å‘äººå‘˜ä¸€ä¸ªæ ‡å‡† API çš„é€šç”¨ç»„ä»¶æ¨¡å‹ï¼ˆCCMï¼‰ï¼Œè®¿é—®æ•°æ®åº“ã€AI æ¨¡å‹ã€GPUã€æ¶ˆæ¯ä¼ é€’ã€èº«ä»½éªŒè¯ç­‰ï¼Œè¿™äº› API è¯·æ±‚å°†å˜å¾—éå¸¸å¼ºå¤§ã€‚CCM å°†è®©å¼€å‘äººå‘˜ç¼–å†™ç›¸åŒçš„ä»£ç ï¼Œåœ¨æ•°æ®ä¸­å¿ƒã€äº‘ç”šè‡³è¾¹ç¼˜ä½ç½®çš„ä»»ä½•ç±»å‹çš„æœåŠ¡å™¨ä¸Šä¸ AI æ¨¡å‹ï¼ˆä¾‹å¦‚ GPT æˆ– Llamaï¼‰è¿›è¡Œé€šä¿¡ï¼Œåªè¦è¯¥æœåŠ¡å™¨æ‹¥æœ‰è¶³å¤Ÿçš„ç¡¬ä»¶èµ„æºå¯ç”¨ï¼Œâ€Volk è¯´ã€‚â€œè¿™ä¸€åˆ‡éƒ½å½’ç»“ä¸ºå…³é”®é—®é¢˜ï¼Œå³äº§ä¸šå‚ä¸è€…ä½•æ—¶ä¼šå°± CCM è¾¾æˆä¸€è‡´ã€‚åŒæ—¶ï¼ŒWebAssembly äº‘ï¼ˆå¦‚ Fermyonï¼‰å¯ä»¥åˆ©ç”¨ WebAssembly ä½¿ AI æ¨¡å‹åœ¨å…¶è‡ªå·±çš„äº‘åŸºç¡€è®¾æ–½ä¸­å…·æœ‰å¯ç§»æ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œæ— éœ€ CCMï¼Œå¹¶å°†ä¸€äº›èŠ‚çœæˆæœ¬ä¼ é€’ç»™å®¢æˆ·ã€‚â€\n\n## è§£å†³é—®é¢˜\n\nåŒæ—¶ï¼ŒFermyon è®¤ä¸ºï¼Œåœ¨è¿™ä¸ªé˜¶æ®µåº”ç”¨ AI äº WebAssembly å¹¶ä¸ä¸ºæ—¶è¿‡æ—©ã€‚æ­£å¦‚ Butcher æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œè´Ÿè´£åœ¨ LLMï¼ˆå¦‚ LLaMA2ï¼‰ä¸Šæ„å»ºå’Œè¿è¡Œä¼ä¸š AI åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜é¢ä¸´ç€ 100 å€è®¡ç®—æˆæœ¬çš„æŒ‘æˆ˜ï¼Œå³æ¯å°æ—¶ 32 ç¾å…ƒåŠä»¥ä¸Šçš„ GPU è®¿é—®è´¹ç”¨ã€‚æˆ–è€…ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨æŒ‰éœ€æœåŠ¡ï¼Œä½†æ˜¯å¯åŠ¨æ—¶é—´å´éå¸¸æ…¢ã€‚è¿™ä½¿å¾—ä»¥å®æƒ çš„æ–¹å¼æä¾›ä¼ä¸šçº§ AI åº”ç”¨ç¨‹åºå˜å¾—ä¸åˆ‡å®é™…ã€‚\n\nFermyon Serverless AI é€šè¿‡æä¾›è¶…è¿‡ 100 å€äºå…¶ä»–æŒ‰éœ€ AI åŸºç¡€è®¾æ–½æœåŠ¡çš„äºšç§’å†·å¯åŠ¨æ—¶é—´æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒButcher è¯´ã€‚è¿™ä¸€â€œçªç ´â€å¾—ç›Šäºé©±åŠ¨ Fermyon Cloud çš„æœåŠ¡å™¨ WebAssembly æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯è¢«æ¶æ„ä¸ºäºšæ¯«ç§’å†·å¯åŠ¨å’Œé«˜å®¹é‡æ—¶é—´åˆ†ç‰‡çš„è®¡ç®—å®ä¾‹ï¼Œå·²è¢«è¯æ˜å¯ä»¥å°†è®¡ç®—å¯†åº¦æé«˜ 30 å€ã€‚â€œå°†æ­¤è¿è¡Œæ—¶é…ç½®æ–‡ä»¶æ‰©å±•åˆ° GPU å°†ä½¿ Fermyon Cloud æˆä¸ºæœ€å¿«çš„ AI æ¨ç†åŸºç¡€è®¾æ–½æœåŠ¡ï¼Œâ€Butcher è¯´ã€‚\n\nVolk è¯´ï¼Œè¿™æ ·çš„æ¨ç†æœåŠ¡â€œéå¸¸æœ‰è¶£â€ï¼Œå› ä¸ºå…¸å‹çš„ WebAssembly åº”ç”¨ç¨‹åºä»…åŒ…å«å‡ å…†å­—èŠ‚ï¼Œè€Œ AI æ¨¡å‹çš„å¤§å°è¦å¤§å¾—å¤šã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¸ä¼šåƒä¼ ç»Ÿçš„ WebAssembly åº”ç”¨ç¨‹åºé‚£æ ·å¯åŠ¨å¾—é‚£ä¹ˆå¿«ã€‚â€œæˆ‘è®¤ä¸º Fermyon å·²ç»æƒ³å‡ºäº†å¦‚ä½•ä½¿ç”¨æ—¶é—´åˆ†ç‰‡ä¸º WebAssembly åº”ç”¨ç¨‹åºæä¾› GPU è®¿é—®çš„æ–¹æ³•ï¼Œä»¥ä¾¿æ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡å…¶ WebAssembly è¿è¡Œæ—¶ä¿ç•™ä¸€äº›æ—¶é—´ç‰‡æ¥è·å–æ‰€éœ€çš„ GPU èµ„æºâ€ï¼ŒVolk è¯´ã€‚â€œè¿™æ„å‘³ç€å¾ˆå¤šåº”ç”¨ç¨‹åºå¯ä»¥å…±äº«ä¸€å°éƒ¨åˆ†æ˜‚è´µçš„ GPUï¼Œä»¥æŒ‰éœ€ä¸ºå…¶ç”¨æˆ·æä¾›æœåŠ¡ã€‚è¿™æœ‰ç‚¹åƒåˆ†æ—¶å…±äº«ï¼Œä½†ä¸éœ€è¦å¼ºåˆ¶å‚åŠ åˆé¤æ—¶é—´çš„æ¼”ç¤ºã€‚â€\n\nä½¿ç”¨ Spin å…¥é—¨ã€‚\n\n!https:\/\/prod-files-secure.s3.us-west-2.amazonaws.com\/86575c70-5cc9-4b3e-bee7-d1bb14ba20e3\/6bf78916-e34c-4051-86a7-52145cdc372a\/4a27b287-capture-decran-2023-09-05-192118.png\n\né‚£ä¹ˆï¼Œç”¨æˆ·å¦‚ä½•ä¸ Serverless AI äº¤äº’ï¼ŸFermyon çš„ Serverless AI æ²¡æœ‰ REST API æˆ–å¤–éƒ¨æœåŠ¡ï¼Œå®ƒä»…æ„å»ºåœ¨ Fermyon çš„ Spin æœ¬åœ°å’Œ Fermyon Cloud ä¸­ï¼ŒButcher è§£é‡Šè¯´ã€‚â€œåœ¨æ‚¨çš„ä»£ç çš„ä»»ä½•ä½ç½®ï¼Œæ‚¨éƒ½å¯ä»¥å°†æç¤ºä¼ é€’åˆ° Serverless AI å¹¶è·å¾—å“åº”ã€‚åœ¨è¿™ä¸ªç¬¬ä¸€ä¸ªæµ‹è¯•ç‰ˆä¸­ï¼Œæˆ‘ä»¬åŒ…æ‹¬ LLaMa2 çš„èŠå¤©æ¨¡å‹å’Œæœ€è¿‘å®£å¸ƒçš„ Code Llama ä»£ç ç”Ÿæˆæ¨¡å‹ï¼Œâ€Butcher è¯´ã€‚â€œå› æ­¤ï¼Œæ— è®ºæ‚¨æ˜¯åœ¨æ€»ç»“æ–‡æœ¬ã€å®ç°è‡ªå·±çš„èŠå¤©æœºå™¨äººè¿˜æ˜¯ç¼–å†™åç«¯ä»£ç ç”Ÿæˆå™¨ï¼ŒServerless AI éƒ½å¯ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ AI å˜å¾—ç®€å•ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥ç«‹å³å¼€å§‹åˆ©ç”¨å®ƒæ¥æ„å»ºæ–°çš„ä»¤äººç©ç›®çš„æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚â€\n\n## é‡è¦æ„ä¹‰\n\nä½¿ç”¨ WebAssembly æ¥è¿è¡Œå·¥ä½œè´Ÿè½½ï¼Œå¯ä»¥ä½¿ç”¨ Fermyon Serverless AI å°†â€œGPU çš„ä¸€å°éƒ¨åˆ†â€åˆ†é…ç»™ç”¨æˆ·åº”ç”¨ç¨‹åºï¼Œä»¥â€œåŠæ—¶â€æ‰§è¡Œ AI æ“ä½œï¼ŒFermyon CTO å’Œè”åˆåˆ›å§‹äºº Radu Matei åœ¨ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­å†™é“ã€‚ â€œå½“æ“ä½œå®Œæˆæ—¶ï¼Œæˆ‘ä»¬å°†è¯¥ GPU çš„ä¸€å°éƒ¨åˆ†åˆ†é…ç»™é˜Ÿåˆ—ä¸­çš„å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œâ€Matei å†™é“ã€‚â€œç”±äº Fermyon Cloud ä¸­çš„å¯åŠ¨æ—¶é—´ä¸ºæ¯«ç§’çº§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨åˆ†é…ç»™ GPU çš„ç”¨æˆ·åº”ç”¨ç¨‹åºä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚å¦‚æœæ‰€æœ‰ GPU åˆ†æ•°éƒ½åœ¨å¿™äºè®¡ç®—æ•°æ®ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªå¯ç”¨çš„åº”ç”¨ç¨‹åºä¹‹å‰å°†ä¼ å…¥çš„åº”ç”¨ç¨‹åºæ’é˜Ÿã€‚â€\n\nè¿™æœ‰ä¸¤ä¸ªé‡å¤§çš„å½±å“ï¼ŒMatei å†™é“ã€‚é¦–å…ˆï¼Œç”¨æˆ·ä¸å¿…ç­‰å¾…è™šæ‹Ÿæœºæˆ–å®¹å™¨å¯åŠ¨å¹¶é™„åŠ åˆ° GPU ä¸Šã€‚æ­¤å¤–ï¼Œâ€œæˆ‘ä»¬å¯ä»¥å®ç°æ›´é«˜çš„èµ„æºåˆ©ç”¨ç‡å’Œæ•ˆç‡ï¼Œâ€Matei å†™é“ã€‚\n\nFermyon ä¼ è¾¾çš„ Serverless AI çš„å…·ä½“ç‰¹ç‚¹åŒ…æ‹¬ï¼š\n\n- è¿™æ˜¯ä¸€æ¬¾å¼€å‘äººå‘˜å·¥å…·å’Œæ‰˜ç®¡æœåŠ¡ï¼Œä¸“ä¸ºä½¿ç”¨å¼€æº LLM è¿›è¡Œ AI æ¨ç†çš„æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºè€Œè®¾è®¡ã€‚\n- ç”±äºæˆ‘ä»¬çš„æ ¸å¿ƒ WebAssembly æŠ€æœ¯ï¼Œæˆ‘ä»¬çš„å†·å¯åŠ¨æ—¶é—´æ¯”ç«äº‰å¯¹æ‰‹å¿« 100 å€ï¼Œä»å‡ åˆ†é’Ÿç¼©çŸ­åˆ°ä¸åˆ°ä¸€ç§’ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ç›¸åŒçš„æ—¶é—´å†…ï¼ˆå¹¶ä¸”ä½¿ç”¨ç›¸åŒçš„ç¡¬ä»¶ï¼‰æ‰§è¡Œæ•°ç™¾ä¸ªåº”ç”¨ç¨‹åºï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œè€Œä»Šå¤©çš„æœåŠ¡ç”¨äºè¿è¡Œä¸€ä¸ªã€‚\n- æˆ‘ä»¬ä¸ºä½¿ç”¨ Spin æ„å»ºå’Œè¿è¡Œ AI åº”ç”¨ç¨‹åºæä¾›äº†æœ¬åœ°å¼€å‘ä½“éªŒï¼Œç„¶åå°†å…¶éƒ¨ç½²åˆ° Fermyon Cloud ä¸­ï¼Œä»¥é«˜æ€§èƒ½çš„æ–¹å¼ä»¥å…¶ä»–è§£å†³æ–¹æ¡ˆçš„ä¸€å°éƒ¨åˆ†æˆæœ¬æä¾›æœåŠ¡ã€‚\n- Fermyon Cloud ä½¿ç”¨ AI çº§åˆ«çš„ GPU å¤„ç†æ¯ä¸ªè¯·æ±‚ã€‚ç”±äºæˆ‘ä»¬çš„å¿«é€Ÿå¯åŠ¨å’Œé«˜æ•ˆçš„æ—¶é—´å…±äº«ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°ç™¾ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«å•ä¸ª GPUã€‚\n- æˆ‘ä»¬æ­£åœ¨æ¨å‡ºå…è´¹çš„ç§äººæµ‹è¯•ç‰ˆã€‚\n\n## å¤§å¸Œæœ›\n\nç„¶è€Œï¼Œåœ¨ Wasm å’Œ AI åŒæ—¶è¾¾åˆ°æ½œåŠ›ä¹‹å‰ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚åœ¨ WasmCon 2023 ä¸Šï¼ŒSecond State çš„ CEO å…¼è”åˆåˆ›å§‹äºº Michael Yuan å’Œ Wasm çš„è¿è¡Œæ—¶é¡¹ç›®ä»¥åŠ WasmEdge çš„è®¨è®ºäº†ä¸€äº›æ­£åœ¨è¿›è¡Œçš„å·¥ä½œã€‚ä»–åœ¨ä¸ De Miguel Meana çš„è°ˆè¯ä¸­æ¶µç›–äº†è¿™ä¸ªè¯é¢˜ï¼Œâ€œå¼€å§‹ä½¿ç”¨ AI å’Œ WebAssemblyâ€åœ¨ WasmCon 2023 ä¸Šã€‚\n\nâ€œåœ¨è¿™ä¸ªé¢†åŸŸï¼ˆAI å’Œ Wasmï¼‰éœ€è¦åšå¾ˆå¤šç”Ÿæ€ç³»ç»Ÿå·¥ä½œã€‚ä¾‹å¦‚ï¼Œä»…æ‹¥æœ‰æ¨ç†æ˜¯ä¸å¤Ÿçš„ï¼Œâ€Yuan è¯´ã€‚â€œç°åœ¨çš„ç™¾ä¸‡ç¾å…ƒé—®é¢˜æ˜¯ï¼Œå½“æ‚¨æ‹¥æœ‰å›¾åƒå’Œæ–‡æœ¬æ—¶ï¼Œå¦‚ä½•å°†å…¶è½¬æ¢ä¸ºä¸€ç³»åˆ—æ•°å­—ï¼Œç„¶ååœ¨æ¨ç†ä¹‹åå¦‚ä½•å°†è¿™äº›æ•°å­—è½¬æ¢å›å¯ç”¨çš„æ ¼å¼ï¼Ÿâ€\n\né¢„å¤„ç†å’Œåå¤„ç†æ˜¯ Python ä»Šå¤©æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œè¿™å¾—ç›Šäºä¸ºè¿™äº›ä»»åŠ¡æä¾›çš„ä¼—å¤šåº“ï¼ŒYuan è¯´ã€‚å°†è¿™äº›é¢„å¤„ç†å’Œåå¤„ç†å‡½æ•°åˆå¹¶åˆ° Rust å‡½æ•°ä¸­å°†æ˜¯æœ‰ç›Šçš„ï¼Œä½†éœ€è¦ç¤¾åŒºæ›´å¤šçš„åŠªåŠ›æ¥æ”¯æŒå…¶ä»–æ¨¡å—ã€‚â€œè¿™ä¸ªç”Ÿæ€ç³»ç»Ÿæœ‰å¾ˆå¤§çš„å¢é•¿æ½œåŠ›ï¼Œâ€Yuan è¯´ã€‚\n', '\/trans\/is-it-too-early-to-leverage-ai-for-webassembly\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">Fermyon Technologies è®¤ä¸ºï¼Œå°† AI åº”ç”¨äº WebAssembly å¹¶ä¸ä¸ºæ—¶è¿‡æ—©ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/docker-multi-platform-image-building/">Docker å¤šå¹³å°æ„å»ºæŒ‡å—ï¼šæ„å»º WebAssembly é•œåƒ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/04/25</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Docker å¤šå¹³å°æ„å»ºæŒ‡å—ï¼šæ„å»º WebAssembly é•œåƒ', 'æœ¬æ–‡ä»‹ç»äº† Docker buildx çš„å¤šå¹³å°æ„å»ºæŒ‡å—ï¼ŒåŒ…æ‹¬æ„å»ºå™¨ã€å¹¶è¡Œå™¨ã€ç¼“å­˜ç®¡ç†å™¨å’Œè¾“å‡ºå™¨ç­‰ç»„ä»¶ï¼Œä»¥åŠå¸¸ç”¨çš„ docker buildx å‘½ä»¤åŠå…¶ç”¨æ³•ã€‚åŒæ—¶è¿˜ä»‹ç»äº†å¦‚ä½•ç®¡ç†å’Œç»´æŠ¤ Docker buildx çš„æ„å»ºç¯å¢ƒï¼Œä»¥åŠæ„å»º WebAssembly é•œåƒçš„ä¸€èˆ¬æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ã€‚', '\nDocker å¤šå¹³å°æ„å»ºæ˜¯ä¸€ç§ç”¨äºæ„å»º Docker é•œåƒä»¥åœ¨å¤šç§ CPU æ¶æ„å’Œæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æŠ€æœ¯ã€‚å®ƒå¯ä»¥è®©ç”¨æˆ·åœ¨ä¸€ä¸ª Dockerfile ä¸­å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ„å»ºè¿‡ç¨‹ï¼Œç„¶åä½¿ç”¨ Docker CLI å‘½ä»¤å°†å…¶æ„å»ºä¸ºå¤šä¸ªä¸åŒå¹³å°çš„é•œåƒã€‚è¿™äº›é•œåƒå¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—æœºã€äº‘å¹³å°å’Œå®¹å™¨ç¼–æ’ç³»ç»Ÿä¸Šè¿è¡Œï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›æ›´å¹¿æ³›çš„éƒ¨ç½²é€‰é¡¹ã€‚\n\nåœ¨å¤šå¹³å°æ„å»ºä¸­ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ Docker Buildx æ’ä»¶æ¥æ„å»ºé•œåƒã€‚Docker Buildx å¯ä»¥æ„å»ºå¹¶è¾“å‡ºå¤šä¸ªä¸åŒå¹³å°çš„é•œåƒï¼ŒåŒ…æ‹¬ x86ã€ARMã€IBM Power ç­‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¯¥æ’ä»¶åˆ›å»ºå¤šç§å¹³å°çš„æ„å»ºç¯å¢ƒï¼Œå¹¶ä½¿ç”¨è¿™äº›ç¯å¢ƒæ„å»ºé•œåƒã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šå¹³å°æ„å»ºéœ€è¦åœ¨æ”¯æŒå¤šå¹³å°çš„ Docker ä¸»æœºä¸Šè¿›è¡Œã€‚åœ¨è¿™ç§ä¸»æœºä¸Šï¼ŒDocker å¯ä»¥ä½¿ç”¨ QEMU ç­‰æ¨¡æ‹Ÿå™¨æ¥æ¨¡æ‹Ÿå…¶ä»–å¹³å°çš„ç¯å¢ƒï¼Œä»è€Œå®ç°æ„å»ºå¤šç§å¹³å°çš„é•œåƒã€‚\n\n## ä»€ä¹ˆæ˜¯ docker buildx? {#what-is-docker-buildx}\n\nDocker Buildx æ˜¯ Docker çš„ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•ã€é«˜æ•ˆçš„æ–¹å¼æ¥æ„å»ºå’Œæ‰“åŒ… Docker é•œåƒã€‚å®ƒèƒ½å¤Ÿåœ¨å¤šä¸ªå¹³å°ä¸Šæ„å»ºå’Œè¾“å‡º Docker é•œåƒï¼ŒåŒ…æ‹¬ Linuxã€Windowsã€macOS ç­‰ï¼Œæ”¯æŒ CPU æ¶æ„å’Œæ“ä½œç³»ç»Ÿç­‰å¤šç§å‚æ•°çš„è®¾ç½®ã€‚\n\nDocker Buildx åœ¨æ„å»ºé•œåƒæ—¶ä½¿ç”¨äº† [BuildKit](https:\/\/docs.docker.com\/build\/buildkit\/)ï¼Œè¿™æ˜¯ Docker å®˜æ–¹æ¨å‡ºçš„ä¸€ä¸ªåŸºäº Go è¯­è¨€å®ç°çš„é«˜æ€§èƒ½æ„å»ºå¼•æ“ã€‚BuildKit æä¾›äº†æ›´å¿«çš„æ„å»ºé€Ÿåº¦ã€æ›´å°çš„é•œåƒä½“ç§¯ã€æ›´å¥½çš„ç¼“å­˜ç®¡ç†ç­‰ä¼˜åŠ¿ï¼Œä¹Ÿå¯ä»¥åœ¨ Docker Buildx ä¹‹å¤–ä½¿ç”¨ã€‚\n\nä½¿ç”¨ Docker Buildxï¼Œå¯ä»¥å°†ä¸åŒå¹³å°ä¸Šçš„ Docker é•œåƒæ„å»ºåˆå¹¶åˆ°ä¸€ä¸ª manifest ä¸­ï¼Œä½¿å¾—ç”¨æˆ·åªéœ€è¦ä¸‹è½½ä¸€ä¸ª manifestï¼Œå°±å¯ä»¥è·å–å¤šä¸ªå¹³å°çš„é•œåƒã€‚è¿™ä¸ºè·¨å¹³å°å¼€å‘å’Œåˆ†å‘åº”ç”¨ç¨‹åºæä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚\n\n## Docker buildx å®ç°å¤šå¹³å°æ„å»ºçš„åŸç† {#docker-buildx-principles}\n\nDocker [buildx](https:\/\/github.com\/docker\/buildx) å®ç°å¤šå¹³å°é•œåƒæ„å»ºçš„åŸç†æ˜¯åŸºäº Docker çš„å¤šæ¶æ„æ”¯æŒã€‚Docker å¯ä»¥åœ¨ä¸€ä¸ªä¸»æœºä¸Šè¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨è¿è¡Œåœ¨è‡ªå·±çš„éš”ç¦»ç¯å¢ƒä¸­ï¼Œç›¸äº’ç‹¬ç«‹ã€‚è€Œ Docker é•œåƒåˆ™æ˜¯ç”¨äºåˆ›å»ºå®¹å™¨çš„åŸºç¡€æ–‡ä»¶ç³»ç»Ÿã€‚\n\nåœ¨ Docker ä¸­ï¼Œä¸åŒçš„ CPU æ¶æ„å’Œæ“ä½œç³»ç»Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„ base imageï¼ˆåŸºç¡€é•œåƒï¼‰è¿›è¡Œæ„å»ºã€‚è€Œ Docker buildx å¯ä»¥è‡ªåŠ¨è¯†åˆ«å½“å‰ä¸»æœºçš„æ¶æ„å’Œæ“ä½œç³»ç»Ÿï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ base image è¿›è¡Œæ„å»ºã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒDocker buildx ä¼šä½¿ç”¨ BuildKit å¼•æ“è¿›è¡Œæ„å»ºï¼Œæ”¯æŒå¤šå¹³å°çš„äº¤å‰ç¼–è¯‘å’Œé•œåƒæ‰“åŒ…ã€‚\n\nåœ¨æ„å»ºå®Œæˆåï¼ŒDocker buildx ä¼šå°†ä¸åŒå¹³å°ä¸Šçš„é•œåƒæ‰“åŒ…æˆä¸€ä¸ª manifest æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰å¹³å°çš„é•œåƒä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ Docker CLI å‘½ä»¤æˆ–è€… Docker registry æ¥å£æ¥æ“ä½œ manifest æ–‡ä»¶ï¼Œè·å–ä¸åŒå¹³å°ä¸Šçš„é•œåƒã€‚å¯¹äºä¸æ”¯æŒå¤šæ¶æ„çš„ Docker ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡å®‰è£… Docker CLI çš„ experimental ç‰ˆæœ¬æ¥ä½¿ç”¨ Docker buildxã€‚\n\nDocker buildx åˆ©ç”¨äº† Docker çš„å¤šæ¶æ„æ”¯æŒå’Œ BuildKit å¼•æ“ï¼Œå®ç°äº†è·¨å¹³å°çš„ Docker é•œåƒæ„å»ºå’Œåˆ†å‘ã€‚\n\n## Docker BuildKit å¼•æ“ç®€ä»‹ {#docker-buildkit}\n\n[BuildKit](https:\/\/docs.docker.com\/build\/buildkit\/) æ˜¯ Docker å®˜æ–¹æ¨å‡ºçš„ä¸€ä¸ªé«˜æ€§èƒ½çš„æ„å»ºå¼•æ“ï¼Œå®ƒå¯ä»¥ç”¨äºæ„å»º Docker é•œåƒã€æ„å»ºåº”ç”¨ç¨‹åºä»¥åŠæ‰§è¡Œå…¶ä»–æ„å»ºä»»åŠ¡ã€‚BuildKit å¼•æ“é‡‡ç”¨äº†åˆ†å¸ƒå¼çš„æ¶æ„ï¼Œå¯ä»¥å¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªæ„å»ºä»»åŠ¡ï¼Œæé«˜æ„å»ºæ•ˆç‡ã€‚\n\nBuildKit å¼•æ“çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š\n\n1. é«˜æ€§èƒ½ï¼šBuildKit å¼•æ“é‡‡ç”¨äº†é«˜æ•ˆçš„ç¼“å­˜ç®¡ç†æœºåˆ¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿåœ°æ‰§è¡Œå¢é‡æ„å»ºï¼Œå‡å°‘æ„å»ºæ—¶é—´ã€‚åŒæ—¶ï¼Œå®ƒè¿˜èƒ½å¤Ÿè‡ªåŠ¨ä¼˜åŒ–æ„å»ºè¿‡ç¨‹ï¼Œé€‰æ‹©æœ€ä½³çš„æ„å»ºè·¯å¾„å’Œç­–ç•¥ï¼Œè¿›ä¸€æ­¥æé«˜æ„å»ºæ€§èƒ½ã€‚\n2. å¤šå¹³å°æ”¯æŒï¼šBuildKit å¼•æ“æ”¯æŒå¤šç§ CPU æ¶æ„å’Œæ“ä½œç³»ç»Ÿï¼Œèƒ½å¤Ÿåœ¨ä¸åŒå¹³å°ä¸Šæ„å»ºå’Œè¾“å‡º Docker é•œåƒã€‚åœ¨ Docker buildx ä¸­ï¼ŒBuildKit å¼•æ“å¯ä»¥è‡ªåŠ¨è¯†åˆ«å½“å‰ä¸»æœºçš„æ¶æ„å’Œæ“ä½œç³»ç»Ÿï¼Œå¹¶é€‰æ‹©åˆé€‚çš„æ„å»ºæ–¹æ¡ˆã€‚\n3. æ¨¡å—åŒ–è®¾è®¡ï¼šBuildKit å¼•æ“é‡‡ç”¨äº†æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åŠ è½½å’Œå¸è½½ä¸åŒçš„æ¨¡å—ã€‚è¿™ä½¿å¾— BuildKit å¼•æ“æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ï¼Œå¯ä»¥æ”¯æŒå„ç§ä¸åŒçš„æ„å»ºä»»åŠ¡ã€‚\n4. å®‰å…¨æ€§ï¼šBuildKit å¼•æ“é‡‡ç”¨äº†å®‰å…¨çš„æ„å»ºæ–¹å¼ï¼Œå¯ä»¥è‡ªåŠ¨æ‰§è¡Œä¸€ç³»åˆ—çš„å®‰å…¨æ£€æŸ¥ï¼Œç¡®ä¿æ„å»ºè¿‡ç¨‹ä¸­ä¸ä¼šå¼•å…¥æ¼æ´æˆ–å…¶ä»–å®‰å…¨é—®é¢˜ã€‚åŒæ—¶ï¼ŒBuildKit å¼•æ“è¿˜æ”¯æŒç­¾åå’ŒåŠ å¯†ç­‰å®‰å…¨åŠŸèƒ½ï¼Œä¿æŠ¤ç”¨æˆ·çš„æ„å»ºæ•°æ®å’Œé•œåƒã€‚\n\n## Docker buildx æ”¯æŒå“ªäº›å¹³å°ï¼Ÿ{#platforms}\n\nDocker buildx æ”¯æŒçš„å¹³å°ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š\n\n1. Linuxï¼šåŒ…æ‹¬å¤šç§ CPU æ¶æ„å’Œæ“ä½œç³»ç»Ÿï¼Œå¦‚ x86_64ã€ARMã€IBM Powerã€IBM Z ç­‰ã€‚\n2. Windowsï¼šåŒ…æ‹¬å¤šç§ CPU æ¶æ„å’Œæ“ä½œç³»ç»Ÿï¼Œå¦‚ x86_64ã€ARM64 ç­‰ã€‚\n3. macOSï¼šæ”¯æŒ Intelã€Apple M1 æ¶æ„ã€‚\n\né™¤äº†ä»¥ä¸Šå¹³å°å¤–ï¼ŒDocker buildx è¿˜æ”¯æŒæ„å»ºå’Œè¾“å‡ºå¤šç§å…¶ä»–å¹³å°çš„ Docker é•œåƒï¼ŒåŒ…æ‹¬ FreeBSDã€Solaris ç­‰ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æŒ‡å®šå¯¹åº”çš„ \u0060platform\u0060 å‚æ•°æ¥æ„å»ºå’Œè¾“å‡ºä¸åŒå¹³å°çš„ Docker é•œåƒï¼Œä¾‹å¦‚ï¼š\n\n\u0060\u0060\u0060bash\ndocker buildx build --platform linux\/amd64,linux\/arm64 .\n\u0060\u0060\u0060\n\nè¿™ä¸ªå‘½ä»¤å°†ä¼šæ„å»ºä¸€ä¸ªåŒæ—¶æ”¯æŒ x86_64 å’Œ ARM64 æ¶æ„çš„ Docker é•œåƒã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šä¸åŒçš„ buildx æ„å»ºé…ç½®æ¥æ”¯æŒæ›´å¤šçš„å¹³å°ï¼Œä¾‹å¦‚ä½¿ç”¨ qemu-user-static ç­‰æ¨¡æ‹Ÿå™¨æ¥æ”¯æŒå…¶ä»–çš„ CPU æ¶æ„ã€‚æ€»ä¹‹ï¼ŒDocker buildx çš„å¤šå¹³å°æ”¯æŒéå¸¸å¼ºå¤§ï¼Œä¸ºè·¨å¹³å°å¼€å‘å’Œåˆ†å‘åº”ç”¨ç¨‹åºæä¾›äº†ä¾¿åˆ©ã€‚\n\n## Docker buildx å¼•æ“çš„æ¶æ„ä¸ç»„æˆ {#arch}\n\nDocker buildx å¼•æ“çš„æ¶æ„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ„å»ºç³»ç»Ÿï¼Œé€šè¿‡å¤šé˜¶æ®µã€å¤šç»„ä»¶çš„è®¾è®¡ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€å¤šå¹³å°æ”¯æŒã€å®‰å…¨æ€§ç­‰ä¼˜ç‚¹ï¼Œä¸º Docker é•œåƒæ„å»ºå’Œåº”ç”¨ç¨‹åºæ„å»ºæä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚å®ƒç”±ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ç»„æˆï¼š\n\n1. CLIï¼šæä¾›äº†å‘½ä»¤è¡Œæ¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥æ‰§è¡Œæ„å»ºä»»åŠ¡ã€ç®¡ç†æ„å»ºé…ç½®ç­‰æ“ä½œã€‚\n2. BuildKit å¼•æ“ï¼šä½œä¸º Docker buildx çš„æ„å»ºå¼•æ“ï¼Œå®ƒè´Ÿè´£æ‰§è¡Œæ„å»ºä»»åŠ¡ï¼Œç”Ÿæˆ Docker é•œåƒç­‰ã€‚BuildKit å¼•æ“å…·æœ‰é«˜æ€§èƒ½ã€å¤šå¹³å°æ”¯æŒã€å®‰å…¨æ€§ç­‰ä¼˜ç‚¹ã€‚\n3. æ„å»ºå™¨ï¼ˆBuilderï¼‰ï¼šæ„å»ºå™¨æ˜¯ä¸€ä¸ª Docker å®¹å™¨ï¼Œå®ƒåŒ…å«äº†æ„å»ºæ‰€éœ€è¦çš„ç¯å¢ƒå’Œå·¥å…·ï¼Œå¯ä»¥æ‰§è¡Œæ„å»ºä»»åŠ¡ã€‚åœ¨ Docker buildx ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªæ„å»ºå™¨ï¼Œä»¥æ”¯æŒå¤šä¸ªå¹³å°å’Œå¤šä¸ªæ„å»ºç¯å¢ƒã€‚\n4. å¹¶è¡Œå™¨ï¼ˆSchedulerï¼‰ï¼šå¹¶è¡Œå™¨æ˜¯è´Ÿè´£åè°ƒå’Œç®¡ç†å¤šä¸ªæ„å»ºå™¨çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„æ„å»ºå™¨æ‰§è¡Œæ„å»ºä»»åŠ¡ï¼Œå¹¶å°†ä»»åŠ¡åˆ†é…ç»™åˆé€‚çš„æ„å»ºå™¨ã€‚å¹¶è¡Œå™¨è¿˜å¯ä»¥æ‰§è¡Œæ„å»ºä»»åŠ¡çš„å¹¶è¡Œå¤„ç†ï¼Œæé«˜æ„å»ºæ•ˆç‡ã€‚\n5. ç¼“å­˜ç®¡ç†å™¨ï¼ˆCache Managerï¼‰ï¼šç¼“å­˜ç®¡ç†å™¨æ˜¯è´Ÿè´£ç®¡ç†æ„å»ºè¿‡ç¨‹ä¸­çš„ç¼“å­˜æ•°æ®ï¼Œå¯ä»¥å¿«é€Ÿæ‰§è¡Œå¢é‡æ„å»ºï¼Œå‡å°‘æ„å»ºæ—¶é—´ã€‚åœ¨ Docker buildx ä¸­ï¼Œç¼“å­˜ç®¡ç†å™¨å¯ä»¥è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç¼“å­˜æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼“å­˜å’Œè¿œç¨‹ç¼“å­˜ç­‰ã€‚\n6. è¾“å‡ºå™¨ï¼ˆExporterï¼‰ï¼šè¾“å‡ºå™¨è´Ÿè´£å°†æ„å»ºç”Ÿæˆçš„ Docker é•œåƒè¾“å‡ºåˆ°æŒ‡å®šçš„ä»“åº“æˆ–è€…æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚åœ¨ Docker buildx ä¸­ï¼Œè¾“å‡ºå™¨å¯ä»¥è‡ªåŠ¨è¯†åˆ«å½“å‰å¹³å°å’Œç›®æ ‡å¹³å°ï¼Œé€‰æ‹©åˆé€‚çš„é•œåƒæ ¼å¼å’Œè¾“å‡ºè·¯å¾„ã€‚\n\n## docker buildx å‘½ä»¤çš„ä½¿ç”¨{#command}\n\nä½¿ç”¨ docker buildx å‘½ä»¤å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œ Docker é•œåƒçš„æ„å»ºå’Œè¾“å‡ºã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ docker buildx å‘½ä»¤åŠå…¶ç”¨æ³•ï¼š\n\næŸ¥çœ‹å½“å‰çš„ buildx æ„å»ºå™¨åˆ—è¡¨\n\n\u0060\u0060\u0060bash\ndocker buildx ls\n\u0060\u0060\u0060\n\nåˆ›å»ºæ–°çš„ buildx æ„å»ºå™¨\n\n\u0060\u0060\u0060bash\ndocker buildx create --name mybuilder\n\u0060\u0060\u0060\n\nåˆ‡æ¢åˆ°æŒ‡å®šåç§°çš„ buildx æ„å»ºå™¨\n\n\u0060\u0060\u0060bash\ndocker buildx use mybuilder\n\u0060\u0060\u0060\n\nè®¾ç½® buildx æ„å»ºå™¨çš„å¹³å°æ”¯æŒ\n\n\u0060\u0060\u0060bash\ndocker buildx inspect --bootstrap\ndocker buildx inspect --platform\ndocker buildx build --platform linux\/amd64,linux\/arm64 .\n\u0060\u0060\u0060\n\næ„å»º Docker é•œåƒï¼š\n\n\u0060\u0060\u0060bash\ndocker buildx build --tag myimage .\n\u0060\u0060\u0060\n\nè¾“å‡º Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ\n\n\u0060\u0060\u0060bash\ndocker buildx build --output=type=local,dest=.\/output .\n\u0060\u0060\u0060\n\nè¾“å‡º Docker é•œåƒåˆ° Docker Hub æˆ–å…¶ä»–è¿œç¨‹ä»“åº“\n\n\u0060\u0060\u0060bash\ndocker buildx build --tag myrepo\/myimage --push .\n\u0060\u0060\u0060\n\nåˆ é™¤æŒ‡å®šåç§°çš„ buildx æ„å»ºå™¨\n\n\u0060\u0060\u0060bash\ndocker buildx rm mybuilder\n\u0060\u0060\u0060\n\né™¤äº†ä»¥ä¸Šå‘½ä»¤å¤–ï¼Œdocker buildx è¿˜æ”¯æŒè®¸å¤šå…¶ä»–çš„å‚æ•°å’Œé€‰é¡¹ï¼Œä¾‹å¦‚è®¾ç½®æ„å»ºç¼“å­˜ã€å¹¶è¡Œå¤„ç†ã€æ„å»ºæ ‡ç­¾ç­‰ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£æˆ–è€…ä½¿ç”¨ --help é€‰é¡¹æ¥äº†è§£æ›´å¤šè¯¦æƒ…ã€‚\n\n## ç†è§£ buildx æ„å»ºå™¨ {#builder}\n\nåœ¨ Docker ä¸­ï¼Œæ„å»ºå™¨ï¼ˆBuilderï¼‰æ˜¯æŒ‡ä¸€ä¸ª Docker å®¹å™¨ï¼Œå®ƒåŒ…å«äº†æ„å»ºæ‰€éœ€è¦çš„ç¯å¢ƒå’Œå·¥å…·ï¼Œå¯ä»¥æ‰§è¡Œæ„å»ºä»»åŠ¡ã€‚Docker buildx æ„å»ºå™¨æ˜¯æŒ‡ä½¿ç”¨ BuildKit å¼•æ“çš„å¤šå¹³å°æ„å»ºå™¨ï¼Œå¯ä»¥é€šè¿‡ Docker CLI å‘½ä»¤è¿›è¡Œç®¡ç†å’Œæ“ä½œã€‚åœ¨ä½¿ç”¨ Docker buildx æ„å»ºå™¨æ—¶ï¼Œç”¨æˆ·å¯ä»¥é…ç½®å¤šä¸ªæ„å»ºå™¨ï¼Œä»¥æ”¯æŒå¤šä¸ªå¹³å°å’Œå¤šä¸ªæ„å»ºç¯å¢ƒã€‚\n\nç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºã€åˆ‡æ¢ã€æŸ¥çœ‹å’Œåˆ é™¤æ„å»ºå™¨ï¼Œæ¥ç®¡ç†å’Œç»´æŠ¤ Docker buildx çš„æ„å»ºç¯å¢ƒã€‚æ„å»ºå™¨çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªå¹²å‡€ã€ç‹¬ç«‹çš„æ„å»ºç¯å¢ƒï¼Œé¿å…æ„å»ºè¿‡ç¨‹ä¸­çš„ä¾èµ–å†²çªå’Œç¯å¢ƒæ±¡æŸ“ã€‚æ­¤å¤–ï¼Œæ„å»ºå™¨è¿˜å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œå…±äº«ï¼Œä»¥ä¾¿å¤šä¸ªç”¨æˆ·æˆ–è€…å›¢é˜ŸååŒæ„å»º Docker é•œåƒã€‚\n\nDocker buildx æ„å»ºå™¨è¿˜æ”¯æŒå¤šå¹³å°æ„å»ºï¼Œç”¨æˆ·å¯ä»¥åœ¨åŒä¸€ä¸ªæ„å»ºå™¨ä¸­è®¾ç½®å¤šä¸ªå¹³å°ï¼Œä»¥ä¾¿ç”Ÿæˆè·¨å¹³å°çš„ Docker é•œåƒã€‚é€šè¿‡ Docker buildx æ„å»ºå™¨ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾å®ç° Docker é•œåƒçš„å¤šå¹³å°æ„å»ºï¼Œæé«˜æ„å»ºæ•ˆç‡å’Œåº”ç”¨ç¨‹åºçš„å…¼å®¹æ€§ã€‚\n\n## ä¸ºä»€ä¹ˆæœ¬åœ°çœ‹ä¸åˆ° Docker buildx æ„å»ºçš„é•œåƒï¼Ÿ{#where-is-my-images}\n\nè¿™é€šå¸¸æ˜¯å› ä¸ºä½ å½“å‰ä½¿ç”¨çš„ Docker context ä¸æ”¯æŒç¼–è¯‘å‡ºæ¥çš„é•œåƒæ¶æ„ã€‚ä¾‹å¦‚ [Orbstack](https:\/\/orbstack.dev\/)ï¼Œè™½ç„¶å®ƒæ”¯æŒç¼–è¯‘è·¨å¹³å°çš„é•œåƒï¼Œä½†æ˜¯æ‰§è¡Œ \u0060docker buildx\u0060 æ„å»ºå‡ºæ¥çš„é•œåƒä¸ä¼šç›´æ¥ä¿å­˜åœ¨æœ¬åœ°çš„ Docker é•œåƒä»“åº“ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨æ„å»ºå™¨ï¼ˆBuilderï¼‰çš„ç¼“å­˜ä¸­ã€‚è¿™æ˜¯å› ä¸º Docker buildx é‡‡ç”¨äº†åˆ†å±‚æ„å»ºçš„æ–¹å¼ï¼Œæ„å»ºå‡ºçš„æ¯ä¸€å±‚é•œåƒéƒ½å¯ä»¥è¢«é‡ç”¨ï¼Œä»¥å‡å°‘æ„å»ºæ—¶é—´å’Œç£ç›˜ç©ºé—´çš„å ç”¨ã€‚\n\nä½ åº”è¯¥ä½¿ç”¨ \u0060docker context\u0060 å‘½ä»¤åˆ‡æ¢ä¼š Docker é»˜è®¤çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå†æ‰§è¡Œæ„å»ºï¼Œè¿™æ ·æ„å»ºå‡ºæ¥çš„è·¨å¹³å°é•œåƒå°±å¯ä»¥åœ¨æœ¬åœ°çœ‹è§äº†ã€‚\n\n## å¦‚ä½•å°†å¤šå¹³å°é•œåƒä¿å­˜åˆ°æœ¬åœ°ï¼Ÿ{#local-storage}\n\nè¦å°† Docker buildx æ„å»ºçš„å¤šå¹³å°é•œåƒä¿å­˜åˆ°æœ¬åœ°ï¼Œå¯ä»¥ä½¿ç”¨ \u0060--output\u0060 é€‰é¡¹æŒ‡å®šè¾“å‡ºç±»å‹ä¸º \u0060type=local\u0060ï¼Œå¹¶æŒ‡å®šè¾“å‡ºç›®å½•ï¼Œä¾‹å¦‚ï¼š\n\n\u0060\u0060\u0060bash\ndocker buildx build --platform linux\/amd64,linux\/arm64 --output type=local,dest=.\/output .\n\u0060\u0060\u0060\n\nä¸Šè¿°å‘½ä»¤å°†æ„å»ºåŒ…å« \u0060linux\/amd64\u0060 å’Œ \u0060linux\/arm64\u0060 ä¸¤ç§å¹³å°çš„é•œåƒï¼Œå¹¶å°†è¾“å‡ºç±»å‹è®¾ç½®ä¸ºæœ¬åœ°ï¼ˆ\u0060type=local\u0060ï¼‰ï¼Œè¾“å‡ºç›®å½•ä¸º \u0060.\/output\u0060ã€‚\n\næ„å»ºå®Œæˆåï¼Œè¾“å‡ºç›®å½•ä¸­ä¼šç”Ÿæˆå¤šä¸ªå­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•åˆ†åˆ«å¯¹åº”ä¸€ä¸ªå¹³å°ï¼Œå…¶ä¸­åŒ…å«è¯¥å¹³å°ä¸‹çš„é•œåƒæ–‡ä»¶ã€‚\n\nå¦‚æœåªæƒ³ä¿å­˜å…¶ä¸­ä¸€ä¸ªå¹³å°çš„é•œåƒï¼Œå¯ä»¥åœ¨ \u0060--output\u0060 é€‰é¡¹ä¸­æŒ‡å®šè¦ä¿å­˜çš„å¹³å°ï¼Œä¾‹å¦‚ï¼š\n\n\u0060\u0060\u0060bash\ndocker buildx build --platform linux\/amd64,linux\/arm64 --output type=local,dest=.\/output\/linux\/amd64 .\n\u0060\u0060\u0060\n\nä¸Šè¿°å‘½ä»¤å°†åªä¿å­˜ \u0060linux\/amd64\u0060 å¹³å°çš„é•œåƒï¼Œè¾“å‡ºåˆ° \u0060.\/output\/linux\/amd64\u0060 ç›®å½•ä¸­ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ\u0060--output\u0060 é€‰é¡¹åªæ”¯æŒéƒ¨åˆ†è¾“å‡ºç±»å‹ï¼Œå¦‚æœè¦å°†é•œåƒä¿å­˜åˆ°å…¶ä»–ç±»å‹çš„è¾“å‡ºï¼ˆä¾‹å¦‚ tar åŒ…ã€OCI å­˜å‚¨ã€Docker registry ç­‰ï¼‰ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„è¾“å‡ºæ’ä»¶å’Œé€‰é¡¹ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒ [Docker å®˜æ–¹æ–‡æ¡£](https:\/\/docs.docker.com\/build\/building\/multi-platform\/)ã€‚\n\n## å¦‚ä½•ä½¿ç”¨æ„å»º Wasm é•œåƒï¼Ÿ{#wasm}\n\nWebAssembly æ˜¯ä¸€ç§ä¸­é—´ä»£ç æ ¼å¼ï¼Œéœ€è¦ä½¿ç”¨ç¼–è¯‘å™¨å°†æºä»£ç ç¼–è¯‘ä¸º WebAssembly æ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†å°†å…¶æ‰“åŒ…æˆé•œåƒã€‚ä»¥ä¸‹æ˜¯æ„å»º WebAssembly é•œåƒçš„ä¸€èˆ¬æ­¥éª¤ï¼š\n\n1. ç¼–å†™ WebAssembly æºä»£ç ï¼Œå¹¶ä½¿ç”¨ç¼–è¯‘å™¨å°†å…¶ç¼–è¯‘ä¸º WebAssembly æ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¾‹å¦‚ä½¿ç”¨ Rust ç¼–å†™ä»£ç ï¼Œå¹¶ä½¿ç”¨ Cargo ç¼–è¯‘å‡º \u0060.wasm\u0060 æ–‡ä»¶ã€‚\n\n2. ç¼–å†™ Dockerfile å°† Wasm äºŒè¿›åˆ¶æ–‡ä»¶æ·»åŠ åˆ°ç©ºé•œåƒä¸­ã€‚ä¾‹å¦‚ï¼š\n\n   \u0060\u0060\u0060Dockerfile\n   # syntax=docker\/dockerfile:1\n   FROM scratch\n   COPY .\/target\/wasm32-wasi\/debug\/hello-wasm.wasm \/hello.wasm\n   ENTRYPOINT [ \u0022hello.wasm\u0022 ]\n   \u0060\u0060\u0060\n\n3.   ä½¿ç”¨ \u0060docker buildx\u0060 å‘½ä»¤æ„å»ºé•œåƒï¼Œä¾‹å¦‚ \u0060docker buildx build --platform wasi\/wasm32 -t jimmysong\/hello-wasm .\u0060  å°†åœ¨æœ¬åœ°æ„å»ºã€‚è‹¥ä½ æƒ³å°†è¯¥é•œåƒåŒæ—¶åŒæ—¶æ¨é€åˆ° Docker Hubï¼Œå¯ä»¥åœ¨å‘½ä»¤ä¸­åŠ ä¸Š \u0060--push\u0060æ ‡å¿—ã€‚åŸºäº WebAssembly å¹³å°çš„é•œåƒå¹¶ä¸Šä¼ åˆ° Docker Hubã€‚\n\n## æ³¨æ„äº‹é¡¹ {#notice}\n\né™¤äº†æ„å»ºå¤šå¹³å°é•œåƒã€å¯¼å‡ºå’ŒåŠ è½½é•œåƒå¤–ï¼Œè¿˜æœ‰ä¸€äº› Docker buildx å‘½ä»¤çš„å¸¸ç”¨æ“ä½œåŠæ³¨æ„äº‹é¡¹ï¼ŒåŒ…æ‹¬ï¼š\n\n1. \u0060-progress\u0060 é€‰é¡¹ï¼šå¯ä»¥ä½¿ç”¨ \u0060-progress\u0060 é€‰é¡¹æŒ‡å®šæ„å»ºè¿‡ç¨‹çš„è¾“å‡ºæ ¼å¼ï¼ŒåŒ…æ‹¬ \u0060auto\u0060ã€\u0060plain\u0060ã€\u0060tty\u0060 ä¸‰ç§æ ¼å¼ã€‚\n2. \u0060-no-cache\u0060 é€‰é¡¹ï¼šå¯ä»¥ä½¿ç”¨ \u0060-no-cache\u0060 é€‰é¡¹ç¦ç”¨æ„å»ºè¿‡ç¨‹ä¸­çš„ç¼“å­˜æœºåˆ¶ï¼Œå¼ºåˆ¶é‡æ–°æ„å»ºé•œåƒã€‚\n3. \u0060-push\u0060 é€‰é¡¹ï¼šå¯ä»¥ä½¿ç”¨ \u0060-push\u0060 é€‰é¡¹å°†æ„å»ºçš„é•œåƒæ¨é€åˆ° Docker registry ä¸­ã€‚\n4. \u0060-tag\u0060 é€‰é¡¹ï¼šå¯ä»¥ä½¿ç”¨ \u0060-tag\u0060 é€‰é¡¹ä¸ºæ„å»ºçš„é•œåƒæŒ‡å®šæ ‡ç­¾ã€‚\n5. \u0060-file\u0060 é€‰é¡¹ï¼šå¯ä»¥ä½¿ç”¨ \u0060-file\u0060 é€‰é¡¹æŒ‡å®š Dockerfile æ–‡ä»¶çš„è·¯å¾„ã€‚\n6. \u0060-build-arg\u0060 é€‰é¡¹ï¼šå¯ä»¥ä½¿ç”¨ \u0060-build-arg\u0060 é€‰é¡¹ä¼ é€’æ„å»ºå‚æ•°ç»™ Dockerfile ä¸­çš„æŒ‡ä»¤ã€‚\n7. æ„å»ºä¸Šä¸‹æ–‡çš„æ³¨æ„äº‹é¡¹ï¼šæ„å»ºä¸Šä¸‹æ–‡æŒ‡çš„æ˜¯ Dockerfile æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œä»¥åŠæ„å»ºè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„å…¶ä»–æ–‡ä»¶ã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦å°½é‡å‡å°‘æ„å»ºä¸Šä¸‹æ–‡çš„å¤§å°ï¼Œé¿å…æ„å»ºè¿‡ç¨‹ä¸­ä¼ è¾“å¤§é‡ä¸å¿…è¦çš„æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ \u0060.dockerignore\u0060 æ–‡ä»¶æ’é™¤ä¸éœ€è¦ä¼ è¾“çš„æ–‡ä»¶ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDocker buildx æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„å‘½ä»¤ï¼Œä¸åŒç‰ˆæœ¬çš„ Docker Engine å¯èƒ½ä¼šå­˜åœ¨å·®å¼‚ï¼Œå› æ­¤åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ“ä½œã€‚\n', '\/blog\/docker-multi-platform-image-building\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»äº† Docker buildx çš„å¤šå¹³å°æ„å»ºæŒ‡å—ï¼ŒåŒ…æ‹¬æ„å»ºå™¨ã€å¹¶è¡Œå™¨ã€ç¼“å­˜ç®¡ç†å™¨å’Œè¾“å‡ºå™¨ç­‰ç»„ä»¶ï¼Œä»¥åŠå¸¸ç”¨çš„ docker buildx å‘½ä»¤åŠå…¶ç”¨æ³•ã€‚åŒæ—¶è¿˜ä»‹ç»äº†å¦‚ä½•ç®¡ç†å’Œç»´æŠ¤ Docker buildx çš„æ„å»ºç¯å¢ƒï¼Œä»¥åŠæ„å»º WebAssembly é•œåƒçš„ä¸€èˆ¬æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/why-docker-support-wasm/">ä¸ºä»€ä¹ˆ Docker è¦å¢åŠ  WebAssembly è¿è¡Œæ—¶ï¼Ÿ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/04/07</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä¸ºä»€ä¹ˆ Docker è¦å¢åŠ  WebAssembly è¿è¡Œæ—¶ï¼Ÿ', 'æœ¬æ–‡ä»‹ç»äº† Docker ä¸ºä»€ä¹ˆè¦å¢åŠ å¯¹ WebAssembly çš„æ”¯æŒï¼Œä»¥åŠåœ¨ Docker ä¸­è¿è¡Œ WebAssembly åº”ç”¨çš„ä¼˜åŠ¿å’Œæ–¹æ³•ã€‚WebAssembly åº”ç”¨ç›¸å¯¹äº Linux é•œåƒæœ‰æ›´é«˜çš„æ€§èƒ½ã€å¯ç§»æ¤æ€§å’Œå®‰å…¨æ€§ï¼Œé€‚ç”¨äºè¾¹ç¼˜è®¡ç®—ã€äº‘åŸç”Ÿåº”ç”¨å’Œå¾®æœåŠ¡ç­‰åœºæ™¯ã€‚Docker æ”¯æŒå››ç§ WebAssembly è¿è¡Œæ—¶ï¼Œåˆ†åˆ«ä¸º spinã€spiderlightningã€WasmEdge å’Œ wasmtimeã€‚', '\nåœ¨ [Docker å‘å±•å²ï¼šå››ä¸ªé‡å¤§ä¸¾æªï¼Œå½±å“æ·±è¿œï¼](\/blog\/docker-four-milestones\/) è¿™ç¯‡æ–‡ç« ä¸­æˆ‘æåˆ°äº† Docker ä»ä¸€å¼€å§‹å¼•é¢†å®¹å™¨è¿è¡Œæ—¶ï¼Œå†åˆ°åœ¨å®¹å™¨ç¼–æ’è¿™ä¸€ç»´åº¦ä¸Šè½åäº Kubernetesã€‚ä¸ºäº†åœ¨ä¿ä½å®¹å™¨è¿è¡Œæ—¶çš„ç»Ÿæ²»åœ°ä½ï¼ŒDocker å…¬å¸æå‡ºäº† OCI å¹¶é€šè¿‡ [containerd-wasm-shim](https:\/\/github.com\/deislabs\/containerd-wasm-shims) æ”¯æŒæ›´å¤šçš„ WebAssembly è¿è¡Œæ—¶ã€‚\n\nä¸ºäº†è§£å†³ Docker åœ¨å®‰å…¨ã€ç¨³å®šæ€§ã€æ€§èƒ½åŠå¯ç§»æ¤æ€§æ–¹é¢çš„å±€é™æ€§ï¼ŒKubernetes ç¤¾åŒºå¼€å‘äº†å…·æœ‰ä¸åŒå®ç°å’ŒåŠŸèƒ½çš„å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼Œå¹¶ä¸ºå…¶åˆ¶å®šäº†å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰è§„èŒƒã€‚ç›®å‰å®ç°è¯¥è§„èŒƒçš„å®¹å™¨è¿è¡Œæ—¶æœ‰ containerdã€cri-oã€‚è¿˜æœ‰ katacontainersã€gvisor ç­‰æœªå®ç° CRI ä½†æ˜¯å¯ä»¥é€šè¿‡æ·»åŠ è™šæ‹ŸåŒ–å±‚åœ¨ Kubernetes ä¸Šè¿è¡Œçš„å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ã€‚\n\nå¼€æ”¾å®¹å™¨å€¡è®® (OCI) æ—¨åœ¨å®šä¹‰å®¹å™¨é•œåƒæ ¼å¼å’Œè¿è¡Œæ—¶çš„è¡Œä¸šæ ‡å‡†ï¼ŒDocker æèµ äº†å…¶è¿è¡Œæ—¶ runc ä½œä¸ºè¯¥æ ‡å‡†çš„ç¬¬ä¸€ä¸ªå®ç°ã€‚æœ€è¿‘ï¼ŒWASM ç¤¾åŒºå¯¹ OCI å·¥å…·é“¾è¡¨ç°å‡ºäº†å…´è¶£ï¼ŒDocker ç°åœ¨æ”¯æŒ WebAssembly æ¨¡å—ä½œä¸ºå…¶å·¥ä»¶ä¹‹ä¸€ã€‚ç°åœ¨ Docker Hub å·²ç»æ”¯æŒé™¤äº†é•œåƒä»¥å¤–çš„ï¼ŒHelmã€Volume å’Œ WebAssembly ç­‰å¸¸ç”¨å·¥ä»¶ã€‚\n\nä½¿ç”¨ Docker æ„å»ºåŒ…å« WebAssembly æ¨¡å—çš„é•œåƒï¼Œå¹¶ä¿å­˜åœ¨ Docker Hub ä¸­ã€‚é€šè¿‡ [containerd-wasm-shim](https:\/\/github.com\/deislabs\/containerd-wasm-shims)ï¼Œå¯ä»¥è®©å®ƒä»¬åœ¨ Kubernetes ä¸­è¿è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![åœ¨ Kubernetes ä¸­è¿è¡Œ WebAssembly æ¨¡å—](oci.svg)\n\nContainerd æ˜¯ä¸€ç§ç¬¦åˆ CRIï¼ˆContainer Runtime Interfaceï¼‰è§„èŒƒçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ç”± Docker å…¬å¸å¼€æºå¹¶è´¡çŒ®ç»™ CNCF çš„ã€‚åªè¦æ”¯æŒ CRI è§„èŒƒçš„è¿è¡Œæ—¶éƒ½å¯ä»¥åœ¨ Kubernetes ä¸­è¿è¡Œã€‚\n\nå…³äºä»¥ä¸Šæåˆ°çš„åè¯ containerdã€CRIã€OCI ç­‰çš„å…³ç³»ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ [Dockerï¼Œcontainerdï¼ŒCRIï¼ŒCRI-Oï¼ŒOCIï¼Œrunc åˆ†ä¸æ¸…ï¼Ÿçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†](https:\/\/zhuanlan.zhihu.com\/p\/490585683)\n\n## åœ¨ Docker ä¸­è¿è¡Œ WebAssembly åº”ç”¨ç›¸å¯¹ Linux é•œåƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ{#advantages}\n\nä½¿ç”¨ Docker è¿è¡Œ WebAssembly åº”ç”¨ç›¸å¯¹è¿è¡Œ Linux é•œåƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿ã€‚\n\n**æ›´é«˜çš„æ€§èƒ½**\n\nWebAssembly åº”ç”¨çš„å¯åŠ¨æ—¶é—´æ›´çŸ­ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å¯åŠ¨æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œè€Œ Linux å®¹å™¨éœ€è¦ã€‚WebAssembly æ¨¡å—çš„å†·å¯åŠ¨æ—¶é—´æ¯” Docker å®¹å™¨å¿« 100 å€ã€‚WebAssembly æ¨¡å—çš„å†…å­˜å ç”¨æ›´å°ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥é«˜æ•ˆåœ°å‹ç¼©ä»£ç å’Œä¾èµ–ï¼Œè€Œ Docker å®¹å™¨éœ€è¦æ‰“åŒ…æ•´ä¸ªé•œåƒã€‚WebAssembly æ¨¡å—çš„å¤§å°ä¸€èˆ¬åœ¨ 1MB ä»¥å†…ï¼Œè€Œ Docker é•œåƒçš„å¤§å°å¯ä»¥è¾¾åˆ° 100 æˆ– 200 MBã€‚\n\n**æ›´é«˜çš„å¯ç§»æ¤æ€§**\n\nWebAssembly åº”ç”¨æ˜¯ä¸€ä¸ªæ¶æ„ä¸­ç«‹çš„æ ¼å¼ï¼Œåªè¦æœ‰ç›¸åº”çš„è¿è¡Œæ—¶ï¼Œå°±å¯ä»¥åœ¨ä»»ä½•åº•å±‚æ¶æ„ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦è€ƒè™‘ä¸åŒæ¶æ„ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ã€‚Docker å®¹å™¨éœ€è¦é’ˆå¯¹ä¸åŒçš„æ¶æ„æ„å»ºä¸åŒçš„é•œåƒï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€äº›æ½œåœ¨çš„å®‰å…¨é£é™©æˆ–æ¼æ´ã€‚\n\n**æ›´å¥½çš„å®‰å…¨æ€§å’Œéš”ç¦»æ€§**\n\nWebAssembly åº”ç”¨å¯ä»¥æä¾›ä»£ç çº§åˆ«çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ¶æ„ä»£ç è®¿é—®ç³»ç»Ÿèµ„æºï¼Œå…·ä½“æ¥è¯´ï¼š\n\n- WebAssembly åº”ç”¨æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç®±ç¯å¢ƒä¸­çš„äºŒè¿›åˆ¶å­—èŠ‚ç ï¼Œä¸éœ€è¦è®¿é—®ä¸»æœºç³»ç»Ÿçš„èµ„æºï¼Œä¹Ÿä¸ä¼šå—åˆ°ä¸»æœºç³»ç»Ÿçš„å½±å“ã€‚Docker å®¹å™¨è™½ç„¶ä¹Ÿæ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒä¸­ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦åœ¨ä¸»æœºç³»ç»Ÿä¸Šè¿è¡Œï¼Œå¯èƒ½ä¼šå—åˆ°ä¸»æœºç³»ç»Ÿçš„æ”»å‡»æˆ–å¹²æ‰°ã€‚\n- WebAssembly åº”ç”¨æ˜¯é€šè¿‡ WebAssembly System Interface (WASI) æ¥ä¸å¤–éƒ¨äº¤äº’çš„ï¼ŒWASI æ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„ API é›†åˆï¼Œå¯ä»¥æä¾›ä¸€äº›åŸºæœ¬çš„ç³»ç»ŸåŠŸèƒ½ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œã€ç½‘ç»œè®¿é—®ã€ç¯å¢ƒå˜é‡ç­‰ã€‚WASI å¯ä»¥é™åˆ¶ WebAssembly åº”ç”¨çš„æƒé™å’Œèƒ½åŠ›ï¼Œé˜²æ­¢å®ƒä»¬åšä¸€äº›å±é™©çš„æ“ä½œã€‚Docker å®¹å™¨è™½ç„¶ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ä¸€äº›å®‰å…¨é€‰é¡¹æ¥é™åˆ¶å®¹å™¨çš„æƒé™å’Œèƒ½åŠ›ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ä¾èµ–ä¸»æœºç³»ç»Ÿæä¾›çš„åŠŸèƒ½å’ŒæœåŠ¡ã€‚\n- WebAssembly åº”ç”¨æ˜¯ä¸€ä¸ªæ¶æ„ä¸­ç«‹çš„æ ¼å¼ï¼Œåªè¦æœ‰ç›¸åº”çš„è¿è¡Œæ—¶ï¼Œå°±å¯ä»¥åœ¨ä»»ä½•åº•å±‚æ¶æ„ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦è€ƒè™‘ä¸åŒæ¶æ„ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ã€‚Docker å®¹å™¨éœ€è¦é’ˆå¯¹ä¸åŒçš„æ¶æ„æ„å»ºä¸åŒçš„é•œåƒï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€äº›æ½œåœ¨çš„å®‰å…¨é£é™©æˆ–æ¼æ´ã€‚\n\nå› ä¸ºæœ‰ä»¥ä¸Šä¼˜åŠ¿ï¼ŒWebAssembly åœ¨ä¸€äº›åœºæ™¯ä¸‹æ¯” Docker å®¹å™¨æ›´æœ‰ä¼˜åŠ¿ï¼Œä¾‹å¦‚è¾¹ç¼˜è®¡ç®—ã€äº‘åŸç”Ÿåº”ç”¨å’Œå¾®æœåŠ¡ã€‚å½“ç„¶ï¼ŒWebAssembly åº”ç”¨ä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼Œæ¯”å¦‚ä¸æ”¯æŒå¤šçº¿ç¨‹ã€åƒåœ¾å›æ”¶å’ŒäºŒè¿›åˆ¶æ‰“åŒ…ç­‰ã€‚å› æ­¤ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚åˆä½¿ç”¨ WebAssembly åº”ç”¨ã€‚ä½ å¯ä»¥æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚å’Œåå¥½æ¥é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆã€‚\n\n## å¦‚ä½•åœ¨ Docker ä¸­è¿è¡Œ WebAssembly åº”ç”¨ï¼Ÿ{#how-to-run-wasm-with-docker}\n\nåœ¨ Docker ä¸­è¿è¡Œ WebAssembly åº”ç”¨çš„æ–¹å¼ä¸æ™®é€šçš„ Linux é•œåƒæ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œåªæ˜¯åœ¨è¿è¡Œæ—¶éœ€è¦æŒ‡å®šä¸‹å¹³å°å’Œè¿è¡Œæ—¶ã€‚ä¸‹é¢çš„ä¾‹å­æ¥è‡ª [Docker å®˜æ–¹æ–‡æ¡£](https:\/\/docs.docker.com\/desktop\/wasm\/)ï¼Œä»¥åœ¨ Docker Desktop ä¸­ä¸ºä¾‹è¿è¡Œ WebAssembly åº”ç”¨ï¼š\n\n\u0060\u0060\u0060bash\ndocker run -dp 8080:8080 --name=wasm-example --runtime=io.containerd.wasmedge.v1 --platform=wasi\/wasm32 michaelirwin244\/wasm-example\n\u0060\u0060\u0060\n\nå…¶ä¸­ï¼š\n\n- \u0060--runtime=io.containerd.wasmedge.v1\u0060 æŒ‡å®šä½¿ç”¨ WasmEdge è¿è¡Œæ—¶ï¼Œæ›¿ä»£é»˜è®¤çš„ Linux å®¹å™¨è¿è¡Œæ—¶ã€‚\n- \u0060--platform=wasi\/wasm32\u0060 æŒ‡å®šé•œåƒçš„æ¶æ„ã€‚é€šè¿‡åˆ©ç”¨ Wasm æ¶æ„ï¼Œæ— éœ€ä¸ºä¸åŒçš„æœºå™¨æ¶æ„æ„å»ºå•ç‹¬çš„é•œåƒã€‚Wasm è¿è¡Œæ—¶è´Ÿè´£å°† Wasm äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨æŒ‡ä»¤çš„æœ€åä¸€æ­¥ã€‚\n\nç›®å‰ Docker æ”¯æŒå››ç§ WebAssembly è¿è¡Œæ—¶ï¼Œåˆ†åˆ«ä¸ºï¼š\n\n| è¿è¡Œæ—¶åç§° | API åç§° | å¼€å‘è€… | åŸºé‡‘ä¼šæ‰˜ç®¡ |\n| --- | --- | --- | --- |\n| [spin](https:\/\/github.com\/fermyon\/spin) | \u0060io.containerd.spin.v1\u0060 | Fermyon | æ—  |\n| [SpiderLightning](https:\/\/github.com\/deislabs\/spiderlightning) | \u0060io.containerd.slight.v1\u0060 | DeisLabs | æ—  |\n| [WasmEdge](https:\/\/github.com\/WasmEdge\/WasmEdge) | \u0060io.containerd.wasmedge.v1\u0060 | SecondState | CNCF æ²™ç®±é¡¹ç›® |\n| [Wasmtime](https:\/\/github.com\/bytecodealliance\/wasmtime) | \u0060io.containerd.wasmtime.v1\u0060 | Mozillaã€Fastlyã€Intelã€Red Hat ç­‰å…¬å¸ | å­—èŠ‚ç è”ç›Ÿé¡¹ç›® |\n\nåœ¨å‘½ä»¤è¡Œç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ WebAssembly åº”ç”¨çš„è¿è¡Œæƒ…å†µï¼š\n\n\u0060\u0060\u0060bash\ncurl http:\/\/localhost:8080\/\n\u0060\u0060\u0060\n\nä½ å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n\n\u0060\u0060\u0060bash\nHello world from Rust running with Wasm! Send POST data to \/echo to have it echoed back to you\n\u0060\u0060\u0060\n\nä½ è¿˜å¯ä»¥å‘\u0060\/echo\u0060ç«¯ç‚¹å‘é€ POST æµ‹è¯•è¯·æ±‚ï¼š\n\n\u0060\u0060\u0060bash\ncurl localhost:8080\/echo -d \u0027{\u0022message\u0022:\u0022Hello\u0022}\u0027 -H \u0022Content-type: application\/json\u0022\n\u0060\u0060\u0060\n\nä½ å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n\n\u0060\u0060\u0060json\n{\u0022message\u0022:\u0022hello\u0022}\n\u0060\u0060\u0060\n\n## æ€»ç»“ {#summary}\n\næœ¬æ–‡ä»‹ç»äº† Docker ä¸ºä»€ä¹ˆè¦å¢åŠ å¯¹ WebAssembly çš„æ”¯æŒï¼Œä»¥åŠåœ¨ Docker ä¸­è¿è¡Œ WebAssembly åº”ç”¨çš„ä¼˜åŠ¿å’Œæ–¹æ³•ã€‚WebAssembly åº”ç”¨ç›¸å¯¹äº Linux é•œåƒæœ‰æ›´é«˜çš„æ€§èƒ½ã€å¯ç§»æ¤æ€§å’Œå®‰å…¨æ€§ï¼Œé€‚ç”¨äºè¾¹ç¼˜è®¡ç®—ã€äº‘åŸç”Ÿåº”ç”¨å’Œå¾®æœåŠ¡ç­‰åœºæ™¯ã€‚Docker æ”¯æŒå››ç§ WebAssembly è¿è¡Œæ—¶ï¼Œåˆ†åˆ«ä¸º spinã€spiderlightningã€WasmEdge å’Œ wasmtimeã€‚åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘å°†ä»‹ç»å¦‚ä½•å¼€å‘ä¸€ä¸ª WebAssembly åº”ç”¨ï¼Œæ•¬è¯·æœŸå¾…ã€‚\n\n## å‚è€ƒ {#reference}\n\n- [Announcing Docker Hub OCI Artifacts Support](https:\/\/www.docker.com\/blog\/announcing-docker-hub-oci-artifacts-support\/)\n- [Dockerï¼Œcontainerdï¼ŒCRIï¼ŒCRI-Oï¼ŒOCIï¼Œrunc åˆ†ä¸æ¸…ï¼Ÿçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†](https:\/\/zhuanlan.zhihu.com\/p\/490585683)\n- [Build, Share, and Run WebAssembly Apps Using Docker](https:\/\/www.docker.com\/blog\/build-share-run-webassembly-apps-docker\/)\n- [Why Containers and WebAssembly Work Well Together](https:\/\/www.docker.com\/blog\/why-containers-and-webassembly-work-well-together\/)\n- [Docker \u002b WebAssembly: a quick intro](https:\/\/medium.com\/@guglielmino\/docker-webassembly-a-quick-intro-730c38e8390c)\n', '\/blog\/why-docker-support-wasm\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»äº† Docker ä¸ºä»€ä¹ˆè¦å¢åŠ å¯¹ WebAssembly çš„æ”¯æŒï¼Œä»¥åŠåœ¨ Docker ä¸­è¿è¡Œ WebAssembly åº”ç”¨çš„ä¼˜åŠ¿å’Œæ–¹æ³•ã€‚WebAssembly åº”ç”¨ç›¸å¯¹äº Linux é•œåƒæœ‰æ›´é«˜çš„æ€§èƒ½ã€å¯ç§»æ¤æ€§å’Œå®‰å…¨æ€§ï¼Œé€‚ç”¨äºè¾¹ç¼˜è®¡ç®—ã€äº‘åŸç”Ÿåº”ç”¨å’Œå¾®æœåŠ¡ç­‰åœºæ™¯ã€‚Docker æ”¯æŒå››ç§ WebAssembly è¿è¡Œæ—¶ï¼Œåˆ†åˆ«ä¸º spinã€spiderlightningã€WasmEdge å’Œ wasmtimeã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/docker-four-milestones/">Docker å‘å±•å²ï¼šå››ä¸ªé‡å¤§ä¸¾æªï¼Œå½±å“æ·±è¿œï¼</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/04/06</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/%e5%85%b6%e4%bb%96"> 
             å…¶ä»–
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Docker å‘å±•å²ï¼šå››ä¸ªé‡å¤§ä¸¾æªï¼Œå½±å“æ·±è¿œï¼', 'åœ¨ 2017 å¹´çš„å®¹å™¨ç¼–æ’å¤§æˆ˜ä¸­ï¼ŒDocker å…¬å¸å¤±è´¥åæ²‰å¯‚äº†å‡ å¹´ï¼Œä½†è¿‘å¹´æ¥åˆå¼€å§‹é¢‘ç¹è¡ŒåŠ¨ï¼Œä¾‹å¦‚è…¾é€€å¼€æºç»„ç»‡è´¦å·ï¼Œæ”¯æŒ WebAssembly ç­‰ã€‚æœ¬æ–‡å°†å›é¡¾ Docker å…¬å¸å‘å±•è¿‡ç¨‹ä¸­çš„å››ä¸ªé‡å¤§ä¸¾æªï¼Œè¿™äº›æªæ–½æ·±æ·±åœ°å½±å“äº† Docker å…¬å¸çš„å‘å±•ï¼Œä¹Ÿå¯¹ Docker ç”šè‡³ Kubernetes ç¤¾åŒºäº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚', '\nåœ¨ 2017 å¹´çš„å®¹å™¨ç¼–æ’å¤§æˆ˜ä¸­ï¼ŒDocker å…¬å¸å¤±è´¥åæ²‰å¯‚äº†å‡ å¹´ï¼Œä½†è¿‘å¹´æ¥åˆå¼€å§‹é¢‘ç¹è¡ŒåŠ¨ï¼Œä¾‹å¦‚è…¾é€€å¼€æºç»„ç»‡è´¦å·ï¼Œæ”¯æŒ WebAssembly ç­‰ã€‚æœ¬æ–‡å°†å›é¡¾ Docker å…¬å¸å‘å±•è¿‡ç¨‹ä¸­çš„å››ä¸ªé‡å¤§ä¸¾æªï¼Œè¿™äº›æªæ–½æ·±æ·±åœ°å½±å“äº† Docker å…¬å¸çš„å‘å±•ï¼Œä¹Ÿå¯¹ Docker ç”šè‡³ Kubernetes ç¤¾åŒºäº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚\n\n## å½“æˆ‘ä»¬åœ¨è°ˆè®º Docker æ—¶æˆ‘ä»¬åœ¨è°ˆè®ºä»€ä¹ˆï¼Ÿ{#what-are-we-talking-about-docker}\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆç¡®å®š Docker è¿™ä¸ªè¯çš„å«ä¹‰ã€‚å½“äººä»¬åœ¨è°ˆè®º Docker æ—¶å¯èƒ½æŒ‡çš„æ˜¯ï¼š\n\n1. Docker å…¬å¸\n2. Docker è½¯ä»¶æ ˆ\n3. Docker å‘½ä»¤è¡Œå·¥å…·\n4. Docker å®¹å™¨è¿è¡Œæ—¶\n\nä¸ºä»€ä¹ˆåŒä¸€ä¸ªè¯ä¼šæœ‰è¿™ä¹ˆå¤šä¸åŒçš„æ„æ€å‘¢ï¼Ÿè¿™éƒ½æ˜¯æœ‰å†å²åŸå› çš„ã€‚Docker è½¯ä»¶äº 2013 å¹´å‘å¸ƒï¼Œèµ·åˆå®šä½ä¸ºå¼€å‘è€…å·¥å…·ã€‚ä½œä¸ºæœ€æ—©å‘å¸ƒçš„å®¹å™¨å·¥å…·ï¼Œå®ƒè¿…é€Ÿèµ°çº¢ï¼Œå¹¶æˆä¸ºå®¹å™¨æŠ€æœ¯çš„ä»£åè¯ã€‚ä½†å®ƒæœ€åˆåªæ˜¯åœ¨å•æœºä¸Šè¿è¡Œï¼Œæœ‰å¤ªå¤šè€¦åˆçš„æ¥å£è®¾è®¡ã€‚åæ¥å®¹å™¨é›†ç¾¤å‡ºç°ï¼Œæ‰éœ€è¦ç”¨åˆ°å®¹å™¨ç¼–æ’è°ƒåº¦å·¥å…·ã€‚å› ä¸º Kubernetes å…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½å’Œæ‰©å±•æ€§ï¼ŒDocker å…¬å¸æ¨å‡ºçš„ Swarm åœ¨è¿™åœºå®¹å™¨ç¼–æ’å¤§æˆ˜ä¸­è´¥ä¸‹é˜µæ¥ã€‚å½’æ ¹ç»“åº•ï¼ŒDocker é¢å‘å¼€å‘è€…ï¼Œè€Œå®¹å™¨è¿è¡Œæ—¶åˆ™é¢å‘æœºå™¨ï¼Œåªéœ€è¦å¯¹åº”çš„æ¥å£å³å¯ï¼Œä¸éœ€è¦é‚£ä¹ˆä¸°å¯Œçš„ç®¡ç†å·¥å…·ã€‚å¦‚ä»Šï¼ŒDocker ä»ç„¶æ˜¯æœ€å—å¼€å‘è€…å–œçˆ±çš„å®¹å™¨å·¥å…·ä¹‹ä¸€ï¼Œå…¶ Docker Hub æ˜¯å…¨çƒæœ€å¤§çš„é•œåƒä»“åº“ã€‚\n\n## å°† Docker é¡¹ç›®æ”¹åä¸º Moby {#rename-docker-to-moby}\n\n2017 å¹´ 4 æœˆï¼ŒDocker å…¬å¸å°† Docker é¡¹ç›®é‡å‘½åä¸º Mobyï¼Œè¯¦è§ [Introducing Moby Project: a new open-source project to advance the software containerization movement](https:\/\/www.docker.com\/blog\/introducing-the-moby-project\/)ï¼š\n\n- [Moby Project](https:\/\/github.com\/moby\/moby) æ˜¯ Docker å…¬å¸ä¸ºäº†åº”å¯¹å®¹å™¨æŠ€æœ¯åœ¨å„ä¸ªé¢†åŸŸå’Œç”¨ä¾‹ä¸­æ™®åŠçš„è¶‹åŠ¿è€Œå‘èµ·çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ã€‚\n- Moby Project æ˜¯ Docker å…¬å¸ä½œä¸ºä¸€ä¸ªå¼€æ”¾çš„ç ”å‘å®éªŒå®¤ï¼Œä¸æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿåˆä½œï¼Œå®éªŒï¼Œå¼€å‘æ–°çš„ç»„ä»¶ï¼Œå¹¶åä½œæ„å»ºå®¹å™¨æŠ€æœ¯çš„æœªæ¥ã€‚\n- Moby Project ä¸æ˜¯ Docker äº§å“çš„æ›¿ä»£å“ï¼Œè€Œæ˜¯ Docker äº§å“çš„åŸºç¡€ã€‚\n- Moby Project åŒ…æ‹¬ä¸‰ä¸ªå±‚æ¬¡ï¼šç»„ä»¶å±‚ï¼Œæ¡†æ¶å±‚å’Œè£…é…å±‚ã€‚\n    - ç»„ä»¶å±‚åŒ…æ‹¬ä¸€äº›å¯å¤ç”¨çš„å¼€æºç»„ä»¶ï¼Œå¦‚ runc, containerd, LinuxKit, InfraKit ç­‰ï¼Œå¯ä»¥ç”¨äºæ„å»ºå„ç§ç±»å‹çš„å®¹å™¨ç³»ç»Ÿã€‚\n    - æ¡†æ¶å±‚æä¾›äº†ä¸€äº›å·¥å…·å’Œåº“ï¼Œç”¨äºå°†ç»„ä»¶ç»„è£…æˆç³»ç»Ÿï¼Œå¹¶ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚\n    - è£…é…å±‚æ˜¯ä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„å¹³å°ï¼Œç”¨äºåˆ†äº«å’Œåä½œæ„å»ºåŸºäº Moby æ¡†æ¶çš„ç³»ç»Ÿã€‚\n\nMoby Project æ˜¯ä¸€ä¸ªæ–°çš„å¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨æ¨åŠ¨è½¯ä»¶å®¹å™¨åŒ–è¿åŠ¨çš„å‘å±•ï¼Œå¸®åŠ©ç”Ÿæ€ç³»ç»Ÿè®©å®¹å™¨æŠ€æœ¯èµ°å‘ä¸»æµã€‚å®ƒæä¾›äº†ä¸€ä¸ªç»„ä»¶åº“ï¼Œä¸€ä¸ªç”¨äºå°†ç»„ä»¶ç»„è£…æˆå®šåˆ¶çš„åŸºäºå®¹å™¨çš„ç³»ç»Ÿçš„æ¡†æ¶ï¼Œä»¥åŠä¸€ä¸ªè®©æ‰€æœ‰å®¹å™¨çˆ±å¥½è€…å¯ä»¥å®éªŒå’Œäº¤æµæƒ³æ³•çš„åœ°æ–¹ã€‚\n\nMoby Project å’Œ Docker çš„åŒºåˆ«å’Œè”ç³»æ˜¯ï¼š\n\n- Moby Project æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ŒDocker æ˜¯ä¸€ä¸ªå•†ä¸šäº§å“ã€‚\n- Moby Project æ˜¯ Docker äº§å“çš„åŸºç¡€ï¼ŒDocker äº§å“æ˜¯ Moby Project çš„ä¸€ä¸ªå®ä¾‹ã€‚\n- Moby Project æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¡†æ¶ï¼Œå¯ä»¥ç”¨äºæ„å»ºå„ç§ç±»å‹å’Œç”¨ä¾‹çš„å®¹å™¨ç³»ç»Ÿï¼ŒDocker æ˜¯ä¸€ä¸ªé’ˆå¯¹ç‰¹å®šç”¨ä¾‹çš„å®¹å™¨ç³»ç»Ÿï¼Œå³æ„å»ºï¼Œè¿è¡Œå’Œå…±äº«åº”ç”¨ç¨‹åºã€‚\n- Moby Project æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç ”å‘å®éªŒå®¤ï¼Œç”¨äºå®éªŒå’Œåä½œå¼€å‘æ–°çš„å®¹å™¨æŠ€æœ¯ï¼ŒDocker æ˜¯ä¸€ä¸ªæˆç†Ÿçš„äº§å“ï¼Œç”¨äºæä¾›ç¨³å®šå’Œå¯é çš„å®¹å™¨æœåŠ¡ã€‚\n\n## æ”¯æŒ Kubernetes è°ƒåº¦ {#support-kubernetes}\n\nDocker å…¬å¸åœ¨ 2017 å¹´ 12 æœˆå‘å¸ƒçš„ Docker 17.12 ç‰ˆæœ¬ä¸­å¼€å§‹æ”¯æŒ Kubernetesã€‚åœ¨æ­¤ä¹‹å‰ï¼ŒDocker å…¬å¸ä¸€ç›´åœ¨å‘å±•è‡ªå·±çš„å®¹å™¨ç¼–æ’å’Œè°ƒåº¦å·¥å…· Docker Swarmã€‚ç„¶è€Œï¼ŒKubernetes åœ¨å®¹å™¨ç¼–æ’å’Œè°ƒåº¦æ–¹é¢å…·æœ‰æ›´å¹¿æ³›çš„æ”¯æŒå’Œç¤¾åŒºè´¡çŒ®ï¼Œå·²ç»æˆä¸ºäº†ä¸šç•Œæ ‡å‡†ã€‚å› æ­¤ï¼ŒDocker å…¬å¸å†³å®šå°† Kubernetes é›†æˆåˆ° Docker å¹³å°ä¸­ï¼Œä»¥æä¾›æ›´å¹¿æ³›çš„é€‰æ‹©å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚Docker å…¬å¸åœ¨ Docker Desktop å’Œ Docker Enterprise ä¸­æä¾›äº† Kubernetes çš„é›†æˆæ”¯æŒï¼Œä½¿å¾— Kubernetes å’Œ Docker å®¹å™¨å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°éƒ¨ç½²å’Œç®¡ç†ã€‚åŒæ—¶ï¼ŒDocker å…¬å¸ä¹Ÿå¼€å‘äº†ä¸€äº›å·¥å…·ï¼Œå¦‚ Kompose å’Œ Docker Composeï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å°† Docker Compose é…ç½®æ–‡ä»¶è½¬æ¢ä¸º Kubernetes YAML æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´åŠ æ–¹ä¾¿åœ°å°†åº”ç”¨ç¨‹åºä» Docker Swarm è¿ç§»åˆ° Kubernetesã€‚\n\n## Kubernetes ä¸å†æ”¯æŒ Docker è¿è¡Œæ—¶ {#kubernetes-not-support-docker}\n\nKubernetes ä» v1.20 èµ·ä¸å†æ”¯æŒ Docker è¿è¡Œæ—¶å¹¶åœ¨ 2022 å¹´ 4 æœˆå‘å¸ƒçš„ v1.24 ä¸­è¢«å®Œå…¨ç§»é™¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™æ„å‘³ç€åœ¨ Kubernetes ä¸­åªèƒ½ä½¿ç”¨ containerd æˆ– CRI-O å®¹å™¨è¿è¡Œæ—¶ï¼Œä¸è¿‡ä½ ä¾ç„¶å¯ä»¥ä½¿ç”¨ Docker é•œåƒï¼Œåªæ˜¯æ— éœ€ä½¿ç”¨ docker å‘½ä»¤æˆ– Docker å®ˆæŠ¤ç¨‹åºã€‚\n\n![Kubernetes v1.24 æ­£å¼ç§»é™¤ Docker è¿è¡Œæ—¶](cri.svg)\n\nKubernetes v1.24 æ­£å¼ç§»é™¤ Docker è¿è¡Œæ—¶\n\n## è…¾é€€å¼€æºç»„ç»‡è´¦å· {#deprecate-open-source-organization}\n\n2023 å¹´ 3 æœˆï¼Œæ® [Alex Ellis çš„åšå®¢](https:\/\/blog.alexellis.io\/docker-is-deleting-open-source-images\/) ä»‹ç»ï¼ŒDocker å…¬å¸å†³å®šåˆ é™¤ä¸€äº›å¼€æºç»„ç»‡çš„è´¦æˆ·å’Œé•œåƒï¼Œé™¤éä»–ä»¬å‡çº§åˆ°ä»˜è´¹çš„å›¢é˜Ÿè®¡åˆ’ï¼Œè¿™å¯¹å¼€æºç¤¾åŒºé€ æˆäº†å¾ˆå¤§çš„å›°æ‰°å’Œä¸å®‰ã€‚å¾ˆå¤š Docker å¿ å®æ‹¥æŠ¤è€…å’Œè´¡çŒ®è€…å¯¹ Docker çš„è¿™ä¸€ä¸¾åŠ¨è¡¨ç¤ºäº†ä¸æ»¡å’Œå¤±æœ›ã€‚\n\nè¿™ä¸€äº‹ä»¶æ˜¯è¿™æ ·çš„ï¼š\n\n- Docker å…¬å¸ç»™æ‰€æœ‰åˆ›å»ºè¿‡ç»„ç»‡çš„ Docker Hub ç”¨æˆ·å‘äº†ä¸€å°é‚®ä»¶ï¼Œå‘ŠçŸ¥ä»–ä»¬å¦‚æœä¸å‡çº§åˆ°ä»˜è´¹çš„å›¢é˜Ÿè®¡åˆ’ï¼Œä»–ä»¬çš„è´¦æˆ·å’Œé•œåƒéƒ½å°†è¢«åˆ é™¤ã€‚\n- è¿™ä¸€ä¸¾åŠ¨åªå½±å“å¼€æºç¤¾åŒºç»å¸¸ä½¿ç”¨çš„ç»„ç»‡è´¦æˆ·ï¼Œä¸ªäººè´¦æˆ·æ²¡æœ‰å˜åŒ–ã€‚\n- ä»˜è´¹çš„å›¢é˜Ÿè®¡åˆ’æ¯å¹´éœ€è¦ 420 ç¾å…ƒï¼Œå¾ˆå¤šå¼€æºé¡¹ç›®æ²¡æœ‰è¶³å¤Ÿçš„èµ„é‡‘æ”¯æŒã€‚\n- Docker å…¬å¸çš„å¼€æºé¡¹ç›®è®¡åˆ’ï¼ˆDSOSï¼‰è¦æ±‚éå¸¸è‹›åˆ»ï¼Œä¸å¼€æºé¡¹ç›®çš„å¯æŒç»­æ€§ç›¸æ‚–ã€‚\n- Docker å…¬å¸çš„æ²Ÿé€šæ–¹å¼éå¸¸è„±èŠ‚ï¼Œå¼•èµ·äº†å¼€æºç¤¾åŒºçš„åæ„Ÿå’Œæ‹…å¿§ã€‚\n- æ–‡ç« ä½œè€…å»ºè®®å¼€æºé¡¹ç›®ä½¿ç”¨å…¶ä»–çš„å®¹å™¨é•œåƒä»“åº“ï¼Œå¦‚ GitHub Container Registryã€[Quay.io](http:\/\/quay.io\/)ã€å„å¤§äº‘å‚å•†çš„é•œåƒä»“åº“ç­‰ã€‚\n- å¼€æºç¤¾åŒºè¿˜æä¾›äº†ä¸€äº›è¿ç§»é•œåƒå’Œé‡å‘½åé•œåƒçš„æ–¹æ³•å’Œå·¥å…·ã€‚\n\n## å¢åŠ å¯¹ WebAssembly è¿è¡Œæ—¶çš„æ”¯æŒ {#support-webassembly-runtime}\n\n2022 å¹´ 10 æœˆï¼ŒDocker å…¬å¸å‘å¸ƒäº† Docker\u002bWasm æŠ€æœ¯é¢„è§ˆï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ„å»ºï¼Œå¯ä»¥è®©å¼€å‘è€…æ›´å®¹æ˜“åœ°ä½¿ç”¨ Docker è¿è¡Œ Wasm å·¥ä½œè´Ÿè½½ã€‚ä½œä¸ºè¿™æ¬¡å‘å¸ƒçš„ä¸€éƒ¨åˆ†ï¼ŒDocker è¿˜å®£å¸ƒå°†åŠ å…¥ Bytecode Alliance ä½œä¸ºä¸€ä¸ªæŠ•ç¥¨æˆå‘˜ã€‚\n\nWasm æ˜¯ä¸€ç§æ–°æŠ€æœ¯ï¼Œå¯è®©ä½ åœ¨æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œ 40 å¤šç§è¯­è¨€çš„åº”ç”¨ç¨‹åºä»£ç ï¼ŒåŒ…æ‹¬ Rustï¼ŒCï¼ŒC\u002b\u002bï¼ŒJavaScript å’Œ Golangã€‚æœ€åˆï¼ŒWasm çš„ç”¨ä¾‹æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡Œæœ¬åœ°ä»£ç ï¼Œå¦‚ Figmaï¼ŒAutoCAD å’Œ Photoshop ç­‰ã€‚ç°åœ¨ï¼Œä¸€äº›å…¬å¸å¦‚ Vercelï¼ŒFastlyï¼ŒShopify å’Œ Cloudflare ç­‰æ”¯æŒä½¿ç”¨ Wasm åœ¨è¾¹ç¼˜å’Œäº‘ç«¯è¿è¡Œä»£ç ã€‚\n\nDocker\u002bWasm æŠ€æœ¯é¢„è§ˆåŒ…æ‹¬ï¼š\n\n- Docker çš„ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…é€šè¿‡å…‹æœåº”ç”¨å¼€å‘çš„å¤æ‚æ€§æ¥å®ç°ä»–ä»¬çš„æƒ³æ³•ã€‚\n- Docker å°† Wasm è§†ä¸ºä¸ Linux å®¹å™¨ç›¸è¾…ç›¸æˆçš„æŠ€æœ¯ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ç”¨ä¾‹é€‰æ‹©ä½¿ç”¨å“ªç§æŠ€æœ¯ï¼ˆæˆ–ä¸¤è€…éƒ½ç”¨ï¼‰ã€‚\n- Docker æƒ³è¦å¸®åŠ©å¼€å‘è€…æ›´å®¹æ˜“åœ°ä½¿ç”¨ç†Ÿæ‚‰çš„ç»éªŒå’Œå·¥å…·æ¥å¼€å‘ï¼Œæ„å»ºå’Œè¿è¡Œ Wasm åº”ç”¨ã€‚\n- è¦è·å–æŠ€æœ¯é¢„è§ˆï¼Œéœ€è¦ä¸‹è½½å¹¶å®‰è£…é€‚åˆä½ ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œç„¶åå¯ç”¨ containerd é•œåƒå­˜å‚¨ï¼ˆè®¾ç½® \u003e å¼€å‘ä¸­çš„åŠŸèƒ½ \u003e ä½¿ç”¨ containerd æ‹‰å–å’Œå­˜å‚¨é•œåƒï¼‰ã€‚\n- è¿™ä¸ªé¢„è§ˆæ”¯æŒä½¿ç”¨ WasmEdge è¿è¡Œæ—¶å¼•æ“è¿è¡Œ Wasm å®¹å™¨ï¼Œå¹¶å¯ä»¥é€šè¿‡å®¹å™¨ä»“åº“å¦‚ DockerHub ç­‰åˆ†äº«ã€‚\n\n2023 å¹´ 3 æœˆ Docker å…¬å¸åˆå‘å¸ƒäº† Docker\u002bWasm æŠ€æœ¯é¢„è§ˆ 2ï¼ŒåŒ…æ‹¬äº†ä¸‰ä¸ªæ–°çš„ Wasm è¿è¡Œæ—¶å¼•æ“ï¼šFermyon çš„ spinï¼ŒDeislabs çš„ slightï¼Œå’Œ Bytecode Alliance çš„ wasmtimeã€‚\n\nè¯¥ç‰ˆæœ¬çš„ä¸»è¦æ›´æ–°æ˜¯ï¼š\n\n- Docker\u002bWasm æŠ€æœ¯é¢„è§ˆ 2 æ˜¯åœ¨ Docker Desktop 4.15 ç‰ˆæœ¬ä¸­å‘å¸ƒçš„ï¼Œæ—¨åœ¨è®©å¼€å‘è€…æ›´å®¹æ˜“åœ°è¿è¡Œ Wasm å·¥ä½œè´Ÿè½½ï¼Œå¹¶æ‰©å±•è¿è¡Œæ—¶æ”¯æŒã€‚\n- Docker\u002bWasm æŠ€æœ¯é¢„è§ˆ 2 æ”¯æŒå››ç§ Wasm è¿è¡Œæ—¶å¼•æ“ï¼ŒåŒ…æ‹¬ä¹‹å‰å·²ç»æ”¯æŒçš„ WasmEdgeï¼Œä»¥åŠæ–°å¢åŠ çš„ spinï¼Œslightï¼Œå’Œ wasmtimeã€‚\n- è¿™å››ç§ Wasm è¿è¡Œæ—¶å¼•æ“éƒ½åŸºäº runwasi åº“ï¼Œè¿™æ˜¯ä¸€ä¸ª Rust åº“ï¼Œå¯ä»¥è®©å®¹å™¨ç®¡ç†å™¨ containerd è¿è¡Œ Wasm å·¥ä½œè´Ÿè½½ï¼Œå¹¶åˆ›å»ºä¸€ç§æ–°çš„å®¹å™¨ç±»å‹ã€‚\n- runwasi åº“åŸºäº WASI æ ‡å‡†ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸º WebAssembly æä¾›é€šç”¨å¹³å°æ¥å£çš„æ¨¡å—åŒ–ç³»ç»Ÿæ¥å£ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªç¨‹åºç¼–è¯‘æˆç›®æ ‡æ˜¯ WASIï¼Œå®ƒå°±å¯ä»¥åœ¨ä»»ä½•ç¬¦åˆ WASI çš„è¿è¡Œæ—¶ä¸Šè¿è¡Œã€‚\n- Wasm å®¹å™¨é€šå¸¸åªåŒ…å«ä¸€ä¸ªç¼–è¯‘å¥½çš„ Wasm å­—èŠ‚ç æ–‡ä»¶ï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„äºŒè¿›åˆ¶åº“ï¼Œè¿™ä½¿å¾—å®ƒæ¯” Linux å®¹å™¨æ›´å°ã€‚è¿™ä¹Ÿæ„å‘³ç€ Wasm å®¹å™¨é€šå¸¸å¯åŠ¨æ›´å¿«ï¼Œæ›´å¯ç§»æ¤ã€‚\n- ç”±äº Wasm å®¹å™¨ç›´æ¥è¢« containerd æ”¯æŒï¼Œåœ¨ Docker Desktop æœ€æ–°ç‰ˆæœ¬ä¸­å°è¯• Docker\u002bWasm æŠ€æœ¯é¢„è§ˆ 2 åªéœ€è¦å¯ç”¨â€œä½¿ç”¨ containerdâ€é€‰é¡¹ã€‚\n- é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒWasm å®¹å™¨å¯ä»¥ä¸ Linux å®¹å™¨ä¸€èµ·ä½¿ç”¨ Docker Compose æˆ–å…¶ä»–ç¼–æ’å¹³å°å¦‚ Kubernetes è¿è¡Œã€‚\n- æ­¤å¤–ï¼ŒDocker Desktop è¿˜èƒ½å¤Ÿå°†ä¸€ä¸ª Wasm åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ª OCI å®¹å™¨ï¼Œå¹¶åœ¨å…¶ä¸­åµŒå…¥ä¸€ä¸ª Wasm è¿è¡Œæ—¶ï¼Œä»¥ä¾¿é€šè¿‡å®¹å™¨ä»“åº“å¦‚ DockerHub ç­‰åˆ†äº«ã€‚\n\n## æ€»ç»“ {#summary}\n\næœ¬æ–‡ä»‹ç»äº† Docker å‘å±•è¿‡ç¨‹ä¸­çš„å››ä¸ªé‡å¤§ä¸¾æªï¼šMoby Projectã€æ”¯æŒ Kubernetesã€åˆ é™¤å¼€æºç»„ç»‡è´¦å·å’Œå¢åŠ å¯¹ WebAssembly è¿è¡Œæ—¶çš„æ”¯æŒã€‚å…¶ä¸­ï¼ŒMoby Project æ—¨åœ¨æ¨åŠ¨å®¹å™¨æŠ€æœ¯èµ°å‘ä¸»æµï¼Œæ”¯æŒ Kubernetes çš„ä¸¾æªæä¾›äº†æ›´å¹¿æ³›çš„é€‰æ‹©å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåˆ é™¤å¼€æºç»„ç»‡è´¦å·çš„ä¸¾æªå¼•èµ·äº†å¼€æºç¤¾åŒºçš„ä¸æ»¡å’Œå¤±æœ›ï¼Œå¢åŠ å¯¹ WebAssembly è¿è¡Œæ—¶çš„æ”¯æŒçš„ä¸¾æªåˆ™æ‰©å±•äº† Docker çš„åº”ç”¨åœºæ™¯ã€‚\n\n## å‚è€ƒ {#reference}\n\n- [Introducing Moby Project: a new open-source project to advance the software containerization movement](https:\/\/www.docker.com\/blog\/introducing-the-moby-project\/)\n- [Docker for Windows Desktopâ€¦ Now With Kubernetes!](https:\/\/www.docker.com\/blog\/docker-windows-desktop-now-kubernetes\/)\n- [Introducing the Docker\u002bWasm Technical Preview](https:\/\/www.docker.com\/blog\/docker-wasm-technical-preview\/)\n- [Announcing Docker\u002bWasm Technical Preview 2](https:\/\/www.docker.com\/blog\/announcing-dockerwasm-technical-preview-2\/)\n- [Docker is deleting Open Source organisations - what you need to know](https:\/\/blog.alexellis.io\/docker-is-deleting-open-source-images\/)\n- [åˆ«æ…Œï¼šKubernetes å’Œ Docker](https:\/\/kubernetes.io\/zh-cn\/blog\/2020\/12\/02\/dont-panic-kubernetes-and-docker\/)\n', '\/blog\/docker-four-milestones\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">åœ¨ 2017 å¹´çš„å®¹å™¨ç¼–æ’å¤§æˆ˜ä¸­ï¼ŒDocker å…¬å¸å¤±è´¥åæ²‰å¯‚äº†å‡ å¹´ï¼Œä½†è¿‘å¹´æ¥åˆå¼€å§‹é¢‘ç¹è¡ŒåŠ¨ï¼Œä¾‹å¦‚è…¾é€€å¼€æºç»„ç»‡è´¦å·ï¼Œæ”¯æŒ WebAssembly ç­‰ã€‚æœ¬æ–‡å°†å›é¡¾ Docker å…¬å¸å‘å±•è¿‡ç¨‹ä¸­çš„å››ä¸ªé‡å¤§ä¸¾æªï¼Œè¿™äº›æªæ–½æ·±æ·±åœ°å½±å“äº† Docker å…¬å¸çš„å‘å±•ï¼Œä¹Ÿå¯¹ Docker ç”šè‡³ Kubernetes ç¤¾åŒºäº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
 <nav aria-label="Page navigation">
   <ul class="pagination justify-content-center">
     
     
     
     
     
     
       
       
       
         
       
       
       
         <li class="page-item page-item active ">
           <a href="/categories/%E5%85%B6%E4%BB%96/" class="page-link">
             1
           </a>
         </li>
       
     
       
       
       
         
       
       
       
         <li class="page-item">
           <a href="/categories/%E5%85%B6%E4%BB%96/page/2/" class="page-link">
             2
           </a>
         </li>
       
     
     
     
     <li class="page-item">
       <a href="/categories/%E5%85%B6%E4%BB%96/page/2/" class="page-link">
         Â»
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a class="page-link" href="/categories/%E5%85%B6%E4%BB%96/page/2/">
         Â»Â»
       </a>
     </li>
     
   </ul>
 </nav>
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      ä¸“æ 
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(77)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(42)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(25)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>éšç¬”</span>
            <span>(22)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>å…¶ä»–</span>
            <span>(19)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>ä¸šæ€</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>äº‘åŸç”Ÿ</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>å®‰å…¨</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>å¼€æº</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>æ—…è¡Œ</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>å¯è§‚æµ‹æ€§</span>
            <span>(5)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      èµ„æ–™
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>å‡ºç‰ˆç‰©</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>ç¿»è¯‘ç”µå­ä¹¦</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>ç¿»è¯‘æ–‡æ¡£</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>ç¿»è¯‘å›¾ä¹¦</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>åŸåˆ›å›¾ä¹¦</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>æ•™ç¨‹æ‰‹å†Œ</span>
            <span>(2)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">è”ç³»</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">å¾®ä¿¡å…¬ä¼—å·</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">åšå®¢</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-ambient-traffic-interception/">Istio Ambient æ¨¡å¼ä¸­çš„é€æ˜æµé‡æ‹¦æˆªè¿‡ç¨‹è¯¦è§£</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-ambient-inpod-iptables/">Istio Ambient æ¨¡å¼ä¸­çš„ Pod å†… iptable è§„åˆ™æ³¨å…¥è§£æ</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/cross-network-namespace-socket/">è·¨ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å¥—æ¥å­—ï¼šæ¢ç´¢ Linux å¥—æ¥å­—çš„ä½¿ç”¨</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">é“¾æ¥</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio æœåŠ¡ç½‘æ ¼
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate å…¬å¸
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿå­¦é™¢|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿå¼€æºé¡¹ç›®å¤§å…¨
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">æ•™ç¨‹</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy åŸºç¡€æ•™ç¨‹
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio åŸºç¡€æ•™ç¨‹
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes åŸºç¡€æ•™ç¨‹
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  ç®€æ˜ Envoy æ•™ç¨‹
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">é€šçŸ¥</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">èµ„æ–™åˆ†äº«ï¼šäº‘åŸç”Ÿåº”ç”¨æœåŠ¡ç½‘æ ¼ä»£ç†æ¨¡å‹çš„å¨èƒåˆ†ææŒ‡å—</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024ï¼ˆé¦™æ¸¯ï¼‰</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">ç½‘ç«™æ”¹ç‰ˆé€šçŸ¥</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">Â© 2017-2024 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />










<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
