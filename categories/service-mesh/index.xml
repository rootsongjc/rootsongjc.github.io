<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song - Cloud Native | Open Source | Community â€“ service mesh</title>
    <link>https://jimmysong.io/categories/service-mesh/</link>
    <description>Recent content in service mesh on Jimmy Song - Cloud Native | Open Source | Community</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <copyright>Copyright &amp;copy; 2020 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©ï¼›åŸºäº Hugo [educenter](https://github.com/themefisher/educenter-hugo)  ä¸»é¢˜æ„å»º</copyright>
    <lastBuildDate>Sat, 03 Aug 2019 15:24:37 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/categories/service-mesh/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Blog: äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istio å›¾ä¹¦</title>
      <link>https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/</link>
      <pubDate>Sat, 03 Aug 2019 15:24:37 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;https://item.jd.com/12538407.html&#34;&gt;ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æï¼ˆå¼ è¶…ç›Ÿã€ç« é‘«ã€å¾ä¸­è™ã€å¾é£ç¼–è‘—ï¼‰ã€‹&lt;/a&gt;æ˜¯ 2019 å¹´å›½å†…å‡ºç‰ˆçš„ç¬¬å››æœ¬ Istio ç›¸å…³å›¾ä¹¦ï¼Œå‰ä¸‰æœ¬åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://item.jd.com/12527008.html&#34;&gt;æ·±å…¥æµ…å‡ºIstioï¼šService Meshå¿«é€Ÿå…¥é—¨ä¸å®è·µï¼Œå´”ç§€é¾™ è‘—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://item.jd.com/12516473.html&#34;&gt;Service Meshå®æˆ˜ï¼šç”¨Istioè½¯è´Ÿè½½å®ç°æœåŠ¡ç½‘æ ¼ï¼Œå‘¨é¥ è‘—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://item.jd.com/12601120.html&#34;&gt;Istio å…¥é—¨ä¸å®æˆ˜ï¼Œæ¯›å¹¿çŒ® è‘—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™å››æœ¬ä¹¦åˆšä¸Šå¸‚æ—¶æˆ‘éƒ½è·å¾—äº†ä½œè€…çš„èµ ä¹¦ï¼Œè¿™æœ¬ä¹¦æ˜¯ç”±å››ä½åä¸ºçš„åŒå­¦ç¼–å†™ï¼Œäº 2019 å¹´  7 æœˆç¬¬ä¸€æ¬¡å°åˆ·ï¼Œå…¨ä¹¦å…± 24 ç« ï¼Œ606 é¡µï¼Œå”®ä»· 139 å…ƒã€‚æˆ‘æ˜¯åœ¨ KubeCon China 2019 çš„ä¸Šæµ·å¤§ä¼šç°åœºå¼ è¶…ç›Ÿäº²æ‰‹èµ ä¸æˆ‘çš„ï¼Œå¼ è¶…ç›Ÿä¹Ÿæ˜¯ 2018 å¹´&lt;a href=&#34;https://www.servicemesher.com/blog/service-mesh-meetup-shenzhen-20180825/&#34;&gt;ç¬¬ä¸‰å±Š Service Mesh Meetup&lt;/a&gt; çš„è®²å¸ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006tNc79ly1g60ml3q3i4j30xc0m8wg2.jpg&#34; alt=&#34;å³ä¾§æ˜¯äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼ˆåä¸ºäº‘åŸç”ŸæŠ€æœ¯ä¸›ä¹¦ï¼‰ä½œè€…ä¹‹ä¸€å¼ è¶…ç›Ÿ&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æœ¬ä¹¦ç»“æ„&#34;&gt;æœ¬ä¹¦ç»“æ„&lt;/h2&gt;
&lt;p&gt;å…¨ä¹¦å…±åˆ†å››ä¸ªç¯‡ç« ï¼Œ24 ä¸ªç« èŠ‚ï¼Œ606 é¡µï¼Œæ¯ä¸ªç« èŠ‚çš„é¡µæ•°å æ¯”ç»Ÿè®¡å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006tNc79ly1g5nsbm4pkej30u00uj0vw.jpg&#34; alt=&#34;äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹å›¾ä¹¦ç« èŠ‚é¡µæ•°å å…¨ä¹¦ç™¾åˆ†æ¯”-è¡¨æ ¼&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006tNc79ly1g60mjr3lirj30v20u0q5g.jpg&#34; alt=&#34;ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹å›¾ä¹¦ç« èŠ‚é¡µæ•°å å…¨ä¹¦ç™¾åˆ†æ¯”-é¥¼å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ç»Ÿè®¡ç»“æœä¸­å¯ä»¥çœ‹å‡ºä¹¦ä¸­ç¬¬ 3 ç« ï¼ˆéä¾µå…¥çš„æµé‡æ²»ç†ï¼‰ã€ç¬¬ 14 ç« ï¼ˆå¸ä»¤å®˜ Pilotï¼‰ä¸€å…±å å…¨ä¹¦çš„é¡µæ•°ç™¾åˆ†æ¯”ä¸º 24%ï¼Œå‡ ä¹å äº†å››åˆ†ä¹‹ä¸€çš„ç¯‡å¹…ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦æ˜¯ç›®å‰ï¼ˆ2019å¹´08æœˆ15æ—¥ï¼‰å¸‚é¢ä¸Šèƒ½ä¹°åˆ°çš„æœ€å…¨çš„ä¸€æœ¬ Istio ç›¸å…³çš„å›¾ä¹¦äº†ï¼Œè¯è¯´å›½å¤–è¿˜ä¸€æœ¬ Istio çš„ä¹¦ä¹Ÿå‡ºæ¥ï¼Œå›½å†…åˆ°ç°åœ¨éƒ½å‡ºäº†å››æœ¬äº†ï¼Œæ˜¯ä¸æ˜¯æœ‰ç§å¢™å¤–å¼€èŠ±å¢™å†…é¦™çš„æ„Ÿè§‰ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å»ºè®®å¤§å®¶ç»“åˆ &lt;a href=&#34;https://istio.io&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ä¸€èµ·æ¥çœ‹è¿™æœ¬ä¹¦ï¼ŒIstio ç‰ˆæœ¬æ›´æ–°è™½ç„¶æ²¡æœ‰ Kubernetes é‚£ä¹ˆå¿«ï¼Œä½†æ˜¯åœ¨æœ¬ä¹¦å‘è¡Œä¸€ä¸ªå¤šæœˆåä¹Ÿè¦å‘å¸ƒ 1.2 ç‰ˆæœ¬äº†ï¼Œæ¬¢è¿å¤§å®¶&lt;a href=&#34;https://www.servicemesher.com&#34;&gt;åŠ å…¥ ServiceMesher ç¤¾åŒº&lt;/a&gt;æ¥å­¦ä¹  Istioï¼&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: ã€ŠService Mesh å®æˆ˜â€”åŸºäº Linkerd å’Œ Kubernetes çš„å¾®æœåŠ¡å®è·µã€‹è¯»åæ„Ÿ</title>
      <link>https://jimmysong.io/blog/service-mesh-in-action-by-yangzhangxian-review/</link>
      <pubDate>Tue, 08 Jan 2019 20:50:44 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/service-mesh-in-action-by-yangzhangxian-review/</guid>
      <description>
        
        
        &lt;p&gt;æœ€è¿‘åœ¨å›é¡¾ Service Mesh æŠ€æœ¯åœ¨2018å¹´çš„å‘å±•ï¼Œæƒ³å†çœ‹çœ‹ Linkerdï¼Œæ­£å¥½&lt;strong&gt;æ¨å½°æ˜¾&lt;/strong&gt;çš„è¿™æœ¬ã€ŠService Mesh å®æˆ˜â€”â€”åŸºäº Linkerd å’Œ Kubernetes çš„å¾®æœåŠ¡å®è·µã€‹ä¸Šå¸‚å‘å”®äº†ï¼Œ&lt;strong&gt;æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/strong&gt;çš„ç¼–è¾‘é€äº†æˆ‘ä¸€æœ¬ï¼ŒğŸ™&lt;strong&gt;æ¨ç¦å·&lt;/strong&gt;ç¼–è¾‘ï¼Œæˆ‘çœ‹äº†ä¸‹æŠ½ç©ºå†™äº†ç‚¹è¯»åæ„Ÿï¼Œæˆ‘çœ‹äº†ä¸‹æŠ½ç©ºå†™äº†ç‚¹è¯»åæ„Ÿï¼Œå…¶å®ä¹Ÿè¯´ä¸ä¸Šæ˜¯è¯»åæ„Ÿï¼Œå°±å½“æ˜¯è‡ªå·±çš„ä¸€ç‚¹æ„Ÿæ‚Ÿå§ï¼Œå°±å½“æ‹¿æ­¤ä¹¦å€Ÿé¢˜å‘æŒ¥å§ï¼Œè¿™ä¸ªçŸ¥è¯†çˆ†ç‚¸çš„å¹´ä»£ï¼ŒæŠ€æœ¯å‘å±•å¦‚æ­¤è¿…é€Ÿï¼Œå¯ä»¥è¯´æ˜¯ IT äººå‘˜çš„å¹¸è¿ï¼Œä¹Ÿæ˜¯ä¸å¹¸ï¼æœ‰å¤šå°‘å†™å¼€æºè½¯ä»¶çš„ä¹¦æ¨å‡ºä¸€ç‰ˆåèƒ½æ’‘è¿‡ä¸‰å¹´çš„ï¼Ÿå¦‚æœè½¯ä»¶çº¢å¾—å‘ç´«ï¼ŒæŒç»­è¿­ä»£ N ä¸ªç‰ˆæœ¬ï¼Œä¾‹å¦‚ Kubernetesï¼Œæœ€è¿‘ä¸¤å¹´ä»¥æ¯ä¸‰ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬çš„é€Ÿåº¦è¿­ä»£ï¼Œä¹‹å‰çš„ä¹¦æ—©å°±è·Ÿä¸ä¸ŠèŠ‚å¥ï¼Œè¦ä¹ˆå°±è¦ä¸æ–­æ¨å‡ºæ–°ç‰ˆï¼Œç›´åˆ°è½¯ä»¶ç¨³å®šåä¸å†æœ‰å¤§çš„æ”¹åŠ¨ã€‚è¿˜æœ‰ç§å¯èƒ½å°±æ˜¯è½¯ä»¶æ¨å¹¿å’Œå‘å±•çš„ä¸ç†æƒ³ï¼Œæ— äººé—®æ´¥ï¼Œå†™è¿™æ ·è½¯ä»¶çš„ä¹¦å°±ä¸ä¼šæœ‰å†ç‰ˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ‹¿åˆ°æœ¬ä¹¦åæˆ‘çš„ç¬¬ä¸€ååº”å°±æ˜¯çœ‹çœ‹è¿™æœ¬ä¹¦å®šç¨¿çš„æ—¶å€™ Istio æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼ŒLinkerd åˆæ˜¯ä»€ä¹ˆç‰ˆæœ¬ã€‚å› ä¸ºåœ¨è¿™ä¸€å¹´å†…ä¸¤æ¬¾å¼€æºè½¯ä»¶éƒ½æœ‰è¾ƒå¤§çš„ç‰ˆæœ¬å˜åŠ¨ï¼Œå¦‚æœä¹¦ç±å®šç¨¿çš„æ—¶å€™åŸºäºçš„è½¯ä»¶ç‰ˆæœ¬å¤ªä½ï¼Œè½¯ä»¶æ¶æ„å¯èƒ½ä¼šæœ‰è¾ƒå¤§çš„å˜åŒ–ï¼Œå½±å“ä¹¦ä¸­ç¤ºä¾‹å’Œéƒ¨åˆ†ç« èŠ‚çš„æ—¶æ•ˆæ€§ã€‚è¿™ä¹Ÿæ˜¯å¤§å¤šæŠ€æœ¯ä¹¦ç±åçŸ­çš„ç—‡ç»“æ‰€åœ¨ï¼ŒæŠ€æœ¯å‘å±•æ˜¯åœ¨å¤ªå¿«ï¼Œä¼ ç»Ÿçš„ä¹¦ç±å‡ºç‰ˆæµç¨‹å¾€å¾€è¿‡äºç¹çå’Œå†—é•¿ï¼Œç­‰åˆ°ä¹¦ç±å‡ºç‰ˆåæ‰€ä»‹ç»çš„è½¯ä»¶éƒ½å‡ºäº†å¥½å‡ ä¸ªç‰ˆæœ¬ã€‚ä¾‹å¦‚ Kubernetes è¿™ç§çš„è½¯ä»¶ï¼Œæ¯ä¸‰ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ï¼Œè€Œå†™ä¸€èˆ¬ä¹¦ä»ç­–åˆ’åˆ°å‘è¡Œå°‘è¯´åŠå¹´ï¼Œä¸€èˆ¬ä¹Ÿè¦ä¸€å¹´çš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä¹¦ç±å®šç¨¿æ—¶çš„è½¯ä»¶ç‰ˆæœ¬&#34;&gt;å…³äºä¹¦ç±å®šç¨¿æ—¶çš„è½¯ä»¶ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Istio 0.8&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦ç¬¬ä¸€ç« ã€ŒService Mesh ç®€ä»‹ã€å¯¹ Service Mesh ç›¸å…³å¼€æºäº§å“ä»‹ç»æ—¶æåˆ°æœ¬ä¹¦å®šç¨¿æ—¶ Istio æ˜¯ 0.8 ç‰ˆæœ¬ï¼Œè€Œ Istio åœ¨ 2018å¹´7æœˆ31æ—¥å‘å¸ƒäº† &lt;a href=&#34;https://istio.io/zh/about/notes/1.0/&#34;&gt;1.0 ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦å®šç¨¿æ—¶ï¼ŒIstio çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 0.8ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Linkerd 1.3.6&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦ä»åºè¨€å¼€å§‹ä¸€ç›´åˆ°ç¬¬äºŒç« ç»“æŸä¹Ÿæ²¡æœ‰æåŠå†™ä½œæ—¶åŸºäºçš„ Linkerd ç‰ˆæœ¬ï¼Œæˆ‘åœ¨ç¬¬äºŒç« çš„å®‰è£…æ­¥éª¤ä¸­çœ‹åˆ°äº†è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æœ¬ä¹¦å†™ä½œæ—¶æ˜¯åŸºäº Linkerd 1.3.6 ç‰ˆæœ¬ï¼Œè€Œ Linkerd åœ¨åŒå¹´çš„ 9æœˆ18æ—¥å‘å¸ƒäº† &lt;a href=&#34;http://www.servicemesher.com/blog/linkerd-2-0-in-general-availability/&#34;&gt;2.0 GA&lt;/a&gt;ï¼Œè¿™ä¸€ç‰ˆæœ¬è·Ÿ 1.x ç‰ˆæœ¬ç›¸æ¯”æœ‰é‡å¤§å˜åŒ–â€”â€”å®ƒè¿˜å°†é¡¹ç›®ä»é›†ç¾¤èŒƒå›´çš„service meshè½¬æ¢ä¸ºå¯ç»„åˆçš„ &lt;em&gt;service sidecar&lt;/em&gt; ï¼Œæ—¨åœ¨ä¸ºå¼€å‘äººå‘˜å’ŒæœåŠ¡æ‰€æœ‰è€…æä¾›åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­æˆåŠŸæ‰€éœ€çš„å…³é”®å·¥å…·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;linkerd-vs-envoy&#34;&gt;Linkerd vs Envoy&lt;/h2&gt;
&lt;p&gt;Linkerd 2.0 çš„ service sidecar è®¾è®¡ä½¿å¼€å‘äººå‘˜å’ŒæœåŠ¡æ‰€æœ‰è€…èƒ½å¤Ÿåœ¨ä»–ä»¬çš„æœåŠ¡ä¸Šè¿è¡Œ Linkerdï¼Œæä¾›è‡ªåŠ¨å¯è§‚å¯Ÿæ€§ã€å¯é æ€§å’Œè¿è¡Œæ—¶è¯Šæ–­ï¼Œè€Œæ— éœ€æ›´æ”¹é…ç½®æˆ–ä»£ç ã€‚é€šè¿‡æä¾›è½»é‡çº§çš„å¢é‡è·¯å¾„æ¥è·å¾—å¹³å°èŒƒå›´çš„é¥æµ‹ã€å®‰å…¨æ€§å’Œå¯é æ€§çš„ä¼ ç»Ÿ service mesh åŠŸèƒ½ï¼Œservice sidecar æ–¹æ³•è¿˜é™ä½äº†å¹³å°æ‰€æœ‰è€…å’Œç³»ç»Ÿæ¶æ„å¸ˆçš„é£é™©ã€‚è¯¥ç‰ˆæœ¬è¿˜ç”¨ Rust é‡å†™äº†ä»£ç†éƒ¨åˆ†ï¼Œåœ¨å»¶è¿Ÿï¼Œååé‡å’Œèµ„æºæ¶ˆè€—æ–¹é¢äº§ç”Ÿäº†æ•°é‡çº§çš„æ”¹è¿›ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ Linkerd 1.x ç»§æ‰¿è‡ª Twitter å¼€æºçš„ Finagle é«˜æ€§èƒ½ RPCï¼Œæ‰€æœ‰æƒ³è¦æ·±åº¦å­¦ä¹  Linkerd 1.x è¿˜éœ€è¦äº†è§£ Finagleï¼Œè¿™å°±è·Ÿ Istio å°† Envoy ä½œä¸ºé»˜è®¤çš„æ•°æ®å¹³é¢ä¸€æ ·ï¼Œè¦æƒ³æ·±åº¦å­¦ä¹  Istio å¿…é¡»äº†è§£ Envoyã€‚&lt;/p&gt;
&lt;p&gt;äºŒè€…å‡ ä¹ä½¿ç”¨äº†å®Œå…¨ä¸åŒçš„æœ¯è¯­ï¼Œå‡å¦‚ä½ å·²ç»äº†è§£äº† &lt;a href=&#34;http://www.servicemesher.com/envoy/&#34;&gt;Envoy&lt;/a&gt; æƒ³è¦å†åˆ‡æ¢åˆ° Linkerd ä¸Šï¼Œé‚£ä¹ˆå°±è¦å†è´¹å¾ˆå¤šå¿ƒåŠ›æ¥å­¦ä¹ å®ƒçš„æ¦‚å¿µå’ŒåŸç†ï¼Œä¾‹å¦‚å¦‚ä¸‹è¿™äº›æœ¯è¯­æˆ–é…ç½®ï¼ˆLinkerd ä¸­ç‹¬æœ‰çš„é…ç½®ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;dtabï¼ˆå§”æ‰˜è¡¨ï¼‰&lt;/strong&gt;ï¼šç”±ä¸€ç³»åˆ—è·¯ç”±ç»„æˆï¼Œç”±ä¸€ç³»åˆ—è·¯ç”±è§„åˆ™ç»„æˆï¼Œä»¥é€»è¾‘è·¯å¾„ä¸ºè¾“å…¥ï¼Œç„¶åç»è¿‡è·¯ç”±è§„åˆ™åšä¸€ç³»åˆ—è½¬æ¢ç”Ÿæˆå…·ä½“åå­—ã€‚è¿™æ˜¯ Linkerd è·¯ç”±æœºåˆ¶çš„æ ¹æœ¬ï¼Œå°±åƒ Envoy ä¸­çš„ &lt;a href=&#34;https://jimmysong.io/istio-handbook/data-plane/envoy-xds.html&#34;&gt;xDS åè®®&lt;/a&gt;ä¸€æ ·ï¼Œæœ¬ä¹¦çš„ç¬¬å››ç« ã€Œæ·±å…¥ Linkerd æ•°æ®è®¿é—®æµã€ä¸“é—¨è®²è§£äº† dtab çš„å®ç°æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dentryï¼ˆå§”æ‰˜è¡¨è®°å½•ï¼‰&lt;/strong&gt;ï¼šå§”æ‰˜è¡¨çš„æ¯æ¡è·¯ç”±è§„åˆ™ç§°ä¸º dentryï¼Œå¦‚ /consul =&amp;gt; /#/io.l5d.consul/dc1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;namer&lt;/strong&gt;ï¼šé…ç½® Linkerd æ”¯æŒçš„æœåŠ¡å‘ç°å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;namerd&lt;/strong&gt;ï¼šLinkerd çš„æ§åˆ¶å¹³é¢ï¼Œç›¸å½“äº Istio ä¸­çš„ Pilotï¼Œå¯¹æ¥å„ç§æœåŠ¡å‘ç°ã€‚å½“ç„¶ Linkerd ä¹Ÿå¯ä»¥ç›´æ¥ä¸æŸä¸ªæœåŠ¡å‘ç°å¹³å°å¯¹æ¥å¦‚ consulï¼Œè€Œä¸ä½¿ç”¨ namerd è¿™ä¸ªé›†ä¸­è·¯ç”±å’Œé…ç½®ç®¡ç†ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;interpreter&lt;/strong&gt;ï¼šinterpreter å†³å®šå¦‚ä½•è§£ææœåŠ¡åå­—å’Œå®¢æˆ·ç«¯åå­—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶ Linkerd ä¹Ÿæ˜¯ &lt;a href=&#34;https://www.cncf.io/projects/&#34;&gt;CNCF ä¸­çš„é¡¹ç›®&lt;/a&gt;ï¼Œä½†å®ƒç›®å‰è¿˜å¤„äºå­µåŒ–é˜¶æ®µï¼Œè€Œ Envoy çš„ &lt;a href=&#34;https://jimmysong.io/istio-handbook/data-plane/envoy-xds.html&#34;&gt;xDS åè®®&lt;/a&gt;å·²ç»è¢«ä¼—å¤šå¼€æºé¡¹ç›®æ‰€æ”¯æŒï¼Œå¦‚ &lt;a href=&#34;https://istio.io/zh&#34;&gt;Istio&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/alipay/sofa-mesh&#34;&gt;SOFAMesh&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/nginxinc/nginmesh&#34;&gt;NginxMesh&lt;/a&gt; ç­‰ï¼Œä¸” Envoy å·²ç»ä» CNCF ä¸­æ¯•ä¸šï¼Œä»¥åå¯èƒ½æˆä¸º Service Mesh é¢†åŸŸçš„æ ‡å‡†åè®®ï¼ŒLinkerd çš„ç”Ÿå­˜çŠ¶å†µå ªå¿§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºæœ¬ä¹¦&#34;&gt;å…³äºæœ¬ä¹¦&lt;/h2&gt;
&lt;p&gt;æœ¬ä¹¦ä¸­æ‰€æœ‰ç¤ºä¾‹éƒ½æä¾›äº†è™šæ‹Ÿæœºçš„å¿«é€Ÿä¸Šæ‰‹ç¯å¢ƒï¼Œåªè¦ä½¿ç”¨ Vagrant å³å¯åˆ›å»ºè™šæ‹Ÿæœºå’Œåº”ç”¨ï¼Œæ‰€ä»¥åœ¨æœ¬ä¹¦çš„&lt;a href=&#34;https://github.com/yangzhares/linkerd-in-action&#34;&gt;ç¤ºä¾‹ä»£ç &lt;/a&gt;æœ‰å¤§é‡çš„ Vagrantfileã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦ç¬¬ä¸‰éƒ¨åˆ†ã€Œå®æˆ˜ç¯‡ã€èŠ±äº†å¤§é‡ç¯‡å¹…ï¼ˆæœ¬ä¹¦ä¸€åŠçš„é¡µæ•°ï¼‰æ¥è®²è§£å¦‚ä½•ä½¿ç”¨ Linkerd å’Œ Kubernetes æ¥ç®¡ç†å¾®æœåŠ¡ï¼Œå¯ä»¥å‚è€ƒæˆ‘2017å¹´8æœˆ1æ—¥å†™çš„è¿™ç¯‡&lt;a href=&#34;https://jimmysong.io/posts/linkerd-user-guide/&#34;&gt;å¾®æœåŠ¡ç®¡ç†æ¡†æ¶service meshâ€”â€”Linkerdå®‰è£…è¯•ç”¨ç¬”è®°&lt;/a&gt;ï¼Œé‚£æ—¶å€™è¿˜æ˜¯åŸºäº Linkerd 1.1.2ï¼Œè¿˜æœ‰ &lt;a href=&#34;https://github.com/linkerd/linkerd-examples/&#34;&gt;Linkerd å®˜æ–¹ç¤ºä¾‹&lt;/a&gt;ï¼Œè¿™äº›ç¤ºä¾‹åŸºæœ¬éƒ½ä¸æ€ä¹ˆæ›´æ–°äº†ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¯¥ä¹¦å®šç¨¿æ—¶æ‰€åŸºäºçš„ Linkerd ç‰ˆæœ¬è·ç¦»æœ¬ä¹¦å‘å”®æ—¶çš„ Linkerd å·²ç»è½åä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼ˆæœ€æ–°ç‰ˆæœ¬æ˜¯ &lt;a href=&#34;https://blog.linkerd.io/2018/12/06/announcing-linkerd-2-1/&#34;&gt;Linkerd 2.1&lt;/a&gt;ï¼‰ï¼Œæ‰€ä»¥è¯»è€…ä¸€å®šè¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œè€å®è¯´æˆ‘åªèŠ±äº†ä¸¤ä¸ªå¤œæ™šå¿«é€Ÿè¿‡äº†ä¸€ä¸‹æœ¬ä¹¦ï¼Œæ— æ³•å¯¹æœ¬ä¹¦å†…å®¹ç»™å‡ºå…·ä½“è¯„è®ºï¼Œæ‰€ä»¥æœ¬ä¹¦æ˜¯å¦æ˜¯ä½ æ‰€éœ€è¦çš„å°±è¦ä½ è‡ªå·±å»æ€è€ƒäº†ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: Istio çš„æ•°æ®å¹³é¢ Envoy Proxy é…ç½®è¯¦è§£</title>
      <link>https://jimmysong.io/blog/envoy-proxy-config-deep-dive/</link>
      <pubDate>Mon, 07 Jan 2019 16:11:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-proxy-config-deep-dive/</guid>
      <description>
        
        
        &lt;p&gt;Envoy æ˜¯ Istio Service Mesh ä¸­é»˜è®¤çš„ Sidecarï¼ŒIstio åœ¨ Enovy çš„åŸºç¡€ä¸ŠæŒ‰ç…§ Envoy çš„ xDS åè®®æ‰©å±•äº†å…¶æ§åˆ¶å¹³é¢ï¼Œåœ¨è®²åˆ° Envoy xDS åè®®ä¹‹å‰è¿˜éœ€è¦æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸‹ Envoy çš„åŸºæœ¬æœ¯è¯­ã€‚ä¸‹é¢åˆ—ä¸¾äº† Envoy é‡Œçš„åŸºæœ¬æœ¯è¯­åŠå…¶æ•°æ®ç»“æ„è§£æï¼Œå…³äº Envoy çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/&#34;&gt;Envoy å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œè‡³äº Envoy åœ¨ Service Meshï¼ˆä¸ä»…é™äº Istioï¼‰ ä¸­æ˜¯å¦‚ä½•ä½œä¸ºè½¬å‘ä»£ç†å·¥ä½œçš„è¯·å‚è€ƒç½‘æ˜“äº‘åˆ˜è¶…çš„è¿™ç¯‡&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ &lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;ï¼Œæœ¬æ–‡å¼•ç”¨å…¶ä¸­çš„ä¸€äº›è§‚ç‚¹ï¼Œè¯¦ç»†å†…å®¹ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://ae01.alicdn.com/kf/U587b3a8535474a2abcbe93fa069341c0A.png&#34; alt=&#34;Envoy proxy æ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åŸºæœ¬æœ¯è¯­&#34;&gt;åŸºæœ¬æœ¯è¯­&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ‚¨åº”è¯¥äº†è§£çš„ Enovy é‡Œçš„åŸºæœ¬æœ¯è¯­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Downstreamï¼ˆä¸‹æ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸‹æ¸¸ä¸»æœºè¿æ¥åˆ° Envoyï¼Œå‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼Œå³å‘é€è¯·æ±‚çš„ä¸»æœºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Upstreamï¼ˆä¸Šæ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸Šæ¸¸ä¸»æœºæ¥æ”¶æ¥è‡ª Envoy çš„è¿æ¥å’Œè¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ï¼Œå³æ¥å—è¯·æ±‚çš„ä¸»æœºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Listenerï¼ˆç›‘å¬å™¨ï¼‰&lt;/strong&gt;ï¼šç›‘å¬å™¨æ˜¯å‘½åç½‘åœ°å€ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unix domain socket ç­‰)ï¼Œä¸‹æ¸¸å®¢æˆ·ç«¯å¯ä»¥è¿æ¥è¿™äº›ç›‘å¬å™¨ã€‚Envoy æš´éœ²ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›‘å¬å™¨ç»™ä¸‹æ¸¸ä¸»æœºè¿æ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Clusterï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šé›†ç¾¤æ˜¯æŒ‡ Envoy è¿æ¥çš„ä¸€ç»„é€»è¾‘ç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;æ¥å‘ç°é›†ç¾¤çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤çš„å“ªä¸ªæˆå‘˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å°†åœ¨æœ¬æ–‡çš„ååŠéƒ¨åˆ†è§£é‡Šä»¥ä¸Šæœ¯è¯­ä¸ Kubernetesã€Istio ä¸­æ¦‚å¿µä¹‹é—´çš„è”ç³»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-xds-çš„ç‰ˆæœ¬&#34;&gt;å…³äº xDS çš„ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸€ç‚¹éœ€è¦å¤§å®¶æ³¨æ„ï¼Œå°±æ˜¯ Envoy çš„ API æœ‰ v1 å’Œ v2 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä» Envoy 1.5.0 èµ· v2 API å°±å·²ç»ç”Ÿäº§å°±ç»ªäº†ï¼Œä¸ºäº†èƒ½å¤Ÿè®©ç”¨æˆ·é¡ºåˆ©çš„å‘ v2 ç‰ˆæœ¬çš„é¢ API è¿‡åº¦ï¼ŒEnvoy å¯åŠ¨çš„æ—¶å€™è®¾ç½®äº†ä¸€ä¸ª &lt;code&gt;--v2-config-only&lt;/code&gt; çš„æ ‡å¿—ï¼ŒEnovy ä¸åŒç‰ˆæœ¬å¯¹ v1/v2 API çš„æ”¯æŒè¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://groups.google.com/forum/#!topic/envoy-announce/Lb1QZcSclGQ&#34;&gt;Envoy v1 é…ç½®åºŸå¼ƒæ—¶é—´è¡¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„ä½œè€… Matt Klein åœ¨ &lt;a href=&#34;http://www.servicemesher.com/blog/the-universal-data-plane-api/&#34;&gt;Service Mesh ä¸­çš„é€šç”¨æ•°æ®å¹³é¢ API è®¾è®¡&lt;/a&gt;è¿™ç¯‡æ–‡ç« ä¸­è¯´æ˜äº† Envoy API v1 çš„å†å²åŠå…¶ç¼ºç‚¹ï¼Œè¿˜æœ‰ v2 çš„å¼•å…¥ã€‚v2 API æ˜¯ v1 çš„æ¼”è¿›ï¼Œè€Œä¸æ˜¯é©å‘½ï¼Œå®ƒæ˜¯ v1 åŠŸèƒ½çš„è¶…é›†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.0 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯ &lt;strong&gt;Envoy 1.8.0-dev&lt;/strong&gt; ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ v2 çš„ APIï¼ŒåŒæ—¶åœ¨ Envoy ä½œä¸º Sidecar proxy å¯åŠ¨çš„ä½¿ç”¨ä½¿ç”¨äº†ä¾‹å¦‚ä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ /usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span style=&#34;color:#ae81ff&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt; --service-cluster ratings --service-node sidecar~172.33.14.2~ratings-v1-8558d4458d-ld8x9.default~default.svc.cluster.local --max-obj-name-len &lt;span style=&#34;color:#ae81ff&#34;&gt;189&lt;/span&gt; --allow-unknown-fields -l warn --v2-config-only
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æ˜¯éƒ½ Bookinfo ç¤ºä¾‹ä¸­çš„ rating pod ä¸­çš„ sidecar å¯åŠ¨çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­æŒ‡å®šäº† &lt;code&gt;--v2-config-only&lt;/code&gt;ï¼Œè¡¨æ˜ Istio 1.0+ åªæ”¯æŒ xDS v2 çš„ APIã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-sidecar-proxy-é…ç½®&#34;&gt;Istio sidecar proxy é…ç½®&lt;/h2&gt;
&lt;p&gt;å‡å¦‚æ‚¨ä½¿ç”¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; éƒ¨ç½²äº† Kubernetes é›†ç¾¤å¹¶å¼€å¯äº† &lt;a href=&#34;https://istio.io/zh&#34;&gt;Istio Service Mesh&lt;/a&gt;ï¼Œå†éƒ¨ç½² &lt;a href=&#34;https://istio.io/zh/docs/examples/bookinfo/&#34;&gt;bookinfo ç¤ºä¾‹&lt;/a&gt;ï¼Œé‚£ä¹ˆåœ¨ &lt;code&gt;default&lt;/code&gt; å‘½åç©ºé—´ä¸‹æœ‰ä¸€ä¸ªåå­—ç±»ä¼¼äº &lt;code&gt;ratings-v1-7c9949d479-dwkr4&lt;/code&gt; çš„ Podï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹è¯¥ Pod çš„ Envoy sidecar çš„å…¨é‡é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl -n default exec ratings-v1-7c9949d479-dwkr4 -c istio-proxy curl http://localhost:15000/config_dump &amp;gt; dump-rating.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°† Envoy çš„è¿è¡Œæ—¶é…ç½® dump å‡ºæ¥ä¹‹åä½ å°†çœ‹åˆ°ä¸€ä¸ªé•¿ 6000 ä½™è¡Œçš„é…ç½®æ–‡ä»¶ã€‚å…³äºè¯¥é…ç½®æ–‡ä»¶çš„ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html&#34;&gt;Envoy v2 API æ¦‚è§ˆ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Istio ä¼šåœ¨ä¸º Service Mesh ä¸­çš„æ¯ä¸ª Pod æ³¨å…¥ Sidecar çš„æ—¶å€™åŒæ—¶ä¸º Envoy æ³¨å…¥ Bootstrap é…ç½®ï¼Œå…¶ä½™çš„é…ç½®æ˜¯é€šè¿‡ Pilot ä¸‹å‘çš„ï¼Œæ³¨æ„æ•´ä¸ªæ•°æ®å¹³é¢å³ Service Mesh ä¸­çš„ Envoy çš„åŠ¨æ€é…ç½®åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æ£€æŸ¥å…¶ä»– sidecar çš„ Envoy é…ç½®æ˜¯å¦è·Ÿæœ€ä¸Šé¢çš„é‚£ä¸ªç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥ Service Mesh ä¸­çš„æ‰€æœ‰æœ‰ Sidecar æ³¨å…¥çš„ Pod ä¸­çš„ proxy é…ç½®æ˜¯å¦åŒæ­¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ istioctl proxy-status
PROXY                                                 CDS        LDS        EDS               RDS          PILOT                            VERSION
details-v1-876bf485f-sx7df.default                    SYNCED     SYNCED     SYNCED &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;100%&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;     SYNCED       istio-pilot-5bf6d97f79-6lz4x     1.0.0
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://istio.io/zh/docs/reference/commands/istioctl/&#34;&gt;istioctl&lt;/a&gt; è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å°±åƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/kubectl-cheatsheet.html&#34;&gt;kubectl&lt;/a&gt; ä¸€æ ·æœ‰å¾ˆå¤šç¥å™¨çš„é­”æ³•ï¼Œé€šè¿‡å®ƒå¯ä»¥é«˜æ•ˆçš„ç®¡ç† Istio å’Œ debugã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-proxy-é…ç½®è§£æ&#34;&gt;Envoy proxy é…ç½®è§£æ&lt;/h2&gt;
&lt;p&gt;Istio envoy sidecar proxy é…ç½®ä¸­åŒ…å«ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;bootstrap&lt;/strong&gt;ï¼šEnvoy proxy å¯åŠ¨æ—¶å€™åŠ è½½çš„é™æ€é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;listeners&lt;/strong&gt;ï¼šç›‘å¬å™¨é…ç½®ï¼Œä½¿ç”¨ LDS ä¸‹å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;clusters&lt;/strong&gt;ï¼šé›†ç¾¤é…ç½®ï¼Œé™æ€é…ç½®ä¸­åŒ…æ‹¬ xds-grpc å’Œ zipkin åœ°å€ï¼ŒåŠ¨æ€é…ç½®ä½¿ç”¨  CDS ä¸‹å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;routes&lt;/strong&gt;ï¼šè·¯ç”±é…ç½®ï¼Œé™æ€é…ç½®ä¸­åŒ…æ‹¬äº†æœ¬åœ°ç›‘å¬çš„æœåŠ¡çš„é›†ç¾¤ä¿¡æ¯ï¼Œå…¶ä¸­å¼•ç”¨äº† clusterï¼ŒåŠ¨æ€é…ç½®ä½¿ç”¨ RDS ä¸‹å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ä¸ªéƒ¨åˆ†ä¸­éƒ½åŒ…å«é™æ€é…ç½®ä¸åŠ¨æ€é…ç½®ï¼Œå…¶ä¸­ bootstrap é…ç½®åˆæ˜¯åœ¨é›†ç¾¤å¯åŠ¨çš„æ—¶å€™é€šè¿‡ sidecar å¯åŠ¨å‚æ•°æ³¨å…¥çš„ï¼Œé…ç½®æ–‡ä»¶åœ¨ &lt;code&gt;/etc/istio/proxy/envoy-rev0.json&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº bootstrap ä¸­çš„é…ç½®æ˜¯æ¥è‡ª Envoy å¯åŠ¨æ—¶åŠ è½½çš„é™æ€æ–‡ä»¶ï¼Œä¸»è¦é…ç½®äº†èŠ‚ç‚¹ä¿¡æ¯ã€tracingã€admin å’Œç»Ÿè®¡ä¿¡æ¯æ”¶é›†ç­‰ä¿¡æ¯ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap&#34;&gt;Bootstrap&lt;/a&gt; æ˜¯ Envoy ä¸­é…ç½®çš„æ ¹æœ¬æ¥æºï¼Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap&#34;&gt;Bootstrap&lt;/a&gt; æ¶ˆæ¯ä¸­æœ‰ä¸€ä¸ªå…³é”®çš„æ¦‚å¿µï¼Œå°±æ˜¯é™æ€å’ŒåŠ¨æ€èµ„æºçš„ä¹‹é—´çš„åŒºåˆ«ã€‚ä¾‹å¦‚ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/lds.proto.html#envoy-api-msg-listener&#34;&gt;Listener&lt;/a&gt; æˆ– &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster&#34;&gt;Cluster&lt;/a&gt; è¿™äº›èµ„æºæ—¢å¯ä»¥ä» &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-static-resources&#34;&gt;static_resources&lt;/a&gt; é™æ€çš„è·å¾—ä¹Ÿå¯ä»¥ä» &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources&#34;&gt;dynamic_resources&lt;/a&gt; ä¸­é…ç½®çš„ &lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listeners/lds.html#config-listeners-lds&#34;&gt;LDS&lt;/a&gt; æˆ– &lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html#config-cluster-manager-cds&#34;&gt;CDS&lt;/a&gt; ä¹‹ç±»çš„ xDS æœåŠ¡è·å–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener&#34;&gt;Listener&lt;/h3&gt;
&lt;p&gt;Listener é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç›‘å¬å™¨ï¼Œç›‘å¬ IP åœ°å€å’Œç«¯å£ï¼Œç„¶åæ ¹æ®ç­–ç•¥è½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener çš„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª Envoy è¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ª Listenerï¼ŒEnvoy ä¸ Listener ä¹‹é—´æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª Listener ä¸­å¯ä»¥é…ç½®ä¸€æ¡ filter é“¾è¡¨ï¼ˆfilter_chainsï¼‰ï¼ŒEnvoy ä¼šæ ¹æ® filter é¡ºåºæ‰§è¡Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;Listener å¯ä»¥ç›‘å¬ä¸‹æ¸¸çš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»– listener çš„æ•°æ®ï¼Œå½¢æˆé“¾å¼å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;filter æ˜¯å¯æ‰©å±•çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é™æ€é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ LDS åŠ¨æ€é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ç›®å‰åªèƒ½ç›‘å¬ TCPï¼ŒUDP è¿˜æœªæ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Listener çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Listener çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼Œé™¤äº† &lt;code&gt;name&lt;/code&gt;ã€&lt;code&gt;address&lt;/code&gt; å’Œ &lt;code&gt;filter_chains&lt;/code&gt; ä¸ºå¿…é¡»é…ç½®ä¹‹å¤–ï¼Œå…¶ä»–éƒ½ä¸ºå¯é€‰çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;use_original_dst&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;per_connection_buffer_limit_bytes&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;drain_type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;transparent&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;freebind&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socket_options&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tcp_fast_open_queue_length&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;bugfix_reverse_write_filter_order&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šè¯¥ listener çš„ UUIDï¼Œå”¯ä¸€é™å®šåï¼Œé»˜è®¤60ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚ &lt;code&gt;10.254.74.159_15011&lt;/code&gt;ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤å‚æ•°æŒ‡å®šé•¿åº¦é™åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;address&lt;/strong&gt;ï¼šç›‘å¬çš„é€»è¾‘/ç‰©ç†åœ°å€å’Œç«¯å£å·ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt; {
       &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10.254.74.159&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;15011&lt;/span&gt;
       }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;filter_chains&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒEnvoy ä¸­å†…ç½®äº†ä¸€äº›é€šç”¨çš„ filterï¼Œæ¯ç§ filter éƒ½æœ‰ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼ŒEnovy ä¼šæ ¹æ®è¯¥é…ç½®é¡ºåºæ‰§è¡Œ filterã€‚Envoy ä¸­å†…ç½®çš„ filter æœ‰ï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/client_ssl_auth_filter#config-network-filters-client-ssl-auth&#34;&gt;envoy.client_ssl_auth&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/echo_filter#config-network-filters-echo&#34;&gt;envoy.echo&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/http_conn_man/http_conn_man#config-http-conn-man&#34;&gt;enovy.http_connection_manager&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/mongo_proxy_filter#config-network-filters-mongo-proxy&#34;&gt;envoy.mongo_proxy&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/rate_limit_filter#config-network-filters-rate-limit&#34;&gt;envoy.rate_limit&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/redis_proxy_filter#config-network-filters-redis-proxy&#34;&gt;enovy.redis_proxy&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/tcp_proxy_filter#config-network-filters-tcp-proxy&#34;&gt;envoy.tcp_proxy&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/intro/arch_overview/http_filters&#34;&gt;http_filters&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/thrift_filters/thrift_filters&#34;&gt;thrift_filters&lt;/a&gt;ç­‰ã€‚è¿™äº› filter å¯ä»¥å•ç‹¬ä½¿ç”¨ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æ‰©å±•ï¼Œä¾‹å¦‚ä½¿ç”¨ Istio ä¸­çš„ &lt;a href=&#34;https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#envoyfilter&#34;&gt;EnvoyFilter é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;use_original_dst&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœä½¿ç”¨ iptables é‡å®šå‘è¿æ¥ï¼Œåˆ™ä»£ç†æ¥æ”¶çš„ç«¯å£å¯èƒ½ä¸&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ç«¯å£ä¸ä¸€æ ·ã€‚å½“æ­¤æ ‡å¿—è®¾ç½®ä¸º true æ—¶ï¼ŒListener å°†é‡å®šå‘çš„è¿æ¥åˆ‡æ¢åˆ°ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerã€‚å¦‚æœæ²¡æœ‰ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œåˆ™è¿æ¥ç”±æ¥æ”¶å®ƒçš„ Listener å¤„ç†ã€‚é»˜è®¤ä¸º falseã€‚æ³¨æ„ï¼šè¯¥å‚æ•°å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ Listener filter æ›¿ä»£ã€‚è¯¥å‚æ•°çš„ä¸»è¦ç”¨é€”æ˜¯ï¼šEnvoy é€šè¿‡ç›‘å¬ 15001 ç«¯å£å°†åº”ç”¨çš„æµé‡æˆªå–åå†ç”±å…¶ä»– Listener å¤„ç†è€Œä¸æ˜¯ç›´æ¥è½¬å‘å‡ºå»ï¼Œè¯¦æƒ…è§ &lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#virtual-listener&#34;&gt;Virtual Listener&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Listener çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/lds.proto#envoy-api-msg-listener&#34;&gt;Envoy v2 API reference - listener&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;route&#34;&gt;Route&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€è¯´çš„è·¯ç”±æŒ‡çš„æ˜¯ &lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/http_routing.html&#34;&gt;HTTP è·¯ç”±&lt;/a&gt;ï¼Œè¿™ä¹Ÿä½¿å¾— Envoy å¯ä»¥ç”¨æ¥å¤„ç†ç½‘æ ¼è¾¹ç¼˜çš„æµé‡ã€‚HTTP è·¯ç”±è½¬å‘æ˜¯é€šè¿‡è·¯ç”±è¿‡æ»¤å™¨å®ç°çš„ã€‚è¯¥è¿‡æ»¤å™¨çš„ä¸»è¦èŒèƒ½å°±æ˜¯æ‰§è¡Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route_config#config-http-conn-man-route-table&#34;&gt;è·¯ç”±è¡¨&lt;/a&gt;ä¸­çš„æŒ‡ä»¤ã€‚é™¤äº†å¯ä»¥åšé‡å®šå‘å’Œè½¬å‘ï¼Œè·¯ç”±è¿‡æ»¤å™¨è¿˜éœ€è¦å¤„ç†é‡è¯•ã€ç»Ÿè®¡ä¹‹ç±»çš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP è·¯ç”±çš„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰ç¼€å’Œç²¾ç¡®è·¯å¾„åŒ¹é…è§„åˆ™ã€‚&lt;/li&gt;
&lt;li&gt;å¯è·¨è¶Šå¤šä¸ªä¸Šæ¸¸é›†ç¾¤è¿›è¡ŒåŸºäº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route#config-http-conn-man-route-table-route-weighted-clusters&#34;&gt;æƒé‡/ç™¾åˆ†æ¯”çš„è·¯ç”±&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/http_routing.html#arch-overview-http-routing-priority&#34;&gt;ä¼˜å…ˆçº§&lt;/a&gt;çš„è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route#config-http-conn-man-route-table-hash-policy&#34;&gt;å“ˆå¸Œ&lt;/a&gt;ç­–ç•¥çš„è·¯ç”±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Route çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;internal_only_headers&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;response_headers_to_add&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;response_headers_to_remove&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;request_headers_to_add&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;request_headers_to_remove&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šè¯¥åå­—è·Ÿ &lt;code&gt;envoy.http_connection_manager&lt;/code&gt; filter ä¸­çš„ &lt;code&gt;http_filters.rds.route_config_name&lt;/code&gt; ä¸€è‡´ï¼Œåœ¨ Istio Service Mesh ä¸­ä¸º Envoy ä¸‹å‘çš„é…ç½®ä¸­çš„ Route æ˜¯ä»¥ç›‘å¬çš„ç«¯å£å·ä½œä¸ºåå­—ï¼Œè€ŒåŒä¸€ä¸ªåå­—ä¸‹é¢çš„ &lt;code&gt;virtual_hosts&lt;/code&gt; å¯ä»¥æœ‰å¤šä¸ªå€¼ï¼ˆæ•°ç»„å½¢å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;virtual_hosts&lt;/strong&gt;ï¼šå› ä¸º &lt;strong&gt;VirtualHosts&lt;/strong&gt; æ˜¯ Envoy ä¸­å¼•å…¥çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæˆ‘ä»¬åœ¨ä¸‹æ–‡å°†è¯¦ç»†è¯´æ˜ &lt;code&gt;virtual_hosts&lt;/code&gt; çš„æ•°æ®ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;validate_clusters&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥è®¾ç½®å¼€å¯ä½¿ç”¨ cluster manager æ¥æ£€æµ‹è·¯ç”±è¡¨å¼•ç”¨çš„ cluster æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœæ˜¯è·¯ç”±è¡¨æ˜¯é€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-route-config&#34;&gt;route_config&lt;/a&gt; é™æ€é…ç½®çš„åˆ™è¯¥å€¼é»˜è®¤è®¾ç½®ä¸º trueï¼Œå¦‚æœæ˜¯ä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds&#34;&gt;rds&lt;/a&gt; åŠ¨æ€é…ç½®çš„è¯ï¼Œåˆ™è¯¥å€¼é»˜è®¤è®¾ç½®ä¸º falseã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Route çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/rds.proto&#34;&gt;Envoy v2 API reference - HTTP route configuration&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;routevirtualhost&#34;&gt;route.VirtualHost&lt;/h4&gt;
&lt;p&gt;VirtualHost å³ä¸Šæ–‡ä¸­ Route é…ç½®ä¸­çš„ &lt;code&gt;virtual_hosts&lt;/code&gt;ï¼ŒVirtualHost æ˜¯è·¯ç”±é…ç½®ä¸­çš„é¡¶çº§å…ƒç´ ã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºéƒ½æœ‰ä¸€ä¸ªé€»è¾‘åç§°ä»¥åŠä¸€ç»„æ ¹æ®ä¼ å…¥è¯·æ±‚çš„ host header è·¯ç”±åˆ°å®ƒçš„åŸŸã€‚è¿™å…è®¸å•ä¸ª Listener ä¸ºå¤šä¸ªé¡¶çº§åŸŸè·¯å¾„æ ‘æä¾›æœåŠ¡ã€‚åŸºäºåŸŸé€‰æ‹©äº†è™šæ‹Ÿä¸»æœºå Envoy  å°±ä¼šå¤„ç†è·¯ç”±ä»¥æŸ¥çœ‹è¦è·¯ç”±åˆ°å“ªä¸ªä¸Šæ¸¸é›†ç¾¤æˆ–æ˜¯å¦æ‰§è¡Œé‡å®šå‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VirtualHost çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ VirtualHost çš„æ•°æ®ç»“æ„ï¼Œé™¤äº† &lt;code&gt;name&lt;/code&gt; å’Œ &lt;code&gt;domains&lt;/code&gt; æ˜¯å¿…é¡»é…ç½®é¡¹å¤–ï¼Œå…¶ä»–çš†ä¸ºå¯é€‰é¡¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;require_tls&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;virtual_clusters&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;rate_limits&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;request_headers_to_add&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;request_headers_to_remove&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;response_headers_to_add&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;response_headers_to_remove&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cors&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;per_filter_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;include_request_attempt_count&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šè¯¥ VirtualHost çš„åå­—ï¼Œä¸€èˆ¬æ˜¯ FQDN åŠ ç«¯å£ï¼Œå¦‚ &lt;code&gt;details.default.svc.cluster.local:9080&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;domains&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸ªç”¨æ¥åŒ¹é… VirtualHost çš„åŸŸåï¼ˆhost/authority headerï¼‰åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œä½†æ˜¯é€šé…ç¬¦ä¸èƒ½åŒ¹é…ç©ºå­—ç¬¦ï¼Œé™¤äº†ä»…ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt; ä½œä¸º domainsï¼Œæ³¨æ„åˆ—è¡¨ä¸­çš„å€¼ä¸èƒ½é‡å¤å’Œå­˜åœ¨äº¤é›†ï¼Œåªè¦æœ‰ä¸€æ¡ domain è¢«åŒ¹é…ä¸Šäº†ï¼Œå°±ä¼šæ‰§è¡Œè·¯ç”±ã€‚Istio ä¼šä¸ºè¯¥å€¼é…ç½®æ‰€æœ‰åœ°å€è§£æå½¢å¼ï¼ŒåŒ…æ‹¬ IP åœ°å€ã€FQDN å’ŒçŸ­åŸŸåç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;routes&lt;/strong&gt;ï¼šé’ˆå¯¹å…¥å£æµé‡çš„æœ‰åºè·¯ç”±åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…ä¸Šçš„è·¯ç”±å°†è¢«æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨ä¸‹æ–‡å°†è¯¦ç»†è¯´æ˜ route çš„æ•°æ®ç»“æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªå®é™…çš„ VirtualHost çš„ä¾‹å­ï¼Œè¯¥é…ç½®æ¥è‡ª &lt;a href=&#34;https://istio.io/zh/docs/examples/bookinfo/&#34;&gt;Bookinfo åº”ç”¨&lt;/a&gt;çš„ details åº”ç”¨çš„ Sidecar æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details:9080&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster:9080&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc:9080&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default:9080&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10.254.4.113&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10.254.4.113:9080&amp;#34;&lt;/span&gt;
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: [
                {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;: {
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
                    },
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: {
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;outbound|9080||details.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;,
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;
                    },
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;: {
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
                    },
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;per_filter_config&amp;#34;&lt;/span&gt;: {
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;mixer&amp;#34;&lt;/span&gt;: {
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;forward_attributes&amp;#34;&lt;/span&gt;: {
                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;attributes&amp;#34;&lt;/span&gt;: {
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.uid&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;istio://default/services/details&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.host&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.namespace&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.name&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
                                    }
                                }
                            },
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;mixer_attributes&amp;#34;&lt;/span&gt;: {
                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;attributes&amp;#34;&lt;/span&gt;: {
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.host&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.uid&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;istio://default/services/details&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.name&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service.namespace&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
                                    },
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;destination.service&amp;#34;&lt;/span&gt;: {
                                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
                                    }
                                }
                            },
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;disable_check_calls&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
                        }
                    }
                }
            ]
        }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äº route.VirtualHost çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-msg-route-virtualhost&#34;&gt;Envoy v2 API reference - route.VirtualHost&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;routeroute&#34;&gt;route.Route&lt;/h4&gt;
&lt;p&gt;è·¯ç”±æ—¢æ˜¯å¦‚ä½•åŒ¹é…è¯·æ±‚çš„è§„èŒƒï¼Œä¹Ÿæ˜¯å¯¹ä¸‹ä¸€æ­¥åšä»€ä¹ˆçš„æŒ‡ç¤ºï¼ˆä¾‹å¦‚ï¼Œredirectã€forwardã€rewriteç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;route.Route çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ˜¯ route.Route çš„æ•°æ®ç»“æ„ï¼Œé™¤äº† &lt;code&gt;match&lt;/code&gt; ä¹‹å¤–å…¶ä½™éƒ½æ˜¯å¯é€‰çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;redirect&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;direct_response&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;per_filter_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;request_headers_to_add&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;request_headers_to_remove&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;response_headers_to_add&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;response_headers_to_remove&amp;#34;&lt;/span&gt;: []
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;match&lt;/strong&gt;ï¼šè·¯ç”±åŒ¹é…å‚æ•°ã€‚ä¾‹å¦‚ URL prefixï¼ˆå‰ç¼€ï¼‰ã€pathï¼ˆURL çš„å®Œæ•´è·¯å¾„ï¼‰ã€regexï¼ˆè§„åˆ™è¡¨è¾¾å¼ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;route&lt;/strong&gt;ï¼šè¿™é‡Œé¢é…ç½®è·¯ç”±çš„è¡Œä¸ºï¼Œå¯ä»¥æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-route&#34;&gt;route&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-redirect&#34;&gt;redirect&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-direct-response&#34;&gt;direct_response&lt;/a&gt;ï¼Œä¸è¿‡è¿™é‡Œé¢æ²¡æœ‰ä¸“é—¨çš„ä¸€ä¸ªé…ç½®é¡¹ç”¨æ¥é…ç½®ä»¥ä¸Šä¸‰ç§è¡Œä¸ºï¼Œè€Œæ˜¯æ ¹æ®å®é™…å¡«å……çš„é…ç½®é¡¹æ¥ç¡®å®šçš„ã€‚ä¾‹å¦‚åœ¨æ­¤å¤„æ·»åŠ  &lt;code&gt;cluster&lt;/code&gt; é…ç½®åˆ™æš—ç¤ºè·¯ç”±åŠ¨ä½œä¸ºâ€routeâ€œï¼Œè¡¨ç¤ºå°†æµé‡è·¯ç”±åˆ°è¯¥ clusterã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#route-routeaction&#34;&gt;route.RouteAction&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;decorator&lt;/strong&gt;ï¼šè¢«åŒ¹é…çš„è·¯ç”±çš„ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºè¢«åŒ¹é…çš„è™šæ‹Ÿä¸»æœºå’Œ URLã€‚è¯¥é…ç½®é‡Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå¿…é¡»é…ç½®çš„é¡¹ &lt;code&gt;operation&lt;/code&gt;ï¼Œä¾‹å¦‚ &lt;code&gt;details.default.svc.cluster.local:9080/*&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;per_filter_config&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ª map ç±»å‹ï¼Œ&lt;code&gt;per_filter_config&lt;/code&gt; å­—æ®µå¯ç”¨äºä¸º filter æä¾›ç‰¹å®šè·¯ç”±çš„é…ç½®ã€‚Map çš„ key åº”ä¸ filleter åç§°åŒ¹é…ï¼Œä¾‹å¦‚ç”¨äº HTTP buffer filter çš„ &lt;code&gt;envoy.buffer&lt;/code&gt;ã€‚è¯¥å­—æ®µæ˜¯ç‰¹å®šäº filter çš„ï¼Œè¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/http_filters#config-http-filters&#34;&gt;HTTP filter&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº route.Route çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-msg-route-route&#34;&gt;Envoy v2 API reference - route.Route&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster&#34;&gt;Cluster&lt;/h3&gt;
&lt;p&gt;Cluster æ˜¯æŒ‡ Envoy è¿æ¥çš„ä¸€ç»„é€»è¾‘ç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;æ¥å‘ç° cluster çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ° cluster çš„å“ªä¸ªæˆå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cluster çš„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ç»„é€»è¾‘ä¸Šç›¸åŒçš„ä¸»æœºæ„æˆä¸€ä¸ª clusterã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨ cluster ä¸­å®šä¹‰å„ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;æ–°åŠ å…¥çš„ cluster éœ€è¦ä¸€ä¸ªçƒ­èº«çš„è¿‡ç¨‹æ‰å¯ä»¥ç»™è·¯ç”±å¼•ç”¨ï¼Œè¯¥è¿‡ç¨‹æ˜¯åŸå­çš„ï¼Œå³åœ¨ cluster çƒ­èº«ä¹‹å‰å¯¹äº Envoy åŠ Service Mesh çš„å…¶ä½™éƒ¨åˆ†æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥é…ç½® clusterï¼Œä¾‹å¦‚é™æ€ç±»å‹ã€ä¸¥æ ¼é™å®š DNSã€é€»è¾‘ DNSã€EDS ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Cluster çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cluster çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼Œé™¤äº† &lt;code&gt;name&lt;/code&gt; å­—æ®µï¼Œå…¶ä»–éƒ½æ˜¯å¯é€‰çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;alt_stat_name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;eds_cluster_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;per_connection_buffer_limit_bytes&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;load_assignment&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;health_checks&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_requests_per_connection&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;circuit_breakers&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tls_context&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;common_http_protocol_options&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;http_protocol_options&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;extension_protocol_options&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dns_refresh_rate&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dns_lookup_family&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dns_resolvers&amp;#34;&lt;/span&gt;: [],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;outlier_detection&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cleanup_interval&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;upstream_bind_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lb_subset_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ring_hash_lb_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;original_dst_lb_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;least_request_lb_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;common_lb_config&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;protocol_selection&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;upstream_connection_options&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;close_connections_on_host_health_failure&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;drain_connections_on_host_removal&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šå¦‚æœä½ ç•™æ„åˆ°ä½œä¸º Sidecar å¯åŠ¨çš„ Envoy çš„å‚æ•°çš„ä¼šæ³¨æ„åˆ° &lt;code&gt;--max-obj-name-len 189&lt;/code&gt;ï¼Œè¯¥é€‰é¡¹ç”¨æ¥ç”¨æ¥æŒ‡å®š cluster çš„åå­—ï¼Œä¾‹å¦‚ &lt;code&gt;inbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;ã€‚è¯¥åå­—å­—ç¬¦ä¸²ç”± &lt;code&gt;|&lt;/code&gt; åˆ†éš”æˆå››ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ &lt;code&gt;inbound&lt;/code&gt; æˆ– &lt;code&gt;outbound&lt;/code&gt; ä»£è¡¨å…¥å‘æµé‡æˆ–å‡ºå‘æµé‡ã€ç«¯å£å·ã€subcluster åç§°ã€FQDNï¼Œå…¶ä¸­ subcluster åç§°å°†å¯¹åº”äº Istio &lt;code&gt;DestinationRule&lt;/code&gt; ä¸­é…ç½®çš„ &lt;code&gt;subnet&lt;/code&gt;ï¼Œå¦‚æœæ˜¯æŒ‰ç…§å¤šç‰ˆæœ¬æŒ‰æ¯”ä¾‹è·¯ç”±çš„è¯ï¼Œè¯¥å€¼å¯ä»¥æ˜¯ç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;type&lt;/strong&gt;ï¼šå³&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery-types&#34;&gt;æœåŠ¡å‘ç°ç±»å‹&lt;/a&gt;ï¼Œæ”¯æŒçš„å‚æ•°æœ‰ &lt;code&gt;STATIC&lt;/code&gt;ï¼ˆç¼ºçœå€¼ï¼‰ã€&lt;code&gt;STRICT_DNS&lt;/code&gt;ã€&lt;code&gt;LOGICAL_DNS&lt;/code&gt;ã€&lt;code&gt;EDS&lt;/code&gt;ã€&lt;code&gt;ORIGINAL_DST&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;hosts&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸ªåˆ—è¡¨ï¼Œé…ç½®è´Ÿè½½å‡è¡¡çš„ IP åœ°å€å’Œç«¯å£ï¼Œåªæœ‰ä½¿ç”¨äº†  &lt;code&gt;STATIC&lt;/code&gt;ã€&lt;code&gt;STRICT_DNS&lt;/code&gt;ã€&lt;code&gt;LOGICAL_DNS&lt;/code&gt; æœåŠ¡å‘ç°ç±»å‹æ—¶æ‰éœ€è¦é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;eds_cluster_config&lt;/strong&gt;ï¼šå¦‚æœä½¿ç”¨ &lt;code&gt;EDS&lt;/code&gt; åšæœåŠ¡å‘ç°ï¼Œåˆ™éœ€è¦é…ç½®è¯¥é¡¹ç›®ï¼Œå…¶ä¸­åŒ…æ‹¬çš„é…ç½®æœ‰ &lt;code&gt;service_name&lt;/code&gt; å’Œ &lt;code&gt;ads&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Cluster çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto#cluster&#34;&gt;Envoy v2 API reference - cluster&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html&#34;&gt;Envoy v2 API æ¦‚è§ˆ - servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listeners/lds.html&#34;&gt;ç›‘å¬å™¨å‘ç°æœåŠ¡ï¼ˆLDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/http_conn_man/rds.html&#34;&gt;è·¯ç”±å‘ç°æœåŠ¡ï¼ˆRDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡ï¼ˆCDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html&#34;&gt;xDS åè®®è§£æ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ - cnblogs.com&lt;/a&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘</title>
      <link>https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/</link>
      <pubDate>Wed, 26 Dec 2018 18:32:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡ä»¥ Istio å®˜æ–¹çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/examples/bookinfo&#34;&gt;bookinfo ç¤ºä¾‹&lt;/a&gt;æ¥è®²è§£åœ¨è¿›å…¥ Pod çš„æµé‡è¢« iptables è½¬äº¤ç»™ Envoy sidecar åï¼ŒEnvoy æ˜¯å¦‚ä½•åšè·¯ç”±è½¬å‘çš„ï¼Œè¯¦è¿°äº† Inbound å’Œ Outbound å¤„ç†è¿‡ç¨‹ã€‚å…³äºæµé‡æ‹¦æˆªçš„è¯¦ç»†åˆ†æè¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio å®˜æ–¹æä¾›çš„ bookinfo çš„è¯·æ±‚æµç¨‹å›¾ï¼Œå‡è®¾ bookinfo åº”ç”¨çš„æ‰€æœ‰æœåŠ¡ä¸­æ²¡æœ‰é…ç½® DestinationRuleã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006tNbRwgy1fvlwjd3302j31bo0ro0x5.jpg&#34; alt=&#34;Bookinfo ç¤ºä¾‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio è‡ªèº«ç»„ä»¶ä¸ Bookinfo ç¤ºä¾‹çš„è¿æ¥å…³ç³»å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ HTTP è¿æ¥éƒ½åœ¨ 9080 ç«¯å£ç›‘å¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006tNbRwly1fyitp0jsghj31o70u0x6p.jpg&#34; alt=&#34;Bookinfo ç¤ºä¾‹ä¸ Istio ç»„ä»¶è¿æ¥å…³ç³»å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨ &lt;a href=&#34;https://drive.google.com/open?id=19ed3_tkjf6RgGboxllMdt_Ytd5_cocib&#34;&gt;Google Drive&lt;/a&gt; ä¸Šä¸‹è½½åŸå›¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥åŠæµé‡åŠ«æŒæ­¥éª¤æ¦‚è¿°&#34;&gt;Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒæ­¥éª¤æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä» Sidecar æ³¨å…¥ã€Pod å¯åŠ¨åˆ° Sidecar proxy æ‹¦æˆªæµé‡åŠ Envoy å¤„ç†è·¯ç”±çš„æ­¥éª¤æ¦‚è§ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; Kubernetes é€šè¿‡ Admission Controller è‡ªåŠ¨æ³¨å…¥ï¼Œæˆ–è€…ç”¨æˆ·ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤æ‰‹åŠ¨æ³¨å…¥ sidecar å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; åº”ç”¨ YAML é…ç½®éƒ¨ç½²åº”ç”¨ï¼Œæ­¤æ—¶ Kubernetes API server æ¥æ”¶åˆ°çš„æœåŠ¡åˆ›å»ºé…ç½®æ–‡ä»¶ä¸­å·²ç»åŒ…å«äº† Init å®¹å™¨åŠ sidecar proxyã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; åœ¨ sidecar proxy å®¹å™¨å’Œåº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰ï¼Œé¦–å…ˆè¿è¡Œ Init å®¹å™¨ï¼ŒInit å®¹å™¨ç”¨äºè®¾ç½® iptablesï¼ˆIstio ä¸­é»˜è®¤çš„æµé‡æ‹¦æˆªæ–¹å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ BPFã€IPVS ç­‰æ–¹å¼ï¼‰ å°†è¿›å…¥ pod çš„æµé‡åŠ«æŒåˆ° Envoy sidecar proxyã€‚æ‰€æœ‰ TCP æµé‡ï¼ˆEnvoy ç›®å‰åªæ”¯æŒ TCP æµé‡ï¼‰å°†è¢« sidecar åŠ«æŒï¼Œå…¶ä»–åè®®çš„æµé‡å°†æŒ‰åŸæ¥çš„ç›®çš„åœ°è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; å¯åŠ¨ Pod ä¸­çš„ Envoy sidecar proxy å’Œåº”ç”¨ç¨‹åºå®¹å™¨ã€‚è¿™ä¸€æ­¥çš„è¿‡ç¨‹è¯·å‚è€ƒ&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#%E9%80%9A%E8%BF%87%E7%AE%A1%E7%90%86%E6%8E%A5%E5%8F%A3%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE&#34;&gt;é€šè¿‡ç®¡ç†æ¥å£è·å–å®Œæ•´é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Sidecar proxy ä¸åº”ç”¨å®¹å™¨çš„å¯åŠ¨é¡ºåºé—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ sidecar proxy å’Œåº”ç”¨å®¹å™¨ï¼Œç©¶ç«Ÿå“ªä¸ªå®¹å™¨å…ˆå¯åŠ¨å‘¢ï¼Ÿæ­£å¸¸æƒ…å†µæ˜¯ Envoy Sidecar å’Œåº”ç”¨ç¨‹åºå®¹å™¨å…¨éƒ¨å¯åŠ¨å®Œæˆåå†å¼€å§‹æ¥æ”¶æµé‡è¯·æ±‚ã€‚ä½†æ˜¯æˆ‘ä»¬æ— æ³•é¢„æ–™å“ªä¸ªå®¹å™¨ä¼šå…ˆå¯åŠ¨ï¼Œé‚£ä¹ˆå®¹å™¨å¯åŠ¨é¡ºåºæ˜¯å¦ä¼šå¯¹ Envoy åŠ«æŒæµé‡æœ‰å½±å“å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¸è¿‡åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ…å†µ1ï¼šåº”ç”¨å®¹å™¨å…ˆå¯åŠ¨ï¼Œè€Œ sidecar proxy ä»æœªå°±ç»ª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œæµé‡è¢« iptables è½¬ç§»åˆ° 15001 ç«¯å£ï¼Œè€Œ Pod ä¸­æ²¡æœ‰ç›‘å¬è¯¥ç«¯å£ï¼ŒTCP é“¾æ¥å°±æ— æ³•å»ºç«‹ï¼Œè¯·æ±‚å¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ…å†µ2ï¼šSidecar å…ˆå¯åŠ¨ï¼Œè¯·æ±‚åˆ°è¾¾è€Œåº”ç”¨ç¨‹åºä»æœªå°±ç»ª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹è¯·æ±‚ä¹Ÿè‚¯å®šä¼šå¤±è´¥ï¼Œè‡³äºæ˜¯åœ¨å“ªä¸€æ­¥å¼€å§‹å¤±è´¥çš„ï¼Œç•™ç»™è¯»è€…æ¥æ€è€ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœä¸º sidecar proxy å’Œåº”ç”¨ç¨‹åºå®¹å™¨æ·»åŠ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34;&gt;å°±ç»ªå’Œå­˜æ´»æ¢é’ˆ&lt;/a&gt;æ˜¯å¦å¯ä»¥è§£å†³è¯¥é—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5.&lt;/strong&gt; ä¸è®ºæ˜¯è¿›å…¥è¿˜æ˜¯ä» Pod å‘å‡ºçš„ TCP è¯·æ±‚éƒ½ä¼šè¢« iptables åŠ«æŒï¼Œinbound æµé‡è¢«åŠ«æŒåç» Inbound Handler å¤„ç†åè½¬äº¤ç»™åº”ç”¨ç¨‹åºå®¹å™¨å¤„ç†ï¼Œoutbound æµé‡è¢« iptables åŠ«æŒåè½¬äº¤ç»™ Outbound Handler å¤„ç†ï¼Œå¹¶ç¡®å®šè½¬å‘çš„ upstream å’Œ Endpointã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6.&lt;/strong&gt; Sidecar proxy è¯·æ±‚ Pilot ä½¿ç”¨ xDS åè®®åŒæ­¥ Envoy é…ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ LDSã€EDSã€CDS ç­‰ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯æ›´æ–°çš„é¡ºåºï¼ŒEnvoy ä¼šç›´æ¥ä½¿ç”¨ ADS å‘ Pilot è¯·æ±‚é…ç½®æ›´æ–°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-å¦‚ä½•å¤„ç†è·¯ç”±è½¬å‘&#34;&gt;Envoy å¦‚ä½•å¤„ç†è·¯ç”±è½¬å‘&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡è¯·æ±‚è®¿é—® &lt;code&gt;http://reviews.default.svc.cluster.local:9080/&lt;/code&gt;ï¼Œå½“æµé‡è¿›å…¥ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡å†…éƒ¨æ—¶ï¼Œ&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡å†…éƒ¨çš„ Envoy Sidecar æ˜¯å¦‚ä½•åšæµé‡æ‹¦æˆªå’Œè·¯ç”±è½¬å‘çš„ã€‚å¯ä»¥åœ¨ &lt;a href=&#34;https://drive.google.com/file/d/1n-h235tm8DnL_RqxTTA95rgGtrLkBsyr/view?usp=sharing&#34;&gt;Google Drive&lt;/a&gt; ä¸Šä¸‹è½½åŸå›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;istio-envoy-sidecar-traffic-injection.jpg&#34; alt=&#34;Envoy sidecar æµé‡åŠ«æŒä¸è·¯ç”±è½¬å‘ç¤ºæ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥å¼€å§‹æ—¶ï¼Œ&lt;code&gt;productpage&lt;/code&gt; Pod ä¸­çš„ Envoy sidecar å·²ç»é€šè¿‡ EDS é€‰æ‹©å‡ºäº†è¦è¯·æ±‚çš„ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡çš„ä¸€ä¸ª Podï¼ŒçŸ¥æ™“äº†å…¶ IP åœ°å€ï¼Œå‘é€ TCP è¿æ¥è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®˜ç½‘ä¸­çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/#envoy-%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90&#34;&gt;Envoy é…ç½®æ·±åº¦è§£æ&lt;/a&gt;ä¸­æ˜¯ä»¥å‘èµ· HTTP è¯·æ±‚çš„ä¸€æ–¹æ¥è¯¦è¿° Envoy åšæµé‡è½¬å‘çš„è¿‡ç¨‹ï¼Œè€Œæœ¬æ–‡ä¸­è€ƒè™‘çš„æ˜¯æ¥å— downstream çš„æµé‡çš„ä¸€æ–¹ï¼Œå®ƒæ—¢è¦æ¥æ”¶ downstream å‘æ¥çš„è¯·æ±‚ï¼Œè‡ªå·±è¿˜éœ€è¦è¯·æ±‚å…¶ä»–æœåŠ¡ï¼Œä¾‹å¦‚ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ä¸­çš„ Pod è¿˜éœ€è¦è¯·æ±‚ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸‰ä¸ªç‰ˆæœ¬ä¸­çš„ sidecar å·¥ä½œæ­¥éª¤ç±»ä¼¼ï¼Œä¸‹æ–‡åªä»¥ &lt;code&gt;reviews-v1-cb8655c75-b97zc&lt;/code&gt; è¿™ä¸€ä¸ª Pod ä¸­çš„ Sidecar æµé‡è½¬å‘æ­¥éª¤æ¥è¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-inbound-handler&#34;&gt;ç†è§£ Inbound Handler&lt;/h2&gt;
&lt;p&gt;Inbound handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„ downstream çš„æµé‡è½¬äº¤ç»™ localhostï¼Œä¸ Pod å†…çš„åº”ç”¨ç¨‹åºå®¹å™¨å»ºç«‹è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ä¸‹ &lt;code&gt;reviews-v1-cb8655c75-b97zc&lt;/code&gt; pod ä¸­çš„ Listenerã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc listener reviews-v1-cb8655c75-b97zc&lt;/code&gt; æŸ¥çœ‹è¯¥ Pod ä¸­çš„å…·æœ‰å“ªäº› Listenerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ADDRESS            PORT      TYPE &lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;172.33.3.3         9080      HTTP &amp;lt;--- æ¥æ”¶æ‰€æœ‰ Inbound HTTP æµé‡ï¼Œè¯¥åœ°å€å³ä¸ºå½“å‰ Pod çš„ IP åœ°å€&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.0.1         443       TCP  &amp;lt;--+&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.4.253       80        TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.4.253       8080      TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.109.182     443       TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.22.50       15011     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.22.50       853       TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.79.114      443       TCP     | &lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.143.179     15011     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.0.2         53        TCP     | æ¥æ”¶ä¸ 0.0.0.0_15001 ç›‘å¬å™¨é…å¯¹çš„ Outbound é HTTP æµé‡&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.22.50       443       TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.16.64       42422     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.127.202     16686     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.22.50       31400     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.22.50       8060      TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.169.13      14267     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.169.13      14268     TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.32.134      8443      TCP     |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;10.254.118.196     443       TCP  &amp;lt;--+&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            15004     HTTP &amp;lt;--+&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            8080      HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            15010     HTTP    | &lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            8088      HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            15031     HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            9090      HTTP    | &lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            9411      HTTP    | æ¥æ”¶ä¸ 0.0.0.0_15001 é…å¯¹çš„ Outbound HTTP æµé‡&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            80        HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            15030     HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            9080      HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            9093      HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            3000      HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            8060      HTTP    |&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            9091      HTTP &amp;lt;--+    &lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;0.0.0.0            15001     TCP  &amp;lt;--- æ¥æ”¶æ‰€æœ‰ç» iptables æ‹¦æˆªçš„ Inbound å’Œ Outbound æµé‡å¹¶è½¬äº¤ç»™è™šæ‹Ÿç›‘å¬å™¨å¤„ç†&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æ¥è‡ª &lt;code&gt;productpage&lt;/code&gt; çš„æµé‡æŠµè¾¾ &lt;code&gt;reviews&lt;/code&gt; Pod çš„æ—¶å€™å·²ç»ï¼Œdownstream å¿…é¡»æ˜ç¡®çŸ¥é“ Pod çš„ IP åœ°å€ä¸º &lt;code&gt;172.33.3.3&lt;/code&gt; æ‰€ä»¥æ‰ä¼šè®¿é—®è¯¥ Podï¼Œæ‰€ä»¥è¯¥è¯·æ±‚æ˜¯ &lt;code&gt;172.33.3.3:9080&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;virtual&lt;/code&gt; Listener&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»è¯¥ Pod çš„ Listener åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ0.0.0.0:15001/TCP çš„ Listenerï¼ˆå…¶å®é™…åå­—æ˜¯ &lt;code&gt;virtual&lt;/code&gt;ï¼‰ç›‘å¬æ‰€æœ‰çš„ Inbound æµé‡ï¼Œä¸‹é¢æ˜¯è¯¥ Listener çš„è¯¦ç»†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;virtual&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;15001&lt;/span&gt;
        }
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;: [
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;: [
                {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;envoy.tcp_proxy&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: {
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;,
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;
                    }
                }
            ]
        }
    ],
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;useOriginalDst&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;UseOriginalDst&lt;/strong&gt;ï¼šä»é…ç½®ä¸­å¯ä»¥çœ‹å‡º &lt;code&gt;useOriginalDst&lt;/code&gt; é…ç½®æŒ‡å®šä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç¼ºçœä¸º falseï¼Œä½¿ç”¨ iptables é‡å®šå‘è¿æ¥æ—¶ï¼Œproxy æ¥æ”¶çš„ç«¯å£å¯èƒ½ä¸&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ç«¯å£ä¸ä¸€æ ·ï¼Œå¦‚æ­¤å¤„ proxy æ¥æ”¶çš„ç«¯å£ä¸º 15001ï¼Œè€ŒåŸå§‹ç›®çš„åœ°ç«¯å£ä¸º 9080ã€‚å½“æ­¤æ ‡å¿—è®¾ç½®ä¸º true æ—¶ï¼ŒListener å°†è¿æ¥é‡å®šå‘åˆ°ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œæ­¤å¤„ä¸º &lt;code&gt;172.33.3.3:9080&lt;/code&gt;ã€‚å¦‚æœæ²¡æœ‰ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œåˆ™è¿æ¥ç”±æ¥æ”¶å®ƒçš„ Listener å¤„ç†ï¼Œå³è¯¥ &lt;code&gt;virtual&lt;/code&gt; Listenerï¼Œç»è¿‡ &lt;code&gt;envoy.tcp_proxy&lt;/code&gt; è¿‡æ»¤å™¨å¤„ç†è½¬å‘ç»™ &lt;code&gt;BlackHoleCluster&lt;/code&gt;ï¼Œè¿™ä¸ª Cluster çš„ä½œç”¨æ­£å¦‚å®ƒçš„åå­—ï¼Œå½“ Envoy æ‰¾ä¸åˆ°åŒ¹é…çš„è™šæ‹Ÿç›‘å¬å™¨æ—¶ï¼Œå°±ä¼šå°†è¯·æ±‚å‘é€ç»™å®ƒï¼Œå¹¶è¿”å› 404ã€‚è¿™ä¸ªå°†äºä¸‹æ–‡æåˆ°çš„ Listener ä¸­è®¾ç½® &lt;code&gt;bindToPort&lt;/code&gt; ç›¸å‘¼åº”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¯¥å‚æ•°å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ Listener filter æ›¿ä»£ã€‚è¯¥å‚æ•°çš„ä¸»è¦ç”¨é€”æ˜¯ï¼šEnvoy é€šè¿‡ç›‘å¬ 15001 ç«¯å£å°† iptables æ‹¦æˆªçš„æµé‡ç»ç”±å…¶ä»– Listener å¤„ç†è€Œä¸æ˜¯ç›´æ¥è½¬å‘å‡ºå»ï¼Œè¯¦æƒ…è§ &lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#virtual-listener&#34;&gt;Virtual Listener&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener 172.33.3.3_9080&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šæ–‡è¯´åˆ°è¿›å…¥ Inbound handler çš„æµé‡è¢« &lt;code&gt;virtual&lt;/code&gt; Listener è½¬ç§»åˆ° &lt;code&gt;172.33.3.3_9080&lt;/code&gt; Listenerï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹ä¸‹è¯¥ Listener é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc listener reviews-v1-cb8655c75-b97zc --address 172.33.3.3 --port 9080 -o json&lt;/code&gt; æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;[{
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;172.33.3.3_9080&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;172.33.3.3&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
        }
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;: [
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;raw_buffer&amp;#34;&lt;/span&gt;
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;: [
                {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: {
                        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt; 
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;: {
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;: [
                                {
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: [
                                        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
                                    ],
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;,
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: [
                                        {
                                            &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
                                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: {
                                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;,
                                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;use_remote_address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
                        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
                    }
                }
            ]&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼Œ&lt;/span&gt;
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deprecatedV1&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;bindToPort&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
            }
        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tls&amp;#34;&lt;/span&gt;
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tlsContext&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;: [&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
            ]
        }
    ],
&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
}]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;bindToPort&lt;/strong&gt;ï¼šæ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.6.0/api-v1/listeners/listeners&#34;&gt;&lt;code&gt;bindToPort&lt;/code&gt;&lt;/a&gt; çš„é…ç½®ï¼Œå…¶å€¼ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œè¯¥é…ç½®çš„ç¼ºçœå€¼ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¡¨ç¤ºå°† Listener ç»‘å®šåˆ°ç«¯å£ä¸Šï¼Œæ­¤å¤„è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt; åˆ™è¯¥ Listener åªèƒ½å¤„ç†å…¶ä»– Listener è½¬ç§»è¿‡æ¥çš„æµé‡ï¼Œå³ä¸Šæ–‡æ‰€è¯´çš„ &lt;code&gt;virtual&lt;/code&gt; Listenerï¼Œæˆ‘ä»¬çœ‹å…¶ä¸­çš„ filterChains.filters ä¸­çš„ &lt;code&gt;envoy.http_connection_manager&lt;/code&gt; é…ç½®éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt; {
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;: [
                                {
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: [
                                        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
                                    ],
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;,
                                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: [
                                        {
                                            &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
                                            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: {
                                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;,
                                                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥é…ç½®è¡¨ç¤ºæµé‡å°†è½¬äº¤ç»™ Cluster &lt;code&gt;inbound|9080||reviews.default.svc.cluster.local&lt;/code&gt; å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cluster &lt;code&gt;inbound|9080||reviews.default.svc.cluster.local&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc cluster reviews-v1-cb8655c75-b97zc --fqdn reviews.default.svc.cluster.local --direction inbound -o json&lt;/code&gt; æŸ¥çœ‹è¯¥ Cluster çš„é…ç½®å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;[
    {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;connectTimeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.000s&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: [
            {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;: {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
                }
            }
        ],
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;: [
                {}
            ]
        }
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°è¯¥ Cluster çš„ Endpoint ç›´æ¥å¯¹åº”çš„å°±æ˜¯ localhostï¼Œå†ç»è¿‡ iptables è½¬å‘æµé‡å°±è¢«åº”ç”¨ç¨‹åºå®¹å™¨æ¶ˆè´¹äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-outbound-handler&#34;&gt;ç†è§£ Outbound Handler&lt;/h2&gt;
&lt;p&gt;å› ä¸º &lt;code&gt;reviews&lt;/code&gt; ä¼šå‘ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚çš„åœ°å€æ˜¯ï¼š&lt;code&gt;http://ratings.default.svc.cluster.local:9080/&lt;/code&gt;ï¼ŒOutbound handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„æœ¬åœ°åº”ç”¨ç¨‹åºå‘å‡ºçš„æµé‡ï¼Œç»ç”± Envoy åˆ¤æ–­å¦‚ä½•è·¯ç”±åˆ° upstreamã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºå®¹å™¨å‘å‡ºçš„è¯·æ±‚ä¸º Outbound æµé‡ï¼Œè¢« iptables åŠ«æŒåè½¬ç§»ç»™ Envoy  Outbound handler å¤„ç†ï¼Œç„¶åç»è¿‡ &lt;code&gt;virtual&lt;/code&gt; Listenerã€&lt;code&gt;0.0.0.0_9080&lt;/code&gt; Listenerï¼Œç„¶åé€šè¿‡ Route 9080 æ‰¾åˆ° upstream çš„ clusterï¼Œè¿›è€Œé€šè¿‡ EDS æ‰¾åˆ° Endpoint æ‰§è¡Œè·¯ç”±åŠ¨ä½œã€‚è¿™ä¸€éƒ¨åˆ†å¯ä»¥å‚è€ƒ Istio å®˜ç½‘ä¸­çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/#envoy-%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90&#34;&gt;Envoy æ·±åº¦é…ç½®è§£æ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Route 9080&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; ä¼šè¯·æ±‚ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ï¼Œè¿è¡Œ &lt;code&gt;istioctl proxy-config routes reviews-v1-cb8655c75-b97zc --name 9080 -o json&lt;/code&gt; æŸ¥çœ‹ route é…ç½®ï¼Œå› ä¸º Envoy ä¼šæ ¹æ® HTTP header ä¸­çš„ domains æ¥åŒ¹é… VirtualHostï¼Œæ‰€ä»¥ä¸‹é¢åªåˆ—ä¸¾äº† &lt;code&gt;ratings.default.svc.cluster.local:9080&lt;/code&gt; è¿™ä¸€ä¸ª VirtualHostã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;[{
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: [
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings:9080&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc.cluster&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc.cluster:9080&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc:9080&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default:9080&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10.254.234.130&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10.254.234.130:9080&amp;#34;&lt;/span&gt;
    ],
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: [
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;maxGrpcTimeout&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;perFilterConfig&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;
            }
        }
    ]
},
&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;.&lt;/span&gt;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¯¥ Virtual Host é…ç½®ä¸­å¯ä»¥çœ‹åˆ°å°†æµé‡è·¯ç”±åˆ° Cluster &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Endpoint &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio 1.1 ä»¥å‰ç‰ˆæœ¬ä¸æ”¯æŒä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤ç›´æ¥æŸ¥è¯¢ Cluster çš„ Endpointï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢ Pilot çš„ debug ç«¯ç‚¹çš„æ–¹å¼æŠ˜ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl exec reviews-v1-cb8655c75-b97zc -c istio-proxy curl http://istio-pilot.istio-system.svc.cluster.local:9093/debug/edsz &amp;gt; endpoints.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;endpoints.json&lt;/code&gt; æ–‡ä»¶ä¸­åŒ…å«äº†æ‰€æœ‰ Cluster çš„ Endpoint ä¿¡æ¯ï¼Œæˆ‘ä»¬åªé€‰å–å…¶ä¸­çš„ &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt; Cluster çš„ç»“æœå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;clusterName&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;: [
    {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;: {

      },
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lbEndpoints&amp;#34;&lt;/span&gt;: [
        {
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: {
              &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;172.33.100.2&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
              }
            }
          },
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filterMetadata&amp;#34;&lt;/span&gt;: {
              &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;: {
                  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;uid&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kubernetes://ratings-v1-8558d4458d-ns6lk.default&amp;#34;&lt;/span&gt;
                }
            }
          }
        }
      ]
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Endpoint å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ŒEnvoy å°†æ ¹æ®ä¸€å®šè§„åˆ™é€‰æ‹©é€‚å½“çš„ Endpoint æ¥è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šIstio 1.1 å°†æ”¯æŒ &lt;code&gt;istioctl pc endpoint&lt;/code&gt; å‘½ä»¤æ¥æŸ¥è¯¢ Endpointã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/&#34;&gt;è°ƒè¯• Envoy å’Œ Pilot - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/&#34;&gt;Istioæµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ - zhaohuabing.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: Istioä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹</title>
      <link>https://jimmysong.io/blog/istio-service-and-traffic-model/</link>
      <pubDate>Mon, 17 Dec 2018 21:37:35 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-service-and-traffic-model/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚è™½ç„¶ Istio ä¸€å¼€å§‹ç¡®å®šçš„æŠ½è±¡æ¨¡å‹ä¸å¯¹æ¥çš„åº•å±‚å¹³å°æ— å…³ï¼Œä½†ç›®å‰æ¥çœ‹åŸºæœ¬ç»‘å®š Kubernetesï¼Œæœ¬æ–‡ä»…ä»¥ Kubernetes è¯´æ˜ã€‚å¦å¤–åœ¨ &lt;a href=&#34;http://www.servicemesher.com&#34;&gt;ServiceMesher ç¤¾åŒº&lt;/a&gt;ä¸­æœ€è¿‘æœ‰å¾ˆå¤šå…³äº Istioã€Envoyã€Kubernetes ä¹‹ä¸­çš„æœåŠ¡æ¨¡å‹å…³ç³»çš„è®¨è®ºï¼Œæœ¬æ–‡ä½œä¸ºä¸€ä¸ªå¼€ç¯‡è¯´æ˜ï¼ŒKubernetes å’Œ Isito ä¹‹é—´æœ‰å“ªäº›å…±æœ‰çš„æœåŠ¡æ¨¡å‹ï¼ŒIstio åœ¨ Kubernetes çš„æœåŠ¡æ¨¡å‹ä¹‹ä¸Šåˆå¢åŠ äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;**æœåŠ¡å…·æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚**åœ¨ CI/CD è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªæœåŠ¡å¯èƒ½åŒæ—¶éƒ¨ç½²åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œå¦‚å¼€å‘ã€ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒç­‰ï¼Œè¿™äº›æœåŠ¡ç‰ˆæœ¬ä¸ä¸€å®šå…·æœ‰ä¸åŒçš„ APIï¼Œå¯èƒ½åªæ˜¯ä¸€äº›å°çš„æ›´æ”¹å¯¼è‡´çš„è¿­ä»£ç‰ˆæœ¬ã€‚åœ¨ A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒä¸­ç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸-istio-ä¸­å…±æœ‰çš„æ¨¡å‹&#34;&gt;Kubernetes ä¸ Istio ä¸­å…±æœ‰çš„æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;å› ä¸º Istio åŸºæœ¬å°±æ˜¯ç»‘å®šåœ¨ Kubernetes ä¸Šï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ Kubernetes åŠ Istio ä¸­å…±æœ‰çš„æœåŠ¡æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­ iptables ä»£ç†æ¨¡å¼ï¼ˆå¦å¤–è¿˜æœ‰ IPVS æ¨¡å¼ï¼‰ä¸‹çš„ service ï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨ kube-proxy ä¸­é…ç½®ç®€å•çš„è´Ÿè½½å‡è¡¡ï¼Œå¯¹æ•´ä¸ª node ç”Ÿæ•ˆï¼Œæ— æ³•é…ç½®åˆ°å•ä¸ªæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œå…¶ä»–å¾®æœåŠ¡çš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚ç†”æ–­ã€é™æµã€è¿½è¸ªç­‰ï¼Œè¿™äº›åŠŸèƒ½åªèƒ½åœ¨åº”ç”¨ä¸­å®ç°äº†ï¼Œè€Œåœ¨ Istio çš„æ¦‚å¿µæ¨¡å‹ä¸­å®Œå…¨å»æ‰äº† &lt;code&gt;kube-proxy&lt;/code&gt;  è¿™ä¸ªç»„ä»¶ï¼Œå°†å…¶åˆ†æ•£åˆ°æ¯ä¸ªåº”ç”¨ Pod ä¸­åŒæ—¶éƒ¨ç½²çš„ Envoy ä¸­å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢åˆ—ä¸¾çš„æ˜¯ Kubernetes å’Œ Istio ä¸­å…±æœ‰çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;service&#34;&gt;Service&lt;/h3&gt;
&lt;p&gt;è¿™å®é™…ä¸Šè·Ÿ Kubernetes ä¸­çš„ service æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34;&gt;Kubernetes ä¸­çš„ service&lt;/a&gt;ã€‚Istio æ¨å‡ºäº†æ¯” service æ›´å¤æ‚çš„æ¨¡å‹ &lt;code&gt;VirtualService&lt;/code&gt;ï¼Œè¿™ä¸å•çº¯æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡å®šä¹‰äº†ï¼Œè€Œæ˜¯åœ¨æœåŠ¡ä¹‹ä¸Šå®šä¹‰äº†è·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå®Œå…¨é™å®šçš„åŸŸåï¼ˆFQDNï¼‰ï¼Œç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ã€‚æœåŠ¡è¿˜å¯ä»¥æœ‰ä¸å…¶ç›¸å…³è”çš„å•ä¸ªè´Ÿè½½å‡è¡¡å™¨æˆ–è™šæ‹Ÿ IP åœ°å€ã€‚é’ˆå¯¹ FQDN çš„ DNS æŸ¥è¯¢å°†è§£æä¸ºè¯¥è´Ÿè½½å‡è¡¡å™¨æˆ–è€…è™šæ‹Ÿ IP çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ Kubernetes ä¸­ä¸€ä¸ªæœåŠ¡ä¸º &lt;code&gt;foo.default.svc.cluster.local hostname&lt;/code&gt;ï¼Œè™šæ‹Ÿ IP /ClusterIP æ˜¯ 10.0.1.1ï¼Œç›‘å¬çš„ç«¯å£æ˜¯ 80 å’Œ 8080ã€‚&lt;/p&gt;
&lt;h3 id=&#34;endpoint&#34;&gt;Endpoint&lt;/h3&gt;
&lt;p&gt;è¿™é‡ŒæŒ‡çš„æ˜¯ Kubernetes ä¸­çš„ endpointï¼Œä¸€ä¸ª endpoint æ˜¯å®ç°äº†æŸæœåŠ¡çš„å…·ä½“å®ä¾‹ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª Endpointï¼Œè¡¨ç¤ºä¸º IP åœ°å€åŠ ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä¸º DNS åç§°åŠ ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®åˆ°åº•å“ªäº›å®ä¾‹å±äºåŒä¸€ä¸ª serviceï¼Œè¿˜æ˜¯éœ€è¦ é€šè¿‡ label åŒ¹é…æ¥é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;label&#34;&gt;Label&lt;/h3&gt;
&lt;p&gt;æœåŠ¡çš„ç‰ˆæœ¬ã€å¯¹åº”çš„å¼•ç”¨åç§°ç­‰æ˜¯é€šè¿‡ label æ¥æ ‡è®°çš„ï¼Œä¾‹å¦‚ä¸‹é¢ Kubernetes ä¸­ä¸€ä¸ªåº”ç”¨çš„ YAML é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;apiVersion&lt;/span&gt;: extensions/v1beta1
&lt;span style=&#34;color:#66d9ef&#34;&gt;kind&lt;/span&gt;: Deployment
&lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: ratings-v1
&lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;replicas&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: ratings
        &lt;span style=&#34;color:#66d9ef&#34;&gt;version&lt;/span&gt;: v1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;containers&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: ratings
        &lt;span style=&#34;color:#66d9ef&#34;&gt;image&lt;/span&gt;: istio/examples-bookinfo-ratings-v1:&lt;span style=&#34;color:#ae81ff&#34;&gt;1.8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;imagePullPolicy&lt;/span&gt;: IfNotPresent
        &lt;span style=&#34;color:#66d9ef&#34;&gt;ports&lt;/span&gt;:
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;containerPort&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;version: v1&lt;/code&gt; æ ‡è®°è¯¥æœåŠ¡æ˜¯ v1 ç‰ˆæœ¬ï¼Œ&lt;code&gt;version&lt;/code&gt; æ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„æ ‡ç­¾ï¼Œå»ºè®®å¤§å®¶çš„æœåŠ¡ä¸Šéƒ½å¸¦ä¸Šè¯¥æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶æœåŠ¡çš„ label å¯ä»¥è®¾ç½®ä»»æ„å¤šä¸ªï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨åšè·¯ç”±çš„æ—¶å€™å¯ä»¥æ ¹æ®æ ‡ç­¾åŒ¹é…æ¥åšç»†ç²’åº¦çš„æµé‡åˆ’åˆ†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶é¢æ¿-envoy&#34;&gt;æ§åˆ¶é¢æ¿ Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio ä¸­é»˜è®¤çš„ proxy sidecarï¼Œè´Ÿè´£æœåŠ¡é—´çš„æµé‡ç®¡æ§ã€è®¤è¯ä¸å®‰å…¨åŠ å¯†ã€å¯è§‚å¯Ÿæ€§ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;envoy-arch-20190114.png&#34; alt=&#34;Envoyæ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ Envoy çš„æ¶æ„å›¾ï¼Œæˆ‘å†ç»™å¤§å®¶ä»‹ç» Envoy ä¸­çš„å¦‚ä¸‹å‡ ä¸ªé‡è¦æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster&#34;&gt;Cluster&lt;/h3&gt;
&lt;p&gt;é›†ç¾¤ï¼ˆclusterï¼‰æ˜¯ Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;å‘ç°é›†ç¾¤ä¸­çš„æˆå‘˜ã€‚Envoy å¯ä»¥é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking#arch-overview-health-checking&#34;&gt;ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶å†µã€‚Envoy å¦‚ä½•å°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤æˆå‘˜ç”±&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing#arch-overview-load-balancing&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;ç¡®å®šã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¸ Kubernetes ä¸­çš„ Service æ¦‚å¿µç±»ä¼¼ï¼Œåªä¸è¿‡ Kubernetes ä¸­çš„æœåŠ¡å‘ç°ä¸­å¹¶ä¸åŒ…å«å¥åº·çŠ¶å†µæ£€æŸ¥ï¼Œè€Œæ˜¯é€šè¿‡&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34;&gt;é…ç½® Pod çš„ liveness å’Œ readiness æ¢é’ˆ&lt;/a&gt;æ¥å®ç°ï¼ŒæœåŠ¡å‘ç°é»˜è®¤ä¹Ÿæ˜¯é€šè¿‡ DNS æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener&#34;&gt;Listener&lt;/h3&gt;
&lt;p&gt;ç›‘å¬å™¨ï¼ˆlistenerï¼‰æ˜¯å¯ä»¥ç”±ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥çš„å‘½åç½‘ç»œä½ç½®ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unixåŸŸå¥—æ¥å­—ç­‰ï¼‰ã€‚Envoy å…¬å¼€ä¸€ä¸ªæˆ–å¤šä¸ªä¸‹æ¸¸ä¸»æœºè¿æ¥çš„ä¾¦å¬å™¨ã€‚ä¸€èˆ¬æ˜¯æ¯å°ä¸»æœºè¿è¡Œä¸€ä¸ª Envoyï¼Œä½¿ç”¨å•è¿›ç¨‹è¿è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨ä»»æ„æ•°é‡çš„ Listenerï¼ˆç›‘å¬å™¨ï¼‰ï¼Œç›®å‰åªç›‘å¬ TCPï¼Œæ¯ä¸ªç›‘å¬å™¨éƒ½ç‹¬ç«‹é…ç½®ä¸€å®šæ•°é‡çš„ï¼ˆL3/L4ï¼‰ç½‘ç»œè¿‡æ»¤å™¨ã€‚Listenter ä¹Ÿå¯ä»¥é€šè¿‡ Listener Discovery Serviceï¼ˆ&lt;strong&gt;LDS&lt;/strong&gt;ï¼‰åŠ¨æ€è·å–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener-filter&#34;&gt;Listener filter&lt;/h3&gt;
&lt;p&gt;Listener ä½¿ç”¨ listener filterï¼ˆç›‘å¬å™¨è¿‡æ»¤å™¨ï¼‰æ¥æ“ä½œé“¾æ¥çš„å…ƒæ•°æ®ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨ä¸æ›´æ”¹ Envoy çš„æ ¸å¿ƒåŠŸèƒ½çš„æƒ…å†µä¸‹æ·»åŠ æ›´å¤šçš„é›†æˆåŠŸèƒ½ã€‚Listener filter çš„ API ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºè¿™äº›è¿‡æ»¤å™¨æœ€ç»ˆæ˜¯åœ¨æ–°æ¥å—çš„å¥—æ¥å­—ä¸Šè¿è¡Œã€‚åœ¨é“¾ä¸­å¯ä»¥äº’ç›¸è¡”æ¥ä»¥æ”¯æŒæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚è°ƒç”¨é€Ÿç‡é™åˆ¶ã€‚Envoy å·²ç»åŒ…å«äº†å¤šä¸ªç›‘å¬å™¨è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­å¢åŠ çš„æµé‡æ¨¡å‹&#34;&gt;Istio ä¸­å¢åŠ çš„æµé‡æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;VirtualService&lt;/code&gt;ã€&lt;code&gt;DestinationRule&lt;/code&gt;ã€&lt;code&gt;Gateway&lt;/code&gt;ã€&lt;code&gt;ServiceEntry&lt;/code&gt; å’Œ &lt;code&gt;EnvoyFilter&lt;/code&gt; éƒ½æ˜¯ Istio ä¸­ä¸ºæµé‡ç®¡ç†æ‰€åˆ›å»ºçš„ CRDï¼Œè¿™äº›æ¦‚å¿µå…¶å®æ˜¯åšè·¯ç”±ç®¡ç†ï¼Œè€Œ Kubernetes ä¸­çš„ service åªæ˜¯ç”¨æ¥åšæœåŠ¡å‘ç°ï¼Œæ‰€ä»¥ä»¥ä¸Šå…¶å®ä¹Ÿä¸èƒ½æˆä¸º Istio ä¸­çš„æœåŠ¡æ¨¡å‹ï¼Œä½†å…¶å®å®ƒä»¬ä¹Ÿæ˜¯ç”¨æ¥ç®¡ç†æœåŠ¡çš„ï¼Œå¦‚æœæµé‡ä¸èƒ½è·¯ç”±çš„åˆ›å»ºçš„æœåŠ¡ä¸Šé¢å»ï¼Œé‚£æœåŠ¡çš„å­˜åœ¨åˆæœ‰ä½•æ„ä¹‰ï¼Ÿåœ¨ Service Mesh çœŸæ­£çš„æœåŠ¡æ¨¡å‹è¿˜æ˜¯å¾—ä» Envoy çš„ &lt;a href=&#34;http://www.servicemesher.com/blog/envoy-xds-protocol/&#34;&gt;xDS åè®®&lt;/a&gt;æ¥çœ‹ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æœåŠ¡çš„æµé‡æ²»ç†ï¼ŒæœåŠ¡çš„æ–­ç‚¹æ˜¯é€šè¿‡ EDS æ¥é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;istio-pilot.png&#34; alt=&#34;Istio pilot æ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ Pilot è®¾è®¡å›¾ï¼Œæ¥è‡ª&lt;a href=&#34;https://github.com/istio/old_pilot_repo/blob/master/doc/design.md&#34;&gt;Istio Pilot design overview&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;routing&#34;&gt;Routing&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­çš„ service æ˜¯æ²¡æœ‰ä»»ä½•è·¯ç”±å±æ€§å¯ä»¥é…ç½®çš„ï¼ŒIstio åœ¨è®¾è®¡ä¹‹åˆå°±é€šè¿‡åœ¨åŒä¸€ä¸ª Pod ä¸­ï¼Œåœ¨åº”ç”¨å®¹å™¨æ—è¿è¡Œä¸€ä¸ª sidecar proxy æ¥é€æ˜å¾—å®ç°ç»†ç²’åº¦çš„è·¯ç”±æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;virtualservice&#34;&gt;VirtualService&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;VirtualService&lt;/code&gt; å®šä¹‰é’ˆå¯¹æŒ‡å®šæœåŠ¡æµé‡çš„è·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½é’ˆå¯¹ç‰¹å®šåè®®çš„åŒ¹é…è§„åˆ™ã€‚å¦‚æœæµé‡ç¬¦åˆè¿™äº›ç‰¹å¾ï¼Œå°±ä¼šæ ¹æ®è§„åˆ™å‘é€åˆ°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ç›®æ ‡æœåŠ¡ï¼ˆæˆ–è€…ç›®æ ‡æœåŠ¡çš„å­é›†æˆ–ç‰ˆæœ¬ï¼‰ã€‚å¯¹äº A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒç­‰åœºæ™¯ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨åˆ’åˆ† &lt;code&gt;subset&lt;/code&gt;ï¼ŒVirtualService ä¸­æ ¹æ® destination ä¸­çš„ subset é…ç½®æ¥é€‰æ‹©è·¯ç”±ï¼Œä½†æ˜¯è¿™äº› subset ç©¶ç«Ÿå¯¹åº”å“ªäº›æœåŠ¡ç¤ºä¾‹ï¼Œè¿™å°±éœ€è¦ &lt;code&gt;DestionationRule&lt;/code&gt;ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#virtualservice&#34;&gt;VirtualService&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;destinationrule&#34;&gt;DestinationRule&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;DestinationRule&lt;/code&gt; æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#destinationrule&#34;&gt;DestinationRule&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;gateway&#34;&gt;Gateway&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Gateway&lt;/code&gt; æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½ç½‘æ ¼è¾¹ç¼˜çš„è¿›å…¥å’Œå‘å‡ºè¿æ¥ã€‚è¿™ä¸€è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£ï¼Œä»¥åŠè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯å®šä¹‰æœåŠ¡ç½‘æ ¼çš„è¾¹ç¼˜è·¯ç”±ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#gateway&#34;&gt;Gateway&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;serviceentry&#34;&gt;ServiceEntry&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ServiceEntry&lt;/code&gt; èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚&lt;code&gt;ServiceEntry&lt;/code&gt; æè¿°äº†æœåŠ¡çš„å±æ€§ï¼ˆDNS åç§°ã€VIPã€ç«¯å£ã€åè®®ä»¥åŠç«¯ç‚¹ï¼‰ã€‚è¿™ç±»æœåŠ¡å¯èƒ½æ˜¯ç½‘æ ¼å¤–çš„ APIï¼Œæˆ–è€…æ˜¯å¤„äºç½‘æ ¼å†…éƒ¨ä½†å´ä¸å­˜åœ¨äºå¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ¡ç›®ï¼ˆä¾‹å¦‚éœ€è¦å’Œ Kubernetes æœåŠ¡æ²Ÿé€šçš„ä¸€ç»„è™šæ‹ŸæœºæœåŠ¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰é…ç½® ServiceEntry çš„è¯ï¼ŒIstio å®é™…ä¸Šæ˜¯æ— æ³•å‘ç°æœåŠ¡ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoyfilter&#34;&gt;EnvoyFilter&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt; å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸€åŠŸèƒ½ä¸€å®šè¦è°¨æ…ä½¿ç”¨ã€‚é”™è¯¯çš„é…ç½®å†…å®¹ä¸€æ—¦å®Œæˆä¼ æ’­ï¼Œå¯èƒ½ä¼šä»¤æ•´ä¸ªæœåŠ¡ç½‘æ ¼è¿›å…¥ç˜«ç—ªçŠ¶æ€ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#envoyfilter&#34;&gt;EnvoyFilter&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä¸­çš„ listener å¯ä»¥é…ç½®å¤šä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listener_filters&#34;&gt;filter&lt;/a&gt;ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é€šè¿‡ Istio æ¥æ‰©å±• Envoy çš„æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34;&gt;Kubernetes ä¸­çš„ service - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/old_pilot_repo/blob/master/doc/service-registry.md&#34;&gt;Istio services model - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3&#34;&gt;æµé‡è·¯ç”± - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ</title>
      <link>https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/</link>
      <pubDate>Tue, 11 Sep 2018 10:39:42 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/</guid>
      <description>
        
        
        &lt;blockquote&gt;
&lt;p&gt;ä»¥å¾€æœ‰å¾ˆå¤šæ–‡ç« è®²è§£ Istio æ˜¯å¦‚ä½•åš Sidecar æ³¨å…¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰è®²è§£æ³¨å…¥ä¹‹å Sidecar å·¥ä½œçš„ç»†èŠ‚ã€‚æœ¬æ–‡å°†å¸¦å¤§å®¶è¯¦ç»†äº†è§£ Istio æ˜¯å¦‚ä½•å°† Envoy ä½œä¸º Sidecar çš„æ–¹å¼æ³¨å…¥åˆ°åº”ç”¨ç¨‹åº Pod ä¸­ï¼ŒåŠ Sidecar æ˜¯å¦‚ä½•åšåŠ«æŒæµé‡çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨è®²è§£ Istio å¦‚ä½•å°† Envoy ä»£ç†æ³¨å…¥åˆ°åº”ç”¨ç¨‹åº Pod ä¸­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar æ¨¡å¼ï¼šå®¹å™¨åº”ç”¨æ¨¡å¼ä¹‹ä¸€ï¼ŒService Mesh æ¶æ„çš„ä¸€ç§å®ç°æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;Init å®¹å™¨ï¼šPod ä¸­çš„ä¸€ç§ä¸“ç”¨çš„å®¹å™¨ï¼Œåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;iptablesï¼šæµé‡åŠ«æŒæ˜¯é€šè¿‡ iptables è½¬å‘å®ç°çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥çœ‹ç›®å‰ &lt;code&gt;productpage-v1-745ffc55b7-2l2lw&lt;/code&gt; Pod ä¸­è¿è¡Œçš„å®¹å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ kubectl -n default get pod productpage-v1-745ffc55b7-2l2lw -o&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{..spec.containers[*].name}&amp;#39;&lt;/span&gt;
productpage istio-proxy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;productpage&lt;/code&gt; å³åº”ç”¨å®¹å™¨ï¼Œ&lt;code&gt;istio-proxy&lt;/code&gt; å³ Envoy ä»£ç†çš„ sidecar å®¹å™¨ã€‚å¦å¤–è¯¥ Pod ä¸­å®é™…ä¸Šè¿˜è¿è¡Œè¿‡ä¸€ä¸ª Init å®¹å™¨ï¼Œå› ä¸ºå®ƒæ‰§è¡Œç»“æŸå°±è‡ªåŠ¨ç»ˆæ­¢äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸åˆ°è¯¥å®¹å™¨çš„å­˜åœ¨ã€‚å…³æ³¨ &lt;code&gt;jsonpath&lt;/code&gt; çš„ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://kubernetes.io/docs/reference/kubectl/jsonpath/&#34;&gt;JSONPath Support&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ¨¡å¼&#34;&gt;Sidecar æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;åœ¨äº†è§£ Istio ä½¿ç”¨ Sidecar æ³¨å…¥ä¹‹å‰ï¼Œéœ€è¦å…ˆè¯´æ˜ä¸‹ä»€ä¹ˆæ˜¯ Sidecar æ¨¡å¼ã€‚Sidecar æ˜¯å®¹å™¨åº”ç”¨æ¨¡å¼çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯åœ¨ Service Mesh ä¸­å‘æ‰¬å…‰å¤§çš„ä¸€ç§æ¨¡å¼ï¼Œè¯¦è§ &lt;a href=&#34;http://www.servicemesher.com/blog/service-mesh-architectures/&#34;&gt;Service Mesh æ¶æ„è§£æ&lt;/a&gt;ï¼Œå…¶ä¸­è¯¦ç»†æè¿°äº†&lt;strong&gt;èŠ‚ç‚¹ä»£ç†&lt;/strong&gt;å’Œ &lt;strong&gt;Sidecar&lt;/strong&gt; æ¨¡å¼çš„ Service Mesh æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Sidecar æ¨¡å¼éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶ï¼Œæ— éœ€åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œä»£ç†ï¼ˆå› æ­¤æ‚¨ä¸éœ€è¦åŸºç¡€ç»“æ„çš„åä½œï¼‰ï¼Œä½†æ˜¯é›†ç¾¤ä¸­å°†è¿è¡Œå¤šä¸ªç›¸åŒçš„ Sidecar å‰¯æœ¬ã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼šæˆ‘å¯ä»¥ä¸ºä¸€ç»„å¾®æœåŠ¡éƒ¨ç½²åˆ°ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥éƒ¨ç½²ä¸€ä¸ªæœ‰ç‰¹å®šå®ç°çš„æœåŠ¡ç½‘æ ¼ã€‚åœ¨ Sidecar éƒ¨ç½²æ–¹å¼ä¸­ï¼Œä½ ä¼šä¸ºæ¯ä¸ªåº”ç”¨çš„å®¹å™¨éƒ¨ç½²ä¸€ä¸ªä¼´ç”Ÿå®¹å™¨ã€‚Sidecar æ¥ç®¡è¿›å‡ºåº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡ã€‚åœ¨ Kubernetes çš„ Pod ä¸­ï¼Œåœ¨åŸæœ‰çš„åº”ç”¨å®¹å™¨æ—è¾¹è¿è¡Œä¸€ä¸ª Sidecar å®¹å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªå®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºï¼Œå¯ä»¥å¹¿ä¹‰çš„å°†è¿™ä¸ªæ³¨å…¥äº† Sidecar å®¹å™¨çš„ Pod ç†è§£ä¸ºä¸€å°ä¸»æœºï¼Œä¸¤ä¸ªå®¹å™¨å…±äº«ä¸»æœºèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä¸‹å›¾ &lt;a href=&#34;https://jimmysong.io/posts/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial/&#34;&gt;SOFAMesh &amp;amp; SOFA MOSNâ€”åŸºäºIstioæ„å»ºçš„ç”¨äºåº”å¯¹å¤§è§„æ¨¡æµé‡çš„Service Meshè§£å†³æ–¹æ¡ˆ&lt;/a&gt;çš„æ¶æ„å›¾ä¸­æè¿°çš„ï¼ŒMOSN ä½œä¸º Sidecar çš„æ–¹å¼å’Œåº”ç”¨è¿è¡Œåœ¨åŒä¸€ä¸ª Pod ä¸­ï¼Œæ‹¦æˆªæ‰€æœ‰è¿›å‡ºåº”ç”¨å®¹å™¨çš„æµé‡ï¼Œ&lt;a href=&#34;https://github.com/alipay/sofa-mesh&#34;&gt;SOFAMesh&lt;/a&gt; å…¼å®¹ Istioï¼Œå…¶ä¸­ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„ &lt;a href=&#34;https://github.com/alipay/sofa-mosn&#34;&gt;SOFAMosn&lt;/a&gt; æ›¿æ¢äº† Envoyã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006y8mN6ly1g81hmkxqxaj30va0qg758.jpg&#34; alt=&#34;SOFAMeshæ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸‹æ–‡ä¸­æ‰€æŒ‡çš„ Sidecar éƒ½æ˜¯æŒ‡çš„ Envoy ä»£ç†å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;init-å®¹å™¨&#34;&gt;Init å®¹å™¨&lt;/h2&gt;
&lt;p&gt;Init å®¹å™¨æ˜¯ä¸€ç§ä¸“ç”¨å®¹å™¨ï¼Œå®ƒåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª Pod ä¸­å¯ä»¥æŒ‡å®šå¤šä¸ª Init å®¹å™¨ï¼Œå¦‚æœæŒ‡å®šäº†å¤šä¸ªï¼Œé‚£ä¹ˆ Init å®¹å™¨å°†ä¼šæŒ‰é¡ºåºä¾æ¬¡è¿è¡Œã€‚åªæœ‰å½“å‰é¢çš„ Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸåï¼Œæ‰å¯ä»¥è¿è¡Œä¸‹ä¸€ä¸ª Init å®¹å™¨ã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆåï¼ŒKubernetes æ‰åˆå§‹åŒ– Pod å’Œè¿è¡Œåº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨ä½¿ç”¨ Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œå®ƒä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—® Secret çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºå®¹å™¨åˆ™ä¸èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Pod å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒInit å®¹å™¨ä¼šæŒ‰é¡ºåºåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åå¯åŠ¨ã€‚æ¯ä¸ªå®¹å™¨å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸé€€å‡ºã€‚å¦‚æœç”±äºè¿è¡Œæ—¶æˆ–å¤±è´¥é€€å‡ºï¼Œå°†å¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå®ƒä¼šæ ¹æ® Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; æŒ‡å®šçš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; è®¾ç½®ä¸º Alwaysï¼ŒInit å®¹å™¨å¤±è´¥æ—¶ä¼šä½¿ç”¨ &lt;code&gt;RestartPolicy&lt;/code&gt; ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ‰€æœ‰çš„ Init å®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼ŒPod å°†ä¸ä¼šå˜æˆ &lt;code&gt;Ready&lt;/code&gt; çŠ¶æ€ã€‚Init å®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨ Service ä¸­è¿›è¡Œèšé›†ã€‚ æ­£åœ¨åˆå§‹åŒ–ä¸­çš„ Pod å¤„äº &lt;code&gt;Pending&lt;/code&gt; çŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°† &lt;code&gt;Initializing&lt;/code&gt; çŠ¶æ€è®¾ç½®ä¸º trueã€‚Init å®¹å™¨è¿è¡Œå®Œæˆä»¥åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Init å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥ç¤ºä¾‹åˆ†æ&#34;&gt;Sidecar æ³¨å…¥ç¤ºä¾‹åˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹ Istio å®˜æ–¹ç¤ºä¾‹ &lt;code&gt;bookinfo&lt;/code&gt; ä¸­ &lt;code&gt;productpage&lt;/code&gt;  çš„ YAML é…ç½®ï¼Œå…³äº &lt;code&gt;bookinfo&lt;/code&gt; åº”ç”¨çš„è¯¦ç»† YAML é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster/blob/master/yaml/istio-bookinfo/bookinfo.yaml&#34;&gt;bookinfo.yaml&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;apiVersion&lt;/span&gt;: v1
&lt;span style=&#34;color:#66d9ef&#34;&gt;kind&lt;/span&gt;: Service
&lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: productpage
  &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: productpage
&lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;ports&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;port&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: http
  &lt;span style=&#34;color:#66d9ef&#34;&gt;selector&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: productpage
---
&lt;span style=&#34;color:#66d9ef&#34;&gt;apiVersion&lt;/span&gt;: extensions/v1beta1
&lt;span style=&#34;color:#66d9ef&#34;&gt;kind&lt;/span&gt;: Deployment
&lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: productpage-v1
&lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;replicas&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: productpage
        &lt;span style=&#34;color:#66d9ef&#34;&gt;version&lt;/span&gt;: v1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;containers&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: productpage
        &lt;span style=&#34;color:#66d9ef&#34;&gt;image&lt;/span&gt;: istio/examples-bookinfo-productpage-v1:&lt;span style=&#34;color:#ae81ff&#34;&gt;1.8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;imagePullPolicy&lt;/span&gt;: IfNotPresent
        &lt;span style=&#34;color:#66d9ef&#34;&gt;ports&lt;/span&gt;:
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;containerPort&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æŸ¥çœ‹ä¸‹ &lt;code&gt;productpage&lt;/code&gt; å®¹å™¨çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/samples/bookinfo/src/productpage/Dockerfile&#34;&gt;Dockerfile&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; python:2.7-slim&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; requirements.txt ./&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; pip install --no-cache-dir -r requirements.txt&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; productpage.py /opt/microservices/&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; templates /opt/microservices/templates&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; requirements.txt /opt/microservices/&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPOSE&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; 9080&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;WORKDIR&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; /opt/microservices&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CMD&lt;/span&gt; python productpage.py &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;Dockerfile&lt;/code&gt; ä¸­æ²¡æœ‰é…ç½® &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œæ‰€ä»¥ &lt;code&gt;CMD&lt;/code&gt; çš„é…ç½® &lt;code&gt;python productpage.py 9080&lt;/code&gt;  å°†ä½œä¸ºé»˜è®¤çš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼Œå†çœ‹ä¸‹æ³¨å…¥ sidecar ä¹‹åçš„é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ istioctl kube-inject -f yaml/istio-bookinfo/bookinfo.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åªæˆªå–å…¶ä¸­ä¸ &lt;code&gt;productpage&lt;/code&gt; ç›¸å…³çš„ &lt;code&gt;Service&lt;/code&gt; å’Œ &lt;code&gt;Deployment&lt;/code&gt; é…ç½®éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;apiVersion&lt;/span&gt;: v1
&lt;span style=&#34;color:#66d9ef&#34;&gt;kind&lt;/span&gt;: Service
&lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: productpage
  &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: productpage
&lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;ports&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;port&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: http
  &lt;span style=&#34;color:#66d9ef&#34;&gt;selector&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: productpage
---
&lt;span style=&#34;color:#66d9ef&#34;&gt;apiVersion&lt;/span&gt;: extensions/v1beta1
&lt;span style=&#34;color:#66d9ef&#34;&gt;kind&lt;/span&gt;: Deployment
&lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;creationTimestamp&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: productpage-v1
&lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;replicas&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;strategy&lt;/span&gt;: {}
  &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;annotations&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;sidecar.istio.io/status&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{&amp;#34;version&amp;#34;:&amp;#34;fde14299e2ae804b95be08e0f2d171d466f47983391c00519bbf01392d9ad6bb&amp;#34;,&amp;#34;initContainers&amp;#34;:[&amp;#34;istio-init&amp;#34;],&amp;#34;containers&amp;#34;:[&amp;#34;istio-proxy&amp;#34;],&amp;#34;volumes&amp;#34;:[&amp;#34;istio-envoy&amp;#34;,&amp;#34;istio-certs&amp;#34;],&amp;#34;imagePullSecrets&amp;#34;:null}&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;creationTimestamp&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;app&lt;/span&gt;: productpage
        &lt;span style=&#34;color:#66d9ef&#34;&gt;version&lt;/span&gt;: v1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;containers&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;image&lt;/span&gt;: istio/examples-bookinfo-productpage-v1:&lt;span style=&#34;color:#ae81ff&#34;&gt;1.8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;imagePullPolicy&lt;/span&gt;: IfNotPresent
        &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: productpage
        &lt;span style=&#34;color:#66d9ef&#34;&gt;ports&lt;/span&gt;:
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;containerPort&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;resources&lt;/span&gt;: {}
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;args&lt;/span&gt;:
        - proxy
        - sidecar
        - --configPath
        - /etc/istio/proxy
        - --binaryPath
        - /usr/local/bin/envoy
        - --serviceCluster
        - productpage
        - --drainDuration
        - 45s
        - --parentShutdownDuration
        - 1m0s
        - --discoveryAddress
        - istio-pilot.istio-system:&lt;span style=&#34;color:#ae81ff&#34;&gt;15007&lt;/span&gt;
        - --discoveryRefreshDelay
        - 1s
        - --zipkinAddress
        - zipkin.istio-system:&lt;span style=&#34;color:#ae81ff&#34;&gt;9411&lt;/span&gt;
        - --connectTimeout
        - 10s
        - --statsdUdpAddress
        - istio-statsd-prom-bridge.istio-system:&lt;span style=&#34;color:#ae81ff&#34;&gt;9125&lt;/span&gt;
        - --proxyAdminPort
        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;15000&amp;#34;&lt;/span&gt;
        - --controlPlaneAuthPolicy
        - NONE
        &lt;span style=&#34;color:#66d9ef&#34;&gt;env&lt;/span&gt;:
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: POD_NAME
          &lt;span style=&#34;color:#66d9ef&#34;&gt;valueFrom&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldRef&lt;/span&gt;:
              &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldPath&lt;/span&gt;: metadata.name
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: POD_NAMESPACE
          &lt;span style=&#34;color:#66d9ef&#34;&gt;valueFrom&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldRef&lt;/span&gt;:
              &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldPath&lt;/span&gt;: metadata.namespace
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: INSTANCE_IP
          &lt;span style=&#34;color:#66d9ef&#34;&gt;valueFrom&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldRef&lt;/span&gt;:
              &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldPath&lt;/span&gt;: status.podIP
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: ISTIO_META_POD_NAME
          &lt;span style=&#34;color:#66d9ef&#34;&gt;valueFrom&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldRef&lt;/span&gt;:
              &lt;span style=&#34;color:#66d9ef&#34;&gt;fieldPath&lt;/span&gt;: metadata.name
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: ISTIO_META_INTERCEPTION_MODE
          &lt;span style=&#34;color:#66d9ef&#34;&gt;value&lt;/span&gt;: REDIRECT
        &lt;span style=&#34;color:#66d9ef&#34;&gt;image&lt;/span&gt;: jimmysong/istio-release-proxyv2:&lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;imagePullPolicy&lt;/span&gt;: IfNotPresent
        &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: istio-proxy
        &lt;span style=&#34;color:#66d9ef&#34;&gt;resources&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;requests&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;cpu&lt;/span&gt;: 10m
        &lt;span style=&#34;color:#66d9ef&#34;&gt;securityContext&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;privileged&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
          &lt;span style=&#34;color:#66d9ef&#34;&gt;readOnlyRootFilesystem&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
          &lt;span style=&#34;color:#66d9ef&#34;&gt;runAsUser&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1337&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;volumeMounts&lt;/span&gt;:
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;mountPath&lt;/span&gt;: /etc/istio/proxy
          &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: istio-envoy
        - &lt;span style=&#34;color:#66d9ef&#34;&gt;mountPath&lt;/span&gt;: /etc/certs/
          &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: istio-certs
          &lt;span style=&#34;color:#66d9ef&#34;&gt;readOnly&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;initContainers&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;args&lt;/span&gt;:
        - -p
        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;15001&amp;#34;&lt;/span&gt;
        - -u
        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1337&amp;#34;&lt;/span&gt;
        - -m
        - REDIRECT
        - -i
        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;
        - -x
        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
        - -b
        - &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt;,
        - -d
        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;image&lt;/span&gt;: jimmysong/istio-release-proxy_init:&lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;imagePullPolicy&lt;/span&gt;: IfNotPresent
        &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: istio-init
        &lt;span style=&#34;color:#66d9ef&#34;&gt;resources&lt;/span&gt;: {}
        &lt;span style=&#34;color:#66d9ef&#34;&gt;securityContext&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;capabilities&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;add&lt;/span&gt;:
            - NET_ADMIN
          &lt;span style=&#34;color:#66d9ef&#34;&gt;privileged&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;volumes&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;emptyDir&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;medium&lt;/span&gt;: Memory
        &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: istio-envoy
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: istio-certs
        &lt;span style=&#34;color:#66d9ef&#34;&gt;secret&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;optional&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
          &lt;span style=&#34;color:#66d9ef&#34;&gt;secretName&lt;/span&gt;: istio.default
&lt;span style=&#34;color:#66d9ef&#34;&gt;status&lt;/span&gt;: {}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° Service çš„é…ç½®æ²¡æœ‰å˜åŒ–ï¼Œæ‰€æœ‰çš„å˜åŒ–éƒ½åœ¨ &lt;code&gt;Deployment&lt;/code&gt; é‡Œï¼ŒIstio ç»™åº”ç”¨ Pod æ³¨å…¥çš„é…ç½®ä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Init å®¹å™¨ &lt;code&gt;istio-init&lt;/code&gt;ï¼šç”¨äºç»™ Sidecar å®¹å™¨å³ Envoy ä»£ç†åšåˆå§‹åŒ–ï¼Œè®¾ç½® iptables ç«¯å£è½¬å‘&lt;/li&gt;
&lt;li&gt;Envoy sidecar å®¹å™¨ &lt;code&gt;istio-proxy&lt;/code&gt;ï¼šè¿è¡Œ Envoy ä»£ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°†åˆ†åˆ«è§£æä¸‹è¿™ä¸¤ä¸ªå®¹å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨è§£æ&#34;&gt;Init å®¹å™¨è§£æ&lt;/h3&gt;
&lt;p&gt;Istio åœ¨ Pod ä¸­æ³¨å…¥çš„ Init å®¹å™¨åä¸º &lt;code&gt;istio-init&lt;/code&gt;ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢ Istio æ³¨å…¥å®Œæˆåçš„ YAML æ–‡ä»¶ä¸­çœ‹åˆ°äº†è¯¥å®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;-p &lt;span style=&#34;color:#ae81ff&#34;&gt;15001&lt;/span&gt; -u &lt;span style=&#34;color:#ae81ff&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt; -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å†æ£€æŸ¥ä¸‹è¯¥å®¹å™¨çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/pilot/docker/Dockerfile.proxy_init&#34;&gt;Dockerfile&lt;/a&gt; çœ‹çœ‹ &lt;code&gt;ENTRYPOINT&lt;/code&gt; æ˜¯ä»€ä¹ˆä»¥ç¡®å®šå¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; ubuntu:xenial&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get install -y &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    iproute2 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    iptables &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -rf /var/lib/apt/lists/*&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; istio-iptables.sh /usr/local/bin/&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ENTRYPOINT&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/usr/local/bin/istio-iptables.sh&amp;#34;&lt;/span&gt;]&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å…¥å£æ˜¯ &lt;code&gt;/usr/local/bin/istio-iptables.sh&lt;/code&gt; è„šæœ¬ï¼Œå†æŒ‰å›¾ç´¢éª¥çœ‹çœ‹è¿™ä¸ªè„šæœ¬é‡Œåˆ°åº•å†™çš„ä»€ä¹ˆï¼Œè¯¥è„šæœ¬çš„ä½ç½®åœ¨ Istio æºç ä»“åº“çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh&#34;&gt;tools/deb/istio-iptables.sh&lt;/a&gt;ï¼Œä¸€å…± 300 å¤šè¡Œï¼Œå°±ä¸è´´åœ¨è¿™é‡Œäº†ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥è§£æä¸‹è¿™ä¸ªå¯åŠ¨è„šæœ¬ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨å¯åŠ¨å…¥å£&#34;&gt;Init å®¹å™¨å¯åŠ¨å…¥å£&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨çš„å¯åŠ¨å…¥å£æ˜¯ &lt;code&gt;/usr/local/bin/istio-iptables.sh&lt;/code&gt; è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ istio-iptables.sh -p PORT -u UID -g GID &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-m mode&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-b ports&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-d ports&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-i CIDR&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-x CIDR&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-h&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
  -p: æŒ‡å®šé‡å®šå‘æ‰€æœ‰ TCP æµé‡çš„ Envoy ç«¯å£ï¼ˆé»˜è®¤ä¸º $ENVOY_PORT &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 15001ï¼‰
  -u: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ UIDã€‚é€šå¸¸ï¼Œè¿™æ˜¯ä»£ç†å®¹å™¨çš„ UIDï¼ˆé»˜è®¤ä¸º $ENVOY_USER çš„ uidï¼Œistio_proxy çš„ uid æˆ– 1337ï¼‰
  -g: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ GIDã€‚ï¼ˆä¸ -u param ç›¸åŒçš„é»˜è®¤å€¼ï¼‰
  -m: æŒ‡å®šå…¥ç«™è¿æ¥é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ï¼Œâ€œREDIRECTâ€ æˆ– â€œTPROXYâ€ï¼ˆé»˜è®¤ä¸º $ISTIO_INBOUND_INTERCEPTION_MODE&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
  -b: é€—å·åˆ†éš”çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œå…¶æµé‡å°†é‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰ç«¯å£ã€‚ä¸ºç©ºæ—¶è¡¨ç¤ºç¦ç”¨æ‰€æœ‰å…¥ç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º $ISTIO_INBOUND_PORTSï¼‰
  -d: æŒ‡å®šè¦ä»é‡å®šå‘åˆ° Envoy ä¸­æ’é™¤ï¼ˆå¯é€‰ï¼‰çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œä»¥é€—å·æ ¼å¼åˆ†éš”ã€‚ä½¿ç”¨é€šé…ç¬¦â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å…¥ç«™æµé‡ï¼ˆé»˜è®¤ä¸º $ISTIO_LOCAL_EXCLUDE_PORTSï¼‰
  -i: æŒ‡å®šé‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ã€‚ç©ºåˆ—è¡¨å°†ç¦ç”¨æ‰€æœ‰å‡ºç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º $ISTIO_SERVICE_CIDRï¼‰
  -x: æŒ‡å®šå°†ä»é‡å®šå‘ä¸­æ’é™¤çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ï¼ˆé»˜è®¤ä¸º $ISTIO_SERVICE_EXCLUDE_CIDRï¼‰ã€‚

ç¯å¢ƒå˜é‡ä½äº $ISTIO_SIDECAR_CONFIGï¼ˆé»˜è®¤åœ¨ï¼š/var/lib/istio/envoy/sidecar.envï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æŸ¥çœ‹è¯¥è„šæœ¬ä½ å°†çœ‹åˆ°ï¼Œä»¥ä¸Šä¼ å…¥çš„å‚æ•°éƒ½ä¼šé‡æ–°ç»„è£…æˆ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34;&gt;&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤&lt;/a&gt;çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å†å‚è€ƒ &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼Œå®Œæ•´çš„å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ /usr/local/bin/istio-iptables.sh -p &lt;span style=&#34;color:#ae81ff&#34;&gt;15001&lt;/span&gt; -u &lt;span style=&#34;color:#ae81ff&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b &lt;span style=&#34;color:#ae81ff&#34;&gt;9080&lt;/span&gt; -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å®¹å™¨å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®© Envoy ä»£ç†å¯ä»¥æ‹¦æˆªæ‰€æœ‰çš„è¿›å‡º Pod çš„æµé‡ï¼Œå³å°†å…¥ç«™æµé‡é‡å®šå‘åˆ° Sidecarï¼Œå†æ‹¦æˆªåº”ç”¨å®¹å™¨çš„å‡ºç«™æµé‡ç»è¿‡ Sidecar å¤„ç†åå†å‡ºç«™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‘½ä»¤è§£æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¡å¯åŠ¨å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†åº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡éƒ½è½¬å‘åˆ° Envoy çš„ 15001 ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istio-proxy&lt;/code&gt; ç”¨æˆ·èº«ä»½è¿è¡Œï¼Œ UID ä¸º 1337ï¼Œå³ Envoy æ‰€å¤„çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç”¨æˆ·ï¼Œè§ YAML é…ç½®ä¸­çš„ &lt;code&gt;runAsUser&lt;/code&gt; å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼æ¥é‡å®šå‘æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½é‡å®šå‘åˆ° Envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‰€æœ‰è®¿é—® 9080 ç«¯å£ï¼ˆå³åº”ç”¨å®¹å™¨ &lt;code&gt;productpage&lt;/code&gt; çš„ç«¯å£ï¼‰çš„æµé‡é‡å®šå‘åˆ° Envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸º Init å®¹å™¨åˆå§‹åŒ–å®Œæ¯•åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç™»é™†åˆ°å®¹å™¨ä¸­æŸ¥çœ‹ iptables ä¿¡æ¯ï¼Œä½†æ˜¯ Init å®¹å™¨åˆå§‹åŒ–ç»“æœä¼šä¿ç•™åˆ°åº”ç”¨å®¹å™¨å’Œ Sidecar å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-proxy-å®¹å™¨è§£æ&#34;&gt;istio-proxy å®¹å™¨è§£æ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æŸ¥çœ‹ iptables é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦ç™»é™†åˆ° Sidecar å®¹å™¨ä¸­ä½¿ç”¨ root ç”¨æˆ·æ¥æŸ¥çœ‹ï¼Œå› ä¸º &lt;code&gt;kubectl&lt;/code&gt; æ— æ³•ä½¿ç”¨ç‰¹æƒæ¨¡å¼æ¥è¿œç¨‹æ“ä½œ docker å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç™»é™†åˆ° &lt;code&gt;productpage&lt;/code&gt; Pod æ‰€åœ¨çš„ä¸»æœºä¸Šä½¿ç”¨ &lt;code&gt;docker&lt;/code&gt; å‘½ä»¤ç™»é™†å®¹å™¨ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;productpage&lt;/code&gt; Pod æ‰€åœ¨çš„ä¸»æœºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ kubectl -n default get pod -l app&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;productpage -o wide
NAME                              READY     STATUS    RESTARTS   AGE       IP             NODE
productpage-v1-745ffc55b7-2l2lw   2/2       Running   &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;          1d        172.33.78.10   node3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°è¯¥ Pod è¿è¡Œåœ¨ &lt;code&gt;node3&lt;/code&gt; ä¸Šï¼Œä½¿ç”¨ &lt;code&gt;vagrant&lt;/code&gt; å‘½ä»¤ç™»é™†åˆ° &lt;code&gt;node3&lt;/code&gt; ä¸»æœºä¸­å¹¶åˆ‡æ¢ä¸º root ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ vagrant ssh node3
$ sudo -i
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ iptables é…ç½®ï¼Œåˆ—å‡º NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå› ä¸ºåœ¨ Init å®¹å™¨å¯åŠ¨çš„æ—¶å€™é€‰æ‹©ç»™  &lt;code&gt;istio-iptables.sh&lt;/code&gt; ä¼ é€’çš„å‚æ•°ä¸­æŒ‡å®šå°†å…¥ç«™æµé‡é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ä¸º â€œREDIRECTâ€ï¼Œå› æ­¤åœ¨ iptables ä¸­å°†åªæœ‰ NAT è¡¨çš„è§„æ ¼é…ç½®ï¼Œå¦‚æœé€‰æ‹© &lt;code&gt;TPROXY&lt;/code&gt; è¿˜ä¼šæœ‰ &lt;code&gt;mangle&lt;/code&gt; è¡¨é…ç½®ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34;&gt;iptables&lt;/a&gt;ï¼Œè§„åˆ™é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://www.zsythink.net/archives/1517&#34;&gt;iptables è§„åˆ™é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-iptables&#34;&gt;ç†è§£ iptables&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; æ˜¯ Linux å†…æ ¸ä¸­çš„é˜²ç«å¢™è½¯ä»¶ netfilter çš„ç®¡ç†å·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ netfilter çš„ä¸€éƒ¨åˆ†ã€‚Netfilter ä½äºå†…æ ¸ç©ºé—´ï¼Œä¸ä»…æœ‰ç½‘ç»œåœ°å€è½¬æ¢çš„åŠŸèƒ½ï¼Œä¹Ÿå…·å¤‡æ•°æ®åŒ…å†…å®¹ä¿®æ”¹ã€ä»¥åŠæ•°æ®åŒ…è¿‡æ»¤ç­‰é˜²ç«å¢™åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº†è§£ Init å®¹å™¨åˆå§‹åŒ–çš„ iptables ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ iptables å’Œè§„åˆ™é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† iptables è°ƒç”¨é“¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;iptables_packetflow.png&#34; alt=&#34;iptables è°ƒç”¨é“¾&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;iptables-ä¸­çš„è¡¨&#34;&gt;iptables ä¸­çš„è¡¨&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨ä¸­ä½¿ç”¨çš„çš„ iptables ç‰ˆæœ¬æ˜¯ &lt;code&gt;v1.6.0&lt;/code&gt;ï¼Œå…±åŒ…å« 5 å¼ è¡¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;raw&lt;/code&gt; ç”¨äºé…ç½®æ•°æ®åŒ…ï¼Œ&lt;code&gt;raw&lt;/code&gt; ä¸­çš„æ•°æ®åŒ…ä¸ä¼šè¢«ç³»ç»Ÿè·Ÿè¸ªã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;filter&lt;/code&gt; æ˜¯ç”¨äºå­˜æ”¾æ‰€æœ‰ä¸é˜²ç«å¢™ç›¸å…³æ“ä½œçš„é»˜è®¤è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nat&lt;/code&gt; ç”¨äº &lt;a href=&#34;https://en.wikipedia.org/wiki/Network_address_translation&#34;&gt;ç½‘ç»œåœ°å€è½¬æ¢&lt;/a&gt;ï¼ˆä¾‹å¦‚ï¼šç«¯å£è½¬å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mangle&lt;/code&gt; ç”¨äºå¯¹ç‰¹å®šæ•°æ®åŒ…çš„ä¿®æ”¹ï¼ˆå‚è€ƒ&lt;a href=&#34;https://en.wikipedia.org/wiki/Mangled_packet&#34;&gt;æŸåæ•°æ®åŒ…&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;security&lt;/code&gt; ç”¨äº&lt;a href=&#34;https://wiki.archlinux.org/index.php/Security#Mandatory_access_control&#34;&gt;å¼ºåˆ¶è®¿é—®æ§åˆ¶&lt;/a&gt; ç½‘ç»œè§„åˆ™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šåœ¨æœ¬ç¤ºä¾‹ä¸­åªç”¨åˆ°äº† &lt;code&gt;nat&lt;/code&gt; è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒçš„è¡¨ä¸­çš„å…·æœ‰çš„é“¾ç±»å‹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è§„åˆ™åç§°&lt;/th&gt;
&lt;th&gt;raw&lt;/th&gt;
&lt;th&gt;filter&lt;/th&gt;
&lt;th&gt;nat&lt;/th&gt;
&lt;th&gt;mangle&lt;/th&gt;
&lt;th&gt;security&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;PREROUTING&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;INPUT&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OUTPUT&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;POSTROUTING&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FORWARD&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å…³äº iptables çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34;&gt;å¸¸è§ iptables ä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;iptables-å‘½ä»¤&#34;&gt;iptables å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„ä¸»è¦ç”¨é€”æ˜¯ä¿®æ”¹è¿™äº›è¡¨ä¸­çš„è§„åˆ™ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ iptables &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-t è¡¨å&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; å‘½ä»¤é€‰é¡¹ï¼»é“¾å&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;ï¼»æ¡ä»¶åŒ¹é…ï¼½&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-j ç›®æ ‡åŠ¨ä½œæˆ–è·³è½¬ï¼½
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Init å®¹å™¨ä¸­çš„ &lt;code&gt;/istio-iptables.sh&lt;/code&gt; å¯åŠ¨å…¥å£è„šæœ¬å°±æ˜¯æ‰§è¡Œ iptables åˆå§‹åŒ–çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç†è§£-iptables-è§„åˆ™&#34;&gt;ç†è§£ iptables è§„åˆ™&lt;/h3&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨ä¸­çš„é»˜è®¤çš„ iptables è§„åˆ™ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯ filter è¡¨ä¸­çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ iptables -L -v
Chain INPUT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT 350K packets, 63M bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; packets, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT 18M packets, 1916M bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªé»˜è®¤çš„é“¾ï¼Œåˆ†åˆ«æ˜¯ INPUTã€FORWARD å’Œ OUTPUTï¼Œæ¯ä¸ªé“¾ä¸­çš„ç¬¬ä¸€è¡Œè¾“å‡ºè¡¨ç¤ºé“¾åç§°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºINPUT/FORWARD/OUTPUTï¼‰ï¼Œåè·Ÿé»˜è®¤ç­–ç•¥ï¼ˆACCEPTï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ iptables çš„å»ºè®®ç»“æ„å›¾ï¼Œæµé‡åœ¨ç»è¿‡ INPUT é“¾ä¹‹åå°±è¿›å…¥äº†ä¸Šå±‚åè®®æ ˆï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;p&gt;æ¯æ¡é“¾ä¸­éƒ½å¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ï¼Œè§„åˆ™æ˜¯æŒ‰ç…§é¡ºåºä»å‰åˆ°åæ‰§è¡Œçš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è§„åˆ™çš„è¡¨å¤´å®šä¹‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pkts&lt;/strong&gt;ï¼šå¤„ç†è¿‡çš„åŒ¹é…çš„æŠ¥æ–‡æ•°é‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bytes&lt;/strong&gt;ï¼šç´¯è®¡å¤„ç†çš„æŠ¥æ–‡å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;target&lt;/strong&gt;ï¼šå¦‚æœæŠ¥æ–‡ä¸è§„åˆ™åŒ¹é…ï¼ŒæŒ‡å®šç›®æ ‡å°±ä¼šè¢«æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prot&lt;/strong&gt;ï¼šåè®®ï¼Œä¾‹å¦‚ &lt;code&gt;tdp&lt;/code&gt;ã€&lt;code&gt;udp&lt;/code&gt;ã€&lt;code&gt;icmp&lt;/code&gt; å’Œ &lt;code&gt;all&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;opt&lt;/strong&gt;ï¼šå¾ˆå°‘ä½¿ç”¨ï¼Œè¿™ä¸€åˆ—ç”¨äºæ˜¾ç¤º IP é€‰é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;in&lt;/strong&gt;ï¼šå…¥ç«™ç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;out&lt;/strong&gt;ï¼šå‡ºç«™ç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;source&lt;/strong&gt;ï¼šæµé‡çš„æº IP åœ°å€æˆ–å­ç½‘ï¼Œåè€…æ˜¯ &lt;code&gt;anywhere&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;destination&lt;/strong&gt;ï¼šæµé‡çš„ç›®çš„åœ° IP åœ°å€æˆ–å­ç½‘ï¼Œæˆ–è€…æ˜¯ &lt;code&gt;anywhere&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜æœ‰ä¸€åˆ—æ²¡æœ‰è¡¨å¤´ï¼Œæ˜¾ç¤ºåœ¨æœ€åï¼Œè¡¨ç¤ºè§„åˆ™çš„é€‰é¡¹ï¼Œä½œä¸ºè§„åˆ™çš„æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œç”¨æ¥è¡¥å……å‰é¢çš„å‡ åˆ—ä¸­çš„é…ç½®ã€‚&lt;code&gt;prot&lt;/code&gt;ã€&lt;code&gt;opt&lt;/code&gt;ã€&lt;code&gt;in&lt;/code&gt;ã€&lt;code&gt;out&lt;/code&gt;ã€&lt;code&gt;source&lt;/code&gt; å’Œ &lt;code&gt;destination&lt;/code&gt; å’Œæ˜¾ç¤ºåœ¨ &lt;code&gt;destination&lt;/code&gt; åé¢çš„æ²¡æœ‰è¡¨å¤´çš„ä¸€åˆ—æ‰©å±•æ¡ä»¶å…±åŒç»„æˆåŒ¹é…è§„åˆ™ã€‚å½“æµé‡åŒ¹é…è¿™äº›è§„åˆ™åå°±ä¼šæ‰§è¡Œ &lt;code&gt;target&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº iptables è§„åˆ™è¯·å‚è€ƒ&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34;&gt;å¸¸è§iptablesä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;target æ”¯æŒçš„ç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;target&lt;/code&gt; ç±»å‹åŒ…æ‹¬ ACCEPT&lt;code&gt;ã€REJECT&lt;/code&gt;ã€&lt;code&gt;DROP&lt;/code&gt;ã€&lt;code&gt;LOG&lt;/code&gt; ã€&lt;code&gt;SNAT&lt;/code&gt;ã€&lt;code&gt;MASQUERADE&lt;/code&gt;ã€&lt;code&gt;DNAT&lt;/code&gt;ã€&lt;code&gt;REDIRECT&lt;/code&gt;ã€&lt;code&gt;RETURN&lt;/code&gt; æˆ–è€…è·³è½¬åˆ°å…¶ä»–è§„åˆ™ç­‰ã€‚åªè¦æ‰§è¡Œåˆ°æŸä¸€æ¡é“¾ä¸­åªæœ‰æŒ‰ç…§é¡ºåºæœ‰ä¸€æ¡è§„åˆ™åŒ¹é…åå°±å¯ä»¥ç¡®å®šæŠ¥æ–‡çš„å»å‘äº†ï¼Œé™¤äº† &lt;code&gt;RETURN&lt;/code&gt; ç±»å‹ï¼Œç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ &lt;code&gt;return&lt;/code&gt; è¯­å¥ï¼Œè¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ã€‚&lt;code&gt;target&lt;/code&gt; æ”¯æŒçš„é…ç½®è¯¦è§£è¯·å‚è€ƒ &lt;a href=&#34;http://www.zsythink.net/archives/1199&#34;&gt;iptables è¯¦è§£ï¼ˆ1ï¼‰ï¼šiptables æ¦‚å¿µ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ° Init å®¹å™¨æ²¡æœ‰åœ¨ iptables çš„é»˜è®¤é“¾è·¯ä¸­åˆ›å»ºä»»ä½•è§„åˆ™ï¼Œè€Œæ˜¯åˆ›å»ºäº†æ–°çš„é“¾è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŸ¥çœ‹-iptables-nat-è¡¨ä¸­æ³¨å…¥çš„è§„åˆ™&#34;&gt;æŸ¥çœ‹ iptables nat è¡¨ä¸­æ³¨å…¥çš„è§„åˆ™&lt;/h2&gt;
&lt;p&gt;Init å®¹å™¨é€šè¿‡å‘ iptables nat è¡¨ä¸­æ³¨å…¥è½¬å‘è§„åˆ™æ¥åŠ«æŒæµé‡çš„ï¼Œä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ productpage æœåŠ¡ä¸­çš„ iptables æµé‡åŠ«æŒçš„è¯¦ç»†è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;istio-envoy-sidecar-traffic-injection.jpg&#34; alt=&#34;Envoy sidecar æµé‡åŠ«æŒä¸è·¯ç”±è½¬å‘ç¤ºæ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨å¯åŠ¨æ—¶å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šäº† &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼ï¼Œå› æ­¤åªåˆ›å»ºäº† NAT è¡¨è§„åˆ™ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥çœ‹ä¸‹ NAT è¡¨ä¸­åˆ›å»ºçš„è§„åˆ™ï¼Œè¿™æ˜¯å…¨æ–‡ä¸­çš„&lt;strong&gt;é‡ç‚¹éƒ¨åˆ†&lt;/strong&gt;ï¼Œå‰é¢è®²äº†é‚£ä¹ˆå¤šéƒ½æ˜¯ä¸ºå®ƒåšé“ºå«çš„ã€‚ä¸‹é¢æ˜¯æŸ¥çœ‹ nat è¡¨ä¸­çš„è§„åˆ™ï¼Œå…¶ä¸­é“¾çš„åå­—ä¸­åŒ…å« &lt;code&gt;ISTIO&lt;/code&gt; å‰ç¼€çš„æ˜¯ç”± Init å®¹å™¨æ³¨å…¥çš„ï¼Œè§„åˆ™åŒ¹é…æ˜¯æ ¹æ®ä¸‹é¢æ˜¾ç¤ºçš„é¡ºåºæ¥æ‰§è¡Œçš„ï¼Œå…¶ä¸­ä¼šæœ‰å¤šæ¬¡è·³è½¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŸ¥çœ‹ NAT è¡¨ä¸­è§„åˆ™é…ç½®çš„è¯¦ç»†ä¿¡æ¯&lt;/span&gt;
$ iptables -t nat -L -v
&lt;span style=&#34;color:#75715e&#34;&gt;# PREROUTING é“¾ï¼šç”¨äºç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ï¼Œå°†æ‰€æœ‰å…¥ç«™ TCP æµé‡è·³è½¬åˆ° ISTIO_INBOUND é“¾ä¸Š&lt;/span&gt;
Chain PREROUTING &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; packets, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
    &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;   &lt;span style=&#34;color:#ae81ff&#34;&gt;120&lt;/span&gt; ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere

&lt;span style=&#34;color:#75715e&#34;&gt;# INPUT é“¾ï¼šå¤„ç†è¾“å…¥æ•°æ®åŒ…ï¼Œé TCP æµé‡å°†ç»§ç»­ OUTPUT é“¾&lt;/span&gt;
Chain INPUT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; packets, &lt;span style=&#34;color:#ae81ff&#34;&gt;120&lt;/span&gt; bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination

&lt;span style=&#34;color:#75715e&#34;&gt;# OUTPUT é“¾ï¼šå°†æ‰€æœ‰å‡ºç«™æ•°æ®åŒ…è·³è½¬åˆ° ISTIO_OUTPUT é“¾ä¸Š&lt;/span&gt;
Chain OUTPUT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span style=&#34;color:#ae81ff&#34;&gt;41146&lt;/span&gt; packets, 3845K bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
   &lt;span style=&#34;color:#ae81ff&#34;&gt;93&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;5580&lt;/span&gt; ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere

&lt;span style=&#34;color:#75715e&#34;&gt;# POSTROUTING é“¾ï¼šæ‰€æœ‰æ•°æ®åŒ…æµå‡ºç½‘å¡æ—¶éƒ½è¦å…ˆè¿›å…¥POSTROUTING é“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬å‘å‡ºå»ï¼Œæˆ‘ä»¬çœ‹åˆ°æ­¤å¤„æœªåšä»»ä½•å¤„ç†&lt;/span&gt;
Chain POSTROUTING &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span style=&#34;color:#ae81ff&#34;&gt;41199&lt;/span&gt; packets, 3848K bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination

&lt;span style=&#34;color:#75715e&#34;&gt;# ISTIO_INBOUND é“¾ï¼šå°†æ‰€æœ‰ç›®çš„åœ°ä¸º 9080 ç«¯å£çš„å…¥ç«™æµé‡é‡å®šå‘åˆ° ISTIO_IN_REDIRECT é“¾ä¸Š&lt;/span&gt;
Chain ISTIO_INBOUND &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; references&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
    &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;   &lt;span style=&#34;color:#ae81ff&#34;&gt;120&lt;/span&gt; ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere             tcp dpt:9080

&lt;span style=&#34;color:#75715e&#34;&gt;# ISTIO_IN_REDIRECT é“¾ï¼šå°†æ‰€æœ‰çš„å…¥ç«™æµé‡è·³è½¬åˆ°æœ¬åœ°çš„ 15001 ç«¯å£ï¼Œè‡³æ­¤æˆåŠŸçš„æ‹¦æˆªäº†æµé‡åˆ° Envoy&lt;/span&gt; 
Chain ISTIO_IN_REDIRECT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; references&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
    &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;   &lt;span style=&#34;color:#ae81ff&#34;&gt;120&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span style=&#34;color:#ae81ff&#34;&gt;15001&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# ISTIO_OUTPUT é“¾ï¼šé€‰æ‹©éœ€è¦é‡å®šå‘åˆ° Envoyï¼ˆå³æœ¬åœ°ï¼‰ çš„å‡ºç«™æµé‡ï¼Œæ‰€æœ‰é localhost çš„æµé‡å…¨éƒ¨è½¬å‘åˆ° ISTIO_REDIRECTã€‚ä¸ºäº†é¿å…æµé‡åœ¨è¯¥ Pod ä¸­æ— é™å¾ªç¯ï¼Œæ‰€æœ‰åˆ° istio-proxy ç”¨æˆ·ç©ºé—´çš„æµé‡éƒ½è¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ä¸­çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæœ¬ä¾‹ä¸­å³ OUTPUT é“¾ï¼Œå› ä¸ºè·³å‡º ISTIO_OUTPUT è§„åˆ™ä¹‹åå°±è¿›å…¥ä¸‹ä¸€æ¡é“¾ POSTROUTINGã€‚å¦‚æœç›®çš„åœ°é localhost å°±è·³è½¬åˆ° ISTIO_REDIRECTï¼›å¦‚æœæµé‡æ˜¯æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´çš„ï¼Œé‚£ä¹ˆå°±è·³å‡ºè¯¥é“¾ï¼Œè¿”å›å®ƒçš„è°ƒç”¨é“¾ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ï¼ˆOUPT çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæ— éœ€å¯¹æµé‡è¿›è¡Œå¤„ç†ï¼‰ï¼›æ‰€æœ‰çš„é istio-proxy ç”¨æˆ·ç©ºé—´çš„ç›®çš„åœ°æ˜¯ localhost çš„æµé‡å°±è·³è½¬åˆ° ISTIO_REDIRECT&lt;/span&gt;
Chain ISTIO_OUTPUT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; references&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
    &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ISTIO_REDIRECT  all  --  any    lo      anywhere            !localhost
   &lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;2400&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner UID match istio-proxy
    &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner GID match istio-proxy	
    &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             localhost
   &lt;span style=&#34;color:#ae81ff&#34;&gt;53&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;3180&lt;/span&gt; ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere

&lt;span style=&#34;color:#75715e&#34;&gt;# ISTIO_REDIRECT é“¾ï¼šå°†æ‰€æœ‰æµé‡é‡å®šå‘åˆ° Envoyï¼ˆå³æœ¬åœ°ï¼‰ çš„ 15001 ç«¯å£&lt;/span&gt;
Chain ISTIO_REDIRECT &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; references&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     source               destination
   &lt;span style=&#34;color:#ae81ff&#34;&gt;53&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;3180&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span style=&#34;color:#ae81ff&#34;&gt;15001&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; æ˜¾ç¤ºçš„é“¾çš„é¡ºåºï¼Œå³æµé‡è§„åˆ™åŒ¹é…çš„é¡ºåºã€‚å…¶ä¸­è¦ç‰¹åˆ«æ³¨æ„ &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾ä¸­çš„è§„åˆ™é…ç½®ã€‚ä¸ºäº†é¿å…æµé‡ä¸€ç›´åœ¨ Pod ä¸­æ— é™å¾ªç¯ï¼Œæ‰€æœ‰åˆ° istio-proxy ç”¨æˆ·ç©ºé—´çš„æµé‡éƒ½è¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ä¸­çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæœ¬ä¾‹ä¸­å³ OUTPUT é“¾ï¼Œå› ä¸ºè·³å‡º &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; è§„åˆ™ä¹‹åå°±è¿›å…¥ä¸‹ä¸€æ¡é“¾ &lt;code&gt;POSTROUTING&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾è§„åˆ™åŒ¹é…çš„è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç›®çš„åœ°é localhost å°±è·³è½¬åˆ° ISTIO_REDIRECT é“¾&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´çš„é localhost æµé‡è·³è½¬åˆ°å®ƒçš„è°ƒç”¨ç‚¹ &lt;code&gt;OUTPUT&lt;/code&gt; ç»§ç»­æ‰§è¡Œ &lt;code&gt;OUTPUT&lt;/code&gt; é“¾çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œå› ä¸º &lt;code&gt;OUTPUT&lt;/code&gt; é“¾ä¸­æ²¡æœ‰ä¸‹ä¸€æ¡è§„åˆ™äº†ï¼Œæ‰€ä»¥ä¼šç»§ç»­æ‰§è¡Œ &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾ç„¶åè·³å‡º iptablesï¼Œç›´æ¥è®¿é—®ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;å¦‚æœæµé‡ä¸æ˜¯æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´ï¼Œåˆæ˜¯å¯¹ localhost çš„è®¿é—®ï¼Œé‚£ä¹ˆå°±è·³å‡º iptablesï¼Œç›´æ¥è®¿é—®ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;å…¶å®ƒæ‰€æœ‰æƒ…å†µéƒ½è·³è½¬åˆ° &lt;code&gt;ISTIO_REDIRECT&lt;/code&gt; é“¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶å®åœ¨æœ€åè¿™æ¡è§„åˆ™å‰è¿˜å¯ä»¥å¢åŠ  IP åœ°å€è¿‡æ»¤ï¼Œè®©æŸäº› IP åœ°å€æ®µä¸é€šè¿‡ Envoy ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Š iptables è§„åˆ™éƒ½æ˜¯ Init å®¹å™¨å¯åŠ¨çš„æ—¶ä½¿ç”¨ &lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh&#34;&gt;istio-iptables.sh&lt;/a&gt; è„šæœ¬ç”Ÿæˆçš„ï¼Œè¯¦ç»†è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹è¯¥è„šæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŸ¥çœ‹-envoy-è¿è¡ŒçŠ¶æ€&#34;&gt;æŸ¥çœ‹ Envoy è¿è¡ŒçŠ¶æ€&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæŸ¥çœ‹ &lt;code&gt;proxyv2&lt;/code&gt; é•œåƒçš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/pilot/docker/Dockerfile.proxyv2&#34;&gt;Dockerfile&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; istionightly/base_debug&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ARG&lt;/span&gt; proxy_version&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ARG&lt;/span&gt; istio_version&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£… Envoy&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; envoy /usr/local/bin/envoy&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼æ˜æ–‡æŒ‡å®š proxy çš„ç‰ˆæœ¬/åŠŸèƒ½&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ENV&lt;/span&gt; ISTIO_META_ISTIO_PROXY_VERSION &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.1.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼æ˜æ–‡æŒ‡å®š proxy æ˜ç¡®çš„ shaï¼Œç”¨äºæŒ‡å®šç‰ˆæœ¬çš„é…ç½®å’Œè°ƒè¯•&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ENV&lt;/span&gt; ISTIO_META_ISTIO_PROXY_SHA $proxy_version&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šæ˜ç¡®çš„æ„å»ºå·ï¼Œç”¨äºè°ƒè¯•&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ENV&lt;/span&gt; ISTIO_META_ISTIO_VERSION $istio_version&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; pilot-agent /usr/local/bin/pilot-agent&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; envoy_pilot.yaml.tmpl /etc/istio/proxy/envoy_pilot.yaml.tmpl&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; envoy_policy.yaml.tmpl /etc/istio/proxy/envoy_policy.yaml.tmpl&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; envoy_telemetry.yaml.tmpl /etc/istio/proxy/envoy_telemetry.yaml.tmpl&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ADD&lt;/span&gt; istio-iptables.sh /usr/local/bin/istio-iptables.sh&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; envoy_bootstrap_v2.json /var/lib/istio/envoy/envoy_bootstrap_tmpl.json&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; chmod &lt;span style=&#34;color:#ae81ff&#34;&gt;755&lt;/span&gt; /usr/local/bin/envoy /usr/local/bin/pilot-agent&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°† istio-proxy ç”¨æˆ·åŠ å…¥ sudo æƒé™ä»¥å…è®¸æ‰§è¡Œ tcpdump å’Œå…¶ä»–è°ƒè¯•å‘½ä»¤&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; useradd -m --uid &lt;span style=&#34;color:#ae81ff&#34;&gt;1337&lt;/span&gt; istio-proxy &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;istio-proxy ALL=NOPASSWD: ALL&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sudoers &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    chown -R istio-proxy /var/lib/istio&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨ pilot-agent æ¥å¯åŠ¨ Envoy&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ENTRYPOINT&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/usr/local/bin/pilot-agent&amp;#34;&lt;/span&gt;]&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å®¹å™¨çš„å¯åŠ¨å…¥å£æ˜¯ &lt;code&gt;pilot-agent&lt;/code&gt; å‘½ä»¤ï¼Œæ ¹æ® YAML é…ç½®ä¸­ä¼ é€’çš„å‚æ•°ï¼Œè¯¦ç»†çš„å¯åŠ¨å‘½ä»¤å…¥ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;/usr/local/bin/pilot-agent proxy sidecar --configPath /etc/istio/proxy --binaryPath /usr/local/bin/envoy --serviceCluster productpage --drainDuration 45s --parentShutdownDuration 1m0s --discoveryAddress istio-pilot.istio-system:15007 --discoveryRefreshDelay 1s --zipkinAddress zipkin.istio-system:9411 --connectTimeout 10s --statsdUdpAddress istio-statsd-prom-bridge.istio-system:9125 --proxyAdminPort &lt;span style=&#34;color:#ae81ff&#34;&gt;15000&lt;/span&gt; --controlPlaneAuthPolicy NONE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸»è¦é…ç½®äº† Envoy äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ã€æœåŠ¡å‘ç°åœ°å€ã€æœåŠ¡é›†ç¾¤åã€ç›‘æ§æŒ‡æ ‡ä¸ŠæŠ¥åœ°å€ã€Envoy çš„ç®¡ç†ç«¯å£ã€çƒ­é‡å¯æ—¶é—´ç­‰ï¼Œè¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/docs/reference/commands/pilot-agent/&#34;&gt;Istioå®˜æ–¹æ–‡æ¡£ pilot-agent çš„ç”¨æ³•&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; æ˜¯å®¹å™¨ä¸­ PID ä¸º 1 çš„å¯åŠ¨è¿›ç¨‹ï¼Œå®ƒå¯åŠ¨æ—¶åˆåˆ›å»ºäº†ä¸€ä¸ª Envoy è¿›ç¨‹ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;/usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span style=&#34;color:#ae81ff&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt; --service-cluster productpage --service-node sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local --max-obj-name-len &lt;span style=&#34;color:#ae81ff&#34;&gt;189&lt;/span&gt; -l warn --v2-config-only
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åˆ†åˆ«è§£é‡Šä¸‹ä»¥ä¸Šé…ç½®çš„æ„ä¹‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-c /etc/istio/proxy/envoy-rev0.json&lt;/code&gt;ï¼šé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒ &lt;code&gt;.json&lt;/code&gt;ã€&lt;code&gt;.yaml&lt;/code&gt;ã€&lt;code&gt;.pb&lt;/code&gt; å’Œ &lt;code&gt;.pb_text&lt;/code&gt; æ ¼å¼ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; å¯åŠ¨çš„æ—¶å€™è¯»å–äº†å®¹å™¨çš„ç¯å¢ƒå˜é‡ååˆ›å»ºçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--restart-epoch 0&lt;/code&gt;ï¼šEnvoy çƒ­é‡å¯å‘¨æœŸï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨é»˜è®¤ä¸º 0ï¼Œæ¯çƒ­é‡å¯ä¸€æ¬¡è¯¥å€¼åŠ  1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--drain-time-s 45&lt;/code&gt;ï¼šçƒ­é‡å¯æœŸé—´ Envoy å°†è€—å°½è¿æ¥çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--parent-shutdown-time-s 60&lt;/code&gt;ï¼š Envoy åœ¨çƒ­é‡å¯æ—¶å…³é—­çˆ¶è¿›ç¨‹ä¹‹å‰ç­‰å¾…çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--service-cluster productpage&lt;/code&gt;ï¼šEnvoy è¿è¡Œçš„æœ¬åœ°æœåŠ¡é›†ç¾¤çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--service-node sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local&lt;/code&gt;ï¼šå®šä¹‰ Envoy è¿è¡Œçš„æœ¬åœ°æœåŠ¡èŠ‚ç‚¹åç§°ï¼Œå…¶ä¸­åŒ…å«äº†è¯¥ Pod çš„åç§°ã€IPã€DNS åŸŸç­‰ä¿¡æ¯ï¼Œæ ¹æ®å®¹å™¨çš„ç¯å¢ƒå˜é‡æ‹¼å‡ºæ¥çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-max-obj-name-len 189&lt;/code&gt;ï¼šcluster/route_config/listener ä¸­åç§°å­—æ®µçš„æœ€å¤§é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-l warn&lt;/code&gt;ï¼šæ—¥å¿—çº§åˆ«&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--v2-config-only&lt;/code&gt;ï¼šåªè§£æ v2 å¼•å¯¼é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦ç»†é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/operations/cli.html&#34;&gt;Envoy çš„å‘½ä»¤è¡Œé€‰é¡¹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ Envoy çš„é…ç½®æ–‡ä»¶ &lt;code&gt;/etc/istio/proxy/envoy-rev0.json&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;node&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;,

    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;: {
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;INTERCEPTION_MODE&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;REDIRECT&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ISTIO_PROXY_SHA&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;istio-proxy:6166ae7ebac7f630206b2fe4e6767516bf198313&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ISTIO_PROXY_VERSION&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.0.0&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ISTIO_VERSION&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.0.0&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;POD_NAME&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;productpage-v1-745ffc55b7-2l2lw&amp;#34;&lt;/span&gt;,
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sidecar&amp;#34;&lt;/span&gt;
    }
  },
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;stats_config&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;use_all_default_tags&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
  },
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;access_log_path&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/dev/stdout&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;15000&lt;/span&gt;
      }
    }
  },
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dynamic_resources&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lds_config&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;: {}
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cds_config&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;: {}
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ads_config&amp;#34;&lt;/span&gt;: {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;,
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;refresh_delay&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;seconds&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;nanos&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;},
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;: [
        {
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xds-grpc&amp;#34;&lt;/span&gt;
          }
        }
      ]
    }
  },
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;static_resources&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;: [
    {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xds-grpc&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;STRICT_DNS&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;seconds&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;nanos&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;},
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;,

    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: [
    {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;istio-pilot.istio-system&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;15010&lt;/span&gt;}
    }
    ],
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;circuit_breakers&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;: [
      {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;priority&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_pending_requests&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_requests&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;
      },
      {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;priority&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;high&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_pending_requests&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;max_requests&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;
      }]
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;upstream_connection_options&amp;#34;&lt;/span&gt;: {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tcp_keepalive&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;keepalive_time&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;300&lt;/span&gt;
      }
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;: { }
    }


    ,
      {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;zipkin&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;STRICT_DNS&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;: {
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;seconds&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
        },
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: [
          {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;zipkin.istio-system&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9411&lt;/span&gt;}
          }
        ]
      }

    ]
  },

  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tracing&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;http&amp;#34;&lt;/span&gt;: {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;envoy.zipkin&amp;#34;&lt;/span&gt;,
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;collector_cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;zipkin&amp;#34;&lt;/span&gt;
      }
    }
  },


  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;stats_sinks&amp;#34;&lt;/span&gt;: [
    {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;envoy.statsd&amp;#34;&lt;/span&gt;,
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: {
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10.254.109.175&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;9125&lt;/span&gt;}
        }
      }
    }
  ]

}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹å›¾æ˜¯ä½¿ç”¨ Istio ç®¡ç†çš„ bookinfo ç¤ºä¾‹çš„è®¿é—®è¯·æ±‚è·¯å¾„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;006tNbRwgy1fvlwjd3302j31bo0ro0x5.jpg&#34; alt=&#34;Istio bookinfo&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯¹ç…§ bookinfo ç¤ºä¾‹çš„ productpage çš„æŸ¥çœ‹å»ºç«‹çš„è¿æ¥ã€‚åœ¨ &lt;code&gt;productpage-v1-745ffc55b7-2l2lw&lt;/code&gt; Pod çš„ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨ä¸­ä½¿ç”¨ root ç”¨æˆ·æŸ¥çœ‹æ‰“å¼€çš„ç«¯å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ lsof -i
COMMAND PID        USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy    9u  IPv4  &lt;span style=&#34;color:#ae81ff&#34;&gt;73951&lt;/span&gt;      0t0  TCP localhost:15000 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;LISTEN&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# Envoy admin ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   17u  IPv4  &lt;span style=&#34;color:#ae81ff&#34;&gt;74320&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:46862-&amp;gt;istio-pilot.istio-system.svc.cluster.local:15010 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 15010ï¼šistio-pilot çš„ grcp-xds ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   18u  IPv4  &lt;span style=&#34;color:#ae81ff&#34;&gt;73986&lt;/span&gt;      0t0  UDP productpage-v1-745ffc55b7-2l2lw:44332-&amp;gt;istio-statsd-prom-bridge.istio-system.svc.cluster.local:9125 &lt;span style=&#34;color:#75715e&#34;&gt;# ç»™ Promethues å‘é€ metric çš„ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   52u  IPv4  &lt;span style=&#34;color:#ae81ff&#34;&gt;74599&lt;/span&gt;      0t0  TCP *:15001 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;LISTEN&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# Envoy çš„ç›‘å¬ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   53u  IPv4  &lt;span style=&#34;color:#ae81ff&#34;&gt;74600&lt;/span&gt;      0t0  UDP productpage-v1-745ffc55b7-2l2lw:48011-&amp;gt;istio-statsd-prom-bridge.istio-system.svc.cluster.local:9125 &lt;span style=&#34;color:#75715e&#34;&gt;# ç»™ Promethues å‘é€ metric ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   54u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338551&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:15001-&amp;gt;172.17.8.102:52670 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 52670ï¼šIngress gateway ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   55u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338364&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:44046-&amp;gt;172.33.78.9:9091 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 9091ï¼šistio-telemetry æœåŠ¡çš„ grpc-mixer ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   56u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338473&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:47210-&amp;gt;zipkin.istio-system.svc.cluster.local:9411 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 9411: zipkin ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   58u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338383&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:41564-&amp;gt;172.33.84.8:9080 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 9080ï¼šdetails-v1 çš„ http ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   59u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338390&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:54410-&amp;gt;172.33.78.5:9080 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 9080ï¼šreivews-v2 çš„ http ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   60u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338411&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:35200-&amp;gt;172.33.84.5:9091 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 9091:istio-telemetry æœåŠ¡çš„ grpc-mixer ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   62u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338497&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:34402-&amp;gt;172.33.84.9:9080 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# reviews-v1 çš„ http ç«¯å£&lt;/span&gt;
envoy    &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; istio-proxy   63u  IPv4 &lt;span style=&#34;color:#ae81ff&#34;&gt;338525&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:50592-&amp;gt;172.33.71.5:9080 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# reviews-v3 çš„ http ç«¯å£&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¾“å‡ºçº§è¿‡ä¸Šå¯ä»¥éªŒè¯ Sidecar æ˜¯å¦‚ä½•æ¥ç®¡æµé‡å’Œä¸ istio-pilot é€šä¿¡ï¼ŒåŠå‘ Mixer åšé¥æµ‹æ•°æ®æ±‡èšçš„ã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å†å»çœ‹çœ‹å…¶ä»–å‡ ä¸ªæœåŠ¡çš„ istio-proxy å®¹å™¨ä¸­çš„ iptables å’Œç«¯å£ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial&#34;&gt;SOFAMesh &amp;amp; SOFA MOSNâ€”åŸºäºIstioæ„å»ºçš„ç”¨äºåº”å¯¹å¤§è§„æ¨¡æµé‡çš„Service Meshè§£å†³æ–¹æ¡ˆ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/kubectl/jsonpath/&#34;&gt;JSONPath Support - kubernetes.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34;&gt;iptables å‘½ä»¤ä½¿ç”¨è¯´æ˜ - wangchujiang.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules&#34;&gt;How To List and Delete Iptables Firewall Rules - digitalocean.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/fhefh/archive/2011/04/04/2005249.html&#34;&gt;ä¸€å¥ä¸€å¥è§£è¯´ iptablesçš„è¯¦ç»†ä¸­æ–‡æ‰‹å†Œ - cnblog.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34;&gt;å¸¸è§iptablesä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç† - aliang.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: èš‚èšé‡‘æœå¼€æºSOFAMesh</title>
      <link>https://jimmysong.io/blog/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial/</link>
      <pubDate>Mon, 16 Jul 2018 17:48:18 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial/</guid>
      <description>
        
        
        &lt;p&gt;4æœˆï¼Œèš‚èšé‡‘æœè‡ªä¸»ç ”å‘çš„åˆ†å¸ƒå¼ä¸­é—´ä»¶ï¼ˆScalable Open Financial Architectureï¼Œä»¥ä¸‹ç®€ç§° SOFA ï¼‰å¯åŠ¨å¼€æºè®¡åˆ’ï¼Œå¹¶å¼€æ”¾å¤šä¸ªç»„ä»¶ï¼Œï¼ˆç›¸å…³èƒŒæ™¯è¯·ç‚¹å‡»é“¾æ¥é˜…è¯»ã€Š&lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzI0Nzc3MTQyMw==&amp;amp;mid=2247484729&amp;amp;idx=1&amp;amp;sn=0d8dbee2739fb0eef3e4ad699661fd13&amp;amp;chksm=e9abbd49dedc345fd5d6898fd1989710f249d6386bf3d52ae1603365a4a1c3696538bc8b9a8f&amp;amp;scene=21#wechat_redirect&#34;&gt;å¼€æº |èš‚èšé‡‘æœå¯åŠ¨åˆ†å¸ƒå¼ä¸­é—´ä»¶å¼€æºè®¡åˆ’ï¼Œç”¨äºå¿«é€Ÿæ„å»ºé‡‘èçº§äº‘åŸç”Ÿæ¶æ„&lt;/a&gt;ã€‹ã€ã€Š&lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzI0Nzc3MTQyMw==&amp;amp;mid=2247485026&amp;amp;idx=1&amp;amp;sn=0a367bc67d5fe3a268e3715b17e020ab&amp;amp;chksm=e9abbe12dedc370489102d9307b832457891fdb0530eec5c35c0fb82bc2a3e6dbbc7db8436c4&amp;amp;scene=21#wechat_redirect&#34;&gt;å¼€æº | èš‚èšé‡‘æœåˆ†å¸ƒå¼ä¸­é—´ä»¶å¼€æºç¬¬äºŒå¼¹ï¼šä¸°å¯Œå¾®æœåŠ¡æ¶æ„ä½“ç³»&lt;/a&gt;ã€‹ï¼‰ï¼Œè¿™ä¸€ç³»åˆ—çš„åŠ¨ä½œå—åˆ°å¤§å®¶çš„å…³æ³¨å’Œæ”¯æŒï¼ŒSOFAç¤¾åŒºä¹Ÿæ—¥ç›Šå£®å¤§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸¤è½®å¼€æºä¹‹åï¼Œèš‚èšé‡‘æœè‡ªä¸»ç ”å‘çš„åˆ†å¸ƒå¼ä¸­é—´ä»¶ï¼ˆScalable Open Financial Architectureï¼Œä»¥ä¸‹ç®€ç§° SOFA ï¼‰åœ¨ä»Šå¤©æ¨å‡ºäº†&lt;strong&gt;ç¬¬ä¸‰è½®çš„å¼€æºäº§å“ï¼šSOFAMesh&lt;/strong&gt;ã€‚å’Œå‰ä¸¤è½®å¼€æºçš„å†ç»å¤šå¹´æ²‰æ·€å’Œæ‰“ç£¨çš„æˆç†Ÿäº§å“ä¸åŒï¼Œæœ¬è½®çš„å¼€æºä¸»è§’SOFAMeshï¼Œå°†æ¢ç´¢ä¸€æ¡å’Œä»¥å¾€äº§å“æœ‰æ‰€ä¸åŒçš„å¼€æºé“è·¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹åˆ°åº•æœ‰å“ªäº›ä¸åŒå§ï¼&lt;/p&gt;
&lt;h3 id=&#34;sofameshçš„å¼€æºæ¢ç´¢ä¹‹è·¯&#34;&gt;SOFAMeshçš„å¼€æºæ¢ç´¢ä¹‹è·¯&lt;/h3&gt;
&lt;p&gt;SOFAMeshå°è¯•åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè‡ªæˆ‘çªç ´å’Œå‹‡æ•¢æ¢ç´¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…¨æ–°çš„æŠ€æœ¯é¢†åŸŸ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Service Meshæ˜¯ç›®å‰æŠ€æœ¯ç¤¾åŒºæœ€ä¸ºç‚™æ‰‹å¯çƒ­çš„æ–°æŠ€æœ¯æ–¹å‘ï¼Œæœ‰ä¸‹ä¸€ä»£å¾®æœåŠ¡çš„æ˜æ˜¾è¶‹åŠ¿ã€‚ä½†æ˜¯ç›®å‰Service MeshæŠ€æœ¯è¿˜å¤„äºå‘å±•æ—©æœŸï¼Œæš‚æ—¶è¿˜æ²¡æœ‰æˆç†Ÿçš„äº§å“ï¼Œå°¤å…¶ç¼ºä¹å¤§è§„æ¨¡çš„è½åœ°å®è·µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¾ƒæ—©çš„å¼€æºæ—¶é—´&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šè¿°èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©äº†å°†å¯åŠ¨ä¸ä¹…çš„Service Meshäº§å“å¼€æºåœ¨å¼€å‘æ—©æœŸï¼Œä¹Ÿå°±æ˜¯è¿˜æœªæˆç†Ÿä¹‹æ—¶ï¼Œå°±å¯¹ç¤¾åŒºå¼€æ”¾ï¼Œå¼€æ”¾æºç å¹¶å¯»æ±‚ç¤¾åŒºåˆä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´åŠ å¼€æ”¾çš„æ€åº¦&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨SOFAMeshä¸Šï¼Œæˆ‘ä»¬æ„¿æ„ä»¥å¼€æºå…±å»ºçš„æ–¹å¼æ¥å’Œç¤¾åŒºä¸€èµ·æ¨è¿›Service MeshæŠ€æœ¯çš„æ›´å¥½å‘å±•å’Œå®ç°è½åœ°å®è·µï¼Œå…±åŒæ‰“é€ ä¸€ä¸ªæŠ€æœ¯å…ˆè¿›ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå…·å¤‡è‰¯å¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œå¯ä»¥å®å®åœ¨åœ¨çš„ç”Ÿäº§è½åœ°çš„ä¼˜ç§€äº§å“ã€‚æ¬¢è¿å›½å†…æŠ€æœ¯ç¤¾åŒºçš„æœ‹å‹ä»¬å’Œæˆ‘ä»¬å¼€å±•ä¸åŒå±‚é¢çš„äº¤æµä¸åˆä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŠ¡å®çš„äº§å“è·¯çº¿&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SOFAMeshåœ¨äº§å“è·¯çº¿ä¸Šï¼Œé€‰æ‹©äº†è·Ÿéšç¤¾åŒºä¸»æµï¼Œæˆ‘ä»¬é€‰æ‹©äº†ç›®å‰Service Meshä¸­æœ€æœ‰å½±å“åŠ›å’Œå‰æ™¯çš„Istioã€‚SOFAMeshä¼šåœ¨Istioçš„åŸºç¡€ä¸Šï¼Œæå‡æ€§èƒ½ï¼Œå¢åŠ æ‰©å±•æ€§ï¼Œå¹¶åœ¨è½åœ°å®è·µä¸Šåšæ¢ç´¢å’Œè¡¥å……ï¼Œä»¥å¼¥è¡¥ç›®å‰Istioçš„ä¸è¶³ï¼ŒåŒæ—¶ä¿æŒä¸Istioç¤¾åŒºçš„æ­¥éª¤ä¸€è‡´å’ŒæŒç»­è·Ÿè¿›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sofameshä»‹ç»&#34;&gt;SOFAMeshä»‹ç»&lt;/h3&gt;
&lt;p&gt;SOFAMeshå°†åœ¨å…¼å®¹Istioæ•´ä½“æ¶æ„å’Œåè®®çš„åŸºç¡€ä¸Šï¼Œåšå‡ºéƒ¨åˆ†è°ƒæ•´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨Golangè¯­è¨€å¼€å‘å…¨æ–°çš„Sidecarï¼Œæ›¿ä»£Envoy&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ºäº†é¿å…Mixerå¸¦æ¥çš„æ€§èƒ½ç“¶é¢ˆï¼Œåˆå¹¶Mixeréƒ¨åˆ†åŠŸèƒ½è¿›å…¥Sidecar&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pilotå’ŒCitadelæ¨¡å—è¿›è¡Œäº†å¤§å¹…çš„æ‰©å±•å’Œå¢å¼º&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬çš„ç›®æ ‡ï¼šæ‰“é€ ä¸€ä¸ªæ›´åŠ åŠ¡å®çš„Istioè½åœ°ç‰ˆæœ¬ï¼&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¤‡æ³¨ï¼šä»¥ä¸Šæ¶æ„è°ƒæ•´çš„ç»†èŠ‚ä»¥åŠæˆ‘ä»¬åšè°ƒæ•´çš„å‡ºå‘ç‚¹å’ŒåŸå› ï¼Œè¯·æµè§ˆ &lt;a href=&#34;http://www.servicemesher.com/blog/the-way-to-service-mesh-in-ant-financial/&#34;&gt;èš‚èšé‡‘æœå¤§è§„æ¨¡å¾®æœåŠ¡æ¶æ„ä¸‹çš„Service Meshæ¢ç´¢ä¹‹è·¯&lt;/a&gt; ä¸€æ–‡ï¼Œæœ‰éå¸¸è¯¦å°½çš„è§£é‡Šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;å¼€æºå†…å®¹&#34;&gt;å¼€æºå†…å®¹&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬è½®å¼€æºä¸­ï¼Œæˆ‘ä»¬å°†æ¨å‡ºSOFAMeshç›®å‰æ­£åœ¨å¼€å‘çš„ä¸¤å¤§æ¨¡å—ï¼šMOSNå’ŒSOFAPilotã€‚&lt;/p&gt;
&lt;h4 id=&#34;1mosn&#34;&gt;1.MOSN&lt;/h4&gt;
&lt;p&gt;SOFAMeshä¸­Golangç‰ˆæœ¬çš„Sidecarï¼Œæ˜¯ä¸€ä¸ªåä¸ºMOSN(Modular Observable Smart Netstub)çš„å…¨æ–°å¼€å‘çš„æ¨¡å—ï¼Œå®ç°Envoyçš„åŠŸèƒ½ï¼Œå…¼å®¹Envoyçš„APIï¼Œå¯ä»¥å’ŒIstioé›†æˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;mosn-with-service-mesh.png&#34; alt=&#34;mosn&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬ä¼šå¢åŠ å¯¹SOFARPCã€Dubboç­‰é€šè®¯åè®®çš„æ”¯æŒï¼Œä»¥ä¾¿æ›´å¥½çš„è¿åˆå›½å†…ç”¨æˆ·åŒ…æ‹¬æˆ‘ä»¬è‡ªèº«çš„å®é™…éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºSidecarç›¸å¯¹ç‹¬ç«‹ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿé¢„æœŸä¼šæœ‰å•ç‹¬ä½¿ç”¨MOSNçš„åœºæ™¯ï¼Œå› æ­¤MOSNçš„ä»£ç ä»“åº“æ˜¯ç‹¬ç«‹äºSOFAMeshçš„ï¼Œåœ°å€ä¸ºï¼š &lt;a href=&#34;https://github.com/sofastack/sofa-mosn&#34;&gt;https://github.com/sofastack/sofa-mosn&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶ä½¿ç”¨ï¼Œæä¾›éœ€æ±‚ã€åé¦ˆé—®é¢˜ã€è´¡çŒ®ä»£ç æˆ–è€…åˆä½œå¼€å‘ã€‚&lt;/p&gt;
&lt;h4 id=&#34;2sofapilot&#34;&gt;2.SOFAPilot&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å°†å¤§å¹…æ‰©å±•å’Œå¢å¼ºIstioä¸­çš„Pilotæ¨¡å—ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/006tKfTcgy1ft75pq8rplj31kw19sn5q.jpg&#34; alt=&#34;SOFAMesh Pilot architecture&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¢åŠ SOFARegistryçš„Adapterï¼Œæä¾›è¶…å¤§è§„æ¨¡æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¢åŠ æ•°æ®åŒæ­¥æ¨¡å—ï¼Œä»¥å®ç°å¤šä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¢åŠ Open Service Registry APIï¼Œæä¾›æ ‡å‡†åŒ–çš„æœåŠ¡æ³¨å†ŒåŠŸèƒ½&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;MOSNå’ŒSOFAPiloté…åˆï¼Œå°†å¯ä»¥æä¾›è®©ä¼ ç»Ÿä¾µå…¥å¼æ¡†æ¶ï¼ˆå¦‚Spring Cloudï¼ŒDubboï¼ŒSOFA RPCç­‰ï¼‰å’ŒService Meshäº§å“å¯ä»¥ç›¸äº’é€šè®¯çš„åŠŸèƒ½ï¼Œä»¥ä¾¿å¯ä»¥å¹³æ»‘çš„å‘Service Meshäº§å“æ¼”è¿›å’Œè¿‡æ¸¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pilotå’Œåé¢ä¼šé™†ç»­å¼€æ”¾çš„Mixerï¼ŒCitadelç­‰Istioæ¨¡å—&lt;/strong&gt;ï¼Œä¼šç»Ÿä¸€å­˜æ”¾åœ¨åŒä¸€ä¸ªä»Istio Forkå‡ºæ¥çš„ä»£ç ä»“åº“ä¸­ã€‚æœªæ¥ä¼šæŒç»­æ›´æ–°Istioæœ€æ–°ä»£ç ï¼Œä»¥ä¿æŒå’ŒIstioçš„ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é™„å½•&#34;&gt;é™„å½•&lt;/h3&gt;
&lt;p&gt;æœ¬æ–‡ä¸­æåˆ°çš„é“¾æ¥åœ°å€é›†åˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/mosn/mosn&#34;&gt;MOSN&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.servicemesher.com/blog/the-way-to-service-mesh-in-ant-financial/&#34;&gt;èš‚èšé‡‘æœå¤§è§„æ¨¡å¾®æœåŠ¡æ¶æ„ä¸‹çš„Service Meshæ¢ç´¢ä¹‹è·¯&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: åœ¨ Kubernetes ä¸­ä½¿ç”¨ Envoy mesh æ•™ç¨‹</title>
      <link>https://jimmysong.io/blog/envoy-mesh-in-kubernetes-tutorial/</link>
      <pubDate>Sat, 28 Apr 2018 20:26:53 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-mesh-in-kubernetes-tutorial/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡æ˜¯åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œä½¿ç”¨ Envoy æ¥åš meshï¼Œæ¥ä¸ºä¸€ä¸ªç®€å•çš„ä½¿ç”¨ Python ç¼–å†™çš„ Flask åº”ç”¨ç¨‹åºåšåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šæœ¬æ•™ç¨‹ä¸­çš„ç¤ºä¾‹æ¥è‡ª &lt;a href=&#34;https://github.com/datawire/envoy-steps&#34;&gt;envoy-steps&lt;/a&gt;ï¼Œæœ¬æ–‡ä¸­ä½¿ç”¨çš„æ‰€æœ‰çš„ä»£ç å’Œ YAML é…ç½®è§ &lt;a href=&#34;https://github.com/rootsongjc/envoy-tutorial&#34;&gt;envoy-tutorial&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/envoy-mesh-in-kubernetes.png&#34; alt=&#34;Envoy Meshæ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‰ææ¡ä»¶&#34;&gt;å‰ææ¡ä»¶&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; éƒ¨ç½² kubernetes é›†ç¾¤ï¼Œåªè¦å¯åŠ¨é›†ç¾¤å¹¶å®‰è£…äº† CoreDNS å³å¯ï¼Œæ— é¡»å®‰è£…å…¶ä»–æ’ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²åº”ç”¨&#34;&gt;éƒ¨ç½²åº”ç”¨&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆå°†åº”ç”¨éƒ¨ç½²åˆ° Kubernetes ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨ç½² postgres æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f postgres
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»º usersvc é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;docker build -t jimmysong/usersvc:step1 .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½² usersvcã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f usersvc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ uservc çš„ ClusterIP åœ°å€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ kubectl get svc usersvc
kubectl get svc usersvc
NAME      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;S&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;    AGE
usersvc   ClusterIP   10.254.176.248   &amp;lt;none&amp;gt;        5000/TCP   11m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿›åˆ° node1 ä¸­è®¿é—®è¯¥æœåŠ¡ï¼Œå› ä¸ºæˆ‘ä»¬è¦è®¿é—®çš„æ˜¯ ClusterIPï¼Œåœ¨æˆ‘ä»¬è‡ªå·±çš„ç”µè„‘ä¸Šæ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ï¼Œæ‰€ä»¥è¿›åˆ°è™šæ‹Ÿæœºä¸­æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ vagrant ssh node1
$ curl 10.254.176.248:5000
&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hostname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc-7cf5bb9d85-9gx7w&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;msg&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;user health check OK&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ok&amp;#34;&lt;/span&gt;: true,
  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;resolvedname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;172.33.10.7&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°è¯•æ·»åŠ ä¸€ä¸ªåä¸º &lt;code&gt;Alice&lt;/code&gt; çš„ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ curl -X PUT -H &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Content-Type: application/json&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{ &amp;#34;fullname&amp;#34;: &amp;#34;Alice&amp;#34;, &amp;#34;password&amp;#34;: &amp;#34;alicerules&amp;#34; }&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    10.254.176.248/user/alice
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;fullname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hostname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc-7cf5bb9d85-9gx7w&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ok&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;resolvedname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;172.33.10.7&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;uuid&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;EF43B475F65848C6BE708F436305864B&amp;#34;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°è¯•å†æ·»åŠ ä¸€ä¸ªåä¸º &lt;code&gt;Bob&lt;/code&gt; çš„ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ curl -X PUT -H &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Content-Type: application/json&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{ &amp;#34;fullname&amp;#34;: &amp;#34;Bob&amp;#34;, &amp;#34;password&amp;#34;: &amp;#34;bobrules&amp;#34; }&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    10.254.176.248/user/bob
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;fullname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hostname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc-7cf5bb9d85-9gx7w&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;ok&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;resolvedname&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;172.33.10.7&amp;#34;&lt;/span&gt;,
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;uuid&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6AC944E7D4254D9A811A82C0FDAC3046&amp;#34;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“åº”ç”¨éƒ¨ç½²å®Œæ¯•åï¼Œæˆ‘ä»¬è¯¥éƒ¨ç½² edge envoy äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²-edge-envoy&#34;&gt;éƒ¨ç½² edge envoy&lt;/h2&gt;
&lt;p&gt;éƒ¨ç½² edge envoy çš„æ–¹å¼å¾ˆç®€å•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f edge-envoy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨è®¿é—® edge envoy æ˜¯å°±å¯ä»¥è·¯ç”±åˆ° &lt;code&gt;usersvc&lt;/code&gt; ä¸Šçš„ï¼Œå½“ç„¶ç›´æ¥è®¿é—® &lt;code&gt;usersvc&lt;/code&gt; ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹ edge-envoy çš„ envoy é…ç½®æ–‡ä»¶å®šä¹‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;listeners&amp;#34;&lt;/span&gt;: [
    {
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp://0.0.0.0:80&amp;#34;&lt;/span&gt;,
      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;: [
        {
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;read&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http_connection_manager&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;codec_type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;auto&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ingress_http&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;: {
              &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;: [
                {
                  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;backend&amp;#34;&lt;/span&gt;,
                  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;],
                  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: [
                    {
                      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;timeout_ms&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
                      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/user&amp;#34;&lt;/span&gt;,
                      &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc&amp;#34;&lt;/span&gt;
                    }
                  ]
                }
              ]
            },
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;: [
              {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;decoder&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;router&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: {}
              }
            ]
          }
        }
      ]
    }
  ],
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;access_log_path&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp://127.0.0.1:8001&amp;#34;&lt;/span&gt;
  },
  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cluster_manager&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;: [
      {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;connect_timeout_ms&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;250&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lb_type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;round_robin&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;features&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http2&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: [
          {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp://usersvc:80&amp;#34;&lt;/span&gt;
          }
        ]
      }
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯è®¿é—® &lt;code&gt;edge-envoy&lt;/code&gt; çš„ &lt;code&gt;ClusterIP:8000/user/health&lt;/code&gt; å°±å¯ä»¥æ£€æŸ¥èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²-usersvc2&#34;&gt;éƒ¨ç½² usersvc2&lt;/h2&gt;
&lt;p&gt;åˆ é™¤åŸæ¥çš„ &lt;code&gt;usersvc&lt;/code&gt;ï¼Œéƒ¨ç½²ç¬¬äºŒç‰ˆ &lt;code&gt;usersvc2&lt;/code&gt;ï¼Œå®ƒä¸åŸæ¥çš„ &lt;code&gt;usersvc&lt;/code&gt; å”¯ä¸€ä¸åŒçš„åœ°æ–¹æ˜¯åœ¨ &lt;code&gt;entrypoint&lt;/code&gt; ä¸­é›†æˆäº† envoyï¼ŒæŸ¥çœ‹ &lt;code&gt;Dockerfile&lt;/code&gt; ä¸­æŒ‡å®šçš„ &lt;code&gt;entrypoint.sh&lt;/code&gt; çš„å†…å®¹ä¾¿å¯çŸ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
python /application/service.py &amp;amp;
/usr/local/bin/envoy -c /application/envoy.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆåˆ é™¤è€çš„ &lt;code&gt;usersvc&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl delete -f usersvc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤éƒ¨ç½² &lt;code&gt;usersvc2&lt;/code&gt;ï¼Œå®ƒä»ç„¶ä½¿ç”¨ &lt;code&gt;usersvc&lt;/code&gt; è¿™ä¸ª service åç§°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f usersvc2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy ä»¥ out-of-process çš„æ–¹å¼è¿è¡Œï¼Œå¯¹åº”ç”¨è¿›ç¨‹æ²¡æœ‰ä¾µå…¥æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ sidecar çš„æ–¹å¼è¿è¡Œï¼Œè®© envoy ä¸ åº”ç”¨å®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ª pod ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¢åŠ  &lt;code&gt;usersvc2&lt;/code&gt; çš„å®ä¾‹ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl scale --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; deployment/usersvc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬æœ‰ 3 ä¸ª usersvc å®ä¾‹ï¼Œç°åœ¨é€šè¿‡ &lt;code&gt;edge-envoy&lt;/code&gt; çš„ &lt;code&gt;ClusterIP:8000/user/health&lt;/code&gt; æ£€æŸ¥èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µæ—¶ï¼Œæ˜¯ä¸æ˜¯ä¼šè½®è¯¢çš„è®¿é—®åˆ°åç«¯çš„çš„ &lt;code&gt;usersvc2&lt;/code&gt; çš„å®ä¾‹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å½“åˆåœ¨ &lt;code&gt;edge-node&lt;/code&gt; çš„ &lt;code&gt;envoy.json&lt;/code&gt; ä¸­é…ç½®è¿‡ cluster çš„ï¼Œå…¶ä¸­æŒ‡å®šäº† &lt;code&gt;lb_type&lt;/code&gt; ä¸º &lt;code&gt;round_robin&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cluster_manager&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt; {
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;: [
      {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;connect_timeout_ms&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;250&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;usersvc&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;lb_type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;round_robin&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;features&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http2&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: [
          {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp://usersvc:80&amp;#34;&lt;/span&gt;
          }
        ]
      }
    ]
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œä¸”è¯¥ &lt;code&gt;serivce_name&lt;/code&gt; ä¹Ÿå¯ä»¥è¢« DNS æ­£ç¡®è§£æã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@usersvc-55b6857d44-gcg5c:/application# nslookup usersvc
Server:         10.254.0.2
Address:        10.254.0.2#53

Name:   usersvc.envoy-tutorial.svc.cluster.local
Address: 10.254.123.166
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è™½ç„¶é€šè¿‡ DNS å¯ä»¥æ­£ç¡®çš„è§£æå‡º serivce çš„ ClusterIPï¼Œä½†æ˜¯è´Ÿè½½å‡è¡¡ä¸å†é€šè¿‡ kube-proxy å®ç°ï¼Œæ‰€ä»¥ä¸è®ºæˆ‘ä»¬è®¿é—®å¤šå°‘æ¬¡ &lt;code&gt;edge-envoy&lt;/code&gt; æ°¸è¿œåªèƒ½è®¿é—®åˆ°ä¸€ä¸ªå›ºå®šçš„åç«¯ &lt;code&gt;usersvc&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡å‘ç°æœåŠ¡---sds&#34;&gt;æœåŠ¡å‘ç°æœåŠ¡ - SDS&lt;/h2&gt;
&lt;p&gt;Kubernetes ä¸­çš„ DNS å¯ä»¥å‘ç°æ‰€æœ‰ serivce çš„ ClusterIPï¼Œä½†æ˜¯ DNS ä¸­ä¸åŒ…æ‹¬æ‰€æœ‰ endpoint åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª SDSï¼ˆæœåŠ¡å‘ç°æœåŠ¡ï¼‰æ¥å‘ç°æœåŠ¡çš„æ‰€æœ‰çš„ endpointï¼Œæˆ‘ä»¬å°†ä¿®æ”¹ &lt;code&gt;lb_type&lt;/code&gt;ï¼Œä½¿ç”¨ &lt;code&gt;sds&lt;/code&gt; æ›¿ä»£ &lt;code&gt;strict_dns&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤éƒ¨ç½² SDSã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bassh&#34; data-lang=&#34;bassh&#34;&gt;kubectl apply -f usersvc-sds
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å› ä¸ºåœ¨æ·»åŠ äº† SDS ä¹‹åéœ€è¦ä¿®æ”¹ &lt;code&gt;edge-envoy&lt;/code&gt; ä¸­çš„ &lt;code&gt;envoy.josn&lt;/code&gt; é…ç½®ï¼Œåœ¨ &lt;code&gt;clusters&lt;/code&gt; å­—æ®µä¸­å¢åŠ  &lt;code&gt;sds&lt;/code&gt; ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„é…ç½®éƒ½å†™å¥½äº†ï¼Œé‡æ–°æ‰“åŒ…æˆäº†é•œåƒï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ é™¤ä¹‹å‰éƒ¨ç½²çš„ &lt;code&gt;edge-envoy&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl delete -f edge-envoy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²æ–°çš„ &lt;code&gt;edge-envoy2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f edge-envoy2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿ç»­è®¿é—® &lt;code&gt;usersvc&lt;/code&gt; 12 æ¬¡çœ‹çœ‹è¾“å‡ºç»“æœå¦‚ä½•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;URL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://172.17.8.101:30800/user/alice
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i in &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;seq &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; 12&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;;&lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; curl -s $URL|grep &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;resolvedname&amp;#34;&lt;/span&gt;|tr -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;|tr -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;|tr -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt;;&lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.71.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.88.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.10.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.71.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.88.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.10.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.71.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.88.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.10.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.71.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.88.2&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;resolvedname:172.33.10.2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æŸ¥çœ‹ä¸‹ &lt;code&gt;usersvc&lt;/code&gt; æœåŠ¡çš„æ‰€æœ‰ pod çš„ IP åœ°å€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ kubectl get pod -l service&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;usersvc -o wide
NAME                       READY     STATUS    RESTARTS   AGE       IP            NODE
usersvc-55b6857d44-mkfpv   1/1       Running   &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;          9m        172.33.88.2   node1
usersvc-55b6857d44-q98jg   1/1       Running   &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;          9m        172.33.71.2   node2
usersvc-55b6857d44-s2znk   1/1       Running   &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;          9m        172.33.10.2   node3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° round-robin è´Ÿè½½å‡è¡¡ç”Ÿæ•ˆäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.datawire.io/envoyproxy/envoy-flask-kubernetes/&#34;&gt;Part 2: Deploying Envoy with a Python Flask webapp and Kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/datawire/envoy-steps&#34;&gt;envoy-steps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/envoy-tutorial&#34;&gt;envoy-tutorial&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: Envoy çš„æ¶æ„ä¸åŸºæœ¬é…ç½®è§£æ</title>
      <link>https://jimmysong.io/blog/envoy-archiecture-and-terminology/</link>
      <pubDate>Fri, 27 Apr 2018 17:16:50 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-archiecture-and-terminology/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨äº†è§£ä¸€é—¨æŠ€æœ¯ä¹‹å‰ä¸€å¼€å§‹å°±è¦äº†è§£å…¶ä¸­çš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­ï¼Œåªæœ‰èå…¥äº†è¯¥è¯­å¢ƒæ‰èƒ½ç†è§£è¿™é—¨æŠ€æœ¯ã€‚æœ¬æ–‡å°†ä¸ºå¤§å®¶ä»‹ç» Envoy ä¸­çš„åŸºæœ¬æœ¯è¯­å’Œé‡ç‚¹æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶æ„&#34;&gt;æ¶æ„&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ Envoy proxy çš„æ¶æ„å›¾ï¼Œæ˜¾ç¤ºäº† host B ç»è¿‡ Envoy è®¿é—® host A çš„è¿‡ç¨‹ã€‚æ¯ä¸ª host ä¸Šéƒ½å¯èƒ½è¿è¡Œå¤šä¸ª serviceï¼ŒEnvoy ä¸­ä¹Ÿå¯èƒ½æœ‰å¤šä¸ª Listenerï¼Œæ¯ä¸ª Listener ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ª filter ç»„æˆäº† chainã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;U587b3a8535474a2abcbe93fa069341c0A.png&#34; alt=&#34;Envoy proxy æ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­çš„åŸºæœ¬æœ¯è¯­å°†åœ¨ä¸‹é¢è§£é‡Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºæœ¬æœ¯è¯­&#34;&gt;åŸºæœ¬æœ¯è¯­&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Host&lt;/strong&gt;ï¼šèƒ½å¤Ÿè¿›è¡Œç½‘ç»œé€šä¿¡çš„å®ä½“ï¼ˆåœ¨æ‰‹æœºæˆ–æœåŠ¡å™¨ç­‰ä¸Šçš„åº”ç”¨ç¨‹åºï¼‰ã€‚åœ¨ Envoy ä¸­ä¸»æœºæ˜¯æŒ‡é€»è¾‘ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åªè¦æ¯å°ä¸»æœºéƒ½å¯ä»¥ç‹¬ç«‹å¯»å€ï¼Œä¸€å—ç‰©ç†ç¡¬ä»¶ä¸Šå°±è¿è¡Œå¤šä¸ªä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Downstream&lt;/strong&gt;ï¼šä¸‹æ¸¸ï¼ˆdownstreamï¼‰ä¸»æœºè¿æ¥åˆ° Envoyï¼Œå‘é€è¯·æ±‚å¹¶æˆ–è·å¾—å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Upstream&lt;/strong&gt;ï¼šä¸Šæ¸¸ï¼ˆupstreamï¼‰ä¸»æœºè·å–æ¥è‡ª Envoy çš„é“¾æ¥è¯·æ±‚å’Œå“åº”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cluster&lt;/strong&gt;: é›†ç¾¤ï¼ˆclusterï¼‰æ˜¯ Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;å‘ç°é›†ç¾¤ä¸­çš„æˆå‘˜ã€‚Envoy å¯ä»¥é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking#arch-overview-health-checking&#34;&gt;ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶å†µã€‚Envoy å¦‚ä½•å°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤æˆå‘˜ç”±&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing#arch-overview-load-balancing&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;ç¡®å®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mesh&lt;/strong&gt;ï¼šä¸€ç»„äº’ç›¸åè°ƒä»¥æä¾›ä¸€è‡´ç½‘ç»œæ‹“æ‰‘çš„ä¸»æœºã€‚Envoy mesh æ˜¯æŒ‡ä¸€ç»„ Envoy ä»£ç†ï¼Œå®ƒä»¬æ„æˆäº†ç”±å¤šç§ä¸åŒæœåŠ¡å’Œåº”ç”¨ç¨‹åºå¹³å°ç»„æˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶ˆæ¯ä¼ é€’åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿è¡Œæ—¶é…ç½®&lt;/strong&gt;ï¼šä¸ Envoy ä¸€èµ·éƒ¨ç½²çš„å¸¦å¤–å®æ—¶é…ç½®ç³»ç»Ÿã€‚å¯ä»¥åœ¨æ— éœ€é‡å¯ Envoy æˆ– æ›´æ”¹ Envoy ä¸»é…ç½®çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ›´æ”¹è®¾ç½®æ¥å½±å“æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener&lt;/strong&gt;: ä¾¦å¬å™¨ï¼ˆlistenerï¼‰æ˜¯å¯ä»¥ç”±ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥çš„å‘½åç½‘ç»œä½ç½®ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unixåŸŸå¥—æ¥å­—ç­‰ï¼‰ã€‚Envoy å…¬å¼€ä¸€ä¸ªæˆ–å¤šä¸ªä¸‹æ¸¸ä¸»æœºè¿æ¥çš„ä¾¦å¬å™¨ã€‚ä¸€èˆ¬æ˜¯æ¯å°ä¸»æœºè¿è¡Œä¸€ä¸ª Envoyï¼Œä½¿ç”¨å•è¿›ç¨‹è¿è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨ä»»æ„æ•°é‡çš„ Listenerï¼ˆç›‘å¬å™¨ï¼‰ï¼Œç›®å‰åªç›‘å¬ TCPï¼Œæ¯ä¸ªç›‘å¬å™¨éƒ½ç‹¬ç«‹é…ç½®ä¸€å®šæ•°é‡çš„ï¼ˆL3/L4ï¼‰ç½‘ç»œè¿‡æ»¤å™¨ã€‚Listenter ä¹Ÿå¯ä»¥é€šè¿‡ Listener Discovery Serviceï¼ˆ&lt;strong&gt;LDS&lt;/strong&gt;ï¼‰åŠ¨æ€è·å–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener filter&lt;/strong&gt;ï¼šListener ä½¿ç”¨ listener filterï¼ˆç›‘å¬å™¨è¿‡æ»¤å™¨ï¼‰æ¥æ“ä½œé“¾æ¥çš„å…ƒæ•°æ®ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨ä¸æ›´æ”¹ Envoy çš„æ ¸å¿ƒåŠŸèƒ½çš„æƒ…å†µä¸‹æ·»åŠ æ›´å¤šçš„é›†æˆåŠŸèƒ½ã€‚Listener filter çš„ API ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºè¿™äº›è¿‡æ»¤å™¨æœ€ç»ˆæ˜¯åœ¨æ–°æ¥å—çš„å¥—æ¥å­—ä¸Šè¿è¡Œã€‚åœ¨é“¾ä¸­å¯ä»¥äº’ç›¸è¡”æ¥ä»¥æ”¯æŒæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚è°ƒç”¨é€Ÿç‡é™åˆ¶ã€‚Envoy å·²ç»åŒ…å«äº†å¤šä¸ªç›‘å¬å™¨è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Http Route Table&lt;/strong&gt;ï¼šHTTP çš„è·¯ç”±è§„åˆ™ï¼Œä¾‹å¦‚è¯·æ±‚çš„åŸŸåï¼ŒPath ç¬¦åˆä»€ä¹ˆè§„åˆ™ï¼Œè½¬å‘ç»™å“ªä¸ª Clusterã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Health checking&lt;/strong&gt;ï¼šå¥åº·æ£€æŸ¥ä¼šä¸SDSæœåŠ¡å‘ç°é…åˆä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå³ä½¿ä½¿ç”¨å…¶ä»–æœåŠ¡å‘ç°æ–¹å¼ï¼Œä¹Ÿæœ‰ç›¸åº”éœ€è¦è¿›è¡Œä¸»åŠ¨å¥åº·æ£€æŸ¥çš„æƒ…å†µã€‚è¯¦è§ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking&#34;&gt;health checking&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;xds&#34;&gt;xDS&lt;/h2&gt;
&lt;p&gt;xDS æ˜¯ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ç±»å‘ç°æœåŠ¡çš„ç»Ÿç§°ï¼Œå…¶åŒ…æ‹¬å¦‚ä¸‹å‡ ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CDSï¼šCluster Discovery Service&lt;/li&gt;
&lt;li&gt;EDSï¼šEndpoint Discovery Service&lt;/li&gt;
&lt;li&gt;SDSï¼šSecret Discovery Service&lt;/li&gt;
&lt;li&gt;RDSï¼šRoute Discovery Service&lt;/li&gt;
&lt;li&gt;LDSï¼šListener Discovery Service&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­£æ˜¯é€šè¿‡å¯¹ xDS çš„è¯·æ±‚æ¥åŠ¨æ€æ›´æ–° Envoy é…ç½®ï¼Œå¦å¤–è¿˜æœ‰ä¸ª ADSï¼ˆAggregated Discovery Serviceï¼‰é€šè¿‡èšåˆçš„æ–¹å¼è§£å†³ä»¥ä¸Š xDS çš„æ›´æ–°é¡ºåºé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-mesh&#34;&gt;Envoy Mesh&lt;/h2&gt;
&lt;p&gt;Envoy Mesh æŒ‡çš„æ˜¯ç”± envoy åšè´Ÿè½½å‡è¡¡å’Œä»£ç†çš„ meshã€‚è¯¥ Mesh ä¸­ä¼šåŒ…å«ä¸¤ç±» envoyï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Edge envoyï¼šå³æµé‡è¿›å‡º mesh æ—¶å€™çš„ envoyï¼Œç›¸å½“äº kubernetes ä¸­çš„ ingressã€‚&lt;/li&gt;
&lt;li&gt;Service envoyï¼šæœåŠ¡ envoy æ˜¯è·Ÿæ¯ä¸ª serivce å®ä¾‹ä¸€èµ·è¿è¡Œçš„ï¼Œåº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥çš„è¿›ç¨‹å¤–å·¥å…·ï¼Œåœ¨ kubernetes ä¸­ä¼šä¸åº”ç”¨å®¹å™¨ä»¥ sidecar å½¢å¼è¿è¡Œåœ¨åŒä¸€ä¸ª pod ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy å³å¯ä»¥å•ç‹¬ä½œä¸º edge envoyï¼Œä¹Ÿå¯ä»¥ä»…åš service envoy ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸¤è€…åŒæ—¶ä½¿ç”¨ã€‚Mesh ä¸­çš„æ‰€æœ‰ envoy ä¼šå…±äº«è·¯ç”±ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-é…ç½®&#34;&gt;Envoy é…ç½®&lt;/h2&gt;
&lt;p&gt;Envoy ä¸­çš„é…ç½®åŒ…æ‹¬ä¸¤å¤§ç±»ï¼šlistenner é…ç½®å’Œ cluster é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener-é…ç½®&#34;&gt;Listener é…ç½®&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ Envoy ä¸­å¯ä»¥é…ç½®ä¸€ç»„ listener ä»¥å®ç°å¤æ‚çš„å¤„ç†é€»è¾‘ã€‚Listener ä¸­è®¾ç½®ç›‘å¬çš„ TCP ç«¯å£ï¼Œè¿˜æœ‰ä¸€ç»„ filter å¯¹è¿™äº›ç«¯å£ä¸Šçš„æ•°æ®æµè¿›è¡Œå¤„ç†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œè¯¥ç¤ºä¾‹æ¥è‡ª&lt;a href=&#34;envoy-front-proxy.md&#34;&gt;ä½¿ç”¨Envoy ä½œä¸ºå‰ç«¯ä»£ç†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;listeners&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;filter_chains&lt;/span&gt;:
    - &lt;span style=&#34;color:#66d9ef&#34;&gt;filters&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: envoy.http_connection_manager
        &lt;span style=&#34;color:#66d9ef&#34;&gt;config&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;codec_type&lt;/span&gt;: auto
          &lt;span style=&#34;color:#66d9ef&#34;&gt;stat_prefix&lt;/span&gt;: ingress_http
          &lt;span style=&#34;color:#66d9ef&#34;&gt;route_config&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: local_route
            &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual_hosts&lt;/span&gt;:
            - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: backend
              &lt;span style=&#34;color:#66d9ef&#34;&gt;domains&lt;/span&gt;:
              - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
              &lt;span style=&#34;color:#66d9ef&#34;&gt;routes&lt;/span&gt;:
              - &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;prefix&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/service/1&amp;#34;&lt;/span&gt;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;route&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;cluster&lt;/span&gt;: service1
              - &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;prefix&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/service/2&amp;#34;&lt;/span&gt;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;route&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;cluster&lt;/span&gt;: service2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ª &lt;code&gt;http_connection_manager&lt;/code&gt; ä¾‹å­ï¼Œå…¶ä¸­å¿…é¡»åŒ…å« &lt;code&gt;virtual_hosts&lt;/code&gt; é…ç½®ï¼Œè€Œ &lt;code&gt;virtual_hosts&lt;/code&gt; é…ç½®ä¸­å¿…é¡»åŒ…å«ä»¥ä¸‹å‡ é¡¹é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt;ï¼šæœåŠ¡åç§°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;domains&lt;/code&gt;ï¼šDNS åŸŸåï¼Œå¿…é¡»èƒ½è·Ÿ &lt;code&gt;virtual_host&lt;/code&gt; çš„ URL åŒ¹é…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;routes&lt;/code&gt;ï¼šè·¯ç”±åˆ—è¡¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ä¸ªè·¯ç”±ä¸­è¿˜å¯ä»¥åŒ…å«ä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;prefix&lt;/code&gt;ï¼šURL è·¯å¾„å‰ç¼€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cluster&lt;/code&gt;ï¼šå¤„ç†è¯¥è¯·æ±‚çš„ envoy cluster&lt;/li&gt;
&lt;li&gt;&lt;code&gt;timeout_ms&lt;/code&gt;ï¼šå½“å‡ºé”™æ—¶çš„è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ &lt;code&gt;service1&lt;/code&gt; cluster å’Œ &lt;code&gt;service2&lt;/code&gt; clusterã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster-é…ç½®&#34;&gt;Cluster é…ç½®&lt;/h3&gt;
&lt;p&gt;Cluster æ˜¯ä¸€ç»„é€»è¾‘ç›¸ä¼¼çš„ä¸»æœºé…ç½®ï¼Œå®šä¹‰å“ªäº›ä¸»æœºå±äºä¸€ä¸ªæœåŠ¡ï¼Œcluster çš„é…ç½®ä¸­åŒ…å«äº†æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡æ–¹å¼é…ç½®ã€‚ä¾ç„¶æ˜¯å‚è€ƒ&lt;a href=&#34;envoy-front-proxy.md&#34;&gt;ä½¿ç”¨Envoy ä½œä¸ºå‰ç«¯ä»£ç†&lt;/a&gt;ä¸­çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;clusters&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: service1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;connect_timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.&lt;/span&gt;25s
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: strict_dns
    &lt;span style=&#34;color:#66d9ef&#34;&gt;lb_policy&lt;/span&gt;: round_robin
    &lt;span style=&#34;color:#66d9ef&#34;&gt;http2_protocol_options&lt;/span&gt;: {}
    &lt;span style=&#34;color:#66d9ef&#34;&gt;hosts&lt;/span&gt;:
    - &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: service1
        &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: service2
    &lt;span style=&#34;color:#66d9ef&#34;&gt;connect_timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.&lt;/span&gt;25s
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: strict_dns
    &lt;span style=&#34;color:#66d9ef&#34;&gt;lb_policy&lt;/span&gt;: round_robin
    &lt;span style=&#34;color:#66d9ef&#34;&gt;http2_protocol_options&lt;/span&gt;: {}
    &lt;span style=&#34;color:#66d9ef&#34;&gt;hosts&lt;/span&gt;:
    - &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: service2
        &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cluster çš„é…ç½®ä¸­è‡³å°‘åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt;ï¼šcluster åç§°ï¼Œå°±æ˜¯æœåŠ¡åç§°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;type&lt;/code&gt;ï¼šè¯¥ cluster æ€ä¹ˆçŸ¥é“ä¸»æœºæ˜¯å¦å¯åŠ¨ï¼Ÿå³æœåŠ¡å‘ç°ç±»å‹ï¼Œæœ‰ä»¥ä¸‹æ–¹å¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;static&lt;/code&gt;ï¼šç›‘å¬ cluster ä¸­çš„æ‰€æœ‰ä¸»æœº&lt;/li&gt;
&lt;li&gt;&lt;code&gt;strict_dns&lt;/code&gt;ï¼šenvoy ä¼šç›‘å¬ DNSï¼Œæ¯ä¸ªåŒ¹é…çš„ A è®°å½•éƒ½ä¼šè®¤å®šä¸ºæœ‰æ•ˆ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;logical_dns&lt;/code&gt;ï¼šenvoy å°†ä½¿ç”¨ DNS æ¥å¢åŠ ä¸»æœºï¼Œå¦‚æœ DNS ä¸å†è¿”å›è¯¥ä¸»æœºä¹Ÿä¸ä¼šåˆ é™¤è¿™äº›ä¸»æœºä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sds&lt;/code&gt;ï¼šå³ Serivce Discovery Serivceï¼Œenvoy è®¿é—®å¤–éƒ¨çš„ REST è·å– cluster æˆå‘˜ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lb_type&lt;/code&gt;ï¼šcluster çš„è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œæœ‰ä»¥ä¸‹æ–¹å¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;round_robin&lt;/code&gt;ï¼šè½®è¯¢ä¸»æœº&lt;/li&gt;
&lt;li&gt;&lt;code&gt;weighted_least_request&lt;/code&gt;ï¼šæœ€è¿‘è·å¾—æœ€å°‘è¯·æ±‚çš„ä¸»æœº&lt;/li&gt;
&lt;li&gt;&lt;code&gt;random&lt;/code&gt;ï¼šéšæœº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hosts&lt;/code&gt;ï¼šèƒ½å¤Ÿå®šä¹‰ cluster ä¸­ä¸»æœºçš„ URL åœ°å€ï¼Œé€šå¸¸æ˜¯&lt;code&gt;tcp://&lt;/code&gt; URL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy ä½œä¸º Istio ä¸­é»˜è®¤çš„æ•°æ®å¹³é¢ï¼Œå…³äº Istio å’Œ Envoy çš„æ›´å¤šè¯¦ç»†ä»‹ç»è¯·å‚è€ƒï¼š&lt;a href=&#34;https://jimmysong.io/istio-hanbdook&#34;&gt;Istio handbook&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.servicemesher.com&#34;&gt;ServiceMesher ç¤¾åŒºå®˜ç½‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/terminology&#34;&gt;Terminology - www.envoyproxy.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.datawire.io/envoyproxy/getting-started-envoyproxy-microservices-resilience/&#34;&gt;Part 1: Getting started with Envoy Proxy for microservices resilience&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/istio-handbook&#34;&gt;Istio Handbookâ€”â€”Istioä¸­æ–‡æŒ‡å—/æœåŠ¡ç½‘æ ¼å®è·µæ‰‹å†Œ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: ä½¿ç”¨ Envoy ä½œä¸ºå‰ç«¯ä»£ç†</title>
      <link>https://jimmysong.io/blog/envoy-as-front-proxy/</link>
      <pubDate>Sun, 22 Apr 2018 17:13:15 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-as-front-proxy/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;https://github.com/envoyproxy/envoy&#34;&gt;Envoy&lt;/a&gt; æ˜¯ä¸€æ¬¾ç”± Lyft å¼€æºçš„ï¼Œä½¿ç”¨ C++ ç¼–å†™çš„ L7 ä»£ç†å’Œé€šä¿¡æ€»çº¿ï¼Œç›®å‰æ˜¯ &lt;a href=&#34;https://cncf.io&#34;&gt;CNCF&lt;/a&gt; æ——ä¸‹çš„å¼€æºé¡¹ç›®ï¼Œä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œå®ƒä¹Ÿæ˜¯ &lt;a href=&#34;https://istio.io&#34;&gt;Istio&lt;/a&gt; service mesh ä¸­é»˜è®¤çš„ data planeã€‚æœ¬æ–‡å°†ç»™å‡ºä½¿ç”¨ Envoy ä½œä¸º service mesh çš„æ•°æ®å¹³é¢çš„ç¤ºä¾‹ï¼Œåº”ç”¨ä½¿ç”¨ docker-compose ç¼–æ’ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹æ€§&#34;&gt;ç‰¹æ€§&lt;/h2&gt;
&lt;p&gt;Envoy åŒ…æ‹¬å¦‚ä¸‹ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿›ç¨‹å¤–æ¶æ„ï¼Œä¸ä¾µå…¥åº”ç”¨è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç°ä»£ç‰ˆ C++11 ä»£ç &lt;/li&gt;
&lt;li&gt;L3/L4 filter æ¶æ„&lt;/li&gt;
&lt;li&gt;HTTP L7 filter æ¶æ„&lt;/li&gt;
&lt;li&gt;æ”¯æŒ HTTP/2&lt;/li&gt;
&lt;li&gt;HTTP L7 routing&lt;/li&gt;
&lt;li&gt;æ”¯æŒ gRPC&lt;/li&gt;
&lt;li&gt;æ”¯æŒ MongoDB L7&lt;/li&gt;
&lt;li&gt;åŠ¨æ€é…ç½®&lt;/li&gt;
&lt;li&gt;æœ€ä½³å¯è§‚æµ‹æ€§&lt;/li&gt;
&lt;li&gt;æ”¯æŒ front/edge proxy&lt;/li&gt;
&lt;li&gt;é«˜çº§è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;å¥åº·æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;æœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;æ”¯æŒ DynamoDB L7&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy æœ¬èº«æ— æ³•æ„æˆä¸€ä¸ªå®Œæ•´çš„ Service Meshï¼Œä½†æ˜¯å®ƒå¯ä»¥ä½œä¸º service mesh ä¸­çš„åº”ç”¨é—´æµé‡çš„ä»£ç†ï¼Œè´Ÿè´£ service mesh ä¸­çš„æ•°æ®å±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/&#34;&gt;Envoy å®˜ç½‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-ä½œä¸ºå‰ç«¯ä»£ç†&#34;&gt;Envoy ä½œä¸ºå‰ç«¯ä»£ç†&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯ä½¿ç”¨ Envoy ä½œä¸ºå‰ç«¯ä»£ç†çš„ä»‹ç»ï¼Œä»…ä½¿ç”¨ docker å®¹å™¨å’Œ docker-compose åšç¼–æ’åœ¨å•æœºä¸­è¿è¡Œï¼Œå¸®åŠ©æˆ‘ä»¬ä»æ›´åº•å±‚äº†è§£ Envoyï¼Œå½“æˆ‘ä»¬å°† Envoy ä½œä¸º Istio Service Mesh çš„ data panel çš„æ—¶å€™å°†æ›´åŠ æ¸¸åˆƒæœ‰ä½™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¿«é€Ÿå¼€å§‹&#34;&gt;å¿«é€Ÿå¼€å§‹&lt;/h2&gt;
&lt;p&gt;Envoy ä¸­çš„æ‰€æœ‰è§„åˆ™é…ç½®è·Ÿ Kubernetes ä¸€æ ·éƒ½æ˜¯é€šè¿‡ YAML æ–‡ä»¶æ¥å®Œæˆçš„ã€‚åœ¨ç»§ç»­ä¸‹é¢çš„æ­¥éª¤ä¹‹å‰ï¼Œé¦–å…ˆå…‹éš† Envoy çš„ GitHub repoã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;git clone https://github.com/envoyproxy/envoy.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è¿è¡Œ-sandbox-æµ‹è¯•&#34;&gt;è¿è¡Œ sandbox æµ‹è¯•&lt;/h2&gt;
&lt;p&gt;Envoy å®˜æ–¹æä¾›äº†ä»¥ä¸‹æ‰“åŒ…ç”¨ä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/front_proxy&#34;&gt;Front Proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/zipkin_tracing&#34;&gt;Zipkin Tracing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/jaeger_tracing&#34;&gt;Jaeger Tracing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/grpc_bridge&#34;&gt;gRPC Bridge&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¨éƒ¨å¯ä»¥ä½¿ç”¨ &lt;code&gt;docker-compose&lt;/code&gt; è¿è¡Œï¼Œä»£ç å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/envoyproxy/envoy/tree/master/examples&#34;&gt;https://github.com/envoyproxy/envoy/tree/master/examples&lt;/a&gt; æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;front-proxy&#34;&gt;Front proxy&lt;/h2&gt;
&lt;p&gt;Envoy åœ¨ envoymesh çš„è¾¹ç¼˜åšåå‘ä»£ç†ï¼Œè¯¦ç»†ä½¿ç”¨æ–¹å¼è§ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/front_proxy&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/front_proxy&lt;/a&gt;ï¼Œåœ¨æ­¤æˆ‘å°†è§£è¯´ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy æ˜¯å¦‚ä½•ä½œä¸ºè¿›ç¨‹å¤–æ¶æ„è¿è¡Œçš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºä½•è¯´ Envoy æ˜¯æ— ä¾µå…¥å¼æ¶æ„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Envoy ä½œä¸ºè¾¹ç¼˜åå‘ä»£ç†èƒ½åšä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬ç¤ºä¾‹çš„æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œæ­¤æ—¶ Envoy å°†ä½œä¸ºä¸€ä¸ªåå‘ä»£ç†ï¼Œç±»ä¼¼äº Nginxï¼Œä½†ä¸ Nginx ä¸åŒçš„æ˜¯å®ƒè¿˜ä¼šä½œä¸ºä¸€ä¸ªè¿›ç¨‹ï¼Œä¼´éšæ¯ä¸ªæœåŠ¡ä¸€èµ·è¿è¡Œåœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­ï¼ˆåœ¨ Kubernetes ä¸­å¯ä»¥ä½œä¸º Sidecar ä¸åº”ç”¨å®¹å™¨ä¸€èµ·è¿è¡Œåœ¨åŒä¸€ä¸ª Pod ä¸­ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;envoyproxy-docker-compose.png&#34; alt=&#34;Front proxy éƒ¨ç½²ç»“æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤ç¤ºä¾‹ä¸­ä¸€å…±æœ‰ 3 ä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå…¶åˆ›å»ºå®¹å™¨ç¼–æ’çš„ &lt;code&gt;docker-compose.yml&lt;/code&gt; æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;services&lt;/span&gt;:

  &lt;span style=&#34;color:#66d9ef&#34;&gt;front-envoy&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;build&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;context&lt;/span&gt;: .
      &lt;span style=&#34;color:#66d9ef&#34;&gt;dockerfile&lt;/span&gt;: Dockerfile-frontenvoy
    &lt;span style=&#34;color:#66d9ef&#34;&gt;volumes&lt;/span&gt;:
      - ./front-envoy.yaml:/etc/front-envoy.yaml
    &lt;span style=&#34;color:#66d9ef&#34;&gt;networks&lt;/span&gt;:
      - envoymesh
    &lt;span style=&#34;color:#66d9ef&#34;&gt;expose&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;80&amp;#34;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;8001&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;ports&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;8000:80&amp;#34;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;8001:8001&amp;#34;&lt;/span&gt;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;service1&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;build&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;context&lt;/span&gt;: .
      &lt;span style=&#34;color:#66d9ef&#34;&gt;dockerfile&lt;/span&gt;: Dockerfile-service
    &lt;span style=&#34;color:#66d9ef&#34;&gt;volumes&lt;/span&gt;:
      - ./service-envoy.yaml:/etc/service-envoy.yaml
    &lt;span style=&#34;color:#66d9ef&#34;&gt;networks&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;envoymesh&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;aliases&lt;/span&gt;:
          - service1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;environment&lt;/span&gt;:
      - SERVICE_NAME=&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;expose&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;80&amp;#34;&lt;/span&gt;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;service2&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;build&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;context&lt;/span&gt;: .
      &lt;span style=&#34;color:#66d9ef&#34;&gt;dockerfile&lt;/span&gt;: Dockerfile-service
    &lt;span style=&#34;color:#66d9ef&#34;&gt;volumes&lt;/span&gt;:
      - ./service-envoy.yaml:/etc/service-envoy.yaml
    &lt;span style=&#34;color:#66d9ef&#34;&gt;networks&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;envoymesh&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;aliases&lt;/span&gt;:
          - service2
    &lt;span style=&#34;color:#66d9ef&#34;&gt;environment&lt;/span&gt;:
      - SERVICE_NAME=&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;expose&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;80&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;networks&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;envoymesh&lt;/span&gt;: {}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ docker-compose å¯åŠ¨å¯ä»¥ä¿è¯ä¸‰ä¸ªæœåŠ¡éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œå†…ï¼Œå³ &lt;code&gt;frontproxy_envoymesh&lt;/code&gt; ç½‘ç»œä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;front-envoy&lt;/code&gt; æ˜¯å‰ç«¯ï¼ˆè¾¹ç¼˜ï¼‰Envoy æœåŠ¡ï¼Œç”¨æ¥åšåå‘ä»£ç†ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ &lt;code&gt;Dockerfile-frontenvoy&lt;/code&gt; æ–‡ä»¶æ¥æ„å»ºé•œåƒçš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¯¥ &lt;code&gt;Dockerfile&lt;/code&gt; çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; envoyproxy/envoy:latest&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get -q install -y &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    curl&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CMD&lt;/span&gt; /usr/local/bin/envoy -c /etc/front-envoy.yaml --service-cluster front-proxy&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;/etc/front-envoy.yaml&lt;/code&gt; æ˜¯æœ¬åœ°çš„ &lt;code&gt;front-envoy.yaml&lt;/code&gt; æŒ‚è½½è¿›å»çš„ã€‚æˆ‘ä»¬çœ‹ä¸‹è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static_resources&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;listeners&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;filter_chains&lt;/span&gt;:
    - &lt;span style=&#34;color:#66d9ef&#34;&gt;filters&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: envoy.http_connection_manager
        &lt;span style=&#34;color:#66d9ef&#34;&gt;config&lt;/span&gt;:
          &lt;span style=&#34;color:#66d9ef&#34;&gt;codec_type&lt;/span&gt;: auto
          &lt;span style=&#34;color:#66d9ef&#34;&gt;stat_prefix&lt;/span&gt;: ingress_http
          &lt;span style=&#34;color:#66d9ef&#34;&gt;route_config&lt;/span&gt;:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: local_route
            &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual_hosts&lt;/span&gt;:
            - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: backend
              &lt;span style=&#34;color:#66d9ef&#34;&gt;domains&lt;/span&gt;:
              - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
              &lt;span style=&#34;color:#66d9ef&#34;&gt;routes&lt;/span&gt;:
              - &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;prefix&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/service/1&amp;#34;&lt;/span&gt;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;route&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;cluster&lt;/span&gt;: service1
              - &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;prefix&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/service/2&amp;#34;&lt;/span&gt;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;route&lt;/span&gt;:
                  &lt;span style=&#34;color:#66d9ef&#34;&gt;cluster&lt;/span&gt;: service2
          &lt;span style=&#34;color:#66d9ef&#34;&gt;http_filters&lt;/span&gt;:
          - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: envoy.router
            &lt;span style=&#34;color:#66d9ef&#34;&gt;config&lt;/span&gt;: {}
  &lt;span style=&#34;color:#66d9ef&#34;&gt;clusters&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: service1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;connect_timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.&lt;/span&gt;25s
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: strict_dns
    &lt;span style=&#34;color:#66d9ef&#34;&gt;lb_policy&lt;/span&gt;: round_robin
    &lt;span style=&#34;color:#66d9ef&#34;&gt;http2_protocol_options&lt;/span&gt;: {}
    &lt;span style=&#34;color:#66d9ef&#34;&gt;hosts&lt;/span&gt;:
    - &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: service1
        &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: service2
    &lt;span style=&#34;color:#66d9ef&#34;&gt;connect_timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.&lt;/span&gt;25s
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: strict_dns
    &lt;span style=&#34;color:#66d9ef&#34;&gt;lb_policy&lt;/span&gt;: round_robin
    &lt;span style=&#34;color:#66d9ef&#34;&gt;http2_protocol_options&lt;/span&gt;: {}
    &lt;span style=&#34;color:#66d9ef&#34;&gt;hosts&lt;/span&gt;:
    - &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: service2
        &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;admin&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;access_log_path&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;socket_address&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;.0&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;port_value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;8001&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°å…¶ä¸­åŒ…æ‹¬äº†ä¸‰å¤§é…ç½®é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;static_resources&lt;/strong&gt;ï¼šè·¯ç”±é…ç½®ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cluster&lt;/strong&gt;ï¼šenvoymesh çš„æœåŠ¡æ³¨å†Œä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;admin&lt;/strong&gt;ï¼šç®¡ç†æ¥å£ï¼Œå¯ä»¥é€šè¿‡è®¿é—® 8001 ç«¯å£çš„ï¼Œè®¿é—® &lt;code&gt;/stats&lt;/code&gt;  è·å–å½“å‰ envoymesh çš„ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¿é—® &lt;code&gt;/server_info&lt;/code&gt; è·å– Envoy çš„ç‰ˆæœ¬ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;docker-compose&lt;/code&gt; å¯åŠ¨ä¸‰ä¸ªå®¹å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ pwd
envoy/examples/front-proxy
$ docker-compose up --build -d
$ docker-compose ps
        Name                       Command               State      Ports
-------------------------------------------------------------------------------------------------------------
example_service1_1      /bin/sh -c /usr/local/bin/ ... Up       80/tcp
example_service2_1      /bin/sh -c /usr/local/bin/ ... Up       80/tcp
example_front-envoy_1   /bin/sh -c /usr/local/bin/ ... Up       0.0.0.0:8000-&amp;gt;80/tcp, 0.0.0.0:8001-&amp;gt;8001/tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸‹é¢å°†è¿‡ä¸€é Envoy ä½œä¸ºå‰ç«¯ä»£ç†çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æ˜¯é€šç”¨åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è·¯ç”±&#34;&gt;è·¯ç”±&lt;/h3&gt;
&lt;p&gt;è®¿é—® service1 &lt;a href=&#34;http://localhost:8000/service/1&#34;&gt;http://localhost:8000/service/1&lt;/a&gt; å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ curl -v localhost:8000/service/1
* 
Trying ::1...
* TCP_NODELAY set
* Connected to localhost &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;::1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; port &lt;span style=&#34;color:#ae81ff&#34;&gt;8000&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#0)&lt;/span&gt;
&amp;gt; GET /service/1 HTTP/1.1
&amp;gt; Host: localhost:8000
&amp;gt; User-Agent: curl/7.54.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt; OK
&amp;lt; content-type: text/html; charset&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;utf-8
&amp;lt; content-length: &lt;span style=&#34;color:#ae81ff&#34;&gt;89&lt;/span&gt;
&amp;lt; server: envoy
&amp;lt; date: Fri, &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; Apr &lt;span style=&#34;color:#ae81ff&#34;&gt;2018&lt;/span&gt; 08:26:33 GMT
&amp;lt; x-envoy-upstream-service-time: &lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;
&amp;lt;
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: a3e4185a9a49 resolvedhostname: 172.18.0.4
* Connection &lt;span style=&#34;color:#75715e&#34;&gt;#0 to host localhost left intact&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—® service2 &lt;a href=&#34;http://localhost:8000/service/2&#34;&gt;http://localhost:8000/service/2&lt;/a&gt; å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;::1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; port &lt;span style=&#34;color:#ae81ff&#34;&gt;8000&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#0)&lt;/span&gt;
&amp;gt; GET /service/2 HTTP/1.1
&amp;gt; Host: localhost:8000
&amp;gt; User-Agent: curl/7.54.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt; OK
&amp;lt; content-type: text/html; charset&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;utf-8
&amp;lt; content-length: &lt;span style=&#34;color:#ae81ff&#34;&gt;89&lt;/span&gt;
&amp;lt; server: envoy
&amp;lt; date: Fri, &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; Apr &lt;span style=&#34;color:#ae81ff&#34;&gt;2018&lt;/span&gt; 08:27:27 GMT
&amp;lt; x-envoy-upstream-service-time: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&amp;lt;
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 2&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: f6650e1911a0 resolvedhostname: 172.18.0.3
* Connection &lt;span style=&#34;color:#75715e&#34;&gt;#0 to host localhost left intact&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°è®¿é—®è¯·æ±‚è¢«è·¯ç”±åˆ°äº†æ­£ç¡®çš„æœåŠ¡åç«¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è´Ÿè½½å‡è¡¡&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;å¢åŠ  service1 çš„ç¤ºä¾‹æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ docker-compose scale service1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
WARNING: The scale command is deprecated. Use the up command with the --scale flag instead.
Starting frontproxy_service1_1 ... &lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
Creating frontproxy_service1_2 ... &lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
Creating frontproxy_service1_3 ... &lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;

$ docker-compose ps
          Name                        Command               State                            Ports
---------------------------------------------------------------------------------------------------------------------------
frontproxy_front-envoy_1   /usr/bin/dumb-init -- /bin ...   Up      10000/tcp, 0.0.0.0:8000-&amp;gt;80/tcp, 0.0.0.0:8001-&amp;gt;8001/tcp
frontproxy_service1_1      /bin/sh -c /usr/local/bin/ ...   Up      10000/tcp, 80/tcp
frontproxy_service1_2      /bin/sh -c /usr/local/bin/ ...   Up      10000/tcp, 80/tcp
frontproxy_service1_3      /bin/sh -c /usr/local/bin/ ...   Up      10000/tcp, 80/tcp
frontproxy_service2_1      /bin/sh -c /usr/local/bin/ ...   Up      10000/tcp, 80/tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°ç°åœ¨ service1 å·²ç»æœ‰äº† 3 ä¸ªå®ä¾‹ï¼Œç°åœ¨å†è®¿é—® service1 &lt;a href=&#34;http://localhost:8000/service/1&#34;&gt;http://localhost:8000/service/1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; true;&lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; curl localhost:8000/service/1;sleep 1;&lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: a3e4185a9a49 resolvedhostname: 172.18.0.4
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: fe44dba64122 resolvedhostname: 172.18.0.5
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: c5b9f1289e0f resolvedhostname: 172.18.0.6
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: a3e4185a9a49 resolvedhostname: 172.18.0.4
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: fe44dba64122 resolvedhostname: 172.18.0.5
Hello from behind Envoy &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;service 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;! hostname: c5b9f1289e0f resolvedhostname: 172.18.0.6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°å¯¹ service1 çš„å·²ç»æœ‰è´Ÿè½½å‡è¡¡äº†ï¼Œä½¿ç”¨çš„ç­–ç•¥æ˜¯ &lt;code&gt;round_robin&lt;/code&gt;ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ &lt;code&gt;front-envoy.yaml&lt;/code&gt; æ–‡ä»¶ä¸­çš„ &lt;code&gt;cluster&lt;/code&gt; é¡¹ä¸‹é…ç½®çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;admin-ç«¯ç‚¹&#34;&gt;admin ç«¯ç‚¹&lt;/h3&gt;
&lt;p&gt;è®¿é—® &lt;a href=&#34;http://localhost:8001&#34;&gt;http://localhost:8001&lt;/a&gt; å¯ä»¥çœ‹åˆ° Envoy admin æä¾›ä»¥ä¸‹ç®¡ç† API ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‘½ä»¤&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;Admin ä¸»é¡µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/certs&lt;/td&gt;
&lt;td&gt;æ‰“å°æœºå™¨ä¸Šçš„ certs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/clusters&lt;/td&gt;
&lt;td&gt;upstream cluster çŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/config_dump&lt;/td&gt;
&lt;td&gt;è¾“å‡ºå½“å‰çš„ Envoy é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/cpuprofiler&lt;/td&gt;
&lt;td&gt;å¼€å¯/å…³é—­ CPU profiler&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/healthcheck/fail&lt;/td&gt;
&lt;td&gt;å¯¼è‡´æœåŠ¡å¤±è´¥å¥åº·æ£€æŸ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/healthcheck/ok&lt;/td&gt;
&lt;td&gt;å¯¼è‡´æœåŠ¡é€šè¿‡å¥åº·æ£€æŸ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/help&lt;/td&gt;
&lt;td&gt;æ‰“å°ç®¡ç†å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/hot_restart_version&lt;/td&gt;
&lt;td&gt;æ‰“å°çƒ­é‡å¯å…¼å®¹ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/listeners&lt;/td&gt;
&lt;td&gt;æ‰“å° listener åœ°å€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/logging&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢/æ›´æ”¹æ—¥å¿—çº§åˆ«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/quitquitquit&lt;/td&gt;
&lt;td&gt;é€€å‡ºæœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/reset_counters&lt;/td&gt;
&lt;td&gt;å°†è®¡æ•°å™¨é‡ç½®ä¸º 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/runtime&lt;/td&gt;
&lt;td&gt;æ‰“å°è¿è¡Œæ—¶å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/runtime_modify&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹è¿è¡Œæ—¶å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/server_info&lt;/td&gt;
&lt;td&gt;æ‰“å°æœåŠ¡å™¨ç‰ˆæœ¬/çŠ¶æ€ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/stats&lt;/td&gt;
&lt;td&gt;æ‰“å°æœåŠ¡å™¨çŠ¶æ€ç»Ÿè®¡ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/stats/prometheus&lt;/td&gt;
&lt;td&gt;æ‰“å° prometheus æ ¼å¼çš„æœåŠ¡å™¨çŠ¶æ€ç»Ÿè®¡ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Envoy æä¾›äº† API ç®¡ç†ç«¯ç‚¹ï¼Œå¯ä»¥å¯¹ Envoy è¿›è¡ŒåŠ¨æ€é…ç½®ï¼Œå‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api&#34;&gt;v2 API reference&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/front_proxy&#34;&gt;Front proxy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: Istio Service Mesh æ•™ç¨‹</title>
      <link>https://jimmysong.io/blog/istio-tutorial/</link>
      <pubDate>Wed, 18 Apr 2018 23:20:47 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-tutorial/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡æ˜¯ Istio ç®¡ç† Java å¾®æœåŠ¡çš„æ¡ˆä¾‹æ•™ç¨‹ï¼Œä½¿ç”¨çš„æ‰€æœ‰å·¥å…·å’Œè½¯ä»¶å…¨éƒ¨åŸºäºå¼€æºæ–¹æ¡ˆï¼Œæ›¿æ¢äº† &lt;a href=&#34;https://github.com/redhat-developer-demos/istio-tutorial&#34;&gt;redhat-developer-demos/istio-tutorial&lt;/a&gt; ä¸­çš„ minishift ç¯å¢ƒï¼Œä½¿ç”¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; æ›¿ä»£ï¼Œæ²¿ç”¨äº†åŸæœ‰çš„å¾®æœåŠ¡ç¤ºä¾‹ï¼Œä½¿ç”¨ Zipkin åšåˆ†å¸ƒå¼è¿½è¸ªè€Œä¸æ˜¯ Jaegerã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸­çš„ä»£ç å’Œ YAML æ–‡ä»¶è§ &lt;a href=&#34;https://github.com/rootsongjc/istio-tutorial&#34;&gt;https://github.com/rootsongjc/istio-tutorial&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‡†å¤‡ç¯å¢ƒ&#34;&gt;å‡†å¤‡ç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿›è¡Œæœ¬æ•™ç¨‹å‰éœ€è¦å…ˆå‡†å¤‡ä»¥ä¸‹å·¥å…·å’Œç¯å¢ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;8G ä»¥ä¸Šå†…å­˜&lt;/li&gt;
&lt;li&gt;Vagrant 2.0+&lt;/li&gt;
&lt;li&gt;Virtualbox 5.0 +&lt;/li&gt;
&lt;li&gt;æå‰ä¸‹è½½ kubernetes1.9.1 çš„ release å‹ç¼©åŒ…&lt;/li&gt;
&lt;li&gt;docker 1.12+&lt;/li&gt;
&lt;li&gt;kubectl 1.9.1+&lt;/li&gt;
&lt;li&gt;maven 3.5.2+&lt;/li&gt;
&lt;li&gt;istioctl 0.7.1&lt;/li&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;curlã€gzipã€tar&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/johanhaleby/kubetail&#34;&gt;kubetail&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/JoeDog/siege&#34;&gt;siege&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®‰è£…-kubernetes&#34;&gt;å®‰è£… Kubernetes&lt;/h2&gt;
&lt;p&gt;è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; åœ¨æœ¬åœ°å¯åŠ¨æ‹¥æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;git clone https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster.git
cd kubernetes-vagrant-centos-cluster
vagrant up
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; ä¸­çš„åŒ…å« Istio 0.7.1 çš„å®‰è£… YAML æ–‡ä»¶ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… Istioã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f addon/istio/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è¿è¡Œç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -n default -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f yaml/istio-bookinfo/bookinfo.yaml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ‚¨è‡ªå·±çš„æœ¬åœ°ä¸»æœºçš„&lt;code&gt;/etc/hosts&lt;/code&gt;æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;172.17.8.102 grafana.istio.jimmysong.io&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;172.17.8.102 servicegraph.istio.jimmysong.io&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;172.17.8.102 zipkin.istio.jimmysong.io&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„URLåœ°å€è®¿é—®ä»¥ä¸Šçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Service&lt;/th&gt;
&lt;th&gt;URL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;grafana&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://grafana.istio.jimmysong.io&#34;&gt;http://grafana.istio.jimmysong.io&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;servicegraph&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://servicegraph.istio.jimmysong.io/dotviz&#34;&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/a&gt;ï¼Œ&lt;a href=&#34;http://servicegraph.istio.jimmysong.io/graph&#34;&gt;http://servicegraph.istio.jimmysong.io/graph&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zipkin&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://zipkin.istio.jimmysong.io&#34;&gt;http://zipkin.istio.jimmysong.io&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¯¦ç»†ä¿¡æ¯è¯·å‚é˜… &lt;a href=&#34;https://istio.io/docs/guides/bookinfo.html&#34;&gt;https://istio.io/docs/guides/bookinfo.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨&#34;&gt;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨&lt;/h2&gt;
&lt;p&gt;åœ¨æ‰“åŒ…æˆé•œåƒéƒ¨ç½²åˆ° kubernetes é›†ç¾¤ä¸Šè¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨æœ¬åœ°è¿è¡Œæ‰€æœ‰ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ•™ç¨‹ä¸­ä¸‰ä¸ªæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;customer â†’ preference â†’ recommendation&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;customer&lt;/code&gt; å’Œ &lt;code&gt;preference&lt;/code&gt; å¾®æœåŠ¡æ˜¯åŸºäº Spring Boot æ„å»ºçš„ï¼Œ&lt;code&gt;recommendation&lt;/code&gt; å¾®æœåŠ¡æ˜¯åŸºäº &lt;a href=&#34;https://vertx.io&#34;&gt;vert.x&lt;/a&gt; æ„å»ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;customer&lt;/code&gt; å’Œ &lt;code&gt;preference&lt;/code&gt; å¾®æœåŠ¡çš„ &lt;code&gt;pom.xml&lt;/code&gt; æ–‡ä»¶ä¸­éƒ½å¼•å…¥äº† OpenTracing å’Œ Jeager çš„ä¾èµ–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;dependency&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
	&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;groupId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;io.opentracing.contrib&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
	&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;artifactId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;opentracing-spring-cloud-starter&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
	&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;version&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;0.1.7&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;dependency&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
	&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;groupId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;com.uber.jaeger&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
	&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;artifactId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;jaeger-tracerresolver&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;version&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;0.25.0&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æœ¬åœ°è¿è¡Œ&#34;&gt;æœ¬åœ°è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆåœ¨æœ¬åœ°ç¡®å®šæ‰€æœ‰çš„å¾®æœåŠ¡éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œç„¶åå†æ‰“åŒ…é•œåƒåœ¨ kubernetes é›†ç¾¤ä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨ Jaeger&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ docker æ¥è¿è¡Œ jaggerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;docker run -d &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --rm &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -p5775:5775/udp &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -p6831:6831/udp &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -p6832:6832/udp &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -p16686:16686 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -p14268:14268 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  jaegertracing/all-in-one:1.3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Jaeger UI åœ°å€ http://localhost:16686&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Customer&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd customer/java/springboot
JAEGER_SERVICE_NAME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;customer mvn &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  spring-boot:run &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -Drun.arguments&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;--spring.config.location=src/main/resources/application-local.properties&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡è®¿é—®åœ°å€ï¼š http://localhost:8280&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Preference&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd preference/java/springboot
JAEGER_SERVICE_NAME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;preference mvn &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  spring-boot:run &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -Drun.arguments&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;--spring.config.location=src/main/resources/application-local.properties&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡è®¿é—®åœ°å€ï¼šhttp://localhost:8180&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Recommendation&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd recommendation/java/vertx
mvn vertx:run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡è®¿é—®åœ°å€ï¼šhttp://localhost:8080&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰æœåŠ¡éƒ½å¯åŠ¨ä¹‹åï¼Œæ­¤æ—¶è®¿é—® http://localhost:8280 å°†ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;unknown&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯è®¿é—®ä¸€æ¬¡æœ€åçš„æ•°å­—å°±ä¼šåŠ  1ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Jaeger&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶è®¿é—® http://localhost:16686 å°†çœ‹åˆ° Jaeger query UIï¼Œæ‰€æœ‰åº”ç”¨å°† metrics å‘é€åˆ° Jeager ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨ Jaeger UI ä¸­æœç´¢ &lt;code&gt;customer&lt;/code&gt; å’Œ &lt;code&gt;preference&lt;/code&gt; service çš„ trace å¹¶æŸ¥çœ‹æ¯æ¬¡è¯·æ±‚çš„ tracingã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/jaeger-query-ui.png&#34; alt=&#34;Jaeger query UI&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ„å»ºé•œåƒ&#34;&gt;æ„å»ºé•œåƒ&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬åœ°è¿è¡Œæµ‹è¯•æ— è¯¯ä¹‹åå°±å¯ä»¥æ„å»ºé•œåƒäº†ã€‚æœ¬æ•™ç¨‹ä¸­çš„å®¹å™¨é•œåƒéƒ½æ˜¯åœ¨ &lt;a href=&#34;https://hub.docker.com/r/fabric8/java-jboss-openjdk8-jdk/~/dockerfile/&#34;&gt;fabric8/java-jboss-openjdk8-jdk&lt;/a&gt; çš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚åªè¦å°† Java åº”ç”¨æ„å»ºå‡º Jar åŒ…ç„¶åæ”¾åˆ° &lt;code&gt;/deployments&lt;/code&gt; ç›®å½•ä¸‹åŸºç¡€é•œåƒå°±å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ç€å‡ ä¸ªåº”ç”¨çš„ &lt;code&gt;Dockerfile&lt;/code&gt; æ–‡ä»¶ä¸­éƒ½æ²¡æœ‰æ‰§è¡Œå…¥å£ï¼ŒçœŸæ­£çš„æ‰§è¡Œå…¥å£æ˜¯ &lt;a href=&#34;https://github.com/fabric8io-images/java/blob/master/images/jboss/openjdk8/jdk/run-java.sh&#34;&gt;run-java.sh&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Customer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»º Customer é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd customer/java/springboot
mvn clean package
docker build -t jimmysong/istio-tutorial-customer:v1 .
docker push jimmysong/istio-tutorial-customer:v1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ä¸€æ¬¡æ„å»ºå’Œä¸Šä¼ éœ€è¦èŠ±è´¹ä¸€ç‚¹æ—¶é—´ï¼Œä¸‹ä¸€æ¬¡æ„å»ºå°±ä¼šå¾ˆå¿«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Preference&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»º Preference é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd preference/java/springboot
mvn clean package
docker build -t jimmysong/istio-tutorial-preference:v1 .
docker push jimmysong/istio-tutorial-preference:v1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Recommendation&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»º Recommendation é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd recommendation/java/vertx
mvn clean package
docker build -t jimmysong/istio-tutorial-recommendation:v1 .
docker push jimmysong/istio-tutorial-recommendation:v1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ä¸‰ä¸ª docker é•œåƒéƒ½æ„å»ºå®Œæˆäº†ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ docker images | grep istio-tutorial
REPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE
jimmysong/istio-tutorial-recommendation   v1                  d31dd858c300        &lt;span style=&#34;color:#ae81ff&#34;&gt;51&lt;/span&gt; seconds ago      443MB
jimmysong/istio-tutorial-preference       v1                  e5f0be361477        &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt; minutes ago       459MB
jimmysong/istio-tutorial-customer         v1                  d9601692673e        &lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt; minutes ago      459MB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²åˆ°-kubernetes&#34;&gt;éƒ¨ç½²åˆ° Kubernetes&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†ä»¥ä¸ŠæœåŠ¡éƒ¨ç½²åˆ° kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create new namespace&lt;/span&gt;
kubectl create ns istio-tutorial

&lt;span style=&#34;color:#75715e&#34;&gt;# deploy recommendation&lt;/span&gt;
kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f recommendation/kubernetes/Deployment.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-tutorial
kubectl apply -f recommendation/kubernetes/Service.yml

&lt;span style=&#34;color:#75715e&#34;&gt;# deploy preferrence&lt;/span&gt;
kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f preference/kubernetes/Deployment.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-tutorial
kubectl apply -f preference/kubernetes/Service.yml

&lt;span style=&#34;color:#75715e&#34;&gt;# deploy customer&lt;/span&gt;
kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f customer/kubernetes/Deployment.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-tutorial
kubectl apply -f customer/kubernetes/Service.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;**æ³¨æ„ï¼š**&lt;code&gt;preference&lt;/code&gt; å’Œ &lt;code&gt;customer&lt;/code&gt; åº”ç”¨å¯åŠ¨é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæˆ‘ä»¬å°† livenessProb é…ç½®ä¸­çš„ &lt;code&gt;initialDelaySeconds&lt;/code&gt; è®¾ç½®ä¸º &lt;strong&gt;20&lt;/strong&gt; ç§’ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ Pod å¯åŠ¨çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl get pod -w -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¢åŠ -ingress-é…ç½®&#34;&gt;å¢åŠ  Ingress é…ç½®&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†åœ¨ kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—® customer æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ  ingress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f ingress/ingress.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹æœ¬åœ°çš„ &lt;code&gt;/etc/hosts&lt;/code&gt; æ–‡ä»¶ï¼Œå¢åŠ ä¸€æ¡é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;172.17.8.102 customer.istio-tutorial.jimmysong.io&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨è®¿é—® &lt;a href=&#34;http://customer.istio-tutorial.jimmysong.io&#34;&gt;http://customer.istio-tutorial.jimmysong.io&lt;/a&gt; å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;customer&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;gt; preference =&amp;gt; recommendation v1 from &amp;#39;6fc97476f8-m2ntp&amp;#39;: 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰¹é‡è®¿é—®è¯¥åœ°å€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;./bin/poll_customer.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—® &lt;a href=&#34;http://servicegraph.istio.jimmysong.io/dotviz&#34;&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/a&gt; æŸ¥çœ‹æœåŠ¡çš„åˆ†å¸ƒå¼è¿½è¸ªå’Œä¾èµ–å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/istio-tutorial-zipkin-trace.png&#34; alt=&#34;åˆ†å¸ƒå¼è¿½è¸ª&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/istio-tutorial-zipkin-dependency.png&#34; alt=&#34;ä¾èµ–å…³ç³»&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®¿é—® &lt;a href=&#34;http://servicegraph.istio.jimmysong.io/dotviz&#34;&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/a&gt; æŸ¥çœ‹æœåŠ¡é—´çš„å…³ç³»å›¾å’Œ QPSã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/istio-tutorial-serivcegraph-dotviz.png&#34; alt=&#34;æœåŠ¡å…³ç³»å›¾å’ŒQPS&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®¿é—® &lt;a href=&#34;http://grafana.istio.jimmysong.io&#34;&gt;http://grafana.istio.jimmysong.io&lt;/a&gt; æŸ¥çœ‹ Service Mesh çš„ç›‘æ§ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://jimmysong.io/kubernetes-handbook/images/istio-tutorial-grafana.png&#34; alt=&#34;Grafana ç›‘æ§&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;istio-ä½¿ç”¨ç¤ºä¾‹&#34;&gt;Istio ä½¿ç”¨ç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è¯•ç”¨ Istio ä¸­çš„å„ç§åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºåº”ç”¨æ„å»ºå¤šä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸º recommendation æ„å»º v2 ç‰ˆæœ¬çš„é•œåƒï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Istio æ§åˆ¶å¾®æœåŠ¡çš„æµé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ„å»º-recommendationv2&#34;&gt;æ„å»º recommendation:v2&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†æ„å»ºæ–°ç‰ˆçš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡çš„é•œåƒï¼Œå¹¶è§‚å¯Ÿ &lt;code&gt;customer&lt;/code&gt; å¯¹ä¸åŒç‰ˆæœ¬çš„ &lt;code&gt;recommendataion&lt;/code&gt; æœåŠ¡çš„è®¿é—®é¢‘ç‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹ &lt;code&gt;recommendation/java/vertx/src/main/java/com/redhat/developer/demos/recommendation/RecommendationVerticle.java&lt;/code&gt; ç¨‹åºä¸­ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å°† &lt;code&gt;private static final String RESPONSE_STRING_FORMAT = &amp;quot;recommendation v1 from &#39;%s&#39;: %d\n&amp;quot;;&lt;/code&gt; ä¿®æ”¹ä¸º &lt;code&gt;private static final String RESPONSE_STRING_FORMAT = &amp;quot;recommendation v2 from &#39;%s&#39;: %d\n&amp;quot;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¹¶æ„å»º &lt;code&gt;recommendation:v2&lt;/code&gt; é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd recommendation/java/vertx
mvn clean package
docker build -t jimmysong/istio-tutorial-recommendation:v2 .
docker push jimmysong/istio-tutorial-recommendation:v2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†åº”ç”¨éƒ¨ç½²åˆ° kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# deploy recommendation&lt;/span&gt;
kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f recommendation/kubernetes/Deployment-v2.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ï¼Œå°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3581&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3582&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3583&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ° v1 å’Œ v2 ç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡ä¼šè¢«é—´éš”è®¿é—®åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†å°† v2 ç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; å®ä¾‹æ•°è®¾ç½®æˆ 2 ä¸ªã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl scale --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; deployment/recommendation-v2 -n istio-tutorial
kubectl get pod -w -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿ &lt;code&gt;recommendation-v2&lt;/code&gt; Pod è¾¾åˆ°ä¸¤ä¸ªä¹‹åå†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-j9fgj&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;71&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3651&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-j9fgj&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;72&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3652&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-j9fgj&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;73&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3653&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿè¾“å‡ºä¸­ v1 å’Œ v2 ç‰ˆæœ¬ &lt;code&gt;recommendation&lt;/code&gt; çš„è®¿é—®é¢‘ç‡ã€‚&lt;/p&gt;
&lt;p&gt;å°† &lt;code&gt;recommendataion&lt;/code&gt; æœåŠ¡çš„å®ä¾‹æ•°æ¢å¤ä¸º 1ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl scale --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; deployment/recommendation-v2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¿®æ”¹-istio-routerules&#34;&gt;ä¿®æ”¹ Istio RouteRules&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ‰€æœ‰è·¯æœ‰è§„åˆ™éƒ½æ˜¯é’ˆå¯¹ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡ï¼Œå¹¶åœ¨ repo çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°†æ‰€æœ‰æµé‡æ‰“ç»™ v2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°†æ¼”ç¤ºå¦‚ä½•åŠ¨æ€çš„åˆ’åˆ†ä¸åŒç‰ˆæœ¬æœåŠ¡é—´çš„æµé‡ï¼Œå°†æ‰€æœ‰çš„æµé‡éƒ½æ‰“åˆ° &lt;code&gt;recommendation:v2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v2.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°†çœ‹åˆ°æ‰€æœ‰çš„æµé‡éƒ½ä¼šæ‰“åˆ° &lt;code&gt;recommendation:v2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤ RouteRules åå†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°†çœ‹åˆ°åˆæ¢å¤äº† v1 å’Œ v2 ç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡çš„é—´éš”è®¿é—®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-default
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åˆ‡åˆ†æµé‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å°† 90% çš„æµé‡ç»™ v1ï¼Œ10% çš„æµé‡ç»™ v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1_and_v2.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ&lt;code&gt;bin/poll_customer.sh&lt;/code&gt; è§‚å¯Ÿè®¿é—®æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³åŠ¨æ€åˆ‡åˆ†æµé‡åªè¦ä¿®æ”¹ RouteRules ä¸­çš„ &lt;code&gt;weight&lt;/code&gt; é…ç½®å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;apiVersion&lt;/span&gt;: config.istio.io/v1alpha2
&lt;span style=&#34;color:#66d9ef&#34;&gt;kind&lt;/span&gt;: RouteRule
&lt;span style=&#34;color:#66d9ef&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: recommendation-v1-v2
&lt;span style=&#34;color:#66d9ef&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;destination&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;namespace&lt;/span&gt;: istio-tutorial
    &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;: recommendation
  &lt;span style=&#34;color:#66d9ef&#34;&gt;precedence&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;route&lt;/span&gt;:
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;version&lt;/span&gt;: v1
    &lt;span style=&#34;color:#66d9ef&#34;&gt;weight&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;90&lt;/span&gt;
  - &lt;span style=&#34;color:#66d9ef&#34;&gt;labels&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;version&lt;/span&gt;: v2
    &lt;span style=&#34;color:#66d9ef&#34;&gt;weight&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸º RouteRule æœ‰ä¼˜å…ˆçº§ï¼Œä¸ºäº†ç»§ç»­åé¢çš„å®éªŒï¼Œåœ¨éªŒè¯å®Œæˆååˆ é™¤è¯¥ RouteRuleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-v1-v2 -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ•…éšœæ³¨å…¥&#34;&gt;æ•…éšœæ³¨å…¥&lt;/h3&gt;
&lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†å¢å¼ºç³»ç»Ÿçš„å¥å£®æ€§ï¼Œéœ€è¦å¯¹ç³»ç»Ÿåšæ··æ²Œå·¥ç¨‹ï¼Œæ•…æ„æ³¨å…¥æ•…éšœï¼Œå¹¶ä¿éšœæœåŠ¡å¯ä»¥è‡ªåŠ¨å¤„ç†è¿™äº›æ•…éšœã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å…¥ HTTP 503 é”™è¯¯&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-503.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ 50% çš„å‡ ç‡æŠ¥ 503 é”™è¯¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;135&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; fault filter abort
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3860&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; fault filter abort
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; fault filter abort
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;136&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3861&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; fault filter abort
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; fault filter abort
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;137&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…ç† RouteRuleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-503 -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¢åŠ å»¶è¿Ÿ&#34;&gt;å¢åŠ å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;å¢åŠ æœåŠ¡çš„è®¿é—®å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-delay.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼šæœ‰ 50% çš„å‡ ç‡è®¿é—® &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡æœ‰ 7 ç§’çš„å»¶è¿Ÿã€‚ç™¾åˆ†æ¯”å’Œå»¶è¿Ÿæ—¶é—´å¯ä»¥åœ¨ RouteRule ä¸­é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç† RouteRuleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-delay -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é‡è¯•&#34;&gt;é‡è¯•&lt;/h3&gt;
&lt;p&gt;è®©æœåŠ¡ä¸æ˜¯ç›´æ¥å¤±è´¥ï¼Œè€Œæ˜¯å¢åŠ é‡è¯•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸‹é¢å°†åŒæ—¶åº”ç”¨ä¸¤æ¡ RouteRuleï¼Œè®©è®¿é—® &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡æ—¶æœ‰ 50% çš„å‡ ç‡å‡ºç° 503 é”™è¯¯ï¼Œå¹¶åœ¨å‡ºç°é”™è¯¯çš„æ—¶å€™å°è¯•è®¿é—® v2 ç‰ˆæœ¬ï¼Œè¶…æ—¶æ—¶é—´ä¸º 2 ç§’ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v2_503.yml -n istio-tutorial
istioctl create -f istiofiles/route-rule-recommendation-v2_retry.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ &lt;code&gt;bin/poll_customer.sh&lt;/code&gt; æˆ‘ä»¬çœ‹åˆ°ä¸€å¼€å§‹æœ‰äº› 503 é”™è¯¯ï¼Œç„¶åæ‰€æœ‰çš„æµé‡éƒ½æµå‘äº† v2ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç† RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-v2-retry -n istio-tutorial
istioctl delete routerule recommendation-v2-503 -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è¶…æ—¶&#34;&gt;è¶…æ—¶&lt;/h3&gt;
&lt;p&gt;è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåªæœ‰æœåŠ¡è®¿é—®è¶…æ—¶æ‰è®¤å®šæœåŠ¡è®¿é—®å¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;å–æ¶ˆæ³¨é‡Š &lt;code&gt;recommendation/java/vertx/src/main/java/com/redhat/developer/demos/recommendation/RecommendationVerticle.java&lt;/code&gt; ä¸­çš„ä¸‹é¢ä¸€è¡Œï¼Œå¢åŠ è¶…æ—¶æ—¶é—´ä¸º 3 ç§’ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;router&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;get&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;handler&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;timeout&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°ç”Ÿæˆé•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd recommendation/java/vertx
mvn clean package
docker build -t jimmysong/istio-tutorial-recommendation:v2 .
docker push jimmysong/istio-tutorial-recommendation:v2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°éƒ¨ç½²åˆ° kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl delete -f recommendation/kubernetes/Deployment-v2.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬é‡æ–°æ„å»ºçš„é•œåƒä½¿ç”¨äº†åŒæ ·çš„åå­—å’Œ tagï¼Œè€Œä¹‹å‰åœ¨ &lt;code&gt;Deployment-v2.yml&lt;/code&gt; ä¸­é…ç½®çš„é•œåƒæ‹‰å–ç­–ç•¥æ˜¯ &lt;code&gt;IfNotPresent&lt;/code&gt;ï¼Œè¿™æ ·çš„è¯å³ä½¿æˆ‘ä»¬æ„å»ºäº†æ–°çš„é•œåƒä¹Ÿæ— æ³•åº”ç”¨åˆ°é›†ç¾¤ä¸Šï¼Œå› æ­¤å°†é•œåƒæ‹‰å–ç­–ç•¥æ”¹æˆ &lt;code&gt;Always&lt;/code&gt; ç¡®ä¿æ¯æ¬¡å¯åŠ¨ Pod çš„æ—¶å€™éƒ½ä¼šæ‹‰å–é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f recommendation/kubernetes/Deployment-v2.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ç”¨è¶…æ—¶ RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-timeout.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;504&lt;/span&gt; upstream request timeout
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;4002&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;504&lt;/span&gt; upstream request timeout
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;4003&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;504&lt;/span&gt; upstream request timeout
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;4004&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…ç† RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-timeout -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åŸºäº-user-agent-çš„æ™ºèƒ½è·¯ç”±é‡‘ä¸é›€å‘å¸ƒ&#34;&gt;åŸºäº user-agent çš„æ™ºèƒ½è·¯ç”±ï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰&lt;/h3&gt;
&lt;p&gt;User-agent æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«äº†æµè§ˆå™¨çš„ä¿¡æ¯ï¼Œè®¿é—® &lt;a href=&#34;https://www.whoishostingthis.com/tools/user-agent&#34;&gt;https://www.whoishostingthis.com/tools/user-agent&lt;/a&gt; è·å–ä½ çš„ user-agentã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„ user-agent æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†æ‰€æœ‰çš„æµé‡æ‰“åˆ° v1ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ä½¿ç”¨ Safari æµè§ˆå™¨è®¿é—®çš„æµé‡æ‰“åˆ° v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-safari-recommendation-v2.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ç”¨ Safari æˆ–è€… Chromeï¼ˆChrome æµè§ˆå™¨çš„ user-agent ä¸­ä¹ŸåŒ…å« Safari å­—æ®µï¼‰è®¿é—® &lt;a href=&#34;http://customer.istio-tutorial.jimmysong.io/&#34;&gt;http://customer.istio-tutorial.jimmysong.io/&lt;/a&gt; åœ¨ç»è¿‡ 3 ç§’é’Ÿï¼ˆæˆ‘ä»¬åœ¨å‰é¢é‡æ–°ç¼–è¯‘ v2 é•œåƒï¼Œè®¾ç½®äº† 3 ç§’è¶…æ—¶æ—¶é—´ï¼‰åå°†çœ‹åˆ°è®¿é—® v2 çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è€…ä½¿ç”¨ curl è®¿é—®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;curl -A Safari http://customer.istio-tutorial.jimmysong.io/
curl -A Firefox http://customer.istio-tutorial.jimmysong.io/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿè¿”å›çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;å°†ç§»åŠ¨ç«¯ç”¨æˆ·çš„æµé‡å¯¼åˆ° v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-mobile-recommendation-v2.yml -n istio-tutorial

curl -A &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4(KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5&amp;#34;&lt;/span&gt; http://customer.istio-tutorial.jimmysong.io/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿè¾“å‡ºçš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç† RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-mobile -n istio-tutorial
istioctl delete routerule recommendation-safari -n istio-tutorial
istioctl delete routerule recommendation-default -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é•œåƒæµé‡&#34;&gt;é•œåƒæµé‡&lt;/h3&gt;
&lt;p&gt;ç¡®ä¿å½“å‰è‡³å°‘è¿è¡Œäº†ä¸¤ä¸ªç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡ï¼Œå¹¶ä¸”æ²¡æœ‰ RouteRuleã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šå¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl get routerule&lt;/code&gt; è·å– RouteRuleã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®æµé‡é•œåƒï¼Œå°†æ‰€æœ‰ v1 çš„æµé‡éƒ½è¢«é•œåƒåˆ° v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1-mirror-v2.yml -n istio-tutorial
bin/poll_customer.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ recommendation-v2 çš„æ—¥å¿—ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl logs -f &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;oc get pods|grep recommendation-v2|awk &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{ print $1 }&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; -c recommendation
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è®¿é—®æ§åˆ¶&#34;&gt;è®¿é—®æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;Istio å¯ä»¥è®¾ç½®æœåŠ¡è®¿é—®çš„é»‘ç™½åå•ï¼Œå¦‚æœæ²¡æœ‰æƒé™çš„è¯ä¼šè¿”å› HTTP 404 Not Foundã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç™½åå•&#34;&gt;ç™½åå•&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/acl-whitelist.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;404&lt;/span&gt; NOT_FOUND:preferencewhitelist.listchecker.istio-tutorial:customer is not whitelisted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡ç½®ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete -f istiofiles/acl-whitelist.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;é»‘åå•&#34;&gt;é»‘åå•&lt;/h4&gt;
&lt;p&gt;è®¾ç½®é»‘åå•ï¼Œæ‰€æœ‰ä½äºé»‘åå•ä¸­çš„æµé‡å°†è·å¾— 403 Forbidden è¿”å›ç ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/acl-blacklist.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;403&lt;/span&gt; PERMISSION_DENIED:denycustomerhandler.denier.istio-tutorial:Not allowed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡ç½®ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete -f istiofiles/acl-blacklist.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è´Ÿè½½å‡è¡¡&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯ round-robinï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Istio æŠŠå®ƒä¿®æ”¹æˆ randomã€‚&lt;/p&gt;
&lt;p&gt;å¢åŠ  v1 çš„å®ä¾‹æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl scale deployment recommendation-v1 --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŒç»­è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;bin/poll_customer.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿æŒå‰å°è¾“å‡ºï¼Œè§‚å¯Ÿæµé‡çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/recommendation_lb_policy_app.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿä¸€æ®µæ—¶é—´æµé‡çš„è¡Œä¸ºåï¼Œé‡ç½®ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete -f istiofiles/recommendation_lb_policy_app.yml -n istio-tutorial
kubectl scale deployment recommendation-v1 --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€Ÿç‡é™åˆ¶&#34;&gt;é€Ÿç‡é™åˆ¶&lt;/h3&gt;
&lt;p&gt;æš‚æ—¶ä¸å¯ç”¨&lt;/p&gt;
&lt;h3 id=&#34;æ–­è·¯å™¨&#34;&gt;æ–­è·¯å™¨&lt;/h3&gt;
&lt;p&gt;å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•°å’Œæœ€å¤§æŒ‚èµ·è¯·æ±‚æ•°æ—¶å¿«é€Ÿå¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;å°†æµé‡åœ¨ v1 å’Œ v2 ä¹‹é—´å‡åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1_and_v2_50_50.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœªå¼€å¯æ–­è·¯å™¨çš„æ—¶å€™å¯åŠ¨è´Ÿè½½æµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ siege -r &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; -c &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; -v customer.istio-tutorial.jimmysong.io
New configuration template added to /Users/jimmysong/.siege
Run siege -C to view the current settings in that file
** SIEGE 4.0.4
** Preparing &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; concurrent users &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; battle.
The server is now under siege...
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.10 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.12 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.13 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.13 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.13 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.17 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.12 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.14 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.17 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.17 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.20 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.20 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.05 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.12 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.25 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.26 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.14 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.58 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     6.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     6.16 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.03 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     6.06 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     6.04 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.11 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.09 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     6.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     6.71 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     3.52 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
^C
Lifting the server siege...
Transactions:		          &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt; hits
Availability:		      100.00 %
Elapsed time:		        7.99 secs
Data transferred:	        0.00 MB
Response time:		        2.99 secs
Transaction rate:	        3.88 trans/sec
Throughput:		        0.00 MB/sec
Concurrency:		       11.60
Successful transactions:          &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt;
Failed transactions:	           &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
Longest transaction:	        6.71
Shortest transaction:	        0.05
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰çš„è¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ï¼Œå› ä¸º v2 ç‰ˆæœ¬è®¾ç½®äº† 3 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ç”¨ä¸‹æ–­è·¯å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/recommendation_cb_policy_version_v2.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°æµ‹è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ siege -r &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; -c &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; -v customer.istio-tutorial.jimmysong.io
** SIEGE 4.0.4
** Preparing &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; concurrent users &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; battle.
The server is now under siege...
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.07 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.07 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.07 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.12 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.12 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.16 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.16 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.21 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.21 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.24 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.24 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.14 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.29 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.13 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.18 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.13 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.11 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.39 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.24 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.44 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.43 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.44 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.40 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.47 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.42 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.42 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.06 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.07 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.12 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.57 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.18 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.52 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.65 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.42 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.09 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.43 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;     0.04 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;92&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     4.15 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;74&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /
HTTP/1.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;     0.01 secs:      &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt; bytes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; GET  /

Transactions:		          &lt;span style=&#34;color:#ae81ff&#34;&gt;19&lt;/span&gt; hits
Availability:		       47.50 %
Elapsed time:		        4.16 secs
Data transferred:	        0.00 MB
Response time:		        0.72 secs
Transaction rate:	        4.57 trans/sec
Throughput:		        0.00 MB/sec
Concurrency:		        3.31
Successful transactions:          &lt;span style=&#34;color:#ae81ff&#34;&gt;19&lt;/span&gt;
Failed transactions:	          &lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;
Longest transaction:	        4.15
Shortest transaction:	        0.01
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å¯ç”¨äº†æ–­è·¯å™¨åå„é¡¹æ€§èƒ½éƒ½æœ‰æé«˜ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete routerule recommendation-v1-v2 -n istio-tutorial
istioctl delete -f istiofiles/recommendation_cb_policy_version_v2.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;pool-ejection&#34;&gt;Pool Ejection&lt;/h3&gt;
&lt;p&gt;æ‰€è°“çš„ Pool Ejection å°±æ˜¯å½“æŸäº›å®ä¾‹å‡ºç°é”™è¯¯ï¼ˆå¦‚è¿”å› 5xx é”™è¯¯ç ï¼‰ä¸´æ—¶å°†è¯¥å®ä¾‹å¼¹å‡ºä¸€æ®µæ—¶é—´åï¼ˆçª—å£æœŸï¼Œå¯é…ç½®ï¼‰ï¼Œç„¶åå†å°†å…¶åŠ å…¥åˆ°è´Ÿè½½å‡è¡¡æ± ä¸­ã€‚æˆ‘ä»¬çš„ä¾‹å­ä¸­é…ç½®çš„çª—å£æœŸæ˜¯ 15 ç§’ã€‚&lt;/p&gt;
&lt;p&gt;å°† v1 å’Œ v2 çš„æµé‡å‡åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1_and_v2_50_50.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  v2 çš„å®ä¾‹ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl scale deployment recommendation-v2 --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; -n istio-tutorial
kubectl get pods -w
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç­‰å¾…æ‰€æœ‰çš„ Pod çš„çŠ¶æ€éƒ½å¯åŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨åˆ° v2 çš„å®¹å™¨ä¸­æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ kubectl exec recommendation-v2-785465d9cd-225ms -c recommendation /bin/bash
$ curl localhost:8080/misbehave
Following requests to &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/&amp;#39;&lt;/span&gt; will &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; a &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  Pool Ejection é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/recommendation_cb_policy_pool_ejection.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ bin/poll_customer.sh
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10505&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2407&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10506&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2408&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10507&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10508&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10509&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; recommendation misbehavior from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;785465d9cd-ldc6j&amp;#39;&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2409&lt;/span&gt;
customer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; preference &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2410&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°çª—å£æœŸç”Ÿæ•ˆäº†ï¼Œå½“å‡ºç° 503 é”™è¯¯åè‡³å°‘ 15 ç§’åæ‰ä¼šå‡ºç°ç¬¬äºŒæ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;å³ä½¿æœ‰äº†è´Ÿè½½å‡è¡¡æ± å¼¹å‡ºç­–ç•¥å¯¹äºç³»ç»Ÿçš„å¼¹æ€§æ¥è¯´ä¾ç„¶è¿˜ä¸å¤Ÿï¼Œå¦‚æœä½ çš„æœåŠ¡æœ‰å¤šä¸ªå¯ç”¨å®ä¾‹ï¼Œå¯ä»¥å°†&lt;strong&gt;æ–­è·¯å™¨&lt;/strong&gt;ã€&lt;strong&gt;é‡è¯•&lt;/strong&gt;ã€&lt;strong&gt;Pool Ejection&lt;/strong&gt; ç­‰ç­–ç•¥ç»„åˆèµ·æ¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚åœ¨ä»¥ä¸Šçš„ Pool Ejection çš„åŸºç¡€ä¸Šå¢åŠ é‡è¯•ç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl replace -f istiofiles/route-rule-recommendation-v1_and_v2_retry.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°±çœ‹ä¸åˆ° 503 é”™è¯¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl scale deployment recommendation-v2 --replicas&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; -n istio-tutorial
istioctl delete routerule recommendation-v1-v2 -n istio-tutorial
istioctl delete -f istiofiles/recommendation_cb_policy_pool_ejection.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;egress&#34;&gt;Egress&lt;/h3&gt;
&lt;p&gt;Egress æ˜¯ç”¨æ¥é…ç½® Istio serivce mesh ä¸­çš„æœåŠ¡å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://istio.doczh.cn/docs/tasks/traffic-management/egress.html&#34;&gt;æ§åˆ¶ Egress æµé‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ç¤ºä¾‹è¿˜æœ‰é—®é¢˜ï¼Œæ— æ³•æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºç¤ºä¾‹é•œåƒ egresshttpbinã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd egress/egresshttpbin/
mvn clean package
docker build -t jimmysong/istio-tutorial-egresshttpbin:v1 .
docker push jimmysong/istio-tutorial-egresshttpbin:v1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²åˆ° Kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f egress/egresshttpbin/src/main/kubernetes/Deployment.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-toturial
kubectl create -f egress/egresshttpbin/src/main/kubernetes/Service.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†åœ¨ kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—®åˆ°è¯¥æœåŠ¡ï¼Œä¿®æ”¹å¢åŠ  ingress é…ç½®å¹¶ä¿®æ”¹æœ¬åœ°çš„&lt;code&gt;/etc/hosts&lt;/code&gt; æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å‰é¢å·²ç»å®Œæˆäº†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºç¤ºä¾‹é•œåƒ egressgithubã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cd egress/egressgithub
mvn clean package
docker build -t jimmysong/istio-tutorial-egressgithub:v1 .
docker push jimmysong/istio-tutorial-egressgithub:v1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²åˆ° Kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl apply -f &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f egress/egressgithub/src/main/kubernetes/Deployment.yml&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; -n istio-tutorial
kubectl create -f egress/egressgithub/src/main/kubernetes/Service.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  Egress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/egress_httpbin.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ° egresshttpbin å®¹å™¨ä¸­æµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl exec -it &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;oc get pods -o jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{.items[*].metadata.name}&amp;#34;&lt;/span&gt; -l app&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;egresshttpbin,version&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;v1&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; -c egresshttpbin /bin/bash

curl localhost:8080

curl httpbin.org/user-agent

curl httpbin.org/headers

exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ å¯¹ &lt;a href=&#34;https://jimmysong.io&#34;&gt;jimmysong.io&lt;/a&gt; çš„ egress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | istioctl create -f -
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;apiVersion: config.istio.io/v1alpha2
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kind: EgressRule
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;metadata:
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  name: jimmysong-egress-rule
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  namespace: istio-tutorial
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;spec:
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  destination:
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    service: jimmysong.io
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  ports:
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    - port: 443
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      protocol: https
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  Egress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl create -f istiofiles/egress_github.yml -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ° egressgithub å®¹å™¨ä¸­æµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl exec -it &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;oc get pods -o jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{.items[*].metadata.name}&amp;#34;&lt;/span&gt; -l app&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;egressgithub,version&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;v1&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; -c egressgithub /bin/bash

curl http://jimmysong:443

exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…ç†ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;istioctl delete egressrule httpbin-egress-rule jimmysong-egress-rule github-egress-rule -n istio-tutorial
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/redhat-developer-demos/istio-tutorial&#34;&gt;https://github.com/redhat-developer-demos/istio-tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developers.redhat.com/books/introducing-istio-service-mesh-microservices/&#34;&gt;Book - Introducing Istio Service Mesh for Microservices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: Istio ç¤¾åŒºä»‹ç»ä¸ç¤¾åŒºå‚ä¸æ³¨æ„äº‹é¡¹</title>
      <link>https://jimmysong.io/blog/istio-community-tips/</link>
      <pubDate>Sat, 14 Apr 2018 18:34:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-community-tips/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡è®²è¿°äº†å‚ä¸ Istio ç¤¾åŒºå’Œè¿›è¡Œ Istio å¼€å‘æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œç»„&#34;&gt;å·¥ä½œç»„&lt;/h3&gt;
&lt;p&gt;ç»å¤§å¤šæ•°å¤æ‚çš„å¼€æºé¡¹ç›®éƒ½æ˜¯ä»¥å·¥ä½œç»„çš„æ–¹å¼ç»„ç»‡çš„ï¼Œè¦æƒ³ä¸º Istio ç¤¾åŒºåšè´¡çŒ®å¯ä»¥åŠ å…¥åˆ°ä»¥ä¸‹çš„å·¥ä½œç»„ï¼ˆWorking Groupï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#api-management&#34;&gt;API Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#config&#34;&gt;Config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#environments&#34;&gt;Environments&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#networking&#34;&gt;Networking&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#performance-and-scalability&#34;&gt;Performance &amp;amp; Scalability&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#policies-and-telemetry&#34;&gt;Policies &amp;amp; Telemetry&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#security&#34;&gt;Security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#test-and-release&#34;&gt;Test &amp;amp; Release&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä»£ç è§„èŒƒ&#34;&gt;ä»£ç è§„èŒƒ&lt;/h3&gt;
&lt;p&gt;Istio çš„ä»£ç è§„èŒƒæ²¿ç”¨ &lt;a href=&#34;https://github.com/cncf/foundation/blob/master/code-of-conduct.md&#34;&gt;CNCF ç¤¾åŒºçš„ä»£ç è§„èŒƒ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€å‘æŒ‡å—&#34;&gt;å¼€å‘æŒ‡å—&lt;/h3&gt;
&lt;p&gt;è¿›è¡Œ Istio å¼€å‘ä¹‹å‰éœ€è¦åšä¸‹é¢å‡ ä»¶äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®åŸºç¡€ç¯å¢ƒï¼Œå¦‚ Kubernetes&lt;/li&gt;
&lt;li&gt;é…ç½®ä»£ç åº“ã€ä¸‹è½½ä¾èµ–å’Œæµ‹è¯•&lt;/li&gt;
&lt;li&gt;é…ç½® CircleCI é›†æˆç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;ç¼–å†™å‚è€ƒæ–‡æ¡£&lt;/li&gt;
&lt;li&gt;Git workflow é…ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦è§ &lt;a href=&#34;https://github.com/istio/istio/wiki/Dev-Guide&#34;&gt;Dev Guide wiki&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¾è®¡æ–‡æ¡£&#34;&gt;è®¾è®¡æ–‡æ¡£&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰çš„è®¾è®¡æ–‡æ¡£éƒ½ä¿å­˜åœ¨ &lt;a href=&#34;https://drive.google.com/drive/u/0/folders/0AIS5p3eW9BCtUk9PVA&#34;&gt;Google Drive&lt;/a&gt; ä¸­ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Technical Oversight Committeeï¼šToCç®¡ç†çš„æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;Miscï¼šä¸€äº›æ‚é¡¹&lt;/li&gt;
&lt;li&gt;Working Groupsï¼šæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå„ä¸ªå·¥ä½œç»„ç›¸å…³çš„è®¾è®¡æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;Presentationsï¼šIstio ç›¸å…³çš„æ¼”è®²å¹»ç¯ç‰‡ï¼Œä»è¿™äº›æ–‡ç¨¿ä¸­å¯ä»¥å¿«é€Ÿäº†è§£ Istio&lt;/li&gt;
&lt;li&gt;Logoï¼šIstio logo&lt;/li&gt;
&lt;li&gt;Engï¼šç¤¾åŒºç›¸å…³çš„ç»´æŠ¤æ–‡æ¡£&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤¾åŒºè§’è‰²åˆ’åˆ†&#34;&gt;ç¤¾åŒºè§’è‰²åˆ’åˆ†&lt;/h3&gt;
&lt;p&gt;æ ¹æ®å¯¹å¼€å‘è€…å’Œè¦æ±‚å’Œè´¡çŒ®ç¨‹åº¦çš„ä¸åŒï¼ŒIstio ç¤¾åŒºä¸­åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#collaborator&#34;&gt;Collaborator&lt;/a&gt;ï¼šéæ­£å¼è´¡çŒ®è€…ï¼Œå¶å°”è´¡çŒ®ï¼Œä»»ä½•äººéƒ½å¯ä»¥æˆä¸ºè¯¥è§’è‰²&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#member&#34;&gt;Member&lt;/a&gt;ï¼šæ­£å¼è´¡çŒ®è€…ï¼Œç»å¸¸è´¡çŒ®ï¼Œå¿…é¡»æœ‰2ä¸ªå·²æœ‰çš„ member æå&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#approver&#34;&gt;Approver&lt;/a&gt;ï¼šè€æ‰‹ï¼Œå¯ä»¥æ‰¹å‡† member çš„è´¡çŒ®&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#lead&#34;&gt;Lead&lt;/a&gt;ï¼šç®¡ç†åŠŸèƒ½ã€é¡¹ç›®å’Œæè®®ï¼Œå¿…é¡»ç”± &lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUP-PROCESSES.md&#34;&gt;ToC&lt;/a&gt; æå&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#administrator&#34;&gt;Administrator&lt;/a&gt;ï¼šç®¡ç†å‘˜ï¼Œç®¡ç†å’Œæ§åˆ¶æƒé™ï¼Œå¿…é¡»ç”± ToC æå&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#vendor&#34;&gt;Vendor&lt;/a&gt;ï¼šè´¡çŒ® Istio é¡¹ç›®çš„æ‰©å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦è§ &lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md&#34;&gt;Istio Community Roles&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å„ç§åŠŸèƒ½çš„çŠ¶æ€&#34;&gt;å„ç§åŠŸèƒ½çš„çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;Istio ä¸­çš„æ‰€æœ‰ feature æ ¹æ®&lt;strong&gt;æ˜¯å¦ç”Ÿäº§å¯ç”¨&lt;/strong&gt;ã€&lt;strong&gt;APIå…¼å®¹æ€§&lt;/strong&gt;ã€&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;ã€&lt;strong&gt;ç»´æŠ¤ç­–ç•¥&lt;/strong&gt;åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Alphaï¼šä»…ä»…å¯ä»¥ä½œä¸º demoï¼Œæ— æ³•ç”Ÿäº§ä¸Šä½¿ç”¨ï¼Œä¹Ÿæ²¡æœ‰æ€§èƒ½ä¿è¯ï¼Œéšæ—¶éƒ½å¯èƒ½ä¸ç»´æŠ¤&lt;/li&gt;
&lt;li&gt;Betaï¼šå¯ä»¥åœ¨ç”Ÿäº§ä¸Šä½¿ç”¨äº†ï¼Œä¹Ÿæœ‰ç‰ˆæœ¬åŒ–çš„ API ä½†æ˜¯æ— æ³•ä¿è¯æ€§èƒ½ï¼Œä¿è¯ä¸‰ä¸ªæœˆçš„ç»´æŠ¤&lt;/li&gt;
&lt;li&gt;Stableï¼šå¯ä»¥ä¸Šç”Ÿäº§è€Œä¸”è¿˜èƒ½ä¿è¯æ€§èƒ½ï¼ŒAPI å‘åå…¼å®¹ï¼Œä¿è¯ä¸€å¹´çš„ç»´æŠ¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio çš„ feature åˆ†ä¸ºå››å¤§ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼šå„ç§åè®®çš„æ”¯æŒã€è·¯ç”±è§„åˆ™é…ç½®ã€Ingress TLS ç­‰&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§ï¼šç›‘æ§ã€æ—¥å¿—ã€åˆ†å¸ƒå¼è¿½è¸ªã€æœåŠ¡ä¾èµ–æ‹“æ‰‘&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§ï¼šå„ç§ checker å’Œå®‰å…¨æ€§é…ç½®&lt;/li&gt;
&lt;li&gt;Coreï¼šæ ¸å¿ƒåŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŠŸèƒ½åˆ’åˆ†ä¸å„ç§åŠŸèƒ½çš„çŠ¶æ€è¯¦æƒ…è¯·è§ï¼šhttps://istio.io/about/feature-stages.html&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦Istioï¼Ÿ</title>
      <link>https://jimmysong.io/blog/why-do-we-need-istio/</link>
      <pubDate>Mon, 19 Mar 2018 23:43:33 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/why-do-we-need-istio/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡è¯‘è‡ª&lt;a href=&#34;https://medium.com/google-cloud/istio-why-do-i-need-it-18d122838ee3&#34;&gt;Istio Why do I need it?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘æœ€è¿‘æ²¡æœ‰å¤šå°‘æ—¶é—´å»ç©k8sï¼Œå¹¶æ‰¿è®¤Istioåˆ°åº•ç»™k8så¸¦æ¥äº†ä»€ä¹ˆæ–¹é¢æœ‰ç‚¹è¿·å¤±äº†ã€‚è¿™æ˜¯å¦ä¼šå¢åŠ æ›´å¤šçš„è¿è¥å¼€é”€ï¼Ÿå®ƒæ˜¯å¦ç®€åŒ–äº†æˆ‘ä»¬é€šå¸¸éœ€è¦åšçš„äº‹æƒ…ï¼Ÿè¿™äº›é—®é¢˜éƒ½æµ®ç°åœ¨æˆ‘çš„è„‘æµ·é‡Œã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆæˆ‘æ€€ç–‘åœ¨å‘å¸ƒäº†è¿™äº›å†…å®¹ä¹‹åï¼Œæˆ‘çš„å›¢é˜Ÿä¸­æ¯”æˆ‘æ›´æ‡‚k8sçš„äººå¯èƒ½ä¼šæƒ³æ‰¾æˆ‘è°ˆè°ˆ&amp;hellip;&amp;hellip;è™½ç„¶æˆ‘è®²ä¼šè·Ÿå›¢é˜Ÿä¸­çš„æˆå‘˜è¾©è®ºï¼Œä½†é‚£å°†æ˜¯æˆ‘æœ€å–œæ¬¢çš„å¯¹è¯ï¼‰&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆIstioç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://istio.io/&#34;&gt;Istioç½‘ç«™&lt;/a&gt;ä¸Šè¯´ï¼š&lt;/p&gt;
&lt;p&gt;Istioå¸¦ç»™ä½ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTPã€gRPCã€WebSocketå’ŒTCPæµé‡çš„è‡ªåŠ¨è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ä¸°å¯Œçš„è·¯ç”±è§„åˆ™ã€é‡è¯•ã€æ•…éšœè½¬ç§»å’Œæ•…éšœæ³¨å…¥å¯¹æµé‡è¡Œä¸ºè¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒè®¿é—®æ§åˆ¶ã€é€Ÿç‡é™åˆ¶å’Œé…é¢çš„å¯æ‹”æ’ç­–ç•¥å±‚å’Œé…ç½®APIã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨æŒ‡æ ‡ã€æ—¥å¿—å’Œé›†ç¾¤å†…æ‰€æœ‰æµé‡çš„è·Ÿè¸ªï¼ŒåŒ…æ‹¬é›†ç¾¤å…¥å£å’Œå‡ºå£ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡é›†ç¾¤ä¸­çš„æœåŠ¡ä¹‹é—´çš„å¼ºèº«ä»½æ–­è¨€æ¥å®ç°æœåŠ¡é—´çš„èº«ä»½éªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åœ¨æ•´ä¸ªç¯å¢ƒä¸­éƒ¨ç½²ä¸€ä¸ªç‰¹æ®Šçš„sidecarä»£ç†ï¼ˆè¾…åŠ©å®¹å™¨ï¼‰ï¼Œæ‚¨å¯ä»¥å°†Istioæ”¯æŒæ·»åŠ åˆ°æœåŠ¡ä¸­ï¼ˆè¿™ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œå¦‚æœæ‚¨æƒ³åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·å‚é˜…åé¢çš„å†…å®¹ï¼‰ã€‚å®‰è£…äº†sidecarä»£ç†ä¹‹åï¼Œï¼ˆå¾®ï¼‰æœåŠ¡ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡éƒ½é€šè¿‡è¿™ä¸ªä»£ç†ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰çš„ç½‘ç»œé€šä¿¡éƒ½æ˜¯ä½¿ç”¨Istioçš„æ§åˆ¶å¹³é¢åŠŸèƒ½è¿›è¡Œé…ç½®å’Œç®¡ç†çš„ã€‚&lt;/p&gt;
&lt;p&gt;Istioæ˜¯&lt;strong&gt;Service Meshï¼ˆæœåŠ¡ç½‘æ ¼ï¼‰&lt;/strong&gt;ã€‚æˆ‘è®¤ä¸ºçš„service meshå®šä¹‰å°±æ˜¯â€œå®ƒæ˜¯ä¸€ä¸ªä¸“ç”¨çš„åŸºç¡€è®¾æ–½å±‚ï¼Œä½¿å¾—æœåŠ¡é—´çš„é€šä¿¡å®‰å…¨ã€é«˜æ•ˆå’Œå¯é â€&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¦‚æœåƒæˆ‘ä¸€æ ·ï¼Œä½ ä»&lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/overview.html&#34;&gt;æ¦‚å¿µæ–‡æ¡£&lt;/a&gt;å¼€å§‹çœ‹çš„è¯ï¼Œä¸Šé¢æœ‰è¿™æ ·çš„å†…å®¹ï¼šâ€œæœ¯è¯­&lt;strong&gt;service mesh&lt;/strong&gt;é€šå¸¸ç”¨äºæè¿°ç»„æˆè¿™äº›åº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œä»¥åŠå®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚éšç€æœåŠ¡ç½‘æ ¼çš„å¤§å°å’Œå¤æ‚ç¨‹åº¦ä¸æ–­å¢åŠ ï¼Œå¯èƒ½ä¼šå˜å¾—éš¾ä»¥ç†è§£å’Œç®¡ç†ã€‚å¯èƒ½å‡ºç°åŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å¹³è¡¡ã€æ•…éšœæ¢å¤ã€åº¦é‡å’Œç›‘æ§ï¼Œä»¥åŠæ›´å¤æ‚çš„éœ€æ±‚ï¼Œå¦‚A/Bæµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒã€é€Ÿç‡é™åˆ¶ã€è®¿é—®æ§åˆ¶å’Œç«¯åˆ°ç«¯èº«ä»½éªŒè¯ã€‚Istioæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å¯¹æ•´ä¸ªæœåŠ¡ç½‘æ ¼æä¾›è¡Œä¸ºåˆ†æå’Œæ“ä½œæ§åˆ¶æ¥æ»¡è¶³å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„å„ç§éœ€æ±‚ã€‚â€œ&lt;/p&gt;
&lt;p&gt;è¯»å®Œä¹‹åä½ å¯èƒ½ä¼šåƒæˆ‘ä¸€æ ·å›°æƒ‘ï¼æœ€ååœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€åœˆå…³äºä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ä¹‹åï¼Œæˆ‘ç»ˆäºææ˜ç™½äº†ã€‚æˆ‘æœ€åä½¿ç”¨çš„å¯èƒ½æ˜¯ä¸€ä¸ªåœ¨æ‰€æœ‰æœç´¢åˆ°çš„æ ·æœ¬é‡Œä¸€ä¸ªéä»£è¡¨æ€§çš„å…±è¯†ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªåˆç†çš„é€‰æ‹©ã€‚ä¸è¿‡æœ‰ä¸ªç»†èŠ‚ç¡®å®äº†ï¼Œå°±æ˜¯å¦‚ä½•å°†å®ƒä¸k8sç­‰ç¼–æ’å·¥å…·åˆ†å¼€ã€‚Istioéœ€è¦è·Ÿk8sä¸€èµ·ä½¿ç”¨ï¼Œæ²¡æœ‰k8sæˆ–å…¶ä»–å®¹å™¨ç¼–æ’å·¥å…·çš„å®ƒå°±ä¸å­˜åœ¨äº†å—ï¼Ÿå®ƒæ²¡æœ‰åšç¼–æ’ï¼Œå®é™…ä¸Šå®ƒçš„æ˜¯ä¸ºè§£å†³ç®¡ç†åŸºäºå¾®æœåŠ¡çš„è§£å†³æ–¹æ¡ˆä¸­ç½‘ç»œå’Œæ“ä½œå¤æ‚æ€§è€Œè®¾è®¡çš„ã€‚å®ƒæ¶µç›–çš„èŒƒå›´å°±åƒk8sä¸€æ ·ï¼ç°åœ¨æˆ‘çœŸçš„éœ€è¦ç»§ç»­è¿™ä¸ªå¸–å­äº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘çŸ¥é“Istioæ˜¯ä»€ä¹ˆï¼Œç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆï¼Œä½†å®ƒå®é™…ä¸Šè§£å†³äº†ä»€ä¹ˆæŒ‘æˆ˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»&lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/overview.html&#34;&gt;ä¸ºä»€ä¹ˆä½¿ç”¨Istioé¡µé¢&lt;/a&gt;ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒåœ¨æœåŠ¡ç½‘ç»œä¸­ç»Ÿä¸€æä¾›äº†è®¸å¤šå…³é”®åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§&lt;/li&gt;
&lt;li&gt;å¼ºåˆ¶ç­–ç•¥&lt;/li&gt;
&lt;li&gt;æœåŠ¡èº«ä»½æ ‡è¯†å’Œå®‰å…¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºæˆ‘æ¥è¯´ï¼Œè¦çœŸæ­£ç†è§£Istioçš„ä»·å€¼ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº†&lt;a href=&#34;https://codelabs.developers.google.com/codelabs/cloud-hello-istio/#0&#34;&gt;codelab&lt;/a&gt;ã€‚ç¼–å†™code labçš„äººçœŸæ˜¯å¤ªæ£’äº†ï¼&lt;/p&gt;
&lt;p&gt;Code labå‘æˆ‘ä»‹ç»äº†Istioæ§åˆ¶å¹³é¢çš„å››ä¸ªä¸»è¦ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Pilot&lt;/strong&gt;ï¼šå¤„ç†ä»£ç†sidecarçš„é…ç½®å’Œç¼–ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mixer&lt;/strong&gt;ï¼šä¸ºæ‚¨çš„æµé‡å¤„ç†å†³ç­–å¹¶æ”¶é›†é¥æµ‹æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ingress&lt;/strong&gt;ï¼šå¤„ç†æ¥è‡ªç¾¤é›†å¤–éƒ¨çš„ä¼ å…¥è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CA&lt;/strong&gt;ï¼šè¯ä¹¦é¢å‘æœºæ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥çœ‹&lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/#architecture&#34;&gt;Istioæ¶æ„æ¦‚å¿µ&lt;/a&gt;é¡µé¢äº†è§£è¿™äº›ç»„ä»¶å¦‚ä½•ååŒå·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;p&gt;Code labæä¾›äº†&lt;a href=&#34;https://istio.io/docs/concepts/traffic-management/rules-configuration.html#route-rules&#34;&gt;è·¯ç”±è§„åˆ™&lt;/a&gt;â€”â€”æµé‡ç®¡ç†éƒ¨åˆ†&lt;/p&gt;
&lt;p&gt;æˆ‘è¿˜å°è¯•äº†&lt;a href=&#34;https://istio.io/docs/tasks/&#34;&gt;Istio.io&lt;/a&gt;ä¸­çš„ä¸€äº›taskï¼Œå› ä¸ºæˆ‘éœ€è¦äº†è§£å®ƒå¦‚ä½•å¤„ç†é‚£äº›é¢†åŸŸçš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æç¤ºï¼šå¦‚æœæ‚¨åœ¨å®Œæˆcodelabæ—¶ä¹Ÿå†³å®šåœ¨å››å¤„çœ‹çœ‹ï¼Œé‚£ä¹ˆè¯·å°†æ‚¨çš„ç¾¤é›†ä¸åº”ç”¨ç¨‹åºä¸€èµ·å¯åŠ¨å¹¶è¿è¡Œã€‚æ— è®ºå¦‚ä½•ï¼Œä½ ä¼šå†æ¬¡ä½¿ç”¨å®ƒã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘å¯¹å®ƒå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä½¿ç”¨åƒGKEè¿™æ ·çš„æ‰˜ç®¡K8sï¼ˆå¥½å§ï¼Œä½ çŸ¥é“æˆ‘ä¼šé€‰é‚£ä¸ªä¸æ˜¯å—ï¼Ÿï¼‰ä½¿ç”¨Istioæ˜¯å¦åˆé€‚ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ˜¯çš„ï¼Œè¿™é‡Œæœ‰æ›´å¤šçš„ç»†èŠ‚ï¼Œä½†æˆ‘ä¸»è¦æƒ³å¼„æ˜ç™½ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨Istioã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é›†ç¾¤æœ€ç»ˆç”¨æˆ·/å¼€å‘äººå‘˜è®¿é—®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;GKEç»“åˆä½¿ç”¨&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/iam-integration&#34;&gt;IAM&lt;/a&gt;å’ŒRBACï¼Œæ˜¯çš„ï¼Œè¿™é‡Œé¢æœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦ä½ äº†è§£ã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¸ºæ‚¨çš„é›†ç¾¤ç”¨æˆ·æˆäºˆæ¯”Cloud IAMæ›´ç»†ç²’åº¦çš„æƒé™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨namespaceå’ŒRBACæ¥é™åˆ¶å¯¹ç‰¹å®špodçš„è®¿é—®æˆ–æ’é™¤å¯¹secretçš„è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/docs/concepts/security/rbac.html&#34;&gt;Istio RBAC&lt;/a&gt;ä»‹ç»äº†ä¸¤ä¸ªä¾§é‡äºæœåŠ¡çš„è§’è‰²&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ServiceRole&lt;/strong&gt;å®šä¹‰ç”¨äºè®¿é—®ç½‘æ ¼ä¸­çš„æœåŠ¡çš„è§’è‰²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ServiceRoleBinding&lt;/strong&gt;å°†è§’è‰²æˆäºˆä¸»é¢˜ï¼ˆä¾‹å¦‚ç”¨æˆ·ã€ç»„ã€æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒä»¬æ˜¯k8sä¸­çš„CustomResourceDefinitionï¼ˆCRDï¼‰å¯¹è±¡ã€‚ä½†æ‚¨ä»ç„¶éœ€è¦äº†è§£IAMã€‚&lt;/p&gt;
&lt;h4 id=&#34;æœåŠ¡èº«ä»½æ ‡è¯†&#34;&gt;æœåŠ¡èº«ä»½æ ‡è¯†&lt;/h4&gt;
&lt;p&gt;GKEå¯ä»¥ä½¿ç”¨service accountæ¥ç®¡ç†&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/tutorials/authenticating-to-cloud-platform&#34;&gt;GKEä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åº&lt;/a&gt;å¯ä»¥ä½¿ç”¨å“ªäº›GCPæœåŠ¡ã€‚è¿™äº›service accoutçš„å¯†é’¥ä½¿ç”¨secretå­˜å‚¨ã€‚Podä¸­è¿è¡Œçš„è¿›ç¨‹çš„èº«ä»½æ ‡è¯†æ˜¯ç”±&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/&#34;&gt;k8s service account&lt;/a&gt;ä¸RBACä¸€èµ·å†³å®šçš„ã€‚Istioä½¿ç”¨&lt;a href=&#34;https://istio.io/docs/concepts/security/mutual-tls.html&#34;&gt;istio-auth&lt;/a&gt;ï¼Œå®ƒä½¿ç”¨åŒå‘TLSæä¾›å¼ºå¤§çš„æœåŠ¡é—´å’Œæœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯ï¼Œå†…ç½®èº«ä»½å’Œå‡­è¯ç®¡ç†ã€‚Istio-authä½¿ç”¨Kubernetes service accountã€‚&lt;/p&gt;
&lt;p&gt;Istioä¸æä¾›ä»»ä½•ä½¿ç”¨GCP service accountå¸®åŠ©ã€‚è¿™è¿˜å¾ˆæ—©ï¼Œä½†æ˜¯å®ƒæ­£åœ¨åˆ¶å®šæœªæ¥å‘å±•è®¡åˆ’çš„è·¯çº¿å›¾ã€‚&lt;/p&gt;
&lt;p&gt;Istio-authå¾ˆå¥½ï¼Œè®¡åˆ’ä¸­çš„å¢å¼ºåŠŸèƒ½å°†å€¼å¾—ç­‰å¾…ã€‚æˆ‘å¯¹å®‰å…¨çš„å¤æ‚æ€§æ„Ÿåˆ°åŒçƒ¦ï¼Œå› ä¸ºè¿™ä¸å¯é¿å…åœ°å¯¼è‡´é…ç½®é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›å®ƒä¸service accountç±»å‹ä¹‹é—´è¿›è¡Œæ›´åŠ æ— ç¼çš„å¯¹é½ï¼&lt;/p&gt;
&lt;h4 id=&#34;ç½‘ç»œæ§åˆ¶&#34;&gt;ç½‘ç»œæ§åˆ¶&lt;/h4&gt;
&lt;p&gt;GKEï¼ˆç”¨äºk8sç‰ˆæœ¬1.7.6 +ï¼‰ä½¿ç”¨&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy&#34;&gt;k8sç½‘ç»œç­–ç•¥&lt;/a&gt;æ¥ç®¡ç†å“ªäº›Podå¯ä»¥å’ŒæœåŠ¡é€šä¿¡ã€‚è¿™æ˜¯ç›¸å¯¹ç®€å•çš„é…ç½®ã€‚ Istioä¹Ÿæœ‰ç½‘ç»œç­–ç•¥ï¼Œä½†ä»–ä»¬ä¸æ˜¯ä½ çŸ¥é“å’Œå–œæ¬¢çš„K8sç­–ç•¥ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„åŒºåˆ«å‘¢ï¼Ÿ &lt;a href=&#34;https://istio.io/blog/2017/0.1-using-network-policy.html&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;å¾ˆå¥½åœ°è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™é‡Œé‡è¿°ï¼Œä½†æ˜¯è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†ä¸åŒä¹‹å¤„ä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„ä¸åŒã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é¡¹ç›®&lt;/th&gt;
&lt;th&gt;Istioç­–ç•¥&lt;/th&gt;
&lt;th&gt;ç½‘ç»œç­–ç•¥&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å±‚&lt;/td&gt;
&lt;td&gt;Serviceï¼ˆ7å±‚ï¼‰&lt;/td&gt;
&lt;td&gt;Networkï¼ˆ3ã€4å±‚ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®ç°&lt;/td&gt;
&lt;td&gt;Userspace&lt;/td&gt;
&lt;td&gt;Kernel&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ§åˆ¶ç‚¹&lt;/td&gt;
&lt;td&gt;Pod&lt;/td&gt;
&lt;td&gt;Node&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Istioä½¿ç”¨envoyä½œä¸ºsidecarä»£ç†ã€‚Envoyåœ¨OSIæ¨¡å‹çš„åº”ç”¨å±‚è¿è¡Œï¼Œæ‰€ä»¥åœ¨ç¬¬7å±‚ã€‚æˆ‘çš„è¿™ç¯‡åšå®¢å°†ä¸ºä½ è¯¦ç»†è§£é‡Šã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨éœ€è¦ä¸¤ç§ç­–ç•¥ç±»å‹ï¼Œè¿™æ˜¯çºµæ·±é˜²å¾¡çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¤šä¸ªé›†ç¾¤&#34;&gt;å¤šä¸ªé›†ç¾¤&lt;/h4&gt;
&lt;p&gt;Istioæœ‰ä¸ªéå¸¸é…·çš„åŠŸèƒ½æ˜¯&lt;a href=&#34;https://istio.io/docs/concepts/policy-and-control/mixer.html#adapters&#34;&gt;mixeré€‚é…å™¨&lt;/a&gt;ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå¯ä»¥ä»åº•å±‚åç«¯è¿›è¡ŒæŠ½è±¡ä»¥æä¾›æ ¸å¿ƒåŠŸèƒ½ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€ç›‘æ§ã€é…é¢ã€ACLæ£€æŸ¥ç­‰ã€‚å®ƒå…¬å¼€äº†ä¸€ä¸ªä¸€è‡´çš„APIï¼Œä¸ä½¿ç”¨çš„åç«¯æ— å…³ã€‚å°±åƒGCSå…¬å¼€äº†ä¸€ä¸ªAPIï¼Œæ— è®ºæ‚¨ä½¿ç”¨ä»€ä¹ˆå­˜å‚¨ç±»åˆ«ï¼&lt;/p&gt;
&lt;p&gt;æˆ‘è®¤ä¸º&lt;a href=&#34;https://istio.io/blog/2017/adapter-model.html&#34;&gt;mixeré€‚é…å™¨æ¨¡å‹&lt;/a&gt;åšå®¢æ–‡ç« ä¸­çš„è¿™å¼ å›¾ç‰‡è§£é‡Šäº†mixeré€‚é…å™¨ä¸­çš„å…¨éƒ¨è¦ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://istio.io/docs/concepts/policy-and-control/img/mixer-config/machine.svg&#34; alt=&#34;mixeré€‚é…å™¨æ¨¡å‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ‰ä¸€ä¸ª&lt;a href=&#34;https://istio.io/docs/guides/integrating-vms.html&#34;&gt;æ—©æœŸdemo&lt;/a&gt;ï¼Œæˆ‘è®¤ä¸ºå®ƒæ˜¯istioæœ€æœ‰ç”¨çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒå®é™…ä¸Šä½¿ç”¨è™šæ‹Ÿæœºæ¥æ‰¿è½½codelabä¸­ä½¿ç”¨çš„è¯„åˆ†dbase MySQLæ•°æ®åº“ï¼Œå¹¶å°†å…¶ä½œä¸ºGKEé›†ç¾¤æ‰€å±ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ä¸€ä¸ªç½‘æ ¼æ¥ç®¡ç†å®ƒä»¬ï¼&lt;/p&gt;
&lt;h4 id=&#34;æµé‡ç®¡ç†&#34;&gt;æµé‡ç®¡ç†&lt;/h4&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨äº†codelabï¼Œä½ ä¼šçœ‹åˆ°ä½¿ç”¨istioæ¥å¼•å¯¼ä½¿ç”¨è·¯ç”±è§„åˆ™çš„æµé‡æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚ä½¿ç”¨K8sï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨é‡‘ä¸é›€éƒ¨ç½²è¿›è¡Œæµé‡ç®¡ç†ï¼Œå¹¶ä»¥ç±»ä¼¼äºistioçš„æ–¹å¼å°†ä¸€å®šæ¯”ä¾‹çš„æµé‡å¼•å¯¼è‡³æ‚¨çš„åº”ç”¨çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä½†Istioåœ¨è¿™ç§æƒ…å†µä¸‹æ›´çµæ´»ï¼Œæ–¹æ³•æ˜¯å…è®¸æ‚¨è®¾ç½®ç»†ç²’åº¦æµé‡ç™¾åˆ†æ¯”å¹¶æ§åˆ¶æµé‡ä½¿ç”¨code labä¸­çš„å…¶ä»–æ ‡å‡†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æœåŠ¡å‘ç°&#34;&gt;æœåŠ¡å‘ç°&lt;/h4&gt;
&lt;p&gt;æœåŠ¡æ³¨å†Œåœ¨k8sä¸­å®Œæˆã€‚IstioæŠ½è±¡å‡ºåº•å±‚çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºenvoy sidecarå¯æ¶ˆè´¹çš„æ ‡å‡†æ ¼å¼ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å®¡è®¡è®°å½•å’Œç›‘æ§&#34;&gt;å®¡è®¡è®°å½•å’Œç›‘æ§&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ˜¯è¶…å‡ºGKEæä¾›çš„æ ‡å‡†æ—¥å¿—è®°å½•çš„è¯ï¼Œå¯ä»¥å°†GKEä¸&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/logging&#34;&gt;StackDriveræ—¥å¿—è®°å½•&lt;/a&gt;é›†æˆæ¥æ”¶é›†ï¼Œåœ¨æŒä¹…åŒ–å­˜å‚¨ä¸­å­˜å‚¨&lt;code&gt;å®¹å™¨æ—¥å¿—&lt;/code&gt;ã€&lt;code&gt;ç³»ç»Ÿæ—¥å¿—&lt;/code&gt;å’Œå…³äºç¾¤é›†ä¸­çš„æ´»åŠ¨çš„&lt;code&gt;äº‹ä»¶&lt;/code&gt;ï¼Œä¾‹å¦‚Podçš„è°ƒåº¦ã€‚è¿˜å¯ä»¥ä¸&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/monitoring&#34;&gt;StackDriver Monitoring&lt;/a&gt;é›†æˆä»¥æ”¶é›†ç³»ç»Ÿåº¦é‡æŒ‡æ ‡ï¼ˆåº¦é‡ç¾¤é›†çš„åŸºç¡€è®¾æ–½ï¼Œä¾‹å¦‚CPUæˆ–å†…å­˜ä½¿ç”¨æƒ…å†µï¼‰å’Œè‡ªå®šä¹‰æŒ‡æ ‡ï¼ˆç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Istioåˆ©ç”¨prometheusä¸grafanaä¸€èµ·ä½œä¸ºä»ªè¡¨æ¿è¿›è¡Œè®°å½•å’Œç›‘æ§ã€‚æˆ‘å–œæ¬¢&lt;a href=&#34;https://istio.io/docs/tasks/telemetry/servicegraph.html&#34;&gt;service graphé…ç½®&lt;/a&gt;ï¼Œå®ƒå¯ä»¥ä¸ºæ‚¨æä¾›service meshçš„å›¾å½¢è¡¨ç¤ºã€‚ä½ ä¹Ÿå¯ä»¥ç”¨kibanaå’Œfluentdæ¥é…åˆElasticsearchä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é‚£ä¹ˆæˆ‘éœ€è¦istioå—&#34;&gt;é‚£ä¹ˆæˆ‘éœ€è¦Istioå—ï¼Ÿ&lt;/h4&gt;
&lt;p&gt;Istioçš„æµé‡ç®¡ç†éå¸¸æ£’ï¼Œmixeré€‚é…å™¨æ¨¡å‹å¯ä»¥è½»æ¾ç®¡ç†è¦†ç›–å¤šä¸ªç¾¤é›†å’Œè™šæ‹Ÿæœºçš„ç½‘æ ¼ã€‚æˆ‘å–œæ¬¢Istioæ˜¯å› ä¸ºå®ƒå¯ä»¥è®©ä½ è¿›ä¸­ç²¾åŠ›æ€è€ƒæœåŠ¡ï¼Œè€Œä¸æ˜¯é‚£ä¹ˆå¤šçš„podå’ŒèŠ‚ç‚¹ï¼Œå¹¶ä¸æ˜¯è¯´ä½ ä¸å¿…æ‹…å¿ƒè¿™äº›ï¼Œè€Œæ˜¯åªå…³æ³¨æœåŠ¡å°±å¥½äº†ï¼&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ éœ€è¦ç®¡ç†ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œé‚£ä¹ˆIstioåº”è¯¥åœ¨ä½ çš„é€‰æ‹©åˆ—è¡¨é‡Œã€‚å¦‚æœæ‚¨éœ€è¦åœ¨æµé‡ç®¡ç†æ–¹é¢æœ‰æ¯”k8sæä¾›çš„æ›´å¤šçš„çµæ´»æ€§çš„åŒ–é‚£ä¹ˆIstioä¹Ÿå¾ˆå€¼å¾—å…³æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æœ‰è¶³å¤Ÿçš„èµ„æºæ¥å¤„ç†å¤„äºå‘å±•æ—©æœŸçš„äº‹ç‰©ï¼Œé‚£ä¹ˆå°½æ—©ç†è§£Istioæ˜¯å€¼å¾—çš„ã€‚å¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨k8sçš„è¯é‚£ä¹ˆistioçš„å­¦ä¹ æ›²çº¿å°†å¾ˆä½ã€‚&lt;/p&gt;
&lt;p&gt;è®°ä½å®ƒæ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ä¸Šå±‚çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä½ ä»ç„¶éœ€è¦åœ¨k8så±‚åšäº›äº‹æƒ…ï¼Œæ¯”å¦‚é…ç½®k8sç½‘ç»œç­–ç•¥æ¥è¡¥å……istioç½‘ç»œç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;Istioè¿˜å¤„äºå‘å±•çš„æ—©æœŸé˜¶æ®µï¼Œæ‰€ä»¥å®ƒä¸ä¼šåšä½ æœŸæœ›çš„æ‰€æœ‰äº‹æƒ…ï¼Œä½†æˆ‘ä»¬å¸Œæœ›å®ƒä¼šã€‚ä½ å°†æ— æ³•é¿å…çš„åœ¨æä¾›å•†APIå’ŒIstioä¹‹é—´æ¥å›è°ƒç”¨æ‰èƒ½å®Œæˆä¸€ä¸ªå®Œæ•´çš„å·¥ä½œï¼Œæ‰€ä»¥å®ƒä¸æ˜¯ä½ å¸Œæœ›çš„é‚£ç§ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;Dashboardæ˜¯å¯è§†åŒ–ç½‘æ ¼é…ç½®çš„ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œå› ä¸ºç¼–å†™YAMLä¼šè®©äººå¾ˆå¿«ç–²æƒ«ï¼æ˜¯çš„ï¼Œæ‚¨å¯ä»¥è®¾ç½®ä»ªè¡¨æ¿ä¸Šçš„æ§åˆ¶é¢æ¿æ¥å¯è§†åŒ–åº¦é‡æŒ‡æ ‡ï¼Œä½†æˆ‘å¸Œæœ›çœ‹åˆ°å®ƒä¸StackDriveré›†æˆã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨æ€»ä½“äº†è§£Istioä¹‹åï¼Œæˆ‘å®é™…ä¸Šå¾ˆå–œæ¬¢å®ƒæ‰€æ‰¿è¯ºçš„å†…å®¹ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: ä»€ä¹ˆæ˜¯Service Meshï¼ˆæœåŠ¡ç½‘æ ¼ï¼‰ï¼Ÿ</title>
      <link>https://jimmysong.io/blog/what-is-a-service-mesh/</link>
      <pubDate>Wed, 20 Sep 2017 21:56:04 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/what-is-a-service-mesh/</guid>
      <description>
        
        
        &lt;p&gt;Service Mesh åˆè¯‘ä½œ â€œæœåŠ¡ç½‘æ ¼â€ï¼Œä½œä¸ºæœåŠ¡é—´é€šä¿¡çš„åŸºç¡€è®¾æ–½å±‚ã€‚Buoyant å…¬å¸çš„ CEO Willian Morgan åœ¨ä»–çš„è¿™ç¯‡æ–‡ç«  &lt;a href=&#34;https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/&#34;&gt;WHATâ€™S A Service Mesh? AND WHY DO I NEED ONE?&lt;/a&gt; ä¸­è§£é‡Šäº†ä»€ä¹ˆæ˜¯ Service Meshï¼Œä¸ºä»€ä¹ˆäº‘åŸç”Ÿåº”ç”¨éœ€è¦ Service Meshã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ &lt;a href=&#34;https://twitter.com/wm&#34;&gt;Willian Morgan&lt;/a&gt; å¯¹ Service Mesh çš„è§£é‡Šã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A Service Mesh is a dedicated infrastructure layer for handling service-to-service communication. Itâ€™s responsible for the reliable delivery of requests through the complex topology of services that comprise a modern, cloud native application. In practice, the Service Mesh is typically implemented as an array of lightweight network proxies that are deployed alongside application code, without the application needing to be aware.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¿»è¯‘æˆä¸­æ–‡æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰æ˜¯è‡´åŠ›äºè§£å†³æœåŠ¡é—´é€šè®¯çš„åŸºç¡€è®¾æ–½å±‚ã€‚å®ƒè´Ÿè´£åœ¨ç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å¤æ‚æœåŠ¡æ‹“æ‰‘æ¥å¯é åœ°ä¼ é€’è¯·æ±‚ã€‚å®é™…ä¸Šï¼ŒService Mesh é€šå¸¸æ˜¯é€šè¿‡ä¸€ç»„è½»é‡çº§ç½‘ç»œä»£ç†ï¼ˆSidecar proxyï¼‰ï¼Œä¸åº”ç”¨ç¨‹åºä»£ç éƒ¨ç½²åœ¨ä¸€èµ·æ¥å®ç°ï¼Œè€Œæ— éœ€æ„ŸçŸ¥åº”ç”¨ç¨‹åºæœ¬èº«ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;service-meshçš„ç‰¹ç‚¹&#34;&gt;Service Meshçš„ç‰¹ç‚¹&lt;/h2&gt;
&lt;p&gt;Service Mesh æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºé—´é€šè®¯çš„ä¸­é—´å±‚&lt;/li&gt;
&lt;li&gt;è½»é‡çº§ç½‘ç»œä»£ç†&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥&lt;/li&gt;
&lt;li&gt;è§£è€¦åº”ç”¨ç¨‹åºçš„é‡è¯•/è¶…æ—¶ã€ç›‘æ§ã€è¿½è¸ªå’ŒæœåŠ¡å‘ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰ä¸¤æ¬¾æµè¡Œçš„ Service Mesh å¼€æºè½¯ä»¶ &lt;a href=&#34;https://istio.io&#34;&gt;Istio&lt;/a&gt; å’Œ &lt;a href=&#34;https://linkerd.io&#34;&gt;Linkerd&lt;/a&gt; éƒ½å¯ä»¥ç›´æ¥åœ¨ kubernetes ä¸­é›†æˆï¼Œå…¶ä¸­ Linkerd å·²ç»æˆä¸º CNCF æˆå‘˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-service-mesh&#34;&gt;ç†è§£ Service Mesh&lt;/h2&gt;
&lt;p&gt;å¦‚æœç”¨ä¸€å¥è¯æ¥è§£é‡Šä»€ä¹ˆæ˜¯ Service Meshï¼Œå¯ä»¥å°†å®ƒæ¯”ä½œæ˜¯åº”ç”¨ç¨‹åºæˆ–è€…è¯´å¾®æœåŠ¡é—´çš„ TCP/IPï¼Œè´Ÿè´£æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè°ƒç”¨ã€é™æµã€ç†”æ–­å’Œç›‘æ§ã€‚å¯¹äºç¼–å†™åº”ç”¨ç¨‹åºæ¥è¯´ä¸€èˆ¬æ— é¡»å…³å¿ƒ TCP/IP è¿™ä¸€å±‚ï¼ˆæ¯”å¦‚é€šè¿‡ HTTP åè®®çš„ RESTful åº”ç”¨ï¼‰ï¼ŒåŒæ ·ä½¿ç”¨ Service Mesh ä¹Ÿå°±æ— é¡»å…³å¿ƒæœåŠ¡ä¹‹é—´çš„é‚£äº›åŸæ¥æ˜¯é€šè¿‡åº”ç”¨ç¨‹åºæˆ–è€…å…¶ä»–æ¡†æ¶å®ç°çš„äº‹æƒ…ï¼Œæ¯”å¦‚ Spring Cloudã€OSSï¼Œç°åœ¨åªè¦äº¤ç»™ Service Mesh å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://philcalcado.com/&#34;&gt;Phil CalÃ§ado&lt;/a&gt; åœ¨ä»–çš„è¿™ç¯‡åšå®¢ &lt;a href=&#34;http://philcalcado.com/2017/08/03/pattern_service_mesh.html&#34;&gt;Pattern: Service Mesh&lt;/a&gt; ä¸­è¯¦ç»†è§£é‡Šäº† Service Mesh çš„æ¥é¾™å»è„‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»æœ€åŸå§‹çš„ä¸»æœºä¹‹é—´ç›´æ¥ä½¿ç”¨ç½‘çº¿ç›¸è¿&lt;/li&gt;
&lt;li&gt;ç½‘ç»œå±‚çš„å‡ºç°&lt;/li&gt;
&lt;li&gt;é›†æˆåˆ°åº”ç”¨ç¨‹åºå†…éƒ¨çš„æ§åˆ¶æµ&lt;/li&gt;
&lt;li&gt;åˆ†è§£åˆ°åº”ç”¨ç¨‹åºå¤–éƒ¨çš„æ§åˆ¶æµ&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºçš„ä¸­é›†æˆæœåŠ¡å‘ç°å’Œæ–­è·¯å™¨&lt;/li&gt;
&lt;li&gt;å‡ºç°äº†ä¸“é—¨ç”¨äºæœåŠ¡å‘ç°å’Œæ–­è·¯å™¨çš„è½¯ä»¶åŒ…/åº“ï¼Œå¦‚ &lt;a href=&#34;https://finagle.github.io/&#34;&gt;Twitter çš„ Finagle&lt;/a&gt; å’Œ &lt;a href=&#34;https://code.facebook.com/posts/1503205539947302&#34;&gt;Facebook  çš„ Proxygen&lt;/a&gt;ï¼Œè¿™æ—¶å€™è¿˜æ˜¯é›†æˆåœ¨åº”ç”¨ç¨‹åºå†…éƒ¨&lt;/li&gt;
&lt;li&gt;å‡ºç°äº†ä¸“é—¨ç”¨äºæœåŠ¡å‘ç°å’Œæ–­è·¯å™¨çš„å¼€æºè½¯ä»¶ï¼Œå¦‚ &lt;a href=&#34;http://netflix.github.io/&#34;&gt;Netflix OSS&lt;/a&gt;ã€Airbnb çš„ &lt;a href=&#34;https://github.com/airbnb/synapse&#34;&gt;synapse&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/airbnb/nerve&#34;&gt;nerve&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æœ€åä½œä¸ºå¾®æœåŠ¡çš„ä¸­é—´å±‚ Service Mesh å‡ºç°&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Service Mesh çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;service-mesh-arch.png&#34; alt=&#34;Service Mesh æ¶æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥è‡ªï¼š&lt;a href=&#34;http://philcalcado.com/2017/08/03/pattern_service_mesh.html&#34;&gt;Pattern: Service Mesh&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Service Mesh ä½œä¸º sidecar è¿è¡Œï¼Œå¯¹åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯é€æ˜ï¼Œæ‰€æœ‰åº”ç”¨ç¨‹åºé—´çš„æµé‡éƒ½ä¼šé€šè¿‡å®ƒï¼Œæ‰€ä»¥å¯¹åº”ç”¨ç¨‹åºæµé‡çš„æ§åˆ¶éƒ½å¯ä»¥åœ¨ serivce mesh ä¸­å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-meshå¦‚ä½•å·¥ä½œ&#34;&gt;Service Meshå¦‚ä½•å·¥ä½œï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢ä»¥ Linkerd ä¸ºä¾‹è®²è§£ Service Mesh å¦‚ä½•å·¥ä½œï¼ŒIstio ä½œä¸º Service Mesh çš„å¦ä¸€ç§å®ç°åŸç†ä¸ linkerd åŸºæœ¬ç±»ä¼¼ï¼Œåç»­æ–‡ç« å°†ä¼šè¯¦è§£ Istio å’Œ Linkerd å¦‚ä½•åœ¨ kubernetes ä¸­å·¥ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Linkerd å°†æœåŠ¡è¯·æ±‚è·¯ç”±åˆ°ç›®çš„åœ°å€ï¼Œæ ¹æ®ä¸­çš„å‚æ•°åˆ¤æ–­æ˜¯åˆ°ç”Ÿäº§ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒè¿˜æ˜¯ staging ç¯å¢ƒä¸­çš„æœåŠ¡ï¼ˆæœåŠ¡å¯èƒ½åŒæ—¶éƒ¨ç½²åœ¨è¿™ä¸‰ä¸ªç¯å¢ƒä¸­ï¼‰ï¼Œæ˜¯è·¯ç”±åˆ°æœ¬åœ°ç¯å¢ƒè¿˜æ˜¯å…¬æœ‰äº‘ç¯å¢ƒï¼Ÿæ‰€æœ‰çš„è¿™äº›è·¯ç”±ä¿¡æ¯å¯ä»¥åŠ¨æ€é…ç½®ï¼Œå¯ä»¥æ˜¯å…¨å±€é…ç½®ä¹Ÿå¯ä»¥ä¸ºæŸäº›æœåŠ¡å•ç‹¬é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å½“ Linkerd ç¡®è®¤äº†ç›®çš„åœ°å€åï¼Œå°†æµé‡å‘é€åˆ°ç›¸åº”æœåŠ¡å‘ç°ç«¯ç‚¹ï¼Œåœ¨ kubernetes ä¸­æ˜¯ serviceï¼Œç„¶å service ä¼šå°†æœåŠ¡è½¬å‘ç»™åç«¯çš„å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;Linkerd æ ¹æ®å®ƒè§‚æµ‹åˆ°æœ€è¿‘è¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´ï¼Œé€‰æ‹©å‡ºæ‰€æœ‰åº”ç”¨ç¨‹åºçš„å®ä¾‹ä¸­å“åº”æœ€å¿«çš„å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;Linkerd å°†è¯·æ±‚å‘é€ç»™è¯¥å®ä¾‹ï¼ŒåŒæ—¶è®°å½•å“åº”ç±»å‹å’Œå»¶è¿Ÿæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¯¥å®ä¾‹æŒ‚äº†ã€ä¸å“åº”äº†æˆ–è€…è¿›ç¨‹ä¸å·¥ä½œäº†ï¼ŒLinkerd å°†æŠŠè¯·æ±‚å‘é€åˆ°å…¶ä»–å®ä¾‹ä¸Šé‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¯¥å®ä¾‹æŒç»­è¿”å› errorï¼ŒLinkerd ä¼šå°†è¯¥å®ä¾‹ä»è´Ÿè½½å‡è¡¡æ± ä¸­ç§»é™¤ï¼Œç¨åå†å‘¨æœŸæ€§å¾—é‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¯·æ±‚çš„æˆªæ­¢æ—¶é—´å·²è¿‡ï¼ŒLinkerd ä¸»åŠ¨å¤±è´¥è¯¥è¯·æ±‚ï¼Œè€Œä¸æ˜¯å†æ¬¡å°è¯•æ·»åŠ è´Ÿè½½ã€‚&lt;/li&gt;
&lt;li&gt;Linkerd ä»¥ metric å’Œåˆ†å¸ƒå¼è¿½è¸ªçš„å½¢å¼æ•è·ä¸Šè¿°è¡Œä¸ºçš„å„ä¸ªæ–¹é¢ï¼Œè¿™äº›è¿½è¸ªä¿¡æ¯å°†å‘é€åˆ°é›†ä¸­ metric ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸ºä½•ä½¿ç”¨-service-mesh&#34;&gt;ä¸ºä½•ä½¿ç”¨ Service Meshï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Service Mesh å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¸¦æ¥æ–°åŠŸèƒ½ï¼Œå®ƒæ˜¯ç”¨äºè§£å†³å…¶ä»–å·¥å…·å·²ç»è§£å†³è¿‡çš„é—®é¢˜ï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯åœ¨ Cloud Native çš„ kubernetes ç¯å¢ƒä¸‹çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¼ ç»Ÿçš„ MVC ä¸‰å±‚ Web åº”ç”¨ç¨‹åºæ¶æ„ä¸‹ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šè®¯å¹¶ä¸å¤æ‚ï¼Œåœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è‡ªå·±ç®¡ç†å³å¯ï¼Œä½†æ˜¯åœ¨ç°ä»Šçš„å¤æ‚çš„å¤§å‹ç½‘ç«™æƒ…å†µä¸‹ï¼Œå•ä½“åº”ç”¨è¢«åˆ†è§£ä¸ºä¼—å¤šçš„å¾®æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¾èµ–å’Œé€šè®¯ååˆ†å¤æ‚ï¼Œå‡ºç°äº† twitter å¼€å‘çš„ &lt;a href=&#34;https://twitter.github.io/finagle/&#34;&gt;Finagle&lt;/a&gt;ã€Netflix å¼€å‘çš„ &lt;a href=&#34;https://github.com/Netflix/Hystrix&#34;&gt;Hystrix&lt;/a&gt; å’Œ Google çš„ Stubby è¿™æ ·çš„ â€œèƒ–å®¢æˆ·ç«¯â€ åº“ï¼Œè¿™äº›å°±æ˜¯æ—©æœŸçš„ Service Meshï¼Œä½†æ˜¯å®ƒä»¬éƒ½è¿‘é€‚ç”¨äºç‰¹å®šçš„ç¯å¢ƒå’Œç‰¹å®šçš„å¼€å‘è¯­è¨€ï¼Œå¹¶ä¸èƒ½ä½œä¸ºå¹³å°çº§çš„ Service Mesh æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Cloud Native æ¶æ„ä¸‹ï¼Œå®¹å™¨çš„ä½¿ç”¨ç»™äºˆäº†å¼‚æ„åº”ç”¨ç¨‹åºçš„æ›´å¤šå¯è¡Œæ€§ï¼Œkubernetes å¢å¼ºçš„åº”ç”¨çš„æ¨ªå‘æ‰©å®¹èƒ½åŠ›ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿçš„ç¼–æ’å‡ºå¤æ‚ç¯å¢ƒã€å¤æ‚ä¾èµ–å…³ç³»çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å¼€å‘è€…åˆæ— é¡»è¿‡åˆ†å…³å¿ƒåº”ç”¨ç¨‹åºçš„ç›‘æ§ã€æ‰©å±•æ€§ã€æœåŠ¡å‘ç°å’Œåˆ†å¸ƒå¼è¿½è¸ªè¿™äº›ç¹ççš„äº‹æƒ…è€Œä¸“æ³¨äºç¨‹åºå¼€å‘ï¼Œèµ‹äºˆå¼€å‘è€…æ›´å¤šçš„åˆ›é€ æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/&#34;&gt;What&amp;rsquo;s a Service Mesh? And why do I need one?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://redmonk.com/jgovernor/2017/05/31/so-what-even-is-a-service-mesh-hot-take-on-istio-and-linkerd&#34;&gt;So what even is a Service Mesh? Hot take on Istio and Linkerd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/attest-engineering/linkerd-a-service-mesh-for-aws-ecs-937f201f847a&#34;&gt;linkerd: A Service Mesh for AWS ECS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/blog/istio-service-mesh-for-microservices.html&#34;&gt;Introducing Istio: A robust Service Mesh for microservices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/application-network-functions-with-esbs-api-management-and-now-service-mesh/&#34;&gt;Application Network Functions With ESBs, API Management, and Now.. Service Mesh?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://philcalcado.com/2017/08/03/pattern_service_mesh.html&#34;&gt;Pattern: Service Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/&#34;&gt;Envoy å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>
