<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>Cilium 的控制平面升级之路：xDS API 的引入与应用 - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="本文探讨了 Cilium 的控制平面设计，分析了其在大规模部署中的局限性，以及如何使用 xDS API 来改进其架构和性能。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.129.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/trans/scaling-cilium-to-new-heights-with-xds/" />
  <meta property="og:title" content="Cilium 的控制平面升级之路：xDS API 的引入与应用 | Jimmy Song" />
  <meta property="twitter:title" content="Cilium 的控制平面升级之路：xDS API 的引入与应用 | Jimmy Song" />

  
  <meta property="og:description" content="本文探讨了 Cilium 的控制平面设计，分析了其在大规模部署中的局限性，以及如何使用 xDS API 来改进其架构和性能。" />
  <meta property="twitter:description" content="本文探讨了 Cilium 的控制平面设计，分析了其在大规模部署中的局限性，以及如何使用 xDS API 来改进其架构和性能。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    [译] Cilium 的控制平面升级之路：xDS API 的引入与应用
                </p>
                <p class="page-description">
                    本文探讨了 Cilium 的控制平面设计，分析了其在大规模部署中的局限性，以及如何使用 xDS API 来改进其架构和性能。
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>2024/01/29</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/categories/istio"> 
                        Istio</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>20 分钟</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>4331 字</li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fas fa-language"></i>
                        </span><a href="https://www.solo.io/blog/scaling-cilium-to-new-heights-with-xds/" target="_blank" rel="noopener">原文</a>
                    </li>
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">

            
              <div class="alert alert-note-container mt-2">
    <div class="alert-note-title px-2 py-2">
      声明
    </div>
    <div class="alert-tip px-2">
        此文为个人翻译，仅供参考，不代表我个人立场。翻译过程中可能有删改或遗漏，如需了解原文，请自行查阅。如有疏漏，欢迎指正。
    </div>
  </div>
            
            
            

            
              <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>查看本文大纲</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#了解-cilium-的控制平面架构">了解 Cilium 的控制平面架构</a></li>
    <li><a href="#构建控制平面的最佳实践">构建控制平面的最佳实践</a></li>
    <li><a href="#cilium-控制平面架构的扩展考虑">Cilium 控制平面架构的扩展考虑</a></li>
    <li><a href="#减轻-kubernetes-api-服务器的压力">减轻 Kubernetes API 服务器的压力</a></li>
    <li><a href="#使用-xds-改进-cilium-的控制平面扩展安全性和效率">使用 xDS 改进 Cilium 的控制平面扩展、安全性和效率</a></li>
    <li><a href="#结论">结论</a></li>
  </ul>
</nav>
</details>

            
            <p>在这篇博客中，我们将探讨当前的 Cilium 控制平面设计，<a href="https://github.com/cilium/cilium/issues/30283" title="大规模部署可能出现的限制的位置和原因" target="_blank" rel="noopener">大规模部署可能出现的限制的位置和原因</a>，以及社区如何使用 CNCF 的 <a href="https://github.com/cncf/xds" title="通用数据平面 (xDS) API" target="_blank" rel="noopener">通用数据平面 (xDS) API</a> 推进这个架构。</p>
<h2 id="了解-cilium-的控制平面架构">了解 Cilium 的控制平面架构</h2>
<p>Cilium 遵循基于“数据平面”和“控制平面”的常见网络架构。在 Cilium 中，数据平面部署在每个主机（或 Kubernetes 节点）上，包括用于处理 L3/L4 连接和策略的 eBPF 程序。为了简化起见，对于完整性，Cilium 还在其数据平面中使用 Envoy 代理处理 L7 策略，但我们将省略这部分。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/f1_huc884a16806c306e29d90f188177ce15d_29921_704x1024_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/f1.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/f1.jpg" data-width="704" data-height="1024" alt="image" data-caption="">
          </picture>
        
      
    
  
  
</figure>
<p>Cilium 控制平面以 cilium-agent 守护程序的形式实现，部署在每个 Kubernetes 节点上。每个 cilium-agent 都是控制平面的单独、独立的实例。</p>
<p>cilium-agent 连接到 Kubernetes API 服务器，监视配置更改，然后使用它来配置数据平面。cilium-agent 还将配置写入 Kubernetes API，表示正在其各自节点上创建的端点或标识。</p>
<p>例如，当在 Kubernetes 节点上启动一个 Pod 时，cilium-agent 负责编写一个 CiliumEndpoint 自定义资源（CR），并可能是一个表示 Pod 网络标识的 CiliumIdentity CR。cilium-agent 还会更新与标识和端点映射相关的节点上的 eBPF 映射。其他 Kubernetes 节点上的 cilium-agent 也会监视这些新的 CiliumEndpoint 和 CiliumIdentity CR 的创建，并更新其本地的 eBPF 数据平面以执行策略。这种机制能够协调每个节点上的全局策略执行配置，以便所有节点看到相同的执行行为。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/f2_hu9bc46edfbf4c7931aa282f5d845e7a5b_99091_2048x1350_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/f2.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/f2.jpg" data-width="2048" data-height="1350" alt="image" data-caption="">
          </picture>
        
      
    
  
  
</figure>
<h2 id="构建控制平面的最佳实践">构建控制平面的最佳实践</h2>
<p>我们以前 <a href="https://www.solo.io/blog/building-a-control-plane-for-envoy/" title="曾多次在博客中" target="_blank" rel="noopener">曾多次在博客中</a> <a href="https://www.solo.io/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/" title="讨论过构建" target="_blank" rel="noopener">讨论过构建</a> <a href="https://www.solo.io/blog/why-the-control-plane-matters/" title="可扩展、安全、高效的控制平面的最佳实践" target="_blank" rel="noopener">可扩展、安全、高效的控制平面的最佳实践</a>。在深入研究如何扩展 Cilium 的控制平面之前，我们应该回顾一些这些最佳实践。</p>
<p>网络架构中的数据平面应该尽可能简单，性能高，以及高效完成它需要做的事情：在本例中，来回传输字节，实施策略，并执行安全性。控制平面的作用是保护数据平面免受复杂性的干扰，以及任何分散数据平面核心任务的事物。</p>
<p>另一方面，用户需要能够以最适合他们用户体验的形式指定配置和策略。很多时候，通过某种 <a href="https://www.solo.io/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/" title="特定领域的配置格式" target="_blank" rel="noopener">特定领域的配置格式</a> 来实现。然后需要将这种更高级别的用户配置与基础设施状态相结合，并将其转化为较低级别的数据平面格式。转译是一半的战斗。还需要将较低级别的配置分发到数据平面，并高效地执行。这就是控制平面出现在画面中的地方。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/f3_hu287aa85ed2f8c6a5d0c7f8770bc2f8d7_23325_768x1104_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/f3.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/f3.jpg" data-width="768" data-height="1104" alt="image" data-caption="">
          </picture>
        
      
    
  
  
</figure>
<p>控制平面允许配置解耦并与平台的其他部分集成，这些部分随后可以通知数据平面。在许多方面，这个图表与我们构建应用程序时使用的 <a href="https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/n-tier" title="三层架构" target="_blank" rel="noopener">三层架构</a> 类似：表示层，解耦的业务逻辑层和数据存储。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/f4_hu1e09b223e67c243936ca8ec32625a375_17623_718x1024_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/f4.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/f4.jpg" data-width="718" data-height="1024" alt="image" data-caption="">
          </picture>
        
      
    
  
  
</figure>
<p>在网络架构的情况下，控制平面层将处理读取/写入 Kubernetes API 和创建网络标识等敏感数据。由于它是一个单独的层，我们可以对其进行安全和硬化处理，并消除数据平面需要执行这些任务的权限。在许多情况下，虽然开始时更简单，但合并一些层会导致效率低下、安全问题和扩展/耦合问题。</p>
<h2 id="cilium-控制平面架构的扩展考虑">Cilium 控制平面架构的扩展考虑</h2>
<p>集群中的每个 cilium-agent 负责将全局集群配置更新到其本地数据平面配置。每个 cilium-agent 可能会监视多达 15 种 CRD 类型。</p>
<p>随着集群在节点、Pod、命名空间和网络策略方面的规模增长，每个 cilium-agent 需要执行的工作量也会增加。为了服务和更新所有这些状态，会对 Kubernetes apiserver 造成压力，可能导致 <a href="https://github.com/cilium/cilium/issues/29127" title="问题" target="_blank" rel="noopener">问题</a>。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/f5_hue7ed0158ce51c9b331ab31adb8afb3a0_126407_2048x1286_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/f5.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/f5.jpg" data-width="2048" data-height="1286" alt="image" data-caption="">
          </picture>
        
      
    
  
  
</figure>
<p>在大规模部署中，这种对 Kubernetes API 服务器的压力可能最终会减慢 <em>甚至导致</em> 集群中的所有操作。</p>
<p>在查看集群中的常见操作以及 cilium-agent 处理它的方式时，全局配置状态对每个节点的影响确实开始放大：工作负载和命名空间被标记、重新标记或取消标记。</p>
<p>cilium-agent 负责为调度到其节点上的 Pod 编写 CiliumEndpoint 和 CiliumIdentity 资源。由于这些资源依赖于 Pod 和命名空间标签的组合，标签的更改将导致所有依赖资源的更新。这会导致大量的写操作和相应的读取操作，因为此状态随后会传播到所有 cilium-agent，它们必须做出反应并重新配置其本地数据平面。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">cilium.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">CiliumIdentity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50568&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">sleep</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">io.cilium.k8s.policy.cluster</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">io.cilium.k8s.policy.serviceaccount</span><span class="p">:</span><span class="w"> </span><span class="l">sleep-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">io.kubernetes.pod.namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">security-labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:app</span><span class="p">:</span><span class="w"> </span><span class="l">sleep</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:io.cilium.k8s.namespace.labels.team</span><span class="p">:</span><span class="w"> </span><span class="l">loyalty</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:io.cilium.k8s.namespace.labels.version</span><span class="p">:</span><span class="w"> </span><span class="l">v10.45</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:io.cilium.k8s.policy.cluster</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:io.cilium.k8s.policy.serviceaccount</span><span class="p">:</span><span class="w"> </span><span class="l">sleep-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:io.kubernetes.pod.namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">k8s:version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span></code></pre></div><p><strong>代码清单 1：<code>CiliumIdentity</code> 资源结合了 <em>Pod</em> 和 <em>命名空间</em> 标签。对任一者的更改都会强制重新计算并生成新的 <code>CiliumIdentity</code>。</strong></p>
<p>对集群中的命名空间进行标记等操作对于 Cilium 可能非常昂贵，并且有可能导致 API 服务器操作减慢到爬行的程度（<a href="https://docs.cilium.io/en/stable/operations/performance/scalability/identity-relevant-labels/" title="请参阅用于标识目的包括/排除标签的建议" target="_blank" rel="noopener">请参阅用于标识目的包括/排除标签的建议</a>）。例如，在中等规模集群中更改命名空间的标签可能会导致足够多的 cilium-agent 导致 Kubernetes API 服务器响应延迟约 <strong>4 分钟</strong>。这将有效地使集群上的所有操作停滞不前。</p>
<p>考虑以下环境：</p>
<ul>
<li>200 个节点的 Kubernetes 集群</li>
<li>5 个命名空间</li>
<li>每个命名空间有 50 个部署</li>
<li>每个部署有 80 个副本（总共 20,000 个 Pod）</li>
</ul>
<p>在一次更新跨命名空间的标签的测试中，我们看到 CPU 利用率急剧上升，约为 150%，并且内存在整个集群的所有节点上升到约 1 GB。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/g1_hua52c85a8206eb9df0debde7d5516fdf4_45787_2048x566_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/g1.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/g1.jpg" data-width="2048" data-height="566" alt="image" data-caption="图 1：所有节点上的 CPU 和内存峰值">
          </picture>
        
      
    
  
  
  <figcaption>图 1：所有节点上的 CPU 和内存峰值</figcaption>
  
</figure>
<p>在整个集群的所有节点上同时提高 CPU 和内存是不希望看到的行为，然而更严重的是 cilium-agent 事件的读写如何影响 Kubernetes API 服务器的延迟。在下图中，我们看到延迟增长到 3 到 4 <em>分钟</em>。这肯定会导致各种类型的停机！不幸的是，由于这种控制平面架构，通过增加容量来处理扩展问题的典型方法不起作用；实际上，添加更多节点和/或更多工作负载会放大这种行为。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/g2_hucb4e599317ac8eb6b090155fc0fe3321_85993_2048x840_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/g2.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/g2.jpg" data-width="2048" data-height="840" alt="image" data-caption="图 2：Kubernetes API 服务器延迟增加到 3 - 4 分钟">
          </picture>
        
      
    
  
  
  <figcaption>图 2：Kubernetes API 服务器延迟增加到 3 - 4 分钟</figcaption>
  
</figure>
<h2 id="减轻-kubernetes-api-服务器的压力">减轻 Kubernetes API 服务器的压力</h2>
<p>对于较大的 Cilium 集群，您可以通过使用<a href="https://docs.cilium.io/en/latest/kvstore/" title="专用的键值存储" target="_blank" rel="noopener">专用的键值存储</a> 来减轻 Kubernetes API 服务器上的压力。键值存储用于存储工作负载标识、端点和 IP 到标识映射等内容。Cilium 不再将此信息存储在 Kubernetes 自定义资源（CRD）中，而是在其自己的数据库中直接监视、操作和写入对象。Cilium Helm 图表支持将 etcd 作为专用键值存储来进行安装，以满足此目的。</p>
<p>随着集群的增长，使用 kv-store 来卸载 Cilium 对象的读/写操作可能是一个好主意，而不是给 Kubernetes API 服务器施加压力。</p>
<p>注意：Cilium 还进行了其他优化，以减轻 Kubernetes API 服务器的压力，例如策略状态更新。有关更多信息，请参阅<a href="https://docs.cilium.io/en/stable/internals/cilium_operator/#policy-status-update" title="k8s-events-handover 文档" target="_blank" rel="noopener">k8s-events-handover 文档</a>。</p>
<p>如果我们在存在 kv-store 的情况下重新运行先前的测试，我们会看到对 Kubernetes API 服务器的压力减轻，尽管 CPU 可能没有减轻。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/g3_hu03ee2df6886e0aead8ba1c0e8a4bfd85_40363_2048x469_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/g3.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/g3.jpg" data-width="2048" data-height="469" alt="image" data-caption="图 3：所有节点上的 CPU 峰值，内存保持在 300-400 MB 范围内">
          </picture>
        
      
    
  
  
  <figcaption>图 3：所有节点上的 CPU 峰值，内存保持在 300-400 MB 范围内</figcaption>
  
</figure>
<p>与先前情况下的 150% CPU 消耗不同，CPU 在大约 100% 左右波动，而内存保持在大约 300 到 400 MB 的范围内。这是因为对每个 Pod 和每个标识（Cilium 在更改标签时创建所有新标识，并且必须更新引用旧标识的所有 eBPF 映射的 CiliumEndpoint 和 CiliumIdentity 对象的重新计算和生成需要 CPU 计算资源来完成，无论使用何种后备存储（CRD、kv-store 等）。</p>
<p>如果我们观察 kv-store，我们会看到在此命名空间标签事件期间，事件操作/秒和延迟会急剧上升：</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/g4_hu9a2efd15f71651839149532ec8fba102_21221_1024x247_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/g4.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/g4.jpg" data-width="1024" data-height="247" alt="image" data-caption="图 4：kv-store 上的事件操作和延迟在此命名空间标签事件期间急剧上升">
          </picture>
        
      
    
  
  
  <figcaption>图 4：kv-store 上的事件操作和延迟在此命名空间标签事件期间急剧上升</figcaption>
  
</figure>
<p>在这种特殊情况下，我们看到 kv-store 承受了相当大的负载，通过事件 IO，我们看到 kv-store 调用的延迟降低到约 15 秒左右。总之，这对于整个集群操作而言要好得多，而不是用请求使 Kubernetes API 服务器饱和。事实上，在图 5 中，我们可以看到 Kubernetes API 服务器的延迟保持在 10 到 40 毫秒的可接受范围内，而在先前的示例中，延迟升高到 4 分钟。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/g5_huff501482344fa25fe8b78a743ca16b56_55565_2048x821_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/g5.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/g5.jpg" data-width="2048" data-height="821" alt="image" data-caption="图 5：Kubernetes API Server 延迟在 10 到 40ms 之间">
          </picture>
        
      
    
  
  
  <figcaption>图 5：Kubernetes API Server 延迟在 10 到 40ms 之间</figcaption>
  
</figure>
<p>使用 kv-store 后端来存储 Cilium 对象是一种缓解 Kubernetes API 服务器压力的好方法，但它也有其缺点。现在有两个持久存储需要维护，而且随着规模的增加，运维负担也增加。在生产环境中运行数据库或持久存储（总体来说）以支持规模化并非易事。如果失去一致性，恢复过程是必需的，因为现在有两个“真相源”。许多平台完全管理 Kubernetes API 服务器及其存储，但 kv-store 并不是如此。由于绝大多数负载是读取操作，缓存将在减少运维复杂性的同时产生相同的改进。</p>
<h2 id="使用-xds-改进-cilium-的控制平面扩展安全性和效率">使用 xDS 改进 Cilium 的控制平面扩展、安全性和效率</h2>
<p>如果我们可以兼顾两全呢？既减轻 Kubernetes API 服务器的压力，又消除维护单独数据存储的昂贵生产操作的需要？甚至可能解决一些其他尚未解决的 Cilium 扩展和安全性问题？</p>
<p>在 Solo.io，我们很高兴为 Cilium 社区中更广泛的 xDS 工作作出贡献，并帮助推动该项目朝着可扩展、安全和高效的控制平面迈进。使用<a href="https://github.com/cncf/xds" title="xDS 协议" target="_blank" rel="noopener">xDS 协议</a>使我们能够在集群中扩展到数千甚至数万个节点。这种方法解决了上面讨论的许多问题，以及其他问题，如单节点妥协影响范围和规模上的 CiliumIdentity 重复。让我们看看它是如何工作的。</p>
<p><a href="https://github.com/cncf/xds" title="xDS 协议" target="_blank" rel="noopener">xDS 协议</a>最初是一种动态配置<a href="https://www.envoyproxy.io/" title="Envoy 代理" target="_blank" rel="noopener">Envoy 代理</a>的方式，但是它建立的理念是可以用来支持“通用数据平面”。该协议已成为在多个节点之间同步状态的有效方式，<a href="https://github.com/cncf/xds" title="现在由 CNCF 工作组管理" target="_blank" rel="noopener">现在由 CNCF 工作组管理</a>。</p>
<p>最终，我们希望消除每个 cilium-agent 所做的冗余工作，将诸如标识创建之类的复杂且权限敏感的操作集中在一起，并以高效的方式为代理提供状态，同时不损害 Kubernetes 作为整体的可靠性。</p>
<p>为了做到这一点，我们将不再让每个 cilium-agent 充当独立的控制平面，而是考虑让 cilium-agent 充当智能集中控制平面的简单只读客户端。控制平面将保护代理免受复杂和权限敏感的操作。</p>
<p>cilium-agent（现在属于数据平面的一部分）与控制平面之间的通信将采用<a href="https://github.com/cncf/xds" title="xDS 协议" target="_blank" rel="noopener">xDS 协议</a>。数据平面不允许从数据平面到控制平面的写操作，因此 cilium-agent 不需要对后端存储（CRD/kv-store）具有写入访问权限。xDS 控制平面服务可以得到安全加固，是唯一需要支持对 Kubernetes API 服务器进行读/写操作的组件。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/f6_hud06f088070b8a4b45fcfc26cbe240d6e_75149_1536x1136_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/f6.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/f6.jpg" data-width="1536" data-height="1136" alt="image" data-caption="">
          </picture>
        
      
    
  
  
</figure>
<p>这种架构减轻了 Kubernetes API 服务器的负载，并且不需要任何外部管理的数据存储。它看起来也更接近之前讨论的三层控制平面架构。</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/trans/scaling-cilium-to-new-heights-with-xds/g6_hu490d613048364fd74eba646cc8785540_43458_1572x796_resize_q75_h2_lanczos.webp" type="image/webp">
           <img src="/trans/scaling-cilium-to-new-heights-with-xds/g6.jpg" data-img="/trans/scaling-cilium-to-new-heights-with-xds/g6.jpg" data-width="1572" data-height="796" alt="image" data-caption="图 6：xDS 实现的初始测试显示 CPU 和内存使用的预期行为">
          </picture>
        
      
    
  
  
  <figcaption>图 6：xDS 实现的初始测试显示 CPU 和内存使用的预期行为</figcaption>
  
</figure>
<p>在这种架构中，我们确实看到了 xDS 控制平面 pods 中的 CPU 和内存开销，正如预期的那样，每个节点仍然需要处理 eBPF 数据平面的一些 CPU/内存处理开销。</p>
<p>这种模型带来的其他好处包括在节点受损时更小的影响范围，以及消除了 cilium-agent 创建的重复标识。在原始架构（CRD 或 kv-store）中，每个节点都有一个完整的控制平面，需要特殊权限来读取和写入<code>CiliumEndpoints</code>和<code>CiliumIdentity</code>。如果某个节点上的 cilium-agent 受到妥协，那么整个控制平面将受到威胁，并使攻击者能够影响其他节点。这可能导致整个集群妥协。在 xDS 模型中，cilium-agent 被允许从控制平面读取数据（不允许写入），单个 cilium-agent 的妥协不会给予对整个控制平面或集群的访问权限。正如前面提到的，xDS 控制平面被视为特权组件，可以进行锁定和安全设置，甚至可以完全在集群之外运行。</p>
<p>xDS 方法的另一个好处是通过集中标识创建来消除 Cilium 中重复标识的生成。在现有模型中，每个 cilium-agent 都独立充当控制平面，与其他节点隔离，正如在现有模型中，它试图做出可能是重复的决策。例如，当 Pod 分配到节点时，CNI 负责设置网络端点，当 cilium-agent 识别到一个新的端点，它没有现有的<code>CiliumIdentity</code>时，它将尝试创建它。如果命名空间标签发生更改并且需要重新计算所有标识，那么也会发生相同的情况。由于标识创建在多个节点上独立进行，因此有很大机会为相同标识创建多个<code>CiliumIdentity</code>（在极端情况下，<a href="https://docs.google.com/document/d/1Hcc_2mB9OOUxrqQgZ-gSYDPnLYE_If_TCzVbUGDOdGM/edit?pli=1#heading=h.yzvq0akbw7z9" title="如此描述的易于重现" target="_blank" rel="noopener">如此描述的易于重现</a>）。在 xDS 方法中，<code>CiliumIdentity</code>在集中创建，从而消除了这种情况。</p>
<h2 id="结论">结论</h2>
<p>Cilium 在 eBPF 基础上构建了强大的数据平面，但要使 Cilium 在规模上有效运行，我们可以利用 xDS 协议来改进控制平面架构。xDS 是一种高效的协议，允许我们利用多年来学到的构建控制平面的最佳实践。事实上，如果我们将 xDS 控制平面 <a href="https://docs.google.com/document/d/1U4pO_dTaHERKOtrneNA8njW19HSVbq3sBM3x8an4878/edit#heading=h.ghzkbpzc9oea" title="直接构建到 cilium-operator 中" target="_blank" rel="noopener">直接构建到 cilium-operator 中</a>，那么从这个实施中不会增加新的复杂性。</p>

            <div class="border-bottom mb-2"></div>
          </div>
          <div class="col-12">
            <p>最后更新于 2024/09/20</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/tags/service-mesh" class="badge">  
                  Service Mesh</a> 
              <a href="/tags/cilium" class="badge">  
                  Cilium</a> 
              <a href="/tags/xds" class="badge">  
                  Xds</a> 
              <a href="/tags/kubernetes" class="badge">  
                  Kubernetes</a> </div>
          </div>
          
          <div class="col-12">
            









    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    


<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/trans/expose-loadbalanced-kubernetes-services-with-bgp-cilium/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; 上一篇</span>
            <span class="text-align-left">[译] 使用 Cilium 和 BGP 为 Kubernetes 服务进行负载均衡</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/blog/preserve-source-ip-in-istio/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">下一篇 &rarr;</span>
            <span class="text-align-right">维持请求的透明度：在 Istio 中保留客户端请求的源 IP</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="zh-CN"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  相关文章
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/trans/doordash-service-mesh/">
            [译] DoorDash 的服务网格之旅：如何实现高效的区域感知路由
          </a>
      </li>
    
      <li>
          <a href="/trans/securing-cloud-natives-most-important-use-cases/">
            [译] 云原生软件的关键用例安全保障之道
          </a>
      </li>
    
      <li>
          <a href="/blog/externalname-and-serviceentry/">
            外部服务别名：ExternalName 与 ServiceEntry 对比
          </a>
      </li>
    
      <li>
          <a href="/blog/kubernetes-gateway-api-enhancement-cloud-native-network/">
            Kubernetes Gateway API 如何增强云原生网络
          </a>
      </li>
    
      <li>
          <a href="/blog/understanding-the-tls-encryption-in-istio/">
            如何理解 Istio 中的 mTLS 流量加密？
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      目录
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#了解-cilium-的控制平面架构">了解 Cilium 的控制平面架构</a></li>
    <li><a href="#构建控制平面的最佳实践">构建控制平面的最佳实践</a></li>
    <li><a href="#cilium-控制平面架构的扩展考虑">Cilium 控制平面架构的扩展考虑</a></li>
    <li><a href="#减轻-kubernetes-api-服务器的压力">减轻 Kubernetes API 服务器的压力</a></li>
    <li><a href="#使用-xds-改进-cilium-的控制平面扩展安全性和效率">使用 xDS 改进 Cilium 的控制平面扩展、安全性和效率</a></li>
    <li><a href="#结论">结论</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

 
 
 
 
 
    

<div class="sticky-top aside-toc loaded subscribe-module mt-4">
     <button class="close-ad" style="position: absolute; top: 0; right: 0; border: none; background: none; cursor: pointer;">✖</button>
     <p class="subscribe-module-title"> </p>
     
          <div class="d-flex">
          <span class="mr-2"><img src="/images/ads/03-geekbang.png" alt="QR Code"></span>
     
     <span>
          <p class="subscribe-module-subtitle"><a href="https://time.geekbang.org/hybrid/next/svip/home?utm_source=wechat&amp;utm_content=Jimmy-0905&amp;utm_term=wechat-Jimmy-0905" title="极客时间 VIP" target="_blank" rel="noopener">极客时间 VIP</a></p>
          <p class="subscribe-module-author">专属口令「1299-300」：Jimmy9999</p>
          <p class="subscribe-module-description">带你一站解锁 340+ 门专栏、视频课</p>
     </span>
     
     </div>
</div>


          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/black-myth-wukong-review/">《黑神话：悟空》一周目评测：瑕不掩瑜，期待更丰富内容</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/macao-trip/">澳门 City Walk：感受精致濠江</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/introducing-kmesh-kernel-native-service-mesh/">介绍 Kmesh：用内核原生技术革新服务网格数据平面</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024（香港）</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">网站改版通知</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
