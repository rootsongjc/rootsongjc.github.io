<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>全面解析 Istio 新型部署模式：环境模式 - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="本文详细介绍了 Istio 的新型部署模式——环境模式（Ambient Mesh），这是一种实验性的无 sidecar 部署模式，旨在提高服务网格的性能和可靠性。">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/trans/istio-ambient-mesh-introduction/" />
  <meta property="og:title" content="全面解析 Istio 新型部署模式：环境模式 | Jimmy Song" />
  <meta property="twitter:title" content="全面解析 Istio 新型部署模式：环境模式 | Jimmy Song" />

  
  <meta property="og:description" content="本文详细介绍了 Istio 的新型部署模式——环境模式（Ambient Mesh），这是一种实验性的无 sidecar 部署模式，旨在提高服务网格的性能和可靠性。" />
  <meta property="twitter:description" content="本文详细介绍了 Istio 的新型部署模式——环境模式（Ambient Mesh），这是一种实验性的无 sidecar 部署模式，旨在提高服务网格的性能和可靠性。" />

  
  <meta property="og:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />
  <meta property="twitter:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    [译] 全面解析 Istio 新型部署模式：环境模式
                </p>
                <p class="page-description">
                    本文详细介绍了 Istio 的新型部署模式——环境模式（Ambient Mesh），这是一种实验性的无 sidecar 部署模式，旨在提高服务网格的性能和可靠性。
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>2022/10/28</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/categories/istio"> 
                        Istio</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>16 分钟</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>3622 字</li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fas fa-language"></i>
                        </span><a href="https://tetrate.io/blog/ambient-mesh-what-you-need-to-know-about-this-experimental-new-deployment-model-for-istio/" target="_blank" rel="noopener">原文</a>
                    </li>
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">

            
              <div class="alert alert-note-container mt-2">
    <div class="alert-note-title px-2 py-2">
      声明
    </div>
    <div class="alert-tip px-2">
        本文为个人翻译，仅供参考，若需原文请自行查阅，疏漏之处欢迎指正。
    </div>
  </div>
            
            
            

            
              <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>查看本文大纲</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是环境模式">什么是环境模式？</a></li>
    <li><a href="#为什么应该关心环境模式">为什么应该关心环境模式？</a></li>
    <li><a href="#简要总结">简要总结</a></li>
    <li><a href="#istio-中的-l4-和-l7-处理是如何工作的">Istio 中的 L4 和 L7 处理是如何工作的？</a></li>
    <li><a href="#现在可以使用环境模式吗还不行">现在可以使用环境模式吗？（还不行）</a></li>
    <li><a href="#关于服务网格和-istio-的环境模式假设">关于服务网格和 Istio 的环境模式假设</a></li>
    <li><a href="#环境模式假设与客户现场的经验如何匹配">环境模式假设与客户现场的经验如何匹配</a></li>
    <li><a href="#关于环境模式的最后思考">关于环境模式的最后思考</a></li>
  </ul>
</nav>
</details>

            
            <p>Istio <a href="https://istio.io/latest/blog/2022/introducing-ambient-mesh/" title="最近宣布了“环境模式”" target="_blank" rel="noopener">最近宣布了“环境模式”</a>——一种实验性的、无 sidecar 的部署模式。我们最近在<a href="https://tetrate.io/blog/ebpf-and-sidecars-getting-the-most-performance-and-resiliency-out-of-the-service-mesh/" title="如何从服务网格中获得最大性能和弹性" target="_blank" rel="noopener">如何从服务网格中获得最大性能和弹性</a>的背景下讨论了 sidecar 与无 sidecar。在本文中，我们将特别介绍环境模式。</p>
<h2 id="什么是环境模式">什么是环境模式？</h2>
<p>环境模式是 Istio 最近引入的一种新的实验性部署模式。它将原本由 Envoy sidecar 执行的职责分解为两个独立的组件：一个节点级的加密组件（称为“ztunnel”）和一个每个服务部署的 L7 Envoy 实例，用于处理所有其他的流程（称为“waypoint”）。环境模式模型试图在生命周期和资源管理上获得一些效率提升——至少，这是其动机。</p>
<h2 id="为什么应该关心环境模式">为什么应该关心环境模式？</h2>
<p>对于大多数服务网格用户来说，Istio 数据平面的确切部署模式可能不是你需要过多考虑的问题。默认设置可能就足够好。对于<em>一些</em>服务网格用户，特别是那些有大量横向扩展且服务数量少的用户——在这种情况下，waypoint 架构最能获得效率提升——环境模式模式随着其成熟为生产就绪的基础设施软件，将会变得有用。</p>
<h2 id="简要总结">简要总结</h2>
<ul>
<li>环境模式部署模式相较于 sidecar 模式在生命周期管理、资源利用、故障排除和安全姿态方面做了一些权衡。两者并没有明显的优劣。</li>
<li>环境模式是一项实验，最早将在 2023 年前成为生产就绪——即，<strong>现在还不能在生产中使用</strong>。当前的性能更差，功能不那么丰富，广泛使用的技术如 CNI 行为不明确。然而，我们预计随着实现的加固，这种情况将在未来几个月迅速改善。</li>
<li>你关心的许多网格功能——如每次请求的流量管理和安全控制、分布式跟踪和应用级 RED 指标——都在 L7 层发生。目前尚不清楚仅 L4 部分的环境模式的适用范围有多广，以及分解这些数据平面职责将在多大程度上帮助推动网格的采用。</li>
</ul>
<p>本文的其余部分是我们对环境模型与 Istio 现有的 sidecar 部署模型的权衡，以及哪一个可能更适合你以及何时使用。</p>
<h2 id="istio-中的-l4-和-l7-处理是如何工作的">Istio 中的 L4 和 L7 处理是如何工作的？</h2>
<p>由于环境模式将 L4 和 L7 处理分开，了解每一层中发生的网格行为是很重要的：</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th><strong>L4</strong></th>
          <th><strong>L7</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>安全性</strong></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>服务对服务认证</td>
          <td><a href="https://spiffe.io/" title="SPIFFE" target="_blank" rel="noopener">SPIFFE</a>, 通过 mTLS 证书。Istio 发行一个编码了 pod 服务账户身份的短期 X.509 证书。</td>
          <td>N/A—服务身份在 Istio 中基于 TLS。</td>
      </tr>
      <tr>
          <td>服务对服务授权</td>
          <td>基于网络的授权，加上基于身份的策略，例如：<em>A</em> 只能接受来自“10.2.0.0/16”的入站调用；<em>A</em> 可以调用 <em>B</em>。</td>
          <td>完整策略，例如：<em>A</em> 只能在拥有有效的终端用户凭据且包含 READ 范围时，从 <em>B</em> 获取 /foo。</td>
      </tr>
      <tr>
          <td>终端用户认证</td>
          <td>N/A—我们无法应用每个用户的设置。</td>
          <td>本地认证 JWT，支持通过 OAuth 和 OIDC 流程的远程认证。</td>
      </tr>
      <tr>
          <td>终端用户授权</td>
          <td>N/A—见上文。</td>
          <td>服务对服务策略可以扩展到要求<a href="https://istio.io/latest/docs/reference/config/security/conditions/" title="具有特定范围、发行者、主体、受众等的终端用户凭据" target="_blank" rel="noopener">具有特定范围、发行者、主体、受众等的终端用户凭据</a>—但它不能用于全面的用户对资源的访问控制。全面的用户对资源的访问控制应该使用外部授权来实现。</td>
      </tr>
      <tr>
          <td>Envoy 的外部授权 API (ext_authz)</td>
          <td>不能执行任何每次请求的策略；ext_authz API 只能配置用于 L7 流量。</td>
          <td>执行每次请求的策略，决策来自一个外部服务，例如 OPA。</td>
      </tr>
      <tr>
          <td><strong>可观测性</strong></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>日志记录</td>
          <td>基本网络信息：网络 5 元组，发送/接收的字节等。<a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#command-operators" title="参见 Envoy 文档" target="_blank" rel="noopener">参见 Envoy 文档</a>。</td>
          <td><a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#command-operators" title="完整的请求元数据日志记录" target="_blank" rel="noopener">完整的请求元数据日志记录</a>，除了基本网络信息。</td>
      </tr>
      <tr>
          <td>跟踪</td>
          <td>今天不可行；可能最终通过 HBONE 实现。</td>
          <td>Envoy 参与分布式跟踪。<a href="https://istio.io/latest/docs/tasks/observability/distributed-tracing/overview/" title="参见 Istio 跟踪概述" target="_blank" rel="noopener">参见 Istio 跟踪概述</a>。</td>
      </tr>
      <tr>
          <td>指标</td>
          <td>仅 TCP（发送/接收的字节，数据包数量等）。</td>
          <td>L7 RED 指标：请求率、错误率、请求持续时间（延迟）。</td>
      </tr>
      <tr>
          <td><strong>流量管理</strong></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>负载均衡</td>
          <td>仅在连接级别。<a href="https://istio.io/latest/docs/tasks/traffic-management/tcp-traffic-shifting/" title="参见 TCP 流量转移任务" target="_blank" rel="noopener">参见 TCP 流量转移任务</a>。</td>
          <td>每次请求，启用例如金丝雀部署、gRPC 流量等。<a href="https://istio.io/latest/docs/tasks/traffic-management/traffic-shifting/" title="参见 HTTP 流量转移任务" target="_blank" rel="noopener">参见 HTTP 流量转移任务</a>。</td>
      </tr>
      <tr>
          <td>断路器</td>
          <td><a href="https://istio.io/latest/docs/reference/config/networking/destination-rule/#ConnectionPoolSettings-TCPSettings" title="仅 TCP" target="_blank" rel="noopener">仅 TCP</a>。</td>
          <td><a href="https://istio.io/latest/docs/reference/config/networking/destination-rule/#ConnectionPoolSettings-HTTPSettings" title="HTTP 设置" target="_blank" rel="noopener">HTTP 设置</a> 除了 TCP。</td>
      </tr>
      <tr>
          <td>异常检测</td>
          <td>在连接建立/失败时。</td>
          <td>在请求成功/失败时。</td>
      </tr>
      <tr>
          <td>速率限制</td>
          <td><a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/rate_limit_filter#config-network-filters-rate-limit" title="仅在连接建立时，L4 连接数据的速率限制" target="_blank" rel="noopener">仅在连接建立时，L4 连接数据的速率限制</a>，有全局和本地速率限制选项。</td>
          <td><a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/rate_limit_filter#config-http-filters-rate-limit" title="每次请求的 L7 请求元数据的速率限制" target="_blank" rel="noopener">每次请求的 L7 请求元数据的速率限制</a>。</td>
      </tr>
      <tr>
          <td>超时</td>
          <td>仅在连接建立时（通过断路器设置配置连接保持活动）。</td>
          <td>每次请求。</td>
      </tr>
      <tr>
          <td>重试</td>
          <td>重试连接建立。</td>
          <td>重试每次请求失败。</td>
      </tr>
      <tr>
          <td>故障注入</td>
          <td>N/A—TCP 连接上不能配置故障注入。</td>
          <td>全面的应用和连接级故障（<a href="https://istio.io/latest/docs/tasks/traffic-management/fault-injection/" title="超时、延迟、特定响应码" target="_blank" rel="noopener">超时、延迟、特定响应码</a>）。</td>
      </tr>
      <tr>
          <td>流量镜像</td>
          <td>N/A—仅 HTTP。</td>
          <td><a href="https://istio.io/latest/docs/tasks/traffic-management/mirroring/" title="请求的百分比基础镜像到多个后端" target="_blank" rel="noopener">请求的百分比基础镜像到多个后端</a>。</td>
      </tr>
  </tbody>
</table>
<p>值得记住的是，一个在 L7 操作的代理可以执行 L4 <em>和</em> L7 栏中的所有操作，而一个仅在 L4 操作的代理只能执行 L4 栏中的操作。了解何处发生了什么以及 L4 与 L7 的限制，我们可以看看环境模式与 sidecar 模型相比的权衡。</p>
<h2 id="现在可以使用环境模式吗还不行">现在可以使用环境模式吗？（还不行）</h2>
<p>截至其 2022 年 9 月的公告，环境模式是一个实验性的概念验证。根据<a href="https://github.com/istio/istio/tree/experimental-ambient#limitations" title="几乎所有的度量" target="_blank" rel="noopener">几乎所有的度量</a>，它的表现不如 sidecar，并且有不少<a href="https://github.com/istio/istio/tree/experimental-ambient#limitations" title="限制" target="_blank" rel="noopener">限制</a>。环境模式<strong>还没有准备好</strong>在生产环境中使用（对我们的客户来说——大型企业的平台团队——应用开发和测试环境也算是生产环境）。</p>
<p>然而，我们预计这种状态会相对快速地改变，因为整个社区的工程师正在努力改进这种部署模型。它将像<a href="https://istio.io/latest/docs/releases/feature-stages/" title="所有其他 Istio 功能" target="_blank" rel="noopener">所有其他 Istio 功能</a>一样，通过功能阶段发展。关注<a href="https://istio.io/latest/docs/releases/feature-stages/#istio-features" title="Istio 功能列表" target="_blank" rel="noopener">Istio 功能列表</a>，环境模式可能在 2023 年某个时候被提升为 Alpha 状态。我们预计它会在 2023 年底或 2024 年初离开 Beta，并且我们不建议在那之前将其用于生产环境。</p>
<h2 id="关于服务网格和-istio-的环境模式假设">关于服务网格和 Istio 的环境模式假设</h2>
<p>总结环境模式公告博客文章，驱动架构的核心假设是：</p>
<ol>
<li><strong>假设</strong>：Envoy 的 L7 功能是使新应用加入网格变得困难的原因。</li>
<li><strong>假设</strong>：Envoy 的 L7 功能是发现 CVE 的地方（绝大多数 Envoy CVE 都在 L7 代码中，而不是处理 TLS 和连接的 L4 代码），因此，在节点级别保持多个容器的证书在严格的 L4 代理中是可接受的，而在节点级别进行 L7 处理则不是。</li>
<li><strong>假设</strong>：sidecar 常常导致资源过度分配。</li>
<li><strong>假设</strong>：额外的网络跳数比 Envoy 进行 L7 计算更便宜（从两个 L7 sidecar 转到一个 L7 waypoint 增加了一个跳数，但减少了一个执行 L7 处理的 Envoy）。</li>
<li><strong>假设</strong>：Istio 最有价值的功能是传输中的加密，因此，优化使这一用例易于实现是有价值的。</li>
</ol>
<h2 id="环境模式假设与客户现场的经验如何匹配">环境模式假设与客户现场的经验如何匹配</h2>
<p>我们与世界上一些最大的企业紧密合作，以促进服务网格的采用，这些经验并没有完全证明这些激励思想：</p>
<ol>
<li>
<p><strong>L7 功能</strong>：网格的一些 L7 功能<em>可以</em>使应用的采用更加困难，但根据我们的经验，应用入网的更多破坏是由于连接寿命的变化或双重加密的问题造成的。这些问题无论是 sidecar 还是节点级代理都会以类似的方式表现出来，但在节点部署模型中（通常缺乏权限检查特权/节点级组件的日志）对应用团队来说更难排查问题。深入了解<a href="https://tetrate.io/blog/ebpf-and-sidecars-getting-the-most-performance-and-resiliency-out-of-the-service-mesh/" title="节点级代理与 sidecar" target="_blank" rel="noopener">节点级代理与 sidecar</a>的区别，请参阅我们之前提到的博客文章。</p>
</li>
<li>
<p><strong>L7 CVE</strong>: 查看这些，我们看到：</p>
<ul>
<li>三十三个与 L7 处理相关，主要是解析或 HTTP 处理。</li>
<li>剩下的 12 个是 L4 或 Envoy 固有的（连接处理、证书处理、噪声邻居 DOS、缓冲区溢出等）。</li>
<li>L7 CVEs 的平均严重性高于非 L7 CVE。</li>
</ul>
<p>一个仅 L4 的 Envoy <em>确实</em>提供了相比 L7 Envoy 更小的攻击面，因为代码更少（CVEs 也更少）。是否这样的攻击面足够低以证明在节点上保持每个 pod 的身份是个问题。环境模式安全模型的核心在于我们对 ztunnel 组件的信任程度——这是社区打算首先发展的组件。总体而言，环境的安全模型最好是与 sidecar 模型相比的一种侧步，但在将其纳入现有安全模型时，边界更难以推理。</p>
</li>
<li>
<p><strong>资源利用</strong>：的确，如果没有配置 pod 资源请求，sidecar 可以导致资源利用不良，如果不使用<a href="https://istio.io/latest/docs/ops/best-practices/traffic-management/#cross-namespace-configuration" title="配置资源可见性" target="_blank" rel="noopener">配置资源可见性</a>或<a href="https://istio.io/latest/docs/reference/config/networking/sidecar/" title="sidecar API 资源" target="_blank" rel="noopener">sidecar API 资源</a>等技术。然而，我们在严格控制资源可见性并通过 sidecar API 资源限制配置范围的 Istio 部署中的经验是，sidecar 资源利用非常低，我们可以为每个 sidecar 设置比 Istio 默认配置文件更小的资源请求。手动维护这种配置类型的 sidecar API 资源<em>非常具有挑战性</em>——这就是为什么 <a href="https://tetrate.io/tetrate-service-bridge/" title="Tetrate Service Bridge" target="_blank" rel="noopener">Tetrate Service Bridge</a> 根据更高级别的访问构造自动生成它。</p>
<p>我们很高兴看到环境部署模型带来的资源利用改进——因为一个独立的 waypoint Envoy 通常可以处理比单个服务实例（及其 sidecar）看到的流量显著更多。</p>
</li>
<li>
<p><strong>额外的网络跳数与 sidecar</strong>：环境部署模型提供的最有趣的可能性之一是在 sidecar 架构中移除额外的 L7 Envoy。因为网格中的通信是 sidecar 对 sidecar，客户端和</p>
</li>
</ol>
<p>服务器都应用 L7 策策，我们必须对每个请求进行两次 L7 处理。在环境模式中，该策略将由服务器的 Waypoint 执行——所以 L7 处理只发生一次。然而，连接的两侧仍有 ztunnel 进行 L4 处理。</p>
<p>这种交易——一个网络跳数而不是 Envoy 进行 L7 处理——是否总体上值得仍有待观察。当然在同一可用区的云提供商网络中，由于延迟低且连接可靠，它可能是值得的。然而，我们的许多客户在预置和各种物理站点上部署服务网格，这些站点通常看起来不像云提供商网络。</p>
<ol start="5">
<li><strong>mTLS</strong>：Istio 的传输中加密无疑是其最强大的功能之一。它被用于（<a href="https://tetrate.io/blog/tetrate-istio-distro-achieves-fips-certification/" title="以 FIPS 验证的形式" target="_blank" rel="noopener">以 FIPS 验证的形式</a>）<a href="https://tetrate.io/blog/tetrate-first-to-provide-hardened-istio-to-dods-iron-bank/" title="FIPS 合规" target="_blank" rel="noopener">FIPS 合规</a>、<a href="https://tetrate.io/resource/meeting-pci-compliance-standards/" title="PCI 合规" target="_blank" rel="noopener">PCI 合规</a> 和在各种安全优先的环境中。然而，当我们看到网格的能力时，通常加密本身并不是采用的原因：通常是加密与 L7 策略（包括流量控制）和可观测性一起激励技术投资。从上表中可以看出，这些能力不能仅靠 ztunnel 实现——它们需要一个 L7 Envoy。事实上，我们今天看到的大多数网格使用都需要一个 L7 Envoy。我们对任何使网格采用更容易的事情都感到非常热情，但我们还没有信心环境模式的部署模型将在这方面显著提供。</li>
</ol>
<h2 id="关于环境模式的最后思考">关于环境模式的最后思考</h2>
<p>环境模式是对无 sidecar 服务网格模型的一种有趣看法。我们很期待看到它的发展，特别是如果它能帮助简化网格的采用。有一些特定的用例我们预计这种方法会带来好处，但现在还很早，尚不清楚这些权衡是否值得。无论如何，环境模式在被认为准备好生产之前可能还需要一段时间。直到那时，正如人们所说，让我们拭目以待。</p>

            <div class="border-bottom mb-2"></div>
          </div>
          <div class="col-12">
            <p>最后更新于 2025/03/09</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/tags/ambient" class="badge">  
                  Ambient</a> </div>
          </div>
          
          <div class="col-12">
            









    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    


<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/blog/why-gateway-api-is-the-future-of-ingress-and-mesh/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; 上一篇</span>
            <span class="text-align-left">Gateway API：Kubernetes 和服务网格入口中网关的未来</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/blog/envoy-gateway-release/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">下一篇 &rarr;</span>
            <span class="text-align-right">Envoy Gateway 首个正式开源版本介绍</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="zh-CN"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  相关文章
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/blog/istio-ambient-mode/">
            关于 Istio 推出 Ambient 模式（无侵入模式）的看法
          </a>
      </li>
    
      <li>
          <a href="/blog/istio-arm64-support/">
            Istio 1.15 新增对 arm64 架构处理器的支持
          </a>
      </li>
    
      <li>
          <a href="/blog/istiocon-2022-recap/">
            IstioCon 2022 回顾及录像、PPT 分享
          </a>
      </li>
    
      <li>
          <a href="/blog/beyond-istio-oss/">
            Beyond Istio OSS —— Istio 服务网格的现状与未来
          </a>
      </li>
    
      <li>
          <a href="/blog/how-to-integrate-spire-with-istio/">
            如何在 Istio 中集成 SPIRE？
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      目录
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是环境模式">什么是环境模式？</a></li>
    <li><a href="#为什么应该关心环境模式">为什么应该关心环境模式？</a></li>
    <li><a href="#简要总结">简要总结</a></li>
    <li><a href="#istio-中的-l4-和-l7-处理是如何工作的">Istio 中的 L4 和 L7 处理是如何工作的？</a></li>
    <li><a href="#现在可以使用环境模式吗还不行">现在可以使用环境模式吗？（还不行）</a></li>
    <li><a href="#关于服务网格和-istio-的环境模式假设">关于服务网格和 Istio 的环境模式假设</a></li>
    <li><a href="#环境模式假设与客户现场的经验如何匹配">环境模式假设与客户现场的经验如何匹配</a></li>
    <li><a href="#关于环境模式的最后思考">关于环境模式的最后思考</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-installation-deep-dive/">Istio 安装方式深度剖析——选择与实践指南</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-ambient-terminology/">Istio Ambient 模式：图解及概念解读</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/free-ai-drawing-tool-raphael/">免费的 AI 绘图工具推荐：Raphael.app</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  简明 Envoy 教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/kcd-beijing-2025/">KCD Beijing 2025 - 提交议题及参会报名</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-community-domain-migration/">云原生社区网站域名变更通知</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2025 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
