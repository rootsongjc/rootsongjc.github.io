<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="g8IYR9SNLF" />
    <meta name="uyan_auth" content="419f63884b" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="contiv, docker, docker plugin, network, cisco, sdn, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½• : rootsongjc.github.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://rootsongjc.github.io/blogs/contiv-tryout/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-03-09"/>
<meta property="article:modified_time" content="2017-03-09"/>



<meta property="article:tag" content="contiv">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="docker plugin">
<meta property="article:tag" content="network">
<meta property="article:tag" content="cisco">
<meta property="article:tag" content="sdn">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½• : rootsongjc.github.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="rootsongjc.github.io">

    <base href="http://rootsongjc.github.io/">
    <title> Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½• - Jimmy Song </title>
    <link rel="canonical" href="http://rootsongjc.github.io/blogs/contiv-tryout/">

    
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
<script>
    hljs.initHighlightingOnLoad();
</script>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function() {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden; '>
    <img src='http://olz1di9xf.bkt.clouddn.com/jimmy.jpg' />
</div>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=61142324" charset="UTF-8"></script>
</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
<header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/blogs/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blogs </span>
            </a>
            </li>
            <li>
            <a href="/projects/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> projects </span>
            </a>
            </li>
            <li>
            <a href="/talks/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="http://www.linkedin.com/in/rootsongjc">
                <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

    <ul id="social">
    <li id="share">
        <span class="icon icon-bubbles"> </span>
        <span class="title"> share </span>
        <div class="dropdown share">
            <ul class="social">
                <li> <a href="https://twitter.com/intent/tweet?status=Contiv%e5%85%a5%e5%9d%91%e6%8c%87%e5%8d%97-%e8%af%95%e7%94%a8%e5%85%a8%e8%ae%b0%e5%bd%95-http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-tryout%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-tryout%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="https://plus.google.com/share?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-tryout%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-tryout%2f&title=Contiv%e5%85%a5%e5%9d%91%e6%8c%87%e5%8d%97-%e8%af%95%e7%94%a8%e5%85%a8%e8%ae%b0%e5%bd%95&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://del.icio.us/post?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-tryout%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-tryout%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
            </ul>
            <span class="subcount">sharing is caring</span>
        </div>
    </li>
    <li id="follow">
        <span class="icon icon-rocket"> </span>
        <span class="title"> follow </span>
        <div class="dropdown follow">
            <ul class="social">
                <li> <a href="http://www.twitter.com/rootsongjc" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="http://www.facebook.com/rootsongjc" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="http://www.linkedin.com/in/rootsongjc" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="è±†ç“£" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                <li> <a href="https://rootsongjc.tuchong.com/" target="_blank" title="å›¾è™«" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>
            </ul>
            <span class="subcount">join 10k+ subscribers &amp; followers</span>
        </div>
    </li>
</ul>
    </nav>
</header>



<section id="main">
  <h1 itemprop="name" id="title">Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½•</h1>
  <div>
        <article itemprop="articleBody" id="content">
           

<p><img src="http://olz1di9xf.bkt.clouddn.com/2017013129.jpg" alt="é»„æ˜" /></p>

<p><em>(é¢˜å›¾ï¼šå±±ä¸œè£æˆæ»¨æµ·é£åŠ›å‘ç”µåœº  Jan 31,2017ï¼‰</em></p>

<p>å…³äºcontivçš„ä»‹ç»è¯·çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« <a href="http://rootsongjc.github.io/post/contiv_guide/">Contiv Intro</a>ã€‚</p>

<p>å¼€å‘ç¯å¢ƒä½¿ç”¨<strong>Vagrant</strong>æ­å»ºï¼Œæ˜¨å¤©è¯•ç”¨äº†ä¸‹ï¼ŒçœŸä¸çŸ¥é“å®ƒä»¬æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œå³ç„¶æ˜¯dockeræ’ä»¶ä¸ºå•¥ä¸ç›´æ¥åœ¨dockerä¸­å¼€å‘å‘¢ï¼Œæˆ‘æœ‰ç¯‡æ–‡ç« ä»‹ç»<a href="http://rootsongjc.github.io/post/docker-dev-env/">å¦‚ä½•æ­å»ºdockerå¼€å‘ç¯å¢ƒ</a>ï¼Œå¯ä»¥åœ¨dockerä¸­å¼€å‘dockerï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨æ¥å¼€å‘contivå•ŠğŸ˜„ï¼Œåªè¦ä¸‹è½½ä¸€ä¸ªdockeré•œåƒ<code>dockercore/docker:latest</code>å³å¯ï¼Œä¸è¿‡æœ‰ç‚¹å¤§2.31Gï¼Œä½¿ç”¨é˜¿é‡Œäº‘çš„mirrorä¸‹è½½å€’æ˜¯ä¹Ÿåˆ’ç®—ï¼Œæ€»æ¯”ä½ è‡ªå·±éƒ¨ç½²ä¸€ä¸ªå¼€å‘ç¯å¢ƒèŠ‚çœæ—¶é—´ã€‚</p>

<h3 id="contivæ¦‚å¿µè§£æ">Contivæ¦‚å¿µè§£æ</h3>

<p>Contivç”¨äºç»™å®¹å™¨åˆ›å»ºå’Œåˆ†é…ç½‘è·¯ï¼Œå¯ä»¥åˆ›å»ºç­–ç•¥ç®¡ç†å®¹å™¨çš„å®‰å…¨ã€å¸¦å®½ã€ä¼˜å…ˆçº§ç­‰ï¼Œç›¸å½“äºä¸€ä¸ªSDNã€‚</p>

<h4 id="group">Group</h4>

<p>æŒ‰å®¹å™¨æˆ–Podçš„åŠŸèƒ½ç»™å®¹å™¨åˆ†é…ç­–ç•¥ç»„ï¼Œé€šå¸¸æ˜¯æŒ‰ç…§å®¹å™¨/Podçš„<code>label</code>æ¥åˆ†ç»„ï¼Œåº”ç”¨ç»„è·Ÿcontivçš„networkä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¯ä»¥å¾ˆå¤šåº”ç”¨ç»„å±äºåŒä¸€ä¸ªnetworkæˆ–IP subnetã€‚</p>

<h4 id="polices">Polices</h4>

<p>ç”¨æ¥é™å®šgroupçš„è¡Œä¸ºï¼Œcontivæ”¯æŒä¸¤ç§ç±»å‹çš„policyï¼š</p>

<ul>
<li>Bandwidth é™å®šåº”ç”¨ç»„çš„èµ„æºä½¿ç”¨ä¸Šé™</li>
<li>Isolation èµ„æºç»„çš„è®¿é—®æƒé™</li>
</ul>

<p>Groupå¯ä»¥åŒæ—¶åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªpolicyï¼Œå½“æœ‰å®¹å™¨è°ƒåº¦åˆ°è¯¥groupé‡Œå°±ä¼šé€‚ç”¨è¯¥groupçš„policyã€‚</p>

<h4 id="network">Network</h4>

<p>IPv4æˆ–IPv6ç½‘ç»œï¼Œå¯ä»¥é…ç½®subnetå’Œgatewayã€‚</p>

<p><strong>Contivä¸­çš„ç½‘ç»œ</strong></p>

<p>åœ¨contivä¸­å¯ä»¥é…ç½®ä¸¤ç§ç±»å‹çš„ç½‘ç»œ</p>

<ul>
<li>application networkï¼šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œ</li>
<li>infrastructure networkï¼šhost namespaceçš„è™šæ‹Ÿç½‘ç»œï¼Œæ¯”å¦‚åŸºç¡€è®¾æ–½ç›‘æ§ç½‘ç»œ</li>
</ul>

<p><strong>ç½‘ç»œå°è£…</strong></p>

<p>Contivä¸­æœ‰ä¸¤ç§ç±»å‹çš„ç½‘ç»œå°è£…</p>

<ul>
<li>Routedï¼šoverlay topologyå’ŒL3-routed BGP topology</li>
<li>Bridgedï¼šlayer2 VLAN</li>
</ul>

<h4 id="tenant">Tenant</h4>

<p>Tenantæä¾›contivä¸­çš„namespaceéš”ç¦»ã€‚ä¸€ä¸ªtenantå¯ä»¥æœ‰å¾ˆå¤šä¸ªnetworkï¼Œæ¯ä¸ªnetworkéƒ½æœ‰ä¸ªsubnetã€‚è¯¥tenantä¸­çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒçš„ä»»æ„networkå’Œsubnetçš„IPã€‚</p>

<p>ç‰©ç†ç½‘ç»œä¸­çš„tenantç§°ä½œ<code>è™šæ‹Ÿè·¯ç”±è½¬å‘(VRF)</code>ã€‚Contivä½¿ç”¨VLANå’ŒVXLAN IDæ¥å®ç°å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œè¿™å–å†³ä½ ä½¿ç”¨çš„æ˜¯layer2ã€layer3è¿˜æ˜¯Cisco ACIã€‚</p>

<h3 id="contivä¸‹è½½">Contivä¸‹è½½</h3>

<p>Contivçš„ç¼–è¯‘å®‰è£…æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½githubä¸Šçš„<a href="[1.0.0-beta.3-03-08-2017.18-51-20.UTC](https://github.com/contiv/netplugin/releases/tag/1.0.0-beta.3-03-08-2017.18-51-20.UTC)">release-1.0.0-beta.3-03-08-2017.18-51-20.UTC</a>æ–‡ä»¶è§£å‹è·å¾—äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚</p>

<blockquote>
<p><a href="https://github.com/contiv/install/blob/master/README.mdè¿™ä¸ªå®˜æ–¹æ–‡æ¡£å·²ç»è¿‡æ—¶ï¼Œä¸è¦çœ‹äº†ã€‚">https://github.com/contiv/install/blob/master/README.mdè¿™ä¸ªå®˜æ–¹æ–‡æ¡£å·²ç»è¿‡æ—¶ï¼Œä¸è¦çœ‹äº†ã€‚</a></p>
</blockquote>

<p>å¦‚æœè¯•ç”¨å¯ä»¥çš„è¯ï¼Œæˆ‘ä¼šåç»­å†™contivå¼€å‘ç¯å¢ƒæ­å»ºçš„æ–‡ç« ã€‚</p>

<p>è¿™ä¸ªreleaseæ˜¯2017å¹´3æœˆ8æ—¥å‘å¸ƒçš„ï¼Œå°±åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„å‰ä¸€å¤©ã€‚æœ‰ä¸ª<strong>æœ€é‡è¦çš„æ›´æ–°</strong>æ˜¯<u>æ”¯æŒdocker1.13 swarm mode</u>ã€‚</p>

<p><a href="https://github.com/contiv/netplugin/blob/master/install/HowtoSetupContiv.md">å®˜æ–¹å®‰è£…æ–‡æ¡£</a></p>

<p>ä¸‹è½½è§£å‹åä¼šå¾—åˆ°å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>

<ul>
<li>contivk8s  k8sä¸“ç”¨çš„</li>
<li>contrib  æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸ª<code>netctl</code>çš„bashè„šæœ¬</li>
<li>netcontiv  è¿™ä¸ªå‘½ä»¤å°±ä¸€ä¸ª-versioné€‰é¡¹ç”¨æ¥æŸ¥çœ‹contivçš„ç‰ˆæœ¬ğŸ˜“</li>
<li>netctl  contivå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥é…ç½®ç½‘ç»œã€ç­–ç•¥ã€æœåŠ¡è´Ÿè½½å‡è¡¡ï¼Œ<a href="http://contiv.github.io/documents/reference/netctlcli.html">ä½¿ç”¨è¯´æ˜</a></li>
<li>netmaster  contivçš„ä¸»èŠ‚ç‚¹æœåŠ¡</li>
<li>netplugin</li>
</ul>

<p>ä¸‹é¢çš„å®‰è£…ä¸­ç”¨åˆ°çš„åªæœ‰netctlã€netmasterå’Œnetpluginè¿™ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>

<p>æˆ‘ä»¬å°†è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½copyåˆ°/usr/binç›®å½•ä¸‹ã€‚</p>

<p>æˆ‘ä»¬åœ¨docker17.03-ceä¸­å®‰è£…contivã€‚</p>

<h3 id="contivå®‰è£…ä¾èµ–">Contivå®‰è£…ä¾èµ–</h3>

<p>Contivä¾èµ–äºconsulæˆ–etcdï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨etcdï¼Œslacké‡Œçš„äººè¯´åªæ”¯æŒ2.3.xç‰ˆæœ¬ï¼Œå¯èƒ½ä¸æ”¯æŒ3.0+ç‰ˆæœ¬çš„å§ï¼Œè¿˜æ²¡å®é™…æµ‹è¿‡ï¼Œå…ˆä½¿ç”¨2.3.7ã€‚</p>

<p><code>contiv master</code>å¯åŠ¨åè‡ªåŠ¨å‘etcdä¸­æ³¨å†Œä¿¡æ¯ï¼š</p>

<pre><code>/contiv.io/oper
/contiv.io/oper/auto-vlan
/contiv.io/oper/auto-vlan/global
/contiv.io/oper/auto-vxlan
/contiv.io/oper/auto-vxlan/global
/contiv.io/oper/global
/contiv.io/oper/global/global
/contiv.io/oper/ovs-driver
/contiv.io/oper/ovs-driver/sz-pg-oam-docker-test-001.tendcloud.com
/contiv.io/master
/contiv.io/master/config
/contiv.io/master/config/global
/contiv.io/obj
/contiv.io/obj/modeldb
/contiv.io/obj/modeldb/global
/contiv.io/obj/modeldb/global/global
/contiv.io/obj/modeldb/tenant
/contiv.io/obj/modeldb/tenant/default
/contiv.io/lock
/contiv.io/lock/netmaster
/contiv.io/lock/netmaster/leader
/contiv.io/service
/contiv.io/service/netmaster
/contiv.io/service/netmaster/172.20.0.113:9999
/contiv.io/service/netmaster.rpc
/contiv.io/service/netmaster.rpc/172.20.0.113:9001
/contiv.io/state
/contiv.io/state/auto-vlan
/contiv.io/state/auto-vlan/global
/contiv.io/state/auto-vxlan
/contiv.io/state/auto-vxlan/global
/contiv.io/state/global
/contiv.io/state/global/global
</code></pre>

<h3 id="contivå¯åŠ¨">Contivå¯åŠ¨</h3>

<p><strong>å¯åŠ¨netmaster</strong></p>

<pre><code class="language-shell">$nohup netmaster -cluster-mode docker -cluster-store etcd://172.20.0.113:2379 -debug -listen-url 172.20.0.113:9999 -plugin-name netplugin &amp;
</code></pre>

<p>ä¸ºäº†çªå‡ºnetmasterå‘½ä»¤çš„ä½¿ç”¨ï¼Œæˆ‘æŠŠæ‰€æœ‰å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼çš„å‚æ•°éƒ½æ˜ç¡®çš„å†™å‡ºã€‚</p>

<p><code>netmaster</code>ç›‘å¬9999ç«¯å£ã€‚</p>

<p><strong>æŸ¥çœ‹å·²æœ‰çš„contivç½‘ç»œ</strong></p>

<pre><code>$netctl --netmaster http://172.20.0.113:9999 network ls
Tenant  Network  Nw Type  Encap type  Packet tag  Subnet   Gateway  IPv6Subnet  IPv6Gateway
------  -------  -------  ----------  ----------  -------  ------   ----------  -----------
</code></pre>

<p>ä¸ºäº†ä»¥åæ‰§è¡Œå‘½ä»¤æ–¹ä¾¿ï¼Œä¸ç”¨æ¥å›è¾“å…¥<code>$NETMASTER</code>åœ°å€ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡</p>

<p><code>export NETMASTER=&quot;http://172.20.0.113:9999&quot;</code></p>

<blockquote>
<p>netpluginéœ€è¦ä½¿ç”¨Open vSwitchï¼Œæ‰€ä»¥ä½ éœ€è¦å…ˆå®‰è£…<strong>Open vSwitch</strong>ã€‚å¦åˆ™ä½ ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜<a href="https://github.com/contiv/netplugin/issues/760">netplugin issue-760</a></p>
</blockquote>

<h3 id="open-vswitchå®‰è£…">Open vSwitchå®‰è£…</h3>

<p><a href="http://supercomputing.caltech.edu/blog/index.php/2016/05/03/open-vswitch-installation-on-centos-7-2/">Open vSwitch installation on CentOS7.2</a></p>

<p>å‚è€ƒä¸Šé¢é“¾æ¥é‡Œçš„æ–¹æ³•ã€‚</p>

<pre><code class="language-shell">#!/bin/bash
yum -y install make gcc openssl-devel autoconf automake rpm-build redhat-rpm-config python-devel openssl-devel kernel-devel kernel-debug-devel libtool wget
mkdir -p ~/rpmbuild/SOURCES
cp openvswitch-2.5.1.tar.gz ~/rpmbuild/SOURCES/
tar xfz openvswitch-2.5.1.tar.gz
sed 's/openvswitch-kmod, //g' openvswitch-2.5.1/rhel/openvswitch.spec &gt; openvswitch-2.5.1/rhel/openvswitch_no_kmod.spec
rpmbuild -bb --nocheck ~/openvswitch-2.5.1/rhel/openvswitch_no_kmod.spec
</code></pre>

<p>ç¼–è¯‘å¥½çš„rpmåŒ…åœ¨<code>~/rpmbuild/RPMS/x86_64/openvswitch-2.5.1-1.x86_64.rpm</code>ç›®å½•ä¸‹ã€‚</p>

<p>å®‰è£…å¥½Open vSwitchåå°±å¯ä»¥å¯åŠ¨<strong>netplugin</strong>ã€‚</p>

<h3 id="åˆ›å»ºcontivç½‘ç»œ">åˆ›å»ºcontivç½‘ç»œ</h3>

<p><strong>å¯åŠ¨netplugin</strong></p>

<p><code>nohup netplugin -cluster-store etcd://172.20.0.113:2379 &amp;</code></p>

<p><strong>åˆ›å»ºnetwork</strong></p>

<p><code>netctl --netmaster http://172.20.0.113:9999 network create --subnet=10.1.2.0/24 contiv-net</code></p>

<p>è·å¾—ä»¥ä¸‹æŠ¥é”™ï¼š</p>

<p>ERRO[0000] Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode</p>

<p>ä½†æ˜¯æ‰§è¡Œç¬¬äºŒæ¬¡çš„æ—¶å€™å±…ç„¶æˆåŠŸäº†ï¼Œä¸è¿‡å½“æˆ‘æŸ¥çœ‹docker networkçš„æ—¶å€™æ ¹æœ¬å°±çœ‹ä¸åˆ°åˆšåˆšåˆ›å»ºçš„contiv-netç½‘ç»œã€‚*è¿™åªæ˜¯ä¸€åœºæ¸¸æˆä¸€åœºæ¢¦ã€‚ã€‚ã€‚*ğŸ˜¢</p>

<p>Creating network default:contiv-net</p>

<pre><code>$netctl network ls
Tenant   Network     Nw Type  Encap type  Packet tag  Subnet       Gateway  IPv6Subnet  IPv6Gateway
------   -------     -------  ----------  ----------  -------      ------   ----------  -----------
default  contiv-net  data     vxlan       0           10.1.2.0/24  
</code></pre>

<p>æŸ¥çœ‹åˆšåˆ›å»ºçš„contiv-netç½‘ç»œã€‚</p>

<pre><code>$netctl network inspect contiv-net
Inspeting network: contiv-net tenant: default
{
  &quot;Config&quot;: {
    &quot;key&quot;: &quot;default:contiv-net&quot;,
    &quot;encap&quot;: &quot;vxlan&quot;,
    &quot;networkName&quot;: &quot;contiv-net&quot;,
    &quot;nwType&quot;: &quot;data&quot;,
    &quot;subnet&quot;: &quot;10.1.2.0/24&quot;,
    &quot;tenantName&quot;: &quot;default&quot;,
    &quot;link-sets&quot;: {},
    &quot;links&quot;: {
      &quot;Tenant&quot;: {
        &quot;type&quot;: &quot;tenant&quot;,
        &quot;key&quot;: &quot;default&quot;
      }
    }
  },
  &quot;Oper&quot;: {
    &quot;availableIPAddresses&quot;: &quot;10.1.2.1-10.1.2.254&quot;,
    &quot;externalPktTag&quot;: 1,
    &quot;pktTag&quot;: 1
  }
}
</code></pre>

<p>ä»<strong>netmaster</strong>æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>

<pre><code>time=&quot;Mar  9 21:44:14.746627381&quot; level=debug msg=&quot;NwInfra type is default, no ACI&quot; 
time=&quot;Mar  9 21:44:14.750278056&quot; level=info msg=&quot;Creating docker network: {CheckDuplicate:true Driver:netplugin EnableIPv6:false IPAM:0xc4204d8ea0 Internal:false Attachable:true Options:map[tenant:default encap:vxlan pkt-tag:1] Labels:map[]}&quot; 
time=&quot;Mar  9 21:44:14.752034749&quot; level=error msg=&quot;Error creating network contiv-net. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752067294&quot; level=error msg=&quot;Error creating network contiv-net.default in docker. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752102735&quot; level=error msg=&quot;Error creating network {&amp;{Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752129195&quot; level=error msg=&quot;NetworkCreate retruned error for: &amp;{Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752155973&quot; level=error msg=&quot;CreateNetwork error for: {Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752172138&quot; level=error msg=&quot;Handler for POST /api/v1/networks/default:contiv-net/ returned error: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
</code></pre>

<h3 id="æ€»ç»“">æ€»ç»“</h3>

<p>ä»æ—¥å¿—ä¸­çœ‹åˆ°ä¸€ä¸ªä»¤äººæ‚²ç—›è¯­å¥çš„è¯*legacy plugin netplugin of type NetworkDriver is not supported in swarm mode*ï¼Œä½ ä»¬æ˜¨å¤©ä¸æ˜¯åˆšå‘çš„ç‰ˆæœ¬è¯´å·²ç»æ”¯æŒswarm modeå—ï¼Ÿ<a href="https://github.com/contiv/netplugin/commit/8afd1b7718c8424a876760d18484124e0aad3557"><code>commit-8afd1b7</code></a>ä¸æ˜¯ç™½çº¸é»‘å­—çš„å†™ç€å—ï¼Ÿ</p>

<p>æˆ‘æäº†ä¸ª<a href="https://github.com/contiv/netplugin/issues/776">issue-776</a>ï¼Œçœ‹çœ‹æ€æ ·è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦å¤–netpluginå‘½ä»¤æ€ä¹ˆç”¨ï¼Œæ–‡æ¡£ä¸Šæ²¡å†™å•Šï¼Ÿ</p>

<p><code>netplugin -h</code>å¯ä»¥ä¸­æœ‰ä¸¤ä¸ªé€‰é¡¹æˆ‘ä¸æ˜ç™½ï¼Œä¸çŸ¥é“æ€ä¹ˆè®¾ç½®ï¼Œæœ‰çŸ¥é“çš„äººè¯·å‘Šè¯‰æˆ‘ä¸€å£°ã€‚</p>

<pre><code>  -vlan-if value
    	VLAN uplink interface
  -vtep-ip string
    	My VTEP ip address
</code></pre>

<p>åŒæ—¶æˆ‘ä¼šç»§ç»­å…³æ³¨contivçš„slackå’Œgithub <a href="https://github.com/contiv/netplugin/issues/776">Issue-776</a>çš„è¿›å±•ã€‚</p>

        </article>
  </div>
</section>



<aside id="meta">

<div>
    <section id="datecount">
        <h4 id="date"> Thu Mar 9, 2017 </h4>
        <h5 id="wc"> 600 Words </h5>
        <h5 id="readtime"> Read in about 3 Min </h5>
    </section>
    <ul id="categories">
        
    </ul>
    <ul id="tags">
        
        <li> <a href="http://rootsongjc.github.io//tags/contiv">contiv</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/docker">docker</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/docker-plugin">docker plugin</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/network">network</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/cisco">cisco</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/sdn">sdn</a> </li>
        
    </ul>
</div>

<div>
    <section id="prev">
        &nbsp;<a class="previous" href="http://rootsongjc.github.io/blogs/contiv-v2plugin/"><i class="icon-arrow-left"></i> Contivå…¥å‘æŒ‡å—-v2plugin</a><br>
    </section>
    <section id="next">
        &nbsp;<a class="next" href="http://rootsongjc.github.io/blogs/contiv-guide/">æ€ç§‘å¼€æºdockerç½‘ç»œæ’ä»¶Contivç®€ä»‹ <i class="icon-arrow-right"></i></a>
    </section>
</div>

<div>
    <section id="author">
        <h4>About the Author</h4>
        <p>
            <a href="http://rootsongjc.github.io/about/">Jimmy Song</a> is a software engineer in Beijing, also an open source enthusiast and Big Data, Cloud Native fans. If you not see him front of computer, he must be traveling or taking pictures outside,
            visit the amazing pictures at <a href=https://rootsongjc.tuchong.com/>tuchong(å›¾è™«)</a>. Feel free to <a href=https://twitter.com/rootsongjc>follow him on twitter</a>.
        </p>
    </section>

</div>
</aside>

<meta itemprop="wordCount" content="567">
<meta itemprop="datePublished" content="2017-03-09">
<meta itemprop="url" content="http://rootsongjc.github.io/blogs/contiv-tryout/">


<aside id=comments>
    <div><h2> Comments </h2></div>
    
    <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2126256"></script>
    
</aside>

<footer>
  <div>
    <p>
    &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span></span>
    Powered by <a href="http://gohugo.io">Hugo</a>.
    </p>
  </div>
</footer>
</body>
</html>

