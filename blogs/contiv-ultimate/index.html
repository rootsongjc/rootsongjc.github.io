<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="g8IYR9SNLF" />
    <meta name="uyan_auth" content="419f63884b" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="docker, docker plugin, network, cisco, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Contiv Ultimate-æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆç¬¬ä¸€å¹• : rootsongjc.github.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://rootsongjc.github.io/blogs/contiv-ultimate/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-03-17"/>
<meta property="article:modified_time" content="2017-03-17"/>



<meta property="article:tag" content="docker">
<meta property="article:tag" content="docker plugin">
<meta property="article:tag" content="network">
<meta property="article:tag" content="cisco">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Contiv Ultimate-æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆç¬¬ä¸€å¹• : rootsongjc.github.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="rootsongjc.github.io">

    <base href="http://rootsongjc.github.io/">
    <title> Contiv Ultimate-æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆç¬¬ä¸€å¹• - Jimmy Song </title>
    <link rel="canonical" href="http://rootsongjc.github.io/blogs/contiv-ultimate/">
    

    
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
<script>hljs.initHighlightingOnLoad();</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=61142324" charset="UTF-8"></script>
</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
<header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/blogs/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blogs </span>
            </a>
            </li>
            <li>
            <a href="/projects/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> projects </span>
            </a>
            </li>
            <li>
            <a href="/talks/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="http://www.linkedin.com/in/rootsongjc">
                <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

            <ul id="social">
            <li id="share">
                <span class="icon icon-bubbles"> </span>
                <span class="title"> share </span>
                <div class="dropdown share">
                    <ul class="social">
                      <li> <a href="https://twitter.com/intent/tweet?status=Contiv%20Ultimate-%e6%80%9d%e7%a7%91docker%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6contiv%e8%b6%9f%e5%9d%91%e7%bb%88%e6%9e%81%e7%89%88%e7%ac%ac%e4%b8%80%e5%b9%95-http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                        <li> <a href="https://plus.google.com/share?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                        <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-ultimate%2f&title=Contiv%20Ultimate-%e6%80%9d%e7%a7%91docker%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6contiv%e8%b6%9f%e5%9d%91%e7%bb%88%e6%9e%81%e7%89%88%e7%ac%ac%e4%b8%80%e5%b9%95&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                        <li> <a href="http://del.icio.us/post?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                        <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
                    </ul>
                    <span class="subcount">sharing is caring</span>
                </div>
            </li>
            <li id="follow">
                <span class="icon icon-rocket"> </span>
                <span class="title"> follow </span>
                <div class="dropdown follow">
                    <ul class="social">
                        <li> <a href="http://www.twitter.com/rootsongjc" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="http://www.facebook.com/rootsongjc" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                        <li> <a href="http://www.linkedin.com/in/rootsongjc" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                        <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                        <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="è±†ç“£" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                        <li> <a href="https://tuchong.com/1425795/" target="_blank" title="å›¾è™«" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>                    </ul>
                    <span class="subcount">join 10k+ subscribers &amp; followers</span>
                </div>
            </li>
          </ul>

    </nav>
</header>



<section id="main">
  <h1 itemprop="name" id="title">Contiv Ultimate-æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆç¬¬ä¸€å¹•</h1>
  <div>
        <article itemprop="articleBody" id="content">
           

<p><img src="http://olz1di9xf.bkt.clouddn.com/20140810001.jpg" alt="å¹¿å·çŸ³ç‰Œæ¡¥" /></p>

<p><em>ï¼ˆé¢˜å›¾ï¼šå¹¿å·çŸ³ç‰Œæ¡¥ Aug 10,2014ï¼‰</em></p>

<p>å‰å‡ å¤©å†™çš„å‡ ç¯‡<a href="http://rootsongjc.github.io/tags/contiv/">å…³äºContivçš„æ–‡ç« </a>å·²ç»æŠŠå¼•å…¥å‘äº†ğŸ˜‚</p>

<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« å°†å¸¦é¢†å¤§å®¶ç”¨æ­£ç¡®çš„å§¿åŠ¿ç¼–è¯‘å’Œæ‰“åŒ…ä¸€ä¸ª<strong>contiv netplugin</strong>ã€‚</p>

<blockquote>
<p>è¯·ä¸€å®šè¦åœ¨<strong>Linux</strong>ç¯å¢ƒä¸­ç¼–è¯‘ã€‚dockerä¸­ç¼–è¯‘ä¹Ÿä¼šæŠ¥é”™ï¼Œæœ€å¥½è¿˜æ˜¯æä¸ªè™šæ‹ŸğŸ”å§ï¼Œæœ€å¥½è¿˜æœ‰VPNèƒ½ç¿»å¢™ã€‚</p>
</blockquote>

<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h2>

<p>æˆ‘ä½¿ç”¨çš„æ˜¯docker17.03-CEã€å®‰è£…äº†open vSwitch(è¿™ä¸ªåŒ…redhatçš„æºé‡Œæ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±çš„ç¼–è¯‘å®‰è£…)ï¼Œå¦‚æœä½ æ‡’å¾—ç¼–è¯‘å¯ä»¥ç”¨æˆ‘ç¼–è¯‘çš„rpmåŒ…ï¼Œ<a href="http://olz1di9xf.bkt.clouddn.com/openvswitch-2.5.0-2.el7.x86_64.rpm">ç‚¹è¿™é‡Œä¸‹è½½</a>ã€‚</p>

<h2 id="ç¼–è¯‘">ç¼–è¯‘</h2>

<p>è¿™ä¸€æ­¥æ˜¯å¾ˆå®¹æ˜“å¤±è´¥çš„ï¼Œæœ‰äººæè¿‡<a href="https://github.com/contiv/netplugin/issues/779">issue-779</a></p>

<p><strong>å…·ä½“æ­¥éª¤</strong></p>

<ul>
<li>åˆ›å»ºä¸€ä¸ªlink <strong>/go</strong>é“¾æ¥åˆ°ä½ çš„GOPATHç›®å½•ï¼Œä¸‹é¢ç¼–è¯‘çš„æ—¶å€™è¦ç”¨ã€‚</li>
<li>å°†æºç çš„<strong>vender</strong>ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°$GOPATH/srcç›®å½•ã€‚</li>
<li>æ‰§è¡Œç¼–è¯‘</li>
</ul>

<p>åœ¨netpluginç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤èƒ½å¤Ÿç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>

<pre><code>NET_CONTAINER_BUILD=1 make build
</code></pre>

<p>åœ¨ä½ çš„<strong>/$GOPATH/bin</strong>ç›®å½•ä¸‹åº”è¯¥ä¼šæœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>

<pre><code>contivk8s  github-release  godep  golint  misspell  modelgen  netcontiv  netctl  netmaster  netplugin
</code></pre>

<p><em>âš ï¸ç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ° æœ‰äº›åŒ…ä¸å­˜åœ¨æˆ–è€…éœ€è¦ç¿»å¢™ä¸‹è½½ã€‚</em></p>

<h2 id="æ‰“åŒ…">æ‰“åŒ…</h2>

<p>æˆ‘ä»¬å°†å…¶æ‰“åŒ…ä¸ºdocker pluginã€‚</p>

<p>Makefileé‡Œç”¨äºåˆ›å»ºplugin rootfsçš„å‘½ä»¤æ˜¯ï¼š</p>

<pre><code class="language-Makefile">host-pluginfs-create:
        @echo dev: creating a docker v2plugin rootfs ...
        sh scripts/v2plugin_rootfs.sh
</code></pre>

<p><strong>v2plugin_rootfs.sh</strong>è¿™ä¸ªè„šæœ¬çš„å†…å®¹ï¼š</p>

<pre><code class="language-Shell">#!/bin/bash
# Script to create the docker v2 plugin
# run this script from contiv/netplugin directory

echo &quot;Creating rootfs for v2plugin &quot;, ${CONTIV_V2PLUGIN_NAME}
cat install/v2plugin/config.template | grep -v &quot;##&quot; &gt; install/v2plugin/config.json
sed -i &quot;s%PluginName%${CONTIV_V2PLUGIN_NAME}%&quot; install/v2plugin/config.json
cp bin/netplugin bin/netmaster bin/netctl install/v2plugin
docker build -t contivrootfs install/v2plugin
id=$(docker create contivrootfs true)
mkdir -p install/v2plugin/rootfs
sudo docker export &quot;${id}&quot; | sudo tar -x -C install/v2plugin/rootfs
docker rm -vf &quot;${id}&quot;
docker rmi contivrootfs
rm install/v2plugin/netplugin install/v2plugin/netmaster install/v2plugin/netctl
</code></pre>

<p>å…ˆæŠŠ<code>$GOPATH/bin</code>ä¸‹ç”Ÿæˆçš„<code>netplugin</code>ã€<code>netmaster</code>ã€<code>netctl</code>ã€<code>netplugin</code>è¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°netpluginæºç çš„binç›®å½•ä¸‹ã€‚</p>

<p>è¿™é‡Œé¢ç”¨è¯­åˆ›å»ºcontivrootfsé•œåƒçš„Dockerfileå†…å®¹ï¼š</p>

<pre><code class="language-Dockerfile"># Docker v2plugin container with OVS / netplugin / netmaster 

FROM alpine:3.5
MAINTAINER Cisco Contiv (http://contiv.github.io/)

RUN mkdir -p /run/docker/plugins /etc/openvswitch /var/run/contiv/log \
    &amp;&amp; echo 'http://dl-cdn.alpinelinux.org/alpine/v3.4/main' &gt;&gt; /etc/apk/repositories \
    &amp;&amp; apk update &amp;&amp; apk add openvswitch=2.5.0-r0 iptables

COPY netplugin netmaster netctl startcontiv.sh /

ENTRYPOINT [&quot;/startcontiv.sh&quot;]
</code></pre>

<p>æ‰§è¡Œ<code>make host-pluginfs-create</code>åˆ›å»ºrootfsã€‚</p>

<p>åˆ›å»ºå‡ºäº†rootfsåï¼Œç„¶åæ‰§è¡Œ</p>

<pre><code class="language-Shell">docker plugin create localhost:5000/contiv/netplugin .
docker push localhost:5000/contiv/netplugin
</code></pre>

<blockquote>
<p>æ³¨ï¼šæˆ‘ä»¬å°†æ’ä»¶pushåˆ°docker registryçš„é•œåƒä»“åº“ä¸­ï¼Œå½“å‰<a href="www.github.com/vmware/harbor">Harbor</a>è¿˜ä¸æ”¯æŒdockeræ’ä»¶çš„pushã€‚</p>
</blockquote>

<p><strong>Install plugin</strong></p>

<p>ä¸‹é¢æ˜¯ç¼–è¯‘å’Œå®‰è£…æˆ‘è‡ªå·±ç”Ÿæˆv2pluginçš„è¿‡ç¨‹ã€‚</p>

<p>ä¿®æ”¹<strong>config.json</strong>æ–‡ä»¶ä¸­çš„<code>plugin_name</code>å­—æ®µçš„å€¼ä¸ºæ’ä»¶çš„åç§°ã€‚</p>

<pre><code class="language-shell">$docker plugin install localhost:5000/contiv/v2plugin 
Plugin &quot;localhost:5000/contiv/v2plugin&quot; is requesting the following privileges:
 - network: [host]
 - mount: [/etc/openvswitch]
 - mount: [/var/log/openvswitch]
 - mount: [/var/run]
 - mount: [/lib/modules]
 - capabilities: [CAP_SYS_ADMIN CAP_NET_ADMIN CAP_SYS_MODULE]
Do you grant the above permissions? [y/N] y
latest: Pulling from contiv/v2plugin
fd87a71d9090: Download complete 
Digest: sha256:b13ad7930f771c9602acf562c2ae147482466f4d94e708692a215935663215a6
Status: Downloaded newer image for localhost:5000/contiv/v2plugin:latest
Installed plugin localhost:5000/contiv/v2plugin
</code></pre>

<p>è‡ªå·±createçš„æ’ä»¶enableçš„æ—¶å€™ä»docker daemonçš„æ—¥å¿—ä¸­ä¾ç„¶å¯ä»¥çœ‹åˆ°ä¹‹å‰çœ‹åˆ°æ‰¾ä¸åˆ°socketçš„é”™è¯¯ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®æ˜¯æ²¡æœ‰ç”Ÿæˆã€‚å¦‚æœç›´æ¥ä½¿ç”¨<code>docker plugin install store/contiv/v2plugin:1.0.0-beta.3</code>çš„æ–¹å¼å®‰è£…æ’ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>

<h2 id="docker17-03-ceä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜">Docker17.03-CEä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜</h2>

<p>Docker17.03çš„æ’ä»¶æœºåˆ¶æ˜¯ä¸ºäº†dockerå…¬å¸çš„å•†ä¸šåŒ–ç­–ç•¥è€Œå®è¡Œçš„ï¼Œæ‰€æœ‰çš„dockeræ’ä»¶éƒ½è¿è¡Œåœ¨è‡ªå·±çš„namespaceå’Œrootfsä¸­ï¼Œæ’ä»¶æ¥å£</p>

<p><strong>Plugin backendæ¥å£</strong></p>

<pre><code class="language-Go">// Backend for Plugin
type Backend interface {
	Disable(name string, config *enginetypes.PluginDisableConfig) error
	Enable(name string, config *enginetypes.PluginEnableConfig) error
	List(filters.Args) ([]enginetypes.Plugin, error)
	Inspect(name string) (*enginetypes.Plugin, error)
	Remove(name string, config *enginetypes.PluginRmConfig) error
	Set(name string, args []string) error
	Privileges(ctx context.Context, ref reference.Named, metaHeaders http.Header, authConfig *enginetypes.AuthConfig) (enginetypes.PluginPrivileges, error)
	Pull(ctx context.Context, ref reference.Named, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, privileges enginetypes.PluginPrivileges, outStream io.Writer) error
	Push(ctx context.Context, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, outStream io.Writer) error
	Upgrade(ctx context.Context, ref reference.Named, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, privileges enginetypes.PluginPrivileges, outStream io.Writer) error
	CreateFromContext(ctx context.Context, tarCtx io.ReadCloser, options *enginetypes.PluginCreateOptions) error
}
</code></pre>

<p>ä»Pluginçš„åç«¯æ¥å£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰åƒé•œåƒä¸€æ ·çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š</p>

<ul>
<li>æ²¡æœ‰ä¿®æ”¹pluginåå­—çš„æ–¹æ³•ï¼Œå› ä¸ºæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ— æ³•push pluginåˆ°è‡ªå·±çš„é•œåƒä»“åº“ï¼Œå¦å¤–<strong>Harbor</strong>è¿˜æ˜¯ä¸æ”¯æŒ<code>docker plugin push</code> <a href="https://github.com/vmware/harbor/issues/1532">Issue-1532</a>ã€‚</li>
<li>æ²¡æœ‰å¯¼å‡ºpluginçš„æ–¹æ³•ï¼Œè¿™æ ·å°±åªèƒ½åœ¨è”ç½‘çš„ä¸»æœºä¸Šå®‰è£…docker pluginäº†ï¼Œå¯¹äºæ— æ³•è”ç½‘çš„ä¸»æœºåªå¥½æŸæ‰‹æ— ç­–äº†ã€‚</li>
</ul>

<p>ä¼°è®¡dockerå®˜æ–¹ä¹Ÿä¸ä¼šå¼€æ”¾è¿™ä¸¤ä¸ªæ¥å£å§ã€‚æ¯•ç«Ÿè¿™æ˜¯<strong>Docker EE</strong> çš„ä¸€ä¸ªé‡è¦å–ç‚¹ï¼š</p>

<blockquote>
<p><strong>Docker EE&rsquo;s Certified Plugins</strong> provide networking and volume plugins and easy to download and install containers to the Docker EE environment.</p>
</blockquote>

<h2 id="ç–‘é—®">ç–‘é—®</h2>

<p><strong>ä¸ºä»€ä¹ˆä¸€å®šè¦ä½¿ç”¨docker plugin install</strong></p>

<p>å› ä¸º<code>docker plugin install</code>çš„æ—¶å€™ä¼šç”³è¯·ä¸€äº›è®¿é—®æƒé™ã€‚</p>

<p>è¿™ä¸€å—åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­å¯ä»¥çœ‹åˆ°ã€‚</p>

<p><strong>ä¸ºä»€ä¹ˆdocker pluginä¸èƒ½æ”¹åå­—ï¼Ÿ</strong></p>

<p>æˆ‘ä»¬çœ‹ä¸‹Pluginçš„ç»“æ„ä½“ï¼ˆåœ¨api/types/plugin.goä¸­å®šä¹‰ï¼‰ï¼š</p>

<pre><code class="language-go">// Plugin A plugin for the Engine API
// swagger:model Plugin
type Plugin struct {

	// config
	// Required: true
	Config PluginConfig `json:&quot;Config&quot;`

	// True when the plugin is running. False when the plugin is not running, only installed.
	// Required: true
	Enabled bool `json:&quot;Enabled&quot;`

	// Id
	ID string `json:&quot;Id,omitempty&quot;`

	// name
	// Required: true
	Name string `json:&quot;Name&quot;`

	// plugin remote reference used to push/pull the plugin
	PluginReference string `json:&quot;PluginReference,omitempty&quot;`

	// settings
	// Required: true
	Settings PluginSettings `json:&quot;Settings&quot;`
}
</code></pre>

<p>æ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª<code>PluginReference</code>ç»“æ„ä½“ï¼Œå®ƒçš„æ–¹æ³•æœ‰ï¼š</p>

<pre><code class="language-Go">type pluginReference struct {
	name     reference.Named
	pluginID digest.Digest
}

func (r *pluginReference) References(id digest.Digest) []reference.Named {
	if r.pluginID != id {
		return nil
	}
	return []reference.Named{r.name}
}

func (r *pluginReference) ReferencesByName(ref reference.Named) []refstore.Association {
	return []refstore.Association{
		{
			Ref: r.name,
			ID:  r.pluginID,
		},
	}
}

func (r *pluginReference) Get(ref reference.Named) (digest.Digest, error) {
	if r.name.String() != ref.String() {
		return digest.Digest(&quot;&quot;), refstore.ErrDoesNotExist
	}
	return r.pluginID, nil
}

func (r *pluginReference) AddTag(ref reference.Named, id digest.Digest, force bool) error {
	// Read only, ignore
	return nil
}
func (r *pluginReference) AddDigest(ref reference.Canonical, id digest.Digest, force bool) error {
	// Read only, ignore
	return nil
}
func (r *pluginReference) Delete(ref reference.Named) (bool, error) {
	// Read only, ignore
	return false, nil
}
</code></pre>

<p>æ³¨æ„å…¶ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•<code>AddTag</code>ã€<code>AddDigest</code>ã€<code>Delete</code>æ–¹æ³•éƒ½æ˜¯åªè¯»çš„ã€‚åœ¨<code>migrate/v1/migratev1.go</code>ä¸­æœ‰å¼•ç”¨åˆ°äº†è¿™ä¸ªã€‚</p>

<p>å†çœ‹ä¸‹<strong>Reference</strong>çš„çš„å®šä¹‰ï¼ˆvendor/github.com/docker/distribution/reference/reference.goï¼‰</p>

<pre><code class="language-Go">// Package reference provides a general type to represent any way of referencing images within the registry.
// Its main purpose is to abstract tags and digests (content-addressable hash).
//
// Grammar
//
// 	reference                       := name [ &quot;:&quot; tag ] [ &quot;@&quot; digest ]
//	name                            := [domain '/'] path-component ['/' path-component]*
//	domain                          := domain-component ['.' domain-component]* [':' port-number]
//	domain-component                := /([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])/
//	port-number                     := /[0-9]+/
//	path-component                  := alpha-numeric [separator alpha-numeric]*
// 	alpha-numeric                   := /[a-z0-9]+/
//	separator                       := /[_.]|__|[-]*/
//
//	tag                             := /[\w][\w.-]{0,127}/
//
//	digest                          := digest-algorithm &quot;:&quot; digest-hex
//	digest-algorithm                := digest-algorithm-component [ digest-algorithm-separator digest-algorithm-component ]
//	digest-algorithm-separator      := /[+.-_]/
//	digest-algorithm-component      := /[A-Za-z][A-Za-z0-9]*/
//	digest-hex                      := /[0-9a-fA-F]{32,}/ ; At least 128 bit digest value
//
//	identifier                      := /[a-f0-9]{64}/
//	short-identifier                := /[a-f0-9]{6,64}/
// Reference is an opaque object reference identifier that may include
// modifiers such as a hostname, name, tag, and digest.
</code></pre>

<p>ä¿®æ”¹pluginçš„åå­—çš„æ–¹æ³•æ˜¯ä¸æ˜¯è¿˜æ²¡å®ç°ï¼Ÿ</p>

        </article>
  </div>
</section>



<aside id="meta">

    <div>
        <section id="datecount">
          <h4 id="date"> Fri Mar 17, 2017 </h4>
          <h5 id="wc"> 800 Words </h5>
          <h5 id="readtime"> Read in about 4 Min </h5>
        </section>
        <ul id="categories">
          
        </ul>
        <ul id="tags">
          
            <li> <a href="http://rootsongjc.github.io//tags/docker">docker</a> </li>
          
            <li> <a href="http://rootsongjc.github.io//tags/docker-plugin">docker plugin</a> </li>
          
            <li> <a href="http://rootsongjc.github.io//tags/network">network</a> </li>
          
            <li> <a href="http://rootsongjc.github.io//tags/cisco">cisco</a> </li>
          
        </ul>
    </div>

    <div>
        <section id="prev">
            &nbsp;
        </section><section id="next">
            &nbsp;<a class="next" href="http://rootsongjc.github.io/blogs/docker-plugin-develop/">Docker17.03-CEæ’ä»¶å¼€å‘-ä¸¾ä¸ªğŸŒ° <i class="icon-arrow-right"></i></a>
        </section>
    </div>

    <div>
        <section id="author">
             <h4>About the Author:</h4>
            <p>
            <a href="http://rootsongjc.github.io/about/">Jimmy Song</a> is a software engineer living in Beijing, he usually likes to hack open source software, traveling and photographing. He is familiar with Java, python, golang, PAAS, hadoop and docker ecosystem. He took photos particularly sticky,<a href=https://tuchong.com/1425795/>Jimmy's tuchong homepage</a>.
            He has recently been keen on micro-service, DevOps and software architecture research.
            </p>
        </section>

</div>

</aside>

<meta itemprop="wordCount" content="743">
<meta itemprop="datePublished" content="2017-03-17">
<meta itemprop="url" content="http://rootsongjc.github.io/blogs/contiv-ultimate/">


<aside id=comments>
    <div><h2> Comments </h2></div>
    
    <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2126256"></script>
    
</aside>

<footer>
  <div>
    <p>
    &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span></span>
    Powered by <a href="http://gohugo.io">Hugo</a>.
    </p>
  </div>
</footer>
</body>
</html>

