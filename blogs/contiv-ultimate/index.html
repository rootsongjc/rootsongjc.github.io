<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="baidu-site-verification" content="g8IYR9SNLF" />
    <meta name="uyan_auth" content="419f63884b" /> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="docker, docker plugin, network, cisco, contiv, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Contiv Ultimate-Docker17.03CEä¸‹æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆ : jimmysong.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="https://jimmysong.io/blogs/contiv-ultimate/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-03-17"/>
<meta property="article:modified_time" content="2017-03-17"/>



<meta property="article:tag" content="docker">
<meta property="article:tag" content="docker plugin">
<meta property="article:tag" content="network">
<meta property="article:tag" content="cisco">
<meta property="article:tag" content="contiv">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Contiv Ultimate-Docker17.03CEä¸‹æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆ : jimmysong.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="jimmysong.io">

    <base href="https://jimmysong.io/">
    <title> Contiv Ultimate-Docker17.03CEä¸‹æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆ - jimmysong.io focus on Cloud Native & Big Data </title>
    <link rel="canonical" href="https://jimmysong.io/blogs/contiv-ultimate/"> <link rel="stylesheet" href="https://jimmysong.io/static/css/style.css">




<link rel="stylesheet" href="/static/css/syntax.css">


<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>





    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
</head>


<body lang="en" itemscope itemtype="http://schema.org/Article">
    <header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
    <ul id="mainnav">
    <li>
        <a href="/blogs/">
            <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
            <span> blogs </span>
        </a>
    </li>
    <li>
        <a href="/projects/">
            <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
            <span> projects </span>
        </a>
    </li>
    <li>
        <a href="/talks/">
            <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
            <span> talks </span>
        </a>
    </li>
    <li>
        <a href="http://www.linkedin.com/in/rootsongjc">
            <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
            <span> me </span>
        </a>
    </li>
</ul>
    <ul id="social">
    <li id="share">
        <span class="icon icon-bubbles"> </span>
        <span class="title"> share </span>
        <div class="dropdown share">
            <ul class="social">
                <li> <a href="https://twitter.com/intent/tweet?status=Contiv%20Ultimate-Docker17.03CE%e4%b8%8b%e6%80%9d%e7%a7%91docker%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6contiv%e8%b6%9f%e5%9d%91%e7%bb%88%e6%9e%81%e7%89%88-https%3a%2f%2fjimmysong.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjimmysong.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="https://plus.google.com/share?url=https%3a%2f%2fjimmysong.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fjimmysong.io%2fblogs%2fcontiv-ultimate%2f&title=Contiv%20Ultimate-Docker17.03CE%e4%b8%8b%e6%80%9d%e7%a7%91docker%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6contiv%e8%b6%9f%e5%9d%91%e7%bb%88%e6%9e%81%e7%89%88&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://del.icio.us/post?url=https%3a%2f%2fjimmysong.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                <li> <a href="http://www.reddit.com/submit?url=https%3a%2f%2fjimmysong.io%2fblogs%2fcontiv-ultimate%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
            </ul>
            <span class="subcount">sharing is caring</span>
        </div>
    </li>
    <li id="follow">
        <span class="icon icon-rocket"> </span>
        <span class="title"> follow </span>
        <div class="dropdown follow">
            <ul class="social">
                <li> <a href="http://www.twitter.com/jimmysongio" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="http://www.facebook.com/jimmysongio" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="http://www.linkedin.com/in/jimmysongio" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="è±†ç“£" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                <li> <a href="https://jimmysongio.tuchong.com/" target="_blank" title="å›¾è™«" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>
            </ul>
            <span class="subcount">join 10k+ subscribers &amp; followers</span>
        </div>
    </li>
</ul>

    </nav>
</header>
 

    <section id="main">
        <h1 itemprop="name" id="title">Contiv Ultimate-Docker17.03CEä¸‹æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆ</h1>
        <div>
            <article itemprop="articleBody" id="content">
                

<p><img src="http://olz1di9xf.bkt.clouddn.com/20140810001.jpg" alt="å¹¿å·çŸ³ç‰Œæ¡¥" /></p>

<p><em>ï¼ˆé¢˜å›¾ï¼šå¹¿å·çŸ³ç‰Œæ¡¥ Aug 10,2014ï¼‰</em></p>

<p>å‰å‡ å¤©å†™çš„å‡ ç¯‡<a href="http://rootsongjc.github.io/tags/contiv/">å…³äºContivçš„æ–‡ç« </a>å·²ç»æŠŠå¼•å…¥å‘äº†ğŸ˜‚</p>

<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« å°†å¸¦é¢†å¤§å®¶ç”¨æ­£ç¡®çš„å§¿åŠ¿ç¼–è¯‘å’Œæ‰“åŒ…ä¸€ä¸ª<strong>contiv netplugin</strong>ã€‚</p>

<blockquote>
<p>è¯·ä¸€å®šè¦åœ¨<strong>Linux</strong>ç¯å¢ƒä¸­ç¼–è¯‘ã€‚dockerä¸­ç¼–è¯‘ä¹Ÿä¼šæŠ¥é”™ï¼Œæœ€å¥½è¿˜æ˜¯æä¸ªè™šæ‹ŸğŸ”å§ï¼Œæœ€å¥½è¿˜æœ‰VPNèƒ½ç¿»å¢™ã€‚</p>
</blockquote>

<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h2>

<p>æˆ‘ä½¿ç”¨çš„æ˜¯docker17.03-CEã€å®‰è£…äº†open vSwitch(è¿™ä¸ªåŒ…redhatçš„æºé‡Œæ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±çš„ç¼–è¯‘å®‰è£…)ï¼Œå¦‚æœä½ æ‡’å¾—ç¼–è¯‘å¯ä»¥ç”¨æˆ‘ç¼–è¯‘çš„rpmåŒ…ï¼Œ<a href="http://olz1di9xf.bkt.clouddn.com/openvswitch-2.5.0-2.el7.x86_64.rpm">ç‚¹è¿™é‡Œä¸‹è½½</a>ã€‚</p>

<h2 id="ç¼–è¯‘">ç¼–è¯‘</h2>

<p>è¿™ä¸€æ­¥æ˜¯å¾ˆå®¹æ˜“å¤±è´¥çš„ï¼Œæœ‰äººæè¿‡<a href="https://github.com/contiv/netplugin/issues/779">issue-779</a></p>

<p><strong>å…·ä½“æ­¥éª¤</strong></p>

<ul>
<li>åˆ›å»ºä¸€ä¸ªlink <strong>/go</strong>é“¾æ¥åˆ°ä½ çš„GOPATHç›®å½•ï¼Œä¸‹é¢ç¼–è¯‘çš„æ—¶å€™è¦ç”¨ã€‚</li>
<li>å°†æºç çš„<strong>vender</strong>ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°$GOPATH/srcç›®å½•ã€‚</li>
<li>æ‰§è¡Œç¼–è¯‘</li>
</ul>

<p>åœ¨netpluginç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤èƒ½å¤Ÿç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>

<pre><code>NET_CONTAINER_BUILD=1 make build
</code></pre>

<p>åœ¨ä½ çš„<strong>/$GOPATH/bin</strong>ç›®å½•ä¸‹åº”è¯¥ä¼šæœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>

<pre><code>contivk8s  github-release  godep  golint  misspell  modelgen  netcontiv  netctl  netmaster  netplugin
</code></pre>

<p><em>âš ï¸ç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ° æœ‰äº›åŒ…ä¸å­˜åœ¨æˆ–è€…éœ€è¦ç¿»å¢™ä¸‹è½½ã€‚</em></p>

<h2 id="æ‰“åŒ…">æ‰“åŒ…</h2>

<p>æˆ‘ä»¬å°†å…¶æ‰“åŒ…ä¸ºdocker pluginã€‚</p>

<p>Makefileé‡Œç”¨äºåˆ›å»ºplugin rootfsçš„å‘½ä»¤æ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Makefile" data-lang="Makefile"><span class="">host-pluginfs-create:
</span><span class="">        @echo dev: creating a docker v2plugin rootfs ...
</span><span class="">        sh scripts/v2plugin_rootfs.sh</span></code></pre>
</div>
<p><strong>v2plugin_rootfs.sh</strong>è¿™ä¸ªè„šæœ¬çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="ch">#!/bin/bash
</span><span class="ch"></span><span class="c1"># Script to create the docker v2 plugin
</span><span class="c1"># run this script from contiv/netplugin directory
</span><span class="c1"></span><span class="">
</span><span class=""></span><span class="nb">echo</span><span class=""> </span><span class="s2">&#34;Creating rootfs for v2plugin &#34;</span><span class="">, </span><span class="si">${</span><span class="nv">CONTIV_V2PLUGIN_NAME</span><span class="si">}</span><span class="">
</span><span class="">cat install/v2plugin/config.template </span><span class="p">|</span><span class=""> grep -v </span><span class="s2">&#34;##&#34;</span><span class=""> &gt; install/v2plugin/config.json
</span><span class="">sed -i </span><span class="s2">&#34;s%PluginName%</span><span class="si">${</span><span class="nv">CONTIV_V2PLUGIN_NAME</span><span class="si">}</span><span class="s2">%&#34;</span><span class=""> install/v2plugin/config.json
</span><span class="">cp bin/netplugin bin/netmaster bin/netctl install/v2plugin
</span><span class="">docker build -t contivrootfs install/v2plugin
</span><span class=""></span><span class="nv">id</span><span class=""></span><span class="o">=</span><span class="k">$(</span><span class="">docker create contivrootfs </span><span class="nb">true</span><span class="k">)</span><span class="">
</span><span class="">mkdir -p install/v2plugin/rootfs
</span><span class="">sudo docker </span><span class="nb">export</span><span class=""> </span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">&#34;</span><span class=""> </span><span class="p">|</span><span class=""> sudo tar -x -C install/v2plugin/rootfs
</span><span class="">docker rm -vf </span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">&#34;</span><span class="">
</span><span class="">docker rmi contivrootfs
</span><span class="">rm install/v2plugin/netplugin install/v2plugin/netmaster install/v2plugin/netctl</span></code></pre>
</div>
<p>å…ˆæŠŠ<code>$GOPATH/bin</code>ä¸‹ç”Ÿæˆçš„<code>netplugin</code>ã€<code>netmaster</code>ã€<code>netctl</code>ã€<code>netplugin</code>è¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°netpluginæºç çš„binç›®å½•ä¸‹ã€‚</p>

<p>è¿™é‡Œé¢ç”¨è¯­åˆ›å»ºcontivrootfsé•œåƒçš„Dockerfileå†…å®¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class=""># Docker v2plugin container with OVS / netplugin / netmaster 
</span><span class="">
</span><span class="">FROM alpine:3.5
</span><span class="">MAINTAINER Cisco Contiv (http://contiv.github.io/)
</span><span class="">
</span><span class="">RUN mkdir -p /run/docker/plugins /etc/openvswitch /var/run/contiv/log \
</span><span class="">    &amp;&amp; echo &#39;http://dl-cdn.alpinelinux.org/alpine/v3.4/main&#39; &gt;&gt; /etc/apk/repositories \
</span><span class="">    &amp;&amp; apk update &amp;&amp; apk add openvswitch=2.5.0-r0 iptables
</span><span class="">
</span><span class="">COPY netplugin netmaster netctl startcontiv.sh /
</span><span class="">
</span><span class="">ENTRYPOINT [&#34;/startcontiv.sh&#34;]</span></code></pre>
</div>
<p>æ‰§è¡Œ<code>make host-pluginfs-create</code>åˆ›å»ºrootfsã€‚</p>

<p>åˆ›å»ºå‡ºäº†rootfsåï¼Œç„¶åæ‰§è¡Œ</p>
<div class="highlight"><pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="">docker plugin create localhost:5000/contiv/netplugin .
</span><span class="">docker push localhost:5000/contiv/netplugin</span></code></pre>
</div>
<blockquote>
<p>æ³¨ï¼šæˆ‘ä»¬å°†æ’ä»¶pushåˆ°docker registryçš„é•œåƒä»“åº“ä¸­ï¼Œå½“å‰<a href="www.github.com/vmware/harbor">Harbor</a>è¿˜ä¸æ”¯æŒdockeræ’ä»¶çš„pushã€‚</p>
</blockquote>

<p><strong>Install plugin</strong></p>

<p>ä¸‹é¢æ˜¯ç¼–è¯‘å’Œå®‰è£…æˆ‘è‡ªå·±ç”Ÿæˆv2pluginçš„è¿‡ç¨‹ã€‚</p>

<p>ä¿®æ”¹<strong>config.json</strong>æ–‡ä»¶ä¸­çš„<code>plugin_name</code>å­—æ®µçš„å€¼ä¸ºæ’ä»¶çš„åç§°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">$docker</span><span class=""> plugin install localhost:5000/contiv/v2plugin 
</span><span class="">Plugin </span><span class="s2">&#34;localhost:5000/contiv/v2plugin&#34;</span><span class=""> is requesting the following privileges:
</span><span class=""> - network: </span><span class="o">[</span><span class="">host</span><span class="o">]</span><span class="">
</span><span class=""> - mount: </span><span class="o">[</span><span class="">/etc/openvswitch</span><span class="o">]</span><span class="">
</span><span class=""> - mount: </span><span class="o">[</span><span class="">/var/log/openvswitch</span><span class="o">]</span><span class="">
</span><span class=""> - mount: </span><span class="o">[</span><span class="">/var/run</span><span class="o">]</span><span class="">
</span><span class=""> - mount: </span><span class="o">[</span><span class="">/lib/modules</span><span class="o">]</span><span class="">
</span><span class=""> - capabilities: </span><span class="o">[</span><span class="">CAP_SYS_ADMIN CAP_NET_ADMIN CAP_SYS_MODULE</span><span class="o">]</span><span class="">
</span><span class="">Do you grant the above permissions? </span><span class="o">[</span><span class="">y/N</span><span class="o">]</span><span class=""> y
</span><span class="">latest: Pulling from contiv/v2plugin
</span><span class="">fd87a71d9090: Download </span><span class="nb">complete</span><span class=""> 
</span><span class="">Digest: sha256:b13ad7930f771c9602acf562c2ae147482466f4d94e708692a215935663215a6
</span><span class="">Status: Downloaded newer image </span><span class="k">for</span><span class=""> localhost:5000/contiv/v2plugin:latest
</span><span class="">Installed plugin localhost:5000/contiv/v2plugin</span></code></pre>
</div>
<p>è‡ªå·±createçš„æ’ä»¶enableçš„æ—¶å€™ä»docker daemonçš„æ—¥å¿—ä¸­ä¾ç„¶å¯ä»¥çœ‹åˆ°ä¹‹å‰çœ‹åˆ°æ‰¾ä¸åˆ°socketçš„é”™è¯¯ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®æ˜¯æ²¡æœ‰ç”Ÿæˆã€‚å¦‚æœç›´æ¥ä½¿ç”¨<code>docker plugin install store/contiv/v2plugin:1.0.0-beta.3</code>çš„æ–¹å¼å®‰è£…æ’ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>

<h2 id="docker17-03-ceä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜">Docker17.03-CEä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜</h2>

<p>Docker17.03çš„æ’ä»¶æœºåˆ¶æ˜¯ä¸ºäº†dockerå…¬å¸çš„å•†ä¸šåŒ–ç­–ç•¥è€Œå®è¡Œçš„ï¼Œæ‰€æœ‰çš„dockeræ’ä»¶éƒ½è¿è¡Œåœ¨è‡ªå·±çš„namespaceå’Œrootfsä¸­ï¼Œæ’ä»¶æ¥å£</p>

<p><strong>Plugin backendæ¥å£</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-Go" data-lang="Go"><span class="c1">// Backend for Plugin
</span><span class="c1"></span><span class="kd">type</span><span class=""> </span><span class="nx">Backend</span><span class=""> </span><span class="kd">interface</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="nx">Disable</span><span class="p">(</span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">config</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginDisableConfig</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">Enable</span><span class="p">(</span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">config</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginEnableConfig</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">List</span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span><span class=""> </span><span class="p">([]</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">,</span><span class=""> </span><span class="kt">error</span><span class="p">)</span><span class="">
</span><span class="">	</span><span class="nx">Inspect</span><span class="p">(</span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">)</span><span class=""> </span><span class="p">(</span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">,</span><span class=""> </span><span class="kt">error</span><span class="p">)</span><span class="">
</span><span class="">	</span><span class="nx">Remove</span><span class="p">(</span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">config</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginRmConfig</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">Set</span><span class="p">(</span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">args</span><span class=""> </span><span class="p">[]</span><span class="kt">string</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">Privileges</span><span class="p">(</span><span class="nx">ctx</span><span class=""> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class=""> </span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">,</span><span class=""> </span><span class="nx">metaHeaders</span><span class=""> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Header</span><span class="p">,</span><span class=""> </span><span class="nx">authConfig</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">AuthConfig</span><span class="p">)</span><span class=""> </span><span class="p">(</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginPrivileges</span><span class="p">,</span><span class=""> </span><span class="kt">error</span><span class="p">)</span><span class="">
</span><span class="">	</span><span class="nx">Pull</span><span class="p">(</span><span class="nx">ctx</span><span class=""> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class=""> </span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">,</span><span class=""> </span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">metaHeaders</span><span class=""> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Header</span><span class="p">,</span><span class=""> </span><span class="nx">authConfig</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">AuthConfig</span><span class="p">,</span><span class=""> </span><span class="nx">privileges</span><span class=""> </span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginPrivileges</span><span class="p">,</span><span class=""> </span><span class="nx">outStream</span><span class=""> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">Push</span><span class="p">(</span><span class="nx">ctx</span><span class=""> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class=""> </span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">metaHeaders</span><span class=""> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Header</span><span class="p">,</span><span class=""> </span><span class="nx">authConfig</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">AuthConfig</span><span class="p">,</span><span class=""> </span><span class="nx">outStream</span><span class=""> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">Upgrade</span><span class="p">(</span><span class="nx">ctx</span><span class=""> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class=""> </span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">,</span><span class=""> </span><span class="nx">name</span><span class=""> </span><span class="kt">string</span><span class="p">,</span><span class=""> </span><span class="nx">metaHeaders</span><span class=""> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Header</span><span class="p">,</span><span class=""> </span><span class="nx">authConfig</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">AuthConfig</span><span class="p">,</span><span class=""> </span><span class="nx">privileges</span><span class=""> </span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginPrivileges</span><span class="p">,</span><span class=""> </span><span class="nx">outStream</span><span class=""> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class="">	</span><span class="nx">CreateFromContext</span><span class="p">(</span><span class="nx">ctx</span><span class=""> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class=""> </span><span class="nx">tarCtx</span><span class=""> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadCloser</span><span class="p">,</span><span class=""> </span><span class="nx">options</span><span class=""> </span><span class="o">*</span><span class="nx">enginetypes</span><span class="p">.</span><span class="nx">PluginCreateOptions</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class="">
</span><span class=""></span><span class="p">}</span></code></pre>
</div>
<p>ä»Pluginçš„åç«¯æ¥å£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰åƒé•œåƒä¸€æ ·çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š</p>

<ul>
<li>æ²¡æœ‰ä¿®æ”¹pluginåå­—çš„æ–¹æ³•ï¼Œå› ä¸ºæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ— æ³•push pluginåˆ°è‡ªå·±çš„é•œåƒä»“åº“ï¼Œå¦å¤–<strong>Harbor</strong>è¿˜æ˜¯ä¸æ”¯æŒ<code>docker plugin push</code> <a href="https://github.com/vmware/harbor/issues/1532">Issue-1532</a>ã€‚</li>
<li>æ²¡æœ‰å¯¼å‡ºpluginçš„æ–¹æ³•ï¼Œè¿™æ ·å°±åªèƒ½åœ¨è”ç½‘çš„ä¸»æœºä¸Šå®‰è£…docker pluginäº†ï¼Œå¯¹äºæ— æ³•è”ç½‘çš„ä¸»æœºåªå¥½æŸæ‰‹æ— ç­–äº†ã€‚</li>
</ul>

<p>ä¼°è®¡dockerå®˜æ–¹ä¹Ÿä¸ä¼šå¼€æ”¾è¿™ä¸¤ä¸ªæ¥å£å§ã€‚æ¯•ç«Ÿè¿™æ˜¯<strong>Docker EE</strong> çš„ä¸€ä¸ªé‡è¦å–ç‚¹ï¼š</p>

<blockquote>
<p><strong>Docker EE&rsquo;s Certified Plugins</strong> provide networking and volume plugins and easy to download and install containers to the Docker EE environment.</p>
</blockquote>

<h2 id="ç–‘é—®">ç–‘é—®</h2>

<p><strong>ä¸ºä»€ä¹ˆä¸€å®šè¦ä½¿ç”¨docker plugin install</strong></p>

<p>å› ä¸º<code>docker plugin install</code>çš„æ—¶å€™ä¼šç”³è¯·ä¸€äº›è®¿é—®æƒé™ã€‚</p>

<p>è¿™ä¸€å—åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­å¯ä»¥çœ‹åˆ°ã€‚</p>

<p><strong>ä¸ºä»€ä¹ˆdocker pluginä¸èƒ½æ”¹åå­—ï¼Ÿ</strong></p>

<p>æˆ‘ä»¬çœ‹ä¸‹Pluginçš„ç»“æ„ä½“ï¼ˆåœ¨api/types/plugin.goä¸­å®šä¹‰ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Plugin A plugin for the Engine API
</span><span class="c1">// swagger:model Plugin
</span><span class="c1"></span><span class="kd">type</span><span class=""> </span><span class="nx">Plugin</span><span class=""> </span><span class="kd">struct</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">
</span><span class="">	</span><span class="c1">// config
</span><span class="c1"></span><span class="">	</span><span class="c1">// Required: true
</span><span class="c1"></span><span class="">	</span><span class="nx">Config</span><span class=""> </span><span class="nx">PluginConfig</span><span class=""> </span><span class="s">`json:&#34;Config&#34;`</span><span class="">
</span><span class="">
</span><span class="">	</span><span class="c1">// True when the plugin is running. False when the plugin is not running, only installed.
</span><span class="c1"></span><span class="">	</span><span class="c1">// Required: true
</span><span class="c1"></span><span class="">	</span><span class="nx">Enabled</span><span class=""> </span><span class="kt">bool</span><span class=""> </span><span class="s">`json:&#34;Enabled&#34;`</span><span class="">
</span><span class="">
</span><span class="">	</span><span class="c1">// Id
</span><span class="c1"></span><span class="">	</span><span class="nx">ID</span><span class=""> </span><span class="kt">string</span><span class=""> </span><span class="s">`json:&#34;Id,omitempty&#34;`</span><span class="">
</span><span class="">
</span><span class="">	</span><span class="c1">// name
</span><span class="c1"></span><span class="">	</span><span class="c1">// Required: true
</span><span class="c1"></span><span class="">	</span><span class="nx">Name</span><span class=""> </span><span class="kt">string</span><span class=""> </span><span class="s">`json:&#34;Name&#34;`</span><span class="">
</span><span class="">
</span><span class="">	</span><span class="c1">// plugin remote reference used to push/pull the plugin
</span><span class="c1"></span><span class="">	</span><span class="nx">PluginReference</span><span class=""> </span><span class="kt">string</span><span class=""> </span><span class="s">`json:&#34;PluginReference,omitempty&#34;`</span><span class="">
</span><span class="">
</span><span class="">	</span><span class="c1">// settings
</span><span class="c1"></span><span class="">	</span><span class="c1">// Required: true
</span><span class="c1"></span><span class="">	</span><span class="nx">Settings</span><span class=""> </span><span class="nx">PluginSettings</span><span class=""> </span><span class="s">`json:&#34;Settings&#34;`</span><span class="">
</span><span class=""></span><span class="p">}</span></code></pre>
</div>
<p>æ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª<code>PluginReference</code>ç»“æ„ä½“ï¼Œå®ƒçš„æ–¹æ³•æœ‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Go" data-lang="Go"><span class="kd">type</span><span class=""> </span><span class="nx">pluginReference</span><span class=""> </span><span class="kd">struct</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="nx">name</span><span class="">     </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="">
</span><span class="">	</span><span class="nx">pluginID</span><span class=""> </span><span class="nx">digest</span><span class="p">.</span><span class="nx">Digest</span><span class="">
</span><span class=""></span><span class="p">}</span><span class="">
</span><span class="">
</span><span class=""></span><span class="kd">func</span><span class=""> </span><span class="p">(</span><span class="nx">r</span><span class=""> </span><span class="o">*</span><span class="nx">pluginReference</span><span class="p">)</span><span class=""> </span><span class="nx">References</span><span class="p">(</span><span class="nx">id</span><span class=""> </span><span class="nx">digest</span><span class="p">.</span><span class="nx">Digest</span><span class="p">)</span><span class=""> </span><span class="p">[]</span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="k">if</span><span class=""> </span><span class="nx">r</span><span class="p">.</span><span class="nx">pluginID</span><span class=""> </span><span class="o">!=</span><span class=""> </span><span class="nx">id</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">		</span><span class="k">return</span><span class=""> </span><span class="kc">nil</span><span class="">
</span><span class="">	</span><span class="p">}</span><span class="">
</span><span class="">	</span><span class="k">return</span><span class=""> </span><span class="p">[]</span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">{</span><span class="nx">r</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="">
</span><span class=""></span><span class="p">}</span><span class="">
</span><span class="">
</span><span class=""></span><span class="kd">func</span><span class=""> </span><span class="p">(</span><span class="nx">r</span><span class=""> </span><span class="o">*</span><span class="nx">pluginReference</span><span class="p">)</span><span class=""> </span><span class="nx">ReferencesByName</span><span class="p">(</span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">)</span><span class=""> </span><span class="p">[]</span><span class="nx">refstore</span><span class="p">.</span><span class="nx">Association</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="k">return</span><span class=""> </span><span class="p">[]</span><span class="nx">refstore</span><span class="p">.</span><span class="nx">Association</span><span class="p">{</span><span class="">
</span><span class="">		</span><span class="p">{</span><span class="">
</span><span class="">			</span><span class="nx">Ref</span><span class="p">:</span><span class=""> </span><span class="nx">r</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="">
</span><span class="">			</span><span class="nx">ID</span><span class="p">:</span><span class="">  </span><span class="nx">r</span><span class="p">.</span><span class="nx">pluginID</span><span class="p">,</span><span class="">
</span><span class="">		</span><span class="p">},</span><span class="">
</span><span class="">	</span><span class="p">}</span><span class="">
</span><span class=""></span><span class="p">}</span><span class="">
</span><span class="">
</span><span class=""></span><span class="kd">func</span><span class=""> </span><span class="p">(</span><span class="nx">r</span><span class=""> </span><span class="o">*</span><span class="nx">pluginReference</span><span class="p">)</span><span class=""> </span><span class="nx">Get</span><span class="p">(</span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">)</span><span class=""> </span><span class="p">(</span><span class="nx">digest</span><span class="p">.</span><span class="nx">Digest</span><span class="p">,</span><span class=""> </span><span class="kt">error</span><span class="p">)</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="k">if</span><span class=""> </span><span class="nx">r</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span><span class=""> </span><span class="o">!=</span><span class=""> </span><span class="nx">ref</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">		</span><span class="k">return</span><span class=""> </span><span class="nx">digest</span><span class="p">.</span><span class="nx">Digest</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">),</span><span class=""> </span><span class="nx">refstore</span><span class="p">.</span><span class="nx">ErrDoesNotExist</span><span class="">
</span><span class="">	</span><span class="p">}</span><span class="">
</span><span class="">	</span><span class="k">return</span><span class=""> </span><span class="nx">r</span><span class="p">.</span><span class="nx">pluginID</span><span class="p">,</span><span class=""> </span><span class="kc">nil</span><span class="">
</span><span class=""></span><span class="p">}</span><span class="">
</span><span class="">
</span><span class=""></span><span class="kd">func</span><span class=""> </span><span class="p">(</span><span class="nx">r</span><span class=""> </span><span class="o">*</span><span class="nx">pluginReference</span><span class="p">)</span><span class=""> </span><span class="nx">AddTag</span><span class="p">(</span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">,</span><span class=""> </span><span class="nx">id</span><span class=""> </span><span class="nx">digest</span><span class="p">.</span><span class="nx">Digest</span><span class="p">,</span><span class=""> </span><span class="nx">force</span><span class=""> </span><span class="kt">bool</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="c1">// Read only, ignore
</span><span class="c1"></span><span class="">	</span><span class="k">return</span><span class=""> </span><span class="kc">nil</span><span class="">
</span><span class=""></span><span class="p">}</span><span class="">
</span><span class=""></span><span class="kd">func</span><span class=""> </span><span class="p">(</span><span class="nx">r</span><span class=""> </span><span class="o">*</span><span class="nx">pluginReference</span><span class="p">)</span><span class=""> </span><span class="nx">AddDigest</span><span class="p">(</span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Canonical</span><span class="p">,</span><span class=""> </span><span class="nx">id</span><span class=""> </span><span class="nx">digest</span><span class="p">.</span><span class="nx">Digest</span><span class="p">,</span><span class=""> </span><span class="nx">force</span><span class=""> </span><span class="kt">bool</span><span class="p">)</span><span class=""> </span><span class="kt">error</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="c1">// Read only, ignore
</span><span class="c1"></span><span class="">	</span><span class="k">return</span><span class=""> </span><span class="kc">nil</span><span class="">
</span><span class=""></span><span class="p">}</span><span class="">
</span><span class=""></span><span class="kd">func</span><span class=""> </span><span class="p">(</span><span class="nx">r</span><span class=""> </span><span class="o">*</span><span class="nx">pluginReference</span><span class="p">)</span><span class=""> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ref</span><span class=""> </span><span class="nx">reference</span><span class="p">.</span><span class="nx">Named</span><span class="p">)</span><span class=""> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class=""> </span><span class="kt">error</span><span class="p">)</span><span class=""> </span><span class="p">{</span><span class="">
</span><span class="">	</span><span class="c1">// Read only, ignore
</span><span class="c1"></span><span class="">	</span><span class="k">return</span><span class=""> </span><span class="kc">false</span><span class="p">,</span><span class=""> </span><span class="kc">nil</span><span class="">
</span><span class=""></span><span class="p">}</span></code></pre>
</div>
<p>æ³¨æ„å…¶ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•<code>AddTag</code>ã€<code>AddDigest</code>ã€<code>Delete</code>æ–¹æ³•éƒ½æ˜¯åªè¯»çš„ã€‚åœ¨<code>migrate/v1/migratev1.go</code>ä¸­æœ‰å¼•ç”¨åˆ°äº†è¿™ä¸ªã€‚</p>

<p>å†çœ‹ä¸‹<strong>Reference</strong>çš„çš„å®šä¹‰ï¼ˆvendor/github.com/docker/distribution/reference/reference.goï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-Go" data-lang="Go"><span class="c1">// Package reference provides a general type to represent any way of referencing images within the registry.
</span><span class="c1">// Its main purpose is to abstract tags and digests (content-addressable hash).
</span><span class="c1">//
</span><span class="c1">// Grammar
</span><span class="c1">//
</span><span class="c1">// 	reference                       := name [ &#34;:&#34; tag ] [ &#34;@&#34; digest ]
</span><span class="c1">//	name                            := [domain &#39;/&#39;] path-component [&#39;/&#39; path-component]*
</span><span class="c1">//	domain                          := domain-component [&#39;.&#39; domain-component]* [&#39;:&#39; port-number]
</span><span class="c1">//	domain-component                := /([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])/
</span><span class="c1">//	port-number                     := /[0-9]+/
</span><span class="c1">//	path-component                  := alpha-numeric [separator alpha-numeric]*
</span><span class="c1">// 	alpha-numeric                   := /[a-z0-9]+/
</span><span class="c1">//	separator                       := /[_.]|__|[-]*/
</span><span class="c1">//
</span><span class="c1">//	tag                             := /[\w][\w.-]{0,127}/
</span><span class="c1">//
</span><span class="c1">//	digest                          := digest-algorithm &#34;:&#34; digest-hex
</span><span class="c1">//	digest-algorithm                := digest-algorithm-component [ digest-algorithm-separator digest-algorithm-component ]
</span><span class="c1">//	digest-algorithm-separator      := /[+.-_]/
</span><span class="c1">//	digest-algorithm-component      := /[A-Za-z][A-Za-z0-9]*/
</span><span class="c1">//	digest-hex                      := /[0-9a-fA-F]{32,}/ ; At least 128 bit digest value
</span><span class="c1">//
</span><span class="c1">//	identifier                      := /[a-f0-9]{64}/
</span><span class="c1">//	short-identifier                := /[a-f0-9]{6,64}/
</span><span class="c1">// Reference is an opaque object reference identifier that may include
</span><span class="c1"></span><span class="o">//</span><span class=""> </span><span class="nx">modifiers</span><span class=""> </span><span class="nx">such</span><span class=""> </span><span class="nx">as</span><span class=""> </span><span class="nx">a</span><span class=""> </span><span class="nx">hostname</span><span class="p">,</span><span class=""> </span><span class="nx">name</span><span class="p">,</span><span class=""> </span><span class="nx">tag</span><span class="p">,</span><span class=""> </span><span class="nx">and</span><span class=""> </span><span class="nx">digest</span><span class="p">.</span></code></pre>
</div>
<p>ä¿®æ”¹pluginçš„åå­—çš„æ–¹æ³•æ˜¯ä¸æ˜¯è¿˜æ²¡å®ç°ï¼Ÿ</p>

<h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2>

<p>åœ¨ä»£ç å­˜åœ¨bugçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆç”¨ä¸‹é¢çš„æ–¹æ³•æš‚æ—¶åˆ›å»ºpluginã€‚</p>

<p>è™½ç„¶dockerä»£ç é‡Œæ²¡æœ‰æä¾›<strong>rename plugin</strong>çš„æ¥å£ï¼Œä½†æ˜¯ä½¿ç”¨<strong>docker install</strong>å‘½ä»¤å®‰è£…çš„pluginä¼šå­˜å‚¨åœ¨<code>/var/lib/docker/plugins/${PLUGIN_ID}</code>ç›®å½•ä¸‹ã€‚</p>

<p>å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹ä½¿ç”¨<strong>docker plugin create</strong>å‘½ä»¤åˆ›å»ºä½ è‡ªå·±æƒ³è¦çš„åç§°çš„docker pluginã€‚</p>

<p>ä½¿ç”¨<code>docker plugin set</code>å‘½ä»¤ä¿®æ”¹pluginä¸­çš„å±æ€§:</p>

<ul>
<li>cluster_store</li>
<li>plugin_role</li>
<li>plugin_name</li>
</ul>

<p><strong>æ’ä»¶è°ƒè¯•</strong></p>

<p>æ—¥å¿—åœ°å€<code>/run/contiv/log/</code>ã€‚</p>

<p>ä»émasterèŠ‚ç‚¹çš„netpluginå¯åŠ¨æ—¥å¿—<code>netplugin_bootup.log</code>ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>

<pre><code>V2 Plugin logs
Loading OVS
Starting OVS
Starting Netplugin 
/netplugin -debug -plugin-mode docker -vlan-if  -cluster-store etcd://172.20.0.113:2379  
Not starting netmaster as plugin role is none
</code></pre>

<p>Netpluginå¯åŠ¨çš„æ—¶å€™æ˜¯æ­£ç¡®çš„è§£æäº†<strong>etcd</strong>çš„é…ç½®äº†ã€‚</p>

<p>ä½†æ˜¯æˆ‘ä»¬å†çœ‹ä¸€ä¸‹<code>netplugin.log</code>çš„æ—¥å¿—åå°±ä¼šå‘ç°ï¼Œå¯åŠ¨è¿˜æ˜¯å¤±è´¥äº†ã€‚</p>

<pre><code>time=&quot;Mar 21 03:20:37.537954358&quot; level=debug msg=&quot;Got link list(16): [0xc4203fe200 0xc4203fe300 0xc4203fe400 0xc4203fe500 0xc420420000 0xc420420090 0xc420420120 0xc4204201b0 0xc420420240 0xc4204202d0 0xc420420360 0xc4204203f0 0xc420420480 0xc420420510 0xc4203feb80 0xc4203fec80]&quot;
time=&quot;Mar 21 03:20:37.538576647&quot; level=error msg=&quot;Failed to connect to etcd. Err: client: etcd cluster is unavailable or misconfigured&quot;
time=&quot;Mar 21 03:20:37.538599827&quot; level=error msg=&quot;Error creating client etcd to url 127.0.0.1:2379. Err: client: etcd cluster is unavailable or misconfigured&quot;
time=&quot;Mar 21 03:20:37.538612813&quot; level=fatal msg=&quot;Error initializing cluster. Err: client: etcd cluster is unavailable or misconfigured&quot;
</code></pre>

<p><code>netplugin</code>æ²¡æœ‰æ­£ç¡®çš„è§£æetcdçš„åœ°å€ã€‚è¿™åˆ°åº•æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿbootupçš„æ—¥å¿—é‡Œä¸æ˜¯å†™çš„è§£æåˆ°äº†å—ï¼Ÿè¿™ä¸ªé—®é¢˜è¿˜å¾—ç ”ç©¶ä¸‹æºç ï¼Œä¹Ÿè®¸æ˜¯ä¸€ä¸ªbugã€‚</p>

            </article>
             
            <h2>See Also</h2>
            <ul>
                
                <li><a href="/blogs/contiv-v2plugin/">Contivå…¥å‘æŒ‡å—-v2plugin</a></li>
                
                <li><a href="/blogs/contiv-tryout/">Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½•</a></li>
                
                <li><a href="/blogs/contiv-guide/">æ€ç§‘å¼€æºdockerç½‘ç»œæ’ä»¶Contivç®€ä»‹</a></li>
                
                <li><a href="/blogs/docker-plugin-develop/">Docker17.03-CEæ’ä»¶å¼€å‘æ¡ˆä¾‹</a></li>
                
                <li><a href="/blogs/docker-create-plugin/">Docker 17.03-CE create pluginæºç è§£æ</a></li>
                
            </ul>
            
        </div>
    </section>

    

<aside id="meta">

<div>
    <section id="datecount">
        <h4 id="date"> Fri Mar 17, 2017 </h4>
        <h5 id="wc"> 2600 Words </h5>
        <h5 id="readtime"> Read in about 6 Min </h5>
    </section>
    <ul id="categories">
        
    </ul>
    <ul id="tags">
        
        <li> <a href="https://jimmysong.io//tags/docker">docker</a> </li>
        
        <li> <a href="https://jimmysong.io//tags/docker-plugin">docker plugin</a> </li>
        
        <li> <a href="https://jimmysong.io//tags/network">network</a> </li>
        
        <li> <a href="https://jimmysong.io//tags/cisco">cisco</a> </li>
        
        <li> <a href="https://jimmysong.io//tags/contiv">contiv</a> </li>
        
    </ul>
</div>

<div>
    <section id="prev">
        &nbsp;<a class="previous" href="https://jimmysong.io/talks/building-github-pages-with-hugo/"><i class="icon-arrow-left"></i> é›¶åŸºç¡€ä½¿ç”¨Hugoå’ŒGitHub Pagesåˆ›å»ºè‡ªå·±çš„åšå®¢</a><br>
    </section>
    <section id="next">
        &nbsp;<a class="next" href="https://jimmysong.io/blogs/docker-plugin-develop/">Docker17.03-CEæ’ä»¶å¼€å‘æ¡ˆä¾‹ <i class="icon-arrow-right"></i></a>
    </section>
</div>

<div>
    <section id="author">
        <h4>About the Author</h4>
        <p>
            <a href="https://jimmysong.io/about/">Jimmy Song</a> is a software engineer in Beijing, also an open source enthusiast and Big Data, Cloud Native fans. If you not see him front of computer, he must be traveling or taking pictures outside,
            visit the amazing pictures at <a href=https://jimmysongio.tuchong.com/>tuchong(å›¾è™«)</a>. Feel free to <a href=https://twitter.com/jimmysongio>follow him on twitter</a>.
        </p>
    </section>

</div>

</aside>

<meta itemprop="wordCount" content="2527">
<meta itemprop="datePublished" content="2017-03-17">
<meta itemprop="url" content="https://jimmysong.io/blogs/contiv-ultimate/">
 <aside id=comments>
    <div>
        <h2> Comments </h2>
    </div>
    
    
    
    <div id="container"></div>
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rootsongjc', 
            repo: 'rootsongjc.github.io', 
            oauth: {
                client_id: '93a0df08e0f93ff0c8a3',
                client_secret: '3bdbf0b42c525f78582600bd38cf7f722ee40541',
            },
        })
        gitment.render('container')
    </script>
</aside> <footer>
    <div>
        <p>
            <a href="https://jimmysong.io/kubernetes-handbook">Kubernetes Handbookä¸­æ–‡æŒ‡å—/å®è·µæ‰‹å†Œ</a> |
            <a href="https://jimmysong.io/cloud-native-go">Cloud Native Go</a> |
            <a href="https://jimmysong.io/awesome-cloud-native">Awesome Cloud Native</a> |
            <a href="https://jimmysong.io/migrating-to-cloud-native-application-architectures">è¿ç§»åˆ°äº‘åŸç”Ÿåº”ç”¨æ¶æ„æ‰‹å†Œ</a> |
            <a href="https://istio.doczh.cn/">Istio Service Meshä¸­æ–‡æ–‡æ¡£</a> |
            <a href="https://jimmysong.io/spark-on-k8s">Spark on Kubernetes</a>
    </div>
    <div>
        <p>

        </p>
        <p> &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span><span>
            Powered by <a href="https://gohugo.io">Hugo</a></span>
            </span>
    </div>
</footer>


</body>

</html>

    
