<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Blogs on Jimmy Song&#39;s Blog</title>
    <link>http://rootsongjc.github.io/blogs/index.xml</link>
    <description>Recent content in Blogs on Jimmy Song&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 25 Apr 2017 22:14:49 +0800</lastBuildDate>
    <atom:link href="http://rootsongjc.github.io/blogs/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Kubernetesç½‘ç»œå’Œé›†ç¾¤æ€§èƒ½æµ‹è¯•</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-performance-test/</link>
      <pubDate>Tue, 25 Apr 2017 22:14:49 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-performance-test/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160618045.jpg&#34; alt=&#34;Img&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ— é¢˜@å®‰è´é—¨ Jun 18,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¯¥æµ‹è¯•æ˜¯ä¸ºäº†æµ‹è¯•åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œè®¿é—®kubernetesçš„å»¶è¿Ÿä»¥åŠkubernetesçš„æ€§èƒ½ã€‚è¿›è¡Œä»¥ä¸‹æµ‹è¯•å‰ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªéƒ¨ç½²å¥½çš„kubernetesé›†ç¾¤ï¼Œå…³äºå¦‚ä½•éƒ¨ç½²kuberentes1.6é›†ç¾¤ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•ç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä»¥ä¸‹å‡ ç§ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetesé›†ç¾¤nodeèŠ‚ç‚¹ä¸Šé€šè¿‡Cluster IPæ–¹å¼è®¿é—®&lt;/li&gt;
&lt;li&gt;Kubernetesé›†ç¾¤å†…éƒ¨é€šè¿‡serviceè®¿é—®&lt;/li&gt;
&lt;li&gt;Kubernetesé›†ç¾¤å¤–éƒ¨é€šè¿‡traefik ingressæš´éœ²çš„åœ°å€è®¿é—®&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•åœ°å€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Cluster IP: 10.254.149.31&lt;/p&gt;

&lt;p&gt;Service Portï¼š8000&lt;/p&gt;

&lt;p&gt;Ingress Hostï¼štraefik.sample-webapp.io&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•å·¥å…·&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://locust.io&#34;&gt;Locust&lt;/a&gt;ï¼šä¸€ä¸ªç®€å•æ˜“ç”¨çš„ç”¨æˆ·è´Ÿè½½æµ‹è¯•å·¥å…·ï¼Œç”¨æ¥æµ‹è¯•webæˆ–å…¶ä»–ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¤„ç†çš„å¹¶å‘ç”¨æˆ·æ•°ã€‚&lt;/li&gt;
&lt;li&gt;curl&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/test/e2e&#34;&gt;kubemark&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æµ‹è¯•ç¨‹åºï¼šsample-webappï¼Œæºç è§Github &lt;a href=&#34;https://github.com/rootsongjc/distributed-load-testing-using-kubernetes&#34;&gt;kubernetesçš„åˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•è¯´æ˜&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡å‘&lt;code&gt;sample-webapp&lt;/code&gt;å‘é€curlè¯·æ±‚è·å–å“åº”æ—¶é—´ï¼Œç›´æ¥curlåçš„ç»“æœä¸ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Bash&#34;&gt;$ curl &amp;quot;http://10.254.149.31:8000/&amp;quot;
Welcome to the &amp;quot;Distributed Load Testing Using Kubernetes&amp;quot; sample web app
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç½‘ç»œå»¶è¿Ÿæµ‹è¯•&#34;&gt;ç½‘ç»œå»¶è¿Ÿæµ‹è¯•&lt;/h2&gt;

&lt;h3 id=&#34;åœºæ™¯ä¸€-kubernetesé›†ç¾¤nodeèŠ‚ç‚¹ä¸Šé€šè¿‡cluster-ipè®¿é—®&#34;&gt;åœºæ™¯ä¸€ã€ Kubernetesé›†ç¾¤nodeèŠ‚ç‚¹ä¸Šé€šè¿‡Cluster IPè®¿é—®&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•å‘½ä»¤&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;curl -o /dev/null -s -w &#39;%{time_connect} %{time_starttransfer} %{time_total}&#39; &amp;quot;http://10.254.149.31:8000/&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;10ç»„æµ‹è¯•ç»“æœ&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;No&lt;/th&gt;
&lt;th&gt;time_connect&lt;/th&gt;
&lt;th&gt;time_starttransfer&lt;/th&gt;
&lt;th&gt;time_total&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.003&lt;/td&gt;
&lt;td&gt;0.003&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;0.000&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;td&gt;0.002&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;å¹³å‡å“åº”æ—¶é—´ï¼š2ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ—¶é—´æŒ‡æ ‡è¯´æ˜&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å•ä½ï¼šç§’&lt;/p&gt;

&lt;p&gt;time_connectï¼šå»ºç«‹åˆ°æœåŠ¡å™¨çš„ TCP è¿æ¥æ‰€ç”¨çš„æ—¶é—´&lt;/p&gt;

&lt;p&gt;time_starttransferï¼šåœ¨å‘å‡ºè¯·æ±‚ä¹‹åï¼ŒWeb æœåŠ¡å™¨è¿”å›æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€ç”¨çš„æ—¶é—´&lt;/p&gt;

&lt;p&gt;time_totalï¼šå®Œæˆè¯·æ±‚æ‰€ç”¨çš„æ—¶é—´&lt;/p&gt;

&lt;h3 id=&#34;åœºæ™¯äºŒ-kubernetesé›†ç¾¤å†…éƒ¨é€šè¿‡serviceè®¿é—®&#34;&gt;åœºæ™¯äºŒã€Kubernetesé›†ç¾¤å†…éƒ¨é€šè¿‡serviceè®¿é—®&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•å‘½ä»¤&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;curl -o /dev/null -s -w &#39;%{time_connect} %{time_starttransfer} %{time_total}&#39; &amp;quot;http://sample-webapp:8000/&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;10ç»„æµ‹è¯•ç»“æœ&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;No&lt;/th&gt;
&lt;th&gt;time_connect&lt;/th&gt;
&lt;th&gt;time_starttransfer&lt;/th&gt;
&lt;th&gt;time_total&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;0.004&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;td&gt;0.006&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;å¹³å‡å“åº”æ—¶é—´ï¼š6ms&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;åœºæ™¯ä¸‰-åœ¨å…¬ç½‘ä¸Šé€šè¿‡traefik-ingressè®¿é—®&#34;&gt;åœºæ™¯ä¸‰ã€åœ¨å…¬ç½‘ä¸Šé€šè¿‡traefik ingressè®¿é—®&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•å‘½ä»¤&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;curl -o /dev/null -s -w &#39;%{time_connect} %{time_starttransfer} %{time_total}&#39; &amp;quot;http://traefik.sample-webapp.io&amp;quot; &amp;gt;&amp;gt;result
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;10ç»„æµ‹è¯•ç»“æœ&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;No&lt;/th&gt;
&lt;th&gt;time_connect&lt;/th&gt;
&lt;th&gt;time_starttransfer&lt;/th&gt;
&lt;th&gt;time_total&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0.043&lt;/td&gt;
&lt;td&gt;0.085&lt;/td&gt;
&lt;td&gt;0.085&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0.052&lt;/td&gt;
&lt;td&gt;0.093&lt;/td&gt;
&lt;td&gt;0.093&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0.043&lt;/td&gt;
&lt;td&gt;0.082&lt;/td&gt;
&lt;td&gt;0.082&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0.051&lt;/td&gt;
&lt;td&gt;0.093&lt;/td&gt;
&lt;td&gt;0.093&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;0.068&lt;/td&gt;
&lt;td&gt;0.188&lt;/td&gt;
&lt;td&gt;0.188&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;0.049&lt;/td&gt;
&lt;td&gt;0.089&lt;/td&gt;
&lt;td&gt;0.089&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;0.051&lt;/td&gt;
&lt;td&gt;0.113&lt;/td&gt;
&lt;td&gt;0.113&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;0.055&lt;/td&gt;
&lt;td&gt;0.120&lt;/td&gt;
&lt;td&gt;0.120&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;0.065&lt;/td&gt;
&lt;td&gt;0.126&lt;/td&gt;
&lt;td&gt;0.127&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;0.050&lt;/td&gt;
&lt;td&gt;0.111&lt;/td&gt;
&lt;td&gt;0.111&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;å¹³å‡å“åº”æ—¶é—´ï¼š110ms&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;æµ‹è¯•ç»“æœ&#34;&gt;æµ‹è¯•ç»“æœ&lt;/h3&gt;

&lt;p&gt;åœ¨è¿™ä¸‰ç§åœºæ™¯ä¸‹çš„å“åº”æ—¶é—´æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetesé›†ç¾¤nodeèŠ‚ç‚¹ä¸Šé€šè¿‡Cluster IPæ–¹å¼è®¿é—®ï¼š2ms&lt;/li&gt;
&lt;li&gt;Kubernetesé›†ç¾¤å†…éƒ¨é€šè¿‡serviceè®¿é—®ï¼š6ms&lt;/li&gt;
&lt;li&gt;Kubernetesé›†ç¾¤å¤–éƒ¨é€šè¿‡traefik ingressæš´éœ²çš„åœ°å€è®¿é—®ï¼š110ms&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼šæ‰§è¡Œæµ‹è¯•çš„nodeèŠ‚ç‚¹/Podä¸serivceæ‰€åœ¨çš„podçš„è·ç¦»ï¼ˆæ˜¯å¦åœ¨åŒä¸€å°ä¸»æœºä¸Šï¼‰ï¼Œå¯¹å‰ä¸¤ä¸ªåœºæ™¯å¯ä»¥èƒ½ä¼šæœ‰ä¸€å®šå½±å“ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;ç½‘ç»œæ€§èƒ½æµ‹è¯•&#34;&gt;ç½‘ç»œæ€§èƒ½æµ‹è¯•&lt;/h2&gt;

&lt;p&gt;ç½‘ç»œä½¿ç”¨flannelçš„vxlanæ¨¡å¼ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨iperfè¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;

&lt;p&gt;æœåŠ¡ç«¯å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;iperf -s -p 12345 -i 1 -M
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®¢æˆ·ç«¯å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;iperf -c ${server-ip} -p 12345 -i 1 -t 10 -w 20K
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;åœºæ™¯ä¸€-ä¸»æœºä¹‹é—´&#34;&gt;åœºæ™¯ä¸€ã€ä¸»æœºä¹‹é—´&lt;/h3&gt;

&lt;p&gt;[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 1.0 sec   598 MBytes  5.02 Gbits/sec
[  3]  1.0- 2.0 sec   637 MBytes  5.35 Gbits/sec
[  3]  2.0- 3.0 sec   664 MBytes  5.57 Gbits/sec
[  3]  3.0- 4.0 sec   657 MBytes  5.51 Gbits/sec
[  3]  4.0- 5.0 sec   641 MBytes  5.38 Gbits/sec
[  3]  5.0- 6.0 sec   639 MBytes  5.36 Gbits/sec
[  3]  6.0- 7.0 sec   628 MBytes  5.26 Gbits/sec
[  3]  7.0- 8.0 sec   649 MBytes  5.44 Gbits/sec
[  3]  8.0- 9.0 sec   638 MBytes  5.35 Gbits/sec
[  3]  9.0-10.0 sec   652 MBytes  5.47 Gbits/sec
&lt;strong&gt;[  3]  0.0-10.0 sec  6.25 GBytes  5.37 Gbits/sec&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;åœºæ™¯äºŒ-ä¸åŒä¸»æœºçš„çš„podä¹‹é—´&#34;&gt;åœºæ™¯äºŒã€ä¸åŒä¸»æœºçš„çš„Podä¹‹é—´&lt;/h3&gt;

&lt;p&gt;[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 1.0 sec   372 MBytes  3.12 Gbits/sec
[  3]  1.0- 2.0 sec   345 MBytes  2.89 Gbits/sec
[  3]  2.0- 3.0 sec   361 MBytes  3.03 Gbits/sec
[  3]  3.0- 4.0 sec   397 MBytes  3.33 Gbits/sec
[  3]  4.0- 5.0 sec   405 MBytes  3.40 Gbits/sec
[  3]  5.0- 6.0 sec   410 MBytes  3.44 Gbits/sec
[  3]  6.0- 7.0 sec   404 MBytes  3.39 Gbits/sec
[  3]  7.0- 8.0 sec   408 MBytes  3.42 Gbits/sec
[  3]  8.0- 9.0 sec   451 MBytes  3.78 Gbits/sec
[  3]  9.0-10.0 sec   387 MBytes  3.25 Gbits/sec
&lt;strong&gt;[  3]  0.0-10.0 sec  3.85 GBytes  3.30 Gbits/sec&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;åœºæ™¯ä¸‰-nodeä¸éåŒä¸»æœºçš„podä¹‹é—´&#34;&gt;åœºæ™¯ä¸‰ã€Nodeä¸éåŒä¸»æœºçš„Podä¹‹é—´&lt;/h3&gt;

&lt;p&gt;[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 1.0 sec   372 MBytes  3.12 Gbits/sec
[  3]  1.0- 2.0 sec   420 MBytes  3.53 Gbits/sec
[  3]  2.0- 3.0 sec   434 MBytes  3.64 Gbits/sec
[  3]  3.0- 4.0 sec   409 MBytes  3.43 Gbits/sec
[  3]  4.0- 5.0 sec   382 MBytes  3.21 Gbits/sec
[  3]  5.0- 6.0 sec   408 MBytes  3.42 Gbits/sec
[  3]  6.0- 7.0 sec   403 MBytes  3.38 Gbits/sec
[  3]  7.0- 8.0 sec   423 MBytes  3.55 Gbits/sec
[  3]  8.0- 9.0 sec   376 MBytes  3.15 Gbits/sec
[  3]  9.0-10.0 sec   451 MBytes  3.78 Gbits/sec
&lt;strong&gt;[  3]  0.0-10.0 sec  3.98 GBytes  3.42 Gbits/sec&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;ç½‘ç»œæ€§èƒ½å¯¹æ¯”ç»¼è¿°&#34;&gt;ç½‘ç»œæ€§èƒ½å¯¹æ¯”ç»¼è¿°&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨Flannelçš„&lt;strong&gt;vxlan&lt;/strong&gt;æ¨¡å¼å®ç°æ¯ä¸ªpodä¸€ä¸ªIPçš„æ–¹å¼ï¼Œä¼šæ¯”å®¿ä¸»æœºç›´æ¥äº’è”çš„ç½‘ç»œæ€§èƒ½æŸè€—30%ï½40%ï¼Œç¬¦åˆç½‘ä¸Šæµä¼ çš„æµ‹è¯•ç»“è®ºã€‚&lt;/p&gt;

&lt;h2 id=&#34;kuberneteçš„æ€§èƒ½æµ‹è¯•&#34;&gt;Kuberneteçš„æ€§èƒ½æµ‹è¯•&lt;/h2&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://supereagle.github.io/2017/03/09/kubemark/&#34;&gt;Kubernetesé›†ç¾¤æ€§èƒ½æµ‹è¯•&lt;/a&gt;ä¸­çš„æ­¥éª¤ï¼Œå¯¹kubernetesçš„æ€§èƒ½è¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘çš„é›†ç¾¤ç‰ˆæœ¬æ˜¯Kubernetes1.6.0ï¼Œé¦–å…ˆå…‹éš†ä»£ç ï¼Œå°†kubernetesç›®å½•å¤åˆ¶åˆ°&lt;code&gt;$GOPATH/src/k8s.io/&lt;/code&gt;ä¸‹ç„¶åæ‰§è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ./hack/generate-bindata.sh
/usr/local/src/k8s.io/kubernetes /usr/local/src/k8s.io/kubernetes
Generated bindata file : test/e2e/generated/bindata.go has 13498 test/e2e/generated/bindata.go lines of lovely automated artifacts
No changes in generated bindata file: pkg/generated/bindata.go
/usr/local/src/k8s.io/kubernetes
$ make WHAT=&amp;quot;test/e2e/e2e.test&amp;quot;
...
+++ [0425 17:01:34] Generating bindata:
    test/e2e/generated/gobindata_util.go
/usr/local/src/k8s.io/kubernetes /usr/local/src/k8s.io/kubernetes/test/e2e/generated
/usr/local/src/k8s.io/kubernetes/test/e2e/generated
+++ [0425 17:01:34] Building go targets for linux/amd64:
    test/e2e/e2e.test
$ make ginkgo
+++ [0425 17:05:57] Building the toolchain targets:
    k8s.io/kubernetes/hack/cmd/teststale
    k8s.io/kubernetes/vendor/github.com/jteeuwen/go-bindata/go-bindata
+++ [0425 17:05:57] Generating bindata:
    test/e2e/generated/gobindata_util.go
/usr/local/src/k8s.io/kubernetes /usr/local/src/k8s.io/kubernetes/test/e2e/generated
/usr/local/src/k8s.io/kubernetes/test/e2e/generated
+++ [0425 17:05:58] Building go targets for linux/amd64:
    vendor/github.com/onsi/ginkgo/ginkgo

$ export KUBERNETES_PROVIDER=local
$ export KUBECTL_PATH=/usr/bin/kubectl
$ go run hack/e2e.go -v -test  --test_args=&amp;quot;--host=http://172.20.0.113:8080 --ginkgo.focus=\[Feature:Performance\]&amp;quot; &amp;gt;&amp;gt;log.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•ç»“æœ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;Apr 25 18:27:31.461: INFO: API calls latencies: {
  &amp;quot;apicalls&amp;quot;: [
    {
      &amp;quot;resource&amp;quot;: &amp;quot;pods&amp;quot;,
      &amp;quot;verb&amp;quot;: &amp;quot;POST&amp;quot;,
      &amp;quot;latency&amp;quot;: {
        &amp;quot;Perc50&amp;quot;: 2148000,
        &amp;quot;Perc90&amp;quot;: 13772000,
        &amp;quot;Perc99&amp;quot;: 14436000,
        &amp;quot;Perc100&amp;quot;: 0
      }
    },
    {
      &amp;quot;resource&amp;quot;: &amp;quot;services&amp;quot;,
      &amp;quot;verb&amp;quot;: &amp;quot;DELETE&amp;quot;,
      &amp;quot;latency&amp;quot;: {
        &amp;quot;Perc50&amp;quot;: 9843000,
        &amp;quot;Perc90&amp;quot;: 11226000,
        &amp;quot;Perc99&amp;quot;: 12391000,
        &amp;quot;Perc100&amp;quot;: 0
      }
    },
    ...
Apr 25 18:27:31.461: INFO: [Result:Performance] {
  &amp;quot;version&amp;quot;: &amp;quot;v1&amp;quot;,
  &amp;quot;dataItems&amp;quot;: [
    {
      &amp;quot;data&amp;quot;: {
        &amp;quot;Perc50&amp;quot;: 2.148,
        &amp;quot;Perc90&amp;quot;: 13.772,
        &amp;quot;Perc99&amp;quot;: 14.436
      },
      &amp;quot;unit&amp;quot;: &amp;quot;ms&amp;quot;,
      &amp;quot;labels&amp;quot;: {
        &amp;quot;Resource&amp;quot;: &amp;quot;pods&amp;quot;,
        &amp;quot;Verb&amp;quot;: &amp;quot;POST&amp;quot;
      }
    },
...
2.857: INFO: Running AfterSuite actions on all node
Apr 26 10:35:32.857: INFO: Running AfterSuite actions on node 1

Ran 2 of 606 Specs in 268.371 seconds
SUCCESS! -- 2 Passed | 0 Failed | 0 Pending | 604 Skipped PASS

Ginkgo ran 1 suite in 4m28.667870101s
Test Suite Passed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»kubemarkè¾“å‡ºçš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°&lt;strong&gt;API calls latencies&lt;/strong&gt;å’Œ&lt;strong&gt;Performance&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–è¿˜æœ‰ä¸€ä¸ªå°†æµ‹è¯•ç»“æœç”»å›¾çš„å·¥å…·&lt;a href=&#34;https://github.com/coreos/kscale/blob/dfe65f050cff5bebf83074e3b3e6b3c2d69a9222/logplot/main.go&#34;&gt;plot&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubenetes-e2e-test.jpg&#34; alt=&#34;kubernetes-dashboard&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;æ³¨æ„äº‹é¡¹&#34;&gt;æ³¨æ„äº‹é¡¹&lt;/h3&gt;

&lt;p&gt;æµ‹è¯•è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°dockeré•œåƒå­˜å‚¨åœ¨GCEä¸­ï¼Œéœ€è¦ç¿»å¢™ä¸‹è½½ï¼Œæˆ‘æ²¡çœ‹åˆ°å“ªé‡Œé…ç½®è¿™ä¸ªé•œåƒçš„åœ°å€ã€‚è¯¥é•œåƒå‰¯æœ¬å·²ä¸Šä¼ æ—¶é€Ÿäº‘ï¼š&lt;/p&gt;

&lt;p&gt;ç”¨åˆ°çš„é•œåƒæœ‰å¦‚ä¸‹ä¸¤ä¸ªï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;gcr.io/google_containers/pause-amd64:3.0&lt;/li&gt;
&lt;li&gt;gcr.io/google_containers/serve_hostname:v1.4&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ—¶é€Ÿäº‘é•œåƒåœ°å€ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/pause-amd64:3.0&lt;/li&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/serve_hostname:v1.4&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°†é•œåƒpullåˆ°æœ¬åœ°åé‡æ–°æ‰“tagã€‚&lt;/p&gt;

&lt;h2 id=&#34;locustæµ‹è¯•&#34;&gt;Locustæµ‹è¯•&lt;/h2&gt;

&lt;p&gt;è¯·æ±‚ç»Ÿè®¡&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Method&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;# requests&lt;/th&gt;
&lt;th&gt;# failures&lt;/th&gt;
&lt;th&gt;Median response time&lt;/th&gt;
&lt;th&gt;Average response time&lt;/th&gt;
&lt;th&gt;Min response time&lt;/th&gt;
&lt;th&gt;Max response time&lt;/th&gt;
&lt;th&gt;Average Content Size&lt;/th&gt;
&lt;th&gt;Requests/s&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;POST&lt;/td&gt;
&lt;td&gt;/login&lt;/td&gt;
&lt;td&gt;5070&lt;/td&gt;
&lt;td&gt;78&lt;/td&gt;
&lt;td&gt;59000&lt;/td&gt;
&lt;td&gt;80551&lt;/td&gt;
&lt;td&gt;11218&lt;/td&gt;
&lt;td&gt;202140&lt;/td&gt;
&lt;td&gt;54&lt;/td&gt;
&lt;td&gt;1.17&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;POST&lt;/td&gt;
&lt;td&gt;/metrics&lt;/td&gt;
&lt;td&gt;5114232&lt;/td&gt;
&lt;td&gt;85879&lt;/td&gt;
&lt;td&gt;63000&lt;/td&gt;
&lt;td&gt;82280&lt;/td&gt;
&lt;td&gt;29518&lt;/td&gt;
&lt;td&gt;331330&lt;/td&gt;
&lt;td&gt;94&lt;/td&gt;
&lt;td&gt;1178.77&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;Total&lt;/td&gt;
&lt;td&gt;5119302&lt;/td&gt;
&lt;td&gt;85957&lt;/td&gt;
&lt;td&gt;63000&lt;/td&gt;
&lt;td&gt;82279&lt;/td&gt;
&lt;td&gt;11218&lt;/td&gt;
&lt;td&gt;331330&lt;/td&gt;
&lt;td&gt;94&lt;/td&gt;
&lt;td&gt;1179.94&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å“åº”æ—¶é—´åˆ†å¸ƒ&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;# requests&lt;/th&gt;
&lt;th&gt;50%&lt;/th&gt;
&lt;th&gt;66%&lt;/th&gt;
&lt;th&gt;75%&lt;/th&gt;
&lt;th&gt;80%&lt;/th&gt;
&lt;th&gt;90%&lt;/th&gt;
&lt;th&gt;95%&lt;/th&gt;
&lt;th&gt;98%&lt;/th&gt;
&lt;th&gt;99%&lt;/th&gt;
&lt;th&gt;100%&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;POST /login&lt;/td&gt;
&lt;td&gt;5070&lt;/td&gt;
&lt;td&gt;59000&lt;/td&gt;
&lt;td&gt;125000&lt;/td&gt;
&lt;td&gt;140000&lt;/td&gt;
&lt;td&gt;148000&lt;/td&gt;
&lt;td&gt;160000&lt;/td&gt;
&lt;td&gt;166000&lt;/td&gt;
&lt;td&gt;174000&lt;/td&gt;
&lt;td&gt;176000&lt;/td&gt;
&lt;td&gt;202140&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;POST /metrics&lt;/td&gt;
&lt;td&gt;5114993&lt;/td&gt;
&lt;td&gt;63000&lt;/td&gt;
&lt;td&gt;127000&lt;/td&gt;
&lt;td&gt;142000&lt;/td&gt;
&lt;td&gt;149000&lt;/td&gt;
&lt;td&gt;160000&lt;/td&gt;
&lt;td&gt;166000&lt;/td&gt;
&lt;td&gt;172000&lt;/td&gt;
&lt;td&gt;176000&lt;/td&gt;
&lt;td&gt;331330&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;None Total&lt;/td&gt;
&lt;td&gt;5120063&lt;/td&gt;
&lt;td&gt;63000&lt;/td&gt;
&lt;td&gt;127000&lt;/td&gt;
&lt;td&gt;142000&lt;/td&gt;
&lt;td&gt;149000&lt;/td&gt;
&lt;td&gt;160000&lt;/td&gt;
&lt;td&gt;166000&lt;/td&gt;
&lt;td&gt;172000&lt;/td&gt;
&lt;td&gt;176000&lt;/td&gt;
&lt;td&gt;331330&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ä»¥ä¸Šä¸¤ä¸ªè¡¨æ ¼éƒ½æ˜¯ç¬æ—¶å€¼ã€‚è¯·æ±‚å¤±è´¥ç‡åœ¨2%å·¦å³ã€‚&lt;/p&gt;

&lt;p&gt;Sample-webappèµ·äº†48ä¸ªpodã€‚&lt;/p&gt;

&lt;p&gt;Locustæ¨¡æ‹Ÿ10ä¸‡ç”¨æˆ·ï¼Œæ¯ç§’å¢é•¿100ä¸ªã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-locust-test.jpg&#34; alt=&#34;locust-test&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://testerhome.com/topics/4839&#34;&gt;åŸºäº Python çš„æ€§èƒ½æµ‹è¯•å·¥å…· locust (ä¸ LR çš„ç®€å•å¯¹æ¯”)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.locust.io/en/latest/what-is-locust.html&#34;&gt;Locust docs&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://timd.cn/2015/09/17/locust/&#34;&gt;pythonç”¨æˆ·è´Ÿè½½æµ‹è¯•å·¥å…·ï¼šlocust&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://supereagle.github.io/2017/03/09/kubemark/&#34;&gt;Kubernetesé›†ç¾¤æ€§èƒ½æµ‹è¯•&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://dockone.io/article/1050&#34;&gt;CoreOSæ˜¯å¦‚ä½•å°†Kubernetesçš„æ€§èƒ½æé«˜10å€çš„&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.fleeto.us/translation/updates-performance-and-scalability-kubernetes-13-2000-node-60000-pod-clusters&#34;&gt;Kubernetes 1.3 çš„æ€§èƒ½å’Œå¼¹æ€§ â€”â€” 2000 èŠ‚ç‚¹ï¼Œ60,0000 Pod çš„é›†ç¾¤&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.csdn.net/article/2015-07-07/2825155&#34;&gt;è¿ç”¨Kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/devel/kubemark-guide.md&#34;&gt;Kubemark User Guide&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è¿ç”¨kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•</title>
      <link>http://rootsongjc.github.io/blogs/distributed-load-testing-using-kubernetes/</link>
      <pubDate>Mon, 24 Apr 2017 21:32:52 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/distributed-load-testing-using-kubernetes/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160325002.jpg&#34; alt=&#34;kubrick&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šKubrick Book Store  Mar 25,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;Githubåœ°å€&lt;a href=&#34;https://github.com/rootsongjc/distributed-load-testing-using-kubernetes&#34;&gt;https://github.com/rootsongjc/distributed-load-testing-using-kubernetes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¯¥æ•™ç¨‹æè¿°å¦‚ä½•åœ¨&lt;a href=&#34;http://kubernetes.io&#34;&gt;Kubernetes&lt;/a&gt;ä¸­è¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡æµ‹è¯•ï¼ŒåŒ…æ‹¬ä¸€ä¸ªwebåº”ç”¨ã€dockeré•œåƒå’ŒKubernetes controllers/servicesã€‚æ›´å¤šèµ„æ–™è¯·æŸ¥çœ‹&lt;a href=&#34;http://cloud.google.com/solutions/distributed-load-testing-using-kubernetes&#34;&gt;Distributed Load Testing Using Kubernetes&lt;/a&gt; ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šè¯¥æµ‹è¯•æ˜¯åœ¨æˆ‘è‡ªå·±æœ¬åœ°æ­å»ºçš„kubernetesé›†ç¾¤ä¸Šæµ‹è¯•çš„ï¼Œä¸éœ€è¦ä½¿ç”¨Google Cloud Platformã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä¸éœ€è¦GCEåŠå…¶ä»–ç»„ä»¶ï¼Œä½ åªéœ€è¦æœ‰ä¸€ä¸ªkubernetesé›†ç¾¤å³å¯ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ è¿˜æ²¡æœ‰kubernetesé›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;https://www.gitbook.com/book/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;éƒ¨ç½²ä¸€ä¸ªã€‚&lt;/p&gt;

&lt;h2 id=&#34;éƒ¨ç½²webåº”ç”¨&#34;&gt;éƒ¨ç½²Webåº”ç”¨&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;sample-webapp&lt;/code&gt; ç›®å½•ä¸‹åŒ…å«ä¸€ä¸ªç®€å•çš„webæµ‹è¯•åº”ç”¨ã€‚æˆ‘ä»¬å°†å…¶æ„å»ºä¸ºdockeré•œåƒï¼Œåœ¨kubernetesä¸­è¿è¡Œã€‚ä½ å¯ä»¥è‡ªå·±æ„å»ºï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªæˆ‘æ„å»ºå¥½çš„é•œåƒ&lt;code&gt;index.tenxcloud.com/jimmy/k8s-sample-webapp:latest&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨kubernetesä¸Šéƒ¨ç½²sample-webappã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cd kubernetes-config
$ kubectl create -f sample-webapp-controller.yaml
$ kubectl create -f kubectl create -f sample-webapp-service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;éƒ¨ç½²locustçš„controllerå’Œservice&#34;&gt;éƒ¨ç½²Locustçš„Controllerå’ŒService&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;locust-master&lt;/code&gt;å’Œ&lt;code&gt;locust-work&lt;/code&gt;ä½¿ç”¨åŒæ ·çš„dockeré•œåƒï¼Œä¿®æ”¹cotnrollerä¸­&lt;code&gt;spec.template.spec.containers.env&lt;/code&gt;å­—æ®µä¸­çš„valueä¸ºä½ &lt;code&gt;sample-webapp&lt;/code&gt; serviceçš„åå­—ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- name: TARGET_HOST
  value: http://sample-webapp:8000
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;åˆ›å»ºcontroller-dockeré•œåƒ-å¯é€‰&#34;&gt;åˆ›å»ºController Dockeré•œåƒï¼ˆå¯é€‰ï¼‰&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;locust-master&lt;/code&gt;å’Œ&lt;code&gt;locust-work&lt;/code&gt; controllerä½¿ç”¨çš„éƒ½æ˜¯&lt;code&gt;locust-tasks&lt;/code&gt; dockeré•œåƒã€‚ä½ å¯ä»¥ç›´æ¥ä¸‹è½½&lt;code&gt;gcr.io/cloud-solutions-http://olz1di9xf.bkt.clouddn.com/locust-tasks&lt;/code&gt;ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–è¯‘ã€‚è‡ªå·±ç¼–è¯‘å¤§æ¦‚è¦èŠ±å‡ åˆ†é’Ÿæ—¶é—´ï¼Œé•œåƒå¤§å°ä¸º820Mã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker build -t index.tenxcloud.com/jimmy/locust-tasks:latest .
$ docker push index.tenxcloud.com/jimmy/locust-tasks:latest
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæˆ‘ä½¿ç”¨çš„æ˜¯æ—¶é€Ÿäº‘çš„é•œåƒä»“åº“ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªcontrollerçš„yamlçš„&lt;code&gt;spec.template.spec.containers.image&lt;/code&gt; å­—æ®µæŒ‡å®šçš„æ˜¯æˆ‘çš„é•œåƒï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;image: index.tenxcloud.com/jimmy/locust-tasks:latest
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;éƒ¨ç½²locust-master&#34;&gt;éƒ¨ç½²locust-master&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f locust-master-controller.yaml
$ kubectl create -f locust-master-service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;éƒ¨ç½²locust-worker&#34;&gt;éƒ¨ç½²locust-worker&lt;/h3&gt;

&lt;p&gt;Now deploy &lt;code&gt;locust-worker-controller&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f locust-worker-controller.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯ä»¥å¾ˆè½»æ˜“çš„ç»™workæ‰©å®¹ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl scale --replicas=20 replicationcontrollers locust-worker
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡WebUIï¼šDashboard - Workloads - Replication Controllers - &lt;strong&gt;ServiceName&lt;/strong&gt; - Scaleæ¥æ‰©å®¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/dashbaord-scale.jpg&#34; alt=&#34;dashboard-scale&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;é…ç½®traefik&#34;&gt;é…ç½®Traefik&lt;/h3&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;http://rootsongjc.github.io/blogs/traefik-ingress-installation/&#34;&gt;kubernetesçš„traefik ingresså®‰è£…&lt;/a&gt;ï¼Œåœ¨&lt;code&gt;ingress.yaml&lt;/code&gt;ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;  - host: traefik.locust.io
    http:
      paths:
      - path: /
        backend:
          serviceName: locust-master
          servicePort: 8089
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åæ‰§è¡Œ&lt;code&gt;kubectl replace -f ingress.yaml&lt;/code&gt;å³å¯æ›´æ–°traefikã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡Traefikçš„dashboardå°±å¯ä»¥çœ‹åˆ°åˆšå¢åŠ çš„&lt;code&gt;traefik.locust.io&lt;/code&gt;èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-dashboard-locust.jpg&#34; alt=&#34;traefik-dashboard-locust&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ‰§è¡Œæµ‹è¯•&#34;&gt;æ‰§è¡Œæµ‹è¯•&lt;/h2&gt;

&lt;p&gt;æ‰“å¼€&lt;code&gt;http://traefik.locust.io&lt;/code&gt;é¡µé¢ï¼Œç‚¹å‡»&lt;code&gt;Edit&lt;/code&gt;è¾“å…¥ä¼ªé€ çš„ç”¨æˆ·æ•°å’Œç”¨æˆ·æ¯ç§’å‘é€çš„è¯·æ±‚ä¸ªæ•°ï¼Œç‚¹å‡»&lt;code&gt;Start Swarming&lt;/code&gt;å°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/locust-start-swarming.jpg&#34; alt=&#34;locust-start-swarming&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è°ƒæ•´&lt;code&gt;sample-webapp&lt;/code&gt;çš„podä¸ªæ•°ï¼ˆé»˜è®¤è®¾ç½®äº†1ä¸ªpodï¼‰ï¼Œè§‚å¯Ÿpodçš„è´Ÿè½½å˜åŒ–æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/sample-webapp-rc.jpg&#34; alt=&#34;sample-webapp-rc&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä»ä¸€æ®µæ—¶é—´çš„è§‚å¯Ÿä¸­å¯ä»¥çœ‹åˆ°è´Ÿè½½è¢«å¹³å‡åˆ†é…ç»™äº†3ä¸ªpodã€‚&lt;/p&gt;

&lt;p&gt;åœ¨locustçš„é¡µé¢ä¸­å¯ä»¥å®æ—¶è§‚å¯Ÿä¹Ÿå¯ä»¥ä¸‹è½½æµ‹è¯•ç»“æœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/locust-dashboard.jpg&#34; alt=&#34;locust-dashboard&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/solutions/distributed-load-testing-using-kubernetes&#34;&gt;Distributed Load Testing Using Kubernetes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.csdn.net/article/2015-07-07/2825155&#34;&gt;è¿ç”¨Kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„IPå’ŒæœåŠ¡å‘ç°ä½“ç³»</title>
      <link>http://rootsongjc.github.io/blogs/ip-and-service-discovry-in-kubernetes/</link>
      <pubDate>Mon, 24 Apr 2017 16:11:16 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/ip-and-service-discovry-in-kubernetes/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20151108011.jpg&#34; alt=&#34;æœé˜³å…¬å›­&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šè·¯è¾¹çš„é‡èŠ±@æœé˜³å…¬å›­ Nov 8,2015ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;cluster-ip&#34;&gt;Cluster IP&lt;/h2&gt;

&lt;p&gt;å³Serviceçš„IPï¼Œé€šå¸¸åœ¨é›†ç¾¤å†…éƒ¨ä½¿ç”¨Service Nameæ¥è®¿é—®æœåŠ¡ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“è¯¥IPåœ°å€ï¼Œkubednsä¼šè‡ªåŠ¨æ ¹æ®service nameè§£æåˆ°æœåŠ¡çš„IPåœ°å€ï¼Œå°†æµé‡åˆ†å‘ç»™Podã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Service Nameæ‰æ˜¯å¯¹å¤–æš´éœ²æœåŠ¡çš„å…³é”®ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨kubeapiçš„é…ç½®ä¸­æŒ‡å®šè¯¥åœ°å€èŒƒå›´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é»˜è®¤é…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;--service-cluster-ip-range=10.254.0.0/16
--service-node-port-range=30000-32767
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;pod-ip&#34;&gt;Pod IP&lt;/h2&gt;

&lt;p&gt;é€šè¿‡é…ç½®flannelçš„&lt;code&gt;network&lt;/code&gt;å’Œ&lt;code&gt;subnet&lt;/code&gt;æ¥å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é»˜è®¤é…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;FLANNEL_NETWORK=172.30.0.0/16
FLANNEL_SUBNET=172.30.46.1/24
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podçš„IPåœ°å€&lt;u&gt;ä¸å›ºå®š&lt;/u&gt;ï¼Œå½“podé‡å¯æ—¶IPåœ°å€ä¼šå˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¯¥IPåœ°å€ä¹Ÿæ˜¯ç”¨æˆ·æ— éœ€å…³å¿ƒçš„ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯Flannelä¼šåœ¨æœ¬åœ°ç”Ÿæˆç›¸åº”IPæ®µçš„è™šæ‹Ÿç½‘å¡ï¼Œä¸ºäº†é˜²æ­¢å’Œé›†ç¾¤ä¸­çš„å…¶ä»–IPåœ°å€å†²çªï¼Œéœ€è¦è§„åˆ’IPæ®µã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä¸»æœº-node-ip&#34;&gt;ä¸»æœº/Node IP&lt;/h2&gt;

&lt;p&gt;ç‰©ç†æœºçš„IPåœ°å€ï¼Œå³kubernetesç®¡ç†çš„ç‰©ç†æœºçš„IPåœ°å€ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl get nodes
NAME           STATUS    AGE       VERSION
172.20.0.113   Ready     12d       v1.6.0
172.20.0.114   Ready     12d       v1.6.0
172.20.0.115   Ready     12d       v1.6.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æœåŠ¡å‘ç°&#34;&gt;æœåŠ¡å‘ç°&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡DNSå³å¯å‘ç°ï¼Œkubendsæ˜¯kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä¸åŒæœåŠ¡ä¹‹é—´å¯ä»¥ç›´æ¥ä½¿ç”¨service nameè®¿é—®ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡&lt;code&gt;sericename:port&lt;/code&gt;å³å¯è°ƒç”¨æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœåŠ¡å¤–éƒ¨çš„æœåŠ¡å‘ç°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡Ingressæ¥å®ç°ï¼Œæˆ‘ä»¬æ˜¯ç”¨çš„&lt;strong&gt;Traefik&lt;/strong&gt;æ¥å®ç°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/&#34;&gt;Ingressè§£æ&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://rootsongjc.github.io/blogs/traefik-ingress-installation/&#34;&gt;Kubernetes Traefik Ingresså®‰è£…è¯•ç”¨&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„RBACæ”¯æŒ</title>
      <link>http://rootsongjc.github.io/blogs/RBAC-support-in-kubernetes/</link>
      <pubDate>Fri, 21 Apr 2017 19:52:18 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/RBAC-support-in-kubernetes/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160402017.jpg&#34; alt=&#34;æ— é¢˜&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ— é¢˜ Apr 2,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;åœ¨Kubernetes1.6ç‰ˆæœ¬ä¸­æ–°å¢è§’è‰²è®¿é—®æ§åˆ¶æœºåˆ¶ï¼ˆRole-Based Accessï¼ŒRBACï¼‰è®©é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥é’ˆå¯¹ç‰¹å®šä½¿ç”¨è€…æˆ–æœåŠ¡è´¦å·çš„è§’è‰²ï¼Œè¿›è¡Œæ›´ç²¾ç¡®çš„èµ„æºè®¿é—®æ§åˆ¶ã€‚åœ¨RBACä¸­ï¼Œæƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºé€‚å½“è§’è‰²çš„æˆå‘˜è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚è¿™å°±æå¤§åœ°ç®€åŒ–äº†æƒé™çš„ç®¡ç†ã€‚åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè§’è‰²æ˜¯ä¸ºäº†å®Œæˆå„ç§å·¥ä½œè€Œåˆ›é€ ï¼Œç”¨æˆ·åˆ™ä¾æ®å®ƒçš„è´£ä»»å’Œèµ„æ ¼æ¥è¢«æŒ‡æ´¾ç›¸åº”çš„è§’è‰²ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»ä¸€ä¸ªè§’è‰²è¢«æŒ‡æ´¾åˆ°å¦ä¸€ä¸ªè§’è‰²ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª&lt;a href=&#34;http://blog.kubernetes.io/2017/04/rbac-support-in-kubernetes.html&#34;&gt;RBAC Support in Kubernetes&lt;/a&gt;ï¼Œè½¬è½½è‡ª&lt;a href=&#34;https://www.kubernetes.org.cn/1879.html&#34;&gt;kubernetesä¸­æ–‡ç¤¾åŒº&lt;/a&gt;ï¼Œè¯‘è€…å‚¬æ€»ï¼Œ&lt;a href=&#34;http://rootsongjc.github.com/about&#34;&gt;Jimmy Song&lt;/a&gt;åšäº†ç¨è®¸ä¿®æ”¹ã€‚è¯¥æ–‡ç« æ˜¯&lt;a href=&#34;http://blog.kubernetes.io/2017/03/five-days-of-kubernetes-1.6.html&#34;&gt;5å¤©å†…äº†è§£Kubernetes1.6æ–°ç‰¹æ€§&lt;/a&gt;çš„ç³»åˆ—æ–‡ç« ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;p&gt;One of the highlights of the &lt;a href=&#34;http://blog.kubernetes.io/2017/03/kubernetes-1.6-multi-user-multi-workloads-at-scale.html&#34;&gt;Kubernetes 1.6&lt;/a&gt;ä¸­çš„ä¸€ä¸ªäº®ç‚¹æ—¶RBACè®¿é—®æ§åˆ¶æœºåˆ¶å‡çº§åˆ°äº†betaç‰ˆæœ¬ã€‚RBACï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œæ˜¯ç”¨æ¥ç®¡ç†kubernetesé›†ç¾¤ä¸­èµ„æºè®¿é—®æƒé™çš„æœºåˆ¶ã€‚ä½¿ç”¨RBACå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ›´æ–°è®¿é—®æˆæƒç­–ç•¥è€Œä¸ç”¨é‡å¯é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡ä¸»è¦å…³æ³¨æ–°ç‰¹æ€§å’Œæœ€ä½³å®è·µã€‚&lt;/p&gt;

&lt;h3 id=&#34;rbac-vs-abac&#34;&gt;RBAC vs ABAC&lt;/h3&gt;

&lt;p&gt;ç›®å‰kubernetesä¸­å·²ç»æœ‰ä¸€ç³»åˆ—l &lt;a href=&#34;https://kubernetes.io/docs/admin/authorization/&#34;&gt;é‰´æƒæœºåˆ¶&lt;/a&gt;ã€‚é‰´æƒçš„ä½œç”¨æ˜¯ï¼Œå†³å®šä¸€ä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒä½¿ç”¨ Kubernetes API åšæŸäº›äº‹æƒ…ã€‚å®ƒé™¤äº†ä¼šå½±å“ kubectl ç­‰ç»„ä»¶ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ä¸€äº›è¿è¡Œåœ¨é›†ç¾¤å†…éƒ¨å¹¶å¯¹é›†ç¾¤è¿›è¡Œæ“ä½œçš„è½¯ä»¶äº§ç”Ÿä½œç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨äº† Kubernetes æ’ä»¶çš„ Jenkinsï¼Œæˆ–è€…æ˜¯åˆ©ç”¨ Kubernetes API è¿›è¡Œè½¯ä»¶éƒ¨ç½²çš„ Helmã€‚ABAC å’Œ RBAC éƒ½èƒ½å¤Ÿå¯¹è®¿é—®ç­–ç•¥è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;ABACï¼ˆAttribute Based Access Controlï¼‰æœ¬æ¥æ˜¯ä¸é”™çš„æ¦‚å¿µï¼Œä½†æ˜¯åœ¨ Kubernetes ä¸­çš„å®ç°æ¯”è¾ƒéš¾äºç®¡ç†å’Œç†è§£ï¼Œè€Œä¸”éœ€è¦å¯¹ Master æ‰€åœ¨èŠ‚ç‚¹çš„ SSH å’Œæ–‡ä»¶ç³»ç»Ÿæƒé™ï¼Œè€Œä¸”è¦ä½¿å¾—å¯¹æˆæƒçš„å˜æ›´æˆåŠŸç”Ÿæ•ˆï¼Œè¿˜éœ€è¦é‡æ–°å¯åŠ¨ API Serverã€‚&lt;/p&gt;

&lt;p&gt;è€Œ RBAC çš„æˆæƒç­–ç•¥å¯ä»¥åˆ©ç”¨ kubectl æˆ–è€… Kubernetes API ç›´æ¥è¿›è¡Œé…ç½®ã€‚&lt;strong&gt;RBAC å¯ä»¥æˆæƒç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·æœ‰æƒè¿›è¡Œæˆæƒç®¡ç†ï¼Œè¿™æ ·å°±å¯ä»¥æ— éœ€æ¥è§¦èŠ‚ç‚¹ï¼Œç›´æ¥è¿›è¡Œæˆæƒç®¡ç†ã€‚&lt;/strong&gt;RBAC åœ¨ Kubernetes ä¸­è¢«æ˜ å°„ä¸º API èµ„æºå’Œæ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸º Kubernetes ç¤¾åŒºçš„æŠ•å…¥å’Œåå¥½ï¼Œç›¸å¯¹äº ABAC è€Œè¨€ï¼ŒRBAC æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŸºç¡€æ¦‚å¿µ&#34;&gt;åŸºç¡€æ¦‚å¿µ&lt;/h3&gt;

&lt;p&gt;éœ€è¦ç†è§£ RBAC ä¸€äº›åŸºç¡€çš„æ¦‚å¿µå’Œæ€è·¯ï¼ŒRBAC æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿè®¿é—® &lt;a href=&#34;https://kubernetes.io/docs/api-reference/v1.6/&#34;&gt;Kubernetes API èµ„æº&lt;/a&gt;çš„æˆæƒæ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://1.bp.blogspot.com/-v6KLs1tT_xI/WOa0anGP4sI/AAAAAAAABBo/KIgYfp8PjusuykUVTfgu9-2uKj_wXo4lwCLcB/s1600/rbac1.png&#34;&gt;&lt;img src=&#34;https://1.bp.blogspot.com/-v6KLs1tT_xI/WOa0anGP4sI/AAAAAAAABBo/KIgYfp8PjusuykUVTfgu9-2uKj_wXo4lwCLcB/s400/rbac1.png&#34; alt=&#34;img&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ RBAC ä¸­å®šä¹‰äº†ä¸¤ä¸ªå¯¹è±¡ï¼Œç”¨äºæè¿°åœ¨ç”¨æˆ·å’Œèµ„æºä¹‹é—´çš„è¿æ¥æƒé™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;role&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è§’è‰²æ˜¯ä¸€ç³»åˆ—æƒé™çš„é›†åˆï¼Œä¾‹å¦‚ä¸€ä¸ªè§’è‰²å¯ä»¥åŒ…å«è¯»å– Pod çš„æƒé™å’Œåˆ—å‡º Pod çš„æƒé™ï¼Œ ClusterRole è·Ÿ Role ç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥åœ¨é›†ç¾¤ä¸­åˆ°å¤„ä½¿ç”¨ï¼ˆ Role æ˜¯ namespace ä¸€çº§çš„ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;role binding&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;RoleBinding æŠŠè§’è‰²æ˜ å°„åˆ°ç”¨æˆ·ï¼Œä»è€Œè®©è¿™äº›ç”¨æˆ·ç»§æ‰¿è§’è‰²åœ¨ namespace ä¸­çš„æƒé™ã€‚ClusterRoleBinding è®©ç”¨æˆ·ç»§æ‰¿ ClusterRole åœ¨æ•´ä¸ªé›†ç¾¤ä¸­çš„æƒé™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://1.bp.blogspot.com/-ixDe91-cnqw/WOa0auxC0mI/AAAAAAAABBs/4LxVsr6shEgTYqUapt5QPISUeuTuztVwwCEw/s1600/rbac2.png&#34;&gt;&lt;img src=&#34;https://1.bp.blogspot.com/-ixDe91-cnqw/WOa0auxC0mI/AAAAAAAABBs/4LxVsr6shEgTYqUapt5QPISUeuTuztVwwCEw/s640/rbac2.png&#34; alt=&#34;img&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦å¤–è¿˜è¦è€ƒè™‘cluster roleså’Œcluster role bindingã€‚cluster roleå’Œcluster role bindingæ–¹æ³•è·Ÿroleå’Œrole bindingä¸€æ ·ï¼Œå‡ºäº†å®ƒä»¬æœ‰æ›´å¹¿çš„scopeã€‚è¯¦ç»†å·®åˆ«è¯·è®¿é—® &lt;a href=&#34;https://kubernetes.io/docs/admin/authorization/rbac/#rolebinding-and-clusterrolebinding&#34;&gt;role bindingä¸clsuter role binding&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;kubernetesä¸­çš„rbac&#34;&gt;Kubernetesä¸­çš„RBAC&lt;/h3&gt;

&lt;p&gt;RBAC ç°åœ¨è¢« Kubernetes æ·±åº¦é›†æˆï¼Œå¹¶ä½¿ç”¨ä»–ç»™ç³»ç»Ÿç»„ä»¶è¿›è¡Œæˆæƒã€‚&lt;a href=&#34;https://kubernetes.io/docs/admin/authorization/rbac/#default-roles-and-role-bindings&#34;&gt;System Roles&lt;/a&gt; ä¸€èˆ¬å…·æœ‰å‰ç¼€&lt;code&gt;system:&lt;/code&gt;ï¼Œå¾ˆå®¹æ˜“è¯†åˆ«ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get clusterroles --namespace=kube-system
NAME                                           AGE
admin                                          10d
cluster-admin                                  10d
edit                                           10d
system:auth-delegator                          10d
system:basic-user                              10d
system:controller:attachdetach-controller      10d
system:controller:certificate-controller       10d
system:controller:cronjob-controller           10d
system:controller:daemon-set-controller        10d
system:controller:deployment-controller        10d
system:controller:disruption-controller        10d
system:controller:endpoint-controller          10d
system:controller:generic-garbage-collector    10d
system:controller:horizontal-pod-autoscaler    10d
system:controller:job-controller               10d
system:controller:namespace-controller         10d
system:controller:node-controller              10d
system:controller:persistent-volume-binder     10d
system:controller:pod-garbage-collector        10d
system:controller:replicaset-controller        10d
system:controller:replication-controller       10d
system:controller:resourcequota-controller     10d
system:controller:route-controller             10d
system:controller:service-account-controller   10d
system:controller:service-controller           10d
system:controller:statefulset-controller       10d
system:controller:ttl-controller               10d
system:discovery                               10d
system:heapster                                10d
system:kube-aggregator                         10d
system:kube-controller-manager                 10d
system:kube-dns                                10d
system:kube-scheduler                          10d
system:node                                    10d
system:node-bootstrapper                       10d
system:node-problem-detector                   10d
system:node-proxier                            10d
system:persistent-volume-provisioner           10d
view                                           10d
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;RBAC ç³»ç»Ÿè§’è‰²å·²ç»å®Œæˆè¶³å¤Ÿçš„è¦†ç›–ï¼Œè®©é›†ç¾¤å¯ä»¥å®Œå…¨åœ¨ RBAC çš„ç®¡ç†ä¸‹è¿è¡Œã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ ABAC åˆ° RBAC è¿›è¡Œè¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›åœ¨ ABAC é›†ç¾¤ä¸­ç¼ºçœå¼€æ”¾çš„æƒé™ï¼Œåœ¨ RBAC ä¸­ä¼šè¢«è§†ä¸ºä¸å¿…è¦çš„æˆæƒï¼Œä¼šå¯¹å…¶è¿›è¡Œ&lt;a href=&#34;https://kubernetes.io/docs/admin/authorization/rbac/#upgrading-from-15&#34;&gt;é™çº§&lt;/a&gt;ã€‚è¿™ç§æƒ…å†µä¼šå½±å“åˆ°ä½¿ç”¨ Service Account çš„è´Ÿè½½ã€‚ABAC é…ç½®ä¸­ï¼Œä» Pod ä¸­å‘å‡ºçš„è¯·æ±‚ä¼šä½¿ç”¨ Pod Tokenï¼ŒAPI Server ä¼šä¸ºå…¶æˆäºˆè¾ƒé«˜æƒé™ã€‚ä¾‹å¦‚ä¸‹é¢çš„å‘½ä»¤åœ¨ ABAC é›†ç¾¤ä¸­ä¼šè¿”å› JSON ç»“æœï¼Œè€Œåœ¨ RBAC çš„æƒ…å†µä¸‹åˆ™ä¼šè¿”å›é”™è¯¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl run nginx --image=nginx:latest
$ kubectl exec -it $(kubectl get pods -o jsonpath=&#39;{.items[0].metadata.name}&#39;) bash
$ apt-get update &amp;amp;&amp;amp; apt-get install -y curl
$ curl -ik \
  -H &amp;quot;Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)&amp;quot; \
  https://kubernetes/api/v1/namespaces/default/pods
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰€æœ‰åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ï¼Œä¸€æ—¦å’Œ API Server è¿›è¡Œé€šä¿¡ï¼Œéƒ½ä¼šæœ‰å¯èƒ½å—åˆ°è¿ç§»çš„å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;è¦å¹³æ»‘çš„ä» ABAC å‡çº§åˆ° RBACï¼Œåœ¨åˆ›å»º 1.6 é›†ç¾¤çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶å¯ç”¨&lt;a href=&#34;https://kubernetes.io/docs/admin/authorization/rbac/#parallel-authorizers&#34;&gt;ABAC å’Œ RBAC&lt;/a&gt;ã€‚å½“ä»–ä»¬åŒæ—¶å¯ç”¨çš„æ—¶å€™ï¼Œå¯¹ä¸€ä¸ªèµ„æºçš„æƒé™è¯·æ±‚ï¼Œåœ¨ä»»ä½•ä¸€æ–¹è·å¾—æ”¾è¡Œéƒ½ä¼šè·å¾—æ‰¹å‡†ã€‚ç„¶è€Œåœ¨è¿™ç§é…ç½®ä¸‹çš„æƒé™å¤ªè¿‡ç²—æ”¾ï¼Œå¾ˆå¯èƒ½æ— æ³•åœ¨å•çº¯çš„ RBAC ç¯å¢ƒä¸‹å·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰RBACå·²ç»è¶³å¤Ÿäº†ï¼ŒABACå¯èƒ½ä¼šè¢«å¼ƒç”¨ã€‚åœ¨å¯è§çš„æœªæ¥ABACä¾ç„¶ä¼šä¿ç•™åœ¨kubernetesä¸­ï¼Œä¸è¿‡å¼€å‘çš„é‡å¿ƒå·²ç»è½¬ç§»åˆ°äº†RBACã€‚&lt;/p&gt;

&lt;h3 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/admin/authorization/rbac/&#34;&gt;RBAC documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=Cd4JU7qzYbE#t=8m01s&#34;&gt;Google Cloud Next talks 1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=18P7cFc6nTU#t=41m06s&#34;&gt;Google Cloud Next talks 2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tonybai.com/2017/03/03/access-api-server-from-a-pod-through-serviceaccount/&#34;&gt;åœ¨Kubernetes Podä¸­ä½¿ç”¨Service Accountè®¿é—®API Server&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes traefik ingresså®‰è£…è¯•ç”¨</title>
      <link>http://rootsongjc.github.io/blogs/traefik-ingress-installation/</link>
      <pubDate>Thu, 20 Apr 2017 22:38:40 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/traefik-ingress-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160915046.jpg&#34; alt=&#34;fish&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šğŸŸ@é±¼ç¼¸ Sep 15,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æ˜¨å¤©ç¿»äº†ä¸‹&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/&#34;&gt;Ingressè§£æ&lt;/a&gt;ï¼Œç„¶åå®‰è£…è¯•ç”¨äº†ä¸‹&lt;a href=&#34;https://traefik.io&#34;&gt;traefik&lt;/a&gt;ï¼Œè¿‡ç¨‹å·²åŒæ­¥åˆ°&lt;a href=&#34;https://www.gitbook.com/book/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸Šï¼ŒGithubåœ°å€&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;https://github.com/rootsongjc/kubernetes-handbook&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ingressç®€ä»‹&#34;&gt;Ingressç®€ä»‹&lt;/h2&gt;

&lt;p&gt;å¦‚æœä½ è¿˜ä¸äº†è§£ï¼Œingressæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆçœ‹ä¸‹æˆ‘ç¿»è¯‘çš„Kuberneteså®˜ç½‘ä¸Šingressçš„ä»‹ç»&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/&#34;&gt;Kubernetes Ingressè§£æ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç†è§£Ingress&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç®€å•çš„è¯´ï¼Œingresså°±æ˜¯ä»kubernetesé›†ç¾¤å¤–è®¿é—®é›†ç¾¤çš„å…¥å£ï¼Œå°†ç”¨æˆ·çš„URLè¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„serviceä¸Šã€‚Ingressç›¸å½“äºnginxã€apacheç­‰è´Ÿè½½å‡è¡¡æ–¹å‘ä»£ç†æœåŠ¡å™¨ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬è§„åˆ™å®šä¹‰ï¼Œå³URLçš„è·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±ä¿¡æ¯å¾—çš„åˆ·æ–°ç”±&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers&#34;&gt;Ingress controller&lt;/a&gt;æ¥æä¾›ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç†è§£Ingress Controller&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Ingress Controller å®è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸ªç›‘è§†å™¨ï¼ŒIngress Controller é€šè¿‡ä¸æ–­åœ°è·Ÿ kubernetes API æ‰“äº¤é“ï¼Œå®æ—¶çš„æ„ŸçŸ¥åç«¯ serviceã€pod ç­‰å˜åŒ–ï¼Œæ¯”å¦‚æ–°å¢å’Œå‡å°‘ podï¼Œservice å¢åŠ ä¸å‡å°‘ç­‰ï¼›å½“å¾—åˆ°è¿™äº›å˜åŒ–ä¿¡æ¯åï¼ŒIngress Controller å†ç»“åˆä¸‹æ–‡çš„ Ingress ç”Ÿæˆé…ç½®ï¼Œç„¶åæ›´æ–°åå‘ä»£ç†è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶åˆ·æ–°å…¶é…ç½®ï¼Œè¾¾åˆ°æœåŠ¡å‘ç°çš„ä½œç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;éƒ¨ç½²traefik&#34;&gt;éƒ¨ç½²Traefik&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä»‹ç»traefik&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://traefik.io/&#34;&gt;Traefik&lt;/a&gt;æ˜¯ä¸€æ¬¾å¼€æºçš„åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿä¸å¸¸è§çš„å¾®æœåŠ¡ç³»ç»Ÿç›´æ¥æ•´åˆï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠ¨æ€é…ç½®ã€‚ç›®å‰æ”¯æŒDocker, Swarm, Mesos/Marathon, Mesos, Kubernetes, Consul, Etcd, Zookeeper, BoltDB, Rest APIç­‰ç­‰åç«¯æ¨¡å‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹é…ç½®æ–‡ä»¶å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;GitHubä»“åº“ä¸­çš„&lt;a href=&#34;manifests/traefik-ingress/&#34;&gt;manifests/traefik-ingress/&lt;/a&gt;ç›®å½•ä¸‹æ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºingress-rbac.yaml&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å°†ç”¨äºservice accountéªŒè¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
kind: ServiceAccount
metadata:
  name: ingress
  namespace: kube-system

---

kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: ingress
subjects:
  - kind: ServiceAccount
    name: ingress
    namespace: kube-system
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºåä¸º&lt;code&gt;traefik-ingress&lt;/code&gt;çš„ingress&lt;/strong&gt;ï¼Œæ–‡ä»¶åtraefik.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: traefik-ingress
spec:
  rules:
  - host: traefik.nginx.io
    http:
      paths:
      - path: /
        backend:
          serviceName: my-nginx
          servicePort: 80
  - host: traefik.frontend.io
    http:
      paths:
      - path: /
        backend:
          serviceName: frontend
          servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™å…¶ä¸­çš„&lt;code&gt;backend&lt;/code&gt;ä¸­è¦é…ç½®default namespaceä¸­å¯åŠ¨çš„serviceåå­—ã€‚&lt;code&gt;path&lt;/code&gt;å°±æ˜¯URLåœ°å€åçš„è·¯å¾„ï¼Œå¦‚traefik.frontend.io/pathï¼Œserviceå°†ä¼šæ¥å—pathè¿™ä¸ªè·¯å¾„ï¼Œhostæœ€å¥½ä½¿ç”¨service-name.filed1.filed2.domain-nameè¿™ç§ç±»ä¼¼ä¸»æœºåç§°çš„å‘½åæ–¹å¼ï¼Œæ–¹ä¾¿åŒºåˆ†æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ®ä½ è‡ªå·±ç¯å¢ƒä¸­éƒ¨ç½²çš„serviceçš„åå­—å’Œç«¯å£è‡ªè¡Œä¿®æ”¹ï¼Œæœ‰æ–°serviceå¢åŠ æ—¶ï¼Œä¿®æ”¹è¯¥æ–‡ä»¶åå¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl replace -f traefik.yaml&lt;/code&gt;æ¥æ›´æ–°ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ç°åœ¨é›†ç¾¤ä¸­å·²ç»æœ‰ä¸¤ä¸ªserviceäº†ï¼Œä¸€ä¸ªæ˜¯nginxï¼Œå¦ä¸€ä¸ªæ˜¯å®˜æ–¹çš„&lt;code&gt;guestbook&lt;/code&gt;ä¾‹å­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºDepeloyment&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: traefik-ingress-lb
  namespace: kube-system
  labels:
    k8s-app: traefik-ingress-lb
spec:
  template:
    metadata:
      labels:
        k8s-app: traefik-ingress-lb
        name: traefik-ingress-lb
    spec:
      terminationGracePeriodSeconds: 60
      hostNetwork: true
      restartPolicy: Always
      serviceAccountName: ingress
      containers:
      - image: traefik
        name: traefik-ingress-lb
        resources:
          limits:
            cpu: 200m
            memory: 30Mi
          requests:
            cpu: 100m
            memory: 20Mi
        ports:
        - name: http
          containerPort: 80
          hostPort: 80
        - name: admin
          containerPort: 8580
          hostPort: 8580
        args:
        - --web
        - --web.address=:8580
        - --kubernetes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„æˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯Deployç±»å‹ï¼Œæ²¡æœ‰é™å®šè¯¥podè¿è¡Œåœ¨å“ªä¸ªä¸»æœºä¸Šã€‚Traefikçš„ç«¯å£æ˜¯8580ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Traefik UI&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Service
metadata:
  name: traefik-web-ui
  namespace: kube-system
spec:
  selector:
    k8s-app: traefik-ingress-lb
  ports:
  - name: web
    port: 80
    targetPort: 8580
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: traefik-web-ui
  namespace: kube-system
spec:
  rules:
  - host: traefik-ui.local
    http:
      paths:
      - path: /
        backend:
          serviceName: traefik-web-ui
          servicePort: web
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é…ç½®å®Œæˆåå°±å¯ä»¥å¯åŠ¨treafik ingressäº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl create -f .
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘æŸ¥çœ‹åˆ°traefikçš„podåœ¨&lt;code&gt;172.20.0.115&lt;/code&gt;è¿™å°èŠ‚ç‚¹ä¸Šå¯åŠ¨äº†ã€‚&lt;/p&gt;

&lt;p&gt;è®¿é—®è¯¥åœ°å€&lt;code&gt;http://172.20.0.115:8580/&lt;/code&gt;å°†å¯ä»¥çœ‹åˆ°dashboardã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-dashboard.jpg&#34; alt=&#34;kubernetes-dashboard&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å·¦ä¾§é»„è‰²éƒ¨åˆ†éƒ¨åˆ†åˆ—å‡ºçš„æ˜¯æ‰€æœ‰çš„ruleï¼Œå³ä¾§ç»¿è‰²éƒ¨åˆ†æ˜¯æ‰€æœ‰çš„backendã€‚&lt;/p&gt;

&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h2&gt;

&lt;p&gt;åœ¨é›†ç¾¤çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚å‡å¦‚ç°åœ¨æˆ‘è¦è®¿é—®nginxçš„&amp;rdquo;/&amp;ldquo;è·¯å¾„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ curl -H Host:traefik.nginx.io http://172.20.0.115/
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;Welcome to nginx!&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Welcome to nginx!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;For online documentation and support please refer to
&amp;lt;a href=&amp;quot;http://nginx.org/&amp;quot;&amp;gt;nginx.org&amp;lt;/a&amp;gt;.&amp;lt;br/&amp;gt;
Commercial support is available at
&amp;lt;a href=&amp;quot;http://nginx.com/&amp;quot;&amp;gt;nginx.com&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;em&amp;gt;Thank you for using nginx.&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä½ éœ€è¦åœ¨kubernetesé›†ç¾¤ä»¥å¤–è®¿é—®å°±éœ€è¦è®¾ç½®DNSï¼Œæˆ–è€…ä¿®æ”¹æœ¬æœºçš„hostsæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å…¶ä¸­åŠ å…¥ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;172.20.0.115 traefik.nginx.io
172.20.0.115 traefik.frontend.io
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰€æœ‰è®¿é—®è¿™äº›åœ°å€çš„æµé‡éƒ½ä¼šå‘é€ç»™172.20.0.115è¿™å°ä¸»æœºï¼Œå°±æ˜¯æˆ‘ä»¬å¯åŠ¨traefikçš„ä¸»æœºã€‚&lt;/p&gt;

&lt;p&gt;Traefikä¼šè§£æhttpè¯·æ±‚headeré‡Œçš„Hostå‚æ•°å°†æµé‡è½¬å‘ç»™Ingressé…ç½®é‡Œçš„ç›¸åº”serviceã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹hostsåå°±å°±å¯ä»¥åœ¨kubernetesé›†ç¾¤å¤–è®¿é—®ä»¥ä¸Šä¸¤ä¸ªserviceï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-nginx.jpg&#34; alt=&#34;traefik-nginx&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-guestbook.jpg&#34; alt=&#34;traefik-guestbook&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.colabug.com/thread-1703745-1-1.html&#34;&gt;Traefik-kubernetes åˆè¯•&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.tuicool.com/articles/ZnuEfay&#34;&gt;Traefikç®€ä»‹&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook&#34;&gt;Guestbook example&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes ingressè§£æ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/</link>
      <pubDate>Wed, 19 Apr 2017 21:05:47 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160131054.jpg&#34; alt=&#34;é“¶æ²³soho&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæœé˜³é—¨é“¶æ²³SOHO Jan 31,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯kuberneteå®˜æ–¹æ–‡æ¡£ä¸­&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34;&gt;Ingress Resource&lt;/a&gt;çš„ç¿»è¯‘ï¼Œå› ä¸ºæœ€è¿‘å·¥ä½œä¸­ç”¨åˆ°ï¼Œæ–‡ç« ä¹Ÿä¸é•¿ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œç´¢æ€§ç¿»è¯‘ä¸€ä¸‹ï¼Œä¹Ÿä¾¿äºè‡ªå·±åŠ æ·±ç†è§£ï¼ŒåŒæ—¶é€ ç¦&lt;a href=&#34;https://www.kubernetes.org.cn/&#34;&gt;kubernetesä¸­æ–‡ç¤¾åŒº&lt;/a&gt;ã€‚åç»­å‡†å¤‡ä½¿ç”¨&lt;a href=&#34;https://github.com/containous/traefik&#34;&gt;Traefik&lt;/a&gt;æ¥åšIngress controllerï¼Œæ–‡ç« æœ«å°¾ç»™å‡ºäº†å‡ ä¸ªç›¸å…³é“¾æ¥ï¼Œå®é™…ä½¿ç”¨æ¡ˆä¾‹æ­£åœ¨æ‘¸ç´¢ä¸­ï¼Œå±Šæ—¶ç›¸å…³å®‰è£…æ–‡æ¡£å’Œé…ç½®è¯´æ˜å°†åŒæ­¥æ›´æ–°åˆ°&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœ¯è¯­&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šçœ‹åˆ°ä¸€äº›åœ¨å…¶ä»–åœ°æ–¹è¢«äº¤å‰ä½¿ç”¨çš„æœ¯è¯­ï¼Œä¸ºäº†é˜²æ­¢äº§ç”Ÿæ­§ä¹‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥æ¾„æ¸…ä¸‹ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹ï¼šKubernetesé›†ç¾¤ä¸­çš„ä¸€å°ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é›†ç¾¤ï¼šä½äºInterneté˜²ç«å¢™åçš„èŠ‚ç‚¹ï¼Œè¿™æ˜¯kubernetesç®¡ç†çš„ä¸»è¦è®¡ç®—èµ„æºã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è¾¹ç•Œè·¯ç”±å™¨ï¼šä¸ºé›†ç¾¤å¼ºåˆ¶æ‰§è¡Œé˜²ç«å¢™ç­–ç•¥çš„è·¯ç”±å™¨ã€‚ è¿™å¯èƒ½æ˜¯ç”±äº‘æä¾›å•†æˆ–ç‰©ç†ç¡¬ä»¶ç®¡ç†çš„ç½‘å…³ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é›†ç¾¤ç½‘ç»œï¼šä¸€ç»„é€»è¾‘æˆ–ç‰©ç†é“¾æ¥ï¼Œå¯æ ¹æ®Kubernetes&lt;a href=&#34;https://kubernetes.io/docs/admin/networking/&#34;&gt;ç½‘ç»œæ¨¡å‹&lt;/a&gt;å®ç°ç¾¤é›†å†…çš„é€šä¿¡ã€‚ é›†ç¾¤ç½‘ç»œçš„å®ç°åŒ…æ‹¬Overlayæ¨¡å‹çš„ &lt;a href=&#34;https://github.com/coreos/flannel#flannel&#34;&gt;flannel&lt;/a&gt; å’ŒåŸºäºSDNçš„&lt;a href=&#34;https://kubernetes.io/docs/admin/ovs-networking/&#34;&gt;OVS&lt;/a&gt;ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æœåŠ¡ï¼šä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨æ ‡è¯†ä¸€ç»„podæˆä¸ºçš„Kubernetes&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/&#34;&gt;æœåŠ¡&lt;/a&gt;ã€‚ é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æœåŠ¡å‡å®šåœ¨é›†ç¾¤ç½‘ç»œå†…ä»…å¯é€šè¿‡è™šæ‹ŸIPè®¿é—®ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯ingress&#34;&gt;ä»€ä¹ˆæ˜¯Ingressï¼Ÿ&lt;/h2&gt;

&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œserviceå’Œpodä»…å¯åœ¨é›†ç¾¤å†…éƒ¨ç½‘ç»œä¸­é€šè¿‡IPåœ°å€è®¿é—®ã€‚æ‰€æœ‰åˆ°è¾¾è¾¹ç•Œè·¯ç”±å™¨çš„æµé‡æˆ–è¢«ä¸¢å¼ƒæˆ–è¢«è½¬å‘åˆ°å…¶ä»–åœ°æ–¹ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå¯èƒ½åƒä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    internet
        |
  ------------
  [ Services ]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ingressæ˜¯æˆæƒå…¥ç«™è¿æ¥åˆ°è¾¾é›†ç¾¤æœåŠ¡çš„è§„åˆ™é›†åˆã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    internet
        |
   [ Ingress ]
   --|-----|--
   [ Services ]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯ä»¥ç»™Ingressé…ç½®æä¾›å¤–éƒ¨å¯è®¿é—®çš„URLã€è´Ÿè½½å‡è¡¡ã€SSLã€åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºç­‰ã€‚ç”¨æˆ·é€šè¿‡POST Ingressèµ„æºåˆ°API serverçš„æ–¹å¼æ¥è¯·æ±‚ingressã€‚ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers&#34;&gt;Ingress controller&lt;/a&gt;è´Ÿè´£å®ç°Ingressï¼Œé€šå¸¸ä½¿ç”¨è´Ÿè½½å¹³è¡¡å™¨ï¼Œå®ƒè¿˜å¯ä»¥é…ç½®è¾¹ç•Œè·¯ç”±å’Œå…¶ä»–å‰ç«¯ï¼Œè¿™æœ‰åŠ©äºä»¥HAæ–¹å¼å¤„ç†æµé‡ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h2&gt;

&lt;p&gt;åœ¨ä½¿ç”¨Ingress resourceä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸‹é¢å‡ ä»¶äº‹æƒ…ã€‚Ingressæ˜¯betaç‰ˆæœ¬çš„resourceï¼Œåœ¨kubernetes1.1ä¹‹å‰è¿˜æ²¡æœ‰ã€‚ä½ éœ€è¦ä¸€ä¸ª&lt;code&gt;Ingress Controller&lt;/code&gt;æ¥å®ç°&lt;code&gt;Ingress&lt;/code&gt;ï¼Œå•çº¯çš„åˆ›å»ºä¸€ä¸ª&lt;code&gt;Ingress&lt;/code&gt;æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚&lt;/p&gt;

&lt;p&gt;GCE/GKEä¼šåœ¨masterèŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªingress controllerã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªpodä¸­éƒ¨ç½²ä»»æ„ä¸ªè‡ªå®šä¹‰çš„ingress controllerã€‚ä½ å¿…é¡»æ­£ç¡®åœ°annotateæ¯ä¸ªingressï¼Œæ¯”å¦‚ &lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers/nginx#running-multiple-ingress-controllers&#34;&gt;è¿è¡Œå¤šä¸ªingress controller&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/BETA_LIMITATIONS.md#disabling-glbc&#34;&gt;å…³é—­glbc&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;ç¡®å®šä½ å·²ç»é˜…è¯»äº†Ingress controllerçš„&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/BETA_LIMITATIONS.md&#34;&gt;betaç‰ˆæœ¬é™åˆ¶&lt;/a&gt;ã€‚åœ¨éGCE/GKEçš„ç¯å¢ƒä¸­ï¼Œä½ éœ€è¦åœ¨podä¸­&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers&#34;&gt;éƒ¨ç½²ä¸€ä¸ªcontroller&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ingress-resource&#34;&gt;Ingress Resource&lt;/h2&gt;

&lt;p&gt;æœ€ç®€åŒ–çš„Ingressé…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;1: apiVersion: extensions/v1beta1
2: kind: Ingress
3: metadata:
4:   name: test-ingress
5: spec:
6:   rules:
7:   - http:
8:       paths:
9:       - path: /testpath
10:        backend:
11:           serviceName: test
12:           servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;å¦‚æœä½ æ²¡æœ‰é…ç½®Ingress controllerå°±å°†å…¶POSTåˆ°API serverä¸ä¼šæœ‰ä»»ä½•ç”¨å¤„&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®è¯´æ˜&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1-4è¡Œ&lt;/strong&gt;ï¼šè·ŸKubernetesçš„å…¶ä»–é…ç½®ä¸€æ ·ï¼Œingressçš„é…ç½®ä¹Ÿéœ€è¦&lt;code&gt;apiVersion&lt;/code&gt;ï¼Œ&lt;code&gt;kind&lt;/code&gt;å’Œ&lt;code&gt;metadata&lt;/code&gt;å­—æ®µã€‚é…ç½®æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/user-guide/deploying-applications&#34;&gt;éƒ¨ç½²åº”ç”¨&lt;/a&gt;, &lt;a href=&#34;https://kubernetes.io/docs/user-guide/configuring-containers&#34;&gt;é…ç½®å®¹å™¨&lt;/a&gt;å’Œ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/working-with-resources&#34;&gt;ä½¿ç”¨resources&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;5-7è¡Œ&lt;/strong&gt;: Ingress &lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md#spec-and-status&#34;&gt;spec&lt;/a&gt; ä¸­åŒ…å«é…ç½®ä¸€ä¸ªloadbalanceræˆ–proxy serverçš„æ‰€æœ‰ä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªåŒ¹é…æ‰€æœ‰å…¥ç«™è¯·æ±‚çš„è§„åˆ™åˆ—è¡¨ã€‚ç›®å‰ingressåªæ”¯æŒhttpè§„åˆ™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;8-9è¡Œ&lt;/strong&gt;ï¼šæ¯æ¡httpè§„åˆ™åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šä¸€ä¸ª&lt;code&gt;host&lt;/code&gt;é…ç½®é¡¹ï¼ˆæ¯”å¦‚for.bar.comï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­é»˜è®¤æ˜¯*ï¼‰ï¼Œ&lt;code&gt;path&lt;/code&gt;åˆ—è¡¨ï¼ˆæ¯”å¦‚ï¼š/testpathï¼‰ï¼Œæ¯ä¸ªpathéƒ½å…³è”ä¸€ä¸ª&lt;code&gt;backend&lt;/code&gt;(æ¯”å¦‚test:80)ã€‚åœ¨loadbalancerå°†æµé‡è½¬å‘åˆ°backendä¹‹å‰ï¼Œæ‰€æœ‰çš„å…¥ç«™è¯·æ±‚éƒ½è¦å…ˆåŒ¹é…hostå’Œpathã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;10-12è¡Œ&lt;/strong&gt;ï¼šæ­£å¦‚ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/services&#34;&gt;services doc&lt;/a&gt;ä¸­æè¿°çš„é‚£æ ·ï¼Œbackendæ˜¯ä¸€ä¸ª&lt;code&gt;service:port&lt;/code&gt;çš„ç»„åˆã€‚Ingressçš„æµé‡è¢«è½¬å‘åˆ°å®ƒæ‰€åŒ¹é…çš„backendã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å…¨å±€å‚æ•°&lt;/strong&gt;ï¼šä¸ºäº†ç®€å•èµ·è§ï¼ŒIngressç¤ºä¾‹ä¸­æ²¡æœ‰å…¨å±€å‚æ•°ï¼Œè¯·å‚é˜…èµ„æºå®Œæ•´å®šä¹‰çš„&lt;a href=&#34;https://releases.k8s.io/master/pkg/apis/extensions/v1beta1/types.go&#34;&gt;apiå‚è€ƒ&lt;/a&gt;ã€‚ åœ¨æ‰€æœ‰è¯·æ±‚éƒ½ä¸èƒ½è·Ÿspecä¸­çš„pathåŒ¹é…çš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚è¢«å‘é€åˆ°Ingress controllerçš„é»˜è®¤åç«¯ï¼Œå¯ä»¥æŒ‡å®šå…¨å±€ç¼ºçœbackendã€‚&lt;/p&gt;

&lt;h2 id=&#34;ingress-controllers&#34;&gt;Ingress controllers&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†ä½¿Ingressæ­£å¸¸å·¥ä½œï¼Œé›†ç¾¤ä¸­å¿…é¡»è¿è¡ŒIngress controllerã€‚ è¿™ä¸å…¶ä»–ç±»å‹çš„æ§åˆ¶å™¨ä¸åŒï¼Œå…¶ä»–ç±»å‹çš„æ§åˆ¶å™¨é€šå¸¸ä½œä¸º&lt;code&gt;kube-controller-manager&lt;/code&gt;äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œåœ¨é›†ç¾¤å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ã€‚ ä½ éœ€è¦é€‰æ‹©æœ€é€‚åˆè‡ªå·±é›†ç¾¤çš„Ingress controlleræˆ–è€…è‡ªå·±å®ç°ä¸€ä¸ªã€‚ ç¤ºä¾‹å’Œè¯´æ˜å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åœ¨ä½ å¼€å§‹å‰&#34;&gt;åœ¨ä½ å¼€å§‹å‰&lt;/h2&gt;

&lt;p&gt;ä»¥ä¸‹æ–‡æ¡£æè¿°äº†Ingressèµ„æºä¸­å…¬å¼€çš„ä¸€ç»„è·¨å¹³å°åŠŸèƒ½ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„Ingress controlleréƒ½åº”è¯¥ç¬¦åˆè¿™ä¸ªè§„èŒƒï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°ã€‚ GCEå’Œnginxæ§åˆ¶å™¨çš„æ–‡æ¡£åˆ†åˆ«åœ¨&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/README.md&#34;&gt;è¿™é‡Œ&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/nginx/README.md&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;strong&gt;ç¡®ä¿æ‚¨æŸ¥çœ‹æ§åˆ¶å™¨ç‰¹å®šçš„æ–‡æ¡£ï¼Œä»¥ä¾¿æ‚¨äº†è§£æ¯ä¸ªæ–‡æ¡£çš„æ³¨æ„äº‹é¡¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;ingressç±»å‹&#34;&gt;Ingressç±»å‹&lt;/h2&gt;

&lt;h3 id=&#34;å•service-ingress&#34;&gt;å•Service Ingress&lt;/h3&gt;

&lt;p&gt;Kubernetesä¸­å·²ç»å­˜åœ¨ä¸€äº›æ¦‚å¿µå¯ä»¥æš´éœ²å•ä¸ªserviceï¼ˆæŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#alternatives&#34;&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/a&gt;ï¼‰ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥é€šè¿‡Ingressæ¥å®ç°ï¼Œé€šè¿‡æŒ‡å®šä¸€ä¸ªæ²¡æœ‰ruleçš„é»˜è®¤backendçš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;ingress.yamlå®šä¹‰æ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test-ingress
spec:
  backend:
    serviceName: testsvc
    servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;kubectl create -f&lt;/code&gt;å‘½ä»¤åˆ›å»ºï¼Œç„¶åæŸ¥çœ‹ingressï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get ing
NAME                RULE          BACKEND        ADDRESS
test-ingress        -             testsvc:80     107.178.254.228
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;107.178.254.228&lt;/code&gt;å°±æ˜¯Ingress controllerä¸ºäº†å®ç°Ingressè€Œåˆ†é…çš„IPåœ°å€ã€‚&lt;code&gt;RULE&lt;/code&gt;åˆ—è¡¨ç¤ºæ‰€æœ‰å‘é€ç»™è¯¥IPçš„æµé‡éƒ½è¢«è½¬å‘åˆ°äº†&lt;code&gt;BACKEND&lt;/code&gt;æ‰€åˆ—çš„Kubernetes serviceä¸Šã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç®€å•å±•å¼€&#34;&gt;ç®€å•å±•å¼€&lt;/h3&gt;

&lt;p&gt;å¦‚å‰é¢æè¿°çš„é‚£æ ·ï¼Œkubernete podä¸­çš„IPåªåœ¨é›†ç¾¤ç½‘ç»œå†…éƒ¨å¯è§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¾¹ç•Œè®¾ç½®ä¸€ä¸ªä¸œè¥¿ï¼Œè®©å®ƒèƒ½å¤Ÿæ¥æ”¶ingressçš„æµé‡å¹¶å°†å®ƒä»¬è½¬å‘åˆ°æ­£ç¡®çš„ç«¯ç‚¹ä¸Šã€‚è¿™ä¸ªä¸œè¥¿ä¸€èˆ¬æ˜¯é«˜å¯ç”¨çš„loadbalancerã€‚ä½¿ç”¨Ingressèƒ½å¤Ÿå…è®¸ä½ å°†loadbalancerçš„ä¸ªæ•°é™ä½åˆ°æœ€å°‘ï¼Œä¾‹å¦‚ï¼Œå‡å¦‚ä½ æƒ³è¦åˆ›å»ºè¿™æ ·çš„ä¸€ä¸ªè®¾ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;foo.bar.com -&amp;gt; 178.91.123.132 -&amp;gt; / foo    s1:80
                                 / bar    s2:80

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ éœ€è¦ä¸€ä¸ªè¿™æ ·çš„ingressï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test
spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - path: /foo
        backend:
          serviceName: s1
          servicePort: 80
      - path: /bar
        backend:
          serviceName: s2
          servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;kubectl create -f&lt;/code&gt;åˆ›å»ºå®Œingressåï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get ing
NAME      RULE          BACKEND   ADDRESS
test      -
          foo.bar.com
          /foo          s1:80
          /bar          s2:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åªè¦æœåŠ¡ï¼ˆs1ï¼Œs2ï¼‰å­˜åœ¨ï¼ŒIngress controllerå°±ä¼šå°†æä¾›ä¸€ä¸ªæ»¡è¶³è¯¥Ingressçš„ç‰¹å®šloadbalancerå®ç°ã€‚ è¿™ä¸€æ­¥å®Œæˆåï¼Œæ‚¨å°†åœ¨Ingressçš„æœ€åä¸€åˆ—çœ‹åˆ°loadbalancerçš„åœ°å€ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº&#34;&gt;åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº&lt;/h3&gt;

&lt;p&gt;Name-basedçš„è™šæ‹Ÿä¸»æœºåœ¨åŒä¸€ä¸ªIPåœ°å€ä¸‹æ‹¥æœ‰å¤šä¸ªä¸»æœºåã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;foo.bar.com --|                 |-&amp;gt; foo.bar.com s1:80
              | 178.91.123.132  |
bar.foo.com --|                 |-&amp;gt; bar.foo.com s2:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸‹é¢è¿™ä¸ªingressè¯´æ˜åŸºäº&lt;a href=&#34;https://tools.ietf.org/html/rfc7230#section-5.4&#34;&gt;Host header&lt;/a&gt;çš„åç«¯loadbalancerçš„è·¯ç”±è¯·æ±‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test
spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - backend:
          serviceName: s1
          servicePort: 80
  - host: bar.foo.com
    http:
      paths:
      - backend:
          serviceName: s2
          servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é»˜è®¤backend&lt;/strong&gt;ï¼šä¸€ä¸ªæ²¡æœ‰ruleçš„ingressï¼Œå¦‚å‰é¢ç« èŠ‚ä¸­æ‰€ç¤ºï¼Œæ‰€æœ‰æµé‡éƒ½å°†å‘é€åˆ°ä¸€ä¸ªé»˜è®¤backendã€‚ä½ å¯ä»¥ç”¨è¯¥æŠ€å·§é€šçŸ¥loadbalancerå¦‚ä½•æ‰¾åˆ°ä½ ç½‘ç«™çš„404é¡µé¢ï¼Œé€šè¿‡åˆ¶å®šä¸€äº›åˆ—ruleå’Œä¸€ä¸ªé»˜è®¤backendçš„æ–¹å¼ã€‚å¦‚æœè¯·æ±‚headerä¸­çš„hostä¸èƒ½è·Ÿingressä¸­çš„hoståŒ¹é…ï¼Œå¹¶ä¸”/æˆ–è¯·æ±‚çš„URLä¸èƒ½ä¸ä»»ä½•ä¸€ä¸ªpathåŒ¹é…ï¼Œåˆ™æµé‡å°†è·¯ç”±åˆ°ä½ çš„é»˜è®¤backendã€‚&lt;/p&gt;

&lt;h3 id=&#34;tls&#34;&gt;TLS&lt;/h3&gt;

&lt;p&gt;ä½ å¯ä»¥é€šè¿‡æŒ‡å®šåŒ…å«TLSç§é’¥å’Œè¯ä¹¦çš„&lt;a href=&#34;https://kubernetes.io/docs/user-guide/secrets&#34;&gt;secret&lt;/a&gt;æ¥åŠ å¯†Ingressã€‚ ç›®å‰ï¼ŒIngressä»…æ”¯æŒå•ä¸ªTLSç«¯å£443ï¼Œå¹¶å‡å®šTLS terminationã€‚ å¦‚æœIngressä¸­çš„TLSé…ç½®éƒ¨åˆ†æŒ‡å®šäº†ä¸åŒçš„ä¸»æœºï¼Œåˆ™å®ƒä»¬å°†æ ¹æ®é€šè¿‡SNI TLSæ‰©å±•æŒ‡å®šçš„ä¸»æœºåï¼ˆå‡å¦‚Ingress controlleræ”¯æŒSNIï¼‰åœ¨å¤šä¸ªç›¸åŒç«¯å£ä¸Šè¿›è¡Œå¤ç”¨ã€‚ TLS secretä¸­å¿…é¡»åŒ…å«åä¸º&lt;code&gt;tls.crt&lt;/code&gt;å’Œ&lt;code&gt;tls.key&lt;/code&gt;çš„å¯†é’¥ï¼Œè¿™é‡Œé¢åŒ…å«äº†ç”¨äºTLSçš„è¯ä¹¦å’Œç§é’¥ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
data:
  tls.crt: base64 encoded cert
  tls.key: base64 encoded key
kind: Secret
metadata:
  name: testsecret
  namespace: default
type: Opaque
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨Ingressä¸­å¼•ç”¨è¿™ä¸ªsecretå°†é€šçŸ¥Ingress controllerä½¿ç”¨TLSåŠ å¯†ä»å°†å®¢æˆ·ç«¯åˆ°loadbalancerçš„channelï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: no-rules-map
spec:
  tls:
    - secretName: testsecret
  backend:
    serviceName: s1
    servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼Œå„ç§Ingress controlleræ”¯æŒçš„TLSåŠŸèƒ½ä¹‹é—´å­˜åœ¨å·®è·ã€‚ è¯·å‚é˜…æœ‰å…³&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/nginx/README.md#https&#34;&gt;nginx&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/README.md#tls&#34;&gt;GCE&lt;/a&gt;æˆ–ä»»ä½•å…¶ä»–å¹³å°ç‰¹å®šIngress controllerçš„æ–‡æ¡£ï¼Œä»¥äº†è§£TLSåœ¨ä½ çš„ç¯å¢ƒä¸­çš„å·¥ä½œåŸç†ã€‚&lt;/p&gt;

&lt;p&gt;Ingress controllerå¯åŠ¨æ—¶é™„å¸¦ä¸€äº›é€‚ç”¨äºæ‰€æœ‰Ingressçš„è´Ÿè½½å¹³è¡¡ç­–ç•¥è®¾ç½®ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåç«¯æƒé‡æ–¹æ¡ˆç­‰ã€‚æ›´é«˜çº§çš„è´Ÿè½½å¹³è¡¡æ¦‚å¿µï¼ˆä¾‹å¦‚æŒä¹…ä¼šè¯ï¼ŒåŠ¨æ€æƒé‡ï¼‰å°šæœªåœ¨Ingressä¸­å…¬å¼€ã€‚ ä½ ä»ç„¶å¯ä»¥é€šè¿‡&lt;a href=&#34;https://github.com/kubernetes/contrib/tree/master/service-loadbalancer&#34;&gt;service loadbalancer&lt;/a&gt;è·å–è¿™äº›åŠŸèƒ½ã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬è®¡åˆ’å°†é€‚ç”¨äºè·¨å¹³å°çš„è´Ÿè½½å¹³è¡¡æ¨¡å¼åŠ å…¥åˆ°Ingressèµ„æºä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡å¥åº·æ£€æŸ¥ä¸ç›´æ¥é€šè¿‡Ingresså…¬å¼€ï¼Œä½†Kubernetesä¸­å­˜åœ¨å¹¶è¡Œæ¦‚å¿µï¼Œä¾‹å¦‚&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/&#34;&gt;å‡†å¤‡æ¢æŸ¥&lt;/a&gt;ï¼Œå¯ä»¥ä½¿ä½ è¾¾æˆç›¸åŒçš„æœ€ç»ˆç»“æœã€‚ è¯·æŸ¥çœ‹ç‰¹å®šæ§åˆ¶å™¨çš„æ–‡æ¡£ï¼Œä»¥äº†è§£ä»–ä»¬å¦‚ä½•å¤„ç†å¥åº·æ£€æŸ¥ï¼ˆ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/nginx/README.md&#34;&gt;nginx&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/README.md#health-checks&#34;&gt;GCE&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ›´æ–°ingress&#34;&gt;æ›´æ–°Ingress&lt;/h2&gt;

&lt;p&gt;å‡å¦‚ä½ æƒ³è¦å‘å·²æœ‰çš„ingressä¸­å¢åŠ ä¸€ä¸ªæ–°çš„Hostï¼Œä½ å¯ä»¥ç¼–è¾‘å’Œæ›´æ–°è¯¥ingressï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Bash&#34;&gt;$ kubectl get ing
NAME      RULE          BACKEND   ADDRESS
test      -                       178.91.123.132
          foo.bar.com
          /foo          s1:80
$ kubectl edit ing test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¼šå¼¹å‡ºä¸€ä¸ªåŒ…å«å·²æœ‰çš„yamlæ–‡ä»¶çš„ç¼–è¾‘å™¨ï¼Œä¿®æ”¹å®ƒï¼Œå¢åŠ æ–°çš„Hosté…ç½®ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - backend:
          serviceName: s1
          servicePort: 80
        path: /foo
  - host: bar.baz.com
    http:
      paths:
      - backend:
          serviceName: s2
          servicePort: 80
        path: /foo
..
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿å­˜å®ƒä¼šæ›´æ–°API serverä¸­çš„èµ„æºï¼Œè¿™ä¼šè§¦å‘ingress controlleré‡æ–°é…ç½®loadbalancerã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get ing
NAME      RULE          BACKEND   ADDRESS
test      -                       178.91.123.132
          foo.bar.com
          /foo          s1:80
          bar.baz.com
          /foo          s2:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ä¸€ä¸ªä¿®æ”¹è¿‡çš„ingress yamlæ–‡ä»¶ä¸Šè°ƒç”¨&lt;code&gt;kubectl replace -f&lt;/code&gt;å‘½ä»¤ä¸€æ ·å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚&lt;/p&gt;

&lt;h2 id=&#34;è·¨å¯ç”¨åŸŸæ•…éšœ&#34;&gt;è·¨å¯ç”¨åŸŸæ•…éšœ&lt;/h2&gt;

&lt;p&gt;åœ¨ä¸é€šäº‘ä¾›åº”å•†ä¹‹é—´ï¼Œè·¨æ•…éšœåŸŸçš„æµé‡ä¼ æ’­æŠ€æœ¯æœ‰æ‰€ä¸åŒã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ç›¸å…³Ingress controllerçš„æ–‡æ¡£ã€‚ æœ‰å…³åœ¨federationé›†ç¾¤ä¸­éƒ¨ç½²Ingressçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/federation/&#34;&gt;federationæ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æœªæ¥è®¡åˆ’&#34;&gt;æœªæ¥è®¡åˆ’&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å¤šæ ·åŒ–çš„HTTPS/TLSæ¨¡å‹æ”¯æŒï¼ˆå¦‚SNIï¼Œre-encryptionï¼‰&lt;/li&gt;
&lt;li&gt;é€šè¿‡å£°æ˜æ¥è¯·æ±‚IPæˆ–è€…ä¸»æœºå&lt;/li&gt;
&lt;li&gt;ç»“åˆL4å’ŒL7 Ingress&lt;/li&gt;
&lt;li&gt;æ›´å¤šçš„Ingress controller&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¯·è·Ÿè¸ª&lt;a href=&#34;https://github.com/kubernetes/kubernetes/pull/12827&#34;&gt;L7å’ŒIngressçš„proposal&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³èµ„æºæ¼”è¿›çš„æ›´å¤šç»†èŠ‚ï¼Œä»¥åŠ&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master&#34;&gt;Ingress repository&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³å„ç§Ingress controlleræ¼”è¿›çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ›¿ä»£æ–¹æ¡ˆ&#34;&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/h2&gt;

&lt;p&gt;ä½ å¯ä»¥é€šè¿‡å¾ˆå¤šç§æ–¹å¼æš´éœ²serviceè€Œä¸å¿…ç›´æ¥ä½¿ç”¨ingressï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/#type-loadbalancer&#34;&gt;Service.Type=LoadBalancer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/#type-nodeport&#34;&gt;Service.Type=NodePort&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://github.com/kubernetes/contrib/tree/master/for-demos/proxy-to-service&#34;&gt;Port Proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²ä¸€ä¸ª&lt;a href=&#34;https://github.com/kubernetes/contrib/tree/master/service-loadbalancer&#34;&gt;Service loadbalancer&lt;/a&gt; è¿™å…è®¸ä½ åœ¨å¤šä¸ªserviceä¹‹é—´å…±äº«å•ä¸ªIPï¼Œå¹¶é€šè¿‡Service Annotationså®ç°æ›´é«˜çº§çš„è´Ÿè½½å¹³è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34;&gt;Kubernetes Ingress Resource&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://dockone.io/article/957&#34;&gt;ä½¿ç”¨NGINX Plusè´Ÿè½½å‡è¡¡KubernetesæœåŠ¡&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.cnblogs.com/276815076/p/6407101.html&#34;&gt;ä½¿ç”¨ NGINX å’Œ NGINX Plus çš„ Ingress Controller è¿›è¡Œ Kubernetes çš„è´Ÿè½½å‡è¡¡&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.osones.com/en/kubernetes-ingress-controller-with-traefik-and-lets-encrypt.html&#34;&gt;Kubernetes : Ingress Controller with TrÃ¦fÉªk and Let&amp;rsquo;s Encrypt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.osones.com/en/kubernetes-traefik-and-lets-encrypt-at-scale.html&#34;&gt;Kubernetes : TrÃ¦fÉªk and Let&amp;rsquo;s Encrypt at scale&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.traefik.io/user-guide/kubernetes/&#34;&gt;Kubernetes Ingress Controller-TrÃ¦fÉªk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.kubernetes.io/2016/03/Kubernetes-1.2-and-simplifying-advanced-networking-with-Ingress.html&#34;&gt;Kubernetes 1.2 and simplifying advanced networking with Ingress&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨å¼€å¯TLSçš„Kubernetes1.6é›†ç¾¤ä¸Šå®‰è£…EFK</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-efk-installation-with-tls/</link>
      <pubDate>Thu, 13 Apr 2017 12:28:10 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-efk-installation-with-tls/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2016061706.jpg&#34; alt=&#34;ç°‹è¡—&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šç°‹è¡— Jun 17,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®(forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œåœ¨å¼€å¯äº†TLSéªŒè¯çš„é›†ç¾¤ä¸­éƒ¨ç½²EFKæ—¥å¿—æ”¶é›†ç›‘æ§æ’ä»¶ã€‚&lt;/p&gt;

&lt;h1 id=&#34;é…ç½®å’Œå®‰è£…-efk&#34;&gt;é…ç½®å’Œå®‰è£… EFK&lt;/h1&gt;

&lt;p&gt;å®˜æ–¹æ–‡ä»¶ç›®å½•ï¼š&lt;code&gt;cluster/addons/fluentd-elasticsearch&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ls *.yaml
es-controller.yaml  es-service.yaml  fluentd-es-ds.yaml  kibana-controller.yaml  kibana-service.yaml efk-rbac.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åŒæ ·EFKæœåŠ¡ä¹Ÿéœ€è¦ä¸€ä¸ª&lt;code&gt;efk-rbac.yaml&lt;/code&gt;æ–‡ä»¶ï¼Œé…ç½®serviceaccountä¸º&lt;code&gt;efk&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼š&lt;a href=&#34;./manifests/EFK&#34;&gt;EFK&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®-es-controller-yaml&#34;&gt;é…ç½® es-controller.yaml&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff es-controller.yaml.orig es-controller.yaml
24c24
&amp;lt;       - image: gcr.io/google_containers/elasticsearch:v2.4.1-2
---
&amp;gt;       - image: sz-pg-oam-docker-hub-001.tendcloud.com/library/elasticsearch:v2.4.1-2
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®-es-service-yaml&#34;&gt;é…ç½® es-service.yaml&lt;/h2&gt;

&lt;p&gt;æ— éœ€é…ç½®ï¼›&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®-fluentd-es-ds-yaml&#34;&gt;é…ç½® fluentd-es-ds.yaml&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff fluentd-es-ds.yaml.orig fluentd-es-ds.yaml
26c26
&amp;lt;         image: gcr.io/google_containers/fluentd-elasticsearch:1.22
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/fluentd-elasticsearch:1.22
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®-kibana-controller-yaml&#34;&gt;é…ç½® kibana-controller.yaml&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff kibana-controller.yaml.orig kibana-controller.yaml
22c22
&amp;lt;         image: gcr.io/google_containers/kibana:v4.6.1-1
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/kibana:v4.6.1-1
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç»™-node-è®¾ç½®æ ‡ç­¾&#34;&gt;ç»™ Node è®¾ç½®æ ‡ç­¾&lt;/h2&gt;

&lt;p&gt;å®šä¹‰ DaemonSet &lt;code&gt;fluentd-es-v1.22&lt;/code&gt; æ—¶è®¾ç½®äº† nodeSelector &lt;code&gt;beta.kubernetes.io/fluentd-ds-ready=true&lt;/code&gt; ï¼Œæ‰€ä»¥éœ€è¦åœ¨æœŸæœ›è¿è¡Œ fluentd çš„ Node ä¸Šè®¾ç½®è¯¥æ ‡ç­¾ï¼›&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get nodes
NAME        STATUS    AGE       VERSION
172.20.0.113   Ready     1d        v1.6.0

$ kubectl label nodes 172.20.0.113 beta.kubernetes.io/fluentd-ds-ready=true
node &amp;quot;172.20.0.113&amp;quot; labeled
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»™å…¶ä»–ä¸¤å°nodeæ‰“ä¸ŠåŒæ ·çš„æ ‡ç­¾ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ‰§è¡Œå®šä¹‰æ–‡ä»¶&#34;&gt;æ‰§è¡Œå®šä¹‰æ–‡ä»¶&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f .
serviceaccount &amp;quot;efk&amp;quot; created
clusterrolebinding &amp;quot;efk&amp;quot; created
replicationcontroller &amp;quot;elasticsearch-logging-v1&amp;quot; created
service &amp;quot;elasticsearch-logging&amp;quot; created
daemonset &amp;quot;fluentd-es-v1.22&amp;quot; created
deployment &amp;quot;kibana-logging&amp;quot; created
service &amp;quot;kibana-logging&amp;quot; created
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æ£€æŸ¥æ‰§è¡Œç»“æœ&#34;&gt;æ£€æŸ¥æ‰§è¡Œç»“æœ&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get deployment -n kube-system|grep kibana
kibana-logging         1         1         1            1           2m

$ kubectl get pods -n kube-system|grep -E &#39;elasticsearch|fluentd|kibana&#39;
elasticsearch-logging-v1-mlstp          1/1       Running   0          1m
elasticsearch-logging-v1-nfbbf          1/1       Running   0          1m
fluentd-es-v1.22-31sm0                  1/1       Running   0          1m
fluentd-es-v1.22-bpgqs                  1/1       Running   0          1m
fluentd-es-v1.22-qmn7h                  1/1       Running   0          1m
kibana-logging-1432287342-0gdng         1/1       Running   0          1m

$ kubectl get service  -n kube-system|grep -E &#39;elasticsearch|kibana&#39;
elasticsearch-logging   10.254.77.62    &amp;lt;none&amp;gt;        9200/TCP                        2m
kibana-logging          10.254.8.113    &amp;lt;none&amp;gt;        5601/TCP                        2m
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;kibana Pod ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä¼šç”¨&lt;strong&gt;è¾ƒé•¿æ—¶é—´(10-20åˆ†é’Ÿ)&lt;/strong&gt;æ¥ä¼˜åŒ–å’Œ Cache çŠ¶æ€é¡µé¢ï¼Œå¯ä»¥ tailf è¯¥ Pod çš„æ—¥å¿—è§‚å¯Ÿè¿›åº¦ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl logs kibana-logging-1432287342-0gdng -n kube-system -f
ELASTICSEARCH_URL=http://elasticsearch-logging:9200
server.basePath: /api/v1/proxy/namespaces/kube-system/services/kibana-logging
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:08:06Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;info&amp;quot;,&amp;quot;optimize&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;message&amp;quot;:&amp;quot;Optimizing and caching bundles for kibana and statusPage. This may take a few minutes&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:17Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;info&amp;quot;,&amp;quot;optimize&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;message&amp;quot;:&amp;quot;Optimization of bundles for kibana and statusPage complete in 610.40 seconds&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:17Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:kibana@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:18Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:elasticsearch@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;yellow&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:kbn_vislib_vis_types@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:markdown_vis@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:metric_vis@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:spyModes@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:statusPage@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:table_vis@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from uninitialized to green - Ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;uninitialized&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;uninitialized&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:19Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;listening&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;message&amp;quot;:&amp;quot;Server running at http://0.0.0.0:5601&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:24Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:elasticsearch@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;yellow&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from yellow to yellow - No existing Kibana index found&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;yellow&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;Waiting for Elasticsearch&amp;quot;}
{&amp;quot;type&amp;quot;:&amp;quot;log&amp;quot;,&amp;quot;@timestamp&amp;quot;:&amp;quot;2017-04-12T13:18:29Z&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;status&amp;quot;,&amp;quot;plugin:elasticsearch@1.0.0&amp;quot;,&amp;quot;info&amp;quot;],&amp;quot;pid&amp;quot;:7,&amp;quot;state&amp;quot;:&amp;quot;green&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;Status changed from yellow to green - Kibana index ready&amp;quot;,&amp;quot;prevState&amp;quot;:&amp;quot;yellow&amp;quot;,&amp;quot;prevMsg&amp;quot;:&amp;quot;No existing Kibana index found&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;è®¿é—®-kibana&#34;&gt;è®¿é—® kibana&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;é€šè¿‡ kube-apiserver è®¿é—®ï¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è·å– monitoring-grafana æœåŠ¡ URL&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;   $ kubectl cluster-info
   Kubernetes master is running at https://172.20.0.113:6443
   Elasticsearch is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/elasticsearch-logging
   Heapster is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/heapster
   Kibana is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kibana-logging
   KubeDNS is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kube-dns
   kubernetes-dashboard is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard
   monitoring-grafana is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana
   monitoring-influxdb is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-influxdb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æµè§ˆå™¨è®¿é—® URLï¼š &lt;code&gt;https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kibana-logging/app/kibana&lt;/code&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;é€šè¿‡ kubectl proxy è®¿é—®ï¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åˆ›å»ºä»£ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;   $ kubectl proxy --address=&#39;172.20.0.113&#39; --port=8086 --accept-hosts=&#39;^*$&#39;
   Starting to serve on 172.20.0.113:8086
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æµè§ˆå™¨è®¿é—® URLï¼š&lt;code&gt;http://172.20.0.113:8086/api/v1/proxy/namespaces/kube-system/services/kibana-logging&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Settings -&amp;gt; Indices é¡µé¢åˆ›å»ºä¸€ä¸ª indexï¼ˆç›¸å½“äº mysql ä¸­çš„ä¸€ä¸ª databaseï¼‰ï¼Œé€‰ä¸­ &lt;code&gt;Index contains time-based events&lt;/code&gt;ï¼Œä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;logstash-*&lt;/code&gt; patternï¼Œç‚¹å‡» &lt;code&gt;Create&lt;/code&gt; ;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯èƒ½é‡åˆ°çš„é—®é¢˜&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ åœ¨è¿™é‡Œå‘ç°CreateæŒ‰é’®æ˜¯ç°è‰²çš„æ— æ³•ç‚¹å‡»ï¼Œä¸”Time-filed nameä¸­æ²¡æœ‰é€‰é¡¹ï¼Œfluentdè¦è¯»å–&lt;code&gt;/var/log/containers/&lt;/code&gt;ç›®å½•ä¸‹çš„logæ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—æ˜¯ä»&lt;code&gt;/var/lib/docker/containers/${CONTAINER_ID}/${CONTAINER_ID}-json.log&lt;/code&gt;é“¾æ¥è¿‡æ¥çš„ï¼ŒæŸ¥çœ‹ä½ çš„dockeré…ç½®ï¼Œ&lt;code&gt;â€”log-dirver&lt;/code&gt;éœ€è¦è®¾ç½®ä¸º&lt;strong&gt;json-file&lt;/strong&gt;æ ¼å¼ï¼Œé»˜è®¤çš„å¯èƒ½æ˜¯&lt;strong&gt;journald&lt;/strong&gt;ï¼Œå‚è€ƒ&lt;a href=&#34;[https://docs.docker.com/engine/admin/logging/overview/#examples](https://docs.docker.com/engine/admin/logging/overview/#examples)&#34;&gt;docker logging&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-es-setting.png&#34; alt=&#34;es-setting&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ›å»ºIndexåï¼Œå¯ä»¥åœ¨ &lt;code&gt;Discover&lt;/code&gt; ä¸‹çœ‹åˆ° ElasticSearch logging ä¸­æ±‡èšçš„æ—¥å¿—ï¼›&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-efk-kibana.jpg&#34; alt=&#34;es-home&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è‡³æ­¤Kubernetesçš„æ‰€æœ‰ç¯å¢ƒéƒ½å®‰è£…å®Œæˆã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨å¼€å¯TLSçš„Kubernetes1.6é›†ç¾¤ä¸Šå®‰è£…heapster</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation-with-tls/</link>
      <pubDate>Wed, 12 Apr 2017 20:20:19 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation-with-tls/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2016080801.jpg&#34; alt=&#34;å¤§å–µ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šå¤§å–µ Aug 8,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®(forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œåœ¨å¼€å¯äº†TLSéªŒè¯çš„é›†ç¾¤ä¸­éƒ¨ç½²heapsterï¼ŒåŒ…æ‹¬influxdbã€grafanaç­‰ç»„ä»¶ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®å’Œå®‰è£…heapster&#34;&gt;é…ç½®å’Œå®‰è£…Heapster&lt;/h2&gt;

&lt;p&gt;åˆ° &lt;a href=&#34;https://github.com/kubernetes/heapster/releases&#34;&gt;heapster release é¡µé¢&lt;/a&gt; ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ heapsterã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ wget https://github.com/kubernetes/heapster/archive/v1.3.0.zip
$ unzip v1.3.0.zip
$ mv v1.3.0.zip heapster-1.3.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–‡ä»¶ç›®å½•ï¼š &lt;code&gt;heapster-1.3.0/deploy/kube-config/influxdb&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cd heapster-1.3.0/deploy/kube-config/influxdb
$ ls *.yaml
grafana-deployment.yaml  grafana-service.yaml  heapster-deployment.yaml  heapster-service.yaml  influxdb-deployment.yaml  influxdb-service.yaml heapster-rbac.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬è‡ªå·±åˆ›å»ºäº†heapsterçš„rbacé…ç½®&lt;code&gt;heapster-rbac.yaml&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼š&lt;a href=&#34;./manifests/heapster&#34;&gt;heapster&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®-grafana-deployment&#34;&gt;é…ç½® grafana-deployment&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff grafana-deployment.yaml.orig grafana-deployment.yaml
16c16
&amp;lt;         image: gcr.io/google_containers/heapster-grafana-amd64:v4.0.2
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-grafana-amd64:v4.0.2
40,41c40,41
&amp;lt;           # value: /api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/
&amp;lt;           value: /
---
&amp;gt;           value: /api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/
&amp;gt;           #value: /
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœåç»­ä½¿ç”¨ kube-apiserver æˆ–è€… kubectl proxy è®¿é—® grafana dashboardï¼Œåˆ™å¿…é¡»å°† &lt;code&gt;GF_SERVER_ROOT_URL&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/&lt;/code&gt;ï¼Œå¦åˆ™åç»­è®¿é—®grafanaæ—¶è®¿é—®æ—¶æç¤ºæ‰¾ä¸åˆ°&lt;code&gt;http://10.64.3.7:8086/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/api/dashboards/home&lt;/code&gt; é¡µé¢ï¼›&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®-heapster-deployment&#34;&gt;é…ç½® heapster-deployment&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff heapster-deployment.yaml.orig heapster-deployment.yaml
16c16
&amp;lt;         image: gcr.io/google_containers/heapster-amd64:v1.3.0-beta.1
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-amd64:v1.3.0-beta.1
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®-influxdb-deployment&#34;&gt;é…ç½® influxdb-deployment&lt;/h2&gt;

&lt;p&gt;influxdb å®˜æ–¹å»ºè®®ä½¿ç”¨å‘½ä»¤è¡Œæˆ– HTTP API æ¥å£æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œä» v1.1.0 ç‰ˆæœ¬å¼€å§‹é»˜è®¤å…³é—­ admin UIï¼Œå°†åœ¨åç»­ç‰ˆæœ¬ä¸­ç§»é™¤ admin UI æ’ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å¼€å¯é•œåƒä¸­ admin UIçš„åŠæ³•å¦‚ä¸‹ï¼šå…ˆå¯¼å‡ºé•œåƒä¸­çš„ influxdb é…ç½®æ–‡ä»¶ï¼Œå¼€å¯ admin æ’ä»¶åï¼Œå†å°†é…ç½®æ–‡ä»¶å†…å®¹å†™å…¥ ConfigMapï¼Œæœ€åæŒ‚è½½åˆ°é•œåƒä¸­ï¼Œè¾¾åˆ°è¦†ç›–åŸå§‹é…ç½®çš„ç›®çš„ï¼š&lt;/p&gt;

&lt;p&gt;æ³¨æ„ï¼šmanifests ç›®å½•å·²ç»æä¾›äº† &lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/manifests/heapster/influxdb-cm.yaml&#34;&gt;ä¿®æ”¹åçš„ ConfigMap å®šä¹‰æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ # å¯¼å‡ºé•œåƒä¸­çš„ influxdb é…ç½®æ–‡ä»¶
$ docker run --rm --entrypoint &#39;cat&#39;  -ti lvanneo/heapster-influxdb-amd64:v1.1.1 /etc/config.toml &amp;gt;config.toml.orig
$ cp config.toml.orig config.toml
$ # ä¿®æ”¹ï¼šå¯ç”¨ admin æ¥å£
$ vim config.toml
$ diff config.toml.orig config.toml
35c35
&amp;lt;   enabled = false
---
&amp;gt;   enabled = true
$ # å°†ä¿®æ”¹åçš„é…ç½®å†™å…¥åˆ° ConfigMap å¯¹è±¡ä¸­
$ kubectl create configmap influxdb-config --from-file=config.toml  -n kube-system
configmap &amp;quot;influxdb-config&amp;quot; created
$ # å°† ConfigMap ä¸­çš„é…ç½®æ–‡ä»¶æŒ‚è½½åˆ° Pod ä¸­ï¼Œè¾¾åˆ°è¦†ç›–åŸå§‹é…ç½®çš„ç›®çš„
$ diff influxdb-deployment.yaml.orig influxdb-deployment.yaml
16c16
&amp;lt;         image: grc.io/google_containers/heapster-influxdb-amd64:v1.1.1
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-influxdb-amd64:v1.1.1
19a20,21
&amp;gt;         - mountPath: /etc/
&amp;gt;           name: influxdb-config
22a25,27
&amp;gt;       - name: influxdb-config
&amp;gt;         configMap:
&amp;gt;           name: influxdb-config
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®-monitoring-influxdb-service&#34;&gt;é…ç½® monitoring-influxdb Service&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;$ diff influxdb-service.yaml.orig influxdb-service.yaml
12a13
&amp;gt;   type: NodePort
15a17,20
&amp;gt;     name: http
&amp;gt;   - port: 8083
&amp;gt;     targetPort: 8083
&amp;gt;     name: admin
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;å®šä¹‰ç«¯å£ç±»å‹ä¸º NodePortï¼Œé¢å¤–å¢åŠ äº† admin ç«¯å£æ˜ å°„ï¼Œç”¨äºåç»­æµè§ˆå™¨è®¿é—® influxdb çš„ admin UI ç•Œé¢ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;æ‰§è¡Œæ‰€æœ‰å®šä¹‰æ–‡ä»¶&#34;&gt;æ‰§è¡Œæ‰€æœ‰å®šä¹‰æ–‡ä»¶&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ pwd
/root/heapster-1.3.0/deploy/kube-config/influxdb
$ ls *.yaml
grafana-service.yaml      heapster-rbac.yaml     influxdb-cm.yaml          influxdb-service.yaml
grafana-deployment.yaml  heapster-deployment.yaml  heapster-service.yaml  influxdb-deployment.yaml
$ kubectl create -f  .
deployment &amp;quot;monitoring-grafana&amp;quot; created
service &amp;quot;monitoring-grafana&amp;quot; created
deployment &amp;quot;heapster&amp;quot; created
serviceaccount &amp;quot;heapster&amp;quot; created
clusterrolebinding &amp;quot;heapster&amp;quot; created
service &amp;quot;heapster&amp;quot; created
configmap &amp;quot;influxdb-config&amp;quot; created
deployment &amp;quot;monitoring-influxdb&amp;quot; created
service &amp;quot;monitoring-influxdb&amp;quot; created
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æ£€æŸ¥æ‰§è¡Œç»“æœ&#34;&gt;æ£€æŸ¥æ‰§è¡Œç»“æœ&lt;/h2&gt;

&lt;p&gt;æ£€æŸ¥ Deployment&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get deployments -n kube-system | grep -E &#39;heapster|monitoring&#39;
heapster               1         1         1            1           2m
monitoring-grafana     1         1         1            1           2m
monitoring-influxdb    1         1         1            1           2m
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ£€æŸ¥ Pods&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get pods -n kube-system | grep -E &#39;heapster|monitoring&#39;
heapster-110704576-gpg8v                1/1       Running   0          2m
monitoring-grafana-2861879979-9z89f     1/1       Running   0          2m
monitoring-influxdb-1411048194-lzrpc    1/1       Running   0          2m
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ£€æŸ¥ kubernets dashboard ç•Œé¢ï¼Œçœ‹æ˜¯æ˜¾ç¤ºå„ Nodesã€Pods çš„ CPUã€å†…å­˜ã€è´Ÿè½½ç­‰åˆ©ç”¨ç‡æ›²çº¿å›¾ï¼›&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-dashboard-with-heapster.jpg&#34; alt=&#34;dashboard-heapster&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;è®¿é—®-grafana&#34;&gt;è®¿é—® grafana&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;é€šè¿‡ kube-apiserver è®¿é—®ï¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è·å– monitoring-grafana æœåŠ¡ URL&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;   $ kubectl cluster-info
   Kubernetes master is running at https://172.20.0.113:6443
   Heapster is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/heapster
   KubeDNS is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kube-dns
   kubernetes-dashboard is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard
   monitoring-grafana is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana
   monitoring-influxdb is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-influxdb

   To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æµè§ˆå™¨è®¿é—® URLï¼š &lt;code&gt;http://172.20.0.113:8080/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana&lt;/code&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;é€šè¿‡ kubectl proxy è®¿é—®ï¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åˆ›å»ºä»£ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;   $ kubectl proxy --address=&#39;172.20.0.113&#39; --port=8086 --accept-hosts=&#39;^*$&#39;
   Starting to serve on 172.20.0.113:8086
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æµè§ˆå™¨è®¿é—® URLï¼š&lt;code&gt;http://172.20.0.113:8086/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-heapster-grafana.jpg&#34; alt=&#34;grafana&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;è®¿é—®-influxdb-admin-ui&#34;&gt;è®¿é—® influxdb admin UI&lt;/h2&gt;

&lt;p&gt;è·å– influxdb http 8086 æ˜ å°„çš„ NodePort&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl get svc -n kube-system|grep influxdb
monitoring-influxdb    10.254.22.46    &amp;lt;nodes&amp;gt;       8086:32299/TCP,8083:30269/TCP   9m
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€šè¿‡ kube-apiserver çš„&lt;strong&gt;éå®‰å…¨ç«¯å£&lt;/strong&gt;è®¿é—® influxdb çš„ admin UI ç•Œé¢ï¼š &lt;code&gt;http://172.20.0.113:8080/api/v1/proxy/namespaces/kube-system/services/monitoring-influxdb:8083/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é¡µé¢çš„ â€œConnection Settingsâ€ çš„ Host ä¸­è¾“å…¥ node IPï¼Œ Port ä¸­è¾“å…¥ 8086 æ˜ å°„çš„ nodePort å¦‚ä¸Šé¢çš„ 32299ï¼Œç‚¹å‡» â€œSaveâ€ å³å¯ï¼ˆæˆ‘çš„é›†ç¾¤ä¸­çš„åœ°å€æ˜¯172.20.0.113:32299ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-influxdb-heapster.jpg&#34; alt=&#34;kubernetes-influxdb-heapster&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ°æ­¤Heapsterå·²ç»éƒ¨ç½²å®Œæˆã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨å¼€å¯TLSçš„Kubernetes1.6é›†ç¾¤ä¸Šå®‰è£…dashboard</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation-with-tls/</link>
      <pubDate>Wed, 12 Apr 2017 15:53:39 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation-with-tls/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2016082001.jpg&#34; alt=&#34;ä¸œç›´é—¨&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šä¸œç›´é—¨æ¡¥ Aug 20,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®(forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œåœ¨å¼€å¯äº†TLSéªŒè¯çš„é›†ç¾¤ä¸­éƒ¨ç½²dashboardã€‚&lt;/p&gt;

&lt;p&gt;æ„Ÿè°¢&lt;a href=&#34;github.com/opsnull&#34;&gt;opsnull&lt;/a&gt;å’Œ&lt;a href=&#34;github.com/ipchy&#34;&gt;ipchy&lt;/a&gt;çš„ç»†å¿ƒè§£ç­”ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…ç¯å¢ƒé…ç½®ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CentOS 7.2.1511&lt;/li&gt;
&lt;li&gt;Docker 1.12.5&lt;/li&gt;
&lt;li&gt;Flannel 0.7&lt;/li&gt;
&lt;li&gt;Kubernetes 1.6.0&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;é…ç½®å’Œå®‰è£…-dashboard&#34;&gt;é…ç½®å’Œå®‰è£… dashboard&lt;/h2&gt;

&lt;p&gt;å®˜æ–¹æ–‡ä»¶ç›®å½•ï¼š&lt;code&gt;kubernetes/cluster/addons/dashboard&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨çš„æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ls *.yaml
dashboard-controller.yaml  dashboard-service.yaml dashboard-rbac.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼š&lt;a href=&#34;./manifests/dashboard&#34;&gt;dashboard&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç”±äº &lt;code&gt;kube-apiserver&lt;/code&gt; å¯ç”¨äº† &lt;code&gt;RBAC&lt;/code&gt; æˆæƒï¼Œè€Œå®˜æ–¹æºç ç›®å½•çš„ &lt;code&gt;dashboard-controller.yaml&lt;/code&gt; æ²¡æœ‰å®šä¹‰æˆæƒçš„ ServiceAccountï¼Œæ‰€ä»¥åç»­è®¿é—® &lt;code&gt;kube-apiserver&lt;/code&gt; çš„ API æ—¶ä¼šè¢«æ‹’ç»ï¼Œwebä¸­æç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Forbidden (403)

User &amp;quot;system:serviceaccount:kube-system:default&amp;quot; cannot list jobs.batch in the namespace &amp;quot;default&amp;quot;. (get jobs.batch)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¢åŠ äº†ä¸€ä¸ª&lt;code&gt;dashboard-rbac.yaml&lt;/code&gt;æ–‡ä»¶ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º dashboard çš„ ServiceAccountï¼Œç„¶åå°†å®ƒå’Œ Cluster Role view ç»‘å®šã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®dashboard-service&#34;&gt;é…ç½®dashboard-service&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff dashboard-service.yaml.orig dashboard-service.yaml
10a11
&amp;gt;   type: NodePort
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;æŒ‡å®šç«¯å£ç±»å‹ä¸º NodePortï¼Œè¿™æ ·å¤–ç•Œå¯ä»¥é€šè¿‡åœ°å€ nodeIP:nodePort è®¿é—® dashboardï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;é…ç½®dashboard-controller&#34;&gt;é…ç½®dashboard-controller&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff dashboard-controller.yaml.orig dashboard-controller.yaml
23c23
&amp;lt;         image: gcr.io/google_containers/kubernetes-dashboard-amd64:v1.6.0
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/kubernetes-dashboard-amd64:v1.6.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æ‰§è¡Œæ‰€æœ‰å®šä¹‰æ–‡ä»¶&#34;&gt;æ‰§è¡Œæ‰€æœ‰å®šä¹‰æ–‡ä»¶&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ pwd
/root/kubernetes/cluster/addons/dashboard
$ ls *.yaml
dashboard-controller.yaml  dashboard-service.yaml
$ kubectl create -f  .
service &amp;quot;kubernetes-dashboard&amp;quot; created
deployment &amp;quot;kubernetes-dashboard&amp;quot; created
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æ£€æŸ¥æ‰§è¡Œç»“æœ&#34;&gt;æ£€æŸ¥æ‰§è¡Œç»“æœ&lt;/h2&gt;

&lt;p&gt;æŸ¥çœ‹åˆ†é…çš„ NodePort&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get services kubernetes-dashboard -n kube-system
NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
kubernetes-dashboard   10.254.224.130   &amp;lt;nodes&amp;gt;       80:30312/TCP   25s
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;NodePort 30312æ˜ å°„åˆ° dashboard pod 80ç«¯å£ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ£€æŸ¥ controller&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get deployment kubernetes-dashboard  -n kube-system
NAME                   DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-dashboard   1         1         1            1           3m
$ kubectl get pods  -n kube-system | grep dashboard
kubernetes-dashboard-1339745653-pmn6z   1/1       Running   0          4m
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;è®¿é—®dashboard&#34;&gt;è®¿é—®dashboard&lt;/h2&gt;

&lt;p&gt;æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;kubernetes-dashboard æœåŠ¡æš´éœ²äº† NodePortï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;http://NodeIP:nodePort&lt;/code&gt; åœ°å€è®¿é—® dashboardï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡ kube-apiserver è®¿é—® dashboardï¼ˆhttps 6443ç«¯å£å’Œhttp 8080ç«¯å£æ–¹å¼ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡ kubectl proxy è®¿é—® dashboardï¼š&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;é€šè¿‡-kubectl-proxy-è®¿é—®-dashboard&#34;&gt;é€šè¿‡ kubectl proxy è®¿é—® dashboard&lt;/h3&gt;

&lt;p&gt;å¯åŠ¨ä»£ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl proxy --address=&#39;172.20.0.113&#39; --port=8086 --accept-hosts=&#39;^*$&#39;
Starting to serve on 172.20.0.113:8086
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;éœ€è¦æŒ‡å®š &lt;code&gt;--accept-hosts&lt;/code&gt; é€‰é¡¹ï¼Œå¦åˆ™æµè§ˆå™¨è®¿é—® dashboard é¡µé¢æ—¶æç¤º â€œUnauthorizedâ€ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æµè§ˆå™¨è®¿é—® URLï¼š&lt;code&gt;http://172.20.0.113:8086/ui&lt;/code&gt;
è‡ªåŠ¨è·³è½¬åˆ°ï¼š&lt;code&gt;http://172.20.0.113:8086/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard/#/workload?namespace=default&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;é€šè¿‡-kube-apiserver-è®¿é—®dashboard&#34;&gt;é€šè¿‡ kube-apiserver è®¿é—®dashboard&lt;/h3&gt;

&lt;p&gt;è·å–é›†ç¾¤æœåŠ¡åœ°å€åˆ—è¡¨&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl cluster-info
Kubernetes master is running at https://172.20.0.113:6443
KubeDNS is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kube-dns
kubernetes-dashboard is running at https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æµè§ˆå™¨è®¿é—® URLï¼š&lt;code&gt;https://172.20.0.113:6443/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard&lt;/code&gt;ï¼ˆæµè§ˆå™¨ä¼šæç¤ºè¯ä¹¦éªŒè¯ï¼Œå› ä¸ºé€šè¿‡åŠ å¯†é€šé“ï¼Œä»¥æ”¹æ–¹å¼è®¿é—®çš„è¯ï¼Œéœ€è¦æå‰å¯¼å…¥è¯ä¹¦åˆ°ä½ çš„è®¡ç®—æœºä¸­ï¼‰ã€‚è¿™æ˜¯æˆ‘å½“æ—¶åœ¨è¿™é‡åˆ°çš„å‘ï¼š&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster/issues/5&#34;&gt;é€šè¿‡ kube-apiserver è®¿é—®dashboardï¼Œæç¤ºUser &amp;ldquo;system:anonymous&amp;rdquo; cannot proxy services in the namespace &amp;ldquo;kube-system&amp;rdquo;. #5&lt;/a&gt;ï¼Œå·²ç»è§£å†³ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯¼å…¥è¯ä¹¦&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å°†ç”Ÿæˆçš„admin.pemè¯ä¹¦è½¬æ¢æ ¼å¼&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openssl pkcs12 -export -in admin.pem  -out admin.p12 -inkey admin-key.pem
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°†ç”Ÿæˆçš„&lt;code&gt;admin.p12&lt;/code&gt;è¯ä¹¦å¯¼å…¥çš„ä½ çš„ç”µè„‘ï¼Œå¯¼å‡ºçš„æ—¶å€™è®°ä½ä½ è®¾ç½®çš„å¯†ç ï¼Œå¯¼å…¥çš„æ—¶å€™è¿˜è¦ç”¨åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä¸æƒ³ä½¿ç”¨&lt;strong&gt;https&lt;/strong&gt;çš„è¯ï¼Œå¯ä»¥ç›´æ¥è®¿é—®insecure port 8080ç«¯å£:&lt;code&gt;http://172.20.0.113:8080/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-dashboard-raw.jpg&#34; alt=&#34;kubernetes-dashboard&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±äºç¼ºå°‘ Heapster æ’ä»¶ï¼Œå½“å‰ dashboard ä¸èƒ½å±•ç¤º Podã€Nodes çš„ CPUã€å†…å­˜ç­‰ metric å›¾å½¢ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹kubednsé…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-kubedns-installation/</link>
      <pubDate>Wed, 12 Apr 2017 13:04:45 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-kubedns-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2016082701.jpg&#34; alt=&#34;ä¸œä¸‰ç¯&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šé›¨è¿‡å¤©æ™´@åŒ—äº¬å®šç¦åº„ Aug 27,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®(forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œä½¿ç”¨yamlæ–‡ä»¶éƒ¨ç½²&lt;strong&gt;kubedns&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…ç¯å¢ƒé…ç½®ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CentOS 7.2.1511&lt;/li&gt;
&lt;li&gt;Docker 1.12.5&lt;/li&gt;
&lt;li&gt;Flannel 0.7&lt;/li&gt;
&lt;li&gt;Kubernetes 1.6.0&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å®‰è£…å’Œé…ç½®-kubedns-æ’ä»¶&#34;&gt;å®‰è£…å’Œé…ç½® kubedns æ’ä»¶&lt;/h2&gt;

&lt;p&gt;å®˜æ–¹çš„yamlæ–‡ä»¶ç›®å½•ï¼š&lt;code&gt;kubernetes/cluster/addons/dns&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¯¥æ’ä»¶ç›´æ¥ä½¿ç”¨kuberneteséƒ¨ç½²ï¼Œå®˜æ–¹çš„é…ç½®æ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹é•œåƒï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.1
gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.1
gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘cloneäº†ä¸Šè¿°é•œåƒï¼Œä¸Šä¼ åˆ°æˆ‘çš„ç§æœ‰é•œåƒä»“åº“ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-dnsmasq-nanny-amd64:1.14.1
sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-kube-dns-amd64:1.14.1
sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-sidecar-amd64:1.14.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åŒæ—¶ä¸Šä¼ äº†ä¸€ä»½åˆ°æ—¶é€Ÿäº‘å¤‡ä»½ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;index.tenxcloud.com/jimmy/k8s-dns-dnsmasq-nanny-amd64:1.14.1
index.tenxcloud.com/jimmy/k8s-dns-kube-dns-amd64:1.14.1
index.tenxcloud.com/jimmy/k8s-dns-sidecar-amd64:1.14.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»¥ä¸‹yamlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ˜¯ç§æœ‰é•œåƒä»“åº“ä¸­çš„é•œåƒã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubedns-cm.yaml  
kubedns-sa.yaml  
kubedns-controller.yaml  
kubedns-svc.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼š&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;githubé¡¹ç›®ä¸­çš„manifest/kubedns/ç›®å½•&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç³»ç»Ÿé¢„å®šä¹‰çš„-rolebinding&#34;&gt;ç³»ç»Ÿé¢„å®šä¹‰çš„ RoleBinding&lt;/h2&gt;

&lt;p&gt;é¢„å®šä¹‰çš„ RoleBinding &lt;code&gt;system:kube-dns&lt;/code&gt; å°† kube-system å‘½åç©ºé—´çš„ &lt;code&gt;kube-dns&lt;/code&gt; ServiceAccount ä¸ &lt;code&gt;system:kube-dns&lt;/code&gt; Role ç»‘å®šï¼Œ è¯¥ Role å…·æœ‰è®¿é—® kube-apiserver DNS ç›¸å…³ API çš„æƒé™ï¼›&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Bash&#34;&gt;$ kubectl get clusterrolebindings system:kube-dns -o yaml
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: &amp;quot;true&amp;quot;
  creationTimestamp: 2017-04-11T11:20:42Z
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: system:kube-dns
  resourceVersion: &amp;quot;58&amp;quot;
  selfLink: /apis/rbac.authorization.k8s.io/v1beta1/clusterrolebindingssystem%3Akube-dns
  uid: e61f4d92-1ea8-11e7-8cd7-f4e9d49f8ed0
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:kube-dns
subjects:
- kind: ServiceAccount
  name: kube-dns
  namespace: kube-system
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;kubedns-controller.yaml&lt;/code&gt; ä¸­å®šä¹‰çš„ Pods æ—¶ä½¿ç”¨äº† &lt;code&gt;kubedns-sa.yaml&lt;/code&gt; æ–‡ä»¶å®šä¹‰çš„ &lt;code&gt;kube-dns&lt;/code&gt; ServiceAccountï¼Œæ‰€ä»¥å…·æœ‰è®¿é—® kube-apiserver DNS ç›¸å…³ API çš„æƒé™ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®-kube-dns-serviceaccount&#34;&gt;é…ç½® kube-dns ServiceAccount&lt;/h2&gt;

&lt;p&gt;æ— éœ€ä¿®æ”¹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®-kube-dns-æœåŠ¡&#34;&gt;é…ç½® &lt;code&gt;kube-dns&lt;/code&gt; æœåŠ¡&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff kubedns-svc.yaml.base kubedns-svc.yaml
30c30
&amp;lt;   clusterIP: __PILLAR__DNS__SERVER__
---
&amp;gt;   clusterIP: 10.254.0.2
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;spec.clusterIP = 10.254.0.2ï¼Œå³æ˜ç¡®æŒ‡å®šäº† kube-dns Service IPï¼Œè¿™ä¸ª IP éœ€è¦å’Œ kubelet çš„ &lt;code&gt;--cluster-dns&lt;/code&gt; å‚æ•°å€¼ä¸€è‡´ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;é…ç½®-kube-dns-deployment&#34;&gt;é…ç½® &lt;code&gt;kube-dns&lt;/code&gt; Deployment&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ diff kubedns-controller.yaml.base kubedns-controller.yaml
58c58
&amp;lt;         image: gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.1
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-kube-dns-amd64:v1.14.1
88c88
&amp;lt;         - --domain=__PILLAR__DNS__DOMAIN__.
---
&amp;gt;         - --domain=cluster.local.
92c92
&amp;lt;         __PILLAR__FEDERATIONS__DOMAIN__MAP__
---
&amp;gt;         #__PILLAR__FEDERATIONS__DOMAIN__MAP__
110c110
&amp;lt;         image: gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.1
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-dnsmasq-nanny-amd64:v1.14.1
129c129
&amp;lt;         - --server=/__PILLAR__DNS__DOMAIN__/127.0.0.1#10053
---
&amp;gt;         - --server=/cluster.local./127.0.0.1#10053
148c148
&amp;lt;         image: gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.1
---
&amp;gt;         image: sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-sidecar-amd64:v1.14.1
161,162c161,162
&amp;lt;         - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.__PILLAR__DNS__DOMAIN__,5,A
&amp;lt;         - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.__PILLAR__DNS__DOMAIN__,5,A
---
&amp;gt;         - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A
&amp;gt;         - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç³»ç»Ÿå·²ç»åšäº† RoleBinding çš„ &lt;code&gt;kube-dns&lt;/code&gt; ServiceAccountï¼Œè¯¥è´¦æˆ·å…·æœ‰è®¿é—® kube-apiserver DNS ç›¸å…³ API çš„æƒé™ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;æ‰§è¡Œæ‰€æœ‰å®šä¹‰æ–‡ä»¶&#34;&gt;æ‰§è¡Œæ‰€æœ‰å®šä¹‰æ–‡ä»¶&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ pwd
/root/kubedns
$ ls *.yaml
kubedns-cm.yaml  kubedns-controller.yaml  kubedns-sa.yaml  kubedns-svc.yaml
$ kubectl create -f .
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æ£€æŸ¥-kubedns-åŠŸèƒ½&#34;&gt;æ£€æŸ¥ kubedns åŠŸèƒ½&lt;/h2&gt;

&lt;p&gt;æ–°å»ºä¸€ä¸ª Deployment&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cat  my-nginx.yaml
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: my-nginx
spec:
  replicas: 2
  template:
    metadata:
      labels:
        run: my-nginx
    spec:
      containers:
      - name: my-nginx
        image: sz-pg-oam-docker-hub-001.tendcloud.com/library/nginx:1.9
        ports:
        - containerPort: 80
$ kubectl create -f my-nginx.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Export è¯¥ Deployment, ç”Ÿæˆ &lt;code&gt;my-nginx&lt;/code&gt; æœåŠ¡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl expose deploy my-nginx
$ kubectl get services --all-namespaces |grep my-nginx
default       my-nginx     10.254.179.239   &amp;lt;none&amp;gt;        80/TCP          42m
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ›å»ºå¦ä¸€ä¸ª Podï¼ŒæŸ¥çœ‹ &lt;code&gt;/etc/resolv.conf&lt;/code&gt; æ˜¯å¦åŒ…å« &lt;code&gt;kubelet&lt;/code&gt; é…ç½®çš„ &lt;code&gt;--cluster-dns&lt;/code&gt; å’Œ &lt;code&gt;--cluster-domain&lt;/code&gt;ï¼Œæ˜¯å¦èƒ½å¤Ÿå°†æœåŠ¡ &lt;code&gt;my-nginx&lt;/code&gt; è§£æåˆ° Cluster IP &lt;code&gt;10.254.179.239&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl create -f nginx-pod.yaml
$ kubectl exec  nginx -i -t -- /bin/bash
root@nginx:/# cat /etc/resolv.conf
nameserver 10.254.0.2
search default.svc.cluster.local. svc.cluster.local. cluster.local. tendcloud.com
options ndots:5

root@nginx:/# ping my-nginx
PING my-nginx.default.svc.cluster.local (10.254.179.239): 56 data bytes
76 bytes from 119.147.223.109: Destination Net Unreachable
^C--- my-nginx.default.svc.cluster.local ping statistics ---

root@nginx:/# ping kubernetes
PING kubernetes.default.svc.cluster.local (10.254.0.1): 56 data bytes
^C--- kubernetes.default.svc.cluster.local ping statistics ---
11 packets transmitted, 0 packets received, 100% packet loss

root@nginx:/# ping kube-dns.kube-system.svc.cluster.local
PING kube-dns.kube-system.svc.cluster.local (10.254.0.2): 56 data bytes
^C--- kube-dns.kube-system.svc.cluster.local ping statistics ---
6 packets transmitted, 0 packets received, 100% packet loss
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»ç»“æœæ¥çœ‹ï¼Œserviceåç§°å¯ä»¥æ­£å¸¸è§£æã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes nodeèŠ‚ç‚¹å®‰è£…</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-node-installation/</link>
      <pubDate>Tue, 11 Apr 2017 22:20:31 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-node-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2016121101.jpg&#34; alt=&#34;ä¸œä¸‰ç¯&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šå¤ªé˜³å®«æ¡¥@åŒ—äº¬ä¸œåŒ—ä¸‰ç¯ Dec 11,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®(forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œéƒ¨ç½²nodeèŠ‚ç‚¹ä¸Šçš„&lt;code&gt;kube-proxy&lt;/code&gt;å’Œ&lt;code&gt;kubelet&lt;/code&gt;ï¼ŒåŒæ—¶å¯¹ä¹‹å‰éƒ¨ç½²çš„flannelæ”¹é€ ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…ç¯å¢ƒé…ç½®ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CentOS7.2.1511&lt;/li&gt;
&lt;li&gt;Docker 1.12.5&lt;/li&gt;
&lt;li&gt;Flannel 0.7&lt;/li&gt;
&lt;li&gt;Kubernetes 1.6.0&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;éƒ¨ç½²kubernetes-nodeèŠ‚ç‚¹&#34;&gt;éƒ¨ç½²kubernetes nodeèŠ‚ç‚¹&lt;/h2&gt;

&lt;p&gt;kubernetes node èŠ‚ç‚¹åŒ…å«å¦‚ä¸‹ç»„ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Flanneldï¼šå‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« &lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-network-config/&#34;&gt;KubernetesåŸºäºFlannelçš„ç½‘ç»œé…ç½®&lt;/a&gt;ï¼Œä¹‹å‰æ²¡æœ‰é…ç½®TLSï¼Œç°åœ¨éœ€è¦åœ¨serivceé…ç½®æ–‡ä»¶ä¸­å¢åŠ TLSé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;Docker1.12.5ï¼šdockerçš„å®‰è£…å¾ˆç®€å•ï¼Œè¿™é‡Œä¹Ÿä¸è¯´äº†ã€‚&lt;/li&gt;
&lt;li&gt;kubelet&lt;/li&gt;
&lt;li&gt;kube-proxy&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢ç€é‡è®²&lt;code&gt;kubelet&lt;/code&gt;å’Œ&lt;code&gt;kube-proxy&lt;/code&gt;çš„å®‰è£…ï¼ŒåŒæ—¶è¿˜è¦å°†ä¹‹å‰å®‰è£…çš„flannelé›†æˆTLSéªŒè¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç›®å½•å’Œæ–‡ä»¶&#34;&gt;ç›®å½•å’Œæ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬å†æ£€æŸ¥ä¸€ä¸‹ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç»è¿‡å‰å‡ æ­¥æ“ä½œç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ls /etc/kubernetes/ssl
admin-key.pem  admin.pem  ca-key.pem  ca.pem  kube-proxy-key.pem  kube-proxy.pem  kubernetes-key.pem  kubernetes.pem
$ ls /etc/kubernetes/
apiserver  bootstrap.kubeconfig  config  controller-manager  kubelet  kube-proxy.kubeconfig  proxy  scheduler  ssl  token.csv
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®flanneld&#34;&gt;é…ç½®Flanneld&lt;/h2&gt;

&lt;p&gt;å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« &lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-network-config/&#34;&gt;KubernetesåŸºäºFlannelçš„ç½‘ç»œé…ç½®&lt;/a&gt;ï¼Œä¹‹å‰æ²¡æœ‰é…ç½®TLSï¼Œç°åœ¨éœ€è¦åœ¨serivceé…ç½®æ–‡ä»¶ä¸­å¢åŠ TLSé…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;serviceé…ç½®æ–‡ä»¶&lt;code&gt;/usr/lib/systemd/system/flanneld.service&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Flanneld overlay address etcd agent
After=network.target
After=network-online.target
Wants=network-online.target
After=etcd.service
Before=docker.service

[Service]
Type=notify
EnvironmentFile=/etc/sysconfig/flanneld
EnvironmentFile=-/etc/sysconfig/docker-network
ExecStart=/usr/bin/flanneld-start $FLANNEL_OPTIONS
ExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker
Restart=on-failure

[Install]
WantedBy=multi-user.target
RequiredBy=docker.service
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;/etc/sysconfig/flanneld&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;# Flanneld configuration options  

# etcd url location.  Point this to the server where etcd runs
FLANNEL_ETCD_ENDPOINTS=&amp;quot;https://172.20.0.113:2379,https://172.20.0.114:2379,https://172.20.0.115:2379&amp;quot;

# etcd config key.  This is the configuration key that flannel queries
# For address range assignment
FLANNEL_ETCD_PREFIX=&amp;quot;/kube-centos/network&amp;quot;

# Any additional options that you want to pass
FLANNEL_OPTIONS=&amp;quot;-etcd-cafile=/etc/kubernetes/ssl/ca.pem -etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem -etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨FLANNEL_OPTIONSä¸­å¢åŠ TLSçš„é…ç½®ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…å’Œé…ç½®-kubelet&#34;&gt;å®‰è£…å’Œé…ç½® kubelet&lt;/h2&gt;

&lt;p&gt;kubelet å¯åŠ¨æ—¶å‘ kube-apiserver å‘é€ TLS bootstrapping è¯·æ±‚ï¼Œéœ€è¦å…ˆå°† bootstrap token æ–‡ä»¶ä¸­çš„ kubelet-bootstrap ç”¨æˆ·èµ‹äºˆ system:node-bootstrapper cluster è§’è‰²(role)ï¼Œ
ç„¶å kubelet æ‰èƒ½æœ‰æƒé™åˆ›å»ºè®¤è¯è¯·æ±‚(certificate signing requests)ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cd /etc/kubernetes
$ kubectl create clusterrolebinding kubelet-bootstrap \
  --clusterrole=system:node-bootstrapper \
  --user=kubelet-bootstrap
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--user=kubelet-bootstrap&lt;/code&gt; æ˜¯åœ¨ &lt;code&gt;/etc/kubernetes/token.csv&lt;/code&gt; æ–‡ä»¶ä¸­æŒ‡å®šçš„ç”¨æˆ·åï¼ŒåŒæ—¶ä¹Ÿå†™å…¥äº† &lt;code&gt;/etc/kubernetes/bootstrap.kubeconfig&lt;/code&gt; æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ä¸‹è½½æœ€æ–°çš„-kubelet-å’Œ-kube-proxy-äºŒè¿›åˆ¶æ–‡ä»¶&#34;&gt;ä¸‹è½½æœ€æ–°çš„ kubelet å’Œ kube-proxy äºŒè¿›åˆ¶æ–‡ä»¶&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ wget https://dl.k8s.io/v1.6.0/kubernetes-server-linux-amd64.tar.gz
$ tar -xzvf kubernetes-server-linux-amd64.tar.gz
$ cd kubernetes
$ tar -xzvf  kubernetes-src.tar.gz
$ cp -r ./server/bin/{kube-proxy,kubelet} /usr/bin/
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;åˆ›å»º-kubelet-çš„serviceé…ç½®æ–‡ä»¶&#34;&gt;åˆ›å»º kubelet çš„serviceé…ç½®æ–‡ä»¶&lt;/h3&gt;

&lt;p&gt;æ–‡ä»¶ä½ç½®&lt;code&gt;/usr/lib/systemd/system/kubelet.serivce&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Kubelet Server
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=docker.service
Requires=docker.service

[Service]
WorkingDirectory=/var/lib/kubelet
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/kubelet
ExecStart=/usr/bin/kubelet \
            $KUBE_LOGTOSTDERR \
            $KUBE_LOG_LEVEL \
            $KUBELET_API_SERVER \
            $KUBELET_ADDRESS \
            $KUBELET_PORT \
            $KUBELET_HOSTNAME \
            $KUBE_ALLOW_PRIV \
            $KUBELET_POD_INFRA_CONTAINER \
            $KUBELET_ARGS
Restart=on-failure

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;kubeletçš„é…ç½®æ–‡ä»¶&lt;code&gt;/etc/kubernetes/kubelet&lt;/code&gt;ã€‚å…¶ä¸­çš„IPåœ°å€æ›´æ”¹ä¸ºä½ çš„æ¯å°nodeèŠ‚ç‚¹çš„IPåœ°å€ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;###
## kubernetes kubelet (minion) config
#
## The address for the info server to serve on (set to 0.0.0.0 or &amp;quot;&amp;quot; for all interfaces)
KUBELET_ADDRESS=&amp;quot;--address=172.20.0.113&amp;quot;
#
## The port for the info server to serve on
#KUBELET_PORT=&amp;quot;--port=10250&amp;quot;
#
## You may leave this blank to use the actual hostname
KUBELET_HOSTNAME=&amp;quot;--hostname-override=172.20.0.113&amp;quot;
#
## location of the api-server
KUBELET_API_SERVER=&amp;quot;--api-servers=http://172.20.0.113:8080&amp;quot;
#
## pod infrastructure container
KUBELET_POD_INFRA_CONTAINER=&amp;quot;--pod-infra-container-image=sz-pg-oam-docker-hub-001.tendcloud.com/library/pod-infrastructure:rhel7&amp;quot;
#
## Add your own!
KUBELET_ARGS=&amp;quot;--cgroup-driver=systemd --cluster_dns=10.254.0.2 --experimental-bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig --kubeconfig=/etc/kubernetes/kubelet.kubeconfig --require-kubeconfig --cert-dir=/etc/kubernetes/ssl --cluster_domain=cluster.local. --hairpin-mode promiscuous-bridge --serialize-image-pulls=false&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--address&lt;/code&gt; ä¸èƒ½è®¾ç½®ä¸º &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼Œå¦åˆ™åç»­ Pods è®¿é—® kubelet çš„ API æ¥å£æ—¶ä¼šå¤±è´¥ï¼Œå› ä¸º Pods è®¿é—®çš„ &lt;code&gt;127.0.0.1&lt;/code&gt; æŒ‡å‘è‡ªå·±è€Œä¸æ˜¯ kubeletï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè®¾ç½®äº† &lt;code&gt;--hostname-override&lt;/code&gt; é€‰é¡¹ï¼Œåˆ™ &lt;code&gt;kube-proxy&lt;/code&gt; ä¹Ÿéœ€è¦è®¾ç½®è¯¥é€‰é¡¹ï¼Œå¦åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ° Node çš„æƒ…å†µï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--experimental-bootstrap-kubeconfig&lt;/code&gt; æŒ‡å‘ bootstrap kubeconfig æ–‡ä»¶ï¼Œkubelet ä½¿ç”¨è¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå’Œ token å‘ kube-apiserver å‘é€ TLS Bootstrapping è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;ç®¡ç†å‘˜é€šè¿‡äº† CSR è¯·æ±‚åï¼Œkubelet è‡ªåŠ¨åœ¨ &lt;code&gt;--cert-dir&lt;/code&gt; ç›®å½•åˆ›å»ºè¯ä¹¦å’Œç§é’¥æ–‡ä»¶(&lt;code&gt;kubelet-client.crt&lt;/code&gt; å’Œ &lt;code&gt;kubelet-client.key&lt;/code&gt;)ï¼Œç„¶åå†™å…¥ &lt;code&gt;--kubeconfig&lt;/code&gt; æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;å»ºè®®åœ¨ &lt;code&gt;--kubeconfig&lt;/code&gt; é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š &lt;code&gt;kube-apiserver&lt;/code&gt; åœ°å€ï¼Œå¦‚æœæœªæŒ‡å®š &lt;code&gt;--api-servers&lt;/code&gt; é€‰é¡¹ï¼Œåˆ™å¿…é¡»æŒ‡å®š &lt;code&gt;--require-kubeconfig&lt;/code&gt; é€‰é¡¹åæ‰ä»é…ç½®æ–‡ä»¶ä¸­è¯»å– kube-apiserver çš„åœ°å€ï¼Œå¦åˆ™ kubelet å¯åŠ¨åå°†æ‰¾ä¸åˆ° kube-apiserver (æ—¥å¿—ä¸­æç¤ºæœªæ‰¾åˆ° API Serverï¼‰ï¼Œ&lt;code&gt;kubectl get nodes&lt;/code&gt; ä¸ä¼šè¿”å›å¯¹åº”çš„ Node ä¿¡æ¯;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--cluster_dns&lt;/code&gt; æŒ‡å®š kubedns çš„ Service IP(å¯ä»¥å…ˆåˆ†é…ï¼Œåç»­åˆ›å»º kubedns æœåŠ¡æ—¶æŒ‡å®šè¯¥ IP)ï¼Œ&lt;code&gt;--cluster_domain&lt;/code&gt; æŒ‡å®šåŸŸååç¼€ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åŒæ—¶æŒ‡å®šåæ‰ä¼šç”Ÿæ•ˆï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®Œæ•´ unit è§ &lt;a href=&#34;./systemd/kubelet.service&#34;&gt;kubelet.service&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å¯åŠ¨kublet&#34;&gt;å¯åŠ¨kublet&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ systemctl daemon-reload
$ systemctl enable kubelet
$ systemctl start kubelet
$ systemctl status kubelet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;é€šè¿‡-kublet-çš„-tls-è¯ä¹¦è¯·æ±‚&#34;&gt;é€šè¿‡ kublet çš„ TLS è¯ä¹¦è¯·æ±‚&lt;/h3&gt;

&lt;p&gt;kubelet é¦–æ¬¡å¯åŠ¨æ—¶å‘ kube-apiserver å‘é€è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œå¿…é¡»é€šè¿‡å kubernetes ç³»ç»Ÿæ‰ä¼šå°†è¯¥ Node åŠ å…¥åˆ°é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;æŸ¥çœ‹æœªæˆæƒçš„ CSR è¯·æ±‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get csr
NAME        AGE       REQUESTOR           CONDITION
csr-2b308   4m        kubelet-bootstrap   Pending
$ kubectl get nodes
No resources found.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€šè¿‡ CSR è¯·æ±‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl certificate approve csr-2b308
certificatesigningrequest &amp;quot;csr-2b308&amp;quot; approved
$ kubectl get nodes
NAME        STATUS    AGE       VERSION
10.64.3.7   Ready     49m       v1.6.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡ªåŠ¨ç”Ÿæˆäº† kubelet kubeconfig æ–‡ä»¶å’Œå…¬ç§é’¥&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ls -l /etc/kubernetes/kubelet.kubeconfig
-rw------- 1 root root 2284 Apr  7 02:07 /etc/kubernetes/kubelet.kubeconfig
$ ls -l /etc/kubernetes/ssl/kubelet*
-rw-r--r-- 1 root root 1046 Apr  7 02:07 /etc/kubernetes/ssl/kubelet-client.crt
-rw------- 1 root root  227 Apr  7 02:04 /etc/kubernetes/ssl/kubelet-client.key
-rw-r--r-- 1 root root 1103 Apr  7 02:07 /etc/kubernetes/ssl/kubelet.crt
-rw------- 1 root root 1675 Apr  7 02:07 /etc/kubernetes/ssl/kubelet.key
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®-kube-proxy&#34;&gt;é…ç½® kube-proxy&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»º kube-proxy çš„serviceé…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ–‡ä»¶è·¯å¾„&lt;code&gt;/usr/lib/systemd/system/kube-proxy.service&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Kube-Proxy Server
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=network.target

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/proxy
ExecStart=/usr/bin/kube-proxy \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_PROXY_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;kube-proxyé…ç½®æ–‡ä»¶&lt;code&gt;/etc/kubernetes/proxy&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;###
# kubernetes proxy config

# default config should be adequate

# Add your own!
KUBE_PROXY_ARGS=&amp;quot;--bind-address=172.20.0.113 --hostname-override=172.20.0.113 --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig --cluster-cidr=10.254.0.0/16&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--hostname-override&lt;/code&gt; å‚æ•°å€¼å¿…é¡»ä¸ kubelet çš„å€¼ä¸€è‡´ï¼Œå¦åˆ™ kube-proxy å¯åŠ¨åä¼šæ‰¾ä¸åˆ°è¯¥ Nodeï¼Œä»è€Œä¸ä¼šåˆ›å»ºä»»ä½• iptables è§„åˆ™ï¼›&lt;/li&gt;
&lt;li&gt;kube-proxy æ ¹æ® &lt;code&gt;--cluster-cidr&lt;/code&gt; åˆ¤æ–­é›†ç¾¤å†…éƒ¨å’Œå¤–éƒ¨æµé‡ï¼ŒæŒ‡å®š &lt;code&gt;--cluster-cidr&lt;/code&gt; æˆ– &lt;code&gt;--masquerade-all&lt;/code&gt; é€‰é¡¹å kube-proxy æ‰ä¼šå¯¹è®¿é—® Service IP çš„è¯·æ±‚åš SNATï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--kubeconfig&lt;/code&gt; æŒ‡å®šçš„é…ç½®æ–‡ä»¶åµŒå…¥äº† kube-apiserver çš„åœ°å€ã€ç”¨æˆ·åã€è¯ä¹¦ã€ç§˜é’¥ç­‰è¯·æ±‚å’Œè®¤è¯ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;é¢„å®šä¹‰çš„ RoleBinding &lt;code&gt;cluster-admin&lt;/code&gt; å°†User &lt;code&gt;system:kube-proxy&lt;/code&gt; ä¸ Role &lt;code&gt;system:node-proxier&lt;/code&gt; ç»‘å®šï¼Œè¯¥ Role æˆäºˆäº†è°ƒç”¨ &lt;code&gt;kube-apiserver&lt;/code&gt; Proxy ç›¸å…³ API çš„æƒé™ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®Œæ•´ unit è§ &lt;a href=&#34;./systemd/kube-proxy.service&#34;&gt;kube-proxy.service&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å¯åŠ¨-kube-proxy&#34;&gt;å¯åŠ¨ kube-proxy&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ systemctl daemon-reload
$ systemctl enable kube-proxy
$ systemctl start kube-proxy
$ systemctl status kube-proxy
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;éªŒè¯æµ‹è¯•&#34;&gt;éªŒè¯æµ‹è¯•&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªniginxçš„serviceè¯•ä¸€ä¸‹é›†ç¾¤æ˜¯å¦å¯ç”¨ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl run nginx --replicas=2 --labels=&amp;quot;run=load-balancer-example&amp;quot; --image=sz-pg-oam-docker-hub-001.tendcloud.com/library/nginx:1.9  --port=80
deployment &amp;quot;nginx&amp;quot; created
$ kubectl expose deployment nginx --type=NodePort --name=example-service
service &amp;quot;example-service&amp;quot; exposed
$ kubectl describe svc example-service
Name:			example-service
Namespace:		default
Labels:			run=load-balancer-example
Annotations:		&amp;lt;none&amp;gt;
Selector:		run=load-balancer-example
Type:			NodePort
IP:			10.254.62.207
Port:			&amp;lt;unset&amp;gt;	80/TCP
NodePort:		&amp;lt;unset&amp;gt;	32724/TCP
Endpoints:		172.30.60.2:80,172.30.94.2:80
Session Affinity:	None
Events:			&amp;lt;none&amp;gt;
$ curl &amp;quot;10.254.62.207:80&amp;quot;
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;Welcome to nginx!&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Welcome to nginx!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;For online documentation and support please refer to
&amp;lt;a href=&amp;quot;http://nginx.org/&amp;quot;&amp;gt;nginx.org&amp;lt;/a&amp;gt;.&amp;lt;br/&amp;gt;
Commercial support is available at
&amp;lt;a href=&amp;quot;http://nginx.com/&amp;quot;&amp;gt;nginx.com&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;em&amp;gt;Thank you for using nginx.&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è®¿é—®&lt;code&gt;172.20.0.113:32724&lt;/code&gt;æˆ–&lt;code&gt;172.20.0.114:32724&lt;/code&gt;æˆ–è€…&lt;code&gt;172.20.0.115:32724&lt;/code&gt;éƒ½å¯ä»¥å¾—åˆ°nginxçš„é¡µé¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-installation-test-nginx.png&#34; alt=&#34;welcome-nginx&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetesé«˜å¯ç”¨masterèŠ‚ç‚¹å®‰è£…</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-ha-master-installation/</link>
      <pubDate>Tue, 11 Apr 2017 19:55:56 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-ha-master-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2015091402.jpg&#34; alt=&#34;åŒ—äº¬è¥¿å±±&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šé¬¼è§æ„@åŒ—äº¬è¥¿å±± Sep 14,2015ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®((forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;))ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œéƒ¨ç½²masterèŠ‚ç‚¹çš„&lt;code&gt;kube-apiserver&lt;/code&gt;ã€&lt;code&gt;kube-controller-manager&lt;/code&gt;å’Œ&lt;code&gt;kube-scheduler&lt;/code&gt;çš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é«˜å¯ç”¨kubernetes-masterèŠ‚ç‚¹å®‰è£…&#34;&gt;é«˜å¯ç”¨kubernetes masterèŠ‚ç‚¹å®‰è£…&lt;/h2&gt;

&lt;p&gt;kubernetes master èŠ‚ç‚¹åŒ…å«çš„ç»„ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;kube-apiserver&lt;/li&gt;
&lt;li&gt;kube-scheduler&lt;/li&gt;
&lt;li&gt;kube-controller-manager&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›®å‰è¿™ä¸‰ä¸ªç»„ä»¶éœ€è¦éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kube-scheduler&lt;/code&gt;ã€&lt;code&gt;kube-controller-manager&lt;/code&gt; å’Œ &lt;code&gt;kube-apiserver&lt;/code&gt; ä¸‰è€…çš„åŠŸèƒ½ç´§å¯†ç›¸å…³ï¼›&lt;/li&gt;
&lt;li&gt;åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª &lt;code&gt;kube-scheduler&lt;/code&gt;ã€&lt;code&gt;kube-controller-manager&lt;/code&gt; è¿›ç¨‹å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå¦‚æœè¿è¡Œå¤šä¸ªï¼Œåˆ™éœ€è¦é€šè¿‡é€‰ä¸¾äº§ç”Ÿä¸€ä¸ª leaderï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬æ–‡æ¡£è®°å½•éƒ¨ç½²ä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„é«˜å¯ç”¨ kubernetes master é›†ç¾¤æ­¥éª¤ã€‚ï¼ˆåç»­åˆ›å»ºä¸€ä¸ª load balancer æ¥ä»£ç†è®¿é—® kube-apiserver çš„è¯·æ±‚ï¼‰&lt;/p&gt;

&lt;h2 id=&#34;tls-è¯ä¹¦æ–‡ä»¶&#34;&gt;TLS è¯ä¹¦æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;pemå’Œtoken.csvè¯ä¹¦æ–‡ä»¶æˆ‘ä»¬åœ¨&lt;a href=&#34;./01-TLSè¯ä¹¦å’Œç§˜é’¥.md&#34;&gt;TLSè¯ä¹¦å’Œç§˜é’¥&lt;/a&gt;è¿™ä¸€æ­¥ä¸­å·²ç»åˆ›å»ºè¿‡äº†ã€‚æˆ‘ä»¬å†æ£€æŸ¥ä¸€ä¸‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ls /etc/kubernetes/ssl
admin-key.pem  admin.pem  ca-key.pem  ca.pem  kube-proxy-key.pem  kube-proxy.pem  kubernetes-key.pem  kubernetes.pem
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶&#34;&gt;ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;æœ‰ä¸¤ç§ä¸‹è½½æ–¹å¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–¹å¼ä¸€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä» &lt;a href=&#34;https://github.com/kubernetes/kubernetes/releases&#34;&gt;github release é¡µé¢&lt;/a&gt; ä¸‹è½½å‘å¸ƒç‰ˆ tarballï¼Œè§£å‹åå†æ‰§è¡Œä¸‹è½½è„šæœ¬&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ wget https://github.com/kubernetes/kubernetes/releases/download/v1.6.0/kubernetes.tar.gz
$ tar -xzvf kubernetes.tar.gz
...
$ cd kubernetes
$ ./cluster/get-kube-binaries.sh
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ–¹å¼äºŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä» &lt;a href=&#34;https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md&#34;&gt;&lt;code&gt;CHANGELOG&lt;/code&gt;é¡µé¢&lt;/a&gt; ä¸‹è½½ &lt;code&gt;client&lt;/code&gt; æˆ– &lt;code&gt;server&lt;/code&gt; tarball æ–‡ä»¶&lt;/p&gt;

&lt;p&gt;&lt;code&gt;server&lt;/code&gt; çš„ tarball &lt;code&gt;kubernetes-server-linux-amd64.tar.gz&lt;/code&gt; å·²ç»åŒ…å«äº† &lt;code&gt;client&lt;/code&gt;(&lt;code&gt;kubectl&lt;/code&gt;) äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ç”¨å•ç‹¬ä¸‹è½½&lt;code&gt;kubernetes-client-linux-amd64.tar.gz&lt;/code&gt;æ–‡ä»¶ï¼›&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ # wget https://dl.k8s.io/v1.6.0/kubernetes-client-linux-amd64.tar.gz
$ wget https://dl.k8s.io/v1.6.0/kubernetes-server-linux-amd64.tar.gz
$ tar -xzvf kubernetes-server-linux-amd64.tar.gz
...
$ cd kubernetes
$ tar -xzvf  kubernetes-src.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°†äºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šè·¯å¾„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cp -r server/bin/{kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,kube-proxy,kubelet} /root/local/bin/
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®å’Œå¯åŠ¨-kube-apiserver&#34;&gt;é…ç½®å’Œå¯åŠ¨ kube-apiserver&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»º kube-apiserverçš„serviceé…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;serivceé…ç½®æ–‡ä»¶&lt;code&gt;/usr/lib/systemd/system/kube-apiserver.service&lt;/code&gt;å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes API Service
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=network.target
After=etcd.service

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/apiserver
ExecStart=/usr/bin/kube-apiserver \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_ETCD_SERVERS \
	    $KUBE_API_ADDRESS \
	    $KUBE_API_PORT \
	    $KUBELET_PORT \
	    $KUBE_ALLOW_PRIV \
	    $KUBE_SERVICE_ADDRESSES \
	    $KUBE_ADMISSION_CONTROL \
	    $KUBE_API_ARGS
Restart=on-failure
Type=notify
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;/etc/kubernetes/config&lt;/code&gt;æ–‡ä»¶çš„å†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes system config
#
# The following values are used to configure various aspects of all
# kubernetes services, including
#
#   kube-apiserver.service
#   kube-controller-manager.service
#   kube-scheduler.service
#   kubelet.service
#   kube-proxy.service
# logging to stderr means we get it in the systemd journal
KUBE_LOGTOSTDERR=&amp;quot;--logtostderr=true&amp;quot;

# journal message level, 0 is debug
KUBE_LOG_LEVEL=&amp;quot;--v=0&amp;quot;

# Should this cluster be allowed to run privileged docker containers
KUBE_ALLOW_PRIV=&amp;quot;--allow-privileged=true&amp;quot;

# How the controller-manager, scheduler, and proxy find the apiserver
#KUBE_MASTER=&amp;quot;--master=http://sz-pg-oam-docker-test-001.tendcloud.com:8080&amp;quot;
KUBE_MASTER=&amp;quot;--master=http://172.20.0.113:8080&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥é…ç½®æ–‡ä»¶åŒæ—¶è¢«kube-apiserverã€kube-controller-managerã€kube-schedulerã€kubeletã€kube-proxyä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;apiserveré…ç½®æ–‡ä»¶&lt;code&gt;/etc/kubernetes/apiserver&lt;/code&gt;å†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;###
## kubernetes system config
##
## The following values are used to configure the kube-apiserver
##
#
## The address on the local server to listen to.
#KUBE_API_ADDRESS=&amp;quot;--insecure-bind-address=sz-pg-oam-docker-test-001.tendcloud.com&amp;quot;
KUBE_API_ADDRESS=&amp;quot;--advertise-address=172.20.0.113 --bind-address=172.20.0.113 --insecure-bind-address=172.20.0.113&amp;quot;
#
## The port on the local server to listen on.
#KUBE_API_PORT=&amp;quot;--port=8080&amp;quot;
#
## Port minions listen on
#KUBELET_PORT=&amp;quot;--kubelet-port=10250&amp;quot;
#
## Comma separated list of nodes in the etcd cluster
KUBE_ETCD_SERVERS=&amp;quot;--etcd-servers=https://172.20.0.113:2379,172.20.0.114:2379,172.20.0.115:2379&amp;quot;
#
## Address range to use for services
KUBE_SERVICE_ADDRESSES=&amp;quot;--service-cluster-ip-range=10.254.0.0/16&amp;quot;
#
## default admission control policies
KUBE_ADMISSION_CONTROL=&amp;quot;--admission-control=ServiceAccount,NamespaceLifecycle,NamespaceExists,LimitRanger,ResourceQuota&amp;quot;
#
## Add your own!
KUBE_API_ARGS=&amp;quot;--authorization-mode=RBAC --runtime-config=rbac.authorization.k8s.io/v1beta1 --kubelet-https=true --experimental-bootstrap-token-auth --token-auth-file=/etc/kubernetes/token.csv --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem --client-ca-file=/etc/kubernetes/ssl/ca.pem --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem --etcd-cafile=/etc/kubernetes/ssl/ca.pem --etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem --etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem --enable-swagger-ui=true --apiserver-count=3 --audit-log-maxage=30 --audit-log-maxbackup=3 --audit-log-maxsize=100 --audit-log-path=/var/lib/audit.log --event-ttl=1h&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--authorization-mode=RBAC&lt;/code&gt; æŒ‡å®šåœ¨å®‰å…¨ç«¯å£ä½¿ç”¨ RBAC æˆæƒæ¨¡å¼ï¼Œæ‹’ç»æœªé€šè¿‡æˆæƒçš„è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;kube-schedulerã€kube-controller-manager ä¸€èˆ¬å’Œ kube-apiserver éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå®ƒä»¬ä½¿ç”¨&lt;strong&gt;éå®‰å…¨ç«¯å£&lt;/strong&gt;å’Œ kube-apiserveré€šä¿¡;&lt;/li&gt;
&lt;li&gt;kubeletã€kube-proxyã€kubectl éƒ¨ç½²åœ¨å…¶å®ƒ Node èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœé€šè¿‡&lt;strong&gt;å®‰å…¨ç«¯å£&lt;/strong&gt;è®¿é—® kube-apiserverï¼Œåˆ™å¿…é¡»å…ˆé€šè¿‡ TLS è¯ä¹¦è®¤è¯ï¼Œå†é€šè¿‡ RBAC æˆæƒï¼›&lt;/li&gt;
&lt;li&gt;kube-proxyã€kubectl é€šè¿‡åœ¨ä½¿ç”¨çš„è¯ä¹¦é‡ŒæŒ‡å®šç›¸å…³çš„ Userã€Group æ¥è¾¾åˆ°é€šè¿‡ RBAC æˆæƒçš„ç›®çš„ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨äº† kubelet TLS Boostrap æœºåˆ¶ï¼Œåˆ™ä¸èƒ½å†æŒ‡å®š &lt;code&gt;--kubelet-certificate-authority&lt;/code&gt;ã€&lt;code&gt;--kubelet-client-certificate&lt;/code&gt; å’Œ &lt;code&gt;--kubelet-client-key&lt;/code&gt; é€‰é¡¹ï¼Œå¦åˆ™åç»­ kube-apiserver æ ¡éªŒ kubelet è¯ä¹¦æ—¶å‡ºç° â€x509: certificate signed by unknown authorityâ€œ é”™è¯¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--admission-control&lt;/code&gt; å€¼å¿…é¡»åŒ…å« &lt;code&gt;ServiceAccount&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--bind-address&lt;/code&gt; ä¸èƒ½ä¸º &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;runtime-config&lt;/code&gt;é…ç½®ä¸º&lt;code&gt;rbac.authorization.k8s.io/v1beta1&lt;/code&gt;ï¼Œè¡¨ç¤ºè¿è¡Œæ—¶çš„apiVersionï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--service-cluster-ip-range&lt;/code&gt; æŒ‡å®š Service Cluster IP åœ°å€æ®µï¼Œè¯¥åœ°å€æ®µä¸èƒ½è·¯ç”±å¯è¾¾ï¼›&lt;/li&gt;
&lt;li&gt;ç¼ºçœæƒ…å†µä¸‹ kubernetes å¯¹è±¡ä¿å­˜åœ¨ etcd &lt;code&gt;/registry&lt;/code&gt; è·¯å¾„ä¸‹ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;--etcd-prefix&lt;/code&gt; å‚æ•°è¿›è¡Œè°ƒæ•´ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®Œæ•´ unit è§ &lt;a href=&#34;./systemd/kube-apiserver.service&#34;&gt;kube-apiserver.service&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨kube-apiserver&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ systemctl daemon-reload
$ systemctl enable kube-apiserver
$ systemctl start kube-apiserver
$ systemctl status kube-apiserver
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®å’Œå¯åŠ¨-kube-controller-manager&#34;&gt;é…ç½®å’Œå¯åŠ¨ kube-controller-manager&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»º kube-controller-managerçš„serivceé…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ–‡ä»¶è·¯å¾„&lt;code&gt;/usr/lib/systemd/system/kube-controller-manager.service&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;Description=Kubernetes Controller Manager
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/controller-manager
ExecStart=/usr/bin/kube-controller-manager \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_CONTROLLER_MANAGER_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é…ç½®æ–‡ä»¶&lt;code&gt;/etc/kubernetes/controller-manager&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# The following values are used to configure the kubernetes controller-manager

# defaults from config and apiserver should be adequate

# Add your own!
KUBE_CONTROLLER_MANAGER_ARGS=&amp;quot;--address=127.0.0.1 --service-cluster-ip-range=10.254.0.0/16 --cluster-name=kubernetes --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem  --service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem --root-ca-file=/etc/kubernetes/ssl/ca.pem --leader-elect=true&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;--service-cluster-ip-range&lt;/code&gt; å‚æ•°æŒ‡å®š Cluster ä¸­ Service çš„CIDRèŒƒå›´ï¼Œè¯¥ç½‘ç»œåœ¨å„ Node é—´å¿…é¡»è·¯ç”±ä¸å¯è¾¾ï¼Œå¿…é¡»å’Œ kube-apiserver ä¸­çš„å‚æ•°ä¸€è‡´ï¼›&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;--cluster-signing-*&lt;/code&gt; æŒ‡å®šçš„è¯ä¹¦å’Œç§é’¥æ–‡ä»¶ç”¨æ¥ç­¾åä¸º TLS BootStrap åˆ›å»ºçš„è¯ä¹¦å’Œç§é’¥ï¼›&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;--root-ca-file&lt;/code&gt; ç”¨æ¥å¯¹ kube-apiserver è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œ&lt;strong&gt;æŒ‡å®šè¯¥å‚æ•°åï¼Œæ‰ä¼šåœ¨Pod å®¹å™¨çš„ ServiceAccount ä¸­æ”¾ç½®è¯¥ CA è¯ä¹¦æ–‡ä»¶&lt;/strong&gt;ï¼›&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;--address&lt;/code&gt; å€¼å¿…é¡»ä¸º &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼Œå› ä¸ºå½“å‰ kube-apiserver æœŸæœ› scheduler å’Œ controller-manager åœ¨åŒä¸€å°æœºå™¨ï¼Œå¦åˆ™ï¼š&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;  $ kubectl get componentstatuses
  NAME                 STATUS      MESSAGE                                                                                        ERROR
  scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused   
  controller-manager   Healthy     ok                                                                                             
  etcd-2               Unhealthy   Get http://172.20.0.113:2379/health: malformed HTTP response &amp;quot;\x15\x03\x01\x00\x02\x02&amp;quot;        
  etcd-0               Healthy     {&amp;quot;health&amp;quot;: &amp;quot;true&amp;quot;}                                                                             
  etcd-1               Healthy     {&amp;quot;health&amp;quot;: &amp;quot;true&amp;quot;}  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;a href=&#34;https://github.com/kubernetes-incubator/bootkube/issues/64&#34;&gt;https://github.com/kubernetes-incubator/bootkube/issues/64&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å®Œæ•´ unit è§ &lt;a href=&#34;./systemd/kube-controller-manager.service&#34;&gt;kube-controller-manager.service&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å¯åŠ¨-kube-controller-manager&#34;&gt;å¯åŠ¨ kube-controller-manager&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ systemctl daemon-reload
$ systemctl enable kube-controller-manager
$ systemctl start kube-controller-manager
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®å’Œå¯åŠ¨-kube-scheduler&#34;&gt;é…ç½®å’Œå¯åŠ¨ kube-scheduler&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»º kube-schedulerçš„serivceé…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ–‡ä»¶è·¯å¾„&lt;code&gt;/usr/lib/systemd/system/kube-scheduler.serivce&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Scheduler Plugin
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/scheduler
ExecStart=/usr/bin/kube-scheduler \
            $KUBE_LOGTOSTDERR \
            $KUBE_LOG_LEVEL \
            $KUBE_MASTER \
            $KUBE_SCHEDULER_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é…ç½®æ–‡ä»¶&lt;code&gt;/etc/kubernetes/scheduler&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;###
# kubernetes scheduler config

# default config should be adequate

# Add your own!
KUBE_SCHEDULER_ARGS=&amp;quot;--leader-elect=true --address=127.0.0.1&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--address&lt;/code&gt; å€¼å¿…é¡»ä¸º &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼Œå› ä¸ºå½“å‰ kube-apiserver æœŸæœ› scheduler å’Œ controller-manager åœ¨åŒä¸€å°æœºå™¨ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®Œæ•´ unit è§ &lt;a href=&#34;./systemd/kube-scheduler.service&#34;&gt;kube-scheduler.service&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å¯åŠ¨-kube-scheduler&#34;&gt;å¯åŠ¨ kube-scheduler&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ systemctl daemon-reload
$ systemctl enable kube-scheduler
$ systemctl start kube-scheduler
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;éªŒè¯-master-èŠ‚ç‚¹åŠŸèƒ½&#34;&gt;éªŒè¯ master èŠ‚ç‚¹åŠŸèƒ½&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get componentstatuses
NAME                 STATUS    MESSAGE              ERROR
scheduler            Healthy   ok                   
controller-manager   Healthy   ok                   
etcd-0               Healthy   {&amp;quot;health&amp;quot;: &amp;quot;true&amp;quot;}   
etcd-1               Healthy   {&amp;quot;health&amp;quot;: &amp;quot;true&amp;quot;}   
etcd-2               Healthy   {&amp;quot;health&amp;quot;: &amp;quot;true&amp;quot;}   
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;å½“æ—¶åœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster/issues/4&#34;&gt;TLSè®¤è¯ç›¸å…³çš„é—®é¢˜&lt;/a&gt;ï¼Œå…¶å®å°±æ˜¯å› ä¸ºé…ç½®apiserveræ—¶å€™etcdçš„åè®®å†™æˆäº†httpå¯¼è‡´çš„ï¼Œåº”è¯¥æ˜¯ç”¨httpsã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;Opsnull&lt;/a&gt;å†™çš„kubernetesé«˜å¯ç”¨masteré›†ç¾¤éƒ¨ç½²è¿‡ç¨‹ä¸­ä¼¼ä¹å¹¶æ²¡æœ‰åŒ…æ‹¬&lt;strong&gt;é«˜å¯ç”¨çš„é…ç½®&lt;/strong&gt;ï¼Œæ‰äº‘ç§‘æŠ€çš„å”ç»§å…ƒåˆ†äº«è¿‡&lt;a href=&#34;https://segmentfault.com/a/1190000005832319&#34;&gt;Kubernetes Master High Availability é«˜çº§å®è·µ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç©¶ç«Ÿå¦‚ä½•å®ç°kubernetes masterçš„é«˜å¯ç”¨è¿˜éœ€è¦ç»§ç»­æ¢ç´¢ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹etcdé«˜å¯ç”¨é…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-etcd-ha-config/</link>
      <pubDate>Tue, 11 Apr 2017 15:21:39 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-etcd-ha-config/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2015091401.jpg&#34; alt=&#34;è¥¿å±±ä¿¯ç°åŒ—äº¬å¤œæ™¯&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šåŒ—äº¬å¤œæ™¯@è¥¿å±±ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®((forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;))ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œç”Ÿæˆ&lt;strong&gt;kubeconfig&lt;/strong&gt;æ–‡ä»¶çš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åˆ›å»ºé«˜å¯ç”¨-etcd-é›†ç¾¤&#34;&gt;åˆ›å»ºé«˜å¯ç”¨ etcd é›†ç¾¤&lt;/h2&gt;

&lt;p&gt;kuberntes ç³»ç»Ÿä½¿ç”¨ etcd å­˜å‚¨æ‰€æœ‰æ•°æ®ï¼Œæœ¬æ–‡æ¡£ä»‹ç»éƒ¨ç½²ä¸€ä¸ªä¸‰èŠ‚ç‚¹é«˜å¯ç”¨ etcd é›†ç¾¤çš„æ­¥éª¤ï¼Œè¿™ä¸‰ä¸ªèŠ‚ç‚¹å¤ç”¨ kubernetes master æœºå™¨ï¼Œåˆ†åˆ«å‘½åä¸º&lt;code&gt;sz-pg-oam-docker-test-001.tendcloud.com&lt;/code&gt;ã€&lt;code&gt;sz-pg-oam-docker-test-002.tendcloud.com&lt;/code&gt;ã€&lt;code&gt;sz-pg-oam-docker-test-003.tendcloud.com&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;sz-pg-oam-docker-test-001.tendcloud.comï¼š172.20.0.113&lt;/li&gt;
&lt;li&gt;sz-pg-oam-docker-test-002.tendcloud.comï¼š172.20.0.114&lt;/li&gt;
&lt;li&gt;sz-pg-oam-docker-test-003.tendcloud.comï¼š172.20.0.115&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;tls-è®¤è¯æ–‡ä»¶&#34;&gt;TLS è®¤è¯æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;éœ€è¦ä¸º etcd é›†ç¾¤åˆ›å»ºåŠ å¯†é€šä¿¡çš„ TLS è¯ä¹¦ï¼Œè¿™é‡Œå¤ç”¨ä»¥å‰åˆ›å»ºçš„ kubernetes è¯ä¹¦&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cp ca.pem kubernetes-key.pem kubernetes.pem /etc/kubernetes/ssl
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;kubernetes è¯ä¹¦çš„ &lt;code&gt;hosts&lt;/code&gt; å­—æ®µåˆ—è¡¨ä¸­åŒ…å«ä¸Šé¢ä¸‰å°æœºå™¨çš„ IPï¼Œå¦åˆ™åç»­è¯ä¹¦æ ¡éªŒä¼šå¤±è´¥ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶&#34;&gt;ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;åˆ° &lt;code&gt;https://github.com/coreos/etcd/releases&lt;/code&gt; é¡µé¢ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ https://github.com/coreos/etcd/releases/download/v3.1.5/etcd-v3.1.5-linux-amd64.tar.gz
$ tar -xvf etcd-v3.1.4-linux-amd64.tar.gz
$ sudo mv etcd-v3.1.4-linux-amd64/etcd* /root/local/bin
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;åˆ›å»º-etcd-çš„-systemd-unit-æ–‡ä»¶&#34;&gt;åˆ›å»º etcd çš„ systemd unit æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;æ³¨æ„æ›¿æ¢ &lt;code&gt;ETCD_NAME&lt;/code&gt; å’Œ &lt;code&gt;INTERNAL_IP&lt;/code&gt; å˜é‡çš„å€¼ï¼›&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ export ETCD_NAME=sz-pg-oam-docker-test-001.tendcloud.com
$ export INTERNAL_IP=172.20.0.113
$ sudo mkdir -p /var/lib/etcd /var/lib/etcd
$ cat &amp;gt; etcd.service &amp;lt;&amp;lt;EOF
[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target
Documentation=https://github.com/coreos

[Service]
Type=notify
WorkingDirectory=/var/lib/etcd/
EnvironmentFile=-/etc/etcd/etcd.conf
ExecStart=/root/local/bin/etcd \\
  --name ${ETCD_NAME} \\
  --cert-file=/etc/kubernetes/ssl/kubernetes.pem \\
  --key-file=/etc/kubernetes/ssl/kubernetes-key.pem \\
  --peer-cert-file=/etc/kubernetes/ssl/kubernetes.pem \\
  --peer-key-file=/etc/kubernetes/ssl/kubernetes-key.pem \\
  --trusted-ca-file=/etc/kubernetes/ssl/ca.pem \\
  --peer-trusted-ca-file=/etc/kubernetes/ssl/ca.pem \\
  --initial-advertise-peer-urls https://${INTERNAL_IP}:2380 \\
  --listen-peer-urls https://${INTERNAL_IP}:2380 \\
  --listen-client-urls https://${INTERNAL_IP}:2379,https://127.0.0.1:2379 \\
  --advertise-client-urls https://${INTERNAL_IP}:2379 \\
  --initial-cluster-token etcd-cluster-0 \\
  --initial-cluster sz-pg-oam-docker-test-001.tendcloud.com=https://172.20.0.113:2380,sz-pg-oam-docker-test-002.tendcloud.com=https://172.20.0.114:2380,sz-pg-oam-docker-test-003.tendcloud.com=https://172.20.0.115:2380 \\
  --initial-cluster-state new \\
  --data-dir=/var/lib/etcd
Restart=on-failure
RestartSec=5
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;æŒ‡å®š &lt;code&gt;etcd&lt;/code&gt; çš„å·¥ä½œç›®å½•ä¸º &lt;code&gt;/var/lib/etcd&lt;/code&gt;ï¼Œæ•°æ®ç›®å½•ä¸º &lt;code&gt;/var/lib/etcd&lt;/code&gt;ï¼Œéœ€åœ¨å¯åŠ¨æœåŠ¡å‰åˆ›å»ºè¿™ä¸¤ä¸ªç›®å½•ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ä¿è¯é€šä¿¡å®‰å…¨ï¼Œéœ€è¦æŒ‡å®š etcd çš„å…¬ç§é’¥(cert-fileå’Œkey-file)ã€Peers é€šä¿¡çš„å…¬ç§é’¥å’Œ CA è¯ä¹¦(peer-cert-fileã€peer-key-fileã€peer-trusted-ca-file)ã€å®¢æˆ·ç«¯çš„CAè¯ä¹¦ï¼ˆtrusted-ca-fileï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»º &lt;code&gt;kubernetes.pem&lt;/code&gt; è¯ä¹¦æ—¶ä½¿ç”¨çš„ &lt;code&gt;kubernetes-csr.json&lt;/code&gt; æ–‡ä»¶çš„ &lt;code&gt;hosts&lt;/code&gt; å­—æ®µ&lt;strong&gt;åŒ…å«æ‰€æœ‰ etcd èŠ‚ç‚¹çš„ INTERNAL_IP&lt;/strong&gt;ï¼Œå¦åˆ™è¯ä¹¦æ ¡éªŒä¼šå‡ºé”™ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--initial-cluster-state&lt;/code&gt; å€¼ä¸º &lt;code&gt;new&lt;/code&gt; æ—¶ï¼Œ&lt;code&gt;--name&lt;/code&gt; çš„å‚æ•°å€¼å¿…é¡»ä½äº &lt;code&gt;--initial-cluster&lt;/code&gt; åˆ—è¡¨ä¸­ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®Œæ•´ unit æ–‡ä»¶è§ï¼š&lt;a href=&#34;./systemd/etcd.service&#34;&gt;etcd.service&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;å¯åŠ¨-etcd-æœåŠ¡&#34;&gt;å¯åŠ¨ etcd æœåŠ¡&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo mv etcd.service /etc/systemd/system/
$ sudo systemctl daemon-reload
$ sudo systemctl enable etcd
$ sudo systemctl start etcd
$ systemctl status etcd
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨æ‰€æœ‰çš„ kubernetes master èŠ‚ç‚¹é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰æœºå™¨çš„ etcd æœåŠ¡éƒ½å·²å¯åŠ¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;éªŒè¯æœåŠ¡&#34;&gt;éªŒè¯æœåŠ¡&lt;/h2&gt;

&lt;p&gt;åœ¨ä»»ä¸€ kubernetes master æœºå™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ etcdctl \
  --ca-file=/etc/kubernetes/ssl/ca.pem \
  --cert-file=/etc/kubernetes/ssl/kubernetes.pem \
  --key-file=/etc/kubernetes/ssl/kubernetes-key.pem \
  cluster-health
2017-04-11 15:17:09.082250 I | warning: ignoring ServerName for user-provided CA for backwards compatibility is deprecated
2017-04-11 15:17:09.083681 I | warning: ignoring ServerName for user-provided CA for backwards compatibility is deprecated
member 9a2ec640d25672e5 is healthy: got healthy result from https://172.20.0.115:2379
member bc6f27ae3be34308 is healthy: got healthy result from https://172.20.0.114:2379
member e5c92ea26c4edba0 is healthy: got healthy result from https://172.20.0.113:2379
cluster is healthy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»“æœæœ€åä¸€è¡Œä¸º &lt;code&gt;cluster is healthy&lt;/code&gt; æ—¶è¡¨ç¤ºé›†ç¾¤æœåŠ¡æ­£å¸¸ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹åˆ›å»ºkubeconfigæ–‡ä»¶</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-create-kubeconfig/</link>
      <pubDate>Tue, 11 Apr 2017 14:34:54 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-create-kubeconfig/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2016050801.jpg&#34; alt=&#34;åŒ—æµ·å…¬å›­&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(é¢˜å›¾ï¼šåŒ—æµ·å…¬å›­ May 8,2016)&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://github.com/rootsongjc/follow-me-install-kubernetes-cluster&#34;&gt;å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤&lt;/a&gt;é¡¹ç›®((forkè‡ª&lt;a href=&#34;https://github.com/opsnull/follow-me-install-kubernetes-cluster&#34;&gt;opsnull&lt;/a&gt;))ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹&lt;/a&gt;äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œç”Ÿæˆ&lt;strong&gt;kubeconfig&lt;/strong&gt;æ–‡ä»¶çš„è¿‡ç¨‹ã€‚
&lt;code&gt;kubelet&lt;/code&gt;ã€&lt;code&gt;kube-proxy&lt;/code&gt; ç­‰ Node æœºå™¨ä¸Šçš„è¿›ç¨‹ä¸ Master æœºå™¨çš„ &lt;code&gt;kube-apiserver&lt;/code&gt; è¿›ç¨‹é€šä¿¡æ—¶éœ€è¦è®¤è¯å’Œæˆæƒï¼›
kubernetes 1.4 å¼€å§‹æ”¯æŒç”± &lt;code&gt;kube-apiserver&lt;/code&gt; ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆ TLS è¯ä¹¦çš„ &lt;a href=&#34;https://kubernetes.io/docs/admin/kubelet-tls-bootstrapping/&#34;&gt;TLS Bootstrapping&lt;/a&gt; åŠŸèƒ½ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆè¯ä¹¦äº†ï¼›è¯¥åŠŸèƒ½&lt;strong&gt;å½“å‰ä»…æ”¯æŒä¸º &lt;code&gt;kubelet&lt;/code&gt;&lt;/strong&gt; ç”Ÿæˆè¯ä¹¦ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åˆ›å»º-tls-bootstrapping-token&#34;&gt;åˆ›å»º TLS Bootstrapping Token&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Token auth file&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Tokenå¯ä»¥æ˜¯ä»»æ„çš„åŒ…æ¶µ128 bitçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°å‘ç”Ÿå™¨ç”Ÿæˆã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39; &#39;)
cat &amp;gt; token.csv &amp;lt;&amp;lt;EOF
${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,&amp;quot;system:kubelet-bootstrap&amp;quot;
EOF
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;åä¸‰è¡Œæ˜¯ä¸€å¥ï¼Œç›´æ¥å¤åˆ¶ä¸Šé¢çš„è„šæœ¬è¿è¡Œå³å¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å°†token.csvå‘åˆ°æ‰€æœ‰æœºå™¨ï¼ˆMaster å’Œ Nodeï¼‰çš„ &lt;code&gt;/etc/kubernetes/&lt;/code&gt; ç›®å½•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$cp token.csv /etc/kubernetes/
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;åˆ›å»º-kubelet-bootstrapping-kubeconfig-æ–‡ä»¶&#34;&gt;åˆ›å»º kubelet bootstrapping kubeconfig æ–‡ä»¶&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cd /etc/kubernetes
$ export KUBE_APISERVER=&amp;quot;https://172.20.0.113:6443&amp;quot;
$ # è®¾ç½®é›†ç¾¤å‚æ•°
$ kubectl config set-cluster kubernetes \
  --certificate-authority=/etc/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=bootstrap.kubeconfig
$ # è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°
$ kubectl config set-credentials kubelet-bootstrap \
  --token=${BOOTSTRAP_TOKEN} \
  --kubeconfig=bootstrap.kubeconfig
$ # è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°
$ kubectl config set-context default \
  --cluster=kubernetes \
  --user=kubelet-bootstrap \
  --kubeconfig=bootstrap.kubeconfig
$ # è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡
$ kubectl config use-context default --kubeconfig=bootstrap.kubeconfig
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--embed-certs&lt;/code&gt; ä¸º &lt;code&gt;true&lt;/code&gt; æ—¶è¡¨ç¤ºå°† &lt;code&gt;certificate-authority&lt;/code&gt; è¯ä¹¦å†™å…¥åˆ°ç”Ÿæˆçš„ &lt;code&gt;bootstrap.kubeconfig&lt;/code&gt; æ–‡ä»¶ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°æ—¶&lt;strong&gt;æ²¡æœ‰&lt;/strong&gt;æŒ‡å®šç§˜é’¥å’Œè¯ä¹¦ï¼Œåç»­ç”± &lt;code&gt;kube-apiserver&lt;/code&gt; è‡ªåŠ¨ç”Ÿæˆï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;åˆ›å»º-kube-proxy-kubeconfig-æ–‡ä»¶&#34;&gt;åˆ›å»º kube-proxy kubeconfig æ–‡ä»¶&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ export KUBE_APISERVER=&amp;quot;https://172.20.0.113:6443&amp;quot;
$ # è®¾ç½®é›†ç¾¤å‚æ•°
$ kubectl config set-cluster kubernetes \
  --certificate-authority=/etc/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=kube-proxy.kubeconfig
$ # è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°
$ kubectl config set-credentials kube-proxy \
  --client-certificate=/etc/kubernetes/ssl/kube-proxy.pem \
  --client-key=/etc/kubernetes/ssl/kube-proxy-key.pem \
  --embed-certs=true \
  --kubeconfig=kube-proxy.kubeconfig
$ # è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°
$ kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-proxy \
  --kubeconfig=kube-proxy.kubeconfig
$ # è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡
$ kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;è®¾ç½®é›†ç¾¤å‚æ•°å’Œå®¢æˆ·ç«¯è®¤è¯å‚æ•°æ—¶ &lt;code&gt;--embed-certs&lt;/code&gt; éƒ½ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¿™ä¼šå°† &lt;code&gt;certificate-authority&lt;/code&gt;ã€&lt;code&gt;client-certificate&lt;/code&gt; å’Œ &lt;code&gt;client-key&lt;/code&gt; æŒ‡å‘çš„è¯ä¹¦æ–‡ä»¶å†…å®¹å†™å…¥åˆ°ç”Ÿæˆçš„ &lt;code&gt;kube-proxy.kubeconfig&lt;/code&gt; æ–‡ä»¶ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kube-proxy.pem&lt;/code&gt; è¯ä¹¦ä¸­ CN ä¸º &lt;code&gt;system:kube-proxy&lt;/code&gt;ï¼Œ&lt;code&gt;kube-apiserver&lt;/code&gt; é¢„å®šä¹‰çš„ RoleBinding &lt;code&gt;cluster-admin&lt;/code&gt; å°†User &lt;code&gt;system:kube-proxy&lt;/code&gt; ä¸ Role &lt;code&gt;system:node-proxier&lt;/code&gt; ç»‘å®šï¼Œè¯¥ Role æˆäºˆäº†è°ƒç”¨ &lt;code&gt;kube-apiserver&lt;/code&gt; Proxy ç›¸å…³ API çš„æƒé™ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;åˆ†å‘-kubeconfig-æ–‡ä»¶&#34;&gt;åˆ†å‘ kubeconfig æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;å°†ä¸¤ä¸ª kubeconfig æ–‡ä»¶åˆ†å‘åˆ°æ‰€æœ‰ Node æœºå™¨çš„ &lt;code&gt;/etc/kubernetes/&lt;/code&gt; ç›®å½•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cp bootstrap.kubeconfig kube-proxy.kubeconfig /etc/kubernetes/
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>å¼€æºå¾®æœåŠ¡ç®¡ç†å¹³å°fabric8ç®€ä»‹</title>
      <link>http://rootsongjc.github.io/blogs/fabric8-introduction/</link>
      <pubDate>Mon, 10 Apr 2017 21:39:00 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/fabric8-introduction/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;https://fabric8.io/images/fabric8_logo.svg&#34; alt=&#34;fabric8&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æ— æ„ä¸­å‘ç°&lt;a href=&#34;https://github.com/fabric8io/fabric8&#34;&gt;Fabric8&lt;/a&gt;è¿™ä¸ª&lt;strong&gt;å¯¹äºJavaå‹å¥½çš„å¼€æºå¾®æœåŠ¡ç®¡ç†å¹³å°&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®è¿™åœ¨è¿™é‡Œå‘ç°çš„&lt;a href=&#34;http://blog.sonatype.com/achieving-ci/cd-with-kubernetes&#34;&gt;Achieving CI/CD with Kubernetes&lt;/a&gt;ï¼ˆby Ramit Surana,on February 17, 2017ï¼‰ï¼Œå…¶å®æ˜¯å…ˆåœ¨&lt;a href=&#34;https://www.slideshare.net/ramitsurana/achieving-cicd-with-kubernetes&#34;&gt;slideshare&lt;/a&gt;ä¸Šçœ‹åˆ°çš„ï¼Œpdfå¯ä»¥&lt;a href=&#34;http://olz1di9xf.bkt.clouddn.com/achiveving-ci-cd-with-kubernetes-ramit-surana.pdf&#34;&gt;åœ¨æ­¤ä¸‹è½½&lt;/a&gt;ï¼Œå¤§å°2.04Mã€‚&lt;/p&gt;

&lt;p&gt;å¤§å®¶å¯èƒ½ä»¥å‰å¬è¿‡ä¸€ä¸ªå«åš&lt;a href=&#34;https://github.com/fabric/fabric/&#34;&gt;fabric&lt;/a&gt;çš„å·¥å…·ï¼Œé‚£æ˜¯ä¸€ä¸ª Python (2.5-2.7) åº“å’Œå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥æµæ°´çº¿åŒ–æ‰§è¡Œ SSH ä»¥éƒ¨ç½²åº”ç”¨æˆ–ç³»ç»Ÿç®¡ç†ä»»åŠ¡ã€‚æ‰€ä»¥å¤§å®¶ä¸è¦æŠŠfabric8è·Ÿfabricææ··ï¼Œè™½ç„¶å®ƒä»¬ä¹‹é—´æœ‰ä¸€äº›å…±åŒç‚¹ï¼Œä½†ä¸¤è€…å®Œå…¨ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œ&lt;strong&gt;fabric8ä¸æ˜¯fabricçš„ä¸€ä¸ªç‰ˆæœ¬&lt;/strong&gt;ã€‚Fabricæ˜¯ç”¨pythonå¼€å‘çš„ï¼Œfabric8æ˜¯javaå¼€å‘çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ æƒ³äº†è§£ç®€åŒ–Fabricå¯ä»¥çœ‹å®ƒçš„&lt;a href=&#34;http://fabric-docs-cn.readthedocs.io/zh_CN/latest/tutorial.html&#34;&gt;ä¸­æ–‡å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;fabric8ç®€ä»‹&#34;&gt;Fabric8ç®€ä»‹&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;fabric8&lt;/strong&gt;æ˜¯ä¸€ä¸ªå¼€æº&lt;strong&gt;é›†æˆå¼€å‘å¹³å°&lt;/strong&gt;ï¼Œä¸ºåŸºäº&lt;a href=&#34;http://kubernetes.io/&#34;&gt;Kubernetes&lt;/a&gt;å’Œ&lt;a href=&#34;https://jenkins.io/&#34;&gt;Jenkins&lt;/a&gt;çš„å¾®æœåŠ¡æä¾›&lt;a href=&#34;http://fabric8.io/guide/cdelivery.html&#34;&gt;æŒç»­å‘å¸ƒ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨fabricå¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡&lt;a href=&#34;http://fabric8.io/guide/cdelivery.html&#34;&gt;Continuous Delivery pipelines&lt;/a&gt;åˆ›å»ºã€ç¼–è¯‘ã€éƒ¨ç½²å’Œæµ‹è¯•å¾®æœåŠ¡ï¼Œç„¶åé€šè¿‡Continuous Improvementå’Œ&lt;a href=&#34;http://fabric8.io/guide/chat.html&#34;&gt;ChatOps&lt;/a&gt;è¿è¡Œå’Œç®¡ç†ä»–ä»¬ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://fabric8.io/guide/fabric8DevOps.html&#34;&gt;Fabric8å¾®æœåŠ¡å¹³å°&lt;/a&gt;æä¾›ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/console.html&#34;&gt;Developer Console&lt;/a&gt;ï¼Œæ˜¯ä¸€ä¸ª&lt;a href=&#34;http://www.infoq.com/cn/news/2014/11/seven-principles-rich-web-app&#34;&gt;å¯Œwebåº”ç”¨&lt;/a&gt;ï¼Œæä¾›ä¸€ä¸ªå•é¡µé¢æ¥åˆ›å»ºã€ç¼–è¾‘ã€ç¼–è¯‘ã€éƒ¨ç½²å’Œæµ‹è¯•å¾®æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/cdelivery.html&#34;&gt;Continuous Integration and Continous Delivery&lt;/a&gt;ï¼Œä½¿ç”¨ &lt;a href=&#34;https://jenkins.io/&#34;&gt;Jenkins&lt;/a&gt; with a &lt;a href=&#34;http://fabric8.io/guide/jenkinsWorkflowLibrary.html&#34;&gt;Jenkins Workflow Library&lt;/a&gt;æ›´å¿«å’Œæ›´å¯é çš„äº¤ä»˜è½¯ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/management.html&#34;&gt;Management&lt;/a&gt;ï¼Œé›†ä¸­å¼ç®¡ç†&lt;a href=&#34;http://fabric8.io/guide/logging.html&#34;&gt;Logging&lt;/a&gt;ã€&lt;a href=&#34;http://fabric8.io/guide/metrics.html&#34;&gt;Metrics&lt;/a&gt;, &lt;a href=&#34;http://fabric8.io/guide/chat.html&#34;&gt;ChatOps&lt;/a&gt;ã€&lt;a href=&#34;http://fabric8.io/guide/chaosMonkey.html&#34;&gt;Chaos Monkey&lt;/a&gt;ï¼Œä½¿ç”¨&lt;a href=&#34;http://hawt.io/&#34;&gt;Hawtio&lt;/a&gt;å’Œ&lt;a href=&#34;http://jolokia.org/&#34;&gt;Jolokia&lt;/a&gt;ç®¡ç†Java Containersã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/ipaas.html&#34;&gt;Integration&lt;/a&gt; &lt;u&gt;&lt;em&gt;Integration Platform As A Service&lt;/em&gt;&lt;/u&gt; with &lt;a href=&#34;http://fabric8.io/guide/console.html&#34;&gt;deep visualisation&lt;/a&gt; of your &lt;a href=&#34;http://camel.apache.org/&#34;&gt;Apache Camel&lt;/a&gt; integration services, an &lt;a href=&#34;http://fabric8.io/guide/apiRegistry.html&#34;&gt;API Registry&lt;/a&gt; to view of all your RESTful and SOAP APIs and &lt;a href=&#34;http://fabric8.io/guide/fabric8MQ.html&#34;&gt;Fabric8 MQ&lt;/a&gt; provides &lt;u&gt;&lt;em&gt;Messaging As A Service&lt;/em&gt;&lt;/u&gt; based on &lt;a href=&#34;http://activemq.apache.org/&#34;&gt;Apache ActiveMQ&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/tools.html&#34;&gt;Java Tools&lt;/a&gt; å¸®åŠ©Javaåº”ç”¨ä½¿ç”¨&lt;a href=&#34;http://kubernetes.io/&#34;&gt;Kubernetes&lt;/a&gt;:

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/mavenPlugin.html&#34;&gt;Maven Plugin&lt;/a&gt; for working with &lt;a href=&#34;http://kubernetes.io/&#34;&gt;Kubernetes&lt;/a&gt; ï¼Œè¿™çœŸæ˜¯æå¥½çš„&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/testing.html&#34;&gt;Integration and System Testing&lt;/a&gt; of &lt;a href=&#34;http://kubernetes.io/&#34;&gt;Kubernetes&lt;/a&gt; resources easily inside &lt;a href=&#34;http://junit.org/&#34;&gt;JUnit&lt;/a&gt; with &lt;a href=&#34;http://arquillian.org/&#34;&gt;Arquillian&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/javaLibraries.html&#34;&gt;Java Libraries&lt;/a&gt; and support for &lt;a href=&#34;http://fabric8.io/guide/cdi.html&#34;&gt;CDI&lt;/a&gt; extensions for working with &lt;a href=&#34;http://kubernetes.io/&#34;&gt;Kubernetes&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;fabric8å¾®æœåŠ¡å¹³å°&#34;&gt;Fabric8å¾®æœåŠ¡å¹³å°&lt;/h2&gt;

&lt;p&gt;Fabric8æä¾›äº†ä¸€ä¸ªå®Œå…¨é›†æˆçš„å¼€æºå¾®æœåŠ¡å¹³å°ï¼Œå¯åœ¨ä»»ä½•çš„&lt;a href=&#34;http://kubernetes.io/&#34;&gt;Kubernetes&lt;/a&gt;å’Œ&lt;a href=&#34;http://www.openshift.org/&#34;&gt;OpenShift&lt;/a&gt;ç¯å¢ƒä¸­å¼€ç®±å³ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªå¹³å°æ˜¯åŸºäºå¾®æœåŠ¡è€Œä¸”æ˜¯æ¨¡å—åŒ–çš„ï¼Œä½ å¯ä»¥æŒ‰ç…§å¾®æœåŠ¡çš„æ–¹å¼æ¥ä½¿ç”¨å®ƒã€‚&lt;/p&gt;

&lt;p&gt;å¾®æœåŠ¡å¹³å°æä¾›çš„æœåŠ¡æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¼€å‘è€…æ§åˆ¶å°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ŒWebåº”ç”¨ç¨‹åºï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå•ä¸€çš„é¡µé¢æ¥åˆ›å»ºã€ç¼–è¾‘ã€ç¼–è¯‘ã€éƒ¨ç½²å’Œæµ‹è¯•å¾®æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼Œå¸®åŠ©å›¢é˜Ÿä»¥æ›´å¿«æ›´å¯é çš„æ–¹å¼äº¤ä»˜è½¯ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¼€æºè½¯ä»¶ï¼š

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jenkins.io/&#34;&gt;Jenkins&lt;/a&gt;ï¼šCIï¼CD pipeline&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.sonatype.org/nexus/&#34;&gt;Nexus&lt;/a&gt;ï¼š ç»„ä»¶åº“&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://gogs.io/&#34;&gt;Gogs&lt;/a&gt;ï¼šgitä»£ç åº“&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.sonarqube.org/&#34;&gt;SonarQube&lt;/a&gt;ï¼šä»£ç è´¨é‡ç»´æŠ¤å¹³å°&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/jenkinsWorkflowLibrary.html&#34;&gt;Jenkins Workflow Library&lt;/a&gt;ï¼šåœ¨ä¸åŒçš„é¡¹ç›®ä¸­å¤ç”¨&lt;a href=&#34;https://github.com/fabric8io/jenkins-workflow-library&#34;&gt;Jenkins Workflow scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/fabric8YmlFile.html&#34;&gt;Fabric8.yml&lt;/a&gt;ï¼šä¸ºæ¯ä¸ªé¡¹ç›®ã€å­˜å‚¨åº“ã€èŠå¤©å®¤ã€å·¥ä½œæµè„šæœ¬å’Œé—®é¢˜è·Ÿè¸ªå™¨æä¾›ä¸€ä¸ªé…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/chat.html&#34;&gt;ChatOps&lt;/a&gt;ï¼šé€šè¿‡ä½¿ç”¨&lt;a href=&#34;https://hubot.github.com/&#34;&gt;hubot&lt;/a&gt;æ¥å¼€å‘å’Œç®¡ç†ï¼Œèƒ½å¤Ÿè®©ä½ çš„å›¢é˜Ÿæ‹¥æŠ±DevOpsï¼Œé€šè¿‡èŠå¤©å’Œç³»ç»Ÿé€šçŸ¥çš„æ–¹å¼æ¥&lt;a href=&#34;https://github.com/fabric8io/fabric8-jenkins-workflow-steps#hubotapprove&#34;&gt;approval of release promotion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/chaosMonkey.html&#34;&gt;Chaos Monkey&lt;/a&gt;ï¼šé€šè¿‡å¹²æ‰&lt;a href=&#34;http://fabric8.io/guide/pods.html&#34;&gt;pods&lt;/a&gt;æ¥æµ‹è¯•ç³»ç»Ÿå¥å£®æ€§å’Œå¯é æ€§&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/management.html&#34;&gt;ç®¡ç†&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/logging.html&#34;&gt;æ—¥å¿—&lt;/a&gt; ç»Ÿä¸€é›†ç¾¤æ—¥å¿—å’Œå¯è§†åŒ–æŸ¥çœ‹çŠ¶æ€&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://fabric8.io/guide/metrics.html&#34;&gt;metris&lt;/a&gt; å¯æŸ¥çœ‹å†å²metricså’Œå¯è§†åŒ–&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://hao.jobbole.com/fabric8/&#34;&gt;fabric8ï¼šå®¹å™¨é›†æˆå¹³å°â€”â€”ä¼¯ä¹åœ¨çº¿&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzI0NjI4MDg5MQ==&amp;amp;mid=2715290731&amp;amp;idx=1&amp;amp;sn=f1fcacb9aa4f1f3037918f03c29c0465&amp;amp;chksm=cd6d0bbffa1a82a978ccc0405afa295bd9265bd9f89f2217c80f48e1c497b25d1f24090108af&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=0410RTk3PKkxlFlLbCVlOKMK#rd&#34;&gt;Kuberneteséƒ¨ç½²å¾®æœåŠ¡é€ŸæˆæŒ‡å—â€”â€”&lt;em&gt;2017-03-09&lt;/em&gt; &lt;em&gt;å¾è–›å½ª&lt;/em&gt; å®¹å™¨æ—¶ä»£å¾®ä¿¡å…¬ä¼—å·&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢é‚£ç¯‡æ–‡ç« æ˜¯ç¿»è¯‘çš„ï¼Œè‹±æ–‡åŸæ–‡åœ°å€ï¼š&lt;a href=&#34;http://www.eclipse.org/community/eclipse_newsletter/2017/january/article2.php&#34;&gt;Quick Guide to Developing Microservices on Kubernetes and Docker&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://fabric8.io/&#34;&gt;fabric8å®˜ç½‘&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://fabric8.io/guide/getStarted/gofabric8.html&#34;&gt;fabric8 get started&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;&lt;del&gt;æˆ‘åœ¨è‡ªå·±ç¬”è®°æœ¬ä¸Šè£…äº†ä¸ªminikubeï¼Œè¯•ç©æ„Ÿå—å°†åœ¨åç»­å‘è¡¨ã€‚&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;è¯•ç©æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$gofabric8 start
using the executable /usr/local/bin/minikube
minikube already running
using the executable /usr/local/bin/kubectl
Switched to context &amp;quot;minikube&amp;quot;.
Deploying fabric8 to your Kubernetes installation at https://192.168.99.100:8443 for domain  in namespace default

Loading fabric8 releases from maven repository:https://repo1.maven.org/maven2/
Deploying package: platform version: 2.4.24

Now about to install package https://repo1.maven.org/maven2/io/fabric8/platform/packages/fabric8-platform/2.4.24/fabric8-platform-2.4.24-kubernetes.yml
Processing resource kind: Namespace in namespace default name user-secrets-source-admin
Found namespace on kind Secret of user-secrets-source-adminProcessing resource kind: Secret in namespace user-secrets-source-admin name default-gogs-git
Processing resource kind: Secret in namespace default name jenkins-docker-cfg
Processing resource kind: Secret in namespace default name jenkins-git-ssh
Processing resource kind: Secret in namespace default name jenkins-hub-api-token
Processing resource kind: Secret in namespace default name jenkins-master-ssh
Processing resource kind: Secret in namespace default name jenkins-maven-settings
Processing resource kind: Secret in namespace default name jenkins-release-gpg
Processing resource kind: Secret in namespace default name jenkins-ssh-config
Processing resource kind: ServiceAccount in namespace default name configmapcontroller
Processing resource kind: ServiceAccount in namespace default name exposecontroller
Processing resource kind: ServiceAccount in namespace default name fabric8
Processing resource kind: ServiceAccount in namespace default name gogs
Processing resource kind: ServiceAccount in namespace default name jenkins
Processing resource kind: Service in namespace default name fabric8
Processing resource kind: Service in namespace default name fabric8-docker-registry
Processing resource kind: Service in namespace default name fabric8-forge
Processing resource kind: Service in namespace default name gogs
...
-------------------------

Default GOGS admin username/password = gogsadmin/RedHat$1

Checking if PersistentVolumeClaims bind to a PersistentVolume ....
Downloading images and waiting to open the fabric8 console...

-------------------------
.....................................................
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯åŠ¨äº†åŠå¤©ä¸€ç›´æ˜¯è¿™ç§çŠ¶æ€ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Waiting, endpoint for service is not ready yet...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä¸€çœ‹ä¸‹è½½ä¸‹æ¥çš„&lt;code&gt;https://repo1.maven.org/maven2/io/fabric8/platform/packages/fabric8-platform/2.4.24/fabric8-platform-2.4.24-kubernetes.yml&lt;/code&gt;æ–‡ä»¶ï¼ŒçœŸæ˜¯&lt;strong&gt;è”šä¸ºå£®è§‚&lt;/strong&gt;å•Šï¼Œè¶³è¶³æœ‰&lt;strong&gt;24712è¡Œ&lt;/strong&gt;(è¿™é‡Œé¢éƒ½æ˜¯å®é™…é…ç½®ï¼Œæ²¡æœ‰é…ç½®å……è¡Œæ•°)ï¼Œä½¿ç”¨äº†å¦‚ä¸‹è¿™äº›dockeré•œåƒï¼Œè¶³è¶³æœ‰&lt;strong&gt;53ä¸ªdockeré•œåƒ&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;fabric8/alpine-caddy:2.2.311
fabric8/apiman-gateway:2.2.168
fabric8/apiman:2.2.168
fabric8/chaos-monkey:2.2.311
fabric8/configmapcontroller:2.3.5
fabric8/eclipse-orion:2.2.311
fabric8/elasticsearch-k8s:2.3.4
fabric8/elasticsearch-logstash-template:2.2.311
fabric8/elasticsearch-v1:2.2.168
fabric8/exposecontroller:2.3.2
fabric8/fabric8-console:2.2.199
fabric8/fabric8-forge:2.3.88
fabric8/fabric8-kiwiirc:2.2.311
fabric8/fluentd-kubernetes:v1.19
fabric8/gerrit:2.2.311
fabric8/git-collector:2.2.311
fabric8/gogs:v0.9.97
fabric8/grafana:2.6.1
fabric8/hubot-irc:2.2.311
fabric8/hubot-letschat:v1.0.0
fabric8/hubot-notifier:2.2.311
fabric8/hubot-slack:2.2.311
fabric8/jenkins-docker:2.2.311
fabric8/jenkinshift:2.2.199
fabric8/kafka:2.2.153
fabric8/kibana-config:2.2.311
fabric8/kibana4:v4.5.3
fabric8/lets-chat:2.2.311
fabric8/maven-builder:2.2.311
fabric8/message-broker:2.2.168
fabric8/message-gateway:2.2.168
fabric8/nexus:2.2.311
fabric8/taiga-back:2.2.311
fabric8/taiga-front:2.2.311
fabric8/turbine-server:1.0.28
fabric8/zookeeper:2.2.153
fabric8/zookeeper:2.2.168
funktion/funktion-nodejs-runtime:1.0.3
funktion/funktion:1.0.9
gitlab/gitlab-ce
jboss/keycloak:2.2.0.Final
jfrog-docker-registry.bintray.io/artifactory/artifactory-oss
jimmidyson/configmap-reload:v0.1
manageiq/manageiq:latest
mongo
mysql:5.7
nginxdemos/nginx-ingress:0.3.1
openzipkin/zipkin:1.13.0
postgres
prom/blackbox-exporter:master
prom/node-exporter
prom/prometheus:v1.3.1
registry:2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ ä»¬æ„Ÿå—ä¸‹å§ï¼Œæˆ‘æœæ–­æ”¾å¼ƒäº†åœ¨è‡ªå·±ç¬”è®°æœ¬ä¸Šå®‰è£…çš„å¿µå¤´ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>