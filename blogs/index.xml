<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Blogs on Jimmy&#39;s blog</title>
    <link>http://rootsongjc.github.io/blogs/index.xml</link>
    <description>Recent content in Blogs on Jimmy&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 19 Mar 2017 23:00:29 +0800</lastBuildDate>
    <atom:link href="http://rootsongjc.github.io/blogs/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Dockeræºç åˆ†æç¬¬ä¸€ç¯‡â€”â€”ä»£ç ç»“æ„</title>
      <link>http://rootsongjc.github.io/blogs/docker-source-code-analysis-code-structure/</link>
      <pubDate>Sun, 19 Mar 2017 23:00:29 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-source-code-analysis-code-structure/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20151001042.jpg&#34; alt=&#34;å…«è¾¾å²­é•¿åŸ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(é¢˜å›¾ï¼šåŒ—äº¬å…«è¾¾å²­é•¿åŸ  Oct 1,2015)&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ä¹‹å‰é™†é™†ç»­ç»­çœ‹è¿‡ä¸€ç‚¹&lt;strong&gt;docker&lt;/strong&gt;çš„æºç ï¼Œéƒ½æœªæˆä½“ç³»ï¼Œæœ€è¿‘åœ¨ç ”ç©¶&lt;strong&gt;Docker-17.03-CE&lt;/strong&gt;ï¼Œè¶æ­¤æœºä¼šç ”ç©¶ä¸‹dockerçš„æºç ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€äº›ç›¸å…³èµ„æ–™ï¼Œéƒ½æ¯”è¾ƒè¿‡æ—¶äº†ï¼Œå‘ç°*å­™å®äº®*å¤§å“¥å†™è¿‡ä¸€æœ¬ä¹¦å«ã€ŠDockeræºç åˆ†æã€‹ï¼Œè€Œä¸”ä¹‹å‰ä¹Ÿåœ¨&lt;strong&gt;InfoQ&lt;/strong&gt;ä¸Šé™†ç»­å‘è¿‡ä¸€äº›æ–‡ç« ï¼Œè™½ç„¶æ–‡ç« éƒ½æ¯”è¾ƒè€äº†ï¼ŒåŸºäºè€çš„dockerç‰ˆæœ¬ï¼Œä½†æˆ‘è®¤ä¸ºä¾ç„¶æœ‰é˜…è¯»çš„ä»·å€¼ã€‚èµ·ç èƒ½æœ‰è¿™ä¸‰æ–¹é¢æ”¶è·ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä¸€æ˜¯åŸ¹å…»é˜…è¯»æºç çš„æ€ç»´æ–¹å¼ï¼Œä¸ºè‡ªå·±é˜…è¯»dockeræºç æä¾›å€Ÿé‰´ã€‚&lt;/li&gt;
&lt;li&gt;äºŒæ˜¯å¯ä»¥äº†è§£dockerç‰ˆæœ¬çš„æ¥é¾™å»è„‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸‰è¿˜å¯ä»¥ä½œä¸ºGoè¯­è¨€é¡¹ç›®å¼€å‘ä½œä¸ºå€Ÿé‰´ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ä¸‹è½½åœ°å€&#34;&gt;ä¸‹è½½åœ°å€&lt;/h3&gt;

&lt;p&gt;é‰´äºè¿™æœ¬ä¹¦å·²ç»å‘è¡Œä¸€å¹´åŠäº†äº†ï¼ŒåŸºäºçš„dockerç‰ˆæœ¬è¿˜æ˜¯&lt;strong&gt;1.2.0&lt;/strong&gt;ï¼Œè€Œå¦‚ä»Šéƒ½åˆ°äº†&lt;strong&gt;1.13.0&lt;/strong&gt;ï¼ˆdocker17.03çš„è€ç‰ˆæœ¬å·ï¼‰ï¼Œåº”è¯¥å¾ˆå°‘æœ‰äººä¹°äº†å§ï¼Œå¯ä»¥è¯´è¿™æœ¬ä¹¦çš„çº¸è´¨ç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå·®ä¸å¤šäº†å§ã€‚å¦‚æœæœ‰äººæ„Ÿå…´è¶£å¯ä»¥ä¸‹è½½pdfç‰ˆæœ¬çœ‹çœ‹ï¼Œ&lt;a href=&#34;http://olz1di9xf.bkt.clouddn.com/Docker%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%AD%99%E5%AE%8F%E4%BA%AE%E8%91%97.pdf&#34;&gt;Dockeræºç è§£æ-æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾-å­™å®äº®è‘—-2015å¹´8æœˆ&lt;/a&gt;ï¼ˆå®Œæ•´æ–‡å­—ç‰ˆï¼Œå¤§å°25.86Mï¼‰ï¼Œ&lt;a href=&#34;http://olz1di9xf.bkt.clouddn.com/Docker%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%AD%99%E5%AE%8F%E4%BA%AE-%E7%9C%8B%E4%BA%91%E7%89%88.pdf&#34;&gt;Dockeræºç è§£æ-çœ‹äº‘æ•´ç†ç‰ˆ&lt;/a&gt;ï¼ˆæ–‡å­—ç‰ˆï¼Œæœ‰ç¼©ç•¥ï¼Œå¤§å°7.62Mï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;out-of-date&#34;&gt;Out-of-date&lt;/h2&gt;

&lt;p&gt;æœ‰ä¸€ç‚¹å¿…é¡»å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œè¿™æœ¬ä¹¦ä¸­çš„dockeræºç åˆ†ææ˜¯åŸºäº&lt;strong&gt;docker1.2.0&lt;/strong&gt;ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬çš„dockeræºç åœ¨githubä¸Šå·²ç»æ— æ³•ä¸‹è½½åˆ°äº†ï¼Œgithubä¸Šavailableçš„æœ€ä½ç‰ˆæœ¬çš„dockeræºç æ˜¯&lt;strong&gt;1.4.1&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;é¡ºä¾¿æ„Ÿå¹ä¸€å¥ï¼Œç§‘æŠ€è¡Œä¸šå‘å±•å®åœ¨å¤ªå¿«äº†ï¼Œå°¤å…¶æ˜¯äº’è”ç½‘ï¼Œä¸€æœ¬ä¹¦èƒ½è¿ç»­ç”¨ä¸Šä¸‰å¹´éƒ½ä¸è¿‡æ—¶ï¼Œå¦‚æœè¿™æ ·çš„è¯é‚£ä¹ˆè¿™é—¨æŠ€æœ¯ææ€•éƒ½å°±è¦è¢«æ·˜æ±°äº†å§ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;æ€»ä½“æ¶æ„&#34;&gt;æ€»ä½“æ¶æ„&lt;/h2&gt;

&lt;p&gt;Dockeræ€»ä½“ä¸Šæ˜¯ç”¨çš„æ˜¯&lt;strong&gt;Client/Server&lt;/strong&gt;æ¨¡å¼ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½å¯ä»¥é€šè¿‡RESTfulæ¥å£ä¼ é€’ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªDockerè½¯ä»¶çš„æ¶æ„ä¸­å¯ä»¥åˆ†æˆä¸‰ä¸ªè§’è‰²ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Daemon&lt;/strong&gt;ï¼šå¸¸é©»åå°è¿è¡Œçš„è¿›ç¨‹ï¼Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç®¡ç†dockerå®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Clien&lt;/strong&gt;tï¼šå‘½ä»¤è¡Œç»ˆç«¯ï¼ŒåŒ…è£…å‘½ä»¤å‘é€APIè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Engine&lt;/strong&gt;ï¼šçœŸæ­£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„åç«¯ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ä»£ç ç»“æ„&#34;&gt;ä»£ç ç»“æ„&lt;/h2&gt;

&lt;p&gt;Dockerçš„ä»£ç ç»“æ„æ¯”è¾ƒæ¸…æ™°ï¼Œåˆ†æˆçš„ç›®å½•æ¯”è¾ƒå¤šï¼Œæœ‰ä»¥ä¸‹è¿™äº›ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;api&lt;/strong&gt;ï¼šå®šä¹‰APIï¼Œä½¿ç”¨äº†&lt;strong&gt;Swagger2.0&lt;/strong&gt;è¿™ä¸ªå·¥å…·æ¥ç”ŸæˆAPIï¼Œé…ç½®æ–‡ä»¶åœ¨&lt;code&gt;api/swagger.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;builder&lt;/strong&gt;ï¼šç”¨æ¥build dockeré•œåƒçš„åŒ…ï¼Œçœ‹æ¥å†å²æ¯”è¾ƒæ‚ ä¹…äº†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bundles&lt;/strong&gt;ï¼šè¿™ä¸ªåŒ…æ˜¯åœ¨è¿›è¡Œ&lt;a href=&#34;http://rootsongjc.github.io/blogs/docker-dev-env/&#34;&gt;dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒæ­å»º&lt;/a&gt;çš„æ—¶å€™ç”¨åˆ°çš„ï¼Œç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶éƒ½åœ¨è¿™é‡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cli&lt;/strong&gt;ï¼šä½¿ç”¨&lt;a href=&#34;http://www.github.com/spf13/cobra&#34;&gt;cobra&lt;/a&gt;å·¥å…·ç”Ÿæˆçš„dockerå®¢æˆ·ç«¯å‘½ä»¤è¡Œè§£æå™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;ï¼šæ¥æ”¶&lt;code&gt;cli&lt;/code&gt;çš„è¯·æ±‚ï¼Œè°ƒç”¨RESTful APIä¸­çš„æ¥å£ï¼Œå‘serverç«¯å‘é€httpè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cmd&lt;/strong&gt;ï¼šå…¶ä¸­åŒ…æ‹¬&lt;code&gt;docker&lt;/code&gt;å’Œ&lt;code&gt;dockerd&lt;/code&gt;ä¸¤ä¸ªåŒ…ï¼Œä»–ä»¬åˆ†åˆ«åŒ…å«äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„mainå‡½æ•°å…¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;container&lt;/strong&gt;ï¼šå®¹å™¨çš„é…ç½®ç®¡ç†ï¼Œå¯¹ä¸åŒçš„platformé€‚é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;contrib&lt;/strong&gt;ï¼šè¿™ä¸ªç›®å½•åŒ…æ‹¬ä¸€äº›æœ‰ç”¨çš„è„šæœ¬ã€é•œåƒå’Œå…¶ä»–édocker coreä¸­çš„éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;daemon&lt;/strong&gt;ï¼šè¿™ä¸ªåŒ…ä¸­å°†docker deamonè¿è¡Œæ—¶çŠ¶æ€exposeå‡ºæ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;distribution&lt;/strong&gt;ï¼šè´Ÿè´£dockeré•œåƒçš„pullã€pushå’Œé•œåƒä»“åº“çš„ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dockerversion&lt;/strong&gt;ï¼šç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;docs&lt;/strong&gt;ï¼šæ–‡æ¡£ã€‚è¿™ä¸ªç›®å½•å·²ç»ä¸å†ç»´æŠ¤ï¼Œæ–‡æ¡£åœ¨å¦ä¸€ä¸ªä»“åº“é‡Œ&lt;a href=&#34;https://github.com/docker/docker.github.io/ã€‚&#34;&gt;https://github.com/docker/docker.github.io/ã€‚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;experimental&lt;/strong&gt;ï¼šä»docker1.13.0ç‰ˆæœ¬èµ·å¼€å§‹å¢åŠ äº†å®éªŒç‰¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;hack&lt;/strong&gt;ï¼šåˆ›å»ºdockerå¼€å‘ç¯å¢ƒå’Œç¼–è¯‘æ‰“åŒ…æ—¶ç”¨åˆ°çš„è„šæœ¬å’Œé…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;image&lt;/strong&gt;ï¼šç”¨äºæ„å»ºdockeré•œåƒçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;integration-cli&lt;/strong&gt;ï¼šé›†æˆæµ‹è¯•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;layer&lt;/strong&gt;ï¼šç®¡ç† union file system driverä¸Šçš„read-onlyå’Œread-write mountsã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;libcontainerd&lt;/strong&gt;ï¼šè®¿é—®å†…æ ¸ä¸­çš„å®¹å™¨ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;man&lt;/strong&gt;ï¼šç”Ÿæˆman pagesã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;migrate&lt;/strong&gt;ï¼šå°†è€ç‰ˆæœ¬çš„graphç›®å½•è½¬æ¢æˆæ–°çš„metadataã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;oci&lt;/strong&gt;ï¼šOpen Container Interfaceåº“&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;opts&lt;/strong&gt;ï¼šå‘½ä»¤è¡Œçš„é€‰é¡¹åº“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pkg&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;plugin&lt;/strong&gt;ï¼šdockeræ’ä»¶åç«¯å®ç°åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;profiles&lt;/strong&gt;ï¼šé‡Œé¢æœ‰apparmorå’Œseccompä¸¤ä¸ªç›®å½•ã€‚ç”¨äºå†…æ ¸è®¿é—®æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;project&lt;/strong&gt;ï¼šé¡¹ç›®ç®¡ç†çš„ä¸€äº›è¯´æ˜æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;reference&lt;/strong&gt;ï¼šå¤„ç†docker storeä¸­é•œåƒçš„referenceã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;registry&lt;/strong&gt;ï¼šdocker registryçš„å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;restartmanager&lt;/strong&gt;ï¼šå¤„ç†é‡å¯åçš„åŠ¨ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;runconfig&lt;/strong&gt;ï¼šé…ç½®æ ¼å¼è§£ç å’Œæ ¡éªŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;vendor&lt;/strong&gt;ï¼šå„ç§ä¾èµ–åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;volume&lt;/strong&gt;ï¼šdocker volumeçš„å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹ä¸€ç¯‡å°†è®²è§£dockerçš„å„ä¸ªåŠŸèƒ½æ¨¡å—å’ŒåŸç†ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Contiv Ultimate-Docker17.03CEä¸‹æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰</title>
      <link>http://rootsongjc.github.io/blogs/contiv-ultimate/</link>
      <pubDate>Fri, 17 Mar 2017 17:52:37 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/contiv-ultimate/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20140810001.jpg&#34; alt=&#34;å¹¿å·çŸ³ç‰Œæ¡¥&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šå¹¿å·çŸ³ç‰Œæ¡¥ Aug 10,2014ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;å‰å‡ å¤©å†™çš„å‡ ç¯‡&lt;a href=&#34;http://rootsongjc.github.io/tags/contiv/&#34;&gt;å…³äºContivçš„æ–‡ç« &lt;/a&gt;å·²ç»æŠŠå¼•å…¥å‘äº†ğŸ˜‚&lt;/p&gt;

&lt;p&gt;ä»Šå¤©è¿™ç¯‡æ–‡ç« å°†å¸¦é¢†å¤§å®¶ç”¨æ­£ç¡®çš„å§¿åŠ¿ç¼–è¯‘å’Œæ‰“åŒ…ä¸€ä¸ª&lt;strong&gt;contiv netplugin&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¯·ä¸€å®šè¦åœ¨&lt;strong&gt;Linux&lt;/strong&gt;ç¯å¢ƒä¸­ç¼–è¯‘ã€‚dockerä¸­ç¼–è¯‘ä¹Ÿä¼šæŠ¥é”™ï¼Œæœ€å¥½è¿˜æ˜¯æä¸ªè™šæ‹ŸğŸ”å§ï¼Œæœ€å¥½è¿˜æœ‰VPNèƒ½ç¿»å¢™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç¯å¢ƒå‡†å¤‡&#34;&gt;ç¯å¢ƒå‡†å¤‡&lt;/h2&gt;

&lt;p&gt;æˆ‘ä½¿ç”¨çš„æ˜¯docker17.03-CEã€å®‰è£…äº†open vSwitch(è¿™ä¸ªåŒ…redhatçš„æºé‡Œæ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±çš„ç¼–è¯‘å®‰è£…)ï¼Œå¦‚æœä½ æ‡’å¾—ç¼–è¯‘å¯ä»¥ç”¨æˆ‘ç¼–è¯‘çš„rpmåŒ…ï¼Œ&lt;a href=&#34;http://olz1di9xf.bkt.clouddn.com/openvswitch-2.5.0-2.el7.x86_64.rpm&#34;&gt;ç‚¹è¿™é‡Œä¸‹è½½&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç¼–è¯‘&#34;&gt;ç¼–è¯‘&lt;/h2&gt;

&lt;p&gt;è¿™ä¸€æ­¥æ˜¯å¾ˆå®¹æ˜“å¤±è´¥çš„ï¼Œæœ‰äººæè¿‡&lt;a href=&#34;https://github.com/contiv/netplugin/issues/779&#34;&gt;issue-779&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å…·ä½“æ­¥éª¤&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªlink &lt;strong&gt;/go&lt;/strong&gt;é“¾æ¥åˆ°ä½ çš„GOPATHç›®å½•ï¼Œä¸‹é¢ç¼–è¯‘çš„æ—¶å€™è¦ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;å°†æºç çš„&lt;strong&gt;vender&lt;/strong&gt;ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°$GOPATH/srcç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œç¼–è¯‘&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨netpluginç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤èƒ½å¤Ÿç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NET_CONTAINER_BUILD=1 make build
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ä½ çš„&lt;strong&gt;/$GOPATH/bin&lt;/strong&gt;ç›®å½•ä¸‹åº”è¯¥ä¼šæœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;contivk8s  github-release  godep  golint  misspell  modelgen  netcontiv  netctl  netmaster  netplugin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;âš ï¸ç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ° æœ‰äº›åŒ…ä¸å­˜åœ¨æˆ–è€…éœ€è¦ç¿»å¢™ä¸‹è½½ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ‰“åŒ…&#34;&gt;æ‰“åŒ…&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬å°†å…¶æ‰“åŒ…ä¸ºdocker pluginã€‚&lt;/p&gt;

&lt;p&gt;Makefileé‡Œç”¨äºåˆ›å»ºplugin rootfsçš„å‘½ä»¤æ˜¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Makefile&#34;&gt;host-pluginfs-create:
        @echo dev: creating a docker v2plugin rootfs ...
        sh scripts/v2plugin_rootfs.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;v2plugin_rootfs.sh&lt;/strong&gt;è¿™ä¸ªè„šæœ¬çš„å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;#!/bin/bash
# Script to create the docker v2 plugin
# run this script from contiv/netplugin directory

echo &amp;quot;Creating rootfs for v2plugin &amp;quot;, ${CONTIV_V2PLUGIN_NAME}
cat install/v2plugin/config.template | grep -v &amp;quot;##&amp;quot; &amp;gt; install/v2plugin/config.json
sed -i &amp;quot;s%PluginName%${CONTIV_V2PLUGIN_NAME}%&amp;quot; install/v2plugin/config.json
cp bin/netplugin bin/netmaster bin/netctl install/v2plugin
docker build -t contivrootfs install/v2plugin
id=$(docker create contivrootfs true)
mkdir -p install/v2plugin/rootfs
sudo docker export &amp;quot;${id}&amp;quot; | sudo tar -x -C install/v2plugin/rootfs
docker rm -vf &amp;quot;${id}&amp;quot;
docker rmi contivrootfs
rm install/v2plugin/netplugin install/v2plugin/netmaster install/v2plugin/netctl
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…ˆæŠŠ&lt;code&gt;$GOPATH/bin&lt;/code&gt;ä¸‹ç”Ÿæˆçš„&lt;code&gt;netplugin&lt;/code&gt;ã€&lt;code&gt;netmaster&lt;/code&gt;ã€&lt;code&gt;netctl&lt;/code&gt;ã€&lt;code&gt;netplugin&lt;/code&gt;è¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°netpluginæºç çš„binç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œé¢ç”¨è¯­åˆ›å»ºcontivrootfsé•œåƒçš„Dockerfileå†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Dockerfile&#34;&gt;# Docker v2plugin container with OVS / netplugin / netmaster 

FROM alpine:3.5
MAINTAINER Cisco Contiv (http://contiv.github.io/)

RUN mkdir -p /run/docker/plugins /etc/openvswitch /var/run/contiv/log \
    &amp;amp;&amp;amp; echo &#39;http://dl-cdn.alpinelinux.org/alpine/v3.4/main&#39; &amp;gt;&amp;gt; /etc/apk/repositories \
    &amp;amp;&amp;amp; apk update &amp;amp;&amp;amp; apk add openvswitch=2.5.0-r0 iptables

COPY netplugin netmaster netctl startcontiv.sh /

ENTRYPOINT [&amp;quot;/startcontiv.sh&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;make host-pluginfs-create&lt;/code&gt;åˆ›å»ºrootfsã€‚&lt;/p&gt;

&lt;p&gt;åˆ›å»ºå‡ºäº†rootfsåï¼Œç„¶åæ‰§è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;docker plugin create localhost:5000/contiv/netplugin .
docker push localhost:5000/contiv/netplugin
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šæˆ‘ä»¬å°†æ’ä»¶pushåˆ°docker registryçš„é•œåƒä»“åº“ä¸­ï¼Œå½“å‰&lt;a href=&#34;www.github.com/vmware/harbor&#34;&gt;Harbor&lt;/a&gt;è¿˜ä¸æ”¯æŒdockeræ’ä»¶çš„pushã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;Install plugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ç¼–è¯‘å’Œå®‰è£…æˆ‘è‡ªå·±ç”Ÿæˆv2pluginçš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹&lt;strong&gt;config.json&lt;/strong&gt;æ–‡ä»¶ä¸­çš„&lt;code&gt;plugin_name&lt;/code&gt;å­—æ®µçš„å€¼ä¸ºæ’ä»¶çš„åç§°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$docker plugin install localhost:5000/contiv/v2plugin 
Plugin &amp;quot;localhost:5000/contiv/v2plugin&amp;quot; is requesting the following privileges:
 - network: [host]
 - mount: [/etc/openvswitch]
 - mount: [/var/log/openvswitch]
 - mount: [/var/run]
 - mount: [/lib/modules]
 - capabilities: [CAP_SYS_ADMIN CAP_NET_ADMIN CAP_SYS_MODULE]
Do you grant the above permissions? [y/N] y
latest: Pulling from contiv/v2plugin
fd87a71d9090: Download complete 
Digest: sha256:b13ad7930f771c9602acf562c2ae147482466f4d94e708692a215935663215a6
Status: Downloaded newer image for localhost:5000/contiv/v2plugin:latest
Installed plugin localhost:5000/contiv/v2plugin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡ªå·±createçš„æ’ä»¶enableçš„æ—¶å€™ä»docker daemonçš„æ—¥å¿—ä¸­ä¾ç„¶å¯ä»¥çœ‹åˆ°ä¹‹å‰çœ‹åˆ°æ‰¾ä¸åˆ°socketçš„é”™è¯¯ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®æ˜¯æ²¡æœ‰ç”Ÿæˆã€‚å¦‚æœç›´æ¥ä½¿ç”¨&lt;code&gt;docker plugin install store/contiv/v2plugin:1.0.0-beta.3&lt;/code&gt;çš„æ–¹å¼å®‰è£…æ’ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;docker17-03-ceä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜&#34;&gt;Docker17.03-CEä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;Docker17.03çš„æ’ä»¶æœºåˆ¶æ˜¯ä¸ºäº†dockerå…¬å¸çš„å•†ä¸šåŒ–ç­–ç•¥è€Œå®è¡Œçš„ï¼Œæ‰€æœ‰çš„dockeræ’ä»¶éƒ½è¿è¡Œåœ¨è‡ªå·±çš„namespaceå’Œrootfsä¸­ï¼Œæ’ä»¶æ¥å£&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Plugin backendæ¥å£&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// Backend for Plugin
type Backend interface {
	Disable(name string, config *enginetypes.PluginDisableConfig) error
	Enable(name string, config *enginetypes.PluginEnableConfig) error
	List(filters.Args) ([]enginetypes.Plugin, error)
	Inspect(name string) (*enginetypes.Plugin, error)
	Remove(name string, config *enginetypes.PluginRmConfig) error
	Set(name string, args []string) error
	Privileges(ctx context.Context, ref reference.Named, metaHeaders http.Header, authConfig *enginetypes.AuthConfig) (enginetypes.PluginPrivileges, error)
	Pull(ctx context.Context, ref reference.Named, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, privileges enginetypes.PluginPrivileges, outStream io.Writer) error
	Push(ctx context.Context, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, outStream io.Writer) error
	Upgrade(ctx context.Context, ref reference.Named, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, privileges enginetypes.PluginPrivileges, outStream io.Writer) error
	CreateFromContext(ctx context.Context, tarCtx io.ReadCloser, options *enginetypes.PluginCreateOptions) error
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»Pluginçš„åç«¯æ¥å£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰åƒé•œåƒä¸€æ ·çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰ä¿®æ”¹pluginåå­—çš„æ–¹æ³•ï¼Œå› ä¸ºæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ— æ³•push pluginåˆ°è‡ªå·±çš„é•œåƒä»“åº“ï¼Œå¦å¤–&lt;strong&gt;Harbor&lt;/strong&gt;è¿˜æ˜¯ä¸æ”¯æŒ&lt;code&gt;docker plugin push&lt;/code&gt; &lt;a href=&#34;https://github.com/vmware/harbor/issues/1532&#34;&gt;Issue-1532&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰å¯¼å‡ºpluginçš„æ–¹æ³•ï¼Œè¿™æ ·å°±åªèƒ½åœ¨è”ç½‘çš„ä¸»æœºä¸Šå®‰è£…docker pluginäº†ï¼Œå¯¹äºæ— æ³•è”ç½‘çš„ä¸»æœºåªå¥½æŸæ‰‹æ— ç­–äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¼°è®¡dockerå®˜æ–¹ä¹Ÿä¸ä¼šå¼€æ”¾è¿™ä¸¤ä¸ªæ¥å£å§ã€‚æ¯•ç«Ÿè¿™æ˜¯&lt;strong&gt;Docker EE&lt;/strong&gt; çš„ä¸€ä¸ªé‡è¦å–ç‚¹ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Docker EE&amp;rsquo;s Certified Plugins&lt;/strong&gt; provide networking and volume plugins and easy to download and install containers to the Docker EE environment.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç–‘é—®&#34;&gt;ç–‘é—®&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸€å®šè¦ä½¿ç”¨docker plugin install&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å› ä¸º&lt;code&gt;docker plugin install&lt;/code&gt;çš„æ—¶å€™ä¼šç”³è¯·ä¸€äº›è®¿é—®æƒé™ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸€å—åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­å¯ä»¥çœ‹åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆdocker pluginä¸èƒ½æ”¹åå­—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹Pluginçš„ç»“æ„ä½“ï¼ˆåœ¨api/types/plugin.goä¸­å®šä¹‰ï¼‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// Plugin A plugin for the Engine API
// swagger:model Plugin
type Plugin struct {

	// config
	// Required: true
	Config PluginConfig `json:&amp;quot;Config&amp;quot;`

	// True when the plugin is running. False when the plugin is not running, only installed.
	// Required: true
	Enabled bool `json:&amp;quot;Enabled&amp;quot;`

	// Id
	ID string `json:&amp;quot;Id,omitempty&amp;quot;`

	// name
	// Required: true
	Name string `json:&amp;quot;Name&amp;quot;`

	// plugin remote reference used to push/pull the plugin
	PluginReference string `json:&amp;quot;PluginReference,omitempty&amp;quot;`

	// settings
	// Required: true
	Settings PluginSettings `json:&amp;quot;Settings&amp;quot;`
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª&lt;code&gt;PluginReference&lt;/code&gt;ç»“æ„ä½“ï¼Œå®ƒçš„æ–¹æ³•æœ‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;type pluginReference struct {
	name     reference.Named
	pluginID digest.Digest
}

func (r *pluginReference) References(id digest.Digest) []reference.Named {
	if r.pluginID != id {
		return nil
	}
	return []reference.Named{r.name}
}

func (r *pluginReference) ReferencesByName(ref reference.Named) []refstore.Association {
	return []refstore.Association{
		{
			Ref: r.name,
			ID:  r.pluginID,
		},
	}
}

func (r *pluginReference) Get(ref reference.Named) (digest.Digest, error) {
	if r.name.String() != ref.String() {
		return digest.Digest(&amp;quot;&amp;quot;), refstore.ErrDoesNotExist
	}
	return r.pluginID, nil
}

func (r *pluginReference) AddTag(ref reference.Named, id digest.Digest, force bool) error {
	// Read only, ignore
	return nil
}
func (r *pluginReference) AddDigest(ref reference.Canonical, id digest.Digest, force bool) error {
	// Read only, ignore
	return nil
}
func (r *pluginReference) Delete(ref reference.Named) (bool, error) {
	// Read only, ignore
	return false, nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„å…¶ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•&lt;code&gt;AddTag&lt;/code&gt;ã€&lt;code&gt;AddDigest&lt;/code&gt;ã€&lt;code&gt;Delete&lt;/code&gt;æ–¹æ³•éƒ½æ˜¯åªè¯»çš„ã€‚åœ¨&lt;code&gt;migrate/v1/migratev1.go&lt;/code&gt;ä¸­æœ‰å¼•ç”¨åˆ°äº†è¿™ä¸ªã€‚&lt;/p&gt;

&lt;p&gt;å†çœ‹ä¸‹&lt;strong&gt;Reference&lt;/strong&gt;çš„çš„å®šä¹‰ï¼ˆvendor/github.com/docker/distribution/reference/reference.goï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// Package reference provides a general type to represent any way of referencing images within the registry.
// Its main purpose is to abstract tags and digests (content-addressable hash).
//
// Grammar
//
// 	reference                       := name [ &amp;quot;:&amp;quot; tag ] [ &amp;quot;@&amp;quot; digest ]
//	name                            := [domain &#39;/&#39;] path-component [&#39;/&#39; path-component]*
//	domain                          := domain-component [&#39;.&#39; domain-component]* [&#39;:&#39; port-number]
//	domain-component                := /([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])/
//	port-number                     := /[0-9]+/
//	path-component                  := alpha-numeric [separator alpha-numeric]*
// 	alpha-numeric                   := /[a-z0-9]+/
//	separator                       := /[_.]|__|[-]*/
//
//	tag                             := /[\w][\w.-]{0,127}/
//
//	digest                          := digest-algorithm &amp;quot;:&amp;quot; digest-hex
//	digest-algorithm                := digest-algorithm-component [ digest-algorithm-separator digest-algorithm-component ]
//	digest-algorithm-separator      := /[+.-_]/
//	digest-algorithm-component      := /[A-Za-z][A-Za-z0-9]*/
//	digest-hex                      := /[0-9a-fA-F]{32,}/ ; At least 128 bit digest value
//
//	identifier                      := /[a-f0-9]{64}/
//	short-identifier                := /[a-f0-9]{6,64}/
// Reference is an opaque object reference identifier that may include
// modifiers such as a hostname, name, tag, and digest.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿®æ”¹pluginçš„åå­—çš„æ–¹æ³•æ˜¯ä¸æ˜¯è¿˜æ²¡å®ç°ï¼Ÿ&lt;/p&gt;

&lt;h2 id=&#34;è§£å†³æ–¹æ³•&#34;&gt;è§£å†³æ–¹æ³•&lt;/h2&gt;

&lt;p&gt;åœ¨ä»£ç å­˜åœ¨bugçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆç”¨ä¸‹é¢çš„æ–¹æ³•æš‚æ—¶åˆ›å»ºpluginã€‚&lt;/p&gt;

&lt;p&gt;è™½ç„¶dockerä»£ç é‡Œæ²¡æœ‰æä¾›&lt;strong&gt;rename plugin&lt;/strong&gt;çš„æ¥å£ï¼Œä½†æ˜¯ä½¿ç”¨&lt;strong&gt;docker install&lt;/strong&gt;å‘½ä»¤å®‰è£…çš„pluginä¼šå­˜å‚¨åœ¨&lt;code&gt;/var/lib/docker/plugins/${PLUGIN_ID}&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹ä½¿ç”¨&lt;strong&gt;docker plugin create&lt;/strong&gt;å‘½ä»¤åˆ›å»ºä½ è‡ªå·±æƒ³è¦çš„åç§°çš„docker pluginã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;docker plugin set&lt;/code&gt;å‘½ä»¤ä¿®æ”¹pluginä¸­çš„å±æ€§:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;cluster_store&lt;/li&gt;
&lt;li&gt;plugin_role&lt;/li&gt;
&lt;li&gt;plugin_name&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;æ’ä»¶è°ƒè¯•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ—¥å¿—åœ°å€&lt;code&gt;/run/contiv/log/&lt;/code&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Docker17.03-CEæ’ä»¶å¼€å‘-ä¸¾ä¸ªğŸŒ°</title>
      <link>http://rootsongjc.github.io/blogs/docker-plugin-develop/</link>
      <pubDate>Wed, 15 Mar 2017 13:57:26 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-plugin-develop/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20161016022.jpg&#34; alt=&#34;æ­å·å´å±±&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ­å·å´å±±æ­¥é“æ—çš„å¢™å£ Oct 16,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å½“ä½ çœ‹åˆ°è¿™ç¯‡æ–‡ç« æ—¶ï¼Œå¦‚æœä½ ä¹Ÿæ­£åœ¨è¿›è¡Œdocker1.13+ç‰ˆæœ¬ä¸‹çš„pluginå¼€å‘ï¼Œæ­å–œä½ ä¹Ÿå…¥å‘äº†ï¼Œå¦‚æœä½ è¶Ÿå‡ºå‘ï¼Œéº»çƒ¦å‘Šè¯‰ä½ çš„æ–¹æ³•ï¼Œæ„Ÿæ©ä¸å°½ğŸ™&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;çœ‹äº†æ–‡ç« åä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œå®˜ç½‘ä¸Šçš„å¯èƒ½æ˜¯ä¸ªå‡ğŸŒ°ã€‚&lt;strong&gt;è™½ç„¶å®˜ç½‘ä¸Šçš„æ–‡æ¡£å†™çš„æœ‰ç‚¹ä¸å¯¹ï¼Œä¸è¿‡ä½ ä½¿ç”¨docker-ssh-volumeçš„å¼€æºä»£ç è‡ªå·±å»æ„å»ºpluginçš„è¿˜æ˜¯å¯ä»¥æˆåŠŸçš„ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;docker-pluginå¼€å‘æ–‡æ¡£&#34;&gt;Docker pluginå¼€å‘æ–‡æ¡£&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆdockerå®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ª&lt;a href=&#34;https://docs.docker.com/engine/extend/legacy_plugins/&#34;&gt;docker legacy pluginæ–‡æ¡£&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« åŸºæœ¬å°±æ˜¯å‘Šè¯‰ä½ dockerç›®å‰æ”¯æŒå“ªäº›æ’ä»¶ï¼Œç½—åˆ—äº†ä¸€ç³»åˆ—è¿æ¥ï¼Œä¸è¿‡å¯¹ä¸èµ·ï¼Œè¿™äº›ä¸æ˜¯dockerå®˜æ–¹æ’ä»¶ï¼Œæœ‰é—®é¢˜å»æ‰¾å®ƒä»¬çš„å¼€å‘è€…å»å§ğŸ˜‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Docker pluginè²Œä¼¼å¼€å§‹ä½¿ç”¨äº†æ–°çš„v2 pluginäº†ï¼Œlegacyç‰ˆæœ¬çš„pluginå¯ä»¥èƒ½åœ¨åæœŸè¢«åºŸå¼ƒã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä»dockerçš„æºç &lt;strong&gt;plugin/store.go&lt;/strong&gt;ä¸­å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;/* allowV1PluginsFallback determines daemon&#39;s support for V1 plugins.
 * When the time comes to remove support for V1 plugins, flipping
 * this bool is all that will be needed.
 */
const allowV1PluginsFallback bool = true

/* defaultAPIVersion is the version of the plugin API for volume, network,
   IPAM and authz. This is a very stable API. When we update this API, then
   pluginType should include a version. e.g. &amp;quot;networkdriver/2.0&amp;quot;.
*/
const defaultAPIVersion string = &amp;quot;1.0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;éšç€dockerå…¬å¸æ˜¯çš„æˆ˜ç•¥è°ƒæ•´ï¼Œæ¨å‡ºäº†docker-CEå’Œdocker-EEä¹‹åï¼Œæœªæ¥æœ‰äº›æ’ä»¶å°±å¯èƒ½è¦æ”¶è´¹äº†ï¼Œv2ç‰ˆæœ¬çš„æ’ä»¶éƒ½æ˜¯åœ¨docker storeä¸­ä¸‹è½½äº†ï¼Œè€Œè¿™ç§æ’ä»¶åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½æ˜¯æ‰“åŒ…æˆdocker imageï¼Œå¦‚æœä¸å¼€æ”¾æºç çš„è¯ï¼Œä½ å³ä½¿pullä¸‹æ¥æ’ä»¶ä¹Ÿæ— æ³•ä¿®æ”¹å’Œå¯¼å‡ºçš„ï¼Œ&lt;strong&gt;docker pluginç›®å‰æ²¡æœ‰å¯¼å‡ºæ¥å£&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;çœŸæ­£è¦å¼€å‘ä¸€ä¸ªdocker pluginè¿˜æ˜¯å¾—çœ‹&lt;a href=&#34;https://docs.docker.com/engine/extend/plugin_api/&#34;&gt;docker plugin API&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ï¼š&lt;/p&gt;

&lt;h4 id=&#34;æ’ä»¶å‘ç°&#34;&gt;æ’ä»¶å‘ç°&lt;/h4&gt;

&lt;p&gt;å½“ä½ å¼€å‘å¥½ä¸€ä¸ªæ’ä»¶&lt;strong&gt;docker engine&lt;/strong&gt;æ€ä¹ˆæ‰èƒ½å‘ç°å®ƒä»¬å‘¢ï¼Ÿæœ‰ä¸‰ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;.sock&lt;/strong&gt;ï¼Œlinuxä¸‹æ”¾åœ¨/run/docker/pluginsç›®å½•ä¸‹ï¼Œæˆ–è¯¥ç›®å½•ä¸‹çš„å­ç›®å½•æ¯”å¦‚&lt;a href=&#34;https://github.com/ClusterHQ/flocker&#34;&gt;flocker&lt;/a&gt;æ’ä»¶çš„&lt;code&gt;.sock&lt;/code&gt;æ–‡ä»¶æ”¾åœ¨&lt;code&gt;/run/docker/plugins/flocker/flocker.sock&lt;/code&gt;ä¸‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;.spec&lt;/strong&gt;ï¼Œæ¯”å¦‚&lt;strong&gt;convoy&lt;/strong&gt;æ’ä»¶åœ¨&lt;code&gt;/etc/docker/plugins/convoy.spec&lt;/code&gt;å®šä¹‰ï¼Œå†…å®¹ä¸º&lt;code&gt;unix:///var/run/convoy/convoy.sock&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;.json&lt;/strong&gt;ï¼Œæ¯”å¦‚&lt;strong&gt;infinit&lt;/strong&gt;æ’ä»¶åœ¨&lt;code&gt;/usr/lib/docker/plugins/infinit.json&lt;/code&gt;å®šä¹‰ï¼Œå†…å®¹ä¸º&lt;code&gt;{&amp;quot;Addr&amp;quot;:&amp;quot;https://infinit.sh&amp;quot;,&amp;quot;Name&amp;quot;:&amp;quot;infinit&amp;quot;}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ–‡ç« ä¸­çš„å…¶å®ƒéƒ¨åˆ†&lt;strong&gt;è²Œä¼¼éƒ½è¿‡æ—¶&lt;/strong&gt;äº†ï¼Œæ–°çš„æ’ä»¶ä¸æ˜¯ä½œä¸º&lt;strong&gt;systemd&lt;/strong&gt;è¿›ç¨‹è¿è¡Œçš„ï¼Œè€Œæ˜¯å®Œå…¨é€šè¿‡&lt;strong&gt;docker plugin&lt;/strong&gt;å‘½ä»¤æ¥ç®¡ç†çš„ã€‚&lt;/p&gt;

&lt;p&gt;å½“ä½ ä½¿ç”¨&lt;strong&gt;docker plugin enable &lt;plugin_name&gt;&lt;/strong&gt;æ¥æ¿€æ´»äº†æ’ä»¶åï¼Œç†åº”åœ¨&lt;code&gt;/run/docker/plugins&lt;/code&gt;ç›®å½•ä¸‹ç”Ÿæˆæ’ä»¶çš„&lt;code&gt;.sock&lt;/code&gt;æ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨åªæœ‰ä¸€ä¸ªä»¥runc IDå‘½åçš„ç›®å½•ï¼Œè¿™ä¸ªé—®é¢˜ä¸‹é¢æœ‰è¯¦ç»†çš„å™è¿°è¿‡ç¨‹ï¼Œä½ ä¹Ÿå¯ä»¥è·³è¿‡ï¼Œç›´æ¥çœ‹&lt;a href=&#34;https://github.com/docker/docker/issues/31723&#34;&gt;issue-31723&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/engine/extend/&#34;&gt;docker pluginç®¡ç†&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºsshfs-volume-plugin&#34;&gt;åˆ›å»ºsshfs volume plugin&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/docker/docker/blob/17.03.x/docs/extend/index.md#developing-a-plugin&#34;&gt;å®˜æ–¹ç¤ºä¾‹æ–‡æ¡£&lt;/a&gt;ï¼ˆè¿™ä¸ªæ–‡æ¡£æœ‰é—®é¢˜ï¼‰&lt;a href=&#34;https://github.com/docker/docker/issues/29886&#34;&gt;docker-issue29886&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å®˜æ–¹ä»¥å¼€å‘ä¸€ä¸ª&lt;strong&gt;sshfs&lt;/strong&gt;çš„volume pluginä¸ºä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;docker plugin create&lt;/code&gt;å‘½ä»¤çš„ç›®å½•ä¸‹å¿…é¡»åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;config.json&lt;/strong&gt;æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æ’ä»¶çš„é…ç½®ä¿¡æ¯ï¼Œ&lt;a href=&#34;https://github.com/docker/docker/blob/17.03.x/docs/extend/config.md&#34;&gt;plugin configå‚è€ƒæ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rootfs&lt;/strong&gt;ç›®å½•ï¼Œæ’ä»¶é•œåƒè§£å‹åçš„ç›®å½•ã€‚v2ç‰ˆæœ¬çš„docker pluginéƒ½æ˜¯ä»¥dockeré•œåƒçš„æ–¹å¼åŒ…è£…çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;$ git clone https://github.com/vieux/docker-volume-sshfs
$ cd docker-volume-sshfs
$ go get github.com/docker/go-plugins-helpers/volume
$ go build -o docker-volume-sshfs main.go  
$ docker build -t rootfsimage .
$ id=$(docker create rootfsimage true) # id was cd851ce43a403 when the image was created
$ sudo mkdir -p myplugin/rootfs
$ sudo docker export &amp;quot;$id&amp;quot; | sudo tar -x -C myplugin/rootfs
$ docker rm -vf &amp;quot;$id&amp;quot;
$ docker rmi rootfsimage
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;strong&gt;sshfs&lt;/strong&gt;çš„Dockerfileæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Dockerfile&#34;&gt;FROM alpine

RUN apk update &amp;amp;&amp;amp; apk add sshfs

RUN mkdir -p /run/docker/plugins /mnt/state /mnt/volumes

COPY docker-volume-sshfs docker-volume-sshfs

CMD [&amp;quot;docker-volume-sshfs&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®é™…ä¸Šæ˜¯ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°alpine linuxå®¹å™¨ä¸­è¿è¡Œã€‚&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘rootfsimageé•œåƒçš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker build -t rootfsimage .
Sending build context to Docker daemon 11.71 MB
Step 1/5 : FROM alpine
 ---&amp;gt; 4a415e366388
Step 2/5 : RUN apk update &amp;amp;&amp;amp; apk add sshfs
 ---&amp;gt; Running in 1551ecc1c847
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz
v3.5.2-2-ge626ce8c3c [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]
v3.5.1-71-gc7bb9a04f0 [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]
OK: 7959 distinct packages available
(1/10) Installing openssh-client (7.4_p1-r0)
(2/10) Installing fuse (2.9.7-r0)
(3/10) Installing libffi (3.2.1-r2)
(4/10) Installing libintl (0.19.8.1-r0)
(5/10) Installing libuuid (2.28.2-r1)
(6/10) Installing libblkid (2.28.2-r1)
(7/10) Installing libmount (2.28.2-r1)
(8/10) Installing pcre (8.39-r0)
(9/10) Installing glib (2.50.2-r0)
(10/10) Installing sshfs (2.8-r0)
Executing busybox-1.25.1-r0.trigger
Executing glib-2.50.2-r0.trigger
OK: 11 MiB in 21 packages
 ---&amp;gt; 1a73c501f431
Removing intermediate container 1551ecc1c847
Step 3/5 : RUN mkdir -p /run/docker/plugins /mnt/state /mnt/volumes
 ---&amp;gt; Running in 032af3b2595a
 ---&amp;gt; 30c7e8463e96
Removing intermediate container 032af3b2595a
Step 4/5 : COPY docker-volume-sshfs docker-volume-sshfs
 ---&amp;gt; a924c6fcc1e4
Removing intermediate container ffc5e3c97707
Step 5/5 : CMD docker-volume-sshfs
 ---&amp;gt; Running in 0dc938fe4f4e
 ---&amp;gt; 0fd2e3d94860
Removing intermediate container 0dc938fe4f4e
Successfully built 0fd2e3d94860
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;config.json&lt;/code&gt;æ–‡æ¡£&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Json&#34;&gt;{
    &amp;quot;description&amp;quot;: &amp;quot;sshFS plugin for Docker&amp;quot;,
    &amp;quot;documentation&amp;quot;: &amp;quot;https://docs.docker.com/engine/extend/plugins/&amp;quot;,
    &amp;quot;entrypoint&amp;quot;: [
        &amp;quot;/docker-volume-sshfs&amp;quot;
    ],
    &amp;quot;env&amp;quot;: [
        {
            &amp;quot;name&amp;quot;: &amp;quot;DEBUG&amp;quot;,
            &amp;quot;settable&amp;quot;: [
                &amp;quot;value&amp;quot;
            ],
            &amp;quot;value&amp;quot;: &amp;quot;0&amp;quot;
        }
    ],
    &amp;quot;interface&amp;quot;: {
        &amp;quot;socket&amp;quot;: &amp;quot;sshfs.sock&amp;quot;,
        &amp;quot;types&amp;quot;: [
            &amp;quot;docker.volumedriver/1.0&amp;quot;
        ]
    },
    &amp;quot;linux&amp;quot;: {
        &amp;quot;capabilities&amp;quot;: [
            &amp;quot;CAP_SYS_ADMIN&amp;quot;
        ],
        &amp;quot;devices&amp;quot;: [
            {
                &amp;quot;path&amp;quot;: &amp;quot;/dev/fuse&amp;quot;
            }
        ]
    },
    &amp;quot;mounts&amp;quot;: [
        {
            &amp;quot;destination&amp;quot;: &amp;quot;/mnt/state&amp;quot;,
            &amp;quot;options&amp;quot;: [
                &amp;quot;rbind&amp;quot;
            ],
            &amp;quot;source&amp;quot;: &amp;quot;/var/lib/docker/plugins/&amp;quot;,
            &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;
        }
    ],
    &amp;quot;network&amp;quot;: {
        &amp;quot;type&amp;quot;: &amp;quot;host&amp;quot;
    },
    &amp;quot;propagatedmount&amp;quot;: &amp;quot;/mnt/volumes&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥æ’ä»¶ä½¿ç”¨hostç½‘ç»œç±»å‹ï¼Œä½¿ç”¨/run/docker/plugins/sshfs.sockæ¥å£ä¸docker engineé€šä¿¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„å®˜ç½‘ä¸Šçš„è¿™ä¸ªæ–‡æ¡£æœ‰é—®é¢˜ï¼Œconfig.jsonä¸ä»£ç é‡Œçš„ä¸ç¬¦ï¼Œå°¤å…¶æ˜¯Entrypointçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ä¸å¯¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„&lt;strong&gt;socket&lt;/strong&gt;é…ç½®çš„åœ°å€ä¸è¦å†™è¯¦ç»†åœ°å€ï¼Œé»˜è®¤ä¼šåœ¨/run/docker/pluginsç›®å½•ä¸‹ç”Ÿæˆsocketæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºplugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;docker plugin create &amp;lt;plugin_name&amp;gt; /path/to/plugin/data/&lt;/code&gt;å‘½ä»¤åˆ›å»ºæ’ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å…·ä½“åˆ°sshfsæ’ä»¶ï¼Œåœ¨mypluginç›®å½•ä¸‹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºæ’ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker plugin create jimmmysong/sshfs:latest .
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å°±å¯ä»¥çœ‹åˆ°åˆšåˆ›å»ºçš„æ’ä»¶äº†&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker plugin ls
ID                  NAME                 DESCRIPTION               ENABLED
8aa1f6098fca        jimmysong/sshfs:latest   sshFS plugin for Docker   true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;push plugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…ˆç™»å½•ä½ çš„docker hubè´¦æˆ·ï¼Œç„¶åä½¿ç”¨&lt;code&gt;docker plugin push jimmysong/sshfs:latest&lt;/code&gt;å³å¯ä»¥æ¨é€docker pluginåˆ°docker hubä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰æ¨é€åˆ°&lt;strong&gt;harbor&lt;/strong&gt;é•œåƒä»“åº“æœ‰é—®é¢˜ï¼ŒæŠ¥é”™ä¿¡æ¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;c08c951b53b7: Preparing 
denied: requested access to the resource is denied
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å·²ç»™harboræ&lt;a href=&#34;https://github.com/vmware/harbor/issues/1532&#34;&gt;issue-1532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;pluginçš„ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœ‰å‘ç°äº†ä¸ªé—®é¢˜&lt;a href=&#34;https://github.com/docker/docker/issues/31723&#34;&gt;docker issue-31723&lt;/a&gt;ï¼Œä½¿ç”¨pluginåˆ›å»ºvolumeçš„æ—¶å€™å±…ç„¶æ‰¾ä¸åˆ°&lt;code&gt;sshfs.sock&lt;/code&gt;æ–‡ä»¶ï¼ğŸ˜¢åˆšå¼€å§‹æ‰‹åŠ¨åˆ›å»ºpluginçš„æ—¶å€™æµ‹è¯•äº†ä¸‹æ˜¯æ­£å¸¸çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥å¼„åˆ°è¿™å°æµ‹è¯•æœºå™¨ä¸Šå‡ºé—®é¢˜äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³äºdocker-plugin-enableå¤±è´¥çš„é—®é¢˜&#34;&gt;å…³äºdocker plugin enableå¤±è´¥çš„é—®é¢˜&lt;/h3&gt;

&lt;p&gt;å½“docker  pluginåˆ›å»ºæˆåŠŸå¹¶enableçš„æ—¶å€™dockerå¹¶æ²¡æœ‰æŠ¥é”™ï¼Œè¿™ä¸docker pluginçš„&lt;strong&gt;activate&lt;/strong&gt;æœºåˆ¶æœ‰å…³ï¼Œåªæœ‰å½“ä½ æœ€ç»ˆä½¿ç”¨è¯¥pluginçš„æ—¶å€™æ‰ä¼šæ¿€æ´»å®ƒã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;strong&gt;sshfs&lt;/strong&gt;æ’ä»¶åˆ›å»ºvolumeã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker volume create -d jimmysong/sshfs --name sshvolume -o sshcmd=1.2.3.4:/remote -o password=password
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŠ¥é”™å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Error response from daemon: create sshvolume: Post http://%2Frun%2Fdocker%2Fplugins%2F8f7b8f931b38a4ef53d0e4f8d738e26e8f10ef8bd26c8244f4b8dcc7276b685f%2Fsshfs.sock/VolumeDriver.Create: dial unix /run/docker/plugins/8f7b8f931b38a4ef53d0e4f8d738e26e8f10ef8bd26c8244f4b8dcc7276b685f/sshfs.sock: connect: no such file or directory
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Docker daemonåœ¨enableè¿™ä¸ªæ’ä»¶çš„æ—¶å€™ä¼šå¯»æ‰¾è¿™ä¸ª&lt;strong&gt;.sock&lt;/strong&gt;æ–‡ä»¶ï¼Œç„¶ååœ¨è‡ªå·±çš„plugindbä¸­æ³¨å†Œå®ƒï¼Œç›¸å…³ä»£ç åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼š&lt;a href=&#34;https://github.com/docker/docker/blob/17.03.x/plugin/manager_linux.go&#34;&gt;https://github.com/docker/docker/blob/17.03.x/plugin/manager_linux.go&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç›¸å…³ä»£ç ç‰‡æ®µï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;func (pm *Manager) enable(p *v2.Plugin, c *controller, force bool) error {
	...
	return pm.pluginPostStart(p, c)
}

func (pm *Manager) pluginPostStart(p *v2.Plugin, c *controller) error {
    //è¿™é‡Œéœ€è¦è·å–.sockæ–‡ä»¶çš„åœ°å€ 
    //pm.conifg.ExecRootå°±æ˜¯/run/docker/plugins
    //p.GetID()è¿”å›çš„å°±æ˜¯å¾ˆé•¿çš„é‚£ä¸²plugin ID
	sockAddr := filepath.Join(pm.config.ExecRoot, p.GetID(), p.GetSocket())
	client, err := plugins.NewClientWithTimeout(&amp;quot;unix://&amp;quot;+sockAddr, nil, c.timeoutInSecs)
	if err != nil {
		c.restart = false
		shutdownPlugin(p, c, pm.containerdClient)
		return errors.WithStack(err)
	}

	p.SetPClient(client)

	maxRetries := 3
	var retries int
	for {
		time.Sleep(3 * time.Second)
		retries++

		if retries &amp;gt; maxRetries {
			logrus.Debugf(&amp;quot;error net dialing plugin: %v&amp;quot;, err)
			c.restart = false
			shutdownPlugin(p, c, pm.containerdClient)
			return err
		}

		// net dial into the unix socket to see if someone&#39;s listening.
		conn, err := net.Dial(&amp;quot;unix&amp;quot;, sockAddr)
		if err == nil {
			conn.Close()
			break
		}
	}
	pm.config.Store.SetState(p, true)
	pm.config.Store.CallHandler(p)

	return pm.save(p)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„è¿™æ®µä»£ç é‡Œçš„&lt;strong&gt;sockAddr := filepath.Join(pm.config.ExecRoot, p.GetID(), p.GetSocket())&lt;/strong&gt;ï¼Œæˆ‘åœ¨ä¸Šé¢æ·»åŠ äº†æ³¨é‡Šã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ª&lt;strong&gt;.sock&lt;/strong&gt;æ–‡ä»¶åº”è¯¥æœ‰docker pluginæ¥ç”Ÿæˆï¼Œå…·ä½“æ€æ ·ç”Ÿæˆçš„å‘¢ï¼Ÿè¿˜ä»¥&lt;strong&gt;docker-volume-ssh&lt;/strong&gt;è¿™ä¸ªæ’ä»¶ä¸ºä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªé¡¹ç›®å°±ä¸€ä¸ª&lt;strong&gt;main.go&lt;/strong&gt;æ–‡ä»¶ï¼Œé‡Œé¢æœ€åä¸€è¡Œç”Ÿæˆäº†&lt;strong&gt;/run/docker/plugins/sshfs.sock&lt;/strong&gt;è¿™ä¸ªsockã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;logrus.Error(h.ServeUnix(socketAddress, 0))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™è¡Œä»£ç è°ƒç”¨&lt;strong&gt;docker/go-plugin-helpers/sdk/handler.go&lt;/strong&gt;ä¸­çš„:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// ServeUnix makes the handler to listen for requests in a unix socket.
// It also creates the socket file on the right directory for docker to read.
func (h Handler) ServeUnix(addr string, gid int) error {
	l, spec, err := newUnixListener(addr, gid)
	if err != nil {
		return err
	}
	if spec != &amp;quot;&amp;quot; {
		defer os.Remove(spec)
	}
	return h.Serve(l)
}

// Serve sets up the handler to serve requests on the passed in listener
func (h Handler) Serve(l net.Listener) error {
	server := http.Server{
		Addr:    l.Addr().String(),
		Handler: h.mux,
	}
	return server.Serve(l)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;//unix_listener_unsupoorted.go
func newUnixListener(pluginName string, gid int) (net.Listener, string, error) {
	return nil, &amp;quot;&amp;quot;, errOnlySupportedOnLinuxAndFreeBSD
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;çœ‹äº†ä¸Šé¢è¿™è¿™äº›ï¼Œä½ çœ‹å‡ºsocketæ–‡ä»¶æ˜¯æ€ä¹ˆåˆ›å»ºçš„å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;è¿™åˆæ˜¯ä¸€ä¸ª&lt;a href=&#34;https://github.com/vieux/docker-volume-sshfs/issues/19&#34;&gt;issue-19&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä¿®æ”¹&lt;strong&gt;config.json&lt;/strong&gt;æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„&lt;strong&gt;interfaces - socket&lt;/strong&gt;æŒ‡å®šä¸º&lt;code&gt;/run/docker/plugins/sshfs.sock&lt;/code&gt;ç„¶ååˆ›å»ºpluginï¼Œåˆ™èƒ½æˆåŠŸç”Ÿæˆsocketæ–‡ä»¶ï¼Œä½†æ˜¯å½“ä½ enableå®ƒçš„æ—¶å€™åˆä¼šæŠ¥é”™&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Error response from daemon: Unix socket path &amp;quot;/run/docker/plugins/ac34f7b246ac6c029023b1ebd48e166eadcdd2c9d0cc682cadca0336951d72f7/run/docker/plugins/sshfs.sock&amp;quot; is too long
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»docker daemonçš„æ—¥å¿—é‡Œå¯ä»¥çœ‹åˆ°è¯¦ç»†æŠ¥é”™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Mar 13 17:15:20 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:15:20+08:00&amp;quot; level=info msg=&amp;quot;standard_init_linux.go:178: exec user process caused \&amp;quot;no such file or directory\&amp;quot;&amp;quot; plugin=ac34f7b246ac6c029023b1ebd48e166eadcdd2c9d0cc682cadca0336951d72f7
Mar 13 17:15:20 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:15:20.321277088+08:00&amp;quot; level=error msg=&amp;quot;Sending SIGTERM to plugin failed with error: rpc error: code = 2 desc = no such process&amp;quot;
Mar 13 17:15:20 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:15:20.321488680+08:00&amp;quot; level=error msg=&amp;quot;Handler for POST /v1.26/plugins/sshfs/enable returned error: Unix socket path \&amp;quot;/run/docker/plugins/ac34f7b246ac6c029023b1ebd48e166eadcdd2c9d0cc682cadca0336951d72f7/run/docker/plugins/sshfs.sock\&amp;quot; is too long\ngithub.com/docker/docker/plugin.(*Manager).pluginPostStart\n\t/root/rpmbuild/BUILD/docker-engine/.gopath/src/github.com/docker/docker/plugin/manager_linux.go:84\ngithub.com/docker/docker/plugin.(*Manager).enable\n\t/root/rpmbuild/BUILD/docker-
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ­£å¥½éªŒè¯äº†ä¸Šé¢çš„&lt;strong&gt;enable&lt;/strong&gt;ä»£ç ï¼Œdockeré»˜è®¤æ˜¯åˆ°&lt;code&gt;/run/docker/plugins&lt;/code&gt;ç›®å½•ä¸‹æ‰¾&lt;strong&gt;sshfs.sock&lt;/strong&gt;è¿™ä¸ªæ–‡ä»¶çš„ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘åœ¨docker daemonä¸­å‘ç°ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„é”™è¯¯ï¼Œ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Mar 13 17:29:41 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:29:41+08:00&amp;quot; level=info msg=&amp;quot;standard_init_linux.go:178: exec user process caused \&amp;quot;no such file or directory\&amp;quot;&amp;quot; plugin=85760810b4850009fc965f5c20d8534dc9aba085340a2ac0b4b9167a6fef7d53
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘æŸ¥çœ‹äº†ä¸‹&lt;code&gt;github.com/libnetwork/vendor/github.com/opencontainers/run/libcontainer/standard_init_linux.go&lt;/code&gt;æ–‡ä»¶ï¼Œè¿™ä¸ªé‚£ä¸ªæ–‡ä»¶åªæœ‰114è¡Œï¼Œè§è¿™é‡Œ&lt;a href=&#34;https://github.com/docker/libnetwork/blob/master/vendor/github.com/opencontainers/runc/libcontainer/standard_init_linux.go&#34;&gt;https://github.com/docker/libnetwork/blob/master/vendor/github.com/opencontainers/runc/libcontainer/standard_init_linux.go&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯åœ¨&lt;strong&gt;opencontainers&lt;/strong&gt;çš„githubé¡¹ç›®é‡Œæ‰æœ‰é‚£ä¹ˆå¤šè¡Œï¼Œè§è¿™é‡Œï¼š&lt;a href=&#34;https://github.com/opencontainers/runc/blob/master/libcontainer/standard_init_linux.go&#34;&gt;https://github.com/opencontainers/runc/blob/master/libcontainer/standard_init_linux.go&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæŠ¥é”™å‰åçš„å‡½æ•°æ˜¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// PR_SET_NO_NEW_PRIVS isn&#39;t exposed in Golang so we define it ourselves copying the value
// the kernel
const PR_SET_NO_NEW_PRIVS = 0x26

func (l *linuxStandardInit) Init() error {
	if !l.config.Config.NoNewKeyring {
		ringname, keepperms, newperms := l.getSessionRingParams()

		// do not inherit the parent&#39;s session keyring
		sessKeyId, err := keys.JoinSessionKeyring(ringname)
		if err != nil {
			return err
		}
		// make session keyring searcheable
		if err := keys.ModKeyringPerm(sessKeyId, keepperms, newperms); err != nil {
			return err
		}
	}

...
	}
	if l.config.Config.Seccomp != nil &amp;amp;&amp;amp; l.config.NoNewPrivileges {
         //ä¸‹é¢è¿™è¡Œæ˜¯ç¬¬178è¡Œ
		if err := seccomp.InitSeccomp(l.config.Config.Seccomp); err != nil {
			return newSystemErrorWithCause(err, &amp;quot;init seccomp&amp;quot;)
		}
	}
	// close the statedir fd before exec because the kernel resets dumpable in the wrong order
	// https://github.com/torvalds/linux/blob/v4.9/fs/exec.c#L1290-L1318
	syscall.Close(l.stateDirFD)
	if err := syscall.Exec(name, l.config.Args[0:], os.Environ()); err != nil {
		return newSystemErrorWithCause(err, &amp;quot;exec user process&amp;quot;)
	}
	return nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç»“è®º&#34;&gt;&lt;del&gt;ç»“è®º&lt;/del&gt;&lt;/h2&gt;

&lt;p&gt;&lt;del&gt;åˆ°æ­¤äº†é—®é¢˜è¿˜æ²¡è§£å†³ã€‚&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;é—®é¢˜çš„å…³é”®æ˜¯æ‰§è¡Œ&lt;strong&gt;docker create plugin&lt;/strong&gt;ä¹‹å&lt;strong&gt;.sock&lt;/strong&gt;æ–‡ä»¶åˆ›å»ºåˆ°å“ªé‡Œå»äº†ï¼Ÿä¸ºä»€ä¹ˆåœ¨&lt;strong&gt;config.json&lt;/strong&gt;æŒ‡å®šæˆ&lt;code&gt;/run/docker/plugins/sshfs.sock&lt;/code&gt;å°±å¯ä»¥åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºå‡º.sockæ–‡ä»¶ï¼Œè¯´æ˜&lt;strong&gt;åˆ›å»ºsocketçš„å®šä¹‰å’Œget socketæ—¶å¯»æ‰¾çš„è·¯å¾„ä¸ä¸€æ ·&lt;/strong&gt;ï¼Œåˆ›å»ºsocketæ—¶å°±æ˜¯å›ºå®šåœ¨/run/docker/pluginsç›®å½•ä¸‹åˆ›å»ºï¼Œè€Œenable pluginçš„æ—¶å€™ï¼ŒGet socketçš„æ—¶å€™è¿˜è¦åŠ ä¸Šdocker pluginçš„IDï¼Œå¯æ˜¯æŒ‰ç…§å®˜ç½‘çš„é…ç½®åœ¨æœ¬åœ°create pluginåå¹¶æ²¡æœ‰åœ¨/run/docker/pluginsç›®å½•ä¸‹ç”Ÿæˆæ’ä»¶çš„socketæ–‡ä»¶ï¼Œç›´åˆ°enableæ’ä»¶çš„æ—¶å€™æ‰ä¼šç”Ÿæˆä»¥plugin IDå‘½åçš„ç›®å½•ï¼Œä½†æ˜¯socketæ–‡ä»¶æ²¡æœ‰ï¼â˜¹ï¸&lt;/del&gt;&lt;/p&gt;

&lt;h2 id=&#34;é—®é¢˜è§£å†³&#34;&gt;é—®é¢˜è§£å†³&lt;/h2&gt;

&lt;p&gt;ä¹‹æ‰€ä»¥å‡ºç°ä¸Šé¢çš„é‚£äº›é—®é¢˜ï¼Œæ˜¯å› ä¸ºcreate docker pluginçš„æ—¶å€™æœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æœ‰é—®é¢˜ï¼Œæˆ‘åœ¨&lt;strong&gt;Mac&lt;/strong&gt;ä¸Šbuildçš„imageï¼Œè€Œä¸”è¿˜æ²¡æœ‰ç”¨&lt;strong&gt;Dockerfile.dev&lt;/strong&gt;è¿™ä¸ªä¸“é—¨ç”¨æ¥æ­å»ºäºŒè¿›åˆ¶æ–‡ä»¶ç¼–è¯‘ç¯å¢ƒçš„Dockerfileæ¥åˆ›å»ºgolangçš„ç¼–è¯‘ç¯å¢ƒï¼Œè™½ç„¶docker pluginæ˜¯åˆ›å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯å½“docker plugin enableçš„æ—¶å€™ï¼Œè¿™ä¸ªçƒ­ç´§å¼ æ–‡ä»¶ä¸èƒ½æ­£ç¡®çš„è¿è¡Œï¼Œæ‰€ä»¥å°±æ²¡èƒ½ç”Ÿæˆ&lt;strong&gt;sshfs.sock&lt;/strong&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¯·åœ¨Linuxç¯å¢ƒä¸‹ä½¿ç”¨&lt;strong&gt;make all&lt;/strong&gt;å‘½ä»¤æ¥åˆ›å»ºpluginã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Docker 17.03-CE create pluginæºç è§£æ</title>
      <link>http://rootsongjc.github.io/blogs/docker-create-plugin/</link>
      <pubDate>Wed, 15 Mar 2017 12:09:26 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-create-plugin/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160403050.jpg&#34; alt=&#34;æ•…å®«åšç‰©é™¢&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ•…å®« Apr 3,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ç»§ç»­ä¸Šä¸€ç¯‡&lt;a href=&#34;http://rootsongjc.github.io/blogs/docker-plugin-develop/&#34;&gt;Docker17.03-CEæ’ä»¶å¼€å‘çš„ğŸŒ°&lt;/a&gt;ï¼Œä»Šå¤©æ¥çœ‹ä¸‹&lt;strong&gt;docker create plugin&lt;/strong&gt;çš„æºç ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;cli/command/plugin/create.go&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Dockerå‘½ä»¤è¡Œ&lt;code&gt;docker plugin create&lt;/code&gt;è°ƒç”¨çš„ï¼Œä½¿ç”¨çš„æ˜¯&lt;a href=&#34;http://github.com/spf13/cobra&#34;&gt;cobra&lt;/a&gt;ï¼Œè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å¼€å‘åŒ…å¾ˆå¥½ç”¨ï¼Œæ¨èä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œè¿™ä¸¤ä¸ªå‡½æ•°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func newCreateCommand(dockerCli *command.DockerCli) *cobra.Command 
//è°ƒç”¨ä¸‹é¢çš„å‡½æ•°ï¼Œæ‹¼è£…æˆURLè°ƒç”¨RESTful APIæ¥å£
func runCreate(dockerCli *command.DockerCli, options pluginCreateOptions) error {
  ...
  if err = dockerCli.Client().PluginCreate(ctx, createCtx, createOptions); err != nil {
		return err
	}
  ...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;strong&gt;api/server/router/plugin/plugin_routes.go&lt;/strong&gt;ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (pr *pluginRouter) createPlugin(ctx context.Context, w http.ResponseWriter, r *http.Request, vars map[string]string) error {
  ...
  if err := pr.backend.CreateFromContext(ctx, r.Body, options); err != nil {
		return err
	}
  ...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;createPlugin&lt;/strong&gt;è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨api/server/route/plugin/backen.goçš„&lt;strong&gt;Backend&lt;/strong&gt;æ¥å£ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PluginCreate&lt;/strong&gt;è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨docker/docker/client/Interface.goçš„&lt;strong&gt;PluginAPIClient&lt;/strong&gt;æ¥å£ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;docker/client/plugin_create.go&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// PluginCreate creates a plugin
func (cli *Client) PluginCreate(ctx context.Context, createContext io.Reader, createOptions types.PluginCreateOptions) error {
	headers := http.Header(make(map[string][]string))
	headers.Set(&amp;quot;Content-Type&amp;quot;, &amp;quot;application/x-tar&amp;quot;)

	query := url.Values{}
	query.Set(&amp;quot;name&amp;quot;, createOptions.RepoName)

	resp, err := cli.postRaw(ctx, &amp;quot;/plugins/create&amp;quot;, query, createContext, headers)
	if err != nil {
		return err
	}
	ensureReaderClosed(resp)
	return err
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;pluginåœ¨åç«¯æ¥æ”¶åˆ°è¯·æ±‚åä¼šæ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ã€‚æœ€ç»ˆ&lt;strong&gt;create plugin&lt;/strong&gt;çš„å®ç°åœ¨plugin/backend_linux.goä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// CreateFromContext creates a plugin from the given pluginDir which contains
// both the rootfs and the config.json and a repoName with optional tag.
func (pm *Manager) CreateFromContext(ctx context.Context, tarCtx io.ReadCloser, options *types.PluginCreateOptions) (err error) {}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡³äºdocker create pluginæ—¶dockeråå°ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Œå°±çœ‹ğŸ‘†é‚£ä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Docker v.s Kubernetes part2</title>
      <link>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part2/</link>
      <pubDate>Fri, 10 Mar 2017 22:06:32 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part2/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160709044.jpg&#34; alt=&#34;æ‰¿å¾·å…´éš†æ˜Ÿç©º&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ²³åŒ—æ‰¿å¾·å…´éš†å¿é›¾çµå±±äº¬éƒŠæœ€ä½³æ˜Ÿç©ºæ‹æ‘„ç‚¹ July 9,2016)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡æ˜¯&lt;code&gt;Docker v.s Kubernetes&lt;/code&gt;ç¬¬äºŒç¯‡ï¼Œç»­æ¥ä¸Šæ–‡&lt;a href=&#34;http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/&#34;&gt;Docker v.s Kuberntes Part1&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesæ˜¯å…¸å‹çš„&lt;strong&gt;Master/Slave&lt;/strong&gt;æ¶æ„æ¨¡å¼ï¼Œæœ¬æ–‡ç®€è¦çš„ä»‹ç»kubenetesçš„æ¶æ„å’Œç»„ä»¶æ„æˆã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetesæ ¸å¿ƒæ¶æ„&#34;&gt;Kubernetesæ ¸å¿ƒæ¶æ„&lt;/h2&gt;

&lt;h3 id=&#34;masterèŠ‚ç‚¹&#34;&gt;masterèŠ‚ç‚¹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;apiserverï¼šä½œä¸ºkubernetesç³»ç»Ÿçš„å…¥å£ï¼Œå°è£…äº†æ ¸å¿ƒå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»¥RESTFulæ¥å£æ–¹å¼æä¾›ç»™å¤–éƒ¨å®¢æˆ·å’Œå†…éƒ¨ç»„ä»¶è°ƒç”¨ã€‚å®ƒç»´æŠ¤çš„RESTå¯¹è±¡å°†æŒä¹…åŒ–åˆ°etcdï¼ˆä¸€ä¸ªåˆ†å¸ƒå¼å¼ºä¸€è‡´æ€§çš„key/valueå­˜å‚¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;schedulerï¼šè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ï¼Œä¸ºæ–°å»ºçš„Podåˆ†é…æœºå™¨ã€‚è¿™éƒ¨åˆ†å·¥ä½œåˆ†å‡ºæ¥å˜æˆä¸€ä¸ªç»„ä»¶ï¼Œæ„å‘³ç€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢æˆå…¶ä»–çš„è°ƒåº¦å™¨ã€‚&lt;/li&gt;
&lt;li&gt;controller-managerï¼šè´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰æœ‰ä¸¤ç±»ï¼š

&lt;ol&gt;
&lt;li&gt;endpoint-controllerï¼šå®šæœŸå…³è”serviceå’ŒPod(å…³è”ä¿¡æ¯ç”±endpointå¯¹è±¡ç»´æŠ¤)ï¼Œä¿è¯serviceåˆ°Podçš„æ˜ å°„æ€»æ˜¯æœ€æ–°çš„ã€‚&lt;/li&gt;
&lt;li&gt;replication-controllerï¼šå®šæœŸå…³è”replicationControllerå’ŒPodï¼Œä¿è¯replicationControllerå®šä¹‰çš„å¤åˆ¶æ•°é‡ä¸å®é™…è¿è¡ŒPodçš„æ•°é‡æ€»æ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;nodeèŠ‚ç‚¹&#34;&gt;nodeèŠ‚ç‚¹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;kubeletï¼šè´Ÿè´£ç®¡æ§dockerå®¹å™¨ï¼Œå¦‚å¯åŠ¨/åœæ­¢ã€ç›‘æ§è¿è¡ŒçŠ¶æ€ç­‰ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–åˆ†é…åˆ°æœ¬æœºçš„Podï¼Œå¹¶æ ¹æ®Podä¿¡æ¯å¯åŠ¨æˆ–åœæ­¢ç›¸åº”çš„å®¹å™¨ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¼šæ¥æ”¶apiserverçš„HTTPè¯·æ±‚ï¼Œæ±‡æŠ¥Podçš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;proxyï¼šè´Ÿè´£ä¸ºPodæä¾›ä»£ç†ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–æ‰€æœ‰çš„serviceï¼Œå¹¶æ ¹æ®serviceä¿¡æ¯åˆ›å»ºä»£ç†ã€‚å½“æŸä¸ªå®¢æˆ·Podè¦è®¿é—®å…¶ä»–Podæ—¶ï¼Œè®¿é—®è¯·æ±‚ä¼šç»è¿‡æœ¬æœºproxyåšè½¬å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;http://valleylord.github.io/images/201601-kubernetes-concepts/kubernetes-masterslave.png&#34; alt=&#34;img&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;kubernetesç»„ä»¶è¯¦ç»†ä»‹ç»&#34;&gt;Kubernetesç»„ä»¶è¯¦ç»†ä»‹ç»&lt;/h2&gt;

&lt;h3 id=&#34;etcd&#34;&gt;etcd&lt;/h3&gt;

&lt;p&gt;è™½ç„¶ä¸æ˜¯Kubernetesçš„ç»„ä»¶ä½†æ˜¯æœ‰å¿…è¦æä¸€ä¸‹ï¼Œetcdæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ååŒæ•°æ®åº“ï¼ŒåŸºäºGoè¯­è¨€å¼€å‘ï¼Œ&lt;code&gt;CoreOS&lt;/code&gt;å…¬å¸å‡ºå“ï¼Œä½¿ç”¨&lt;a href=&#34;http://rootsongjc.github.io/blogs/raft/&#34;&gt;raftä¸€è‡´æ€§ç®—æ³•&lt;/a&gt;ååŒã€‚Kubernetesçš„ä¸»æ•°æ®åº“ï¼Œåœ¨å®‰è£…kubernetesä¹‹å‰å°±è¦å…ˆå®‰è£…å®ƒï¼Œå¾ˆå¤šå¼€æºä¸‹é¡¹ç›®éƒ½ç”¨åˆ°ï¼Œè€ç‰ˆæœ¬çš„&lt;code&gt;docker swarm&lt;/code&gt;ä¹Ÿç”¨åˆ°äº†å®ƒã€‚ç›®å‰ä¸»è¦ä½¿ç”¨çš„æ˜¯&lt;code&gt;2.7.x&lt;/code&gt;ç‰ˆæœ¬ï¼Œ&lt;code&gt;3.0+&lt;/code&gt;ç‰ˆæœ¬çš„APIå˜åŒ–å¤ªå¤§ã€‚&lt;/p&gt;

&lt;h3 id=&#34;apiserver&#34;&gt;APIServer&lt;/h3&gt;

&lt;p&gt;APIServerè´Ÿè´£å¯¹å¤–æä¾›kubernetes APIæœåŠ¡ï¼Œå®ƒè¿è¡Œåœ¨masterèŠ‚ç‚¹ä¸Šã€‚ä»»ä½•å¯¹èµ„æºçš„å¢åˆ æ”¹æŸ¥éƒ½è¦äº¤ç»™APIServerå¤„ç†åæ‰èƒ½æäº¤ç»™etcdã€‚APIServeræ€»ä½“ä¸Šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šHTTP/HTTPSæœåŠ¡å’Œä¸€äº›åŠŸèƒ½æ€§æ’ä»¶ã€‚è¿™äº›åŠŸèƒ½æ€§æ’ä»¶åˆåˆ†ä¸ºä¸¤ç§ï¼šä¸€éƒ¨åˆ†ä¸åº•å±‚IaaSå¹³å°ï¼ˆCloud Provideï¼‰ç›¸å…³ï¼›å¦ä¸€éƒ¨åˆ†ä¸èµ„æºç®¡ç†æ§åˆ¶ï¼ˆAdmission Controlï¼‰ç›¸å…³ã€‚&lt;/p&gt;

&lt;h3 id=&#34;scheduler&#34;&gt;Scheduler&lt;/h3&gt;

&lt;p&gt;Schedulerçš„ä½œç”¨æ˜¯&lt;strong&gt;æ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å°†podè°ƒåº¦åˆ°nodeèŠ‚ç‚¹ä¸Š&lt;/strong&gt;ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºç»‘å®šã€‚Schedulerè°ƒåº¦å™¨çš„è¾“å…¥æ˜¯å¾…è°ƒåº¦çš„podå’Œå¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ï¼Œè¾“å‡ºåˆ™æ˜¯ä¸€ä¸ªå·²ç»ç»‘å®šäº†podçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯é€šè¿‡è°ƒåº¦ç®—æ³•åœ¨å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©çš„æœ€ä¼˜èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹ä»å“ªé‡Œæ¥ï¼Ÿå·¥ä½œèŠ‚ç‚¹å¹¶ä¸æ˜¯ç”±Kubernetesåˆ›å»ºï¼Œå®ƒæ˜¯ç”±IaaSå¹³å°åˆ›å»ºï¼Œæˆ–è€…å°±æ˜¯ç”±ç”¨æˆ·ç®¡ç†çš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚ä½†æ˜¯Kubernetesä¼šåˆ›å»ºä¸€ä¸ªNodeå¯¹è±¡ï¼Œç”¨æ¥æè¿°è¿™ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚æè¿°çš„å…·ä½“ä¿¡æ¯ç”±åˆ›å»ºNodeå¯¹è±¡çš„é…ç½®æ–‡ä»¶ç»™å‡ºã€‚ä¸€æ—¦ç”¨æˆ·åˆ›å»ºèŠ‚ç‚¹çš„è¯·æ±‚è¢«æˆåŠŸå¤„ç†ï¼ŒKubernetesåˆä¼šç«‹å³åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªnodeå¯¹è±¡ï¼Œå†å»æ£€æŸ¥è¯¥èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µã€‚åªæœ‰é‚£äº›å½“å‰å¯ç”¨çš„nodeæ‰ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èŠ‚ç‚¹å¹¶å…è®¸podè°ƒåº¦åˆ°ä¸Šé¢è¿è¡Œã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹å¯ä»¥é€šè¿‡èµ„æºé…ç½®æ–‡ä»¶æˆ–è€…kubectlå‘½ä»¤è¡Œå·¥å…·æ¥åˆ›å»ºã€‚Kubernetesä¸»è¦ç»´æŠ¤å·¥ä½œèŠ‚ç‚¹çš„ä¸¤ä¸ªå±æ€§ï¼šspecå’Œstatusæ¥æè¿°ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„æœŸæœ›çŠ¶æ€å’Œå½“å‰çŠ¶æ€ã€‚å…¶ä¸­ï¼Œæ‰€è°“çš„å½“å‰çŠ¶æ€ä¿¡æ¯ç”±3ä¸ªä¿¡æ¯ç»„æˆï¼š&lt;code&gt;HostIp&lt;/code&gt;ã€&lt;code&gt;NodePhase&lt;/code&gt;å’Œ&lt;code&gt;Node Condition&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹çš„åŠ¨æ€ç»´æŠ¤è¿‡ç¨‹ä¾é &lt;strong&gt;Node Controller&lt;/strong&gt;æ¥å®Œæˆï¼Œå®ƒæ˜¯&lt;code&gt;Kubernetes Controller Manager&lt;/code&gt;ä¸‹å±çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚å®ƒä¼šä¸€ç›´ä¸æ–­çš„æ£€æŸ¥Kuberneteså·²çŸ¥çš„æ¯å°nodeèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœä¸€ä¸ªä¹‹å‰å·²ç»å¤±è´¥çš„èŠ‚ç‚¹åœ¨è¿™ä¸ªæ£€æŸ¥å¾ªç¯ä¸­è¢«æ£€æŸ¥ä¸ºå¯ä»¥å·¥ä½œçš„ï¼Œé‚£ä¹ˆNode Controllerä¼šæŠŠè¿™ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°å·¥ä½œèŠ‚ç‚¹ä¸­ï¼ŒNode Controllerä¼šä»å·¥ä½œèŠ‚ç‚¹ä¸­åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;controller-manager&#34;&gt;Controller Manager&lt;/h3&gt;

&lt;p&gt;Controller Managerè¿è¡Œåœ¨é›†ç¾¤çš„MasterèŠ‚ç‚¹ä¸Šï¼Œæ˜¯åŸºäºpod APIçš„ä¸€ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œå®ƒ&lt;strong&gt;é‡ç‚¹å®ç°service Endpointï¼ˆæœåŠ¡ç«¯ç‚¹ï¼‰çš„åŠ¨æ€æ›´æ–°&lt;/strong&gt;ã€‚ç®¡ç†ç€Kubernetesé›†ç¾¤ä¸­å„ç§æ§åˆ¶èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬&lt;strong&gt;replication Controller&lt;/strong&gt;å’Œ&lt;strong&gt;node Controller&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸APIServerç›¸æ¯”ï¼ŒAPIServerè´Ÿè´£æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶åˆ›å»ºå¯¹åº”çš„èµ„æºï¼Œè€ŒController Manageråœ¨ç³»ç»Ÿä¸­æ‰®æ¼”çš„è§’è‰²æ˜¯åœ¨ä¸€æ—æ—é»˜é»˜çš„ç®¡æ§è¿™äº›èµ„æºï¼Œç¡®ä¿ä»–ä»¬æ°¸è¿œä¿æŒåœ¨é¢„æœŸçš„çŠ¶æ€&lt;/strong&gt;ã€‚å®ƒé‡‡ç”¨å„ç§ç®¡ç†å™¨å®šæ—¶çš„å¯¹podã€èŠ‚ç‚¹ç­‰èµ„æºè¿›è¡Œé¢„è®¾çš„æ£€æŸ¥ï¼Œç„¶ååˆ¤æ–­å‡ºäºé¢„æœŸçš„æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´ï¼Œåˆ™é€šçŸ¥APIServeré‡‡å–è¡ŒåŠ¨ï¼Œæ¯”å¦‚é‡å¯ã€è¿ç§»ã€åˆ é™¤ç­‰ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kubelet&#34;&gt;kubelet&lt;/h3&gt;

&lt;p&gt;kubeletç»„ä»¶å·¥ä½œåœ¨Kubernetesçš„nodeä¸Šï¼Œ&lt;strong&gt;è´Ÿè´£ç®¡ç†å’Œç»´æŠ¤åœ¨è¿™å°ä¸»æœºä¸Šè¿è¡Œç€çš„æ‰€æœ‰å®¹å™¨&lt;/strong&gt;ã€‚ kubeletä¸cAdvisoräº¤äº’æ¥æŠ“å–dockerå®¹å™¨å’Œä¸»æœºçš„èµ„æºä¿¡æ¯ã€‚ kubeletåƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒåŒ…æ‹¬å®¹å™¨åƒåœ¾å›æ”¶å’Œé•œåƒåƒåœ¾å›æ”¶ã€‚ kubeletå·¥ä½œèŠ‚ç‚¹çŠ¶æ€åŒæ­¥ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kube-proxy&#34;&gt;kube-proxy&lt;/h3&gt;

&lt;p&gt;kube-proxyæä¾›ä¸¤ç§åŠŸèƒ½:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æä¾›ç®—æ³•å°†å®¢æœç«¯æµé‡è´Ÿè½½å‡è¡¡åˆ°serviceå¯¹åº”çš„ä¸€ç»„åç«¯podã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨etcdçš„watchæœºåˆ¶ï¼Œå®ç°æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œç»´æŠ¤ä¸€å¼ ä»serviceåˆ°endpointçš„æ˜ å°„å…³ç³»ï¼Œä»è€Œä¿è¯åç«¯podçš„IPå˜åŒ–ä¸ä¼šå¯¹è®¿é—®è€…çš„è®¿é—®é€ æˆå½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Docker v.s Kubernetes part1</title>
      <link>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/</link>
      <pubDate>Fri, 10 Mar 2017 21:09:47 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20161016031.jpg&#34; alt=&#34;æ­å·è¥¿æ¹–&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ­å·è¥¿æ¹– Oct 16,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;è¿™ä¸€ç³»åˆ—æ–‡ç« æ˜¯å¯¹æ¯”kubernetes å’Œdockerä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼Œé‰´äºæˆ‘ä¹‹å‰ä»docker1.10.3èµ·å¼€å§‹ä½¿ç”¨dockerï¼Œå¯¹åŸç”Ÿdockerçš„äº†è§£æ¯”è¾ƒå¤šï¼Œæœ€è¿‘åˆæ­£åœ¨çœ‹&lt;strong&gt;Kunernetesæƒå¨æŒ‡å—ï¼ˆç¬¬äºŒç‰ˆï¼‰&lt;/strong&gt;è¿™æœ¬ä¹¦ï¼ˆP.Sæ„Ÿè°¢&lt;u&gt;ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/u&gt;çš„ç¼–è¾‘æœ‹å‹èµ é€æ­¤ä¹¦ï¼‰ã€‚è¿™ç³»åˆ—æ–‡ç« ä¸æ˜¯ä¸ºäº†æ¯”è¾ƒå­°ä¼˜å­°åŠ£ï¼Œ&lt;strong&gt;é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤ç³»åˆ—æ–‡ç« ä¸­æ‰€è¯´çš„&lt;strong&gt;docker&lt;/strong&gt;æŒ‡çš„æ˜¯*17.03-ce*ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ¦‚å¿µæ€§çš„å·®åˆ«&#34;&gt;æ¦‚å¿µæ€§çš„å·®åˆ«&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;äº†è§£ä¸€æ ·ä¸œè¥¿é¦–å…ˆè¦é«˜å±‹å»ºç“´çš„äº†è§£å®ƒçš„æ¦‚å¿µï¼ŒkubernetesåŒ…æ‹¬ä»¥ä¸‹å‡ ç§èµ„æºå¯¹è±¡ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/abstractions/pod/&#34;&gt;Pod&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;li&gt;Volume&lt;/li&gt;
&lt;li&gt;Namespace&lt;/li&gt;
&lt;li&gt;ReplicaSet&lt;/li&gt;
&lt;li&gt;Deployment&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/abstractions/controllers/statefulsets/&#34;&gt;StatefulSet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;DaemonSet&lt;/li&gt;
&lt;li&gt;Job&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Docker&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Dockerçš„èµ„æºå¯¹è±¡ç›¸å¯¹äºkubernetesæ¥è¯´å°±ç®€å•å¤šäº†ï¼Œåªæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;li&gt;Node&lt;/li&gt;
&lt;li&gt;Stack&lt;/li&gt;
&lt;li&gt;Docker&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°±è¿™ä¹ˆç®€å•ï¼Œä½¿ç”¨ä¸€ä¸ª*docker-compose.yml*å³å¯ä»¥å¯åŠ¨ä¸€ç³»åˆ—æœåŠ¡ã€‚å½“ç„¶ç®€å•çš„å¥½å¤„æ˜¯ä¾¿äºç†è§£å’Œç®¡ç†ï¼Œä½†æ˜¯åœ¨åŠŸèƒ½æ–¹é¢å°±æ²¡æœ‰kubernetesé‚£ä¹ˆå¼ºå¤§äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŠŸèƒ½æ€§å·®åˆ«&#34;&gt;åŠŸèƒ½æ€§å·®åˆ«&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetes èµ„æºé™åˆ¶ CPU 100måƒåˆ†ä¹‹ä¸€æ ¸ä¸ºå•ä½ï¼Œç»å¯¹å€¼ï¼Œrequests å’Œlimitsï¼Œè¶…è¿‡è¿™ä¸ªå€¼å¯èƒ½è¢«æ€æ‰ï¼Œèµ„æºé™åˆ¶åŠ›åº¦æ¯”dockeræ›´ç»†ã€‚&lt;/li&gt;
&lt;li&gt;Podä¸­æœ‰ä¸ªæœ€åº•å±‚çš„pause å®¹å™¨ï¼Œå…¶ä»–ä¸šåŠ¡å®¹å™¨å…±ç”¨ä»–çš„IPï¼Œdockerå› ä¸ºæ²¡æœ‰è¿™å±‚æ¦‚å¿µï¼Œæ‰€ä»¥æ²¡æ³•å…±ç”¨IPï¼Œè€Œæ˜¯ä½¿ç”¨overlayç½‘ç»œåŒå¤„äºä¸€ä¸ªç½‘ç»œé‡Œæ¥é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesåœ¨rcä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ä¼ é€’é…ç½®ï¼ˆ1.3ç‰ˆæœ¬æ˜¯è¿™æ ·çš„ï¼Œåç»­ç‰ˆæœ¬è¿˜æ²¡æœ‰ç ”ç©¶è¿‡ï¼‰&lt;/li&gt;
&lt;li&gt;Kuberentes Label å¯ä»¥åœ¨å¼€å§‹å’ŒåŠ¨æ€çš„æ·»åŠ ä¿®æ”¹ï¼Œæ‰€æœ‰çš„èµ„æºå¯¹è±¡éƒ½æœ‰ï¼Œè¿™ä¸€ç‚¹dockerä¹Ÿæœ‰ï¼Œä½†æ˜¯èµ„æºè°ƒåº¦å› ä¸ºæ²¡æœ‰kubernetesé‚£ä¹ˆå±‚çº§ï¼Œæ‰€æœ‰è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ã€‚&lt;/li&gt;
&lt;li&gt;Kuberneteså¯¹è±¡é€‰æ‹©æœºåˆ¶ç»§ç»­é€šè¿‡label selectorï¼Œç”¨äºå¯¹è±¡è°ƒåº¦ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„é•œåƒï¼Œå«åš&lt;code&gt;google_containers/pause&lt;/code&gt;ï¼Œè¿™ä¸ªé•œåƒæ˜¯ç”¨æ¥å®ç°Podæ¦‚å¿µçš„ã€‚&lt;/li&gt;
&lt;li&gt;HPA horizontal pod autoscaling æ¨ªå‘ç§»åŠ¨æ‰©å®¹ï¼Œä¹Ÿæ˜¯ä¸€ç§èµ„æºå¯¹è±¡ï¼Œæ ¹æ®è´Ÿè½½å˜åŒ–æƒ…å†µé’ˆå¯¹æ€§çš„è°ƒæ•´podç›®æ ‡å‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesä¸­æœ‰ä¸‰ä¸ªIPï¼ŒNode,Pod,Cluster IPçš„å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œdockerä¸­æ²¡æœ‰Cluster IPçš„æ¦‚å¿µã€‚&lt;/li&gt;
&lt;li&gt;æŒä¹…åŒ–å­˜å‚¨ï¼Œåœ¨Kubernetesä¸­æœ‰Persistent volume åªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨ï¼Œä¸å±äºä»»ä½•nodeï¼Œç‹¬ç«‹äºpodä¹‹å¤–ï¼Œè€Œdockeråªèƒ½ä½¿ç”¨&lt;code&gt;volume plugin&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·ç®¡ç†ï¼Œkubernetesä¸­æœ‰`Namespaceï¼Œdockeræš‚æ—¶æ²¡æœ‰å¤šç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»ä½“æ¥è¯´Dockeræ¶æ„æ›´åŠ ç®€å•ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„é…ç½®ï¼Œåªéœ€è¦æ¯ä¸ªç»“ç‚¹éƒ½å®‰è£…dockerå³å¯ï¼Œè°ƒåº¦å’Œç®¡ç†åŠŸèƒ½æ²¡kubernetesé‚£ä¹ˆå¤æ‚ã€‚ä½†æ˜¯kubernetesæœ¬èº«å°±æ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®ä¸­å¿ƒç®¡ç†å·¥å…·ï¼Œä¸ä»…å¯ä»¥ç”¨æ¥ç®¡ç†dockerï¼Œ*pod*è¿™ä¸ªæ¦‚å¿µé‡Œå°±å¯ä»¥è¿è¡Œä¸ä»…æ˜¯dockeräº†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä»¥åçš„æ–‡ç« ä¸­å°†ç»“åˆdockerç€é‡è®²Kubernetesï¼ŒåŸºäº1.3ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Contivå…¥å‘æŒ‡å—-v2plugin</title>
      <link>http://rootsongjc.github.io/blogs/contiv-v2plugin/</link>
      <pubDate>Fri, 10 Mar 2017 11:51:09 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/contiv-v2plugin/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20161022082.jpg&#34; alt=&#34;ä¸Šæµ·äº¤é€šå¤§å­¦&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(é¢˜å›¾ï¼šä¸Šæµ·äº¤é€šå¤§å­¦ Oct 22,2016)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ç»§ç»­è¶Ÿæ˜¨å¤©æŒ–çš„å‘ã€‚&lt;/p&gt;

&lt;p&gt;æ˜¨å¤©çš„&lt;a href=&#34;https://github.com/contiv/netplugin/issues/776&#34;&gt;issue-776&lt;/a&gt;å·²ç»å¾—åˆ°@gkvijayçš„å›å¤ï¼ŒåŸæ¥æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…contiv/v2pluginçš„ç¼˜æ•…ï¼Œæ‰€ä»¥create contiv networkå¤±è´¥ï¼Œæˆ‘éœ€è¦è‡ªå·±buildä¸€ä¸ª&lt;strong&gt;docker plugin&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æŸ¥çœ‹ä¸‹è¿™ä¸ª&lt;a href=&#34;https://github.com/contiv/netplugin/commit/8afd1b7718c8424a876760d18484124e0aad3557&#34;&gt;commit&lt;/a&gt;é‡Œé¢æœ‰build &lt;strong&gt;v2plugin&lt;/strong&gt;çš„è„šæœ¬æ›´æ”¹ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥buildè‡ªå·±çš„v2pluginã€‚&lt;/p&gt;

&lt;p&gt;å‰æä½ éœ€è¦å…ˆbuildå‡º&lt;code&gt;netctl&lt;/code&gt;ã€&lt;code&gt;netmaster&lt;/code&gt;ã€&lt;code&gt;netplugin&lt;/code&gt;ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¹¶ä¿å­˜åˆ°&lt;strong&gt;bin&lt;/strong&gt;ç›®å½•ä¸‹ï¼Œå¦‚æœä½ æ²¡è‡ªå·±buildç›´æ¥ä¸‹è½½&lt;strong&gt;release&lt;/strong&gt;é‡Œé¢çš„æ–‡ä»¶ä¿å­˜è¿›å»ä¹Ÿè¡Œã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç¼–è¯‘v2pluginæ’ä»¶&#34;&gt;ç¼–è¯‘v2pluginæ’ä»¶&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¿®æ”¹config.jsonæ’ä»¶é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Json&#34;&gt;{
    &amp;quot;manifestVersion&amp;quot;: &amp;quot;v0&amp;quot;,
    &amp;quot;description&amp;quot;: &amp;quot;Contiv network plugin for Docker&amp;quot;,
    &amp;quot;documentation&amp;quot;: &amp;quot;https://contiv.github.io&amp;quot;,
    &amp;quot;entrypoint&amp;quot;: [&amp;quot;/startcontiv.sh&amp;quot;],
    &amp;quot;network&amp;quot;: {
           &amp;quot;type&amp;quot;: &amp;quot;host&amp;quot;
    },
    &amp;quot;env&amp;quot;: [
       {
          &amp;quot;Description&amp;quot;: &amp;quot;To enable debug mode, set to &#39;-debug&#39;&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;dbg_flag&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;-debug&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;VLAN uplink interface used by OVS&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;iflist&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Etcd or Consul cluster store url&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;cluster_store&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;etcd://172.20.0.113:2379&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Local IP address to be used by netplugin for control communication&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;ctrl_ip&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;none&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Local VTEP IP address to be used by netplugin&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;vtep_ip&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;none&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;In &#39;master&#39; role, plugin runs netmaster and netplugin&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;plugin_role&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;master&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Netmaster url to listen http requests on&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;listen_url&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;172.20.0.113:9999&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Network Driver name for requests to dockerd. Should be same as name:tag of the plugin&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;plugin_name&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;contiv/v2plugin:latest&amp;quot;
       }
    ],
    &amp;quot;mounts&amp;quot;: [
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/etc/openvswitch&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/etc/openvswitch&amp;quot;
       },
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/var/log/openvswitch&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/var/log/openvswitch&amp;quot;
       },
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/var/run&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/var/run&amp;quot;
       },
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/lib/modules&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/lib/modules&amp;quot;
       }
    ],
    &amp;quot;interface&amp;quot; : {
          &amp;quot;types&amp;quot;: [&amp;quot;docker.networkdriver/1.0&amp;quot;, &amp;quot;docker.ipamdriver/1.0&amp;quot;],
          &amp;quot;socket&amp;quot;: &amp;quot;netplugin.sock&amp;quot;
    },
    &amp;quot;Linux&amp;quot;: {
          &amp;quot;Capabilities&amp;quot;: [&amp;quot;CAP_SYS_ADMIN&amp;quot;, &amp;quot;CAP_NET_ADMIN&amp;quot;, &amp;quot;CAP_SYS_MODULE&amp;quot;]
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/docker/docker/blob/master/docs/extend/config.md&#34;&gt;å…³äº&lt;strong&gt;docker plugin v2&lt;/strong&gt;é…ç½®æ–‡ä»¶çš„è¯´æ˜&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–¹æ³•ä¸€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è‡ªåŠ¨åŒ–make&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$make host-pluginfs-create
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ–¹æ³•äºŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›´æ¥è°ƒç”¨Makefileé‡ŒæŒ‡å®šçš„é‚£ä¸ªshellè„šæœ¬&lt;code&gt;scripts/v2plugin_rootfs.sh&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;$bash scripts/v2plugin_rootfs
Creating rootfs for v2plugin ,
sed: 1: &amp;quot;install/v2plugin/config ...&amp;quot;: command i expects \ followed by text
Sending build context to Docker daemon 73.94 MB
Step 1/5 : FROM alpine:3.5
 ---&amp;gt; 4a415e366388
Step 2/5 : MAINTAINER Cisco Contiv (http://contiv.github.io/)
 ---&amp;gt; Running in fada1677341b
 ---&amp;gt; f0440792dff6
Removing intermediate container fada1677341b
Step 3/5 : RUN mkdir -p /run/docker/plugins /etc/openvswitch /var/run/contiv/log     &amp;amp;&amp;amp; echo &#39;http://dl-cdn.alpinelinux.org/alpine/v3.4/main&#39; &amp;gt;&amp;gt; /etc/apk/repositories     &amp;amp;&amp;amp; apk update &amp;amp;&amp;amp; apk add openvswitch=2.5.0-r0 iptables
 ---&amp;gt; Running in 2ae2fbee6834
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz
v3.5.2-3-g3649125268 [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]
v3.5.1-71-gc7bb9a04f0 [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]
v3.4.6-81-g1f1f409 [http://dl-cdn.alpinelinux.org/alpine/v3.4/main]
OK: 13194 distinct packages available
(1/6) Installing libmnl (1.0.4-r0)
(2/6) Installing libnftnl-libs (1.0.7-r0)
(3/6) Installing iptables (1.6.0-r0)
(4/6) Installing libcrypto1.0 (1.0.2k-r0)
(5/6) Installing libssl1.0 (1.0.2k-r0)
(6/6) Installing openvswitch (2.5.0-r0)
Executing busybox-1.25.1-r0.trigger
OK: 19 MiB in 17 packages
 ---&amp;gt; b130141ad660
Removing intermediate container 2ae2fbee6834
Step 4/5 : COPY netplugin netmaster netctl startcontiv.sh /
 ---&amp;gt; 2b88b2f8e5e7
Removing intermediate container d7580a394c64
Step 5/5 : ENTRYPOINT /startcontiv.sh
 ---&amp;gt; Running in e6fc5c887cb3
 ---&amp;gt; 1c569e4c633d
Removing intermediate container e6fc5c887cb3
Successfully built 1c569e4c633d
Password:
03d60dc01488362156f98a062d17af7a34e4b17569c2fe4f5d2048d619860314
Untagged: contivrootfs:latest
Deleted: sha256:1c569e4c633d27bd3e79d9d30b2825ce57452d30f90a3452304b932835331b13
Deleted: sha256:2b88b2f8e5e7bae348bf296f6254662c1d444760db5acd1764b9c955b106adad
Deleted: sha256:b60594671dc9312bf7ba73bf17abb9704d2b0d0e802c0d990315c5b4a5ca11fe
Deleted: sha256:b130141ad660d4ee291d9eb9a1e0704c4bc009fc91a73de28e8fd110aa45c481
Deleted: sha256:ab3c02d5a171681ba00d27f2c456cf8b63eeeaf408161dc84d9d89526d0399de
Deleted: sha256:f0440792dff6a89e321cc5d34ecaa21b4cb993f0c4e4df6c2b04eef8878bb471
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;åˆ›å»ºé•œåƒè¿™ä¸€æ­¥éœ€è¦è¾“å…¥ä½ çš„docker hubå¯†ç ã€‚è€Œä¸”alpineä¸‹è½½è½¯ä»¶éœ€è¦ç¿»å¢™çš„ã€‚æ‰“åŒ…v2pluginç›®å½•éœ€è¦ä½¿ç”¨sudoï¼Œä¸ç„¶ä¼šæŠ¥ä¸€ä¸ªé”™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ•´ä¸ªæ’ä»¶æ‰“åŒ…å‹ç¼©åçš„å¤§å°æ˜¯91Mã€‚ç°åœ¨&lt;code&gt;rootfs&lt;/code&gt;å’Œ&lt;code&gt;config.json&lt;/code&gt;éƒ½å·²ç»æœ‰äº†ï¼Œå°±å¯ä»¥åœ¨ä½ è‡ªå·±çš„ç³»ç»Ÿä¸Šcreate docker pluginäº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å¯åŠ¨contiv-plugin&#34;&gt;å¯åŠ¨contiv plugin&lt;/h2&gt;

&lt;p&gt;åˆ›å»ºdocker network pluginå¹¶enableã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;$docker plugin create contiv/v2plugin .
contiv/v2plugin
$docker plugin enable contiv/v2plugin
$docker plugin ls
ID                  NAME                     DESCRIPTION                        ENABLED
574d4a4d82a3        contiv/v2plugin:latest   Contiv network plugin for Docker   true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡³æ­¤*contiv plugin*å·²ç»åˆ›å»ºå¥½äº†ï¼Œenableåæ‰§è¡Œ&lt;code&gt;ip addr&lt;/code&gt;å‘½ä»¤å¯ä»¥çœ‹åˆ°å¤šå‡ºä¸€ä¸ªç½‘ç»œ*contivh0*ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;contivh0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state UNKNOWN qlen 1000
link/ether 02:02:ac:13:ff:fe brd ff:ff:ff:ff:ff:ff
inet 172.19.255.254/16 scope global contivh0
	valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸”ä¸»æœºå¤šäº†ä¸€ä¸ªIPåœ°å€*172.19.255.254*ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸éœ€è¦å†ä¸»æœºä¸Šå®‰è£…&lt;code&gt;netctl&lt;/code&gt;ã€&lt;code&gt;netmaster&lt;/code&gt;ã€&lt;code&gt;netplugin&lt;/code&gt;è¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶äº†ï¼Œåªéœ€è¦å®‰è£…&lt;code&gt;docker plugin&lt;/code&gt;å³å¯ï¼Œè¿™äº›éƒ½å·²ç»å°è£…åˆ°pluginä¸­äº†ï¼Œå¦‚æœä½ çœ‹ä¸‹æ’ä»¶çš„ç›®å½•ç»“æ„å°±çŸ¥é“äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å› ä¸ºæ’ä»¶å®‰è£…çš„é—®é¢˜ï¼Œç›®å‰æˆ‘æµ‹è¯•æœºä¸Šçš„è‡ªå®šä¹‰æ’ä»¶éƒ½æ— æ³•ä½¿ç”¨ï¼Œæ­£åœ¨troubleshootingä¸­ï¼Œä¸€æ—¦æœ‰è¿›å±•ä¼šåŠæ—¶æ›´æ–°è¯¥æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–æ­£åœ¨åŒæ­¥è·Ÿå¼€å‘è€…æ²Ÿé€šä¸­ï¼Œå› ä¸ºæ—¶å·®é—®é¢˜ï¼Œä¸‹å‘¨ä¸€æ‰èƒ½æœ‰ç»“æœã€‚ğŸ˜ª&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½•</title>
      <link>http://rootsongjc.github.io/blogs/contiv-tryout/</link>
      <pubDate>Thu, 09 Mar 2017 14:23:04 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/contiv-tryout/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2017013129.jpg&#34; alt=&#34;é»„æ˜&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(é¢˜å›¾ï¼šå±±ä¸œè£æˆæ»¨æµ·é£åŠ›å‘ç”µåœº  Jan 31,2017ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;å…³äºcontivçš„ä»‹ç»è¯·çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« &lt;a href=&#34;http://rootsongjc.github.io/post/contiv_guide/&#34;&gt;Contiv Intro&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¼€å‘ç¯å¢ƒä½¿ç”¨&lt;strong&gt;Vagrant&lt;/strong&gt;æ­å»ºï¼Œæ˜¨å¤©è¯•ç”¨äº†ä¸‹ï¼ŒçœŸä¸çŸ¥é“å®ƒä»¬æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œå³ç„¶æ˜¯dockeræ’ä»¶ä¸ºå•¥ä¸ç›´æ¥åœ¨dockerä¸­å¼€å‘å‘¢ï¼Œæˆ‘æœ‰ç¯‡æ–‡ç« ä»‹ç»&lt;a href=&#34;http://rootsongjc.github.io/post/docker-dev-env/&#34;&gt;å¦‚ä½•æ­å»ºdockerå¼€å‘ç¯å¢ƒ&lt;/a&gt;ï¼Œå¯ä»¥åœ¨dockerä¸­å¼€å‘dockerï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨æ¥å¼€å‘contivå•ŠğŸ˜„ï¼Œåªè¦ä¸‹è½½ä¸€ä¸ªdockeré•œåƒ&lt;code&gt;dockercore/docker:latest&lt;/code&gt;å³å¯ï¼Œä¸è¿‡æœ‰ç‚¹å¤§2.31Gï¼Œä½¿ç”¨é˜¿é‡Œäº‘çš„mirrorä¸‹è½½å€’æ˜¯ä¹Ÿåˆ’ç®—ï¼Œæ€»æ¯”ä½ è‡ªå·±éƒ¨ç½²ä¸€ä¸ªå¼€å‘ç¯å¢ƒèŠ‚çœæ—¶é—´ã€‚&lt;/p&gt;

&lt;h3 id=&#34;contivæ¦‚å¿µè§£æ&#34;&gt;Contivæ¦‚å¿µè§£æ&lt;/h3&gt;

&lt;p&gt;Contivç”¨äºç»™å®¹å™¨åˆ›å»ºå’Œåˆ†é…ç½‘è·¯ï¼Œå¯ä»¥åˆ›å»ºç­–ç•¥ç®¡ç†å®¹å™¨çš„å®‰å…¨ã€å¸¦å®½ã€ä¼˜å…ˆçº§ç­‰ï¼Œç›¸å½“äºä¸€ä¸ªSDNã€‚&lt;/p&gt;

&lt;h4 id=&#34;group&#34;&gt;Group&lt;/h4&gt;

&lt;p&gt;æŒ‰å®¹å™¨æˆ–Podçš„åŠŸèƒ½ç»™å®¹å™¨åˆ†é…ç­–ç•¥ç»„ï¼Œé€šå¸¸æ˜¯æŒ‰ç…§å®¹å™¨/Podçš„&lt;code&gt;label&lt;/code&gt;æ¥åˆ†ç»„ï¼Œåº”ç”¨ç»„è·Ÿcontivçš„networkä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¯ä»¥å¾ˆå¤šåº”ç”¨ç»„å±äºåŒä¸€ä¸ªnetworkæˆ–IP subnetã€‚&lt;/p&gt;

&lt;h4 id=&#34;polices&#34;&gt;Polices&lt;/h4&gt;

&lt;p&gt;ç”¨æ¥é™å®šgroupçš„è¡Œä¸ºï¼Œcontivæ”¯æŒä¸¤ç§ç±»å‹çš„policyï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Bandwidth é™å®šåº”ç”¨ç»„çš„èµ„æºä½¿ç”¨ä¸Šé™&lt;/li&gt;
&lt;li&gt;Isolation èµ„æºç»„çš„è®¿é—®æƒé™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Groupå¯ä»¥åŒæ—¶åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªpolicyï¼Œå½“æœ‰å®¹å™¨è°ƒåº¦åˆ°è¯¥groupé‡Œå°±ä¼šé€‚ç”¨è¯¥groupçš„policyã€‚&lt;/p&gt;

&lt;h4 id=&#34;network&#34;&gt;Network&lt;/h4&gt;

&lt;p&gt;IPv4æˆ–IPv6ç½‘ç»œï¼Œå¯ä»¥é…ç½®subnetå’Œgatewayã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Contivä¸­çš„ç½‘ç»œ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨contivä¸­å¯ä»¥é…ç½®ä¸¤ç§ç±»å‹çš„ç½‘ç»œ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;application networkï¼šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œ&lt;/li&gt;
&lt;li&gt;infrastructure networkï¼šhost namespaceçš„è™šæ‹Ÿç½‘ç»œï¼Œæ¯”å¦‚åŸºç¡€è®¾æ–½ç›‘æ§ç½‘ç»œ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;ç½‘ç»œå°è£…&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Contivä¸­æœ‰ä¸¤ç§ç±»å‹çš„ç½‘ç»œå°è£…&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Routedï¼šoverlay topologyå’ŒL3-routed BGP topology&lt;/li&gt;
&lt;li&gt;Bridgedï¼šlayer2 VLAN&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;tenant&#34;&gt;Tenant&lt;/h4&gt;

&lt;p&gt;Tenantæä¾›contivä¸­çš„namespaceéš”ç¦»ã€‚ä¸€ä¸ªtenantå¯ä»¥æœ‰å¾ˆå¤šä¸ªnetworkï¼Œæ¯ä¸ªnetworkéƒ½æœ‰ä¸ªsubnetã€‚è¯¥tenantä¸­çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒçš„ä»»æ„networkå’Œsubnetçš„IPã€‚&lt;/p&gt;

&lt;p&gt;ç‰©ç†ç½‘ç»œä¸­çš„tenantç§°ä½œ&lt;code&gt;è™šæ‹Ÿè·¯ç”±è½¬å‘(VRF)&lt;/code&gt;ã€‚Contivä½¿ç”¨VLANå’ŒVXLAN IDæ¥å®ç°å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œè¿™å–å†³ä½ ä½¿ç”¨çš„æ˜¯layer2ã€layer3è¿˜æ˜¯Cisco ACIã€‚&lt;/p&gt;

&lt;h3 id=&#34;contivä¸‹è½½&#34;&gt;Contivä¸‹è½½&lt;/h3&gt;

&lt;p&gt;Contivçš„ç¼–è¯‘å®‰è£…æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½githubä¸Šçš„&lt;a href=&#34;[1.0.0-beta.3-03-08-2017.18-51-20.UTC](https://github.com/contiv/netplugin/releases/tag/1.0.0-beta.3-03-08-2017.18-51-20.UTC)&#34;&gt;release-1.0.0-beta.3-03-08-2017.18-51-20.UTC&lt;/a&gt;æ–‡ä»¶è§£å‹è·å¾—äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/contiv/install/blob/master/README.mdè¿™ä¸ªå®˜æ–¹æ–‡æ¡£å·²ç»è¿‡æ—¶ï¼Œä¸è¦çœ‹äº†ã€‚&#34;&gt;https://github.com/contiv/install/blob/master/README.mdè¿™ä¸ªå®˜æ–¹æ–‡æ¡£å·²ç»è¿‡æ—¶ï¼Œä¸è¦çœ‹äº†ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¦‚æœè¯•ç”¨å¯ä»¥çš„è¯ï¼Œæˆ‘ä¼šåç»­å†™contivå¼€å‘ç¯å¢ƒæ­å»ºçš„æ–‡ç« ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªreleaseæ˜¯2017å¹´3æœˆ8æ—¥å‘å¸ƒçš„ï¼Œå°±åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„å‰ä¸€å¤©ã€‚æœ‰ä¸ª&lt;strong&gt;æœ€é‡è¦çš„æ›´æ–°&lt;/strong&gt;æ˜¯&lt;u&gt;æ”¯æŒdocker1.13 swarm mode&lt;/u&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/contiv/netplugin/blob/master/install/HowtoSetupContiv.md&#34;&gt;å®˜æ–¹å®‰è£…æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹è½½è§£å‹åä¼šå¾—åˆ°å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;contivk8s  k8sä¸“ç”¨çš„&lt;/li&gt;
&lt;li&gt;contrib  æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸ª&lt;code&gt;netctl&lt;/code&gt;çš„bashè„šæœ¬&lt;/li&gt;
&lt;li&gt;netcontiv  è¿™ä¸ªå‘½ä»¤å°±ä¸€ä¸ª-versioné€‰é¡¹ç”¨æ¥æŸ¥çœ‹contivçš„ç‰ˆæœ¬ğŸ˜“&lt;/li&gt;
&lt;li&gt;netctl  contivå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥é…ç½®ç½‘ç»œã€ç­–ç•¥ã€æœåŠ¡è´Ÿè½½å‡è¡¡ï¼Œ&lt;a href=&#34;http://contiv.github.io/documents/reference/netctlcli.html&#34;&gt;ä½¿ç”¨è¯´æ˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;netmaster  contivçš„ä¸»èŠ‚ç‚¹æœåŠ¡&lt;/li&gt;
&lt;li&gt;netplugin&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢çš„å®‰è£…ä¸­ç”¨åˆ°çš„åªæœ‰netctlã€netmasterå’Œnetpluginè¿™ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å°†è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½copyåˆ°/usr/binç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬åœ¨docker17.03-ceä¸­å®‰è£…contivã€‚&lt;/p&gt;

&lt;h3 id=&#34;contivå®‰è£…ä¾èµ–&#34;&gt;Contivå®‰è£…ä¾èµ–&lt;/h3&gt;

&lt;p&gt;Contivä¾èµ–äºconsulæˆ–etcdï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨etcdï¼Œslacké‡Œçš„äººè¯´åªæ”¯æŒ2.3.xç‰ˆæœ¬ï¼Œå¯èƒ½ä¸æ”¯æŒ3.0+ç‰ˆæœ¬çš„å§ï¼Œè¿˜æ²¡å®é™…æµ‹è¿‡ï¼Œå…ˆä½¿ç”¨2.3.7ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;contiv master&lt;/code&gt;å¯åŠ¨åè‡ªåŠ¨å‘etcdä¸­æ³¨å†Œä¿¡æ¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/contiv.io/oper
/contiv.io/oper/auto-vlan
/contiv.io/oper/auto-vlan/global
/contiv.io/oper/auto-vxlan
/contiv.io/oper/auto-vxlan/global
/contiv.io/oper/global
/contiv.io/oper/global/global
/contiv.io/oper/ovs-driver
/contiv.io/oper/ovs-driver/sz-pg-oam-docker-test-001.tendcloud.com
/contiv.io/master
/contiv.io/master/config
/contiv.io/master/config/global
/contiv.io/obj
/contiv.io/obj/modeldb
/contiv.io/obj/modeldb/global
/contiv.io/obj/modeldb/global/global
/contiv.io/obj/modeldb/tenant
/contiv.io/obj/modeldb/tenant/default
/contiv.io/lock
/contiv.io/lock/netmaster
/contiv.io/lock/netmaster/leader
/contiv.io/service
/contiv.io/service/netmaster
/contiv.io/service/netmaster/172.20.0.113:9999
/contiv.io/service/netmaster.rpc
/contiv.io/service/netmaster.rpc/172.20.0.113:9001
/contiv.io/state
/contiv.io/state/auto-vlan
/contiv.io/state/auto-vlan/global
/contiv.io/state/auto-vxlan
/contiv.io/state/auto-vxlan/global
/contiv.io/state/global
/contiv.io/state/global/global
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;contivå¯åŠ¨&#34;&gt;Contivå¯åŠ¨&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨netmaster&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$nohup netmaster -cluster-mode docker -cluster-store etcd://172.20.0.113:2379 -debug -listen-url 172.20.0.113:9999 -plugin-name netplugin &amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸ºäº†çªå‡ºnetmasterå‘½ä»¤çš„ä½¿ç”¨ï¼Œæˆ‘æŠŠæ‰€æœ‰å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼çš„å‚æ•°éƒ½æ˜ç¡®çš„å†™å‡ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;netmaster&lt;/code&gt;ç›‘å¬9999ç«¯å£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹å·²æœ‰çš„contivç½‘ç»œ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$netctl --netmaster http://172.20.0.113:9999 network ls
Tenant  Network  Nw Type  Encap type  Packet tag  Subnet   Gateway  IPv6Subnet  IPv6Gateway
------  -------  -------  ----------  ----------  -------  ------   ----------  -----------
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸ºäº†ä»¥åæ‰§è¡Œå‘½ä»¤æ–¹ä¾¿ï¼Œä¸ç”¨æ¥å›è¾“å…¥&lt;code&gt;$NETMASTER&lt;/code&gt;åœ°å€ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡&lt;/p&gt;

&lt;p&gt;&lt;code&gt;export NETMASTER=&amp;quot;http://172.20.0.113:9999&amp;quot;&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;netpluginéœ€è¦ä½¿ç”¨Open vSwitchï¼Œæ‰€ä»¥ä½ éœ€è¦å…ˆå®‰è£…&lt;strong&gt;Open vSwitch&lt;/strong&gt;ã€‚å¦åˆ™ä½ ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜&lt;a href=&#34;https://github.com/contiv/netplugin/issues/760&#34;&gt;netplugin issue-760&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;open-vswitchå®‰è£…&#34;&gt;Open vSwitchå®‰è£…&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://supercomputing.caltech.edu/blog/index.php/2016/05/03/open-vswitch-installation-on-centos-7-2/&#34;&gt;Open vSwitch installation on CentOS7.2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å‚è€ƒä¸Šé¢é“¾æ¥é‡Œçš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;#!/bin/bash
yum -y install make gcc openssl-devel autoconf automake rpm-build redhat-rpm-config python-devel openssl-devel kernel-devel kernel-debug-devel libtool wget
mkdir -p ~/rpmbuild/SOURCES
cp openvswitch-2.5.1.tar.gz ~/rpmbuild/SOURCES/
tar xfz openvswitch-2.5.1.tar.gz
sed &#39;s/openvswitch-kmod, //g&#39; openvswitch-2.5.1/rhel/openvswitch.spec &amp;gt; openvswitch-2.5.1/rhel/openvswitch_no_kmod.spec
rpmbuild -bb --nocheck ~/openvswitch-2.5.1/rhel/openvswitch_no_kmod.spec
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¼–è¯‘å¥½çš„rpmåŒ…åœ¨&lt;code&gt;~/rpmbuild/RPMS/x86_64/openvswitch-2.5.1-1.x86_64.rpm&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;å®‰è£…å¥½Open vSwitchåå°±å¯ä»¥å¯åŠ¨&lt;strong&gt;netplugin&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºcontivç½‘ç»œ&#34;&gt;åˆ›å»ºcontivç½‘ç»œ&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨netplugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;nohup netplugin -cluster-store etcd://172.20.0.113:2379 &amp;amp;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºnetwork&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;netctl --netmaster http://172.20.0.113:9999 network create --subnet=10.1.2.0/24 contiv-net&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è·å¾—ä»¥ä¸‹æŠ¥é”™ï¼š&lt;/p&gt;

&lt;p&gt;ERRO[0000] Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯æ‰§è¡Œç¬¬äºŒæ¬¡çš„æ—¶å€™å±…ç„¶æˆåŠŸäº†ï¼Œä¸è¿‡å½“æˆ‘æŸ¥çœ‹docker networkçš„æ—¶å€™æ ¹æœ¬å°±çœ‹ä¸åˆ°åˆšåˆšåˆ›å»ºçš„contiv-netç½‘ç»œã€‚*è¿™åªæ˜¯ä¸€åœºæ¸¸æˆä¸€åœºæ¢¦ã€‚ã€‚ã€‚*ğŸ˜¢&lt;/p&gt;

&lt;p&gt;Creating network default:contiv-net&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$netctl network ls
Tenant   Network     Nw Type  Encap type  Packet tag  Subnet       Gateway  IPv6Subnet  IPv6Gateway
------   -------     -------  ----------  ----------  -------      ------   ----------  -----------
default  contiv-net  data     vxlan       0           10.1.2.0/24  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹åˆšåˆ›å»ºçš„contiv-netç½‘ç»œã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$netctl network inspect contiv-net
Inspeting network: contiv-net tenant: default
{
  &amp;quot;Config&amp;quot;: {
    &amp;quot;key&amp;quot;: &amp;quot;default:contiv-net&amp;quot;,
    &amp;quot;encap&amp;quot;: &amp;quot;vxlan&amp;quot;,
    &amp;quot;networkName&amp;quot;: &amp;quot;contiv-net&amp;quot;,
    &amp;quot;nwType&amp;quot;: &amp;quot;data&amp;quot;,
    &amp;quot;subnet&amp;quot;: &amp;quot;10.1.2.0/24&amp;quot;,
    &amp;quot;tenantName&amp;quot;: &amp;quot;default&amp;quot;,
    &amp;quot;link-sets&amp;quot;: {},
    &amp;quot;links&amp;quot;: {
      &amp;quot;Tenant&amp;quot;: {
        &amp;quot;type&amp;quot;: &amp;quot;tenant&amp;quot;,
        &amp;quot;key&amp;quot;: &amp;quot;default&amp;quot;
      }
    }
  },
  &amp;quot;Oper&amp;quot;: {
    &amp;quot;availableIPAddresses&amp;quot;: &amp;quot;10.1.2.1-10.1.2.254&amp;quot;,
    &amp;quot;externalPktTag&amp;quot;: 1,
    &amp;quot;pktTag&amp;quot;: 1
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»&lt;strong&gt;netmaster&lt;/strong&gt;æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;time=&amp;quot;Mar  9 21:44:14.746627381&amp;quot; level=debug msg=&amp;quot;NwInfra type is default, no ACI&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.750278056&amp;quot; level=info msg=&amp;quot;Creating docker network: {CheckDuplicate:true Driver:netplugin EnableIPv6:false IPAM:0xc4204d8ea0 Internal:false Attachable:true Options:map[tenant:default encap:vxlan pkt-tag:1] Labels:map[]}&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.752034749&amp;quot; level=error msg=&amp;quot;Error creating network contiv-net. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.752067294&amp;quot; level=error msg=&amp;quot;Error creating network contiv-net.default in docker. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.752102735&amp;quot; level=error msg=&amp;quot;Error creating network {&amp;amp;{Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.752129195&amp;quot; level=error msg=&amp;quot;NetworkCreate retruned error for: &amp;amp;{Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.752155973&amp;quot; level=error msg=&amp;quot;CreateNetwork error for: {Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&amp;quot; 
time=&amp;quot;Mar  9 21:44:14.752172138&amp;quot; level=error msg=&amp;quot;Handler for POST /api/v1/networks/default:contiv-net/ returned error: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&amp;quot; 
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;

&lt;p&gt;ä»æ—¥å¿—ä¸­çœ‹åˆ°ä¸€ä¸ªä»¤äººæ‚²ç—›è¯­å¥çš„è¯*legacy plugin netplugin of type NetworkDriver is not supported in swarm mode*ï¼Œä½ ä»¬æ˜¨å¤©ä¸æ˜¯åˆšå‘çš„ç‰ˆæœ¬è¯´å·²ç»æ”¯æŒswarm modeå—ï¼Ÿ&lt;a href=&#34;https://github.com/contiv/netplugin/commit/8afd1b7718c8424a876760d18484124e0aad3557&#34;&gt;&lt;code&gt;commit-8afd1b7&lt;/code&gt;&lt;/a&gt;ä¸æ˜¯ç™½çº¸é»‘å­—çš„å†™ç€å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æˆ‘æäº†ä¸ª&lt;a href=&#34;https://github.com/contiv/netplugin/issues/776&#34;&gt;issue-776&lt;/a&gt;ï¼Œçœ‹çœ‹æ€æ ·è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦å¤–netpluginå‘½ä»¤æ€ä¹ˆç”¨ï¼Œæ–‡æ¡£ä¸Šæ²¡å†™å•Šï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;netplugin -h&lt;/code&gt;å¯ä»¥ä¸­æœ‰ä¸¤ä¸ªé€‰é¡¹æˆ‘ä¸æ˜ç™½ï¼Œä¸çŸ¥é“æ€ä¹ˆè®¾ç½®ï¼Œæœ‰çŸ¥é“çš„äººè¯·å‘Šè¯‰æˆ‘ä¸€å£°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  -vlan-if value
    	VLAN uplink interface
  -vtep-ip string
    	My VTEP ip address
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åŒæ—¶æˆ‘ä¼šç»§ç»­å…³æ³¨contivçš„slackå’Œgithub &lt;a href=&#34;https://github.com/contiv/netplugin/issues/776&#34;&gt;Issue-776&lt;/a&gt;çš„è¿›å±•ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Contiv Intro</title>
      <link>http://rootsongjc.github.io/blogs/contiv-guide/</link>
      <pubDate>Thu, 09 Mar 2017 11:28:34 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/contiv-guide/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2017021162.jpg&#34; alt=&#34;è“è‰²æ¸¯æ¹¾&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(é¢˜å›¾ï¼šåŒ—äº¬è“è‰²æ¸¯æ¹¾å¤œæ™¯ Feb 11,2017 å…ƒå®µèŠ‚)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Contiv&lt;/strong&gt;æ˜¯æ€ç§‘å¼€å‘çš„dockerç½‘ç»œæ’ä»¶ï¼Œä»2015å¹´å°±å¼€æºäº†ï¼Œä¸šç•Œé€šå¸¸æ‹¿å®ƒå’ŒCalicoæ¯”è¾ƒã€‚è²Œä¼¼Contivä»¥å‰è¿˜å¼€å‘è¿‡volume pluginï¼Œç°åœ¨é”€å£°åŒ¿è¿¹äº†ï¼Œåªæœ‰netpluginä»åœ¨æ´»è·ƒå¼€å‘ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://dockone.io/article/1935&#34;&gt;å®¹å™¨ç½‘ç»œæ’ä»¶ Calico ä¸ Contiv Netpluginæ·±å…¥æ¯”è¾ƒ&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰ç¯‡æ–‡ç« è®²è§£äº†&lt;a href=&#34;http://blog.dataman-inc.com/shurenyun-docker-133/&#34;&gt;dockerç½‘ç»œæ–¹æ¡ˆçš„æ”¹è¿›&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;contiv-netplugin-ç®€ä»‹&#34;&gt;Contiv Netplugin ç®€ä»‹&lt;/h3&gt;

&lt;p&gt;Contiv Netplugin æ˜¯æ¥è‡ªæ€ç§‘çš„è§£å†³æ–¹æ¡ˆã€‚ç¼–ç¨‹è¯­è¨€ä¸º Goã€‚å®ƒåŸºäº OpenvSwitchï¼Œä»¥æ’ä»¶åŒ–çš„å½¢å¼æ”¯æŒå®¹å™¨è®¿é—®ç½‘ç»œï¼Œæ”¯æŒ VLANï¼ŒVxlanï¼Œå¤šç§Ÿæˆ·ï¼Œä¸»æœºè®¿é—®æ§åˆ¶ç­–ç•¥ç­‰ã€‚ä½œä¸ºæ€ç§‘æ•´ä½“æ”¯æŒå®¹å™¨åŸºç¡€è®¾æ–½contivé¡¹ç›®çš„ç½‘ç»œéƒ¨åˆ†ï¼Œæœ€å¤§çš„äº®ç‚¹åœ¨äºå®¹å™¨è¢«èµ‹äºˆäº† SDN èƒ½åŠ›ï¼Œå®ç°å¯¹å®¹å™¨æ›´ç»†ç²’åº¦ï¼Œæ›´ä¸°å¯Œçš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚å¦å¤–ï¼Œå¯¹ Docker CNM ç½‘ç»œæ¨¡å‹çš„æ”¯æŒï¼Œå¹¶å†…ç½®äº† IPAM æ¥å£ï¼Œä¸ä»…ä»…æä¾›äº†ä¸€å®¹å™¨ä¸€ IPï¼Œè€Œä¸”å®¹å™¨çš„ç½‘ç»œä¿¡æ¯è¢«è®°å½•çš„å®¹å™¨é…ç½®ä¸­ï¼Œä¼´éšç€å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå‡ä½å› ä¸ºçŠ¶æ€ä¸åŒæ­¥é€ æˆç½‘ç»œä¿¡æ¯ä¸¢å¤±çš„é£é™©ã€‚æœ‰åˆ«äº CNIï¼Œè¿™ç§å†…èšåŒ–çš„è®¾è®¡æœ‰åˆ©äºå‡å°‘å¯¹ç¬¬ä¸‰æ–¹æ¨¡å—çš„ä¾èµ–ã€‚éšç€é¡¹ç›®çš„å‘å±•ï¼Œé™¤äº† Dockerï¼Œè¿˜æä¾›äº†å¯¹ Kubernetes ä»¥åŠ Mesos çš„æ”¯æŒï¼Œå³ CNI æ¥å£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://dockerone.com/uploads/article/20161221/c737f78ce7c50c84e49648aaf771a6b4.png&#34;&gt;&lt;img src=&#34;http://dockerone.com/uploads/article/20161221/c737f78ce7c50c84e49648aaf771a6b4.png&#34; alt=&#34;9260E9B7-43C0-48B8-B5C7-CF8B952959D2.png&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Netmaster åå°è¿›ç¨‹è´Ÿè´£è®°å½•æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ï¼Œä¿å­˜ç½‘ç»œä¿¡æ¯ï¼Œåˆ†é… IP åœ°å€&lt;/li&gt;
&lt;li&gt;Netplugin åå°è¿›ç¨‹ä½œä¸ºæ¯ä¸ªå®¿ä¸»æœºä¸Šçš„ Agent ä¸ Docker åŠ OVS é€šä¿¡ï¼Œå¤„ç†æ¥è‡ª Docker çš„è¯·æ±‚ï¼Œç®¡ç† OVSã€‚Docker æ–¹é¢æ¥å£ä¸º remote driverï¼ŒåŒ…æ‹¬ä¸€ç³»åˆ— Docker å®šä¹‰çš„ JSON-RPC(POST) æ¶ˆæ¯ã€‚OVS æ–¹é¢æ¥å£ä¸º remote ovsdbï¼Œä¹Ÿæ˜¯ JSON-RPC æ¶ˆæ¯ã€‚ä»¥ä¸Šæ¶ˆæ¯éƒ½åœ¨ localhost ä¸Šå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç®¡ç†ä¾èµ– etcd/serf&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&#34;http://dockerone.com/uploads/article/20161221/852b276222482c4740b690eb7f078409.png&#34;&gt;&lt;img src=&#34;http://dockerone.com/uploads/article/20161221/852b276222482c4740b690eb7f078409.png&#34; alt=&#34;580469BC-468C-49C8-B29E-8B88143AFE0A.png&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;netpluginçš„ä¼˜åŠ¿&#34;&gt;Netpluginçš„ä¼˜åŠ¿&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;è¾ƒæ—©æ”¯æŒCNMæ¨¡å‹ã€‚ä¸å·²æœ‰çš„ç½‘ç»œåŸºç¡€è®¾æ–½å…¼å®¹æ€§è¾ƒé«˜ï¼Œæ”¹é€ å½±å“å°ã€‚åŸºäºVLANçš„å¹³è¡Œæ‰©å±•ä¸ç°æœ‰ç½‘ç»œç»“æ„åœ°ä½å¯¹ç­‰&lt;/li&gt;
&lt;li&gt;SDNèƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹å®¹å™¨çš„ç½‘ç»œè®¿é—®åšæ›´ç²¾ç»†çš„æ§åˆ¶&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·æ”¯æŒï¼Œå…·å¤‡æœªæ¥å‘æ··åˆäº‘/å…¬æœ‰äº‘è¿ç§»çš„æ½œåŠ›&lt;/li&gt;
&lt;li&gt;ä»£ç è§„æ¨¡ä¸å¤§ï¼Œé€»è¾‘ç»“æ„æ¸…æ™°ï¼Œå¹¶å‘å¥½ï¼ŒVLANåœ¨å…¬å¸å†…éƒ¨æœ‰å¼€å‘éƒ¨ç½²è¿ç»´å®è·µç»éªŒï¼Œç¨³å®šæ€§ç»è¿‡ç”Ÿäº§ç¯å¢ƒéªŒè¯&lt;/li&gt;
&lt;li&gt;&lt;u&gt;&lt;strong&gt;äº¬ä¸œ&lt;/strong&gt;åŸºäºç›¸åŒçš„æŠ€æœ¯æ ˆï¼ˆOVS + VLANï¼‰å·²æ”¯æŒ10w+ å®¹å™¨çš„è¿è¡Œã€‚&lt;/u&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;next&#34;&gt;Next&lt;/h3&gt;

&lt;p&gt;åç»­æ–‡ç« ä¼šè®²è§£contiv netpluginçš„ç¯å¢ƒé…ç½®å’Œå¼€å‘ã€‚ç›®å‰è¿˜åœ¨1.0-betaç‰ˆæœ¬ã€‚&lt;strong&gt;Docker store&lt;/strong&gt;ä¸Šæä¾›äº†contivæ’ä»¶çš„&lt;a href=&#34;https://store.docker.com/plugins/803eecee-0780-401a-a454-e9523ccf86b3&#34;&gt;ä¸‹è½½åœ°å€&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Packer Intro</title>
      <link>http://rootsongjc.github.io/blogs/packer-intro/</link>
      <pubDate>Thu, 09 Mar 2017 10:58:42 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/packer-intro/</guid>
      <description>&lt;p&gt;æ˜¨å¤©ç ”ç©¶äº†ä¸‹&lt;a href=&#34;https://github.com/mitchellh/vagrant&#34;&gt;&lt;strong&gt;Vagrant&lt;/strong&gt;&lt;/a&gt;ï¼Œæ„Ÿè§‰å®ƒçš„è™šæ‹Ÿæœºrubyæ ¼å¼å®šä¹‰å¾ˆéº»çƒ¦ï¼Œç»äººæŒ‡ç‚¹è¿˜æœ‰ä¸€ä¸ªå«åš&lt;a href=&#34;https://github.com/mitchellh/packer&#34;&gt;&lt;strong&gt;packer&lt;/strong&gt;&lt;/a&gt;çš„ä¸œè¥¿ï¼Œä¹Ÿæ˜¯Hashicorpè¿™å®¶å…¬å¸å‡ºå“çš„ï¼Œä»Šå¤©çœ‹äº†ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Packer&lt;/strong&gt;æ˜¯ä¸€æ¬¾å¼€æºè½»é‡çº§çš„é•œåƒå®šä¹‰å·¥å…·ï¼Œå¯ä»¥æ ¹æ®ä¸€ä»½å®šä¹‰æ–‡ä»¶ç”Ÿæˆå¤šä¸ªå¹³å°çš„é•œåƒï¼Œæ”¯æŒçš„å¹³å°æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Amazon EC2 (AMI). Both EBS-backed and instance-store AMIs&lt;/li&gt;
&lt;li&gt;Azure&lt;/li&gt;
&lt;li&gt;DigitalOcean&lt;/li&gt;
&lt;li&gt;Docker&lt;/li&gt;
&lt;li&gt;Google Compute Engine&lt;/li&gt;
&lt;li&gt;OpenStack&lt;/li&gt;
&lt;li&gt;Parallels&lt;/li&gt;
&lt;li&gt;QEMU. Both KVM and Xen images.&lt;/li&gt;
&lt;li&gt;VirtualBox&lt;/li&gt;
&lt;li&gt;VMware&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Packeråˆ›é€ çš„é•œåƒä¹Ÿèƒ½è½¬æ¢æˆ&lt;strong&gt;Vagrant boxes&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Packerçš„é•œåƒåˆ›å»ºéœ€è¦ä¸€ä¸ªjsonæ ¼å¼çš„å®šä¹‰æ–‡ä»¶ï¼Œä¾‹å¦‚&lt;code&gt;quick-start.json&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;variables&amp;quot;: {
    &amp;quot;access_key&amp;quot;: &amp;quot;{{env `AWS_ACCESS_KEY_ID`}}&amp;quot;,
    &amp;quot;secret_key&amp;quot;: &amp;quot;{{env `AWS_SECRET_ACCESS_KEY`}}&amp;quot;
  },
  &amp;quot;builders&amp;quot;: [{
    &amp;quot;type&amp;quot;: &amp;quot;amazon-ebs&amp;quot;,
    &amp;quot;access_key&amp;quot;: &amp;quot;{{user `access_key`}}&amp;quot;,
    &amp;quot;secret_key&amp;quot;: &amp;quot;{{user `secret_key`}}&amp;quot;,
    &amp;quot;region&amp;quot;: &amp;quot;us-east-1&amp;quot;,
    &amp;quot;source_ami&amp;quot;: &amp;quot;ami-af22d9b9&amp;quot;,
    &amp;quot;instance_type&amp;quot;: &amp;quot;t2.micro&amp;quot;,
    &amp;quot;ssh_username&amp;quot;: &amp;quot;ubuntu&amp;quot;,
    &amp;quot;ami_name&amp;quot;: &amp;quot;packer-example {{timestamp}}&amp;quot;
  }]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;packer build quick-start.json&lt;/code&gt;å¯ä»¥åœ¨AWSä¸Šbuildä¸€ä¸ªAIMé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;Packerçš„è¯¦ç»†æ–‡æ¡£ï¼š&lt;a href=&#34;https://www.packer.io/docs/&#34;&gt;https://www.packer.io/docs/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vagrantä»‹ç»-ä»ä½¿ç”¨åˆ°æ”¾å¼ƒå®Œå…¨æŒ‡å—</title>
      <link>http://rootsongjc.github.io/blogs/vagrant-intro/</link>
      <pubDate>Wed, 08 Mar 2017 20:40:08 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/vagrant-intro/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2017030513.jpg&#34; alt=&#34;å…‰ç†™å®¶å›­å¤œæ™¯&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šåŒ—äº¬åœ°é“13å·çº¿å…‰ç†™å®¶å›­å¤œæ™¯ Mar 5,2017ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;èµ·æº&#34;&gt;èµ·æº&lt;/h2&gt;

&lt;p&gt;ä¹…é—»&lt;strong&gt;Vagrant&lt;/strong&gt;å¤§åï¼Œä¹‹å‰ç»å¸¸çœ‹åˆ°æœ‰å¼€æºé¡¹ç›®ä½¿ç”¨å®ƒä½œä¸ºåˆ†å¸ƒå¼å¼€å‘çš„ç¯å¢ƒé…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºä»Šå¤©åœ¨çœ‹&lt;a href=&#34;https://github.com/contiv/netplugin&#34;&gt;contiv&lt;/a&gt;æ­£å¥½é‡Œé¢ä½¿ç”¨vagrantæ­å»ºçš„å¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œæ‰€ä»¥é¡ºä¾¿äº†è§£ä¸‹ã€‚å®ƒçš„&lt;a href=&#34;https://github.com/contiv/netplugin/blob/master/Vagrantfile&#34;&gt;Vagrantfile&lt;/a&gt;æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸‰å°ä¸»æœºã€‚å¹¶å®‰è£…äº†å¾ˆå¤šä¾èµ–è½¯ä»¶ï¼Œå¦‚consulã€etcdã€dockerã€goç­‰ï¼Œæ•´çš„æ¯”è¾ƒå¤æ‚ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;âœ  netplugin git:(master) âœ— vagrant status
Current machine states:

netplugin-node1           running (virtualbox)
netplugin-node2           running (virtualbox)
netplugin-node3           running (virtualbox)

This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run `vagrant status NAME`.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vagrantæ˜¯&lt;a href=&#34;https://www.hashicorp.com/&#34;&gt;hashicorp&lt;/a&gt;è¿™å®¶å…¬å¸çš„äº§å“ï¼Œè¿™å®¶å…¬å¸ä¸»è¦åšæ•°æ®ä¸­å¿ƒPAASå’Œè™šæ‹ŸåŒ–ï¼Œå…¶åä¸‹å¤§åé¼é¼çš„äº§å“æœ‰&lt;code&gt;Consul&lt;/code&gt;ã€&lt;code&gt;Vault&lt;/code&gt;ã€&lt;code&gt;Nomad&lt;/code&gt;ã€&lt;code&gt;Terraform&lt;/code&gt;ã€‚ä»–ä»¬çš„äº§å“éƒ½æ˜¯åŸºäº&lt;strong&gt;Open Source&lt;/strong&gt;çš„&lt;a href=&#34;https://github.com/hashicorp&#34;&gt;Githubåœ°å€&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç”¨é€”&#34;&gt;ç”¨é€”&lt;/h2&gt;

&lt;p&gt;Vagrantæ˜¯ç”¨æ¥ç®¡ç†è™šæ‹Ÿæœºçš„ï¼Œå¦‚VirtualBoxã€VMwareã€AWSç­‰ï¼Œä¸»è¦å¥½å¤„æ˜¯å¯ä»¥æä¾›ä¸€ä¸ªå¯é…ç½®ã€å¯ç§»æ¤å’Œå¤ç”¨çš„è½¯ä»¶ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨shellã€chefã€puppetç­‰å·¥å…·éƒ¨ç½²ã€‚æ‰€ä»¥vagrantä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¦‚æœä½ ç”¨å®ƒæ¥ç®¡ç†è‡ªå·±çš„å¼€å‘ç¯å¢ƒçš„è¯ï¼Œå¿…é¡»åœ¨è‡ªå·±çš„ç”µè„‘é‡Œå®‰è£…äº†è™šæ‹Ÿæœºè½¯ä»¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯&lt;strong&gt;virtualbox&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Vagrantæä¾›ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·&lt;code&gt;vagrant&lt;/code&gt;ï¼Œé€šè¿‡è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å¯ä»¥ç›´æ¥å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå½“ç„¶ä½ éœ€è¦æå‰å®šä¹‰ä¸€ä¸ªVagrantfileæ–‡ä»¶ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼Dockerfileä¹‹äºdockeräº†ã€‚&lt;/p&gt;

&lt;p&gt;è·Ÿdockerç±»æ¯”è¿™æ¥çœ‹vagrantå°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œvagrantä¹Ÿæ˜¯ç”¨æ¥æä¾›ä¸€è‡´æ€§ç¯å¢ƒçš„ï¼Œvagrantæœ¬èº«ä¹Ÿæä¾›ä¸€ä¸ªé•œåƒæºï¼Œä½¿ç”¨&lt;code&gt;vagrant init hashicorp/precise64&lt;/code&gt;å°±å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªUbuntu 12.04çš„é•œåƒã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç”¨æ³•&#34;&gt;ç”¨æ³•&lt;/h2&gt;

&lt;p&gt;ä½ å¯ä»¥ä¸‹è½½å®‰è£…æ–‡ä»¶æ¥å®‰è£…vagrantï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨RubyGemå®‰è£…ï¼Œå®ƒæ˜¯ç”¨Rubyå¼€å‘çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Vagrantfile&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Vagrantfileæ˜¯ç”¨æ¥å®šä¹‰vagrant projectçš„ï¼Œä½¿ç”¨rubyè¯­æ³•ï¼Œä¸è¿‡ä½ ä¸å¿…äº†è§£rubyå°±å¯ä»¥å†™ä¸€ä¸ªVagrantfileã€‚&lt;/p&gt;

&lt;p&gt;çœ‹ä¸ªä¾‹å­ï¼Œé€‰è‡ª&lt;a href=&#34;https://github.com/fenbox/Vagrantfile&#34;&gt;https://github.com/fenbox/Vagrantfile&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ruby&#34;&gt;# -*- mode: ruby -*-
# vi: set ft=ruby :

# All Vagrant configuration is done below. The &amp;quot;2&amp;quot; in Vagrant.configure
# configures the configuration version (we support older styles for
# backwards compatibility). Please don&#39;t change it unless you know what
# you&#39;re doing.
Vagrant.configure(&amp;quot;2&amp;quot;) do |config|
  # The most common configuration options are documented and commented below.
  # For a complete reference, please see the online documentation at
  # https://docs.vagrantup.com.

  # Every Vagrant development environment requires a box. You can search for
  # boxes at https://atlas.hashicorp.com/search.
  config.vm.box = &amp;quot;ubuntu/trusty64&amp;quot;

  # Disable automatic box update checking. If you disable this, then
  # boxes will only be checked for updates when the user runs
  # `vagrant box outdated`. This is not recommended.
  # config.vm.box_check_update = false

  # Create a forwarded port mapping which allows access to a specific port
  # within the machine from a port on the host machine. In the example below,
  # accessing &amp;quot;localhost:8080&amp;quot; will access port 80 on the guest machine.
  # config.vm.network &amp;quot;forwarded_port&amp;quot;, guest: 80, host: 8080

  # Create a private network, which allows host-only access to the machine
  # using a specific IP.
  config.vm.network &amp;quot;private_network&amp;quot;, ip: &amp;quot;192.168.33.10&amp;quot;

  # Create a public network, which generally matched to bridged network.
  # Bridged networks make the machine appear as another physical device on
  # your network.
  # config.vm.network &amp;quot;public_network&amp;quot;

  # Share an additional folder to the guest VM. The first argument is
  # the path on the host to the actual folder. The second argument is
  # the path on the guest to mount the folder. And the optional third
  # argument is a set of non-required options.
  # config.vm.synced_folder &amp;quot;../data&amp;quot;, &amp;quot;/vagrant_data&amp;quot;

  # Provider-specific configuration so you can fine-tune various
  # backing providers for Vagrant. These expose provider-specific options.
  # Example for VirtualBox:
  #
  # config.vm.provider &amp;quot;virtualbox&amp;quot; do |vb|
  #   # Display the VirtualBox GUI when booting the machine
  #   vb.gui = true
  #
  #   # Customize the amount of memory on the VM:
  #   vb.memory = &amp;quot;1024&amp;quot;
  # end
  #
  # View the documentation for the provider you are using for more
  # information on available options.

  # Define a Vagrant Push strategy for pushing to Atlas. Other push strategies
  # such as FTP and Heroku are also available. See the documentation at
  # https://docs.vagrantup.com/v2/push/atlas.html for more information.
  # config.push.define &amp;quot;atlas&amp;quot; do |push|
  #   push.app = &amp;quot;YOUR_ATLAS_USERNAME/YOUR_APPLICATION_NAME&amp;quot;
  # end

  # Enable provisioning with a shell script. Additional provisioners such as
  # Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the
  # documentation for more information about their specific syntax and use.
  # config.vm.provision &amp;quot;shell&amp;quot;, inline: &amp;lt;&amp;lt;-SHELL
  #   apt-get update
  #   apt-get install -y apache2
  # SHELL
  config.vm.provision :shell, path: &amp;quot;bootstrap.sh&amp;quot;
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Boxes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Vagrantçš„åŸºç¡€é•œåƒï¼Œç›¸å½“äºdocker imagesã€‚å¯ä»¥åœ¨è¿™äº›åŸºç¡€é•œåƒçš„åŸºç¡€ä¸Šåˆ¶ä½œè‡ªå·±çš„è™šæ‹Ÿæœºé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;æ·»åŠ ä¸€ä¸ªbox&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ vagrant box add hashicorp/precise64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨Vagrantfileä¸­æŒ‡å®šbox&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ruby&#34;&gt;Vagrant.configure(&amp;quot;2&amp;quot;) do |config|
  config.vm.box = &amp;quot;hashicorp/precise64&amp;quot;
  config.vm.box_version = &amp;quot;1.1.0&amp;quot;
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä½¿ç”¨sshè¿›å…¥vagrant&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;vagrant up&lt;/code&gt;åå°±å¯ä»¥ç”¨&lt;code&gt;vagrant ssh $name&lt;/code&gt;è¿›å…¥è™šæ‹Ÿæœºå†…ï¼Œå¦‚æœä¸»æœºä¸Šå°±ä¸€ä¸ªvagrantå¯ä»¥ä¸æŒ‡å®šåå­—ã€‚é»˜è®¤è¿›å…¥çš„ç”¨æˆ·æ˜¯vagrantã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–‡ä»¶åŒæ­¥&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;vagrant up&lt;/code&gt;ååœ¨è™šæ‹Ÿæœºä¸­ä¼šæœ‰ä¸€ä¸ª&lt;code&gt;/vagrant&lt;/code&gt;ç›®å½•ï¼Œè¿™è·Ÿä½ å®šä¹‰&lt;code&gt;Vagrantfile&lt;/code&gt;æ˜¯åŒä¸€çº§ç›®å½•ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªç›®å½•è·Ÿä½ å®¿ä¸»æœºä¸Šçš„ç›®å½•æ–‡ä»¶æ˜¯åŒæ­¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è½¯ä»¶å®‰è£…&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨Vagrantfileä¸­å®šä¹‰è¦å®‰è£…çš„è½¯ä»¶å’Œæ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚å®‰è£…apache&lt;/p&gt;

&lt;p&gt;åœ¨ä¸VagrantfileåŒçº§çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª&lt;code&gt;bootstrap.sh&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;#!/usr/bin/env bash

apt-get update
apt-get install -y apache2
if ! [ -L /var/www ]; then
  rm -rf /var/www
  ln -fs /vagrant /var/www
fi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶ååœ¨Vagrantfileä¸­ä½¿ç”¨å®ƒã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ruby&#34;&gt;Vagrant.configure(&amp;quot;2&amp;quot;) do |config|
  config.vm.box = &amp;quot;hashicorp/precise64&amp;quot;
  config.vm.box_version = &amp;quot;1.1.0&amp;quot;
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ç½‘ç»œ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç«¯å£è½¬å‘&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Vagrant.configure(&amp;quot;2&amp;quot;) do |config|
  config.vm.box = &amp;quot;hashicorp/precise64&amp;quot;
  config.vm.provision :shell, path: &amp;quot;bootstrap.sh&amp;quot;
  config.vm.network :forwarded_port, guest: 80, host: 4567
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;vagrant reload&lt;/code&gt;æˆ–è€…&lt;code&gt;vagrant up&lt;/code&gt;å¯ä»¥ç”Ÿæ•ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ†äº«&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½ è‡ªå·±åšçš„vagrantæ˜¯å¯ä»¥åˆ†äº«ç»™åˆ«äººçš„ç”¨çš„ï¼Œåªè¦ä½ æœ‰ä¸€ä¸ªhashicorpè´¦å·ï¼Œ&lt;code&gt;vagrant login&lt;/code&gt;åå°±å¯ä»¥æ‰§è¡Œ&lt;code&gt;vagrant share&lt;/code&gt;åˆ†äº«ï¼Œä¼šç”Ÿæˆä¸€ä¸ªURLï¼Œå…¶å®ƒäººä¹Ÿå¯ä»¥è®¿é—®åˆ°ä½ çš„vagranté‡Œçš„æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸­æ­¢&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;vagrant suspend&lt;/li&gt;
&lt;li&gt;Vagrant halt&lt;/li&gt;
&lt;li&gt;Vagrant destroy&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;é‡æ„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å†æ¬¡æ‰§è¡Œ&lt;code&gt;vagrant up&lt;/code&gt;å³å¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åˆ†å¸ƒå¼ç¯å¢ƒ&#34;&gt;åˆ†å¸ƒå¼ç¯å¢ƒ&lt;/h2&gt;

&lt;p&gt;å¼€å‘åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åº”ç”¨æ—¶å¾€å¾€éœ€è¦å¤šä¸ªè™šæ‹Ÿæœºç”¨äºæµ‹è¯•ï¼Œè¿™æ—¶å€™æ‰æ˜¯vagrantæ˜¾å¨åŠ›çš„æ—¶å€™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®šä¹‰å¤šä¸ªä¸»æœº&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Vagrant.configure(&amp;quot;2&amp;quot;) do |config|
  config.vm.provision &amp;quot;shell&amp;quot;, inline: &amp;quot;echo Hello&amp;quot;

  config.vm.define &amp;quot;web&amp;quot; do |web|
    web.vm.box = &amp;quot;apache&amp;quot;
  end

  config.vm.define &amp;quot;db&amp;quot; do |db|
    db.vm.box = &amp;quot;mysql&amp;quot;
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ªæ¯”è¾ƒå¤æ‚ï¼Œè¯¦è§&lt;a href=&#34;https://www.vagrantup.com/docs/multi-machine/&#34;&gt;https://www.vagrantup.com/docs/multi-machine/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰ä¸€äº›å…¶å®ƒåŠŸèƒ½ï¼Œå¦‚pushã€pluginsã€providersæŒ‰ä¸‹ä¸è¡¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æ€»çš„æ¥è¯´è¯´Vagrantæ²¡æœ‰Dockerå¥½ç”¨ï¼Œä½†æ˜¯å¯¹äºååŒå¼€å‘ï¼Œç”¨å®ƒæ¥å®šä¹‰åˆ†å¸ƒå¼å¼€å‘ç¯å¢ƒè¿˜å¯ä»¥ï¼Œrubyçš„è¯­æ³•çœ‹ç€æœ‰ç‚¹ä¸ä¹ æƒ¯ï¼Œå¥½åœ¨ä¹Ÿä¸å¤æ‚ï¼Œå¦‚æœæ˜¯å›¢é˜Ÿå‡ ä¸ªäººå¼€å‘ï¼Œå¼„å‡ ä¸ªè™šæ‹Ÿæœºå¤§å®¶äº’ç›¸æ‹·è´ä¸€ä¸‹ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚å§ï¼Ÿ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒæ­å»º</title>
      <link>http://rootsongjc.github.io/blogs/docker-dev-env/</link>
      <pubDate>Mon, 06 Mar 2017 17:03:19 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-dev-env/</guid>
      <description>

&lt;p&gt;çœ‹äº†ä¸‹ç½‘ä¸Šå…¶ä»–äººå†™çš„dockerå¼€å‘ç¯å¢ƒæ­å»ºï¼Œè¦ä¹ˆæ˜¯åœ¨ubuntuä¸‹æ­å»ºï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨å®˜æ–¹è¯´æ˜çš„build docker-devé•œåƒçš„æ–¹å¼ä¸€æ­¥æ­¥æ­å»ºçš„ï¼Œç”šæ˜¯ç¹çï¼Œdocker hubä¸Šæœ‰ä¸€ä¸ªdockerå®˜æ–¹æ¨å‡ºçš„&lt;strong&gt;dockercore/docker&lt;/strong&gt;é•œåƒï¼Œå…¶å®è¿™å°±æ˜¯å®˜ç½‘ä¸Šæ‰€è¯´çš„docker-devé•œåƒï¼Œä¸è¿‡ä»¥å‰çš„é‚£ä¸ªdeprecatedäº†ï¼Œä½¿ç”¨ç›®å‰è¿™ä¸ªé•œåƒæ­å»ºdockerå¼€å‘ç¯å¢ƒæ˜¯æœ€å¿«æ·çš„äº†ã€‚&lt;/p&gt;

&lt;p&gt;æƒ³è¦ä¿®æ”¹dockeræºç å’Œåšdockerå®šåˆ¶å¼€å‘çš„åŒå­¦å¯ä»¥å‚è€ƒä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;å®˜æ–¹æŒ‡å¯¼æ–‡æ¡£ï¼š&lt;a href=&#34;https://docs.docker.com/opensource/code/&#34;&gt;https://docs.docker.com/opensource/code/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è®¾ç½®dockerå¼€å‘ç¯å¢ƒï¼š&lt;a href=&#34;https://docs.docker.com/opensource/project/set-up-dev-env/&#34;&gt;https://docs.docker.com/opensource/project/set-up-dev-env/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;dockerçš„ç¼–è¯‘å®è´¨ä¸Šæ˜¯åœ¨dockerå®¹å™¨ä¸­è¿è¡Œdockerã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤åœ¨æœ¬åœ°ç¼–è¯‘dockerçš„å‰ææ˜¯éœ€è¦å®‰è£…äº†dockerï¼Œè¿˜éœ€è¦ç”¨gitæŠŠä»£ç pullä¸‹æ¥ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºåˆ†æ”¯&#34;&gt;åˆ›å»ºåˆ†æ”¯&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ä»¥åç»™dockeræäº¤æ›´æ”¹ï¼Œæˆ‘ä»¬ä»dockerå®˜æ–¹forkä¸€ä¸ªåˆ†æ”¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;git clone https://github.com/rootsongjc/docker.git
git config --local user.name &amp;quot;Jimmy Song&amp;quot;
git config --local user.email &amp;quot;rootsongjc@gmail.com&amp;quot;
git remote add upstream https://github.com/docker/docker.git
git config --local -l
git remote -v
git checkout -b dry-run-test
touch TEST.md
vim TEST.md
git status
git add TEST.md
git commit -am &amp;quot;Making a dry run test.&amp;quot;
git push --set-upstream origin dry-run-test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åå°±å¯ä»¥åœ¨&lt;code&gt;dry-run-test&lt;/code&gt;è¿™ä¸ªåˆ†æ”¯ä¸‹å·¥ä½œäº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é…ç½®dockerå¼€å‘ç¯å¢ƒ&#34;&gt;é…ç½®dockerå¼€å‘ç¯å¢ƒ&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/opensource/project/set-up-dev-env/&#34;&gt;å®˜ç½‘&lt;/a&gt;ä¸Šè¯´éœ€è¦å…ˆæ¸…ç©ºè‡ªå·±ç”µè„‘ä¸Šå·²æœ‰çš„å®¹å™¨å’Œé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;dockerå¼€å‘ç¯å¢ƒæœ¬è´¨ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªdockeré•œåƒï¼Œé•œåƒé‡ŒåŒ…å«äº†dockerçš„æ‰€æœ‰å¼€å‘è¿è¡Œç¯å¢ƒï¼Œæœ¬åœ°ä»£ç é€šè¿‡æŒ‚è½½çš„æ–¹å¼æ”¾åˆ°å®¹å™¨ä¸­è¿è¡Œï¼Œä¸‹é¢è¿™æ¡å‘½ä»¤ä¼šè‡ªåŠ¨åˆ›å»ºè¿™æ ·ä¸€ä¸ªé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;åœ¨&lt;code&gt;dry-run-test&lt;/code&gt;åˆ†æ”¯ä¸‹æ‰§è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;make BIND_DIR=. shell
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨ç¼–è¯‘ä¸€ä¸ªdockeré•œåƒï¼ŒFrom debian:jessieã€‚è¿™ä¸€æ­¥ä¼šä¸Šç½‘ä¸‹è½½å¾ˆå¤šä¾èµ–åŒ…ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚å¦‚æœç¿»ä¸äº†å¢™çš„è¯è‚¯å®šéƒ½ä¼šå¤±è´¥ã€‚å› ä¸ºéœ€è¦ä¸‹è½½çš„è½¯ä»¶å’Œå®‰è£…åŒ…éƒ½æ˜¯åœ¨å›½å¤–æœåŠ¡å™¨ä¸Šï¼Œä¸ç¿»å¢™æ ¹æœ¬å°±ä¸‹è½½ä¸ä¸‹æ¥ï¼Œä¸ºäº†ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œæ¨èç›´æ¥ä½¿ç”¨dockerå®˜æ–¹çš„dockercore/dockeré•œåƒï¼Œä¹Ÿä¸ç”¨ä»¥å‰çš„docker-devé•œåƒï¼Œé‚£ä¸ªé€ å°±åºŸå¼ƒäº†ã€‚è¿™ä¸ªé•œåƒå¤§å°æœ‰2.31Gã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker pull dockercore/docker
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨æ–¹æ³•è§è¿™é‡Œï¼š&lt;a href=&#34;https://hub.docker.com/r/dockercore/docker/&#34;&gt;https://hub.docker.com/r/dockercore/docker/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç„¶åå°±å¯ä»¥è¿›å…¥åˆ°å®¹å™¨é‡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;docker run --rm -i --privileged -e BUILDFLAGS -e KEEPBUNDLE -e DOCKER_BUILD_GOGC -e DOCKER_BUILD_PKGS -e DOCKER_CLIENTONLY -e DOCKER_DEBUG -e DOCKER_EXPERIMENTAL -e DOCKER_GITCOMMIT -e DOCKER_GRAPHDRIVER=devicemapper -e DOCKER_INCREMENTAL_BINARY -e DOCKER_REMAP_ROOT -e DOCKER_STORAGE_OPTS -e DOCKER_USERLANDPROXY -e TESTDIRS -e TESTFLAGS -e TIMEOUT -v &amp;quot;/Users/jimmy/Workspace/github/rootsongjc/docker/bundles:/go/src/github.com/docker/docker/bundles&amp;quot; -t &amp;quot;dockercore/docker:latest&amp;quot; bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŒ‰ç…§å®˜ç½‘çš„è¯´æ˜makeä¼šæŠ¥é”™&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root@f2753f78bb6d:/go/src/github.com/docker/docker# ./hack/make.sh binary                          

error: .git directory missing and DOCKER_GITCOMMIT not specified
  Please either build with the .git directory accessible, or specify the
  exact (--short) commit hash you are building using DOCKER_GITCOMMIT for
  future accountability in diagnosing build issues.  Thanks!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ä¸ª&lt;a href=&#34;https://github.com/docker/docker/issues/27581&#34;&gt;issue-27581&lt;/a&gt;ï¼Œè§£å†³æ–¹å¼å°±æ˜¯åœ¨makeçš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®š&lt;code&gt;DOCKER_GITCOMMIT&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root@f2753f78bb6d:/go/src/github.com/docker/docker# DOCKER_GITCOMMIT=3385658 ./hack/make.sh binary

---&amp;gt; Making bundle: binary (in bundles/17.04.0-dev/binary)
Building: bundles/17.04.0-dev/binary-client/docker-17.04.0-dev
Created binary: bundles/17.04.0-dev/binary-client/docker-17.04.0-dev
Building: bundles/17.04.0-dev/binary-daemon/dockerd-17.04.0-dev
Created binary: bundles/17.04.0-dev/binary-daemon/dockerd-17.04.0-dev
Copying nested executables into bundles/17.04.0-dev/binary-daemon
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;bundlesç›®å½•ä¸‹ä¼šç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ç»“æ„&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.
â”œâ”€â”€ 17.04.0-dev
â”‚Â Â  â”œâ”€â”€ binary-client
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker -&amp;gt; docker-17.04.0-dev
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker-17.04.0-dev
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker-17.04.0-dev.md5
â”‚Â Â  â”‚Â Â  â””â”€â”€ docker-17.04.0-dev.sha256
â”‚Â Â  â””â”€â”€ binary-daemon
â”‚Â Â      â”œâ”€â”€ docker-containerd
â”‚Â Â      â”œâ”€â”€ docker-containerd-ctr
â”‚Â Â      â”œâ”€â”€ docker-containerd-ctr.md5
â”‚Â Â      â”œâ”€â”€ docker-containerd-ctr.sha256
â”‚Â Â      â”œâ”€â”€ docker-containerd-shim
â”‚Â Â      â”œâ”€â”€ docker-containerd-shim.md5
â”‚Â Â      â”œâ”€â”€ docker-containerd-shim.sha256
â”‚Â Â      â”œâ”€â”€ docker-containerd.md5
â”‚Â Â      â”œâ”€â”€ docker-containerd.sha256
â”‚Â Â      â”œâ”€â”€ docker-init
â”‚Â Â      â”œâ”€â”€ docker-init.md5
â”‚Â Â      â”œâ”€â”€ docker-init.sha256
â”‚Â Â      â”œâ”€â”€ docker-proxy
â”‚Â Â      â”œâ”€â”€ docker-proxy.md5
â”‚Â Â      â”œâ”€â”€ docker-proxy.sha256
â”‚Â Â      â”œâ”€â”€ docker-runc
â”‚Â Â      â”œâ”€â”€ docker-runc.md5
â”‚Â Â      â”œâ”€â”€ docker-runc.sha256
â”‚Â Â      â”œâ”€â”€ dockerd -&amp;gt; dockerd-17.04.0-dev
â”‚Â Â      â”œâ”€â”€ dockerd-17.04.0-dev
â”‚Â Â      â”œâ”€â”€ dockerd-17.04.0-dev.md5
â”‚Â Â      â””â”€â”€ dockerd-17.04.0-dev.sha256
â””â”€â”€ latest -&amp;gt; 17.04.0-dev

4 directories, 26 files
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å¯ä»¥å°†docker-daemonå’Œdocker-clientç›®å½•ä¸‹çš„dockerå¯ä»¥æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨çš„/usr/bin/ç›®å½•ä¸‹äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¯åŠ¨docker deamon&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;docker daemon -D&amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ£€æŸ¥ä¸‹dockeræ˜¯å¦å¯ç”¨&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root@f2753f78bb6d:/go/src/github.com/docker/docker/bundles/17.04.0-dev# docker version
DEBU[0048] Calling GET /_ping                           
DEBU[0048] Calling GET /v1.27/version                   
Client:
 Version:      17.04.0-dev
 API version:  1.27
 Go version:   go1.7.5
 Git commit:   3385658
 Built:        Mon Mar  6 08:39:06 2017
 OS/Arch:      linux/amd64

Server:
 Version:      17.04.0-dev
 API version:  1.27 (minimum version 1.12)
 Go version:   go1.7.5
 Git commit:   3385658
 Built:        Mon Mar  6 08:39:06 2017
 OS/Arch:      linux/amd64
 Experimental: false
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ°æ­¤dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒéƒ½å·²ç»æ­å»ºå¥½äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæƒ³è¦ä¿®æ”¹dockeræºç ï¼Œåªè¦åœ¨ä½ çš„IDEã€å®¹å™¨é‡Œæˆ–è€…ä½ æœ¬æœºä¸Šä¿®æ”¹dockerä»£ç åï¼Œå†æ‰§è¡Œä¸Šé¢çš„hack/make.sh binaryå‘½ä»¤å°±å¯ä»¥ç”Ÿæˆæ–°çš„dockeräºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†æ›¿æ¢åŸæ¥çš„/usr/bin/ç›®å½•ä¸‹çš„dockeräºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ã€Šäº‘è®¡ç®—æŠ€æœ¯æ¶æ„ä¸å®è·µã€‹è¯»åæ„Ÿ</title>
      <link>http://rootsongjc.github.io/blogs/cloud-computing-architecture-practice/</link>
      <pubDate>Wed, 01 Mar 2017 18:29:36 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/cloud-computing-architecture-practice/</guid>
      <description>&lt;p&gt;æœ€è¿‘å‹äººæ¨èäº†ä¸€æœ¬ä¹¦ï¼Œæ˜¯åä¸ºçš„å·¥ç¨‹å¸ˆå†™çš„ã€Šäº‘è®¡ç®—æ¶æ„ä¸å®è·µç¬¬äºŒç‰ˆã€‹ï¼Œæ­£å¥½åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™æœ¬ä¹¦çš„pdfï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œ&lt;a href=&#34;http://olz1di9xf.bkt.clouddn.com/docs/%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5%E7%AC%AC2%E7%89%88.pdf&#34;&gt;ç‚¹è¿™é‡Œä¸‹è½½&lt;/a&gt;ï¼Œä¹¦æ˜¯æ–‡å­—ç‰ˆçš„ï¼Œå¤§å°13.04MBï¼Œé™¤äº†ç« èŠ‚é¡ºåºæœ‰ç‚¹é—®é¢˜å¤–æ²¡æœ‰å…¶ä»–ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;åç»­æˆ‘å°†ä¼šé™†ç»­åˆ†äº«è¿™æœ¬ä¹¦çš„è¯»åæ„Ÿã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>12 factor app</title>
      <link>http://rootsongjc.github.io/blogs/12-factor-app/</link>
      <pubDate>Mon, 27 Feb 2017 22:32:40 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/12-factor-app/</guid>
      <description>

&lt;h1 id=&#34;twelve-factor-app&#34;&gt;Twelve-factor App&lt;/h1&gt;

&lt;h1 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h1&gt;

&lt;p&gt;å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;strong&gt;æ ‡å‡†åŒ–&lt;/strong&gt;æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„&lt;strong&gt;åˆ’æ¸…ç•Œé™&lt;/strong&gt;ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›&lt;strong&gt;æœ€å¤§çš„å¯ç§»æ¤æ€§&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‚åˆ&lt;strong&gt;éƒ¨ç½²&lt;/strong&gt;åœ¨ç°ä»£çš„&lt;strong&gt;äº‘è®¡ç®—å¹³å°&lt;/strong&gt;ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„&lt;strong&gt;å·®å¼‚é™è‡³æœ€ä½&lt;/strong&gt;ï¼Œå¹¶ä½¿ç”¨&lt;strong&gt;æŒç»­äº¤ä»˜&lt;/strong&gt;å®æ–½æ•æ·å¼€å‘ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°&lt;strong&gt;æ‰©å±•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;h1 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h1&gt;

&lt;p&gt;æœ¬æ–‡çš„è´¡çŒ®è€…è€…å‚ä¸è¿‡æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡Â &lt;a href=&#34;http://www.heroku.com/&#34;&gt;Heroku&lt;/a&gt;Â å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡ç»¼åˆäº†æˆ‘ä»¬å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½•Â &lt;a href=&#34;http://blog.heroku.com/archives/2011/6/28/the_new_heroku_4_erosion_resistance_explicit_contracts/&#34;&gt;é¿å…è½¯ä»¶æ±¡æŸ“&lt;/a&gt;Â ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çš„åˆè¡·æ˜¯åˆ†äº«åœ¨ç°ä»£è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­å‘ç°çš„ä¸€äº›ç³»ç»Ÿæ€§é—®é¢˜ï¼Œå¹¶åŠ æ·±å¯¹è¿™äº›é—®é¢˜çš„è®¤è¯†ã€‚æˆ‘ä»¬æä¾›äº†è®¨è®ºè¿™äº›é—®é¢˜æ—¶æ‰€éœ€çš„å…±äº«è¯æ±‡ï¼ŒåŒæ—¶ä½¿ç”¨ç›¸å…³æœ¯è¯­ç»™å‡ºä¸€å¥—é’ˆå¯¹è¿™äº›é—®é¢˜çš„å¹¿ä¹‰è§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡æ ¼å¼çš„çµæ„Ÿæ¥è‡ªäº Martin Fowler çš„ä¹¦ç±ï¼šÂ *Patterns of Enterprise Application Architecture*Â ï¼ŒÂ *Refactoring*Â ã€‚&lt;/p&gt;

&lt;h1 id=&#34;12-factors&#34;&gt;12-factors&lt;/h1&gt;

&lt;h2 id=&#34;i-åŸºå‡†ä»£ç -https-12factor-net-zh-cn-codebase&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/codebase&#34;&gt;I. åŸºå‡†ä»£ç &lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;ä¸€ä»½åŸºå‡†ä»£ç -å¤šä»½éƒ¨ç½²&#34;&gt;ä¸€ä»½åŸºå‡†ä»£ç ï¼Œå¤šä»½éƒ¨ç½²&lt;/h3&gt;

&lt;h2 id=&#34;ii-ä¾èµ–-https-12factor-net-zh-cn-dependencies&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/dependencies&#34;&gt;II. ä¾èµ–&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»&#34;&gt;æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»&lt;/h3&gt;

&lt;h2 id=&#34;iii-é…ç½®-https-12factor-net-zh-cn-config&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/config&#34;&gt;III. é…ç½®&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®&#34;&gt;åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®&lt;/h3&gt;

&lt;h2 id=&#34;iv-åç«¯æœåŠ¡-https-12factor-net-zh-cn-backing-services&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/backing-services&#34;&gt;IV. åç«¯æœåŠ¡&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;æŠŠåç«¯æœåŠ¡å½“ä½œé™„åŠ èµ„æº&#34;&gt;æŠŠåç«¯æœåŠ¡å½“ä½œé™„åŠ èµ„æº&lt;/h3&gt;

&lt;h2 id=&#34;v-æ„å»º-å‘å¸ƒ-è¿è¡Œ-https-12factor-net-zh-cn-build-release-run&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/build-release-run&#34;&gt;V. æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;ä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ&#34;&gt;ä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ&lt;/h3&gt;

&lt;h2 id=&#34;vi-è¿›ç¨‹-https-12factor-net-zh-cn-processes&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/processes&#34;&gt;VI. è¿›ç¨‹&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨&#34;&gt;ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨&lt;/h3&gt;

&lt;h2 id=&#34;vii-ç«¯å£ç»‘å®š-https-12factor-net-zh-cn-port-binding&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/port-binding&#34;&gt;VII. ç«¯å£ç»‘å®š&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;é€šè¿‡ç«¯å£ç»‘å®šæä¾›æœåŠ¡&#34;&gt;é€šè¿‡ç«¯å£ç»‘å®šæä¾›æœåŠ¡&lt;/h3&gt;

&lt;h2 id=&#34;viii-å¹¶å‘-https-12factor-net-zh-cn-concurrency&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/concurrency&#34;&gt;VIII. å¹¶å‘&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;é€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•&#34;&gt;é€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•&lt;/h3&gt;

&lt;h2 id=&#34;ix-æ˜“å¤„ç†-https-12factor-net-zh-cn-disposability&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/disposability&#34;&gt;IX. æ˜“å¤„ç†&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…ç»ˆæ­¢å¯æœ€å¤§åŒ–å¥å£®æ€§&#34;&gt;å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…ç»ˆæ­¢å¯æœ€å¤§åŒ–å¥å£®æ€§&lt;/h3&gt;

&lt;h2 id=&#34;x-å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·-https-12factor-net-zh-cn-dev-prod-parity&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/dev-prod-parity&#34;&gt;X. å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;å°½å¯èƒ½çš„ä¿æŒå¼€å‘-é¢„å‘å¸ƒ-çº¿ä¸Šç¯å¢ƒç›¸åŒ&#34;&gt;å°½å¯èƒ½çš„ä¿æŒå¼€å‘ï¼Œé¢„å‘å¸ƒï¼Œçº¿ä¸Šç¯å¢ƒç›¸åŒ&lt;/h3&gt;

&lt;h2 id=&#34;xi-æ—¥å¿—-https-12factor-net-zh-cn-logs&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/logs&#34;&gt;XI. æ—¥å¿—&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;æŠŠæ—¥å¿—å½“ä½œäº‹ä»¶æµ&#34;&gt;æŠŠæ—¥å¿—å½“ä½œäº‹ä»¶æµ&lt;/h3&gt;

&lt;h2 id=&#34;xii-ç®¡ç†è¿›ç¨‹-https-12factor-net-zh-cn-admin-processes&#34;&gt;&lt;a href=&#34;https://12factor.net/zh_cn/admin-processes&#34;&gt;XII. ç®¡ç†è¿›ç¨‹&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;åå°ç®¡ç†ä»»åŠ¡å½“ä½œä¸€æ¬¡æ€§è¿›ç¨‹è¿è¡Œ&#34;&gt;åå°ç®¡ç†ä»»åŠ¡å½“ä½œä¸€æ¬¡æ€§è¿›ç¨‹è¿è¡Œ&lt;/h3&gt;
</description>
    </item>
    
    <item>
      <title>docker service discovery</title>
      <link>http://rootsongjc.github.io/blogs/docker-service-discovery/</link>
      <pubDate>Mon, 27 Feb 2017 18:27:07 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-service-discovery/</guid>
      <description>&lt;p&gt;Prior to Docker 1.12 release, setting up Swarm cluster needed some sort ofÂ &lt;a href=&#34;https://docs.docker.com/v1.11/swarm/discovery/&#34;&gt;service discovery backend&lt;/a&gt;. There are multiple discovery backends available like hosted discovery service, using a static file describing the cluster, etcd, consul, zookeeper or using static list of IP address.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pic-intro.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pic-intro.png&#34; alt=&#34;pic-intro&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Thanks to Docker 1.12 Swarm Mode&lt;/strong&gt;, we donâ€™t have to depend upon these external tools and complex configurations.Â &lt;a href=&#34;https://github.com/docker/docker/releases/tag/v1.12.0-rc5&#34;&gt;Docker Engine 1.12&lt;/a&gt;Â runs itâ€™s own internal DNS service to route services by name.Swarm manager nodes assign each service in the swarm a unique DNS name and load balances running containers. You can query every container running in the swarm through a DNS server embedded in the swarm.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;How does it help?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;When you create a service and provide a name for it, you can use just that name as a target hostname, and itâ€™s going to be automatically resolved to the proper container IP of the service. In short, within the swarm, containers can simply reference other services via their names and the built-in DNS will be used to find the appropriate IP and port automatically. It is important to note thatÂ if the service has multiple replicas,Â &lt;strong&gt;the requests would be round-robin load-balanced&lt;/strong&gt;. This would still work if you didnâ€™t forward any ports when you created your docker services.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic10.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic10.png&#34; alt=&#34;Pic10&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Embedded DNS is not a new concept. It was first included under Docker 1.10 release. Please note thatÂ DNS lookup for containers connected to user-defined networks works differently compared to the containers connected toÂ &lt;code&gt;default bridge&lt;/code&gt;Â network.Â As of Docker 1.10, the docker daemon implements an embedded DNS server which provides built-in service discovery for any container created with a validÂ &lt;code&gt;name&lt;/code&gt;Â orÂ &lt;code&gt;net-alias&lt;/code&gt;Â or aliased byÂ &lt;code&gt;link&lt;/code&gt;. Moreover,container name configured usingÂ &lt;code&gt;--name&lt;/code&gt;Â is used to discover a container within an user-defined docker network. The embedded DNS server maintains the mapping between the container name and its IP address (on the network the container is connected to).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;How does Embedded DNS resolve unqualified names?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic22.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic22.png&#34; alt=&#34;Pic22&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;With Docker 1.12 release, a new API called â€œserviceâ€ is being included which clearly talks about theÂ functionality of service discovery. Â It is important to noteÂ that Service discovery is scoped within the network. What it really means is â€“ Â If youÂ have redis application and web client as two separate services , you combine into single application and put them into same network.If you try build your application in such a way that you are trying to reach to redis through name â€œredisâ€,it will always resolve to name â€œredisâ€. Reason â€“ both of these services are part of the same network.Â You donâ€™t need to be inside the application trying to resolve this service using FQDN. Reason â€“ FQDNÂ name is not going to be portable which in turn, makes your application non-portable.&lt;/p&gt;

&lt;p&gt;Internally, there is a listener opened inside the container itself. If we try to enter into the container which is providing a service discovery and look at /etc/resolv.conf, we will find that the nameserver entry holds something really different like 127.0.0.11.This is nothing but a loopback address. So, whenever resolver tried to resolve, it will resolve to 127.0.0.11 and this request is rightly trapped.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic-12.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic-12.png&#34; alt=&#34;Pic-12&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Once this request is trapped, it isÂ sent to particular random UDP / TCP port currently being listened under theÂ docker daemon. Consequently, theÂ socket is to be created inside the namespace. When DNS server and daemon gets the request, it knows that this is coming from which specific network, hence gets aware ofÂ Â the context of from where it is coming from.Once it knows the context, it can generate the appropriate DNS response.&lt;/p&gt;

&lt;p&gt;To demonstrate Service Discovery Â under Docker 1.12, I have upgraded Docker 1.12.rc5 to 1.12.0 GA version. The swarm cluster look like:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pico01.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pico01.png&#34; alt=&#34;Pico01&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have created a network called â€œcollabnetâ€ for the new services as shown below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic-2.jpg&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic-2.jpg&#34; alt=&#34;Pic-2&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Letâ€™s create a service called â€œwordpressdbâ€ under collabnet network :&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-mysql.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-mysql.png&#34; alt=&#34;pico-mysql&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can list the running tasks(containers) and the node on which these containers are running on:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic-4.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic-4.png&#34; alt=&#34;Pic-4&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Letâ€™s create another service called â€œwordpressappâ€ under the same network:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-app.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-app.png&#34; alt=&#34;pico-app&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now, we can list out the number ofÂ services running on our swarm cluster as shown below.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-2.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-2.png&#34; alt=&#34;pico-2&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have scaled out the number of wordpressapp and wordpressdb just for demonstration purpose.&lt;/p&gt;

&lt;p&gt;Letâ€™s consider my master node where I have two of the containers running as shown below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pico-1.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pico-1.png&#34; alt=&#34;Pico-1&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can reach out one service(wordpressapp) from another service(wordpressapp) through just service-name as shown below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-last.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-last.png&#34; alt=&#34;pico-last&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, I can reach out to particular container by its name from other container running different service but on the same network. As shown below, I can reach out toÂ wordpressapp.3.6f8bthp container viaÂ wordpressdb.7.e62jl57qqu running wordpressdb.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-tasktoo.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-tasktoo.png&#34; alt=&#34;pico-tasktoo&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The below picture depicts the Service Discovery in a nutshell:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic23.png&#34; alt=&#34;Pic23&#34; /&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Every service has Virtual IP(VIP) associated which can be derived as shown below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pic-list.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pic-list.png&#34; alt=&#34;pic-list&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As shown above,Â each service has an IP address and this IP address maps to multiple container IP address associated with that service. It is important to note thatÂ service IP associated with a service does not change even though containers associated with the service dies/ restarts.&lt;/p&gt;

&lt;p&gt;Few important points to remember:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;VIP based services use Linux IPVS load balancing to route to the backend containers. This works only for TCP/UDP protocols. When you use DNS-RR mode services donâ€™t have a VIP allocated. Instead service names resolves to one of the backend container IPs randomly.&lt;/li&gt;
&lt;li&gt;Ping not working for VIP is as designed. Technically, IPVS is a TCP/UDP load-balancer, while ping uses ICMP and hence IPVS is not going to load-balance the ping request.&lt;/li&gt;
&lt;li&gt;For VIP based services the reason ping works on the local node is because the VIP is added a 2nd IP address on the overlay network interface&lt;/li&gt;
&lt;li&gt;You can any of the tools like Â dig, nslookup or wget -O- &lt;service name&gt; to demonstrate the service discovery functionality&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Below picture depicts that the network is the scope of service discoverability which means that when you have a service running on one network , it is scoped to that network and wonâ€™t be able to reach out to different service running on different network(unless it is part of that network).&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/SD.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/SD.png&#34; alt=&#34;SD&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Letâ€™s dig littleÂ further introducing Load-balancing aspect too. To see what is basically enabling the load-balancingÂ functionality, we can go into sandbox of each containers and see how it has been resolved.&lt;/p&gt;

&lt;p&gt;Letâ€™s pick up the two containers running on the master node. We can see the sandbox running through the following command:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-namespace.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-namespace.png&#34; alt=&#34;pico-namespace&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Under /var/run/docker/netns, you will find various namespaces. The namespaces marked with x-{id} represents network namespace managed by the overlay network driver for its operation (such as creating a bridge, terminating vxlan tunnel, etcâ€¦). They donâ€™t represent the container network namespace. Since it is managed by the driver, it is not recommended to manipulate anything within this namespace. But if you are curious on the deep dive, then you can use the â€œnsenterâ€ tool to understand more about this internal namespace.&lt;/p&gt;

&lt;p&gt;We can enter into sandbox through the nsenter utility:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-mangle.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/pico-mangle.png&#34; alt=&#34;pico-mangle&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In case you faced an error stating â€œnsenter: reassociate to namespace â€˜ns/netâ€™ failed: Invalid argumentâ€, I suggest to look atÂ &lt;a href=&#34;http://tinyurl.com/gu5rsw9&#34;&gt;this&lt;/a&gt;Â workaround.&lt;/p&gt;

&lt;p&gt;10.0.3.4 service IP is marked 0x108 using iptables OUTPUT chain. ipvs uses this marking and load balances it to containers 10.0.3.5 and 10.0.3.6 as shown below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/ipvs.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/ipvs.png&#34; alt=&#34;ipvs&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here are key takeaways from this entire post:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic34.png&#34;&gt;&lt;img src=&#34;http://collabnix.com/wp-content/uploads/2016/07/Pic34.png&#34; alt=&#34;Pic34&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From &lt;a href=&#34;http://collabnix.com/archives/1504&#34;&gt;http://collabnix.com/archives/1504&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>