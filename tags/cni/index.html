<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>CNI - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="宋净超的博客">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.129.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/tags/cni/" />
  <meta property="og:title" content="CNI | Jimmy Song" />
  <meta property="twitter:title" content="CNI | Jimmy Song" />

  
  <meta property="og:description" content="宋净超的博客" />
  <meta property="twitter:description" content="宋净超的博客" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">资料</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    <a class="nav-link" href="/en/tags/cni/">English</a>
                    
                  
                
              
              
              
                
                  
                    
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    CNI
                </p>
                <p class="page-description">
                    
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/istio-cni-deep-dive/">深入解析 Istio CNI：赋能无侵入式流量管理与强化服务网格安全</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/04/17</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('深入解析 Istio CNI：赋能无侵入式流量管理与强化服务网格安全', '本文详细解释了 Istio CNI 插件的设计理念、实现方式以及如何通过 Ambient Mode 提升安全性和权限管理。', '\n本文将深入探讨 Istio CNI 插件的设计理念、实现方式以及如何通过 Ambient Mode 来解决传统模式中存在的安全和权限问题。本文内容包括：\n\n- Init 容器的安全风险及其解决方案。\n- Istio CNI 的工作原理及其优势。\n- Ambient Mode 的实现机制及其与 CNI 的集成。\n\n## Istio 网络要求与解决方案概览 {#overview}\n\nIstio 服务网格通过 Sidecar 模式实现应用流量的拦截和管理。该模式通过在应用程序 Pod 中注入 Sidecar Proxy 和 init 容器，并使用 iptables 规则来管理网络流量。详细的部署和操作过程请参见 [Istio 中的 Sidecar 注入、透明流量劫持及流量路由过程详解](\/blog\/sidecar-injection-iptables-and-traffic-routing\/)。虽然此方法在多数 Kubernetes 平台上有效，但对高权限的依赖在多租户环境中引发了安全方面的担忧。\n\n### Istio-init 的局限性 {#istio-init}\n\nIstio 在其网络配置初期采用了 \u0060istio-init\u0060 容器来初始化流量拦截规则，这需要容器具有高级权限来修改网络配置，如 IPTables 规则。虽然这种方法实现了对流量的有效管理，但它也显著提高了权限需求并增加了安全风险。根据 [Istio 官方文档](https:\/\/istio.io\/latest\/zh\/docs\/setup\/additional-setup\/cni\/)，\u0060istio-init\u0060 容器默认被注入到 Istio 网格中的 Pod 里，以便将网络流量劫持到 Istio 的 Sidecar 代理。这一过程需要对部署 Pod 的 Service Account 赋予 [\u0060NET_ADMIN\u0060 容器权限](https:\/\/kubernetes.io\/zh-cn\/docs\/tasks\/configure-pod-container\/security-context\/#set-capabilities-for-a-container)，可能与某些组织的安全政策相悖。\n\n### Istio CNI 插件 {#istio-cni-plugin}\n\n为响应这一挑战，Istio 社区推出了 [Istio CNI](https:\/\/github.com\/istio\/istio\/tree\/master\/cni) 插件，该插件避免了对 init 容器的需求，允许直接在 Kubernetes 的网络层面操作，从而降低权限需求并简化部署流程，但是存在 CNI 兼容性问题。\n\n### Ambient 模式的引入 {#ambient-mode}\n\nIstio 的 Ambient Mode 是一种创新的无 sidecar 方案，它通过 [使用 Geneve 隧道](\/blog\/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh\/) 或 Istio CNI 提高网络的灵活性和安全性。\n\n直到最近 Istio 社区才推出[适配任意 CNI](https:\/\/istio.io\/latest\/zh\/blog\/2024\/inpod-traffic-redirection-ambient\/) 的通用的解决方案。此模式解决了与任意 CNI 的兼容性问题，使 Istio 能够在不影响现有网络策略的前提下，更有效地管理服务间的流量。\n\n## NET_ADMIN 权限的安全考虑 {#net-admin}\n\n在 Kubernetes 和 Docker 等容器化环境中，\u0060NET_ADMIN\u0060 权限允许容器内的进程执行广泛的网络相关操作。这包括修改 iptables 规则、更改网络接口配置、管理 IP 路由表，以及控制网络相关的内核参数。然而，这种权限的使用引发了安全上的考虑，特别是在权限过度和潜在的攻击面方面。\n\n**最佳实践包括**：\n\n- **限制使用范围**：只在必要时授予 \u0060NET_ADMIN\u0060 权限，并通过 Kubernetes 网络策略加以限制。\n- **持续监控与审计**：对使用 \u0060NET_ADMIN\u0060 权限的容器进行严格的日志记录和监控。\n\n## Istio CNI 插件的工作原理 {#istio-cni-principal}\n\nIstio CNI 插件是一个二进制文件，作为代理安装在每个节点的文件系统中。以下流程图说明了 Istio CNI 节点代理的工作原理：\n\n\u0060\u0060\u0060mermaid \u0022Istio CNI 插件的工作原理\u0022\nflowchart TB\n    subgraph istio_cni_node_agent[Istio CNI 节点代理]\n        direction LR\n        install_plugin[安装 Istio CNI 插件]\n        update_config[更新节点 CNI 配置位于 \/etc\/cni\/net.d]\n        monitor_paths[监控插件和配置路径]\n        \n        subgraph sidecar_mode[\u0022Sidecar 模式\u0022]\n            sidecar_setup[为 Pod 配置 iptables]\n        end\n        \n        subgraph ambient_mode[\u0022Ambient 模式\u0022]\n            ambient_server[Ambient 监控服务器]\n            sync_events[同步 Pod 事件]\n            configure_iptables[在 Pod 内配置 iptables]\n        end\n\n        install_plugin --\u003e update_config\n        update_config --\u003e monitor_paths\n        monitor_paths --\u003e sidecar_mode\n        monitor_paths --\u003e ambient_mode\n        ambient_mode --\u003e ambient_server\n        ambient_server --\u003e sync_events\n        sync_events --\u003e configure_iptables\n    end\n\u0060\u0060\u0060\n\n![Istio CNI 插件的工作原理](fb607dc081ac2cb19c109626ccfe368b.svg)\n\n\n\n- Istio CNI Node Agent 充当安装在每个节点上的代理。\n- 安装 Istio CNI 插件并更新节点的 CNI 配置。\n- 代理监控 CNI 插件和配置路径的更改。\n- 在 Sidecar 模式下，它使用 pod 的 iptables 处理 sidecar 网络设置。\n- 在 Ambient 模式下，它将 pod 事件同步到环境监控服务器，然后该服务器在 pod 内配置 iptables。\n- 节点需要提升权限，例如 \u0060CAP_SYS_ADMIN\u0060 、 \u0060CAP_NET_ADMIN\u0060 和 \u0060CAP_NET_RAW\u0060 才能在任一模式下运行。\n\n## 解析 Istio Ambient Mode 与 Kubernetes CNI 的冲突 {#confilct}\n\nIstio 的 Ambient Mode 是为了适配所有 CNI 而设计的一种模式，它通过 ztunnel 来透明地处理 Pod 内的流量转发，而不影响现有的 CNI 配置。这种模式下，Ambient Mode 通过 ztunnel 管理流量，使其流经 Istio 服务网格，而标准的 CNI 则侧重于为 Pod 提供标准化的网络接入。\n\nCNI 的主要职责是解决 Kubernetes Pod 之间的网络连通性，例如分配 IP 地址和转发数据包。相比之下，Ambient Mode 需要将流量导入 ztunnel，这与 CNI 的网络配置可能存在不兼容，主要问题包括：\n\n- 主流 CNI 的网络配置可能会与 Istio 的 CNI 扩展冲突，导致流量处理中断。\n- 如果部署的网络策略依赖于 CNI，那么使用 Istio CNI 时可能会影响这些策略的执行。\n\n为解决这些问题，可以通过将 ztunnel 运行在与 Pod 相同的用户空间中，避免与 CNI 修改过的内核空间的冲突。这样，Pod 可以直接连接到 ztunnel，绕过 CNI 的影响。\n\n下面的时序图描述了 Ambient mode 下的流程：\n\n\u0060\u0060\u0060mermaid \u0022Amibent mode 的运行流程\u0022\nsequenceDiagram\n    participant K8s_API as Kubernetes API\n    participant Plugin as CNI Plugin\n    participant Agent as Ambient CNI Agent\n    participant Server as Ambient Watch Server\n    participant Ztunnel as ztunnel\n\n    Plugin-\u003e\u003eAgent: CmdAdd (Pod 调度)\n    Agent-\u003e\u003eServer: 通知新的 Pod\n    Server-\u003e\u003eK8s_API: 检索 Pod 信息\n    K8s_API--\u003e\u003eServer: Pod 详情\n    Server-\u003e\u003eZtunnel: 设置 iptables\n    Ztunnel-\u003e\u003eServer: 确认设置\n    Server-\u003e\u003eAgent: 配置完成\n    Agent-\u003e\u003ePlugin: CmdDel (Pod 移除)\n    Server-\u003e\u003eZtunnel: 移除 iptables\n    Ztunnel--\u003e\u003eServer: 确认\n\u0060\u0060\u0060\n\n![Amibent mode 的运行流程](a513f6cb6fbbf1fd242a46a962706dd8.svg)\n\n\n\n- **Ambient CNI 代理** 通过监听信号着 Pod 创建的 UDS 事件来启动交互。\n- **Ambient 监控服务器** 根据需要修改 Pod 内的 iptables，将流量重定向到 ztunnel。\n- **ztunnel** 在 Kubernetes 集群内建立连接，并处理网络流量的重定向。\n\n## 解决 Istio Ambient Mode 和 Kubernetes CNI 的冲突 {#resolution}\n\n为缓解这些冲突，Istio 的 Ambient Mode 避免了对 CNI 修改过的内核空间的依赖：\n\n- **在用户空间运行 ztunnel**：这一策略让 ztunnel 与 Pod 运行在同一用户空间，避免了与 CNI 的直接冲突。\n- **确保 CNI 兼容性**：Istio CNI 配置必须在不影响现有 CNI 插件配置的前提下进行，确保 Pod 间的正常通信和流量管理。\n\n这些措施帮助 Istio 的 Ambient Mode 在不干扰现有 CNI 插件的情况下，有效管理服务间流量。\n\n## Istio Ambient Mode 的流量管理优化 {#optimization}\n\nAmbient Mode 在 Istio 中通过 **node-local Ztunnel** 实现了改进的流量转发机制，允许在 Pod 的网络命名空间中设置侦听套接字，实现从服务网格内部的加密（mTLS）和明文流量的有效重定向。这种方法不仅提高了流量管理的灵活性，还避免了与现有的 CNI 插件之间的潜在冲突。下面是该模式的具体实现流程：\n\n\u0060\u0060\u0060mermaid \u0022Ambient mode 的实现流程\u0022\ngraph TD\n    subgraph Kubernetes 集群\n    A[带有 istio.io\/dataplane-mode=ambient 的 Pod] --\u003e|被检测到| B(istio-cni 节点代理)\n    B --\u003e C{Pod 状态}\n    C --\u003e|新启动| D[CNI 插件触发]\n    C --\u003e|已运行| E[新 Pod 事件]\n    D \u0026 E --\u003e F[配置重定向]\n    F --\u003e|进入 Pod 的网络命名空间| G[建立网络重定向]\n    G --\u003e H[通知节点 Ztunnel]\n    H --\u003e|在 Pod 的命名空间中创建监听套接字| I[节点本地 Ztunnel 代理实例]\n    I --\u003e J[流量重定向已建立]\n    end\n\n    J --\u003e K{流量类型}\n    K --\u003e|mTLS| L[网格内的加密流量]\n    K --\u003e|明文| M[明文流量处理]\n\u0060\u0060\u0060\n\n![Ambient mode 的实现流程](37dcdcfa80a406219ebe4b580345b04d.svg)\n\n\n\n具体步骤如下：\n\n1. **侦测标记**：Istio CNI 节点代理侦测标记为 \u0060istio.io\/dataplane-mode=ambient\u0060 的 Pod。\n2. **触发 CNI 插件**：根据 Pod 事件（新启动或现有 Pod 加入网格）触发 CNI 插件，这一步会触发 Istio CNI 节点代理进行流量重定向配置。\n3. **配置重定向规则**：在 Pod 的网络命名空间内配置网络重定向规则，以便拦截并重定向至 node-local ztunnel 代理。\n4. **建立侦听套接字**：node-local ztunnel 在 Pod 的网络命名空间中创建侦听套接字，实现流量的重定向。\n5. **流量处理**：node-local ztunnel 处理网格内的加密（mTLS）和明文流量，确保数据传输的安全性和高效性。\n\n通过这种方法，Istio Ambient Mode 为 Kubernetes 环境中的服务间流量管理提供了一种更为高效和安全的解决方案。\n\n## 总结 {#summary}\n\n本文全面解析了 Istio CNI 插件的设计理念、实现方式和优势，特别是 Istio CNI 如何解决了传统 \u0060istio-init\u0060 方法中存在的权限和安全问题。通过这些创新，Istio 在网络安全和操作简便性上取得了重大进步，为 Kubernetes 环境中实施 Istio 提供了更灵活和高效的方法。\n', '\/blog\/istio-cni-deep-dive\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文详细解释了 Istio CNI 插件的设计理念、实现方式以及如何通过 Ambient Mode 提升安全性和权限管理。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/cni-deep-dive/">深入解读 CNI：容器网络接口</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2024/04/15</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('深入解读 CNI：容器网络接口', '本文详细解释了 CNI（容器网络接口）的基本概念、核心组件以及其与 CRI（容器运行时接口）的关系。', '\n在容器化环境中，有效管理网络是至关重要的。容器网络接口（CNI）是一个标准，定义了容器应如何配置网络。本文将深入探讨 CNI 的基础知识，并带你了解 CNI 与 CRI 的关系。\n\n## 什么是 CNI？{#what-is-cni}\n\nCNI（容器网络接口）规范为容器运行时和网络插件之间提供了一个通用的接口，旨在实现容器网络配置的标准化。\n\nCNI 规范包含以下几个核心组成部分：\n\n- **网络配置的格式**：定义了管理员如何定义网络配置。\n- **请求协议**：描述了容器运行时如何向网络插件发出网络配置或清理请求。\n- **插件执行过程**：详细阐述了插件如何根据提供的配置执行网络设置或清理。\n- **插件委派**：允许插件将特定功能委托给其他插件执行。\n- **结果返回**：定义了插件执行完成后如何向运行时返回结果的数据格式。\n\nCNI 规范通过定义这些核心组成部分，确保了不同的容器运行时和网络插件能够以一致的方式进行交互，实现网络配置的自动化和标准化。\n\n{{\u003ccallout note \u0022CNI 规范的一些要点\u0022\u003e}}\n\n- CNI 是一个插件化的容器化网络解决方案\n- CNI 插件为可执行文件\n- 单个 CNI 插件的职责是单一的\n- CNI 插件是呈链式调用的\n- CNI 规范为一个容器定义一个 Linux 网络命名空间\n- CNI 的网络定义存储为 JSON 格式\n- 网络定义通过 STDIN 输入流传输到插件，这意味着宿主机上不会存储网络配置文件，其他的配置参数通过环境变量传递给插件\n\n{{\u003c\/callout\u003e}}\n\nCNI 插件根据操作类型，接收相应的网络配置参数，执行网络配置或清理任务，并返回执行结果。这一流程确保了容器网络的动态配置与容器生命周期的同步。\n\n下图展示了 CNI 包含了众多的网络插件。\n\n\u0060\u0060\u0060mermaid \u0022CNI 插件的种类\u0022\ngraph TB\n    CR[Container Runtime] --\u003e CNI[\u0022Container Network Interface (CNI)\u0022]\n    CNI --\u003e LP[Loopback Plugin]\n    CNI --\u003e BP[Bridge Plugin]\n    CNI --\u003e PTP[PTP Plugin]\n    CNI --\u003e MACV[MACvlan Plugin]\n    CNI --\u003e IPV[IPvlan Plugin]\n    CNI --\u003e TPP[3rd-Party Plugin]\n\u0060\u0060\u0060\n\n![CNI 插件的种类](cdc38d55a4fc4468ab20df85ab63c2c7.svg)\n\n根据 [CNI 规范](https:\/\/github.com\/containernetworking\/cni\/blob\/main\/SPEC.md#section-2-execution-protocol)，一个 CNI 插件负责以某种方式配置容器的网络接口。插件可分为两大类：\n\n- \u0022接口\u0022插件，负责在容器内部创建网络接口并确保其具有连通性。\n- \u0022链式\u0022插件，调整已创建接口的配置（但可能需要创建更多接口以完成此操作）。\n\n## CNI 与 CRI 的关系 {#relationship}\n\nCNI 和 CRI（容器运行时接口）是 Kubernetes 中两个关键的接口，它们分别处理容器的网络配置和运行时管理。在 Kubernetes 集群中，CRI 调用 CNI 插件来配置或清理容器的网络，这确保了网络配置的过程与容器的创建和销毁过程紧密协调。\n\n下图直观地展示了 CNI 如何与 CRI 协同运行的：\n\n\u0060\u0060\u0060mermaid \u0022CNI 如何与 CRI 协同运行的\u0022\nsequenceDiagram\n    participant K as Kubelet\n    participant CRI as Container Runtime Interface\n    participant CNI as Container Network Interface\n    participant P as Pod\n\n    K-\u003e\u003e\u002bCRI: 创建 Pod 容器\n    CRI-\u003e\u003e\u002bP: 启动容器\n    P--\u003e\u003e-CRI: 容器运行中\n    CRI--\u003e\u003e-K: 容器准备就绪\n    K-\u003e\u003e\u002bCNI: 调用 CNI 进行网络设置\n    CNI-\u003e\u003e\u002bP: 连接网络\n    P--\u003e\u003e-CNI: 网络配置完成\n    CNI--\u003e\u003e-K: Pod 网络就绪\n    K-\u003e\u003eP: 带有网络运行的 Pod\n\u0060\u0060\u0060\n\n![CNI 如何与 CRI 协同运行的](5451dd983a8c3858a265283d74b7536b.svg)\n\n1. **Kubelet 到 CRI**：Kubelet 指示 CRI 创建已调度的 Pod 的容器。\n2. **CRI 到 Pod**：容器运行时在 Pod 中启动容器。\n3. **Pod 到 CRI**：一旦容器运行，它会向容器运行时发出信号。\n4. **CRI 到 Kubelet**：容器运行时通知 Kubelet 容器已准备就绪。\n5. **Kubelet 到 CNI**：容器已启动，Kubelet 调用 CNI 为 Pod 设置网络。\n6. **CNI 到 Pod**：CNI 为 Pod 配置网络，将其连接到必要的网络接口。\n7. **Pod 到 CNI**：网络配置完成后，Pod 向 CNI 确认网络设置。\n8. **CNI 到 Kubelet**：CNI 通知 Kubelet Pod 的网络已准备就绪。\n9. **Kubelet 到 Pod**：现在 Pod 完全可操作，两个容器均已运行且网络已配置。\n\n下图展示了在 Kubernetes 中为 Pod 设置网络所涉及的详细步骤：\n\n\u0060\u0060\u0060mermaid \u0022在 Kubernetes 中为 Pod 设置网络所涉及的详细步骤\u0022\nsequenceDiagram\n    participant P as Pod\n    participant K as Kubelet\n    participant CNI as Container Network Interface\n    participant NS as Network Setup\n    participant IPAM as IP Address Management\n\n    K-\u003e\u003e\u002bP: 调度 Pod\n    P-\u003e\u003e\u002bK: 请求网络设置\n    K-\u003e\u003e\u002bCNI: 调用 CNI\n    CNI-\u003e\u003e\u002bNS: 创建网络命名空间\n    NS--\u003e\u003e-CNI: 命名空间已创建\n    CNI-\u003e\u003e\u002bIPAM: 分配 IP 地址\n    IPAM--\u003e\u003e-CNI: IP 地址已分配\n    CNI-\u003e\u003eP: 设置网络接口\n    P--\u003e\u003e-K: 网络设置完成\n    K-\u003e\u003eP: 带有网络运行的 Pod\n\n    Note over P,K: Pod 调度触发网络设置\n    Note over CNI,IPAM: CNI 处理网络命名空间创建和 IP 地址分配\n\u0060\u0060\u0060\n\n![在 Kubernetes 中为 Pod 设置网络所涉及的详细步骤](4f3017abf23385a5007302ea17241bdf.svg)\n\n1. **Pod 调度**：Kubelet 在节点上调度一个 Pod 运行。\n2. **请求网络设置**：已调度的 Pod 请求 Kubelet 进行网络设置。\n3. **调用 CNI**：Kubelet 调用 CNI 处理 Pod 的网络设置。\n4. **创建网络命名空间**：CNI 为 Pod 创建一个网络命名空间，隔离其网络环境。\n5. **分配 IP 地址**：CNI 通过其 IP 地址管理（IPAM）插件为 Pod 分配一个 IP 地址。\n6. **设置网络接口**：CNI 在 Pod 的网络命名空间内设置必要的网络接口，将其连接到网络。\n7. **网络设置完成**：Pod 通知 Kubelet 其网络设置已完成。\n8. **带有网络运行的 Pod**：Pod 现在已经运行，并且其网络已配置，可以与 Kubernetes 集群中的其他 Pod 和服务通信。\n\n## CNI 工作流程 {#cni-process}\n\n容器网络接口（CNI）规范定义了容器如何配置网络，其中包括 \u0060ADD\u0060、\u0060CHECK\u0060、\u0060DELETE\u0060、\u0060GC\u0060 和 \u0060VERSION\u0060 五种操作。容器运行时通过调用各种 CNI 插件来执行这些操作，从而实现容器网络的动态管理和更新。\n\n\u0060\u0060\u0060mermaid \u0022CNI 工作流程\u0022\nsequenceDiagram\n    participant K as Kubelet\n    participant P as Pod\n    participant CNI as CNI Plugins\n    participant CNII as Interface CNI Plugin\n    participant CNIC as Chained CNI Plugin\n    participant NS as Network Setup\n    participant IPAM as IP Address Management\n\n    K-\u003e\u003e\u002bP: 调度 Pod\n    P-\u003e\u003eK: 请求网络设置\n    K-\u003e\u003eCNI: 调用 CNI 插件\n    CNI-\u003e\u003eCNII: 调用接口插件\n    CNII-\u003e\u003eNS: 设置网络接口\n    CNII-\u003e\u003eCNIC: 调用链式插件\n    CNIC-\u003e\u003eIPAM: 分配 IP 地址\n    IPAM-\u003e\u003eCNIC: IP 地址已分配\n    CNIC-\u003e\u003eNS: 应用网络策略\n    CNIC--\u003e\u003eCNI: 链式配置完成\n    CNI--\u003e\u003eK: 网络设置完成\n    K-\u003e\u003eP: 带有网络运行的 Pod\n\n    Note over CNI,CNIC: CNI插件可以是接口类型或链式类型\n\u0060\u0060\u0060\n\n![CNI 工作流程](893d64215a1ed2a7e409925b258f32ee.svg)\n\n为了详细说明序列图中描述的每个步骤，涉及 Kubelet、Pod、CNI 插件（包括接口和链式 CNI 插件）、网络设置和 IP 地址管理（IPAM）之间的交互，让我们深入了解这个过程：\n\n1. **调度 Pod**：Kubelet 安排一个 Pod 在节点上运行。这一步启动了 Kubernetes 集群中 Pod 的生命周期。\n2. **请求网络设置**：Pod 向 Kubelet 发出网络设置请求。这个请求触发了为 Pod 配置网络的过程，确保它可以在 Kubernetes 集群内进行通信。\n3. **调用 CNI 插件**：Kubelet 调用配置的容器网络接口（CNI）插件。CNI 定义了一个标准化的方式，用于容器管理系统在 Linux 容器中配置网络接口。Kubelet 将必要的信息传递给 CNI 插件，以启动网络设置。\n4. **调用接口插件**：CNI 框架调用一个接口 CNI 插件，负责为 Pod 设置主要的网络接口。这个插件可能会创建一个新的网络命名空间、连接一对 veth 或执行其他操作，以确保 Pod 具有所需的网络接口。\n5. **设置网络接口**：接口 CNI 插件为 Pod 配置网络接口。这个设置包括分配 IP 地址、设置路由和确保接口准备好通信。\n6. **调用链式插件**：在设置网络接口之后，接口 CNI 插件或 CNI 框架调用链式 CNI 插件。这些插件执行额外的网络配置任务，比如设置 IP 伪装、配置入口\/出口规则或应用网络策略。\n7. **分配 IP 地址**：作为链式过程的一部分，链式 CNI 插件中的一个可能涉及 IP 地址管理（IPAM）。IPAM 插件负责为 Pod 分配一个 IP 地址，确保每个 Pod 在集群或命名空间内具有唯一的 IP。\n8. **IP 地址已分配**：IPAM 插件分配了一个 IP 地址，并将分配信息返回给调用插件。这些信息通常包括 IP 地址本身、子网掩码和可能的网关。\n9. **应用网络策略**：链式 CNI 插件将任何指定的网络策略应用于 Pod 的网络接口。这些策略可以规定允许的入口和出口流量，确保根据集群的配置要求进行网络安全和隔离。\n10. **链式配置完成**：一旦所有链式插件完成了它们的任务，Pod 的整体网络配置被认为已完成。CNI 框架或链中的最后一个插件向 Kubelet 发送信号，表明网络设置已完成。\n11. **网络设置完成**：Kubelet 收到了 Pod 的网络设置完成的确认。此时，Pod 具有完全配置的网络接口，具有 IP 地址、路由规则和应用的网络策略。\n12. **带有网络运行的 Pod**：Pod 现在已经运行，并配置了网络。它可以与 Kubernetes 集群中的其他 Pod 通信，根据网络策略访问外部资源，并执行其指定的功能。\n\n以下是针对 [CNI 官方示例](https:\/\/github.com\/containernetworking\/cni\/blob\/main\/SPEC.md#appendix-examples)中的 \u0060ADD\u0060 操作、\u0060CHECK\u0060 操作和 \u0060DELETE\u0060 操作的示例序列图以及详细说明。通过这些操作，容器运行时与 CNI 插件之间进行交互，实现容器网络配置的动态管理和更新。\n\n### ADD 操作示例 {#add}\n\n以下是 ADD 操作的示例序列图以及详细说明：\n\n\u0060\u0060\u0060mermaid \u0022ADD 操作流程\u0022\nsequenceDiagram\n    participant CR as Container Runtime\n    participant PP as Portmap Plugin\n    participant TP as Tuning Plugin\n    participant BP as Bridge Plugin\n    participant HLP as Host-local Plugin\n\n    CR-\u003e\u003ePP: CNI_COMMAND=ADD\n    PP--\u003e\u003eCR: Portmap 配置完成\n    CR-\u003e\u003eTP: CNI_COMMAND=ADD\n    TP--\u003e\u003eCR: Tuning 配置完成\n    CR-\u003e\u003eBP: CNI_COMMAND=ADD\n    BP-\u003e\u003eHLP: CNI_COMMAND=ADD\n    HLP--\u003e\u003eBP: IPAM 配置完成\n    BP--\u003e\u003eCR: Bridge 配置完成\n\u0060\u0060\u0060\n\n![ADD 操作流程](4c05303a04984692bbba9bac12928387.svg)\n\n1. **容器运行时调用 Portmap 插件**：容器运行时通过调用 Portmap 插件执行 ADD 操作，配置容器的端口映射。\n2. **Portmap 配置完成**：Portmap 插件完成端口映射配置，并将结果返回给容器运行时。\n3. **容器运行时调用 Tuning 插件**：容器运行时调用 Tuning 插件执行 ADD 操作，配置容器的网络调优参数。\n4. **Tuning 配置完成**：Tuning 插件完成网络调优参数配置，并将结果返回给容器运行时。\n5. **容器运行时调用 Bridge 插件**：容器运行时调用 Bridge 插件执行 ADD 操作，配置容器的网络接口和 IP 地址。\n6. **Bridge 插件调用 Host-local 插件**：在完成自身配置之前，Bridge 插件调用 Host-local 插件执行 ADD 操作，配置容器的 IP 地址。\n7. **IPAM 配置完成**：Host-local 插件作为 IP 地址管理（IPAM）的授权方，完成 IP 地址分配，并将结果返回给 Bridge 插件。\n8. **Bridge 配置完成**：Bridge 插件完成网络接口和 IP 地址配置，并将结果返回给容器运行时。\n\n这些操作确保了在容器启动时，其所需的网络配置能够按照预期进行设置，包括端口映射、网络调优和 IP 地址分配等。\n\n### CHECK 操作示例 {#check}\n\n以下是 CHECK 操作的示例序列图以及详细说明：\n\n\u0060\u0060\u0060mermaid \u0022CHECK 操作流程\u0022\nsequenceDiagram\n    participant CR as Container Runtime\n    participant BP as Bridge Plugin\n    participant HLP as Host-local Plugin\n    participant TP as Tuning Plugin\n\n    CR-\u003e\u003eBP: CNI_COMMAND=CHECK with prevResult\n    BP-\u003e\u003eHLP: CNI_COMMAND=CHECK\n    HLP--\u003e\u003eBP: 返回无错误\n    BP--\u003e\u003eCR: 返回 0 返回码\n    CR-\u003e\u003eTP: CNI_COMMAND=CHECK with prevResult\n    TP--\u003e\u003eCR: 操作成功\n\u0060\u0060\u0060\n\n![CHECK 操作流程](eaf27d3bee18f3fe637b78d765c66d3c.svg)\n\n1. **容器运行时调用 Bridge 插件进行检查**：容器运行时通过调用 Bridge 插件执行 CHECK 操作，检查容器的网络配置是否符合预期。\n2. **Bridge 插件调用 Host-local 插件**：Bridge 插件调用 Host-local 插件执行 CHECK 操作，检查 IP 地址分配是否正常。\n3. **返回无错误**：Host-local 插件检查 IP 地址分配无异常，并返回无错误给 Bridge 插件。\n4. **返回 0 返回码**：Bridge 插件检查网络配置无异常，并返回 0 返回码给容器运行时。\n5. **容器运行时调用 Tuning 插件进行检查**：容器运行时调用 Tuning 插件执行 CHECK 操作，检查网络调优参数是否符合预期。\n6. **操作成功**：Tuning 插件检查网络调优参数无异常，返回操作成功给容器运行时。\n\n这些操作确保了在容器运行期间，其网络配置和网络调优参数能够按照预期进行检查和验证，以确保网络配置的一致性和正确性。\n\n### DELETE 操作示例 {#delete}\n\n以下是 DELETE 操作的示例序列图以及详细说明：\n\n\u0060\u0060\u0060mermaid \u0022DELETE 操作流程\u0022\nsequenceDiagram\n    participant CR as Container Runtime\n    participant PP as Portmap Plugin\n    participant TP as Tuning Plugin\n    participant BP as Bridge Plugin\n    participant HLP as Host-local Plugin\n\n    CR-\u003e\u003ePP: CNI_COMMAND=DEL\n    PP--\u003e\u003eCR: Portmap 删除完成\n    CR-\u003e\u003eTP: CNI_COMMAND=DEL\n    TP--\u003e\u003eCR: Tuning 删除完成\n    CR-\u003e\u003eBP: CNI_COMMAND=DEL\n    BP-\u003e\u003eHLP: CNI_COMMAND=DEL\n    HLP--\u003e\u003eBP: IPAM 删除完成\n    BP--\u003e\u003eCR: Bridge 删除完成\n\u0060\u0060\u0060\n\n![DELETE 操作流程](f7506b2840f92ecda6ad52e98a92e79c.svg)\n\n1. **容器运行时调用 Portmap 插件**：容器运行时通过调用 Portmap 插件执行 DELETE 操作，删除容器的端口映射配置。\n2. **Portmap 删除完成**：Portmap 插件完成端口映射的删除，并将结果返回给容器运行时。\n3. **容器运行时调用 Tuning 插件**：容器运行时调用 Tuning 插件执行 DELETE 操作，删除容器的网络调优参数配置。\n4. **Tuning 删除完成**：Tuning 插件完成网络调优参数的删除，并将结果返回给容器运行时。\n5. **容器运行时调用 Bridge 插件**：容器运行时调用 Bridge 插件执行 DELETE 操作，删除容器的网络接口和 IP 地址配置。\n6. **Bridge 插件调用 Host-local 插件**：在完成自身删除之前，Bridge 插件调用 Host-local 插件执行 DELETE 操作，删除容器的 IP 地址分配。\n7. **IPAM 删除完成**：Host-local 插件完成 IP 地址分配的删除，并将结果返回给 Bridge 插件。\n8. **Bridge 删除完成**：Bridge 插件完成网络接口和 IP 地址的删除，并将结果返回给容器运行时。\n\n这些操作确保了在容器停止运行时，其所需的网络配置能够被正确清理和移除，以确保网络资源的有效释放和管理。\n\n通过对 ADD、CHECK 和 DELETE 操作的示例序列图及详细说明，可以清晰地了解容器运行时与 CNI 插件之间的交互过程，以及如何实现容器网络配置的动态管理和更新。\n\n## 总结 {#summary}\n\nCNI 为容器化环境中的网络管理提供了一种标准化的接口，通过与 CRI 的配合，确保了 Kubernetes 集群中容器的网络配置高效且一致。通过深入理解 CNI，开发者和系统管理员可以更好地管理和优化其容器网络。\n\n## 参考 {#references}\n\n- [CNI 规范](https:\/\/github.com\/containernetworking\/cni\/blob\/main\/SPEC.md)\n', '\/blog\/cni-deep-dive\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文详细解释了 CNI（容器网络接口）的基本概念、核心组件以及其与 CRI（容器运行时接口）的关系。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      专栏
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(71)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(41)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(24)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>随笔</span>
            <span>(21)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>业态</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>其他</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(16)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>云原生</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>安全</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>开源</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>可观测性</span>
            <span>(5)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>旅行</span>
            <span>(5)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      资料
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>出版物</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>翻译电子书</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>翻译文档</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>翻译图书</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>原创图书</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>教程手册</span>
            <span>(1)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/service-mesh-data-plane-deployment-modes/">深入解析服务网格的四种数据平面部署模式：性能、安全性与成本分析</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/service-mesh-sidecar-vs-sidecarless-debate/">服务网格架构：Sidecar vs. Sidecarless，谁才是未来？</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/hong-kong-trip/">香港——内地的一面的镜子</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024（香港）</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">网站改版通知</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>









<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
