<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>Skywalking - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="å®‹å‡€è¶…çš„åšå®¢">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/tags/skywalking/" />
  <meta property="og:title" content="Skywalking | Jimmy Song" />
  <meta property="twitter:title" content="Skywalking | Jimmy Song" />

  
  <meta property="og:description" content="å®‹å‡€è¶…çš„åšå®¢" />
  <meta property="twitter:description" content="å®‹å‡€è¶…çš„åšå®¢" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">åšå®¢</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">èµ„æ–™</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">æ ‡ç­¾</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">å…¬å‘Š</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">è”ç³»</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">å…³äº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">ç¤¾åŒº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">è§†é¢‘ <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    <a class="nav-link" href="/en/tags/skywalking/">English</a>
                    
                  
                
              
              
              
                
                  
                    
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>æœç´¢</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">âŒ˜</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>ç«™å†…æœç´¢</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="å…³é—­"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="è¯·è¾“å…¥æœç´¢è¯" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="è¯·è¾“å…¥æœç´¢è¯">
        
        <div class="mt-4">
          <span>æœç´¢ç±»å‹: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">æ‰€æœ‰</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">åŸåˆ›</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">è¯‘æ–‡</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">èµ„æ–™</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">å…¬å‘Š</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    Skywalking
                </p>
                <p class="page-description">
                    
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/">ä½¿ç”¨ Argo é¡¹ç›® Istio åŠ SkyWalking å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/10/21</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä½¿ç”¨ Argo é¡¹ç›® Istio åŠ SkyWalking å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²', 'æœ¬æ–‡è®¨è®ºå¦‚ä½•ä½¿ç”¨ Kubernetes Deploymentã€Argo é¡¹ç›®å’Œ Istio æ¥å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚', '\n{{\u003ccallout note å…³äºæœ¬æ–‡\u003e}}\n\næœ¬æ–‡æ ¹æ®ç¬”è€…åœ¨ KubeCon\u0026CloudNativeCon China 2023 çš„é€šè¯ä»“æ´»åŠ¨ [IstioCon China](https:\/\/istioconchina2023.sched.com\/event\/1RoVG\/nano-argo-istio-re-skywalking-jiong-gitops-reqi-zha-yao-pi-how-to-achieve-the-perfect-union-of-gitops-and-observability-with-argo-istio-and-skywalking-jimmy-song-tetrate) ä¸Šçš„åˆ†äº«æ•´ç†è€Œæˆï¼ŒåŸæ ‡é¢˜ä¸ºã€Šå¦‚ä½•åœ¨ Argoã€Istio å’Œ SkyWalking ä¸­å®ç° GitOps å’Œå¯è§‚æµ‹æ€§çš„å®Œç¾ç»“åˆã€‹ã€‚\n\n{{\u003c\/callout\u003e}}\n\näº‘åŸç”Ÿåº”ç”¨çš„å‘å±•å¯¼è‡´å¼€å‘å·¦ç§»ï¼Œåº”ç”¨è¿­ä»£é¢‘ç‡æ›´é«˜ï¼Œè¿™å°±å‚¬ç”Ÿäº† GitOps çš„éœ€æ±‚ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Argo é¡¹ç›®ï¼ŒåŒ…æ‹¬ ArgoCD å’Œ Argo Rolloutsï¼Œé€šè¿‡ Istio å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚æ–‡ä¸­è¿˜æœ‰ä¸€ä¸ªæ¼”ç¤ºï¼Œå±•ç¤ºäº†å¦‚ä½•åŸºäº Tetrate Service Expressï¼ˆä¹Ÿé€‚ç”¨äº Tetrate Service Bridgeï¼‰æä¾›çš„ Istio ç¯å¢ƒå®ç° GitOpsã€‚\n\næœ¬æ–‡ demo çš„éƒ¨ç½²æ¶æ„å›¾å¦‚å›¾ 1 æ‰€ç¤ºã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰æœ¬æ–‡ä»‹ç»çš„éƒ¨ç½²ç­–ç•¥å’Œ Argo é¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥è·³åˆ° [demo éƒ¨åˆ†](#demo)ã€‚\n\n![å›¾ 1ï¼šåœ¨ TSE\/TSB ä¸­ä½¿ç”¨ Istio å’Œ Argo é¡¹ç›®å®ç° GitOps å’Œé‡‘ä¸é›€å‘å¸ƒçš„æ¶æ„å›¾](f1.svg)\n\n## éƒ¨ç½²ç­–ç•¥ {#deployment-strategy}\n\né¦–å…ˆï¼Œæˆ‘æƒ³ç®€å•ä»‹ç»ä¸€ä¸‹ Argo Rollouts æ”¯æŒçš„ä¸¤ç§éƒ¨ç½²ç­–ç•¥ï¼Œå¯ä»¥å®ç°é›¶åœæœºéƒ¨ç½²ã€‚\n\nè“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€éƒ¨ç½²çš„æ­¥éª¤å¦‚å›¾ 2 æ‰€ç¤ºã€‚\n\n![Figure 2: Steps of blue-green deployment and canary deployment](f2.svg)\n\n- è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§åœ¨å•ç‹¬çš„ç¯å¢ƒä¸­å¹¶è¡Œéƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºè€Œä¸å½±å“å½“å‰ç”Ÿäº§ç¯å¢ƒçš„ç­–ç•¥ã€‚åœ¨è“ç»¿éƒ¨ç½²ä¸­ï¼Œå½“å‰çš„ç”Ÿäº§ç¯å¢ƒç§°ä¸ºâ€œè“è‰²ç¯å¢ƒâ€ï¼Œéƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºçš„ç¯å¢ƒç§°ä¸ºâ€œç»¿è‰²ç¯å¢ƒâ€ã€‚ä¸€æ—¦ç»¿è‰²ç¯å¢ƒè¢«è®¤ä¸ºç¨³å®šå¹¶é€šè¿‡æµ‹è¯•ï¼Œæµé‡å°†é€æ¸ä»è“è‰²ç¯å¢ƒåˆ‡æ¢åˆ°ç»¿è‰²ç¯å¢ƒï¼Œè®©ç”¨æˆ·é€æ­¥æ¥å…¥æ–°ç‰ˆæœ¬ã€‚å¦‚æœåˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šåˆ°è“ç¯å¢ƒï¼Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“ã€‚è“ç»¿éƒ¨ç½²çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›é«˜å¯ç”¨æ€§å’Œé›¶åœæœºéƒ¨ç½²ã€‚\n- é‡‘ä¸é›€éƒ¨ç½²æ˜¯ä¸€ç§é€æ­¥å°†æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½å¼•å…¥ç”Ÿäº§ç¯å¢ƒçš„ç­–ç•¥ã€‚åœ¨é‡‘ä¸é›€éƒ¨ç½²ä¸­ï¼Œæ–°ç‰ˆæœ¬æˆ–æ–°åŠŸèƒ½é¦–å…ˆéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„å°‘æ•°ç”¨æˆ·ï¼Œç§°ä¸ºâ€œé‡‘ä¸é›€ç”¨æˆ·â€ã€‚é€šè¿‡ç›‘æ§é‡‘ä¸é›€ç”¨æˆ·çš„åé¦ˆå’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥è¯„ä¼°æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥é€æ­¥å°†æ›´å¤šç”¨æˆ·çº³å…¥é‡‘ä¸é›€éƒ¨ç½²ä¸­ï¼Œç›´åˆ°æ‰€æœ‰ç”¨æˆ·éƒ½ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚å¦‚æœå‘ç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šæˆ–ä¿®å¤ï¼Œé¿å…å¯¹æ•´ä¸ªç”¨æˆ·ç¾¤é€ æˆè´Ÿé¢å½±å“ã€‚é‡‘ä¸é›€éƒ¨ç½²çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å¿«é€Ÿå‘ç°é—®é¢˜å¹¶åœ¨å½±å“è¾ƒå°çš„èŒƒå›´å†…è¿›è¡Œè°ƒæ•´ã€‚\n\nè“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€éƒ¨ç½²çš„ä¸»è¦åŒºåˆ«åœ¨äºéƒ¨ç½²æ–¹å¼å’Œå˜æ›´è§„æ¨¡ã€‚è“ç»¿éƒ¨ç½²æ˜¯å°†æ•´ä¸ªåº”ç”¨éƒ¨ç½²åœ¨æ–°çš„ç¯å¢ƒä¸­ï¼Œç„¶åè¿›è¡Œåˆ‡æ¢ï¼Œé€‚åˆå¤§è§„æ¨¡çš„å˜æ›´ï¼Œæ¯”å¦‚æ•´ä¸ªåº”ç”¨çš„é‡å¤§å‡çº§ã€‚é‡‘ä¸é›€éƒ¨ç½²é€æ¸å¼•å…¥æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½ï¼Œé€‚åˆå°è§„æ¨¡æ›´æ”¹ï¼Œä¾‹å¦‚æ·»åŠ æˆ–ä¿®æ”¹å•ä¸ªåŠŸèƒ½ã€‚\n\nä»åº”ç”¨åœºæ™¯æ¥çœ‹ï¼Œè“ç»¿éƒ¨ç½²é€‚åˆå¯¹é«˜å¯ç”¨ã€é›¶å®•æœºéƒ¨ç½²è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿã€‚åœ¨éƒ¨ç½²å¤§è§„æ¨¡å˜æ›´æ—¶ï¼Œè“ç»¿éƒ¨ç½²å¯ä»¥ä¿è¯ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿå›æ»šä»¥åº”å¯¹çªå‘æƒ…å†µã€‚é‡‘ä¸é›€éƒ¨ç½²é€‚åˆéœ€è¦å¿«é€ŸéªŒè¯æ–°åŠŸèƒ½æˆ–ç‰ˆæœ¬çš„ç³»ç»Ÿã€‚é€šè¿‡é€æ­¥å¼•å…¥å˜æ›´ï¼Œå¯ä»¥åŠæ—©å‘ç°é—®é¢˜å¹¶è¿›è¡Œè°ƒæ•´ï¼Œå°½é‡å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“ã€‚\n\n## Kubernetes Deployment çš„å‘å¸ƒç­–ç•¥ {#kuberentes-deployment}\n\nåœ¨ Kubernetes ä¸­ï¼ŒDeployment èµ„æºå¯¹è±¡æ˜¯ç®¡ç†åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œæ›´æ–°çš„ä¸»è¦å·¥å…·ä¹‹ä¸€ã€‚éƒ¨ç½²æä¾›äº†ä¸€ç§å£°æ˜å¼æ–¹å¼æ¥å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸçŠ¶æ€ï¼Œå¹¶é€šè¿‡æ§åˆ¶å™¨çš„åŠŸèƒ½å®ç°å‘å¸ƒç­–ç•¥ã€‚Deployment çš„æ¶æ„å¦‚å›¾ 3 æ‰€ç¤ºï¼Œå…¶ä¸­å½©è‰²æ–¹å—ä»£è¡¨ä¸åŒç‰ˆæœ¬çš„ Podã€‚\n\n![å›¾ 3ï¼šKubernetes Deployment æ¶æ„å›¾](f3.svg)\n\nå‘å¸ƒç­–ç•¥å¯ä»¥åœ¨ Deployment çš„ spec å­—æ®µä¸­é…ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å‘å¸ƒç­–ç•¥é€‰é¡¹ï¼š\n\n1. ReplicaSet çš„ç®¡ç†ï¼šDeployment ä½¿ç”¨ ReplicaSet æ¥åˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å‰¯æœ¬ã€‚å¯ä»¥é€šè¿‡è®¾ç½® \u0060spec.replicas\u0060 å­—æ®µæ¥æŒ‡å®šæ‰€éœ€çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ï¼ŒKubernetes æ§åˆ¶å™¨ä¿è¯æ–°ç‰ˆæœ¬ ReplicaSet çš„å‰¯æœ¬æ•°é‡åœ¨åˆ›å»ºæ—¶é€æ¸å¢åŠ ï¼Œæ—§ç‰ˆæœ¬ ReplicaSet çš„å‰¯æœ¬æ•°é‡åœ¨åˆ é™¤æ—¶é€æ¸å‡å°‘ï¼Œå®ç°å¹³æ»‘åˆ‡æ¢ã€‚\n2. æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼šéƒ¨ç½²æ”¯æŒå¤šç§æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® \u0060spec.strategy.type\u0060 å­—æ®µæ¥é€‰æ‹©ã€‚å¸¸è§æ”¿ç­–åŒ…æ‹¬ï¼š\n   - \u0060RollingUpdate\u0060ï¼šé»˜è®¤ç­–ç•¥ä»¥ä¸€å®šçš„æ—¶é—´é—´éš”é€æ¸æ›´æ–°å‰¯æœ¬ã€‚ä¸åŒæ—¶å¯ç”¨çš„å‰¯æœ¬æ•°é‡ä»¥åŠé¢å¤–å¯ç”¨çš„å‰¯æœ¬æ•°é‡å¯ä»¥é€šè¿‡è®¾ç½® \u0060spec.strategy.rollingUpdate.maxUnavailable\u0060 å’Œ \u0060spec.strategy.rollingUpdate.maxSurge\u0060 å­—æ®µæ¥æ§åˆ¶ã€‚\n   - \u0060ReCreate\u0060ï¼šè¯¥ç­–ç•¥åœ¨æ›´æ–°è¿‡ç¨‹ä¸­é¦–å…ˆåˆ é™¤æ—§ç‰ˆæœ¬çš„æ‰€æœ‰å‰¯æœ¬ï¼Œç„¶ååˆ›å»ºæ–°ç‰ˆæœ¬çš„å‰¯æœ¬ã€‚æ­¤ç­–ç•¥å°†å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨æ›´æ–°æœŸé—´æš‚æ—¶ä¸å¯ç”¨ã€‚\n3. ç‰ˆæœ¬æ§åˆ¶ï¼šDeployment é€šè¿‡ \u0060spec.template.metadata.labels\u0060 å­—æ®µä¸ºæ¯ä¸ªç‰ˆæœ¬çš„ ReplicaSet è®¾ç½®æ ‡ç­¾ï¼Œä»¥ä¾¿æ§åˆ¶å™¨å‡†ç¡®è·Ÿè¸ªå’Œç®¡ç†ã€‚è¿™æ · ReplicaSet çš„å¤šä¸ªç‰ˆæœ¬å¯ä»¥å…±å­˜ï¼Œå¹¶ä¸”å¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªç‰ˆæœ¬çš„å‰¯æœ¬æ•°é‡ã€‚\n\né€šè¿‡ä½¿ç”¨è¿™äº›é…ç½®é€‰é¡¹ï¼ŒDeployment å¯ä»¥å®ç°ä¸åŒçš„å‘å¸ƒç­–ç•¥ã€‚æ›´æ–° Deployment å¯¹è±¡çš„ spec å­—æ®µå¯ä»¥è§¦å‘æ–°ç‰ˆæœ¬çš„å‘å¸ƒã€‚Kubernetes æ§åˆ¶å™¨ä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥è‡ªåŠ¨å¤„ç†å‰¯æœ¬çš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ï¼Œä»¥å®ç°å¹³æ»‘çš„åº”ç”¨æ›´æ–°å’Œéƒ¨ç½²ç­–ç•¥ã€‚\n\n## ä½¿ç”¨ ArgoCD å®æ–½ GitOps {#argocd-gitops}\n\nå¯ä»¥ä½¿ç”¨ Deployment æ¥æ‰‹åŠ¨ç®¡ç†å‘å¸ƒç­–ç•¥ï¼Œä½†è¦å®ç°è‡ªåŠ¨åŒ–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ ArgoCD ç­‰ GitOps å·¥å…·ã€‚\n\nArgoCD æ˜¯ä¸€ä¸ªåŸºäº GitOps çš„æŒç»­äº¤ä»˜å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–å’Œç®¡ç† Kubernetes åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚å®ƒä¸ºæé«˜åº”ç”¨ç¨‹åºéƒ¨ç½²çš„æ•ˆç‡å’Œå¯é æ€§æä¾›äº†ä¸€äº›å…³é”®çš„å¸®åŠ©ã€‚\n\nä»¥ä¸‹æ˜¯ ArgoCD ä¸º Kubernetes åº”ç”¨ç¨‹åºéƒ¨ç½²æä¾›çš„ä¸€äº›å¸®åŠ©ï¼š\n\n1. **å£°æ˜å¼é…ç½®**ï¼šArgoCD ä½¿ç”¨å£°æ˜å¼æ–¹å¼å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸçŠ¶æ€ï¼Œå¹¶å°†åº”ç”¨ç¨‹åºé…ç½®å­˜å‚¨åœ¨ Git å­˜å‚¨åº“ä¸­ã€‚é€šè¿‡ç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆ\/æŒç»­äº¤ä»˜ (CI\/CD) æµç¨‹ï¼Œå¯ä»¥è½»æ¾è·Ÿè¸ªå’Œç®¡ç†åº”ç”¨ç¨‹åºé…ç½®æ›´æ”¹ã€‚\n2. **æŒç»­éƒ¨ç½²**ï¼šArgoCD å¯ä»¥ç›‘æ§ Git å­˜å‚¨åº“ä¸­çš„é…ç½®å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒã€‚æä¾›å¯å®šåˆ¶çš„åŒæ­¥ç­–ç•¥ï¼Œè‡ªåŠ¨è§¦å‘åº”ç”¨éƒ¨ç½²å’Œæ›´æ–°ï¼Œå®ç°æŒç»­éƒ¨ç½²ã€‚\n3. **çŠ¶æ€æ¯”è¾ƒå’Œè‡ªåŠ¨ä¿®å¤**ï¼šArgoCD å®šæœŸæ£€æŸ¥åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€å¹¶å°†å…¶ä¸é¢„æœŸçŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå‘ç°ä¸ä¸€è‡´ï¼Œå®ƒä¼šè‡ªåŠ¨å°è¯•ä¿®å¤å¹¶å°†åº”ç”¨ç¨‹åºæ¢å¤åˆ°æ‰€éœ€çŠ¶æ€ï¼Œä»¥ç¡®ä¿é¢„æœŸçŠ¶æ€ä¸å®é™…çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚\n4. **å¤šç¯å¢ƒç®¡ç†**ï¼šArgoCD æ”¯æŒç®¡ç†å¤šä¸ª Kubernetes ç¯å¢ƒï¼Œä¾‹å¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒã€‚å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒç¯å¢ƒä¹‹é—´éƒ¨ç½²å’ŒåŒæ­¥åº”ç”¨é…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§å’Œå¯æ§æ€§ã€‚\n\nä¸ Deployment èµ„æºå¯¹è±¡ç›¸æ¯”ï¼ŒArgoCD æä¾›äº†æ›´é«˜çº§çš„åŠŸèƒ½å’Œå·¥ä½œæµç¨‹ï¼Œè¡¥å……äº†åŸç”Ÿ Kubernetes èµ„æºå¯¹è±¡çš„åŠŸèƒ½ï¼š\n\n- **åŸºäº GitOps çš„é…ç½®ç®¡ç†**ï¼šArgoCD å°†åº”ç”¨ç¨‹åºé…ç½®å­˜å‚¨åœ¨ Git å­˜å‚¨åº“ä¸­ï¼Œä»è€Œå®ç°åŸºäº GitOps çš„é…ç½®ç®¡ç†ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿é…ç½®æ›´æ”¹æ˜¯å¯è·Ÿè¸ªã€å¯å®¡è®¡çš„ï¼Œå¹¶ä¸”å¯ä»¥ä¸ç°æœ‰çš„ CI\/CD ç®¡é“é›†æˆã€‚\n\n- **è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜**ï¼šArgoCD å¯ä»¥è‡ªåŠ¨æ£€æµ‹ Git å­˜å‚¨åº“ä¸­çš„é…ç½®æ›´æ”¹å¹¶å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒï¼Œä»è€Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜ã€‚\n\n- **çŠ¶æ€ç®¡ç†å’Œè‡ªåŠ¨æ¢å¤**ï¼šArgoCD æŒç»­ç›‘æ§åº”ç”¨ç¨‹åºçš„çŠ¶æ€å¹¶å°†å…¶ä¸é¢„æœŸçŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼Œå®ƒä¼šè‡ªåŠ¨æ¢å¤å¹¶ç¡®ä¿åº”ç”¨ç¨‹åºçŠ¶æ€ä¸é¢„æœŸçŠ¶æ€ä¿æŒä¸€è‡´ã€‚\n\n## ä½¿ç”¨ Istio å®ç°ç»†ç²’åº¦çš„æµé‡è·¯ç”± {#istio-routing-traffic}\n\nè™½ç„¶ ArgoCD å¯ä»¥å®ç° GitOpsï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯åœ¨ Kubernetes éƒ¨ç½²ä¸Šè¿è¡Œå¹¶é€šè¿‡å‰¯æœ¬æ•°é‡æ§åˆ¶æµé‡è·¯ç”±ã€‚ä¸ºäº†å®ç°ç»†ç²’åº¦çš„æµé‡è·¯ç”±ï¼Œä½¿ç”¨äº† Istio ç­‰æœåŠ¡ç½‘æ ¼ã€‚\n\nIstio é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°æ›´ç»†ç²’åº¦çš„æµé‡è·¯ç”±å’Œåº”ç”¨å‘å¸ƒï¼š\n\n**VirtualService**ï¼šIstio ä½¿ç”¨ VirtualService æ¥å®šä¹‰æµé‡è·¯ç”±è§„åˆ™ã€‚é€šè¿‡é…ç½® VirtualServiceï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚å¤´ã€è·¯å¾„ã€æƒé‡ç­‰è¯·æ±‚å±æ€§å¯¹æµé‡è¿›è¡Œè·¯ç”±å’Œåˆ†å‘ï¼Œå°†è¯·æ±‚å®šå‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹æˆ–ç‰ˆæœ¬ã€‚\n\n**DestinationRule**ï¼šIstio çš„ DestinationRule ç”¨äºå®šä¹‰æœåŠ¡ç‰ˆæœ¬ç­–ç•¥å’Œè´Ÿè½½å‡è¡¡è®¾ç½®ã€‚é€šè¿‡æŒ‡å®šä¸åŒç‰ˆæœ¬æœåŠ¡å®ä¾‹ä¹‹é—´ä¸åŒçš„æµé‡æƒé‡ï¼Œå¯ä»¥å®ç°é‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ç­‰é«˜çº§åº”ç”¨å‘å¸ƒç­–ç•¥ã€‚\n\n**æµé‡æ§åˆ¶å’Œç­–ç•¥**ï¼šIstio æä¾›äº†ä¸°å¯Œçš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›ï¼Œå¦‚æµé‡é™åˆ¶ã€æ•…éšœæ³¨å…¥ã€è¶…æ—¶è®¾ç½®ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°æ›´é«˜çº§åˆ«çš„è´Ÿè½½å‡è¡¡ã€å®¹é”™å’Œå¯é æ€§è¦æ±‚ã€‚\n\nä¸ ArgoCD å’Œ Kubernetes Deployment å¯¹è±¡ç›¸æ¯”ï¼ŒIstio åœ¨åº”ç”¨éƒ¨ç½²æ–¹é¢æä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\n**ç»†ç²’åº¦çš„æµé‡è·¯ç”±æ§åˆ¶**ï¼šIstio æä¾›äº†æ›´ä¸°å¯Œçš„æµé‡è·¯ç”±èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®å¤šç§è¯·æ±‚å±æ€§è¿›è¡Œçµæ´»çš„è·¯ç”±å’Œåˆ†å‘ï¼Œä»è€Œå®ç°æ›´ç»†ç²’åº¦çš„æµé‡æ§åˆ¶å’Œç®¡ç†ã€‚\n\n**é«˜çº§å‘å¸ƒç­–ç•¥æ”¯æŒ**ï¼šIstio çš„ DestinationRule å¯ä»¥æŒ‡å®šä¸åŒç‰ˆæœ¬æœåŠ¡å®ä¾‹ä¹‹é—´çš„æµé‡æƒé‡ï¼Œæ”¯æŒé‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ç­‰é«˜çº§åº”ç”¨å‘å¸ƒç­–ç•¥ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæ›´åŠ çµæ´»å¯æ§ã€‚\n\n**å¼ºå¤§çš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›**ï¼šIstio æä¾›äº†ä¸°å¯Œçš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›ï¼Œå¦‚æµé‡é™åˆ¶ã€æ•…éšœæ³¨å…¥ã€è¶…æ—¶è®¾ç½®ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°æ›´é«˜çº§åˆ«çš„è´Ÿè½½å‡è¡¡ã€å®¹é”™å’Œå¯é æ€§è¦æ±‚ã€‚\n\nå°† Istio ä¸ Argo Rollouts ç›¸ç»“åˆï¼Œå¯ä»¥å……åˆ†å‘æŒ¥ Istio ç»†ç²’åº¦æµé‡è·¯ç”±çš„ä¼˜åŠ¿ã€‚ç°åœ¨è®©æˆ‘ä»¬ä¸€èµ·è¿›è¡Œæ¼”ç¤ºã€‚åœ¨æˆ‘ä»¬çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ TSE æä¾›çš„ Kubernetes å’Œ Istio ç¯å¢ƒï¼Œä½¿ç”¨ ArgoCD å®ç° GitOpsï¼Œå¹¶ä½¿ç”¨ Argo Rollouts å®ç°é‡‘ä¸é›€å‘å¸ƒã€‚\n\n## Demo\n\næˆ‘ä»¬çš„æ¼”ç¤ºä¸­ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯ï¼š\n\n-  Kubernetes v1.24.14\n-  Istio v1.15.7\n-  Argo CD v2.7.4\n-  Argo å‘å¸ƒ v1.5.1\n-  TSE Preview 2\n\næˆ‘ä»¬å°†ä½¿ç”¨ Istio çš„ VirtualService å’Œ DestinationRule æ¥å®ç°åŸºäº Subset çš„æµé‡åˆ†ç»„è·¯ç”±ï¼Œå¹¶ä½¿ç”¨ ArgoCD Rollouts è¿›è¡Œæ¸è¿›å¼å‘å¸ƒã€‚\n\n### éƒ¨ç½² ArgoCD å’Œ Argo Rollouts {#deployment-argocd-and-rollouts}\n\næˆ‘æå‰åˆ›å»ºäº†ä¸€ä¸ª Kubernetes é›†ç¾¤å¹¶å°†å…¶æ·»åŠ åˆ° TSE ä¸­ï¼ŒTSE ä¼šè‡ªåŠ¨ä¸ºé›†ç¾¤å®‰è£… Istio æ§åˆ¶å¹³é¢ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®‰è£… ArgoCD å’Œ Argo Rolloutsï¼š\n\n\u0060\u0060\u0060bash\n# Install ArgoCD\nkubectl create namespace argocd\nkubectl apply -n argocd -f https:\/\/raw.githubusercontent.com\/argoproj\/argo-cd\/stable\/manifests\/install.yaml\n\n# Install ArgoCD CLI on macOS\nbrew install argocd\n\n# Change the service type of argocd-server to LoadBalancer\nkubectl patch svc argocd-server -n argocd -p \u0027{\u0022spec\u0022: {\u0022type\u0022: \u0022LoadBalancer\u0022}}\u0027\n\n# Get the ArgoCD UI address\nARGOCD_ADDR=$(kubectl get svc argocd-server -n argocd -o jsonpath=\u0027{.status.loadBalancer.ingress[0].hostname}\u0027)\n\n# Login using ArgoCD CLI, see https:\/\/argo-cd.readthedocs.io\/en\/stable\/getting_started\/#4-login-using-the-cli to get password\nargocd login $ARGOCD_ADDR --skip-test-tls --grpc-web --insecure\n\n# Install Argo Rollouts\nkubectl create namespace argo-rollouts\nkubectl apply -n argo-rollouts -f https:\/\/github.com\/argoproj\/argo-rollouts\/releases\/download\/latest\/install.yaml\n\n# Install rollouts plugin on macOS\ncurl -LO https:\/\/github.com\/argoproj\/argo-rollouts\/releases\/download\/v1.5.0\/kubectl-argo-rollouts-darwin-amd64\nchmod \u002bx .\/kubectl-argo-rollouts-darwin-amd64\nsudo mv .\/kubectl-argo-rollouts-darwin-amd64 \/usr\/local\/bin\/kubectl-argo-rollouts\n\u0060\u0060\u0060\n\nè¯¥åŠŸèƒ½ä¸é€‚ç”¨äº TSE Bridge Modeï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨ TSE Direct Mode æ¥å®ç°æ¸è¿›å¼å‘å¸ƒã€‚\n\n{{\u003ccallout note \u0022ğŸ’¡ä»€ä¹ˆæ˜¯æ¡¥æ¥æ¨¡å¼å’Œç›´æ¥æ¨¡å¼ï¼Ÿ\u0022\u003e}}\n\n\nç›´æ¥æ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼æ˜¯ TSE ä¸­æ§åˆ¶å¹³é¢ä¸‹å‘é…ç½®çš„ä¸¤ç§æ¨¡å¼ã€‚é€‚ç”¨äºæµé‡ã€å®‰å…¨ã€ç½‘å…³ç»„é…ç½®æ¨¡å¼ã€‚BRIDGED æ¨¡å¼æ˜¯ä¸€ç§æç®€æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ Tetrate ç‰¹å®šçš„ API å¿«é€Ÿé…ç½®æœåŠ¡ç½‘æ ¼ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œè€Œ DIRECT æ¨¡å¼ä¸ºé«˜çº§ç”¨æˆ·æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸ä»–ä»¬ç›´æ¥ä½¿ç”¨ Istio API è¿›è¡Œé…ç½®ã€‚\n\n{{\u003c\/callout\u003e}}\n\næ¥ä¸‹æ¥ï¼Œéƒ¨ç½² Rollouts Dashboardï¼š\n\n\u0060\u0060\u0060bash\ngit clone https:\/\/github.com\/argoproj\/argo-rollouts.git\nkustomize build manifests\/dashboard-install|kubectl apply -n argo-rollouts -f -\nkubectl port-forward svc\/argo-rollouts-dashboard -n argo-rollouts 3100:3100\n\u0060\u0060\u0060\n\næ‚¨ç°åœ¨å¯ä»¥é€šè¿‡ \u003chttps:\/\/localhost:3100\/rollouts\/\u003e è®¿é—® Rollouts ä»ªè¡¨æ¿ã€‚\n\n### éƒ¨ç½² Bookinfo åº”ç”¨ {#bookinfo}\n\næˆ‘ä»¬å·²ç»ä¸º Bookinfo åº”ç”¨ç¨‹åºå‡†å¤‡äº†é…ç½®æ–‡ä»¶ï¼ˆä¿å­˜åœ¨ [tse-gitops-demo](https:\/\/github.com\/tetrateio\/tse-gitops-demo\/) å­˜å‚¨åº“ä¸­ï¼‰ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†å…¶ fork åˆ°æ‚¨è‡ªå·±çš„å¸æˆ·å¹¶å°†å…¶æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å­˜å‚¨åº“ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½² Bookinfo åº”ç”¨ç¨‹åºï¼š\n\n\u0060\u0060\u0060bash\nargocd app create bookinfo-app --repo https:\/\/github.com\/tetrateio\/tse-gitops-demo.git --path application --dest-server https:\/\/kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated\n\u0060\u0060\u0060\n\næ³¨æ„ï¼šæˆ‘ä»¬åœ¨ [\u0060reviews\u0060 éƒ¨ç½²](https:\/\/github.com\/tetrateio\/tse-gitops-demo\/blob\/main\/application\/bookinfo.yaml#L151)ä¸­å°† \u0060replicas\u0060 è®¾ç½®ä¸º \u00600\u0060 ï¼Œå› ä¸ºæˆ‘ä»¬å°†åˆ›å»º Argo Rollouts æ¥æ“çºµ \u0060reviews\u0060 çš„å®ä¾‹æ•°é‡æœåŠ¡ã€‚å¦‚æœè¿™é‡Œè®¾ç½®ä¸ºéé›¶æ­£æ•´æ•°ï¼Œæˆ‘ä»¬å°†æ— æ³•å®ç°é‡‘ä¸é›€éƒ¨ç½²ã€‚\n\nç°åœ¨æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ ArgoCD UIï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚\n\n![å›¾ 4ï¼šArgoCD ç”¨æˆ·ç•Œé¢](f4.png)\n\nå¦‚æœæ‚¨å‘ç°åº”ç”¨ç¨‹åºçŠ¶æ€ä¸åŒæ­¥ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æˆ–å•å‡» UI ä¸­çš„ SYNC æŒ‰é’®ã€‚\n\n\u0060\u0060\u0060bash\nargocd app sync bookinfo-app\n\u0060\u0060\u0060\n\n## ä½¿ç”¨ Istio å®æ–½ç»†ç²’åº¦æµé‡ç®¡ç† {#istio-fine-grain-traffic-management}\n\né¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ Argo CD åˆ›å»º Istio ç›¸å…³çš„èµ„æºå¯¹è±¡ï¼š\n\n\u0060\u0060\u0060bash\nargocd app create bookinfo-tse-conf --repo https:\/\/github.com\/tetrateio\/tse-gitops-demo.git --path argo\/tse --dest-server https:\/\/kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated --self-heal\n\n# Check the creation status\nargocd app get bookinfo-tse-conf\n\u0060\u0060\u0060\n\n### å°† Deployment è½¬æ¢ä¸º Rollout {#convert-deployment-to-rollout}\n\nå‡è®¾æˆ‘ä»¬è¦å‘å¸ƒæ–°ç‰ˆæœ¬çš„ \u0060reviews\u0060 æœåŠ¡ã€‚ä¸ºäº†å®ç°é›¶åœæœºæ›´æ–°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é‡‘ä¸é›€éƒ¨ç½²ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. å°† \u0060reviews\u0060 Deployment çš„ \u0060replicas\u0060 å‡å°‘ä¸º 0ï¼›\n2. åˆ›å»ºå¼•ç”¨å…ˆå‰åœ¨ Bookinfo åº”ç”¨ç¨‹åºä¸­éƒ¨ç½²çš„ \u0060reviews\u0060 Deployment çš„ Rolloutï¼›\n3. å°†æµé‡å‘é€åˆ° \u0060reviews\u0060 æœåŠ¡ä»¥å®ç°è‡ªåŠ¨é‡‘ä¸é›€éƒ¨ç½²è¿›åº¦ã€‚\n\næ‚¨å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æœ¬æ¼”ç¤ºä¸­ä½¿ç”¨çš„ Rollout å’Œ AnalysisTemplate é…ç½®ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½² \u0060reivews-rollout\u0060 ï¼š\n\n\u0060\u0060\u0060bash\nargocd app create reviews-rollout --repo https:\/\/github.com\/tetrateio\/tse-gitops-demo.git --path argo\/rollout --dest-server https:\/\/kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated\n\u0060\u0060\u0060\n\næ³¨æ„ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ \u0060argocd\u0060 å‘½ä»¤æ¥éƒ¨ç½²æˆ–ä½¿ç”¨ \u0060kubectl apply\u0060 ã€‚æ¨èä½¿ç”¨ \u0060argocd\u0060 ï¼Œå› ä¸ºæ‚¨å¯ä»¥åŒæ—¶åœ¨ ArgoCD UI å’Œ Argo Rollouts Dashboard ä¸­æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ \u0060argocd\u0060 å‘½ä»¤ç®¡ç†éƒ¨ç½²ã€‚\n\nåœ¨ Argo Rollouts Dashboard ä¸­æŸ¥çœ‹ \u0060reviews\u0060 éƒ¨ç½²çš„çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æµé‡å‘é€åˆ° \u0060reviews\u0060 æœåŠ¡ä¸€æ®µæ—¶é—´ï¼š\n\n\u0060\u0060\u0060bash\nexport GATEWAY_HOSTNAME=$(kubectl -n bookinfo get service tsb-gateway-bookinfo -o jsonpath=\u0027{.status.loadBalancer.ingress[0].hostname}\u0027)\nwhile 1;do curl -H \u0022Host: bookinfo.tetrate.com\u0022 http:\/\/$GATEWAY_HOSTNAME\/api\/v1\/products\/1\/reviews;sleep 3;done\n\u0060\u0060\u0060\n\næ‚¨å°†åœ¨è¾“å‡ºä¸­çœ‹åˆ°æ¥è‡ªå…·æœ‰ä¸åŒ rollouts-pod-template-hash æ ‡ç­¾çš„ pod çš„å“åº”ï¼Œè¿™è¯æ˜é‡‘ä¸é›€éƒ¨ç½²æ˜¯æœ‰æ•ˆçš„ã€‚å¤§çº¦ 10 åˆ†é’Ÿåï¼Œæ‚¨çœ‹åˆ°çš„ Argo Rollouts ä»ªè¡¨æ¿å°†å¦‚å›¾ 5 æ‰€ç¤ºã€‚\n\n![å›¾ 5ï¼šArgo Rollouts ä»ªè¡¨æ¿](f5.png)\n\nä»å›¾ 5 ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡‘ä¸é›€éƒ¨ç½²è¿›å±•é¡ºåˆ©ï¼Œå·²ç»åˆ°äº†ç¬¬ä¸‰æ­¥ã€‚è¿™æ˜¯å› ä¸º \u0060reviews\u0060 æœåŠ¡çš„ \u0060apdex\u0060 ï¼ˆåº”ç”¨æ€§èƒ½æŒ‡æ•°ï¼‰æŒ‡æ ‡æ­£å¸¸ã€‚æ‚¨å¯ä»¥[ä½¿ç”¨ Postman å‘ SkyWalking æäº¤ GraphQL æŸ¥è¯¢](https:\/\/tetrate.io\/blog\/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman\/)æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚\n\n![å›¾ 6ï¼šä½¿ç”¨ Postman å°† GraphQL æŸ¥è¯¢æäº¤åˆ° SkyWalking](f6.png)\n\næˆ‘ä»¬æ„å»ºçš„ GraphQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n\u0060\u0060\u0060graphql\nquery ReadMetricsValues {\n    readMetricsValues(condition: {\n    name: \u0022service_apdex\u0022, entity: {scope: Service, serviceName: \u0022canary|reviews|bookinfo|cluster-1|-\u0022, normal: true}\n  }, duration: {\n    start: \u00222023-07-13 0812\u0022,\n    end: \u00222023-07-13 0813\u0022,\n    step: MINUTE\n  }) {\n        label\n        values {\n            values {\n                id\n                value\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\nè¯¥è¯­å¥ä» UTC \u00602023-07-13 8:12\u0060 åˆ° \u00602023 8:13\u0060 æŸ¥è¯¢ \u0060canary|reviews|bookinfo|cluster-1|-\u0060 æœåŠ¡çš„ \u0060apdex\u0060 æŒ‡æ ‡ï¼ŒæŒç»­ä¸¤åˆ†é’Ÿï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\n\n\u0060\u0060\u0060json\n{\n    \u0022data\u0022: {\n        \u0022readMetricsValues\u0022: {\n            \u0022label\u0022: null,\n            \u0022values\u0022: {\n                \u0022values\u0022: [\n                    {\n                        \u0022id\u0022: \u0022service_apdex_202307130812_Y2FuYXJ5fHJldmlld3N8Ym9va2luZm98Y2x1c3Rlci0xfC0=.1\u0022,\n                        \u0022value\u0022: 10000\n                    },\n                    {\n                        \u0022id\u0022: \u0022service_apdex_202307130813_Y2FuYXJ5fHJldmlld3N8Ym9va2luZm98Y2x1c3Rlci0xfC0=.1\u0022,\n                        \u0022value\u0022: 10000\n                    }\n                ]\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\n\u0060apdex\u0060 æŒ‡æ ‡çš„å€¼å¤§äº 9900ï¼ˆAnalysisTemplate çš„ \u0060successCondition\u0060 ä¸­é…ç½®çš„é˜ˆå€¼ï¼‰ï¼Œå› æ­¤ Rollouts ä¼šé¡ºåˆ©è¿›è¡Œã€‚æ‚¨è¿˜å¯ä»¥åœ¨ Argo Rollouts Dashboard ä¸Šå•å‡»â€œæ‰‹åŠ¨å‡çº§â€æ¥å‡çº§å®ƒï¼Œæˆ–è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n\u0060\u0060\u0060bash\nkubectl argo rollouts promote reviews-rollout -n bookinf\n\u0060\u0060\u0060\n\n## æ¸…ç† {#clean-up}\n\nåˆ é™¤å·²éƒ¨ç½²çš„ ArgoCD åº”ç”¨ç¨‹åºå’Œ Rolloutï¼š\n\n\u0060\u0060\u0060bash\nargocd app delete -y reviews-rollout\nargocd app delete -y bookinfo-tse-conf\nargocd app delete -y bookinfo-app\n\u0060\u0060\u0060\n\n## Argo Rollouts åŸç† {#rollouts-principle}\n\nä¸ Istio é›†æˆæ—¶ï¼ŒArgo Rollouts æ”¯æŒåŸºäº VirtualService å’Œ Subset çš„æµé‡æ‹†åˆ†ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºã€‚\n\n![å›¾ 7ï¼šArgo Rollouts ä½¿ç”¨ Istio è¿›è¡Œæµé‡åˆ†é…](f7.svg)\n\nä¸‹è¡¨æä¾›äº†è¿™ä¸¤ç§æµé‡åˆ†æ®µæ–¹æ³•çš„è¯¦ç»†æ¯”è¾ƒã€‚\n\n| ç±»å‹           | é€‚ç”¨åœºæ™¯                             | èµ„æºå¯¹è±¡                                          | åŸåˆ™                                                         |\n| :------------- | :----------------------------------- | :------------------------------------------------ | :----------------------------------------------------------- |\n| ä¸»æœºçº§æµé‡åˆ†å‰² | é€‚ç”¨äºæ ¹æ®ä¸»æœºåè®¿é—®ä¸åŒç‰ˆæœ¬çš„æœåŠ¡ï¼› | 2 ä¸ªæœåŠ¡ã€1 ä¸ªè™šæ‹ŸæœåŠ¡ã€1 ä¸ªéƒ¨ç½²ï¼›                | Rollout å°† rollouts-pod-template-hash æ ‡ç­¾æ³¨å…¥åˆ° ReplicaSet ä¸­ï¼Œå¹¶é€šè¿‡æ›´æ–° Service ä¸­çš„é€‰æ‹©å™¨æ¥é€‰æ‹©å¸¦æœ‰è¿™äº›æ ‡ç­¾çš„ podï¼› |\n| å­é›†çº§æµé‡åˆ†å‰² | é€‚ç”¨äºæ ¹æ®æ ‡ç­¾è®¿é—®ä¸åŒçš„æœåŠ¡ï¼›       | 1 ä¸ªæœåŠ¡ã€1 ä¸ªè™šæ‹ŸæœåŠ¡ã€1 ä¸ªç›®æ ‡è§„åˆ™å’Œ 1 ä¸ªè½¬å‡ºï¼› | Rollout å°† rollouts-pod-template-hash æ ‡ç­¾æ³¨å…¥åˆ° ReplicaSet ä¸­ï¼Œå¹¶é€šè¿‡æ›´æ–° DestinationRule ä¸­çš„é€‰æ‹©å™¨æ¥é€‰æ‹©å…·æœ‰è¿™äº›æ ‡ç­¾çš„ podï¼› |\n\næœ¬æ¼”ç¤ºä¸­ä½¿ç”¨åŸºäºå­é›†çš„æµé‡åˆ†å‰²ï¼ŒArgo ä¸æ–­æ¨å‡ºï¼š\n\n- ä¿®æ”¹ VirtualService \u0060spec.http[].route[].weight\u0060 ä»¥åŒ¹é…å½“å‰æ‰€éœ€çš„é‡‘ä¸é›€æƒé‡\n- ä¿®æ”¹ DestinationRule \u0060spec.subsets[].labels\u0060 ä»¥åŒ…å« canary å’Œç¨³å®š ReplicaSet çš„ \u0060rollouts-pod-template-hash\u0060 æ ‡ç­¾\n\nè¯·è®¿é—® [Argo Rollouts æ–‡æ¡£](https:\/\/argo-rollouts.readthedocs.io\/en\/stable\/features\/traffic-management\/istio\/)ï¼Œäº†è§£æœ‰å…³ä½¿ç”¨ Istio è¿›è¡Œæµé‡ç®¡ç†çš„è¯¦ç»†ä¿¡æ¯ã€‚\n\n## æ€»ç»“ {#summary}\n\næœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Argo é¡¹ç›®å’Œ Istio å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ ArgoCD å®ç° GitOpsï¼Œç„¶åä½¿ç”¨ Argo Rollout å’Œ SkyWalking å®ç°è‡ªåŠ¨åŒ–é‡‘ä¸é›€å‘å¸ƒã€‚ä» demo ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° TSE éƒ¨ç½²çš„ Istio ä¸å¼€æºç‰ˆæœ¬å®Œå…¨å…¼å®¹ã€‚TSE æœ‰è®¸å¤šåŠŸèƒ½å€¼å¾—æ¢ç´¢ï¼Œè¯·è®¿é—® [Tetrate ç½‘ç«™](https:\/\/tetrate.io\/tetrate-service-express\/)äº†è§£æ›´å¤šä¿¡æ¯ã€‚\n', '\/blog\/implementing-gitops-and-canary-deployment-with-argo-project-and-istio\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡è®¨è®ºå¦‚ä½•ä½¿ç”¨ Kubernetes Deploymentã€Argo é¡¹ç›®å’Œ Istio æ¥å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/">å¦‚ä½•ä½¿ç”¨ GraphQL å’Œ Postman æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/07/20</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('å¦‚ä½•ä½¿ç”¨ GraphQL å’Œ Postman æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®', 'æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚å®ƒé¦–å…ˆä»‹ç»äº† GraphQL å’Œ SkyWalkingï¼Œç„¶åä»‹ç»äº†å¦‚ä½•è®¾ç½® Postman å‘é€ GraphQL æŸ¥è¯¢ï¼Œæœ€åæä¾›äº†ä¸€äº›ç¤ºä¾‹ GraphQL æŸ¥è¯¢ï¼Œå¯ç”¨äºä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚', '\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ [GraphQL ä¸](https:\/\/graphql.org\/)[Postman](https:\/\/www.postman.com\/) ä¸€èµ·ä» [SkyWalking](https:\/\/skywalking.apache.org\/) æŸ¥è¯¢æ•°æ®ã€‚å®ƒåŒ…æ‹¬è·å–ä¸è®°åä»¤ç‰Œã€æ„å»ºæŸ¥è¯¢ä»¥æ£€ç´¢ç‰¹å®šæœåŠ¡çš„è´Ÿè½½æŒ‡æ ‡ä»¥åŠä½¿ç”¨ GraphQL è‡ªçœæ¥æŸ¥çœ‹ SkyWalking GraphQL API æ¶æ„çš„æ­¥éª¤ã€‚æœ¬æ–‡è¿˜æä¾›äº†æ›´å¤šä¿¡æ¯çš„å‚è€ƒã€‚\n\n## ä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ\n\nGraphQL æ˜¯ Facebook å¼€å‘çš„ä¸€ç§ API æŸ¥è¯¢è¯­è¨€å’Œè¿è¡Œæ—¶ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯å‡†ç¡®æŒ‡å®šä»–ä»¬éœ€è¦çš„æ•°æ®å¹¶ä»…æ¥æ”¶è¯¥æ•°æ®ä½œä¸ºå“åº”ï¼Œä»è€Œä¸ºä¼ ç»Ÿ REST API æä¾›äº†æ›´é«˜æ•ˆã€æ›´å¼ºå¤§ã€æ›´çµæ´»çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä½¿ç”¨ GraphQLï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨å•ä¸ªè¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ªèµ„æºï¼Œä»è€Œå‡å°‘ä¸æœåŠ¡å™¨çš„å¾€è¿”æ¬¡æ•°å¹¶æé«˜æ€§èƒ½ã€‚\n\n## GraphQL å’Œ REST API ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\nGraphQL å…è®¸å®¢æˆ·ç«¯ä»…è¯·æ±‚ä»–ä»¬éœ€è¦çš„æ•°æ®ï¼Œè€Œ REST API è¦æ±‚å®¢æˆ·ç«¯æ£€ç´¢èµ„æºä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œæ— è®ºä»–ä»¬æ˜¯å¦éœ€è¦ã€‚æ­¤å¤–ï¼ŒGraphQL å…è®¸å®¢æˆ·ç«¯åœ¨å•ä¸ªè¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ªèµ„æºï¼Œè¿™ä½¿å…¶æ¯” REST API æ›´é«˜æ•ˆã€æ›´ç®€æ´ã€‚\n\n## å¦‚ä½•æŸ¥è¯¢ SkyWalking æ•°æ®ï¼Ÿ\n\nSkyWalking å®šä¹‰äº†æŸ¥è¯¢é˜¶æ®µçš„é€šä¿¡åè®®ã€‚SkyWalking åŸç”Ÿ UI å’Œ CLI ä½¿ç”¨æ­¤åè®®ä»åç«¯æŒç»­è·å–æ•°æ®ï¼Œæ— éœ€æ‹…å¿ƒåç«¯æ›´æ–°ã€‚\n\nä» SkyWalking æŸ¥è¯¢æŒ‡æ ‡æœ‰ä¸¤ç§æ–¹æ³•ï¼š\n\n1. [GraphQL API](https:\/\/skywalking.apache.org\/docs\/main\/v9.4.0\/en\/api\/query-protocol\/)\n2. [PromQL API](https:\/\/skywalking.apache.org\/docs\/main\/v9.4.0\/en\/api\/promql-service\/)\n\næœ¬æ–‡æä¾›äº†æœ‰å…³å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢æŒ‡æ ‡çš„æŒ‡å—ã€‚å¦‚æœä½ å¯¹ PromQL API æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚é˜…æ–‡ç« [ä¸º Apache SkyWalking æ„å»º Grafana Dashboard - åŸç”Ÿ PromQL æ”¯æŒ](https:\/\/skywalking.apache.org\/zh\/2023-03-17-build-grafana-dashboards-for-apache-skywalking-native-promql-support\/) ã€‚ç»§ç»­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤éœ€è¦å®‰è£… TSBã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œä½†ä»æƒ³ä½“éªŒä½¿ç”¨ GraphQL åœ¨ SkyWalking ä¸­æŸ¥è¯¢æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ SkyWalking æä¾›çš„å…è´¹[æ¼”ç¤ºç¯å¢ƒ](https:\/\/skywalking.apache.org\/)ï¼ˆç”¨æˆ·å \/ å¯†ç ï¼šskywalking\/skywalkingï¼‰ã€‚ç™»å½•æ¼”ç¤ºç½‘ç«™å¹¶è·å–æŸ¥è¯¢ä»¤ç‰Œã€‚GraphQL æŸ¥è¯¢çš„ç«¯ç‚¹åœ°å€æ˜¯ \u003chttp:\/\/demo.skywalking.apache.org\/graphql\u003e ã€‚æ„é€ æŸ¥è¯¢çš„æ­¥éª¤ä¸ä¸‹é¢æè¿°çš„ç›¸åŒã€‚\n\n## è§‚å¯Ÿ TSB ä¸­çš„ GraphQL æŸ¥è¯¢\n\nåœ¨æˆ‘ä»¬ä½¿ç”¨ Postman æ„å»ºè‡ªå·±çš„ GraphQL æŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè§‚å¯Ÿ TSB å¦‚ä½•ä» SkyWalking è·å–æ•°æ®ã€‚\n\n1. æ‰“å¼€ Chrome DevTools å¹¶åˆ‡æ¢åˆ°â€œNetworkâ€é€‰é¡¹å¡ã€‚\n2. è®¿é—®ç½‘ç«™ä¸Šçš„**Organization - Services** é€‰é¡¹å¡ã€‚\n\nè§‚å¯Ÿç½‘ç»œè¯·æ±‚åˆ—è¡¨å¹¶å³é”®å•å‡»å…¶ä¸­ä¸€ä¸ª graphql è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![å›¾ 1ï¼šChrome DevTool](f1.jpg)\n\nä½ çœ‹åˆ°çš„ curl å‘½ä»¤å°†å¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä½ å°†ä» SkyWalking ä¸­è·å– TSB ç®¡ç†çš„æœåŠ¡åˆ—è¡¨ã€‚\n\n\u0060\u0060\u0060bash\ncurl \u0027\u003chttps:\/\/saturn.tetrate.work\/ui\/graphql\u003e\u0027 \\\\\n  -H \u0027Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7,zh-TW;q=0.6\u0027 \\\\\n  -H \u0027Cache-Control: no-cache\u0027 \\\\\n  -H \u0027Client-Timestamp: 1686104776136\u0027 \\\\\n  -H \u0027Connection: keep-alive\u0027 \\\\\n  -H \u0027Content-Type: application\/json\u0027 \\\\\n  -H \u0027Cookie: ...\u0027 \\\\\n  -H \u0027Origin: \u003chttps:\/\/saturn.tetrate.work\u003e\u0027 \\\\\n  -H \u0027Pragma: no-cache\u0027 \\\\\n  -H \u0027Referer: \u003chttps:\/\/saturn.tetrate.work\/mp\/services\u003e\u0027 \\\\\n  -H \u0027Request-Id: ...\u0027 \\\\\n  -H \u0027Sec-Fetch-Dest: empty\u0027 \\\\\n  -H \u0027Sec-Fetch-Mode: cors\u0027 \\\\\n  -H \u0027Sec-Fetch-Site: same-origin\u0027 \\\\\n  -H \u0027User-Agent: Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/114.0.0.0 Safari\/537.36\u0027 \\\\\n  -H \u0027X-Bridge-Csrf-Token: IOmJszLAqY3TRIUNhTuGu7vQgnfQY1FtgYFm\u002bl\/\u002bMu4EmVQU5T8EaQ7bngkCv4hQ12ZGids\u002bI21pHMdepE9\/qQ==\u0027 \\\\\n  -H \u0027X-Csrf-Token: xTbxZerD3t8N3PaS7nbjKCfxk1Q9dtvvrx4D\u002bIJohHicb0VfB4iAZaP0zh1eXDWctQyCYZWaKLhAYT3M6Drk3A==\u0027 \\\\\n  -H \u0027accept: application\/json\u0027 \\\\\n  -H \u0027sec-ch-ua: \u0022Not.A\/Brand\u0022;v=\u00228\u0022, \u0022Chromium\u0022;v=\u0022114\u0022, \u0022Google Chrome\u0022;v=\u0022114\u0022\u0027 \\\\\n  -H \u0027sec-ch-ua-mobile: ?0\u0027 \\\\\n  -H \u0027sec-ch-ua-platform: \u0022macOS\u0022\u0027 \\\\\n  --data-raw $\u0027{\u0022query\u0022:\u0022query ServiceRegistryListMetrics(...)}\u0027 \\\\\n  --compressed\n\u0060\u0060\u0060\n\n**æ³¨æ„ï¼š** *ä¸Šä¾‹ä¸­çš„æŸäº›å­—æ®µå¤ªé•¿ï¼Œç”¨ç‚¹ (...) æ›¿æ¢*ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘å°†æŒ‡å¯¼ä½ æ„å»ºä¸€ä¸ªæŸ¥è¯¢æ¥æ£€ç´¢ç‰¹å®šæœåŠ¡çš„è´Ÿè½½æŒ‡æ ‡ã€‚\n\n## è·å– Bearer Token\n\né¦–å…ˆï¼Œä½ éœ€è¦è·å–ç½‘ç«™çš„ Bearer Tokenã€‚ç™»å½•åˆ° TSB UIï¼Œç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·æŒ‰é’®ï¼Œç„¶åç‚¹å‡»â€œShow token informationâ€ã€‚åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œä½ å°†çœ‹åˆ° Bearer Tokenï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![å›¾ 2ï¼šä» TSB UI è·å– Bear Token](f2.jpg)\n\næ³¨æ„ï¼šBearer token çš„æœ‰æ•ˆæœŸæ¯”è¾ƒçŸ­ã€‚å½“å®ƒè¿‡æœŸæ—¶ï¼Œä½ éœ€è¦é‡æ–°ç™»å½• TSB ä»¥è·å–æ–°çš„ tokenã€‚\n\næˆ‘ä»¬å·²ç»é¢„å…ˆéƒ¨ç½²äº†[bookinfo åº”ç”¨ç¨‹åº](https:\/\/istio.io\/latest\/docs\/examples\/bookinfo\/)å¹¶å‘é€äº†ä¸€äº›æµ‹è¯•æµé‡ã€‚è¦åœ¨ Postman å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ GraphQL æŸ¥è¯¢\u0060reviews\u0060çš„è´Ÿè½½æŒ‡æ ‡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. åˆ›å»ºä¸€ä¸ªæ–°çš„ GraphQL è¯·æ±‚ï¼Œå¹¶è¾“å…¥è¯·æ±‚ URLï¼š\u0060$TSB_ADDRESS\/graphql\u0060\n2. æ·»åŠ å¸¦æœ‰å€¼\u0060Bearer $TOKEN\u0060çš„\u0060Authorization\u0060å¤´\n3. ä½¿ç”¨ GraphQL Introspection æŸ¥çœ‹ SkyWalking GraphQL APIs çš„æ¨¡å¼ã€‚æŸ¥æ‰¾å¹¶å•å‡»\u0060readMetricsValues\u0060é¡¹ã€‚ä½ å°†åœ¨å³ä¾§çœ‹åˆ°å˜é‡ã€‚å¡«å†™\u0060condition\u0060å’Œ\u0060duration\u0060é¡¹ç›®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![å›¾ 3ï¼šPostman æŸ¥è¯¢](f3.jpg)\n\nå˜é‡å¦‚ä¸‹ï¼š\n\n\u0060\u0060\u0060graphql\nquery ReadMetricsValues {\n    readMetricsValues(condition: {\n    name: \u0022service_cpm\u0022, entity: {scope: Service, serviceName: \u0022reviews\u0022, normal: true}\n  }, duration: {\n    start: \u00222023-06-05 0625\u0022,\n    end: \u00222023-06-05 0627\u0022,\n    step: MINUTE\n  }) {\n        label\n        values {\n            values {\n                id\n                value\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\nå•å‡» Query æŒ‰é’®ä»¥è·å–ç»“æœã€‚å®ƒåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š\n\n\u0060\u0060\u0060json\n{\n    \u0022data\u0022: {\n        \u0022readMetricsValues\u0022: {\n            \u0022label\u0022: null,\n            \u0022values\u0022: {\n                \u0022values\u0022: [\n                    {\n                        \u0022id\u0022: \u0022service_cpm_202306050625_cmV2aWV3cw==.1\u0022,\n                        \u0022value\u0022: 0\n                    },\n                    {\n                        \u0022id\u0022: \u0022service_cpm_202306050626_cmV2aWV3cw==.1\u0022,\n                        \u0022value\u0022: 0\n                    },\n                    {\n                        \u0022id\u0022: \u0022service_cpm_202306050627_cmV2aWV3cw==.1\u0022,\n                        \u0022value\u0022: 0\n                    }\n                ]\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\nä»¥ä¸Šæ˜¯ä½¿ç”¨ SkyWalking Demo ç¯å¢ƒæµ‹è¯• GraphQL æŸ¥è¯¢ã€‚TSE ä¹Ÿæ”¯æŒ GraphQL æŸ¥è¯¢ï¼Œå¹¶ä¸”ç«¯ç‚¹åœ°å€ä¸º\u0060$TSB_SERVER\/graphql\u0060ã€‚\n\næ³¨æ„ï¼šæ­¤å¤„çš„æŸ¥è¯¢ç«¯ç‚¹ä¸ DevTool ä¸­çœ‹åˆ°çš„ä¸åŒã€‚TSB UI ç‰¹å®šçš„ GraphQL æŸ¥è¯¢ç«¯ç‚¹æ˜¯\u0060$TSB_SERVER\/ui\/graphql\u0060ã€‚\n\næœ‰å…³ SkyWalking GraphQL æŸ¥è¯¢åè®®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[GitHub](https:\/\/github.com\/apache\/skywalking-query-protocol\/tree\/master)ã€‚\n\n## æ€»ç»“\n\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•åœ¨ Postman ä¸­ä½¿ç”¨ GraphQL æŸ¥è¯¢åè®®æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®ã€‚ä½ å¯ä»¥æ ¹æ® SkyWalking çš„ GraphQL æ¨¡å¼æ„å»ºè‡ªå·±çš„æŸ¥è¯¢æ¡ä»¶ã€‚TSB \/ TSE ä¸­ä¹Ÿæä¾›äº†æ­¤åŠŸèƒ½ã€‚\n', '\/blog\/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚å®ƒé¦–å…ˆä»‹ç»äº† GraphQL å’Œ SkyWalkingï¼Œç„¶åä»‹ç»äº†å¦‚ä½•è®¾ç½® Postman å‘é€ GraphQL æŸ¥è¯¢ï¼Œæœ€åæä¾›äº†ä¸€äº›ç¤ºä¾‹ GraphQL æŸ¥è¯¢ï¼Œå¯ç”¨äºä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/distributed-tracing-with-skywalking-in-istio/">å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ SkyWalking è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼Ÿ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2022/12/07</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ SkyWalking è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼Ÿ', 'æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åœ¨äº‘åŸç”Ÿåº”ç”¨ä¸­åˆ†å¸ƒå¼è¿½è¸ªçš„ç›¸å…³å†…å®¹ï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼è¿½è¸ªåŸºç¡€ã€Istio å®ç°åˆ†å¸ƒå¼è¿½è¸ªçš„æ–¹å¼ã€åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿçš„é€‰æ‹©ã€ä»¥ Bookinfo å’Œ SkyWalking ä¸ºä¾‹çš„å®éªŒä»¥åŠæ€»ç»“å’Œå‚è€ƒã€‚', '\nåœ¨äº‘åŸç”Ÿåº”ç”¨ä¸­ï¼Œä¸€æ¬¡è¯·æ±‚å¾€å¾€éœ€è¦ç»è¿‡ä¸€ç³»åˆ—çš„ API æˆ–åå°æœåŠ¡å¤„ç†æ‰èƒ½å®Œæˆï¼Œè¿™äº›æœåŠ¡æœ‰äº›æ˜¯å¹¶è¡Œçš„ï¼Œæœ‰äº›æ˜¯ä¸²è¡Œçš„ï¼Œè€Œä¸”ä½äºä¸åŒçš„å¹³å°æˆ–èŠ‚ç‚¹ã€‚é‚£ä¹ˆå¦‚ä½•ç¡®å®šä¸€æ¬¡è°ƒç”¨çš„ç»è¿‡çš„æœåŠ¡è·¯å¾„å’ŒèŠ‚ç‚¹ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œé—®é¢˜æ’æŸ¥ï¼Ÿè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ°åˆ†å¸ƒå¼è¿½è¸ªã€‚\n\næœ¬æ–‡å°†å‘ä½ ä»‹ç»ï¼š\n\n- åˆ†å¸ƒå¼è¿½è¸ªçš„åŸç†\n- å¦‚ä½•é€‰æ‹©åˆ†å¸ƒå¼è¿½è¸ªè½¯ä»¶\n- åœ¨ Istio ä¸­å¦‚ä½•ä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ª\n- ä»¥ Bookinfo å’Œ SkyWalking ä¸ºä¾‹è¯´æ˜å¦‚ä½•æŸ¥çœ‹åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®\n\n## åˆ†å¸ƒå¼è¿½è¸ªåŸºç¡€ {#tracing-basic}\n\nåˆ†å¸ƒå¼è¿½è¸ªæ˜¯ä¸€ç§ç”¨æ¥è·Ÿè¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¯·æ±‚çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£ã€æ§åˆ¶å’Œä¼˜åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿã€‚åˆ†å¸ƒå¼è¿½è¸ªä¸­ç”¨åˆ°äº†ä¸¤ä¸ªæ¦‚å¿µï¼šTraceID å’Œ SpanIDã€‚\n\n- TraceID æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªè¯·æ±‚çš„è¿½è¸ªä¿¡æ¯ã€‚ä¸€ä¸ªè¯·æ±‚çš„æ‰€æœ‰è¿½è¸ªä¿¡æ¯éƒ½å±äºåŒä¸€ä¸ª TraceIDï¼ŒTraceID åœ¨æ•´ä¸ªè¯·æ±‚çš„è¿½è¸ªè¿‡ç¨‹ä¸­éƒ½æ˜¯ä¸å˜çš„ï¼›\n\n- SpanID æ˜¯ä¸€ä¸ªå±€éƒ¨å”¯ä¸€çš„ IDï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªè¯·æ±‚åœ¨æŸä¸€æ—¶åˆ»çš„è¿½è¸ªä¿¡æ¯ã€‚ä¸€ä¸ªè¯·æ±‚åœ¨ä¸åŒçš„æ—¶é—´æ®µä¼šäº§ç”Ÿä¸åŒçš„ SpanIDï¼ŒSpanID ç”¨æ¥åŒºåˆ†ä¸€ä¸ªè¯·æ±‚åœ¨ä¸åŒæ—¶é—´æ®µçš„è¿½è¸ªä¿¡æ¯ï¼›\n\nTraceID å’Œ SpanID æ˜¯åˆ†å¸ƒå¼è¿½è¸ªçš„åŸºç¡€ï¼Œå®ƒä»¬ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¯·æ±‚çš„è¿½è¸ªæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ ‡è¯†ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥è¯¢ã€ç®¡ç†å’Œåˆ†æè¯·æ±‚çš„è¿½è¸ªä¿¡æ¯ã€‚\n\n![åˆ†å¸ƒå¼è¿½è¸ªåŸç†å›¾](basic.svg)\n\nä¸‹é¢æ˜¯åˆ†å¸ƒå¼è¿½è¸ªçš„è¿‡ç¨‹ï¼š\n\n1. å½“ä¸€ä¸ªç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¼šä¸ºè¯¥è¯·æ±‚åˆ†é…ä¸€ä¸ª TraceIDï¼Œç”¨äºä¸²è”èµ·æ•´ä¸ªè°ƒç”¨é“¾ï¼›\n2. åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¼šä¸ºè¯¥è¯·æ±‚åœ¨ç³»ç»Ÿå†…çš„æ¯ä¸€æ¬¡æœåŠ¡è°ƒç”¨ç”Ÿæˆä¸€ä¸ª SpanID å’Œ ParentIDï¼Œç”¨äºè®°å½•è°ƒç”¨çš„çˆ¶å­å…³ç³»ï¼Œæ²¡æœ‰ ParentID çš„ Span å°†ä½œä¸ºè°ƒç”¨é“¾çš„å…¥å£ï¼›\n3. æ¯ä¸ªæœåŠ¡è°ƒç”¨è¿‡ç¨‹ä¸­éƒ½è¦ä¼ é€’ TraceID å’Œ SpanIDï¼›\n4. åœ¨æŸ¥çœ‹åˆ†å¸ƒå¼è¿½è¸ªæ—¶ï¼Œé€šè¿‡ TraceID æŸ¥è¯¢æŸæ¬¡è¯·æ±‚çš„å…¨è¿‡ç¨‹ï¼›\n\n## Istio å¦‚ä½•å®ç°åˆ†å¸ƒå¼è¿½è¸ª {#distributed-tracing-in-istio}\n\nIstio ä¸­çš„åˆ†å¸ƒå¼è¿½è¸ªæ˜¯åŸºäºæ•°æ®å¹³é¢ä¸­çš„ Envoy ä»£ç†å®ç°çš„ã€‚æœåŠ¡è¯·æ±‚åœ¨è¢«åŠ«æŒåˆ° Envoy ä¸­åï¼ŒEnvoy åœ¨è½¬å‘è¯·æ±‚æ—¶ä¼šé™„åŠ å¤§é‡ Headerï¼Œå…¶ä¸­ä¸åˆ†å¸ƒå¼è¿½è¸ªç›¸å…³çš„æœ‰ï¼š\n\n- ä½œä¸º TraceIDï¼š\u0060x-request-id\u0060\n- ç”¨äºåœ¨ LightStep è¿½è¸ªç³»ç»Ÿä¸­å»ºç«‹ Span çš„çˆ¶å­å…³ç³»ï¼š\u0060x-ot-span-context\u0060\n- ç”¨äº Zipkinï¼ŒåŒæ—¶é€‚ç”¨äº Jaegerã€SkyWalkingï¼Œè¯¦è§ [b3-propagation](https:\/\/github.com\/openzipkin\/b3-propagation)ï¼š\n  - \u0060x-b3-traceid\u0060\n  - \u0060x-b3-spanid\u0060\n  - \u0060x-b3-parentspanid\u0060\n  - \u0060x-b3-sampled\u0060\n  - \u0060x-b3-flags\u0060\n  - \u0060b3\u0060\n- ç”¨äº Datadogï¼š\n  - \u0060x-datadog-trace-id\u0060\n  - \u0060x-datadog-parent-id\u0060\n  - \u0060x-datadog-sampling-priority\u0060\n- ç”¨äº SkyWalkingï¼š\u0060sw8\u0060\n- ç”¨äº AWS X-Rayï¼š\u0060x-amzn-trace-id\u0060\n\nå…³äºè¿™äº› Header çš„è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ [Envoy æ–‡æ¡£](https:\/\/www.envoyproxy.io\/docs\/envoy\/latest\/configuration\/http\/http_conn_man\/headers)ã€‚\n\nEnvoy ä¼šåœ¨ Ingress Gateway ä¸­ä¸ºä½ äº§ç”Ÿç”¨äºè¿½è¸ªçš„ Headerï¼Œä¸è®ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨ä½•ç§è¯­è¨€å¼€å‘ï¼ŒEnvoy éƒ½ä¼šå°†è¿™äº› Header è½¬å‘åˆ°ä¸Šæ¸¸é›†ç¾¤ã€‚ä½†æ˜¯ï¼Œä½ è¿˜è¦å¯¹åº”ç”¨ç¨‹åºä»£ç åšä¸€äº›å°çš„ä¿®æ”¹ï¼Œæ‰èƒ½ä¸ºä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ªåŠŸèƒ½ã€‚è¿™æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºæ— æ³•è‡ªåŠ¨ä¼ æ’­è¿™äº› Headerï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­é›†æˆåˆ†å¸ƒå¼è¿½è¸ªçš„ Agentï¼Œæˆ–è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨ä¼ æ’­è¿™äº› Headerã€‚Envoy ä¼šå°†è¿½è¸ªæ•°æ®å‘é€åˆ° tracer åç«¯å¤„ç†ï¼Œç„¶åå°±å¯ä»¥åœ¨ UI ä¸­æŸ¥çœ‹è¿½è¸ªæ•°æ®äº†ã€‚\n\nä¾‹å¦‚åœ¨ Bookinfo åº”ç”¨ä¸­çš„ Productpage æœåŠ¡ï¼Œå¦‚æœä½ æŸ¥çœ‹å®ƒçš„ä»£ç å¯ä»¥å‘ç°ï¼Œå…¶ä¸­é›†æˆäº† Jaeger å®¢æˆ·ç«¯åº“ï¼Œå¹¶åœ¨ \u0060getForwardHeaders (request)\u0060 æ–¹æ³•ä¸­å°† Envoy ç”Ÿæˆçš„ Header åŒæ­¥ç»™å¯¹ Details å’Œ Reviews æœåŠ¡çš„ HTTP è¯·æ±‚ï¼š\n\n\u0060\u0060\u0060python\ndef getForwardHeaders(request):\n    headers = {}\n\n    # ä½¿ç”¨ Jaeger agent è·å– x-b3-* header\n    span = get_current_span()\n    carrier = {}\n    tracer.inject(\n        span_context=span.context,\n        format=Format.HTTP_HEADERS,\n        carrier=carrier)\n\n    headers.update(carrier)\n\n    # æ‰‹åŠ¨å¤„ç†é x-b3-* header\n    if \u0027user\u0027 in session:\n        headers[\u0027end-user\u0027] = session[\u0027user\u0027]\n    incoming_headers = [\n        \u0027x-request-id\u0027,\n        \u0027x-ot-span-context\u0027,\n        \u0027x-datadog-trace-id\u0027,\n        \u0027x-datadog-parent-id\u0027,\n        \u0027x-datadog-sampling-priority\u0027,\n        \u0027traceparent\u0027,\n        \u0027tracestate\u0027,\n        \u0027x-cloud-trace-context\u0027,\n        \u0027grpc-trace-bin\u0027,\n        \u0027sw8\u0027,\n        \u0027user-agent\u0027,\n        \u0027cookie\u0027,\n        \u0027authorization\u0027,\n        \u0027jwt\u0027,\n    ]\n\n    for ihdr in incoming_headers:\n        val = request.headers.get(ihdr)\n        if val is not None:\n            headers[ihdr] = val\n\n    return headers\n\u0060\u0060\u0060\n\nå…³äº Istio ä¸­åˆ†å¸ƒå¼è¿½è¸ªçš„å¸¸è§é—®é¢˜è¯·è§ [Istio æ–‡æ¡£](https:\/\/istio.io\/latest\/zh\/about\/faq\/#distributed-tracing)ã€‚\n\n## åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿå¦‚ä½•é€‰æ‹© {#how-to-choose-a-distributed-tracing-system}\n\nåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿçš„åŸç†ç±»ä¼¼ï¼Œå¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šè¿™æ ·çš„ç³»ç»Ÿï¼Œä¾‹å¦‚ [Apache SkyWalking](https:\/\/github.com\/apache\/skywalking)ã€[Jaeger](https:\/\/github.com\/jaegertracing\/jaeger)ã€[Zipkin](https:\/\/github.com\/openzipkin\/zipkin\/)ã€LightStepã€[Pinpoint](https:\/\/github.com\/pinpoint-apm\/pinpoint) ç­‰ã€‚æˆ‘ä»¬å°†é€‰æ‹©å…¶ä¸­ä¸‰ä¸ªï¼Œä»å¤šä¸ªç»´åº¦è¿›è¡Œå¯¹æ¯”ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©å®ƒä»¬æ˜¯å› ä¸ºï¼š\n\n- å®ƒä»¬æ˜¯å½“å‰æœ€æµè¡Œçš„å¼€æºåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼›\n- éƒ½æ˜¯åŸºäº OpenTracing è§„èŒƒï¼›\n- éƒ½æ”¯æŒä¸ Istio åŠ Envoy é›†æˆï¼›\n\n{{\u003ctable \u0022åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿå¯¹æ¯”è¡¨ï¼ˆæ•°æ®æˆªæ­¢æ—¶é—´ 2022-12-07ï¼‰\u0022\u003e}}\n| ç±»åˆ«      | Apache SkyWalking                                            | Jaeger                                       | Zipkin                                       |\n| --------- | ------------------------------------------------------------ | -------------------------------------------- | -------------------------------------------- |\n| å®ç°æ–¹å¼  | åŸºäºè¯­è¨€çš„æ¢é’ˆã€æœåŠ¡ç½‘æ ¼æ¢é’ˆã€eBPF agentã€ç¬¬ä¸‰æ–¹æŒ‡æ ‡åº“ï¼ˆå½“å‰æ”¯æŒ Zipkinï¼‰ | åŸºäºè¯­è¨€çš„æ¢é’ˆ                               | åŸºäºè¯­è¨€çš„æ¢é’ˆ                               |\n| æ•°æ®å­˜å‚¨  | ESã€H2ã€MySQLã€TiDBã€Sharding-sphereã€BanyanDB               | ESã€MySQLã€Cassandraã€å†…å­˜                   | ESã€MySQLã€Cassandraã€å†…å­˜                   |\n| æ”¯æŒè¯­è¨€  | Javaã€Rustã€PHPã€NodeJSã€Goã€Pythonã€C\u002b\u002bã€.NETã€Lua          | Javaã€Goã€Pythonã€NodeJSã€C#ã€PHPã€Rubyã€C\u002b\u002b | Javaã€Goã€Pythonã€NodeJSã€C#ã€PHPã€Rubyã€C\u002b\u002b |\n| å‘èµ·è€…    | ä¸ªäºº                                                         | Uber                                         | Twitter                                      |\n| æ²»ç†æ–¹å¼  | Apache Foundation                                            | CNCF                                         | CNCF                                         |\n| ç‰ˆæœ¬      | 9.3.0                                                        | 1.39.0                                       | 2.23.19                                      |\n| Star æ•°é‡ | 20.9k                                                        | 16.8k                                        | 15.8k                                        |\n\n{{\u003c\/table\u003e}}\n\nè™½ç„¶ Apache SkyWalking çš„ Agent æ”¯æŒçš„è¯­è¨€æ²¡æœ‰ Jaeger å’Œ Zipkin å¤šï¼Œä½†æ˜¯ SkyWalking çš„å®ç°æ–¹å¼æ›´ä¸°å¯Œï¼Œå¹¶ä¸”ä¸ Jaegerã€Zipkin çš„è¿½è¸ªæ•°æ®å…¼å®¹ï¼Œå¼€å‘æ›´ä¸ºæ´»è·ƒï¼Œä¸”ä¸ºå›½äººå¼€å‘ï¼Œä¸­æ–‡èµ„æ–™ä¸°å¯Œï¼Œæ˜¯æ„å»ºé¥æµ‹å¹³å°çš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€ã€‚\n\n## å®éªŒ {#demo}\n\nå‚è€ƒ [Istio æ–‡æ¡£](https:\/\/istio.io\/latest\/docs\/tasks\/observability\/distributed-tracing\/skywalking\/)æ¥å®‰è£…å’Œé…ç½® Apache SkyWalkingã€‚\n\n### ç¯å¢ƒè¯´æ˜ {#environments}\n\nä»¥ä¸‹æ˜¯æˆ‘ä»¬å®éªŒçš„ç¯å¢ƒï¼š\n\n- Kubernetes 1.24.5\n- Istio 1.16\n- SkyWalking 9.1.0\n\n### å®‰è£… Istio {#install-istio}\n\nå®‰è£…ä¹‹å‰å¯ä»¥å…ˆæ£€æŸ¥ä¸‹ç¯å¢ƒæ˜¯å¦æœ‰é—®é¢˜ï¼š\n\n\u0060\u0060\u0060bash\n$ istioctl experimental precheck\nâœ” No issues found when checking the cluster. Istio is safe to install or upgrade!\n  To get started, check out https:\/\/istio.io\/latest\/docs\/setup\/getting-started\/\n\u0060\u0060\u0060\n\nç„¶åä½¿ç”¨ \u0060istioctl\u0060 å®‰è£… Istio åŒæ—¶é…ç½®å‘é€è¿½è¸ªä¿¡æ¯çš„ç›®çš„åœ°ä¸º SkyWalkingï¼š\n\n\u0060\u0060\u0060bash\n# å°†å®‰è£…é…ç½®ä¿å­˜åˆ°æ–‡ä»¶ä¸­\ncat\u003c\u003cEOF\u003eistio-install.yaml\napiVersion: install.istio.io\/v1alpha1\nkind: IstioOperator\nmetadata:\n  namespace: istio-system\n  name: istio-with-skywalking\nspec:\n  meshConfig:\n    defaultProviders:\n      tracing:\n      - \u0022skywalking\u0022\n    enableTracing: true\n    extensionProviders:\n    - name: \u0022skywalking\u0022\n      skywalking:\n        service: tracing.istio-system.svc.cluster.local\n        port: 11800\nEOF\n\n# ä½¿ç”¨ istioctl å®‰è£… Istio\nistioctl install -f istio-install.yaml\n\u0060\u0060\u0060\n\n### éƒ¨ç½² Apache SkyWalking {#install-skywalking}\n\nIstio 1.16 æ”¯æŒä½¿ç”¨ Apache SkyWalking è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç å®‰è£… SkyWalkingï¼š\n\n\u0060\u0060\u0060bash\nkubectl apply -f https:\/\/raw.githubusercontent.com\/istio\/istio\/master\/samples\/addons\/extras\/skywalking.yaml\n\u0060\u0060\u0060\n\nå®ƒå°†åœ¨ \u0060istio-system\u0060 å‘½åç©ºé—´ä¸‹å®‰è£…ï¼š\n\n- SkyWalking OAP (Observability Analysis Platform) ï¼šç”¨äºæ¥æ”¶è¿½è¸ªæ•°æ®ï¼Œæ”¯æŒ SkyWalking åŸç”Ÿæ•°æ®æ ¼å¼ï¼ŒZipkin v1 å’Œ v2 ä»¥åŠ Jaeger æ ¼å¼ã€‚\n- UIï¼šç”¨äºæŸ¥è¯¢åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®ã€‚\n\nå…³äº SkyWalking çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ SkyWalking æ–‡æ¡£ã€‚\n\n### éƒ¨ç½² Bookinfo åº”ç”¨ {#install-bookinfo}\n\næ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… bookinfo ç¤ºä¾‹ï¼š\n\n\u0060\u0060\u0060bash\nkubectl label namespace default istio-injection=enabled\nkubectl apply -f samples\/bookinfo\/platform\/kube\/bookinfo.yaml\nkubectl apply -f samples\/bookinfo\/networking\/bookinfo-gateway.yaml\n\u0060\u0060\u0060\n\nç„¶åç»™ productpage æœåŠ¡å‘é€è¯·æ±‚ï¼Œå¦‚æœä½ æ˜¯åœ¨ Kind ä¸­å®‰è£…çš„ Istioï¼Œåˆ™é»˜è®¤çš„ IngressGateway å°†æ˜¯ LoadBalancer ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ç«¯å£è½¬å‘çš„æ–¹å¼æ¥æš´éœ²ç½‘å…³ã€‚\n\n\u0060\u0060\u0060bash\nkubectl port-forward -n istio-system svc\/istio-ingressgateway 8081:80\n\u0060\u0060\u0060\n\né€šè¿‡ \u0060http:\/\/localhost:8081\/productpage\u0060 å°±å¯ä»¥è®¿é—®åˆ° productpage æœåŠ¡ã€‚å¤šè®¿é—®å‡ æ¬¡æ¥åˆ¶é€ ä¸€äº›æµé‡ï¼Œåé¢æˆ‘ä»¬å°±èƒ½åœ¨ SkyWalking UI ä¸Šçœ‹åˆ°æ‹“æ‰‘å›¾äº†ã€‚\n\næ‰“å¼€ SkyWalking UIï¼š\n\n\u0060\u0060\u0060bash\nistioctl dashboard skywalking\n\u0060\u0060\u0060\n\nSkyWalking çš„ General Service é¡µé¢å±•ç¤ºäº† bookinfo åº”ç”¨ä¸­çš„æ‰€æœ‰æœåŠ¡ã€‚\n\n![SkyWalking çš„ General Service é¡µé¢](general-service.jpg)\n\nä½ è¿˜å¯ä»¥çœ‹åˆ°å®ä¾‹ã€ç«¯ç‚¹ã€æ‹“æ‰‘ã€è¿½è¸ªç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ä¸‹å›¾å±•ç¤ºäº† bookinfo åº”ç”¨çš„æœåŠ¡æ‹“æ‰‘ã€‚\n\n![Bookinfo åº”ç”¨çš„æœåŠ¡æ‹“æ‰‘](topology.jpg)\n\nSkyWalking çš„è¿½è¸ªè§†å›¾æœ‰å¤šç§æ˜¾ç¤ºå½¢å¼ï¼Œå¦‚åˆ—è¡¨ã€æ ‘å½¢ã€è¡¨æ ¼å’Œç»Ÿè®¡ã€‚\n\n![SkyWalking é€šç”¨æœåŠ¡è¿½è¸ªæ”¯æŒå¤šç§æ˜¾ç¤ºæ ·å¼](gs-styles.jpg)\n\nä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æ£€æŸ¥ï¼Œå°†è¿½è¸ªçš„é‡‡æ ·ç‡è®¾ç½®ä¸º 100%ï¼š\n\n\u0060\u0060\u0060bash\nkubectl apply -f - \u003c\u003cEOF\napiVersion: telemetry.istio.io\/v1alpha1\nkind: Telemetry\nmetadata:\n  name: mesh-default\n  namespace: istio-system\nspec:\n  tracing:\n  - randomSamplingPercentage: 100.00\nEOF\n\u0060\u0060\u0060\n\n### å¸è½½ {#purge}\n\nåœ¨å®éªŒå®Œåï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¸è½½ Istio å’Œ SkyWalkingï¼š\n\n\u0060\u0060\u0060bash\nsamples\/bookinfo\/platform\/kube\/cleanup.sh\nistioctl unintall --purge\nkubectl delete namespace istio-system\n\u0060\u0060\u0060\n\n## Bookinfo demo è¿½è¸ªä¿¡æ¯è¯´æ˜ {#bookinfo-tracing}\n\nåœ¨ Apache SkyWalking UI ä¸­å¯¼èˆªåˆ° General Service åˆ†é¡µï¼ŒæŸ¥çœ‹æœ€è¿‘çš„ \u0060istio-ingressgateway\u0060 æœåŠ¡çš„è¿½è¸ªä¿¡æ¯ï¼Œè¡¨è§†å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚å›¾ä¸­å±•ç¤ºäº†æ­¤æ¬¡è¯·æ±‚æ‰€æœ‰ Span çš„åŸºæœ¬ä¿¡æ¯ï¼Œç‚¹å‡»æ¯ä¸ª Span å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚\n\n![è¡¨æ ¼è§†å›¾ä¸­æ˜¾ç¤ºäº† Span çš„åŸºæœ¬ä¿¡æ¯](span-table.jpg)\n\nåˆ‡æ¢ä¸ºåˆ—è¡¨è§†å›¾ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ª Span çš„æ‰§è¡Œé¡ºåºåŠæŒç»­æ—¶é—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![åˆ—è¡¨è§†å›¾](trace-list.jpg)\n\nä½ å¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªåº”ç”¨ä¼šäº§ç”Ÿå¦‚æ­¤å¤šçš„ Span ä¿¡æ¯ï¼Ÿå› ä¸ºæˆ‘ä»¬ä¸º Pod æ³¨å…¥äº† Envoy ä»£ç†ä¹‹åï¼Œæ¯ä¸ªæœåŠ¡é—´çš„è¯·æ±‚éƒ½ä¼šè¢« Envoy æ‹¦æˆªå’Œå¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![Envoy æ‹¦æˆªè¯·æ±‚äº§ç”Ÿ Span](span.svg)\n\næ•´ä¸ªè¿½è¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![Bookinfo çš„åˆ†å¸ƒå¼è¿½è¸ªç—•è¿¹](bookinfo-spans-with-time.svg)\n\nå›¾ä¸­ç»™æ¯ä¸€ä¸ª Span æ ‡è®°äº†åºå·ï¼Œå¹¶åœ¨æ‹¬å·é‡Œæ³¨æ˜äº†è€—æ—¶ã€‚ä¸ºäº†ä¾¿äºè¯´æ˜æˆ‘ä»¬å°†æ‰€æœ‰ Span æ±‡æ€»åœ¨ä¸‹é¢çš„è¡¨æ ¼ä¸­ã€‚\n\n| åºå· | æ–¹æ³•     | æ€»è€—æ—¶ï¼ˆmsï¼‰ | ç»„ä»¶è€—æ—¶ï¼ˆmsï¼‰ | å½“å‰æœåŠ¡         | è¯´æ˜                    |\n| -------- | ------------ | ------------------------ | -------------------------- | -------------------- | ------------------------------- |\n| 1    | \/productpage | 190                      | 0                          | istio-ingressgateway | Envoy Outbound          |\n| 2    | \/productpage | 190                      | 1                          | istio-ingressgateway | Ingress -\u003e Productpage ç½‘ç»œä¼ è¾“ |\n| 3    | \/productpage | 189                      | 1                          | productpage          | Envoy Inbound       |\n| 4    | \/productpage | 188                      | 21                         | productpage          | åº”ç”¨å†…éƒ¨å¤„ç†        |\n| 5    | \/details\/0   | 8                        | 1                          | productpage          | Envoy Outbound      |\n| 6    | \/details\/0   | 7                        | 3                          | productpage          | Productpage -\u003e Details ç½‘ç»œä¼ è¾“     |\n| 7    | \/details\/0   | 4                        | 0                          | details              | Envoy Inbound           |\n| 8    | \/details\/0   | 4                        | 4                          | details              | åº”ç”¨å†…éƒ¨                |\n| 9    | \/reviews\/0   | 159                      | 0                          | productpage          | Envoy Outbound      |\n| 10   | \/reviews\/0   | 159                      | 14                         | productpage          | Productpage -\u003e Reviews ç½‘ç»œä¼ è¾“ |\n| 11   | \/reviews\/0   | 145                      | 1                          | reviews              | Envoy Inbound           |\n| 12   | \/reviews\/0   | 144                      | 109                        | reviews              | åº”ç”¨å†…éƒ¨å¤„ç†              |\n| 13   | \/ratings\/0   | 35                       | 2                          | reviews              | Envoy Outbound          |\n| 14   | \/ratings\/0   | 33                       | 16                         | reviews              | Reviews -\u003e Ratings ç½‘ç»œä¼ è¾“         |\n| 15   | \/ratings\/0   | 17                       | 1                          | ratings              | Envoy Inbound           |\n| 16   | \/ratings\/0   | 16                       | 16                         | ratings              | åº”ç”¨å†…éƒ¨å¤„ç†            |\n\nä»ä»¥ä¸Šä¿¡æ¯å¯ä»¥å‘ç°ï¼š\n\n- æœ¬æ¬¡è¯·æ±‚æ€»è€—æ—¶ 190msï¼›\n- åœ¨ Istio sidecar æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡æµé‡åœ¨è¿›å‡ºåº”ç”¨å®¹å™¨æ—¶éƒ½éœ€è¦ç»è¿‡ä¸€æ¬¡ Envoy ä»£ç†ï¼Œæ¯æ¬¡è€—æ—¶åœ¨ 0 åˆ° 2 msï¼›\n- åœ¨ Pod é—´çš„ç½‘ç»œè¯·æ±‚è€—æ—¶åœ¨ 1 åˆ° 16ms ä¹‹é—´ï¼›\n- å°†è€—æ—¶åšå¤šçš„è°ƒç”¨é“¾ Ingress Gateway -\u003e Productpage -\u003e Reviews -\u003e Ratings ä¸Šçš„æ‰€æœ‰è€—æ—¶ç´¯è®¡ 182 msï¼Œå°äºè¯·æ±‚æ€»è€—æ—¶ 190msï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®æœ¬èº«æœ‰è¯¯å·®ï¼Œä»¥åŠ Span çš„å¼€å§‹æ—¶é—´å¹¶ä¸ä¸€å®šç­‰äºçˆ¶ Span çš„ç»“æŸæ—¶é—´ï¼Œå¦‚æœä½ åœ¨ SkyWalking çš„è¿½è¸ªé¡µé¢ï¼Œé€‰æ‹©ã€Œåˆ—è¡¨ã€æ ·å¼æŸ¥çœ‹è¿½è¸ªæ•°æ®ï¼ˆè§å›¾ 2ï¼‰å¯ä»¥æ›´ç›´è§‚çš„å‘ç°è¿™ä¸ªé—®é¢˜ï¼›\n- æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°æœ€è€—æ—¶çš„éƒ¨åˆ†æ˜¯ Reviews åº”ç”¨ï¼Œè€—æ—¶ 109msï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¯¥åº”ç”¨è¿›è¡Œä¼˜åŒ–ï¼›\n\n## æ€»ç»“ {#summary}\n\nåªè¦å¯¹åº”ç”¨ä»£ç ç¨ä½œä¿®æ”¹å°±å¯ä»¥åœ¨ Istio å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ªåŠŸèƒ½ã€‚åœ¨ Istio æ”¯æŒçš„ä¼—å¤šåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¸­ï¼Œ[Apache SkyWalking](https:\/\/skywalking.apache.org\/) æ˜¯å…¶ä¸­çš„ä½¼ä½¼è€…ã€‚å®ƒä¸ä»…æ”¯æŒåˆ†å¸ƒå¼è¿½è¸ªï¼Œè¿˜æ”¯æŒæŒ‡æ ‡å’Œæ—¥å¿—æ”¶é›†ã€æŠ¥è­¦ã€Kubernetes å’ŒæœåŠ¡ç½‘æ ¼ç›‘æ§ï¼Œ[ä½¿ç”¨ eBPF è¯Šæ–­æœåŠ¡ç½‘æ ¼æ€§èƒ½](https:\/\/skywalking.apache.org\/zh\/diagnose-service-mesh-network-performance-with-ebpf\/)ç­‰åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„äº‘åŸç”Ÿåº”ç”¨åˆ†æå¹³å°ã€‚æœ¬æ–‡ä¸­ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå°†è¿½è¸ªé‡‡æ ·ç‡è®¾ç½®ä¸ºäº† 100%ï¼Œåœ¨ç”Ÿäº§ä½¿ç”¨æ—¶è¯·æ ¹æ®éœ€è¦è°ƒæ•´é‡‡æ ·ç­–ç•¥ï¼ˆé‡‡æ ·ç™¾åˆ†æ¯”ï¼‰ï¼Œé˜²æ­¢äº§ç”Ÿè¿‡å¤šçš„è¿½è¸ªæ—¥å¿—ã€‚\n\n## å‚è€ƒ {#reference}\n\n- [Istio åˆ†å¸ƒå¼è¿½è¸ªæ¦‚è§ˆ - istio.io](https:\/\/istio.io\/latest\/zh\/docs\/tasks\/observability\/distributed-tracing\/overview\/)\n- [Istio åˆ†å¸ƒå¼è¿½è¸ª FAQ - istio.io](https:\/\/istio.io\/latest\/zh\/about\/faq\/#distributed-tracing)\n', '\/blog\/distributed-tracing-with-skywalking-in-istio\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åœ¨äº‘åŸç”Ÿåº”ç”¨ä¸­åˆ†å¸ƒå¼è¿½è¸ªçš„ç›¸å…³å†…å®¹ï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼è¿½è¸ªåŸºç¡€ã€Istio å®ç°åˆ†å¸ƒå¼è¿½è¸ªçš„æ–¹å¼ã€åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿçš„é€‰æ‹©ã€ä»¥ Bookinfo å’Œ SkyWalking ä¸ºä¾‹çš„å®éªŒä»¥åŠæ€»ç»“å’Œå‚è€ƒã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      ä¸“æ 
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(87)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(42)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(25)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>éšç¬”</span>
            <span>(22)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>å…¶ä»–</span>
            <span>(20)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(18)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>ä¸šæ€</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>äº‘åŸç”Ÿ</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>å®‰å…¨</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>å¼€æº</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%b7%a5%e5%85%b7" class="sidebar-item">
            <span>å·¥å…·</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>æ—…è¡Œ</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>å¯è§‚æµ‹æ€§</span>
            <span>(6)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      èµ„æ–™
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>å‡ºç‰ˆç‰©</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>ç¿»è¯‘ç”µå­ä¹¦</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>ç¿»è¯‘æ–‡æ¡£</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>ç¿»è¯‘å›¾ä¹¦</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>åŸåˆ›å›¾ä¹¦</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>æ•™ç¨‹æ‰‹å†Œ</span>
            <span>(2)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">è”ç³»</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">å¾®ä¿¡å…¬ä¼—å·</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">åšå®¢</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/beyond-sidecar/">è¶…è¶Š Sidecarï¼šæ·±å…¥è§£æ Istio Ambient Mode çš„æµé‡æœºåˆ¶ä¸æˆæœ¬æ•ˆç›Š</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-installation-deep-dive/">Istio å®‰è£…æ–¹å¼æ·±åº¦å‰–æâ€”â€”é€‰æ‹©ä¸å®è·µæŒ‡å—</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/istio-ambient-terminology/">Istio Ambient æ¨¡å¼ï¼šå›¾è§£åŠæ¦‚å¿µè§£è¯»</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">é“¾æ¥</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio æœåŠ¡ç½‘æ ¼
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate å…¬å¸
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿå­¦é™¢|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿå¼€æºé¡¹ç›®å¤§å…¨
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">æ•™ç¨‹</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy åŸºç¡€æ•™ç¨‹
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio åŸºç¡€æ•™ç¨‹
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes åŸºç¡€æ•™ç¨‹
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  ç®€æ˜ Envoy æ•™ç¨‹
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">é€šçŸ¥</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/kcd-beijing-2025/">KCD Beijing 2025 - æäº¤è®®é¢˜åŠå‚ä¼šæŠ¥å</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-community-domain-migration/">äº‘åŸç”Ÿç¤¾åŒºç½‘ç«™åŸŸåå˜æ›´é€šçŸ¥</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">èµ„æ–™åˆ†äº«ï¼šäº‘åŸç”Ÿåº”ç”¨æœåŠ¡ç½‘æ ¼ä»£ç†æ¨¡å‹çš„å¨èƒåˆ†ææŒ‡å—</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">Â© 2017-2025 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />










<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
