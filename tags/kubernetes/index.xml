<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubernetes on Jimmy Song&#39;s Blog</title>
    <link>http://rootsongjc.github.io/tags/kubernetes/</link>
    <description>Recent content in Kubernetes on Jimmy Song&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 11 Jul 2017 20:33:21 +0800</lastBuildDate>
    
	<atom:link href="http://rootsongjc.github.io/tags/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Kubernetesä¸­çš„æ•°æ®æŒä¹…åŒ–é—®é¢˜çš„ä¸€ä¸ªæ¡ˆä¾‹è®¨è®ºä¸è§£å†³æ–¹æ¡ˆæ¢ç©¶</title>
      <link>http://rootsongjc.github.io/blogs/data-persistence-problem/</link>
      <pubDate>Tue, 11 Jul 2017 20:33:21 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/data-persistence-problem/</guid>
      <description> æœ¬æ–‡å·²å½’æ¡£åˆ°kubernetes-handbookä¸­çš„ã€æœ€ä½³å®è·µâ€”è¿ç»´ç®¡ç†ã€‘ç« èŠ‚ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥kubernetes-handbookä¸ºå‡†ã€‚
æ•°æ®è½ç›˜é—®é¢˜çš„ç”±æ¥ è¿™æœ¬è´¨ä¸Šæ˜¯æ•°æ®æŒä¹…åŒ–é—®é¢˜ï¼Œå¯¹äºæœ‰äº›åº”ç”¨ä¾èµ–æŒä¹…åŒ–æ•°æ®ï¼Œæ¯”å¦‚åº”ç”¨è‡ªèº«äº§ç”Ÿçš„æ—¥å¿—éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„æƒ…å†µï¼Œéœ€è¦ä¿è¯å®¹å™¨é‡Œçš„æ•°æ®ä¸ä¸¢å¤±ï¼Œåœ¨PodæŒ‚æ‰åï¼Œå…¶ä»–åº”ç”¨ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è¿™äº›æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†æ•°æ®æŒä¹…åŒ–å­˜å‚¨èµ·æ¥ã€‚
æ•°æ®è½ç›˜é—®é¢˜è§£å†³æ–¹æ¡ˆ ä¸‹é¢ä»¥ä¸€ä¸ªåº”ç”¨çš„æ—¥å¿—æ”¶é›†ä¸ºä¾‹ï¼Œè¯¥æ—¥å¿—éœ€è¦æŒä¹…åŒ–æ”¶é›†åˆ°ElasticSearché›†ç¾¤ä¸­ï¼Œå¦‚æœä¸è€ƒè™‘æ•°æ®ä¸¢å¤±çš„æƒ…å½¢ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨kubernetes-handbookä¸­ã€åº”ç”¨æ—¥å¿—æ”¶é›†ã€‘ä¸€èŠ‚ä¸­çš„æ–¹æ³•ï¼Œä½†è€ƒè™‘åˆ°PodæŒ‚æ‰æ—¶logstashï¼ˆæˆ–filebeatï¼‰å¹¶æ²¡æœ‰æ”¶é›†å®Œè¯¥podå†…æ—¥å¿—çš„æƒ…å½¢ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†å¦‚ä¸‹è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š
 é¦–å…ˆéœ€è¦ç»™æ•°æ®è½ç›˜çš„åº”ç”¨åˆ’åˆ†nodeï¼Œå³è¿™äº›åº”ç”¨åªè°ƒç”¨åˆ°è‹¥å¹²å°ä¸»æœºä¸Š ç»™è¿™è‹¥å¹²å°ä¸»æœºå¢åŠ label ä½¿ç”¨deamonsetæ–¹å¼åœ¨è¿™è‹¥å¹²å°ä¸»æœºä¸Šå¯åŠ¨logstashçš„Podï¼ˆä½¿ç”¨nodeSelectoræ¥é™å®šåœ¨è¿™å‡ å°ä¸»æœºä¸Šï¼Œæˆ‘ä»¬åœ¨è¾¹ç¼˜èŠ‚ç‚¹å¯åŠ¨çš„treafikä¹Ÿæ˜¯è¿™ç§æ¨¡å¼ï¼‰ å°†åº”ç”¨çš„æ•°æ®é€šè¿‡volumeæŒ‚è½½åˆ°å®¿ä¸»æœºä¸Š Logstashï¼ˆæˆ–è€…filebeatï¼‰æ”¶é›†å®¿ä¸»æœºä¸Šçš„æ•°æ®ï¼Œæ•°æ®æŒä¹…åŒ–ä¸ä¼šä¸¢å¤±  Side-effect  é¦–å…ˆkubernetesæœ¬èº«å°±æä¾›äº†æ•°æ®æŒä¹…åŒ–çš„è§£å†³æ–¹æ¡ˆstatefulsetï¼Œä¸è¿‡éœ€è¦ç”¨åˆ°å…¬æœ‰äº‘çš„å­˜å‚¨è´§å…¶ä»–åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ä¸€ç‚¹åœ¨æˆ‘ä»¬çš„ç§æœ‰äº‘ç¯å¢ƒé‡Œè¢«å¦å®šäº†ã€‚ éœ€è¦ç®¡ç†ä¸»æœºçš„labelï¼Œå¢åŠ è¿ç»´å¤æ‚åº¦ï¼Œä½†æ˜¯å…·ä½“é—®é¢˜å…·ä½“å¯¹å¾… å¿…é¡»ä¿è¯åº”ç”¨å¯åŠ¨é¡ºåºï¼Œéœ€è¦å…ˆå¯åŠ¨logstash ä¸ºä¸»æœºæ‰“labelä½¿ç”¨nodeSelectorçš„æ–¹å¼é™åˆ¶äº†èµ„æºè°ƒåº¦çš„èŒƒå›´  </description>
    </item>
    
    <item>
      <title>Kubernetes kubectl cheat sheatâ€”â€”Kubectlå‘½ä»¤å‚è€ƒå›¾</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-kubectl-cheatsheat/</link>
      <pubDate>Sat, 01 Jul 2017 14:44:23 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-kubectl-cheatsheat/</guid>
      <description>å‚è€ƒ https://kubernetes.io/docs/user-guide/kubectl/v1.6/ ç»˜åˆ¶ã€‚
é€šè¿‡è¯¥å›¾å¯ä»¥å¯¹kubernetesçš„å®¢æˆ·ç«¯å‘½ä»¤kubectlæœ‰ä¸ªæ„Ÿæ€§å’Œå¤§ä½“çš„äº†è§£ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚
å›¾ç‰‡å½’æ¡£åœ¨kubernetes-handbookï¼Œä»¥GitHubä¸­çš„å›¾ç‰‡ä¸ºå‡†ã€‚
æ³¨ï¼šåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ‰“å¼€è¯¥é“¾æ¥åä¼šæç¤ºå›¾ç‰‡å¤ªå¤§æ— æ³•æŸ¥çœ‹è¯·é€‰æ‹©Desktop versionæ–¹å¯æŸ¥çœ‹åŸå›¾ã€‚
ä»Šåæˆ‘å°†é™†ç»­æ¨å‡ºå…¶ä»–objectçš„cheat sheetï¼Œæ•¬è¯·å…³æ³¨ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­æ„å»ºä¸å‘å¸ƒåº”ç”¨åˆ°kubernetesé›†ç¾¤ä¸­</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-jenkins-ci-cd/</link>
      <pubDate>Tue, 27 Jun 2017 20:52:57 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-jenkins-ci-cd/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ­£åˆ@ä¸œç›´é—¨ Jun 27ï¼Œ2017ï¼‰
æœ¬æ–‡å·²å½’æ¡£åˆ°kubernetes-handbookä¸­çš„ã€æœ€ä½³å®è·µâ€”ä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­æ„å»ºä¸å‘å¸ƒã€‘ç« èŠ‚ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥kubernetes-handbookä¸ºå‡†ã€‚
æˆ‘ä»¬åŸºäºJenkinsçš„CI/CDæµç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚
æµç¨‹è¯´æ˜ åº”ç”¨æ„å»ºå’Œå‘å¸ƒæµç¨‹è¯´æ˜ã€‚
 ç”¨æˆ·å‘Gitlabæäº¤ä»£ç ï¼Œä»£ç ä¸­å¿…é¡»åŒ…å«Dockerfileï¼› å°†ä»£ç æäº¤åˆ°è¿œç¨‹ä»“åº“ï¼› ç”¨æˆ·åœ¨å‘å¸ƒåº”ç”¨æ—¶éœ€è¦å¡«å†™gitä»“åº“åœ°å€å’Œåˆ†æ”¯ã€æœåŠ¡ç±»å‹ã€æœåŠ¡åç§°ã€èµ„æºæ•°é‡ã€å®ä¾‹ä¸ªæ•°ç­‰ï¼Œç¡®å®šåè§¦å‘Jenkinsè‡ªåŠ¨æ„å»ºï¼› Jenkinsçš„CIæµæ°´çº¿è‡ªåŠ¨ç¼–è¯‘ä»£ç å¹¶æ‰“åŒ…æˆdockeré•œåƒæ¨é€åˆ°Harboré•œåƒä»“åº“ï¼› Jenkinsçš„CIæµæ°´çº¿ä¸­åŒ…æ‹¬äº†è‡ªå®šä¹‰è„šæœ¬ï¼Œæ ¹æ®æˆ‘ä»¬å·²å‡†å¤‡å¥½çš„kubernetesçš„YAMLæ¨¡æ¿ï¼Œå°†å…¶ä¸­çš„å˜é‡æ›¿æ¢æˆç”¨æˆ·è¾“å…¥çš„é€‰é¡¹ï¼› ç”Ÿæˆåº”ç”¨çš„kubernetes YAMLé…ç½®æ–‡ä»¶ï¼› æ›´æ–°Ingressçš„é…ç½®ï¼Œæ ¹æ®æ–°éƒ¨ç½²çš„åº”ç”¨çš„åç§°ï¼Œåœ¨ingressçš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ ä¸€æ¡è·¯ç”±ä¿¡æ¯ æ›´æ–°PowerDNSï¼Œå‘å…¶ä¸­æ’å…¥ä¸€æ¡DNSè®°å½•ï¼ŒIPåœ°å€æ˜¯è¾¹ç¼˜èŠ‚ç‚¹çš„IPåœ°å€ã€‚å…³äºè¾¹ç¼˜èŠ‚ç‚¹ï¼Œè¯·æŸ¥çœ‹kubernetes-handbookä¸­çš„ã€æœ€ä½³å®è·µâ€”â€”è¾¹ç¼˜èŠ‚ç‚¹é…ç½®ã€‘ç« èŠ‚ï¼› Jenkinsè°ƒç”¨kubernetesçš„APIï¼Œéƒ¨ç½²åº”ç”¨åˆ°kubernetesé›†ç¾¤ä¸­ã€‚  å…³äºåº”ç”¨çš„æ›´æ–°ã€æ»šåŠ¨å‡çº§ã€ç°åº¦å‘å¸ƒè¯·ç•™æ„åšå®¢ä¸­çš„åç»­æ–‡ç« æˆ–å…³æ³¨kubernetes-handbookçš„æ›´æ–°ã€‚</description>
    </item>
    
    <item>
      <title>Kubernetes Pod Cheat Sheetâ€”â€”Podæ•°æ®ç»“æ„å‚è€ƒå›¾</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-pod-cheetsheet/</link>
      <pubDate>Sat, 24 Jun 2017 14:20:39 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-pod-cheetsheet/</guid>
      <description>æ˜¨å¤©æ™šä¸Šæ„æ€ï¼Œä»Šå¤©èŠ±äº†ä¸€ä¸Šåˆçš„æ—¶é—´ç¿»é˜…äº†ä¸‹kubernetes api referenceï¼Œç”»äº†ä¸€ä¸ªKubernetes Pod Cheat Sheetã€‚
ä»Podçš„æ•°æ®ç»“æ„å’ŒAPIå…¥æ‰‹ï¼Œç®¡ä¸­çª¥è±¹ï¼Œå¯è§ä¸€æ–‘ã€‚é€šè¿‡è¯¥å›¾åŸºæœ¬å¯ä»¥å¯¹kubernetesä¸­è¿™ä¸ªæœ€åŸºæœ¬çš„objectâ€”â€”Podçš„åŠŸèƒ½å’Œé…ç½®æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†äº†ï¼Œä¹Ÿè®¸å…·ä½“çš„æŸä¸ªç»„ä»¶çš„å®ç°ä½ ä¸äº†è§£ï¼Œä½†æ˜¯ä»high levelçš„è§†è§’æ¥çœ‹å¾…Podæ•´ä½“æœ‰åŠ©äºä»Šåæ·±å…¥ç ”ç©¶æŸä¸ªfeatureã€‚
è¯¥å›¾æ˜¯æ ¹æ®kubernetes 1.6ç‰ˆæœ¬çš„Pod v1 core APIç»˜åˆ¶ã€‚
å›¾ç‰‡å½’æ¡£åœ¨kubernetes-handbook,è¯·ä»¥GitHubä¸­çš„å›¾ç‰‡ä¸ºå‡†ã€‚
æ³¨ï¼šåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ‰“å¼€è¯¥é“¾æ¥åä¼šæç¤ºå›¾ç‰‡å¤ªå¤§æ— æ³•æŸ¥çœ‹è¯·é€‰æ‹©Desktop versionæ–¹å¯æŸ¥çœ‹åŸå›¾ã€‚
ä»Šåæˆ‘å°†é™†ç»­æ¨å‡ºå…¶ä»–objectçš„cheat sheetï¼Œæ•¬è¯·å…³æ³¨ã€‚</description>
    </item>
    
    <item>
      <title>kubernetes client-goåŒ…ä½¿ç”¨ç¤ºä¾‹</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-client-go-sample/</link>
      <pubDate>Wed, 21 Jun 2017 19:23:45 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-client-go-sample/</guid>
      <description>(é¢˜å›¾ï¼šé’å²›æ ˆæ¡¥ May 26,2017)
å‰è¨€ æœ¬æ–‡å°†å½’æ¡£åˆ°kubernetes-handbookçš„ã€å¼€å‘æŒ‡å—â€”client-goç¤ºä¾‹ã€‘ç« èŠ‚ä¸­ï¼Œæœ€ç»ˆç‰ˆæœ¬ä»¥kubernetes-handbookä¸­ä¸ºå‡†ã€‚
æœ¬æ–‡ä¸­çš„ä»£ç è§ï¼šhttps://github.com/rootsongjc/kubernetes-client-go-sample
client-goç¤ºä¾‹ è®¿é—®kubernetesé›†ç¾¤æœ‰å‡ ä¸‹å‡ ç§æ–¹å¼ï¼š
   æ–¹å¼ ç‰¹ç‚¹ æ”¯æŒè€…     Kubernetes dashboard ç›´æ¥é€šè¿‡Web UIè¿›è¡Œæ“ä½œï¼Œç®€å•ç›´æ¥ï¼Œå¯å®šåˆ¶åŒ–ç¨‹åº¦ä½ å®˜æ–¹æ”¯æŒ   kubectl å‘½ä»¤è¡Œæ“ä½œï¼ŒåŠŸèƒ½æœ€å…¨ï¼Œä½†æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œé€‚åˆå¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†è£…ï¼Œå®šåˆ¶åŠŸèƒ½ï¼Œç‰ˆæœ¬é€‚é…æœ€å¥½ å®˜æ–¹æ”¯æŒ   client-go ä»kubernetesçš„ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥çš„å®¢æˆ·ç«¯åŒ…ï¼Œç®€å•æ˜“ç”¨ï¼Œä½†éœ€è¦å°å¿ƒåŒºåˆ†kubernetesçš„APIç‰ˆæœ¬ å®˜æ–¹æ”¯æŒ   client-python pythonå®¢æˆ·ç«¯ï¼Œkubernetes-incubator å®˜æ–¹æ”¯æŒ   Java client fabric8ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œkubernetesçš„javaå®¢æˆ·ç«¯ redhat    ä¸‹é¢ï¼Œæˆ‘ä»¬åŸºäºclient-goï¼Œå¯¹Deploymentå‡çº§é•œåƒçš„æ­¥éª¤è¿›è¡Œäº†å®šåˆ¶ï¼Œé€šè¿‡å‘½ä»¤è¡Œä¼ é€’ä¸€ä¸ªDeploymentçš„åå­—ã€åº”ç”¨å®¹å™¨åå’Œæ–°imageåå­—çš„æ–¹å¼æ¥å‡çº§ã€‚ä»£ç å’Œä½¿ç”¨æ–¹å¼è§ https://github.com/rootsongjc/kubernetes-client-go-sample ã€‚
kubernetes-client-go-sample ä»£ç å¦‚ä¸‹ï¼š
package main import ( &amp;quot;flag&amp;quot; &amp;quot;fmt&amp;quot; &amp;quot;os&amp;quot; &amp;quot;path/filepath&amp;quot; &amp;quot;k8s.io/apimachinery/pkg/api/errors&amp;quot; metav1 &amp;quot;k8s.io/apimachinery/pkg/apis/meta/v1&amp;quot; &amp;quot;k8s.io/client-go/kubernetes&amp;quot; &amp;quot;k8s.io/client-go/tools/clientcmd&amp;quot; ) func main() { var kubeconfig *string if home := homeDir(); home !</description>
    </item>
    
    <item>
      <title>kubernetesç®¡ç†çš„å®¹å™¨å‘½åè§„åˆ™è§£æ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-container-naming-rule/</link>
      <pubDate>Thu, 15 Jun 2017 21:52:38 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-container-naming-rule/</guid>
      <description>æœ¬æ–‡å°†å½’æ¡£åˆ°kubernetes-handbookçš„ã€è¿ç»´ç®¡ç†-ç›‘æ§ã€‘ç« èŠ‚ä¸­ï¼Œæœ€ç»ˆç‰ˆæœ¬ä»¥kubernetes-handbookä¸­ä¸ºå‡†ã€‚
å½“æˆ‘ä»¬é€šè¿‡cAdvisorè·å–åˆ°äº†å®¹å™¨çš„ä¿¡æ¯åï¼Œä¾‹å¦‚è®¿é—®${NODE_IP}:4194/api/v1.3/dockerè·å–çš„jsonç»“æœä¸­çš„æŸä¸ªå®¹å™¨åŒ…å«å¦‚ä¸‹å­—æ®µï¼š
&amp;quot;labels&amp;quot;: { &amp;quot;annotation.io.kubernetes.container.hash&amp;quot;: &amp;quot;f47f0602&amp;quot;, &amp;quot;annotation.io.kubernetes.container.ports&amp;quot;: &amp;quot;[{\&amp;quot;containerPort\&amp;quot;:80,\&amp;quot;protocol\&amp;quot;:\&amp;quot;TCP\&amp;quot;}]&amp;quot;, &amp;quot;annotation.io.kubernetes.container.restartCount&amp;quot;: &amp;quot;0&amp;quot;, &amp;quot;annotation.io.kubernetes.container.terminationMessagePath&amp;quot;: &amp;quot;/dev/termination-log&amp;quot;, &amp;quot;annotation.io.kubernetes.container.terminationMessagePolicy&amp;quot;: &amp;quot;File&amp;quot;, &amp;quot;annotation.io.kubernetes.pod.terminationGracePeriod&amp;quot;: &amp;quot;30&amp;quot;, &amp;quot;io.kubernetes.container.logpath&amp;quot;: &amp;quot;/var/log/pods/d8a2e995-3617-11e7-a4b0-ecf4bbe5d414/php-redis_0.log&amp;quot;, &amp;quot;io.kubernetes.container.name&amp;quot;: &amp;quot;php-redis&amp;quot;, &amp;quot;io.kubernetes.docker.type&amp;quot;: &amp;quot;container&amp;quot;, &amp;quot;io.kubernetes.pod.name&amp;quot;: &amp;quot;frontend-2337258262-771lz&amp;quot;, &amp;quot;io.kubernetes.pod.namespace&amp;quot;: &amp;quot;default&amp;quot;, &amp;quot;io.kubernetes.pod.uid&amp;quot;: &amp;quot;d8a2e995-3617-11e7-a4b0-ecf4bbe5d414&amp;quot;, &amp;quot;io.kubernetes.sandbox.id&amp;quot;: &amp;quot;843a0f018c0cef2a5451434713ea3f409f0debc2101d2264227e814ca0745677&amp;quot; },  è¿™äº›ä¿¡æ¯å…¶å®éƒ½æ˜¯kubernetesåˆ›å»ºå®¹å™¨æ—¶ç»™docker containeræ‰“çš„Labelsã€‚
ä½ æ˜¯å¦æƒ³è¿‡è¿™äº›labelè·Ÿå®¹å™¨çš„åå­—æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå½“ä½ åœ¨nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œdocker psçœ‹åˆ°çš„å®¹å™¨åå­—åˆå¯¹åº”å“ªä¸ªåº”ç”¨çš„Podå‘¢ï¼Ÿ
åœ¨kubernetesä»£ç ä¸­pkg/kubelet/dockertools/docker.goä¸­çš„BuildDockerNameæ–¹æ³•å®šä¹‰äº†å®¹å™¨çš„åç§°è§„èŒƒã€‚
è¿™æ®µå®¹å™¨åç§°å®šä¹‰ä»£ç å¦‚ä¸‹ï¼š
// Creates a name which can be reversed to identify both full pod name and container name. // This function returns stable name, unique name and a unique id. // Although rand.Uint32() is not really unique, but it&#39;s enough for us because error will // only occur when instances of the same container in the same pod have the same UID.</description>
    </item>
    
    <item>
      <title>Kubernetesé…ç½®æœ€ä½³å®è·µ</title>
      <link>http://rootsongjc.github.io/blogs/configuration-best-practice/</link>
      <pubDate>Wed, 14 Jun 2017 20:03:09 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/configuration-best-practice/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šé’å²› May 26,2017ï¼‰
å‰è¨€ æœ¬æ–‡æ¡£æ—¨åœ¨æ±‡æ€»å’Œå¼ºè°ƒç”¨æˆ·æŒ‡å—ã€å¿«é€Ÿå¼€å§‹æ–‡æ¡£å’Œç¤ºä¾‹ä¸­çš„æœ€ä½³å®è·µã€‚è¯¥æ–‡æ¡£ä¼šå¾ˆå¾ˆæ´»è·ƒå¹¶æŒç»­æ›´æ–°ä¸­ã€‚å¦‚æœä½ è§‰å¾—å¾ˆæœ‰ç”¨çš„æœ€ä½³å®è·µä½†æ˜¯æœ¬æ–‡æ¡£ä¸­æ²¡æœ‰åŒ…å«ï¼Œæ¬¢è¿ç»™æˆ‘ä»¬æPull Requestã€‚
æœ¬æ–‡å·²ä¸Šä¼ åˆ°kubernetes-handbookä¸­çš„ç¬¬å››ç« æœ€ä½³å®è·µç« èŠ‚ï¼Œæœ¬æ–‡ä»…ä½œå½’æ¡£ï¼Œæ›´æ–°ä»¥kubernetes-handbookä¸ºå‡†ã€‚
é€šç”¨é…ç½®å»ºè®®  å®šä¹‰é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŒ‡å®šæœ€æ–°çš„ç¨³å®šAPIç‰ˆæœ¬ï¼ˆç›®å‰æ˜¯V1ï¼‰ã€‚ åœ¨é…ç½®æ–‡ä»¶pushåˆ°é›†ç¾¤ä¹‹å‰åº”è¯¥ä¿å­˜åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚è¿™æ ·å½“éœ€è¦çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿå›æ»šï¼Œå¿…è¦çš„æ—¶å€™ä¹Ÿå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºé›†ç¾¤ã€‚ ä½¿ç”¨YAMLæ ¼å¼è€Œä¸æ˜¯JSONæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å®ƒä»¬éƒ½å¯ä»¥ä½œä¸ºæ•°æ®äº¤æ¢æ ¼å¼ï¼Œä½†æ˜¯YAMLæ ¼å¼æ¯”èµ·JSONæ›´æ˜“è¯»å’Œé…ç½®ã€‚ å°½é‡å°†ç›¸å…³çš„å¯¹è±¡æ”¾åœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œã€‚è¿™æ ·æ¯”åˆ†æˆå¤šä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†ã€‚å‚è€ƒguestbook-all-in-one.yamlæ–‡ä»¶ä¸­çš„é…ç½®ï¼ˆæ³¨æ„ï¼Œå°½ç®¡ä½ å¯ä»¥åœ¨ä½¿ç”¨kubectlå‘½ä»¤æ—¶æŒ‡å®šé…ç½®æ–‡ä»¶ç›®å½•ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œkubectl createâ€”â€”æŸ¥çœ‹ä¸‹é¢çš„è¯¦ç»†ä¿¡æ¯ï¼‰ã€‚ ä¸ºäº†ç®€åŒ–å’Œæœ€å°åŒ–é…ç½®ï¼Œä¹Ÿä¸ºäº†é˜²æ­¢é”™è¯¯å‘ç”Ÿï¼Œä¸è¦æŒ‡å®šä¸å¿…è¦çš„é»˜è®¤é…ç½®ã€‚ä¾‹å¦‚ï¼Œçœç•¥æ‰ReplicationControllerçš„selectorå’Œlabelï¼Œå¦‚æœä½ å¸Œæœ›å®ƒä»¬è·ŸpodTemplateä¸­çš„labelä¸€æ ·çš„è¯ï¼Œå› ä¸ºé‚£äº›é…ç½®é»˜è®¤æ˜¯podTemplateçš„labeläº§ç”Ÿçš„ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ guestbook app çš„yamlæ–‡ä»¶å’Œ examples ã€‚ å°†èµ„æºå¯¹è±¡çš„æè¿°æ”¾åœ¨ä¸€ä¸ªannotationä¸­å¯ä»¥æ›´å¥½çš„å†…çœã€‚  è£¸å¥”çš„Pods vs Replication Controllerså’Œ Jobs  å¦‚æœæœ‰å…¶ä»–æ–¹å¼æ›¿ä»£â€œè£¸å¥”çš„podâ€ï¼ˆå¦‚æ²¡æœ‰ç»‘å®šåˆ°replication controller ä¸Šçš„podï¼‰ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å…¶ä»–é€‰æ‹©ã€‚åœ¨nodeèŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œè£¸å¥”çš„podä¸ä¼šè¢«é‡æ–°è°ƒåº¦ã€‚Replication Controlleræ€»æ˜¯ä¼šé‡æ–°åˆ›å»ºpodï¼Œé™¤äº†æ˜ç¡®æŒ‡å®šäº†restartPolicy: Never çš„åœºæ™¯ã€‚Job ä¹Ÿè®¸æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚  Services  é€šå¸¸æœ€å¥½åœ¨åˆ›å»ºç›¸å…³çš„replication controllersä¹‹å‰å…ˆåˆ›å»ºserviceï¼ˆæ²¡æœ‰è¿™ä¸ªå¿…è¦å§ï¼Ÿï¼‰ä½ ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºReplication Controllerçš„æ—¶å€™ä¸æŒ‡å®šreplicaæ•°é‡ï¼ˆé»˜è®¤æ˜¯1ï¼‰ï¼Œåˆ›å»ºserviceåï¼Œåœ¨é€šè¿‡Replication Controlleræ¥æ‰©å®¹ã€‚è¿™æ ·å¯ä»¥åœ¨æ‰©å®¹å¾ˆå¤šä¸ªreplicaä¹‹å‰å…ˆç¡®è®¤podæ˜¯æ­£å¸¸çš„ã€‚ é™¤éæ—¶åˆ†å¿…è¦çš„æƒ…å†µä¸‹ï¼ˆå¦‚è¿è¡Œä¸€ä¸ªnode daemonï¼‰ï¼Œä¸è¦ä½¿ç”¨hostPortï¼ˆç”¨æ¥æŒ‡å®šæš´éœ²åœ¨ä¸»æœºä¸Šçš„ç«¯å£å·ï¼‰ã€‚å½“ä½ ç»™Podç»‘å®šäº†ä¸€ä¸ªhostPortï¼Œè¯¥podå¯è¢«è°ƒåº¦åˆ°çš„ä¸»æœºçš„å—é™äº†ï¼Œå› ä¸ºç«¯å£å†²çªã€‚å¦‚æœæ˜¯ä¸ºäº†è°ƒè¯•ç›®çš„æ¥é€šè¿‡ç«¯å£è®¿é—®çš„è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl proxy and apiserver proxy æˆ–è€… kubectl port-forwardã€‚ä½ å¯ä½¿ç”¨ Service æ¥å¯¹å¤–æš´éœ²æœåŠ¡ã€‚å¦‚æœä½ ç¡®å®éœ€è¦å°†podçš„ç«¯å£æš´éœ²åˆ°ä¸»æœºä¸Šï¼Œè€ƒè™‘ä½¿ç”¨ NodePort serviceã€‚ è·ŸhostPortä¸€æ ·çš„åŸå› ï¼Œé¿å…ä½¿ç”¨ hostNetworkã€‚ å¦‚æœä½ ä¸éœ€è¦kube-proxyçš„è´Ÿè½½å‡è¡¡çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä½¿ç”¨headless servicesã€‚  ä½¿ç”¨Label  å®šä¹‰ labels æ¥æŒ‡å®šåº”ç”¨æˆ–Deploymentçš„ semantic attributes ã€‚ä¾‹å¦‚ï¼Œä¸æ˜¯å°†labelé™„åŠ åˆ°ä¸€ç»„podæ¥æ˜¾å¼è¡¨ç¤ºæŸäº›æœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œservice:myserviceï¼‰ï¼Œæˆ–è€…æ˜¾å¼åœ°è¡¨ç¤ºç®¡ç†podçš„replication controllerï¼ˆä¾‹å¦‚ï¼Œcontroller:mycontrollerï¼‰ï¼Œé™„åŠ labelåº”è¯¥æ˜¯æ ‡ç¤ºè¯­ä¹‰å±æ€§çš„æ ‡ç­¾ï¼Œ ä¾‹å¦‚{app:myapp,tier:frontend,phase:test,deployment:v3}ã€‚ è¿™å°†å…è®¸æ‚¨é€‰æ‹©é€‚åˆä¸Šä¸‹æ–‡çš„å¯¹è±¡ç»„â€”â€”ä¾‹å¦‚ï¼Œæ‰€æœ‰çš„â€tier:frontendâ€œpodçš„æœåŠ¡æˆ–appæ˜¯â€œmyappâ€çš„æ‰€æœ‰â€œæµ‹è¯•â€é˜¶æ®µç»„ä»¶ã€‚ æœ‰å…³æ­¤æ–¹æ³•çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…guestbookåº”ç”¨ç¨‹åºã€‚  å¯ä»¥é€šè¿‡ç®€å•åœ°ä»å…¶serviceçš„é€‰æ‹©å™¨ä¸­çœç•¥ç‰¹å®šäºå‘è¡Œç‰ˆæœ¬çš„æ ‡ç­¾ï¼Œè€Œä¸æ˜¯æ›´æ–°æœåŠ¡çš„é€‰æ‹©å™¨æ¥å®Œå…¨åŒ¹é…replication controllerçš„é€‰æ‹©å™¨ï¼Œæ¥å®ç°è·¨è¶Šå¤šä¸ªéƒ¨ç½²çš„æœåŠ¡ï¼Œä¾‹å¦‚æ»šåŠ¨æ›´æ–°ã€‚</description>
    </item>
    
    <item>
      <title>å¾®æœåŠ¡ç®¡ç†æ¡†æ¶Istioç®€ä»‹</title>
      <link>http://rootsongjc.github.io/blogs/istio-overview/</link>
      <pubDate>Fri, 02 Jun 2017 11:27:57 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/istio-overview/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šå¨æµ·æœ±å£ May 29,2017ï¼‰
å‰è¨€ æœ¬æ–‡å·²ä¸Šä¼ åˆ°kubernetes-handbookä¸­çš„ç¬¬äº”ç« å¾®æœåŠ¡ç« èŠ‚ï¼Œæœ¬æ–‡ä»…ä½œå½’æ¡£ï¼Œæ›´æ–°ä»¥kubernetes-handbookä¸ºå‡†ã€‚
Istioæ˜¯ç”±Googleã€IBMå’ŒLyftå¼€æºçš„å¾®æœåŠ¡ç®¡ç†ã€ä¿æŠ¤å’Œç›‘æ§æ¡†æ¶ã€‚Istioä¸ºå¸Œè…Šè¯­ï¼Œæ„æ€æ˜¯â€èµ·èˆªâ€œã€‚
ç®€ä»‹ ä½¿ç”¨istioå¯ä»¥å¾ˆç®€å•çš„åˆ›å»ºå…·æœ‰è´Ÿè½½å‡è¡¡ã€æœåŠ¡é—´è®¤è¯ã€ç›‘æ§ç­‰åŠŸèƒ½çš„æœåŠ¡ç½‘ç»œï¼Œè€Œä¸éœ€è¦å¯¹æœåŠ¡çš„ä»£ç è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚ä½ åªéœ€è¦åœ¨éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚Kubernetesçš„podé‡Œæ³¨å…¥ä¸€ä¸ªç‰¹åˆ«çš„sidecar proxyæ¥å¢åŠ å¯¹istioçš„æ”¯æŒï¼Œç”¨æ¥æˆªè·å¾®æœåŠ¡ä¹‹é—´çš„ç½‘ç»œæµé‡ã€‚
ç›®å‰ç‰ˆæœ¬çš„istioåªæ”¯æŒkubernetesï¼Œæœªæ¥è®¡åˆ’æ”¯æŒå…¶ä»–å…¶ä»–ç¯å¢ƒã€‚
ç‰¹æ€§ ä½¿ç”¨istioçš„è¿›è¡Œå¾®æœåŠ¡ç®¡ç†æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š
 æµé‡ç®¡ç†ï¼šæ§åˆ¶æœåŠ¡é—´çš„æµé‡å’ŒAPIè°ƒç”¨æµï¼Œä½¿è°ƒç”¨æ›´å¯é ï¼Œå¢å¼ºä¸åŒç¯å¢ƒä¸‹çš„ç½‘ç»œé²æ£’æ€§ã€‚ å¯è§‚æµ‹æ€§ï¼šäº†è§£æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œå®ƒä»¬ä¹‹é—´çš„æ€§è´¨å’Œæµé‡ï¼Œæä¾›å¿«é€Ÿè¯†åˆ«å®šä½é—®é¢˜çš„èƒ½åŠ›ã€‚ ç­–ç•¥å®æ–½ï¼šé€šè¿‡é…ç½®meshè€Œä¸æ˜¯ä»¥æ”¹å˜ä»£ç çš„æ–¹å¼æ¥æ§åˆ¶æœåŠ¡ä¹‹é—´çš„è®¿é—®ç­–ç•¥ã€‚ æœåŠ¡è¯†åˆ«å’Œå®‰å…¨ï¼šæä¾›åœ¨meshé‡Œçš„æœåŠ¡å¯è¯†åˆ«æ€§å’Œå®‰å…¨æ€§ä¿æŠ¤ã€‚  æœªæ¥å°†æ”¯æŒå¤šç§å¹³å°ï¼Œä¸è®ºæ˜¯kubernetesã€Mesosã€è¿˜æ˜¯äº‘ã€‚åŒæ—¶å¯ä»¥é›†æˆå·²æœ‰çš„ACLã€æ—¥å¿—ã€ç›‘æ§ã€é…é¢ã€å®¡è®¡ç­‰ã€‚
æ¶æ„ Istioæ¶æ„åˆ†ä¸ºæ§åˆ¶å±‚å’Œæ•°æ®å±‚ã€‚
 æ•°æ®å±‚ï¼šç”±ä¸€ç»„æ™ºèƒ½ä»£ç†ï¼ˆEnvoyï¼‰ä½œä¸ºsidecaréƒ¨ç½²ï¼Œåè°ƒå’Œæ§åˆ¶æ‰€æœ‰microservicesä¹‹é—´çš„ç½‘ç»œé€šä¿¡ã€‚ æ§åˆ¶å±‚ï¼šè´Ÿè´£ç®¡ç†å’Œé…ç½®ä»£ç†è·¯ç”±æµé‡ï¼Œä»¥åŠåœ¨è¿è¡Œæ—¶æ‰§è¡Œçš„æ”¿ç­–ã€‚  Envoy Istioä½¿ç”¨Envoyä»£ç†çš„æ‰©å±•ç‰ˆæœ¬ï¼Œè¯¥ä»£ç†æ˜¯ä»¥C++å¼€å‘çš„é«˜æ€§èƒ½ä»£ç†ï¼Œç”¨äºè°ƒè§£service meshä¸­æ‰€æœ‰æœåŠ¡çš„æ‰€æœ‰å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚ Istioåˆ©ç”¨äº†Envoyçš„è®¸å¤šå†…ç½®åŠŸèƒ½ï¼Œä¾‹å¦‚åŠ¨æ€æœåŠ¡å‘ç°ï¼Œè´Ÿè½½å¹³è¡¡ï¼ŒTLSç»ˆæ­¢ï¼ŒHTTP/2ï¼†gRPCä»£ç†ï¼Œæ–­è·¯å™¨ï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼ŒåŸºäºç™¾åˆ†æ¯”çš„æµé‡æ‹†åˆ†åˆ†é˜¶æ®µä¸Šçº¿ï¼Œæ•…éšœæ³¨å…¥å’Œä¸°å¯ŒæŒ‡æ ‡ã€‚
Envoyåœ¨kubernetesä¸­ä½œä¸ºpodçš„sidecaræ¥éƒ¨ç½²ã€‚ è¿™å…è®¸Istioå°†å¤§é‡å…³äºæµé‡è¡Œä¸ºçš„ä¿¡å·ä½œä¸ºå±æ€§æå–å‡ºæ¥ï¼Œè¿™äº›å±æ€§åˆå¯ä»¥åœ¨Mixerä¸­ç”¨äºæ‰§è¡Œç­–ç•¥å†³ç­–ï¼Œå¹¶å‘é€ç»™ç›‘æ§ç³»ç»Ÿä»¥æä¾›æœ‰å…³æ•´ä¸ªmeshçš„è¡Œä¸ºçš„ä¿¡æ¯ã€‚ Sidecarä»£ç†æ¨¡å‹è¿˜å…è®¸ä½ å°†IstioåŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰éƒ¨ç½²ä¸­ï¼Œæ— éœ€é‡æ–°æ„å»ºæˆ–é‡å†™ä»£ç ã€‚ æ›´å¤šä¿¡æ¯å‚è§è®¾è®¡ç›®æ ‡ã€‚
Mixer Mixerè´Ÿè´£åœ¨service meshä¸Šæ‰§è¡Œè®¿é—®æ§åˆ¶å’Œä½¿ç”¨ç­–ç•¥ï¼Œå¹¶æ”¶é›†Envoyä»£ç†å’Œå…¶ä»–æœåŠ¡çš„é¥æµ‹æ•°æ®ã€‚ä»£ç†æå–è¯·æ±‚çº§å±æ€§ï¼Œå‘é€åˆ°mixerè¿›è¡Œè¯„ä¼°ã€‚æœ‰å…³æ­¤å±æ€§æå–å’Œç­–ç•¥è¯„ä¼°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§Mixeré…ç½®ã€‚ æ··éŸ³å™¨åŒ…æ‹¬ä¸€ä¸ªçµæ´»çš„æ’ä»¶æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿä¸å„ç§ä¸»æœºç¯å¢ƒå’ŒåŸºç¡€æ¶æ„åç«¯è¿›è¡Œæ¥å£ï¼Œä»è¿™äº›ç»†èŠ‚ä¸­æŠ½è±¡å‡ºEnvoyä»£ç†å’ŒIstioç®¡ç†çš„æœåŠ¡ã€‚
Istio Manager Istio-Managerç”¨ä½œç”¨æˆ·å’ŒIstioä¹‹é—´çš„æ¥å£ï¼Œæ”¶é›†å’ŒéªŒè¯é…ç½®ï¼Œå¹¶å°†å…¶ä¼ æ’­åˆ°å„ç§Istioç»„ä»¶ã€‚å®ƒä»Mixerå’ŒEnvoyä¸­æŠ½å–ç¯å¢ƒç‰¹å®šçš„å®ç°ç»†èŠ‚ï¼Œä¸ºä»–ä»¬æä¾›ç‹¬ç«‹äºåº•å±‚å¹³å°çš„ç”¨æˆ·æœåŠ¡çš„æŠ½è±¡è¡¨ç¤ºã€‚ æ­¤å¤–ï¼Œæµé‡ç®¡ç†è§„åˆ™ï¼ˆå³é€šç”¨4å±‚è§„åˆ™å’Œä¸ƒå±‚HTTP/gRPCè·¯ç”±è§„åˆ™ï¼‰å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡Istio-Managerè¿›è¡Œç¼–ç¨‹ã€‚
Istio-auth Istio-Authæä¾›å¼ºå¤§çš„æœåŠ¡é—´å’Œæœ€ç»ˆç”¨æˆ·è®¤è¯ï¼Œä½¿ç”¨ç›¸äº’TLSï¼Œå†…ç½®èº«ä»½å’Œå‡­æ®ç®¡ç†ã€‚å®ƒå¯ç”¨äºå‡çº§service meshä¸­çš„æœªåŠ å¯†æµé‡ï¼Œå¹¶ä¸ºè¿è¥å•†æä¾›åŸºäºæœåŠ¡èº«ä»½è€Œä¸æ˜¯ç½‘ç»œæ§åˆ¶çš„ç­–ç•¥çš„èƒ½åŠ›ã€‚ Istioçš„æœªæ¥ç‰ˆæœ¬å°†å¢åŠ ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶å’Œå®¡è®¡ï¼Œä»¥ä½¿ç”¨å„ç§è®¿é—®æ§åˆ¶æœºåˆ¶ï¼ˆåŒ…æ‹¬å±æ€§å’ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ä»¥åŠæˆæƒhookï¼‰æ¥æ§åˆ¶å’Œç›‘æ§è®¿é—®ä½ æœåŠ¡ã€APIæˆ–èµ„æºçš„äººå‘˜ã€‚
å‚è€ƒ Istioå¼€æºå¹³å°å‘å¸ƒï¼ŒGoogleã€IBMå’ŒLyftåˆ†åˆ«æ‰¿æ‹…ä»€ä¹ˆè§’è‰²ï¼Ÿ
Istioï¼šç”¨äºå¾®æœåŠ¡çš„æœåŠ¡å•®åˆå±‚
Istio Overview</description>
    </item>
    
    <item>
      <title>å¾®æœåŠ¡ç®¡ç†æ¡†æ¶istioå®‰è£…ç¬”è®°</title>
      <link>http://rootsongjc.github.io/blogs/istio-installation/</link>
      <pubDate>Thu, 01 Jun 2017 20:18:57 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/istio-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šå¨æµ·ä¸œéƒ¨æµ·æ¹¾ May 28,2017ï¼‰
å‰è¨€ æœ¬æ–‡å·²ä¸Šä¼ åˆ°kubernetes-handbookä¸­çš„ç¬¬äº”ç« å¾®æœåŠ¡ç« èŠ‚ï¼Œæœ¬æ–‡ä»…ä½œå½’æ¡£ï¼Œæ›´æ–°ä»¥kubernetes-handbookä¸ºå‡†ã€‚
æœ¬æ–‡æ ¹æ®å®˜ç½‘çš„æ–‡æ¡£æ•´ç†è€Œæˆï¼Œæ­¥éª¤åŒ…æ‹¬å®‰è£…istio 0.1.5å¹¶åˆ›å»ºä¸€ä¸ªbookinfoçš„å¾®æœåŠ¡æ¥æµ‹è¯•istioçš„åŠŸèƒ½ã€‚
æ–‡ä¸­ä½¿ç”¨çš„yamlæ–‡ä»¶å¯ä»¥åœ¨kubernetes-handbookçš„manifests/istioç›®å½•ä¸­æ‰¾åˆ°ï¼Œæ‰€æœ‰çš„é•œåƒéƒ½æ¢æˆäº†æˆ‘çš„ç§æœ‰é•œåƒä»“åº“åœ°å€ï¼Œè¯·æ ¹æ®å®˜ç½‘çš„é•œåƒè‡ªè¡Œä¿®æ”¹ã€‚
å®‰è£…ç¯å¢ƒ  CentOS 7.3.1611 Docker 1.12.6 Kubernetes 1.6.0  å®‰è£… 1.ä¸‹è½½å®‰è£…åŒ…
ä¸‹è½½åœ°å€ï¼šhttps://github.com/istio/istio/releases
ä¸‹è½½Linuxç‰ˆæœ¬çš„å½“å‰æœ€æ–°ç‰ˆå®‰è£…åŒ…
wget https://github.com/istio/istio/releases/download/0.1.5/istio-0.1.5-linux.tar.gz  2.è§£å‹
è§£å‹åï¼Œå¾—åˆ°çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
. â”œâ”€â”€ bin â”‚Â â””â”€â”€ istioctl â”œâ”€â”€ install â”‚Â â””â”€â”€ kubernetes â”‚Â â”œâ”€â”€ addons â”‚Â â”‚Â â”œâ”€â”€ grafana.yaml â”‚Â â”‚Â â”œâ”€â”€ prometheus.yaml â”‚Â â”‚Â â”œâ”€â”€ servicegraph.yaml â”‚Â â”‚Â â””â”€â”€ zipkin.yaml â”‚Â â”œâ”€â”€ istio-auth.yaml â”‚Â â”œâ”€â”€ istio-rbac-alpha.yaml â”‚Â â”œâ”€â”€ istio-rbac-beta.yaml â”‚Â â”œâ”€â”€ istio.yaml â”‚Â â”œâ”€â”€ README.</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨filebeatæ”¶é›†kubernetesä¸­çš„åº”ç”¨æ—¥å¿—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-filebeat/</link>
      <pubDate>Wed, 17 May 2017 17:24:52 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-filebeat/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ°‘ç”Ÿç°ä»£ç¾æœ¯é¦† May 14,2017ï¼‰
å‰è¨€ æœ¬æ–‡å·²åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“kubernetes-handbookä¸­ã€‚
æ˜¨å¤©å†™äº†ç¯‡æ–‡ç« ä½¿ç”¨Logstashæ”¶é›†Kubernetesçš„åº”ç”¨æ—¥å¿—ï¼Œå‘ç°logstashååˆ†æ¶ˆè€—å†…å­˜ï¼ˆå¤§çº¦500Mï¼‰ï¼Œç»äººæé†’æ”¹ç”¨filebeatï¼ˆå¤§çº¦æ¶ˆè€—10å‡ Må†…å­˜ï¼‰ï¼Œå› æ­¤é‡å†™ä¸€ç¯‡ä½¿ç”¨filebeatæ”¶é›†kubernetesä¸­çš„åº”ç”¨æ—¥å¿—ã€‚
åœ¨è¿›è¡Œæ—¥å¿—æ”¶é›†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä½¿ç”¨Logstashï¼Œå› ä¸ºå®ƒæ˜¯ELK stackä¸­çš„é‡è¦æˆå‘˜ï¼Œä½†æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼ŒLogstashæ˜¯åŸºäºJDKçš„ï¼Œåœ¨æ²¡æœ‰äº§ç”Ÿæ—¥å¿—çš„æƒ…å†µå•çº¯å¯åŠ¨Logstashå°±å¤§æ¦‚è¦æ¶ˆè€—500Må†…å­˜ï¼Œåœ¨æ¯ä¸ªPodä¸­éƒ½å¯åŠ¨ä¸€ä¸ªæ—¥å¿—æ”¶é›†ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨logstashæœ‰ç‚¹æµªè´¹ç³»ç»Ÿèµ„æºï¼Œç»äººæ¨èæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨Filebeatæ›¿ä»£ï¼Œç»æµ‹è¯•å•ç‹¬å¯åŠ¨Filebeatå®¹å™¨å¤§çº¦ä¼šæ¶ˆè€—12Må†…å­˜ï¼Œæ¯”èµ·logstashç›¸å½“è½»é‡çº§ã€‚
æ–¹æ¡ˆé€‰æ‹© Kuberneteså®˜æ–¹æä¾›äº†EFKçš„æ—¥å¿—æ”¶é›†è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå¹¶ä¸é€‚åˆæ‰€æœ‰çš„ä¸šåŠ¡åœºæ™¯ï¼Œå®ƒæœ¬èº«å°±æœ‰ä¸€äº›å±€é™æ€§ï¼Œä¾‹å¦‚ï¼š
 æ‰€æœ‰æ—¥å¿—éƒ½å¿…é¡»æ˜¯outå‰å°è¾“å‡ºï¼ŒçœŸå®ä¸šåŠ¡åœºæ™¯ä¸­æ— æ³•ä¿è¯æ‰€æœ‰æ—¥å¿—éƒ½åœ¨å‰å°è¾“å‡º åªèƒ½æœ‰ä¸€ä¸ªæ—¥å¿—è¾“å‡ºæ–‡ä»¶ï¼Œè€ŒçœŸå®ä¸šåŠ¡åœºæ™¯ä¸­å¾€å¾€æœ‰å¤šä¸ªæ—¥å¿—è¾“å‡ºæ–‡ä»¶ Fluentdå¹¶ä¸æ˜¯å¸¸ç”¨çš„æ—¥å¿—æ”¶é›†å·¥å…·ï¼Œæˆ‘ä»¬æ›´ä¹ æƒ¯ç”¨logstashï¼Œç°ä½¿ç”¨filebeatæ›¿ä»£ æˆ‘ä»¬å·²ç»æœ‰è‡ªå·±çš„ELKé›†ç¾¤ä¸”æœ‰ä¸“äººç»´æŠ¤ï¼Œæ²¡æœ‰å¿…è¦å†åœ¨kubernetesä¸Šåšä¸€ä¸ªæ—¥å¿—æ”¶é›†æœåŠ¡  åŸºäºä»¥ä¸Šå‡ ä¸ªåŸå› ï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨è‡ªå·±çš„ELKé›†ç¾¤ã€‚
Kubernetesé›†ç¾¤ä¸­çš„æ—¥å¿—æ”¶é›†è§£å†³æ–¹æ¡ˆ
   ç¼–å· æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹     1 æ¯ä¸ªappçš„é•œåƒä¸­éƒ½é›†æˆæ—¥å¿—æ”¶é›†ç»„ä»¶ éƒ¨ç½²æ–¹ä¾¿ï¼Œkubernetesçš„yamlæ–‡ä»¶æ— é¡»ç‰¹åˆ«é…ç½®ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªappè‡ªå®šä¹‰æ—¥å¿—æ”¶é›†é…ç½® å¼ºè€¦åˆï¼Œä¸æ–¹ä¾¿åº”ç”¨å’Œæ—¥å¿—æ”¶é›†ç»„ä»¶å‡çº§å’Œç»´æŠ¤ä¸”ä¼šå¯¼è‡´é•œåƒè¿‡å¤§   2 å•ç‹¬åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ”¶é›†ç»„ä»¶è·Ÿappçš„å®¹å™¨ä¸€èµ·è¿è¡Œåœ¨åŒä¸€ä¸ªpodä¸­ ä½è€¦åˆï¼Œæ‰©å±•æ€§å¼ºï¼Œæ–¹ä¾¿ç»´æŠ¤å’Œå‡çº§ éœ€è¦å¯¹kubernetesçš„yamlæ–‡ä»¶è¿›è¡Œå•ç‹¬é…ç½®ï¼Œç•¥æ˜¾ç¹ç   3 å°†æ‰€æœ‰çš„Podçš„æ—¥å¿—éƒ½æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šï¼Œæ¯å°ä¸»æœºä¸Šå•ç‹¬èµ·ä¸€ä¸ªæ—¥å¿—æ”¶é›†Pod å®Œå…¨è§£è€¦ï¼Œæ€§èƒ½æœ€é«˜ï¼Œç®¡ç†èµ·æ¥æœ€æ–¹ä¾¿ éœ€è¦ç»Ÿä¸€æ—¥å¿—æ”¶é›†è§„åˆ™ï¼Œç›®å½•å’Œè¾“å‡ºæ–¹å¼    ç»¼åˆä»¥ä¸Šä¼˜ç¼ºç‚¹ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ–¹æ¡ˆäºŒã€‚
è¯¥æ–¹æ¡ˆåœ¨æ‰©å±•æ€§ã€ä¸ªæ€§åŒ–ã€éƒ¨ç½²å’ŒåæœŸç»´æŠ¤æ–¹é¢éƒ½èƒ½åšåˆ°å‡è¡¡ï¼Œå› æ­¤é€‰æ‹©è¯¥æ–¹æ¡ˆã€‚
æˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„logstashé•œåƒã€‚åˆ›å»ºè¿‡ç¨‹å’Œä½¿ç”¨æ–¹å¼è§https://github.com/rootsongjc/docker-images
é•œåƒåœ°å€ï¼šindex.tenxcloud.com/jimmy/filebeat:5.4.0
æµ‹è¯• æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªåº”ç”¨å¯¹logstashçš„æ—¥å¿—æ”¶é›†åŠŸèƒ½è¿›è¡Œæµ‹è¯•ã€‚
åˆ›å»ºåº”ç”¨yamlæ–‡ä»¶fielbeat-test.yamlã€‚
apiVersion: extensions/v1beta1 kind: Deployment metadata: name: filebeat-test namespace: default spec: replicas: 3 template: metadata: labels: k8s-app: filebeat-test spec: containers: - image: sz-pg-oam-docker-hub-001.</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Logstashæ”¶é›†Kubernetesçš„åº”ç”¨æ—¥å¿—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-logstash/</link>
      <pubDate>Tue, 16 May 2017 17:46:15 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-logstash/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼š798è‰ºæœ¯åŒº May 14,2017ï¼‰
å‰è¨€ æœ¬æ–‡åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“kubernetes-handbookä¸­ã€‚
å¾ˆå¤šä¼ä¸šå†…éƒ¨éƒ½æœ‰è‡ªå·±çš„ElasticSearché›†ç¾¤ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦åœ¨kubernetesé›†ç¾¤å†…éƒ¨å†éƒ¨ç½²ä¸€ä¸ªï¼Œè€Œä¸”è¿™æ ·è¿˜éš¾äºç®¡ç†ï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘åœ¨å®¹å™¨é‡Œéƒ¨ç½²logstashæ”¶é›†æ—¥å¿—åˆ°å·²æœ‰çš„ElasticSearché›†ç¾¤ä¸­ã€‚
æ–¹æ¡ˆé€‰æ‹© Kuberneteså®˜æ–¹æä¾›äº†EFKçš„æ—¥å¿—æ”¶é›†è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå¹¶ä¸é€‚åˆæ‰€æœ‰çš„ä¸šåŠ¡åœºæ™¯ï¼Œå®ƒæœ¬èº«å°±æœ‰ä¸€äº›å±€é™æ€§ï¼Œä¾‹å¦‚ï¼š
 æ‰€æœ‰æ—¥å¿—éƒ½å¿…é¡»æ˜¯outå‰å°è¾“å‡ºï¼ŒçœŸå®ä¸šåŠ¡åœºæ™¯ä¸­æ— æ³•ä¿è¯æ‰€æœ‰æ—¥å¿—éƒ½åœ¨å‰å°è¾“å‡º åªèƒ½æœ‰ä¸€ä¸ªæ—¥å¿—è¾“å‡ºæ–‡ä»¶ï¼Œè€ŒçœŸå®ä¸šåŠ¡åœºæ™¯ä¸­å¾€å¾€æœ‰å¤šä¸ªæ—¥å¿—è¾“å‡ºæ–‡ä»¶ Fluentdå¹¶ä¸æ˜¯å¸¸ç”¨çš„æ—¥å¿—æ”¶é›†å·¥å…·ï¼Œæˆ‘ä»¬æ›´ä¹ æƒ¯ç”¨logstash æˆ‘ä»¬å·²ç»æœ‰è‡ªå·±çš„ELKé›†ç¾¤ä¸”æœ‰ä¸“äººç»´æŠ¤ï¼Œæ²¡æœ‰å¿…è¦å†åœ¨kubernetesä¸Šåšä¸€ä¸ªæ—¥å¿—æ”¶é›†æœåŠ¡  åŸºäºä»¥ä¸Šå‡ ä¸ªåŸå› ï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨è‡ªå·±çš„ELKé›†ç¾¤ã€‚
Kubernetesé›†ç¾¤ä¸­çš„æ—¥å¿—æ”¶é›†è§£å†³æ–¹æ¡ˆ
   ç¼–å· æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹     1 æ¯ä¸ªappçš„é•œåƒä¸­éƒ½é›†æˆæ—¥å¿—æ”¶é›†ç»„ä»¶ éƒ¨ç½²æ–¹ä¾¿ï¼Œkubernetesçš„yamlæ–‡ä»¶æ— é¡»ç‰¹åˆ«é…ç½®ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªappè‡ªå®šä¹‰æ—¥å¿—æ”¶é›†é…ç½® å¼ºè€¦åˆï¼Œä¸æ–¹ä¾¿åº”ç”¨å’Œæ—¥å¿—æ”¶é›†ç»„ä»¶å‡çº§å’Œç»´æŠ¤ä¸”ä¼šå¯¼è‡´é•œåƒè¿‡å¤§   2 å•ç‹¬åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ”¶é›†ç»„ä»¶è·Ÿappçš„å®¹å™¨ä¸€èµ·è¿è¡Œåœ¨åŒä¸€ä¸ªpodä¸­ ä½è€¦åˆï¼Œæ‰©å±•æ€§å¼ºï¼Œæ–¹ä¾¿ç»´æŠ¤å’Œå‡çº§ éœ€è¦å¯¹kubernetesçš„yamlæ–‡ä»¶è¿›è¡Œå•ç‹¬é…ç½®ï¼Œç•¥æ˜¾ç¹ç   3 å°†æ‰€æœ‰çš„Podçš„æ—¥å¿—éƒ½æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šï¼Œæ¯å°ä¸»æœºä¸Šå•ç‹¬èµ·ä¸€ä¸ªæ—¥å¿—æ”¶é›†Pod å®Œå…¨è§£è€¦ï¼Œæ€§èƒ½æœ€é«˜ï¼Œç®¡ç†èµ·æ¥æœ€æ–¹ä¾¿ éœ€è¦ç»Ÿä¸€æ—¥å¿—æ”¶é›†è§„åˆ™ï¼Œç›®å½•å’Œè¾“å‡ºæ–¹å¼    ç»¼åˆä»¥ä¸Šä¼˜ç¼ºç‚¹ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ–¹æ¡ˆäºŒã€‚
è¯¥æ–¹æ¡ˆåœ¨æ‰©å±•æ€§ã€ä¸ªæ€§åŒ–ã€éƒ¨ç½²å’ŒåæœŸç»´æŠ¤æ–¹é¢éƒ½èƒ½åšåˆ°å‡è¡¡ï¼Œå› æ­¤é€‰æ‹©è¯¥æ–¹æ¡ˆã€‚
æˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„logstashé•œåƒã€‚åˆ›å»ºè¿‡ç¨‹å’Œä½¿ç”¨æ–¹å¼è§https://github.com/rootsongjc/docker-images
é•œåƒåœ°å€ï¼šindex.tenxcloud.com/jimmy/logstash:5.3.0
æµ‹è¯• æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªåº”ç”¨å¯¹logstashçš„æ—¥å¿—æ”¶é›†åŠŸèƒ½è¿›è¡Œæµ‹è¯•ã€‚
åˆ›å»ºåº”ç”¨yamlæ–‡ä»¶logstash-test.yamlã€‚
apiVersion: extensions/v1beta1 kind: Deployment metadata: name: logstash-test namespace: default spec: replicas: 3 template: metadata: labels: k8s-app: logstash-test spec: containers: - image: sz-pg-oam-docker-hub-001.</description>
    </item>
    
    <item>
      <title>Kuberneteæ¦‚å¿µè§£æä¹‹Deployment</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-concept-deployment/</link>
      <pubDate>Sat, 13 May 2017 00:46:37 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-concept-deployment/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šäº¬å¹¿æ¡¥@åŒ—äº¬å›½è´¸ Apr 30,2017ï¼‰
å‰è¨€ æœ¬æ–‡åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“kubernetes-handbookä¸­ã€‚
æœ¬æ–‡ç¿»è¯‘è‡ªkuberneteså®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md
æœ¬æ–‡ç« æ ¹æ®2017å¹´5æœˆ10æ—¥çš„Commit 8481c02ç¿»è¯‘ã€‚
Deploymentæ˜¯Kubernetesä¸­çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä»å®ƒå¼€å§‹æ˜¯äº†è§£kubernetesä¸­èµ„æºæ¦‚å¿µçš„ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ï¼Œçœ‹åˆ°ç½‘ä¸Šä¹Ÿæ²¡ä»€ä¹ˆè¯¦ç»†çš„è¯´æ˜æ–‡æ¡£ï¼Œæˆ‘å°±éšæ‰‹ç¿»è¯‘äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ˆGithubä¸­çš„æ–‡æ¡£ï¼‰ï¼Œkuberneteså®˜ç½‘ä¸Šçš„æ–‡æ¡£è¿˜æ²¡æœ‰è¿™ä¸ªæ–°ã€‚è¿™ç¯‡æ–‡ç« å¯¹Deploymentçš„æ¦‚å¿µè§£é‡Šçš„é¢é¢ä¿±åˆ°ååˆ†è¯¦å°½ã€‚
Deploymentæ˜¯ä»€ä¹ˆï¼Ÿ Deploymentä¸ºPodå’ŒReplica Setï¼ˆä¸‹ä¸€ä»£Replication Controllerï¼‰æä¾›å£°æ˜å¼æ›´æ–°ã€‚
ä½ åªéœ€è¦åœ¨Deploymentä¸­æè¿°ä½ æƒ³è¦çš„ç›®æ ‡çŠ¶æ€æ˜¯ä»€ä¹ˆï¼ŒDeployment controllerå°±ä¼šå¸®ä½ å°†Podå’ŒReplica Setçš„å®é™…çŠ¶æ€æ”¹å˜åˆ°ä½ çš„ç›®æ ‡çŠ¶æ€ã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå…¨æ–°çš„Deploymentï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ›¿æ¢æ—§çš„Deploymentã€‚
ä¸€ä¸ªå…¸å‹çš„ç”¨ä¾‹å¦‚ä¸‹ï¼š
 ä½¿ç”¨Deploymentæ¥åˆ›å»ºReplicaSetã€‚ReplicaSetåœ¨åå°åˆ›å»ºpodã€‚æ£€æŸ¥å¯åŠ¨çŠ¶æ€ï¼Œçœ‹å®ƒæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚ ç„¶åï¼Œé€šè¿‡æ›´æ–°Deploymentçš„PodTemplateSpecå­—æ®µæ¥å£°æ˜Podçš„æ–°çŠ¶æ€ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ReplicaSetï¼ŒDeploymentä¼šæŒ‰ç…§æ§åˆ¶çš„é€Ÿç‡å°†podä»æ—§çš„ReplicaSetç§»åŠ¨åˆ°æ–°çš„ReplicaSetä¸­ã€‚ å¦‚æœå½“å‰çŠ¶æ€ä¸ç¨³å®šï¼Œå›æ»šåˆ°ä¹‹å‰çš„Deployment revisionã€‚æ¯æ¬¡å›æ»šéƒ½ä¼šæ›´æ–°Deploymentçš„revisionã€‚ æ‰©å®¹Deploymentä»¥æ»¡è¶³æ›´é«˜çš„è´Ÿè½½ã€‚ æš‚åœDeploymentæ¥åº”ç”¨PodTemplateSpecçš„å¤šä¸ªä¿®å¤ï¼Œç„¶åæ¢å¤ä¸Šçº¿ã€‚ æ ¹æ®Deployment çš„çŠ¶æ€åˆ¤æ–­ä¸Šçº¿æ˜¯å¦hangä½äº†ã€‚ æ¸…æ¥šæ—§çš„ä¸å¿…è¦çš„ReplicaSetã€‚  åˆ›å»ºDeployment ä¸‹é¢æ˜¯ä¸€ä¸ªDeploymentç¤ºä¾‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªReplica Setæ¥å¯åŠ¨3ä¸ªnginx podã€‚
ä¸‹è½½ç¤ºä¾‹æ–‡ä»¶å¹¶æ‰§è¡Œå‘½ä»¤ï¼š
$ kubectl create -f docs/user-guide/nginx-deployment.yaml --record deployment &amp;quot;nginx-deployment&amp;quot; created  å°†kubectlçš„ â€”record çš„flagè®¾ç½®ä¸º trueå¯ä»¥åœ¨annotationä¸­è®°å½•å½“å‰å‘½ä»¤åˆ›å»ºæˆ–è€…å‡çº§äº†è¯¥èµ„æºã€‚è¿™åœ¨æœªæ¥ä¼šå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹åœ¨æ¯ä¸ªDeployment revisionä¸­æ‰§è¡Œäº†å“ªäº›å‘½ä»¤ã€‚
ç„¶åç«‹å³æ‰§è¡ŒgetÃ­å°†è·å¾—å¦‚ä¸‹ç»“æœï¼š
$ kubectl get deployments NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 3 0 0 0 1s  è¾“å‡ºç»“æœè¡¨æ˜æˆ‘ä»¬å¸Œæœ›çš„repalicaæ•°æ˜¯3ï¼ˆæ ¹æ®deploymentä¸­çš„.spec.replicasé…ç½®ï¼‰å½“å‰replicaæ•°ï¼ˆ .status.replicasï¼‰æ˜¯0, æœ€æ–°çš„replicaæ•°ï¼ˆ.status.updatedReplicasï¼‰æ˜¯0ï¼Œå¯ç”¨çš„replicaæ•°ï¼ˆ.status.availableReplicasï¼‰æ˜¯0ã€‚</description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„Rolling UpdateæœåŠ¡æ»šåŠ¨å‡çº§</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-service-rolling-update/</link>
      <pubDate>Wed, 10 May 2017 17:14:20 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-service-rolling-update/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šåæµ·å¤œè‰² Apr 30,2017ï¼‰
å‰è¨€ æœ¬æ–‡å·²åŒæ­¥åˆ°gitbook kubernetes-handbookçš„ç¬¬8ç« ç¬¬1èŠ‚ã€‚
æœ¬æ–‡è¯´æ˜åœ¨Kubernetes1.6ä¸­æœåŠ¡å¦‚ä½•æ»šåŠ¨å‡çº§ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚
å½“æœ‰é•œåƒå‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬æœåŠ¡ä¸Šçº¿æ—¶å¦‚ä½•å®ç°æœåŠ¡çš„æ»šåŠ¨å’Œå¹³æ»‘å‡çº§ï¼Ÿ
å¦‚æœä½ ä½¿ç”¨ReplicationControlleråˆ›å»ºçš„podå¯ä»¥ä½¿ç”¨kubectl rollingupdateå‘½ä»¤æ»šåŠ¨å‡çº§ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯Deploymentåˆ›å»ºçš„Podå¯ä»¥ç›´æ¥ä¿®æ”¹yamlæ–‡ä»¶åæ‰§è¡Œkubectl applyå³å¯ã€‚
Deploymentå·²ç»å†…ç½®äº†RollingUpdate strategyï¼Œå› æ­¤ä¸ç”¨å†è°ƒç”¨kubectl rollingupdateå‘½ä»¤ï¼Œå‡çº§çš„è¿‡ç¨‹æ˜¯å…ˆåˆ›å»ºæ–°ç‰ˆçš„podå°†æµé‡å¯¼å…¥åˆ°æ–°podä¸Šåé”€æ¯åŸæ¥çš„æ—§çš„podã€‚
Rolling Updateé€‚ç”¨äºDeploymentã€Replication Controllerï¼Œå®˜æ–¹æ¨èä½¿ç”¨Deploymentè€Œä¸å†ä½¿ç”¨Replication Controllerã€‚
ä½¿ç”¨ReplicationControlleræ—¶çš„æ»šåŠ¨å‡çº§è¯·å‚è€ƒå®˜ç½‘è¯´æ˜ï¼šhttps://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/
ReplicationControllerä¸Deploymentçš„å…³ç³» ReplicationControllerå’ŒDeploymentçš„RollingUpdateå‘½ä»¤æœ‰äº›ä¸åŒï¼Œä½†æ˜¯å®ç°çš„æœºåˆ¶æ˜¯ä¸€æ ·çš„ï¼Œå…³äºè¿™ä¸¤ä¸ªkindçš„å…³ç³»æˆ‘å¼•ç”¨äº†ReplicationControllerä¸Deploymentçš„åŒºåˆ«ä¸­çš„éƒ¨åˆ†å†…å®¹å¦‚ä¸‹ï¼Œè¯¦ç»†åŒºåˆ«è¯·æŸ¥çœ‹åŸæ–‡ã€‚
ReplicationController Replication Controllerä¸ºKubernetesçš„ä¸€ä¸ªæ ¸å¿ƒå†…å®¹ï¼Œåº”ç”¨æ‰˜ç®¡åˆ°Kubernetesä¹‹åï¼Œéœ€è¦ä¿è¯åº”ç”¨èƒ½å¤ŸæŒç»­çš„è¿è¡Œï¼ŒReplication Controllerå°±æ˜¯è¿™ä¸ªä¿è¯çš„keyï¼Œä¸»è¦çš„åŠŸèƒ½å¦‚ä¸‹ï¼š
 ç¡®ä¿podæ•°é‡ï¼šå®ƒä¼šç¡®ä¿Kubernetesä¸­æœ‰æŒ‡å®šæ•°é‡çš„Podåœ¨è¿è¡Œã€‚å¦‚æœå°‘äºæŒ‡å®šæ•°é‡çš„podï¼ŒReplication Controllerä¼šåˆ›å»ºæ–°çš„ï¼Œåä¹‹åˆ™ä¼šåˆ é™¤æ‰å¤šä½™çš„ä»¥ä¿è¯Podæ•°é‡ä¸å˜ã€‚ ç¡®ä¿podå¥åº·ï¼šå½“podä¸å¥åº·ï¼Œè¿è¡Œå‡ºé”™æˆ–è€…æ— æ³•æä¾›æœåŠ¡æ—¶ï¼ŒReplication Controllerä¹Ÿä¼šæ€æ­»ä¸å¥åº·çš„podï¼Œé‡æ–°åˆ›å»ºæ–°çš„ã€‚ å¼¹æ€§ä¼¸ç¼© ï¼šåœ¨ä¸šåŠ¡é«˜å³°æˆ–è€…ä½å³°æœŸçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡Replication ControlleråŠ¨æ€çš„è°ƒæ•´podçš„æ•°é‡æ¥æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚åŒæ—¶ï¼Œé…ç½®ç›¸åº”çš„ç›‘æ§åŠŸèƒ½ï¼ˆHroizontal Pod Autoscalerï¼‰ï¼Œä¼šå®šæ—¶è‡ªåŠ¨ä»ç›‘æ§å¹³å°è·å–Replication Controllerå…³è”podçš„æ•´ä½“èµ„æºä½¿ç”¨æƒ…å†µï¼Œåšåˆ°è‡ªåŠ¨ä¼¸ç¼©ã€‚ æ»šåŠ¨å‡çº§ï¼šæ»šåŠ¨å‡çº§ä¸ºä¸€ç§å¹³æ»‘çš„å‡çº§æ–¹å¼ï¼Œé€šè¿‡é€æ­¥æ›¿æ¢çš„ç­–ç•¥ï¼Œä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹åŒ–å‡çº§çš„æ—¶å€™å°±å¯ä»¥åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ï¼Œé¿å…é—®é¢˜ä¸æ–­æ‰©å¤§ã€‚  Deployment DeploymentåŒæ ·ä¸ºKubernetesçš„ä¸€ä¸ªæ ¸å¿ƒå†…å®¹ï¼Œä¸»è¦èŒè´£åŒæ ·æ˜¯ä¸ºäº†ä¿è¯podçš„æ•°é‡å’Œå¥åº·ï¼Œ90%çš„åŠŸèƒ½ä¸Replication Controllerå®Œå…¨ä¸€æ ·ï¼Œå¯ä»¥çœ‹åšæ–°ä¸€ä»£çš„Replication Controllerã€‚ä½†æ˜¯ï¼Œå®ƒåˆå…·å¤‡äº†Replication Controllerä¹‹å¤–çš„æ–°ç‰¹æ€§ï¼š
 Replication Controllerå…¨éƒ¨åŠŸèƒ½ï¼šDeploymentç»§æ‰¿äº†ä¸Šé¢æè¿°çš„Replication Controllerå…¨éƒ¨åŠŸèƒ½ã€‚ äº‹ä»¶å’ŒçŠ¶æ€æŸ¥çœ‹ï¼šå¯ä»¥æŸ¥çœ‹Deploymentçš„å‡çº§è¯¦ç»†è¿›åº¦å’ŒçŠ¶æ€ã€‚ å›æ»šï¼šå½“å‡çº§podé•œåƒæˆ–è€…ç›¸å…³å‚æ•°çš„æ—¶å€™å‘ç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å›æ»šæ“ä½œå›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬æˆ–è€…æŒ‡å®šçš„ç‰ˆæœ¬ã€‚ ç‰ˆæœ¬è®°å½•: æ¯ä¸€æ¬¡å¯¹Deploymentçš„æ“ä½œï¼Œéƒ½èƒ½ä¿å­˜ä¸‹æ¥ï¼Œç»™äºˆåç»­å¯èƒ½çš„å›æ»šä½¿ç”¨ã€‚ æš‚åœå’Œå¯åŠ¨ï¼šå¯¹äºæ¯ä¸€æ¬¡å‡çº§ï¼Œéƒ½èƒ½å¤Ÿéšæ—¶æš‚åœå’Œå¯åŠ¨ã€‚ å¤šç§å‡çº§æ–¹æ¡ˆï¼šRecreateï¼šåˆ é™¤æ‰€æœ‰å·²å­˜åœ¨çš„pod,é‡æ–°åˆ›å»ºæ–°çš„; RollingUpdateï¼šæ»šåŠ¨å‡çº§ï¼Œé€æ­¥æ›¿æ¢çš„ç­–ç•¥ï¼ŒåŒæ—¶æ»šåŠ¨å‡çº§æ—¶ï¼Œæ”¯æŒæ›´å¤šçš„é™„åŠ å‚æ•°ï¼Œä¾‹å¦‚è®¾ç½®æœ€å¤§ä¸å¯ç”¨podæ•°é‡ï¼Œæœ€å°å‡çº§é—´éš”æ—¶é—´ç­‰ç­‰ã€‚  åˆ›å»ºæµ‹è¯•é•œåƒ æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç‰¹åˆ«ç®€å•çš„webæœåŠ¡ï¼Œå½“ä½ è®¿é—®ç½‘é¡µæ—¶ï¼Œå°†è¾“å‡ºä¸€å¥ç‰ˆæœ¬ä¿¡æ¯ã€‚é€šè¿‡åŒºåˆ†è¿™å¥ç‰ˆæœ¬ä¿¡æ¯è¾“å‡ºæˆ‘ä»¬å°±å¯ä»¥æ–­å®šå‡çº§æ˜¯å¦å®Œæˆã€‚
æ‰€æœ‰é…ç½®å’Œä»£ç è§Githubä¸Šçš„manifests/test/rolling-update-testç›®å½•ã€‚
WebæœåŠ¡çš„ä»£ç main.go
package main import ( &amp;quot;fmt&amp;quot; &amp;quot;log&amp;quot; &amp;quot;net/http&amp;quot; ) func sayhello(w http.</description>
    </item>
    
    <item>
      <title>Kubernetesçš„è¾¹ç¼˜èŠ‚ç‚¹é…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-edge-node-configuration/</link>
      <pubDate>Tue, 09 May 2017 12:59:19 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-edge-node-configuration/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šå—å±æ™šé’Ÿ@åœ†æ˜å›­ May 6,2017ï¼‰
å‰è¨€ ä¸ºäº†é…ç½®kubernetesä¸­çš„traefik ingressçš„é«˜å¯ç”¨ï¼Œå¯¹äºkubernetesé›†ç¾¤ä»¥å¤–åªæš´éœ²ä¸€ä¸ªè®¿é—®å…¥å£ï¼Œéœ€è¦ä½¿ç”¨keepalivedæ’é™¤å•ç‚¹é—®é¢˜ã€‚æœ¬æ–‡å‚è€ƒäº†kube-keepalived-vipï¼Œä½†å¹¶æ²¡æœ‰ä½¿ç”¨å®¹å™¨æ–¹å¼å®‰è£…ï¼Œè€Œæ˜¯ç›´æ¥åœ¨nodeèŠ‚ç‚¹ä¸Šå®‰è£…ã€‚
æœ¬æ–‡å·²åŒæ­¥åˆ°gitbook kubernetes-handbookçš„ç¬¬2ç« ç¬¬5èŠ‚ã€‚
å®šä¹‰ é¦–å…ˆè§£é‡Šä¸‹ä»€ä¹ˆå«è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆEdge Nodeï¼‰ï¼Œæ‰€è°“çš„è¾¹ç¼˜èŠ‚ç‚¹å³é›†ç¾¤å†…éƒ¨ç”¨æ¥å‘é›†ç¾¤å¤–æš´éœ²æœåŠ¡èƒ½åŠ›çš„èŠ‚ç‚¹ï¼Œé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡é€šè¿‡è¯¥èŠ‚ç‚¹æ¥è°ƒç”¨é›†ç¾¤å†…éƒ¨çš„æœåŠ¡ï¼Œè¾¹ç¼˜èŠ‚ç‚¹æ˜¯é›†ç¾¤å†…å¤–äº¤æµçš„ä¸€ä¸ªEndpointã€‚
è¾¹ç¼˜èŠ‚ç‚¹è¦è€ƒè™‘ä¸¤ä¸ªé—®é¢˜
 è¾¹ç¼˜èŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œä¸èƒ½æœ‰å•ç‚¹æ•…éšœï¼Œå¦åˆ™æ•´ä¸ªkubernetesé›†ç¾¤å°†ä¸å¯ç”¨ å¯¹å¤–çš„ä¸€è‡´æš´éœ²ç«¯å£ï¼Œå³åªèƒ½æœ‰ä¸€ä¸ªå¤–ç½‘è®¿é—®IPå’Œç«¯å£  æ¶æ„ ä¸ºäº†æ»¡è¶³è¾¹ç¼˜èŠ‚ç‚¹çš„ä»¥ä¸Šéœ€æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨keepalivedæ¥å®ç°ã€‚
åœ¨Kubernetesé›†ç¾¤å¤–éƒ¨é…ç½®nginxæ¥è®¿é—®è¾¹ç¼˜èŠ‚ç‚¹çš„VIPã€‚
é€‰æ‹©Kubernetesçš„ä¸‰ä¸ªnodeä½œä¸ºè¾¹ç¼˜èŠ‚ç‚¹ï¼Œå¹¶å®‰è£…keepalivedã€‚
å‡†å¤‡ å¤ç”¨kubernetesæµ‹è¯•é›†ç¾¤çš„ä¸‰å°ä¸»æœºã€‚
172.20.0.113
172.20.0.114
172.20.0.115
å®‰è£… ä½¿ç”¨keepalivedç®¡ç†VIPï¼ŒVIPæ˜¯ä½¿ç”¨IPVSåˆ›å»ºçš„ï¼ŒIPVSå·²ç»æˆä¸ºlinuxå†…æ ¸çš„æ¨¡å—ï¼Œä¸éœ€è¦å®‰è£…
LVSçš„å·¥ä½œåŸç†è¯·å‚è€ƒï¼šhttp://www.cnblogs.com/codebean/archive/2011/07/25/2116043.html
ä¸ä½¿ç”¨é•œåƒæ–¹å¼å®‰è£…äº†ï¼Œç›´æ¥æ‰‹åŠ¨å®‰è£…ï¼ŒæŒ‡å®šä¸‰ä¸ªèŠ‚ç‚¹ä¸ºè¾¹ç¼˜èŠ‚ç‚¹ï¼ˆEdge nodeï¼‰ã€‚
å› ä¸ºæˆ‘ä»¬çš„æµ‹è¯•é›†ç¾¤ä¸€å…±åªæœ‰ä¸‰ä¸ªnodeï¼Œæ‰€æœ‰åœ¨åœ¨ä¸‰ä¸ªnodeä¸Šéƒ½è¦å®‰è£…keepalivedå’Œipvsadminã€‚
yum install keepalived ipvsadm  é…ç½®è¯´æ˜ éœ€è¦å¯¹åŸå…ˆçš„traefik ingressè¿›è¡Œæ”¹é€ ï¼Œä»ä»¥Deploymentæ–¹å¼å¯åŠ¨æ”¹æˆDeamonSetã€‚è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªä¸nodeåœ¨åŒä¸€ç½‘æ®µçš„IPåœ°å€ä½œä¸ºVIPï¼Œæˆ‘ä»¬æŒ‡å®šæˆ172.20.0.119ï¼Œé…ç½®keepalivedå‰éœ€è¦å…ˆä¿è¯è¿™ä¸ªIPæ²¡æœ‰è¢«åˆ†é…ã€‚ã€‚
 Traefikä»¥DaemonSetçš„æ–¹å¼å¯åŠ¨ é€šè¿‡nodeSelectoré€‰æ‹©è¾¹ç¼˜èŠ‚ç‚¹ é€šè¿‡hostPortæš´éœ²ç«¯å£ å½“å‰VIPæ¼‚ç§»åˆ°äº†172.20.0.115ä¸Š Traefikæ ¹æ®è®¿é—®çš„hostå’Œpathé…ç½®ï¼Œå°†æµé‡è½¬å‘åˆ°ç›¸åº”çš„serviceä¸Š  é…ç½®keepalived å‚è€ƒåŸºäºkeepalived å®ç°VIPè½¬ç§»ï¼Œlvsï¼Œnginxçš„é«˜å¯ç”¨ï¼Œé…ç½®keepalivedã€‚
keepalivedçš„å®˜æ–¹é…ç½®æ–‡æ¡£è§ï¼šhttp://keepalived.org/pdf/UserGuide.pdf
é…ç½®æ–‡ä»¶/etc/keepalived/keepalived.confæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š
! Configuration File for keepalived global_defs { notification_email { root@localhost } notification_email_from kaadmin@localhost smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id LVS_DEVEL } vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 51 priority 100 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 172.</description>
    </item>
    
    <item>
      <title>åœ¨kubernetesä¸­ä½¿ç”¨glusterfsåšæŒä¹…åŒ–å­˜å‚¨</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-with-glusterfs/</link>
      <pubDate>Thu, 04 May 2017 20:06:18 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-with-glusterfs/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ— é¢˜@åŒ—äº¬å¥¥æ—åŒ¹å…‹æ£®æ—å…¬å›­ May 1,2017ï¼‰
å‰è¨€ æœ¬æ–‡ç« å·²åŒæ­¥åˆ°kubernetes-handbook 7.1ç« èŠ‚ã€‚
Kubernetesé›†ç¾¤æ²¿ç”¨è·Ÿæˆ‘ä¸€èµ·éƒ¨ç½²kubernetes1.6é›†ç¾¤ä¸­çš„ä¸‰å°æœºå™¨ã€‚
æˆ‘ä»¬å¤ç”¨kubernetesé›†ç¾¤çš„è¿™ä¸‰å°ä¸»æœºåšglusterfså­˜å‚¨ã€‚
ä»¥ä¸‹æ­¥éª¤å‚è€ƒè‡ªï¼šhttps://www.xf80.com/2017/04/21/kubernetes-glusterfs/
å®‰è£…glusterfs æˆ‘ä»¬ç›´æ¥åœ¨ç‰©ç†æœºä¸Šä½¿ç”¨yumå®‰è£…ï¼Œå¦‚æœä½ é€‰æ‹©åœ¨kubernetesä¸Šå®‰è£…ï¼Œè¯·å‚è€ƒï¼šhttps://github.com/gluster/gluster-kubernetes/blob/master/docs/setup-guide.md
# å…ˆå®‰è£… gluster æº $ yum install centos-release-gluster -y # å®‰è£… glusterfs ç»„ä»¶ $ yum install -y glusterfs glusterfs-server glusterfs-fuse glusterfs-rdma glusterfs-geo-replication glusterfs-devel ## åˆ›å»º glusterfs ç›®å½• $ mkdir /opt/glusterd ## ä¿®æ”¹ glusterd ç›®å½• $ sed -i &#39;s/var\/lib/opt/g&#39; /etc/glusterfs/glusterd.vol # å¯åŠ¨ glusterfs $ systemctl start glusterd.service # è®¾ç½®å¼€æœºå¯åŠ¨ $ systemctl enable glusterd.service #æŸ¥çœ‹çŠ¶æ€ $ systemctl status glusterd.service  é…ç½® glusterfs # é…ç½® hosts $ vi /etc/hosts 172.</description>
    </item>
    
    <item>
      <title>Kubernetesç½‘ç»œå’Œé›†ç¾¤æ€§èƒ½æµ‹è¯•</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-performance-test/</link>
      <pubDate>Tue, 25 Apr 2017 22:14:49 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-performance-test/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ— é¢˜@å®‰è´é—¨ Jun 18,2016ï¼‰
å‰è¨€ è¯¥æµ‹è¯•æ˜¯ä¸ºäº†æµ‹è¯•åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œè®¿é—®kubernetesçš„å»¶è¿Ÿä»¥åŠkubernetesçš„æ€§èƒ½ã€‚è¿›è¡Œä»¥ä¸‹æµ‹è¯•å‰ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªéƒ¨ç½²å¥½çš„kubernetesé›†ç¾¤ï¼Œå…³äºå¦‚ä½•éƒ¨ç½²kuberentes1.6é›†ç¾¤ï¼Œè¯·å‚è€ƒkubernetes-handbookã€‚
å‡†å¤‡ æµ‹è¯•ç¯å¢ƒ
åœ¨ä»¥ä¸‹å‡ ç§ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼š
 Kubernetesé›†ç¾¤nodeèŠ‚ç‚¹ä¸Šé€šè¿‡Cluster IPæ–¹å¼è®¿é—® Kubernetesé›†ç¾¤å†…éƒ¨é€šè¿‡serviceè®¿é—® Kubernetesé›†ç¾¤å¤–éƒ¨é€šè¿‡traefik ingressæš´éœ²çš„åœ°å€è®¿é—®  æµ‹è¯•åœ°å€
Cluster IP: 10.254.149.31
Service Portï¼š8000
Ingress Hostï¼štraefik.sample-webapp.io
æµ‹è¯•å·¥å…·
 Locustï¼šä¸€ä¸ªç®€å•æ˜“ç”¨çš„ç”¨æˆ·è´Ÿè½½æµ‹è¯•å·¥å…·ï¼Œç”¨æ¥æµ‹è¯•webæˆ–å…¶ä»–ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¤„ç†çš„å¹¶å‘ç”¨æˆ·æ•°ã€‚ curl kubemark æµ‹è¯•ç¨‹åºï¼šsample-webappï¼Œæºç è§Github kubernetesçš„åˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•  æµ‹è¯•è¯´æ˜
é€šè¿‡å‘sample-webappå‘é€curlè¯·æ±‚è·å–å“åº”æ—¶é—´ï¼Œç›´æ¥curlåçš„ç»“æœä¸ºï¼š
$ curl &amp;quot;http://10.254.149.31:8000/&amp;quot; Welcome to the &amp;quot;Distributed Load Testing Using Kubernetes&amp;quot; sample web app  ç½‘ç»œå»¶è¿Ÿæµ‹è¯• åœºæ™¯ä¸€ã€ Kubernetesé›†ç¾¤nodeèŠ‚ç‚¹ä¸Šé€šè¿‡Cluster IPè®¿é—® æµ‹è¯•å‘½ä»¤
curl -o /dev/null -s -w &#39;%{time_connect} %{time_starttransfer} %{time_total}&#39; &amp;quot;http://10.254.149.31:8000/&amp;quot;  10ç»„æµ‹è¯•ç»“æœ
   No time_connect time_starttransfer time_total     1 0.</description>
    </item>
    
    <item>
      <title>è¿ç”¨kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•</title>
      <link>http://rootsongjc.github.io/blogs/distributed-load-testing-using-kubernetes/</link>
      <pubDate>Mon, 24 Apr 2017 21:32:52 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/distributed-load-testing-using-kubernetes/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šKubrick Book Store Mar 25,2016ï¼‰
å‰è¨€ Githubåœ°å€https://github.com/rootsongjc/distributed-load-testing-using-kubernetes
è¯¥æ•™ç¨‹æè¿°å¦‚ä½•åœ¨Kubernetesä¸­è¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡æµ‹è¯•ï¼ŒåŒ…æ‹¬ä¸€ä¸ªwebåº”ç”¨ã€dockeré•œåƒå’ŒKubernetes controllers/servicesã€‚æ›´å¤šèµ„æ–™è¯·æŸ¥çœ‹Distributed Load Testing Using Kubernetes ã€‚
æ³¨æ„ï¼šè¯¥æµ‹è¯•æ˜¯åœ¨æˆ‘è‡ªå·±æœ¬åœ°æ­å»ºçš„kubernetesé›†ç¾¤ä¸Šæµ‹è¯•çš„ï¼Œä¸éœ€è¦ä½¿ç”¨Google Cloud Platformã€‚
å‡†å¤‡ ä¸éœ€è¦GCEåŠå…¶ä»–ç»„ä»¶ï¼Œä½ åªéœ€è¦æœ‰ä¸€ä¸ªkubernetesé›†ç¾¤å³å¯ã€‚
å¦‚æœä½ è¿˜æ²¡æœ‰kubernetesé›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒkubernetes-handbookéƒ¨ç½²ä¸€ä¸ªã€‚
éƒ¨ç½²Webåº”ç”¨ sample-webapp ç›®å½•ä¸‹åŒ…å«ä¸€ä¸ªç®€å•çš„webæµ‹è¯•åº”ç”¨ã€‚æˆ‘ä»¬å°†å…¶æ„å»ºä¸ºdockeré•œåƒï¼Œåœ¨kubernetesä¸­è¿è¡Œã€‚ä½ å¯ä»¥è‡ªå·±æ„å»ºï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªæˆ‘æ„å»ºå¥½çš„é•œåƒindex.tenxcloud.com/jimmy/k8s-sample-webapp:latestã€‚
åœ¨kubernetesä¸Šéƒ¨ç½²sample-webappã€‚
$ cd kubernetes-config $ kubectl create -f sample-webapp-controller.yaml $ kubectl create -f kubectl create -f sample-webapp-service.yaml  éƒ¨ç½²Locustçš„Controllerå’ŒService locust-masterå’Œlocust-workä½¿ç”¨åŒæ ·çš„dockeré•œåƒï¼Œä¿®æ”¹cotnrollerä¸­spec.template.spec.containers.envå­—æ®µä¸­çš„valueä¸ºä½ sample-webapp serviceçš„åå­—ã€‚
- name: TARGET_HOST value: http://sample-webapp:8000  åˆ›å»ºController Dockeré•œåƒï¼ˆå¯é€‰ï¼‰ locust-masterå’Œlocust-work controllerä½¿ç”¨çš„éƒ½æ˜¯locust-tasks dockeré•œåƒã€‚ä½ å¯ä»¥ç›´æ¥ä¸‹è½½gcr.io/cloud-solutions-http://olz1di9xf.bkt.clouddn.com/locust-tasksï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–è¯‘ã€‚è‡ªå·±ç¼–è¯‘å¤§æ¦‚è¦èŠ±å‡ åˆ†é’Ÿæ—¶é—´ï¼Œé•œåƒå¤§å°ä¸º820Mã€‚
$ docker build -t index.tenxcloud.com/jimmy/locust-tasks:latest . $ docker push index.tenxcloud.com/jimmy/locust-tasks:latest  æ³¨æ„ï¼šæˆ‘ä½¿ç”¨çš„æ˜¯æ—¶é€Ÿäº‘çš„é•œåƒä»“åº“ã€‚
æ¯ä¸ªcontrollerçš„yamlçš„spec.template.spec.containers.image å­—æ®µæŒ‡å®šçš„æ˜¯æˆ‘çš„é•œåƒï¼š</description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„IPå’ŒæœåŠ¡å‘ç°ä½“ç³»</title>
      <link>http://rootsongjc.github.io/blogs/ip-and-service-discovry-in-kubernetes/</link>
      <pubDate>Mon, 24 Apr 2017 16:11:16 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/ip-and-service-discovry-in-kubernetes/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šè·¯è¾¹çš„é‡èŠ±@æœé˜³å…¬å›­ Nov 8,2015ï¼‰
Cluster IP å³Serviceçš„IPï¼Œé€šå¸¸åœ¨é›†ç¾¤å†…éƒ¨ä½¿ç”¨Service Nameæ¥è®¿é—®æœåŠ¡ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“è¯¥IPåœ°å€ï¼Œkubednsä¼šè‡ªåŠ¨æ ¹æ®service nameè§£æåˆ°æœåŠ¡çš„IPåœ°å€ï¼Œå°†æµé‡åˆ†å‘ç»™Podã€‚
Service Nameæ‰æ˜¯å¯¹å¤–æš´éœ²æœåŠ¡çš„å…³é”®ã€‚
åœ¨kubeapiçš„é…ç½®ä¸­æŒ‡å®šè¯¥åœ°å€èŒƒå›´ã€‚
é»˜è®¤é…ç½®
--service-cluster-ip-range=10.254.0.0/16 --service-node-port-range=30000-32767  Pod IP é€šè¿‡é…ç½®flannelçš„networkå’Œsubnetæ¥å®ç°ã€‚
é»˜è®¤é…ç½®
FLANNEL_NETWORK=172.30.0.0/16 FLANNEL_SUBNET=172.30.46.1/24  Podçš„IPåœ°å€ä¸å›ºå®šï¼Œå½“podé‡å¯æ—¶IPåœ°å€ä¼šå˜åŒ–ã€‚
è¯¥IPåœ°å€ä¹Ÿæ˜¯ç”¨æˆ·æ— éœ€å…³å¿ƒçš„ã€‚
ä½†æ˜¯Flannelä¼šåœ¨æœ¬åœ°ç”Ÿæˆç›¸åº”IPæ®µçš„è™šæ‹Ÿç½‘å¡ï¼Œä¸ºäº†é˜²æ­¢å’Œé›†ç¾¤ä¸­çš„å…¶ä»–IPåœ°å€å†²çªï¼Œéœ€è¦è§„åˆ’IPæ®µã€‚
ä¸»æœº/Node IP ç‰©ç†æœºçš„IPåœ°å€ï¼Œå³kubernetesç®¡ç†çš„ç‰©ç†æœºçš„IPåœ°å€ã€‚
$ kubectl get nodes NAME STATUS AGE VERSION 172.20.0.113 Ready 12d v1.6.0 172.20.0.114 Ready 12d v1.6.0 172.20.0.115 Ready 12d v1.6.0  æœåŠ¡å‘ç° é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°
é€šè¿‡DNSå³å¯å‘ç°ï¼Œkubendsæ˜¯kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä¸åŒæœåŠ¡ä¹‹é—´å¯ä»¥ç›´æ¥ä½¿ç”¨service nameè®¿é—®ã€‚
é€šè¿‡sericename:portå³å¯è°ƒç”¨æœåŠ¡ã€‚
æœåŠ¡å¤–éƒ¨çš„æœåŠ¡å‘ç°
é€šè¿‡Ingressæ¥å®ç°ï¼Œæˆ‘ä»¬æ˜¯ç”¨çš„Traefikæ¥å®ç°ã€‚
å‚è€ƒ Ingressè§£æ
Kubernetes Traefik Ingresså®‰è£…è¯•ç”¨</description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„RBACæ”¯æŒ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-rbac-support/</link>
      <pubDate>Fri, 21 Apr 2017 19:53:18 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-rbac-support/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ— é¢˜ Apr 2,2016ï¼‰
 åœ¨Kubernetes1.6ç‰ˆæœ¬ä¸­æ–°å¢è§’è‰²è®¿é—®æ§åˆ¶æœºåˆ¶ï¼ˆRole-Based Accessï¼ŒRBACï¼‰è®©é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥é’ˆå¯¹ç‰¹å®šä½¿ç”¨è€…æˆ–æœåŠ¡è´¦å·çš„è§’è‰²ï¼Œè¿›è¡Œæ›´ç²¾ç¡®çš„èµ„æºè®¿é—®æ§åˆ¶ã€‚åœ¨RBACä¸­ï¼Œæƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºé€‚å½“è§’è‰²çš„æˆå‘˜è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚è¿™å°±æå¤§åœ°ç®€åŒ–äº†æƒé™çš„ç®¡ç†ã€‚åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè§’è‰²æ˜¯ä¸ºäº†å®Œæˆå„ç§å·¥ä½œè€Œåˆ›é€ ï¼Œç”¨æˆ·åˆ™ä¾æ®å®ƒçš„è´£ä»»å’Œèµ„æ ¼æ¥è¢«æŒ‡æ´¾ç›¸åº”çš„è§’è‰²ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»ä¸€ä¸ªè§’è‰²è¢«æŒ‡æ´¾åˆ°å¦ä¸€ä¸ªè§’è‰²ã€‚
 å‰è¨€ æœ¬æ–‡ç¿»è¯‘è‡ªRBAC Support in Kubernetesï¼Œè½¬è½½è‡ªkubernetesä¸­æ–‡ç¤¾åŒºï¼Œè¯‘è€…å‚¬æ€»ï¼ŒJimmy Songåšäº†ç¨è®¸ä¿®æ”¹ã€‚è¯¥æ–‡ç« æ˜¯5å¤©å†…äº†è§£Kubernetes1.6æ–°ç‰¹æ€§çš„ç³»åˆ—æ–‡ç« ä¹‹ä¸€ã€‚
One of the highlights of the Kubernetes 1.6ä¸­çš„ä¸€ä¸ªäº®ç‚¹æ—¶RBACè®¿é—®æ§åˆ¶æœºåˆ¶å‡çº§åˆ°äº†betaç‰ˆæœ¬ã€‚RBACï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œæ˜¯ç”¨æ¥ç®¡ç†kubernetesé›†ç¾¤ä¸­èµ„æºè®¿é—®æƒé™çš„æœºåˆ¶ã€‚ä½¿ç”¨RBACå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ›´æ–°è®¿é—®æˆæƒç­–ç•¥è€Œä¸ç”¨é‡å¯é›†ç¾¤ã€‚
æœ¬æ–‡ä¸»è¦å…³æ³¨æ–°ç‰¹æ€§å’Œæœ€ä½³å®è·µã€‚
RBAC vs ABAC ç›®å‰kubernetesä¸­å·²ç»æœ‰ä¸€ç³»åˆ—l é‰´æƒæœºåˆ¶ã€‚é‰´æƒçš„ä½œç”¨æ˜¯ï¼Œå†³å®šä¸€ä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒä½¿ç”¨ Kubernetes API åšæŸäº›äº‹æƒ…ã€‚å®ƒé™¤äº†ä¼šå½±å“ kubectl ç­‰ç»„ä»¶ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ä¸€äº›è¿è¡Œåœ¨é›†ç¾¤å†…éƒ¨å¹¶å¯¹é›†ç¾¤è¿›è¡Œæ“ä½œçš„è½¯ä»¶äº§ç”Ÿä½œç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨äº† Kubernetes æ’ä»¶çš„ Jenkinsï¼Œæˆ–è€…æ˜¯åˆ©ç”¨ Kubernetes API è¿›è¡Œè½¯ä»¶éƒ¨ç½²çš„ Helmã€‚ABAC å’Œ RBAC éƒ½èƒ½å¤Ÿå¯¹è®¿é—®ç­–ç•¥è¿›è¡Œé…ç½®ã€‚
ABACï¼ˆAttribute Based Access Controlï¼‰æœ¬æ¥æ˜¯ä¸é”™çš„æ¦‚å¿µï¼Œä½†æ˜¯åœ¨ Kubernetes ä¸­çš„å®ç°æ¯”è¾ƒéš¾äºç®¡ç†å’Œç†è§£ï¼Œè€Œä¸”éœ€è¦å¯¹ Master æ‰€åœ¨èŠ‚ç‚¹çš„ SSH å’Œæ–‡ä»¶ç³»ç»Ÿæƒé™ï¼Œè€Œä¸”è¦ä½¿å¾—å¯¹æˆæƒçš„å˜æ›´æˆåŠŸç”Ÿæ•ˆï¼Œè¿˜éœ€è¦é‡æ–°å¯åŠ¨ API Serverã€‚
è€Œ RBAC çš„æˆæƒç­–ç•¥å¯ä»¥åˆ©ç”¨ kubectl æˆ–è€… Kubernetes API ç›´æ¥è¿›è¡Œé…ç½®ã€‚RBAC å¯ä»¥æˆæƒç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·æœ‰æƒè¿›è¡Œæˆæƒç®¡ç†ï¼Œè¿™æ ·å°±å¯ä»¥æ— éœ€æ¥è§¦èŠ‚ç‚¹ï¼Œç›´æ¥è¿›è¡Œæˆæƒç®¡ç†ã€‚RBAC åœ¨ Kubernetes ä¸­è¢«æ˜ å°„ä¸º API èµ„æºå’Œæ“ä½œã€‚
å› ä¸º Kubernetes ç¤¾åŒºçš„æŠ•å…¥å’Œåå¥½ï¼Œç›¸å¯¹äº ABAC è€Œè¨€ï¼ŒRBAC æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</description>
    </item>
    
    <item>
      <title>Kubernetes traefik ingresså®‰è£…è¯•ç”¨</title>
      <link>http://rootsongjc.github.io/blogs/traefik-ingress-installation/</link>
      <pubDate>Thu, 20 Apr 2017 22:38:40 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/traefik-ingress-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šğŸŸ@é±¼ç¼¸ Sep 15,2016ï¼‰
å‰è¨€ æ˜¨å¤©ç¿»äº†ä¸‹Ingressè§£æï¼Œç„¶åå®‰è£…è¯•ç”¨äº†ä¸‹traefikï¼Œè¿‡ç¨‹å·²åŒæ­¥åˆ°kubernetes-handbookä¸Šï¼ŒGithubåœ°å€https://github.com/rootsongjc/kubernetes-handbook
Ingressç®€ä»‹ å¦‚æœä½ è¿˜ä¸äº†è§£ï¼Œingressæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆçœ‹ä¸‹æˆ‘ç¿»è¯‘çš„Kuberneteså®˜ç½‘ä¸Šingressçš„ä»‹ç»Kubernetes Ingressè§£æã€‚
ç†è§£Ingress
ç®€å•çš„è¯´ï¼Œingresså°±æ˜¯ä»kubernetesé›†ç¾¤å¤–è®¿é—®é›†ç¾¤çš„å…¥å£ï¼Œå°†ç”¨æˆ·çš„URLè¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„serviceä¸Šã€‚Ingressç›¸å½“äºnginxã€apacheç­‰è´Ÿè½½å‡è¡¡æ–¹å‘ä»£ç†æœåŠ¡å™¨ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬è§„åˆ™å®šä¹‰ï¼Œå³URLçš„è·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±ä¿¡æ¯å¾—çš„åˆ·æ–°ç”±Ingress controlleræ¥æä¾›ã€‚
ç†è§£Ingress Controller
Ingress Controller å®è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸ªç›‘è§†å™¨ï¼ŒIngress Controller é€šè¿‡ä¸æ–­åœ°è·Ÿ kubernetes API æ‰“äº¤é“ï¼Œå®æ—¶çš„æ„ŸçŸ¥åç«¯ serviceã€pod ç­‰å˜åŒ–ï¼Œæ¯”å¦‚æ–°å¢å’Œå‡å°‘ podï¼Œservice å¢åŠ ä¸å‡å°‘ç­‰ï¼›å½“å¾—åˆ°è¿™äº›å˜åŒ–ä¿¡æ¯åï¼ŒIngress Controller å†ç»“åˆä¸‹æ–‡çš„ Ingress ç”Ÿæˆé…ç½®ï¼Œç„¶åæ›´æ–°åå‘ä»£ç†è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶åˆ·æ–°å…¶é…ç½®ï¼Œè¾¾åˆ°æœåŠ¡å‘ç°çš„ä½œç”¨ã€‚
éƒ¨ç½²Traefik ä»‹ç»traefik
Traefikæ˜¯ä¸€æ¬¾å¼€æºçš„åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿä¸å¸¸è§çš„å¾®æœåŠ¡ç³»ç»Ÿç›´æ¥æ•´åˆï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠ¨æ€é…ç½®ã€‚ç›®å‰æ”¯æŒDocker, Swarm, Mesos/Marathon, Mesos, Kubernetes, Consul, Etcd, Zookeeper, BoltDB, Rest APIç­‰ç­‰åç«¯æ¨¡å‹ã€‚
ä»¥ä¸‹é…ç½®æ–‡ä»¶å¯ä»¥åœ¨kubernetes-handbookGitHubä»“åº“ä¸­çš„manifests/traefik-ingress/ç›®å½•ä¸‹æ‰¾åˆ°ã€‚
åˆ›å»ºingress-rbac.yaml
å°†ç”¨äºservice accountéªŒè¯ã€‚
apiVersion: v1 kind: ServiceAccount metadata: name: ingress namespace: kube-system --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: ingress subjects: - kind: ServiceAccount name: ingress namespace: kube-system roleRef: kind: ClusterRole name: cluster-admin apiGroup: rbac.</description>
    </item>
    
    <item>
      <title>Kubernetes ingressè§£æ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/</link>
      <pubDate>Wed, 19 Apr 2017 21:05:47 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæœé˜³é—¨é“¶æ²³SOHO Jan 31,2016ï¼‰
å‰è¨€ è¿™æ˜¯kuberneteå®˜æ–¹æ–‡æ¡£ä¸­Ingress Resourceçš„ç¿»è¯‘ï¼Œå› ä¸ºæœ€è¿‘å·¥ä½œä¸­ç”¨åˆ°ï¼Œæ–‡ç« ä¹Ÿä¸é•¿ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œç´¢æ€§ç¿»è¯‘ä¸€ä¸‹ï¼Œä¹Ÿä¾¿äºè‡ªå·±åŠ æ·±ç†è§£ï¼ŒåŒæ—¶é€ ç¦kubernetesä¸­æ–‡ç¤¾åŒºã€‚åç»­å‡†å¤‡ä½¿ç”¨Traefikæ¥åšIngress controllerï¼Œæ–‡ç« æœ«å°¾ç»™å‡ºäº†å‡ ä¸ªç›¸å…³é“¾æ¥ï¼Œå®é™…ä½¿ç”¨æ¡ˆä¾‹æ­£åœ¨æ‘¸ç´¢ä¸­ï¼Œå±Šæ—¶ç›¸å…³å®‰è£…æ–‡æ¡£å’Œé…ç½®è¯´æ˜å°†åŒæ­¥æ›´æ–°åˆ°kubernetes-handbookä¸­ã€‚
æœ¯è¯­
åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šçœ‹åˆ°ä¸€äº›åœ¨å…¶ä»–åœ°æ–¹è¢«äº¤å‰ä½¿ç”¨çš„æœ¯è¯­ï¼Œä¸ºäº†é˜²æ­¢äº§ç”Ÿæ­§ä¹‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥æ¾„æ¸…ä¸‹ã€‚
 èŠ‚ç‚¹ï¼šKubernetesé›†ç¾¤ä¸­çš„ä¸€å°ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚ é›†ç¾¤ï¼šä½äºInterneté˜²ç«å¢™åçš„èŠ‚ç‚¹ï¼Œè¿™æ˜¯kubernetesç®¡ç†çš„ä¸»è¦è®¡ç®—èµ„æºã€‚
 è¾¹ç•Œè·¯ç”±å™¨ï¼šä¸ºé›†ç¾¤å¼ºåˆ¶æ‰§è¡Œé˜²ç«å¢™ç­–ç•¥çš„è·¯ç”±å™¨ã€‚ è¿™å¯èƒ½æ˜¯ç”±äº‘æä¾›å•†æˆ–ç‰©ç†ç¡¬ä»¶ç®¡ç†çš„ç½‘å…³ã€‚
 é›†ç¾¤ç½‘ç»œï¼šä¸€ç»„é€»è¾‘æˆ–ç‰©ç†é“¾æ¥ï¼Œå¯æ ¹æ®Kubernetesç½‘ç»œæ¨¡å‹å®ç°ç¾¤é›†å†…çš„é€šä¿¡ã€‚ é›†ç¾¤ç½‘ç»œçš„å®ç°åŒ…æ‹¬Overlayæ¨¡å‹çš„ flannel å’ŒåŸºäºSDNçš„OVSã€‚
 æœåŠ¡ï¼šä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨æ ‡è¯†ä¸€ç»„podæˆä¸ºçš„KubernetesæœåŠ¡ã€‚ é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æœåŠ¡å‡å®šåœ¨é›†ç¾¤ç½‘ç»œå†…ä»…å¯é€šè¿‡è™šæ‹ŸIPè®¿é—®ã€‚
  ä»€ä¹ˆæ˜¯Ingressï¼Ÿ é€šå¸¸æƒ…å†µä¸‹ï¼Œserviceå’Œpodä»…å¯åœ¨é›†ç¾¤å†…éƒ¨ç½‘ç»œä¸­é€šè¿‡IPåœ°å€è®¿é—®ã€‚æ‰€æœ‰åˆ°è¾¾è¾¹ç•Œè·¯ç”±å™¨çš„æµé‡æˆ–è¢«ä¸¢å¼ƒæˆ–è¢«è½¬å‘åˆ°å…¶ä»–åœ°æ–¹ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå¯èƒ½åƒä¸‹é¢è¿™æ ·ï¼š
 internet | ------------ [ Services ]  Ingressæ˜¯æˆæƒå…¥ç«™è¿æ¥åˆ°è¾¾é›†ç¾¤æœåŠ¡çš„è§„åˆ™é›†åˆã€‚
 internet | [ Ingress ] --|-----|-- [ Services ]  ä½ å¯ä»¥ç»™Ingressé…ç½®æä¾›å¤–éƒ¨å¯è®¿é—®çš„URLã€è´Ÿè½½å‡è¡¡ã€SSLã€åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºç­‰ã€‚ç”¨æˆ·é€šè¿‡POST Ingressèµ„æºåˆ°API serverçš„æ–¹å¼æ¥è¯·æ±‚ingressã€‚ Ingress controllerè´Ÿè´£å®ç°Ingressï¼Œé€šå¸¸ä½¿ç”¨è´Ÿè½½å¹³è¡¡å™¨ï¼Œå®ƒè¿˜å¯ä»¥é…ç½®è¾¹ç•Œè·¯ç”±å’Œå…¶ä»–å‰ç«¯ï¼Œè¿™æœ‰åŠ©äºä»¥HAæ–¹å¼å¤„ç†æµé‡ã€‚
å…ˆå†³æ¡ä»¶ åœ¨ä½¿ç”¨Ingress resourceä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸‹é¢å‡ ä»¶äº‹æƒ…ã€‚Ingressæ˜¯betaç‰ˆæœ¬çš„resourceï¼Œåœ¨kubernetes1.1ä¹‹å‰è¿˜æ²¡æœ‰ã€‚ä½ éœ€è¦ä¸€ä¸ªIngress Controlleræ¥å®ç°Ingressï¼Œå•çº¯çš„åˆ›å»ºä¸€ä¸ªIngressæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚
GCE/GKEä¼šåœ¨masterèŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªingress controllerã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªpodä¸­éƒ¨ç½²ä»»æ„ä¸ªè‡ªå®šä¹‰çš„ingress controllerã€‚ä½ å¿…é¡»æ­£ç¡®åœ°annotateæ¯ä¸ªingressï¼Œæ¯”å¦‚ è¿è¡Œå¤šä¸ªingress controller å’Œ å…³é—­glbc.
ç¡®å®šä½ å·²ç»é˜…è¯»äº†Ingress controllerçš„betaç‰ˆæœ¬é™åˆ¶ã€‚åœ¨éGCE/GKEçš„ç¯å¢ƒä¸­ï¼Œä½ éœ€è¦åœ¨podä¸­éƒ¨ç½²ä¸€ä¸ªcontrollerã€‚
Ingress Resource æœ€ç®€åŒ–çš„Ingressé…ç½®ï¼š
1: apiVersion: extensions/v1beta1 2: kind: Ingress 3: metadata: 4: name: test-ingress 5: spec: 6: rules: 7: - http: 8: paths: 9: - path: /testpath 10: backend: 11: serviceName: test 12: servicePort: 80  å¦‚æœä½ æ²¡æœ‰é…ç½®Ingress controllerå°±å°†å…¶POSTåˆ°API serverä¸ä¼šæœ‰ä»»ä½•ç”¨å¤„</description>
    </item>
    
    <item>
      <title>Kubernetes Handbookå‘èµ·</title>
      <link>http://rootsongjc.github.io/projects/kubernetes-handbook-startup/</link>
      <pubDate>Fri, 14 Apr 2017 19:33:27 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/projects/kubernetes-handbook-startup/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šåœ°å›å…¬å›­ Sep 27,2015ï¼‰
ç©è½¬Kubernetesï¼Œæˆ‘å°±çœ‹kubernetes handbookï¼
GitHubåœ°å€ï¼šhttps://github.com/rootsongjc/kubernetes-handbook
æ–‡ç« åŒæ­¥æ›´æ–°åˆ°gitbookï¼Œæ–¹ä¾¿å¤§å®¶æµè§ˆå’Œä¸‹è½½PDFã€‚
è¯´æ˜ æ–‡ä¸­æ¶‰åŠçš„é…ç½®æ–‡ä»¶å’Œä»£ç é“¾æ¥åœ¨gitbookä¸­ä¼šæ— æ³•æ‰“å¼€ï¼Œè¯·ä¸‹è½½githubæºç åï¼Œåœ¨MarkDownç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œç‚¹å‡»é“¾æ¥å°†è·³è½¬åˆ°ä½ çš„æœ¬åœ°ç›®å½•ã€‚
å¦‚ä½•ä½¿ç”¨ æ–¹å¼ä¸€ï¼šåœ¨çº¿æµè§ˆ
è®¿é—®gitbookï¼šhttps://www.gitbook.com/book/rootsongjc/kubernetes-handbook/
æ–¹å¼äºŒï¼šæœ¬åœ°æŸ¥çœ‹
 å°†ä»£ç å…‹éš†åˆ°æœ¬åœ° å®‰è£…gitbookï¼šSetup and Installation of GitBook æ‰§è¡Œgitbook serve åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://localhost:4000  P.S æœ¬ä¹¦ä¸­ä¹Ÿå°†è®°å½•ä¸šç•ŒåŠ¨æ€å’Œç»éªŒåˆ†äº«ï¼Œæ¬¢è¿åˆ†äº«ä½ çš„ç‹¬åˆ°è§è§£ã€‚
åŠ å…¥Kubernetesäº¤æµç¾¤ï¼Œè¯·æ·»åŠ æˆ‘å¾®ä¿¡jimmysongã€‚</description>
    </item>
    
    <item>
      <title>Kubernetes1.6é›†ç¾¤éƒ¨ç½²å®Œå…¨æŒ‡å— â€”â€”äºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²å¼€å¯TLSåŸºäºCentOS7å‘å¸ƒ</title>
      <link>http://rootsongjc.github.io/projects/kubernetes-installation-document/</link>
      <pubDate>Thu, 13 Apr 2017 14:00:04 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/projects/kubernetes-installation-document/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ¸…æ™¨@é¦–éƒ½æœºåœº Aug 13,2016ï¼‰
è¿™å¯èƒ½æ˜¯ç›®å‰ä¸ºæ­¢æœ€è¯¦ç»†çš„kuberneteså®‰è£…æ–‡æ¡£äº†ã€‚
ç»è¿‡å‡ å¤©çš„å®‰è£…ã€è°ƒè¯•ã€æ•´ç†ï¼Œä»Šå¤©è¯¥æ–‡æ¡£ç»ˆäºå‘å¸ƒäº†ã€‚
ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ–‡æ¡£å’Œé…ç½®æ–‡ä»¶å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½² kubernetes1.6 é›†ç¾¤ã€‚
æˆ–è€…ç›´æ¥ä¸‹è½½pdfç‰ˆæœ¬ï¼ˆ2.92Mï¼‰ã€‚
Kubernetesçš„å®‰è£…ç¹çï¼Œæ­¥éª¤å¤æ‚ï¼Œè¯¥æ–‡æ¡£èƒ½å¤Ÿå¸®åŠ©è·³è¿‡å¾ˆå¤šå‘ï¼ŒèŠ‚çº¦ä¸å°‘æ—¶é—´ï¼Œæˆ‘åœ¨æœ¬åœ°ç¯å¢ƒä¸Šå·²ç»å®‰è£…å®Œæˆï¼Œæœ‰é—®é¢˜æ¬¢è¿åœ¨GitHubä¸Šæissueã€‚
å®‰è£…çš„é›†ç¾¤è¯¦æƒ…
 Kubernetes 1.6.0 Docker 1.12.5ï¼ˆä½¿ç”¨yumå®‰è£…ï¼‰ Etcd 3.1.5 Flanneld 0.7 vxlan ç½‘ç»œ TLS è®¤è¯é€šä¿¡ (æ‰€æœ‰ç»„ä»¶ï¼Œå¦‚ etcdã€kubernetes master å’Œ node) RBAC æˆæƒ kublet TLS BootStrapping kubednsã€dashboardã€heapster(influxdbã€grafana)ã€EFK(elasticsearchã€fluentdã€kibana) é›†ç¾¤æ’ä»¶ ç§æœ‰dockeré•œåƒä»“åº“harborï¼ˆè¯·è‡ªè¡Œéƒ¨ç½²ï¼Œharboræä¾›ç¦»çº¿å®‰è£…åŒ…ï¼Œç›´æ¥ä½¿ç”¨docker-composeå¯åŠ¨å³å¯ï¼‰  è¯¥æ–‡æ¡£ä¸­åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤
 åˆ›å»º TLS é€šä¿¡æ‰€éœ€çš„è¯ä¹¦å’Œç§˜é’¥ åˆ›å»º kubeconfig æ–‡ä»¶ åˆ›å»ºä¸‰èŠ‚ç‚¹çš„é«˜å¯ç”¨ etcd é›†ç¾¤ kubectlå‘½ä»¤è¡Œå·¥å…· éƒ¨ç½²é«˜å¯ç”¨ master é›†ç¾¤ éƒ¨ç½² node èŠ‚ç‚¹ kubedns æ’ä»¶ Dashboard æ’ä»¶ Heapster æ’ä»¶ EFK æ’ä»¶  </description>
    </item>
    
    <item>
      <title>åœ¨å¼€å¯TLSçš„Kubernetes1.6é›†ç¾¤ä¸Šå®‰è£…EFK</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-efk-installation-with-tls/</link>
      <pubDate>Thu, 13 Apr 2017 12:28:10 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-efk-installation-with-tls/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šç°‹è¡— Jun 17,2016ï¼‰
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®(forkè‡ªopsnull)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œåœ¨å¼€å¯äº†TLSéªŒè¯çš„é›†ç¾¤ä¸­éƒ¨ç½²EFKæ—¥å¿—æ”¶é›†ç›‘æ§æ’ä»¶ã€‚
é…ç½®å’Œå®‰è£… EFK å®˜æ–¹æ–‡ä»¶ç›®å½•ï¼šcluster/addons/fluentd-elasticsearch
$ ls *.yaml es-controller.yaml es-service.yaml fluentd-es-ds.yaml kibana-controller.yaml kibana-service.yaml efk-rbac.yaml  åŒæ ·EFKæœåŠ¡ä¹Ÿéœ€è¦ä¸€ä¸ªefk-rbac.yamlæ–‡ä»¶ï¼Œé…ç½®serviceaccountä¸ºefkã€‚
å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼šEFK
é…ç½® es-controller.yaml $ diff es-controller.yaml.orig es-controller.yaml 24c24 &amp;lt; - image: gcr.io/google_containers/elasticsearch:v2.4.1-2 --- &amp;gt; - image: sz-pg-oam-docker-hub-001.tendcloud.com/library/elasticsearch:v2.4.1-2  é…ç½® es-service.yaml æ— éœ€é…ç½®ï¼›
é…ç½® fluentd-es-ds.yaml $ diff fluentd-es-ds.yaml.orig fluentd-es-ds.yaml 26c26 &amp;lt; image: gcr.io/google_containers/fluentd-elasticsearch:1.22 --- &amp;gt; image: sz-pg-oam-docker-hub-001.tendcloud.com/library/fluentd-elasticsearch:1.22  é…ç½® kibana-controller.yaml $ diff kibana-controller.yaml.orig kibana-controller.yaml 22c22 &amp;lt; image: gcr.io/google_containers/kibana:v4.6.1-1 --- &amp;gt; image: sz-pg-oam-docker-hub-001.</description>
    </item>
    
    <item>
      <title>åœ¨å¼€å¯TLSçš„Kubernetes1.6é›†ç¾¤ä¸Šå®‰è£…heapster</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation-with-tls/</link>
      <pubDate>Wed, 12 Apr 2017 20:20:19 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation-with-tls/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šå¤§å–µ Aug 8,2016ï¼‰
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®(forkè‡ªopsnull)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œåœ¨å¼€å¯äº†TLSéªŒè¯çš„é›†ç¾¤ä¸­éƒ¨ç½²heapsterï¼ŒåŒ…æ‹¬influxdbã€grafanaç­‰ç»„ä»¶ã€‚
é…ç½®å’Œå®‰è£…Heapster åˆ° heapster release é¡µé¢ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ heapsterã€‚
$ wget https://github.com/kubernetes/heapster/archive/v1.3.0.zip $ unzip v1.3.0.zip $ mv v1.3.0.zip heapster-1.3.0  æ–‡ä»¶ç›®å½•ï¼š heapster-1.3.0/deploy/kube-config/influxdb
$ cd heapster-1.3.0/deploy/kube-config/influxdb $ ls *.yaml grafana-deployment.yaml grafana-service.yaml heapster-deployment.yaml heapster-service.yaml influxdb-deployment.yaml influxdb-service.yaml heapster-rbac.yaml  æˆ‘ä»¬è‡ªå·±åˆ›å»ºäº†heapsterçš„rbacé…ç½®heapster-rbac.yamlã€‚
å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼šheapster
é…ç½® grafana-deployment $ diff grafana-deployment.yaml.orig grafana-deployment.yaml 16c16 &amp;lt; image: gcr.io/google_containers/heapster-grafana-amd64:v4.0.2 --- &amp;gt; image: sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-grafana-amd64:v4.0.2 40,41c40,41 &amp;lt; # value: /api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/ &amp;lt; value: / --- &amp;gt; value: /api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/ &amp;gt; #value: /  å¦‚æœåç»­ä½¿ç”¨ kube-apiserver æˆ–è€… kubectl proxy è®¿é—® grafana dashboardï¼Œåˆ™å¿…é¡»å°† GF_SERVER_ROOT_URL è®¾ç½®ä¸º /api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/ï¼Œå¦åˆ™åç»­è®¿é—®grafanaæ—¶è®¿é—®æ—¶æç¤ºæ‰¾ä¸åˆ°http://10.</description>
    </item>
    
    <item>
      <title>åœ¨å¼€å¯TLSçš„Kubernetes1.6é›†ç¾¤ä¸Šå®‰è£…dashboard</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation-with-tls/</link>
      <pubDate>Wed, 12 Apr 2017 15:53:39 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation-with-tls/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šä¸œç›´é—¨æ¡¥ Aug 20,2016ï¼‰
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®(forkè‡ªopsnull)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œåœ¨å¼€å¯äº†TLSéªŒè¯çš„é›†ç¾¤ä¸­éƒ¨ç½²dashboardã€‚
æ„Ÿè°¢opsnullå’Œipchyçš„ç»†å¿ƒè§£ç­”ã€‚
å®‰è£…ç¯å¢ƒé…ç½®ä¿¡æ¯
 CentOS 7.2.1511 Docker 1.12.5 Flannel 0.7 Kubernetes 1.6.0  é…ç½®å’Œå®‰è£… dashboard å®˜æ–¹æ–‡ä»¶ç›®å½•ï¼škubernetes/cluster/addons/dashboard
æˆ‘ä»¬ä½¿ç”¨çš„æ–‡ä»¶
$ ls *.yaml dashboard-controller.yaml dashboard-service.yaml dashboard-rbac.yaml  å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼šdashboard
ç”±äº kube-apiserver å¯ç”¨äº† RBAC æˆæƒï¼Œè€Œå®˜æ–¹æºç ç›®å½•çš„ dashboard-controller.yaml æ²¡æœ‰å®šä¹‰æˆæƒçš„ ServiceAccountï¼Œæ‰€ä»¥åç»­è®¿é—® kube-apiserver çš„ API æ—¶ä¼šè¢«æ‹’ç»ï¼Œwebä¸­æç¤ºï¼š
Forbidden (403) User &amp;quot;system:serviceaccount:kube-system:default&amp;quot; cannot list jobs.batch in the namespace &amp;quot;default&amp;quot;. (get jobs.batch)  å¢åŠ äº†ä¸€ä¸ªdashboard-rbac.yamlæ–‡ä»¶ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º dashboard çš„ ServiceAccountï¼Œç„¶åå°†å®ƒå’Œ Cluster Role view ç»‘å®šã€‚
é…ç½®dashboard-service $ diff dashboard-service.yaml.orig dashboard-service.</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹kubednsé…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-kubedns-installation/</link>
      <pubDate>Wed, 12 Apr 2017 13:04:45 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-kubedns-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šé›¨è¿‡å¤©æ™´@åŒ—äº¬å®šç¦åº„ Aug 27,2016ï¼‰
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®(forkè‡ªopsnull)ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œä½¿ç”¨yamlæ–‡ä»¶éƒ¨ç½²kubednsã€‚
å®‰è£…ç¯å¢ƒé…ç½®ä¿¡æ¯
 CentOS 7.2.1511 Docker 1.12.5 Flannel 0.7 Kubernetes 1.6.0  å®‰è£…å’Œé…ç½® kubedns æ’ä»¶ å®˜æ–¹çš„yamlæ–‡ä»¶ç›®å½•ï¼škubernetes/cluster/addons/dnsã€‚
è¯¥æ’ä»¶ç›´æ¥ä½¿ç”¨kuberneteséƒ¨ç½²ï¼Œå®˜æ–¹çš„é…ç½®æ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹é•œåƒï¼š
gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.1 gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.1 gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.1  æˆ‘cloneäº†ä¸Šè¿°é•œåƒï¼Œä¸Šä¼ åˆ°æˆ‘çš„ç§æœ‰é•œåƒä»“åº“ï¼š
sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-dnsmasq-nanny-amd64:1.14.1 sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-kube-dns-amd64:1.14.1 sz-pg-oam-docker-hub-001.tendcloud.com/library/k8s-dns-sidecar-amd64:1.14.1  åŒæ—¶ä¸Šä¼ äº†ä¸€ä»½åˆ°æ—¶é€Ÿäº‘å¤‡ä»½ï¼š
index.tenxcloud.com/jimmy/k8s-dns-dnsmasq-nanny-amd64:1.14.1 index.tenxcloud.com/jimmy/k8s-dns-kube-dns-amd64:1.14.1 index.tenxcloud.com/jimmy/k8s-dns-sidecar-amd64:1.14.1  ä»¥ä¸‹yamlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ˜¯ç§æœ‰é•œåƒä»“åº“ä¸­çš„é•œåƒã€‚
kubedns-cm.yaml kubedns-sa.yaml kubedns-controller.yaml kubedns-svc.yaml  å·²ç»ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶è§ï¼šgithubé¡¹ç›®ä¸­çš„manifest/kubedns/ç›®å½•ã€‚
ç³»ç»Ÿé¢„å®šä¹‰çš„ RoleBinding é¢„å®šä¹‰çš„ RoleBinding system:kube-dns å°† kube-system å‘½åç©ºé—´çš„ kube-dns ServiceAccount ä¸ system:kube-dns Role ç»‘å®šï¼Œ è¯¥ Role å…·æœ‰è®¿é—® kube-apiserver DNS ç›¸å…³ API çš„æƒé™ï¼›
$ kubectl get clusterrolebindings system:kube-dns -o yaml apiVersion: rbac.</description>
    </item>
    
    <item>
      <title>Kubernetesé«˜å¯ç”¨masterèŠ‚ç‚¹å®‰è£…</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-ha-master-installation/</link>
      <pubDate>Tue, 11 Apr 2017 19:55:56 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-ha-master-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šé¬¼è§æ„@åŒ—äº¬è¥¿å±± Sep 14,2015ï¼‰
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®((forkè‡ªopsnull))ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œéƒ¨ç½²masterèŠ‚ç‚¹çš„kube-apiserverã€kube-controller-managerå’Œkube-schedulerçš„è¿‡ç¨‹ã€‚
é«˜å¯ç”¨kubernetes masterèŠ‚ç‚¹å®‰è£… kubernetes master èŠ‚ç‚¹åŒ…å«çš„ç»„ä»¶ï¼š
 kube-apiserver kube-scheduler kube-controller-manager  ç›®å‰è¿™ä¸‰ä¸ªç»„ä»¶éœ€è¦éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚
 kube-schedulerã€kube-controller-manager å’Œ kube-apiserver ä¸‰è€…çš„åŠŸèƒ½ç´§å¯†ç›¸å…³ï¼› åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª kube-schedulerã€kube-controller-manager è¿›ç¨‹å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå¦‚æœè¿è¡Œå¤šä¸ªï¼Œåˆ™éœ€è¦é€šè¿‡é€‰ä¸¾äº§ç”Ÿä¸€ä¸ª leaderï¼›  æœ¬æ–‡æ¡£è®°å½•éƒ¨ç½²ä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„é«˜å¯ç”¨ kubernetes master é›†ç¾¤æ­¥éª¤ã€‚ï¼ˆåç»­åˆ›å»ºä¸€ä¸ª load balancer æ¥ä»£ç†è®¿é—® kube-apiserver çš„è¯·æ±‚ï¼‰
TLS è¯ä¹¦æ–‡ä»¶ pemå’Œtoken.csvè¯ä¹¦æ–‡ä»¶æˆ‘ä»¬åœ¨TLSè¯ä¹¦å’Œç§˜é’¥è¿™ä¸€æ­¥ä¸­å·²ç»åˆ›å»ºè¿‡äº†ã€‚æˆ‘ä»¬å†æ£€æŸ¥ä¸€ä¸‹ã€‚
$ ls /etc/kubernetes/ssl admin-key.pem admin.pem ca-key.pem ca.pem kube-proxy-key.pem kube-proxy.pem kubernetes-key.pem kubernetes.pem  ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ æœ‰ä¸¤ç§ä¸‹è½½æ–¹å¼
æ–¹å¼ä¸€
ä» github release é¡µé¢ ä¸‹è½½å‘å¸ƒç‰ˆ tarballï¼Œè§£å‹åå†æ‰§è¡Œä¸‹è½½è„šæœ¬
$ wget https://github.com/kubernetes/kubernetes/releases/download/v1.6.0/kubernetes.tar.gz $ tar -xzvf kubernetes.tar.gz ... $ cd kubernetes $ .</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹etcdé«˜å¯ç”¨é…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-etcd-ha-config/</link>
      <pubDate>Tue, 11 Apr 2017 15:21:39 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-etcd-ha-config/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šåŒ—äº¬å¤œæ™¯@è¥¿å±±ï¼‰
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®((forkè‡ªopsnull))ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œç”Ÿæˆkubeconfigæ–‡ä»¶çš„è¿‡ç¨‹ã€‚
åˆ›å»ºé«˜å¯ç”¨ etcd é›†ç¾¤ kuberntes ç³»ç»Ÿä½¿ç”¨ etcd å­˜å‚¨æ‰€æœ‰æ•°æ®ï¼Œæœ¬æ–‡æ¡£ä»‹ç»éƒ¨ç½²ä¸€ä¸ªä¸‰èŠ‚ç‚¹é«˜å¯ç”¨ etcd é›†ç¾¤çš„æ­¥éª¤ï¼Œè¿™ä¸‰ä¸ªèŠ‚ç‚¹å¤ç”¨ kubernetes master æœºå™¨ï¼Œåˆ†åˆ«å‘½åä¸ºsz-pg-oam-docker-test-001.tendcloud.comã€sz-pg-oam-docker-test-002.tendcloud.comã€sz-pg-oam-docker-test-003.tendcloud.comï¼š
 sz-pg-oam-docker-test-001.tendcloud.comï¼š172.20.0.113 sz-pg-oam-docker-test-002.tendcloud.comï¼š172.20.0.114 sz-pg-oam-docker-test-003.tendcloud.comï¼š172.20.0.115  TLS è®¤è¯æ–‡ä»¶ éœ€è¦ä¸º etcd é›†ç¾¤åˆ›å»ºåŠ å¯†é€šä¿¡çš„ TLS è¯ä¹¦ï¼Œè¿™é‡Œå¤ç”¨ä»¥å‰åˆ›å»ºçš„ kubernetes è¯ä¹¦
$ cp ca.pem kubernetes-key.pem kubernetes.pem /etc/kubernetes/ssl   kubernetes è¯ä¹¦çš„ hosts å­—æ®µåˆ—è¡¨ä¸­åŒ…å«ä¸Šé¢ä¸‰å°æœºå™¨çš„ IPï¼Œå¦åˆ™åç»­è¯ä¹¦æ ¡éªŒä¼šå¤±è´¥ï¼›  ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ åˆ° https://github.com/coreos/etcd/releases é¡µé¢ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶
$ https://github.com/coreos/etcd/releases/download/v3.1.5/etcd-v3.1.5-linux-amd64.tar.gz $ tar -xvf etcd-v3.1.4-linux-amd64.tar.gz $ sudo mv etcd-v3.1.4-linux-amd64/etcd* /root/local/bin  åˆ›å»º etcd çš„ systemd unit æ–‡ä»¶ æ³¨æ„æ›¿æ¢ ETCD_NAME å’Œ INTERNAL_IP å˜é‡çš„å€¼ï¼›</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹åˆ›å»ºkubeconfigæ–‡ä»¶</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-create-kubeconfig/</link>
      <pubDate>Tue, 11 Apr 2017 14:34:54 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-create-kubeconfig/</guid>
      <description>(é¢˜å›¾ï¼šåŒ—æµ·å…¬å›­ May 8,2016)
å‰è¨€ è¿™æ˜¯å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤é¡¹ç›®((forkè‡ªopsnull))ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹äº§ç”Ÿçš„kuberentesç¯å¢ƒï¼Œç”Ÿæˆkubeconfigæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ kubeletã€kube-proxy ç­‰ Node æœºå™¨ä¸Šçš„è¿›ç¨‹ä¸ Master æœºå™¨çš„ kube-apiserver è¿›ç¨‹é€šä¿¡æ—¶éœ€è¦è®¤è¯å’Œæˆæƒï¼› kubernetes 1.4 å¼€å§‹æ”¯æŒç”± kube-apiserver ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆ TLS è¯ä¹¦çš„ TLS Bootstrapping åŠŸèƒ½ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆè¯ä¹¦äº†ï¼›è¯¥åŠŸèƒ½å½“å‰ä»…æ”¯æŒä¸º kubelet ç”Ÿæˆè¯ä¹¦ã€‚
åˆ›å»º TLS Bootstrapping Token Token auth file
Tokenå¯ä»¥æ˜¯ä»»æ„çš„åŒ…æ¶µ128 bitçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°å‘ç”Ÿå™¨ç”Ÿæˆã€‚
export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39; &#39;) cat &amp;gt; token.csv &amp;lt;&amp;lt;EOF ${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,&amp;quot;system:kubelet-bootstrap&amp;quot; EOF   åä¸‰è¡Œæ˜¯ä¸€å¥ï¼Œç›´æ¥å¤åˆ¶ä¸Šé¢çš„è„šæœ¬è¿è¡Œå³å¯ã€‚
 å°†token.csvå‘åˆ°æ‰€æœ‰æœºå™¨ï¼ˆMaster å’Œ Nodeï¼‰çš„ /etc/kubernetes/ ç›®å½•ã€‚
$cp token.csv /etc/kubernetes/  åˆ›å»º kubelet bootstrapping kubeconfig æ–‡ä»¶ $ cd /etc/kubernetes $ export KUBE_APISERVER=&amp;quot;https://172.</description>
    </item>
    
    <item>
      <title>Kuberneteså®‰è£…ä¹‹è¯ä¹¦éªŒè¯</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-tls-certificate/</link>
      <pubDate>Mon, 10 Apr 2017 17:28:41 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-tls-certificate/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šé“œç‰›@é¢å’Œå›­ Aug 25,2014ï¼‰
å‰è¨€ æ˜¨æ™šï¼ˆApr 9,2017ï¼‰é‡‘å±±è½¯ä»¶çš„opsnullå‘å¸ƒäº†ä¸€ä¸ªå¼€æºé¡¹ç›®å’Œæˆ‘ä¸€æ­¥æ­¥éƒ¨ç½²kubernetesé›†ç¾¤ï¼Œä¸‹æ–‡æ˜¯ç»“åˆæˆ‘ä¹‹å‰éƒ¨ç½²kubernetesçš„è¿‡ç¨‹æ‰“é€ çš„kubernetesç¯å¢ƒå’Œopsnullçš„æ–‡ç« åˆ›å»º kubernetes å„ç»„ä»¶ TLS åŠ å¯†é€šä¿¡çš„è¯ä¹¦å’Œç§˜é’¥çš„å®è·µã€‚ä¹‹å‰å®‰è£…è¿‡ç¨‹ä¸­ä¸€ç›´ä½¿ç”¨çš„æ˜¯éåŠ å¯†æ–¹å¼ï¼Œä¸€ç›´åˆ°åæ¥ä½¿ç”¨Fluentdå’ŒElasticSearchæ”¶é›†Kubernetesé›†ç¾¤æ—¥å¿—æ—¶å‘ç°æœ‰æƒé™éªŒè¯é—®é¢˜ï¼Œæ‰€ä»¥ä¸ºäº†æ·±å…¥ç ”ç©¶kubernentesã€‚
Kubernentesä¸­çš„èº«ä»½éªŒè¯ kubernetes ç³»ç»Ÿçš„å„ç»„ä»¶éœ€è¦ä½¿ç”¨ TLS è¯ä¹¦å¯¹é€šä¿¡è¿›è¡ŒåŠ å¯†ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨ CloudFlare çš„ PKI å·¥å…·é›† cfssl æ¥ç”Ÿæˆ Certificate Authority (CA) å’Œå…¶å®ƒè¯ä¹¦ï¼›
ç”Ÿæˆçš„ CA è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶å¦‚ä¸‹ï¼š
 ca-key.pem ca.pem kubernetes-key.pem kubernetes.pem kube-proxy.pem kube-proxy-key.pem admin.pem admin-key.pem  ä½¿ç”¨è¯ä¹¦çš„ç»„ä»¶å¦‚ä¸‹ï¼š
 etcdï¼šä½¿ç”¨ ca.pemã€kubernetes-key.pemã€kubernetes.pemï¼› kube-apiserverï¼šä½¿ç”¨ ca.pemã€kubernetes-key.pemã€kubernetes.pemï¼› kubeletï¼šä½¿ç”¨ ca.pemï¼› kube-proxyï¼šä½¿ç”¨ ca.pemã€kube-proxy-key.pemã€kube-proxy.pemï¼› kubectlï¼šä½¿ç”¨ ca.pemã€admin-key.pemã€admin.pemï¼›  kube-controllerã€kube-scheduler å½“å‰éœ€è¦å’Œ kube-apiserver éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šä¸”ä½¿ç”¨éå®‰å…¨ç«¯å£é€šä¿¡ï¼Œæ•…ä¸éœ€è¦è¯ä¹¦ã€‚
å®‰è£… CFSSL æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æºç åŒ…å®‰è£…
$ wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 $ chmod +x cfssl_linux-amd64 $ sudo mv cfssl_linux-amd64 /root/local/bin/cfssl $ wget https://pkg.</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Fluentdå’ŒElasticSearchæ”¶é›†Kubernetesé›†ç¾¤æ—¥å¿—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-fluentd-elasticsearch-installation/</link>
      <pubDate>Fri, 07 Apr 2017 20:13:24 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-fluentd-elasticsearch-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šç å¤´@å¤åŒ—æ°´é•‡ Apr 30,2016ï¼‰
å‰è¨€ åœ¨å®‰è£…å¥½äº†Kubernetesé›†ç¾¤ã€é…ç½®å¥½äº†flannelç½‘ç»œã€å®‰è£…äº†Kubernetes Dashboardå’Œé…ç½®Heapsterç›‘æ§æ’ä»¶åï¼Œè¿˜æœ‰ä¸€é¡¹é‡è¦çš„å·¥ä½œï¼Œä¸ºäº†è°ƒè¯•å’Œæ•…éšœæ’æŸ¥ï¼Œè¿˜éœ€è¦è¿›è¡Œæ—¥å¿—æ”¶é›†å·¥ä½œã€‚
å®˜æ–¹æ–‡æ¡£
Kubernetes Logging and Monitoring Cluster Activity
Logging Using Elasticsearch and Kibanaï¼šä¸è¿‡è¿™ç¯‡æ–‡ç« æ˜¯åœ¨GCEä¸Šé…ç½®çš„ï¼Œå‚è€ƒä»·å€¼ä¸å¤§ã€‚
å®¹å™¨æ—¥å¿—çš„å­˜åœ¨å½¢å¼ ç›®å‰å®¹å™¨æ—¥å¿—æœ‰ä¸¤ç§è¾“å‡ºå½¢å¼ï¼š
stdout,stderræ ‡å‡†è¾“å‡º
è¿™ç§å½¢å¼çš„æ—¥å¿—è¾“å‡ºæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨docker logsæŸ¥çœ‹æ—¥å¿—ï¼Œkubernetesé›†ç¾¤ä¸­åŒæ ·å¯ä»¥ä½¿ç”¨kubectl logsç±»ä¼¼çš„å½¢å¼æŸ¥çœ‹æ—¥å¿—ã€‚
æ—¥å¿—æ–‡ä»¶è®°å½•
è¿™ç§æ—¥å¿—è¾“å‡ºæˆ‘ä»¬æ— æ³•ä»ä»¥ä¸Šæ–¹æ³•æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼Œåªèƒ½tailæ—¥å¿—æ–‡ä»¶æŸ¥çœ‹ã€‚
Fluentdä»‹ç» Fluentdæ˜¯ä½¿ç”¨Rubyç¼–å†™çš„ï¼Œé€šè¿‡åœ¨åç«¯ç³»ç»Ÿä¹‹é—´æä¾›ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å±‚æ¥ä»åç«¯ç³»ç»Ÿä¸­è§£è€¦æ•°æ®æºã€‚ æ­¤å±‚å…è®¸å¼€å‘äººå‘˜å’Œæ•°æ®åˆ†æäººå‘˜åœ¨ç”Ÿæˆæ—¥å¿—æ—¶ä½¿ç”¨å¤šç§ç±»å‹çš„æ—¥å¿—ã€‚ ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å±‚å¯ä»¥è®©æ‚¨å’Œæ‚¨çš„ç»„ç»‡æ›´å¥½åœ°ä½¿ç”¨æ•°æ®ï¼Œå¹¶æ›´å¿«åœ°åœ¨æ‚¨çš„è½¯ä»¶ä¸Šè¿›è¡Œè¿­ä»£ã€‚ ä¹Ÿå°±æ˜¯è¯´fluentdæ˜¯ä¸€ä¸ªé¢å‘å¤šç§æ•°æ®æ¥æºä»¥åŠé¢å‘å¤šç§æ•°æ®å‡ºå£çš„æ—¥å¿—æ”¶é›†å™¨ã€‚å¦å¤–å®ƒé™„å¸¦äº†æ—¥å¿—è½¬å‘çš„åŠŸèƒ½ã€‚
Fluentdæ”¶é›†çš„eventç”±ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ç»„æˆï¼š
 Tagï¼šå­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ç‚¹éš”å¼€ï¼Œå¦‚myapp.access Timeï¼šUNIXæ—¶é—´æ ¼å¼ Recordï¼šJSONæ ¼å¼  Fluentdç‰¹ç‚¹  éƒ¨ç½²ç®€å•çµæ´» å¼€æº ç»è¿‡éªŒè¯çš„å¯é æ€§å’Œæ€§èƒ½ ç¤¾åŒºæ”¯æŒï¼Œæ’ä»¶è¾ƒå¤š ä½¿ç”¨jsonæ ¼å¼äº‹ä»¶æ ¼å¼ å¯æ‹”æ’çš„æ¶æ„è®¾è®¡ ä½èµ„æºè¦æ±‚ å†…ç½®é«˜å¯é æ€§  å®‰è£… æŸ¥çœ‹cluster/addons/fluentd-elasticsearchæ’ä»¶ç›®å½•ï¼Œè·å–åˆ°éœ€è¦ç”¨åˆ°çš„dockeré•œåƒåç§°ã€‚
$grep -rn &amp;quot;gcr.io&amp;quot; *.yaml es-controller.yaml:24: - image: gcr.io/google_containers/elasticsearch:v2.4.1-2 fluentd-es-ds.yaml:26: image: gcr.io/google_containers/fluentd-elasticsearch:1.22 kibana-controller.yaml:22: image: gcr.io/google_containers/kibana:v4.6.1-1  éœ€è¦ç”¨åˆ°çš„é•œåƒ
 gcr.io/google_containers/kibana:v4.6.1-1 gcr.io/google_containers/elasticsearch:v2.4.1-2 gcr.</description>
    </item>
    
    <item>
      <title>Kubernetesçš„ConfigMapè§£æ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-configmap-introduction/</link>
      <pubDate>Thu, 06 Apr 2017 21:24:20 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-configmap-introduction/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šé¾™å½¢ç¯ç¬¼@å¤åŒ—æ°´é•‡ Apr 30,2016ï¼‰
å‰è¨€ ä¸ºä»€ä¹ˆè¦ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨ä½¿ç”¨Fluentdå’ŒElasticSearchæ”¶é›†Kubernetesé›†ç¾¤æ—¥å¿—çš„æ—¶å€™é‡åˆ°äº†éœ€è¦ä¿®æ”¹é•œåƒä¸­é…ç½®çš„é—®é¢˜ï¼Œfluent-plugin-kubernetes_metadataé‡Œçš„éœ€è¦çš„td-agent.confæ–‡ä»¶ã€‚
å…¶å®ConfigMapåŠŸèƒ½åœ¨Kubernetes1.2ç‰ˆæœ¬çš„æ—¶å€™å°±æœ‰äº†ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºä¼šä»é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°æˆ–ç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚è¿™äº›é…ç½®ä¿¡æ¯éœ€è¦ä¸docker imageè§£è€¦ï¼Œä½ æ€»ä¸èƒ½æ¯ä¿®æ”¹ä¸€ä¸ªé…ç½®å°±é‡åšä¸€ä¸ªimageå§ï¼ŸConfigMap APIç»™æˆ‘ä»¬æä¾›äº†å‘å®¹å™¨ä¸­æ³¨å…¥é…ç½®ä¿¡æ¯çš„æœºåˆ¶ï¼ŒConfigMapå¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜æ•´ä¸ªé…ç½®æ–‡ä»¶æˆ–è€…JSONäºŒè¿›åˆ¶å¤§å¯¹è±¡ã€‚
ConfigMapæ¦‚è§ˆ ConfigMap APIèµ„æºç”¨æ¥ä¿å­˜key-value pairé…ç½®æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥åœ¨podsé‡Œä½¿ç”¨ï¼Œæˆ–è€…è¢«ç”¨æ¥ä¸ºåƒcontrollerä¸€æ ·çš„ç³»ç»Ÿç»„ä»¶å­˜å‚¨é…ç½®æ•°æ®ã€‚è™½ç„¶ConfigMapè·ŸSecretsç±»ä¼¼ï¼Œä½†æ˜¯ConfigMapæ›´æ–¹ä¾¿çš„å¤„ç†ä¸å«æ•æ„Ÿä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚ æ³¨æ„ï¼šConfigMapsä¸æ˜¯å±æ€§é…ç½®æ–‡ä»¶çš„æ›¿ä»£å“ã€‚ConfigMapsåªæ˜¯ä½œä¸ºå¤šä¸ªpropertiesæ–‡ä»¶çš„å¼•ç”¨ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºLinuxç³»ç»Ÿä¸­çš„/etcç›®å½•ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ConfigMapé…ç½®æ¥åˆ›å»ºKuberntes Volumesï¼ŒConfigMapä¸­çš„æ¯ä¸ªdataé¡¹éƒ½ä¼šæˆä¸ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚
kind: ConfigMap apiVersion: v1 metadata: creationTimestamp: 2016-02-18T19:14:38Z name: example-config namespace: default data: example.property.1: hello example.property.2: world example.property.file: |- property.1=value-1 property.2=value-2 property.3=value-3  dataä¸€æ åŒ…æ‹¬äº†é…ç½®æ•°æ®ï¼ŒConfigMapå¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚ é…ç½®æ•°æ®å¯ä»¥é€šè¿‡å¾ˆå¤šç§æ–¹å¼åœ¨Podsé‡Œè¢«ä½¿ç”¨ã€‚ConfigMapså¯ä»¥è¢«ç”¨æ¥ï¼š
 è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼ åœ¨å®¹å™¨é‡Œè®¾ç½®å‘½ä»¤è¡Œå‚æ•° åœ¨æ•°æ®å·é‡Œé¢åˆ›å»ºconfigæ–‡ä»¶  ç”¨æˆ·å’Œç³»ç»Ÿç»„ä»¶ä¸¤è€…éƒ½å¯ä»¥åœ¨ConfigMapé‡Œé¢å­˜å‚¨é…ç½®æ•°æ®ã€‚
å…¶å®ä¸ç”¨çœ‹ä¸‹é¢çš„æ–‡ç« ï¼Œç›´æ¥ä»kubectl create configmap -hçš„å¸®åŠ©ä¿¡æ¯ä¸­å°±å¯ä»¥å¯¹ConfigMapç©¶ç«Ÿå¦‚ä½•åˆ›å»ºç•¥çŸ¥ä¸€äºŒäº†ã€‚
Examples: # Create a new configmap named my-config based on folder bar kubectl create configmap my-config --from-file=path/to/bar # Create a new configmap named my-config with specified keys instead of file basenames on disk kubectl create configmap my-config --from-file=key1=/path/to/bar/file1.</description>
    </item>
    
    <item>
      <title>Kubernetes heapsterç›‘æ§æ’ä»¶å®‰è£…æ–‡æ¡£</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/</link>
      <pubDate>Wed, 05 Apr 2017 18:41:19 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šå—‘çŒ«è–„è·çš„ç™½åŒ–å­ŸåŠ æ‹‰è™@åŒ—äº¬åŠ¨ç‰©å›­ Apr 3,2017ï¼‰
å‰è¨€ å‰é¢å‡ ç¯‡æ–‡ç« ä¸­è®°å½•äº†æˆ‘ä»¬å®‰è£…å¥½äº†Kubernetesé›†ç¾¤ã€é…ç½®å¥½äº†flannelç½‘ç»œã€å®‰è£…äº†Kubernetes Dashboardï¼Œä½†æ˜¯è¿˜æ²¡æ³•æŸ¥çœ‹Podçš„ç›‘æ§ä¿¡æ¯ï¼Œè™½ç„¶kubeleté»˜è®¤é›†æˆäº†cAdvisorï¼ˆåœ¨æ¯ä¸ªnodeçš„4194ç«¯å£å¯ä»¥æŸ¥çœ‹åˆ°ï¼‰ï¼Œä½†æ˜¯å¾ˆä¸æ–¹ä¾¿ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©å®‰è£…heapsterã€‚
å®‰è£… ä¸‹è½½heapsterçš„ä»£ç 
ç›´æ¥ç°åœ¨Githubä¸Šçš„æœ€æ–°ä»£ç ã€‚
git pull https://github.com/kubernetes/heapster.git  ç›®å‰çš„æœ€é«˜ç‰ˆæœ¬æ˜¯1.3.0ã€‚
åœ¨heapster/deploy/kube-config/influxdbç›®å½•ä¸‹æœ‰å‡ ä¸ªyamlæ–‡ä»¶ï¼š
grafana-deployment.yaml grafana-service.yaml heapster-deployment.yaml heapster-service.yaml influxdb-deployment.yaml influxdb-service.yaml  æˆ‘ä»¬å†çœ‹ä¸‹ç”¨äº†å“ªäº›é•œåƒï¼š
grafana-deployment.yaml:16: image: gcr.io/google_containers/heapster-grafana-amd64:v4.0.2 heapster-deployment.yaml:16: image: gcr.io/google_containers/heapster-amd64:v1.3.0-beta.1 influxdb-deployment.yaml:16: image: gcr.io/google_containers/heapster-influxdb-amd64:v1.1.1  ä¸‹è½½é•œåƒ
æˆ‘ä»¬ä¸‹è½½å¥½äº†è¿™äº›imagesåï¼Œå­˜å‚¨åˆ°ç§æœ‰é•œåƒä»“åº“é‡Œï¼š
 sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-amd64:v1.3.0-beta.1 sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-grafana-amd64:v4.0.2 sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-influxdb-amd64:v1.1.1  æˆ‘å·²ç»å°†å®˜æ–¹é•œåƒå…‹éš†åˆ°äº†æ—¶é€Ÿäº‘ä¸Šï¼Œé•œåƒåœ°å€ï¼š
 index.tenxcloud.com/jimmy/heapster-amd64:v1.3.0-beta.1 index.tenxcloud.com/jimmy/heapster-influxdb-amd64:v1.1.1 index.tenxcloud.com/jimmy/heapster-grafana-amd64:v4.0.2  éœ€è¦çš„å¯ä»¥å»ä¸‹è½½ï¼Œä¸‹è½½å‰éœ€è¦ç”¨æ—¶é€Ÿäº‘è´¦æˆ·ç™»é™†ï¼Œç„¶åå†æ‰§è¡Œpullæ“ä½œã€‚
docker login index.tendcloud.com  é…ç½® å‚è€ƒRun Heapster in a Kubernetes cluster with an InfluxDB backend and a Grafana UIå’ŒConfiguring Sourceï¼Œéœ€è¦ä¿®æ”¹yamlæ–‡ä»¶ä¸­çš„å‡ ä¸ªé…ç½®ã€‚
 é¦–å…ˆä¿®æ”¹ä¸‰ä¸ªdeployment.yamlæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„é•œåƒæ–‡ä»¶åœ°å€æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“çš„ ä¿®æ”¹heapster-deployment.</description>
    </item>
    
    <item>
      <title>Kubernetes Dashboard/Web UIå®‰è£…å…¨è®°å½•</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/</link>
      <pubDate>Wed, 05 Apr 2017 14:28:51 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šæ™’å¤ªé˜³çš„è¢‹é¼ @åŒ—äº¬åŠ¨ç‰©å›­ Apr 3,2017ï¼‰
å‰è¨€ å‰å‡ å¤©åœ¨CentOS7.2ä¸Šå®‰è£…Kubernetes1.6å’Œå®‰è£…å¥½flannelç½‘ç»œé…ç½®ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å®‰è£…ä¸‹kuberentnesçš„dashboardã€‚
Dashboardæ˜¯Kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä»£ç åœ¨å•ç‹¬çš„å¼€æºé¡¹ç›®é‡Œã€‚1å¹´å‰è¿˜æ˜¯ç‰¹åˆ«ç®€å•çš„ä¸€ä¸ªUIï¼Œåªèƒ½åœ¨ä¸Šé¢æŸ¥çœ‹podçš„ä¿¡æ¯å’Œéƒ¨ç½²podè€Œå·²ï¼Œç°åœ¨å·²ç»åšçš„è·ŸDocker Enterprise Editionçš„Docker Datacenterå¾ˆåƒäº†ã€‚
å®‰è£…Dashboard å®˜ç½‘çš„å®‰è£…æ–‡æ¡£https://kubernetes.io/docs/user-guide/ui/ï¼Œå…¶å®å®˜ç½‘æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨ç°æˆçš„imageæ¥ç”¨kuberneteséƒ¨ç½²å³å¯ã€‚
é¦–å…ˆéœ€è¦ä¸€ä¸ªkubernetes-dashboard.yamlçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨Githubçš„src/deploy/kubernetes-dashboard.yamlä¸‹è½½ã€‚
æˆ‘ä»¬èƒ½çœ‹ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š
# Copyright 2015 Google Inc. All Rights Reserved. # # Licensed under the Apache License, Version 2.0 (the &amp;quot;License&amp;quot;); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an &amp;quot;AS IS&amp;quot; BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</description>
    </item>
    
    <item>
      <title>KubernetesåŸºäºflannelçš„ç½‘ç»œé…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-network-config/</link>
      <pubDate>Fri, 31 Mar 2017 11:05:18 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-network-config/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šè¥¿å®‰é¼“æ¥¼ Oct 4,2014ï¼‰
ä¹¦æ¥ä¸Šæ–‡åœ¨CentOSä¸­å®‰è£…Kubernetesè¯¦ç»†æŒ‡å—ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼Œä½œä¸ºå­¦ä¹ Kubernetesçš„å¿ƒè·¯å†ç¨‹å§ã€‚
æœ¬æ–‡ä¸»è¦è®²è§£Kubernetesçš„ç½‘ç»œé…ç½®ï¼ŒğŸ‘†æ–‡ä¸­æœ‰ä¸€ä¸ªå®‰è£…Flannelçš„æ­¥éª¤ï¼Œä½†æ˜¯å®‰è£…å¥½åå¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®è¯´æ˜ã€‚
é…ç½®flannel æˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„yumå®‰è£…çš„flannleï¼Œå®‰è£…å¥½åä¼šç”Ÿæˆ/usr/lib/systemd/system/flanneld.serviceé…ç½®æ–‡ä»¶ã€‚
[Unit] Description=Flanneld overlay address etcd agent After=network.target After=network-online.target Wants=network-online.target After=etcd.service Before=docker.service [Service] Type=notify EnvironmentFile=/etc/sysconfig/flanneld EnvironmentFile=-/etc/sysconfig/docker-network ExecStart=/usr/bin/flanneld-start $FLANNEL_OPTIONS ExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker Restart=on-failure [Install] WantedBy=multi-user.target RequiredBy=docker.service  å¯ä»¥çœ‹åˆ°flannelç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶åœ¨/etc/sysconfig/flanneldã€‚
# Flanneld configuration options # etcd url location. Point this to the server where etcd runs FLANNEL_ETCD_ENDPOINTS=&amp;quot;http://sz-pg-oam-docker-test-001.tendcloud.com:2379&amp;quot; # etcd config key. This is the configuration key that flannel queries # For address range assignment FLANNEL_ETCD_PREFIX=&amp;quot;/kube-centos/network&amp;quot; # Any additional options that you want to pass #FLANNEL_OPTIONS=&amp;quot;&amp;quot;   etcdçš„åœ°å€FLANNEL_ETCD_ENDPOINT etcdæŸ¥è¯¢çš„ç›®å½•ï¼ŒåŒ…å«dockerçš„IPåœ°å€æ®µé…ç½®ã€‚FLANNEL_ETCD_PREFIX  åœ¨etcdä¸­åˆ›å»ºç½‘ç»œé…ç½®</description>
    </item>
    
    <item>
      <title>åœ¨CentOSä¸Šå®‰è£…kubernetesè¯¦ç»†æŒ‡å—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/</link>
      <pubDate>Thu, 30 Mar 2017 20:44:20 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/</guid>
      <description>ï¼ˆé¢˜å›¾ï¼šåŒ—äº¬åœ†æ˜å›­ Aug 25,2014ï¼‰
ä½œè€…ï¼šJimmy Songï¼ŒPeter Maï¼Œ2017å¹´3æœˆ30æ—¥
æœ€è¿‘å†³å®šä»Docker Swarm ModeæŠ•å…¥åˆ°Kubernetesçš„æ€€æŠ±ï¼Œå¯¹Dockerçš„æˆ˜ç•¥å’Œä¼ä¸šåŒ–å‘å±•å‰æ™¯æ¯”è¾ƒå ªå¿§ï¼Œè€ŒKubernetesæ˜¯CNCFçš„æˆå‘˜ä¹‹ä¸€ã€‚
è¿™ç¯‡æ˜¯æ ¹æ®å®˜æ–¹å®‰è£…æ–‡æ¡£å®è·µæ•´ç†çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯çº¯å‡€çš„CentOS7.2ã€‚
å¦å¤–è¿˜æœ‰ä¸€ä¸ªPeter Maå†™çš„åœ¨CentOSä¸Šæ‰‹åŠ¨å®‰è£…kubernetesçš„æ–‡æ¡£å¯ä»¥å‚è€ƒã€‚
è§’è‰²åˆ†é…
ä¸‹é¢ä»¥åœ¨ä¸‰å°ä¸»æœºä¸Šå®‰è£…Kubernetesä¸ºä¾‹ã€‚
172.20.0.113 master/node kube-apiserver kube-controller-manager kube-scheduler kubelet kube-proxy etcd flannel 172.20.0.114 node kubectl kube-proxy flannel 172.20.0.115 node kubectl kube-proxy flannel  ç¬¬ä¸€å°ä¸»æœºæ—¢ä½œä¸ºmasterä¹Ÿä½œä¸ºnodeã€‚
ç³»ç»Ÿç¯å¢ƒ
 Centos 7.2.1511 docker 1.12.6 etcd 3.1.5 kubernetes 1.6.0 flannel 0.7.0-1  å®‰è£… ä¸‹é¢ç»™å‡ºä¸¤ç§å®‰è£…æ–¹å¼ï¼š
 é…ç½®yumæºåï¼Œä½¿ç”¨yumå®‰è£…ï¼Œå¥½å¤„æ˜¯ç®€å•ï¼Œåå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œéœ€è¦googleæ›´æ–°yumæºæ‰èƒ½è·å¾—æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶ï¼Œè€Œæ‰€æœ‰è½¯ä»¶çš„ä¾èµ–åˆä¸èƒ½è‡ªå·±æŒ‡å®šï¼Œå°¤å…¶æ˜¯ä½ çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å¦‚æœä½çš„è¯ï¼Œä½¿ç”¨yumæºå®‰è£…çš„kubernetesçš„ç‰ˆæœ¬ä¹Ÿä¼šå—åˆ°é™åˆ¶ã€‚ ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ï¼Œå¥½å¤„æ˜¯å¯ä»¥å®‰è£…ä»»æ„ç‰ˆæœ¬çš„kubernetesï¼Œåå¤„æ˜¯é…ç½®æ¯”è¾ƒå¤æ‚ã€‚  æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼å®‰è£…ã€‚
æœ¬æ–‡çš„å¾ˆå¤šå®‰è£…æ­¥éª¤å’Œå‘½ä»¤æ˜¯å‚è€ƒçš„Kuberneteså®˜ç½‘CentOS Manual Configæ–‡æ¡£ã€‚
ç¬¬ä¸€ç§æ–¹å¼ï¼šCentOSç³»ç»Ÿä¸­ç›´æ¥ä½¿ç”¨yumå®‰è£… ç»™yumæºå¢åŠ ä¸€ä¸ªRepo
[virt7-docker-common-release] name=virt7-docker-common-release baseurl=http://cbs.centos.org/repos/virt7-docker-common-release/x86_64/os/ gpgcheck=0  å®‰è£…dockerã€kubernetesã€etcdã€flannelä¸€æ­¥åˆ°ä½
yum -y install --enablerepo=virt7-docker-common-release kubernetes etcd flannel  å®‰è£…å¥½äº†ä¹‹åéœ€è¦ä¿®æ”¹ä¸€ç³»åˆ—é…ç½®æ–‡ä»¶ã€‚</description>
    </item>
    
    <item>
      <title>Docker v.s Kubernetes part2</title>
      <link>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part2/</link>
      <pubDate>Fri, 10 Mar 2017 22:06:32 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part2/</guid>
      <description> ï¼ˆé¢˜å›¾ï¼šæ²³åŒ—æ‰¿å¾·å…´éš†å¿é›¾çµå±±äº¬éƒŠæœ€ä½³æ˜Ÿç©ºæ‹æ‘„ç‚¹ July 9,2016)
æœ¬æ–‡æ˜¯Docker v.s Kubernetesç¬¬äºŒç¯‡ï¼Œç»­æ¥ä¸Šæ–‡Docker v.s Kuberntes Part1ã€‚
Kubernetesæ˜¯å…¸å‹çš„Master/Slaveæ¶æ„æ¨¡å¼ï¼Œæœ¬æ–‡ç®€è¦çš„ä»‹ç»kubenetesçš„æ¶æ„å’Œç»„ä»¶æ„æˆã€‚
Kubernetesæ ¸å¿ƒæ¶æ„ masterèŠ‚ç‚¹  apiserverï¼šä½œä¸ºkubernetesç³»ç»Ÿçš„å…¥å£ï¼Œå°è£…äº†æ ¸å¿ƒå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»¥RESTFulæ¥å£æ–¹å¼æä¾›ç»™å¤–éƒ¨å®¢æˆ·å’Œå†…éƒ¨ç»„ä»¶è°ƒç”¨ã€‚å®ƒç»´æŠ¤çš„RESTå¯¹è±¡å°†æŒä¹…åŒ–åˆ°etcdï¼ˆä¸€ä¸ªåˆ†å¸ƒå¼å¼ºä¸€è‡´æ€§çš„key/valueå­˜å‚¨ï¼‰ã€‚ schedulerï¼šè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ï¼Œä¸ºæ–°å»ºçš„Podåˆ†é…æœºå™¨ã€‚è¿™éƒ¨åˆ†å·¥ä½œåˆ†å‡ºæ¥å˜æˆä¸€ä¸ªç»„ä»¶ï¼Œæ„å‘³ç€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢æˆå…¶ä»–çš„è°ƒåº¦å™¨ã€‚ controller-managerï¼šè´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰æœ‰ä¸¤ç±»ï¼š  endpoint-controllerï¼šå®šæœŸå…³è”serviceå’ŒPod(å…³è”ä¿¡æ¯ç”±endpointå¯¹è±¡ç»´æŠ¤)ï¼Œä¿è¯serviceåˆ°Podçš„æ˜ å°„æ€»æ˜¯æœ€æ–°çš„ã€‚ replication-controllerï¼šå®šæœŸå…³è”replicationControllerå’ŒPodï¼Œä¿è¯replicationControllerå®šä¹‰çš„å¤åˆ¶æ•°é‡ä¸å®é™…è¿è¡ŒPodçš„æ•°é‡æ€»æ˜¯ä¸€è‡´çš„ã€‚   nodeèŠ‚ç‚¹  kubeletï¼šè´Ÿè´£ç®¡æ§dockerå®¹å™¨ï¼Œå¦‚å¯åŠ¨/åœæ­¢ã€ç›‘æ§è¿è¡ŒçŠ¶æ€ç­‰ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–åˆ†é…åˆ°æœ¬æœºçš„Podï¼Œå¹¶æ ¹æ®Podä¿¡æ¯å¯åŠ¨æˆ–åœæ­¢ç›¸åº”çš„å®¹å™¨ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¼šæ¥æ”¶apiserverçš„HTTPè¯·æ±‚ï¼Œæ±‡æŠ¥Podçš„è¿è¡ŒçŠ¶æ€ã€‚ proxyï¼šè´Ÿè´£ä¸ºPodæä¾›ä»£ç†ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–æ‰€æœ‰çš„serviceï¼Œå¹¶æ ¹æ®serviceä¿¡æ¯åˆ›å»ºä»£ç†ã€‚å½“æŸä¸ªå®¢æˆ·Podè¦è®¿é—®å…¶ä»–Podæ—¶ï¼Œè®¿é—®è¯·æ±‚ä¼šç»è¿‡æœ¬æœºproxyåšè½¬å‘ã€‚  Kubernetesç»„ä»¶è¯¦ç»†ä»‹ç» etcd è™½ç„¶ä¸æ˜¯Kubernetesçš„ç»„ä»¶ä½†æ˜¯æœ‰å¿…è¦æä¸€ä¸‹ï¼Œetcdæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ååŒæ•°æ®åº“ï¼ŒåŸºäºGoè¯­è¨€å¼€å‘ï¼ŒCoreOSå…¬å¸å‡ºå“ï¼Œä½¿ç”¨raftä¸€è‡´æ€§ç®—æ³•ååŒã€‚Kubernetesçš„ä¸»æ•°æ®åº“ï¼Œåœ¨å®‰è£…kubernetesä¹‹å‰å°±è¦å…ˆå®‰è£…å®ƒï¼Œå¾ˆå¤šå¼€æºä¸‹é¡¹ç›®éƒ½ç”¨åˆ°ï¼Œè€ç‰ˆæœ¬çš„docker swarmä¹Ÿç”¨åˆ°äº†å®ƒã€‚ç›®å‰ä¸»è¦ä½¿ç”¨çš„æ˜¯2.7.xç‰ˆæœ¬ï¼Œ3.0+ç‰ˆæœ¬çš„APIå˜åŒ–å¤ªå¤§ã€‚
APIServer APIServerè´Ÿè´£å¯¹å¤–æä¾›kubernetes APIæœåŠ¡ï¼Œå®ƒè¿è¡Œåœ¨masterèŠ‚ç‚¹ä¸Šã€‚ä»»ä½•å¯¹èµ„æºçš„å¢åˆ æ”¹æŸ¥éƒ½è¦äº¤ç»™APIServerå¤„ç†åæ‰èƒ½æäº¤ç»™etcdã€‚APIServeræ€»ä½“ä¸Šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šHTTP/HTTPSæœåŠ¡å’Œä¸€äº›åŠŸèƒ½æ€§æ’ä»¶ã€‚è¿™äº›åŠŸèƒ½æ€§æ’ä»¶åˆåˆ†ä¸ºä¸¤ç§ï¼šä¸€éƒ¨åˆ†ä¸åº•å±‚IaaSå¹³å°ï¼ˆCloud Provideï¼‰ç›¸å…³ï¼›å¦ä¸€éƒ¨åˆ†ä¸èµ„æºç®¡ç†æ§åˆ¶ï¼ˆAdmission Controlï¼‰ç›¸å…³ã€‚
Scheduler Schedulerçš„ä½œç”¨æ˜¯æ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å°†podè°ƒåº¦åˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºç»‘å®šã€‚Schedulerè°ƒåº¦å™¨çš„è¾“å…¥æ˜¯å¾…è°ƒåº¦çš„podå’Œå¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ï¼Œè¾“å‡ºåˆ™æ˜¯ä¸€ä¸ªå·²ç»ç»‘å®šäº†podçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯é€šè¿‡è°ƒåº¦ç®—æ³•åœ¨å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©çš„æœ€ä¼˜èŠ‚ç‚¹ã€‚
å·¥ä½œèŠ‚ç‚¹ä»å“ªé‡Œæ¥ï¼Ÿå·¥ä½œèŠ‚ç‚¹å¹¶ä¸æ˜¯ç”±Kubernetesåˆ›å»ºï¼Œå®ƒæ˜¯ç”±IaaSå¹³å°åˆ›å»ºï¼Œæˆ–è€…å°±æ˜¯ç”±ç”¨æˆ·ç®¡ç†çš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚ä½†æ˜¯Kubernetesä¼šåˆ›å»ºä¸€ä¸ªNodeå¯¹è±¡ï¼Œç”¨æ¥æè¿°è¿™ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚æè¿°çš„å…·ä½“ä¿¡æ¯ç”±åˆ›å»ºNodeå¯¹è±¡çš„é…ç½®æ–‡ä»¶ç»™å‡ºã€‚ä¸€æ—¦ç”¨æˆ·åˆ›å»ºèŠ‚ç‚¹çš„è¯·æ±‚è¢«æˆåŠŸå¤„ç†ï¼ŒKubernetesåˆä¼šç«‹å³åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªnodeå¯¹è±¡ï¼Œå†å»æ£€æŸ¥è¯¥èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µã€‚åªæœ‰é‚£äº›å½“å‰å¯ç”¨çš„nodeæ‰ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èŠ‚ç‚¹å¹¶å…è®¸podè°ƒåº¦åˆ°ä¸Šé¢è¿è¡Œã€‚
å·¥ä½œèŠ‚ç‚¹å¯ä»¥é€šè¿‡èµ„æºé…ç½®æ–‡ä»¶æˆ–è€…kubectlå‘½ä»¤è¡Œå·¥å…·æ¥åˆ›å»ºã€‚Kubernetesä¸»è¦ç»´æŠ¤å·¥ä½œèŠ‚ç‚¹çš„ä¸¤ä¸ªå±æ€§ï¼šspecå’Œstatusæ¥æè¿°ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„æœŸæœ›çŠ¶æ€å’Œå½“å‰çŠ¶æ€ã€‚å…¶ä¸­ï¼Œæ‰€è°“çš„å½“å‰çŠ¶æ€ä¿¡æ¯ç”±3ä¸ªä¿¡æ¯ç»„æˆï¼šHostIpã€NodePhaseå’ŒNode Conditionã€‚
å·¥ä½œèŠ‚ç‚¹çš„åŠ¨æ€ç»´æŠ¤è¿‡ç¨‹ä¾é Node Controlleræ¥å®Œæˆï¼Œå®ƒæ˜¯Kubernetes Controller Managerä¸‹å±çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚å®ƒä¼šä¸€ç›´ä¸æ–­çš„æ£€æŸ¥Kuberneteså·²çŸ¥çš„æ¯å°nodeèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœä¸€ä¸ªä¹‹å‰å·²ç»å¤±è´¥çš„èŠ‚ç‚¹åœ¨è¿™ä¸ªæ£€æŸ¥å¾ªç¯ä¸­è¢«æ£€æŸ¥ä¸ºå¯ä»¥å·¥ä½œçš„ï¼Œé‚£ä¹ˆNode Controllerä¼šæŠŠè¿™ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°å·¥ä½œèŠ‚ç‚¹ä¸­ï¼ŒNode Controllerä¼šä»å·¥ä½œèŠ‚ç‚¹ä¸­åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ã€‚
Controller Manager Controller Managerè¿è¡Œåœ¨é›†ç¾¤çš„MasterèŠ‚ç‚¹ä¸Šï¼Œæ˜¯åŸºäºpod APIçš„ä¸€ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œå®ƒé‡ç‚¹å®ç°service Endpointï¼ˆæœåŠ¡ç«¯ç‚¹ï¼‰çš„åŠ¨æ€æ›´æ–°ã€‚ç®¡ç†ç€Kubernetesé›†ç¾¤ä¸­å„ç§æ§åˆ¶èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬replication Controllerå’Œnode Controllerã€‚
ä¸APIServerç›¸æ¯”ï¼ŒAPIServerè´Ÿè´£æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶åˆ›å»ºå¯¹åº”çš„èµ„æºï¼Œè€ŒController Manageråœ¨ç³»ç»Ÿä¸­æ‰®æ¼”çš„è§’è‰²æ˜¯åœ¨ä¸€æ—æ—é»˜é»˜çš„ç®¡æ§è¿™äº›èµ„æºï¼Œç¡®ä¿ä»–ä»¬æ°¸è¿œä¿æŒåœ¨é¢„æœŸçš„çŠ¶æ€ã€‚å®ƒé‡‡ç”¨å„ç§ç®¡ç†å™¨å®šæ—¶çš„å¯¹podã€èŠ‚ç‚¹ç­‰èµ„æºè¿›è¡Œé¢„è®¾çš„æ£€æŸ¥ï¼Œç„¶ååˆ¤æ–­å‡ºäºé¢„æœŸçš„æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´ï¼Œåˆ™é€šçŸ¥APIServeré‡‡å–è¡ŒåŠ¨ï¼Œæ¯”å¦‚é‡å¯ã€è¿ç§»ã€åˆ é™¤ç­‰ã€‚
kubelet kubeletç»„ä»¶å·¥ä½œåœ¨Kubernetesçš„nodeä¸Šï¼Œè´Ÿè´£ç®¡ç†å’Œç»´æŠ¤åœ¨è¿™å°ä¸»æœºä¸Šè¿è¡Œç€çš„æ‰€æœ‰å®¹å™¨ã€‚ kubeletä¸cAdvisoräº¤äº’æ¥æŠ“å–dockerå®¹å™¨å’Œä¸»æœºçš„èµ„æºä¿¡æ¯ã€‚ kubeletåƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒåŒ…æ‹¬å®¹å™¨åƒåœ¾å›æ”¶å’Œé•œåƒåƒåœ¾å›æ”¶ã€‚ kubeletå·¥ä½œèŠ‚ç‚¹çŠ¶æ€åŒæ­¥ã€‚
kube-proxy kube-proxyæä¾›ä¸¤ç§åŠŸèƒ½:
 æä¾›ç®—æ³•å°†å®¢æœç«¯æµé‡è´Ÿè½½å‡è¡¡åˆ°serviceå¯¹åº”çš„ä¸€ç»„åç«¯podã€‚ ä½¿ç”¨etcdçš„watchæœºåˆ¶ï¼Œå®ç°æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œç»´æŠ¤ä¸€å¼ ä»serviceåˆ°endpointçš„æ˜ å°„å…³ç³»ï¼Œä»è€Œä¿è¯åç«¯podçš„IPå˜åŒ–ä¸ä¼šå¯¹è®¿é—®è€…çš„è®¿é—®é€ æˆå½±å“ã€‚  </description>
    </item>
    
    <item>
      <title>Docker v.s Kubernetes part1</title>
      <link>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/</link>
      <pubDate>Fri, 10 Mar 2017 21:09:47 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/</guid>
      <description> ï¼ˆé¢˜å›¾ï¼šæ­å·è¥¿æ¹– Oct 16,2016ï¼‰
å‰è¨€ è¿™ä¸€ç³»åˆ—æ–‡ç« æ˜¯å¯¹æ¯”kubernetes å’Œdockerä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼Œé‰´äºæˆ‘ä¹‹å‰ä»docker1.10.3èµ·å¼€å§‹ä½¿ç”¨dockerï¼Œå¯¹åŸç”Ÿdockerçš„äº†è§£æ¯”è¾ƒå¤šï¼Œæœ€è¿‘åˆæ­£åœ¨çœ‹Kunernetesæƒå¨æŒ‡å—ï¼ˆç¬¬äºŒç‰ˆï¼‰è¿™æœ¬ä¹¦ï¼ˆP.Sæ„Ÿè°¢ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾çš„ç¼–è¾‘æœ‹å‹èµ é€æ­¤ä¹¦ï¼‰ã€‚è¿™ç³»åˆ—æ–‡ç« ä¸æ˜¯ä¸ºäº†æ¯”è¾ƒå­°ä¼˜å­°åŠ£ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ã€‚
æ­¤ç³»åˆ—æ–‡ç« ä¸­æ‰€è¯´çš„dockeræŒ‡çš„æ˜¯*17.03-ce*ç‰ˆæœ¬ã€‚
æ¦‚å¿µæ€§çš„å·®åˆ« Kubernetes
äº†è§£ä¸€æ ·ä¸œè¥¿é¦–å…ˆè¦é«˜å±‹å»ºç“´çš„äº†è§£å®ƒçš„æ¦‚å¿µï¼ŒkubernetesåŒ…æ‹¬ä»¥ä¸‹å‡ ç§èµ„æºå¯¹è±¡ï¼š
 Pod Service Volume Namespace ReplicaSet Deployment StatefulSet DaemonSet Job  Docker
Dockerçš„èµ„æºå¯¹è±¡ç›¸å¯¹äºkubernetesæ¥è¯´å°±ç®€å•å¤šäº†ï¼Œåªæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š
 Service Node Stack Docker  å°±è¿™ä¹ˆç®€å•ï¼Œä½¿ç”¨ä¸€ä¸ª*docker-compose.yml*å³å¯ä»¥å¯åŠ¨ä¸€ç³»åˆ—æœåŠ¡ã€‚å½“ç„¶ç®€å•çš„å¥½å¤„æ˜¯ä¾¿äºç†è§£å’Œç®¡ç†ï¼Œä½†æ˜¯åœ¨åŠŸèƒ½æ–¹é¢å°±æ²¡æœ‰kubernetesé‚£ä¹ˆå¼ºå¤§äº†ã€‚
åŠŸèƒ½æ€§å·®åˆ«  Kubernetes èµ„æºé™åˆ¶ CPU 100måƒåˆ†ä¹‹ä¸€æ ¸ä¸ºå•ä½ï¼Œç»å¯¹å€¼ï¼Œrequests å’Œlimitsï¼Œè¶…è¿‡è¿™ä¸ªå€¼å¯èƒ½è¢«æ€æ‰ï¼Œèµ„æºé™åˆ¶åŠ›åº¦æ¯”dockeræ›´ç»†ã€‚ Podä¸­æœ‰ä¸ªæœ€åº•å±‚çš„pause å®¹å™¨ï¼Œå…¶ä»–ä¸šåŠ¡å®¹å™¨å…±ç”¨ä»–çš„IPï¼Œdockerå› ä¸ºæ²¡æœ‰è¿™å±‚æ¦‚å¿µï¼Œæ‰€ä»¥æ²¡æ³•å…±ç”¨IPï¼Œè€Œæ˜¯ä½¿ç”¨overlayç½‘ç»œåŒå¤„äºä¸€ä¸ªç½‘ç»œé‡Œæ¥é€šä¿¡ã€‚ Kubernetesåœ¨rcä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ä¼ é€’é…ç½®ï¼ˆ1.3ç‰ˆæœ¬æ˜¯è¿™æ ·çš„ï¼Œåç»­ç‰ˆæœ¬è¿˜æ²¡æœ‰ç ”ç©¶è¿‡ï¼‰ Kuberentes Label å¯ä»¥åœ¨å¼€å§‹å’ŒåŠ¨æ€çš„æ·»åŠ ä¿®æ”¹ï¼Œæ‰€æœ‰çš„èµ„æºå¯¹è±¡éƒ½æœ‰ï¼Œè¿™ä¸€ç‚¹dockerä¹Ÿæœ‰ï¼Œä½†æ˜¯èµ„æºè°ƒåº¦å› ä¸ºæ²¡æœ‰kubernetesé‚£ä¹ˆå±‚çº§ï¼Œæ‰€æœ‰è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ã€‚ Kuberneteså¯¹è±¡é€‰æ‹©æœºåˆ¶ç»§ç»­é€šè¿‡label selectorï¼Œç”¨äºå¯¹è±¡è°ƒåº¦ã€‚ Kubernetesä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„é•œåƒï¼Œå«åšgoogle_containers/pauseï¼Œè¿™ä¸ªé•œåƒæ˜¯ç”¨æ¥å®ç°Podæ¦‚å¿µçš„ã€‚ HPA horizontal pod autoscaling æ¨ªå‘ç§»åŠ¨æ‰©å®¹ï¼Œä¹Ÿæ˜¯ä¸€ç§èµ„æºå¯¹è±¡ï¼Œæ ¹æ®è´Ÿè½½å˜åŒ–æƒ…å†µé’ˆå¯¹æ€§çš„è°ƒæ•´podç›®æ ‡å‰¯æœ¬æ•°ã€‚ Kubernetesä¸­æœ‰ä¸‰ä¸ªIPï¼ŒNode,Pod,Cluster IPçš„å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œdockerä¸­æ²¡æœ‰Cluster IPçš„æ¦‚å¿µã€‚ æŒä¹…åŒ–å­˜å‚¨ï¼Œåœ¨Kubernetesä¸­æœ‰Persistent volume åªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨ï¼Œä¸å±äºä»»ä½•nodeï¼Œç‹¬ç«‹äºpodä¹‹å¤–ï¼Œè€Œdockeråªèƒ½ä½¿ç”¨volume pluginã€‚ å¤šç§Ÿæˆ·ç®¡ç†ï¼Œkubernetesä¸­æœ‰`Namespaceï¼Œdockeræš‚æ—¶æ²¡æœ‰å¤šç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ã€‚  æ€»ä½“æ¥è¯´Dockeræ¶æ„æ›´åŠ ç®€å•ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„é…ç½®ï¼Œåªéœ€è¦æ¯ä¸ªç»“ç‚¹éƒ½å®‰è£…dockerå³å¯ï¼Œè°ƒåº¦å’Œç®¡ç†åŠŸèƒ½æ²¡kubernetesé‚£ä¹ˆå¤æ‚ã€‚ä½†æ˜¯kubernetesæœ¬èº«å°±æ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®ä¸­å¿ƒç®¡ç†å·¥å…·ï¼Œä¸ä»…å¯ä»¥ç”¨æ¥ç®¡ç†dockerï¼Œ*pod*è¿™ä¸ªæ¦‚å¿µé‡Œå°±å¯ä»¥è¿è¡Œä¸ä»…æ˜¯dockeräº†ã€‚
 ä»¥åçš„æ–‡ç« ä¸­å°†ç»“åˆdockerç€é‡è®²Kubernetesï¼ŒåŸºäº1.3ç‰ˆæœ¬ã€‚
 </description>
    </item>
    
  </channel>
</rss>