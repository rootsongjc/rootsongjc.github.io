<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubernetes on Jimmy Song&#39;s Blog</title>
    <link>http://rootsongjc.github.io/tags/kubernetes/index.xml</link>
    <description>Recent content in Kubernetes on Jimmy Song&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://rootsongjc.github.io/tags/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Kubernetesçš„ConfigMapè§£æ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-configmap-introduction/</link>
      <pubDate>Thu, 06 Apr 2017 21:24:20 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-configmap-introduction/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160430004.jpg&#34; alt=&#34;å¤åŒ—æ°´é•‡&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šé¾™å½¢ç¯ç¬¼@å¤åŒ—æ°´é•‡ Apr 30,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ä¸ºä»€ä¹ˆè¦ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨&lt;a href=&#34;rootsongjc.github.io/blogs/kubernetes-fluentd-elasticsearch-installation&#34;&gt;ä½¿ç”¨Fluentdå’ŒElasticSearchæ”¶é›†Kubernetesé›†ç¾¤æ—¥å¿—&lt;/a&gt;çš„æ—¶å€™é‡åˆ°äº†éœ€è¦ä¿®æ”¹é•œåƒä¸­é…ç½®çš„é—®é¢˜ï¼Œ&lt;a href=&#34;https://github.com/fabric8io/fluent-plugin-kubernetes_metadata_filter&#34;&gt;fluent-plugin-kubernetes_metadata&lt;/a&gt;é‡Œçš„éœ€è¦çš„&lt;a href=&#34;https://github.com/kubernetes/kubernetes/blob/master/cluster/addons/fluentd-elasticsearch/fluentd-es-image/td-agent.conf&#34;&gt;td-agent.conf&lt;/a&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®ConfigMapåŠŸèƒ½åœ¨Kubernetes1.2ç‰ˆæœ¬çš„æ—¶å€™å°±æœ‰äº†ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºä¼šä»é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°æˆ–ç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚è¿™äº›é…ç½®ä¿¡æ¯éœ€è¦ä¸docker imageè§£è€¦ï¼Œä½ æ€»ä¸èƒ½æ¯ä¿®æ”¹ä¸€ä¸ªé…ç½®å°±é‡åšä¸€ä¸ªimageå§ï¼ŸConfigMap APIç»™æˆ‘ä»¬æä¾›äº†å‘å®¹å™¨ä¸­æ³¨å…¥é…ç½®ä¿¡æ¯çš„æœºåˆ¶ï¼ŒConfigMapå¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜æ•´ä¸ªé…ç½®æ–‡ä»¶æˆ–è€…JSONäºŒè¿›åˆ¶å¤§å¯¹è±¡ã€‚&lt;/p&gt;

&lt;h2 id=&#34;configmapæ¦‚è§ˆ&#34;&gt;ConfigMapæ¦‚è§ˆ&lt;/h2&gt;

&lt;p&gt;The ConfigMap API resource holds key-value pairs of configuration data that can be consumed in pods or used to store configuration data for system components such as controllers. ConfigMap is similar to [Secrets](), but designed to more conveniently support working with strings that do not contain sensitive information.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ConfigMap API&lt;/strong&gt;èµ„æºç”¨æ¥ä¿å­˜&lt;strong&gt;key-value pair&lt;/strong&gt;é…ç½®æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥åœ¨&lt;strong&gt;pods&lt;/strong&gt;é‡Œä½¿ç”¨ï¼Œæˆ–è€…è¢«ç”¨æ¥ä¸ºåƒ&lt;strong&gt;controller&lt;/strong&gt;ä¸€æ ·çš„ç³»ç»Ÿç»„ä»¶å­˜å‚¨é…ç½®æ•°æ®ã€‚è™½ç„¶ConfigMapè·Ÿ&lt;a href=&#34;https://kubernetes.io/docs/user-guide/secrets/&#34;&gt;Secrets&lt;/a&gt;ç±»ä¼¼ï¼Œä½†æ˜¯ConfigMapæ›´æ–¹ä¾¿çš„å¤„ç†ä¸å«æ•æ„Ÿä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚
æ³¨æ„ï¼š&lt;u&gt;ConfigMapsä¸æ˜¯å±æ€§é…ç½®æ–‡ä»¶çš„æ›¿ä»£å“ã€‚&lt;/u&gt;ConfigMapsåªæ˜¯ä½œä¸ºå¤šä¸ªpropertiesæ–‡ä»¶çš„å¼•ç”¨ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºLinuxç³»ç»Ÿä¸­çš„&lt;code&gt;/etc&lt;/code&gt;ç›®å½•ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ConfigMapé…ç½®æ¥åˆ›å»ºKuberntes Volumesï¼ŒConfigMapä¸­çš„æ¯ä¸ªdataé¡¹éƒ½ä¼šæˆä¸ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;Note: ConfigMaps are not intended to act as a replacement for a properties file. ConfigMaps are intended to act as a reference to multiple properties files. You can think of them as way to represent something similar to the /etc directory, and the files within, on a Linux computer. One example of this model is creating Kubernetes Volumes from ConfigMaps, where each data item in the ConfigMap becomes a new file.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;kind: ConfigMap
apiVersion: v1
metadata:
  creationTimestamp: 2016-02-18T19:14:38Z
  name: example-config
  namespace: default
data:
  example.property.1: hello
  example.property.2: world
  example.property.file: |-
    property.1=value-1
    property.2=value-2
    property.3=value-3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;data&lt;/code&gt;ä¸€æ åŒ…æ‹¬äº†é…ç½®æ•°æ®ï¼ŒConfigMapå¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚
é…ç½®æ•°æ®å¯ä»¥é€šè¿‡å¾ˆå¤šç§æ–¹å¼åœ¨Podsé‡Œè¢«ä½¿ç”¨ã€‚ConfigMapså¯ä»¥è¢«ç”¨æ¥ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼&lt;/li&gt;
&lt;li&gt;åœ¨å®¹å™¨é‡Œè®¾ç½®å‘½ä»¤è¡Œå‚æ•°&lt;/li&gt;
&lt;li&gt;åœ¨æ•°æ®å·é‡Œé¢åˆ›å»ºconfigæ–‡ä»¶&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç”¨æˆ·å’Œç³»ç»Ÿç»„ä»¶ä¸¤è€…éƒ½å¯ä»¥åœ¨ConfigMapé‡Œé¢å­˜å‚¨é…ç½®æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®ä¸ç”¨çœ‹ä¸‹é¢çš„æ–‡ç« ï¼Œç›´æ¥ä»&lt;code&gt;kubectl create configmap -h&lt;/code&gt;çš„å¸®åŠ©ä¿¡æ¯ä¸­å°±å¯ä»¥å¯¹ConfigMapç©¶ç«Ÿå¦‚ä½•åˆ›å»ºç•¥çŸ¥ä¸€äºŒäº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Examples:
  # Create a new configmap named my-config based on folder bar
  kubectl create configmap my-config --from-file=path/to/bar
  
  # Create a new configmap named my-config with specified keys instead of file basenames on disk
  kubectl create configmap my-config --from-file=key1=/path/to/bar/file1.txt --from-file=key2=/path/to/bar/file2.txt
  
  # Create a new configmap named my-config with key1=config1 and key2=config2
  kubectl create configmap my-config --from-literal=key1=config1 --from-literal=key2=config2
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;åˆ›å»ºconfigmaps&#34;&gt;åˆ›å»ºConfigMaps&lt;/h2&gt;

&lt;p&gt;å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œç”¨ç»™å®šå€¼ã€æ–‡ä»¶æˆ–ç›®å½•æ¥åˆ›å»ºConfigMapã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl create configmap
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ä½¿ç”¨ç›®å½•åˆ›å»º&#34;&gt;ä½¿ç”¨ç›®å½•åˆ›å»º&lt;/h3&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬å·²ç»æœ‰ä¸ªäº†åŒ…å«ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬æƒ³è¦è®¾ç½®çš„ConfigMapçš„å€¼ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ls docs/user-guide/configmap/kubectl/
game.properties
ui.properties

$ cat docs/user-guide/configmap/kubectl/game.properties
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30

$ cat docs/user-guide/configmap/kubectl/ui.properties
color.good=purple
color.bad=yellow
allow.textmode=true
how.nice.to.look=fairlyNice
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„ConfigMapã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl create configmap game-config --from-file=docs/user-guide/configmap/kubectl
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;â€”from-file&lt;/code&gt;æŒ‡å®šåœ¨ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ConfigMapé‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„åå­—å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯æ–‡ä»¶çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‘½ä»¤åˆ›å»ºçš„ConfigMapï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl describe configmaps game-config
Name:           game-config
Namespace:      default
Labels:         &amp;lt;none&amp;gt;
Annotations:    &amp;lt;none&amp;gt;

Data
====
game.properties:        158 bytes
ui.properties:          83 bytes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‚£ä¸¤ä¸ªkeyæ˜¯ä»kubectlæŒ‡å®šçš„ç›®å½•ä¸­çš„æ–‡ä»¶åã€‚è¿™äº›keyçš„å†…å®¹å¯èƒ½ä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥åœ¨kubectl describeçš„è¾“å‡ºä¸­ï¼Œåªèƒ½å¤Ÿçœ‹åˆ°é”®çš„åå­—å’Œä»–ä»¬çš„å¤§å°ã€‚
å¦‚æœæƒ³è¦çœ‹åˆ°é”®çš„å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl get&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl get configmaps game-config -o yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬ä»¥&lt;code&gt;yaml&lt;/code&gt;æ ¼å¼è¾“å‡ºé…ç½®ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
data:
  game.properties: |
    enemies=aliens
    lives=3
    enemies.cheat=true
    enemies.cheat.level=noGoodRotten
    secret.code.passphrase=UUDDLRLRBABAS
    secret.code.allowed=true
    secret.code.lives=30
  ui.properties: |
    color.good=purple
    color.bad=yellow
    allow.textmode=true
    how.nice.to.look=fairlyNice
kind: ConfigMap
metadata:
  creationTimestamp: 2016-02-18T18:34:05Z
  name: game-config
  namespace: default
  resourceVersion: &amp;quot;407&amp;quot;
  selfLink: /api/v1/namespaces/default/configmaps/game-config
  uid: 30944725-d66e-11e5-8cd0-68f728db1985
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ä½¿ç”¨æ–‡ä»¶åˆ›å»º&#34;&gt;ä½¿ç”¨æ–‡ä»¶åˆ›å»º&lt;/h3&gt;

&lt;p&gt;åˆšæ‰&lt;strong&gt;ä½¿ç”¨ç›®å½•åˆ›å»º&lt;/strong&gt;çš„æ—¶å€™æˆ‘ä»¬&lt;code&gt;â€”from-file&lt;/code&gt;æŒ‡å®šçš„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåªè¦æŒ‡å®šä¸ºä¸€ä¸ªæ–‡ä»¶å°±å¯ä»¥ä»å•ä¸ªæ–‡ä»¶ä¸­åˆ›å»ºConfigMapã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl create configmap game-config-2 --from-file=docs/user-guide/configmap/kubectl/game.properties 

$ kubectl get configmaps game-config-2 -o yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
data:
  game-special-key: |
    enemies=aliens
    lives=3
    enemies.cheat=true
    enemies.cheat.level=noGoodRotten
    secret.code.passphrase=UUDDLRLRBABAS
    secret.code.allowed=true
    secret.code.lives=30
kind: ConfigMap
metadata:
  creationTimestamp: 2016-02-18T18:54:22Z
  name: game-config-3
  namespace: default
  resourceVersion: &amp;quot;530&amp;quot;
  selfLink: /api/v1/namespaces/default/configmaps/game-config-3
  uid: 05f8da22-d671-11e5-8cd0-68f728db1985
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;â€”from-file&lt;/code&gt;è¿™ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸¤æ¬¡åˆ†åˆ«æŒ‡å®šä¸Šä¸ªå®ä¾‹ä¸­çš„é‚£ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ•ˆæœå°±è·ŸæŒ‡å®šæ•´ä¸ªç›®å½•æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ä½¿ç”¨literalå€¼åˆ›å»º&#34;&gt;ä½¿ç”¨literalå€¼åˆ›å»º&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨æ–‡å­—å€¼åˆ›å»ºï¼Œåˆ©ç”¨&lt;code&gt;â€”from-literal&lt;/code&gt;å‚æ•°ä¼ é€’é…ç½®ä¿¡æ¯ï¼Œè¯¥å‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼›&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ kubectl create configmap special-config --from-literal=special.how=very --from-literal=special.type=charm

$ kubectl get configmaps special-config -o yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
data:
  special.how: very
  special.type: charm
kind: ConfigMap
metadata:
  creationTimestamp: 2016-02-18T19:14:38Z
  name: special-config
  namespace: default
  resourceVersion: &amp;quot;651&amp;quot;
  selfLink: /api/v1/namespaces/default/configmaps/special-config
  uid: dadce046-d673-11e5-8cd0-68f728db1985
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;podä¸­ä½¿ç”¨configmap&#34;&gt;Podä¸­ä½¿ç”¨ConfigMap&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ConfigMapæ¥æ›¿ä»£ç¯å¢ƒå˜é‡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ConfigMapå¯ä»¥è¢«ç”¨æ¥å¡«å…¥ç¯å¢ƒå˜é‡ã€‚çœ‹ä¸‹ä¸‹é¢çš„ConfigMapã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: default
data:
  special.how: very
  special.type: charm
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: env-config
  namespace: default
data:
  log_level: INFO
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨Podä¸­è¿™æ ·ä½¿ç”¨ConfigMapï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: gcr.io/google_containers/busybox
      command: [ &amp;quot;/bin/sh&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;env&amp;quot; ]
      env:
        - name: SPECIAL_LEVEL_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.how
        - name: SPECIAL_TYPE_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.type
      envFrom:
        - configMapRef:
            name: env-config
  restartPolicy: Never
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ªPodè¿è¡Œåä¼šè¾“å‡ºå¦‚ä¸‹å‡ è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;SPECIAL_LEVEL_KEY=very
SPECIAL_TYPE_KEY=charm
log_level=INFO
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ç”¨ConfigMapè®¾ç½®å‘½ä»¤è¡Œå‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ConfigMapä¹Ÿå¯ä»¥è¢«ä½¿ç”¨æ¥è®¾ç½®å®¹å™¨ä¸­çš„å‘½ä»¤æˆ–è€…å‚æ•°å€¼ã€‚å®ƒä½¿ç”¨çš„æ˜¯Kubernetesçš„$(VAR_NAME)æ›¿æ¢è¯­æ³•ã€‚æˆ‘ä»¬çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªConfigMapã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: default
data:
  special.how: very
  special.type: charm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸ºäº†å°†ConfigMapä¸­çš„å€¼æ³¨å…¥åˆ°å‘½ä»¤è¡Œçš„å‚æ•°é‡Œé¢ï¼Œæˆ‘ä»¬è¿˜è¦åƒå‰é¢é‚£ä¸ªä¾‹å­ä¸€æ ·ä½¿ç”¨ç¯å¢ƒå˜é‡æ›¿æ¢è¯­æ³•&lt;code&gt;${VAR_NAME)&lt;/code&gt;ã€‚ï¼ˆå…¶å®è¿™ä¸ªä¸œè¥¿å°±æ˜¯ç»™Dockerå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥å‰æˆ‘åˆ›å»ºé•œåƒçš„æ—¶å€™ç»å¸¸è¿™ä¹ˆç©ï¼Œé€šè¿‡docker runçš„æ—¶å€™æŒ‡å®š-eå‚æ•°ä¿®æ”¹é•œåƒé‡Œçš„ç¯å¢ƒå˜é‡ï¼Œç„¶ådockerçš„CMDå‘½ä»¤å†åˆ©ç”¨è¯¥$(VAR_NAME)é€šè¿‡sedæ¥æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶æˆ–è€…ä½œä¸ºå‘½ä»¤è¡Œå¯åŠ¨å‚æ•°ã€‚ï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: gcr.io/google_containers/busybox
      command: [ &amp;quot;/bin/sh&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)&amp;quot; ]
      env:
        - name: SPECIAL_LEVEL_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.how
        - name: SPECIAL_TYPE_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.type
  restartPolicy: Never
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿è¡Œè¿™ä¸ªPodåä¼šè¾“å‡ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;very charm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é€šè¿‡æ•°æ®å·æ’ä»¶ä½¿ç”¨ConfigMap&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ConfigMapä¹Ÿå¯ä»¥åœ¨æ•°æ®å·é‡Œé¢è¢«ä½¿ç”¨ã€‚è¿˜æ˜¯è¿™ä¸ªConfigMapã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: default
data:
  special.how: very
  special.type: charm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨æ•°æ®å·é‡Œé¢ä½¿ç”¨è¿™ä¸ªConfigMapï¼Œæœ‰ä¸åŒçš„é€‰é¡¹ã€‚æœ€åŸºæœ¬çš„å°±æ˜¯å°†æ–‡ä»¶å¡«å…¥æ•°æ®å·ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œé”®å°±æ˜¯æ–‡ä»¶åï¼Œé”®å€¼å°±æ˜¯æ–‡ä»¶å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: gcr.io/google_containers/busybox
      command: [ &amp;quot;/bin/sh&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;cat /etc/config/special.how&amp;quot; ]
      volumeMounts:
      - name: config-volume
        mountPath: /etc/config
  volumes:
    - name: config-volume
      configMap:
        name: special-config
  restartPolicy: Never
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿è¡Œè¿™ä¸ªPodçš„è¾“å‡ºæ˜¯&lt;code&gt;very&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ConfigMapå€¼è¢«æ˜ å°„çš„æ•°æ®å·é‡Œæ§åˆ¶è·¯å¾„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: gcr.io/google_containers/busybox
      command: [ &amp;quot;/bin/sh&amp;quot;,&amp;quot;-c&amp;quot;,&amp;quot;cat /etc/config/path/to/special-key&amp;quot; ]
      volumeMounts:
      - name: config-volume
        mountPath: /etc/config
  volumes:
    - name: config-volume
      configMap:
        name: special-config
        items:
        - key: special.how
          path: path/to/special-key
  restartPolicy: Never
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿è¡Œè¿™ä¸ªPodåçš„ç»“æœæ˜¯&lt;code&gt;very&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;è¿˜æ˜¯é‚£å¥è¯ï¼Œå¦‚æœä½ äº†è§£dockerçš„ENVæœºåˆ¶å°±ä¼šæ˜ç™½ConfigMapèƒŒåç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Œso easy~&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Fluentdå’ŒElasticSearchæ”¶é›†Kubernetesé›†ç¾¤æ—¥å¿—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-fluentd-elasticsearch-installation/</link>
      <pubDate>Thu, 06 Apr 2017 14:30:24 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-fluentd-elasticsearch-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160430080.jpg&#34; alt=&#34;å¤åŒ—æ°´é•‡&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šç å¤´@å¤åŒ—æ°´é•‡ Apr 30,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;åœ¨&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/&#34;&gt;å®‰è£…å¥½äº†Kubernetesé›†ç¾¤&lt;/a&gt;ã€&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-network-config/&#34;&gt;é…ç½®å¥½äº†flannelç½‘ç»œ&lt;/a&gt;ã€&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/&#34;&gt;å®‰è£…äº†Kubernetes Dashboard&lt;/a&gt;å’Œ&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/&#34;&gt;é…ç½®Heapsterç›‘æ§æ’ä»¶&lt;/a&gt;åï¼Œè¿˜æœ‰ä¸€é¡¹é‡è¦çš„å·¥ä½œï¼Œä¸ºäº†è°ƒè¯•å’Œæ•…éšœæ’æŸ¥ï¼Œè¿˜éœ€è¦è¿›è¡Œæ—¥å¿—æ”¶é›†å·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®˜æ–¹æ–‡æ¡£&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/logging/&#34;&gt;Kubernetes Logging and Monitoring Cluster Activity&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/&#34;&gt;Logging Using Elasticsearch and Kibana&lt;/a&gt;ï¼šä¸è¿‡è¿™ç¯‡æ–‡ç« æ˜¯åœ¨GCEä¸Šé…ç½®çš„ï¼Œå‚è€ƒä»·å€¼ä¸å¤§ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®¹å™¨æ—¥å¿—çš„å­˜åœ¨å½¢å¼&#34;&gt;å®¹å™¨æ—¥å¿—çš„å­˜åœ¨å½¢å¼&lt;/h2&gt;

&lt;p&gt;ç›®å‰å®¹å™¨æ—¥å¿—æœ‰ä¸¤ç§è¾“å‡ºå½¢å¼ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;stdout,stderræ ‡å‡†è¾“å‡º&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™ç§å½¢å¼çš„æ—¥å¿—è¾“å‡ºæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨&lt;code&gt;docker logs&lt;/code&gt;æŸ¥çœ‹æ—¥å¿—ï¼Œkubernetesé›†ç¾¤ä¸­åŒæ ·å¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl logs&lt;/code&gt;ç±»ä¼¼çš„å½¢å¼æŸ¥çœ‹æ—¥å¿—ã€‚&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ—¥å¿—æ–‡ä»¶è®°å½•&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™ç§æ—¥å¿—è¾“å‡ºæˆ‘ä»¬æ— æ³•ä»ä»¥ä¸Šæ–¹æ³•æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼Œåªèƒ½&lt;code&gt;tail&lt;/code&gt;æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;fluentdä»‹ç»&#34;&gt;Fluentdä»‹ç»&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/fluent/fluentd&#34;&gt;Fluentd&lt;/a&gt;æ˜¯ä½¿ç”¨Rubyç¼–å†™çš„ï¼Œé€šè¿‡åœ¨åç«¯ç³»ç»Ÿä¹‹é—´æä¾›&lt;strong&gt;ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å±‚&lt;/strong&gt;æ¥ä»åç«¯ç³»ç»Ÿä¸­è§£è€¦æ•°æ®æºã€‚
æ­¤å±‚å…è®¸å¼€å‘äººå‘˜å’Œæ•°æ®åˆ†æäººå‘˜åœ¨ç”Ÿæˆæ—¥å¿—æ—¶ä½¿ç”¨å¤šç§ç±»å‹çš„æ—¥å¿—ã€‚
ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å±‚å¯ä»¥è®©æ‚¨å’Œæ‚¨çš„ç»„ç»‡æ›´å¥½åœ°ä½¿ç”¨æ•°æ®ï¼Œå¹¶æ›´å¿«åœ°åœ¨æ‚¨çš„è½¯ä»¶ä¸Šè¿›è¡Œè¿­ä»£ã€‚
ä¹Ÿå°±æ˜¯è¯´fluentdæ˜¯ä¸€ä¸ªé¢å‘å¤šç§æ•°æ®æ¥æºä»¥åŠé¢å‘å¤šç§æ•°æ®å‡ºå£çš„æ—¥å¿—æ”¶é›†å™¨ã€‚å¦å¤–å®ƒé™„å¸¦äº†æ—¥å¿—è½¬å‘çš„åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://camo.githubusercontent.com/c4abfe337c0b54b36f81bce78481f8965acbc7a9/687474703a2f2f646f63732e666c75656e74642e6f72672f696d616765732f666c75656e74642d6172636869746563747572652e706e67&#34; alt=&#34;arch&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Fluentdæ”¶é›†çš„&lt;strong&gt;event&lt;/strong&gt;ç”±ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ç»„æˆï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Tag&lt;/strong&gt;ï¼šå­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ç‚¹éš”å¼€ï¼Œå¦‚myapp.access&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Time&lt;/strong&gt;ï¼šUNIXæ—¶é—´æ ¼å¼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Record&lt;/strong&gt;ï¼šJSONæ ¼å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;fluentdç‰¹ç‚¹&#34;&gt;Fluentdç‰¹ç‚¹&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;éƒ¨ç½²ç®€å•çµæ´»&lt;/li&gt;
&lt;li&gt;å¼€æº&lt;/li&gt;
&lt;li&gt;ç»è¿‡éªŒè¯çš„å¯é æ€§å’Œæ€§èƒ½&lt;/li&gt;
&lt;li&gt;ç¤¾åŒºæ”¯æŒï¼Œæ’ä»¶è¾ƒå¤š&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨jsonæ ¼å¼äº‹ä»¶æ ¼å¼&lt;/li&gt;
&lt;li&gt;å¯æ‹”æ’çš„æ¶æ„è®¾è®¡&lt;/li&gt;
&lt;li&gt;ä½èµ„æºè¦æ±‚&lt;/li&gt;
&lt;li&gt;å†…ç½®é«˜å¯é æ€§&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;

&lt;p&gt;æŸ¥çœ‹&lt;code&gt;cluster/addons/fluentd-elasticsearch&lt;/code&gt;æ’ä»¶ç›®å½•ï¼Œè·å–åˆ°éœ€è¦ç”¨åˆ°çš„dockeré•œåƒåç§°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$grep -rn &amp;quot;gcr.io&amp;quot; *.yaml
es-controller.yaml:24:      - image: gcr.io/google_containers/elasticsearch:v2.4.1-2
fluentd-es-ds.yaml:26:        image: gcr.io/google_containers/fluentd-elasticsearch:1.22
kibana-controller.yaml:22:        image: gcr.io/google_containers/kibana:v4.6.1-1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;éœ€è¦ç”¨åˆ°çš„é•œåƒ&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;gcr.io/google_containers/kibana:v4.6.1-1&lt;/li&gt;
&lt;li&gt;gcr.io/google_containers/elasticsearch:v2.4.1-2&lt;/li&gt;
&lt;li&gt;gcr.io/google_containers/fluentd-elasticsearch:1.22&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› ä¸ºè¿™äº›é•œåƒåœ¨å¢™å¤–ï¼Œæ‰€ä»¥æˆ‘ç‰¹æ„å¤‡ä»½äº†ä¸€ä»½åœ¨æœ¬åœ°è¿˜æœ‰æ—¶é€Ÿäº‘ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æµ‹è¯•ç¯å¢ƒé•œåƒåç§°&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/elasticsearch:v2.4.1-2&lt;/li&gt;
&lt;li&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/kibana:v4.6.1-1&lt;/li&gt;
&lt;li&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/fluentd-elasticsearch:1.22&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;å¤‡ä»½åˆ°æ—¶é€Ÿäº‘ä¸Šçš„é•œåƒåç§°&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/elasticsearch:v2.4.1-2&lt;/li&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/kibana:v4.6.1-1&lt;/li&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/fluentd-elasticsearch:1.22&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¿®æ”¹ä¸Šé¢çš„é‚£ä¸‰ä¸ªyamlæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„é•œåƒåç§°æ”¹æˆæˆ‘ä»¬æµ‹è¯•ç¯å¢ƒä¸­çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å¯åŠ¨é›†ç¾¤&#34;&gt;å¯åŠ¨é›†ç¾¤&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨åˆšä¿®æ”¹å¥½yamlæ–‡ä»¶çš„é‚£ä¸ªç›®å½•å¯åŠ¨fluentd-elasticsearchã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl create -f flucentd-elasticsearch
$kubectl get -f fluentd-elasticsearch/
NAME                          DESIRED   CURRENT   READY     AGE
rc/elasticsearch-logging-v1   2         2         2         13m

NAME                        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
svc/elasticsearch-logging   10.254.107.114   &amp;lt;none&amp;gt;        9200/TCP   13m

NAME                  DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE-SELECTOR                              AGE
ds/fluentd-es-v1.22   0         0         0         0            0           beta.kubernetes.io/fluentd-ds-ready=true   13m

NAME                    DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/kibana-logging   1         1         1            1           13m

NAME                 CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
svc/kibana-logging   10.254.104.215   &amp;lt;none&amp;gt;        5601/TCP   13m

$kubectl cluster-info
Kubernetes master is running at http://sz-pg-oam-docker-test-001:8080
Elasticsearch is running at http://sz-pg-oam-docker-test-001:8080/api/v1/proxy/namespaces/kube-system/services/elasticsearch-logging
Heapster is running at http://sz-pg-oam-docker-test-001:8080/api/v1/proxy/namespaces/kube-system/services/heapster
Kibana is running at http://sz-pg-oam-docker-test-001:8080/api/v1/proxy/namespaces/kube-system/services/kibana-logging
monitoring-grafana is running at http://sz-pg-oam-docker-test-001:8080/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana
monitoring-influxdb is running at http://sz-pg-oam-docker-test-001:8080/api/v1/proxy/namespaces/kube-system/services/monitoring-influxdb

To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯åŠ¨å®Œæˆï¼Œä½†æ˜¯æŸ¥çœ‹podçš„æ—¥å¿—åä¼šå‘ç°å‡ºé”™äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä½•ä¿è¯æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªFluentdå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨DaemonSetã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ’é”™&#34;&gt;æ’é”™&lt;/h3&gt;

&lt;p&gt;æŸ¥çœ‹å¯åŠ¨çš„podã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl --namespace=kube-system get all
NAME                                       READY     STATUS    RESTARTS   AGE
po/elasticsearch-logging-v1-nshz2          1/1       Running   0          16m
po/elasticsearch-logging-v1-q515j          1/1       Running   0          16m
po/heapster-3669180046-06n3d               1/1       Running   0          23h
po/kibana-logging-4247188994-h8jxx         1/1       Running   0          16m
po/kubernetes-dashboard-1074266307-hsgxx   1/1       Running   0          1d
po/monitoring-grafana-127711743-xl9v1      1/1       Running   0          23h
po/monitoring-influxdb-1411048194-cvxmm    1/1       Running   0          23h
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹logging podçš„æ—¥å¿—ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl -n kube-system logs po/elasticsearch-logging-v1-nshz2
F0406 08:30:05.488197       7 elasticsearch_logging_discovery.go:49] Failed to make client: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory
goroutine 1 [running]:
...
[2017-04-06 08:30:23,450][WARN ][discovery.zen.ping.unicast] [elasticsearch-logging-v1-nshz2] failed to send ping to [{#zen_unicast_1#}{127.0.0.1}{127.0.0.1:9300}]
SendRequestTransportException[[][127.0.0.1:9300][internal:discovery/zen/unicast]]; nested: NodeNotConnectedException[[][127.0.0.1:9300] Node not connected];
	at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:340)
	at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing.sendPingRequestToNode(UnicastZenPing.java:440)
	at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing.sendPings(UnicastZenPing.java:426)
	at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing.ping(UnicastZenPing.java:240)
	at org.elasticsearch.discovery.zen.ping.ZenPingService.ping(ZenPingService.java:106)
	at org.elasticsearch.discovery.zen.ping.ZenPingService.pingAndWait(ZenPingService.java:84)
	at org.elasticsearch.discovery.zen.ZenDiscovery.findMaster(ZenDiscovery.java:945)
	at org.elasticsearch.discovery.zen.ZenDiscovery.innerJoinCluster(ZenDiscovery.java:360)
	at org.elasticsearch.discovery.zen.ZenDiscovery.access$4400(ZenDiscovery.java:96)
	at org.elasticsearch.discovery.zen.ZenDiscovery$JoinThreadControl$1.run(ZenDiscovery.java:1296)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: NodeNotConnectedException[[][127.0.0.1:9300] Node not connected]
	at org.elasticsearch.transport.netty.NettyTransport.nodeChannel(NettyTransport.java:1141)
	at org.elasticsearch.transport.netty.NettyTransport.sendRequest(NettyTransport.java:830)
	at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:329)
	... 12 more
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŠ¥é”™ä¸­æœ‰è¿™æ ·çš„æè¿°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;discovery.zen.ping.unicast failed to send ping to [{#zen_unicast_1#}{127.0.0.1}{127.0.0.1:9300}]
SendRequestTransportException[[internal:discovery/zen/unicast]]; nested: NodeNotConnectedException[ Node not connected]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œé¢æœ‰ä¸¤ä¸ªé”™è¯¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ— æ³•è®¿é—®åˆ°API Server&lt;/li&gt;
&lt;li&gt;elasticsearchä¸¤ä¸ªèŠ‚ç‚¹é—´äº’pingå¤±è´¥&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™ä¸ªæ˜¯é•œåƒä¸­çš„é…ç½®é—®é¢˜ï¼Œé…ç½®æ–‡ä»¶åœ¨&lt;code&gt;fluentd-es-image/td-agent.conf&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;http://tonybai.com/2017/03/03/implement-kubernetes-cluster-level-logging-with-fluentd-and-elasticsearch-stack/&#34;&gt;ä½¿ç”¨Fluentdå’ŒElasticSearch Stackå®ç°Kubernetesçš„é›†ç¾¤Logging&lt;/a&gt;ï¼ŒTony Baiä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬äº†è§£ä¸‹&lt;a href=&#34;https://kubernetes.io/docs/user-guide/configmap/&#34;&gt;ConfigMap&lt;/a&gt;è¿˜æœ‰&lt;a href=&#34;https://github.com/fabric8io/fluent-plugin-kubernetes_metadata_filter&#34;&gt;fluent-plugin-kubernetes_metadata_filter&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒæˆ‘çš„å¦ä¸€ç‰‡è¯‘æ–‡&lt;a href=&#34;rootsongjc.github.io/blogs/kubernetes-configmap-introduction&#34;&gt;Kubernetesä¸­ConfigMapè§£æ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;u&gt;é—®é¢˜å°šæœªè§£å†³ï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ã€‚&lt;/u&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;To be continuedâ€¦&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes heapsterç›‘æ§æ’ä»¶å®‰è£…æ–‡æ¡£</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/</link>
      <pubDate>Wed, 05 Apr 2017 18:41:19 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20170403064.jpg&#34; alt=&#34;å—‘çŒ«è–„è·çš„ç™½åŒ–å­ŸåŠ æ‹‰è™&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šå—‘çŒ«è–„è·çš„ç™½åŒ–å­ŸåŠ æ‹‰è™@åŒ—äº¬åŠ¨ç‰©å›­ Apr 3,2017ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;å‰é¢å‡ ç¯‡æ–‡ç« ä¸­è®°å½•äº†æˆ‘ä»¬&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/&#34;&gt;å®‰è£…å¥½äº†Kubernetesé›†ç¾¤&lt;/a&gt;ã€&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-network-config/&#34;&gt;é…ç½®å¥½äº†flannelç½‘ç»œ&lt;/a&gt;ã€&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/&#34;&gt;å®‰è£…äº†Kubernetes Dashboard&lt;/a&gt;ï¼Œä½†æ˜¯è¿˜æ²¡æ³•æŸ¥çœ‹Podçš„ç›‘æ§ä¿¡æ¯ï¼Œè™½ç„¶kubeleté»˜è®¤é›†æˆäº†&lt;strong&gt;cAdvisor&lt;/strong&gt;ï¼ˆåœ¨æ¯ä¸ªnodeçš„4194ç«¯å£å¯ä»¥æŸ¥çœ‹åˆ°ï¼‰ï¼Œä½†æ˜¯å¾ˆä¸æ–¹ä¾¿ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©å®‰è£…heapsterã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä¸‹è½½heapsterçš„ä»£ç &lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›´æ¥ç°åœ¨Githubä¸Šçš„æœ€æ–°ä»£ç ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;git pull https://github.com/kubernetes/heapster.git
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç›®å‰çš„æœ€é«˜ç‰ˆæœ¬æ˜¯1.3.0ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨&lt;code&gt;heapster/deploy/kube-config/influxdb&lt;/code&gt;ç›®å½•ä¸‹æœ‰å‡ ä¸ª&lt;code&gt;yaml&lt;/code&gt;æ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;grafana-deployment.yaml
grafana-service.yaml
heapster-deployment.yaml
heapster-service.yaml
influxdb-deployment.yaml
influxdb-service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å†çœ‹ä¸‹ç”¨äº†å“ªäº›é•œåƒï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;grafana-deployment.yaml:16:        image: gcr.io/google_containers/heapster-grafana-amd64:v4.0.2
heapster-deployment.yaml:16:        image: gcr.io/google_containers/heapster-amd64:v1.3.0-beta.1
influxdb-deployment.yaml:16:        image: gcr.io/google_containers/heapster-influxdb-amd64:v1.1.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä¸‹è½½é•œåƒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä¸‹è½½å¥½äº†è¿™äº›imagesåï¼Œå­˜å‚¨åˆ°ç§æœ‰é•œåƒä»“åº“é‡Œï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-amd64:v1.3.0-beta.1&lt;/li&gt;
&lt;li&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-grafana-amd64:v4.0.2&lt;/li&gt;
&lt;li&gt;sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-influxdb-amd64:v1.1.1&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘å·²ç»å°†å®˜æ–¹é•œåƒå…‹éš†åˆ°äº†&lt;a href=&#34;www.tenxcloud.com&#34;&gt;æ—¶é€Ÿäº‘&lt;/a&gt;ä¸Šï¼Œé•œåƒåœ°å€ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/heapster-amd64:v1.3.0-beta.1&lt;/li&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/heapster-influxdb-amd64:v1.1.1&lt;/li&gt;
&lt;li&gt;index.tenxcloud.com/jimmy/heapster-grafana-amd64:v4.0.2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;éœ€è¦çš„å¯ä»¥å»ä¸‹è½½ï¼Œä¸‹è½½å‰éœ€è¦ç”¨æ—¶é€Ÿäº‘è´¦æˆ·ç™»é™†ï¼Œç„¶åå†æ‰§è¡Œpullæ“ä½œã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker login index.tendcloud.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é…ç½®&#34;&gt;é…ç½®&lt;/h2&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://github.com/kubernetes/heapster/blob/master/docs/influxdb.md&#34;&gt;Run Heapster in a Kubernetes cluster with an InfluxDB backend and a Grafana UI&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md&#34;&gt;Configuring Source&lt;/a&gt;ï¼Œéœ€è¦ä¿®æ”¹yamlæ–‡ä»¶ä¸­çš„å‡ ä¸ªé…ç½®ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é¦–å…ˆä¿®æ”¹ä¸‰ä¸ªdeployment.yamlæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„é•œåƒæ–‡ä»¶åœ°å€æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“çš„&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹heapster-deployment.yamlæ–‡ä»¶ä¸­çš„&lt;code&gt;--source&lt;/code&gt;å‚æ•°ä¸º&lt;code&gt;â€”source=kubernetes:http://sz-pg-oam-docker-test-001.tendcloud.com:8080?inClusterConfig=false&amp;amp;useServiceAccount=false&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;ä¿®æ”¹å®Œé…ç½®çš„&lt;code&gt;heapster-deployment.yaml&lt;/code&gt;æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: heapster
  namespace: kube-system
spec:
  replicas: 1
  template:
    metadata:
      labels:
        task: monitoring
        k8s-app: heapster
    spec:
      containers:
      - name: heapster
        image: sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-amd64:v1.3.0-beta.1
        imagePullPolicy: IfNotPresent
        command:
        - /heapster
        - --source=kubernetes:http://sz-pg-oam-docker-test-001.tendcloud.com:8080?inClusterConfig=false&amp;amp;useServiceAccount=false
        - --sink=influxdb:http://monitoring-influxdb:8086
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å¯åŠ¨&#34;&gt;å¯åŠ¨&lt;/h2&gt;

&lt;p&gt;åœ¨å‡†å¤‡å¥½é•œåƒå’Œä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åå°±å¯ä»¥ä¸€é”®å¯åŠ¨äº†ï¼Œè¿™ä¸å°±æ˜¯ä½¿ç”¨kbuernetesçš„æ–¹ä¾¿ä¹‹å¤„å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨heaspter&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;kubectl create -f deploy/kube-config/influxdb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹çŠ¶æ€&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl get -f deploy/kube-config/influxdb/
NAME                        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/monitoring-grafana   1         1         1            1           1h

NAME                     CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
svc/monitoring-grafana   10.254.250.27   &amp;lt;none&amp;gt;        80/TCP    1h

NAME              DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/heapster   1         1         1            1           1h

NAME           CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
svc/heapster   10.254.244.187   &amp;lt;none&amp;gt;        80/TCP    1h

NAME                         DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/monitoring-influxdb   1         1         1            1           1h

NAME                      CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
svc/monitoring-influxdb   10.254.151.157   &amp;lt;none&amp;gt;        8086/TCP   1h
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹é¡µé¢&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç°åœ¨å†æ‰“å¼€Dashboardé¡µé¢å°±å¯ä»¥çœ‹åˆ°CPUå’ŒMemoryçš„ç›‘æ§ä¿¡æ¯äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-heapster-01.jpg&#34; alt=&#34;kubernetes-heapster&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;è™½ç„¶åœ¨å®‰è£…äº†heapsteræ’ä»¶åå¯ä»¥åœ¨dashboardä¸­çœ‹åˆ°CPUå’ŒMemoryçš„ç›‘æ§ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä»…ä»…æ˜¯è¿‘å®æ—¶çš„ç›‘æ§ï¼Œæ”¶é›†çš„metricsè¢«ä¿å­˜åˆ°äº†InfluxDBä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡Kibanaæˆ–è€…Grafanaæ¥å±•ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯å’Œå†å²æ•°æ®ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšçš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Dashboard/Web UIå®‰è£…å…¨è®°å½•</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/</link>
      <pubDate>Wed, 05 Apr 2017 14:28:51 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2017040301.jpg&#34; alt=&#34;æ™’å¤ªé˜³çš„è¢‹é¼ &#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ™’å¤ªé˜³çš„è¢‹é¼ @åŒ—äº¬åŠ¨ç‰©å›­ Apr 3,2017ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;å‰å‡ å¤©&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/&#34;&gt;åœ¨CentOS7.2ä¸Šå®‰è£…Kubernetes1.6&lt;/a&gt;å’Œå®‰è£…å¥½&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-network-config/&#34;&gt;flannelç½‘ç»œé…ç½®&lt;/a&gt;ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å®‰è£…ä¸‹kuberentnesçš„dashboardã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard&#34;&gt;Dashboard&lt;/a&gt;æ˜¯Kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä»£ç åœ¨å•ç‹¬çš„å¼€æºé¡¹ç›®é‡Œã€‚1å¹´å‰è¿˜æ˜¯ç‰¹åˆ«ç®€å•çš„ä¸€ä¸ªUIï¼Œåªèƒ½åœ¨ä¸Šé¢æŸ¥çœ‹podçš„ä¿¡æ¯å’Œéƒ¨ç½²podè€Œå·²ï¼Œç°åœ¨å·²ç»åšçš„è·Ÿ&lt;a href=&#34;https://www.docker.com/enterprise-edition&#34;&gt;Docker Enterprise Edition&lt;/a&gt;çš„&lt;strong&gt;Docker Datacenter&lt;/strong&gt;å¾ˆåƒäº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…dashboard&#34;&gt;å®‰è£…Dashboard&lt;/h2&gt;

&lt;p&gt;å®˜ç½‘çš„å®‰è£…æ–‡æ¡£&lt;a href=&#34;https://kubernetes.io/docs/user-guide/ui/ï¼Œå…¶å®å®˜ç½‘æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨ç°æˆçš„imageæ¥ç”¨kuberneteséƒ¨ç½²å³å¯ã€‚&#34;&gt;https://kubernetes.io/docs/user-guide/ui/ï¼Œå…¶å®å®˜ç½‘æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨ç°æˆçš„imageæ¥ç”¨kuberneteséƒ¨ç½²å³å¯ã€‚&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆéœ€è¦ä¸€ä¸ª&lt;strong&gt;kubernetes-dashboard.yaml&lt;/strong&gt;çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨&lt;a href=&#34;https://github.com/kubernetes/dashboard/blob/master/src/deploy/kubernetes-dashboard.yaml&#34;&gt;Githubçš„src/deploy/kubernetes-dashboard.yaml&lt;/a&gt;ä¸‹è½½ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬èƒ½çœ‹ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;# Copyright 2015 Google Inc. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the &amp;quot;License&amp;quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &amp;quot;AS IS&amp;quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Configuration to deploy release version of the Dashboard UI.
#
# Example usage: kubectl create -f &amp;lt;this_file&amp;gt;

kind: Deployment
apiVersion: extensions/v1beta1
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: kubernetes-dashboard
  template:
    metadata:
      labels:
        app: kubernetes-dashboard
      # Comment the following annotation if Dashboard must not be deployed on master
      annotations:
        scheduler.alpha.kubernetes.io/tolerations: |
          [
            {
              &amp;quot;key&amp;quot;: &amp;quot;dedicated&amp;quot;,
              &amp;quot;operator&amp;quot;: &amp;quot;Equal&amp;quot;,
              &amp;quot;value&amp;quot;: &amp;quot;master&amp;quot;,
              &amp;quot;effect&amp;quot;: &amp;quot;NoSchedule&amp;quot;
            }
          ]
    spec:
      containers:
      - name: kubernetes-dashboard
        image: sz-pg-oam-docker-hub-001.tendcloud.com/library/kubernetes-dashboard-amd64:v1.6.0
        imagePullPolicy: Always
        ports:
        - containerPort: 9090
          protocol: TCP
        args:
          # Uncomment the following line to manually specify Kubernetes API server Host
          # If not specified, Dashboard will attempt to auto discover the API server and connect
          # to it. Uncomment only if the default does not work.
          # - --apiserver-host=http://my-address:port
          - --apiserver-host=http://sz-pg-oam-docker-test-001.tendcloud.com:8080
        livenessProbe:
          httpGet:
            path: /
            port: 9090
          initialDelaySeconds: 30
          timeoutSeconds: 30
---
kind: Service
apiVersion: v1
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  type: NodePort
  ports:
  - port: 80
    targetPort: 9090
  selector:
    app: kubernetes-dashboard
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;âš ï¸ å®˜æ–¹æä¾›çš„imageåä¸º&lt;code&gt;gcr.io/google_containers/kubernetes-dashboard-amd64:v1.6.0&lt;/code&gt;ï¼Œéœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œæˆ‘è‡ªå·±æ‹‰ä¸‹æ¥pushåˆ°æˆ‘ä»¬çš„ç§æœ‰é•œåƒä»“åº“äº†ã€‚æˆ‘å°†è¿™ä¸ªé•œåƒpushåˆ°äº†docker hubä¸Šï¼Œå¦‚æœä½ æ— æ³•ç¿»å¢™çš„è¯ï¼Œå¯ä»¥åˆ°ä¸‹è½½è¿™ä¸ªé•œåƒï¼š&lt;code&gt;index.tenxcloud.com/jimmy/kubernetes-dashboard-amd64:v1.6.0&lt;/code&gt;ã€‚æ—¶é€Ÿäº‘çš„é•œåƒå­˜å‚¨ï¼Œé€Ÿåº¦å°±æ˜¯å¿«ã€‚&lt;/p&gt;

&lt;p&gt;å‡†å¤‡å¥½imageåå°±å¯ä»¥éƒ¨ç½²äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl create -f kubernetes-dashboard.yaml
deployment &amp;quot;kubernetes-dashboard&amp;quot; created
service &amp;quot;kubernetes-dashboard&amp;quot; created
$kubectl get -f kubernetes-dashboard.yaml
NAME                          DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/kubernetes-dashboard   1         1         1            1           9s

NAME                       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
svc/kubernetes-dashboard   10.254.113.226   &amp;lt;nodes&amp;gt;       80:31370/TCP   8s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å°±å¯ä»¥è®¿é—®&lt;a href=&#34;http://sz-pg-oam-docker-test-001.tendcloud.com:8080/uiäº†ï¼Œæ•ˆæœå¦‚å›¾ï¼š&#34;&gt;http://sz-pg-oam-docker-test-001.tendcloud.com:8080/uiäº†ï¼Œæ•ˆæœå¦‚å›¾ï¼š&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/kubernetes-dashboard-01.jpg&#34; alt=&#34;kubernetes-dashboard&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;troubleshooting&#34;&gt;Troubleshooting&lt;/h2&gt;

&lt;h3 id=&#34;å¦‚æœä½ æ²¡å¯åŠ¨service-accountèº«ä»½è®¤è¯&#34;&gt;å¦‚æœä½ æ²¡å¯åŠ¨Service Accountèº«ä»½è®¤è¯&lt;/h3&gt;

&lt;p&gt;é‚£å°±å¥½åŠäº†ï¼Œæ£€æŸ¥ä¸‹ä½ çš„&lt;strong&gt;kubernetes-dashboard.yaml&lt;/strong&gt;æ–‡ä»¶ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯API Serveråœ°å€é…é”™äº†ï¼Œæˆ–è€…æŸ¥çœ‹ä¸‹podçš„logï¼Œæˆ‘å°±æ˜¯åœ¨logé‡Œå‘ç°ï¼ŒåŸæ¥API Serverçš„ä¸»æœºåæ— æ³•è§£æå¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥ã€‚åœ¨DNSé‡Œæ·»åŠ API Serverä¸»æœºçš„DNSè®°å½•å³å¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å¦‚æœä½ å¯åŠ¨api-serverçš„serviceaccountèº«ä»½è®¤è¯&#34;&gt;å¦‚æœä½ å¯åŠ¨API Serverçš„ServiceAccountèº«ä»½è®¤è¯&lt;/h3&gt;

&lt;p&gt;å¯åŠ¨serviceçš„æ—¶å€™å‡ºé”™ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl --namespace=kube-system logs kubernetes-dashboard-1680927228-pdv45
Using HTTP port: 9090
Error while initializing connection to Kubernetes apiserver. This most likely means that the cluster is misconfigured (e.g., it has invalid apiserver certificates or service accounts configuration) or the --apiserver-host param points to a server that does not exist. Reason: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory
Refer to the troubleshooting guide for more information: https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md&#34;&gt;troubleshooting.md&lt;/a&gt;æ–‡ä»¶å·²ç»è¯´æ˜äº†ï¼Œè¿™æ˜¯å¯èƒ½æ˜¯ä½ é…ç½®API serveråœ°å€æˆ–&lt;strong&gt;Service Account&lt;/strong&gt;çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ˜¯é…ç½®Service Accountçš„é—®é¢˜ï¼Œå¯ä»¥å€Ÿé‰´Tony Baiçš„&lt;a href=&#34;http://tonybai.com/2017/01/19/install-dashboard-addon-for-k8s/&#34;&gt;Kubernetesé›†ç¾¤Dashboardæ’ä»¶å®‰è£…&lt;/a&gt;è¿™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl proxy --address=&#39;0.0.0.0&#39; --accept-hosts=&#39;^*$&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŠ¥é”™ä¿¡æ¯&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;kind&amp;quot;: &amp;quot;Status&amp;quot;,
  &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,
  &amp;quot;metadata&amp;quot;: {},
  &amp;quot;status&amp;quot;: &amp;quot;Failure&amp;quot;,
  &amp;quot;message&amp;quot;: &amp;quot;no endpoints available for service \&amp;quot;kubernetes-dashboard\&amp;quot;&amp;quot;,
  &amp;quot;reason&amp;quot;: &amp;quot;ServiceUnavailable&amp;quot;,
  &amp;quot;code&amp;quot;: 503
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;# start a container that contains curl
$ kubectl run test --image=sz-pg-oam-docker-hub-001.tendcloud.com/library/curl:latest -- sleep 10000
$kubectl get pod
NAME                     READY     STATUS    RESTARTS   AGE
test-2428763157-pxkps    1/1       Running   0          6s
$kubectl exec test-2428763157-pxkps ls /var/run/secrets/kubernetes.io/serviceaccount/
ls: cannot access /var/run/secrets/kubernetes.io/serviceaccount/: No such file or directory
$kubectl get secrets
No resources found.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;/var/run/secrets/kubernetes.io/serviceaccount/&lt;/code&gt;è¿™ä¸ªç›®å½•è¿˜æ˜¯ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å®‰è£…çš„Kuberneteså‹æ ¹å°±æ²¡æœ‰è®¾ç½®secretã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md&#34;&gt;troubleshooting.md&lt;/a&gt;ä¸Šè¯´éœ€è¦ç”¨&lt;code&gt;â€”admission-control&lt;/code&gt;é…ç½®API Serverï¼Œåœ¨é…ç½®è¿™ä¸ªä¹‹å‰è¿˜è¦äº†è§£ä¸‹&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/&#34;&gt;Service Accounts&lt;/a&gt;å’Œ&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/&#34;&gt;å¦‚ä½•ç®¡ç†Service Accounts&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;ä¸€å¹´å‰æˆ‘å®‰è£…Kubernetes Dashboardï¼ˆé‚£æ—¶å€™å¥½åƒè¿˜å«Kube-UIï¼‰çš„æ—¶å€™æ²¡æœ‰å…¶åŠŸèƒ½è¿˜æå…¶ä¸å®Œå–„ï¼Œç»è¿‡ä¸€å¹´å¤šçš„å‘å±•ï¼Œå·²ç»æœ‰æ¨¡æœ‰æ ·äº†ï¼Œå¦‚æœä¸å¯ç”¨&lt;strong&gt;Service Account&lt;/strong&gt;çš„è¯ï¼Œå®‰è£…Dashboardè¿˜æ˜¯å¾ˆç®€å•çš„ã€‚æ¥ä¸‹æ¥æˆ‘è¿˜è¦åœ¨Dashboardä¸Šå®‰è£…å…¶å®ƒAdd-onï¼Œå¦‚Heapsterç”¨æ¥ç›‘æ§PodçŠ¶æ€ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>KubernetesåŸºäºflannelçš„ç½‘ç»œé…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-network-config/</link>
      <pubDate>Fri, 31 Mar 2017 11:05:18 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-network-config/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2014100402.jpg&#34; alt=&#34;è¥¿å®‰é¼“æ¥¼&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šè¥¿å®‰é¼“æ¥¼ Oct 4,2014ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ä¹¦æ¥ä¸Šæ–‡&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/&#34;&gt;åœ¨CentOSä¸­å®‰è£…Kubernetesè¯¦ç»†æŒ‡å—&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼Œä½œä¸ºå­¦ä¹ Kubernetesçš„å¿ƒè·¯å†ç¨‹å§ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡ä¸»è¦è®²è§£&lt;strong&gt;Kubernetesçš„ç½‘ç»œé…ç½®&lt;/strong&gt;ï¼ŒğŸ‘†æ–‡ä¸­æœ‰ä¸€ä¸ªå®‰è£…&lt;strong&gt;Flannel&lt;/strong&gt;çš„æ­¥éª¤ï¼Œä½†æ˜¯å®‰è£…å¥½åå¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®è¯´æ˜ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®flannel&#34;&gt;é…ç½®flannel&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„yumå®‰è£…çš„flannleï¼Œå®‰è£…å¥½åä¼šç”Ÿæˆ&lt;code&gt;/usr/lib/systemd/system/flanneld.service&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Flanneld overlay address etcd agent
After=network.target
After=network-online.target
Wants=network-online.target
After=etcd.service
Before=docker.service

[Service]
Type=notify
EnvironmentFile=/etc/sysconfig/flanneld
EnvironmentFile=-/etc/sysconfig/docker-network
ExecStart=/usr/bin/flanneld-start $FLANNEL_OPTIONS
ExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker
Restart=on-failure

[Install]
WantedBy=multi-user.target
RequiredBy=docker.service
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°flannelç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶åœ¨&lt;code&gt;/etc/sysconfig/flanneld&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;# Flanneld configuration options  

# etcd url location.  Point this to the server where etcd runs
FLANNEL_ETCD_ENDPOINTS=&amp;quot;http://sz-pg-oam-docker-test-001.tendcloud.com:2379&amp;quot;

# etcd config key.  This is the configuration key that flannel queries
# For address range assignment
FLANNEL_ETCD_PREFIX=&amp;quot;/kube-centos/network&amp;quot;

# Any additional options that you want to pass
#FLANNEL_OPTIONS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;etcdçš„åœ°å€&lt;code&gt;FLANNEL_ETCD_ENDPOINT&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;etcdæŸ¥è¯¢çš„ç›®å½•ï¼ŒåŒ…å«dockerçš„IPåœ°å€æ®µé…ç½®ã€‚&lt;code&gt;FLANNEL_ETCD_PREFIX&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;åœ¨etcdä¸­åˆ›å»ºç½‘ç»œé…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¸ºdockeråˆ†é…IPåœ°å€æ®µã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;etcdctl mkdir /kube-centos/network
etcdctl mk /kube-centos/network/config &amp;quot;{ \&amp;quot;Network\&amp;quot;: \&amp;quot;172.30.0.0/16\&amp;quot;, \&amp;quot;SubnetLen\&amp;quot;: 24, \&amp;quot;Backend\&amp;quot;: { \&amp;quot;Type\&amp;quot;: \&amp;quot;vxlan\&amp;quot; } }&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®Docker&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Flannelçš„&lt;a href=&#34;https://github.com/coreos/flannel/blob/master/Documentation/running.md&#34;&gt;æ–‡æ¡£&lt;/a&gt;ä¸­æœ‰å†™&lt;strong&gt;Docker Integration&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;p&gt;Docker daemon accepts &lt;code&gt;--bip&lt;/code&gt; argument to configure the subnet of the docker0 bridge. It also accepts &lt;code&gt;--mtu&lt;/code&gt; to set the MTU for docker0 and veth devices that it will be creating. Since flannel writes out the acquired subnet and MTU values into a file, the script starting Docker can source in the values and pass them to Docker daemon:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;source /run/flannel/subnet.env
docker daemon --bip=${FLANNEL_SUBNET} --mtu=${FLANNEL_MTU} &amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Systemd users can use &lt;code&gt;EnvironmentFile&lt;/code&gt; directive in the .service file to pull in &lt;code&gt;/run/flannel/subnet.env&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹è½½flannel github releaseä¸­çš„taråŒ…ï¼Œè§£å‹åä¼šè·å¾—ä¸€ä¸ª&lt;strong&gt;mk-docker-opts.sh&lt;/strong&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥&lt;code&gt;Generate Docker daemon options based on flannel env file&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;./mk-docker-opts.sh -i&lt;/code&gt;å°†ä¼šç”Ÿæˆå¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶ç¯å¢ƒå˜é‡æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;/run/flannel/subnet.env&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;FLANNEL_NETWORK=172.30.0.0/16
FLANNEL_SUBNET=172.30.46.1/24
FLANNEL_MTU=1450
FLANNEL_IPMASQ=false
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/run/docker_opts.env&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;DOCKER_OPT_BIP=&amp;quot;--bip=172.30.46.1/24&amp;quot;
DOCKER_OPT_IPMASQ=&amp;quot;--ip-masq=true&amp;quot;
DOCKER_OPT_MTU=&amp;quot;--mtu=1450&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨æŸ¥è¯¢etcdä¸­çš„å†…å®¹å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$etcdctl ls /kube-centos/network/subnets
/kube-centos/network/subnets/172.30.14.0-24
/kube-centos/network/subnets/172.30.38.0-24
/kube-centos/network/subnets/172.30.46.0-24
$etcdctl get /kube-centos/network/config
{ &amp;quot;Network&amp;quot;: &amp;quot;172.30.0.0/16&amp;quot;, &amp;quot;SubnetLen&amp;quot;: 24, &amp;quot;Backend&amp;quot;: { &amp;quot;Type&amp;quot;: &amp;quot;vxlan&amp;quot; } }
$etcdctl get /kube-centos/network/subnets/172.30.14.0-24
{&amp;quot;PublicIP&amp;quot;:&amp;quot;172.20.0.114&amp;quot;,&amp;quot;BackendType&amp;quot;:&amp;quot;vxlan&amp;quot;,&amp;quot;BackendData&amp;quot;:{&amp;quot;VtepMAC&amp;quot;:&amp;quot;56:27:7d:1c:08:22&amp;quot;}}
$etcdctl get /kube-centos/network/subnets/172.30.38.0-24
{&amp;quot;PublicIP&amp;quot;:&amp;quot;172.20.0.115&amp;quot;,&amp;quot;BackendType&amp;quot;:&amp;quot;vxlan&amp;quot;,&amp;quot;BackendData&amp;quot;:{&amp;quot;VtepMAC&amp;quot;:&amp;quot;12:82:83:59:cf:b8&amp;quot;}}
$etcdctl get /kube-centos/network/subnets/172.30.46.0-24
{&amp;quot;PublicIP&amp;quot;:&amp;quot;172.20.0.113&amp;quot;,&amp;quot;BackendType&amp;quot;:&amp;quot;vxlan&amp;quot;,&amp;quot;BackendData&amp;quot;:{&amp;quot;VtepMAC&amp;quot;:&amp;quot;e6:b2:fd:f6:66:96&amp;quot;}}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è®¾ç½®docker0ç½‘æ¡¥çš„IPåœ°å€&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;source /run/flannel/subnet.env
ifconfig docker0 $FLANNEL_SUBNET
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·docker0å’Œflannelç½‘æ¡¥ä¼šåœ¨åŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œå¦‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;6: docker0: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc noqueue state DOWN 
    link/ether 02:42:da:bf:83:a2 brd ff:ff:ff:ff:ff:ff
    inet 172.30.38.1/24 brd 172.30.38.255 scope global docker0
       valid_lft forever preferred_lft forever
7: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1450 qdisc noqueue state UNKNOWN 
    link/ether 9a:29:46:61:03:44 brd ff:ff:ff:ff:ff:ff
    inet 172.30.38.0/32 scope global flannel.1
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å°±å¯ä»¥é‡å¯dockeräº†ã€‚&lt;/p&gt;

&lt;p&gt;é‡å¯äº†dockeråè¿˜è¦é‡å¯kubeletï¼Œè¿™æ—¶åˆé‡åˆ°é—®é¢˜ï¼Œkubeletå¯åŠ¨å¤±è´¥ã€‚æŠ¥é”™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Mar 31 16:44:41 sz-pg-oam-docker-test-002.tendcloud.com kubelet[81047]: error: failed to run Kubelet: failed to create kubelet: misconfiguration: kubelet cgroup driver: &amp;quot;cgroupfs&amp;quot; is different from docker cgroup driver: &amp;quot;systemd&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ˜¯kubeletä¸dockerçš„&lt;strong&gt;cgroup driver&lt;/strong&gt;ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œkubeletå¯åŠ¨çš„æ—¶å€™æœ‰ä¸ª&lt;code&gt;â€”cgroup-driver&lt;/code&gt;å‚æ•°å¯ä»¥æŒ‡å®šä¸º&amp;rdquo;cgroupfs&amp;rdquo;æˆ–è€…â€œsystemdâ€ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;--cgroup-driver string                                    Driver that the kubelet uses to manipulate cgroups on the host.  Possible values: &#39;cgroupfs&#39;, &#39;systemd&#39; (default &amp;quot;cgroupfs&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨flannel&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;systemctl daemon-reload
systemctl start flanneld
systemctl status flanneld
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é‡æ–°ç™»å½•è¿™ä¸‰å°ä¸»æœºï¼Œå¯ä»¥çœ‹åˆ°æ¯å°ä¸»æœºéƒ½å¤šäº†ä¸€ä¸ªIPã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒKuberneteså®˜æ–¹æ–‡æ¡£çš„&lt;a href=&#34;https://kubernetes.io/docs/tutorials/stateless-application/expose-external-ip-address/&#34;&gt;Exposing an External IP Address to Access an Application in a Cluster&lt;/a&gt;ï¼Œå®˜æ–¹ä½¿ç”¨çš„Hello Worldæµ‹è¯•ï¼Œæˆ‘ä»¬å¯åŠ¨NginxæœåŠ¡æµ‹è¯•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;#å¯åŠ¨nginxçš„pod
kubectl run nginx --replicas=2 --labels=&amp;quot;run=load-balancer-example&amp;quot; --image=sz-pg-oam-docker-hub-001.tendcloud.com/library/nginx:1.9  --port=80
#åˆ›å»ºåä¸ºexample-serviceçš„æœåŠ¡
kubectl expose deployment nginx --type=NodePort --name=example-service
#æŸ¥çœ‹çŠ¶æ€
kubectl get deployments nginx
kubectl describe deployments nginx
kubectl get replicasets
kubectl describe replicasets
kubectl describe svc example-service
###################################################
Name:			example-service
Namespace:		default
Labels:			run=load-balancer-example
Annotations:		&amp;lt;none&amp;gt;
Selector:		run=load-balancer-example
Type:			NodePort
IP:			10.254.180.209
Port:			&amp;lt;unset&amp;gt;	80/TCP
NodePort:		&amp;lt;unset&amp;gt;	32663/TCP
Endpoints:		172.30.14.2:80,172.30.46.2:80
Session Affinity:	None
Events:			&amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬ä¸Šé¢å¯åŠ¨çš„serivceçš„typeæ˜¯&lt;strong&gt;NodePort&lt;/strong&gt;ï¼ŒKubernetesçš„serviceæ”¯æŒä¸‰ç§ç±»å‹çš„serviceï¼Œå‚è€ƒ&lt;a href=&#34;http://www.cnblogs.com/xuxinkun/p/5331728.html&#34;&gt;Kubernetes Serivceåˆ†æ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨è®¿é—®ä¸‰å°ç‰©ç†æœºçš„IP:80ç«¯å£å°±å¯ä»¥çœ‹åˆ°nginxçš„é¡µé¢äº†ã€‚&lt;/p&gt;

&lt;p&gt;ç¨ç­‰ä¸€ä¼šåœ¨è®¿é—®ClusterIP + Portä¹Ÿå¯ä»¥è®¿é—®åˆ°nginxã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$curl 10.254.180.209:80
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;Welcome to nginx!&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Welcome to nginx!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;For online documentation and support please refer to
&amp;lt;a href=&amp;quot;http://nginx.org/&amp;quot;&amp;gt;nginx.org&amp;lt;/a&amp;gt;.&amp;lt;br/&amp;gt;
Commercial support is available at
&amp;lt;a href=&amp;quot;http://nginx.com/&amp;quot;&amp;gt;nginx.com&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;em&amp;gt;Thank you for using nginx.&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;è™šæ‹Ÿåœ°å€&#34;&gt;è™šæ‹Ÿåœ°å€&lt;/h2&gt;

&lt;p&gt;Kubernetesä¸­çš„Serviceäº†ä½¿ç”¨äº†è™šæ‹Ÿåœ°å€ï¼›è¯¥åœ°å€æ— æ³•pingé€šè¿‡ï¼Œä½†å¯ä»¥è®¿é—®å…¶ç«¯å£ã€‚é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œè¯¥è™šæ‹Ÿåœ°å€æ˜¯è‹¥å¹²æ¡iptablesçš„è§„åˆ™ã€‚åˆ°10.254.124.145:8080ç«¯å£çš„è¯·æ±‚ä¼šè¢«é‡å®šå‘åˆ°172.30.38.2æˆ–172.30.46.2çš„8080ç«¯å£ã€‚è¿™äº›è§„åˆ™æ˜¯ç”±kube-proxyç”Ÿæˆï¼›å¦‚æœéœ€è¦æŸå°æœºå™¨å¯ä»¥è®¿é—®Serviceï¼Œåˆ™éœ€è¦åœ¨è¯¥ä¸»æœºå¯åŠ¨kube-proxyã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹serviceçš„iptables&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$iptables-save|grep example-service
-A KUBE-NODEPORTS -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp --dport 32663 -j KUBE-MARK-MASQ
-A KUBE-NODEPORTS -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp --dport 32663 -j KUBE-SVC-BR4KARPIGKMRMN3E
-A KUBE-SEP-NCPBOLUH5XTTHG3E -s 172.30.46.2/32 -m comment --comment &amp;quot;default/example-service:&amp;quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-NCPBOLUH5XTTHG3E -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp -j DNAT --to-destination 172.30.46.2:80
-A KUBE-SEP-ONEKQBIWICF7RAR3 -s 172.30.14.2/32 -m comment --comment &amp;quot;default/example-service:&amp;quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-ONEKQBIWICF7RAR3 -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp -j DNAT --to-destination 172.30.14.2:80
-A KUBE-SERVICES -d 10.254.180.209/32 -p tcp -m comment --comment &amp;quot;default/example-service: cluster IP&amp;quot; -m tcp --dport 80 -j KUBE-SVC-BR4KARPIGKMRMN3E
-A KUBE-SVC-BR4KARPIGKMRMN3E -m comment --comment &amp;quot;default/example-service:&amp;quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-ONEKQBIWICF7RAR3
-A KUBE-SVC-BR4KARPIGKMRMN3E -m comment --comment &amp;quot;default/example-service:&amp;quot; -j KUBE-SEP-NCPBOLUH5XTTHG3E
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹clusterIPçš„iptables&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$iptables -t nat -nL|grep 10.254
KUBE-SVC-NPX46M4PTMTKRN6Y  tcp  --  0.0.0.0/0            10.254.0.1           /* default/kubernetes:https cluster IP */ tcp dpt:443
KUBE-SVC-BR4KARPIGKMRMN3E  tcp  --  0.0.0.0/0            10.254.180.209       /* default/example-service: cluster IP */ tcp dpt:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨PREROUTINGç¯èŠ‚ï¼Œk8sè®¾ç½®äº†ä¸€ä¸ªtarget: KUBE-SERVICESã€‚è€ŒKUBE-SERVICESä¸‹é¢åˆè®¾ç½®äº†è®¸å¤štargetï¼Œä¸€æ—¦destinationå’ŒdstportåŒ¹é…ï¼Œå°±ä¼šæ²¿ç€chainè¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ï¼šå½“æˆ‘ä»¬åœ¨podç½‘ç»œcurl 10.254.198.44 80æ—¶ï¼ŒåŒ¹é…åˆ°ä¸‹é¢çš„KUBE-SVC-BR4KARPIGKMRMN3E targetï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;KUBE-SVC-BR4KARPIGKMRMN3E  tcp  --  0.0.0.0/0            10.254.180.209       /* default/example-service: cluster IP */ tcp dpt:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;http://tonybai.com/2017/01/17/understanding-flannel-network-for-kubernetes/&#34;&gt;ç†è§£Kubernetesç½‘ç»œä¹‹Flannelç½‘ç»œ&lt;/a&gt;ï¼ŒTony Baiçš„æ–‡ç« ä¸­æœ‰å¯¹flannelçš„è¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é‡åˆ°çš„é—®é¢˜&#34;&gt;é‡åˆ°çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;åœ¨è®¾ç½®ç½‘ç»œçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œè®°å½•å¦‚ä¸‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é—®é¢˜ä¸€&#34;&gt;é—®é¢˜ä¸€&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Kube-proxyå¼€æ”¾çš„&lt;strong&gt;NodePort&lt;/strong&gt;ç«¯å£æ— æ³•è®¿é—®ã€‚å³æ— æ³•ä½¿ç”¨NodeIPåŠ NodePortçš„æ–¹å¼è®¿é—®serviceï¼Œè€Œä¸”æœ¬åœ°telnetä¹Ÿä¸é€šï¼Œä½†æ˜¯ç«¯å£ç¡®ç¡®å®å®åœ¨é‚£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é—®é¢˜çŠ¶æ€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å·²è§£å†³&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…¶å®è¿™ä¸æ˜¯é—®é¢˜ï¼Œæ˜¯å› ä¸ºä»ä¸Šé¢çš„æ“ä½œè®°å½•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ&lt;strong&gt;åœ¨å¯åŠ¨Nginxçš„Pod&lt;/strong&gt;æ—¶ï¼ŒæŒ‡å®športä¸º80å³å¯ã€‚ä»¥ClusterIP + Portçš„æ–¹å¼è®¿é—®serivceéœ€è¦ç­‰ä¸€æ®µæ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åæ€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘ä»¬å·®ä¸å¤šä¸¤å¤©æ—¶é—´ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„æ ¹æºè¿˜æ˜¯å› ä¸º&lt;u&gt;æ€æƒ³è§‚å¿µæ²¡æœ‰ä»è¿è¡Œdockerçš„å‘½ä»¤ä¸­è§£æ”¾å‡ºæ¥&lt;/u&gt;,è¿˜æŠŠ&lt;code&gt;kubelet run â€”port&lt;/code&gt;å½“æˆæ˜¯docker runä¸­çš„ç«¯å£æ˜ å°„ï¼Œè¿™ç§æƒ³æ³•æ˜¯å¤§é”™ç‰¹é”™çš„ï¼Œè¯¥ç«¯å£æ˜¯imageä¸­çš„åº”ç”¨å®é™…æš´éœ²çš„ç«¯å£ï¼Œå¦‚nginxçš„80ç«¯å£ã€‚ğŸ˜”&lt;/p&gt;

&lt;h3 id=&#34;é—®é¢˜äºŒ&#34;&gt;é—®é¢˜äºŒ&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ²¡æœ‰åˆ é™¤serviceå’Œdeployçš„æƒ…å†µä¸‹å°±é‡å¯kubeletçš„æ—¶å€™ï¼Œä¼šé‡åˆ°kubeletå¯åŠ¨å¤±è´¥çš„æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å‡ºé”™ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Apr 01 14:24:08 sz-pg-oam-docker-test-001.tendcloud.com kubelet[103932]: I0401 14:24:08.359839  103932 kubelet.go:1752] skipping pod synchronization - [Failed to start ContainerManager failed to initialise top level QOS containers: failed to create top level Burstable QOS cgroup : Unit kubepods-burstable.slice already exists.]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://www.osbaike.net/article-show-id-229028.html&#34;&gt;Kubernetes Resource QoSæœºåˆ¶è§£è¯»&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†QoSçš„æœºåˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesæ ¹æ®Podä¸­Containers Resourceçš„&lt;code&gt;request&lt;/code&gt;å’Œ&lt;code&gt;limit&lt;/code&gt;çš„å€¼æ¥å®šä¹‰Podçš„QoS Classã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºæ¯ä¸€ç§Resourceéƒ½å¯ä»¥å°†å®¹å™¨åˆ†ä¸º3ä¸­QoS Classes: Guaranteed, Burstable, and Best-Effortï¼Œå®ƒä»¬çš„QoSçº§åˆ«ä¾æ¬¡é€’å‡ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Guaranteed&lt;/strong&gt;ï¼šå¦‚æœPodä¸­æ‰€æœ‰Containerçš„æ‰€æœ‰Resourceçš„&lt;code&gt;limit&lt;/code&gt;å’Œ&lt;code&gt;request&lt;/code&gt;éƒ½ç›¸ç­‰ä¸”ä¸ä¸º0ï¼Œåˆ™è¿™ä¸ªPodçš„QoS Classå°±æ˜¯Guaranteedã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Burstable&lt;/strong&gt;ï¼šé™¤äº†ç¬¦åˆGuaranteedå’ŒBest-Effortçš„åœºæ™¯ï¼Œå…¶ä»–åœºæ™¯çš„Pod QoS Classéƒ½å±äºBurstableã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Best-Effort&lt;/strong&gt;ï¼šå¦‚æœPodä¸­æ‰€æœ‰å®¹å™¨çš„æ‰€æœ‰Resourceçš„requestå’Œlimitéƒ½æ²¡æœ‰èµ‹å€¼ï¼Œåˆ™è¿™ä¸ªPodçš„QoS Classå°±æ˜¯Best-Effortã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæš‚æ—¶è¿˜æ²¡æ‰¾åˆ°æ ¹æœ¬çš„è§£å†³åŠæ³•ï¼Œå‚è€ƒGithubä¸Šçš„&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/43856&#34;&gt;Failed to start ContainerManager failed to initialize top level QOS containers #43856&lt;/a&gt;ï¼Œé‡å¯ä¸»æœºåç¡®å®æ­£å¸¸äº†ï¼Œä¸è¿‡è¿™åªæ˜¯ä¸´æ—¶è§£å†³æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;å…¶å®æ˜¨å¤©å°±å·²ç»å®‰è£…å®Œæ¯•äº†ï¼Œæ˜¯æˆ‘ä»¬ä½¿ç”¨çš„å§¿åŠ¿ä¸å¯¹ï¼Œç™½ç™½è€½è¯¯è¿™ä¹ˆé•¿æ—¶é—´ï¼Œèº«è¾¹å·®ä¸ªè€å¸æœºå•Šï¼Œæ»´ï½å­¦ç”Ÿå¡ã€‚&lt;/p&gt;

&lt;p&gt;æ„Ÿè°¢&lt;a href=&#34;tonybai.com&#34;&gt;Tony Bai&lt;/a&gt;ã€&lt;a href=&#34;https://godliness.github.io/&#34;&gt;Peter Ma&lt;/a&gt;çš„å¤§åŠ›æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;Apr 1,2017 æ„šäººèŠ‚ï¼Œä¸œç›´é—¨&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨CentOSä¸Šå®‰è£…kubernetesè¯¦ç»†æŒ‡å—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/</link>
      <pubDate>Thu, 30 Mar 2017 20:44:20 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2014082501.jpg&#34; alt=&#34;åœ†æ˜å›­&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šåŒ—äº¬åœ†æ˜å›­ Aug 25,2014ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ä½œè€…ï¼š&lt;a href=&#34;rootsongjc.github.io/about&#34;&gt;Jimmy Song&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://godliness.github.io/&#34;&gt;Peter Ma&lt;/a&gt;ï¼Œ2017å¹´3æœˆ30æ—¥&lt;/p&gt;

&lt;p&gt;æœ€è¿‘å†³å®šä»Docker Swarm ModeæŠ•å…¥åˆ°Kubernetesçš„æ€€æŠ±ï¼Œå¯¹Dockerçš„æˆ˜ç•¥å’Œä¼ä¸šåŒ–å‘å±•å‰æ™¯æ¯”è¾ƒå ªå¿§ï¼Œè€ŒKubernetesæ˜¯&lt;a href=&#34;https://www.cncf.io/&#34;&gt;CNCF&lt;/a&gt;çš„æˆå‘˜ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç¯‡æ˜¯æ ¹æ®&lt;a href=&#34;https://kubernetes.io/docs/getting-started-guides/centos/centos_manual_config/#prerequisites&#34;&gt;å®˜æ–¹å®‰è£…æ–‡æ¡£&lt;/a&gt;å®è·µæ•´ç†çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯çº¯å‡€çš„CentOS7.2ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–è¿˜æœ‰ä¸€ä¸ªPeter Maå†™çš„&lt;a href=&#34;https://godliness.github.io/2017/03/29/%E5%9C%A8CentOS7%E4%B8%8A%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85Kubernetes/&#34;&gt;åœ¨CentOSä¸Šæ‰‹åŠ¨å®‰è£…kubernetesçš„æ–‡æ¡£&lt;/a&gt;å¯ä»¥å‚è€ƒã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è§’è‰²åˆ†é…&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢ä»¥åœ¨ä¸‰å°ä¸»æœºä¸Šå®‰è£…Kubernetesä¸ºä¾‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;172.20.0.113 master/node kube-apiserver kube-controller-manager kube-scheduler kubelet kube-proxy etcd flannel
172.20.0.114 node kubectl kube-proxy flannel
172.20.0.115 node kubectl kube-proxy flannel
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¬¬ä¸€å°ä¸»æœºæ—¢ä½œä¸ºmasterä¹Ÿä½œä¸ºnodeã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç³»ç»Ÿç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Centos 7.2.1511&lt;/li&gt;
&lt;li&gt;docker 1.12.6&lt;/li&gt;
&lt;li&gt;etcd 3.1.5&lt;/li&gt;
&lt;li&gt;kubernetes 1.6.0&lt;/li&gt;
&lt;li&gt;flannel 0.7.0-1&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h1&gt;

&lt;p&gt;ä¸‹é¢ç»™å‡ºä¸¤ç§å®‰è£…æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é…ç½®yumæºåï¼Œä½¿ç”¨yumå®‰è£…ï¼Œå¥½å¤„æ˜¯ç®€å•ï¼Œåå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œéœ€è¦googleæ›´æ–°yumæºæ‰èƒ½è·å¾—æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶ï¼Œè€Œæ‰€æœ‰è½¯ä»¶çš„ä¾èµ–åˆä¸èƒ½è‡ªå·±æŒ‡å®šï¼Œå°¤å…¶æ˜¯ä½ çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å¦‚æœä½çš„è¯ï¼Œä½¿ç”¨yumæºå®‰è£…çš„kubernetesçš„ç‰ˆæœ¬ä¹Ÿä¼šå—åˆ°é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ï¼Œå¥½å¤„æ˜¯å¯ä»¥å®‰è£…ä»»æ„ç‰ˆæœ¬çš„kubernetesï¼Œåå¤„æ˜¯é…ç½®æ¯”è¾ƒå¤æ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼å®‰è£…ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡çš„å¾ˆå¤šå®‰è£…æ­¥éª¤å’Œå‘½ä»¤æ˜¯å‚è€ƒçš„Kuberneteså®˜ç½‘&lt;a href=&#34;https://kubernetes.io/docs/getting-started-guides/centos/centos_manual_config/&#34;&gt;CentOS Manual Config&lt;/a&gt;æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç¬¬ä¸€ç§æ–¹å¼-centosç³»ç»Ÿä¸­ç›´æ¥ä½¿ç”¨yumå®‰è£…&#34;&gt;ç¬¬ä¸€ç§æ–¹å¼ï¼šCentOSç³»ç»Ÿä¸­ç›´æ¥ä½¿ç”¨yumå®‰è£…&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ç»™yumæºå¢åŠ ä¸€ä¸ªRepo&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[virt7-docker-common-release]
name=virt7-docker-common-release
baseurl=http://cbs.centos.org/repos/virt7-docker-common-release/x86_64/os/
gpgcheck=0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…dockerã€kubernetesã€etcdã€flannelä¸€æ­¥åˆ°ä½&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;yum -y install --enablerepo=virt7-docker-common-release kubernetes etcd flannel
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®‰è£…å¥½äº†ä¹‹åéœ€è¦ä¿®æ”¹ä¸€ç³»åˆ—é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªrepoåœ¨CentOS7.3ä¸‹æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œå› ä¸ºCentOSå®˜æ–¹æºçš„extrasä¸­å·²ç»åŒ…å«äº†Kubernetes1.5.2ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯CentOS7.3çš„è¯ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…Kubernetes1.5.2ï¼ˆTill March 30,2017ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯CentOS7.2çš„åŒ–ï¼Œè¿™ä¸ªæºå°±æœ‰ç”¨äº†ï¼Œä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…Kubernentes1.1ã€‚æˆ‘ä»¬ç°åœ¨è¦å®‰è£…ç›®å‰çš„æœ€æ–°ç‰ˆæœ¬Kubernetes1.6ï¼Œè€Œä½¿ç”¨çš„åˆæ˜¯CentOS7.2ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä½¿ç”¨yumå®‰è£…ï¼ˆå½“å‰yumæºæ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬çš„kuberentesæ˜¯1.5.2ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç¬¬äºŒç§æ–¹å¼-ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…&#34;&gt;ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…&lt;/h2&gt;

&lt;p&gt;è¿™ç§æ–¹å¼å®‰è£…çš„è¯ï¼Œéœ€è¦è‡ªå·±ä¸€ä¸ªä¸€ä¸ªç»„ä»¶çš„å®‰è£…ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…docker&#34;&gt;å®‰è£…Docker&lt;/h3&gt;

&lt;p&gt;yum localinstall ./docker-engine*&lt;/p&gt;

&lt;p&gt;å°†ä½¿ç”¨CentOSçš„&lt;strong&gt;extras&lt;/strong&gt; repoä¸‹è½½ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³é—­é˜²ç«å¢™å’Œselinux&#34;&gt;å…³é—­é˜²ç«å¢™å’ŒSELinux&lt;/h3&gt;

&lt;p&gt;è¿™æ˜¯å®˜ç½‘ä¸Šå»ºè®®çš„ï¼Œæˆ‘æ˜¯ç›´æ¥å°†iptables-serviceså’Œfirewlldå¸è½½æ‰äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;setenforce 0
systemctl disable iptables-services firewalld
systemctl stop iptables-services firewalld
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;å®‰è£…etcd&#34;&gt;å®‰è£…etcd&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;DOWNLOAD_URL=https://storage.googleapis.com/etcd  #etcdå­˜å‚¨åœ°å€
ETCD_VER=v3.1.5  #è®¾ç½®etcdç‰ˆæœ¬å·
wget ${DOWNLOAD_URL}/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz
tar xvf etcd-${ETCD_VER}-linux-amd64.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;éƒ¨ç½²æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å°†å¦‚ä¸‹å†…å®¹å†™å…¥æ–‡ä»¶ /etc/etcd/etcd.conf ä¸­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;# [member]
ETCD_NAME=default
ETCD_DATA_DIR=&amp;quot;/var/lib/etcd/default.etcd&amp;quot;
# ETCD_WAL_DIR=&amp;quot;&amp;quot;
# ETCD_SNAPSHOT_COUNT=&amp;quot;10000&amp;quot;
# ETCD_HEARTBEAT_INTERVAL=&amp;quot;100&amp;quot;
# ETCD_ELECTION_TIMEOUT=&amp;quot;1000&amp;quot;
# ETCD_LISTEN_PEER_URLS=&amp;quot;http://localhost:2380&amp;quot;
ETCD_LISTEN_CLIENT_URLS=&amp;quot;http://0.0.0.0:2379&amp;quot;
# ETCD_MAX_SNAPSHOTS=&amp;quot;5&amp;quot;
# ETCD_MAX_WALS=&amp;quot;5&amp;quot;
# ETCD_CORS=&amp;quot;&amp;quot;
#
# [cluster]
# ETCD_INITIAL_ADVERTISE_PEER_URLS=&amp;quot;http://localhost:2380&amp;quot;
# if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. &amp;quot;test=http://...&amp;quot;
# ETCD_INITIAL_CLUSTER=&amp;quot;default=http://localhost:2380&amp;quot;
# ETCD_INITIAL_CLUSTER_STATE=&amp;quot;new&amp;quot;
# ETCD_INITIAL_CLUSTER_TOKEN=&amp;quot;etcd-cluster&amp;quot;
ETCD_ADVERTISE_CLIENT_URLS=&amp;quot;http://0.0.0.0:2379&amp;quot;
# ETCD_DISCOVERY=&amp;quot;&amp;quot;
# ETCD_DISCOVERY_SRV=&amp;quot;&amp;quot;
# ETCD_DISCOVERY_FALLBACK=&amp;quot;proxy&amp;quot;
# ETCD_DISCOVERY_PROXY=&amp;quot;&amp;quot;
#
# [proxy]
# ETCD_PROXY=&amp;quot;off&amp;quot;
# ETCD_PROXY_FAILURE_WAIT=&amp;quot;5000&amp;quot;
# ETCD_PROXY_REFRESH_INTERVAL=&amp;quot;30000&amp;quot;
# ETCD_PROXY_DIAL_TIMEOUT=&amp;quot;1000&amp;quot;
# ETCD_PROXY_WRITE_TIMEOUT=&amp;quot;5000&amp;quot;
# ETCD_PROXY_READ_TIMEOUT=&amp;quot;0&amp;quot;
#
# [security]
# ETCD_CERT_FILE=&amp;quot;&amp;quot;
# ETCD_KEY_FILE=&amp;quot;&amp;quot;
# ETCD_CLIENT_CERT_AUTH=&amp;quot;false&amp;quot;
# ETCD_TRUSTED_CA_FILE=&amp;quot;&amp;quot;
# ETCD_PEER_CERT_FILE=&amp;quot;&amp;quot;
# ETCD_PEER_KEY_FILE=&amp;quot;&amp;quot;
# ETCD_PEER_CLIENT_CERT_AUTH=&amp;quot;false&amp;quot;
# ETCD_PEER_TRUSTED_CA_FILE=&amp;quot;&amp;quot;
# [logging]
# ETCD_DEBUG=&amp;quot;false&amp;quot;
# examples for -log-package-levels etcdserver=WARNING,security=DEBUG
# ETCD_LOG_PACKAGE_LEVELS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°† etcd, etcdctlæ”¾å…¥ /usr/bin/ä¸‹ï¼Œå¹¶å°†å¦‚ä¸‹å†…å®¹å†™è¿›/usr/lib/systemd/system/etcd.serviceæ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
WorkingDirectory=/var/lib/etcd/
EnvironmentFile=-/etc/etcd/etcd.conf
User=etcd
# set GOMAXPROCS to number of processors
ExecStart=/bin/bash -c &amp;quot;GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\&amp;quot;${ETCD_NAME}\&amp;quot; --data-dir=\&amp;quot;${ETCD_DATA_DIR}\&amp;quot; --listen-client-urls=\&amp;quot;${ETCD_LISTEN_CLIENT_URLS}\&amp;quot;&amp;quot;
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨å¹¶æ ¡éªŒ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;systemctl start etcd
systemctl enable etcd
systemctl status etcd
etcdctl ls
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é›†ç¾¤&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è‹¥è¦éƒ¨ç½²å¤šèŠ‚ç‚¹é›†ç¾¤ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªè¦æ›´æ”¹etcd.confæ–‡ä»¶ä»¥åŠetcd.serviceæ·»åŠ ç›¸åº”é…ç½®å³å¯&lt;/p&gt;

&lt;p&gt;å¯ä»¥å‚è€ƒé“¾æ¥ï¼š&lt;a href=&#34;https://github.com/coreos/etcd/blob/master/Documentation/op-guide/clustering.md&#34;&gt;https://github.com/coreos/etcd/blob/master/Documentation/op-guide/clustering.md&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…flannel&#34;&gt;å®‰è£…flannel&lt;/h3&gt;

&lt;p&gt;å¯ä»¥ç›´æ¥ä½¿ç”¨&lt;code&gt;yum install flannel&lt;/code&gt;å®‰è£…ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºç½‘ç»œè¿™å—çš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å°†åœ¨åç»­æ–‡ç« ä¸­è¯´æ˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…kubernetes&#34;&gt;å®‰è£…Kubernetes&lt;/h3&gt;

&lt;p&gt;æ ¹æ®ã€ŠKubernetesæƒå¨æŒ‡å—ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ä¸­çš„ä»‹ç»ï¼Œç›´æ¥ä½¿ç”¨GitHubä¸Šçš„releaseé‡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£…ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;wget https://github.com/kubernetes/kubernetes/releases/download/v1.6.0/kubernetes.tar.gz
tar kubernetes.tar.gz
cd kubernetes
./cluster/get-kube-binaries.sh
cd server
tar xvf kubernetes-server-linux-amd64.tar.gz
rm -f *_tag *.tar
chmod 755 *
mv * /usr/bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®é™…ä¸‹è½½kubernetes-server-linux-amd64.tar.gz from &lt;a href=&#34;https://storage.googleapis.com/kubernetes-release/release/v1.6.0&#34;&gt;https://storage.googleapis.com/kubernetes-release/release/v1.6.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è§£å‹å®Œåè·å¾—çš„äºŒè¿›åˆ¶æ–‡ä»¶æœ‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cloud-controller-manager
hyperkube
kubeadm
kube-aggregator
kube-apiserver
kube-controller-manager
kubectl
kubefed
kubelet
kube-proxy
kube-scheduler
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;cluster/juju/layers/kubernetes-master/templates&lt;/code&gt;ç›®å½•ä¸‹æœ‰serviceå’Œç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶çš„æ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿æœ¬æ¥æ˜¯ä¸ºäº†ä½¿ç”¨&lt;a href=&#34;https://jujucharms.com/&#34;&gt;juju&lt;/a&gt;å®‰è£…å†™çš„ã€‚&lt;/p&gt;

&lt;h4 id=&#34;masterèŠ‚ç‚¹çš„é…ç½®&#34;&gt;MasterèŠ‚ç‚¹çš„é…ç½®&lt;/h4&gt;

&lt;p&gt;MasterèŠ‚ç‚¹éœ€è¦é…ç½®çš„kubernetesçš„ç»„ä»¶æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;kube-apiserver&lt;/li&gt;
&lt;li&gt;kube-controller-manager&lt;/li&gt;
&lt;li&gt;kube-scheduler&lt;/li&gt;
&lt;li&gt;kube-proxy&lt;/li&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-apiserver&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-apiserver.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;a href=&#34;http://blog.csdn.net/yuesichiu/article/details/51485147&#34;&gt;CentOSä¸­çš„serviceé…ç½®æ–‡ä»¶å‚è€ƒ&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes API Service
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=network.target
After=etcd.service

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/apiserver
ExecStart=/usr/bin/kube-apiserver \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_ETCD_SERVERS \
	    $KUBE_API_ADDRESS \
	    $KUBE_API_PORT \
	    $KUBELET_PORT \
	    $KUBE_ALLOW_PRIV \
	    $KUBE_SERVICE_ADDRESSES \
	    $KUBE_ADMISSION_CONTROL \
	    $KUBE_API_ARGS
Restart=on-failure
Type=notify
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ›å»ºkubernetesçš„é…ç½®æ–‡ä»¶ç›®å½•&lt;code&gt;/etc/kubernetes&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ·»åŠ &lt;code&gt;config&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes system config
#
# The following values are used to configure various aspects of all
# kubernetes services, including
#
#   kube-apiserver.service
#   kube-controller-manager.service
#   kube-scheduler.service
#   kubelet.service
#   kube-proxy.service
# logging to stderr means we get it in the systemd journal
KUBE_LOGTOSTDERR=&amp;quot;--logtostderr=true&amp;quot;

# journal message level, 0 is debug
KUBE_LOG_LEVEL=&amp;quot;--v=0&amp;quot;

# Should this cluster be allowed to run privileged docker containers
KUBE_ALLOW_PRIV=&amp;quot;--allow-privileged=false&amp;quot;

# How the controller-manager, scheduler, and proxy find the apiserver
KUBE_MASTER=&amp;quot;--master=http://sz-pg-oam-docker-test-001.tendcloud.com:8080&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ·»åŠ &lt;code&gt;apiserver&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
## kubernetes system config
##
## The following values are used to configure the kube-apiserver
##
#
## The address on the local server to listen to.
KUBE_API_ADDRESS=&amp;quot;--address=sz-pg-oam-docker-test-001.tendcloud.com&amp;quot;
#
## The port on the local server to listen on.
KUBE_API_PORT=&amp;quot;--port=8080&amp;quot;
#
## Port minions listen on
KUBELET_PORT=&amp;quot;--kubelet-port=10250&amp;quot;
#
## Comma separated list of nodes in the etcd cluster
KUBE_ETCD_SERVERS=&amp;quot;--etcd-servers=http://127.0.0.1:2379&amp;quot;
#
## Address range to use for services
KUBE_SERVICE_ADDREKUBELET_POD_INFRA_CONTAINERSSES=&amp;quot;--service-cluster-ip-range=10.254.0.0/16&amp;quot;
#
## default admission control policies
KUBE_ADMISSION_CONTROL=&amp;quot;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota&amp;quot;
#
## Add your own!
#KUBE_API_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;â€”admission-control&lt;/code&gt;å‚æ•°æ˜¯Kubernetesçš„å®‰å…¨æœºåˆ¶é…ç½®ï¼Œè¿™äº›å®‰å…¨æœºåˆ¶éƒ½æ˜¯ä»¥æ’ä»¶çš„å½¢å¼ç”¨æ¥å¯¹API Serveè¿›è¡Œå‡†å…¥æ§åˆ¶ï¼Œä¸€å¼€å§‹æˆ‘ä»¬æ²¡æœ‰é…ç½®&lt;code&gt;ServiceAccount&lt;/code&gt;ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿é›†ç¾¤ä¹‹é—´çš„é€šä¿¡ï¼Œä¸éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœä½ éœ€è¦æ›´é«˜çº§çš„èº«ä»½éªŒè¯å’Œé‰´æƒçš„è¯å°±éœ€è¦åŠ ä¸Šå®ƒäº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-controller-manager&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-controller.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;Description=Kubernetes Controller Manager
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/controller-manager
ExecStart=/usr/bin/kube-controller-manager \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_CONTROLLER_MANAGER_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;controller-manager&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# The following values are used to configure the kubernetes controller-manager

# defaults from config and apiserver should be adequate

# Add your own!
KUBE_CONTROLLER_MANAGER_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-scheduler&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-scheduler.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Scheduler Plugin
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/scheduler
ExecStart=/usr/bin/kube-scheduler \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_SCHEDULER_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;scheduler&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes scheduler config

# default config should be adequate

# Add your own!
KUBE_SCHEDULER_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-proxy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-proxy.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Kube-Proxy Server
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=network.target

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/proxy
ExecStart=/usr/bin/kube-proxy \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_PROXY_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;proxy&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes proxy config

# default config should be adequate

# Add your own!
KUBE_PROXY_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kubelet&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kubelet.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Kubelet Server
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=docker.service
Requires=docker.service

[Service]
WorkingDirectory=/var/lib/kubelet
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/kubelet
ExecStart=/usr/bin/kubelet \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBELET_API_SERVER \
	    $KUBELET_ADDRESS \
	    $KUBELET_PORT \
	    $KUBELET_HOSTNAME \
	    $KUBE_ALLOW_PRIV \
	    $KUBELET_POD_INFRA_CONTAINER \
	    $KUBELET_ARGS
Restart=on-failure

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;kubelet&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
## kubernetes kubelet (minion) config
#
## The address for the info server to serve on (set to 0.0.0.0 or &amp;quot;&amp;quot; for all interfaces)
KUBELET_ADDRESS=&amp;quot;--address=0.0.0.0&amp;quot;
#
## The port for the info server to serve on
KUBELET_PORT=&amp;quot;--port=10250&amp;quot;
#
## You may leave this blank to use the actual hostname
KUBELET_HOSTNAME=&amp;quot;--hostname-override=sz-pg-oam-docker-test-001.tendcloud.com&amp;quot;
#
## location of the api-server
KUBELET_API_SERVER=&amp;quot;--api-servers=http://sz-pg-oam-docker-test-001.tendcloud.com:8080&amp;quot;
#
## pod infrastructure container
KUBELET_POD_INFRA_CONTAINER=&amp;quot;--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest&amp;quot;
#
## Add your own!
KUBELET_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;âš ï¸&lt;code&gt;KUBELET_POD_INFRA_CONTAINER&lt;/code&gt;åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®æˆè‡ªå·±ç§æœ‰ä»“åº“é‡Œçš„imageã€‚&lt;/p&gt;

&lt;h4 id=&#34;nodeèŠ‚ç‚¹é…ç½®&#34;&gt;NodeèŠ‚ç‚¹é…ç½®&lt;/h4&gt;

&lt;p&gt;NodeèŠ‚ç‚¹éœ€è¦é…ç½®ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;kube-proxy&lt;/li&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;kube-proxy&lt;/code&gt;çš„é…ç½®ä¸masterèŠ‚ç‚¹çš„kube-proxyé…ç½®ç›¸åŒã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;kubectl&lt;/code&gt;çš„é…ç½®éœ€è¦ä¿®æ”¹&lt;code&gt;KUBELET_HOST&lt;/code&gt;ä¸ºæœ¬æœºçš„hostnameï¼Œå…¶å®ƒé…ç½®ç›¸åŒã€‚&lt;/p&gt;

&lt;h1 id=&#34;å¯åŠ¨&#34;&gt;å¯åŠ¨&lt;/h1&gt;

&lt;p&gt;åœ¨&lt;strong&gt;Master&lt;/strong&gt;èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;for SERVICES in etcd kube-apiserver kube-controller-manager kube-scheduler kube-proxy kubelet flanneld; do
    systemctl restart $SERVICES
    systemctl enable $SERVICES
    systemctl status $SERVICES
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨å¦å¤–ä¸¤å°NodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;for SERVICES in kube-proxy kubelet flanneld; do
    systemctl restart $SERVICES
    systemctl enable $SERVICES
    systemctl status $SERVICES
done
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;éªŒè¯&#34;&gt;éªŒè¯&lt;/h1&gt;

&lt;p&gt;åœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl get all
NAME             CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
svc/kubernetes   10.254.0.1   &amp;lt;none&amp;gt;        443/TCP   1h
$kubectl get nodes
NAME                                      STATUS    AGE       VERSION
sz-pg-oam-docker-test-001.tendcloud.com   Ready     7m        v1.6.0
sz-pg-oam-docker-test-002.tendcloud.com   Ready     4m        v1.6.0
sz-pg-oam-docker-test-003.tendcloud.com   Ready     10s       v1.6.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å•¦ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åè®°&#34;&gt;åè®°&lt;/h3&gt;

&lt;p&gt;å¦å¤–Kuberntesè¿˜æä¾›ç¬¬ä¸‰ä¸­å®‰è£…æ–¹å¼ï¼Œè¯·çœ‹Tony Baiå†™çš„&lt;a href=&#34;http://tonybai.com/2017/01/24/explore-kubernetes-cluster-installed-by-kubeadm/&#34;&gt;ä½¿ç”¨Kubeadmæ–¹å¼å®‰è£…Kubernetesé›†ç¾¤çš„æ¢ç´¢&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ—¶éš”ä¸€å¹´é‡æ–°æ¡èµ·kubernetesï¼Œæ­£å¥½ç°åœ¨KubeConæ­£åœ¨å¾·å›½æŸæ—ä¸¾è¡Œï¼ŒIDC å‘å¸ƒçš„æŠ¥å‘Šæ˜¾ç¤ºï¼Œ2017å¹´å¤§æ•°æ®å…¨çƒå¸‚åœºè§„æ¨¡å°†è¾¾324äº¿ç¾å…ƒï¼Œå¹´å¤åˆå¢é•¿ç‡ä¸º27%ï¼Œå…¶ä¸­å¸‚åœºå¢é•¿æœ€å¿«çš„é¢†åŸŸæ˜¯æ•°æ®å­˜å‚¨é¢†åŸŸï¼ˆ53.4%ï¼‰&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Docker v.s Kubernetes part2</title>
      <link>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part2/</link>
      <pubDate>Fri, 10 Mar 2017 22:06:32 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part2/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160709044.jpg&#34; alt=&#34;æ‰¿å¾·å…´éš†æ˜Ÿç©º&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ²³åŒ—æ‰¿å¾·å…´éš†å¿é›¾çµå±±äº¬éƒŠæœ€ä½³æ˜Ÿç©ºæ‹æ‘„ç‚¹ July 9,2016)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡æ˜¯&lt;code&gt;Docker v.s Kubernetes&lt;/code&gt;ç¬¬äºŒç¯‡ï¼Œç»­æ¥ä¸Šæ–‡&lt;a href=&#34;http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/&#34;&gt;Docker v.s Kuberntes Part1&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesæ˜¯å…¸å‹çš„&lt;strong&gt;Master/Slave&lt;/strong&gt;æ¶æ„æ¨¡å¼ï¼Œæœ¬æ–‡ç®€è¦çš„ä»‹ç»kubenetesçš„æ¶æ„å’Œç»„ä»¶æ„æˆã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetesæ ¸å¿ƒæ¶æ„&#34;&gt;Kubernetesæ ¸å¿ƒæ¶æ„&lt;/h2&gt;

&lt;h3 id=&#34;masterèŠ‚ç‚¹&#34;&gt;masterèŠ‚ç‚¹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;apiserverï¼šä½œä¸ºkubernetesç³»ç»Ÿçš„å…¥å£ï¼Œå°è£…äº†æ ¸å¿ƒå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»¥RESTFulæ¥å£æ–¹å¼æä¾›ç»™å¤–éƒ¨å®¢æˆ·å’Œå†…éƒ¨ç»„ä»¶è°ƒç”¨ã€‚å®ƒç»´æŠ¤çš„RESTå¯¹è±¡å°†æŒä¹…åŒ–åˆ°etcdï¼ˆä¸€ä¸ªåˆ†å¸ƒå¼å¼ºä¸€è‡´æ€§çš„key/valueå­˜å‚¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;schedulerï¼šè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ï¼Œä¸ºæ–°å»ºçš„Podåˆ†é…æœºå™¨ã€‚è¿™éƒ¨åˆ†å·¥ä½œåˆ†å‡ºæ¥å˜æˆä¸€ä¸ªç»„ä»¶ï¼Œæ„å‘³ç€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢æˆå…¶ä»–çš„è°ƒåº¦å™¨ã€‚&lt;/li&gt;
&lt;li&gt;controller-managerï¼šè´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰æœ‰ä¸¤ç±»ï¼š

&lt;ol&gt;
&lt;li&gt;endpoint-controllerï¼šå®šæœŸå…³è”serviceå’ŒPod(å…³è”ä¿¡æ¯ç”±endpointå¯¹è±¡ç»´æŠ¤)ï¼Œä¿è¯serviceåˆ°Podçš„æ˜ å°„æ€»æ˜¯æœ€æ–°çš„ã€‚&lt;/li&gt;
&lt;li&gt;replication-controllerï¼šå®šæœŸå…³è”replicationControllerå’ŒPodï¼Œä¿è¯replicationControllerå®šä¹‰çš„å¤åˆ¶æ•°é‡ä¸å®é™…è¿è¡ŒPodçš„æ•°é‡æ€»æ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;nodeèŠ‚ç‚¹&#34;&gt;nodeèŠ‚ç‚¹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;kubeletï¼šè´Ÿè´£ç®¡æ§dockerå®¹å™¨ï¼Œå¦‚å¯åŠ¨/åœæ­¢ã€ç›‘æ§è¿è¡ŒçŠ¶æ€ç­‰ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–åˆ†é…åˆ°æœ¬æœºçš„Podï¼Œå¹¶æ ¹æ®Podä¿¡æ¯å¯åŠ¨æˆ–åœæ­¢ç›¸åº”çš„å®¹å™¨ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¼šæ¥æ”¶apiserverçš„HTTPè¯·æ±‚ï¼Œæ±‡æŠ¥Podçš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;proxyï¼šè´Ÿè´£ä¸ºPodæä¾›ä»£ç†ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–æ‰€æœ‰çš„serviceï¼Œå¹¶æ ¹æ®serviceä¿¡æ¯åˆ›å»ºä»£ç†ã€‚å½“æŸä¸ªå®¢æˆ·Podè¦è®¿é—®å…¶ä»–Podæ—¶ï¼Œè®¿é—®è¯·æ±‚ä¼šç»è¿‡æœ¬æœºproxyåšè½¬å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;http://valleylord.github.io/images/201601-kubernetes-concepts/kubernetes-masterslave.png&#34; alt=&#34;img&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;kubernetesç»„ä»¶è¯¦ç»†ä»‹ç»&#34;&gt;Kubernetesç»„ä»¶è¯¦ç»†ä»‹ç»&lt;/h2&gt;

&lt;h3 id=&#34;etcd&#34;&gt;etcd&lt;/h3&gt;

&lt;p&gt;è™½ç„¶ä¸æ˜¯Kubernetesçš„ç»„ä»¶ä½†æ˜¯æœ‰å¿…è¦æä¸€ä¸‹ï¼Œetcdæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ååŒæ•°æ®åº“ï¼ŒåŸºäºGoè¯­è¨€å¼€å‘ï¼Œ&lt;code&gt;CoreOS&lt;/code&gt;å…¬å¸å‡ºå“ï¼Œä½¿ç”¨&lt;a href=&#34;http://rootsongjc.github.io/blogs/raft/&#34;&gt;raftä¸€è‡´æ€§ç®—æ³•&lt;/a&gt;ååŒã€‚Kubernetesçš„ä¸»æ•°æ®åº“ï¼Œåœ¨å®‰è£…kubernetesä¹‹å‰å°±è¦å…ˆå®‰è£…å®ƒï¼Œå¾ˆå¤šå¼€æºä¸‹é¡¹ç›®éƒ½ç”¨åˆ°ï¼Œè€ç‰ˆæœ¬çš„&lt;code&gt;docker swarm&lt;/code&gt;ä¹Ÿç”¨åˆ°äº†å®ƒã€‚ç›®å‰ä¸»è¦ä½¿ç”¨çš„æ˜¯&lt;code&gt;2.7.x&lt;/code&gt;ç‰ˆæœ¬ï¼Œ&lt;code&gt;3.0+&lt;/code&gt;ç‰ˆæœ¬çš„APIå˜åŒ–å¤ªå¤§ã€‚&lt;/p&gt;

&lt;h3 id=&#34;apiserver&#34;&gt;APIServer&lt;/h3&gt;

&lt;p&gt;APIServerè´Ÿè´£å¯¹å¤–æä¾›kubernetes APIæœåŠ¡ï¼Œå®ƒè¿è¡Œåœ¨masterèŠ‚ç‚¹ä¸Šã€‚ä»»ä½•å¯¹èµ„æºçš„å¢åˆ æ”¹æŸ¥éƒ½è¦äº¤ç»™APIServerå¤„ç†åæ‰èƒ½æäº¤ç»™etcdã€‚APIServeræ€»ä½“ä¸Šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šHTTP/HTTPSæœåŠ¡å’Œä¸€äº›åŠŸèƒ½æ€§æ’ä»¶ã€‚è¿™äº›åŠŸèƒ½æ€§æ’ä»¶åˆåˆ†ä¸ºä¸¤ç§ï¼šä¸€éƒ¨åˆ†ä¸åº•å±‚IaaSå¹³å°ï¼ˆCloud Provideï¼‰ç›¸å…³ï¼›å¦ä¸€éƒ¨åˆ†ä¸èµ„æºç®¡ç†æ§åˆ¶ï¼ˆAdmission Controlï¼‰ç›¸å…³ã€‚&lt;/p&gt;

&lt;h3 id=&#34;scheduler&#34;&gt;Scheduler&lt;/h3&gt;

&lt;p&gt;Schedulerçš„ä½œç”¨æ˜¯&lt;strong&gt;æ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å°†podè°ƒåº¦åˆ°nodeèŠ‚ç‚¹ä¸Š&lt;/strong&gt;ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºç»‘å®šã€‚Schedulerè°ƒåº¦å™¨çš„è¾“å…¥æ˜¯å¾…è°ƒåº¦çš„podå’Œå¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ï¼Œè¾“å‡ºåˆ™æ˜¯ä¸€ä¸ªå·²ç»ç»‘å®šäº†podçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯é€šè¿‡è°ƒåº¦ç®—æ³•åœ¨å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©çš„æœ€ä¼˜èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹ä»å“ªé‡Œæ¥ï¼Ÿå·¥ä½œèŠ‚ç‚¹å¹¶ä¸æ˜¯ç”±Kubernetesåˆ›å»ºï¼Œå®ƒæ˜¯ç”±IaaSå¹³å°åˆ›å»ºï¼Œæˆ–è€…å°±æ˜¯ç”±ç”¨æˆ·ç®¡ç†çš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚ä½†æ˜¯Kubernetesä¼šåˆ›å»ºä¸€ä¸ªNodeå¯¹è±¡ï¼Œç”¨æ¥æè¿°è¿™ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚æè¿°çš„å…·ä½“ä¿¡æ¯ç”±åˆ›å»ºNodeå¯¹è±¡çš„é…ç½®æ–‡ä»¶ç»™å‡ºã€‚ä¸€æ—¦ç”¨æˆ·åˆ›å»ºèŠ‚ç‚¹çš„è¯·æ±‚è¢«æˆåŠŸå¤„ç†ï¼ŒKubernetesåˆä¼šç«‹å³åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªnodeå¯¹è±¡ï¼Œå†å»æ£€æŸ¥è¯¥èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µã€‚åªæœ‰é‚£äº›å½“å‰å¯ç”¨çš„nodeæ‰ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èŠ‚ç‚¹å¹¶å…è®¸podè°ƒåº¦åˆ°ä¸Šé¢è¿è¡Œã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹å¯ä»¥é€šè¿‡èµ„æºé…ç½®æ–‡ä»¶æˆ–è€…kubectlå‘½ä»¤è¡Œå·¥å…·æ¥åˆ›å»ºã€‚Kubernetesä¸»è¦ç»´æŠ¤å·¥ä½œèŠ‚ç‚¹çš„ä¸¤ä¸ªå±æ€§ï¼šspecå’Œstatusæ¥æè¿°ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„æœŸæœ›çŠ¶æ€å’Œå½“å‰çŠ¶æ€ã€‚å…¶ä¸­ï¼Œæ‰€è°“çš„å½“å‰çŠ¶æ€ä¿¡æ¯ç”±3ä¸ªä¿¡æ¯ç»„æˆï¼š&lt;code&gt;HostIp&lt;/code&gt;ã€&lt;code&gt;NodePhase&lt;/code&gt;å’Œ&lt;code&gt;Node Condition&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹çš„åŠ¨æ€ç»´æŠ¤è¿‡ç¨‹ä¾é &lt;strong&gt;Node Controller&lt;/strong&gt;æ¥å®Œæˆï¼Œå®ƒæ˜¯&lt;code&gt;Kubernetes Controller Manager&lt;/code&gt;ä¸‹å±çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚å®ƒä¼šä¸€ç›´ä¸æ–­çš„æ£€æŸ¥Kuberneteså·²çŸ¥çš„æ¯å°nodeèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœä¸€ä¸ªä¹‹å‰å·²ç»å¤±è´¥çš„èŠ‚ç‚¹åœ¨è¿™ä¸ªæ£€æŸ¥å¾ªç¯ä¸­è¢«æ£€æŸ¥ä¸ºå¯ä»¥å·¥ä½œçš„ï¼Œé‚£ä¹ˆNode Controllerä¼šæŠŠè¿™ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°å·¥ä½œèŠ‚ç‚¹ä¸­ï¼ŒNode Controllerä¼šä»å·¥ä½œèŠ‚ç‚¹ä¸­åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;controller-manager&#34;&gt;Controller Manager&lt;/h3&gt;

&lt;p&gt;Controller Managerè¿è¡Œåœ¨é›†ç¾¤çš„MasterèŠ‚ç‚¹ä¸Šï¼Œæ˜¯åŸºäºpod APIçš„ä¸€ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œå®ƒ&lt;strong&gt;é‡ç‚¹å®ç°service Endpointï¼ˆæœåŠ¡ç«¯ç‚¹ï¼‰çš„åŠ¨æ€æ›´æ–°&lt;/strong&gt;ã€‚ç®¡ç†ç€Kubernetesé›†ç¾¤ä¸­å„ç§æ§åˆ¶èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬&lt;strong&gt;replication Controller&lt;/strong&gt;å’Œ&lt;strong&gt;node Controller&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸APIServerç›¸æ¯”ï¼ŒAPIServerè´Ÿè´£æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶åˆ›å»ºå¯¹åº”çš„èµ„æºï¼Œè€ŒController Manageråœ¨ç³»ç»Ÿä¸­æ‰®æ¼”çš„è§’è‰²æ˜¯åœ¨ä¸€æ—æ—é»˜é»˜çš„ç®¡æ§è¿™äº›èµ„æºï¼Œç¡®ä¿ä»–ä»¬æ°¸è¿œä¿æŒåœ¨é¢„æœŸçš„çŠ¶æ€&lt;/strong&gt;ã€‚å®ƒé‡‡ç”¨å„ç§ç®¡ç†å™¨å®šæ—¶çš„å¯¹podã€èŠ‚ç‚¹ç­‰èµ„æºè¿›è¡Œé¢„è®¾çš„æ£€æŸ¥ï¼Œç„¶ååˆ¤æ–­å‡ºäºé¢„æœŸçš„æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´ï¼Œåˆ™é€šçŸ¥APIServeré‡‡å–è¡ŒåŠ¨ï¼Œæ¯”å¦‚é‡å¯ã€è¿ç§»ã€åˆ é™¤ç­‰ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kubelet&#34;&gt;kubelet&lt;/h3&gt;

&lt;p&gt;kubeletç»„ä»¶å·¥ä½œåœ¨Kubernetesçš„nodeä¸Šï¼Œ&lt;strong&gt;è´Ÿè´£ç®¡ç†å’Œç»´æŠ¤åœ¨è¿™å°ä¸»æœºä¸Šè¿è¡Œç€çš„æ‰€æœ‰å®¹å™¨&lt;/strong&gt;ã€‚ kubeletä¸cAdvisoräº¤äº’æ¥æŠ“å–dockerå®¹å™¨å’Œä¸»æœºçš„èµ„æºä¿¡æ¯ã€‚ kubeletåƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒåŒ…æ‹¬å®¹å™¨åƒåœ¾å›æ”¶å’Œé•œåƒåƒåœ¾å›æ”¶ã€‚ kubeletå·¥ä½œèŠ‚ç‚¹çŠ¶æ€åŒæ­¥ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kube-proxy&#34;&gt;kube-proxy&lt;/h3&gt;

&lt;p&gt;kube-proxyæä¾›ä¸¤ç§åŠŸèƒ½:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æä¾›ç®—æ³•å°†å®¢æœç«¯æµé‡è´Ÿè½½å‡è¡¡åˆ°serviceå¯¹åº”çš„ä¸€ç»„åç«¯podã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨etcdçš„watchæœºåˆ¶ï¼Œå®ç°æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œç»´æŠ¤ä¸€å¼ ä»serviceåˆ°endpointçš„æ˜ å°„å…³ç³»ï¼Œä»è€Œä¿è¯åç«¯podçš„IPå˜åŒ–ä¸ä¼šå¯¹è®¿é—®è€…çš„è®¿é—®é€ æˆå½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Docker v.s Kubernetes part1</title>
      <link>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/</link>
      <pubDate>Fri, 10 Mar 2017 21:09:47 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/docker-vs-kubernetes-part1/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20161016031.jpg&#34; alt=&#34;æ­å·è¥¿æ¹–&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ­å·è¥¿æ¹– Oct 16,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;è¿™ä¸€ç³»åˆ—æ–‡ç« æ˜¯å¯¹æ¯”kubernetes å’Œdockerä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼Œé‰´äºæˆ‘ä¹‹å‰ä»docker1.10.3èµ·å¼€å§‹ä½¿ç”¨dockerï¼Œå¯¹åŸç”Ÿdockerçš„äº†è§£æ¯”è¾ƒå¤šï¼Œæœ€è¿‘åˆæ­£åœ¨çœ‹&lt;strong&gt;Kunernetesæƒå¨æŒ‡å—ï¼ˆç¬¬äºŒç‰ˆï¼‰&lt;/strong&gt;è¿™æœ¬ä¹¦ï¼ˆP.Sæ„Ÿè°¢&lt;u&gt;ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/u&gt;çš„ç¼–è¾‘æœ‹å‹èµ é€æ­¤ä¹¦ï¼‰ã€‚è¿™ç³»åˆ—æ–‡ç« ä¸æ˜¯ä¸ºäº†æ¯”è¾ƒå­°ä¼˜å­°åŠ£ï¼Œ&lt;strong&gt;é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤ç³»åˆ—æ–‡ç« ä¸­æ‰€è¯´çš„&lt;strong&gt;docker&lt;/strong&gt;æŒ‡çš„æ˜¯*17.03-ce*ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ¦‚å¿µæ€§çš„å·®åˆ«&#34;&gt;æ¦‚å¿µæ€§çš„å·®åˆ«&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;äº†è§£ä¸€æ ·ä¸œè¥¿é¦–å…ˆè¦é«˜å±‹å»ºç“´çš„äº†è§£å®ƒçš„æ¦‚å¿µï¼ŒkubernetesåŒ…æ‹¬ä»¥ä¸‹å‡ ç§èµ„æºå¯¹è±¡ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/abstractions/pod/&#34;&gt;Pod&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;li&gt;Volume&lt;/li&gt;
&lt;li&gt;Namespace&lt;/li&gt;
&lt;li&gt;ReplicaSet&lt;/li&gt;
&lt;li&gt;Deployment&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/abstractions/controllers/statefulsets/&#34;&gt;StatefulSet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;DaemonSet&lt;/li&gt;
&lt;li&gt;Job&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Docker&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Dockerçš„èµ„æºå¯¹è±¡ç›¸å¯¹äºkubernetesæ¥è¯´å°±ç®€å•å¤šäº†ï¼Œåªæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;li&gt;Node&lt;/li&gt;
&lt;li&gt;Stack&lt;/li&gt;
&lt;li&gt;Docker&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°±è¿™ä¹ˆç®€å•ï¼Œä½¿ç”¨ä¸€ä¸ª*docker-compose.yml*å³å¯ä»¥å¯åŠ¨ä¸€ç³»åˆ—æœåŠ¡ã€‚å½“ç„¶ç®€å•çš„å¥½å¤„æ˜¯ä¾¿äºç†è§£å’Œç®¡ç†ï¼Œä½†æ˜¯åœ¨åŠŸèƒ½æ–¹é¢å°±æ²¡æœ‰kubernetesé‚£ä¹ˆå¼ºå¤§äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŠŸèƒ½æ€§å·®åˆ«&#34;&gt;åŠŸèƒ½æ€§å·®åˆ«&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetes èµ„æºé™åˆ¶ CPU 100måƒåˆ†ä¹‹ä¸€æ ¸ä¸ºå•ä½ï¼Œç»å¯¹å€¼ï¼Œrequests å’Œlimitsï¼Œè¶…è¿‡è¿™ä¸ªå€¼å¯èƒ½è¢«æ€æ‰ï¼Œèµ„æºé™åˆ¶åŠ›åº¦æ¯”dockeræ›´ç»†ã€‚&lt;/li&gt;
&lt;li&gt;Podä¸­æœ‰ä¸ªæœ€åº•å±‚çš„pause å®¹å™¨ï¼Œå…¶ä»–ä¸šåŠ¡å®¹å™¨å…±ç”¨ä»–çš„IPï¼Œdockerå› ä¸ºæ²¡æœ‰è¿™å±‚æ¦‚å¿µï¼Œæ‰€ä»¥æ²¡æ³•å…±ç”¨IPï¼Œè€Œæ˜¯ä½¿ç”¨overlayç½‘ç»œåŒå¤„äºä¸€ä¸ªç½‘ç»œé‡Œæ¥é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesåœ¨rcä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ä¼ é€’é…ç½®ï¼ˆ1.3ç‰ˆæœ¬æ˜¯è¿™æ ·çš„ï¼Œåç»­ç‰ˆæœ¬è¿˜æ²¡æœ‰ç ”ç©¶è¿‡ï¼‰&lt;/li&gt;
&lt;li&gt;Kuberentes Label å¯ä»¥åœ¨å¼€å§‹å’ŒåŠ¨æ€çš„æ·»åŠ ä¿®æ”¹ï¼Œæ‰€æœ‰çš„èµ„æºå¯¹è±¡éƒ½æœ‰ï¼Œè¿™ä¸€ç‚¹dockerä¹Ÿæœ‰ï¼Œä½†æ˜¯èµ„æºè°ƒåº¦å› ä¸ºæ²¡æœ‰kubernetesé‚£ä¹ˆå±‚çº§ï¼Œæ‰€æœ‰è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ã€‚&lt;/li&gt;
&lt;li&gt;Kuberneteså¯¹è±¡é€‰æ‹©æœºåˆ¶ç»§ç»­é€šè¿‡label selectorï¼Œç”¨äºå¯¹è±¡è°ƒåº¦ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„é•œåƒï¼Œå«åš&lt;code&gt;google_containers/pause&lt;/code&gt;ï¼Œè¿™ä¸ªé•œåƒæ˜¯ç”¨æ¥å®ç°Podæ¦‚å¿µçš„ã€‚&lt;/li&gt;
&lt;li&gt;HPA horizontal pod autoscaling æ¨ªå‘ç§»åŠ¨æ‰©å®¹ï¼Œä¹Ÿæ˜¯ä¸€ç§èµ„æºå¯¹è±¡ï¼Œæ ¹æ®è´Ÿè½½å˜åŒ–æƒ…å†µé’ˆå¯¹æ€§çš„è°ƒæ•´podç›®æ ‡å‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesä¸­æœ‰ä¸‰ä¸ªIPï¼ŒNode,Pod,Cluster IPçš„å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œdockerä¸­æ²¡æœ‰Cluster IPçš„æ¦‚å¿µã€‚&lt;/li&gt;
&lt;li&gt;æŒä¹…åŒ–å­˜å‚¨ï¼Œåœ¨Kubernetesä¸­æœ‰Persistent volume åªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨ï¼Œä¸å±äºä»»ä½•nodeï¼Œç‹¬ç«‹äºpodä¹‹å¤–ï¼Œè€Œdockeråªèƒ½ä½¿ç”¨&lt;code&gt;volume plugin&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·ç®¡ç†ï¼Œkubernetesä¸­æœ‰`Namespaceï¼Œdockeræš‚æ—¶æ²¡æœ‰å¤šç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»ä½“æ¥è¯´Dockeræ¶æ„æ›´åŠ ç®€å•ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„é…ç½®ï¼Œåªéœ€è¦æ¯ä¸ªç»“ç‚¹éƒ½å®‰è£…dockerå³å¯ï¼Œè°ƒåº¦å’Œç®¡ç†åŠŸèƒ½æ²¡kubernetesé‚£ä¹ˆå¤æ‚ã€‚ä½†æ˜¯kubernetesæœ¬èº«å°±æ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®ä¸­å¿ƒç®¡ç†å·¥å…·ï¼Œä¸ä»…å¯ä»¥ç”¨æ¥ç®¡ç†dockerï¼Œ*pod*è¿™ä¸ªæ¦‚å¿µé‡Œå°±å¯ä»¥è¿è¡Œä¸ä»…æ˜¯dockeräº†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä»¥åçš„æ–‡ç« ä¸­å°†ç»“åˆdockerç€é‡è®²Kubernetesï¼ŒåŸºäº1.3ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
  </channel>
</rss>