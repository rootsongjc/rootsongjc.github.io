<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song â€“ Ebpf</title>
    <link>https://jimmysong.io/tags/ebpf/</link>
    <description>Recent content in Ebpf on Jimmy Song</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <managingEditor>rootsongjc@gmail.com (Jimmy Song)</managingEditor>
    <webMaster>rootsongjc@gmail.com (Jimmy Song)</webMaster>
    <lastBuildDate>Wed, 10 Jan 2024 12:00:00 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/tags/ebpf/index.xml" rel="self" type="application/rss+xml" />
    
    
      
         
        
                                                         
                                                         
                           
    <item>
      <title>ç”¨ eBPF æ´å¯Ÿåº”ç”¨å±‚ç½‘ç»œæµé‡</title>
      <link>https://jimmysong.io/trans/application-traffic-with-ebpf/</link>
      <pubDate>Wed, 10 Jan 2024 12:00:00 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/trans/application-traffic-with-ebpf/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨&lt;a href=&#34;../ebpf-adventures-in-networking/&#34; title=&#34;å…ˆå‰çš„å¸–å­&#34;&gt;å…ˆå‰çš„å¸–å­&lt;/a&gt;ä¸­ï¼Œæˆ‘ç¨å¾®è°ˆåˆ°äº†å»ºç«‹ eBPF çŸ¥è¯†ï¼Œä»¥å¼€å§‹æ›´å¤šåœ°äº†è§£ç½‘ç»œé€‚é…å™¨çš„è¾“å…¥å’Œè¾“å‡ºæƒ…å†µã€‚åŸºæœ¬ä¸Šï¼Œå°†ä»¥å¤ªç½‘å¸§å¹¶å‰¥ç¦»æ ‡å¤´ï¼ˆä»¥å¤ªç½‘æ ‡å¤´+IP æ ‡å¤´+TCP/UDP æ ‡å¤´ï¼‰ï¼Œæœ€ç»ˆä½ å°†å¾—åˆ°æ¥è‡ªåº”ç”¨ç¨‹åºæˆ–æ•°æ®è§’åº¦çš„æ•°æ®åŒ…ä¸­å‰©ä½™çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„ä»£ç éƒ½åœ¨â€œå­¦ä¹  eBPFâ€å­˜å‚¨åº“ä¸­ï¼Œå…·ä½“çš„ eBPF ä»£ç åœ¨&lt;a href=&#34;https://github.com/thebsdbox/learning-ebpf/blob/main/ebpf/http/http.c&#34; title=&#34;è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚è¿™ç¯‡æ–‡ç« çš„è®¡åˆ’æ˜¯é€æ­¥ä»‹ç»æˆ‘è®¤ä¸ºæœ‰ç”¨æˆ–å¯èƒ½é‡è¦çš„éƒ¨åˆ†&amp;hellip;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­¤ä»£ç ç¡®å®å¯¹å…¥å£/å‡ºå£æ•°æ®åŒ…è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦ 6.1+ çš„ Linux å†…æ ¸æ‰èƒ½ä½¿ç”¨ä¸€äº› eBPF åŠ©æ‰‹å‡½æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ˜ å°„&#34;&gt;æ˜ å°„ï¼&lt;/h2&gt;
&lt;p&gt;ä½ å¯èƒ½ä»¥å‰é‡åˆ°è¿‡è¿™äº›å§ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œä¸ç”¨æ‹…å¿ƒï¼ç®€è€Œè¨€ä¹‹ï¼ŒeBPF æ˜ å°„æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ä¸­çš„ eBPF ç¨‹åºä¹‹é—´é€šä¿¡çš„æœºåˆ¶ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œéå¸¸é…·çš„ä¸€ç‚¹æ˜¯è¿™äº›æ˜ å°„ä½¿ç”¨é”®å’Œå€¼&amp;hellip;æ‰€ä»¥æˆ‘ä¸å¿…å¾ªç¯æ¯”è¾ƒæ•°æ®å¹¶å¯»æ‰¾åŒ¹é…çš„å†…å®¹ï¼Œæˆ‘ä¼ é€’ä¸€ä¸ªé”®ï¼Œå¦‚æœæœ‰åŒ¹é…çš„å†…å®¹ï¼Œæˆ‘å°±å¾—åˆ°ç›¸åº”çš„æ•°æ®:D&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘å°†è¦ä½¿ç”¨çš„æ˜ å°„ï¼Œç§°ä¸º&lt;code&gt;url_map&lt;/code&gt;ï¼Œé”®æ˜¯ 20 ä¸ªå­—ç¬¦é•¿ï¼ˆå¯ä»¥è¯´æ˜¯æœ‰ç•Œçš„â€œå­—ç¬¦ä¸²â€ï¼‰ï¼Œåˆ†é…ç»™è¯¥é”®çš„å€¼æ˜¯æˆ‘åœ¨ä¸Šé¢å®šä¹‰çš„ç»“æ„ä½“ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// å®šä¹‰ä¸é”®å…³è”çš„ä¸åŒURL
struct url_path {
  __u8 path_len;
  __u8 path[max_path_len]; // è¿™åº”è¯¥æ˜¯ä¸€ä¸ªcharï¼Œä½†åœ¨è¿™é‡Œå’ŒGoä¹‹é—´çš„ä»£ç ç”Ÿæˆæœ‰ç‚¹ä¸åŒ...
};

// å®šä¹‰æˆ‘çš„URLæ˜ å°„
struct {
  __uint(type, BPF_MAP_TYPE_HASH);
  __uint(max_entries, 1024);
  __type(key, char[max_path_len]);
  __type(value, struct url_path);
}
url_map SEC(&amp;#34;.maps&amp;#34;);
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ebpf-ç¨‹åº&#34;&gt;eBPF ç¨‹åºï¼&lt;/h2&gt;
&lt;p&gt;ä»£ç ä¸­å®šä¹‰äº†ä¸¤ä¸ª eBPF ç¨‹åº&lt;code&gt;tc_egress&lt;/code&gt;å’Œ&lt;code&gt;tc_ingress&lt;/code&gt;ï¼Œå¦‚æœä½ èƒ½çŒœåˆ°å®ƒä»¬æ˜¯å¦‚ä½•è¿æ¥çš„ï¼Œé‚£å°±åŠ åˆ†ï¼åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨&lt;code&gt;tc_ingress&lt;/code&gt;ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å°±åƒæˆ‘ä»¬åœ¨å·²ç»å­˜åœ¨çš„ä¼—å¤šç¤ºä¾‹ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ ‡å¤´è¯†åˆ«çš„æ“ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¿›è¡Œåˆç†æ€§æ£€æŸ¥ï¼Œå¹¶å°†&lt;code&gt;data&lt;/code&gt;å¼ºåˆ¶è½¬æ¢ä¸º&lt;code&gt;ethhdr&lt;/code&gt;ç±»å‹ï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Ethernet_frame&#34; title=&#34;ä»¥å¤ªç½‘æ ‡å¤´&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥å¤ªç½‘æ ‡å¤´&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¯»å–ä»¥å¤ªç½‘æ ‡å¤´å†…éƒ¨çš„&lt;code&gt;h_proto&lt;/code&gt;ï¼ˆä¹Ÿç§°ä¸º&lt;code&gt;Ethertype&lt;/code&gt;ï¼‰æ¥æŸ¥æ‰¾ä»¥å¤ªç½‘å¸§å†…éƒ¨çš„åè®®ã€‚&lt;/li&gt;
&lt;li&gt;å°†ä»¥å¤ªç½‘æ ‡å¤´åçš„æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º&lt;code&gt;iphdr&lt;/code&gt;ç±»å‹ï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Internet_Protocol_version_4#Header&#34; title=&#34;IP æ ‡å¤´&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IP æ ‡å¤´&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ IP æ ‡å¤´å†…æŸ¥æ‰¾åè®®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®å®š IP æ ‡å¤´çš„å¤§å°ï¼ˆåŸæ¥å®ƒä»¬å¯ä»¥æœ‰ä¸åŒçš„å¤§å°ï¼&lt;code&gt;Â¯\_(ãƒ„)_/Â¯&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼Œæˆ‘ä»¬å°†å…¶å€¼ä¹˜ä»¥å››ï¼Œä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆï¼å¥½å§ï¼Œè¿™ä¸ªå€¼ä¹˜ä»¥ 32 ä½ä»¥ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼Œæ‰€ä»¥å¦‚æœå€¼ä¸º 6ï¼Œé‚£ä¹ˆæ ‡å¤´å°†æ˜¯ 192 ä½ï¼ˆæˆ– 24 å­—èŠ‚ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ç®€å•åœ°ç¡®å®š IP æ ‡å¤´çš„å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå€¼ä¹˜ä»¥ 4ï¼&lt;/li&gt;
&lt;li&gt;å°†ä»¥ IP æ ‡å¤´åçš„æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º&lt;code&gt;tcphdr&lt;/code&gt;ç±»å‹ï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Transmission_Control_Protocol#TCP_segment_structure&#34; title=&#34;TCP æ ‡å¤´&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP æ ‡å¤´&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åƒæ­¥éª¤ï¼ˆ5ï¼‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®š TCP æ ‡å¤´çš„å¤§å°ï¼ˆå®ƒä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€çš„ï¼‰ï¼Œåœ¨è¿™é‡Œçš„æ­¥éª¤ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å€¼&lt;code&gt;doff&lt;/code&gt;ä¹˜ä»¥å››æ¥ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è®¡ç®—æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¨æ–­å‡ºæ•°æ®ä½äºä»¥å¤ªç½‘æ ‡å¤´å¤§å°ã€IP æ ‡å¤´å¤§å°å’Œ TCP æ ‡å¤´å¤§å°çš„æœ«å°¾ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä» IP æ ‡å¤´ä¸­å‡å» IP å’Œ TCP æ ‡å¤´çš„å¤§å°æ¥ç¡®å®šåº”ç”¨ç¨‹åºæ•°æ®çš„å¤§å°ï¼Œä½¿ç”¨&lt;code&gt;tot_len&lt;/code&gt;ï¼ˆæ€»é•¿åº¦ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åº”ç”¨æ•°æ®&#34;&gt;åº”ç”¨æ•°æ®ï¼ï¼&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¯»å–è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸Šé¢æåˆ°çš„ä¸€äº›ä¸œè¥¿ï¼&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ•°æ®åç§»é‡ï¼ˆæ•°æ®èµ·å§‹ä½ç½®ï¼‰ï¼Œå®ƒä½äºä»¥å¤ªç½‘æ ‡å¤´+IP æ ‡å¤´å¤§å°ï¼ˆä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼‰å’Œ TCP æ ‡å¤´ï¼ˆå†æ¬¡ï¼Œä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼‰ä¹‹åã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç¼“å†²åŒºæ¥å­˜å‚¨æˆ‘ä»¬å°†ä»å¥—æ¥å­—ç¼“å†²åŒºä¸­è¯»å–çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ç”¨äºå­˜å‚¨æˆ‘ä»¬åº”ç”¨ç¨‹åºæ•°æ®çš„æ•°æ®ç¼“å†²åŒº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—æ•°æ®å®é™…ä½ç½®çš„åç§»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;poffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ETH_HLEN&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip_hlen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tcp_hlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä»å¥—æ¥å­—ç¼“å†²åŒºåŠ è½½æ•°æ®ï¼Œpoffset ä» TCP æ ‡å¤´çš„æœ«å°¾å¼€å§‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bpf_skb_load_bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;poffset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;bpf_skb_load_bytes&lt;/code&gt;ä»å¥—æ¥å­—ç¼“å†²åŒºï¼ˆ&lt;code&gt;skb&lt;/code&gt;ï¼‰ä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ï¼ˆ60 ä¸ªå­—èŠ‚ï¼‰åˆ°æˆ‘ä»¬çš„ç¼“å†²åŒºï¼ˆ&lt;code&gt;pdata&lt;/code&gt;ï¼‰ï¼Œèµ·å§‹ä½ç½®æ˜¯æˆ‘ä»¬çŸ¥é“æ•°æ®ä½äºçš„åç§»é‡ï¼ˆ&lt;code&gt;poffset&lt;/code&gt;ï¼‰ï¼&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰äº† 60 å­—èŠ‚çš„æ•°æ®ï¼Œåº”è¯¥è¶³å¤Ÿè®©æˆ‘ä»¬ç¼–å†™ä¸€äº›ä»£ç æ¥ç†è§£å®ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;http-æ•°æ®--&#34;&gt;HTTP æ•°æ® :-)&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬å°è¯•è¿›è¡Œ HTTP è¯·æ±‚æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ~ curl code/test -vvv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*   Trying 192.168.0.22:80...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Connected to code (192.168.0.22) port 80 (#0)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; GET /test HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Host: code
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; User-Agent: curl/7.87.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Accept: */*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘æ­£åœ¨ä½¿ç”¨&lt;code&gt;curl&lt;/code&gt;ä»ä¸»æœº&lt;code&gt;code&lt;/code&gt;ï¼ˆcode æ˜¯æˆ‘çš„å¼€å‘ VMï¼Œè¿è¡Œ code-serverï¼‰è¯·æ±‚ URL &lt;code&gt;/test&lt;/code&gt;ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼ˆæ¯è¡Œä»¥&lt;code&gt;&amp;gt;&lt;/code&gt;å¼€å¤´ï¼Œç”¨äºç¡®å®šé€šä¿¡çš„æ–¹å‘ï¼‰ã€‚HTTP è¯·æ±‚ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®é€šå¸¸æ˜¯ä¸€ä¸ª&lt;em&gt;åŠ¨è¯&lt;/em&gt;ï¼Œåé¢æ˜¯æˆ‘ä»¬å¸Œæœ›ä¸ä¹‹äº¤äº’çš„èµ„æºï¼Œç„¶åæ˜¯ HTTP è§„èŒƒå’Œå›è½¦ç¬¦ï¼Œå¦‚&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP#HTTP/1.1_request_messages&#34; title=&#34;HTTP æ ‡å‡†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP æ ‡å‡†&lt;/a&gt;ä¸­å®šä¹‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…³å¿ƒçš„è¡Œæ˜¯&lt;code&gt;GET /test&lt;/code&gt;ï¼ˆåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬/æˆ‘ä¸å¤ªå…³å¿ƒ HTTP è§„èŒƒ:Dï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥æ˜¯è¯»å–&lt;code&gt;pdata&lt;/code&gt;çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ŒæŸ¥æ‰¾&lt;code&gt;pdata[0] == G&lt;/code&gt;ï¼Œ&lt;code&gt;pdata[1] == E&lt;/code&gt;å’Œ&lt;code&gt;pdata[2] == T&lt;/code&gt;ï¼Œè¿™å°†æœ‰æ•ˆåœ°å¸®åŠ©æˆ‘ä»¬ç¡®å®šé¦–å…ˆæ˜¯å¦æ˜¯ HTTP è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯æ˜¯å¦æ˜¯ HTTP è¯·æ±‚ï¼&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬éªŒè¯äº†è¿™å‰ 3 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°†æƒ³è¦ä»ç¬¬ 4 ä¸ªå­—èŠ‚ï¼ˆè¯·æ±‚çš„å‰ä¸‰ä¸ªå­—èŠ‚åŠ ä¸Šä¸€ä¸ªç”¨äºåˆ†éš”çš„ç©ºæ ¼ï¼‰å¼€å§‹è¯»å–æ›´å¤šæ•°æ®ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_path_len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;memset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path_len&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æŸ¥æ‰¾è¯·æ±‚ URIï¼ˆä»åç§»é‡ 4 å¼€å§‹ï¼‰ï¼Œä»¥ç©ºæ ¼ç»“æŸ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;\0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;path_len&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„å‡½æ•°å°†ä» HTTP æ•°æ®çš„ç¬¬ 4 ä¸ªå­—èŠ‚å¼€å§‹ï¼ˆä»ç¬¬ 4 ä¸ªå­—èŠ‚å¼€å§‹ï¼‰è¯»å–å…¶ä½™çš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ç©ºæ ¼ä¸ºæ­¢ï¼Œç•™ä¸‹æˆ‘ä»¬è¦&lt;code&gt;GET&lt;/code&gt;çš„ URLï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªè°ƒè¯•æ‰“å°è¯­å¥æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bpf_printk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;lt;- incoming path [%s], length [%d]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path_len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;idle&amp;gt;-0       [001] dNs3. 2252901.017812: bpf_trace_printk: &amp;lt;- incoming path [/test], length [5]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¯¹-http-åº”ç”¨ç¨‹åºè¯·æ±‚é‡‡å–è¡ŒåŠ¨&#34;&gt;å¯¹ HTTP åº”ç”¨ç¨‹åºè¯·æ±‚é‡‡å–è¡ŒåŠ¨&lt;/h3&gt;
&lt;p&gt;ä¸Šè¿°è§£é‡Šè¯¦ç»†è¯´æ˜äº†æˆ‘ä»¬å¦‚ä½•è¯»å–æ•°æ®ä»¥åŠå¦‚ä½•è¯»å–æ•°æ®ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦â€œåŠ¨æ€â€æŸ¥æ‰¾ HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨ eBPF æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ Go ç”¨æˆ·ç©ºé—´ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;The URL Path to watch for&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Parse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ª uint8 æ•°ç»„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å°†æˆ‘ä»¬çš„å­—èŠ‚å¤åˆ¶åˆ° uint8 æ•°ç»„ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å°†æˆ‘ä»¬çš„ urlPath ä½œä¸ºé”®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;objs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UrlMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;bpfUrlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;PathLen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­çœ‹åˆ°çš„ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ Go ç¨‹åºæ—¶ï¼Œå®ƒå°†ä»æ ‡å¿—&lt;code&gt;-path&lt;/code&gt;ä¸­è¯»å–ï¼Œå¹¶å°†å…¶ç”¨ä½œæˆ‘ä»¬ eBPF æ˜ å°„ä¸­çš„&lt;strong&gt;é”®&lt;/strong&gt;ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;found_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bpf_map_lookup_elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url_map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;found_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;bpf_printk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Looks like we&amp;#39;ve found your path [%s]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¯èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼Œé˜»æ­¢æµé‡æˆ–é‡å®šå‘ï¼Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æˆ‘ä»¬çš„ eBPF ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ HTTP è¯·æ±‚è¿›è¡Œæ˜ å°„æŸ¥æ‰¾ï¼Œå¦‚æœè¯¥è¯·æ±‚ä½œä¸º char æ•°ç»„å­˜åœ¨äº&lt;strong&gt;é”®&lt;/strong&gt;ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œï¼&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯åŠ¨æˆ‘ä»¬çš„ Go ç¨‹åº &lt;code&gt;sudo ./http -interface ens160 -path /test&lt;/code&gt; å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0000] Starting ğŸ the eBPF HTTP watcher, on interface [ens160] for path [/test]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0000] Loaded TC QDisc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0000] Press Ctrl-C to exit and remove the program
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] d.s3. 2252901.015575: bpf_trace_printk: &amp;lt;- 0.0.0.0:56345 -&amp;gt; 0.0.0.0:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] D.s3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;. 2252901.015642: bpf_trace_printk: -&amp;gt; 192.168.0.22:80 -&amp;gt; 192.168.0.180:56345
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] d.s3. 2252901.017552: bpf_trace_printk: &amp;lt;- 0.0.0.0:56345 -&amp;gt; 0.0.0.0:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] d.s3. 2252901.017793: bpf_trace_printk: &amp;lt;- 0.0.0.0:56345 -&amp;gt; 0.0.0.0:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] dNs3. 2252901.017812: bpf_trace_printk: &amp;lt;- incoming path [/test], length [5]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] dNs3. 2252901.017814: bpf_trace_printk: Looks like we&amp;#39;ve found your path [/test]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;è§£æ HTTP å¹¶ä¸å¤ªå›°éš¾ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„åè®®ï¼Œå®ƒä½¿ç”¨ç®€å•çš„åŠ¨è¯å’Œç»“æ„çš„ç®€å•æ–¹æ³•ï¼Œä½¿ç”¨ç©ºæ ¼å’Œå›è½¦ç¬¦æ¥åŒºåˆ†ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¹Ÿé€‚ç”¨äºå…¶ä»–åè®®ï¼Œå¦‚ DNSã€POP3 æˆ– SMTPã€‚å½“æ•°æ®åŠ å¯†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§è§£å¯†çš„æ–¹æ³•ï¼Œç„¶åæ‰èƒ½è§£ææ•°æ®ï¼ˆè¿™è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›&amp;hellip;ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›è¿™ä¼šæ¿€å‘ä½ æ›´å¤šåœ°å°è¯•ä½¿ç”¨ eBPF æ¥è§£æå’Œæ“ä½œåº”ç”¨ç¨‹åºçš„æƒ³æ³•ï¼&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸€ç›´æƒ³å†™ä¸€äº›æœ‰å¸Œæœ›æœ‰ç”¨çš„å…³äº eBPF çš„å¸–å­ï¼Œå°½ç®¡é€šå¸¸åœ¨æˆ‘æƒ³å‡ºå¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿ä¹‹åï¼Œåˆ«äººå·²ç»æŠ¢å…ˆä¸€æ­¥ã€‚é‰´äºæˆ‘å·²ç»åœ¨ä¸€æ®µæ—¶é—´é‡Œä»¥æŸç§æ–¹å¼å…³æ³¨ç½‘ç»œï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘å…³æ³¨çš„é¢†åŸŸï¼Œå°½ç®¡æˆ‘ç¡®å®ä¸ºæœ€è¿‘çš„ eBPF å³°ä¼š 2023 ç¼–å†™äº†ä¸€äº›æœ‰è¶£çš„å†…å®¹ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæœ‰å¾ˆå¤šäººå¼€å§‹æ’°å†™ eBPF å†…å®¹ï¼Œæ‰€ä»¥æˆ‘å¯èƒ½ä¼šå‚è€ƒä»–ä»¬çš„å¸–å­ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹ã€‚&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>å¦‚ä½•ç”¨ eBPF æ”¹å˜ç½‘ç»œç¼–ç¨‹çš„æ¸¸æˆè§„åˆ™</title>
      <link>https://jimmysong.io/trans/ebpf-adventures-in-networking/</link>
      <pubDate>Wed, 10 Jan 2024 08:00:00 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/trans/ebpf-adventures-in-networking/</guid>
      <description>
        
        
        &lt;p&gt;æˆ‘ä¸€ç›´æƒ³å†™ä¸€äº›å…³äº eBPF çš„å¸–å­ï¼Œå¸Œæœ›å®ƒä»¬èƒ½æœ‰æ‰€å¸®åŠ©ï¼Œå°½ç®¡é€šå¸¸åœ¨æˆ‘æƒ³åˆ°å¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿æ—¶ï¼Œå…¶ä»–äººå·²ç»å…ˆæˆ‘ä¸€æ­¥äº†ã€‚é‰´äºæˆ‘å·²ç»åœ¨ç½‘ç»œæ–¹é¢é›†ä¸­ç²¾åŠ›ä¸€æ®µæ—¶é—´ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä¸“æ³¨çš„é¢†åŸŸï¼Œå°½ç®¡æˆ‘ç¡®å®è®¾æ³•ä¸ºæœ€è¿‘çš„ eBPF å³°ä¼š 2023 å‡†å¤‡äº†ä¸€äº›æˆ‘è®¤ä¸ºå¾ˆæœ‰è¶£çš„ä¸œè¥¿ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæœ‰å¾ˆå¤šäººå¼€å§‹æ’°å†™å…³äº eBPF çš„å†…å®¹ï¼Œå› æ­¤æˆ‘å¯èƒ½ä¼šå‚è€ƒä»–ä»¬çš„å¸–å­ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†ä»ä¸€äº›åœ¨ Linux å†…æ ¸ä¸­å¯èƒ½æˆ–å¯èƒ½ä¸ä¼šé‡åˆ°çš„é¦–å­—æ¯ç¼©å†™æˆ–æŠ€æœ¯å¼€å§‹ã€‚ä½†åŸºæœ¬ä¸Šä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›æ˜¯ä½ ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿä»¥ä¸ç½‘ç»œæ•°æ®äº¤äº’çš„ä¸»è¦é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;xdp&#34;&gt;XDP&lt;/h3&gt;
&lt;p&gt;å…³äº eXpress Data Plane å·²ç»å­˜åœ¨å¤§é‡ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä¸ä¼šæ·±å…¥æ¢è®¨å¤ªå¤šç»†èŠ‚ã€‚&lt;code&gt;tl;dr&lt;/code&gt;æ˜¯ XDP eBPF ç¨‹åºæŒ‚é’©åˆ° XDP å°†ä½¿å…¶èƒ½å¤Ÿè®¿é—®ç”±å†…æ ¸è‡ªèº«å¤„ç†ä¹‹å‰çš„ä¼ å…¥ç½‘ç»œå¸§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒeBPF ç¨‹åºå°†åŠ è½½åˆ° NIC é©±åŠ¨ç¨‹åºæœ¬èº«ä¸­ï¼Œè¿™å°†æœ‰æ•ˆåœ°å°†ç¨‹åºå¸è½½åˆ° NIC æœ¬èº«ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼˜ç‚¹&#34;&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ€ä½³æ€§èƒ½&lt;/li&gt;
&lt;li&gt;éå¸¸é€‚ç”¨äºé˜²ç«å¢™ã€DDoS é˜²æŠ¤æˆ–è´Ÿè½½å‡è¡¡ç­‰ç”¨ä¾‹&lt;/li&gt;
&lt;li&gt;åœ¨ä»»ä½•å…¶ä»–å†…å®¹è¿›è¡Œä¿®æ”¹ä¹‹å‰çœ‹åˆ°ä¼ å…¥çš„æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»…æ”¯æŒå…¥ç«™æµé‡ï¼Œä½¿ç”¨ XDP ç¨‹åºçœ‹åˆ°çš„ä»»ä½•æµé‡éƒ½åªæ˜¯ä¼ å…¥æµé‡ï¼Œç›®å‰æ— æ³•çœ‹åˆ°å‡ºç«™æµé‡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;XDP&lt;/code&gt;æ•°æ®ç»“æ„ï¼Œä¸å¤§å¤šæ•°å¥—æ¥å­—ç¼–ç¨‹çš„é»˜è®¤æ•°æ®ç»“æ„&lt;code&gt;SKB&lt;/code&gt;æœ‰ä¸€äº›ä¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tctraffic-controlæˆ–æµé‡æ§åˆ¶&#34;&gt;TCï¼ˆTraffic Controlï¼‰æˆ–æµé‡æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;Traffic Control æ˜¯å†…æ ¸ç½‘ç»œç»“æ„çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬æ·»åŠ è¯¸å¦‚ qdisc å’Œè¿‡æ»¤å™¨ä¹‹ç±»çš„åŠŸèƒ½åˆ°æ¥å£çš„èƒ½åŠ›ã€‚qdisc ä¸»è¦é›†ä¸­åœ¨ä¸º TBDï¼ˆå¾…å®šï¼‰æä¾›æœåŠ¡ï¼Œè€Œè¿‡æ»¤å™¨é€šå¸¸åœ¨åº•å±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ª eBPF ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„å·¥ä½œæµç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªå…³æ³¨å…¥å£æˆ–å‡ºå£çš„ qdiscï¼Œæˆ–è€…æ›¿æ¢ä¸€ä¸ªç°æœ‰çš„ qdiscã€‚qdisc å°†é™„åŠ åˆ°æ¥å£ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;åŠ è½½ä½ çš„ eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå°†å…¶é™„åŠ åˆ°é€šè¿‡æ¥å£ä¸Šçš„ qdisc ä¸Šçš„å…¥å£æˆ–å‡ºå£ä¹‹ä¸€ã€‚è¯¥è¿‡æ»¤å™¨å°†ä¸ eBPF ç¨‹åºç›¸å…³è”ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ä¼ å…¥æˆ–ä¼ å‡ºçš„æµé‡ç°åœ¨éƒ½ä¼šé€šè¿‡ä¸€ä¸ªç¨‹åºè¿è¡Œï¼ˆå¦‚æœè¿æ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è·åˆ© ğŸ’°&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä¼˜ç‚¹-1&#34;&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æä¾›å…¥å£å’Œå‡ºå£çš„æŒ‚é’©ç‚¹&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä¼ ç»Ÿçš„&lt;code&gt;SKB&lt;/code&gt;æ•°æ®ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¼ºç‚¹-1&#34;&gt;ç¼ºç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å°† TC ç¨‹åºé™„åŠ åˆ°å…¥å£æˆ–å‡ºå£é˜Ÿåˆ—ç¨å¾®å¤æ‚ä¸€äº›ã€‚ç”¨æˆ·éœ€è¦ä½¿ç”¨ qdisc æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒæŸäº› eBPF SDK ä¸ä¼šåŸç”Ÿæ”¯æŒ TC ç¨‹åºçš„ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;TC eBPF ç¨‹åºçœ‹åˆ°çš„æµé‡å¯èƒ½å·²ç»è¢«ä¹‹å‰çš„ XDP ç¨‹åºæˆ–å†…æ ¸æœ¬èº«ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç³»ç»Ÿè°ƒç”¨&#34;&gt;ç³»ç»Ÿè°ƒç”¨&lt;/h3&gt;
&lt;p&gt;ä¸å…¶ä»–ä¸¤ç§ä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†ç½‘ç»œçš„æ–¹æ³•ç›¸æ¯”ï¼Œè¿™å¯èƒ½ä¼šæ˜¾å¾—æœ‰äº›å¥‡æ€ªï¼Œå› ä¸ºå®ƒæ˜¯å°†ä¸€äº› eBPF ä»£ç é™„åŠ åˆ°å†…æ ¸ä¸­çš„ç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œå…·ä½“æ¥è¯´æ˜¯&lt;code&gt;tcp4_connect()&lt;/code&gt; / &lt;code&gt;tcp6_connect()&lt;/code&gt;ç­‰è°ƒç”¨ã€‚è¿™åœ¨åè®®æ ˆä¸­ç•¥å¾®é åï¼Œå› ä¸ºåœ¨æ­¤æ—¶ï¼Œä¼ å…¥æ•°æ®åŒ…å·²ç»ç»è¿‡äº†å¾ˆå¤šå†…æ ¸é€»è¾‘ï¼Œè€Œ eBPF å†…çœç‚¹æ˜¯å½“æµé‡å³å°†ä¸åº”ç”¨ç¨‹åºæœ¬èº«äº¤äº’æ—¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–å†™ç½‘ç»œç¨‹åº&#34;&gt;ç¼–å†™ç½‘ç»œç¨‹åºï¼&lt;/h2&gt;
&lt;p&gt;æ‰€ä»¥åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬ï¼ˆå¸Œæœ›ï¼‰æ„è¯†åˆ°æˆ‘ä»¬æœ‰è®¸å¤šä¸åŒçš„å…¥å£ç‚¹ï¼Œå…è®¸æˆ‘ä»¬åœ¨â€œä¼ é€å¸¦â€ä¸Šæ³¨å…¥æˆ‘ä»¬çš„ä»£ç ï¼Œè¿™ä¸ªä¼ é€å¸¦ä» NIC å¼€å§‹ï¼Œä¸€ç›´åˆ°åº”ç”¨ç¨‹åºï¼ˆä»¥åŠåœ¨å‡ºç«™çš„æƒ…å†µä¸‹ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å›é¡¾&#34;&gt;å›é¡¾&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æ‰€è°“çš„â€œä¼ é€å¸¦â€çš„å¼€å¤´ï¼Œæˆ‘ä»¬å¯ä»¥é™„åŠ æˆ‘ä»¬çš„ XDP ç¨‹åºå¹¶è·å¾—æœªç»è§¦ç¢°çš„åŸå§‹ç½‘ç»œæ•°æ®ã€‚åœ¨â€œä¼ é€å¸¦â€çš„ä¸­é—´ï¼Œæˆ‘ä»¬çš„ TC ç¨‹åºå°†æˆä¸ºé€šè¿‡å†…æ ¸çš„è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶æ¥æ”¶å¯èƒ½è¢«ä¿®æ”¹çš„ç½‘ç»œæ•°æ®ã€‚åœ¨ä¼ é€å¸¦çš„æœ«ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç é™„åŠ åˆ°åº”ç”¨ç¨‹åºå°†åœ¨å®ƒè¢«è¿è¡Œä¹‹å‰è·å–ç½‘ç»œæ•°æ®çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥åœ¨ä¼ é€å¸¦çš„æœ«ç«¯è¿›è¡Œé™„åŠ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®è¡¨ç¤º&#34;&gt;æ•°æ®è¡¨ç¤º&lt;/h3&gt;
&lt;p&gt;ä½ çš„ç¨‹åºé™„åŠ åˆ°çš„ä½ç½®å†³å®šäº†ä¸¤ä¸ªä¸»è¦äº‹ç‰©ï¼Œä¸€ä¸ªæ˜¯æ½œåœ¨çš„æµé‡ä¿®æ”¹çš„ç›¸å¯¹çº§åˆ«ï¼Œå¦ä¸€ä¸ªæ˜¯æµé‡çš„è¡¨ç¤ºæ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;xdp-ç»“æ„&#34;&gt;XDP ç»“æ„&lt;/h3&gt;
&lt;p&gt;æˆ‘ä¼šå†™å…³äºå®ƒçš„å†…å®¹ï¼Œä½†æ˜¯ DataDog å·²ç»åšäº†ï¼Œä½ å¯ä»¥åœ¨&lt;a href=&#34;https://www.datadoghq.com/blog/xdp-intro/#the-flow-of-an-xdp-program&#34; title=&#34;è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;é˜…è¯»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;skbå¥—æ¥å­—ç¼“å†²åŒº&#34;&gt;SKBï¼ˆå¥—æ¥å­—ç¼“å†²åŒºï¼‰&lt;/h3&gt;
&lt;p&gt;SKB æ˜¯åœ¨ eBPF æ·»åŠ åˆ°å†…æ ¸ä¹‹å‰å°±å­˜åœ¨äºå†…æ ¸ä¸­çš„æ•°æ®ç±»å‹ï¼Œå®ƒå·²ç»å…·å¤‡äº†ä¸€äº›ä½¿ä¸ SKB å¯¹è±¡äº¤äº’å˜å¾—ç¨å¾®å®¹æ˜“ä¸€äº›çš„è¾…åŠ©åŠŸèƒ½ã€‚æœ‰å…³æ›´æ·±å…¥çš„ SKB ä»‹ç»ï¼Œä½ å¯ä»¥é˜…è¯»æ­¤æ–‡ -&amp;gt; &lt;a href=&#34;http://vger.kernel.org/~davem/skb_data.html&#34; title=&#34;http://vger.kernel.org/~davem/skb_data.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://vger.kernel.org/~davem/skb_data.html&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;è§£ææ•°æ®&#34;&gt;è§£ææ•°æ®&lt;/h3&gt;
&lt;p&gt;æ— è®ºä¸å“ªä¸ªç»“æ„è¿›è¡Œäº¤äº’ï¼Œå®ƒä»¬éƒ½å…±äº«ä¸€äº›å…±åŒä¹‹å¤„ï¼Œè¿™ä¸»è¦æ˜¯ä¸¤ä¸ªå˜é‡ï¼Œå¯¹äºè¿™ä¸¤ç§æ•°æ®ç±»å‹æ¥è¯´æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å˜é‡æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;data&lt;/code&gt;ï¼Œå®ƒæ˜¯ eBPF ç¨‹åºæ¥æ”¶åˆ°çš„æ•°æ®çš„æŒ‡é’ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;data_len&lt;/code&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šäº†æœ‰å¤šå°‘æ•°æ®å¯ç”¨ï¼ˆä»¥å¸®åŠ©ç¡®ä¿ä½ æ°¸è¿œä¸ä¼šè®¿é—®&lt;code&gt;data&lt;/code&gt;è¶…è¿‡&lt;code&gt;data_len&lt;/code&gt;ï¼ˆæ˜¾è€Œæ˜“è§çš„çœŸç† ğŸ¤“ï¼‰ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥è¿™ä¸€åˆ‡ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†ç­‰ç­‰&amp;hellip; &lt;code&gt;*data&lt;/code&gt;ä¸­å®é™…ä¸Šæœ‰ä»€ä¹ˆï¼Ÿï¼ˆè¿™å–å†³äºä½ çš„å‘ç°ï¼‰&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸æ–­â€œè½¬æ¢â€&lt;code&gt;*data&lt;/code&gt;å¹¶æ²¿ç€å®ƒç§»åŠ¨ä»¥å‰¥ç¦»å„ç§æ ‡å¤´ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£å’ŒæŸ¥æ‰¾åº•å±‚æ•°æ®ï¼&lt;/p&gt;
&lt;h3 id=&#34;è½¬æ¢&#34;&gt;è½¬æ¢ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥è·³è¿‡æ­¤éƒ¨åˆ†ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿï¼ˆä¸”ç³Ÿç³•ï¼‰çš„ç¤ºä¾‹ï¼Œè¯´æ˜äº†æˆ‘ä»¬é€šå¸¸å¦‚ä½•å°†ä¸€äº›åŸå§‹æ•°æ®è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ä¸œè¥¿ã€‚ç›®å‰ï¼Œ&lt;code&gt;*data&lt;/code&gt;å°†åªæ˜¯ä¸€ä¸²éšæœºæ•°æ®ï¼Œæ¯«æ— æ„ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦æœ‰æ•ˆåœ°ä¸ºå…¶æ·»åŠ â€œæ ¼å¼â€ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç†è§£å…¶å¤–è§‚ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸‹éšæœºæ•°æ®è¡Œï¼šâ€œBobby0004500100.503 Harvard Drive90210â€ï¼Œå…¶ä¸­ä¸€äº›å¯¹è£¸çœ¼æ¥è¯´æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æœ‰äº›æ˜¯ä¸æ¸…æ¥šçš„ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è±¡ä¸€ä¸‹åä¸ºâ€œpersonâ€çš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Age: number
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Balance: float
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Street: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ZipCode: number
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬è¦å°†æˆ‘ä»¬çš„éšæœºæ•°æ®â€œè½¬æ¢â€ä¸ºä¸Šé¢çš„â€œpersonâ€ç»“æ„ï¼Œå®ƒå°†çªç„¶å˜æˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name: Bobby
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Age: &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Balance: 100.50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Street: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; Harvard Drive
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ZipCode: &lt;span class=&#34;m&#34;&gt;90210&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨çªç„¶é—´ï¼Œæˆ‘èƒ½å¤Ÿç†è§£å¹¶è®¿é—®ç»“æ„ä¸­çš„åº•å±‚å˜é‡ï¼Œå› ä¸ºå®ƒä»¬ç°åœ¨æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå³ person-&amp;gt;Nameï¼Œå¹¶ä¸”å‘ç°æ­¤ç‰¹å®šçš„ person ç±»å‹å¯¹è±¡å…·æœ‰åç§°å˜é‡â€œBobbyâ€ï¼&lt;/p&gt;
&lt;p&gt;è¿™æ­£æ˜¯æˆ‘ä»¬å°†å¯¹æˆ‘ä»¬çš„&lt;code&gt;*data&lt;/code&gt;æ‰€åšçš„ï¼&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®ä¸­åŒ…å«ä»€ä¹ˆ&#34;&gt;æ•°æ®ä¸­åŒ…å«ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å› æ­¤ï¼Œç¬¬ä¸€æ­¥æ˜¯ç¡®å®šæ•°æ®æ˜¯å¦ä»¥ä»¥å¤ªç½‘å¸§å¼€å¤´ï¼å‡ ä¹æ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½ä»¥ä»¥å¤ªç½‘å¸§å¼€å¤´ï¼Œè¿™ç›¸å½“ç®€å•ï¼Œä½†å…¶ä½œç”¨æ˜¯å…·æœ‰æºå’Œç›®æ ‡ç¡¬ä»¶åœ°å€ï¼ˆæ— è®ºè™šæ‹ŸåŒ–/å®¹å™¨åŒ–/æœ‰çº¿ç½‘ç»œè¿˜æ˜¯ WiFi å¦‚ä½•ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€æ­¥æ˜¯å°†æˆ‘ä»¬çš„&lt;code&gt;*data&lt;/code&gt;è½¬æ¢ä¸ºç±»å‹&lt;code&gt;ETHHDR&lt;/code&gt;ï¼Œå¦‚æœæˆåŠŸï¼Œæˆ‘ä»¬ç°åœ¨å°†èƒ½å¤Ÿäº†è§£ç»„æˆä»¥å¤ªç½‘å¤´æ•°æ®ç±»å‹çš„å˜é‡ã€‚è¿™äº›åŒ…æ‹¬æºå’Œç›®æ ‡ MAC åœ°å€ï¼Œä½†æ›´é‡è¦çš„æ˜¯å‰©ä½™æ•°æ®çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚å†æ¬¡ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»¥å¤ªç½‘å¤´ä¹‹åçš„&lt;code&gt;*data&lt;/code&gt;å†…å®¹é€šå¸¸æ˜¯ IP å¤´ï¼Œä½†æˆ‘ä»¬å°†é€šè¿‡æ£€æŸ¥ä»¥å¤ªç½‘å¸§çš„ TBD å˜é‡æ¥éªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬éªŒè¯ä¸‹ä¸€ç»„æ•°æ®æ˜¯ IP å¤´ï¼Œæˆ‘ä»¬å°†éœ€è¦å°†ä»¥å¤ªç½‘å¤´ä¹‹åçš„æ•°æ®è½¬æ¢ä¸º IPHDR ç±»å‹ã€‚ä¸€æ—¦æˆ‘ä»¬è¿™æ ·åšï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿè®¿é—® IP ç‰¹å®šçš„æ•°æ®ï¼Œä¾‹å¦‚æº IPï¼ˆ&lt;code&gt;saddr&lt;/code&gt;ï¼‰æˆ–ç›®æ ‡åœ°å€ï¼ˆ&lt;code&gt;daddr&lt;/code&gt;ï¼‰ï¼Œå†æ¬¡é‡è¦çš„æ˜¯ IP å¤´åŒ…å«ä¸€ä¸ªå˜é‡ï¼Œè¯¦ç»†è¯´æ˜äº† IP å¤´ä¹‹åçš„æ•°æ®æ˜¯ä»€ä¹ˆã€‚è¿™é€šå¸¸æ˜¯ TCP å¤´æˆ– UDP å¤´ï¼Œä½†è¿˜æœ‰å…¶ä»–é€‰æ‹©ï¼Œä¾‹å¦‚ sctp ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬æŸ¥çœ‹äº† IP å¤´çš„å†…éƒ¨å¹¶ç¡®å®šæ•°æ®ç±»å‹æ˜¯ TCPï¼ˆä¹Ÿå¯èƒ½æ˜¯ UDP æˆ–å…¶ä»–å†…å®¹ï¼‰ï¼Œæˆ‘ä»¬å°†æŠŠä»¥å¤ªç½‘å¤´å’Œ IP å¤´ä¹‹åçš„æ•°æ®éƒ½è½¬æ¢ä¸º TCP å¤´ç±»å‹ï¼ï¼ˆå‡ ä¹å®Œæˆäº†ï¼‰ã€‚é€šè¿‡è®¿é—® TCP å¤´çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— TCP ç‰¹å®šçš„æ•°æ®ï¼Œä¾‹å¦‚æºç«¯å£æˆ–ç›®æ ‡ç«¯å£ï¼Œç”¨äºéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§çš„æ ¡éªŒå’Œä»¥åŠå…¶ä»–æœ‰ç”¨çš„å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å‡ ä¹æ‹¥æœ‰ä¸€åˆ‡ï¼Œä½†æ˜¯ TCP å¤´çš„é•¿åº¦å¯èƒ½æ˜¯å¯å˜çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡æŸ¥çœ‹ tcl_len å˜é‡æ¥ç¡®å®šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¹˜ä»¥ 4ã€‚ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†è®¿é—®æœ€ç»ˆæ•°æ®æ‰€éœ€çš„ä¸€åˆ‡ï¼&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œ&lt;code&gt;*data&lt;/code&gt;æŒ‡å‘æ•°æ®çš„å¼€å¤´ï¼æˆ‘ä»¬å·²ç»ç¡®å®šäº†ä»¥å¤ªç½‘å¤´ä¹‹åæ˜¯ IP å¤´ï¼Œæœ€åæ˜¯ TCP å¤´ï¼Œè¿™æ„å‘³ç€`*data + ä»¥å¤ªç½‘å¤´ + IP å¤´ + TCP å¤´ = å®é™…åº”ç”¨ç¨‹åºæ•°æ®ï¼&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›ä¿¡æ¯åšä»€ä¹ˆ&#34;&gt;æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›ä¿¡æ¯åšä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å½“æˆ‘ä»¬è§£æå„ç§æ ‡å¤´æ—¶ï¼Œå®é™…ä¸Šåœ¨ OSI æ¨¡å‹çš„ä¸åŒå±‚æ¬¡ä¸Šè§£é”äº†è¶Šæ¥è¶Šå¤šçš„ä¿¡æ¯ï¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 2 å±‚]&lt;/strong&gt; ä»¥å¤ªç½‘å¤´ä¸ºæˆ‘ä»¬æä¾›äº†æºå’Œç›®æ ‡ç¡¬ä»¶åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥æ½œåœ¨åœ°é˜»æ­¢ä»æˆ‘ä»¬çŸ¥é“å±é™©çš„æº MAC åœ°å€å¤„ç†çš„å¸§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 3 å±‚]&lt;/strong&gt; IP å¤´åŒ…å«æºå’Œç›®æ ‡ IP åœ°å€ï¼Œå†æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥åƒé˜²ç«å¢™ä¸€æ ·è¿ä½œï¼Œé€šè¿‡ä½¿ç”¨ eBPF ç¨‹åºä¸¢å¼ƒç‰¹å®š IP åœ°å€çš„æ‰€æœ‰æµé‡ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® IP åœ°å€é‡å®šå‘æµé‡ï¼Œæˆ–è€…ç”šè‡³åœ¨è¿™ä¸€å±‚å®æ–½è´Ÿè½½å‡è¡¡é€»è¾‘ï¼Œä»¥å°†æµé‡é‡å®šå‘åˆ°å…¶ä»–åº•å±‚ IP åœ°å€é›†åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 4 å±‚]&lt;/strong&gt; TCP æˆ– UDP æ ‡å¤´å®šä¹‰äº†ç›®æ ‡ç«¯å£å·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥ç¡®å®šåº”ç”¨ç¨‹åºåè®®æ˜¯ä»€ä¹ˆï¼ˆå³ç«¯å£ 80 é€šå¸¸æ„å‘³ç€å‰©ä½™çš„*data å¯èƒ½æ˜¯ HTTP æ•°æ®ï¼‰ã€‚åœ¨è¿™ä¸€å±‚ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ‰§è¡Œè´Ÿè½½å‡è¡¡ç­‰æ“ä½œï¼ŒåŸºäºç›®æ ‡ï¼ˆå³åœ¨å¤šä¸ªå…¶ä»–è´Ÿè½½å‡è¡¡å™¨åœ°å€ä¹‹é—´å¹³è¡¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 7 å±‚]&lt;/strong&gt; æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œå„ç§æ ‡å¤´é›†åˆçš„æœ«å°¾çš„æ•°æ®æ˜¯å®é™…çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“æ ¼å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è§£æå®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤–éƒ¨ Web æµè§ˆå™¨å°è¯•è®¿é—®æˆ‘çš„è®¡ç®—æœºä¸Šçš„&lt;code&gt;/index.html&lt;/code&gt;å¹¶é™„åŠ äº† eBPF ç¨‹åºï¼Œæˆ‘ä¼šè§£æåˆ° TCPï¼Œç„¶åç¡®å®šå®ƒæ˜¯ç«¯å£ 80ï¼Œç„¶ååº”ç”¨ç¨‹åºæ•°æ®åº”è¯¥æ˜¯ HTTP æ ¼å¼ã€‚æˆ‘å¯ä»¥é€šè¿‡æŸ¥çœ‹åº”ç”¨ç¨‹åºæ•°æ®çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ˆåœ¨æ‰€æœ‰æ ‡å¤´ä¹‹åï¼‰æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ApplicationData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; EthernetHDR + IPHDR + TCPHDR // å°†æ‰€æœ‰æ ‡å¤´é•¿åº¦ç›¸åŠ ä»¥æ‰¾åˆ°æ•°æ®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;If &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ApplicationData&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;G&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ApplicationData+1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;E&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ApplicationData+2&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;T&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	// è¿™æ˜¯ä¸€ä¸ªHTTP GETè¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	// åšä¸€äº›ä»¤äººå…´å¥‹çš„äº‹æƒ…
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬â€œæœ‰ç‚¹â€ç†è§£äº†è¿™ä¸ªé€»è¾‘ï¼Œä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥è€ƒè™‘å®æ–½ä¸€äº›ä»£ç æ¥å®Œæˆæ‰€æœ‰è¿™äº›&amp;hellip;ä½†è¿™å°†æ˜¯å¦ä¸€å¤©çš„äº‹æƒ…ã€‚&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>ä½¿ç”¨ Geneve éš§é“å®ç° Istio Ambient Mesh çš„æµé‡æ‹¦æˆª</title>
      <link>https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/</link>
      <pubDate>Fri, 24 Mar 2023 15:03:40 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨æˆ‘&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/&#34; title=&#34;ä¹‹å‰çš„åšå®¢&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;åˆ†äº«ä¸­æåˆ° Istio Ambient Mesh ä½¿ç”¨ iptables å’Œ Geneve éš§é“å°†åº”ç”¨ç¨‹åº Pod ä¸­çš„æµé‡æ‹¦æˆªåˆ° Ztunnel ä¸­ã€‚å¾ˆå¤šè¯»è€…å¯èƒ½è¿˜ä¸äº†è§£è¿™ç§éš§é“åè®®ï¼Œæœ¬æ–‡å°†ä¸ºä½ ä»‹ç» Geneve éš§é“çš„å®šä¹‰ï¼ŒæŠ¥æ–‡ç»“æ„ï¼Œä»¥åŠä¸ VXLAN åè®®çš„æ¯”è¾ƒæœ‰å“ªäº›ä¼˜åŠ¿ã€‚æœ€åï¼Œæœ¬æ–‡å°†ä»‹ç» Istio Ambient Mesh å¦‚ä½•åº”ç”¨ Geneve éš§é“æ¥å®ç°æµé‡æ‹¦æˆªï¼Œä»¥åŠ Istio 1.18 ä¸­æ–°æ¨å‡ºçš„ eBPF æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;geneve-éš§é“ç®€ä»‹&#34;&gt;Geneve éš§é“ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;GENEVEï¼ˆGeneric Network Virtualization Encapsulationï¼‰æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–å°è£…ï¼ˆéš§é“ï¼‰åè®®ï¼Œå®ƒçš„è®¾è®¡çš„åˆè¡·æ˜¯ä¸ºäº†è§£å†³å½“å‰æ•°æ®ä¼ è¾“ç¼ºä¹çµæ´»æ€§å’Œå®‰å…¨æ€§çš„é—®é¢˜ã€‚Geneve åªå®šä¹‰äº†ä¸€ç§æ•°æ®å°è£…æ ¼å¼ï¼Œä¸åŒ…æ‹¬æ§åˆ¶å¹³é¢çš„ä¿¡æ¯ã€‚GENEVE ç›¸è¾ƒäº VXLAN å°è£…çš„å…³é”®ä¼˜åŠ¿åœ¨äºå…¶é€šè¿‡æ·»åŠ  TLV æ ¼å¼çš„é€‰é¡¹æ¥æ‰©å±•å¯å°è£…çš„åè®®ç±»å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;geneve-vs-vxlan&#34;&gt;Geneve vs VXLAN&lt;/h2&gt;
&lt;p&gt;VXLAN å’Œ Geneve éƒ½æ˜¯ç½‘ç»œè™šæ‹ŸåŒ–åè®®ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚è™šæ‹ŸåŒ–åè®®æ˜¯ä¸€ç§å°†è™šæ‹Ÿç½‘ç»œä¸ç‰©ç†ç½‘ç»œåˆ†ç¦»çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œç®¡ç†å‘˜åœ¨è™šæ‹Ÿç¯å¢ƒä¸­åˆ›å»ºå¤šä¸ªè™šæ‹Ÿç½‘ç»œï¼Œæ¯ä¸ªè™šæ‹Ÿç½‘ç»œéƒ½å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ VLAN æ ‡è¯†ç¬¦ã€IP åœ°å€å’Œè·¯ç”±ã€‚æ­¤å¤–ï¼ŒVXLAN å’Œ Geneve åè®®éƒ½ä½¿ç”¨ UDP å°è£…ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½å¤Ÿé€šè¿‡ç°æœ‰ç½‘ç»œåŸºç¡€è®¾æ–½è¿›è¡Œæ‰©å±•ã€‚VXLAN å’Œ Geneve åè®®è¿˜å…·æœ‰çµæ´»æ€§ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ä¸ä¸åŒçš„è™šæ‹ŸåŒ–å¹³å°å…¼å®¹ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ 1 å±•ç¤ºäº† VXLAN ä¸ Geneve åè®®çš„æŠ¥æ–‡ç»“æ„åŠå…¶å„è‡ªçš„ Header åŒºåˆ«ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/vxlan-vs-geneve.svg&#34; data-img=&#34;/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/vxlan-vs-geneve.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šVXLAN ä¸ Geneve æŠ¥æ–‡æ ¼å¼ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;å›¾ 1ï¼šVXLAN ä¸ Geneve æŠ¥æ–‡æ ¼å¼ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒVXLAN ä¸ Geneve éš§é“æŠ¥æ–‡çš„ç»“æ„ç±»ä¼¼ï¼Œå…¶ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨ä¸åŒçš„ UDP ç«¯å£å·å’Œåè®®å¤´ â€”â€”VXLAN ä½¿ç”¨ 4789 ç«¯å£ï¼ŒGeneve ä½¿ç”¨ 6081 ç«¯å£ï¼›Geneve åè®®å¤´æ¯” VXLAN æ›´å…·æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Geneve éš§é“åè®®æ¯” VXLAN æ›´åŠ å¯æ‰©å±•æ˜¯å› ä¸º Geneve éš§é“åè®®ä¸­å¢åŠ äº†å˜é•¿é€‰é¡¹ï¼Œå®ƒå¯ä»¥åŒ…å«é›¶æˆ–å¤šä¸ª TLV æ ¼å¼çš„é€‰é¡¹æ•°æ®ã€‚TLV æ˜¯æŒ‡ç±»å‹ - é•¿åº¦ - å€¼ï¼ˆType-Length-Valueï¼‰æ ¼å¼ï¼Œç”¨äºä¼ è¾“å’Œè§£æç½‘ç»œåŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚åœ¨ Geneve åè®®ä¸­ï¼Œæ¯ä¸ªå…ƒæ•°æ®ä¿¡æ¯éƒ½ç”±ä¸€ä¸ª TLV æ ¼å¼çš„å­—æ®µç»„æˆï¼Œä»¥ä¾¿äºçµæ´»åœ°æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹è¿™äº›å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼ŒTLV æ ¼å¼çš„å­—æ®µåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Typeï¼š8 ä½çš„ç±»å‹å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;Lengthï¼š5 ä½çš„é€‰é¡¹é•¿åº¦å­—æ®µï¼Œä»¥ 4 å­—èŠ‚å€æ•°è¡¨ç¤ºï¼Œä¸åŒ…æ‹¬é€‰é¡¹å¤´ã€‚&lt;/li&gt;
&lt;li&gt;Dataï¼šå¯å˜é•¿çš„é€‰é¡¹æ•°æ®å­—æ®µï¼Œå¯ä»¥ä¸å­˜åœ¨æˆ–è€…ä¸º 4 åˆ° 128 å­—èŠ‚ä¹‹é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨ TLV æ ¼å¼ï¼ŒGeneve åè®®å¯ä»¥è½»æ¾åœ°æ‰©å±•å’Œä¿®æ”¹å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒæ—¶ä¿æŒå…¼å®¹æ€§å’Œçµæ´»æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº VXLAN éš§é“æŠ¥æ–‡çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://tools.ietf.org/html/rfc7348&#34; title=&#34;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Geneve éš§é“æŠ¥æ–‡çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://www.rfc-editor.org/rfc/rfc8926#name-geneve-packet-format-over-i&#34; title=&#34;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œåŸç†&#34;&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;p&gt;Geneve éš§é“ä¸»è¦åº”ç”¨åœ¨äº‘è®¡ç®—å’Œè™šæ‹ŸæœºåŒ–åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åŒ…å°è£…åœ¨ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ä¸­ï¼Œä»¥ä¾¿åœ¨è™šæ‹Ÿç½‘ç»œä¸­ä¼ è¾“ã€‚Geneve éš§é“ä½¿ç”¨ä¸€ä¸ª 24 ä½çš„è™šæ‹Ÿç½‘ç»œæ ‡è¯†ç¬¦ (VNI)ï¼Œå°†æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚Geneve éš§é“è¿˜å¯ä»¥ä½¿ç”¨å®‰å…¨æ€§åè®®ï¼Œå¦‚ IPsecã€TLï¼Œæ¥ä¿æŠ¤æ•°æ®åŒ…çš„ä¼ è¾“ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ•°æ®åŒ…åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶ï¼ŒGeneve éš§é“åè®®ä¼šå°†æ•°æ®åŒ…ä» Geneve åè®®å¤´ä¸­è§£å°è£…å‡ºæ¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è™šæ‹Ÿç½‘ç»œä¸­çš„ç›®çš„åœ°ã€‚åœ¨è§£å°è£…è¿‡ç¨‹ä¸­ï¼ŒGeneve åè®®å¤´ä¸­çš„ VNI ä¿¡æ¯ä¼šè¢«æ¥åˆ¤æ–­æ•°æ®åŒ…çš„ç›®çš„åœ°ï¼Œä»¥ç¡®ä¿æ•°æ®åŒ…è¢«æ­£ç¡®åœ°è·¯ç”±åˆ°è™šæ‹Ÿç½‘ç»œä¸­çš„ç›®çš„åœ°ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œå…¶ VNI ä¸º 1001ã€‚å½“æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨éš§é“å°†æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéš§é“å°†æºç‰©ç†ç½‘ç»œå’Œç›®æ ‡ç‰©ç†ç½‘ç»œä¹‹é—´çš„è™šæ‹Ÿç½‘ç»œæ ‡è¯†ç¬¦ (VNI) è®¾ç½®ä¸º 1001ï¼Œä»¥ä¾¿åœ¨ä¼ è¾“æœŸé—´è·Ÿè¸ªæ•°æ®åŒ…ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡ç‰©ç†ç½‘ç»œæ—¶ï¼Œéš§é“å°† VNI ä»æ•°æ®åŒ…ä¸­åˆ é™¤ï¼Œå¹¶å°†æ•°æ®åŒ…ä¼ é€’ç»™ç›®æ ‡ç‰©ç†ç½‘ç»œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®‰å…¨æ€§&#34;&gt;å®‰å…¨æ€§&lt;/h3&gt;
&lt;p&gt;Geneve éš§é“åè®®æœ¬èº«å¹¶æ²¡æœ‰æä¾›ä»»ä½•å®‰å…¨æœºåˆ¶ï¼Œå› æ­¤åœ¨ Geneve éš§é“ä¸­ä¼ è¾“çš„æ•°æ®åŒ…å¯èƒ½ä¼šå—åˆ°å¨èƒï¼Œä¾‹å¦‚æ•°æ®åŒ…è¢«ç¯¡æ”¹ã€æˆªè·ã€é‡æ”¾ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿éšœ Geneve éš§é“ä¸­ä¼ è¾“çš„æ•°æ®åŒ…çš„å®‰å…¨æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨åè®®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®‰å…¨åè®®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IPsecï¼ˆInternet Protocol Securityï¼‰ï¼šIPsec æ˜¯ä¸€ç§ç½‘ç»œå±‚å®‰å…¨åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ã€è®¤è¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚ä½¿ç”¨ IPsec å¯ä»¥æä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;TLSï¼ˆTransport Layer Securityï¼‰ï¼šTLS æ˜¯ä¸€ç§åŸºäºä¼ è¾“å±‚çš„åŠ å¯†åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚ä½¿ç”¨ TLS å¯ä»¥æä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;MACSecï¼ˆMedia Access Control Securityï¼‰ï¼šMACSec æ˜¯ä¸€ç§æ•°æ®é“¾è·¯å±‚çš„å®‰å…¨åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚ä½¿ç”¨ MACSec å¯ä»¥æä¾›é“¾è·¯å±‚çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šå®‰å…¨åè®®éƒ½éœ€è¦è¿›è¡Œç›¸åº”çš„é…ç½®å’Œéƒ¨ç½²ï¼Œä¸”å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚åœ¨é€‰æ‹©åˆé€‚çš„å®‰å…¨åè®®æ—¶ï¼Œéœ€è¦è€ƒè™‘å®‰å…¨æ€§ã€æ€§èƒ½ã€å¯ç®¡ç†æ€§ç­‰æ–¹é¢çš„å› ç´ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆé€‰æ‹©-geneve&#34;&gt;ä¸ºä»€ä¹ˆé€‰æ‹© Geneveï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸‹è¡¨å¯¹æ¯”äº† VXLAN ä¸ Geneve åœ¨å¤šä¸ªæ–¹é¢çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;VXLAN&lt;/th&gt;
&lt;th&gt;Geneve&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤´éƒ¨æ ¼å¼&lt;/td&gt;
&lt;td&gt;å›ºå®šæ ¼å¼&lt;/td&gt;
&lt;td&gt;å¯æ‰©å±•æ ¼å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯æ‰©å±•æ€§&lt;/td&gt;
&lt;td&gt;æ›´å¤šåœ°ä¸“æ³¨äº L2 æ‰©å±•&lt;/td&gt;
&lt;td&gt;æ›´å¥½åœ°æ”¯æŒæ–°å…´ç½‘ç»œæœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯æ“ä½œæ€§&lt;/td&gt;
&lt;td&gt;è¾ƒéš¾ç®¡ç†å’Œæ‰©å±•&lt;/td&gt;
&lt;td&gt;æ›´å®¹æ˜“ç®¡ç†å’Œæ‰©å±•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ€§èƒ½&lt;/td&gt;
&lt;td&gt;å¤´éƒ¨è¾ƒçŸ­ï¼Œæ€§èƒ½è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;å¤´éƒ¨è¾ƒé•¿ï¼Œæ€§èƒ½ç•¥ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä½¿ç”¨ Geneve åè®®çš„ä¸»è¦åŸå› æ˜¯å°†ç›®å‰ç½‘ç»œè™šæ‹ŸåŒ–å°è£…æŠ€æœ¯ï¼ˆä¾‹å¦‚ VXLANã€NVGRE å’Œ STTï¼‰ä¸­çš„ä¼˜ç‚¹åˆå¹¶åˆ°ä¸€ä¸ªåè®®ä¸­ã€‚æˆ‘ä»¬é€šè¿‡å¤šå¹´çš„ç½‘ç»œè™šæ‹ŸåŒ–å¼€å‘ç»éªŒå¾—çŸ¥ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„éœ€æ±‚æ˜¯å¯æ‰©å±•æ€§ã€‚Geneve åè®®ä½¿ç”¨å¯æ‰©å±•çš„ TLV ç»“æ„å¯¹å…ƒæ•°æ®è¿›è¡Œç¼–ç ï¼Œå› æ­¤å¯ä»¥ç‹¬ç«‹åœ°å‘å±•è½¯ä»¶å’Œç¡¬ä»¶ç«¯ç‚¹çš„åŠŸèƒ½ï¼Œä»¥æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ambient-mesh-å¦‚ä½•åº”ç”¨-geneve-éš§é“&#34;&gt;Istio Ambient Mesh å¦‚ä½•åº”ç”¨ Geneve éš§é“&lt;/h2&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/&#34; title=&#34;ä¹‹å‰çš„åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;ä¸­ï¼Œæˆ‘è®²è§£äº† Istio Ambient Mesh å¦‚ä½•ä½¿ç”¨ Ztunnel å®ç° L4 ä»£ç†çš„ï¼Œå›¾ 2 å±•ç¤ºä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/geneve-tunnel.svg&#34; data-img=&#34;/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/geneve-tunnel.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 2ï¼šä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;å›¾ 2ï¼šä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºÂ &lt;code&gt;istioout&lt;/code&gt;Â ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°†èŠ‚ç‚¹ä¸­çš„å‡ºç«™æµé‡é€æ˜åŠ«æŒåˆ°Â &lt;code&gt;pistioout&lt;/code&gt;Â è™šæ‹Ÿç½‘å¡ï¼›&lt;/li&gt;
&lt;li&gt;Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»º &lt;code&gt;istioin&lt;/code&gt; ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°†èŠ‚ç‚¹ä¸­çš„å…¥ç«™æµé‡é€æ˜åŠ«æŒåˆ° &lt;code&gt;pistioin&lt;/code&gt; è™šæ‹Ÿç½‘å¡ï¼›&lt;/li&gt;
&lt;li&gt;Istio CNI åœ¨ ztunnel ä¸­åˆ›å»º &lt;code&gt;pistioin&lt;/code&gt; å’Œ &lt;code&gt;pistioout&lt;/code&gt; ç½‘å¡ï¼Œç”¨äºæ¥æ”¶ Geneve éš§é“ä¸­çš„å‘æ¥çš„æ•°æ®åŒ…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;pistioin&lt;/code&gt; å’Œ &lt;code&gt;pistioout&lt;/code&gt; è¿™ä¸¤ä¸ªç½‘å¡æ˜¯ç”± ztunnel ä¸­çš„ init å®¹å™¨æˆ– Istio CNIï¼ˆè§ &lt;a href=&#34;https://github.com/istio/istio/blob/master/cni/pkg/ambient/net_linux.go#L910&#34; title=&#34;&amp;lt;code&amp;gt;CreateRulesWithinNodeProxyNS&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;CreateRulesWithinNodeProxyNS&lt;/code&gt;&lt;/a&gt; å‡½æ•°ï¼‰åˆ›å»ºçš„ï¼Œå…¶ IP åœ°å€å’Œç«¯å£ä¹Ÿæ˜¯å›ºå®šçš„ã€‚åº”ç”¨å®¹å™¨å‘å‡ºçš„æ•°æ®åŒ…éœ€è¦ç»è¿‡ &lt;code&gt;istioout&lt;/code&gt; ç½‘å¡å¹¶ä½¿ç”¨ Geneve éš§é“å°è£…åè½¬å‘ç»™ ztunnel å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-ebpf-è¿›è¡Œé€æ˜æµé‡åŠ«æŒ&#34;&gt;ä½¿ç”¨ eBPF è¿›è¡Œé€æ˜æµé‡åŠ«æŒ&lt;/h2&gt;
&lt;p&gt;eBPFï¼ˆextended Berkeley Packet Filterï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨ Linux å†…æ ¸ä¸­è¿è¡Œå®‰å…¨çš„ç”¨æˆ·æ€ç¨‹åºã€‚eBPF æœ€åˆæ˜¯ä¸€ç§ç”¨äºè¿‡æ»¤ç½‘ç»œæ•°æ®åŒ…çš„æŠ€æœ¯ï¼Œä½†ç°åœ¨å·²ç»æ‰©å±•åˆ°å…¶ä»–é¢†åŸŸï¼Œå¦‚è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ã€æ€§èƒ½åˆ†æå’Œå®‰å…¨ç›‘æ§ç­‰ã€‚eBPF çš„ä¼˜åŠ¿åœ¨äºå…¶è½»é‡çº§ã€é«˜æ•ˆã€å®‰å…¨å’Œå¯ç¼–ç¨‹æ€§ã€‚å®ƒå¯ä»¥è¢«ç”¨äºå®æ—¶ç›‘æ§ã€ç½‘ç»œå®‰å…¨ã€åº”ç”¨ç¨‹åºè°ƒè¯•å’Œä¼˜åŒ–ã€å®¹å™¨ç½‘ç»œç­‰å¤šä¸ªé¢†åŸŸã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.18 ä¹‹å‰ï¼ŒAmbient æ¨¡å¼ä¸­ä½¿ç”¨ iptables å’Œ Geneve éš§é“å°†åº”ç”¨ç¨‹åºæµé‡é€æ˜åŠ«æŒåˆ° ztunnel ä¸­ã€‚åœ¨ Istio 1.18 ä¸­ï¼Œå¢åŠ äº† eBPF é€‰é¡¹ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ iptables æˆ– eBPF æ¥åšæµé‡åŠ«æŒã€‚å¦‚å›¾ 3 æ‰€ç¤ºï¼ŒeBPF ç¨‹åºç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºå†…æ ¸ï¼Œå°†åº”ç”¨ç¨‹åºçš„æµé‡è½¬å‘åˆ° ztunnel ä¸­ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/ebpf.svg&#34; data-img=&#34;/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/ebpf.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯¹æ¯”é¡¹&lt;/th&gt;
&lt;th&gt;eBPF æ–¹å¼&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ iptables å’Œ Geneve éš§é“&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•ˆç‡&lt;/td&gt;
&lt;td&gt;æ›´é«˜&lt;/td&gt;
&lt;td&gt;ç•¥ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¼å®¹æ€§&lt;/td&gt;
&lt;td&gt;éœ€è¦è¾ƒé«˜çš„ Linux å†…æ ¸ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;æ›´å¥½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®ç°éš¾åº¦&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;è¾ƒä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰©å±•æ€§&lt;/td&gt;
&lt;td&gt;è¾ƒå¥½&lt;/td&gt;
&lt;td&gt;è¾ƒå·®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&#34;https://istio.io/latest/blog/2023/ambient-ebpf-redirection/&#34; title=&#34;Istio å®˜æ–¹åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹åšå®¢&lt;/a&gt;ä»‹ç»ï¼Œä½¿ç”¨ eBPF æ–¹å¼é¿å…äº†éƒ¨åˆ† iptables è§„åˆ™å’Œéš§é“å°è£…ï¼Œç›¸æ¯”ä½¿ç”¨ iptables å’Œ Geneve éš§é“æ›´åŠ é«˜æ•ˆã€‚ç„¶è€Œï¼ŒeBPF å¯¹ Linux å†…æ ¸ç‰ˆæœ¬çš„è¦æ±‚æ›´é«˜ï¼ˆè‡³å°‘ 4.20ï¼‰ï¼Œè€Œ iptables æ–¹å¼åˆ™å…·æœ‰æ›´å¥½çš„å…¼å®¹æ€§ã€‚æ­¤å¤–ï¼ŒeBPF æ–¹å¼çš„å®ç°éš¾åº¦è¾ƒé«˜ï¼Œä½†æ‰©å±•æ€§è¾ƒå¥½ã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³ä½¿ç”¨ eBPF æ¨¡å¼è¿è¡Œ Ambient Meshï¼Œåªéœ€è¦åœ¨å®‰è£… Istio æ—¶è®¾ç½® &lt;code&gt;values.cni.ambient.redirectMode&lt;/code&gt; å‚æ•°å³å¯ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ambient --set values.cni.ambient.redirectMode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ebpf&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Geneve éš§é“åè®®çš„å·¥ä½œåŸç†ã€å®‰å…¨æ€§å’Œä¸ VXLAN çš„æ¯”è¾ƒã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº† Istio Ambient Mesh å¦‚ä½•ä½¿ç”¨ Geneve éš§é“å®ç°æµé‡æ‹¦æˆªï¼Œå¹¶è®¨è®ºäº†ä½¿ç”¨ eBPF è¿›è¡Œé€æ˜æµé‡åŠ«æŒçš„ä¼˜ç¼ºç‚¹ã€‚Geneve éš§é“åè®®æ˜¯ä¸€ç§é€šç”¨çš„éš§é“åè®®ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿç½‘ç»œä¸­ä¼ è¾“æ•°æ®åŒ…ï¼Œå…·æœ‰æ›´å¤šçš„ä¼˜åŠ¿ï¼Œå› æ­¤åœ¨é€‰æ‹©éš§é“åè®®æ—¶ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨ Geneve éš§é“ã€‚åœ¨ Istio 1.18 ä¸­æ–°æ¨å‡ºäº† Ambient Mesh çš„çš„ eBPF æ¨¡å¼ï¼Œå¯ä»¥æä¾›ç½‘ç»œæ•ˆç‡ï¼Œä½†å¯¹ Linux å†…æ ¸ç‰ˆæœ¬æœ‰æ›´é«˜è¦æ±‚ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc7348&#34; title=&#34;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.rfc-editor.org/rfc/rfc8926#name-geneve-packet-format-over-i&#34; title=&#34;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/architecture/#istio-ambient-mesh&#34; title=&#34;Istio Ambient Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Ambient Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mankier.com/8/ovs-vswitchd.conf.db%285%29&#34; title=&#34;Open vSwitch Geneve(8) man page&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open vSwitch Geneve(8) man page&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
                           
    <item>
      <title>Beyond Istio OSS â€”â€” Istio æœåŠ¡ç½‘æ ¼çš„ç°çŠ¶ä¸æœªæ¥</title>
      <link>https://jimmysong.io/blog/beyond-istio-oss/</link>
      <pubDate>Sat, 23 Jul 2022 15:27:49 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/blog/beyond-istio-oss/</guid>
      <description>
        
        
        


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    å…³äºæœ¬æ–‡
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    æœ¬æ–‡æ ¹æ®ç¬”è€…åœ¨ GIAC æ·±åœ³ 2022 å¹´å¤§ä¼šä¸Šçš„çš„æ¼”è®²&lt;a href=&#34;https://giac.msup.com.cn/2022sz/course?id=16093&#34; title=&#34;ã€ŠBeyond Istio OSS â€”â€” Istio çš„ç°çŠ¶åŠæœªæ¥ã€‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€ŠBeyond Istio OSS â€”â€” Istio çš„ç°çŠ¶åŠæœªæ¥ã€‹&lt;/a&gt;æ•´ç†è€Œæˆï¼Œæ¼”è®²å¹»ç¯ç‰‡è§ &lt;a href=&#34;https://docs.qq.com/pdf/DRWxETHNDZmRsS0l5&#34; title=&#34;è…¾è®¯æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è…¾è®¯æ–‡æ¡£&lt;/a&gt;ã€‚
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;æœ¬æ–‡å›é¡¾äº† Istio å¼€æºè¿‘äº”å¹´æ¥çš„å‘å±•ï¼Œå¹¶å±•æœ›äº† Istio æœåŠ¡ç½‘æ ¼çš„æœªæ¥æ–¹å‘ã€‚æœ¬æ–‡çš„ä¸»è¦è§‚ç‚¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸º Kubernetesã€å¾®æœåŠ¡ã€DevOps åŠäº‘åŸç”Ÿæ¶æ„çš„æµè¡Œï¼Œå¯¼è‡´æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„å…´èµ·ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes å’Œå¯ç¼–ç¨‹ä»£ç†ï¼Œä¸º Istio çš„å‡ºç°æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼›&lt;/li&gt;
&lt;li&gt;è™½ç„¶ eBPF å¯ä»¥åŠ é€Ÿ Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒï¼Œä½†æ— æ³•å–ä»£æœåŠ¡ç½‘æ ¼ä¸­çš„ sidecarï¼›&lt;/li&gt;
&lt;li&gt;Istio çš„æœªæ¥åœ¨äºæ„å»ºåŸºäºæ··åˆäº‘çš„é›¶ä¿¡ä»»ç½‘ç»œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;the-dawn-of-istio&#34;&gt;Istio è¯ç”Ÿçš„å‰å¤œ&lt;/h2&gt;
&lt;p&gt;2013 å¹´èµ·ï¼Œéšç€ç§»åŠ¨äº’è”ç½‘çš„çˆ†å‘ï¼Œä¼ä¸šå¯¹åº”ç”¨è¿­ä»£çš„æ•ˆç‡è¦æ±‚æ›´é«˜ï¼Œåº”ç”¨ç¨‹åºæ¶æ„å¼€å§‹ä»å•ä½“è½¬å‘å¾®æœåŠ¡ï¼ŒDevOps ä¹Ÿå¼€å§‹å˜å¾—æµè¡Œã€‚åŒå¹´éšç€ Docker çš„å¼€æºï¼Œè§£å†³äº†åº”ç”¨å°è£…å’Œéš”ç¦»çš„é—®é¢˜ï¼Œä½¿å¾—åº”ç”¨åœ¨ç¼–æ’ç³»ç»Ÿä¸­è°ƒåº¦å˜å¾—æ›´å®¹æ˜“ã€‚2014 å¹´ Kubernetesã€Spring Boot å¼€æºï¼ŒSpring æ¡†æ¶å¼€å‘å¾®æœåŠ¡åº”ç”¨å¼€å§‹æµè¡Œï¼Œåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é—´å¤§æ‰¹çš„ RPC ä¸­é—´ä»¶å¼€æºé¡¹ç›®å‡ºç°ï¼Œå¦‚ Google åœ¨ 2016 å¹´å‘å¸ƒ gRPC 1.0ï¼Œèš‚èšåœ¨ 2018 å¹´å¼€æº &lt;a href=&#34;https://www.sofastack.tech/&#34; title=&#34;SOFAStack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOFAStack&lt;/a&gt; ç­‰ï¼Œå¾®æœåŠ¡æ¡†æ¶ç™¾èŠ±é½æ”¾ã€‚ä¸ºäº†èŠ‚çº¦æˆæœ¬ï¼Œå¢åŠ å¼€å‘æ•ˆç‡ï¼Œä½¿åº”ç”¨æ›´å…·å¼¹æ€§ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šæ­£åœ¨è¿ç§»ä¸Šäº‘ï¼Œä½†è¿™ä¸ä»…ä»…æ˜¯å°†åº”ç”¨æ¬åˆ°äº‘ä¸Šé‚£ä¹ˆç®€å•ï¼Œä¸ºäº†æ›´é«˜æ•ˆåœ°åˆ©ç”¨äº‘è®¡ç®—ï¼Œä¸€å¥—ã€Œäº‘åŸç”Ÿã€æ–¹æ³•å’Œç†å¿µä¹Ÿå‘¼ä¹‹æ¬²å‡ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-open-time-line&#34;&gt;Istio å¼€æºæ—¶é—´çº¿&lt;/h2&gt;
&lt;p&gt;Istio å¼€æºå‘å±•æ—¶é—´çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istio-history.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istio-history.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio å¼€æºå‘å±•æ—¶é—´çº¿ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Istio å¼€æºå‘å±•æ—¶é—´çº¿ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•å›é¡¾ä¸‹ Istio å¼€æºå¤§äº‹ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2016 å¹´ 9 æœˆï¼šå› ä¸º Envoy æ˜¯ Istio ä¸­çš„é‡è¦ç»„æˆï¼ŒIstio çš„å¼€æºæ—¶é—´çº¿åº”è¯¥æœ‰ Envoy ä¸€éƒ¨åˆ†ã€‚èµ·åˆ Envoy åœ¨ Lyft å†…éƒ¨ä»…ä½œä¸ºè¾¹ç¼˜ä»£ç†ï¼Œå¼€æºå‰å·²åœ¨ Lyft å†…éƒ¨å¾—åˆ°å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯å¹¶å—åˆ°äº† Google å·¥ç¨‹å¸ˆçš„æ³¨æ„ &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œé‚£æ—¶å€™ Google æ­£æ‰“ç®—æ¨å‡ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼çš„å¼€æºé¡¹ç›®ã€‚2017 å¹´ï¼ŒLyft å°† Envoy æçŒ®ç»™äº† &lt;a href=&#34;https://cncf.io&#34; title=&#34;CNCF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;2017 å¹´ 5 æœˆï¼šIstio ç”± Googleã€IBM å’Œ Lyft è”åˆå®£å¸ƒå¼€æº &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚ä¸€å¼€å§‹å°±ä½¿ç”¨äº†å¾®æœåŠ¡æ¶æ„ï¼Œç¡®å®šäº†æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„ç»„æˆä»¥åŠ Sidecar æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;2018 å¹´ 3 æœˆï¼šKubernetes é¡ºåˆ©çš„æˆä¸ºä» CNCF ä¸­ç¬¬ä¸€ä¸ªæ¯•ä¸šçš„é¡¹ç›®ï¼Œå˜å¾—è¶Šæ¥è¶Šã€Œæ— èŠã€ï¼ŒåŸºç¡€ API å·²ç»å®šå‹ï¼ŒCNCF æ­£å¼å°†æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰å†™å…¥åˆ°äº†äº‘åŸç”Ÿçš„ç¬¬äºŒç‰ˆå®šä¹‰ &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; ä¸­ã€‚ç¬”è€…å½“å‰å°±èŒçš„å…¬å¸ &lt;a href=&#34;https://tetrate.io&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;ï¼Œä¹Ÿæ˜¯åœ¨é‚£æ—¶ç”± Google Istio åˆåˆ›å›¢é˜Ÿåˆ›ä¸šæˆç«‹çš„ã€‚æœåŠ¡ç½‘æ ¼åœ¨ä¸­å›½å¼€å§‹çˆ†å‘ï¼ŒServiceMesher ç¤¾åŒºä¹Ÿåœ¨èš‚èšé›†å›¢çš„æ”¯æŒä¸‹æˆç«‹ï¼Œåœ¨ä¸­å›½å¸ƒé“æœåŠ¡ç½‘æ ¼æŠ€æœ¯ã€‚&lt;/li&gt;
&lt;li&gt;2018 å¹´ 7 æœˆï¼šIstio 1.0 å‘å¸ƒï¼Œå·ç§°ã€Œç”Ÿäº§å¯ç”¨ã€ï¼ŒIstio å›¢é˜Ÿé‡ç»„ã€‚&lt;/li&gt;
&lt;li&gt;2020 å¹´ 3 æœˆï¼šIstio 1.5 å‘å¸ƒï¼Œæ¶æ„å›å½’å•ä½“ï¼Œå‘å¸ƒå‘¨æœŸç¡®å®šï¼Œæ¯ä¸‰ä¸ªæœˆå‘å¸ƒä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼ŒAPI è¶‹äºç¨³å®šã€‚&lt;/li&gt;
&lt;li&gt;2020 å¹´è‡³ä»Šï¼šIstio çš„å‘å±•ä¸»è¦ç€é‡äº Day 2 Operation &lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€æ€§èƒ½ä¼˜åŒ–å’Œæ‰©å±•æ€§å‘é¢ï¼Œå¤šä¸ªå›´ç»• Istio ç”Ÿæ€çš„å¼€æºé¡¹ç›®å¼€å§‹å‡ºç°ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://github.com/slime-io/slime/&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/aeraki-mesh/aeraki&#34; title=&#34;Areaki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Areaki&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/merbridge/merbridge&#34; title=&#34;Merbridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;why-istio-born-after-kubernetes&#34;&gt;ä¸ºä»€ä¹ˆ Istio ä¼šåœ¨ Kubernetes ä¹‹åå‡ºç°ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¾®æœåŠ¡å’Œå®¹å™¨åŒ–ä¹‹åï¼Œå¼‚æ„è¯­è¨€ä½¿ç”¨çš„å¢åŠ ï¼ŒæœåŠ¡çš„æ•°é‡æ¿€å¢ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå˜çŸ­æ˜¯å¯¼è‡´æœåŠ¡ç½‘æ ¼å‡ºç°çš„æ ¹æœ¬åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœåŠ¡ä»éƒ¨ç½²åœ¨ Kubernetes åˆ° Istio ä¸­æ¶æ„çš„å˜è¿ï¼Œç„¶åå†æ¢è®¨æ¶æ„æ¼”è¿›è¿‡ç¨‹ä¸­ Istio çš„éœ€æ±‚ï¼Œä¸‹æ–‡å‡å®šè¯»è€…å·²äº†è§£ &lt;a href=&#34;https://jimmysong.io/book/kubernetes-handbook/architecture/&#34; title=&#34;Kubernetes&#34;&gt;Kubernetes&lt;/a&gt; å’Œ &lt;a href=&#34;https://istio.io/latest/zh/docs/ops/deployment/architecture/&#34; title=&#34;Istio çš„æ¶æ„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio çš„æ¶æ„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/kubernetes-to-istio.svg&#34; data-img=&#34;/blog/beyond-istio-oss/kubernetes-to-istio.svg&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes åˆ° Istio çš„æ¶æ„æ”¹å˜ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Kubernetes åˆ° Istio çš„æ¶æ„æ”¹å˜ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä» Kubernetes åˆ° Istioï¼Œæ¦‚æ‹¬çš„è®²åº”ç”¨çš„éƒ¨ç½²æ¶æ„æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†ï¼ˆæ‰©ç¼©å®¹ã€è‡ªåŠ¨æ¢å¤ã€å‘å¸ƒç­–ç•¥ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäº Kubernetes çš„è‡ªåŠ¨ sidecar æ³¨å…¥ï¼Œå®ç°äº†é€æ˜æµé‡æ‹¦æˆªã€‚å…ˆé€šè¿‡ sidecar ä»£ç†æ‹¦æˆªåˆ°å¾®æœåŠ¡é—´æµé‡ï¼Œå†é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ç®¡ç†å¾®æœåŠ¡çš„è¡Œä¸ºã€‚å¦‚ä»ŠæœåŠ¡ç½‘æ ¼çš„éƒ¨ç½²æ¨¡å¼ä¹Ÿè¿æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼Œsidecar å·²ç»ä¸æ˜¯ Istio æœåŠ¡ç½‘æ ¼æ‰€å¿…é¡»çš„ï¼ŒåŸºäº gRPC çš„æ— ä»£ç†çš„æœåŠ¡ç½‘æ ¼ &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt; ä¹Ÿåœ¨æµ‹è¯•ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å°†æµé‡ç®¡ç†ä» Kubernetes ä¸­è§£è€¦ï¼ŒæœåŠ¡ç½‘æ ¼å†…éƒ¨çš„æµé‡æ— é¡» &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶çš„æ”¯æŒï¼Œé€šè¿‡ç±»ä¼¼äºå¾®æœåŠ¡åº”ç”¨å±‚çš„æŠ½è±¡ï¼Œç®¡ç†æœåŠ¡é—´çš„æµé‡ï¼Œå®ç°å®‰å…¨æ€§å’Œå¯è§‚æµ‹æ€§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢é€šè¿‡ xDS åè®®å‘æ”¾ä»£ç†é…ç½®ç»™æ•°æ®å¹³é¢ï¼Œå·²å®ç° xDS çš„ä»£ç†æœ‰ &lt;a href=&#34;https://envoyproxy.io&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; å’Œèš‚èšå¼€æºçš„ &lt;a href=&#34;https://mosn.io&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡æ—¶ï¼ŒåŸå…ˆæ˜¯é€šè¿‡ Kubernetes &lt;a href=&#34;https://jimmysong.io/book/kubernetes-handbook/service-discovery/ingress/&#34; title=&#34;Ingress&#34;&gt;Ingress&lt;/a&gt;ï¼Œåœ¨æœ‰äº† Istio ä¹‹åï¼Œä¼šé€šè¿‡ Gateway æ¥è®¿é—® &lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Kubernetes å®¹å™¨ç¼–æ’ä¸å¯ç¼–ç¨‹ä»£ç† Envoy ä¸º Istio çš„å‡ºç°æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ä¸Šé¢ Kubernetes åˆ° Istio çš„æ¶æ„çš„è½¬å˜çš„æè¿°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸ºäº†è®©å¼€å‘è€…æœ€å°æˆæœ¬åœ°ç®¡ç†æœåŠ¡é—´çš„æµé‡ï¼ŒIstio éœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é€æ˜åŠ«æŒåº”ç”¨é—´çš„æµé‡&lt;/strong&gt;ï¼šIstio å¼€æºæœ€åˆçš„ç›®æ ‡æ˜¯æˆä¸ºç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œå°±åƒæ°´å’Œç”µäººç±»çš„åŸºç¡€è®¾æ–½ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨æ°´ç”µä¸éœ€è¦å…³å¿ƒå¦‚ä½•å–æ°´å’Œå‘ç”µï¼Œåªéœ€è¦æ‰“å¼€æ°´é¾™å¤´ï¼ŒæŒ‰ä¸‹å¼€å…³å³å¯ã€‚é€æ˜æµé‡åŠ«æŒå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå°±åƒä½¿ç”¨æ°´å’Œç”µï¼Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºå°±å¯ä»¥å¿«é€Ÿä½¿ç”¨ Istio å¸¦æ¥çš„æµé‡ç®¡ç†èƒ½åŠ›ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†é›†ç¾¤çš„è¿ç»´&lt;/strong&gt;ï¼šå¦‚ä½•ä¸ºæ¯ä¸ªåº”ç”¨æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼ŒåŒæ—¶é«˜æ•ˆåœ°ç®¡ç†è¿™äº›åˆ†å¸ƒå¼çš„ sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç¼–ç¨‹ä»£ç†&lt;/strong&gt;ï¼šä»£ç†å¯ä»¥é€šè¿‡ API åŠ¨æ€é…ç½®ï¼Œè¿˜è¦æœ‰å‡ºè‰²çš„æ€§èƒ½ä¸å¯æ‰©å±•æ€§ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶å¯¹äº Istio æœåŠ¡ç½‘æ ¼æ¥è¯´ç¼ºä¸€ä¸å¯ï¼Œè€Œä¸”ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›è¦æ±‚åŸºæœ¬éƒ½æ˜¯å¯¹äº sidecar ä»£ç†çš„è¦æ±‚ï¼Œè¿™ä¸ªä»£ç†çš„é€‰æ‹©å°†ç›´æ¥å½±å“è¯¥é¡¹ç›®çš„èµ°å‘ä¸æˆè´¥ã€‚ä¸ºäº†è§£å†³ä»¥ä¸Šä¸‰ä¸ªé—®é¢˜ï¼ŒIstio é€‰æ‹©äº† Kubernetes å®¹å™¨ç¼–æ’å’Œå¯ç¼–ç¨‹ä»£ç† Envoyã€‚&lt;/p&gt;
&lt;h3 id=&#34;traffic-intercept&#34;&gt;é€æ˜æµé‡åŠ«æŒ&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¦‚ gRPC è¿™ç±»ä¸­é—´ä»¶å¼€å‘å¾®æœåŠ¡ï¼Œåœ¨ç¨‹åºä¸­é›†æˆ SDK åï¼ŒSDK ä¸­çš„æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨ä¸ºä½ æ‹¦æˆªæµé‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/grpc.svg&#34; data-img=&#34;/blog/beyond-istio-oss/grpc.svg&#34; alt=&#34;image&#34; data-caption=&#34;gRPC çš„æ‹¦æˆªå™¨ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;gRPC çš„æ‹¦æˆªå™¨ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å¦‚ä½•è®© Kubernetes  pod ä¸­çš„æµé‡éƒ½é€šè¿‡ä»£ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åº pod ä¸­æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼Œä¸åº”ç”¨å…±äº«ç½‘ç»œç©ºé—´ï¼Œå†é€šè¿‡ä¿®æ”¹ pod å†…çš„æµé‡è·¯å¾„ï¼Œè®©æ‰€æœ‰è¿›å‡º pod çš„æµé‡éƒ½ç»è¿‡ sidecarï¼Œå…¶æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istio-route-iptables.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istio-route-iptables.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸€å¥—éå¸¸å¤æ‚çš„ iptables æµé‡åŠ«æŒé€»è¾‘ï¼ˆè¯¦è§ &lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; title=&#34;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&#34;&gt;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&lt;/a&gt;ï¼‰ï¼Œä½¿ç”¨ iptables çš„å¥½å¤„æ˜¯é€‚ç”¨äºä»»ä½• Linux æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯è¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›å‰¯ä½œç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Istio ç½‘æ ¼ä¸­æ‰€æœ‰çš„æœåŠ¡éƒ½éœ€è¦åœ¨è¿›å‡º pod æ—¶éƒ½å¢åŠ äº†ä¸€ä¸ªç½‘ç»œè·³è·ƒç‚¹ï¼ˆhopï¼‰ï¼Œè™½ç„¶æ¯æ¬¡ hop å¯èƒ½åªæœ‰ä¸¤ä¸‰æ¯«ç§’ï¼Œä½†æ˜¯éšç€ç½‘æ ¼ä¸­æœåŠ¡å’ŒæœåŠ¡é—´çš„ä¾èµ–å¢åŠ ï¼Œè¿™ç§å»¶è¿Ÿå¯èƒ½ä¼šæ˜¾è‘—å¢åŠ ï¼Œå¯¹äºé‚£ç§è¿½æ±‚ä½å»¶è¿Ÿçš„æœåŠ¡å¯èƒ½å°±ä¸é€‚ç”¨äºæœåŠ¡ç½‘æ ¼äº†ï¼›&lt;/li&gt;
&lt;li&gt;å› ä¸º Istio å‘æ•°æ®å¹³é¢ä¸­æ³¨å…¥äº†å¤§é‡çš„ sidecarï¼Œå°¤å…¶æ˜¯å½“æœåŠ¡æ•°é‡å¢å¤§æ—¶ï¼Œæ§åˆ¶å¹³é¢éœ€è¦ä¸‹å‘æ›´å¤šçš„ Envoy ä»£ç†é…ç½®åˆ°æ•°æ®å¹³é¢ï¼Œè¿™æ ·ä¼šä½¿æ•°æ®å¹³é¢å ç”¨å¤§é‡çš„ç³»ç»Ÿå†…å­˜å’Œç½‘ç»œèµ„æºï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¼˜åŒ–æœåŠ¡ç½‘æ ¼å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ proxyless æ¨¡å¼ï¼šå–æ¶ˆ sidecar ä»£ç†ï¼Œé‡æ–°å›åˆ° SDKï¼›&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ•°æ®å¹³é¢ï¼šå‡å°‘ä¸‹å‘åˆ°æ•°æ®å¹³é¢çš„é…ç½®çš„é¢‘ç‡å’Œå¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;eBPFï¼šä½¿ç”¨ eBPF ä¼˜åŒ–ç½‘ç»œåŠ«æŒï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡å°†åœ¨åé¢&lt;a href=&#34;#performance-optimizing&#34; title=&#34;æ€§èƒ½ä¼˜åŒ–&#34;&gt;æ€§èƒ½ä¼˜åŒ–&lt;/a&gt;ä¸€èŠ‚è®²è§£è¿™äº›ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sidecar-management&#34;&gt;Sidecar è¿ç»´ç®¡ç†&lt;/h3&gt;
&lt;p&gt;Istio æ˜¯åœ¨ Kubernetes çš„åŸºç¡€ä¸Šæ„å»ºçš„ï¼Œå®ƒå¯ä»¥åˆ©ç”¨ Kubernetes çš„å®¹å™¨ç¼–æ’å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œåœ¨ Kubernetes åˆ›å»º pod æ—¶ï¼Œé€šè¿‡å‡†å…¥æ§åˆ¶å™¨è‡ªåŠ¨å‘ pod ä¸­æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³ Sidecar çš„èµ„æºæ¶ˆè€—é—®é¢˜ï¼Œæœ‰äººä¸ºæœåŠ¡ç½‘æ ¼æå‡ºäº†æœ‰å››ç§éƒ¨ç½²æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/deployment-model.svg&#34; data-img=&#34;/blog/beyond-istio-oss/deployment-model.svg&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡ç½‘æ ¼çš„å››ç§éƒ¨ç½²æ¨¡å¼ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;æœåŠ¡ç½‘æ ¼çš„å››ç§éƒ¨ç½²æ¨¡å¼ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä¸‹è¡¨ä¸­è¯¦ç»†å¯¹æ¯”äº†è¿™å››ç§éƒ¨ç½²æ–¹å¼ï¼Œå®ƒä»¬å„æœ‰ä¼˜åŠ£ï¼Œå…·ä½“é€‰æ‹©å“ªç§æ ¹æ®å®é™…æƒ…å†µè€Œå®šã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;å†…å­˜å¼€é”€&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;æ•…éšœåŸŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;è¿ç»´&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;Sidecar ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å› ä¸ºä¸ºæ¯ä¸ª pod éƒ½æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼Œæ‰€ä»¥å¼€é”€æœ€å¤§ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç”±äº sidecar å¿…é¡»ä¸å·¥ä½œè´Ÿè½½ä¸€èµ·éƒ¨ç½²ï¼Œå·¥ä½œè´Ÿè½½æœ‰å¯èƒ½ç»•è¿‡ sidecarã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Pod çº§åˆ«éš”ç¦»ï¼Œå¦‚æœæœ‰ä»£ç†å‡ºç°æ•…éšœï¼Œåªå½±å“åˆ° Pod ä¸­çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯ä»¥å•ç‹¬å‡çº§æŸä¸ªå·¥ä½œè´Ÿè½½çš„ sidecar è€Œä¸å½±å“å…¶ä»–å·¥ä½œè´Ÿè½½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;èŠ‚ç‚¹å…±äº«ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªä»£ç†ï¼Œä¸ºè¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å·¥ä½œè´Ÿè½½æ‰€å…±äº«ï¼Œå¼€é”€å°ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯¹åŠ å¯†å†…å®¹å’Œç§é’¥çš„ç®¡ç†å­˜åœ¨å®‰å…¨éšæ‚£ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;èŠ‚ç‚¹çº§åˆ«éš”ç¦»ï¼Œå¦‚æœå…±äº«ä»£ç†å‡çº§æ—¶å‡ºç°ç‰ˆæœ¬å†²çªã€é…ç½®å†²çªæˆ–æ‰©å±•ä¸å…¼å®¹ç­‰é—®é¢˜ï¼Œåˆ™å¯èƒ½ä¼šå½±å“è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å·¥ä½œè´Ÿè½½ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¸éœ€è¦è€ƒè™‘æ³¨å…¥ Sidecar çš„é—®é¢˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;Service Account / èŠ‚ç‚¹å…±äº«ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœåŠ¡è´¦æˆ· / èº«ä»½ä¸‹çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½éƒ½ä½¿ç”¨å…±äº«ä»£ç†ï¼Œå¼€é”€å°ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å·¥ä½œè´Ÿè½½å’Œä»£ç†ä¹‹é—´çš„è¿æ¥çš„è®¤è¯åŠå®‰å…¨æ€§æ— æ³•ä¿éšœã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;èŠ‚ç‚¹å’ŒæœåŠ¡è´¦å·ä¹‹é—´çº§åˆ«éš”ç¦»ï¼Œæ•…éšœåŒâ€œèŠ‚ç‚¹å…±äº«ä»£ç†â€ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;åŒâ€œèŠ‚ç‚¹å…±äº«ä»£ç†â€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;å¸¦æœ‰å¾®ä»£ç†çš„å…±äº«è¿œç¨‹ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å› ä¸ºä¸ºæ¯ä¸ª pod éƒ½æ³¨å…¥ä¸€ä¸ªå¾®ä»£ç†ï¼Œå¼€é”€æ¯”è¾ƒå¤§ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¾®ä»£ç†ä¸“é—¨å¤„ç† mTLSï¼Œä¸è´Ÿè´£ L7 è·¯ç”±ï¼Œå¯ä»¥ä¿éšœå®‰å…¨æ€§ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å½“éœ€è¦åº”ç”¨ 7 å±‚ç­–ç•¥æ—¶ï¼Œå·¥ä½œè´Ÿè½½å®ä¾‹çš„æµé‡ä¼šè¢«é‡å®šå‘åˆ° L7 ä»£ç†ä¸Šï¼Œè‹¥ä¸éœ€è¦ï¼Œåˆ™å¯ä»¥ç›´æ¥ç»•è¿‡ã€‚è¯¥ L7 ä»£ç†å¯ä»¥é‡‡ç”¨å…±äº«èŠ‚ç‚¹ä»£ç†ã€æ¯ä¸ªæœåŠ¡è´¦æˆ·ä»£ç†ï¼Œæˆ–è€…è¿œç¨‹ä»£ç†çš„æ–¹å¼è¿è¡Œã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;åŒâ€œSidecar ä»£ç†â€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;figcaption class=&#34;text-center&#34;&gt;
    
    æœåŠ¡ç½‘æ ¼çš„å››ç§éƒ¨ç½²æ¨¡å¼å¯¹æ¯”
    
&lt;/figcaption&gt;

&lt;h3 id=&#34;programmable-proxy&#34;&gt;å¯ç¼–ç¨‹ä»£ç†&lt;/h3&gt;
&lt;p&gt;Flomesh çš„å¼ æ™“è¾‰æ›¾åœ¨ &lt;a href=&#34;https://cloudnative.to/blog/what-and-why-programmable-proxy/&#34; title=&#34;ä¸ºä»€ä¹ˆéœ€è¦å¯ç¼–ç¨‹ä»£ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦å¯ç¼–ç¨‹ä»£ç†&lt;/a&gt; åšå®¢ä¸­è¯¦ç»†è¯´æ˜äº†ä»£ç†è½¯ä»¶çš„å‘å±•æ¼”åŒ–è¿‡ç¨‹ï¼Œæˆ‘ä¸‹é¢å°†å¼•ç”¨ä»–çš„ä¸€äº›è§‚ç‚¹ï¼Œè¯´æ˜å¯ç¼–ç¨‹ä»£ç† Envoy åœ¨ Istio ä¸­çš„å…³é”®ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†ä»£ç†ä»é…ç½®åˆ°å¯ç¼–ç¨‹æ¨¡å¼çš„æ¼”åŒ–è¿‡ç¨‹ï¼ŒåŠæ¯ä¸ªé˜¶æ®µä¸­çš„ä»£è¡¨æ€§ä»£ç†è½¯ä»¶ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/proxy-evolution.svg&#34; data-img=&#34;/blog/beyond-istio-oss/proxy-evolution.svg&#34; alt=&#34;image&#34; data-caption=&#34;ä»£ç†è½¯ä»¶çš„æ¼”åŒ–ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;ä»£ç†è½¯ä»¶çš„æ¼”åŒ–ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;æ•´ä¸ªä»£ç†æ¼”åŒ–è¿‡ç¨‹éƒ½æ˜¯éšç€åº”ç”¨ä»æœ¬åœ°å’Œå•ä½“ï¼Œè¶Šæ¥è¶Šèµ°å‘å¤§è§„æ¨¡å’Œåˆ†å¸ƒå¼ã€‚ä¸‹é¢æˆ‘å°†ç®€è¦æ¦‚æ‹¬ä»£ç†è½¯ä»¶çš„å‘å±•è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶æ—¶ä»£&lt;/strong&gt;ï¼šå‡ ä¹æ‰€æœ‰è½¯ä»¶éƒ½æœ‰é…ç½®æ–‡ä»¶ï¼Œä»£ç†è½¯ä»¶å› ä¸ºå…¶ç›¸å¯¹å¤æ‚çš„åŠŸèƒ½ï¼Œæ›´ç¦»ä¸å¼€é…ç½®æ–‡ä»¶ã€‚è¯¥é˜¶æ®µçš„ä»£ç†ä¸»è¦ä½¿ç”¨ C è¯­è¨€å¼€å‘ï¼ŒåŒ…æ‹¬å…¶æ‰©å±•æ¨¡å—ï¼Œçªå‡ºçš„ä»£ç†æœ¬èº«çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨ä»£ç†æœ€åŸå§‹æœ€åŸºç¡€çš„å½¢å¼ï¼Œè¿™äº›ä»£ç†åŒ…æ‹¬ Nginxã€Apache HTTP Serverã€&lt;a href=&#34;http://www.squid-cache.org/&#34; title=&#34;Squid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Squid&lt;/a&gt; ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®è¯­è¨€æ—¶ä»£&lt;/strong&gt;ï¼šè¿™ä¸ªæ—¶ä»£çš„ä»£ç†ï¼Œæ›´å…·æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œæ¯”å¦‚åŠ¨æ€æ•°æ®è·å–å’Œé…å¥—çš„é€»è¾‘åˆ¤æ–­ã€‚ä»£è¡¨æ€§ä»£ç†åŒ…æ‹¬æ‰© &lt;a href=&#34;https://varnish-cache.org/&#34; title=&#34;Varnish&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Varnish&lt;/a&gt; å’Œ HAProxyï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è„šæœ¬è¯­è¨€æ—¶ä»£&lt;/strong&gt;ï¼šä»è„šæœ¬è¯­è¨€çš„å¼•å…¥å¼€å§‹ï¼Œä»£ç†è½¯ä»¶æ‰çœŸæ­£èµ°å‘çš„å¯ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨è„šæœ¬åœ¨ä»£ç†ä¸­å¢åŠ åŠ¨æ€é€»è¾‘ï¼Œå¢åŠ äº†å¼€å‘æ•ˆç‡ã€‚ä»£è¡¨æ€§çš„ä»£ç†æ˜¯ Nginx åŠå…¶æ”¯æŒçš„è„šæœ¬è¯­è¨€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤æ—¶ä»£&lt;/strong&gt;ï¼šéšç€äº‘è®¡ç®—çš„æ™®åŠï¼Œå¤§è§„æ¨¡éƒ¨ç½²å’ŒåŠ¨æ€é…ç½® API æˆäº†ä»£ç†æ‰€å¿…éœ€çš„èƒ½åŠ›ï¼Œè€Œä¸”éšç€ç½‘ç»œæµé‡çš„å¢åŠ ï¼Œå¤§è§„æ¨¡ä»£ç†é›†ç¾¤ä¹Ÿåº”è¿è€Œç”Ÿã€‚è¿™ä¸ªæ—¶ä»£çš„ä»£è¡¨æ€§ä»£ç†æœ‰ Envoyã€Kong ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘åŸç”Ÿæ—¶ä»£&lt;/strong&gt;ï¼šå¤šç§Ÿæˆ·ã€å¼¹æ€§ã€å¼‚æ„æ··åˆäº‘ã€å¤šé›†ç¾¤ã€å®‰å…¨å’Œå¯è§‚æµ‹ï¼Œè¿™äº›éƒ½æ˜¯äº‘åŸç”Ÿæ—¶ä»£å¯¹ä»£ç†æ‰€æå‡ºçš„æ›´é«˜è¦æ±‚ï¼Œä»£è¡¨æ€§è½¯ä»¶æœ‰ Istioã€Linkerdã€&lt;a href=&#34;https://flomesh.io/&#34; title=&#34;Pypi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pypi&lt;/a&gt;ï¼Œå®ƒä»¬éƒ½ä¸ºä»£ç†æ„å»ºäº†æ§åˆ¶å¹³é¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;are-they-service-mesh&#34;&gt;è¿™äº›éƒ½æ˜¯æœåŠ¡ç½‘æ ¼å—ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘å°†åˆ—ä¸¾ä¸€äº›æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢æœåŠ¡ç½‘æ ¼çš„å‘å±•è§„å¾‹å’Œæœ¬è´¨ã€‚ä¸‹è¡¨å¯¹æ¯”äº†å½“å‰æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›® &lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¯¹æ¯”é¡¹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Istio&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Linkerd&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Consul Connect&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Traefik Mesh&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Kuma&lt;/th&gt;
&lt;th&gt;Open Service Mesh (OSM)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å½“å‰ç‰ˆæœ¬&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.14&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;2.11&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.12&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.5&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è®¸å¯è¯&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Mozilla License&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td&gt;Apache License 2.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å‘èµ·è€…&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Googleã€IBMã€Lyft&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Buoyant&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;HashiCorp&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Traefik Labs&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kong&lt;/td&gt;
&lt;td&gt;Microsoft&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœåŠ¡ä»£ç†&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Envoyï¼Œæ”¯æŒ gRPC çš„ proxyless æ¨¡å¼&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://github.com/linkerd/linkerd2-proxy&#34; title=&#34;Linkerd2-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd2-proxy&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é»˜è®¤ä¸º &lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ï¼Œå¯æ›¿æ¢&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://traefik.io/traefik/&#34; title=&#34;Traefik Proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik Proxy&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å…¥å£æ§åˆ¶å™¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Envoyï¼Œè‡ªå®šä¹‰çš„ Ingressï¼Œæ”¯æŒ Kubernetes  Gateway API&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ— å†…ç½®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Envoyï¼Œæ”¯æŒ Kubernetes Gateway API&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ— å†…ç½®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kong&lt;/td&gt;
&lt;td&gt;æ”¯æŒ Contourã€Nginxï¼Œå…¼å®¹å…¶ä»–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ²»ç†&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Istio Community å’Œ Open Usage Commonsï¼Œå·²æè®®æçŒ®ç»™ CNCF&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;CNCF&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŸ¥çœ‹ &lt;a href=&#34;https://github.com/hashicorp/consul/blob/master/.github/CONTRIBUTING.md&#34; title=&#34;è´¡çŒ®æŒ‡å—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¡çŒ®æŒ‡å—&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŸ¥çœ‹ &lt;a href=&#34;https://github.com/traefik/mesh/blob/master/CONTRIBUTING.md&#34; title=&#34;è´¡çŒ®æŒ‡å—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¡çŒ®æŒ‡å—&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;CNCF&lt;/td&gt;
&lt;td&gt;CNCF&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;figcaption class=&#34;text-center&#34;&gt;
    
    æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®å¯¹æ¯”è¡¨
    
&lt;/figcaption&gt;

&lt;p&gt;ä¸Šè¡¨ä¸­åˆ—å‡ºçš„éƒ½æ˜¯æœåŠ¡ç½‘æ ¼ï¼Œä¸‹é¢å†ç®€å•è¯„è®ºä¸€ä¸‹è¿™äº›é¡¹ç›®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;ï¼šç›®å‰æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ä¹‹ä¸€ï¼Œåœ¨ä¸­å›½å‡ ä¹æˆä¸ºäº†æœåŠ¡ç½‘æ ¼çš„ä»£åè¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkerd.io&#34; title=&#34;Linkerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt;ï¼šæœ€æ—©å‡ºç°çš„æœåŠ¡ç½‘æ ¼ï¼Œã€ŒService Meshã€æ¦‚å¿µæå‡ºè€…ï¼Œç¬¬ä¸€ä¸ªè¿›å…¥ CNCF çš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼Œä½¿ç”¨è‡ªç ”çš„ Rust è¯­è¨€ç¼–å†™è½»é‡çº§ sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://traefik.io/traefik-mesh/&#34; title=&#34;Traefik Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik Mesh&lt;/a&gt;ï¼šç”± Traefik æ¨å‡ºçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼Œä½¿ç”¨ Treafik proxy ä½œä¸º sidecarï¼Œæ”¯æŒ SMIï¼ˆæ¥ä¸‹æ¥ä¼šæåˆ°ï¼‰ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å¯¹åº”ç”¨çš„æ— ä¾µå…¥æ€§ï¼Œä¸ä¼šåœ¨ pod ä¸­æ³¨å…¥ sidecarï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kuma.io/&#34; title=&#34;Kuma&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kuma&lt;/a&gt;ï¼šç”± Kong æ¨å‡ºçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼Œä½¿ç”¨ Envoy ä½œä¸º Sidecar ä»£ç†ï¼Œç‰¹è‰²æ˜¯ä½¿ç”¨ Kong è‡ªå®¶çš„ç½‘å…³ä½œä¸ºå…¥å£ç½‘å…³ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.consul.io/docs/connect&#34; title=&#34;Consul Connect&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul Connect&lt;/a&gt;ï¼šConsul æœåŠ¡ç½‘æ ¼ï¼Œä½¿ç”¨ Envoy ä½œä¸º sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://openservicemesh.io/&#34; title=&#34;Open Service Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Service Mesh&lt;/a&gt;ï¼šç”±å¾®è½¯å¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼Œä½¿ç”¨ Envoy ä½œä¸º sidecarï¼Œå…¼å®¹ SMIï¼ˆåŒæ ·æ˜¯å¾®è½¯æå‡ºï¼‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–è¿˜æœ‰å‡ ä¸ªé¡¹ç›®ï¼Œä¹ŸæœåŠ¡ç½‘æ ¼é¢†åŸŸä¹Ÿç»å¸¸è¢«æåŠï¼Œä½†å®ƒä»¬éƒ½ä¸æ˜¯æœåŠ¡ç½‘æ ¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://envoyproxy.io&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ï¼šEnvoy æœ¬èº«åªæ˜¯ä»£ç†ï¼Œä¹Ÿç»å¸¸è¢«ä½œä¸ºå…¶ä»–åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼çš„ sidecarï¼Œä¹Ÿç»å¸¸è¢«ç”¨æ¥æ„å»º API Gatewayï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://smp-spec.io/&#34; title=&#34;Service Mesh Performanceï¼ˆSMPï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh Performanceï¼ˆSMPï¼‰&lt;/a&gt;ï¼šæ ‡å‡†åŒ–äº†æœåŠ¡ç½‘æ ¼å€¼çš„æŒ‡æ ‡ï¼Œé€šè¿‡æ•è·åŸºç¡€è®¾æ–½å®¹é‡ã€æœåŠ¡ç½‘æ ¼é…ç½®å’Œå·¥ä½œè´Ÿè½½å…ƒæ•°æ®çš„ç»†èŠ‚æ¥æè¿°ä»»ä½•éƒ¨ç½²çš„æ€§èƒ½ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://smi-spec.io/&#34; title=&#34;Service Mesh Interfaceï¼ˆSMIï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh Interfaceï¼ˆSMIï¼‰&lt;/a&gt;ï¼šå®ƒä¸æ˜¯æœåŠ¡ç½‘æ ¼ï¼Œè€Œåªæ˜¯ä¸€å¥—æœåŠ¡ç½‘æ ¼å®ç°æ ‡å‡†ï¼Œä¸ OAMã€SPIFFEã€CNIã€CSI ç­‰ç±»ä¼¼éƒ½æ˜¯å®šä¹‰æ¥å£æ ‡å‡†ï¼Œå…·ä½“å®ç°å°±ä¸ä¸€è€Œè¶³äº†ã€‚ç›®å‰ Traefik Mesh å’Œ Open Service Mesh å£°æ˜æ”¯æŒè¯¥è§„èŒƒï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://networkservicemesh.io/&#34; title=&#34;Network Service Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Network Service Mesh&lt;/a&gt;ï¼šæœ‰å¿…è¦æä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œå› ä¸ºç»å¸¸æœ‰äººæŠŠå®ƒé”™è®¤ä¸ºæ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ã€‚å®é™…ä¸Šï¼Œå®ƒé¢å‘çš„æ˜¯ä¸‰å±‚ç½‘ç»œï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ä¸æ›´æ¢ CNI æ’ä»¶çš„å‰æä¸‹ï¼Œè¿æ¥å¤šäº‘/æ··åˆäº‘ã€‚å®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€å®šä¹‰çš„ã€ŒæœåŠ¡ç½‘æ ¼ã€ï¼Œè€Œæ˜¯æœåŠ¡ç½‘æ ¼çš„ä¸€ä¸ªæœ‰åŠ›è¡¥å……ï¼ˆè™½ç„¶åå­—é‡Œå¸¦æœ‰æœåŠ¡ç½‘æ ¼æ¯”è¾ƒæœ‰è¿·æƒ‘æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çºµè§‚ä»¥ä¸Šé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¤§éƒ¨åˆ†æœåŠ¡ç½‘æ ¼é¡¹ç›®çš„å‘èµ·è€…éƒ½æ˜¯æ ¹æ®ä»£ç†èµ·å®¶ï¼Œç„¶ååšæ§åˆ¶å¹³é¢ã€‚è€Œä¸” Istioã€Consul Connectã€Open Service Meshã€Kuma éƒ½æ˜¯ä½¿ç”¨ Envoy ä½œä¸º sidecar ä»£ç†ã€‚åªæœ‰ Linkerd å’Œ Traefik Mesh æ¨å‡ºäº†è‡ªå·±çš„ä»£ç†ã€‚è€Œæ‰€æœ‰çš„æœåŠ¡ç½‘æ ¼é¡¹ç›®éƒ½æ”¯æŒ sidecar æ¨¡å¼ã€‚é™¤äº† Istioã€Linkerdã€Consul Connect å·²åº”ç”¨äºç”Ÿäº§ä¸Šï¼Œå…¶ä»–æœåŠ¡ç½‘æ ¼é¡¹ç›®è¿˜æ²¡æœ‰çœ‹åˆ°è¢«å¤§è§„æ¨¡åœ¨ç”Ÿäº§ä¸Šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;performance-optimizing&#34;&gt;Istio çš„æ€§èƒ½ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio 1.5 ç‰ˆæœ¬ç¡®å®šäº†ç¨³å®šçš„æ¶æ„ä¹‹åï¼Œç¤¾åŒºçš„ä¸»è¦ç²¾åŠ›åœ¨äºä¼˜åŒ– Istio çš„æ€§èƒ½ã€‚ä¸‹é¢æˆ‘å°†å‘ä½ è¯¦ç»†ä»‹ç» Istio ä¸­çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨ Proxyless æ¨¡å¼ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ eBPF ä¼˜åŒ–æµé‡åŠ«æŒï¼›&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®å¹³é¢æ€§èƒ½ä¼˜åŒ–ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;proxyless-pattern&#34;&gt;Proxyless æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;Proxyless æ¨¡å¼æ˜¯ Istio åœ¨ 1.11 ç‰ˆæœ¬ä¸­æå‡ºçš„å®éªŒç‰¹æ€§ â€”â€” &lt;a href=&#34;https://cloudnative.to/blog/grpc-proxyless-service-mesh/&#34; title=&#34;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&lt;/a&gt;ã€‚ä½¿ç”¨è¯¥æ¨¡å¼å¯ä»¥ç›´æ¥å°† gRPC æœåŠ¡æ·»åŠ åˆ° Istio ä¸­ï¼Œè€Œä¸éœ€è¦å†å‘ Pod ä¸­æ³¨å…¥ Envoy ä»£ç†ã€‚ä¸‹å›¾å±•ç¤ºäº† sidecar æ¨¡å¼ä¸ proxyless æ¨¡å¼çš„å¯¹æ¯”å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/sidecar-to-proxyless.svg&#34; data-img=&#34;/blog/beyond-istio-oss/sidecar-to-proxyless.svg&#34; alt=&#34;image&#34; data-caption=&#34;Sidecar æ¨¡å¼ vs Proxyless æ¨¡å¼&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Sidecar æ¨¡å¼ vs Proxyless æ¨¡å¼&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ proxyless æ¨¡å¼ä¸ä½¿ç”¨ proxy è¿›è¡Œæ•°æ®å¹³é¢é€šä¿¡ï¼Œä½†ä»ç„¶éœ€è¦ä¸€ä¸ª agentï¼ˆå³ &lt;code&gt;pilot-agent&lt;/code&gt;ï¼‰æ¥è¿›è¡Œåˆå§‹åŒ–å’Œä¸æ§åˆ¶å¹³é¢çš„é€šä¿¡ã€‚é¦–å…ˆï¼Œagent åœ¨å¯åŠ¨æ—¶ç”Ÿæˆä¸€ä¸ª&lt;a href=&#34;https://github.com/grpc/proposal/blob/master/A27-xds-global-load-balancing.md#xdsclient-and-bootstrap-file&#34; title=&#34;å¼•å¯¼æ–‡ä»¶&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼•å¯¼æ–‡ä»¶&lt;/a&gt;ï¼Œä¸ä¸º Envoy ç”Ÿæˆå¼•å¯¼æ–‡ä»¶çš„æ–¹å¼ç›¸åŒã€‚è¿™å‘Šè¯‰ gRPC åº“å¦‚ä½•è¿æ¥åˆ° &lt;code&gt;istiod&lt;/code&gt;ï¼Œåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°ç”¨äºæ•°æ®å¹³é¢é€šä¿¡çš„è¯ä¹¦ï¼Œå‘æ§åˆ¶å¹³é¢å‘é€ä»€ä¹ˆå…ƒæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œagent ä½œä¸º xDS proxyï¼Œä»£è¡¨åº”ç”¨ç¨‹åºä¸ &lt;code&gt;istiod&lt;/code&gt; è¿›è¡Œè¿æ¥å’Œè®¤è¯ã€‚æœ€åï¼Œagent è·å–å¹¶è½®æ¢æ•°æ®å¹³é¢é€šä¿¡ä¸­ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¿™å…¶å®ä¸ Sidecar æ¨¡å¼çš„æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å°† Envoy ä»£ç†çš„åŠŸèƒ½å†…ç½®åˆ° SDK ä¸­äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;æœåŠ¡ç½‘æ ¼çš„æœ¬è´¨ä¸æ˜¯ Sidecar æ¨¡å¼ï¼Œä¹Ÿä¸æ˜¯é…ç½®ä¸­å¿ƒæˆ–é€æ˜æµé‡æ‹¦æˆªï¼Œè€Œæ˜¯æ ‡å‡†åŒ–çš„æœåŠ¡é—´é€šä¿¡æ ‡å‡†ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰äººè¯´ proxyless æ¨¡å¼åˆå›åˆ°äº†åŸºäº SDK å¼€å‘å¾®æœåŠ¡çš„è€è·¯ï¼ŒæœåŠ¡ç½‘æ ¼çš„ä¼˜åŠ¿ä¸§å¤±æ®†å°½ï¼Œé‚£è¿˜èƒ½å«åšæœåŠ¡ç½‘æ ¼å— &lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;ï¼Ÿå…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§å¯¹æ€§èƒ½çš„å¦¥å â€”â€” å¦‚æœä½ ä¸»è¦ä½¿ç”¨ gRPC æ¥å¼€å‘å¾®æœåŠ¡çš„è¯ï¼Œåªéœ€è¦ç»´æŠ¤ä¸åŒè¯­è¨€çš„ gRPC ç‰ˆæœ¬ï¼Œå³å¯ä»¥é€šè¿‡æ§åˆ¶å¹³é¢æ¥ç®¡ç†å¾®æœåŠ¡äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Envoy xDS å·²ç»æˆä¸ºæœåŠ¡ç½‘æ ¼ä¸­æœåŠ¡é—´é€šä¿¡çš„äº‹å®æ ‡å‡†ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ebpf&#34;&gt;ä½¿ç”¨ eBPF ä¼˜åŒ–æµé‡åŠ«æŒ&lt;/h3&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;#traffic-intercept&#34; title=&#34;é€æ˜æµé‡åŠ«æŒ&#34;&gt;é€æ˜æµé‡åŠ«æŒ&lt;/a&gt;ä¸€èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœåŠ¡é—´çš„æµé‡åœ¨åˆ°è¾¾ç›®çš„åœ° pod æ—¶ç»è¿‡çš„ iptables è§„åˆ™å’Œè·¯å¾„ï¼Œå…¶ä¸­éœ€è¦ç»è¿‡å¤šæ¡ iptables è§„åˆ™ï¼Œå¦‚ &lt;code&gt;PREROUTING&lt;/code&gt;ã€&lt;code&gt;ISTIO_INBOUND&lt;/code&gt;ã€&lt;code&gt;ISTIO_IN_REDIRECT&lt;/code&gt;ã€&lt;code&gt;OUTPUT&lt;/code&gt;ã€&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt;ã€&lt;code&gt;POSTROUTING&lt;/code&gt; ç­‰ã€‚å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæœåŠ¡ A æƒ³è¦è°ƒç”¨éæœ¬åœ°ä¸»æœºä¸Šçš„å¦ä¸€ä¸ª pod ä¸­çš„æœåŠ¡ Bï¼Œç»è¿‡çš„ç½‘ç»œå †æ ˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/iptables-process.svg&#34; data-img=&#34;/blog/beyond-istio-oss/iptables-process.svg&#34; alt=&#34;image&#34; data-caption=&#34;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆiptables æ¨¡å¼ï¼‰&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆiptables æ¨¡å¼ï¼‰&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªè°ƒç”¨æµç¨‹ä¸­ç»è¿‡å››æ¬¡ iptablesï¼Œå…¶ä¸­ Pod A ä¸­çš„ä» Envoy çš„å‡ºç«™ï¼ˆiptables2ï¼‰å’Œ Pod B ä¸­çš„ä» eth0 çš„å…¥ç«™ï¼ˆiptables3ï¼‰çš„ iptables è·¯ç”±æ˜¯æ— æ³•é¿å…çš„ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ä¸¤ä¸ª iptables1 å’Œ iptables4 æ˜¯å¦å¯ä»¥ä¼˜åŒ–å‘¢ï¼Ÿè®©ä¸¤ä¸ª socket ç›´æ¥é€šä¿¡ï¼Œä¸å°±å¯ä»¥ç¼©çŸ­ç½‘ç»œè·¯å¾„äº†å—ï¼Ÿè¿™å°±éœ€è¦é€šè¿‡ eBPF ç¼–ç¨‹ï¼Œä½¿å¾—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Service A çš„æµé‡ä»ç›´æ¥å‘é€åˆ° Envoy çš„ Inbound socket ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;Pod B ä¸­ Envoy æ¥æ”¶åˆ°å…¥ç«™æµé‡åï¼Œå·²ç»ç¡®å®šæµé‡æ˜¯è¦å‘é€ç»™æœ¬åœ°çš„æœåŠ¡ï¼Œç›´æ¥å¯¹æ¥ Outbound socket ä¸ Service Bï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ eBPF æ¨¡å¼çš„é€æ˜æµé‡æ‹¦æˆªç½‘ç»œè·¯å¾„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/ebpf-diff-node.svg&#34; data-img=&#34;/blog/beyond-istio-oss/ebpf-diff-node.svg&#34; alt=&#34;image&#34; data-caption=&#34;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å¦‚æœè¦è®¿é—®çš„æœåŠ¡ A å’ŒæœåŠ¡ B åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆç½‘ç»œè·¯å¾„å°†æ›´çŸ­ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/ebpf-same-node.svg&#34; data-img=&#34;/blog/beyond-istio-oss/ebpf-same-node.svg&#34; alt=&#34;image&#34; data-caption=&#34;åŒä¸»æœº Pod é—´çš„ç½‘ç»œè®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŒä¸»æœº Pod é—´çš„ç½‘ç»œè®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„æœåŠ¡é—´è®¿é—®å®Œå…¨ç»•è¿‡äº† TCP/IP å †æ ˆï¼Œå˜æˆäº† socket é—´çš„ç›´æ¥è®¿é—®ã€‚&lt;/p&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    ä»€ä¹ˆæ˜¯ eBPFï¼Ÿ
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;p&gt;æˆ‘ä»¬çŸ¥é“ä¿®æ”¹ Linux å†…æ ¸ä»£ç å¾ˆéš¾ï¼Œæ–°ç‰¹æ€§å‘å¸ƒåˆ°å†…æ ¸ä¸­éœ€è¦å¾ˆé•¿çš„å‘¨æœŸã€‚eBPF æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸å†…åŠ è½½å’Œè¿è¡Œè‡ªå®šä¹‰ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº† eBPFï¼Œä½ ä¸éœ€è¦ç›´æ¥ä¿®æ”¹å†…æ ¸ï¼Œå°±å¯ä»¥æ‰©å±•å’Œæ”¹å˜å†…æ ¸çš„è¡Œä¸ºã€‚ä¸‹é¢æˆ‘å°†ç®€è¦çš„ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹ eBPFï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;eBPF ç¨‹åºåŠ è½½åˆ°å†…æ ¸ä¸­åéœ€è¦é€šè¿‡éªŒè¯å™¨çš„éªŒè¯æ‰å¯ä»¥è¿è¡Œï¼ŒéªŒè¯å™¨å¯ä»¥é˜²æ­¢ eBPF ç¨‹åºè¶…è¶Šæƒé™çš„è®¿é—®ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å†…æ ¸çš„å®‰å…¨ï¼›&lt;/li&gt;
&lt;li&gt;eBPF ç¨‹åºæ˜¯é™„ç€äºå†…æ ¸äº‹ä»¶ä¸Šçš„ï¼Œå½“æœ‰è¿›å…¥æˆ–é€€å‡ºå†…æ ¸å‡½æ•°æ—¶è¢«è§¦å‘ï¼›&lt;/li&gt;
&lt;li&gt;å†…æ ¸ç©ºé—´çš„ eBPF ç¨‹åºå¿…é¡»ä½¿ç”¨èƒ½å¤Ÿæ”¯æŒç”Ÿæˆ eBPF å­—èŠ‚ç æ ¼å¼çš„ç¼–è¯‘å™¨çš„è¯­è¨€ç¼–å†™ï¼Œç›®å‰ä½ å¯ä»¥ç”¨ C å’Œ Rust è¯­è¨€ç¼–å†™ eBPF ç¨‹åºï¼›&lt;/li&gt;
&lt;li&gt;eBPF ç¨‹åºå¯¹äºä¸åŒçš„ Linux ç‰ˆæœ¬å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äº eBPF ç¨‹åºå¯ä»¥ç›´æ¥ç›‘å¬å’Œæ“ä½œ Linux å†…æ ¸ï¼Œå…·æœ‰å¯¹ç³»ç»Ÿæœ€åº•å±‚çš„é€è§†ï¼Œå°±å¯ä»¥åœ¨æµé‡ç®¡ç†ã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨å‘æŒ¥ä½œç”¨ã€‚æœ‰å…³ eBPF çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒç¬”è€…ç¿»è¯‘çš„&lt;a href=&#34;https://jimmysong.io/book/what-is-ebpf/&#34; title=&#34;ã€Šä»€ä¹ˆæ˜¯ eBPFã€‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€Šä»€ä¹ˆæ˜¯ eBPFã€‹&lt;/a&gt;ç”µå­ä¹¦ã€‚&lt;/p&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;å¼€æºé¡¹ç›® &lt;a href=&#34;https://github.com/merbridge/merbridge&#34; title=&#34;Merbridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge&lt;/a&gt; æ­£æ˜¯åˆ©ç”¨ eBPF ç¼©çŸ­äº†é€æ˜æµé‡åŠ«æŒçš„è·¯å¾„ï¼Œä¼˜åŒ–äº†æœåŠ¡ç½‘æ ¼çš„æ€§èƒ½ã€‚å…³äº Merbridge å®ç°çš„ä¸€äº›ç»†èŠ‚ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/zh/blog/2022/merbridge/&#34; title=&#34;Istio åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;



&lt;div class=&#34;alert alert-warning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warning-title px-2 py-2&#34;&gt;
    æ³¨æ„
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warning px-2&#34;&gt;
    Merbridge ä½¿ç”¨çš„ eBPF å‡½æ•°éœ€è¦ Linux å†…æ ¸ç‰ˆæœ¬ â‰¥ 5.7ã€‚
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;ä¹çœ‹ä¸Šå» eBPF ä¼¼ä¹ä»æ›´åº•å±‚å®ç°äº† Istio çš„åŠŸèƒ½ï¼Œæ›´å¤§æœ‰å–ä»£ sidecar çš„è¶‹åŠ¿ã€‚ä½†æ˜¯ eBPF ä¹Ÿå­˜åœ¨å¾ˆå¤šå±€é™æ€§ï¼Œå¯¼è‡´åœ¨å¯ä»¥é¢„è§çš„æœªæ¥æ— æ³•å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecarã€‚å¦‚æœå–æ¶ˆ sidecar è½¬è€Œä½¿ç”¨æ¯ä¸ªä¸»æœºä¸€ä¸ªä»£ç†çš„æ¨¡å¼ï¼Œä¼šå¯¼è‡´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»£ç†å¤±è´¥çš„çˆ†ç‚¸åŠå¾„æ‰©å¤§åˆ°æ•´ä¸ªèŠ‚ç‚¹ï¼Œå³ä¸€ä¸ªä»£ç†å¤±è´¥äº†ï¼Œä»£ç†æ‰€åœ¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å·¥ä½œè´Ÿè½½éƒ½ä¼šå—åˆ°å½±å“ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿å¾—å®‰å…¨é—®é¢˜æ›´åŠ å¤æ‚ï¼Œå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¿å­˜åœ¨å¤ªå¤šè´Ÿè½½çš„è¯ä¹¦ï¼Œä¸€æ—¦è¢«æ”»å‡»ï¼Œä¼šå­˜åœ¨ç§˜é’¥æ³„éœ²çš„é£é™©ï¼›&lt;/li&gt;
&lt;li&gt;ä¸»æœºä¸Šçš„ Pod ä¹‹é—´çš„æµé‡äº‰æŠ¢é—®é¢˜ï¼Œå³èŠ‚ç‚¹ä¸Šå¦‚æœæœ‰ä¸€ä¸ªå·¥ä½œè´Ÿè½½æ¶ˆè€—æ‰ä»£ç†çš„æ‰€æœ‰èµ„æºï¼Œå…¶ä»–å·¥ä½œè´Ÿè½½å°†æ— æ³•è·å¾—æµé‡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œä¸” eBPF ä¸»è¦è´Ÿè´£ä¸‰/å››å±‚æµé‡ï¼Œå¯ä»¥ä¸ CNI ä¸€èµ·è¿è¡Œï¼Œä½†æ˜¯ä¸ƒå±‚æµé‡ä½¿ç”¨ eBPF æ¥å¤„ç†å°±ä¸å¤ªåˆé€‚äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;åœ¨å¯ä»¥é¢„è§çš„æœªæ¥ eBPF æŠ€æœ¯æ— æ³•å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecarã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…³äº eBPF ä¸æœåŠ¡ç½‘æ ¼çš„å…³ç³»çš„æ›´è¯¦ç»†ä»‹ç»è¯·å‚è€ƒåšå®¢&lt;a href=&#34;https://jimmysong.io/blog/ebpf-sidecar-and-service-mesh/&#34; title=&#34;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecar æ¨¡å¼çš„å¹»æƒ³&#34;&gt;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecar æ¨¡å¼çš„å¹»æƒ³&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;control-plane-perf-optimizing&#34;&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šä¸¤ç§ä¼˜åŒ–éƒ½æ˜¯é’ˆå¯¹æ•°æ®å¹³é¢è¿›è¡Œçš„ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹æ§åˆ¶å¹³é¢çš„æ€§èƒ½ä¼˜åŒ–ã€‚ä½ å¯ä»¥æŠŠæœåŠ¡ç½‘æ ¼æƒ³è±¡æˆæ˜¯ä¸€åœºæ¼”å‡ºï¼Œæ§åˆ¶å¹³é¢æ˜¯æ€»å¯¼æ¼”ï¼Œæ•°æ®å¹³é¢æ˜¯æ‰€æœ‰æ¼”å‘˜ï¼Œå¯¼æ¼”ä¸å‚ä¸æ¼”å‡ºï¼Œä½†æ˜¯è´Ÿè´£æŒ‡æŒ¥æ¼”å‘˜ã€‚å¦‚æœè¿™åœºæ¼”å‡ºçš„æƒ…èŠ‚å¾ˆç®€å•ï¼Œæ—¶é•¿åˆå¾ˆçŸ­ï¼Œé‚£è¦æ¯ä¸ªæ¼”å‘˜åˆ†é…çš„æˆä»½å°±ä¼šå¾ˆå°‘ï¼Œæ’ç»ƒèµ·æ¥å°±ä¼šå¾ˆå®¹æ˜“ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå¤§å‹æ¼”å‡ºï¼Œæ¼”å‘˜çš„æ•°é‡å¤šï¼Œæƒ…èŠ‚æœ‰å¾ˆå¤æ‚ï¼Œè¦æƒ³æ’ç»ƒå¥½è¿™åœºæ¼”å‡ºï¼Œä¸€ä¸ªå¯¼æ¼”å¯èƒ½æ˜¯ä¸å¤Ÿçš„ï¼Œä»–æŒ‡æŒ¥ä¸äº†è¿™ä¹ˆå¤šæ¼”å‘˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¤šåå‰¯å¯¼æ¼”ï¼ˆæ‰©å¤§æ§åˆ¶å¹³é¢å®ä¾‹æ•°é‡ï¼‰ï¼›æˆ‘ä»¬è¿˜éœ€è¦ç»™æ¼”å‘˜å‡†å¤‡å¥½å°è¯å’Œè„šæœ¬ï¼Œå¦‚æœæ¼”å‘˜ä¹Ÿå¯ä»¥ä¸€ä¸ªé•œå¤´å®Œæˆä¸€è¿ä¸²çš„å°è¯å’Œåœºæ™¯çš„è¡¨æ¼”ï¼ˆå‡å°‘éƒ½æ•°æ®å¹³é¢çš„æ‰“æ‰°ï¼Œæ‰¹é‡æ¨é€æ›´æ–°ï¼‰ï¼Œé‚£æˆ‘ä»¬çš„æ’ç»ƒæ˜¯ä¸æ˜¯æ›´åŠ é«˜æ•ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ç±»æ¯”ä¸­ï¼Œä½ åº”è¯¥å¯ä»¥æ‰¾åˆ°æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘äº†ï¼Œé‚£å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘éœ€è¦æ¨é€çš„é…ç½®å¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;æ‰¹å¤„ç†ä»£ç†æ¨é€ï¼›&lt;/li&gt;
&lt;li&gt;æ‰©å¤§æ§åˆ¶å¹³é¢è§„æ¨¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;reduce-config-size&#34;&gt;å‡å°‘éœ€è¦æ¨é€çš„é…ç½®&lt;/h4&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯å‡å°‘è¦å‘æ•°æ®å¹³é¢æ¨é€çš„ä»£ç†é…ç½®å¤§å°ã€‚å‡è®¾æœ‰å·¥ä½œè´Ÿè½½ Aï¼Œå¦‚æœä»…å°†ä¸ A ç›¸å…³çš„ä»£ç†é…ç½®ï¼ˆå³ A ä¾èµ–çš„æœåŠ¡ï¼‰æ¨é€ç»™ Aï¼Œè€Œä¸æ˜¯å°†ç½‘æ ¼å†…æ‰€æœ‰æœåŠ¡çš„é…ç½®éƒ½æ¨é€ç»™ Aï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§å‹ç¼©è¦æ¨é€çš„å·¥ä½œè´Ÿè½½èŒƒå›´åŠé…ç½®å¤§å°ã€‚Istio ä¸­çš„ Sidecar èµ„æºå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç‚¹ã€‚ä¸‹é¢æ˜¯ Sidecar é…ç½®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Sidecar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cn-bj&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;app-a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;cn-bj/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é€šè¿‡ &lt;code&gt;workloadSelector&lt;/code&gt; å­—æ®µå¯ä»¥é™åˆ¶è¯¥ Sidecar é…ç½®é€‚ç”¨çš„å·¥ä½œè´Ÿè½½èŒƒå›´ï¼Œè€Œ &lt;code&gt;egress&lt;/code&gt; å­—æ®µå¯ä»¥ç¡®å®šè¯¥å·¥ä½œè´Ÿè½½ä¾èµ–çš„æœåŠ¡èŒƒå›´ï¼Œè¿™æ ·æ§åˆ¶å¹³é¢å°±å¯ä»¥ä»…å‘æœåŠ¡ A æ¨é€å…¶ä¾èµ–çš„æœåŠ¡é…ç½®ï¼Œå¤§å¤§å‡ä½è¦å‘æ•°æ®å¹³é¢æ¨é€çš„é…ç½®å¤§å°ï¼Œå‡å°‘äº†æœåŠ¡ç½‘æ ¼çš„å†…å­˜å’Œç½‘ç»œæ¶ˆè€—ã€‚&lt;/p&gt;
&lt;h4 id=&#34;batch-push-conf&#34;&gt;æ‰¹å¤„ç†ä»£ç†é…ç½®æ¨é€&lt;/h4&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢ Istiod å‘æ•°æ®å¹³é¢æ¨é€ä»£ç†é…ç½®çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¸‹å›¾å±•ç¤ºäº†å…¶ä¸­çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istiod-push.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istiod-push.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istiod å‘æ•°æ®å¹³é¢æ¨é€ä»£ç†é…ç½®çš„æµç¨‹å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Istiod å‘æ•°æ®å¹³é¢æ¨é€ä»£ç†é…ç½®çš„æµç¨‹å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ç®¡ç†å‘˜é…ç½® Istio ç½‘æ ¼åï¼ŒIstiod ä¸­æ¨é€ä»£ç†é…ç½®çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®¡ç†å‘˜æ›´æ–° Istio é…ç½®çš„äº‹ä»¶ä¼šè§¦å‘æ•°æ®å¹³é¢ä»£ç†çš„é…ç½®åŒæ­¥ï¼›&lt;/li&gt;
&lt;li&gt;Istio çš„ &lt;code&gt;DiscoveryServer&lt;/code&gt; ç»„ä»¶ç›‘å¬åˆ°è¿™äº›äº‹ä»¶åä¸ä¼šç«‹å³å°†é…ç½®æ¨é€åˆ°æ•°æ®å¹³é¢ï¼Œè€Œæ˜¯å°†è¿™äº›äº‹ä»¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ŒæŒç»­åˆå¹¶ä¸€æ®µæ—¶é—´å†…çš„äº‹ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå»æŠ–åŠ¨ï¼ˆdebouncingï¼‰ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢é¢‘ç¹çš„æ›´æ–°æ•°æ®å¹³é¢é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨å»æŠ–åŠ¨å‘¨æœŸè¿‡åï¼Œè¿™äº›äº‹ä»¶å°†è¢«æ¨é€åˆ°é˜Ÿåˆ—ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istiod ä¼šé™åˆ¶åŒæ—¶æ¨é€çš„è¯·æ±‚æ•°é‡ï¼Œä»¥åŠ å¿«æ¨é€è¿›åº¦ï¼›&lt;/li&gt;
&lt;li&gt;äº‹ä»¶è¢«è½¬æ¢æˆ Envoy çš„é…ç½®æ¨é€åˆ°æ•°æ®å¹³é¢çš„å·¥ä½œè´Ÿè½½ä¸Šï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»ä»¥ä¸Šæµç¨‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¼˜åŒ–é…ç½®æ¨é€çš„å…³é”®å°±æ˜¯æ­¥éª¤ 2 ä¸­å»æŠ–åŠ¨å‘¨æœŸå’Œæ­¥éª¤ 4 ä¸­çš„é™æµè®¾ç½®ã€‚æœ‰è¿™æ ·å‡ ä¸ªç¯å¢ƒå˜é‡å¯ä»¥å¸®åŠ©ä½ è®¾ç½®æ§åˆ¶å¹³é¢çš„æ¨é€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PILOT_DEBOUNCE_AFTER&lt;/code&gt;ï¼šæŒ‡å®šå»æŠ–åŠ¨çš„æ—¶é—´ï¼Œå°†äº‹ä»¶æ·»åŠ åˆ°æ¨é€é˜Ÿåˆ—ä¸­ï¼Œé»˜è®¤ä¸º 100 æ¯«ç§’ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PILOT_DEBOUNCE_MAX&lt;/code&gt;ï¼šæŒ‡å®šå…è®¸äº‹ä»¶å»æŠ–åŠ¨çš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…äº‹ä»¶æ²¡æœ‰æ–°çš„å˜åŒ–åˆ™æ¨é€äº‹ä»¶ï¼Œé»˜è®¤ä¸º 10 ç§’ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PILOT_ENABLE_EDS_DEBOUNCE&lt;/code&gt;ï¼šæŒ‡å®šç«¯ç‚¹æ›´æ–°æ˜¯å¦ç¬¦åˆå»æŠ–åŠ¨è§„åˆ™æˆ–å…·æœ‰ä¼˜å…ˆæƒå¹¶ç«‹å³è½å…¥æ¨é€é˜Ÿåˆ—ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå…³é—­å®ƒåå¯ä»¥åŠ é€Ÿ EDS æ¨é€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PILOT_PUSH_THROTTLE&lt;/code&gt;ï¼šæŒ‡å®šåŒæ—¶å¤„ç†çš„æ¨é€è¯·æ±‚ï¼Œé»˜è®¤æ˜¯ 100ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºè¿™äº›ç¯å¢ƒå˜é‡çš„é»˜è®¤å€¼å’Œå…·ä½“é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/reference/commands/pilot-agent/#envvars&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å€¼ç©¶ç«Ÿå¦‚ä½•è®¾ç½®ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ§åˆ¶å¹³é¢èµ„æºç©ºé—²ï¼Œä¸ºäº†åŠ å¿«é…ç½®æ›´æ–°çš„ä¼ æ’­é€Ÿåº¦ï¼Œä½ å¯ä»¥ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼©çŸ­å»æŠ–åŠ¨å‘¨æœŸï¼Œå¢åŠ æ¨é€æ¬¡æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å¢åŠ åŒæ—¶å¤„ç†çš„æ¨é€è¯·æ±‚æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœæ§åˆ¶å¹³é¢é¥±å’Œï¼Œä¸ºäº†é™ä½æ€§èƒ½ç“¶é¢ˆï¼Œä½ å¯ä»¥ï¼š
&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿå»æŠ–åŠ¨å‘¨æœŸï¼Œå‡å°‘æ¨é€æ¬¡æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å¢åŠ åŒæ—¶å¤„ç†çš„æ¨é€è¯·æ±‚çš„æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡³äºå¦‚ä½•è®¾ç½®æœ€ä¼˜è§£ï¼Œéœ€è¦ç»“åˆä½ çš„å¯è§‚æµ‹ç³»ç»Ÿæ¥è°ƒè¯•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;scale-up-control-plane&#34;&gt;æ‰©å¤§æ§åˆ¶å¹³é¢è§„æ¨¡&lt;/h4&gt;
&lt;p&gt;å¦‚æœè®¾ç½®å»æŠ–åŠ¨æ‰¹å¤„ç†å’Œ Sidecar è¿˜æ— æ³•ä¼˜åŒ–æ§åˆ¶å¹³é¢æ€§èƒ½çš„è¯ï¼Œæœ€åçš„é€‰æ‹©å°±æ˜¯æ‰©å¤§æ§åˆ¶å¹³é¢çš„è§„æ¨¡ï¼ŒåŒ…æ‹¬æ‰©å¤§å•ä¸ª Istiod å®ä¾‹çš„èµ„æºå’Œå¢åŠ  Istiod çš„å®ä¾‹ä¸ªæ•°ï¼Œç©¶ç«Ÿé‡‡ç”¨å“ªç§æ‰©å±•æ–¹å¼è§†æƒ…å†µè€Œå®šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å•ä¸ª Istiod çš„èµ„æºå ç”¨é¥±å’Œæ—¶ï¼Œä¼˜å…ˆæ¨èä½ æ‰©å¤§ Istiod çš„å®ä¾‹å¤§å°ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºæœåŠ¡ç½‘æ ¼ä¸­æœ‰å¤ªå¤šçš„èµ„æºï¼ˆIstio çš„è‡ªå®šä¹‰èµ„æºï¼Œå¦‚ VirtualServiceã€DestinationRule ç­‰ï¼‰éœ€è¦å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå¢åŠ  Istiod å®ä¾‹çš„ CPU å’Œå†…å­˜ä¾ç„¶ä¸èµ·æ•ˆçš„è¯ï¼Œå¢åŠ  Istiod çš„å®ä¾‹ä¸ªæ•°ï¼Œè¿™æ ·å¯ä»¥åˆ†æ•£å•ä¸ªå®ä¾‹è¦ç®¡ç†çš„å·¥ä½œè´Ÿè½½æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;data-plane-performance&#34;&gt;æ•°æ®å¹³é¢æ€§èƒ½ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;Apache SkyWalking å¯ä»¥ä½œä¸º Istio æä¾›å¯è§‚æµ‹æ€§å·¥å…·ï¼Œè¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨è¿›è¡ŒæœåŠ¡åŠ¨æ€è°ƒè¯•å’Œæ•…éšœæ’é™¤å‰–ææœåŠ¡çš„æ€§èƒ½ï¼Œå…¶æœ€æ–°æ¨å‡ºçš„ &lt;a href=&#34;https://github.com/apache/skywalking-rover&#34; title=&#34;Apache SkyWalking Rover&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache SkyWalking Rover&lt;/a&gt; ç»„ä»¶å¯ä»¥åˆ©ç”¨ eBPF æŠ€æœ¯æ¥å‡†ç¡®å®šä½ Istio çš„å…³é”®æ€§èƒ½é—®é¢˜ &lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt;ã€‚åœ¨æ•°æ®å¹³é¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å¢åŠ  Envoy çš„ååé‡ä»¥ä¼˜åŒ– Istio çš„æ€§èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¦ç”¨ Zipkin è¿½è¸ªæˆ–å‡å°‘é‡‡æ ·ç‡&lt;/li&gt;
&lt;li&gt;ç®€åŒ–è®¿é—®æ—¥å¿—æ ¼å¼&lt;/li&gt;
&lt;li&gt;ç¦ç”¨ Envoy çš„è®¿é—®æ—¥å¿—æœåŠ¡ï¼ˆALSï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šä¼˜åŒ–æ–¹å¼å¯¹ Envoy ååé‡çš„å½±å“æ•°æ®è¯·å‚é˜… &lt;a href=&#34;https://cloudnative.to/blog/pinpoint-service-mesh-critical-performance-impact-by-using-ebpf/#introducing-skywalking-rover&#34; title=&#34;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;starring-envoy&#34;&gt;Envoy â€”â€” æœåŠ¡ç½‘æ ¼çš„é¢†è¡”ä¸»æ¼”&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“æœåŠ¡ç½‘æ ¼æ˜¯ç”±æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ç»„æˆçš„ï¼Œä»ä¸Šé¢çš„æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®åˆ—è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäº Envoyï¼Œç„¶åå¼€å‘è‡ªå·±çš„æ§åˆ¶å¹³é¢ã€‚è¿˜è®°å¾—æˆ‘åœ¨æœ¬æ–‡å‰é¢å°†æœåŠ¡ç½‘æ ¼æ¯”ä½œæ¼”å‡ºå—ï¼Ÿåœ¨è¿™åœºæœåŠ¡ç½‘æ ¼çš„æ¼”å‡ºä¸­ï¼Œæ¯«æ— ç–‘é—® Envoy å°±æ˜¯é¢†è¡”ä¸»æ¼” â€”â€” Envoy å‘æ˜çš„ xDS åè®®ï¼ŒåŸºæœ¬æˆä¸ºæœåŠ¡ç½‘æ ¼çš„é€šç”¨ APIã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ Envoy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/envoy-arch.svg&#34; data-img=&#34;/blog/beyond-istio-oss/envoy-arch.svg&#34; alt=&#34;image&#34; data-caption=&#34;Envoy æ¶æ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Envoy æ¶æ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;xDS æ˜¯ Envoy åŒºåˆ«äºå…¶ä»–ä»£ç†çš„å…³é”®ï¼Œå®ƒçš„ä»£ç å’Œè§£ææµç¨‹ååˆ†å¤æ‚ &lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;ï¼Œç›´æ¥æ‰©å±•èµ·æ¥ä¹Ÿå¾ˆæœ‰éš¾åº¦ã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ Istio ç»„ä»¶æ‹“æ‰‘å›¾ï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Istio æ•°æ®å¹³é¢çš„ Sidecar å®¹å™¨ä¸­ä¸æ­¢æœ‰ &lt;code&gt;envoy&lt;/code&gt; è¿™ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿˜æœ‰ä¸€ä¸ª &lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;istio-components.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Istio ç»„ä»¶æ‹“æ‰‘å›¾&#34; id=&#34;istio-components&#34;data-img=&#34;istio-components.svg&#34;
         data-caption=&#34;Istio ç»„ä»¶æ‹“æ‰‘å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Istio ç»„ä»¶æ‹“æ‰‘å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹çš„ä½œç”¨å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸º &lt;code&gt;envoy&lt;/code&gt; çš„çˆ¶è¿›ç¨‹ï¼Œè´Ÿè´£ Envoy çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ¥è‡ªæ§åˆ¶å¹³é¢çš„æ¨é€ï¼Œé…ç½®ä»£ç†å’Œè¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;æ”¶é›† Envoy ç»Ÿè®¡ä¿¡æ¯ï¼Œæ±‡æ€» sidecar çš„ç»Ÿè®¡æ•°æ®ä¾› Prometheus æœé›†ï¼›&lt;/li&gt;
&lt;li&gt;å†…ç½®æœ¬åœ° DNS ä»£ç†ï¼Œç”¨äºè§£æ Kubernetes DNS è§£æä¸äº†çš„é›†ç¾¤å†…éƒ¨åŸŸåçš„åœºæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹ Envoy å’Œ DNS ä»£ç†è¿›è¡Œå¥åº·æ£€æŸ¥ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä»¥ä¸ŠåŠŸèƒ½ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º &lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹ä¸»è¦æ˜¯ç”¨äºä¸ Istiod äº¤äº’ï¼Œä¸º Envoy èµ·åˆ°æŒ‡æŒ¥å’Œè¾…åŠ©çš„ä½œç”¨ï¼ŒIstio çš„æ ¸å¿ƒç»„ä»¶æ˜¯ Envoyã€‚é‚£ä¹ˆ Envoy ä¼šä¸ä¼šã€Œæ¼”è€Œä¼˜åˆ™å¯¼ã€ï¼Œä¸å†é…åˆ Istioï¼Œæ„å»ºä¸€å¥—è‡ªå·±çš„æ§åˆ¶å¹³é¢å‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;åœ¨ Sidecar å®¹å™¨ä¸­ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; å°±åƒæ˜¯ Envoy çš„â€œSidecarâ€ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    è¯·è¯»è€…æ€è€ƒä¸€ä¸‹
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;code&gt;pilot-agent&lt;/code&gt; çš„åŠŸèƒ½èƒ½å¦ç›´æ¥å†…ç½®åˆ° Envoy ä¸­ï¼Œä»è€Œå–æ¶ˆ &lt;code&gt;pilot-agent&lt;/code&gt; å‘¢ï¼Ÿ
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;envoy-gateway&#34;&gt;Envoy Gateway ç»Ÿä¸€æœåŠ¡ç½‘æ ¼ç½‘å…³&lt;/h2&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œé™¤ Service èµ„æºå¯¹è±¡ä¹‹å¤–ï¼Œæœ€æ—©ç”¨æ¥æš´éœ²é›†ç¾¤ä¸­æœåŠ¡çš„èµ„æºå¯¹è±¡æ˜¯ Ingressã€‚ä½¿ç”¨ Ingress ä½ åªéœ€è¦ä¸ºé›†ç¾¤å¼€æ”¾ä¸€ä¸ªå¯¹å¤–çš„è®¿é—®ç‚¹å³å¯ï¼Œé€šè¿‡ HTTP Hosts å’Œ &lt;code&gt;path&lt;/code&gt; æ¥è·¯ç”±æµé‡åˆ°å…·ä½“çš„æœåŠ¡ã€‚ç›¸å¯¹äºç›´æ¥åœ¨ &lt;code&gt;service&lt;/code&gt; èµ„æºä¸Šæš´éœ²æœåŠ¡æ¥è¯´ï¼Œå¯ä»¥å‡å°‘é›†ç¾¤çš„ç½‘ç»œè®¿é—®ç‚¹ï¼ˆPEPï¼‰&lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt; ï¼Œé™ä½é›†ç¾¤è¢«ç½‘ç»œæ”»å‡»çš„é£é™©ã€‚ä½¿ç”¨ Ingress è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/ingress.svg&#34; data-img=&#34;/blog/beyond-istio-oss/ingress.svg&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes Ingress æµé‡è®¿é—®æµç¨‹å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Kubernetes Ingress æµé‡è®¿é—®æµç¨‹å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;åœ¨ Kubernetes ä¹‹å‰ï¼ŒAPI Gateway è½¯ä»¶å°±å·²ç»è¢«å¹¿æ³›ç”¨ä½œè¾¹ç¼˜è·¯ç”±äº†ï¼Œåœ¨å¼•ç”¨ Istio æ—¶åˆå¢åŠ äº† Istio è‡ªå®šä¹‰çš„ Gateway èµ„æºï¼Œä½¿å¾—è®¿é—® Istio æœåŠ¡ç½‘æ ¼ä¸­çš„èµ„æºåˆå¤šäº†ä¸€ç§é€‰æ‹©ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/access-cluster.svg&#34; data-img=&#34;/blog/beyond-istio-oss/access-cluster.svg&#34; alt=&#34;image&#34; data-caption=&#34;è®¿é—® Istio ç½‘æ ¼ä¸­çš„æœåŠ¡çš„æ–¹å¼&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;è®¿é—® Istio ç½‘æ ¼ä¸­çš„æœåŠ¡çš„æ–¹å¼&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ç°åœ¨ï¼Œè¦æƒ³æš´éœ²å•ä¸ª Istio ç½‘æ ¼ä¸­çš„æœåŠ¡ï¼Œ&lt;code&gt;NodePort&lt;/code&gt;ã€&lt;code&gt;LoadBalance&lt;/code&gt;ã€Istio è‡ªå®šä¹‰ Gatewayã€Kubernetes Ingress å’Œ API Gateway è½¯ä»¶ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿå¦‚æœæ˜¯å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ï¼Œå®¢æˆ·ç«¯å¦‚ä½•è®¿é—®ç½‘æ ¼å†…çš„æœåŠ¡ï¼Ÿæˆ‘ä»¬çš„æœåŠ¡ç½‘æ ¼é¢†è¡”ä¸»æ¼” Envoy å·²ç»åœ¨è¿™æ–¹é¢åšè¶³äº†åŠŸå¤«ï¼Œè¢«ä»¥å¤šç§å½¢å¼ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar Proxyï¼šæ­£å¦‚åœ¨&lt;a href=&#34;#are-they-service-mesh&#34; title=&#34;å‰æ–‡ä¸­&#34;&gt;å‰æ–‡ä¸­&lt;/a&gt;æåˆ°çš„ï¼ŒIstioã€Kumaã€Consul Connect éƒ½ä½¿ç”¨äº† Envoy ä½œä¸º sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes Ingress Controller/API Gatewayï¼š&lt;a href=&#34;https://github.com/projectcontour/contour&#34; title=&#34;Contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contour&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/emissary-ingress/emissary&#34; title=&#34;Emissary&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Emissary&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/hango-io/hango-gateway&#34; title=&#34;Hango&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hango&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/solo-io/gloo&#34; title=&#34;Gloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo&lt;/a&gt; ç­‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›é¡¹ç›®åˆ©ç”¨ Envoy æ¥å®ç°æœåŠ¡ç½‘æ ¼å’Œ API ç½‘å…³ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šåŠŸèƒ½é‡å ï¼ŒåŒæ—¶åˆæœ‰å¾ˆå¤šä¸“æœ‰åŠŸèƒ½ï¼Œæˆ–è€…ç¼ºä¹ç¤¾åŒºå¤šæ ·æ€§ï¼Œè¿™ç§ç°çŠ¶ç”±äº Envoy ç¤¾åŒºæ²¡æœ‰æä¾›æ§åˆ¶å¹³é¢å®ç°è€Œå¯¼è‡´çš„ã€‚ä¸ºäº†æ”¹å˜ç°çŠ¶ï¼ŒEnvoy ç¤¾åŒºå‘èµ·äº† &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; title=&#34;Envoy Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt; é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨ç»“åˆç°æœ‰çš„åŸºäº Envoy çš„ API Gateway ç›¸å…³é¡¹ç›®çš„ç»éªŒ &lt;sup id=&#34;fnref:12&#34;&gt;&lt;a href=&#34;#fn:12&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;12&lt;/a&gt;&lt;/sup&gt;ï¼Œåˆ©ç”¨å¸¦æœ‰ä¸€äº› Envoy ç‰¹å®šæ‰©å±•çš„  &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; title=&#34;Kubernetes Gateway API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt; é™ä½ Envoy ç”¨æˆ·ä½¿ç”¨ç½‘å…³çš„é—¨æ§›ã€‚å› ä¸º Envoy Gateway ä»ç„¶é€šè¿‡ xDS ä¸‹å‘é…ç½®ç»™ Envoy ä»£ç†ï¼Œå› æ­¤ä½ è¿˜å¯ä»¥ç”¨å®ƒæ¥ç®¡ç†æ”¯æŒ xDS çš„ç½‘å…³ï¼Œå¦‚ Istio Gatewayã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨æ‰€è§çš„ç½‘å…³åŸºæœ¬éƒ½æ˜¯åœ¨å•é›†ç¾¤ä¸­ä½œä¸ºå…¥å£ç½‘å…³ï¼Œå¯¹äºå¤šé›†ç¾¤å’Œå¤šç½‘æ ¼å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚ä¸ºäº†åº”å¯¹å¤šé›†ç¾¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Istio ä¹‹ä¸Šå†æ·»åŠ ä¸€å±‚ç½‘å…³ï¼Œå’Œä¸€ä¸ªå…¨å±€çš„æ§åˆ¶å¹³é¢ä»¥åœ¨å¤šé›†ç¾¤é—´è·¯ç”±æµé‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/t2-gateway.svg&#34; data-img=&#34;/blog/beyond-istio-oss/t2-gateway.svg&#34; alt=&#34;image&#34; data-caption=&#34;å¤šé›†ç¾¤å¤šç½‘æ ¼çš„ä¸¤çº§ç½‘å…³ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;å¤šé›†ç¾¤å¤šç½‘æ ¼çš„ä¸¤çº§ç½‘å…³ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    å…³äºä¸¤çº§ç½‘å…³çš„ç®€è¦ä»‹ç»
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;ul&gt;
&lt;li&gt;ä¸€çº§ç½‘å…³ï¼ˆä¸‹æ–‡ç®€ç§° T1ï¼‰ä½äºåº”ç”¨è¾¹ç¼˜ï¼Œç”¨äºå¤šé›†ç¾¤ç¯å¢ƒã€‚åŒä¸€åº”ç”¨ä¼šåŒæ—¶æ‰˜ç®¡åœ¨ä¸åŒçš„é›†ç¾¤ä¸Šï¼ŒT1 ç½‘å…³å°†å¯¹è¯¥åº”ç”¨çš„è¯·æ±‚æµé‡åœ¨è¿™äº›é›†ç¾¤ä¹‹é—´è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;äºŒçº§ç½‘å…³ï¼ˆä¸‹æ–‡ç®€ç§° T2ï¼‰ä½äºä¸€ä¸ªçš„é›†ç¾¤è¾¹ç¼˜ï¼Œç”¨äºå°†æµé‡è·¯ç”±åˆ°è¯¥é›†ç¾¤å†…ç”±æœåŠ¡ç½‘æ ¼ç®¡ç†çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;é€šè¿‡åœ¨ Istio æ§åˆ¶å¹³é¢ä»¥å¤–å¢åŠ ä¸€å±‚å…¨å±€æ§åˆ¶å¹³é¢å’Œ APIï¼Œæ¥å®ç°å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ç®¡ç†ã€‚å°† T1 ç½‘å…³éƒ¨ç½²ä¸ºé›†ç¾¤ï¼Œå¯ä»¥é˜²æ­¢å•ç‚¹æ•…éšœã€‚æƒ³è¦äº†è§£å…³äºä¸¤çº§ç½‘å…³çš„æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/&#34; title=&#34;é€šè¿‡ä¸¤çº§ç½‘å…³è®¾è®¡æ¥è·¯ç”±æœåŠ¡ç½‘æ ¼æµé‡&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ä¸¤çº§ç½‘å…³è®¾è®¡æ¥è·¯ç”±æœåŠ¡ç½‘æ ¼æµé‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;T1 ç½‘å…³çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Tier1Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1-tier1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-gw-group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-tenant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway-t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;externalServers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cluster1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;75&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cluster2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥é…ç½®å°† &lt;code&gt;servicea.example.com&lt;/code&gt; é€šè¿‡ T1 ç½‘å…³æš´éœ²åˆ°ç½‘æ ¼å¤–ï¼Œå¹¶å°†ç½‘æ ¼å¤–è®¿é—®è¯¥æœåŠ¡çš„æµé‡çš„ &lt;code&gt;75%&lt;/code&gt; è½¬å‘åˆ° &lt;code&gt;cluster1&lt;/code&gt;ï¼Œ&lt;code&gt;25%&lt;/code&gt; çš„æµé‡è½¬å‘åˆ° &lt;code&gt;cluster2&lt;/code&gt;ï¼Œå¦å¤–ä¸ºäº†åº”å¯¹å¤šé›†ç¾¤ä¸­çš„æµé‡ã€æœåŠ¡å’Œå®‰å…¨é…ç½®ï¼ŒTetrate æ——èˆ°äº§å“ Tetrate Service Bridge ä¸­è¿˜å¢åŠ äº† ä¸€ç³»åˆ— Group APIï¼Œè¯¦è§ TSB æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ecosystem&#34;&gt;Istio å¼€æºç”Ÿæ€&lt;/h2&gt;
&lt;p&gt;Istio å¼€æºåœ¨è‡³ä»Šå·²ç»äº”å¹´å¤šäº†ï¼Œè¿‘ä¸¤å¹´æ¥å‡ºç°äº†å¾ˆå¤šåŸºäº Istio çš„å¼€æºé¡¹ç›®ï¼Œå…¶ä¸­æ¯”è¾ƒä»£è¡¨æ€§çš„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘æ˜“å¼€æºçš„ Slime&lt;/li&gt;
&lt;li&gt;è…¾è®¯å¼€æºçš„ Aeraki&lt;/li&gt;
&lt;li&gt;Istio å®˜æ–¹å¯¹ Wasm æ’ä»¶çš„æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒä»¬çš„å‡ºç°ä½¿å¾— Istio æ›´åŠ æ™ºèƒ½åŒ–å¹¶æ‰©å±•äº† Istio çš„é€‚ç”¨èŒƒå›´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;slime&#34;&gt;Slime&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/slime-io/slime/&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt; æ˜¯ç”±ç½‘æ˜“æ•°å¸†å¾®æœåŠ¡å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾åŸºäº Istio çš„æ™ºèƒ½ç½‘æ ¼ç®¡ç†å™¨ã€‚Slime åŸºäº Kubernetes Operator å®ç°ï¼Œå¯ä½œä¸º Istio çš„ CRD ç®¡ç†å™¨ï¼Œæ— é¡»å¯¹ Istio åšä»»ä½•å®šåˆ¶åŒ–æ”¹é€ ï¼Œå°±å¯ä»¥å®šä¹‰åŠ¨æ€çš„æœåŠ¡æ²»ç†ç­–ç•¥ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨ä¾¿æ·ä½¿ç”¨ Istio å’Œ Envoy é«˜é˜¶åŠŸèƒ½çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å‰æ–‡çš„&lt;a href=&#34;#control-plane-perf-optimizing&#34; title=&#34;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–&#34;&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–&lt;/a&gt;ä¸­æåˆ°äº†é€šè¿‡ã€Œå‡å°‘éœ€è¦æ¨é€çš„é…ç½®ã€çš„æ–¹å¼æ¥ä¼˜åŒ– Istio çš„æ€§èƒ½ï¼Œä½†æ˜¯ Istio æ— æ³•åšåˆ°è‡ªåŠ¨è¯†åˆ«æ— æ³•ä¾èµ–ä»¥æœ€ä¼˜åŒ–éœ€è¦æ¨é€åˆ°æ¯ä¸ª sidecar çš„ä»£ç†é…ç½®ï¼ŒSlime æä¾›äº† &lt;code&gt;lazyload&lt;/code&gt; æ§åˆ¶å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°é…ç½®æ‡’åŠ è½½ï¼Œç”¨æˆ·æ— é¡»æ‰‹åŠ¨é…ç½® &lt;code&gt;SidecarScope&lt;/code&gt; &lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt;ï¼ŒIstio å¯ä»¥æŒ‰éœ€åŠ è½½æœåŠ¡é…ç½®å’ŒæœåŠ¡å‘ç°ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Slime ä½œä¸º Istio çš„ç®¡ç†å¹³é¢æ›´æ–°æ•°æ®å¹³é¢é…ç½®çš„æµç¨‹å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/slime-process.svg&#34; data-img=&#34;/blog/beyond-istio-oss/slime-process.svg&#34; alt=&#34;image&#34; data-caption=&#34;ä½¿ç”¨ Slime æ›´æ–° Istio æ•°æ®å¹³é¢é…ç½®çš„æµç¨‹å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;ä½¿ç”¨ Slime æ›´æ–° Istio æ•°æ®å¹³é¢é…ç½®çš„æµç¨‹å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­ï¼ŒGlobal Proxy ä½¿ç”¨ Envoy æ„å»ºï¼Œåœ¨æ¯ä¸ªéœ€è¦å¯åŠ¨é…ç½®æ‡’åŠ è½½çš„å‘½åç©ºé—´ä¸­éƒ¨ç½²ä¸€ä¸ªæˆ–åœ¨æ•´ä¸ªç½‘æ ¼ä¸­åªéƒ¨ç½²ä¸€ä¸ªï¼Œæ‰€æœ‰ç¼ºå¤±æœåŠ¡å‘ç°ä¿¡æ¯çš„è°ƒç”¨ï¼ˆä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®æœåŠ¡è°ƒç”¨å…³ç³»ï¼‰ï¼Œéƒ½ä¼šè¢«å…œåº•è·¯ç”±åŠ«æŒåˆ° Global Proxyï¼Œç»è¿‡å…¶é¦–æ¬¡è½¬å‘åï¼ŒSlime ä¾¿å¯æ„ŸçŸ¥åˆ°è¢«è°ƒç”¨æ–¹çš„ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å…¶å¯¹åº”æœåŠ¡çš„ VirtualServiceï¼Œæ‰¾åˆ°æœåŠ¡åå’ŒçœŸå®åç«¯çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸¤è€…çš„éƒ½åŠ å…¥ SidecarScopeï¼Œä»¥åè¯¥æœåŠ¡çš„è°ƒç”¨å°±ä¸å†éœ€è¦ç»è¿‡ Global Proxy äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®å¹³é¢é…ç½®æ›´æ–°çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Slime Operator æ ¹æ®ç®¡ç†å‘˜çš„é…ç½®åœ¨ Kubernetes ä¸­å®Œæˆ Slime ç»„ä»¶çš„åˆå§‹åŒ–ï¼Œå¼€å‘è€…åˆ›å»ºç¬¦åˆ Slime CRD è§„èŒƒçš„é…ç½®å¹¶åº”ç”¨åˆ° Kubernetes é›†ç¾¤ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Slime æŒç»­ç›‘å¬ Slime CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Slime æŸ¥è¯¢ Prometheus ä¸­ä¿å­˜çš„ç›¸å…³æœåŠ¡çš„ç›‘æ§æ•°æ®ï¼Œç»“åˆ Slime CRD ä¸­è‡ªé€‚åº”éƒ¨åˆ†çš„é…ç½®ï¼Œå°† Slime CRD è½¬æ¢ä¸º Istio CRDï¼ŒåŒæ—¶å°†å…¶æ¨é€åˆ° Global Proxy ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istio ç›‘å¬ Istio CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Istio å°†ä»£ç†çš„é…ç½®ä¿¡æ¯æ¨é€åˆ°æ•°æ®å¹³é¢ç›¸åº”çš„ Sidecar Proxy ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºæ•°æ®å¹³é¢ä¸­çš„æ‰€æœ‰æœåŠ¡çš„é¦–æ¬¡è°ƒç”¨éƒ½é€šè¿‡ Global Proxyï¼Œè¯¥ Proxy å¯ä»¥è®°å½•æ‰€æœ‰æœåŠ¡çš„è°ƒç”¨å’Œä¾èµ–ä¿¡æ¯ï¼Œæ ¹æ®è¯¥ä¾èµ–ä¿¡æ¯æ›´æ–° Istio ä¸­ Sidecar èµ„æºçš„é…ç½®ï¼›å½“æŸä¸ªæœåŠ¡çš„è°ƒç”¨é“¾è¢« VirtualService ä¸­çš„è·¯ç”±ä¿¡æ¯é‡æ–°å®šä¹‰æ—¶ï¼ŒGlobal Proxy åŸæœ‰è®°å½•å°±å¤±æ•ˆäº†ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤è¯¥æœåŠ¡çš„è°ƒç”¨å…³ç³»ã€‚Slime åˆ›å»ºäº†åä¸º &lt;code&gt;ServiceFence&lt;/code&gt; çš„ CRD æ¥ç»´æŠ¤æœåŠ¡è°ƒç”¨å…³ç³»ä»¥è§£å†³æœåŠ¡ä¿¡æ¯ç¼ºå¤±é—®é¢˜ï¼Œè¯¦è§ &lt;a href=&#34;https://jimmysong.io/blog/slime-intro/&#34; title=&#34;Slime ç®€ä»‹&#34;&gt;Slime ç®€ä»‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;aeraki&#34;&gt;Aeraki&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aeraki-mesh/aeraki&#34; title=&#34;Aeraki Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki Mesh&lt;/a&gt; æ˜¯è…¾è®¯äº‘åœ¨ 2021 å¹´ 3 æœˆå¼€æºçš„ä¸€ä¸ªæœåŠ¡ç½‘æ ¼é¢†åŸŸçš„é¡¹ç›®ï¼ŒåŸºäº Istio æ‰©å±•å…¶å¯¹ä¸ƒå±‚åè®®çš„æ”¯æŒï¼Œä¸“æ³¨äºè§£å†³ Istio ä¸­çš„&lt;strong&gt;é HTTP åè®®&lt;/strong&gt;çš„æœåŠ¡æ²»ç†ï¼Œå·²äº 2022 å¹´ 6 æœˆè¿›å…¥ CNCF Sandboxã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/aeraki-arch.svg&#34; data-img=&#34;/blog/beyond-istio-oss/aeraki-arch.svg&#34; alt=&#34;image&#34; data-caption=&#34;Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å…¶è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Aeraki çš„ X2Istio ç»„ä»¶å¯¹æ¥æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè·å–é HTTP æœåŠ¡çš„æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆ ServiceEntry å‘ Istio ä¸­æ³¨å†Œï¼›&lt;/li&gt;
&lt;li&gt;Aeraki ä½œä¸º Istio ä¹‹ä¸Šçš„ç®¡ç†å¹³é¢ï¼Œå®ƒä» Istio ä¸­è·å– ServiceEntry é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;Aeraki é€šè¿‡ç«¯å£å‘½åè§„åˆ¤æ–­æœåŠ¡çš„åè®®ç±»å‹ï¼ˆå¦‚ &lt;code&gt;tcp-metaprotocol-dubbo&lt;/code&gt;ï¼‰ï¼Œç„¶åç”Ÿæˆ MetaProtocol Proxy Filterï¼ˆå…¼å®¹ EnvoyFilterï¼‰é…ç½®ï¼ŒåŒæ—¶ä¿®æ”¹ RDS åœ°å€ï¼Œå°†å…¶æŒ‡å‘ Aerakiï¼›&lt;/li&gt;
&lt;li&gt;Istio ä½¿ç”¨ xDS åè®®å°†é…ç½®ï¼ˆLDSã€CDSã€EDS ç­‰ï¼‰ä¸‹å‘ç»™æ•°æ®å¹³é¢ï¼›&lt;/li&gt;
&lt;li&gt;Aeraki æ ¹æ®æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯å’Œç”¨æˆ·è®¾ç½®ç”Ÿæˆè·¯ç”±è§„åˆ™ï¼Œé€šè¿‡ RDS å‘é€ç»™æ•°æ®å¹³é¢ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Istio ä¸­æ¥å…¥é HTTP æœåŠ¡çš„æ•´ä¸ªæµç¨‹ä¸­çš„å…³é”®æ˜¯ &lt;strong&gt;MetaProtocol Proxy&lt;/strong&gt; ã€‚Istio é»˜è®¤æ”¯æŒ HTTP/HTTP2ã€TCP å’Œ gRPC åè®®ï¼Œå®éªŒæ€§æ”¯æŒ Mongoã€MySQL å’Œ Redis åè®® &lt;sup id=&#34;fnref:14&#34;&gt;&lt;a href=&#34;#fn:14&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;14&lt;/a&gt;&lt;/sup&gt;ã€‚è‹¥è¦ä½¿ç”¨ Istio è·¯ç”±å…¶ä»–åè®®çš„æµé‡ï¼Œä¸ä»…éœ€è¦ä¿®æ”¹ Istio æ§åˆ¶å¹³é¢å¹¶æ‰©å±• Envoyï¼Œè¿™å°†å¸¦æ¥å·¨å¤§çš„å·¥ä½œé‡ï¼Œè€Œä¸”ä¸åŒåè®®å…±äº«é€šç”¨çš„æ§åˆ¶é€»è¾‘ï¼Œè¿™è¿˜ä¼šå¸¦æ¥å¾ˆå¤šé‡å¤æ€§å·¥ä½œã€‚MetaProtocol Proxy æ˜¯åœ¨ Envoy ä»£ç åŸºç¡€ä¸Šçš„æ‰©å±•ï¼Œä¸ºä¸ƒå±‚åè®®ç»Ÿä¸€å®ç°äº†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€RDS åŠ¨æ€è·¯ç”±ã€æµé‡é•œåƒã€æ•…éšœæ³¨å…¥ã€æœ¬åœ°/å…¨å±€é™æµç­‰åŸºç¡€èƒ½åŠ›ï¼Œå¤§å¤§é™ä½äº†åœ¨ Envoy ä¸Šå¼€å‘ç¬¬ä¸‰æ–¹åè®®çš„éš¾åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„ MetaProtocol Proxy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/metaprotocol-proxy.svg&#34; data-img=&#34;/blog/beyond-istio-oss/metaprotocol-proxy.svg&#34; alt=&#34;image&#34; data-caption=&#34;MetaProtocol Proxy æ¶æ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;MetaProtocol Proxy æ¶æ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å½“æˆ‘ä»¬æƒ³æ‰©å±• Istio ä½¿å…¶æ”¯æŒ Kafkaã€Dubboã€Thrift ç­‰å…¶ä»–ä¸ƒå±‚åè®®æ—¶ï¼Œåªéœ€è¦å®ç°ä¸Šå›¾ä¸­çš„ç¼–è§£ç çš„æ¥å£ï¼ˆDecode å’Œ Encodeï¼‰ï¼Œå°±å¯ä»¥åŸºäº MetaProtocol å¿«é€Ÿå¼€å‘ä¸€ä¸ªç¬¬ä¸‰æ–¹åè®®æ’ä»¶ã€‚MetaProtocol Proxy æ˜¯åœ¨ Envoy åŸºç¡€ä¸Šçš„æ‰©å±•ï¼Œå› æ­¤ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨å¤šç§è¯­è¨€ä¸ºå…¶å¼€å‘è¿‡æ»¤å™¨ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;EnvoyFilter&lt;/code&gt; èµ„æºå°†é…ç½®ä¸‹å‘åˆ°æ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;wasmplugin-api&#34;&gt;WasmPlugin API&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; title=&#34;WasmPlugin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt; æ˜¯ Istio 1.12 ç‰ˆæœ¬å¼•å…¥çš„ APIï¼Œä½œä¸ºä»£ç†æ‰©å±•æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå°†è‡ªå®šä¹‰å’Œç¬¬ä¸‰æ–¹çš„ Wasm æ¨¡å—æ·»åŠ åˆ°æ•°æ®å¹³é¢ä¸­ã€‚ä¸‹å›¾ä¸­å±•ç¤ºäº†å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ WasmPluginã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/wasmplugin.svg&#34; data-img=&#34;/blog/beyond-istio-oss/wasmplugin.svg&#34; alt=&#34;image&#34; data-caption=&#34;åœ¨ Istio ä¸­ä½¿ç”¨ WasmPlugin çš„æµç¨‹å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;åœ¨ Istio ä¸­ä½¿ç”¨ WasmPlugin çš„æµç¨‹å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·ä½¿ç”¨ &lt;a href=&#34;https://github.com/proxy-wasm&#34; title=&#34;Proxy-Wasm SDK&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy-Wasm SDK&lt;/a&gt;ï¼ˆç›®å‰æœ‰ AssemblyScriptã€C++ã€Rustã€Zig å’Œ Go è¯­è¨€ç‰ˆæœ¬ï¼‰æ¥å¼€å‘æ‰©å±•ï¼Œå¹¶æ„å»ºæˆ OCI é•œåƒï¼ˆå¦‚ Docker é•œåƒï¼‰ä¸Šä¼ åˆ°é•œåƒä»“åº“ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·ç¼–å†™ &lt;code&gt;WasmPlugin&lt;/code&gt; é…ç½®å¹¶åº”ç”¨åˆ° Istioï¼›&lt;/li&gt;
&lt;li&gt;Istio æ§åˆ¶å¹³é¢æ ¹æ® &lt;code&gt;WasmPlugin&lt;/code&gt; é…ç½®ä¸­çš„å·¥ä½œè´Ÿè½½é€‰æ‹©é…ç½®ï¼Œå°† Wasm æ¨¡å—æ³¨å…¥åˆ°æŒ‡å®šçš„ Pod ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Sidecar ä¸­çš„ &lt;code&gt;pilot-agent&lt;/code&gt; &lt;sup id=&#34;fnref:15&#34;&gt;&lt;a href=&#34;#fn:15&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;15&lt;/a&gt;&lt;/sup&gt; ä»è¿œç¨‹æˆ–æœ¬åœ°æ–‡ä»¶ä¸­è·å– Wasm æ¨¡å—å¹¶å°†å…¶åŠ è½½åˆ° Envoy ä¸­è¿è¡Œï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;whos-should-use-istio&#34;&gt;è°åº”è¯¥ä½¿ç”¨ Istioï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¥½äº†ï¼Œè¯´äº†è¿™ä¹ˆè¯´ï¼Œè¿™è·Ÿä½ æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼ŸIstio è·Ÿä½ çš„å…³ç³»å–å†³äºä½ çš„è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ æ˜¯å¹³å°è´Ÿè´£äººï¼Œåº”ç”¨æœåŠ¡ç½‘æ ¼åï¼Œå¯èƒ½å¢å¼ºä½ çš„å¹³å°å¯è§‚æµ‹æ€§ï¼Œå…·æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°æ¥ç®¡ç†å¾®æœåŠ¡ï¼Œä½ å°†æ˜¯ç›´æ¥å—ç›Šè€…ï¼Œä¹Ÿåº”è¯¥æ˜¯æœåŠ¡ç½‘æ ¼çš„ä¸»è¦å®æ–½è€…ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åº”ç”¨ç¨‹åºå¼€å‘è€…ï¼Œä¹Ÿä¼šä»æœåŠ¡ç½‘æ ¼ä¸­æ”¶ç›Šï¼Œå› ä¸ºä½ å¯ä»¥æ›´åŠ ä¸“å±äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸ç”¨æ‹…å¿ƒé‡è¯•ç­–ç•¥ã€TLS ç­‰å…¶ä»–éåŠŸèƒ½æ€§é—®é¢˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è·¯å¾„ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/adopt.svg&#34; data-img=&#34;/blog/beyond-istio-oss/adopt.svg&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è·¯å¾„&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è·¯å¾„&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;æ˜¯å¦é‡‡ç”¨æœåŠ¡ç½‘æ ¼å–å†³äºä½ å…¬å¸çš„æŠ€æœ¯å‘å±•é˜¶æ®µï¼Œåº”ç”¨æ˜¯å¦å®ç°å®¹å™¨åŒ–å’Œå¾®æœåŠ¡ï¼Œå¯¹å¤šè¯­è¨€çš„éœ€æ±‚ï¼Œæ˜¯å¦éœ€è¦ mTLS ä»¥åŠå¯¹æ€§èƒ½æŸè€—çš„æ¥çº³åº¦ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-mesh-positioning&#34;&gt;æœåŠ¡ç½‘æ ¼åœ¨äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­çš„å®šä½&lt;/h2&gt;
&lt;p&gt;æŠ€æœ¯çš„å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œè¿‘ä¸¤å¹´æ¥æœ‰ä¸€äº›æ–°æŠ€æœ¯å‡ºç°ï¼Œä¼¼ä¹æŒ‘æˆ˜äº†æœåŠ¡ç½‘æ ¼çš„åœ°ä½ï¼Œæ›´æœ‰äººå£°ç§°å¯ä»¥ç›´æ¥å–ä»£ç°æœ‰ç»å…¸çš„ sidecar æ¨¡å¼çš„æœåŠ¡ç½‘æ ¼ &lt;sup id=&#34;fnref:16&#34;&gt;&lt;a href=&#34;#fn:16&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;16&lt;/a&gt;&lt;/sup&gt;ï¼Œæˆ‘ä»¬ä¸è¦è¢«å¤–ç•Œå˜ˆæ‚çš„å£°éŸ³æ‰€è¿·æƒ‘ï¼Œè®¤æ¸…æœåŠ¡ç½‘æ ¼åœ¨äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­çš„å®šä½ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;ä¸€å‘³åœ°æ¨å¹¿æŸé¡¹æŠ€æœ¯è€Œå¿½ç•¥å®ƒçš„é€‚ç”¨åœºæ™¯ï¼Œå°±æ˜¯è€æµæ°“ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯äº‘åŸç”ŸæŠ€æœ¯å †æ ˆã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/cloud-native-stack.svg&#34; data-img=&#34;/blog/beyond-istio-oss/cloud-native-stack.svg&#34; alt=&#34;image&#34; data-caption=&#34;äº‘åŸç”ŸæŠ€æœ¯å †æ ˆç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;äº‘åŸç”ŸæŠ€æœ¯å †æ ˆç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨äº‘åŸç”ŸæŠ€æœ¯å †æ ˆå›¾ä¸­çš„ã€Œäº‘åŸºç¡€è®¾æ–½ã€ã€ã€Œä¸­é—´ä»¶ã€å’Œã€Œåº”ç”¨ã€å±‚éƒ½åˆ—ä¸¾äº†ä¸€äº›æ ‡å¿—æ€§çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®æ„å»ºäº†å®ƒä»¬æ‰€åœ¨é¢†åŸŸçš„æ ‡å‡†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨äº‘åŸºç¡€è®¾æ–½é¢†åŸŸï¼ŒKubernetes ç»Ÿä¸€äº†å®¹å™¨ç¼–æ’å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ ‡å‡†ï¼ŒOperator æ¨¡å¼å¥ å®šäº†æ‰©å±• Kubernetes API åŠç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥çš„æ ‡å‡†ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ä¸­é—´ä»¶é¢†åŸŸï¼ŒæœåŠ¡ç½‘æ ¼æ‰¿æ‹…èµ·äº†äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­çš„ä¸ƒå±‚ç½‘ç»œã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨ç­‰å¤šä¸ªæ–¹é¢çš„éƒ¨åˆ†æˆ–å…¨éƒ¨è´£ä»»ï¼Œå®ƒè¿è¡Œåœ¨åº”ç”¨ç¨‹åºä¸‹å±‚ï¼Œå¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´å‡ ä¹æ˜¯æ— æ„ŸçŸ¥çš„ï¼›Daprï¼ˆåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼‰å®šä¹‰äº‘åŸç”Ÿä¸­é—´ä»¶çš„èƒ½åŠ›æ¨¡å‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨åº”ç”¨ä¸­é›†æˆ Dapr çš„å¤šè¯­è¨€ SDKï¼Œé¢å‘ Dapr æä¾›çš„åˆ†å¸ƒå¼èƒ½åŠ›ç¼–ç¨‹ï¼Œè€Œä¸ç”¨å…³å¿ƒåº”ç”¨æ‰€è¿è¡Œçš„ç¯å¢ƒåŠå¯¹æ¥çš„åç«¯åŸºç¡€è®¾æ–½ã€‚å› ä¸ºåœ¨å’Œåº”ç”¨ç¨‹åºè¿è¡Œåœ¨åŒä¸€ä¸ª Pod ä¸­çš„ Dapr è¿è¡Œæ—¶ï¼ˆSidecar æ¨¡å¼éƒ¨ç½²ï¼Œå…¶ä¸­åŒ…å«å„ç§æ„å»ºå—ï¼‰è‡ªåŠ¨å¸®æˆ‘ä»¬å¯¹æ¥äº†åç«¯ç»„ä»¶ï¼ˆComponentï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨åº”ç”¨ç¨‹åºé¢†åŸŸï¼šOAM æ—¨åœ¨å»ºç«‹ä¸€ä¸ªåº”ç”¨æ¨¡å‹æ ‡å‡†ï¼Œé€šè¿‡ç»„ä»¶ã€ç‰¹å¾ã€ç­–ç•¥å’Œå·¥ä½œæµæ¥ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Istio åœ¨äº‘åŸç”Ÿéƒ¨ç½²ä¸­å®šä½äºä¸ƒå±‚ç½‘æ ¼ç®¡ç†ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istio-role.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istio-role.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­å®šä½åœ¨ä¸ƒå±‚ç½‘ç»œ&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Istio åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­å®šä½åœ¨ä¸ƒå±‚ç½‘ç»œ&lt;/figcaption&gt;
  
&lt;/figure&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    Dapr ä¸ Istio æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;p&gt;åœ¨äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­ï¼ŒIstio å’Œ Dapr åŒæ—¶ä½äºä¸­é—´ä»¶å±‚ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤šåŒºåˆ«å’Œè”ç³»ã€‚&lt;/p&gt;
&lt;p&gt;Istio å’Œ Dapr ä¹‹é—´çš„ç›¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio å’Œ Dapr éƒ½å¯ä»¥ä½¿ç”¨ Sidecar æ¨¡å¼çš„éƒ¨ç½²æ¨¡å‹ï¼›&lt;/li&gt;
&lt;li&gt;åŒå±äºä¸­é—´ä»¶ï¼ŒåŒæ ·å¯ä»¥ç®¡ç†æœåŠ¡é—´é€šä¿¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å’Œ Dapr ä¹‹é—´çš„ä¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®æ ‡ä¸åŒï¼šIstio çš„ç›®æ ‡æ˜¯æ„å»ºé›¶ä¿¡ä»»ç½‘ç»œï¼Œå®šä¹‰æœåŠ¡é—´é€šä¿¡æ ‡å‡†ï¼ŒDapr ç›®æ ‡æ˜¯æ„å»ºæ ‡å‡†çš„ä¸­é—´ä»¶èƒ½åŠ›çš„ APIï¼›&lt;/li&gt;
&lt;li&gt;æ¶æ„ä¸åŒï¼šIstio = Envoy + é€æ˜æµé‡åŠ«æŒ + æ§åˆ¶å¹³é¢ï¼ŒDapr = å¤šè¯­è¨€ SDK + æ ‡å‡†åŒ– API + åˆ†å¸ƒå¼èƒ½åŠ›ç»„ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;é¢å‘çš„äººç¾¤ä¸åŒï¼šä½†æ˜¯åº”ç”¨ Istio å¯¹äºå¼€å‘è€…æ¥è¯´å‡ ä¹æ— æ„ŸçŸ¥ï¼Œä¸»è¦éœ€è¦åŸºç¡€è®¾æ–½è¿ç»´å›¢é˜Ÿå®æ–½ï¼Œè€Œåº”ç”¨ Dapr éœ€è¦å¼€å‘è€…è‡ªä¸»é€‰æ‹©é›†æˆ Dapr SDKï¼›&lt;/li&gt;
&lt;/ul&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;istio-future&#34;&gt;æœåŠ¡ç½‘æ ¼çš„æœªæ¥&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨å‰æ–‡ä¸­ä»‹ç»äº† Istio çš„å‘å±•è„‰ç»œåŠå¼€æºç”Ÿæ€ï¼Œæ¥ä¸‹æ¥æˆ‘å°†ä¸ºå¤§å®¶ä»‹ç» Istio æœåŠ¡ç½‘æ ¼çš„æœªæ¥è¶‹åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºé›¶ä¿¡ä»»ç½‘ç»œ&lt;/li&gt;
&lt;li&gt;æˆä¸ºæ··åˆäº‘ç®¡ç†å¹³å°çš„ç½‘ç»œåŸºç¡€è®¾æ–½&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;æœåŠ¡ç½‘æ ¼çš„æœªæ¥åœ¨äºæˆä¸ºé›¶ä¿¡ä»»ç½‘ç»œå’Œæ··åˆäº‘çš„åŸºç¡€è®¾æ–½ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ç¬”è€…æ‰€åœ¨çš„å…¬å¸ä¼ä¸šçº§æœåŠ¡ç½‘æ ¼æä¾›å•† &lt;a href=&#34;https://www.tetrate.io/&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt; çš„åŠªåŠ›æ–¹å‘ï¼Œæˆ‘ä»¬è‡´åŠ›äºæ„å»ºä¸€ä¸ªåŸºäºé›¶ä¿¡ä»»çš„é€‚ç”¨äºä»»æ„ç¯å¢ƒã€ä»»æ„è´Ÿè½½çš„åº”ç”¨æ„ŸçŸ¥ç½‘ç»œã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ Tetrate æ——èˆ°äº§å“ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt; çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/tsb.svg&#34; data-img=&#34;/blog/beyond-istio-oss/tsb.svg&#34; alt=&#34;image&#34; data-caption=&#34;TSB æ¶æ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;TSB æ¶æ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;Tetrate å…¬å¸æ˜¯ç”± Istio é¡¹ç›®çš„å‘èµ·äººåˆ›ç«‹çš„ï¼ŒTSB æ˜¯åŸºäºå¼€æºçš„ Istioã€Envoy å’Œ Apache SkyWalking å¼€å‘çš„ã€‚æˆ‘ä»¬åŒæ—¶ç§¯æå¾—è´¡çŒ®ä¸Šæ¸¸ç¤¾åŒºï¼Œå¹¶å‚ä¸äº†æ—¨åœ¨ç®€åŒ–å°† Envoy ç½‘å…³ä½¿ç”¨çš„ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; title=&#34;Envoy Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt; é¡¹ç›®çš„åˆ›å»ºï¼ˆä¸Šå›¾ä¸­çš„ XCP å³ä½¿ç”¨ Envoy æ„å»ºçš„ç½‘å…³ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;zero-trust&#34;&gt;é›¶ä¿¡ä»»&lt;/h2&gt;
&lt;p&gt;é›¶ä¿¡ä»»ï¼ˆZero Trustï¼‰æ˜¯ IstioCon 2022 é‡Œçš„ä¸€ä¸ªé‡è¦è¯é¢˜ï¼ŒIstio æ­£åœ¨æˆä¸ºé›¶ä¿¡ä»»ç½‘ç»œçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    ä»€ä¹ˆæ˜¯é›¶ä¿¡ä»»ï¼Ÿ
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    é›¶ä¿¡ä»»ï¼ˆZero Trustï¼‰æ˜¯ä¸€ç§å®‰å…¨ç†å¿µï¼Œè€Œä¸æ˜¯ä¸€ç§æ‰€æœ‰å®‰å…¨å›¢é˜Ÿéƒ½è¦éµå¾ªçš„æœ€ä½³å®è·µã€‚é›¶ä¿¡ä»»æ¦‚å¿µçš„æå‡ºæ˜¯ä¸ºäº†ç»™äº‘åŸç”Ÿä¸–ç•Œå¸¦æ¥æ›´å®‰å…¨çš„ç½‘ç»œã€‚é›¶ä¿¡ä»»æ˜¯ä¸€ç§ç†è®ºçŠ¶æ€ï¼Œå³ç½‘ç»œå†…çš„æ‰€æœ‰æ¶ˆè´¹è€…ä¸ä»…æ²¡æœ‰ä»»ä½•æƒé™ï¼Œè€Œä¸”ä¹Ÿä¸å…·å¤‡å¯¹å‘¨å›´ç½‘ç»œçš„æ„ŸçŸ¥ã€‚é›¶ä¿¡ä»»çš„ä¸»è¦æŒ‘æˆ˜æ˜¯å°±è¶Šæ¥è¶Šç»†åŒ–çš„æˆæƒå’Œå’Œå¯¹ç”¨æˆ·æˆæƒçš„æ—¶é—´é™åˆ¶ã€‚å…³äºæ›´å¤šé›¶ä¿¡ä»»çš„ä»‹ç»ï¼Œè¯·é˜…è¯»&lt;a href=&#34;https://jimmysong.io/blog/what-is-zero-trust/&#34; title=&#34;è¿™ç¯‡åšå®¢&#34;&gt;è¿™ç¯‡åšå®¢&lt;/a&gt;ã€‚
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;authn&#34;&gt;èº«ä»½è®¤è¯&lt;/h3&gt;
&lt;p&gt;é›¶ä¿¡ä»»ç½‘ç»œä¸­æœ€é‡è¦çš„æ˜¯&lt;strong&gt;é¢å‘èº«ä»½çš„æ§åˆ¶&lt;/strong&gt;è€Œä¸æ˜¯é¢å‘ç½‘ç»œçš„æ§åˆ¶ã€‚Istio 1.14 ä¸­å¢åŠ äº†å¯¹ SPIRE çš„æ”¯æŒï¼ŒSPIREï¼ˆSPIFFE Runtime Environmentï¼ŒCNCF å­µåŒ–é¡¹ç›®ï¼‰æ˜¯ SPIFFEï¼ˆSecure Production Identity Framework For Everyoneï¼ŒCNCF å­µåŒ–é¡¹ç›®ï¼‰çš„ä¸€ä¸ªå®ç°ã€‚åœ¨ Kubernetes ä¸­æˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://jimmysong.io/book/kubernetes-handbook/auth/serviceaccount/&#34; title=&#34;ServiceAccount&#34;&gt;ServiceAccount&lt;/a&gt; ä¸º Pod ä¸­çš„å·¥ä½œè´Ÿè½½æä¾›èº«ä»½ä¿¡æ¯ï¼Œå…¶æ ¸å¿ƒæ˜¯åŸºäº Tokenï¼ˆä½¿ç”¨ Secret èµ„æºå­˜å‚¨ï¼‰æ¥è¡¨ç¤ºè´Ÿè½½èº«ä»½ã€‚è€Œ Token æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„èµ„æºï¼Œå¯¹äºå¤šé›†ç¾¤åŠè¿è¡Œåœ¨é Kubernetes ç¯å¢ƒï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºï¼‰ä¸­çš„è´Ÿè½½ï¼Œå¦‚ä½•ç»Ÿä¸€å®ƒä»¬çš„èº«ä»½ï¼Ÿè¿™å°±æ˜¯ SPIFFE è¦è§£å†³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;SPIFFE çš„ç›®çš„æ˜¯åŸºäºé›¶ä¿¡ä»»çš„ç†å¿µï¼Œå»ºç«‹ä¸€ä¸ªå¼€æ”¾ã€ç»Ÿä¸€çš„å·¥ä½œè´Ÿè½½èº«ä»½æ ‡å‡†ï¼Œè¿™æœ‰åŠ©äºå»ºç«‹ä¸€ä¸ªé›¶ä¿¡ä»»çš„å…¨é¢èº«ä»½åŒ–çš„æ•°æ®ä¸­å¿ƒç½‘ç»œã€‚SPIFFE çš„æ ¸å¿ƒæ˜¯é€šè¿‡ç®€å• API å®šä¹‰äº†ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçŸ­æš‚çš„åŠ å¯†èº«ä»½æ–‡ä»¶â€”â€” SVIDï¼ˆSPFFE Verifiable Identity Documentï¼‰ï¼Œç”¨ä½œå·¥ä½œè´Ÿè½½è®¤è¯æ—¶ä½¿ç”¨çš„èº«ä»½æ–‡ä»¶ï¼ˆåŸºäº X.509 è¯ä¹¦æˆ– JWT ä»¤ç‰Œï¼‰ã€‚SPIRE å¯ä»¥æ ¹æ®ç®¡ç†å‘˜å®šä¹‰çš„ç­–ç•¥è‡ªåŠ¨è½®æ¢ SVID è¯ä¹¦å’Œç§˜é’¥ï¼ŒåŠ¨æ€åœ°æä¾›å·¥ä½œè´Ÿè½½æ ‡è¯†ï¼ŒåŒæ—¶ Istio å¯ä»¥é€šè¿‡ SPIRE åŠ¨æ€çš„æ¶ˆè´¹è¿™äº›å·¥ä½œè´Ÿè½½æ ‡è¯†ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº Kubernetes çš„ SPIRE æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/spire-with-kubernetes.svg&#34; data-img=&#34;/blog/beyond-istio-oss/spire-with-kubernetes.svg&#34; alt=&#34;image&#34; data-caption=&#34;SPIRE éƒ¨ç½²åœ¨ Kubernetes ä¸­çš„æ¶æ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;SPIRE éƒ¨ç½²åœ¨ Kubernetes ä¸­çš„æ¶æ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;Istio ä¸­åŸå…ˆæ˜¯ä½¿ç”¨ Istiod ä¸­ Citadel æœåŠ¡ &lt;sup id=&#34;fnref:17&#34;&gt;&lt;a href=&#34;#fn:17&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;17&lt;/a&gt;&lt;/sup&gt; è´Ÿè´£æœåŠ¡ç½‘æ ¼ä¸­è¯ä¹¦ç®¡ç†ï¼Œé€šè¿‡ xDSï¼ˆå‡†ç¡®çš„è¯´æ˜¯ SDS APIï¼‰åè®®å°†è¯ä¹¦ä¸‹å‘ç»™æ•°æ®å¹³é¢ã€‚æœ‰äº† SPIRE ä¹‹åï¼Œè¯ä¹¦ç®¡ç†çš„å·¥ä½œå°±äº¤ç»™äº† SPIRE Serverã€‚SPIRE åŒæ ·æ”¯æŒ Envoy SDS APIï¼Œæˆ‘ä»¬åœ¨ Istio ä¸­å¯ç”¨ SPIRE ä¹‹åï¼Œè¿›å…¥å·¥ä½œè´Ÿè½½ Pod ä¸­çš„æµé‡åœ¨è¢«é€æ˜æ‹¦æˆªåˆ° Sidecar ä¸­åï¼Œä¼šç»è¿‡ä¸€æ¬¡èº«ä»½è®¤è¯ã€‚èº«ä»½è®¤è¯çš„ç›®çš„æ˜¯å¯¹æ¯”è¯¥å·¥ä½œè´Ÿè½½çš„èº«ä»½ï¼Œä¸å®ƒæ‰€è¿è¡Œçš„ç¯å¢ƒä¿¡æ¯ï¼ˆæ‰€åœ¨çš„èŠ‚ç‚¹ã€Pod çš„ ServiceAccount å’Œ Namespace ç­‰ï¼‰æ˜¯å¦ä¸€è‡´ï¼Œä»¥é˜²æ­¢ä¼ªé€ èº«ä»½ã€‚è¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/blog/how-to-integrate-spire-with-istio/&#34; title=&#34;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE&#34;&gt;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE&lt;/a&gt; ä»¥äº†è§£å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/support/k8s/k8s-workload-registrar/README.md&#34; title=&#34;Kubernetes Workload Registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Workload Registrar&lt;/a&gt; åœ¨ Kubernetes ä¸­éƒ¨ç½² SPIREï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ³¨å†Œ Kubernetes ä¸­çš„å·¥ä½œè´Ÿè½½å¹¶ç”Ÿæˆ SVIDã€‚è¯¥æ³¨å†Œæœºæ˜¯ Server-Agent æ¶æ„ï¼Œå®ƒåœ¨æ¯ä¸ª Node ä¸Šéƒ¨ç½²ä¸€ä¸ª SPIRE Agentï¼ŒAgent ä¸å·¥ä½œè´Ÿè½½é€šè¿‡å…±äº«çš„ UNIX Domain Socket é€šä¿¡ã€‚é›¶ä¿¡ä»»ç½‘ç»œä¸­æ¯ä¸ªæµé‡ä¼šè¯éƒ½éœ€è¦ç»è¿‡èº«ä»½è®¤è¯ï¼ŒIstio åœ¨é€æ˜æµé‡åŠ«æŒæ—¶ï¼ŒSidecar åŒæ—¶å¯¹æµé‡è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯ã€‚ä¸‹å›¾å±•ç¤ºäº†åœ¨ Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œèº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/workload-attestation.svg&#34; data-img=&#34;/blog/beyond-istio-oss/workload-attestation.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­åŸºäº SPIRE çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Istio ä¸­åŸºäº SPIRE çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œå·¥ä½œè´Ÿè½½è®¤è¯çš„æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·¥ä½œè´Ÿè½½çš„ sidecar ä¸­çš„ &lt;code&gt;pilot-agent&lt;/code&gt; é€šè¿‡å…±äº«çš„ UDS è°ƒç”¨ SPIRE Agent æ¥è·å– SVID å¹¶ç¼“å­˜åœ¨ SPIRE Agent ä¸­ç”¨äºåç»­èº«ä»½è®¤è¯ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE Agent è¯¢é—® Kubernetesï¼ˆå‡†ç¡®çš„è¯´æ˜¯èŠ‚ç‚¹ä¸Šçš„ kubeletï¼‰è·å–å·¥ä½œè´Ÿè½½çš„ä¿¡æ¯ï¼Œå¦‚æ‰€åœ¨çš„ namespaceã€èŠ‚ç‚¹åç§°ã€æœåŠ¡è´¦å·ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;Kubelet æŠŠä» API æœåŠ¡å™¨ä¸­æŸ¥è¯¢åˆ°çš„ä¿¡æ¯è¿”å›ç»™å·¥ä½œè´Ÿè½½éªŒè¯å™¨ï¼›&lt;/li&gt;
&lt;li&gt;éªŒè¯å™¨å°† kubelet è¿”å›çš„ç»“æœä¸ SPIRE æŸ¥è¯¢å¾—åˆ°çš„èº«ä»½ä¿¡æ¯æ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å°†æ­£ç¡®çš„ SVID ç¼“å­˜è¿”å›ç»™å·¥ä½œè´Ÿè½½ï¼Œå¦‚æœä¸åŒåˆ™è®¤è¯å¤±è´¥ï¼Œæ‹’ç»æµé‡è¯·æ±‚ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…³äºå·¥ä½œè´Ÿè½½çš„æ³¨å†Œå’Œè®¤è¯çš„è¯¦ç»†è¿‡ç¨‹è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/book/kubernetes-handbook/auth/spire/&#34; title=&#34;SPIRE æ–‡æ¡£&#34;&gt;SPIRE æ–‡æ¡£&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ngac&#34;&gt;NGAC&lt;/h3&gt;
&lt;p&gt;å½“æ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½æœ‰å‡†ç¡®çš„èº«ä»½ä¹‹åï¼Œå¦‚ä½•å¯¹è¿™äº›èº«ä»½çš„æƒé™è¿›è¡Œé™åˆ¶ï¼ŸKubernetes ä¸­é»˜è®¤ä½¿ç”¨ RBAC æ¥åšè®¿é—®æ§åˆ¶ï¼Œæ­£å¦‚å…¶åï¼Œè¿™ç§è®¿é—®æ§åˆ¶æ˜¯åŸºäºè§’è‰²çš„ï¼Œè™½ç„¶ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¯¹äºå¤§è§„æ¨¡é›†ç¾¤ï¼Œå­˜åœ¨è§’è‰²çˆ†ç‚¸é—®é¢˜ â€”â€” å³å­˜åœ¨å¤ªå¤šè§’è‰²ï¼Œè€Œä¸”è§’è‰²çš„ç±»å‹ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéš¾ä»¥å¯¹è§’è‰²æƒé™æœºå‹è·Ÿè¸ªå’Œå®¡è®¡ã€‚å¦å¤– RBAC ä¸­çš„è§’è‰²çš„è®¿é—®æƒé™æ˜¯å›ºå®šï¼Œæ²¡æœ‰è§„å®šçŸ­æš‚çš„ä½¿ç”¨æƒé™ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘ä½ç½®ã€æ—¶é—´æˆ–è®¾å¤‡ç­‰å±æ€§ã€‚ä½¿ç”¨ RBAC çš„ä¼ä¸šå¾ˆéš¾æ»¡è¶³å¤æ‚çš„è®¿é—®æ§åˆ¶è¦æ±‚ï¼Œä»¥æ»¡è¶³å…¶ä»–ç»„ç»‡éœ€æ±‚çš„ç›‘ç®¡è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;NGACï¼Œå³ä¸‹ä¸€ä»£è®¿é—®æ§åˆ¶ï¼Œé‡‡ç”¨å°†è®¿é—®å†³å®šæ•°æ®å»ºæ¨¡ä¸º DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰çš„æ–¹æ³•ã€‚NGAC å¯ä»¥å®ç°ç³»ç»ŸåŒ–ã€ç­–ç•¥ä¸€è‡´çš„è®¿é—®æ§åˆ¶æ–¹æ³•ï¼Œä»¥é«˜ç²¾ç»†åº¦æˆäºˆæˆ–æ‹’ç»ç”¨æˆ·ç®¡ç†èƒ½åŠ›ã€‚NGAC ç”± &lt;a href=&#34;https://www.nist.gov/&#34; title=&#34;NIST&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST&lt;/a&gt; ï¼ˆç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶æ‰€ï¼‰å¼€å‘ï¼Œç›®å‰å·²ç”¨äº &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt; ä¸­çš„æƒé™ç®¡ç†ã€‚å…³äºä¸ºä»€ä¹ˆé€‰æ‹© NGACï¼Œè€Œä¸æ˜¯ ABAC å’Œ RBAC çš„æ›´å¤šå†…å®¹è¯·å‚è€ƒåšå®¢&lt;a href=&#34;https://jimmysong.io/blog/why-you-should-choose-ngac-as-your-access-control-model/&#34; title=&#34;ä¸ºä»€ä¹ˆåº”è¯¥é€‰æ‹©ä½¿ç”¨ NGAC ä½œä¸ºæƒé™æ§åˆ¶æ¨¡å‹&#34;&gt;ä¸ºä»€ä¹ˆåº”è¯¥é€‰æ‹©ä½¿ç”¨ NGAC ä½œä¸ºæƒé™æ§åˆ¶æ¨¡å‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;hybrid-cloud&#34;&gt;æ··åˆäº‘&lt;/h2&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å‡ºäºè´Ÿè½½å‡è¡¡ã€éš”ç¦»å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒã€è§£è€¦æ•°æ®å¤„ç†å’Œæ•°æ®å­˜å‚¨ã€è·¨äº‘å¤‡ä»½å’Œç¾éš¾æ¢å¤ä»¥åŠé¿å…å‚å•†é”å®šç­‰åŸå› ï¼Œåœ¨å¤šç§ç¯å¢ƒä¸‹éƒ¨ç½²å¤šä¸ª Kubernetes é›†ç¾¤ã€‚Kubernetes ç¤¾åŒºæä¾›äº†ã€Œé›†ç¾¤è”é‚¦ã€åŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºå¤šé›†ç¾¤æ¶æ„ï¼Œä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ç§å¸¸ç”¨çš„ Kubernetes å¤šé›†ç¾¤æ¶æ„ï¼Œå…¶ä¸­ Host Cluster ä½œä¸ºæ§åˆ¶å¹³é¢ï¼Œæœ‰ä¸¤ä¸ªæˆå‘˜é›†ç¾¤ï¼Œåˆ†åˆ«æ˜¯ West å’Œ Eastã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/multicluster.svg&#34; data-img=&#34;/blog/beyond-istio-oss/multicluster.svg&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes é›†ç¾¤è”é‚¦æ¶æ„&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;Kubernetes é›†ç¾¤è”é‚¦æ¶æ„&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;é›†ç¾¤è”é‚¦è¦æ±‚ Host é›†ç¾¤ä¸æˆå‘˜é›†ç¾¤çš„ä¹‹é—´çš„ç½‘ç»œèƒ½å¤Ÿäº’é€šï¼Œå¯¹æˆå‘˜é›†ç¾¤ä¹‹é—´çš„ç½‘ç»œè¿æ¥æ€§æ²¡æœ‰è¦æ±‚ã€‚Host é›†ç¾¤ä½œä¸º API å…¥å£ï¼Œå¤–ç•Œæ‰€æœ‰å¯¹ Host é›†ç¾¤çš„èµ„æºè¯·æ±‚ä¼šè½¬å‘åˆ°æˆå‘˜é›†ç¾¤ä¸­ã€‚Host é›†ç¾¤ä¸­éƒ¨ç½²æœ‰é›†ç¾¤è”é‚¦çš„æ§åˆ¶å¹³é¢ï¼Œå…¶ä¸­çš„ã€ŒPush Reconcilerã€ä¼šå°†è”é‚¦ä¸­çš„èº«ä»½ã€è§’è‰²åŠè§’è‰²ç»‘å®šä¼ æ’­åˆ°æ‰€æœ‰çš„æˆå‘˜é›†ç¾¤ä¸­ã€‚é›†ç¾¤è”é‚¦åªæ˜¯ç®€å•åœ°å°†å¤šä¸ªé›†ç¾¤ç®€å•çš„ã€Œè¿æ¥åˆ°äº†ä¸€èµ·ã€ï¼Œåœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´å¤åˆ¶å·¥ä½œè´Ÿè½½ï¼Œè€Œæˆå‘˜é›†ç¾¤ä¹‹é—´çš„æµé‡æ— æ³•è°ƒåº¦ï¼Œä¹Ÿæ— æ³•å®ç°çœŸæ­£çš„å¤šç§Ÿæˆ·ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤è”é‚¦ä¸è¶³ä»¥å®ç°æ··åˆäº‘ï¼Œä¸ºäº†å®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„æ··åˆäº‘ï¼Œå°±è¦è®©é›†ç¾¤ä¹‹é—´åšåˆ°äº’è”äº’é€šï¼ŒåŒæ—¶å®ç°å¤šç§Ÿæˆ·ã€‚TSB åœ¨ Istio ä¹‹ä¸Šæ„å»ºä¸€ä¸ªå¤šé›†ç¾¤ç®¡ç†çš„é€šç”¨æ§åˆ¶å¹³é¢ï¼Œç„¶åå†å¢åŠ ä¸€ä¸ªç®¡ç†å¹³é¢æ¥ç®¡ç†å¤šé›†ç¾¤ï¼Œæä¾›å¤šç§Ÿæˆ·ã€ç®¡ç†é…ç½®ã€å¯è§‚æµ‹æ€§ç­‰åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯ Istio ç®¡ç†å¹³é¢çš„å¤šç§Ÿæˆ·å’Œ API ç¤ºæ„å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/tsb-management-plane.svg&#34; data-img=&#34;/blog/beyond-istio-oss/tsb-management-plane.svg&#34; alt=&#34;image&#34; data-caption=&#34;TSB åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„ç®¡ç†å¹³é¢ç¤ºæ„å›¾&#34;&gt;
        
      
    
  
  
  &lt;figcaption&gt;TSB åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„ç®¡ç†å¹³é¢ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;TSB ä¸ºç®¡ç†æ··åˆäº‘ï¼ŒåŸºäº Istio æ„å»ºäº†ä¸€ä¸ªç®¡ç†å¹³é¢ï¼Œæ–°å»ºäº† Tenant å’Œ Workspace çš„èµ„æºï¼Œå¹¶é€šè¿‡é€‰æ‹©å™¨ï¼Œå°†ç½‘å…³ç»„ã€æµé‡ç»„å’Œå®‰å…¨ç»„åº”ç”¨åˆ°å¯¹åº”é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½ä¸Šã€‚å…³äº TSB çš„è¯¦ç»†æ¶æ„è¯·å‚è€ƒ TSB æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;more&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Istio å’Œäº‘åŸç”Ÿçš„å†…å®¹ï¼Œä¸‹é¢æœ‰ä¸€äº›èµ„æ–™åˆ†äº«ç»™ä½ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½çš„äº†è§£ Istio å’Œäº‘åŸç”Ÿï¼Œç¬”è€…åœ¨ 2020 å¹´å‘èµ·äº†&lt;a href=&#34;https://cloudnative.to&#34; title=&#34;äº‘åŸç”Ÿç¤¾åŒº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº&lt;/a&gt;ï¼Œæ¬¢è¿å¤§å®¶åŠ å…¥æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å Kubernetes æ—¶ä»£çš„äº‘åŸç”Ÿæ–°èŒƒå¼ï¼›&lt;/li&gt;
&lt;li&gt;2022 å¹´ 6 æœˆï¼Œäº‘åŸç”Ÿç¤¾åŒºè‘—çš„&lt;a href=&#34;https://jimmysong.io/blog/istio-service-mesh-book/&#34; title=&#34;ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹&#34;&gt;ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹&lt;/a&gt;å·²å›¾ä¹¦ç”±ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆï¼Œæ¬¢è¿å¤§å®¶è´­ä¹°ï¼›&lt;/li&gt;
&lt;li&gt;ç¬”è€…äº 2022 å¹´ 5 æœˆï¼Œå°†ä¹‹å‰æ‰€ä½œç”µå­ä¹¦ã€æ•™ç¨‹å’Œè¯‘æ–‡å…¨éƒ¨è¿ç§»åˆ°äº†&lt;a href=&#34;https://jimmysong.io/book/&#34; title=&#34;äº‘åŸç”Ÿèµ„æ–™åº“&#34;&gt;äº‘åŸç”Ÿèµ„æ–™åº“&lt;/a&gt;æ¬¢è¿é˜…è¯»å’Œç•™è¨€è¯„è®ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;æœ‰å…³ Envoy å¼€æºçš„è¯¦ç»†è¿‡ç¨‹ï¼Œæ¨èä½ é˜…è¯» Envoy ä½œè€… Matt Klein çš„è¿™ç¯‡æ–‡ç« &lt;a href=&#34;https://cloudnative.to/blog/envoy-oss-5-year/&#34; title=&#34;ç½‘ç»œä»£ç† Envoy å¼€æºäº”å‘¨å¹´ï¼Œåˆ›å§‹äºº Matt Klein äº²è¿°å¼€æºå¿ƒè·¯å†ç¨‹åŠç»éªŒæ•™è®­&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œä»£ç† Envoy å¼€æºäº”å‘¨å¹´ï¼Œåˆ›å§‹äºº Matt Klein äº²è¿°å¼€æºå¿ƒè·¯å†ç¨‹åŠç»éªŒæ•™è®­&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;åæ¥ IBM ä¸ Google åç›®ï¼Œå¤§ä¸¾æŠ¨å‡» Google æ²¡æœ‰éµå®ˆå°† Istio æçŒ®ç»™ CNCF çš„çº¦å®šï¼ŒGoogle å¯¹ Istio å•†æ ‡çš„ç®¡ç†ä¹Ÿå—åˆ°äº†&lt;a href=&#34;https://thenewstack.io/googles-management-of-the-istio-service-mesh-raises-questions-in-the-cloud-native-community/&#34; title=&#34;è´¨ç–‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¨ç–‘&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;2018 å¹´ï¼ŒCNCF ä¸ºäº‘åŸç”Ÿçš„é‡æ–°å®šä¹‰æ˜¯ï¼šäº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ APIã€‚&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;Day-2 Operation æ˜¯åœ¨ç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸç»“æŸå‰ï¼Œå¯¹ç³»ç»Ÿä¸æ–­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œä»¥å®ç°æ•ˆç›Šæœ€å¤§åŒ–ã€‚å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/blog/what-is-day-2-operation/&#34; title=&#34;ä»€ä¹ˆæ˜¯ Day-2 Operation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ Day-2 Operation&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34;&gt;
&lt;p&gt;Istio ç°å·²æ¨å‡º proxyless æ¨¡å¼æµ‹è¯•ç‰ˆï¼Œè¯¦è§ &lt;a href=&#34;https://cloudnative.to/blog/grpc-proxyless-service-mesh/&#34; title=&#34;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34;&gt;
&lt;p&gt;Kubernetes é¢„è®¡æ¨å‡º &lt;a href=&#34;https://jimmysong.io/book/kubernetes-handbook/service-discovery/gateway/&#34; title=&#34;Gateway API&#34;&gt;Gateway API&lt;/a&gt;ï¼ŒIstio ä¹Ÿæœ‰è®¡åˆ’ä½¿ç”¨ Kubernetes çš„ Gateway API æ›¿æ¢å½“å‰ Istio è‡ªå®šä¹‰çš„ Gateway èµ„æºã€‚&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34;&gt;
&lt;p&gt;æœ‰å…³æœåŠ¡ç½‘æ ¼é¡¹ç›®çš„è¯¦ç»†å¯¹æ¯”è¯·å‚è€ƒ &lt;a href=&#34;https://servicemesh.es/&#34; title=&#34;servicemesh.es&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;servicemesh.es&lt;/a&gt; ç½‘ç«™ã€‚&amp;#160;&lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34;&gt;
&lt;p&gt;åœ¨ç™¾åº¦çš„æœåŠ¡ç½‘æ ¼å›¢é˜Ÿåˆ†äº«çš„ &lt;a href=&#34;https://mp.weixin.qq.com/s/G8vmlJyaimux_K-548kFbA&#34; title=&#34;æ®Šé€”åŒå½’ï¼ŒProxyless Service Mesh åœ¨ç™¾åº¦çš„å®è·µä¸æ€è€ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ®Šé€”åŒå½’ï¼ŒProxyless Service Mesh åœ¨ç™¾åº¦çš„å®è·µä¸æ€è€ƒ&lt;/a&gt; è¿™ç¯‡æ–‡ç« é‡Œï¼Œè¯¦ç»†ä»‹ç»äº†ç™¾åº¦çš„æœåŠ¡ç½‘æ ¼é‡‡ç”¨è·¯å¾„ï¼Œä»¥åŠå¯¹æœåŠ¡ç½‘æ ¼æœ¬è´¨çš„æ¢ç´¢ã€‚&amp;#160;&lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34;&gt;
&lt;p&gt;Apache SkyWalking çš„ Rover ç»„ä»¶åˆ©ç”¨ eBPF æŠ€æœ¯æ”¹è¿›äº† SkyWalking çš„å‰–æåŠŸèƒ½ï¼Œå¯ç”¨äºåˆ†ææœåŠ¡ç½‘æ ¼çš„æ€§èƒ½é—®é¢˜ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://cloudnative.to/blog/pinpoint-service-mesh-critical-performance-impact-by-using-ebpf/&#34; title=&#34;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34;&gt;
&lt;p&gt;å…³äº xDS åè®®ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://cloudnative.to/blog/envoy-xds-protocol/&#34; title=&#34;Envoy ä¸­çš„ xDS REST å’Œ gRPC åè®®è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­çš„ xDS REST å’Œ gRPC åè®®è¯¦è§£&lt;/a&gt; è¿™ç¯‡æ–‡ç« ã€‚&amp;#160;&lt;a href=&#34;#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:11&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.oreilly.com/library/view/network-access-control/9780470398678/9780470398678_policy_enforcement_point.html&#34; title=&#34;PEP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PEP&lt;/a&gt;ï¼Œå…¨ç§° Policy Enforcement Pointï¼Œç­–ç•¥æ‰§è¡Œç‚¹ï¼ˆPEPï¼‰æ˜¯æ§åˆ¶ç”¨æˆ·è®¿é—®å¹¶ç¡®ä¿ç­–ç•¥å†³ç­–ç‚¹ (PDP) åšå‡ºæˆæƒå†³ç­–çš„ç½‘ç»œæˆ–å®‰å…¨è®¾å¤‡ã€‚åœ¨ä¸€äº› NAC å®ç°ä¸­ï¼ŒPDP æ˜¯æœ‰çº¿äº¤æ¢æœºæˆ–æ— çº¿æ¥å…¥ç‚¹ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼ŒPEP æ˜¯é˜²ç«å¢™ã€IPSã€æœåŠ¡å™¨æˆ–å†…è”è®¾å¤‡ã€‚æ ¹æ®å®æ–½æƒ…å†µï¼ŒPEP å’Œ PDP å¯ä»¥æ˜¯ç‹¬ç«‹è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥åˆå¹¶ä¸ºå•ä¸ªè®¾å¤‡ã€‚&amp;#160;&lt;a href=&#34;#fnref:11&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:12&#34;&gt;
&lt;p&gt;æœ‰å¤šå®¶å…¬å¸æ­£åœ¨åˆä½œå¼€å‘ Envoy Gatewayï¼ŒåŒ…æ‹¬ &lt;a href=&#34;https://www.getambassador.io/&#34; title=&#34;Ambassador Labs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ã€&lt;a href=&#34;https://www.fidelity.com/&#34; title=&#34;Fidelity Investments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fidelity Investments&lt;/a&gt;ã€&lt;a href=&#34;https://projectcontour.io/&#34; title=&#34;Project Contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Project Contour&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.vmware.com/&#34; title=&#34;VMware&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:12&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:13&#34;&gt;
&lt;p&gt;SidecarScope æ˜¯åœ¨ Istio 1.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç›´æ¥é¢å‘ç”¨æˆ·çš„é…ç½®é¡¹ï¼Œè€Œæ˜¯ Sidecar èµ„æºçš„åŒ…è£…å™¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ Sidecar èµ„æºä¸­çš„ &lt;code&gt;egress&lt;/code&gt; é€‰é¡¹ã€‚é€šè¿‡è¯¥é…ç½®å¯ä»¥å‡å°‘ Istio å‘ Sidecar ä¸‹å‘çš„æ•°æ®é‡ï¼Œä¾‹å¦‚åªå‘æŸä¸ªå‘½åç©ºé—´ä¸­çš„æŸäº›æœåŠ¡ä¸‹å‘æŸäº› hosts çš„è®¿é—®é…ç½®ï¼Œä»è€Œæé«˜åº”ç”¨æé«˜æ€§èƒ½ã€‚&amp;#160;&lt;a href=&#34;#fnref:13&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:14&#34;&gt;
&lt;p&gt;Istio ä»…å¯ä»¥è·¯ç”± TCP æµé‡ï¼Œé»˜è®¤æ”¯æŒ HTTPã€HTTPSã€gRPC å’ŒåŸå§‹ TCP åè®®ï¼Œå…¶ä¸­ Sidecar å’Œ Gateway æ‰€æ”¯æŒçš„åè®®èŒƒå›´æœ‰æ‰€ä¸åŒï¼Œè¯¦è§ &lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:14&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:15&#34;&gt;
&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; æ˜¯ sidecar å®¹å™¨ä¸­çš„ä¸»è¿›ç¨‹ï¼Œä½ å¯ä»¥åœ¨ &lt;a href=&#34;#istio-components&#34; title=&#34;Istio çš„ç»„æˆæ¶æ„å›¾&#34;&gt;Istio çš„ç»„æˆæ¶æ„å›¾&lt;/a&gt;ä¸­çœ‹åˆ°ã€‚&lt;code&gt;pilot-agent&lt;/code&gt; ä¸­çš„é•œåƒæå–æœºåˆ¶ï¼ˆåœ¨ Istio 1.9 ä¸­å¼•å…¥ï¼‰ï¼Œä»è¿œç¨‹ HTTP æºå¯é åœ°æ£€ç´¢ Wasm äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå·²è¢«æ‰©å±•åˆ°æ”¯æŒä»ä»»ä½• OCI æ³¨å†Œå¤„æ£€ç´¢ Wasm OCI é•œåƒï¼ŒåŒ…æ‹¬ Docker Hubã€Google Container Registryï¼ˆGCRï¼‰ã€Amazon Elastic Container Registryï¼ˆAmazon ECRï¼‰å’Œå…¶ä»–åœ°æ–¹ã€‚&amp;#160;&lt;a href=&#34;#fnref:15&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:16&#34;&gt;
&lt;p&gt;ã€Š&lt;a href=&#34;https://cloudnative.to/blog/ebpf-solve-service-mesh-sidecar/&#34; title=&#34;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&lt;/a&gt;ã€‹è¿™ç¯‡æ–‡ç« åœ¨äº‘åŸç”Ÿç¤¾åŒºé‡Œå¼•èµ·äº†ä¸€ç³»åˆ—å…³äºæœåŠ¡ç½‘æ ¼å°†è¢« eBPF æŠ€æœ¯æ‰€å–ä»£çš„è®¨è®ºã€‚&lt;a href=&#34;https://jimmysong.io/blog/epbf-sidecar-and-service-mesh/&#34; title=&#34;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecar æ¨¡å¼çš„å¹»æƒ³&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecar æ¨¡å¼çš„å¹»æƒ³&lt;/a&gt;ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ eBPFï¼Œåœ¨å¯é¢„è§çš„æœªæ¥ï¼ŒæœåŠ¡ç½‘æ ¼éƒ½ä¼šåŸºäºè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ sidecar ä»£ç†ï¼ˆproxyless æ¨¡å¼é™¤å¤–ï¼‰ã€‚&amp;#160;&lt;a href=&#34;#fnref:16&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:17&#34;&gt;
&lt;p&gt;Istio å…·æœ‰èº«ä»½å’Œè¯ä¹¦ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å®ç°æœåŠ¡é—´çš„ç»ˆç«¯ç”¨æˆ·è®¤è¯ï¼Œåœ¨æ§åˆ¶å¹³é¢è¿˜é‡‡ç”¨å¾®æœåŠ¡æ¶æ„çš„æ—¶å€™ï¼Œå…¶ä¸­çš„ Citadel ç»„ä»¶è´Ÿè´£è¯ä¹¦ç®¡ç†ï¼Œåœ¨ Istio 1.5 ç‰ˆæœ¬è¢«åˆå¹¶åˆ°å•ä½“ Istiod ä¸­äº†ã€‚&amp;#160;&lt;a href=&#34;#fnref:17&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;

      </description>
    </item>
                           
    <item>
      <title>è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecar æ¨¡å¼çš„å¹»æƒ³</title>
      <link>https://jimmysong.io/blog/ebpf-sidecar-and-service-mesh/</link>
      <pubDate>Sat, 11 Jun 2022 11:08:49 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/blog/ebpf-sidecar-and-service-mesh/</guid>
      <description>
        
        
        &lt;p&gt;æœ€è¿‘ eBPF æŠ€æœ¯åœ¨äº‘åŸç”Ÿç¤¾åŒºä¸­æŒç»­ç«çƒ­ï¼Œåœ¨æˆ‘ç¿»è¯‘äº†ã€Š&lt;a href=&#34;https://jimmysong.io/book/what-is-ebpf/&#34; title=&#34;ä»€ä¹ˆæ˜¯ eBPF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ eBPF&lt;/a&gt;ã€‹ä¹‹åï¼Œå½“é˜…è¯»â€œäº‘åŸç”Ÿç¯å¢ƒä¸­çš„ eBPFâ€ä¹‹åå°±ä¸€ç›´åœ¨æ€è€ƒ eBPF åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­ç©¶ç«Ÿå¤„äºä»€ä¹ˆåœ°ä½ï¼Œå‘æŒ¥ä»€ä¹ˆæ ·çš„ä½œç”¨ã€‚å½“æ—¶æˆ‘è¯„è®ºè¯´â€œeBPF å¼€å¯äº†ä¸Šå¸è§†è§’ï¼Œå¯ä»¥çœ‹åˆ°ä¸»æœºä¸Šæ‰€æœ‰çš„æ´»åŠ¨ï¼Œè€Œ sidecar åªèƒ½è§‚æµ‹åˆ° pod å†…çš„æ´»åŠ¨ï¼Œåªè¦æå¥½è¿›ç¨‹éš”ç¦»ï¼ŒåŸºäº eBPF çš„ proxy per-node æ‰æ˜¯æœ€ä½³é€‰æ‹©â€ï¼Œå†çœ‹åˆ° William Morgan çš„&lt;a href=&#34;https://buoyant.io/2022/06/07/ebpf-sidecars-and-the-future-of-the-service-mesh/&#34; title=&#34;è¿™ç¯‡æ–‡ç« &#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt; &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ä¹‹åï¼Œè®©æˆ‘æç„¶å¤§æ‚Ÿã€‚ä¸‹é¢èŠ‚é€‰ç¿»è¯‘äº†æ–‡ç« æˆ‘æ¯”ç»ŸåŒæ„çš„è§‚ç‚¹ï¼Œå³ eBPF æ— æ³•æ›¿ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecarï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯» William çš„åŸæ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-ebpf&#34;&gt;ä»€ä¹ˆæ˜¯ eBPF&lt;/h2&gt;
&lt;p&gt;åœ¨è¿‡å»ï¼Œå¦‚æœä½ æƒ³è®©åº”ç”¨ç¨‹åºå¤„ç†ç½‘ç»œæ•°æ®åŒ…ï¼Œé‚£æ˜¯ä¸å¯èƒ½çš„ã€‚å› ä¸ºåº”ç”¨ç¨‹åºè¿è¡Œåœ¨ Linux ç”¨æˆ·ç©ºé—´ï¼Œå®ƒæ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ä¸»æœºçš„ç½‘ç»œç¼“å†²åŒºã€‚ç¼“å†²åŒºæ˜¯ç”±å†…æ ¸ç®¡ç†çš„ï¼Œå—åˆ°å†…æ ¸ä¿æŠ¤ï¼Œå†…æ ¸éœ€è¦ç¡®ä¿è¿›ç¨‹éš”ç¦»ï¼Œè¿›ç¨‹ä¹‹é—´ä¸èƒ½ç›´æ¥è¯»å–å¯¹æ–¹çš„ç½‘ç»œæ•°æ®åŒ…ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆsyscallï¼‰æ¥è¯·æ±‚ç½‘ç»œæ•°æ®åŒ…ä¿¡æ¯ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯å†…æ ¸ API è°ƒç”¨â€”â€”åº”ç”¨ç¨‹åºè°ƒç”¨ syscallï¼Œå†…æ ¸æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰æƒé™è·å¾—å…¶è¯·æ±‚çš„æ•°æ®åŒ…ï¼›å¦‚æœæœ‰ï¼Œå°±æŠŠè¿”å›æ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº† eBPF ä¹‹åï¼Œåº”ç”¨ç¨‹åºä¸å†éœ€è¦ syscallï¼Œæ•°æ®åŒ…ä¸éœ€è¦åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´æ¥å›äº¤äº’ä¼ é€’ã€‚è€Œæ˜¯æˆ‘ä»¬å°†ä»£ç ç›´æ¥äº¤ç»™å†…æ ¸ï¼Œè®©å†…æ ¸è‡ªå·±æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥è®©ä»£ç å…¨é€Ÿè¿è¡Œï¼Œæ•ˆç‡æ›´é«˜ã€‚eBPF å…è®¸åº”ç”¨ç¨‹åºå’Œå†…æ ¸ä»¥å®‰å…¨çš„æ–¹å¼å…±äº«å†…å­˜ï¼ŒeBPF å…è®¸åº”ç”¨ç¨‹åºç›´æ¥å‘å†…æ ¸æäº¤ä»£ç ï¼Œç›®æ ‡éƒ½æ˜¯é€šè¿‡è¶…è¶Šç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ¥å®ç°æ€§èƒ½æå‡ã€‚&lt;/p&gt;
&lt;p&gt;eBPF ä¸æ˜¯é“¶å¼¹ï¼Œä½ ä¸èƒ½ç”¨ eBPF è¿è¡Œä»»æ„ç¨‹åºï¼Œå®é™…ä¸Š eBPF å¯ä»¥åšçš„äº‹æƒ…æ˜¯éå¸¸æœ‰é™çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-çš„å±€é™æ€§&#34;&gt;eBPF çš„å±€é™æ€§&lt;/h2&gt;
&lt;p&gt;eBPF çš„å±€é™æ€§ä¹Ÿæ˜¯å› ä¸ºå†…æ ¸é€ æˆçš„ã€‚å†…æ ¸ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºåº”å½“æœ‰è‡ªå·±çš„ç§Ÿæˆ·ï¼Œè¿™äº›ç§Ÿæˆ·ä¹‹é—´ä¼šäº‰æŠ¢ç³»ç»Ÿçš„å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œï¼Œå†…æ ¸çš„èŒè´£å°±æ˜¯éš”ç¦»å’Œè°ƒåº¦è¿™äº›åº”ç”¨ç¨‹åºçš„èµ„æºï¼ŒåŒæ—¶å†…æ ¸è¿˜è¦ä¿æŠ¤ç¡®è®¤åº”ç”¨ç¨‹åºçš„æƒé™ï¼Œä¿æŠ¤å…¶ä¸è¢«å…¶ä»–ç¨‹åºç ´åã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬ç›´æ¥å°† eBPF ä»£ç äº¤ç»™å†…æ ¸æ‰§è¡Œï¼Œè¿™ç»•è¿‡äº†å†…æ ¸å®‰å…¨ä¿æŠ¤ï¼ˆå¦‚ syscallï¼‰ï¼Œå†…æ ¸å°†é¢ä¸´ç›´æ¥çš„å®‰å…¨é£é™©ã€‚ä¸ºäº†ä¿æŠ¤å†…æ ¸ï¼Œæ‰€æœ‰ eBPF ç¨‹åºè¦æƒ³è¿è¡Œéƒ½å¿…é¡»å…ˆé€šè¿‡ä¸€ä¸ª&lt;strong&gt;éªŒè¯å™¨&lt;/strong&gt;ã€‚ä½†æ˜¯è¦æƒ³è‡ªåŠ¨éªŒè¯ç¨‹åºæ˜¯å¾ˆå›°éš¾çš„ï¼ŒéªŒè¯å™¨å¯èƒ½ä¼šè¿‡åº¦é™åˆ¶ç¨‹åºçš„åŠŸèƒ½ã€‚æ¯”å¦‚ eBPF ç¨‹åºä¸èƒ½æ˜¯é˜»å¡çš„ï¼Œä¸èƒ½æœ‰æ— é™å¾ªç¯ï¼Œä¸èƒ½è¶…è¿‡é¢„å®šçš„å¤§å°ï¼›å…¶å¤æ‚æ€§ä¹Ÿå—åˆ°é™åˆ¶ï¼ŒéªŒè¯å™¨ä¼šè¯„ä¼°æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼Œå¦‚æœ eBPF ç¨‹åºä¸èƒ½åœ¨æŸäº›èŒƒå›´å†…å®Œæˆï¼Œæˆ–è€…ä¸èƒ½è¯æ˜æ¯ä¸ªå¾ªç¯éƒ½æœ‰ä¸€ä¸ªé€€å‡ºæ¡ä»¶ï¼Œé‚£ä¹ˆéªŒè¯å™¨å°±ä¸ä¼šå…è®¸è¯¥ç¨‹åºè¿è¡Œã€‚æœ‰å¾ˆå¤šåº”ç”¨ç¨‹åºéƒ½è¿åäº†è¿™äº›é™åˆ¶ï¼Œè¦æƒ³å°†å®ƒä»¬ä½œä¸º eBPF ç¨‹åºæ¥è¿è¡Œçš„è¯ï¼Œè¦ä¹ˆé‡å†™ä»¥æ»¡è¶³éªŒè¯å™¨çš„éœ€æ±‚ï¼Œè¦ä¹ˆç»™å†…æ ¸æ‰“è¡¥ä¸ï¼Œæ¥ç»•è¿‡ä¸€äº›éªŒè¯ï¼ˆè¿™å¯èƒ½æ¯”è¾ƒå›°éš¾ï¼‰ã€‚ä¸è¿‡éšç€å†…æ ¸ç‰ˆæœ¬çš„å‡çº§ï¼Œè¿™äº›éªŒè¯å™¨ä¹Ÿå˜å¾—æ›´åŠ æ™ºèƒ½ï¼Œé™åˆ¶ä¹Ÿé€æ¸å˜å¾—å®½æ¾ï¼Œä¹Ÿæœ‰ä¸€äº›åˆ›é€ æ€§çš„æ–¹æ³•æ¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ€»çš„æ¥è¯´ï¼ŒeBPF ç¨‹åºèƒ½åšçš„äº‹æƒ…éå¸¸æœ‰é™ã€‚å¯¹äºä¸€äº›é‡é‡çº§äº‹ä»¶çš„å¤„ç†ï¼Œä¾‹å¦‚å¤„ç†å…¨å±€èŒƒå›´å†…çš„ HTTP/2 æµé‡ï¼Œæˆ–è€… TLS æ¡æ‰‹åå•†ä¸èƒ½åœ¨çº¯ eBPF ç¯å¢ƒä¸­å®Œæˆã€‚å……å…¶é‡ï¼ŒeBPF å¯ä»¥åšå…¶ä¸­çš„ä¸€å°éƒ¨åˆ†å·¥ä½œï¼Œç„¶åè°ƒç”¨ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºæ¥å¤„ç†å¯¹äº eBPF æ¥è¯´è¿‡äºå¤æ‚è€Œæ— æ³•å¤„ç†çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-ä¸æœåŠ¡ç½‘æ ¼çš„å…³ç³»&#34;&gt;eBPF ä¸æœåŠ¡ç½‘æ ¼çš„å…³ç³»&lt;/h2&gt;
&lt;p&gt;å› ä¸ºä¸Šæ–‡æ‰€è¿°çš„ eBPF çš„å„é¡¹é™åˆ¶ï¼Œä¸ƒå±‚æµé‡ä»ç„¶éœ€è¦ç”¨æˆ·ç©ºé—´çš„ç½‘ç»œä»£ç†æ¥å®Œæˆï¼ŒeBPF å¹¶ä¸èƒ½æ›¿ä»£æœåŠ¡ç½‘æ ¼ã€‚eBPF å¯ä»¥ä¸ CNIï¼ˆå®¹å™¨ç½‘ç»œæ¥å£ï¼‰ä¸€èµ·è¿è¡Œï¼Œå¤„ç†ä¸‰å±‚/å››å±‚æµé‡ï¼Œè€ŒæœåŠ¡ç½‘æ ¼å¤„ç†ä¸ƒå±‚æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¯ä¸ªä¸»æœºä¸€ä¸ªä»£ç†çš„æ¨¡å¼æ¯”-sidecar-æ›´ç³Ÿ&#34;&gt;æ¯ä¸ªä¸»æœºä¸€ä¸ªä»£ç†çš„æ¨¡å¼æ¯” sidecar æ›´ç³Ÿ&lt;/h2&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ªä¸»æœºä¸€ä¸ªä»£ç†ï¼ˆper-hostï¼‰çš„æ¨¡å¼ï¼ŒæœåŠ¡ç½‘æ ¼çš„æ—©æœŸå®è·µè€… Linkerd 1.x å°±æ˜¯è¿™ä¹ˆç”¨çš„ï¼Œç¬”è€…ä¹Ÿæ˜¯ä»é‚£ä¸ªæ—¶å€™å¼€å§‹å…³æ³¨æœåŠ¡ç½‘æ ¼ï¼ŒLinkerd 1.x è¿˜ä½¿ç”¨äº† JVM è™šæ‹Ÿæœºï¼ä½†æ˜¯ç»è¿‡ Linkerd 1.x çš„ç”¨æˆ·å®è·µè¯æ˜ï¼Œè¿™ç§æ¨¡å¼ç›¸å¯¹äº sidecar æ¨¡å¼ï¼Œå¯¹äºè¿ç»´å’Œå®‰å…¨æ¥è¯´ä¼šæ›´ç³Ÿç³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¯´ sidecar æ¨¡å¼æ¯” per-host æ¨¡å¼æ›´å¥½å‘¢ï¼Ÿå› ä¸º sidecar æ¨¡å¼æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼Œè¿™æ˜¯ per-host æ¨¡å¼æ‰€ä¸å…·å¤‡çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»£ç†çš„èµ„æºæ¶ˆè€—éšç€åº”ç”¨ç¨‹åºçš„è´Ÿè½½è€Œå˜åŒ–ã€‚éšç€å®ä¾‹æµé‡çš„å¢åŠ ï¼Œsidecar ä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æºï¼Œå°±åƒåº”ç”¨ç¨‹åºä¸€æ ·ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„æµé‡éå¸¸å°ï¼Œé‚£ä¹ˆ sidecar å°±ä¸éœ€è¦æ¶ˆè€—å¾ˆå¤šèµ„æºã€‚Kubernetes ç°æœ‰çš„ç®¡ç†èµ„æºæ¶ˆè€—çš„æœºåˆ¶ï¼Œå¦‚èµ„æºè¯·æ±‚å’Œé™åˆ¶ä»¥åŠ OOM killï¼Œéƒ½ä¼šç»§ç»­å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç†å¤±è´¥çš„çˆ†ç‚¸åŠå¾„åªé™äºä¸€ä¸ª podã€‚ä»£ç†å¤±è´¥ä¸åº”ç”¨å¤±è´¥ç›¸åŒï¼Œç”± Kubernetes è´Ÿè´£å¤„ç†å¤±è´¥çš„ podã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç†ç»´æŠ¤ã€‚ä¾‹å¦‚ä»£ç†ç‰ˆæœ¬çš„å‡çº§ï¼Œæ˜¯é€šè¿‡å¦‚æ»šåŠ¨æ›´æ–°ï¼Œç°åº¦å‘å¸ƒç­‰åº”ç”¨ç¨‹åºæœ¬èº«ç›¸åŒçš„æœºåˆ¶å®Œæˆçš„ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨è¾¹ç•Œå¾ˆæ¸…æ¥šï¼ˆè€Œä¸”å¾ˆå°ï¼‰ï¼šåœ¨ pod çº§åˆ«ã€‚Sidecar åœ¨åº”ç”¨ç¨‹åºå®ä¾‹çš„åŒä¸€å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚å®ƒæ˜¯ pod çš„ä¸€éƒ¨åˆ†ï¼Œä¸åº”ç”¨ç¨‹åºå…·æœ‰ä¸€æ ·çš„ IP åœ°å€ã€‚Sidecar æ‰§è¡Œç­–ç•¥ï¼Œå¹¶å°† mTLS åº”ç”¨äºè¿›å‡ºè¯¥ pod çš„æµé‡ï¼Œè€Œä¸”å®ƒåªéœ€è¦è¯¥ pod çš„å¯†é’¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œå¯¹äº per-host æ¨¡å¼ï¼Œå°±æ²¡æœ‰ä¸Šè¿°å¥½å¤„äº†ã€‚ä»£ç†ä¸åº”ç”¨ç¨‹åº pod å®Œå…¨è§£è€¦ï¼Œå¤„ç†ä¸»æœºä¸Šæ‰€æœ‰ pod çš„æµé‡ï¼Œè¿™æ ·ä¼šä»£ç†å„ç§é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»£ç†æ¶ˆè€—çš„èµ„æºæ˜¯é«˜åº¦å¯å˜çš„ï¼Œè¿™å–å†³äºåœ¨æŸä¸ªæ—¶é—´ç‚¹ Kubernetes è°ƒåº¦äº†å¤šå°‘ä¸ª pod åœ¨è¯¥ä¸»æœºä¸Šã€‚ä½ æ— æ³•æœ‰æ•ˆçš„é¢„æµ‹ç‰¹å®šä»£ç†çš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œè¿™æ ·ä»£ç†å°±æœ‰å´©æºƒçš„é£é™©ï¼ˆåŸæ–‡æ˜¯è¿™ä¹ˆè¯´çš„ï¼Œè¿™ç‚¹ç¬”è€…è¿˜æ˜¯å­˜ç–‘çš„ï¼Œå¸Œæœ›æœ‰ç‚¹è¯»è€…èƒ½è§£å¸®å¿™è§£é‡Šä¸‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»æœºä¸Š pod ä¹‹é—´çš„æµé‡äº‰æŠ¢é—®é¢˜ã€‚å› ä¸ºä¸»æœºä¸Šçš„æ‰€æœ‰æµé‡éƒ½ç»è¿‡åŒä¸€ä¸ªä»£ç†ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åº pod çš„æµé‡æé«˜ï¼Œæ¶ˆè€—äº†ä»£ç†çš„æ‰€æœ‰èµ„æºï¼Œä¸»æœºä¸Šçš„å…¶ä»–åº”ç”¨ç¨‹åºå°±æœ‰è¢«é¥¿æ­»çš„å±é™©ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç†çš„çˆ†ç‚¸åŠå¾„å¾ˆå¤§ï¼Œè€Œä¸”æ˜¯ä¸æ–­å˜åŒ–çš„ã€‚ä»£ç†çš„æ•…éšœå’Œå‡çº§ç°åœ¨å½±å“åˆ°éšæœºçš„åº”ç”¨ç¨‹åºé›†åˆä¸­çš„ä¸€ä¸ªéšæœºçš„ pod å­é›†ï¼Œæ„å‘³ç€ä»»ä½•æ•…éšœæˆ–ç»´æŠ¤ä»»åŠ¡éƒ½æœ‰éš¾ä»¥é¢„æµ‹çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿å¾—å®‰å…¨é—®é¢˜æ›´åŠ å¤æ‚ã€‚ä»¥ TLS ä¸ºä¾‹ï¼Œä¸»æœºä¸Šçš„ä»£ç†å¿…é¡»åŒ…å«è¯¥ä¸»æœºä¸Šæ‰€æœ‰åº”ç”¨ç¨‹åºçš„å¯†é’¥ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºä¸€ä¸ªæ–°çš„æ”»å‡»åª’ä»‹ï¼Œå®¹æ˜“å—åˆ°&lt;a href=&#34;https://en.wikipedia.org/wiki/Confused_deputy_problem&#34; title=&#34;æ··æ·†ä»£ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ··æ·†ä»£ç†&lt;/a&gt;é—®é¢˜çš„å½±å“â€”â€”ä»£ç†ä¸­çš„ä»»ä½• CVE æˆ–æ¼æ´éƒ½æ˜¯æ½œåœ¨çš„å¯†é’¥æ³„éœ²é£é™©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œsidecar æ¨¡å¼ç»§ç»­è´¯å½»äº†å®¹å™¨çº§åˆ«çš„éš”ç¦»ä¿æŠ¤â€”â€”å†…æ ¸å¯ä»¥åœ¨å®¹å™¨çº§åˆ«æ‰§è¡Œæ‰€æœ‰å®‰å…¨ä¿æŠ¤å’Œå…¬å¹³çš„å¤šç§Ÿæˆ·è°ƒåº¦ã€‚å®¹å™¨çš„éš”ç¦»ä»ç„¶å¯ä»¥å®Œç¾çš„è¿è¡Œï¼Œè€Œ per-host æ¨¡å¼å´ç ´åäº†è¿™ä¸€åˆ‡ï¼Œé‡æ–°å¼•å…¥äº†äº‰æŠ¢å¼çš„å¤šç§Ÿæˆ·éš”ç¦»é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ per-host ä¹Ÿä¸æ˜¯ä¸€æ— æ˜¯å¤„ï¼Œè¯¥æ¨¡å¼æœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥æˆæ•°é‡çº§çš„å‡å°‘ä»£ç†çš„æ•°é‡ï¼Œå‡å°‘ç½‘ç»œè·³æ•°ï¼Œè¿™ä¹Ÿå°±å‡å°‘äº†èµ„æºæ¶ˆè€—å’Œç½‘ç»œå»¶è¿Ÿã€‚ä½†æ˜¯ä¸è¯¥æ¨¡å¼å¸¦æ¥çš„è¿ç»´å’Œå®‰å…¨æ€§é—®é¢˜ç›¸æ¯”ï¼Œè¿™äº›ä¼˜åŠ¿éƒ½æ˜¯æ¬¡è¦çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŒç»­ä¼˜åŒ– sidecar æ¥å¼¥è¡¥ sidecar æ¨¡å¼åœ¨è¿™æ–¹é¢çš„ä¸è¶³ï¼Œè€Œ per-host æ¨¡å¼çš„ç¼ºé™·ç¡®æ˜¯è‡´å‘½æ€§çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®å½’æ ¹ç»“åº•è¿˜æ˜¯å›åˆ°äº†äº‰æŠ¢å¼å¤šç§Ÿæˆ·é—®é¢˜ä¸Šï¼Œé‚£ä¹ˆèƒ½å¦åˆ©ç”¨ç°æœ‰çš„å†…æ ¸è§£å†³æ–¹æ¡ˆï¼Œæ”¹è¿›ä¸€ä¸‹ per-host æ¨¡å¼ä¸­çš„ä»£ç†ï¼Œè®©å…¶æ”¯æŒå¤šç§Ÿæˆ·å‘¢ï¼Ÿæ¯”å¦‚æ”¹é€  Envoy ä»£ç†ï¼Œä½¿å…¶æ”¯æŒå¤šç§Ÿæˆ·æ¨¡å¼ã€‚è™½ç„¶ä»ç†è®ºæ¥è¯´è¿™æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å·¥ä½œé‡å·¨å¤§ï¼ŒMatt Klein ä¹Ÿè§‰å¾—ä¸å€¼å¾—è¿™æ ·åš &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œè¿˜ä¸å¦‚ä½¿ç”¨å®¹å™¨æ¥å®ç°ç§Ÿæˆ·éš”ç¦»ã€‚è€Œä¸”å³ä½¿è®© per-host æ¨¡å¼ä¸­çš„ä»£ç†æ”¯æŒäº†å¤šç§Ÿæˆ·ï¼Œä»ç„¶è¿˜æœ‰çˆ†ç‚¸åŠå¾„å’Œå®‰å…¨é—®é¢˜éœ€è¦è§£å†³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä¸ç®¡æœ‰æ²¡æœ‰ eBPFï¼Œåœ¨å¯é¢„è§çš„æœªæ¥ï¼ŒæœåŠ¡ç½‘æ ¼éƒ½ä¼šåŸºäºè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ sidecar ä»£ç†ï¼ˆproxyless æ¨¡å¼é™¤å¤–ï¼‰ã€‚Sidecar æ¨¡å¼è™½ç„¶ä¹Ÿæœ‰å¼Šç«¯ï¼Œä½†å®ƒä¾ç„¶æ˜¯æ—¢èƒ½ä¿æŒå®¹å™¨éš”ç¦»å’Œæ“ä½œçš„ä¼˜åŠ¿ï¼Œåˆèƒ½å¤„ç†äº‘åŸç”Ÿç½‘ç»œå¤æ‚æ€§çš„æœ€ä¼˜æ–¹æ¡ˆã€‚eBPF çš„èƒ½åŠ›å°†æ¥æ˜¯å¦ä¼šå‘å±•åˆ°å¯ä»¥å¤„ç†ä¸ƒå±‚ç½‘ç»œæµé‡ï¼Œä»è€Œæ›¿ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecarï¼Œä¹Ÿè®¸å§ï¼Œä½†é‚£ä¸€å¤©å¯èƒ½å¾ˆé¥è¿œã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;William Morgan çš„ &lt;a href=&#34;https://buoyant.io/2022/06/07/ebpf-sidecars-and-the-future-of-the-service-mesh/&#34; title=&#34;eBPF, sidecars, and the future of the service mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF, sidecars, and the future of the service mesh&lt;/a&gt; è¿™ç¯‡æ–‡ç« æ­£å¥½å›ç­”äº†æˆ‘çš„å…³äº eBPFã€sidecar çš„ç–‘é—®ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;å…³äº per-host æ¨¡å¼ä¸­çš„ä»£ç†æ”¹é€ é—®é¢˜ï¼ŒTwitter ä¸Šæœ‰ä¸€ä¸ªç²¾å½©çš„&lt;a href=&#34;https://twitter.com/mattklein123/status/1522925333053272065&#34; title=&#34;è®¨è®º&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¨è®º&lt;/a&gt;ã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;

      </description>
    </item>
                           
    <item>
      <title>å¦‚ä½•åœ¨äº§å“ä¸­å¼•å…¥ eBPF ä»¥å¢åŠ å¯è§‚æµ‹æ€§</title>
      <link>https://jimmysong.io/trans/how-to-add-bpf-observability/</link>
      <pubDate>Thu, 27 Jan 2022 09:24:17 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/trans/how-to-add-bpf-observability/</guid>
      <description>
        
        
        &lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://www.brendangregg.com/blog/2021-07-03/how-to-add-bpf-observability.html&#34; title=&#34;How To Add eBPF Observability To Your Product&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How To Add eBPF Observability To Your Product&lt;/a&gt;ï¼ŒåŸæ–‡å‘å¸ƒäº 2021 å¹´ 7 æœˆ 3 æ—¥ã€‚æœ¬æ–‡ä½œè€… Brendan Gregg æ˜¯ eBPF é¢†åŸŸçš„ä¸“å®¶ï¼Œå‡ºç‰ˆè¿‡å¤šæœ¬ç›¸å…³ä¹¦ç±ï¼Œæœ¬æ–‡æ˜¯ä»–ç»™æƒ³è¦åœ¨äº§å“ä¸­å¼•å…¥ eBPF å¢åŠ å¯è§‚æµ‹æ€§äººå‘˜çš„å¿ å‘Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ­£æ–‡&#34;&gt;æ­£æ–‡&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æœ‰ä¸€åœºå†›å¤‡ç«èµ›ï¼Œå³å¢åŠ  eBPF çš„å†›å¤‡ç«èµ›ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»å¦‚ä½•å¿«é€Ÿåšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™ä¹Ÿé€‚ç”¨äºäººä»¬å°†å…¶æ·»åŠ åˆ°è‡ªå·±çš„å†…éƒ¨ç›‘æµ‹ç³»ç»Ÿä¸­ã€‚&lt;/p&gt;
&lt;p&gt;äººä»¬å–œæ¬¢åœ¨ä»–ä»¬å»ºç«‹äº†åŸå‹æˆ–æ„å»ºäº†äº§å“ä¹‹åå‘æˆ‘å±•ç¤ºä»–ä»¬çš„ BPF å¯è§‚æµ‹æ€§äº§å“ï¼Œä½†æˆ‘å¸¸å¸¸åœ¨ä»–ä»¬å¼€å§‹ä¹‹å‰ç»™å‡ºå»ºè®®ã€‚ä½œä¸º BPF å¯è§‚æµ‹æ€§çš„é¢†å¯¼è€…ï¼Œè¿™æ˜¯æˆ‘åœ¨æœ€è¿‘çš„è°ˆè¯ä¸­ä¸€ç›´åŒ…å«çš„å»ºè®®ï¼Œç°åœ¨æˆ‘æŠŠå®ƒçº³å…¥è¿™ç¯‡æ–‡ç« ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘çŸ¥é“ä½ å¾ˆå¿™ã€‚ä½ ç”šè‡³å¯èƒ½ä¸å–œæ¬¢ BPFã€‚ä¸ºäº†åŠ¡å®èµ·è§ï¼Œæˆ‘å°†æè¿°å¦‚ä½•èŠ±æœ€å°‘çš„ç²¾åŠ›æ¥è·å¾—æœ€å¤§çš„ä»·å€¼ã€‚æŠŠè¿™çœ‹æˆæ˜¯â€œç¬¬ä¸€ç‰ˆâ€ã€‚ä¸€ä¸ªç›¸å½“æœ‰ç”¨çš„å‡ºå‘ç‚¹ã€‚æ— è®ºä½ æ˜¯å¦éµå¾ªè¿™ä¸ªå»ºè®®ï¼Œè‡³å°‘è¯·ä½ ç†è§£å®ƒï¼Œä»¥é¿å…ä»¥åçš„é—æ†¾å’Œç—›è‹¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å¼€æºç›‘æ§å¹³å°ï¼Œé¦–å…ˆæ£€æŸ¥å®ƒæ˜¯å¦å·²ç»æœ‰ä¸€ä¸ª BPF ä»£ç†ã€‚è¿™ç¯‡æ–‡ç« å‡è®¾å®ƒæ²¡æœ‰ï¼Œè€Œä¸”ä½ å°†é¦–æ¬¡æ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-è¿è¡Œç¬¬ä¸€ä¸ªå·¥å…·&#34;&gt;1. è¿è¡Œç¬¬ä¸€ä¸ªå·¥å…·&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆå®‰è£… &lt;a href=&#34;https://github.com/iovisor/bcc&#34; title=&#34;bcc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bcc&lt;/a&gt; æˆ– &lt;a href=&#34;https://github.com/iovisor/bpftrace&#34; title=&#34;bpftrace&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bpftrace&lt;/a&gt; å·¥å…·ã€‚ä¾‹å¦‚ï¼ŒUbuntu ä¸Šçš„ bccã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# apt-get install bpfcc-tools&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå°è¯•è¿è¡Œä¸€ä¸ªå·¥å…·ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ execsnoop (8) æŸ¥çœ‹å¸¦æœ‰æ—¶é—´æˆ³çš„è¿›ç¨‹æ‰§è¡Œæƒ…å†µã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# execsnoop-bpfcc -T&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TIME     PCOMM            PID    PPID   RET ARGS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 service          &lt;span class=&#34;m&#34;&gt;828567&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;6009&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /usr/sbin/service --status-all
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 basename         &lt;span class=&#34;m&#34;&gt;828568&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828567&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 basename         &lt;span class=&#34;m&#34;&gt;828569&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828567&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /usr/bin/basename /usr/sbin/service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 env              &lt;span class=&#34;m&#34;&gt;828570&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828567&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /usr/bin/env -i &lt;span class=&#34;nv&#34;&gt;LANG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;en_AU.UTF-8 &lt;span class=&#34;nv&#34;&gt;LANGUAGE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;en_AU:en &lt;span class=&#34;nv&#34;&gt;LC_CTYPE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_NUMERIC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_TIME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_COLLATE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_MONETARY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_MESSAGES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_PAPER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_ADDRESS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_TELEPHONE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_MEASUREMENT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_IDENTIFICATION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;LC_ALL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/opt/local/bin:/opt/local/sbin:/usr/local/git/bin:/home/bgregg/.local/bin:/home/bgregg/bin:/opt/local/bin:/opt/local/sbin:/ &lt;span class=&#34;nv&#34;&gt;TERM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;xterm-256color /etc/init.d/acpid 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 acpid            &lt;span class=&#34;m&#34;&gt;828570&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828567&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /etc/init.d/acpid status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 run-parts        &lt;span class=&#34;m&#34;&gt;828571&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828570&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /usr/bin/run-parts --lsbsysinit --list /lib/lsb/init-functions.d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 systemctl        &lt;span class=&#34;m&#34;&gt;828572&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828570&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /usr/bin/systemctl -p LoadState --value show acpid.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:36:15 readlink         &lt;span class=&#34;m&#34;&gt;828573&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;828570&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; /usr/bin/readlink -f /etc/init.d/acpid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è™½ç„¶å¾ˆåŸºæœ¬ï¼Œä½†æˆ‘ä»…ç”¨è¿™ä¸ªå·¥å…·å°±è§£å†³äº†å¾ˆå¤š perf é—®é¢˜ï¼ŒåŒ…æ‹¬é’ˆå¯¹é…ç½®é”™è¯¯çš„ç³»ç»Ÿï¼Œå…¶ä¸­ä¸€ä¸ª shell è„šæœ¬æ­£åœ¨å¾ªç¯å¯åŠ¨å¤±è´¥çš„è¿›ç¨‹ï¼Œä»¥åŠå½“ä¸€äº›å°ç¨‹åºå´©æºƒå¹¶æ¯éš”å‡ åˆ†é’Ÿå°±é‡å¯ä½†è¿˜æ²¡æœ‰è¢«æ³¨æ„åˆ°æ—¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-ä¸ºä½ çš„äº§å“æ·»åŠ ä¸€ä¸ªå·¥å…·&#34;&gt;2. ä¸ºä½ çš„äº§å“æ·»åŠ ä¸€ä¸ªå·¥å…·&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æƒ³è±¡ä¸€ä¸‹å°† execsnoop (8) æ·»åŠ åˆ°ä½ çš„äº§å“ä¸­ã€‚ä½ å¯èƒ½å·²ç»åœ¨ä½ æ‰€æœ‰çš„å®¢æˆ·ç³»ç»Ÿä¸Šè¿è¡Œäº†ä»£ç†ã€‚ä»–ä»¬æ˜¯å¦æœ‰åŠæ³•è¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶è¿”å›æ–‡æœ¬è¾“å‡ºï¼Ÿæˆ–è€…è¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶å°†è¾“å‡ºå‘é€åˆ°å…¶ä»–åœ°æ–¹è¿›è¡Œèšåˆï¼ˆS3ã€Hiveã€Druid ç­‰ï¼‰ï¼Ÿæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œè¿™å®é™…ä¸Šæ˜¯ä½ è‡ªå·±åŸºäºç°æœ‰ç³»ç»Ÿå’Œå®¢æˆ·ç¯å¢ƒçš„åå¥½ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ æŠŠç¬¬ä¸€ä¸ªå·¥å…·æ·»åŠ åˆ°ä½ çš„äº§å“ä¸­æ—¶ï¼Œè®©å®ƒåœ¨çŸ­æ—¶é—´å†…è¿è¡Œï¼Œæ¯”å¦‚ 10 åˆ° 60 ç§’ã€‚æˆ‘åˆšåˆšæ³¨æ„åˆ° execsnoop (8) è¿˜æ²¡æœ‰æŒç»­æ—¶é—´é€‰é¡¹ï¼Œæ‰€ä»¥åœ¨è¿™æœŸé—´ä½ å¯ä»¥ç”¨ &lt;code&gt;watch -s2 60 execsnoop-bpfcc&lt;/code&gt; æ¥åŒ…è£…å®ƒã€‚å¦‚æœä½ æƒ³ 24 å°æ—¶è¿è¡Œè¿™äº›å·¥å…·ï¼Œé¦–å…ˆè¦ç ”ç©¶å¼€é”€ä»¥äº†è§£æˆæœ¬ã€‚ä½é¢‘ç‡çš„äº‹ä»¶ï¼Œå¦‚è¿›ç¨‹çš„æ‰§è¡Œï¼Œæ•æ‰èµ·æ¥åº”è¯¥æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä½¿ç”¨ bccï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://github.com/iovisor/bpftrace&#34; title=&#34;bpftrace&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bpftrace&lt;/a&gt; ç‰ˆæœ¬ã€‚è¿™äº›é€šå¸¸æ²¡æœ‰å°è£…é€‰é¡¹ï¼ˆ-vã€-l ç­‰ï¼‰ï¼Œä½†æœ‰ä¸€ä¸ª json è¾“å‡ºæ¨¡å¼ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# bpftrace -f json execsnoop.bt &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;attached_probes&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;probes&amp;#34;&lt;/span&gt;: 2&lt;span class=&#34;o&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;printf&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;TIME(ms)   PID   ARGS\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;printf&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2737       849176 &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;join&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;ls -F&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;printf&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;5641       849178 &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;join&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ·»åŠ è¿™ç§æ¨¡å¼æ˜¯ä¸ºäº†ä½¿ BPF çš„å¯è§‚æµ‹æ€§äº§å“å¯ä»¥å»ºç«‹åœ¨ bpftrace ä¹‹ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-ä¸è¦æ‹…å¿ƒä¾èµ–æ€§é—®é¢˜&#34;&gt;3. ä¸è¦æ‹…å¿ƒä¾èµ–æ€§é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æˆ‘å»ºè®®ä½ åœ¨å®¢æˆ·ç³»ç»Ÿä¸Šå®‰è£… bcc æˆ– bpftraceï¼Œå®ƒä»¬ç›®å‰æœ‰ llvm ä¾èµ–ã€‚è¿™å¯èƒ½ä¼šå¢åŠ åˆ°å‡ å MBï¼Œè¿™å¯¹ä¸€äº›èµ„æºæœ‰é™çš„ç¯å¢ƒï¼ˆåµŒå…¥å¼ï¼‰æ˜¯ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨åšå¤§é‡çš„å·¥ä½œï¼Œä»¥ä¾¿åœ¨æœªæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ &lt;a href=&#34;https://www.brendangregg.com/blog/2020-11-04/bpf-co-re-btf-libbpf.html&#34; title=&#34;BTF and CO-RE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BTF and CO-RE&lt;/a&gt;ï¼ˆè€Œä¸æ˜¯ Pythonï¼‰ï¼Œæœ€ç»ˆå°†æ„å‘³ç€ä½ å¯ä»¥å®‰è£… 100KB çš„æ— ä¾èµ–æ€§çš„å·¥å…·äºŒè¿›åˆ¶ç‰ˆæœ¬ã€‚bpftrace ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„è®¡åˆ’ï¼Œä½¿ç”¨è¾ƒæ–°çš„å†…æ ¸ç‰¹æ€§ç”Ÿæˆä¸€ä¸ªå°çš„æ— ä¾èµ–æ€§çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¡®å®éœ€è¦è‡³å°‘ Linux 5.8 æ‰èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œè€Œä½ çš„å®¢æˆ·å¯èƒ½å‡ å¹´éƒ½ä¸ä¼šè¿è¡Œè¿™ä¸ªç³»ç»Ÿã€‚åœ¨è¿™æœŸé—´ï¼Œæˆ‘å»ºè®®æš‚æ—¶ä¸è¦æ‹…å¿ƒ llvm çš„ä¾èµ–å…³ç³»ï¼Œå› ä¸ºå®ƒä»¥åä¼šè¢«ä¿®å¤ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ Linux å‘è¡Œç‰ˆéƒ½å¯ç”¨äº† &lt;code&gt;CONFIG_DEBUG_INFO_BTF=y&lt;/code&gt;ï¼Œè¿™å¯¹äº BTF å’Œ CO-RE çš„æœªæ¥æ˜¯å¿…è¦çš„ã€‚ä¸»è¦çš„å‘è¡Œç‰ˆå·²ç»è®¾ç½®äº†å®ƒï¼Œæ¯”å¦‚åœ¨ Ubuntu 20.10ã€Fedora 30 å’Œ RHEL 8.2ã€‚ä½†å¦‚æœä½ çŸ¥é“ä½ çš„ä¸€äº›å®¢æˆ·æ­£åœ¨è¿è¡Œä¸€äº›ä¸å¸¸è§çš„ä¸œè¥¿ï¼Œè¯·æ£€æŸ¥å¹¶é¼“åŠ±ä»–ä»¬æˆ–å‘è¡Œå•†è®¾ç½® &lt;code&gt;CONFIG_DEBUG_INFO_BTF=y&lt;/code&gt; å’Œ &lt;code&gt;CONFIG_DEBUG_INFO_BTF_MODULES=y&lt;/code&gt;ï¼Œä»¥é¿å…æœªæ¥çš„ç—›è‹¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4-ç¬¬-1-ç‰ˆä»ªè¡¨æ¿&#34;&gt;4. ç¬¬ 1 ç‰ˆä»ªè¡¨æ¿&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ä½ çš„äº§å“ä¸­æœ‰äº†ä¸€ä¸ª BPF å¯è§‚æµ‹æ€§å·¥å…·ï¼Œæ˜¯æ—¶å€™å¢åŠ æ›´å¤šçš„å·¥å…·äº†ã€‚ä¸‹é¢æ˜¯ä½ å¯ä»¥è¿è¡Œçš„åå¤§å·¥å…·ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªé€šç”¨çš„ BPF å¯è§‚æµ‹æ€§ä»ªè¡¨ç›˜æ¥å±•ç¤ºï¼ŒåŒæ—¶è¿˜æœ‰å»ºè®®çš„å¯è§†åŒ–ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç¼–å·&lt;/th&gt;
&lt;th&gt;å·¥å…·&lt;/th&gt;
&lt;th&gt;å±•ç¤º&lt;/th&gt;
&lt;th&gt;å¯è§†åŒ–&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1.&lt;/td&gt;
&lt;td&gt;execsnoop&lt;/td&gt;
&lt;td&gt;æ–°è¿›ç¨‹ï¼ˆé€šè¿‡ exec (2)ï¼‰&lt;/td&gt;
&lt;td&gt;è¡¨æ ¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2.&lt;/td&gt;
&lt;td&gt;opensnoop&lt;/td&gt;
&lt;td&gt;æ‰“å¼€çš„æ–‡ä»¶&lt;/td&gt;
&lt;td&gt;è¡¨æ ¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3.&lt;/td&gt;
&lt;td&gt;ext4slower&lt;/td&gt;
&lt;td&gt;æ…¢é€Ÿæ–‡ä»¶ç³»ç»Ÿ I/O&lt;/td&gt;
&lt;td&gt;è¡¨æ ¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4.&lt;/td&gt;
&lt;td&gt;biolatency&lt;/td&gt;
&lt;td&gt;ç£ç›˜ I/O å»¶è¿ŸæŸ±çŠ¶å›¾&lt;/td&gt;
&lt;td&gt;çƒ­åŠ›å›¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5.&lt;/td&gt;
&lt;td&gt;biosnoop&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªäº‹ä»¶çš„ç£ç›˜ I/O ç»†èŠ‚&lt;/td&gt;
&lt;td&gt;è¡¨æ ¼ï¼Œåç§»çƒ­å›¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6.&lt;/td&gt;
&lt;td&gt;cachestat&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶ç³»ç»Ÿé«˜é€Ÿç¼“å­˜ç»Ÿè®¡&lt;/td&gt;
&lt;td&gt;çº¿çŠ¶å›¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7.&lt;/td&gt;
&lt;td&gt;tcplife&lt;/td&gt;
&lt;td&gt;TCP è¿æ¥&lt;/td&gt;
&lt;td&gt;è¡¨æ ¼ï¼Œåˆ†å¸ƒå¼å›¾è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8.&lt;/td&gt;
&lt;td&gt;tcpretrans&lt;/td&gt;
&lt;td&gt;TCP é‡ä¼ &lt;/td&gt;
&lt;td&gt;è¡¨æ ¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9.&lt;/td&gt;
&lt;td&gt;runqlat&lt;/td&gt;
&lt;td&gt;CPU è°ƒåº¦å™¨çš„å»¶è¿Ÿ&lt;/td&gt;
&lt;td&gt;çƒ­åŠ›å›¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10.&lt;/td&gt;
&lt;td&gt;profile&lt;/td&gt;
&lt;td&gt;CPU å †æ ˆè·Ÿè¸ªæ ·æœ¬&lt;/td&gt;
&lt;td&gt;ç«ç„°å›¾&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™æ˜¯åœ¨æˆ‘çš„ &lt;a href=&#34;https://github.com/iovisor/bcc/blob/master/docs/tutorial.md&#34; title=&#34;bcc Tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bcc Tutorial&lt;/a&gt; çš„ï¼Œè€Œä¸”å¾ˆå¤šä¹Ÿå­˜åœ¨äº bpftrace ä¸­ã€‚æˆ‘é€‰æ‹©è¿™äº›æ˜¯ä¸ºäº†ç”¨æœ€å°‘çš„å·¥å…·æ‰¾åˆ°æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œrunqlat å’Œ profile ä¼šæœ‰æ˜æ˜¾çš„å¼€é”€ï¼Œæ‰€ä»¥æˆ‘åªè¿è¡Œè¿™äº›å·¥å…· 10 åˆ° 60 ç§’ï¼Œç„¶åç”Ÿæˆä¸€ä»½æŠ¥å‘Šã€‚æœ‰äº›å·¥å…·çš„å¼€é”€å¾ˆä½ï¼Œå¦‚æœéœ€è¦çš„è¯å¯ä»¥ 24 å°æ—¶è¿è¡Œï¼ˆä¾‹å¦‚ execsnoopã€biolatencyã€tcplifeã€tcpretransï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ bcc å’Œ bpftrace èµ„æºåº“ä¸­ï¼Œå·²ç»æœ‰ä»¥æ‰‹å†Œå’Œå®ä¾‹æ–‡ä»¶å½¢å¼å­˜åœ¨çš„æ–‡æ¡£ï¼Œä½ å¯ä»¥é“¾æ¥åˆ°è¿™äº›æ–‡æ¡£ï¼Œä»¥å¸®åŠ©ä½ çš„å®¢æˆ·äº†è§£å·¥å…·çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨ &lt;a href=&#34;https://github.com/iovisor/bcc/blob/master/tools/execsnoop_example.txt&#34; title=&#34;bcc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bcc&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/iovisor/bpftrace/blob/master/tools/execsnoop_example.txt&#34; title=&#34;bpftrace&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bpftrace&lt;/a&gt; æœ‰ execsnoop (8) çš„ç¤ºä¾‹æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæˆè¿™äº›åï¼Œä½ å°±æœ‰äº†ç¬¬ä¸€ç‰ˆçš„ä»ªè¡¨æ¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bcc-ä¸-bpftrace&#34;&gt;bcc ä¸ bpftrace&lt;/h2&gt;
&lt;p&gt;bcc å·¥å…·æ˜¯æœ€å®¹æ˜“ä½¿ç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æœ‰å¾ˆå¤šå‘½ä»¤è¡Œé€‰é¡¹ã€‚bpftrace å·¥å…·æ›´å®¹æ˜“ç¼–è¾‘å’Œå®šåˆ¶ï¼Œè€Œä¸” bpftrace æœ‰ä¸€ä¸ª json è¾“å‡ºæ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ˜¯è¿½è¸ªçš„æ–°æ‰‹ï¼Œå°±ç”¨ bcc å§ã€‚å¦‚æœä½ æƒ³åšä¸€äº›é»‘å®¢å’Œå®šåˆ¶çš„å·¥å…·ï¼Œå°±ç”¨ bpftraceã€‚æœ€åï¼Œå®ƒä»¬éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¡ˆä¾‹ç ”ç©¶netflix&#34;&gt;æ¡ˆä¾‹ç ”ç©¶ï¼šNetflix&lt;/h2&gt;
&lt;p&gt;Netflix æ­£åœ¨å»ºç«‹ä¸€ä¸ªæ–°çš„ GUIï¼Œåœ¨è¿™äº›å·¥å…·çš„ bpftrace ç‰ˆæœ¬çš„åŸºç¡€ä¸Šï¼Œåšè¿™ä¸ªå·¥å…·ä»ªè¡¨ç›˜å’Œæ›´å¤šçš„å·¥ä½œã€‚æ¶æ„å¦‚å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/how-to-add-bpf-observability/008i3skNly1gys3a6aaa2j31310u0tcj_hu43dc48a3fd9e0abea6a3bc0df7ed9b91_99509_1000x769_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/how-to-add-bpf-observability/008i3skNly1gys3a6aaa2j31310u0tcj.jpg&#34; data-img=&#34;/trans/how-to-add-bpf-observability/008i3skNly1gys3a6aaa2j31310u0tcj.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;769&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
&lt;/figure&gt;
&lt;p&gt;è™½ç„¶ bpftrace äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åœ¨æ‰€æœ‰ç›®æ ‡ç³»ç»Ÿä¸Šï¼Œä½† bpftrace å·¥å…·ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰å´åœ¨ç½‘ç»œæœåŠ¡å™¨ä¸Šï¼Œå¹¶åœ¨éœ€è¦æ—¶è¢«æ¨é€å‡ºå»ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä¸€ä¸ªåœ°æ–¹æ›´æ–°å·¥å…·æ¥ç¡®ä¿æˆ‘ä»¬ä¸€ç›´åœ¨è¿è¡Œæœ€æ–°ç‰ˆæœ¬çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ç›®å‰æˆ‘ä»¬ FlameCommander ç”¨æˆ·ç•Œé¢çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä¹Ÿåœ¨äº‘ç«¯è¿è¡Œç«ç„°å›¾ã€‚æˆ‘ä»¬ä»¥å‰çš„ BPF GUI æ˜¯ &lt;a href=&#34;https://github.com/Netflix/vector&#34; title=&#34;Vector&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vector&lt;/a&gt; çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä½¿ç”¨äº† bccï¼Œä½†æˆ‘ä»¬åæ¥åºŸå¼ƒäº†å®ƒã€‚æˆ‘ä»¬å¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶å€™å¼€æºæ–°çš„ GUIï¼Œå¹¶åœ¨ Netflix æŠ€æœ¯åšå®¢ä¸Šå‘è¡¨ç›¸å…³æ–‡ç« ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¡ˆä¾‹ç ”ç©¶facebook&#34;&gt;æ¡ˆä¾‹ç ”ç©¶ï¼šFacebook&lt;/h2&gt;
&lt;p&gt;Facebook æ˜¯ BPF çš„é«˜çº§ç”¨æˆ·ï¼Œä½†ä»–ä»¬å¦‚ä½•åœ¨æ•´ä¸ªé›†ç¾¤ä¸­è¿è¡Œå·¥å…·çš„æ·±å±‚ç»†èŠ‚å¹¶æ²¡æœ‰å®Œå…¨å…¬å¼€ã€‚æ ¹æ® bcc çš„æ´»åŠ¨ï¼Œä»¥åŠä»–ä»¬å¯¹ BTF å’Œ CO-RE æŠ€æœ¯çš„å¼€å‘ï¼Œæˆ‘ååˆ†æ€€ç–‘ä»–ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯åŸºäº bcc çš„ libbpf-tool ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç§»æ¤çš„é™·é˜±&#34;&gt;ç§»æ¤çš„é™·é˜±&lt;/h2&gt;
&lt;p&gt;BPF è¿½è¸ªå·¥å…·å°±åƒåº”ç”¨ç¨‹åºå’Œå†…æ ¸çš„è¡¥ä¸ã€‚å®ƒä»¬éœ€è¦ä¸æ–­çš„æ›´æ–°ä»¥ä¿æŒåœ¨ä¸åŒçš„è½¯ä»¶ç‰ˆæœ¬ä¸­å·¥ä½œã€‚æŠŠå®ƒä»¬ç§»æ¤åˆ°ä¸åŒçš„è¯­è¨€ï¼Œç„¶åä¸ç»´æŠ¤å®ƒä»¬ï¼Œå¯èƒ½å°±åƒè¯•å›¾æŠŠ Linux 4.15 çš„è¡¥ä¸åº”ç”¨äº Linux 5.12ã€‚å¦‚æœä½ è¿æ°”å¥½ï¼Œå®ƒå°±ä¼šå·¥ä½œï¼å¦‚æœä½ ä¸èµ°è¿ï¼Œè¡¥ä¸å°±ä¼šåº”ç”¨ï¼Œä½†ä¼šä»¥ä¸€ç§å¾®å¦™çš„æ–¹å¼ç ´åä¸€äº›ä¸œè¥¿ï¼Œç›´åˆ°åæ¥ä½ æ‰æ³¨æ„åˆ°ã€‚è¿™å–å†³äºå·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œæˆ‘åœ¨ 2014 å¹´ä¼‘å‡æ—¶å†™äº† cachestat (8)ï¼Œç”¨äº Netflix cloudï¼Œå½“æ—¶æ˜¯ Linux 3.2 å’Œ 3.13 çš„æ··åˆç‰ˆæœ¬ã€‚BPF åœ¨è¿™äº›ç‰ˆæœ¬ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº† Linux 3.2 ä¸Šçš„åŸºæœ¬ Ftrace åŠŸèƒ½ã€‚æˆ‘æŠŠè¿™ç§æ–¹æ³•æè¿°ä¸º &lt;a href=&#34;https://www.brendangregg.com/blog/2014-12-31/linux-page-cache-hit-ratio.html&#34; title=&#34;brittle&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;brittle&lt;/a&gt;ï¼Œ &lt;a href=&#34;https://github.com/brendangregg/perf-tools/blob/master/fs/cachestat&#34; title=&#34;sandcastle&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sandcastle&lt;/a&gt; éœ€è¦éšç€å†…æ ¸çš„å˜åŒ–è€Œè¿›è¡Œç»´æŠ¤ã€‚åæ¥ï¼Œå®ƒè¢«ç§»æ¤åˆ°äº†å¸¦æœ‰ kprobes çš„ BPF ä¸Šï¼Œç°åœ¨å·²ç»è¢«é‡å†™å¹¶åŒ…å«åœ¨å•†ä¸šå¯è§‚æµ‹æ€§äº§å“ä¸­ã€‚æˆ‘å¬è¯´å®ƒåœ¨è¾ƒæ–°çš„å†…æ ¸ä¸Šæœ‰é—®é¢˜ï¼Œæ‰“å°çš„è¾“å‡ºæ²¡æœ‰æ„ä¹‰ã€‚å®ƒçœŸçš„éœ€è¦ä¸€æ¬¡å¤§ä¿®ã€‚å½“æˆ‘ï¼ˆæˆ–æŸäººï¼‰åšäº†è¿™ä¸ªå·¥ä½œï¼Œä»»ä½•ä» bcc ä¸Šæ‹‰å–æ›´æ–°çš„äººéƒ½ä¼šè‡ªåŠ¨å¾—åˆ°å›ºå®šçš„ç‰ˆæœ¬ï¼Œä¸éœ€è¦è´¹åŠ›ã€‚é‚£äº›é‡å†™çš„äººå°†éœ€è¦é‡å†™è‡ªå·±çš„ç‰ˆæœ¬ã€‚æˆ‘æ‹…å¿ƒä»–ä»¬ä¸ä¼šè¿™æ ·åšï¼Œè€Œå®¢æˆ·å°†åœ¨å¤šå¹´æ¥ä¸€ç›´è¿è¡Œä¸€ä¸ªé”™è¯¯çš„ cachestat (8) ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œå¦‚æœåœ¨æˆ‘å†™ cachestat (8) çš„æ—¶å€™ï¼ŒBPF åœ¨æˆ‘çš„ç›®æ ‡ç¯å¢ƒä¸­æ˜¯å¯ç”¨çš„ï¼Œæˆ‘çš„ç¼–ç æ–¹å¼å°±ä¼šå®Œå…¨ä¸åŒã€‚äººä»¬æ­£åœ¨ç§»æ¤ä¸º Linux 3.2 ç¼–å†™çš„ä¸œè¥¿ï¼Œå¹¶åœ¨ Linux 5.x ä¸Šè¿è¡Œå®ƒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä»¥å‰çš„ä¸€ç¯‡åšæ–‡ &lt;a href=&#34;https://www.brendangregg.com/blog/2021-06-04/an-unbelievable-demo.html&#34; title=&#34;An Unbelievable Demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;An Unbelievable Demo&lt;/a&gt; ä¸­ï¼Œè°ˆåˆ°äº†å¾ˆå¤šå¹´å‰å‘ç”Ÿçš„ç±»ä¼¼æƒ…å†µï¼Œå³åœ¨æ²¡æœ‰æ›´æ–°çš„æƒ…å†µä¸‹ä½¿ç”¨æ—§çš„è¿½è¸ªå·¥å…·ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æ‰€æè¿°çš„é—®é¢˜æ˜¯é’ˆå¯¹ BPF è½¯ä»¶å’Œå†…æ ¸è¿½è¸ªçš„ã€‚ä½œä¸ºä¸€ä¸ªä¸åŒçš„ä¾‹å­ï¼Œæˆ‘çš„ç«ç„°å›¾è½¯ä»¶å·²ç»è¢«é‡å†™äº†åå‡ æ¬¡ï¼Œç”±äºå®ƒæ˜¯ä¸€ä¸ªç®€å•è€Œå®Œå¤‡çš„ç®—æ³•ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æœ‰ä»€ä¹ˆå¤§é—®é¢˜ã€‚æˆ‘æ›´å–œæ¬¢äººä»¬å¸®åŠ©æ›´æ–° &lt;a href=&#34;https://github.com/spiermar/d3-flame-graph&#34; title=&#34;d3 version&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;d3 version&lt;/a&gt; ä½†å¦‚æœäººä»¬è‡ªå·±åšï¼Œé‚£ä¹Ÿæ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚ä½ å¯ä»¥ç»™å®ƒç¼–ç ï¼Œå®ƒå°†æ°¸è¿œå·¥ä½œã€‚åŸºäº uprobe å’Œ kprobe çš„ BPF å·¥å…·å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œå› ä¸ºå®ƒä»¬ç¡®å®éœ€è¦ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åƒç³»ç»Ÿç®¡ç†å‘˜ä¸€æ ·æ€è€ƒè€Œä¸æ˜¯åƒç¨‹åºå‘˜ä¸€æ ·æ€è€ƒ&#34;&gt;åƒç³»ç»Ÿç®¡ç†å‘˜ä¸€æ ·æ€è€ƒï¼Œè€Œä¸æ˜¯åƒç¨‹åºå‘˜ä¸€æ ·æ€è€ƒ&lt;/h2&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œé¦–å…ˆæ£€æŸ¥ä½ çš„ç›‘æ§ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰ä¸€ä¸ª BPF ä»£ç†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±åœ¨ç°æœ‰çš„åŸºç¡€ä¸Šæ„å»ºä¸€ä¸ª &lt;a href=&#34;https://github.com/iovisor/bcc&#34; title=&#34;bcc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bcc&lt;/a&gt; æˆ– &lt;a href=&#34;https://github.com/iovisor/bpftrace&#34; title=&#34;bpftrace&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bpftrace&lt;/a&gt; å·¥å…·ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹é‡å†™ä¸€åˆ‡ã€‚è¿™æ˜¯åƒä¸€ä¸ªå®‰è£…å’Œç»´æŠ¤è½¯ä»¶çš„ç³»ç»Ÿç®¡ç†å‘˜é‚£æ ·æ€è€ƒï¼Œè€Œä¸æ˜¯åƒä¸€ä¸ªç¼–ç æ‰€æœ‰ä¸œè¥¿çš„ç¨‹åºå‘˜é‚£æ ·æ€è€ƒã€‚å®‰è£… bcc æˆ– bpftrace å·¥å…·ï¼ŒæŠŠå®ƒä»¬æ·»åŠ åˆ°ä½ çš„å¯è§‚æµ‹æ€§äº§å“ä¸­ï¼Œå¹¶æ ¹æ®éœ€è¦æ‹‰å–åŒ…çš„æ›´æ–°ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå¿«é€Ÿè€Œæœ‰ç”¨çš„ç‰ˆæœ¬ã€‚BPF å¯åŠ¨å’Œè¿è¡Œäº†ï¼&lt;/p&gt;
&lt;p&gt;æˆ‘çœ‹åˆ°äººä»¬åè€Œåƒç¨‹åºå‘˜ä¸€æ ·æ€è€ƒï¼Œè§‰å¾—ä»–ä»¬å¿…é¡»ä»æ·±å…¥å­¦ä¹  bcc å’Œ BPF ç¼–ç¨‹ã€‚ç„¶åï¼Œåœ¨å‘ç°æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ C è¯­è¨€æˆ– Python å†™çš„ä¹‹åï¼Œæœ‰äº›äººå°±ç”¨ä¸åŒçš„è¯­è¨€é‡å†™äº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå­¦å¥½ bcc å’Œ BPF éœ€è¦å‡ å‘¨æ—¶é—´ï¼›å­¦ä¹ ç³»ç»Ÿè·Ÿè¸ªçš„å¾®å¦™ä¹‹å¤„å’Œé™·é˜±å¯èƒ½éœ€è¦å‡ ä¸ªæœˆæˆ–å‡ å¹´ã€‚ä¸ºäº†è®©ä½ äº†è§£ä½ æ‰€é¢ä¸´çš„æƒ…å†µï¼Œè¯·çœ‹æˆ‘çš„ &lt;a href=&#34;https://www.brendangregg.com/blog/2021-06-15/bpf-internals.html&#34; title=&#34;BPF Internals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BPF Internals&lt;/a&gt; è®²åº§ã€‚å¦‚æœä½ çœŸçš„æƒ³åšè¿™ä¸ªï¼Œå¹¶ä¸”æœ‰æ—¶é—´ï¼Œä½ å½“ç„¶å¯ä»¥ï¼ˆä½ å¯èƒ½ä¼šåœ¨ Tracing ä¼šè®®ä¸Šé‡åˆ°æˆ‘ã€‚åœ¨ Linux Plumberâ€™s æˆ–è¿½ Tracing ä¼šä¸Šè§ï¼ï¼‰ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨æŸä¸ªæœŸé™å†…è¦å¢åŠ  BPF çš„å¯è§‚æµ‹æ€§ï¼Œé‚£å°±è¯•ç€åƒä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜é‚£æ ·æ€è€ƒï¼Œå¹¶åœ¨ç°æœ‰çš„å·¥å…·åŸºç¡€ä¸Šè¿›è¡Œæ„å»ºã€‚è¿™æ˜¯å¿«é€Ÿçš„æ–¹æ³•ã€‚ä»¥åå†åƒç¨‹åºå‘˜é‚£æ ·æ€è€ƒï¼Œå¦‚æœä½ æœ‰æ—¶é—´çš„è¯ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒï¼ŒBPF è½¯ä»¶ï¼Œç‰¹åˆ«æ˜¯æŸäº›åŸºäº kprobe çš„å·¥å…·ï¼Œéœ€è¦æŒç»­çš„ç»´æŠ¤ã€‚ä¸€ä¸ªå·¥å…·å¯èƒ½åœ¨ Linux 5.3 ä¸Šå·¥ä½œï¼Œä½†åœ¨ 5.4 ä¸Šå°±ä¼šåæ‰ï¼Œå› ä¸ºä¸€ä¸ªè¢«è¿½è¸ªçš„å‡½æ•°è¢«é‡æ–°å‘½åæˆ–å¢åŠ äº†ä¸€ä¸ªæ–°çš„ä»£ç è·¯å¾„ã€‚BPF åº“å’Œæ¡†æ¶ä¹Ÿåœ¨å˜åŒ–å’Œå‘å±•ï¼Œæœ€è¿‘çš„ä¸€æ¬¡æ˜¯ BTF å’Œ CO-RE æ”¯æŒã€‚è¿™æ˜¯æˆ‘å¸Œæœ›äººä»¬åœ¨é€‰æ‹©é‡å†™å®ƒä»¬ä¹‹å‰è¦è€ƒè™‘çš„é—®é¢˜ã€‚ä½ æ˜¯å¦ä¹Ÿæœ‰è®¡åˆ’é‡å†™æ‰€æœ‰çš„æ›´æ–°ï¼Œæˆ–è€…ä½ æœ€ç»ˆä¼šè¢«å›°åœ¨ä¸€ä¸ªæ—§çš„åº“çš„ç«¯å£ä¸Šï¼Ÿæ‹‰å–æ‰€æœ‰çš„æ›´æ–°æ¯”ç»´æŠ¤ä½ è‡ªå·±çš„ç‰ˆæœ¬æ›´å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ¯”æˆ‘ä»¬åœ¨ bcc å’Œ bpftrace ä¸­ä½¿ç”¨çš„æ›´å¥½çš„ BPF åº“æˆ–æ¡†æ¶çš„å¥½ä¸»æ„å‘¢ï¼Ÿå’Œæˆ‘ä»¬è°ˆè°ˆï¼Œè¯•è¯•ï¼Œåˆ›æ–°ä¸€ä¸‹ã€‚æˆ‘ä»¬æ­£å¤„äº BPF æ—¶ä»£çš„å¼€ç«¯ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦æ¢ç´¢ã€‚ä½†è¯·å…ˆäº†è§£ç°æœ‰çš„æƒ…å†µä»¥åŠä½ æ‰€æ‰¿æ‹…çš„ç»´æŠ¤è´Ÿæ‹…ã€‚ä½ çš„ç²¾åŠ›å¯èƒ½ä¼šè¢«ç”¨æ¥åœ¨ç°æœ‰çš„åŸºç¡€ä¸Šåˆ›é€ æ–°çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯ç§»æ¤æ—§çš„ä¸œè¥¿ã€‚&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>eBPF å’Œ Wasmï¼šæ¢ç´¢æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢çš„æœªæ¥</title>
      <link>https://jimmysong.io/trans/ebpf-wasm-service-mesh/</link>
      <pubDate>Tue, 11 Jan 2022 10:55:44 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/trans/ebpf-wasm-service-mesh/</guid>
      <description>
        
        
        &lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;å‰æ®µæ—¶é—´ï¼Œæœ‰äººæå‡ºä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼ä¸­çš„ sidecar ä»£ç†ï¼Œè¯¥è§‚ç‚¹å·²ç»å‘å‡ºï¼Œå°±åœ¨æœåŠ¡ç½‘æ ¼å’Œäº‘åŸç”Ÿç¤¾åŒºä¸­å¼•èµ·äº†â€œè½©ç„¶å¤§æ³¢â€ã€‚åæ¥ä¹Ÿæœ‰ä¸å°‘äººæŒ‡å‡ºè¯¥æ–¹æ¡ˆå®å±æ­¦æ–­ï¼Œä¸åˆ‡å®é™…ã€‚æœ¬æ–‡å°±æ€»ç»“äº† eBPF åœ¨æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸­çš„ä½œç”¨ï¼Œä»¥åŠä½¿ç”¨ Wasm è¿™ç§æ–°çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ­£æ–‡&#34;&gt;æ­£æ–‡&lt;/h2&gt;
&lt;p&gt;2021 å¹´ 12 æœˆ 2 æ—¥ï¼ŒCilium é¡¹ç›®å®£å¸ƒäº† &lt;a href=&#34;https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta&#34; title=&#34;Cilium Service Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium Service Mesh&lt;/a&gt; çš„ beta æµ‹è¯•è®¡åˆ’ã€‚åœ¨è°·æ­Œäº‘åŸºäº eBPF çš„ Google Cloud Kubernetes Serviceï¼ˆGKSï¼‰Dataplane V2ï¼ˆäº 2020 å¹´ 8 æœˆå‘å¸ƒï¼‰æ‰€å¼€åˆ›çš„æ¦‚å¿µåŸºç¡€ä¸Šï¼ŒCilium Service Mesh æå€¡â€œæ—  sidecar æœåŠ¡ç½‘æ ¼ &amp;quot; çš„ç†å¿µã€‚å®ƒæ‰©å±•äº† Cilium eBPF äº§å“ï¼Œä»¥å¤„ç†æœåŠ¡ç½‘æ ¼ä¸­çš„å¤§éƒ¨åˆ† sidecar ä»£ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ L7 è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ã€TLS ç»ˆæ­¢ã€è®¿é—®ç­–ç•¥ã€å¥åº·æ£€æŸ¥ã€æ—¥å¿—å’Œè·Ÿè¸ªï¼Œä»¥åŠå†…ç½®çš„ Kubernetes Ingressã€‚&lt;/p&gt;
&lt;p&gt;Cillium çš„åˆ›å»ºè€… Isovalent åœ¨ä¸€ç¯‡é¢˜ä¸ºâ€œ&lt;a href=&#34;https://cloudnative.to/blog/ebpf-solve-service-mesh-sidecar/&#34; title=&#34;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&lt;/a&gt; â€œçš„æ–‡ç« ä¸­è§£é‡Šäº†ä½¿ç”¨ eBPF ä½œä¸º sidecar ä»£ç†çš„ç†ç”±ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒå°†æŠŠæˆ‘ä»¬ä» sidecar æ¨¡å‹ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¹¶å…è®¸æˆ‘ä»¬å°†ç°æœ‰çš„ä»£ç†æŠ€æœ¯æ•´åˆåˆ°ç°æœ‰çš„å†…æ ¸å‘½åç©ºé—´æ¦‚å¿µä¸­ï¼Œä½¿å®ƒä»¬æˆä¸ºæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„å®¹å™¨æŠ½è±¡çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼ŒeBPF æœ‰æœ›è§£å†³æœåŠ¡ç½‘æ ¼ä¸­çš„ä¸€ä¸ªä¸»è¦ç—›ç‚¹ â€”â€” å½“æœ‰è®¸å¤šç»†ç²’åº¦çš„å¾®æœåŠ¡æ—¶ï¼Œæ€§èƒ½å ªå¿§ã€‚ç„¶è€Œï¼Œä½¿ç”¨ eBPF æ¥å–ä»£ sidecar ä»£ç†è¿™ä¸ªæƒ³æ³•ä¹Ÿæ˜¯å­˜åœ¨äº‰è®®çš„ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-wasm-service-mesh/008i3skNly1gy9u3uba27j31x70u0dk7_hucc6e13ab1ab06b504dc435006cd3c795_55331_1000x434_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-wasm-service-mesh/008i3skNly1gy9u3uba27j31x70u0dk7.jpg&#34; data-img=&#34;/trans/ebpf-wasm-service-mesh/008i3skNly1gy9u3uba27j31x70u0dk7.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;434&#34; alt=&#34;image&#34; data-caption=&#34;å‘Šåˆ« sidecar&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;å‘Šåˆ« sidecar&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ï¼ˆæ¥æºï¼š&lt;a href=&#34;https://cloudnative.to/blog/ebpf-solve-service-mesh-sidecar/&#34; title=&#34;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼ä¸­çš„æ•°æ®å¹³é¢æŒ‡çš„æ˜¯ç®¡ç†æ•°æ®æµé‡å¦‚ä½•è¢«è·¯ç”±å’Œäº¤ä»˜ç»™å¾®æœåŠ¡åº”ç”¨çš„åŸºç¡€è®¾æ–½æœåŠ¡ã€‚ç›®å‰ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨æœåŠ¡ä»£ç†æ¥å®ç°çš„ã€‚è¿™ç§è®¾è®¡æ¨¡å¼é€šå¸¸ä¹Ÿè¢«ç§°ä¸º Sidecar æ¨¡å¼ã€‚Sidecar å…è®¸å…¶é™„å±çš„å¾®æœåŠ¡é€æ˜åœ°ä¸æœåŠ¡ç½‘æ ¼ä¸­çš„å…¶ä»–ç»„ä»¶å‘å‡ºå’Œæ¥æ”¶è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Sidecar é€šå¸¸åŒ…å«ä¸€ä¸ª L7 ç½‘ç»œä»£ç†ï¼Œå¦‚ &lt;a href=&#34;https://envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ã€&lt;a href=&#34;https://linkerd.io/&#34; title=&#34;Linkerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt; æˆ– &lt;a href=&#34;https://mosn.io/&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;ã€‚è¯¥ä»£ç†å¤„ç†æµé‡è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€è®¤è¯ã€æˆæƒã€åŠ å¯†ã€æ—¥å¿—ã€è·Ÿè¸ªå’Œç»Ÿè®¡æ•°æ®æ”¶é›†ã€‚Sidecar è¿˜å¯ä»¥åŒ…å«ä¸€ä¸ªåŸºäº SDK çš„åº”ç”¨æ¡†æ¶ï¼Œå¦‚ &lt;a href=&#34;https://dapr.io/&#34; title=&#34;Dapr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dapr&lt;/a&gt;ï¼Œä»¥æä¾›ç½‘ç»œä»£ç†ä»¥å¤–çš„åº”ç”¨æœåŠ¡ã€‚è¿™ç§åº”ç”¨æœåŠ¡çš„ä¾‹å­åŒ…æ‹¬æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€èµ„æºç»‘å®šã€åŸºäºåç§°çš„æœåŠ¡è°ƒç”¨ã€çŠ¶æ€ç®¡ç†ã€è¡Œä¸ºè€…æ¡†æ¶å’Œç§˜å¯†å­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;Sidecar ä»£ç†å’ŒæœåŠ¡é€šå¸¸åœ¨ Kubernetes pod æˆ–å®¹å™¨å†…è¿è¡Œã€‚å¾®æœåŠ¡åº”ç”¨ä¹Ÿåœ¨å®¹å™¨å†…è¿è¡Œï¼Œå®ƒä»¬é€šè¿‡ç½‘ç»œæ¥å£è¿æ¥åˆ° sidecar ä¸Šã€‚ç„¶è€Œï¼Œè¿™äº›å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªé‡è¦é—®é¢˜æ˜¯èµ„æºæ¶ˆè€—ã€‚Sidecar æœåŠ¡éšç€å¾®æœåŠ¡çš„æ•°é‡å‘ˆå‡ ä½•çº§æ•°å¢åŠ ã€‚å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºæœ‰æ•°ç™¾ä¸ªç›¸äº’è”ç³»å’Œè´Ÿè½½å‡è¡¡çš„å¾®æœåŠ¡æ—¶ï¼Œå¼€é”€å¯èƒ½å˜å¾—ä¸å ªé‡è´Ÿã€‚æœåŠ¡ç½‘æ ¼ä»£ç†ä¾›åº”å•†åœ¨æ€§èƒ½ä¸Šå±•å¼€ç«äº‰ã€‚æ­£å¦‚ &lt;a href=&#34;https://www.infoq.com/news/2021/08/linkerd-rust-cloud-native/&#34; title=&#34;InfoQ ä¹‹å‰æŠ¥é“çš„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfoQ ä¹‹å‰æŠ¥é“çš„&lt;/a&gt;é‚£æ ·ï¼ŒLinkerd å°†å…¶ä»£ç†ä» Go é‡å†™æˆäº† Rustï¼Œå¹¶å–å¾—äº†æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¶³ä¸ºå¥‡çš„æ˜¯ï¼Œç°æœ‰çš„æœåŠ¡ç½‘æ ¼ä¾›åº”å•†å¹¶ä¸ç›¸ä¿¡ eBPF æ˜¯èƒ½è§£å†³æˆ‘ä»¬æ‰€æœ‰é—®é¢˜çš„åœ£æ¯ã€‚æ¥è‡ª Solo çš„ Idit Levine ç­‰äººå†™äº†ä¸€ç¯‡æ–‡ç« æ¥å›åº” Cilium çš„å…¬å‘Šã€‚è¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜æ˜¯â€œ&lt;a href=&#34;https://www.zhaohuabing.com/post/2021-12-19-ebpf-for-service-mesh/&#34; title=&#34;æœåŠ¡ç½‘æ ¼å°†ä½¿ç”¨ eBPFï¼Ÿæ˜¯çš„ï¼Œä½† Envoy ä»£ç†å°†ç»§ç»­å­˜åœ¨&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼å°†ä½¿ç”¨ eBPFï¼Ÿæ˜¯çš„ï¼Œä½† Envoy ä»£ç†å°†ç»§ç»­å­˜åœ¨&lt;/a&gt; &amp;ldquo;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ Solo.ioï¼Œæˆ‘ä»¬è®¤ä¸º eBPF æ˜¯ä¼˜åŒ–æœåŠ¡ç½‘æ ¼çš„ä¸€ç§å¼ºå¤§æ–¹å¼ï¼Œæˆ‘ä»¬è®¤ä¸º Envoy ä»£ç†æ˜¯æ•°æ®å¹³é¢çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Solo.io ä½œè€…æå‡ºçš„å…³é”®ç‚¹æ˜¯ï¼Œç°åœ¨çš„ sidecar ä»£ç†æ‰€åšçš„äº‹æƒ…è¿œè¿œè¶…è¿‡äº†ç®€å•çš„ç½‘ç»œæµé‡ç®¡ç†ã€‚åœ¨ä»Šå¤©çš„æœåŠ¡ç½‘æ ¼éƒ¨ç½²ä¸­ï¼Œæœ‰ä¸€äº›å¤æ‚çš„è¦æ±‚ï¼Œè¿œè¿œè¶…è¿‡äº† eBPF æ‰€æ”¯æŒçš„æœ‰é™çš„ç¼–ç¨‹æ¨¡å‹ï¼ŒeBPF æ˜¯å›¾çµä¸å®Œæ•´çš„ï¼Œå¯¹å†…æ ¸çš„å®‰å…¨æ€§æœ‰è®¸å¤šé™åˆ¶ã€‚Cilium eBPF äº§å“å¯ä»¥å¤„ç†è®¸å¤šï¼Œä½†ä¸æ˜¯å…¨éƒ¨ï¼Œç”± sidecar ä»£ç†æ‰§è¡Œçš„å„ç§ä»»åŠ¡ã€‚æ­¤å¤–ï¼ŒSolo.io çš„ä½œè€…æŒ‡å‡ºï¼ŒeBPF çš„æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªä»£ç†çš„è®¾ç½®æä¾›äº†æ›´å°‘çš„çµæ´»æ€§ï¼Œå› æ­¤ä¸ä¼ ç»Ÿä»£ç†çš„æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªä»£ç†çš„è®¾ç½®ç›¸æ¯”ï¼Œå¢åŠ äº†æ•´ä½“å¼€é”€ã€‚è¿™äº› eBPF çš„ç¼ºç‚¹å¯¹äºå¼€å‘è€…å¿…é¡»ç¼–å†™å¹¶éƒ¨ç½²åˆ°æœåŠ¡ç½‘æ ¼ä»£ç†ä¸­çš„æµé‡è·¯ç”±ã€è´Ÿè½½å‡è¡¡å’Œæˆæƒçš„ç‰¹å®šåº”ç”¨é€»è¾‘æ¥è¯´å°¤å…¶æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;Terate.io çš„å¼€å‘è€…åœ¨å¯¹ Cilium å…¬å‘Šçš„å›åº”ä¸­æå‡ºäº†ç±»ä¼¼çš„è®ºç‚¹ï¼Œæ ‡é¢˜æ˜¯â€œ&lt;a href=&#34;https://www.tetrate.io/blog/the-debate-in-the-community-about-istio-and-service-mesh/&#34; title=&#34;ç¤¾åŒºä¸­å…³äº Istio å’ŒæœåŠ¡ç½‘æ ¼çš„äº‰è®º&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒºä¸­å…³äº Istio å’ŒæœåŠ¡ç½‘æ ¼çš„äº‰è®º&lt;/a&gt; &amp;ldquo;ã€‚ä»–ä»¬æŒ‡å‡ºï¼Œä»Šå¤©çš„ sidecar ä»£ç†çš„æ€§èƒ½æ˜¯åˆç†çš„ï¼Œå¼€æºç¤¾åŒºå·²ç»æƒ³å‡ºäº†è¿›ä¸€æ­¥æé«˜æ€§èƒ½çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œåœ¨ eBPF è¿™ç§æ–°é¢–çš„ã€å›¾çµä¸å®Œæ•´çš„æŠ€æœ¯ä¸­æ„å»ºç‰¹å®šåº”ç”¨çš„æ•°æ®å¹³é¢é€»è¾‘æ˜¯éå¸¸å›°éš¾çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Istio æ¶æ„æ˜¯ç¨³å®šçš„ï¼Œå¯ç”¨äºç”Ÿäº§çš„ï¼Œè€Œä¸”ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨èŒèŠ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;eBPF çš„è®¸å¤šé—®é¢˜ä¸ä»¥ä¸‹äº‹å®æœ‰å…³ï¼šå®ƒæ˜¯ä¸€ç§å†…æ ¸æŠ€æœ¯ï¼Œå› æ­¤å¿…é¡»æœ‰å®‰å…¨é™åˆ¶ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°†å¤æ‚çš„ç‰¹å®šåº”ç”¨çš„ä»£ç†é€»è¾‘çº³å…¥æ•°æ®å¹³é¢ï¼Œè€Œä¸ä½¿ç”¨ä½¿ç”¨ç©ºé—´æŠ€æœ¯é™ä½æ€§èƒ½ï¼Ÿäº‹å®è¯æ˜ï¼ŒWebAssemblyï¼ˆWasmï¼‰å¯èƒ½æ­£æ˜¯è¿™ç§é€‰æ‹©ã€‚Wasm è¿è¡Œæ—¶å¯ä»¥å®‰å…¨åœ°éš”ç¦»å¹¶ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½æ‰§è¡Œç”¨æˆ·ç©ºé—´ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;Envoy Proxy å¼€åˆ›äº†ä½¿ç”¨ Wasm ä½œä¸ºæ‰©å±•æœºåˆ¶å¯¹æ•°æ®å¹³é¢è¿›è¡Œç¼–ç¨‹çš„æ–¹æ³•ã€‚å¼€å‘äººå‘˜å¯ä»¥ç”¨ Cã€C++ã€Rustã€AssemblyScriptã€Swift å’Œ TinyGo ç­‰è¯­è¨€ç¼–å†™ç‰¹å®šåº”ç”¨çš„ä»£ç†é€»è¾‘ï¼Œå¹¶å°†è¯¥æ¨¡å—ç¼–è¯‘åˆ° Wasm ä¸­ã€‚é€šè¿‡ proxy-Wasm æ ‡å‡†ï¼Œä»£ç†å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/bytecodealliance/wasmtime&#34; title=&#34;Wasmtime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wasmtime&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/WasmEdge/WasmEdge&#34; title=&#34;WasmEdge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmEdge&lt;/a&gt; ç­‰é«˜æ€§èƒ½è¿è¡Œæœºåˆ¶ä¸­æ‰§è¡Œé‚£äº› Wasm æ’ä»¶ã€‚ç›®å‰ï¼Œ&lt;a href=&#34;https://envoyproxy.io/&#34; title=&#34;Envoy Proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/istio/proxy&#34; title=&#34;Istio Proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Proxy&lt;/a&gt;ã€MOSN å’Œ &lt;a href=&#34;http://openresty.org/&#34; title=&#34;OpenResty&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenResty&lt;/a&gt; æ”¯æŒ &lt;a href=&#34;https://github.com/proxy-wasm&#34; title=&#34;proxy-Wasm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proxy-Wasm&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-wasm-service-mesh/008i3skNly1gy9u3wo1dnj30u015yq70_hu7a2a222547ac097e607aceb17e3f940d_96912_715x1000_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-wasm-service-mesh/008i3skNly1gy9u3wo1dnj30u015yq70.jpg&#34; data-img=&#34;/trans/ebpf-wasm-service-mesh/008i3skNly1gy9u3wo1dnj30u015yq70.jpg&#34; data-width=&#34;715&#34; data-height=&#34;1000&#34; alt=&#34;image&#34; data-caption=&#34;å®¹å™¨ç”Ÿæ€&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;å®¹å™¨ç”Ÿæ€&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ï¼ˆå®¹å™¨ç”Ÿæ€ç³»ç»Ÿä¸­çš„ Wasmï¼Œæ¥æºï¼š&lt;a href=&#34;https://wasmedge.org/book/en/kubernetes.html&#34; title=&#34;WasmEdge Book&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmEdge Book&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒWasm å¯ä»¥ä½œä¸ºä¸€ä¸ªé€šç”¨çš„åº”ç”¨å®¹å™¨ã€‚å®ƒåœ¨æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸Šçš„åº”ç”¨å¹¶ä¸é™äº sidecar ä»£ç†ã€‚é™„åœ¨ sidecar ä¸Šçš„å¾®æœåŠ¡å¯ä»¥åœ¨å®ƒè‡ªå·±çš„è½»é‡çº§ Wasm è¿è¡Œæ—¶è¿è¡Œã€‚WasmEdge WebAssembly è¿è¡Œæ—¶æ˜¯ä¸€ä¸ªå®‰å…¨ã€è½»é‡çº§ã€å¿«é€Ÿã€å¯ç§»æ¤å’Œå¤šå…ƒåŒ–çš„è¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥ç”± &lt;a href=&#34;https://wasmedge.org/book/en/kubernetes.html&#34; title=&#34;Kubernetes ä½œä¸ºå®¹å™¨&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä½œä¸ºå®¹å™¨&lt;/a&gt;ç®¡ç†ã€‚åˆ° 2021 å¹´ 12 æœˆï¼ŒWasmEdge ç¤¾åŒºçš„è´¡çŒ®è€…è¯æ˜äº†åŸºäº WasmEdge çš„å¾®æœåŠ¡å¯ä»¥ä¸ &lt;a href=&#34;https://github.com/second-state/dapr-wasm&#34; title=&#34;Dapr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dapr&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/Liquid-Reply/kind-crun-wasm&#34; title=&#34;Linkerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt; ä¸€èµ·å·¥ä½œï¼Œä½œä¸ºå¸¦æœ‰æ“ä½œç³»ç»Ÿå’Œå®Œæ•´è½¯ä»¶å †æ ˆçš„é‡é‡çº§å…¨é¢çš„ Linux å®¹å™¨çš„æ›¿ä»£ã€‚WebAssembly å¾®æœåŠ¡æ¶ˆè€— 1% çš„èµ„æºï¼Œä¸ Linux å®¹å™¨åº”ç”¨ç›¸æ¯”ï¼Œå†·å¯åŠ¨çš„æ—¶é—´æ˜¯ 1%ã€‚&lt;/p&gt;
&lt;p&gt;eBPF å’Œ Wasm æ˜¯æœåŠ¡ç½‘æ ¼åº”ç”¨åœ¨æ•°æ®å¹³é¢ä¸Šå®ç°é«˜æ€§èƒ½çš„æ–°ç”ŸåŠ›é‡ã€‚å®ƒä»¬ä»ç„¶æ˜¯æ–°ç”Ÿçš„æŠ€æœ¯ï¼Œä½†æœ‰å¯èƒ½æˆä¸ºä»Šå¤©å¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿä¸­ Linux å®¹å™¨çš„æ›¿ä»£å“æˆ–è¡¥å……ã€‚&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>å‘Šåˆ« Sidecarâ€”â€”ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼</title>
      <link>https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/</link>
      <pubDate>Thu, 09 Dec 2021 21:03:00 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/</guid>
      <description>
        
        
        &lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡ä½œè€…æ˜¯ Isovalent è”åˆåˆ›å§‹äºº&amp;amp;CTOï¼ŒåŸæ–‡æ ‡é¢˜ &lt;a href=&#34;https://isovalent.com/blog/post/2021-12-08-ebpf-servicemesh&#34; title=&#34;How eBPF will solve Service Mesh - Goodbye Sidecars&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How eBPF will solve Service Mesh - Goodbye Sidecars&lt;/a&gt;ï¼Œä½œè€…å›é¡¾äº† Linux å†…æ ¸çš„è¿æ¥æ€§ï¼Œå®ç°æœåŠ¡ç½‘æ ¼çš„å‡ ç§æ¨¡å¼ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ eBPF å®ç°æ—  Sidecar çš„æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼&#34;&gt;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;éšç€åˆ†å¸ƒå¼åº”ç”¨çš„å¼•å…¥ï¼Œé¢å¤–çš„å¯è§æ€§ã€è¿æ¥æ€§å’Œå®‰å…¨æ€§è¦æ±‚ä¹Ÿæµ®å‡ºæ°´é¢ã€‚åº”ç”¨ç¨‹åºç»„ä»¶é€šè¿‡ä¸å—ä¿¡ä»»çš„ç½‘ç»œè·¨è¶Šäº‘å’Œé›†ç¾¤è¾¹ç•Œè¿›è¡Œé€šä¿¡ï¼Œè´Ÿè½½å‡è¡¡ã€å¼¹æ€§å˜å¾—è‡³å…³é‡è¦ï¼Œå®‰å…¨å¿…é¡»å‘å±•åˆ°å‘é€è€…å’Œæ¥æ”¶è€…éƒ½å¯ä»¥éªŒè¯å½¼æ­¤çš„èº«ä»½çš„æ¨¡å¼ã€‚åœ¨åˆ†å¸ƒå¼åº”ç”¨çš„æ—©æœŸï¼Œè¿™äº›è¦æ±‚æ˜¯é€šè¿‡ç›´æ¥å°†æ‰€éœ€çš„é€»è¾‘åµŒå…¥åˆ°åº”ç”¨ä¸­æ¥è§£å†³çš„ã€‚æœåŠ¡ç½‘æ ¼å°†è¿™äº›åŠŸèƒ½ä»åº”ç”¨ç¨‹åºä¸­æå–å‡ºæ¥ï¼Œä½œä¸ºåŸºç¡€è®¾æ–½çš„ä¸€éƒ¨åˆ†æä¾›ç»™æ‰€æœ‰åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå› æ­¤ä¸å†éœ€è¦ä¿®æ”¹æ¯ä¸ªåº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx_hua6c2cd571585fb65a70eadebc0ec1003_20153_1000x333_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;333&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡ç½‘æ ¼ç¤ºæ„å›¾&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;æœåŠ¡ç½‘æ ¼ç¤ºæ„å›¾&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;çºµè§‚ä»Šå¤©æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½è®¾ç½®ï¼Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼¹æ€§è¿æ¥&lt;/strong&gt;ï¼šæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„é€šä¿¡å¿…é¡»èƒ½å¤Ÿè·¨è¶Šè¾¹ç•Œï¼Œå¦‚äº‘ã€é›†ç¾¤å’Œåœºæ‰€ã€‚é€šä¿¡å¿…é¡»æ˜¯æœ‰å¼¹æ€§çš„å’Œå®¹é”™çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;L7 æµé‡ç®¡ç†&lt;/strong&gt;ï¼šè´Ÿè½½å‡è¡¡ã€é€Ÿç‡é™åˆ¶å’Œå¼¹æ€§å¿…é¡»æ˜¯ L7 æ„ŸçŸ¥çš„ï¼ˆHTTPã€RESTã€gRPCã€WebSocket ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸºäºèº«ä»½çš„å®‰å…¨&lt;/strong&gt;ï¼šä¾é ç½‘ç»œæ ‡è¯†ç¬¦æ¥å®ç°å®‰å…¨å·²ç»ä¸å¤Ÿäº†ï¼Œå‘é€å’Œæ¥æ”¶æœåŠ¡éƒ½å¿…é¡»èƒ½å¤Ÿæ ¹æ®èº«ä»½è€Œä¸æ˜¯ç½‘ç»œæ ‡è¯†ç¬¦æ¥éªŒè¯å¯¹æ–¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§å’Œè·Ÿè¸ª&lt;/strong&gt;ï¼šè¿½è¸ªå’ŒæŒ‡æ ‡å½¢å¼çš„å¯è§‚æµ‹æ€§å¯¹äºç†è§£ã€ç›‘æ§å’Œæ’é™¤åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€æ€§èƒ½å’Œå¯ç”¨æ€§è‡³å…³é‡è¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€æ˜&lt;/strong&gt;ï¼šè¯¥åŠŸèƒ½å¿…é¡»ä»¥é€æ˜çš„æ–¹å¼æä¾›ç»™åº”ç”¨ç¨‹åºï¼Œå³ä¸éœ€è¦æ”¹å˜åº”ç”¨ç¨‹åºä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æ—©æœŸï¼ŒæœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½é€šå¸¸æ˜¯ä»¥åº“çš„å½¢å¼å®ç°çš„ï¼Œè¦æ±‚ç½‘æ ¼ä¸­çš„æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½è¦é“¾æ¥åˆ°ä»¥åº”ç”¨ç¨‹åºçš„è¯­è¨€æ¡†æ¶ç¼–å†™çš„åº“ã€‚ç±»ä¼¼çš„äº‹æƒ…ä¹Ÿå‘ç”Ÿåœ¨äº’è”ç½‘çš„æ—©æœŸï¼šæ›¾å‡ ä½•æ—¶ï¼Œåº”ç”¨ç¨‹åºè¿˜éœ€è¦è¿è¡Œè‡ªå·±çš„ TCP/IP åè®®æ ˆï¼æ­£å¦‚æˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­è®¨è®ºçš„é‚£æ ·ï¼ŒæœåŠ¡ç½‘æ ¼æ­£åœ¨å‘å±•æˆä¸ºä¸€ç§å†…æ ¸è´£ä»»ï¼Œå°±åƒç½‘ç»œå †æ ˆä¸€æ ·ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p_huc07436ee8edf5797da1225297f3d73d5_34631_1000x325_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;325&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäºåº“çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŸºäºåº“çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä»Šå¤©ï¼ŒæœåŠ¡ç½‘æ ¼é€šå¸¸ä½¿ç”¨ä¸€ç§å«åš sidecar æ¨¡å‹çš„æ¶æ„æ¥å®ç°ã€‚è¿™ç§æ¶æ„å°†å®ç°ä¸Šè¿°åŠŸèƒ½çš„ä»£ç å°è£…åˆ°ç¬¬å››å±‚ä»£ç†ä¸­ï¼ŒæœåŠ¡é—´çš„æµé‡è¢«é‡å®šå‘åˆ°è¿™ä¸ªæ‰€è°“çš„ sidecar ä»£ç†ã€‚å®ƒä¹‹æ‰€ä»¥è¢«ç§°ä¸ºâ€œæŒæ–—â€ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªä»£ç†ï¼Œå°±åƒæŒæ–—é™„ç€åœ¨æ‘©æ‰˜è½¦ä¸Šä¸€æ ·ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h_huaf93cae986db9eaf01d794ad4e833541_34035_1000x369_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;369&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäº Sidecar çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŸºäº Sidecar çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;è¿™ç§æ¶æ„çš„ä¼˜ç‚¹æ˜¯ï¼ŒæœåŠ¡ä¸å†éœ€è¦è‡ªå·±å®ç°æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½ã€‚å¦‚æœè®¸å¤šæœåŠ¡æ˜¯ç”¨ä¸åŒçš„è¯­è¨€ç¼–å†™éƒ¨ç½²çš„ï¼Œæˆ–è€…å¦‚æœä½ æ­£åœ¨è¿è¡Œä¸å¯å˜çš„ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œè¿™å°±å¾ˆæœ‰å¥½å¤„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹æ˜¯æœ‰å¤§é‡çš„ä»£ç†ï¼Œè®¸å¤šé¢å¤–çš„ç½‘ç»œè¿æ¥ï¼Œä»¥åŠå¤æ‚çš„é‡å®šå‘é€»è¾‘ï¼Œå°†ç½‘ç»œæµé‡è¾“å…¥ä»£ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä»€ä¹ˆç±»å‹çš„ç½‘ç»œæµé‡å¯ä»¥è¢«é‡å®šå‘åˆ°ç¬¬å››å±‚ä»£ç†ä¸Šä¹Ÿæœ‰é™åˆ¶ã€‚ä»£ç†ï¼ˆProxyï¼‰åœ¨å…¶èƒ½æ”¯æŒçš„ç½‘ç»œåè®®æ–¹é¢æ˜¯æœ‰é™çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿æ¥æ€§è½¬ç§»åˆ°å†…æ ¸ä¸­çš„å†å²&#34;&gt;è¿æ¥æ€§è½¬ç§»åˆ°å†…æ ¸ä¸­çš„å†å²&lt;/h2&gt;
&lt;p&gt;å‡ åå¹´æ¥ï¼Œåœ¨åº”ç”¨ç¨‹åºä¹‹é—´æä¾›å®‰å…¨å¯é çš„è¿æ¥ä¸€ç›´æ˜¯æ“ä½œç³»ç»Ÿçš„è´£ä»»ã€‚æœ‰äº›äººå¯èƒ½è¿˜è®°å¾—æ—©æœŸ Unix å’Œ Linux æ—¶ä»£çš„ &lt;a href=&#34;https://en.wikipedia.org/wiki/TCP_Wrappers&#34; title=&#34;TCP åŒ…è£…å™¨&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP åŒ…è£…å™¨&lt;/a&gt;å’Œ tcpdã€‚tcpd å…è®¸ç”¨æˆ·åœ¨ä¸ä¿®æ”¹åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹é€æ˜åœ°æ·»åŠ æ—¥å¿—ã€è®¿é—®æ§åˆ¶ã€ä¸»æœºåéªŒè¯å’Œæ¬ºéª—ä¿æŠ¤ã€‚å®ƒä½¿ç”¨äº† libwrapï¼Œè€Œä¸”ï¼Œåœ¨ä¸€ä¸ªæœ‰è¶£çš„å¹³è¡ŒäºæœåŠ¡ç½‘æ ¼çš„æ•…äº‹ä¸­ï¼Œè¿™ä¸ªåº“ä¹Ÿæ˜¯ä»¥å‰åº”ç”¨ç¨‹åºæä¾›è¿™äº›åŠŸèƒ½çš„é“¾æ¥å¯¹è±¡ã€‚tcpd æ‰€å¸¦æ¥çš„æ˜¯èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ç°æœ‰åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å°†è¿™äº›åŠŸèƒ½é€æ˜åœ°æ·»åŠ åˆ°ç°æœ‰åº”ç”¨ç¨‹åºä¸­ã€‚æœ€ç»ˆï¼Œæ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½è¿›å…¥äº† Linux æœ¬èº«ï¼Œå¹¶ä»¥ä¸€ç§æ›´æœ‰æ•ˆã€æ›´å¼ºå¤§çš„æ–¹å¼æä¾›ç»™æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚ä»Šå¤©ï¼Œè¿™å·²ç»å‘å±•åˆ°äº†æˆ‘ä»¬æ‰€çŸ¥é“çš„ iptablesã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œiptables æ˜¾ç„¶ä¸é€‚åˆè§£å†³ç°ä»£åº”ç”¨çš„è¿æ¥æ€§ã€å®‰å…¨æ€§å’Œå¯è§‚æµ‹æ€§è¦æ±‚ï¼Œå› ä¸ºå®ƒåªåœ¨ç½‘ç»œå±‚é¢ä¸Šæ“ä½œï¼Œå¯¹åº”ç”¨åè®®å±‚ç¼ºä¹ä»»ä½•äº†è§£ã€‚è‡ªç„¶ï¼Œé˜»åŠ›æœ€å°çš„è·¯å¾„æ˜¯å›åˆ°åº“æ¨¡å‹ï¼Œç„¶åæ˜¯ sidecar æ¨¡å‹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ­£å¤„äºè¿™æ ·ä¸€ä¸ªé˜¶æ®µï¼šä¸ºäº†æœ€ä½³çš„é€æ˜åº¦ã€æ•ˆç‡å’Œå®‰å…¨æ€§ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­åŸç”Ÿåœ°æ”¯æŒè¿™ç§æ¨¡å¼æ˜¯æœ‰æ„ä¹‰çš„ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s_hu8a5473f255e424c714bce0ef0dc797bf_57615_1000x565_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;565&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡ç½‘æ ¼çš„è¿›åŒ–&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;æœåŠ¡ç½‘æ ¼çš„è¿›åŒ–&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;åœ¨ tcpd æ—¶ä»£ï¼Œæ›¾ç»çš„è¿æ¥è®°å½•ç°åœ¨æ˜¯è¿½è¸ªã€‚IP å±‚é¢çš„è®¿é—®æ§åˆ¶å·²ç»æ¼”å˜æˆåº”ç”¨åè®®å±‚é¢çš„æˆæƒï¼Œä¾‹å¦‚ä½¿ç”¨ JWTã€‚ä¸»æœºåéªŒè¯å·²è¢«æ›´å¼ºå¤§çš„è®¤è¯æ‰€å–ä»£ï¼Œå¦‚ mTLSã€‚ç½‘ç»œè´Ÿè½½å‡è¡¡å·²ç»æ‰©å±•åˆ° L7 æµé‡ç®¡ç†ã€‚HTTP é‡è¯•æ˜¯æ–°çš„ TCP é‡ä¼ ã€‚è¿‡å»ç”¨é»‘æ´è·¯ç”±è§£å†³çš„é—®é¢˜ä»Šå¤©è¢«ç§°ä¸ºæ–­è·¯ã€‚è¿™äº›éƒ½ä¸æ˜¯æ ¹æœ¬æ€§çš„æ–°é—®é¢˜ï¼Œä½†æ‰€éœ€çš„ç¯å¢ƒå’Œæ§åˆ¶å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•å†…æ ¸å‘½åç©ºé—´æ¦‚å¿µ&#34;&gt;æ‰©å±•å†…æ ¸å‘½åç©ºé—´æ¦‚å¿µ&lt;/h2&gt;
&lt;p&gt;Linux å†…æ ¸å·²ç»æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå¯ä»¥å…±äº«å…±åŒçš„åŠŸèƒ½ï¼Œå¹¶ä½¿å…¶å¯¹ç³»ç»Ÿä¸Šè¿è¡Œçš„è®¸å¤šåº”ç”¨ç¨‹åºå¯ç”¨ã€‚è¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºå‘½åç©ºé—´ï¼ˆNamespaceï¼‰ï¼Œå®ƒæ„æˆäº†æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥çš„å®¹å™¨æŠ€æœ¯çš„åŸºç¡€ã€‚å‘½åç©ºé—´ï¼ˆå†…æ ¸çš„é‚£ç§ï¼Œä¸æ˜¯ Kubernetes çš„å‘½åç©ºé—´ï¼‰å­˜åœ¨äºå„ç§æŠ½è±¡ä¸­ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç”¨æˆ·ç®¡ç†ã€æŒ‚è½½è®¾å¤‡ã€è¿›ç¨‹ã€ç½‘ç»œç­‰ã€‚è¿™å°±æ˜¯å…è®¸å•ä¸ªå®¹å™¨å‘ˆç°ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€ä¸åŒçš„ç”¨æˆ·é›†ï¼Œä»¥åŠå…è®¸å¤šä¸ªå®¹å™¨ç»‘å®šåˆ°å•ä¸ªä¸»æœºä¸Šçš„åŒä¸€ç½‘ç»œç«¯å£ã€‚åœ¨ cgroups çš„å¸®åŠ©ä¸‹ï¼Œè¿™ä¸ªæ¦‚å¿µå¾—åˆ°äº†æ‰©å±•ï¼Œå¯ä»¥å¯¹ CPUã€å†…å­˜å’Œç½‘ç»œç­‰èµ„æºè¿›è¡Œç®¡ç†å’Œä¼˜å…ˆæ’åºã€‚ä»äº‘åŸç”Ÿåº”ç”¨å¼€å‘è€…çš„è§’åº¦æ¥çœ‹ï¼Œcgroups å’Œèµ„æºè¢«ç´§å¯†åœ°æ•´åˆåˆ°æˆ‘ä»¬æ‰€çŸ¥çš„ &amp;ldquo;å®¹å™¨&amp;rdquo; æ¦‚å¿µä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¦åˆé€»è¾‘çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è®¤ä¸ºæœåŠ¡ç½‘æ ¼æ˜¯æ“ä½œç³»ç»Ÿçš„è´£ä»»ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ç¬¦åˆå¹¶æ•´åˆå‘½åç©ºé—´å’Œ cgroup çš„æ¦‚å¿µã€‚è¿™çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75_hu0231bbb9093297f602ab036f13fd844c_60777_1000x426_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;426&#34; alt=&#34;image&#34; data-caption=&#34;Service Mesh Namespace&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;Service Mesh Namespace&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä¸å‡ºæ‰€æ–™ï¼Œè¿™çœ‹èµ·æ¥éå¸¸è‡ªç„¶ï¼Œè€Œä¸”å¯èƒ½æ˜¯å¤§å¤šæ•°ç”¨æˆ·ä»ç®€å•çš„è§’åº¦æ‰€æœŸæœ›çš„ã€‚åº”ç”¨ç¨‹åºä¿æŒä¸å˜ï¼Œå®ƒä»¬ç»§ç»­ä½¿ç”¨å¥—æ¥å­—è¿›è¡Œé€šä¿¡ï¼Œå°±åƒä»¥å‰é‚£æ ·ã€‚ç†æƒ³çš„æœåŠ¡ç½‘æ ¼æ˜¯ä½œä¸º Linux çš„ä¸€éƒ¨åˆ†é€æ˜åœ°æä¾›çš„ã€‚å®ƒå°±åœ¨é‚£é‡Œï¼Œå°±åƒä»Šå¤©çš„ TCP ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ³¨å…¥-sidecar-çš„æˆæœ¬&#34;&gt;æ³¨å…¥ Sidecar çš„æˆæœ¬&lt;/h3&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹ sidecar æ¨¡å‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒå®é™…ä¸Šæ˜¯åœ¨è¯•å›¾æ¨¡ä»¿è¿™ç§æ¨¡å‹ã€‚åº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨å¥—æ¥å­—ï¼Œä¸€åˆ‡éƒ½è¢«å¡è¿› Linux å†…æ ¸çš„ç½‘ç»œå‘½åç©ºé—´ã€‚ç„¶è€Œï¼Œè¿™æ¯”å®ƒçœ‹èµ·æ¥è¦å¤æ‚å¾—å¤šï¼Œéœ€è¦è®¸å¤šé¢å¤–çš„æ­¥éª¤æ¥é€æ˜åœ°æ³¨å…¥ sidecar ä»£ç†ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s_hu8a5473f255e424c714bce0ef0dc797bf_57615_1000x565_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;565&#34; alt=&#34;image&#34; data-caption=&#34;æ³¨å…¥ Sidecar çš„æˆæœ¬&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;æ³¨å…¥ Sidecar çš„æˆæœ¬&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;è¿™ç§é¢å¤–çš„å¤æ‚æ€§åœ¨å»¶è¿Ÿå’Œé¢å¤–èµ„æºæ¶ˆè€—æ–¹é¢ä»˜å‡ºäº†å·¨å¤§çš„ä»£ä»·ã€‚æ—©æœŸçš„åŸºå‡†æµ‹è¯•è¡¨æ˜ï¼Œè¿™å¯¹å»¶è¿Ÿçš„å½±å“é«˜è¾¾ 3-4 å€ï¼Œè€Œä¸”æ‰€æœ‰ä»£ç†éƒ½éœ€è¦å¤§é‡çš„é¢å¤–å†…å­˜ã€‚åœ¨è¿™ç¯‡æ–‡ç« çš„åé¢ï¼Œæˆ‘ä»¬å°†ç ”ç©¶è¿™ä¸¤ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å°†å…¶ä¸åŸºäº eBPF çš„æ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”¨-ebpf-è§£é”å†…æ ¸æœåŠ¡ç½‘æ ¼&#34;&gt;ç”¨ eBPF è§£é”å†…æ ¸æœåŠ¡ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»¥å‰æ²¡æœ‰åœ¨å†…æ ¸ä¸­åˆ›å»ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼ï¼Ÿæœ‰äº›äººåŠå¼€ç©ç¬‘åœ°è¯´ï¼Œkube-proxy æ˜¯æœ€åˆçš„æœåŠ¡ç½‘æ ¼ï¼ˆè§&lt;a href=&#34;https://www.youtube.com/watch?v=lUF88T16YqY&amp;amp;ab_channel=CloudNativeRejekts&#34; title=&#34;æˆ‘ä»¬å·²ç»æ„å»ºäº†ç›¸å½“å¤šçš„æœåŠ¡ç½‘æ ¼ - Tim Hockin, Google&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬å·²ç»æ„å»ºäº†ç›¸å½“å¤šçš„æœåŠ¡ç½‘æ ¼ - Tim Hockin, Google&lt;/a&gt;ï¼‰ã€‚è¿™å¥è¯æ˜¯æœ‰ä¸€å®šé“ç†çš„ã€‚Kube-proxy æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¯´æ˜äº† Linux å†…æ ¸åœ¨ä¾é ä¼ ç»Ÿçš„åŸºäºç½‘ç»œçš„ iptables åŠŸèƒ½å®ç°æœåŠ¡ç½‘æ ¼æ—¶ï¼Œå¯ä»¥è¾¾åˆ°å¤šä¹ˆæ¥è¿‘ã€‚ç„¶è€Œï¼Œè¿™è¿˜ä¸å¤Ÿï¼ŒL7 ä¸Šä¸‹æ–‡æ˜¯ç¼ºå¤±çš„ã€‚Kube-proxy å®Œå…¨åœ¨ç½‘ç»œæ•°æ®åŒ…å±‚é¢è¿ä½œã€‚ç°ä»£åº”ç”¨éœ€è¦ L7 æµé‡ç®¡ç†ã€è·Ÿè¸ªã€è®¤è¯å’Œé¢å¤–çš„å¯é æ€§ä¿è¯ã€‚Kube-proxy ä¸èƒ½åœ¨ç½‘ç»œå±‚é¢ä¸Šæä¾›è¿™äº›ã€‚&lt;/p&gt;
&lt;p&gt;eBPF æ”¹å˜äº†è¿™ä¸ªæ¨¡å¼ã€‚å®ƒå…è®¸åŠ¨æ€åœ°æ‰©å±• Linux å†…æ ¸çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ eBPF ä¸º Cilium å»ºç«‹ä¸€ä¸ªé«˜æ•ˆçš„ç½‘ç»œã€å®‰å…¨å’Œå¯è§‚æµ‹æ€§æ•°æ®é€šè·¯ï¼Œå¹¶å°†å…¶ç›´æ¥åµŒå…¥åˆ° Linux å†…æ ¸ã€‚åº”ç”¨è¿™ä¸ªç›¸åŒçš„æ¦‚å¿µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å†…æ ¸å±‚é¢ä¸Šè§£å†³æœåŠ¡ç½‘æ ¼çš„è¦æ±‚ã€‚äº‹å®ä¸Šï¼ŒCilium å·²ç»å®ç°äº†å„ç§æ‰€éœ€çš„æ¦‚å¿µï¼Œå¦‚åŸºäºèº«ä»½çš„å®‰å…¨ã€L3-L7 å¯è§‚æµ‹æ€§å’Œæˆæƒã€åŠ å¯†å’Œè´Ÿè½½å‡è¡¡ã€‚ç¼ºå°‘çš„éƒ¨åˆ†ç°åœ¨æ­£åœ¨å‘ Cilium æ¶Œæ¥ã€‚åœ¨æœ¬åšå®¢çš„æœ«å°¾ï¼Œä½ ä¼šå‘ç°å¦‚ä½•åŠ å…¥ç”± Cilium ç¤¾åŒºæ¨åŠ¨çš„ Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•é¡¹ç›®çš„ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o_huef89581372e3d2d6460499fe849d7582_45764_1000x440_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;440&#34; alt=&#34;image&#34; data-caption=&#34;eBPF æœåŠ¡ç½‘æ ¼æ¶æ„&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;eBPF æœåŠ¡ç½‘æ ¼æ¶æ„&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;æœ‰äººå¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ Linux å†…æ ¸ç¤¾åŒºä¸ç›´æ¥è§£å†³è¿™äº›éœ€æ±‚&lt;/strong&gt;ã€‚eBPF æœ‰ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ï¼ŒeBPF ä»£ç å¯ä»¥åœ¨è¿è¡Œæ—¶æ’å…¥åˆ°ç°æœ‰çš„ Linux å†…æ ¸ä¸­ï¼Œç±»ä¼¼äº Linux å†…æ ¸æ¨¡å—ï¼Œä½†ä¸å†…æ ¸æ¨¡å—ä¸åŒï¼Œå®ƒå¯ä»¥ä»¥å®‰å…¨å’Œå¯ç§»æ¤çš„æ–¹å¼è¿›è¡Œã€‚è¿™ä½¿å¾— eBPF çš„å®ç°èƒ½å¤Ÿéšç€æœåŠ¡ç½‘æ ¼ç¤¾åŒºçš„å‘å±•è€Œç»§ç»­å‘å±•ã€‚&lt;strong&gt;æ–°çš„å†…æ ¸ç‰ˆæœ¬éœ€è¦å‡ å¹´æ—¶é—´æ‰èƒ½è¿›å…¥ç”¨æˆ·æ‰‹ä¸­&lt;/strong&gt;ã€‚eBPF æ˜¯ä¸€é¡¹å…³é”®æŠ€æœ¯ï¼Œå®ƒä½¿ Linux å†…æ ¸èƒ½å¤Ÿè·Ÿä¸Šå¿«é€Ÿå‘å±•çš„äº‘åŸç”ŸæŠ€æœ¯æ ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ— -sidecar-çš„åŸºäº-ebpf-çš„-l7-è¿½è¸ªå’Œåº¦é‡&#34;&gt;æ—  Sidecar çš„åŸºäº eBPF çš„ L7 è¿½è¸ªå’Œåº¦é‡&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹ L7 è¿½è¸ªå’ŒæŒ‡æ ‡å¯è§‚æµ‹æ€§ï¼Œä½œä¸ºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œè¯´æ˜åŸºäº eBPF çš„æœåŠ¡ç½‘æ ¼å¯¹ä¿æŒä½å»¶è¿Ÿå’Œæé«˜è§‚å¯Ÿæ€§æœ‰å·¨å¤§çš„å½±å“ã€‚åº”ç”¨ç¨‹åºå›¢é˜Ÿä¾é åº”ç”¨ç¨‹åºçš„å¯è§æ€§å’Œç›‘æ§ä½œä¸ºåŸºæœ¬è¦æ±‚è¿™äº›ï¼Œè¿™åŒ…æ‹¬è¯·æ±‚è·Ÿè¸ªã€HTTP å“åº”ç‡å’ŒæœåŠ¡å»¶è¿Ÿä¿¡æ¯ç­‰èƒ½åŠ›ã€‚ç„¶è€Œï¼Œè¿™ç§å¯è§‚æµ‹æ€§åº”è¯¥æ²¡æœ‰æ˜æ˜¾çš„æˆæœ¬ï¼ˆå»¶è¿Ÿã€å¤æ‚æ€§ã€èµ„æºâ€¦ï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1_hu1e4ac016ebc928d7a057881be1715063_60109_1000x317_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;317&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäº eBPF çš„å¯è§†æ€§&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŸºäº eBPF çš„å¯è§†æ€§&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;åœ¨ä¸‹é¢çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—©æœŸçš„æµ‹é‡ç»“æœï¼Œå³é€šè¿‡ eBPF æˆ– sidecar æ–¹æ³•å®ç° HTTP å¯è§æ€§å¯¹å»¶è¿Ÿçš„å½±å“ã€‚è¯¥è®¾ç½®æ˜¯åœ¨ä¸¤ä¸ªä¸åŒèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä¸¤ä¸ª pod ä¹‹é—´é€šè¿‡å›ºå®šæ•°é‡çš„è¿æ¥æ¯ç§’ç¨³å®šè¿è¡Œ 10K ä¸ª HTTP è¯·æ±‚ï¼Œå¹¶æµ‹é‡è¯·æ±‚çš„å¹³å‡å»¶æ—¶ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw_hu2d8acacafd20e3778dae86b39c157b1b_22234_1000x456_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;456&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäº eBPF çš„å»¶è¿ŸåŸºå‡†æµ‹è¯• vs åŸºäº Sidecar çš„ L7 å¯è§†æ€§&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŸºäº eBPF çš„å»¶è¿ŸåŸºå‡†æµ‹è¯• vs åŸºäº Sidecar çš„ L7 å¯è§†æ€§&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬æ•…æ„ä¸æè¿™äº›æµ‹é‡ä¸­ä½¿ç”¨çš„å…·ä½“ä»£ç†ï¼Œå› ä¸ºå®ƒå¹¶ä¸é‡è¦ã€‚å¯¹äºæˆ‘ä»¬æµ‹è¯•è¿‡çš„æ‰€æœ‰ä»£ç†ï¼Œç»“æœå‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¦æ˜ç¡®çš„æ˜¯ï¼Œè¿™ä¸æ˜¯å…³äº Envoyã€Linkerdã€Nginx æˆ–å…¶ä»–ä»£ç†æ˜¯å¦æ›´å¿«ã€‚æ‰€æåˆ°çš„ä»£ç†æœ‰å·®å¼‚ï¼Œä½†ä¸é¦–å…ˆæ³¨å…¥ä»£ç†çš„æˆæœ¬ç›¸æ¯”ï¼Œå®ƒä»¬æ˜¯å¾®ä¸è¶³é“çš„ã€‚&lt;strong&gt;å‡ ä¹æ²¡æœ‰å¼€é”€æ˜¯æ¥è‡ªä»£ç†æœ¬èº«çš„é€»è¾‘ã€‚å¼€é”€æ˜¯é€šè¿‡æ³¨å…¥ä»£ç†ï¼Œå°†ç½‘ç»œæµé‡é‡å®šå‘åˆ°å®ƒï¼Œç»ˆæ­¢è¿æ¥å’Œå¯åŠ¨æ–°çš„è¿æ¥è€Œå¢åŠ çš„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™äº›æ—©æœŸçš„æµ‹é‡ç»“æœè¡¨æ˜ï¼ŒåŸºäº eBPF çš„å†…æ ¸æ–¹æ³•æ˜¯éå¸¸æœ‰å‰é€”çš„ï¼Œå¯ä»¥å®ç°å®Œå…¨é€æ˜çš„æœåŠ¡ç½‘æ ¼çš„æ„¿æœ›ï¼Œè€Œä¸”æ²¡æœ‰æ˜æ˜¾çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-ebpf-åŠ é€Ÿçš„-per-node-ä»£ç†&#34;&gt;ä½¿ç”¨ eBPF åŠ é€Ÿçš„ per-node ä»£ç†&lt;/h2&gt;
&lt;p&gt;è¶Šæ¥è¶Šå¤šçš„ç”¨ä¾‹å¯ä»¥ç”¨è¿™ç§ä»…æœ‰ eBPF çš„æ–¹æ³•æ¥è¦†ç›–ï¼Œä»è€Œå®Œå…¨å–æ¶ˆ L4 ä»£ç†ã€‚æœ‰äº›ç”¨ä¾‹ï¼Œä»ç„¶éœ€è¦ä»£ç†ã€‚ä¾‹å¦‚ï¼Œå½“è¿æ¥éœ€è¦æ‹¼æ¥æ—¶ï¼Œå½“ TLS ç»ˆæ­¢è¢«æ‰§è¡Œæ—¶ï¼Œæˆ–å¯¹äºæŸäº›å½¢å¼çš„ HTTP æˆæƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„ eBPF æœåŠ¡ç½‘æ ¼å·¥ä½œå°†ç»§ç»­å…³æ³¨é‚£äº›ä»æ€§èƒ½è§’åº¦å¯ä»¥è·å¾—æœ€å¤§æ”¶ç›Šçš„é¢†åŸŸã€‚å¦‚æœä½ å¿…é¡»æ‰§è¡Œ TLS ç»ˆæ­¢ï¼Œä½ å¯èƒ½ä¸ä»‹æ„åœ¨æµé‡æµå…¥é›†ç¾¤æ—¶ç”¨ä»£ç†ç»ˆæ­¢ä¸€æ¬¡è¿æ¥ã€‚ç„¶è€Œï¼Œä½ ä¼šæ›´å…³å¿ƒåœ¨æ¯ä¸ªè¿æ¥çš„è·¯å¾„ä¸­æ³¨å…¥ä¸¤ä¸ªä»£ç†çš„å½±å“ï¼Œä»¥æå– HTTP æŒ‡æ ‡å’Œè·Ÿè¸ªæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç”¨ä¾‹ä¸èƒ½ç”¨çº¯ eBPF çš„æ–¹æ³•æ¥å®ç°æ—¶ï¼Œç½‘æ ¼å¯ä»¥å›é€€åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ä»£ç†æ¨¡å‹ï¼Œç›´æ¥å°†ä»£ç†ä¸å†…æ ¸çš„å¥—æ¥å­—å±‚ç»“åˆèµ·æ¥ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87_hu0cace0b51a36ab5ebf81e1babd7d4fc9_63694_1000x443_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;443&#34; alt=&#34;image&#34; data-caption=&#34;eBPF per-node Proxy&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;eBPF per-node Proxy&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;eBPF ä¸ä¾èµ–ç½‘ç»œçº§çš„é‡å®šå‘ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å¥—æ¥å­—çº§åˆ«æ³¨å…¥ä»£ç†ï¼Œä¿æŒè·¯å¾„çŸ­ã€‚åœ¨ Cilium çš„æ¡ˆä¾‹ä¸­ï¼Œæ­£åœ¨ä½¿ç”¨ Envoy ä»£ç†ï¼Œå°½ç®¡ä»æ¶æ„çš„è§’åº¦æ¥çœ‹ï¼Œä»»ä½•ä»£ç†éƒ½å¯ä»¥è¢«æ•´åˆåˆ°è¿™ä¸ªæ¨¡å‹ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™å…è®¸å°† Linux å†…æ ¸ç½‘ç»œå‘½åç©ºé—´çš„æ¦‚å¿µç›´æ¥æ‰©å±•åˆ° Envoy ç›‘å¬å™¨é…ç½®çš„æ¦‚å¿µï¼Œå¹¶å°† Envoy å˜æˆä¸€ä¸ªå¤šç”¨æˆ·ä»£ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-ä¸-per-node-ä»£ç†&#34;&gt;Sidecar ä¸ per-Node ä»£ç†&lt;/h2&gt;
&lt;p&gt;å³ä½¿éœ€è¦ä»£ç†ï¼Œä»£ç†çš„æˆæœ¬ä¹Ÿä¼šæ ¹æ®éƒ¨ç½²çš„æ¶æ„è€Œæœ‰æ‰€ä¸åŒã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„ä»£ç†æ¨¡å¼ä¸ sidecar æ¨¡å¼çš„æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¯ä¸ªè¿æ¥çš„ä»£ç†&#34;&gt;æ¯ä¸ªè¿æ¥çš„ä»£ç†&lt;/h3&gt;
&lt;p&gt;æ‰€éœ€çš„ç½‘ç»œè¿æ¥æ•°å°†å› æ˜¯å¦æœ‰ä»£ç†è€Œä¸åŒã€‚æœ€ç®€å•çš„æƒ…å†µæ˜¯æ—  sidecar æ¨¡å¼ï¼Œè¿™æ„å‘³ç€ç½‘ç»œè¿æ¥çš„æ•°é‡æ²¡æœ‰å˜åŒ–ã€‚ä¸€ä¸ªå•ä¸€çš„è¿æ¥å°†ä¸ºè¯·æ±‚æä¾›æœåŠ¡ï¼ŒeBPF å°†æä¾›æœåŠ¡ç½‘æ ¼åŠŸèƒ½ï¼Œå¦‚è·Ÿè¸ªæˆ–ç°æœ‰è¿æ¥ä¸Šçš„è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9_hu986159b4e232c7961a9a9aeda960997f_17519_1000x251_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;251&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäº eBPF çš„æ¨¡å‹&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŸºäº eBPF çš„æ¨¡å‹&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ç”¨ sidecar æ¨¡å‹æä¾›åŒæ ·çš„åŠŸèƒ½éœ€è¦åœ¨è¿æ¥ä¸­æ³¨å…¥ä¸¤æ¬¡ä»£ç†ï¼Œè¿™å¯¼è‡´éœ€è¦ç»´æŠ¤ä¸‰ä¸ªè¿æ¥ã€‚è¿™å¯¼è‡´äº†å¼€é”€çš„å¢åŠ å’Œæ‰€æœ‰é¢å¤–çš„å¥—æ¥å­—ç¼“å†²åŒºæ‰€éœ€å†…å­˜çš„å€å¢ï¼Œè¡¨ç°ä¸ºæ›´é«˜çš„æœåŠ¡é—´å»¶è¿Ÿã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æ—  sidecar L7 å¯è§æ€§éƒ¨åˆ†çœ‹åˆ°çš„ sidecar å¼€é”€ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3_huab3be886213e4ac57c5bd81133a2a75d_24827_1000x267_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;267&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäº Sidecar ä»£ç†çš„æ¨¡å‹&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åŸºäº Sidecar ä»£ç†çš„æ¨¡å‹&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;åˆ‡æ¢åˆ° per-node çš„ä»£ç†æ¨¡å¼ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‘†è„±å…¶ä¸­ä¸€ä¸ªä»£ç†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†ä¾èµ–åœ¨æ¯ä¸ªå·¥ä½œè´Ÿè½½ä¸­è¿è¡Œä¸€ä¸ª sidecarã€‚æ¯”èµ·ä¸éœ€è¦é¢å¤–çš„è¿æ¥ï¼Œè¿™è¿˜æ˜¯ä¸å¤Ÿç†æƒ³ï¼Œä½†æ¯”èµ·æ€»æ˜¯éœ€è¦ä¸¤ä¸ªé¢å¤–çš„è¿æ¥è¦å¥½ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz_hueca18b1a0d51d8f422c3ba1be248960a_21017_1000x297_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;297&#34; alt=&#34;image&#34; data-caption=&#34;Per-node ä»£ç†æ¨¡å¼&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;Per-node ä»£ç†æ¨¡å¼&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;h3 id=&#34;æ‰€éœ€çš„ä»£ç†æ€»æ•°&#34;&gt;æ‰€éœ€çš„ä»£ç†æ€»æ•°&lt;/h3&gt;
&lt;p&gt;åœ¨æ¯ä¸ªå·¥ä½œè´Ÿè½½ä¸­è¿è¡Œä¸€ä¸ª sidecar ä¼šå¯¼è‡´å¤§é‡çš„ä»£ç†ã€‚å³ä½¿æ¯ä¸ªå•ç‹¬çš„ä»£ç†å®ä¾‹åœ¨å…¶å†…å­˜å ç”¨æ–¹é¢æ˜¯ç›¸å½“ä¼˜åŒ–çš„ï¼Œä½†å®ä¾‹çš„æ•°é‡ä¹‹å¤šå°†å¯¼è‡´æ€»çš„å½±å“å¾ˆå¤§ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªä»£ç†ç»´æŠ¤çš„æ•°æ®ç»“æ„ï¼Œå¦‚è·¯ç”±å’Œç«¯ç‚¹è¡¨ï¼Œéšç€é›†ç¾¤çš„å¢é•¿è€Œå¢é•¿ï¼Œæ‰€ä»¥é›†ç¾¤è¶Šå¤§ï¼Œæ¯ä¸ªä»£ç†çš„å†…å­˜æ¶ˆè€—å°±è¶Šé«˜ã€‚ä»Šå¤©ï¼Œä¸€äº›æœåŠ¡ç½‘æ ¼è¯•å›¾é€šè¿‡å°†éƒ¨åˆ†è·¯ç”±è¡¨æ¨é€ç»™å•ä¸ªä»£ç†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé™åˆ¶å®ƒä»¬å¯ä»¥è·¯ç”±åˆ°å“ªé‡Œã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n_hucca097a7d2b6683e670c6328dc47e158_52881_1000x345_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;345&#34; alt=&#34;image&#34; data-caption=&#34;ä»£ç†æ•°é‡&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;ä»£ç†æ•°é‡&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;è®©æˆ‘ä»¬å‡è®¾åœ¨ä¸€ä¸ª 500 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰ 30 ä¸ª podï¼Œä¸€ä¸ªåŸºäº sidecar çš„æ¶æ„å°†éœ€è¦è¿è¡Œ 15K ä¸ªä»£ç†ã€‚åœ¨æ¯ä¸ªä»£ç†æ¶ˆè€— 70MB å†…å­˜çš„æƒ…å†µä¸‹ï¼ˆå‡è®¾å·²ç»ç»è¿‡æè‡´ä¼˜åŒ–è¿‡çš„è·¯ç”±è¡¨ï¼‰ï¼Œè¿™ä»ç„¶å¯¼è‡´é›†ç¾¤ä¸­æ‰€æœ‰ sidecar æ¶ˆè€— 1.5TB çš„å†…å­˜ã€‚åœ¨ per-node æ¨¡å‹ä¸­ï¼Œå‡è®¾æ¯ä¸ªä»£ç†çš„å†…å­˜è¶³è¿¹ç›¸åŒï¼Œ500 ä¸ªä»£ç†å°†æ¶ˆè€—ä¸è¶…è¿‡ 34GB çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤šç§Ÿæˆ·&#34;&gt;å¤šç§Ÿæˆ·&lt;/h3&gt;
&lt;p&gt;å½“æˆ‘ä»¬ä» sidecar æ¨¡å‹è½¬å‘ per-node æ¨¡å‹æ—¶ï¼Œä»£ç†å°†ä¸ºå¤šä¸ªåº”ç”¨ç¨‹åºæä¾›è¿æ¥ã€‚ä»£ç†å¿…é¡»å…·æœ‰å¤šç§Ÿæˆ·æ„ŸçŸ¥ã€‚è¿™ä¸æˆ‘ä»¬ä»ä½¿ç”¨å•ä¸ªè™šæ‹Ÿæœºè½¬å‘ä½¿ç”¨å®¹å™¨æ—¶å‘ç”Ÿçš„è¿‡æ¸¡å®Œå…¨ç›¸åŒã€‚ç”±äºæˆ‘ä»¬ä¸å†ä½¿ç”¨åœ¨æ¯ä¸ªè™šæ‹Ÿæœºä¸­è¿è¡Œçš„å®Œå…¨ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿå‰¯æœ¬ï¼Œè€Œå¼€å§‹ä¸å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«æ“ä½œç³»ç»Ÿï¼ŒLinux å¿…é¡»å…·æœ‰å¤šç§Ÿæˆ·æ„ŸçŸ¥ã€‚è¿™å°±æ˜¯å‘½åç©ºé—´å’Œ cgroup å­˜åœ¨çš„åŸå› ã€‚å¦‚æœæ²¡æœ‰å®ƒä»¬ï¼Œä¸€ä¸ªå®¹å™¨å¯èƒ½ä¼šæ¶ˆè€—ä¸€ä¸ªç³»ç»Ÿçš„æ‰€æœ‰èµ„æºï¼Œå®¹å™¨å¯èƒ½ä¼šä»¥ä¸å—æ§åˆ¶çš„æ–¹å¼è®¿é—®å¯¹æ–¹çš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs_hu588ae9502772a2ece0f3403c0248a501_70295_1000x556_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;556&#34; alt=&#34;image&#34; data-caption=&#34;Envoy Namespace&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;Envoy Namespace&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;å¦‚æœè¿™åœ¨æœåŠ¡ç½‘æ ¼çº§åˆ«çš„ç½‘ç»œèµ„æºä¸Šè¡¨ç°å¾—å®Œå…¨ä¸€æ ·ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—ï¼ŸEnvoy å·²ç»æœ‰äº†å‘½åç©ºé—´çš„åˆæ­¥æ¦‚å¿µï¼Œå®ƒä»¬è¢«ç§°ä¸ºç›‘å¬å™¨ã€‚ç›‘å¬å™¨å¯ä»¥æºå¸¦å•ç‹¬çš„é…ç½®å¹¶ç‹¬ç«‹è¿è¡Œã€‚è¿™å°†å¼€å¯å…¨æ–°çš„å¯èƒ½æ€§ï¼šçªç„¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ§åˆ¶èµ„æºæ¶ˆè€—ï¼Œå»ºç«‹å…¬å¹³çš„æ’é˜Ÿè§„åˆ™ï¼Œå¹¶å°†å¯ç”¨çš„èµ„æºå¹³ç­‰åœ°åˆ†é…ç»™æ‰€æœ‰çš„åº”ç”¨ç¨‹åºï¼Œæˆ–è€…æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™åˆ†é…ã€‚è¿™å¯ä»¥è€Œä¸”åº”è¯¥ä¸æˆ‘ä»¬ä»Šå¤©åœ¨ Kubernetes ä¸­å®šä¹‰åº”ç”¨ç¨‹åºçš„ CPU å’Œå†…å­˜çº¦æŸçš„æ–¹å¼å®Œå…¨ä¸€æ ·ã€‚å¦‚æœä½ æƒ³äº†è§£è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘æ›¾åœ¨ EnvoyCon ä¸Šè®²è¿‡è¿™ä¸ªé—®é¢˜ï¼ˆ&lt;a href=&#34;https://www.youtube.com/watch?v=08opgZkdYIw&#34; title=&#34;Envoy Namespace - ä»¥æ›´å°çš„ä»£ä»·è¿ç»´åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼ï¼ŒThomas Grafï¼ŒEnvoyCon 2019&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Namespace - ä»¥æ›´å°çš„ä»£ä»·è¿ç»´åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼ï¼ŒThomas Grafï¼ŒEnvoyCon 2019&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æƒ³å‚ä¸å…¶ä¸­å—--åŠ å…¥-cilium-æœåŠ¡ç½‘æ ¼æµ‹è¯•ç‰ˆ&#34;&gt;æƒ³å‚ä¸å…¶ä¸­å—ï¼Ÿ- åŠ å…¥ Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•ç‰ˆ&lt;/h2&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm_hueac9918fc9393273000a54501e65fa1e_47275_1000x376_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm.jpg&#34; data-img=&#34;/trans/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;376&#34; alt=&#34;image&#34; data-caption=&#34;æµ‹è¯•ç‰ˆ&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;æµ‹è¯•ç‰ˆ&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä¼´éšç€å³å°†å‘å¸ƒçš„ Cilium 1.11 ç‰ˆæœ¬ï¼ŒCilium ç¤¾åŒºæ­£åœ¨ä¸¾åŠä¸€ä¸ªæ–°çš„ Cilium Service Mesh æµ‹è¯•è®¡åˆ’ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä¸€ä¸ªæ–°çš„æ„å»ºï¼Œå°†ä½¿ä»¥ä¸‹åŠŸèƒ½å¯ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;L7 æµé‡ç®¡ç†å’Œè´Ÿè½½å‡è¡¡ï¼ˆHTTPï¼ŒgRPCï¼Œâ€¦ï¼‰&lt;/li&gt;
&lt;li&gt;è·¨é›†ç¾¤ã€äº‘å’Œé›†ç¾¤çš„æ‹“æ‰‘æ„ŸçŸ¥è·¯ç”±&lt;/li&gt;
&lt;li&gt;TLS ç»ˆæ­¢&lt;/li&gt;
&lt;li&gt;é€šè¿‡ Envoy é…ç½®çš„é‡‘ä¸é›€å‘å¸ƒã€é‡è¯•ã€é€Ÿç‡é™åˆ¶ã€æ–­è·¯ç­‰&lt;/li&gt;
&lt;li&gt;ç”¨ OpenTelemetry å’Œ Jaeger é›†æˆè¿›è¡Œè¿½è¸ª&lt;/li&gt;
&lt;li&gt;å†…ç½® Kubernetes Ingress æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šè¿°æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/cilium/cilium&#34; title=&#34;github.com/cilium/cilium&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/cilium/cilium&lt;/a&gt; åŠŸèƒ½åˆ†æ”¯ä¸­æ‰¾åˆ°ã€‚æµ‹è¯•è®¡åˆ’å…è®¸ Cilium ç»´æŠ¤è€…ç›´æ¥ä¸ç”¨æˆ·æ¥è§¦ï¼Œäº†è§£ä»–ä»¬çš„éœ€æ±‚ã€‚è¦æ³¨å†Œï¼Œä½ å¯ä»¥ç›´æ¥å¡«å†™ &lt;a href=&#34;https://forms.gle/j9fwhAC6HnHRJQKeA&#34; title=&#34;è¿™ä¸ªè¡¨æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ä¸ªè¡¨æ ¼&lt;/a&gt;ï¼Œæˆ–è€…ä½ å¯ä»¥åœ¨ Cilium ç¤¾åŒºçš„&lt;a href=&#34;https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta&#34; title=&#34;å…¬å‘Š&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¬å‘Š&lt;/a&gt;ä¸­é˜…è¯»æ›´å¤šå…³äºè¯¥è®¡åˆ’çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;eBPF æ˜¯æä¾›æœ¬åœ°å’Œé«˜æ•ˆçš„æœåŠ¡ç½‘æ ¼å®ç°çš„ç­”æ¡ˆã€‚å®ƒå°†æŠŠæˆ‘ä»¬ä» sidecar æ¨¡å‹ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¹¶å…è®¸å°†ç°æœ‰çš„ä»£ç†æŠ€æœ¯æ•´åˆåˆ°ç°æœ‰çš„å†…æ ¸å‘½åæ¦‚å¿µä¸­ï¼Œä½¿å®ƒä»¬æˆä¸ºæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„å®¹å™¨æŠ½è±¡çš„ä¸€éƒ¨åˆ†ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒeBPF å°†èƒ½å¤Ÿå¸è½½è¶Šæ¥è¶Šå¤šçš„ç›®å‰ç”±ä»£ç†æ‰§è¡Œçš„åŠŸèƒ½ï¼Œä»¥è¿›ä¸€æ­¥å‡å°‘å¼€é”€å’Œå¤æ‚æ€§ã€‚é€šè¿‡æ•´åˆå‡ ä¹ä»»ä½•ç°æœ‰çš„ä»£ç†ï¼Œè¯¥æ¶æ„ä¹Ÿå…è®¸ä¸å¤§å¤šæ•°ç°æœ‰çš„æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢ï¼ˆIstioã€SMIã€Linkerdâ€¦ï¼‰æ•´åˆã€‚è¿™å¯ä»¥å°† eBPF çš„å¥½å¤„æä¾›ç»™å¹¿å¤§çš„ç»ˆç«¯ç”¨æˆ·ï¼ŒåŒæ—¶å°†æ•°æ®é€šè·¯çš„æ•ˆç‡å’Œå¼€é”€çš„è®¨è®ºä¸æ§åˆ¶å¹³é¢æ–¹é¢ç›¸åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æœ‰å…´è¶£æ¢ç´¢è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘ä»¬å¾ˆæƒ³å¬åˆ°ä½ çš„æ„è§ã€‚è¯·éšæ—¶é€šè¿‡ &lt;a href=&#34;https://twitter.com/tgraf__&#34; title=&#34;Twitter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; æˆ– &lt;a href=&#34;http://ebpf.io/slack&#34; title=&#34;eBPF &amp;amp;amp; Cilium Slack è”ç³»æˆ‘ä»¬&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF &amp;amp; Cilium Slack è”ç³»æˆ‘ä»¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ä¸€æ­¥é˜…è¯»&#34;&gt;è¿›ä¸€æ­¥é˜…è¯»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/&#34; title=&#34;eBPF å¦‚ä½•ç®€åŒ–æœåŠ¡ç½‘æ ¼&#34;&gt;eBPF å¦‚ä½•ç®€åŒ–æœåŠ¡ç½‘æ ¼&lt;/a&gt;ï¼ŒLiz Riceï¼ŒThe New Stack&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta&#34; title=&#34;Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•è®¡åˆ’&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•è®¡åˆ’&lt;/a&gt;ï¼ŒCilium ç¤¾åŒº&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cilium.io/learn&#34; title=&#34;äº†è§£æ›´å¤šå…³äº Cilium çš„ä¿¡æ¯&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº†è§£æ›´å¤šå…³äº Cilium çš„ä¿¡æ¯&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
                           
    <item>
      <title>eBPF å¦‚ä½•ç®€åŒ–æœåŠ¡ç½‘æ ¼</title>
      <link>https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/</link>
      <pubDate>Wed, 27 Oct 2021 13:00:00 +0800</pubDate>
      <author>rootsongjc@gmail.com (Jimmy Song)</author>
      <guid>https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/</guid>
      <description>
        
        
        &lt;p&gt;ä»Šå¤©æœ‰å‡ ä¸ªæœåŠ¡ç½‘æ ¼çš„äº§å“å’Œé¡¹ç›®ï¼Œæ‰¿è¯ºç®€åŒ–åº”ç”¨å¾®æœåŠ¡ä¹‹é—´çš„è¿æ¥ï¼ŒåŒæ—¶æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚å®‰å…¨è¿æ¥ã€å¯è§‚æµ‹æ€§å’Œæµé‡ç®¡ç†ã€‚ä½†æ­£å¦‚æˆ‘ä»¬åœ¨è¿‡å»å‡ å¹´ä¸­åå¤çœ‹åˆ°çš„é‚£æ ·ï¼Œå¯¹æœåŠ¡ç½‘æ ¼çš„å…´å¥‹å·²ç»è¢«å¯¹é¢å¤–çš„&lt;a href=&#34;https://engineering.hellofresh.com/everything-we-learned-running-istio-in-production-part-2-ff4c26844bfb&#34; title=&#34;å¤æ‚æ€§&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤æ‚æ€§&lt;/a&gt;å’Œ&lt;a href=&#34;https://pklinker.medium.com/performance-impacts-of-an-istio-service-mesh-63957a0000b&#34; title=&#34;å¼€é”€çš„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€é”€çš„&lt;/a&gt;å®é™…&lt;a href=&#34;https://medium.com/geekculture/watch-out-for-this-istio-proxy-sidecar-memory-pitfall-8dbd99ea7e9d&#34; title=&#34;æ‹…å¿§æ‰€æŠ‘åˆ¶&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‹…å¿§æ‰€æŠ‘åˆ¶&lt;/a&gt;ã€‚è®©æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹ &lt;a href=&#34;https://ebpf.io/&#34; title=&#34;eBPF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF&lt;/a&gt; æ˜¯å¦‚ä½•è®©æˆ‘ä»¬ç²¾ç®€&lt;a href=&#34;https://thenewstack.io/category/service-mesh/&#34; title=&#34;æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼&lt;/a&gt;ï¼Œä½¿æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢æ›´æœ‰æ•ˆç‡ï¼Œæ›´å®¹æ˜“éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-é—®é¢˜&#34;&gt;Sidecar é—®é¢˜&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©çš„ Kubernetes æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆè¦æ±‚ä½ åœ¨æ¯ä¸€ä¸ªåº”ç”¨ pod ä¸Šæ·»åŠ ä¸€ä¸ªä»£ç† sidecar å®¹å™¨ï¼Œå¦‚ &lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; æˆ– &lt;a href=&#34;https://linkerd.io/&#34; title=&#34;Linkerd-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd-proxy&lt;/a&gt;ã€‚è¿™æ˜¯æ­£ç¡®çš„ï¼šå³ä½¿åœ¨ä¸€ä¸ªéå¸¸å°çš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚è¯´æœ‰ 20 ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œäº”ä¸ª podï¼Œåˆ†å¸ƒåœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½ ä¹Ÿæœ‰ 100 ä¸ªä»£ç†å®¹å™¨ã€‚æ— è®ºä»£ç†çš„å®ç°å¤šä¹ˆå°å’Œæœ‰æ•ˆï¼Œè¿™ç§çº¯ç²¹çš„é‡å¤éƒ½ä¼šè€—è´¹èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªä»£ç†ä½¿ç”¨çš„å†…å­˜ä¸å®ƒéœ€è¦èƒ½å¤Ÿé€šä¿¡çš„æœåŠ¡æ•°é‡æœ‰å…³ã€‚Pranay Singhal å†™äº†ä»–é…ç½® Istio çš„&lt;a href=&#34;https://medium.com/geekculture/watch-out-for-this-istio-proxy-sidecar-memory-pitfall-8dbd99ea7e9d&#34; title=&#34;ç»éªŒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»éªŒ&lt;/a&gt;ï¼Œå°†æ¯ä¸ªä»£ç†çš„æ¶ˆè€—ä» 1GB å·¦å³å‡å°‘åˆ°æ›´åˆç†çš„ 60-70MBã€‚ä½†æ˜¯ï¼Œå³ä½¿åœ¨æˆ‘ä»¬çš„å°ç¯å¢ƒä¸­ï¼Œåœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ 100 ä¸ªä»£ç†ï¼Œè¿™ç§ä¼˜åŒ–é…ç½®ä»ç„¶éœ€è¦æ¯ä¸ªèŠ‚ç‚¹ 2GB å·¦å³ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8_hu446b6895590d0bfbfa3a8560a0fad8f5_76212_1000x440_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8.jpg&#34; data-img=&#34;/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;440&#34; alt=&#34;image&#34; data-caption=&#34;æ¥è‡ª &amp;lt;a href=&amp;#34;https://redhat.com/architect/why-when-service-mesh&amp;#34; title=&amp;#34;redhat.com/architect/why-when-service-mesh&amp;#34; target=&amp;#34;_blank&amp;#34; rel=&amp;#34;noopener&amp;#34;&amp;gt;redhat.com/architect/why-when-service-mesh&amp;lt;/a&amp;gt;â€”â€”æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä»£ç† sidecar&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;æ¥è‡ª &lt;a href=&#34;https://redhat.com/architect/why-when-service-mesh&#34; title=&#34;redhat.com/architect/why-when-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redhat.com/architect/why-when-service-mesh&lt;/a&gt;â€”â€”æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä»£ç† sidecar&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ‰€æœ‰è¿™äº› sidecarï¼Ÿè¿™ç§æ¨¡å¼å…è®¸ä»£ç†å®¹å™¨ä¸ pod ä¸­çš„åº”ç”¨å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ã€‚ç½‘ç»œå‘½åç©ºé—´æ˜¯ Linux å†…æ ¸çš„ç»“æ„ï¼Œå®ƒå…è®¸å®¹å™¨å’Œ pod æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç½‘ç»œå †æ ˆï¼Œå°†å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºç›¸äº’éš”ç¦»ã€‚è¿™ä½¿å¾—åº”ç”¨ä¹‹é—´äº’ä¸ç›¸å¹²ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥è®©å°½å¯èƒ½å¤šçš„ pod åœ¨ 80 ç«¯å£ä¸Šè¿è¡Œä¸€ä¸ª web åº”ç”¨ â€”â€” ç½‘ç»œå‘½åç©ºé—´æ„å‘³ç€å®ƒä»¬å„è‡ªæ‹¥æœ‰è‡ªå·±çš„ 80 ç«¯å£ã€‚ä»£ç†å¿…é¡»å…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æ‹¦æˆªå’Œå¤„ç†è¿›å‡ºåº”ç”¨å®¹å™¨çš„æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼•å…¥-ebpf&#34;&gt;å¼•å…¥ eBPF&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://ebpf.io/&#34; title=&#34;eBPF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF&lt;/a&gt; æ˜¯ä¸€ç§å†…æ ¸æŠ€æœ¯ï¼Œå…è®¸è‡ªå®šä¹‰ç¨‹åºåœ¨å†…æ ¸ä¸­è¿è¡Œã€‚è¿™äº›ç¨‹åºåœ¨å“åº”äº‹ä»¶æ—¶è¿è¡Œï¼Œæœ‰æˆåƒä¸Šä¸‡ä¸ªå¯èƒ½çš„äº‹ä»¶ï¼ŒeBPF ç¨‹åºå¯ä»¥è¢«é™„åŠ åˆ°è¿™äº›äº‹ä»¶ä¸Šã€‚è¿™äº›äº‹ä»¶åŒ…æ‹¬è½¨è¿¹ç‚¹ã€è¿›å…¥æˆ–é€€å‡ºä»»ä½•åŠŸèƒ½ï¼ˆåœ¨å†…æ ¸æˆ–ç”¨æˆ·ç©ºé—´ï¼‰æˆ–å¯¹æœåŠ¡ç½‘æ ¼æ¥è¯´å¾ˆé‡è¦çš„ â€”â€” æŠµè¾¾çš„ç½‘ç»œæ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;é‡è¦çš„æ˜¯ï¼Œ&lt;strong&gt;æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå†…æ ¸&lt;/strong&gt;ï¼›åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰å®¹å™¨ï¼ˆä¹Ÿå°±æ˜¯æ‰€æœ‰çš„ podï¼‰å…±äº«åŒä¸€ä¸ªå†…æ ¸ã€‚å¦‚æœä½ åœ¨å†…æ ¸ä¸­æ·»åŠ ä¸€ä¸ª eBPF ç¨‹åºåˆ°ä¸€ä¸ªäº‹ä»¶ä¸­ï¼Œå®ƒå°†è¢«è§¦å‘ï¼Œæ— è®ºå“ªä¸ªè¿›ç¨‹å¼•èµ·è¯¥äº‹ä»¶ï¼Œæ— è®ºå®ƒæ˜¯åœ¨åº”ç”¨å®¹å™¨ä¸­è¿è¡Œè¿˜æ˜¯ç›´æ¥è¿è¡Œåœ¨ä¸»æœºä¸Šã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t_hu82c6f19b59d0aedaafd4c57822109e76_64671_1000x597_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t.jpg&#34; data-img=&#34;/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;597&#34; alt=&#34;image&#34; data-caption=&#34;æ¯å°ä¸»æœºä¸€ä¸ªå†…æ ¸&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;æ¯å°ä¸»æœºä¸€ä¸ªå†…æ ¸&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ eBPF å¯¹äº Kubernetes ä¸­çš„ä»»ä½•ä¸€ç§ instrumentation æ¥è¯´éƒ½æ˜¯å¦‚æ­¤ä»¤äººå…´å¥‹çš„æŠ€æœ¯ â€”â€” ä½ åªéœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€æ¬¡ instrumentationï¼Œæ‰€æœ‰çš„åº”ç”¨ç¨‹åº pod éƒ½ä¼šè¢«è¦†ç›–ã€‚æ— è®ºä½ æ˜¯åœ¨å¯»æ±‚å¯è§‚æµ‹æ€§ã€å®‰å…¨æ€§è¿˜æ˜¯ç½‘ç»œï¼Œç”± eBPF é©±åŠ¨çš„è§£å†³æ–¹æ¡ˆéƒ½å¯ä»¥åœ¨ä¸éœ€è¦ sidecar çš„æƒ…å†µä¸‹å¯¹åº”ç”¨è¿›è¡Œæ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº eBPF çš„ &lt;a href=&#34;http://cilium.io/&#34; title=&#34;Cilium&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium&lt;/a&gt; é¡¹ç›®ï¼ˆæœ€è¿‘ &lt;a href=&#34;https://www.cncf.io/blog/2021/10/13/cilium-joins-cncf-as-an-incubating-project/&#34; title=&#34;ä»¥å­µåŒ–çº§åˆ«åŠ å…¥äº‘è®¡ç®—åŸºé‡‘ä¼š&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥å­µåŒ–çº§åˆ«åŠ å…¥äº‘è®¡ç®—åŸºé‡‘ä¼š&lt;/a&gt;ï¼‰å°†è¿™ç§â€œæ—  sidecar&amp;quot; æ¨¡å¼å¸¦åˆ°äº†æœåŠ¡ç½‘æ ¼çš„ä¸–ç•Œã€‚é™¤äº†ä¼ ç»Ÿçš„ sidecar æ¨¡å‹ï¼ŒCilium è¿˜æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ä¸€ä¸ª Envoy ä»£ç†å®ä¾‹è¿è¡ŒæœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢ã€‚ä½¿ç”¨æˆ‘ä»¬å‰é¢çš„ä¾‹å­ï¼Œè¿™å°±æŠŠä»£ç†å®ä¾‹çš„æ•°é‡ä» 100 ä¸ªå‡å°‘åˆ°åªæœ‰ 3 ä¸ªã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp_hu5b3618fa84b4187fcc1006fa4a80037a_47992_1000x430_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp.jpg&#34; data-img=&#34;/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;430&#34; alt=&#34;image&#34; data-caption=&#34;ç”¨æ—  sidecar ä»£ç†æ¨¡å¼å‡å°‘ä»£ç†å®ä¾‹&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;ç”¨æ—  sidecar ä»£ç†æ¨¡å¼å‡å°‘ä»£ç†å®ä¾‹&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;h2 id=&#34;å‡å°‘-yaml&#34;&gt;å‡å°‘ YAML&lt;/h2&gt;
&lt;p&gt;åœ¨ sidecar æ¨¡å‹ä¸­ï¼ŒæŒ‡å®šæ¯ä¸ªåº”ç”¨ pod çš„ YAML éœ€è¦è¢«ä¿®æ”¹ä»¥æ·»åŠ  sidecar å®¹å™¨ã€‚è¿™é€šå¸¸æ˜¯è‡ªåŠ¨åŒ–çš„ â€”â€” ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€ä¸ª mutating webhookï¼Œåœ¨æ¯ä¸ªåº”ç”¨ pod éƒ¨ç½²çš„æ—¶å€™æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ Istio ä¸ºä¾‹ï¼Œè¿™éœ€è¦&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#controlling-the-injection-policy&#34; title=&#34;æ ‡è®°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ‡è®°&lt;/a&gt; Kubernetes å‘½åç©ºé—´å’Œ / æˆ– podï¼Œä»¥å®šä¹‰æ˜¯å¦åº”è¯¥æ³¨å…¥ sidecarâ€”â€” å½“ç„¶ä¹Ÿéœ€è¦ä¸ºé›†ç¾¤å¯ç”¨ mutating webhookã€‚&lt;/p&gt;
&lt;p&gt;ä½†å¦‚æœå‡ºäº†é—®é¢˜æ€ä¹ˆåŠï¼Ÿå¦‚æœå‘½åç©ºé—´æˆ– pod çš„æ ‡ç­¾ä¸æ­£ç¡®ï¼Œé‚£ä¹ˆ sidecar å°†ä¸ä¼šè¢«æ³¨å…¥ï¼Œpod å°†ä¸ä¼šè¢«è¿æ¥åˆ°æœåŠ¡ç½‘æ ¼ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœæ”»å‡»è€…ç ´åäº†é›†ç¾¤ï¼Œå¹¶èƒ½å¤Ÿè¿è¡Œä¸€ä¸ªæ¶æ„çš„å·¥ä½œè´Ÿè½½ â€”â€” ä¾‹å¦‚ï¼Œä¸€ä¸ªåŠ å¯†è´§å¸çŸ¿å·¥ï¼Œä»–ä»¬å°†ä¸å¤ªå¯èƒ½æ ‡è®°å®ƒï¼Œä»¥ä¾¿å®ƒåŠ å…¥æœåŠ¡ç½‘æ ¼ã€‚å®ƒä¸ä¼šé€šè¿‡æœåŠ¡ç½‘æ ¼æä¾›çš„æµé‡è§‚å¯Ÿèƒ½åŠ›è€Œè¢«å‘ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨æ”¯æŒ eBPF çš„æ—  sidecar ä»£ç†æ¨¡å‹ä¸­ï¼Œpod ä¸éœ€è¦ä»»ä½•é¢å¤–çš„ YAML å°±å¯ä»¥è¢«æ£€æµ‹ã€‚ç›¸åï¼Œä¸€ä¸ª CRD è¢«ç”¨æ¥åœ¨é›†ç¾¤èŒƒå›´å†…é…ç½®æœåŠ¡ç½‘æ ¼ã€‚å³ä½¿æ˜¯å·²ç»å­˜åœ¨çš„ pod ä¹Ÿå¯ä»¥æˆä¸ºæœåŠ¡ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ”»å‡»è€…è¯•å›¾é€šè¿‡ç›´æ¥åœ¨ä¸»æœºä¸Šè¿è¡Œå·¥ä½œè´Ÿè½½æ¥ç»•è¿‡ Kubernetes ç¼–æ’ï¼ŒeBPF ç¨‹åºå¯ä»¥æ£€æµ‹å¹¶æ§åˆ¶è¿™ä¸€æ´»åŠ¨ï¼Œå› ä¸ºè¿™ä¸€åˆ‡éƒ½å¯ä»¥ä»å†…æ ¸çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-æ”¯æŒçš„ç½‘ç»œæ•ˆç‡&#34;&gt;eBPF æ”¯æŒçš„ç½‘ç»œæ•ˆç‡&lt;/h2&gt;
&lt;p&gt;æ”¯æŒ eBPF çš„ç½‘ç»œå…è®¸æ•°æ®åŒ…èµ°æ·å¾„ï¼Œç»•è¿‡å†…æ ¸çš„éƒ¨åˆ†ç½‘ç»œå †æ ˆï¼Œè¿™å¯ä»¥ä½¿ Kubernetes ç½‘ç»œçš„&lt;a href=&#34;https://cilium.io/blog/2021/05/11/cni-benchmark&#34; title=&#34;æ€§èƒ½å¾—åˆ°æ˜¾è‘—æ”¹å–„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ€§èƒ½å¾—åˆ°æ˜¾è‘—æ”¹å–„&lt;/a&gt;ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™åœ¨æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸­æ˜¯å¦‚ä½•åº”ç”¨çš„ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw_hu99fe30579521a751f54e46340b89eed8_69860_1000x482_resize_q75_h2_lanczos.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw.jpg&#34; data-img=&#34;/trans/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw.jpg&#34; data-width=&#34;1000&#34; data-height=&#34;482&#34; alt=&#34;image&#34; data-caption=&#34;åœ¨ eBPF åŠ é€Ÿã€æ—  sidecar çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹ä¸­ï¼Œç½‘ç»œæ•°æ®åŒ…é€šè¿‡çš„è·¯å¾„è¦çŸ­å¾—å¤š&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
  &lt;figcaption&gt;åœ¨ eBPF åŠ é€Ÿã€æ—  sidecar çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹ä¸­ï¼Œç½‘ç»œæ•°æ®åŒ…é€šè¿‡çš„è·¯å¾„è¦çŸ­å¾—å¤š&lt;/figcaption&gt;
  
&lt;/figure&gt;
&lt;p&gt;åœ¨æœåŠ¡ç½‘æ ¼çš„æƒ…å†µä¸‹ï¼Œä»£ç†åœ¨ä¼ ç»Ÿç½‘ç»œä¸­ä½œä¸º sidecar è¿è¡Œï¼Œæ•°æ®åŒ…åˆ°è¾¾åº”ç”¨ç¨‹åºçš„è·¯å¾„ç›¸å½“æ›²æŠ˜ï¼šå…¥ç«™æ•°æ®åŒ…å¿…é¡»ç©¿è¶Šä¸»æœº TCP/IP æ ˆï¼Œé€šè¿‡è™šæ‹Ÿä»¥å¤ªç½‘è¿æ¥åˆ°è¾¾ pod çš„ç½‘ç»œå‘½åç©ºé—´ã€‚ä»é‚£é‡Œï¼Œæ•°æ®åŒ…å¿…é¡»ç©¿è¿‡ pod çš„ç½‘ç»œå †æ ˆåˆ°è¾¾ä»£ç†ï¼Œä»£ç†å°†æ•°æ®åŒ…é€šè¿‡å›ç¯æ¥å£è½¬å‘åˆ°åº”ç”¨ç¨‹åºã€‚è€ƒè™‘åˆ°æµé‡å¿…é¡»åœ¨è¿æ¥çš„ä¸¤ç«¯æµç»ä»£ç†ï¼Œä¸éæœåŠ¡ç½‘æ ¼æµé‡ç›¸æ¯”ï¼Œè¿™å°†å¯¼è‡´å»¶è¿Ÿçš„&lt;a href=&#34;https://linkerd.io/2021/05/27/linkerd-vs-istio-benchmarks/#latency-at-20-rps&#34; title=&#34;æ˜¾è‘—å¢åŠ &#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ˜¾è‘—å¢åŠ &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº eBPF çš„ Kubernetes CNI å®ç°ï¼Œå¦‚ Ciliumï¼Œå¯ä»¥ä½¿ç”¨ eBPF ç¨‹åºï¼Œæ˜æ™ºåœ°é’©ä½å†…æ ¸ä¸­çš„ç‰¹å®šç‚¹ï¼Œæ²¿ç€æ›´ç›´æ¥çš„è·¯çº¿é‡å®šå‘æ•°æ®åŒ…ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º Cilium çŸ¥é“æ‰€æœ‰çš„ Kubernetes ç«¯ç‚¹å’ŒæœåŠ¡çš„èº«ä»½ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾ä¸»æœºæ—¶ï¼ŒCilium å¯ä»¥å°†å…¶ç›´æ¥åˆ†é…åˆ°å®ƒæ‰€è¦å»çš„ä»£ç†æˆ– Pod ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘ç»œä¸­çš„åŠ å¯†&#34;&gt;ç½‘ç»œä¸­çš„åŠ å¯†&lt;/h2&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªç½‘ç»œè§£å†³æ–¹æ¡ˆèƒ½å¤Ÿæ„è¯†åˆ° Kubernetes æœåŠ¡ï¼Œå¹¶åœ¨è¿™äº›æœåŠ¡çš„ç«¯ç‚¹ä¹‹é—´æä¾›ç½‘ç»œè¿æ¥ï¼Œé‚£ä¹ˆå®ƒèƒ½å¤Ÿæä¾›æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢çš„èƒ½åŠ›å°±ä¸è¶³ä¸ºå¥‡ã€‚ä½†è¿™äº›èƒ½åŠ›å¯ä»¥è¶…è¶ŠåŸºæœ¬çš„è¿æ¥ã€‚ä¸€ä¸ªä¾‹å­æ˜¯é€æ˜åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ä½¿ç”¨æœåŠ¡ç½‘æ ¼æ¥ç¡®ä¿æ‰€æœ‰çš„åº”ç”¨æµé‡éƒ½æ˜¯ç»è¿‡è®¤è¯å’ŒåŠ å¯†çš„ã€‚è¿™æ˜¯é€šè¿‡åŒå‘ TLSï¼ˆmTLSï¼‰å®ç°çš„ï¼›æœåŠ¡ç½‘æ ¼ä»£ç†ç»„ä»¶ä½œä¸ºç½‘ç»œè¿æ¥çš„ç«¯ç‚¹ï¼Œå¹¶ä¸å…¶è¿œç¨‹å¯¹ç­‰ç‰©åå•†ä¸€ä¸ªå®‰å…¨çš„ TLS è¿æ¥ã€‚è¿™ç§è¿æ¥å¯¹ä»£ç†ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ï¼Œè€Œä¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºåšä»»ä½•æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨åº”ç”¨å±‚ç®¡ç†çš„ TLS å¹¶ä¸æ˜¯å®ç°ç»„ä»¶é—´è®¤è¯å’ŒåŠ å¯†æµé‡çš„å”¯ä¸€æ–¹æ³•ã€‚å¦ä¸€ä¸ªé€‰æ‹©æ˜¯åœ¨ç½‘ç»œå±‚åŠ å¯†æµé‡ï¼Œä½¿ç”¨ &lt;a href=&#34;https://cilium.io/blog/2021/05/11/cni-benchmark#the-cost-of-encryption---wireguard-vs-ipsec&#34; title=&#34;IPSec æˆ– WireGuard&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IPSec æˆ– WireGuard&lt;/a&gt;ã€‚å› ä¸ºå®ƒåœ¨ç½‘ç»œå±‚æ“ä½œï¼Œè¿™ç§åŠ å¯†ä¸ä»…å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œè€Œä¸”å¯¹ä»£ç†ä¹Ÿæ˜¯é€æ˜çš„ â€”â€” å®ƒå¯ä»¥åœ¨æœ‰æˆ–æ²¡æœ‰æœåŠ¡ç½‘æ ¼æ—¶å¯ç”¨ã€‚å¦‚æœä½ ä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„å”¯ä¸€åŸå› æ˜¯æä¾›åŠ å¯†ï¼Œä½ å¯èƒ½æƒ³è€ƒè™‘ç½‘ç»œçº§åŠ å¯†ã€‚å®ƒä¸ä»…æ›´ç®€å•ï¼Œè€Œä¸”è¿˜å¯ä»¥ç”¨æ¥éªŒè¯å’ŒåŠ å¯†èŠ‚ç‚¹ä¸Šçš„ä»»ä½•æµé‡ â€”â€” å®ƒä¸åªé™äºé‚£äº›å¯ç”¨äº† sidecar çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-æ˜¯æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢&#34;&gt;eBPF æ˜¯æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ï¼ŒeBPF åœ¨ Linux ç”Ÿäº§å‘è¡Œç‰ˆä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ä¸­å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œä¼ä¸šå¯ä»¥åˆ©ç”¨å®ƒæ¥è·å¾—æ›´æœ‰æ•ˆçš„ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„æ›´æœ‰æ•ˆçš„æ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;å»å¹´ï¼Œæˆ‘ä»£è¡¨ &lt;a href=&#34;https://cncf.io/?utm_content=inline-mention&#34; title=&#34;CNCF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF&lt;/a&gt; çš„æŠ€æœ¯ç›‘ç£å§”å‘˜ä¼šï¼Œå¯¹æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„æ•´åˆå’Œæ¸…æ™°åŒ–åšäº†ä¸€äº› &lt;a href=&#34;https://youtu.be/bESogtuHwX0&#34; title=&#34;é¢„æµ‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¢„æµ‹&lt;/a&gt;ã€‚åœ¨åŒä¸€ä¸»é¢˜æ¼”è®²ä¸­ï¼Œæˆ‘è°ˆåˆ° eBPF æœ‰å¯èƒ½æˆä¸ºæ›´å¤šé¡¹ç›®å’Œæ›´å¹¿æ³›éƒ¨ç½²èƒ½åŠ›çš„åŸºç¡€ã€‚è¿™ä¸¤ä¸ªæƒ³æ³•ç°åœ¨æ­£ç»“åˆåœ¨ä¸€èµ·ï¼Œå› ä¸º eBPF ä¼¼ä¹æ˜¯æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢çš„è‡ªç„¶è·¯å¾„ã€‚&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
