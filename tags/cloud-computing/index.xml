<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cloud Computing on Jimmy&#39;s blog</title>
    <link>http://rootsongjc.github.io/tags/cloud-computing/index.xml</link>
    <description>Recent content in Cloud Computing on Jimmy&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://rootsongjc.github.io/tags/cloud-computing/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Kubernetes Dashboard/Web UIå®‰è£…å…¨è®°å½•</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/</link>
      <pubDate>Wed, 05 Apr 2017 10:18:51 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2017040301.jpg&#34; alt=&#34;æ™’å¤ªé˜³çš„è¢‹é¼ &#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæ™’å¤ªé˜³çš„è¢‹é¼ @åŒ—äº¬åŠ¨ç‰©å›­ Apr 3,2017ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;å‰å‡ å¤©&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/&#34;&gt;åœ¨CentOS7.2ä¸Šå®‰è£…Kubernetes1.6&lt;/a&gt;å’Œå®‰è£…å¥½&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-network-config/&#34;&gt;flannelç½‘ç»œé…ç½®&lt;/a&gt;ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å®‰è£…ä¸‹kuberentnesçš„dashboardã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard&#34;&gt;Dashboard&lt;/a&gt;æ˜¯Kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä»£ç åœ¨å•ç‹¬çš„å¼€æºé¡¹ç›®é‡Œã€‚1å¹´å‰è¿˜æ˜¯ç‰¹åˆ«ç®€å•çš„ä¸€ä¸ªUIï¼Œåªèƒ½åœ¨ä¸Šé¢æŸ¥çœ‹podçš„ä¿¡æ¯å’Œéƒ¨ç½²podè€Œå·²ï¼Œç°åœ¨å·²ç»åšçš„è·Ÿ&lt;a href=&#34;https://www.docker.com/enterprise-edition&#34;&gt;Docker Enterprise Edition&lt;/a&gt;çš„&lt;strong&gt;Docker Datacenter&lt;/strong&gt;å¾ˆåƒäº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…dashboard&#34;&gt;å®‰è£…Dashboard&lt;/h2&gt;

&lt;p&gt;å®˜ç½‘çš„å®‰è£…æ–‡æ¡£&lt;a href=&#34;https://kubernetes.io/docs/user-guide/ui/ï¼Œå…¶å®å®˜ç½‘æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨ç°æˆçš„imageæ¥ç”¨kuberneteséƒ¨ç½²å³å¯ã€‚&#34;&gt;https://kubernetes.io/docs/user-guide/ui/ï¼Œå…¶å®å®˜ç½‘æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨ç°æˆçš„imageæ¥ç”¨kuberneteséƒ¨ç½²å³å¯ã€‚&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆéœ€è¦ä¸€ä¸ª&lt;strong&gt;kubernetes-dashboard.yaml&lt;/strong&gt;çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨&lt;a href=&#34;https://github.com/kubernetes/dashboard/blob/master/src/deploy/kubernetes-dashboard.yaml&#34;&gt;Githubçš„src/deploy/kubernetes-dashboard.yaml&lt;/a&gt;ä¸‹è½½ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬èƒ½çœ‹ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;# Copyright 2015 Google Inc. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the &amp;quot;License&amp;quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &amp;quot;AS IS&amp;quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Configuration to deploy release version of the Dashboard UI.
#
# Example usage: kubectl create -f &amp;lt;this_file&amp;gt;

kind: Deployment
apiVersion: extensions/v1beta1
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: kubernetes-dashboard
  template:
    metadata:
      labels:
        app: kubernetes-dashboard
      # Comment the following annotation if Dashboard must not be deployed on master
      annotations:
        scheduler.alpha.kubernetes.io/tolerations: |
          [
            {
              &amp;quot;key&amp;quot;: &amp;quot;dedicated&amp;quot;,
              &amp;quot;operator&amp;quot;: &amp;quot;Equal&amp;quot;,
              &amp;quot;value&amp;quot;: &amp;quot;master&amp;quot;,
              &amp;quot;effect&amp;quot;: &amp;quot;NoSchedule&amp;quot;
            }
          ]
    spec:
      containers:
      - name: kubernetes-dashboard
        image: sz-pg-oam-docker-hub-001.tendcloud.com/library/kubernetes-dashboard-amd64:v1.6.0
        imagePullPolicy: Always
        ports:
        - containerPort: 9090
          protocol: TCP
        args:
          # Uncomment the following line to manually specify Kubernetes API server Host
          # If not specified, Dashboard will attempt to auto discover the API server and connect
          # to it. Uncomment only if the default does not work.
          # - --apiserver-host=http://my-address:port
        livenessProbe:
          httpGet:
            path: /
            port: 9090
          initialDelaySeconds: 30
          timeoutSeconds: 30
---
kind: Service
apiVersion: v1
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  type: NodePort
  ports:
  - port: 80
    targetPort: 9090
  selector:
    app: kubernetes-dashboard
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;âš ï¸ å®˜æ–¹æä¾›çš„imageåä¸º&lt;code&gt;gcr.io/google_containers/kubernetes-dashboard-amd64:v1.6.0&lt;/code&gt;ï¼Œéœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œæˆ‘è‡ªå·±æ‹‰ä¸‹æ¥pushåˆ°æˆ‘ä»¬çš„ç§æœ‰é•œåƒä»“åº“äº†ã€‚æˆ‘å°†è¿™ä¸ªé•œåƒpushåˆ°äº†docker hubä¸Šï¼Œå¦‚æœä½ æ— æ³•ç¿»å¢™çš„è¯ï¼Œå¯ä»¥åˆ°ä¸‹è½½è¿™ä¸ªé•œåƒï¼š&lt;code&gt;index.tenxcloud.com/jimmy/kubernetes-dashboard-amd64:v1.6.0&lt;/code&gt;ã€‚æ—¶é€Ÿäº‘çš„é•œåƒå­˜å‚¨ï¼Œé€Ÿåº¦å°±æ˜¯å¿«ã€‚&lt;/p&gt;

&lt;p&gt;å‡†å¤‡å¥½imageåå°±å¯ä»¥éƒ¨ç½²äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl create -f kubernetes-dashboard.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‡ºé”™&#34;&gt;å‡ºé”™&lt;/h2&gt;

&lt;p&gt;å¯åŠ¨serviceçš„æ—¶å€™å‡ºé”™äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl --namespace=kube-system logs kubernetes-dashboard-1680927228-pdv45
Using HTTP port: 9090
Error while initializing connection to Kubernetes apiserver. This most likely means that the cluster is misconfigured (e.g., it has invalid apiserver certificates or service accounts configuration) or the --apiserver-host param points to a server that does not exist. Reason: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory
Refer to the troubleshooting guide for more information: https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md&#34;&gt;troubleshooting.md&lt;/a&gt;æ–‡ä»¶å·²ç»è¯´æ˜äº†ï¼Œè¿™æ˜¯&lt;strong&gt;Service Account&lt;/strong&gt;çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ—¶å€™åˆè¦å€Ÿé‰´Tony Baiçš„&lt;a href=&#34;http://tonybai.com/2017/01/19/install-dashboard-addon-for-k8s/&#34;&gt;Kubernetesé›†ç¾¤Dashboardæ’ä»¶å®‰è£…&lt;/a&gt;è¿™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl proxy --address=&#39;0.0.0.0&#39; --accept-hosts=&#39;^*$&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŠ¥é”™&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;kind&amp;quot;: &amp;quot;Status&amp;quot;,
  &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,
  &amp;quot;metadata&amp;quot;: {},
  &amp;quot;status&amp;quot;: &amp;quot;Failure&amp;quot;,
  &amp;quot;message&amp;quot;: &amp;quot;no endpoints available for service \&amp;quot;kubernetes-dashboard\&amp;quot;&amp;quot;,
  &amp;quot;reason&amp;quot;: &amp;quot;ServiceUnavailable&amp;quot;,
  &amp;quot;code&amp;quot;: 503
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;çœ‹æ¥èº«ä»½è®¤è¯æ˜¯ç»•ä¸è¿‡å»äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# start a container that contains curl
$ kubectl run test --image=sz-pg-oam-docker-hub-001.tendcloud.com/library/curl:latest -- sleep 10000
$kubectl get pod
NAME                     READY     STATUS    RESTARTS   AGE
test-2428763157-pxkps    1/1       Running   0          6s
$kubectl exec test-2428763157-pxkps ls /var/run/secrets/kubernetes.io/serviceaccount/
ls: cannot access /var/run/secrets/kubernetes.io/serviceaccount/: No such file or directory
$kubectl get secrets
No resources found.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/var/run/secrets/kubernetes.io/serviceaccount/è¿™ä¸ªç›®å½•è¿˜æ˜¯ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å®‰è£…çš„Kuberneteså‹æ ¹å°±æ²¡æœ‰è®¾ç½®secretã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md&#34;&gt;troubleshooting.md&lt;/a&gt;ä¸Šè¯´éœ€è¦ç”¨&lt;code&gt;â€”admission-control&lt;/code&gt;é…ç½®API Serverï¼Œåœ¨é…ç½®è¿™ä¸ªä¹‹å‰è¿˜è¦äº†è§£ä¸‹&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/&#34;&gt;Service Accounts&lt;/a&gt;å’Œ&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/&#34;&gt;å¦‚ä½•ç®¡ç†Service Accounts&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®serivce-accounts&#34;&gt;é…ç½®Serivce Accounts&lt;/h2&gt;

&lt;p&gt;Service Accountæ˜¯ä¸ºPodæä¾›ä¸€ä¸ªèº«ä»½è®¤è¯ã€‚&lt;/p&gt;

&lt;p&gt;å½“ä½ ä½¿ç”¨kubectlæ¥è®¿é—®é›†ç¾¤çš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨çš„&lt;strong&gt;admin&lt;/strong&gt;çš„User Accountæ¥è·ŸAPI serveräº¤äº’çš„ï¼Œé™¤éç®¡ç†å‘˜æŒ‡å®šäº†å…¶å®ƒçš„Accountã€‚å½“Podä¸­çš„å®¹å™¨è·ŸAPIserviceäº¤äº’çš„æ—¶å€™ï¼Œéœ€è¦Service Accountï¼ˆæ¯”å¦‚defaultï¼‰çš„èº«ä»½æˆæƒã€‚&lt;/p&gt;

&lt;h3 id=&#34;ä½¿ç”¨default-service-accountæ¥è®¿é—®api-server&#34;&gt;ä½¿ç”¨Default Service Accountæ¥è®¿é—®API server&lt;/h3&gt;

&lt;p&gt;å¦‚æœä½ åˆ›å»ºpodçš„æ—¶å€™ä¸æŒ‡å®šService Accountçš„è¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‡å®šä¸º&lt;strong&gt;default&lt;/strong&gt;ã€‚&lt;code&gt;spec.serviceAccount=default&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æˆ‘ç³»ç»Ÿä¸­çš„Service Account&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl get serviceAccounts
NAME      SECRETS   AGE
default   0         4d
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>å®¹å™¨æŠ€æœ¯åœ¨å¤§æ•°æ®åœºæ™¯ä¸‹çš„åº”ç”¨â€”â€”Yarn on Docker</title>
      <link>http://rootsongjc.github.io/projects/yarn-on-docker/</link>
      <pubDate>Tue, 04 Apr 2017 00:19:04 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/projects/yarn-on-docker/</guid>
      <description>

&lt;p&gt;&lt;strong&gt;ä½œè€…ï¼š&lt;a href=&#34;rootsongjc.github.io/about/&#34;&gt;å®‹å‡€è¶…&lt;/a&gt; TalkingDataäº‘è®¡ç®—åŠå¤§æ•°æ®å·¥ç¨‹å¸ˆ&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£ã€‚â€”â€”å­”å­&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æˆ‘å·²å°±è¯¥è¯é¢˜å·²åœ¨2016å¹´ä¸Šæµ·Qconä¸Šå‘è¡¨è¿‡æ¼”è®²ï¼Œ&lt;a href=&#34;http://www.infoq.com/cn/presentations/yarn-on-docker-container-technology-in-big-data-scenarios&#34;&gt;ç‚¹æ­¤è§‚çœ‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–InfoQç½‘ç«™ä¸Šçš„æ–‡å­—ç‰ˆ&lt;a href=&#34;http://www.infoq.com/cn/articles/YarnOnDocker-forDCCluster&#34;&gt;æ•°æ®ä¸­å¿ƒçš„Yarn on Dockeré›†ç¾¤æ–¹æ¡ˆ&lt;/a&gt;ï¼Œå³æœ¬æ–‡ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å½“å‰æ•°æ®ä¸­å¿ƒå­˜åœ¨çš„é—®é¢˜&#34;&gt;å½“å‰æ•°æ®ä¸­å¿ƒå­˜åœ¨çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;æ•°æ®ä¸­å¿ƒä¸­çš„åº”ç”¨ä¸€èˆ¬ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸ºäº†ä¿è¯ç¯å¢ƒéš”ç¦»ä¸æ–¹ä¾¿ç®¡ç†ï¼Œä¿è¯åº”ç”¨æœ€å¤§èµ„æºÂ  æ•°æ®ä¸­å¿ƒä¸­æ™®éå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š&lt;/p&gt;

&lt;p&gt;1.ä¸»æœºèµ„æºåˆ©ç”¨ç‡ä½&lt;/p&gt;

&lt;p&gt;2.éƒ¨ç½²å’Œæ‰©å±•å¤æ‚&lt;/p&gt;

&lt;p&gt;3.èµ„æºéš”ç¦»æ— æ³•åŠ¨æ€è°ƒæ•´&lt;/p&gt;

&lt;p&gt;4.æ— æ³•å¿«é€Ÿå“åº”ä¸šåŠ¡&lt;/p&gt;

&lt;p&gt;ä¸ºä½•ä½¿ç”¨Yarnon Docker&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å½»åº•éš”ç¦»é˜Ÿåˆ—Â &lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;â€¢Â  ä¸ºäº†åˆç†åˆ©ç”¨Hadoopyarnçš„èµ„æºï¼Œé˜Ÿåˆ—é—´ä¼šäº’ç›¸æŠ¢å è®¡ç®—èµ„æºï¼Œé€ æˆé‡è¦ä»»åŠ¡é˜»å¡&lt;/p&gt;

&lt;p&gt;â€¢Â  æ ¹æ®éƒ¨é—¨ç”³è¯·çš„æœºå™¨æ•°é‡åˆ’åˆ†Yarné›†ç¾¤æ–¹ä¾¿è´¢åŠ¡ç®¡ç†&lt;/p&gt;

&lt;p&gt;â€¢Â  æ›´ç»†ç²’åº¦çš„èµ„æºåˆ†é…Â &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€çš„èµ„æºåˆ†é…&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;â€¢Â  æ¯ä¸ªNodeManagerå’Œå®¹å™¨éƒ½å¯ä»¥é™å®šCPUã€å†…å­˜èµ„æº&lt;/p&gt;

&lt;p&gt;â€¢Â  Yarnèµ„æºåˆ’åˆ†ç²¾ç¡®åˆ°CPUæ ¸æ•°å’Œå†…å­˜å¤§å°Â &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¼¹æ€§ä¼¸ç¼©æ€§æœåŠ¡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;â€¢Â  æ¯ä¸ªå®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªNodeManagerï¼Œå¢å‡yarnèµ„æºåªéœ€å¢å‡å®¹å™¨ä¸ªæ•°&lt;/p&gt;

&lt;p&gt;â€¢Â  å¯ä»¥æŒ‡å®šæ¯ä¸ªNodeManageræ‹¥æœ‰çš„è®¡ç®—èµ„æºå¤šå°‘ï¼ŒæŒ‰éœ€ç”³è¯·èµ„æºÂ &lt;/p&gt;

&lt;h2 id=&#34;ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå¥½å¤„&#34;&gt;ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼ŸÂ &lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Swarmç»Ÿä¸€é›†ç¾¤èµ„æºè°ƒåº¦&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Â â€¢Â  ç»Ÿä¸€èµ„æº&lt;/p&gt;

&lt;p&gt;â€¢Â  å¢åŠ Dockerè™šæ‹ŸåŒ–å±‚ï¼Œé™ä½è¿ç»´æˆæœ¬&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¢åŠ Hadoopé›†ç¾¤èµ„æºåˆ©ç”¨ç‡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;â€¢Â  Fordatacenterï¼šé¿å…äº†é™æ€èµ„æºéš”ç¦»&lt;/p&gt;

&lt;p&gt;â€¢Â  Forclusterï¼šåŠ å¼ºé›†ç¾¤å†…éƒ¨èµ„æºéš”ç¦»&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;h2 id=&#34;ç³»ç»Ÿæ¶æ„&#34;&gt;ç³»ç»Ÿæ¶æ„&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_arch.jpg&#34; alt=&#34;td_yarn_arch&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Â  æ¯”å¦‚æ•°æ®ä¸­å¿ƒä¸­è¿è¡Œçš„Hadoopé›†ç¾¤ï¼Œæˆ‘ä»¬å°†HDFSä¾ç„¶è¿è¡Œåœ¨ç‰©ç†æœºä¸Šï¼Œå³DataNodeä¾ç„¶éƒ¨ç½²åœ¨å®ä½“æœºå™¨ä¸Šï¼Œå°†Yarnè®¡ç®—å±‚è¿è¡Œåœ¨Dockerå®¹å™¨ä¸­ï¼Œæ•´ä¸ªç³»ç»Ÿä½¿ç”¨äºŒå±‚èµ„æºè°ƒåº¦ï¼ŒSparkã€Flinekã€MapReduceç­‰åº”ç”¨è¿è¡Œåœ¨Yarnä¸Šã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;Â Â Â  Swarmè°ƒåº¦æœ€åº•å±‚çš„ä¸»æœºç¡¬ä»¶èµ„æºï¼ŒCPUå’Œå†…å­˜å°è£…ä¸ºDockerå®¹å™¨ï¼Œå®¹å™¨ä¸­è¿è¡ŒNodeManagerï¼Œæä¾›ç»™Yarné›†ç¾¤ï¼Œä¸€ä¸ªSwarmé›†ç¾¤ä¸­å¯ä»¥è¿è¡Œå¤šä¸ªYarné›†ç¾¤ï¼Œå½¢æˆåœˆåœ°å¼çš„Yarnè®¡ç®—é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_arch2.jpg&#34; alt=&#34;td_yarn_arch2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å…·ä½“æµç¨‹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;1.swarm nodeå‘swarm masteræ³¨å†Œä¸»æœºèµ„æºå¹¶åŠ å…¥åˆ°swarmclusterä¸­&lt;/p&gt;

&lt;p&gt;2.swarm masterå‘clusterç”³è¯·èµ„æºè¯·æ±‚å¯åŠ¨å®¹å™¨&lt;/p&gt;

&lt;p&gt;3.swarmæ ¹æ®è°ƒåº¦ç­–ç•¥é€‰æ‹©åœ¨æŸä¸ªnodeä¸Šå¯åŠ¨dockercontainer&lt;/p&gt;

&lt;p&gt;4.swarm nodeçš„docker deamonæ ¹æ®å®¹å™¨å¯åŠ¨å‚æ•°å¯åŠ¨ç›¸åº”èµ„æºå¤§å°çš„NodeManager&lt;/p&gt;

&lt;p&gt;5.NodeManagerè‡ªåŠ¨å‘YARNçš„ResourceManageræ³¨å†Œèµ„æºä¸€ä¸ªNodeManagerèµ„æºæ·»åŠ å®Œæˆã€‚&lt;/p&gt;

&lt;p&gt;Â Â &lt;/p&gt;

&lt;p&gt;Swarmä¸ºæ•°æ®ä¸­å¿ƒåšå®¹å™¨å³ä¸»æœºèµ„æºè°ƒåº¦ï¼Œæ¯ä¸ªswarmnodeçš„èŠ‚ç‚¹ç»“æ„å¦‚å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_arch3.jpg&#34; alt=&#34;td_yarn_arch3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªSwarmnodeå°±æ˜¯ä¸€å°ç‰©ç†æœºï¼Œæ¯å°ä¸»æœºä¸Šå¯ä»¥èµ·å¤šä¸ªåŒç±»å‹çš„dockercontainerï¼Œæ¯ä¸ªcontainerçš„èµ„æºéƒ½æœ‰é™åˆ¶åŒ…æ‹¬CPUã€å†…å­˜NodeManagerå®¹å™¨åªéœ€è¦è€ƒè™‘æœ¬èº«è¿›ç¨‹å ç”¨çš„èµ„æºå’Œéœ€è¦ç»™ä¸»æœºé¢„ç•™èµ„æºã€‚å‡å¦‚ä¸»æœºæ˜¯24æ ¸64Gï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ç»™ä¸€ä¸ªå®¹å™¨5æ ¸12Gï¼ŒNodeManagerå ç”¨4æ ¸10Gçš„èµ„æºæä¾›ç»™Yarnã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;KubernetesVS Swarm&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Â Â  å…³äºå®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿçš„é€‰å‹ï¼Œç”¨Kubernetesè¿˜æ˜¯Swarmï¼Ÿæˆ‘ä»¬ç»“åˆè‡ªå·±çš„ç»éªŒå’Œä¸šåŠ¡éœ€æ±‚ï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_compare.jpg&#34; alt=&#34;td_yarn_compare&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åŸºäºä»¥ä¸Šå››ç‚¹ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†Swarmï¼Œå®ƒåŸºæœ¬æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼ŒæŒæ¡å’Œå¼€å‘æ—¶å¸¸è¾ƒçŸ­ã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;h2 id=&#34;é•œåƒåˆ¶ä½œä¸å‘å¸ƒ&#34;&gt;é•œåƒåˆ¶ä½œä¸å‘å¸ƒ&lt;/h2&gt;

&lt;p&gt;é•œåƒåˆ¶ä½œå’Œå‘å¸ƒæµç¨‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_ci.jpg&#34; alt=&#34;td_yarn_ci&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;Â Â Â  ç”¨æˆ·ä»å®¢æˆ·ç«¯æäº¤ä»£ç åˆ°Gitlabä¸­ï¼Œéœ€è¦åŒ…å«Dockerfileæ–‡ä»¶ï¼Œé€šè¿‡é›†æˆäº†dockeræ’ä»¶çš„Jenkinsçš„è‡ªåŠ¨ç¼–è¯‘å‘å¸ƒæœºåˆ¶ï¼Œè‡ªåŠ¨buildé•œåƒåpushåˆ°dockeré•œåƒä»“åº“ä¸­ï¼ŒåŒä¸€ä¸ªé¡¹ç›®æ¯æäº¤ä¸€æ¬¡ä»£ç éƒ½ä¼šé‡æ–°buildä¸€æ¬¡é•œåƒï¼Œç”Ÿæˆä¸åŒçš„tagæ¥æ ‡è¯†é•œåƒï¼ŒSwarmé›†ç¾¤ä½¿ç”¨è¯¥é•œåƒä»“åº“å°±å¯ä»¥ç›´æ¥æ‹‰å–é•œåƒã€‚&lt;/p&gt;

&lt;p&gt;Dockerfileçš„ç¼–å†™æŠ€å·§&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_dockerfile.jpg&#34; alt=&#34;td_yarn_dockerfile&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Â Dockerfileç›¸å½“äºdockeré•œåƒçš„ç¼–è¯‘æ‰“åŒ…æµç¨‹è¯´æ˜ï¼Œå…¶ä¸­ä¹Ÿä¸ä¹ä¸€äº›æŠ€å·§ã€‚&lt;/p&gt;

&lt;p&gt;Â Â  Â Â &lt;/p&gt;

&lt;p&gt;Â Â Â  å¾ˆå¤šåº”ç”¨éœ€è¦é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæƒ³ä¸ºæ¯æ¬¡å¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ä¸åŒçš„é…ç½®å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’ç¯å¢ƒå˜é‡çš„æ–¹å¼æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå‰ææ˜¯éœ€è¦å†™ä¸€ä¸ªbashè„šæœ¬ï¼Œè„šæœ¬ä¸­æ¥å¤„ç†é…ç½®æ–‡ä»¶ï¼Œå†å°†è¿™ä¸ªè„šæœ¬ä½œä¸ºentrypointå…¥å£ï¼Œæ¯å½“å®¹å™¨å¯åŠ¨æ—¶å°±ä¼šæ‰§è¡Œè¿™ä¸ªè„šæœ¬ä»è€Œæ›¿æ¢é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡CMDä¼ é€’å‚æ•°ç»™è¯¥è„šæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;å¯åŠ¨å®¹å™¨çš„æ—¶å€™é€šè¿‡ä¼ é€’ç¯å¢ƒå˜é‡çš„æ–¹å¼ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;docker run -d 
--net=mynet 
-e NAMESERVICE=nameservice 
-e ACTIVE_NAMENODE_ID=namenode29 \
-e STANDBY_NAMENODE_ID=namenode63 \
-e HA_ZOOKEEPER_QUORUM=zk1:2181,zk2:2181,zk3:2181 \
-e YARN_ZK_DIR=rmstore \
-e YARN_CLUSTER_ID=yarnRM \
-e YARN_RM1_IP=rm1 \
-e YARN_RM2_IP=rm2 \
-e CPU_CORE_NUM=5
-e NODEMANAGER_MEMORY_MB=12288 \
-e YARN_JOBHISTORY_IP=jobhistory \
-e ACTIVE_NAMENODE_IP=active-namenode \
-e STANDBY_NAMENODE_IP=standby-namenode \
-e HA=yes \
docker-registry/library/hadoop-yarn:v0.1 resourcemanager
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€åä¼ é€’resourcemanageræˆ–è€…nodemanagerå‚æ•°æŒ‡å®šå¯åŠ¨ç›¸åº”çš„æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;é›†ç¾¤ç®¡ç†&lt;/p&gt;

&lt;p&gt;æˆ‘å¼€å‘çš„å‘½ä»¤è¡Œå·¥å…·&lt;a href=&#34;https://github.com/rootsongjc/magpie&#34;&gt;magpie&lt;/a&gt;ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–å¼€æºå¯è§†åŒ–é¡µé¢æ¥ç®¡ç†é›†ç¾¤ï¼Œæ¯”å¦‚shipyardã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_shipyard.jpg&#34; alt=&#34;td_yarn_shipyard&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;è‡ªå®šä¹‰ç½‘ç»œ&#34;&gt;è‡ªå®šä¹‰ç½‘ç»œ&lt;/h2&gt;

&lt;p&gt;Â Dockerå®¹å™¨è·¨ä¸»æœºäº’è®¿ä¸€ç›´æ˜¯ä¸€ä¸ªé—®é¢˜ï¼ŒDockerå®˜æ–¹ä¸ºäº†é¿å…ç½‘ç»œä¸Šå¸¦æ¥çš„è¯¸å¤šéº»çƒ¦ï¼Œæ•…å°†è·¨ä¸»æœºç½‘ç»œå¼€äº†æ¯”è¾ƒå¤§çš„å£å­ï¼Œè€Œç”±ç”¨æˆ·è‡ªå·±å»å®ç°ã€‚æˆ‘ä»¬å¼€å‘å¹¶å¼€æºäº†Shrikeè¿™ä¸ªdockerç½‘ç»œæ’ä»¶ï¼Œå¤§å®¶å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½åˆ°ï¼š&lt;a href=&#34;https://github.com/rootsongjc/docker-ipam-plugin&#34;&gt;https://github.com/rootsongjc/docker-ipam-plugin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Â Â Â  ç›®å‰Dockerè·¨ä¸»æœºçš„ç½‘ç»œå®ç°æ–¹æ¡ˆä¹Ÿæœ‰å¾ˆå¤šç§, ä¸»è¦åŒ…æ‹¬ç«¯å£æ˜ å°„ï¼Œovs,fannelç­‰ã€‚ä½†æ˜¯è¿™äº›æ–¹æ¡ˆéƒ½æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œç«¯å£æ˜ å°„æœåŠ¡å†…çš„å†…ç½‘IPä¼šæ˜ å°„æˆå¤–ç½‘çš„IPï¼Œè¿™æ ·ä¼šç»™å¼€å‘å¸¦æ¥å›°æƒ‘ï¼Œå› ä¸ºä»–ä»¬å¾€å¾€åœ¨è·¨ç½‘ç»œäº¤äº’æ—¶æ˜¯ä¸éœ€è¦å†…ç½‘IPçš„ï¼Œè€Œovsä¸fannelåˆ™æ˜¯åœ¨åŸºç¡€ç½‘ç»œåè®®ä¸ŠåˆåŒ…è£…äº†ä¸€å±‚è‡ªå®šä¹‰åè®®ï¼Œè¿™æ ·å½“ç½‘ç»œæµé‡å¤§æ—¶ï¼Œå´åˆæ— ç«¯çš„å¢åŠ äº†ç½‘ç»œè´Ÿè½½ï¼Œæœ€åæˆ‘ä»¬é‡‡å–äº†è‡ªä¸»ç ”å‘æ‰å¹³åŒ–ç½‘ç»œæ’ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´è®©æ‰€æœ‰çš„å®¹å™¨ç»Ÿç»Ÿåœ¨å¤§äºŒå±‚ä¸Šäº’é€šã€‚æ¶æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_network.jpg&#34; alt=&#34;td_yarn_network&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªbr0è‡ªå®šä¹‰ç½‘æ¡¥ï¼Œè¿™ä¸ªç½‘æ¡¥å¹¶ä¸æ˜¯é€šè¿‡ç³»ç»Ÿå‘½ä»¤æ‰‹åŠ¨å»ºç«‹çš„åŸå§‹Linuxç½‘æ¡¥ï¼Œè€Œæ˜¯é€šè¿‡Dockerçš„cerate networkå‘½ä»¤æ¥å»ºç«‹çš„è‡ªå®šä¹‰ç½‘æ¡¥ï¼Œè¿™æ ·é¿å…äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®DefaultGatewayIPv4å‚æ•°æ¥è®¾ç½®å®¹å™¨çš„é»˜è®¤è·¯ç”±ï¼Œè¿™ä¸ªè§£å†³äº†åŸå§‹Linuxè‡ªå»ºç½‘æ¡¥ä¸èƒ½è§£å†³çš„é—®é¢˜. ç”¨Dockeråˆ›å»ºç½‘ç»œæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®subnetå‚æ•°æ¥è®¾ç½®å­ç½‘IPèŒƒå›´ï¼Œé»˜è®¤æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªç½‘æ®µç»™è¿™ä¸ªå­ç½‘ï¼Œåé¢å¯ä»¥ç”¨ipamdriverï¼ˆåœ°å€ç®¡ç†æ’ä»¶ï¼‰æ¥è¿›è¡Œæ§åˆ¶ã€‚è¿˜æœ‰ä¸€ä¸ªå‚æ•°gatewayæ˜¯ç”¨æ¥è®¾ç½®br0è‡ªå®šä¹‰ç½‘æ¡¥åœ°å€çš„ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä½ è¿™å°å®¿ä¸»æœºçš„åœ°å€ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;docker network create 
--opt=com.docker.network.bridge.enable_icc=true
--opt=com.docker.network.bridge.enable_ip_masquerade=false
--opt=com.docker.network.bridge.host_binding_ipv4=0.0.0.0
--opt=com.docker.network.bridge.name=br0
--opt=com.docker.network.driver.mtu=1500
--ipam-driver=talkingdata
--subnet=å®¹å™¨IPçš„å­ç½‘èŒƒå›´
--gateway=br0ç½‘æ¡¥ä½¿ç”¨çš„IP,ä¹Ÿå°±æ˜¯å®¿ä¸»æœºçš„åœ°å€
--aux-address=DefaultGatewayIPv4=å®¹å™¨ä½¿ç”¨çš„ç½‘å…³åœ°å€
mynet
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_ipam.jpg&#34; alt=&#34;td_yarn_ipam&#34; /&gt;&lt;/p&gt;

&lt;p&gt;IPAMé©±åŠ¨æ˜¯ä¸“é—¨ç®¡ç†Docker å®¹å™¨IPçš„, Docker æ¯æ¬¡å¯åœä¸åˆ é™¤å®¹å™¨éƒ½ä¼šè°ƒç”¨è¿™ä¸ªé©±åŠ¨æä¾›çš„IPç®¡ç†æ¥å£ï¼Œç„¶åIPæ¥å£ä¼šå¯¹å­˜å‚¨IPåœ°å€çš„Etcdæœ‰ä¸€ä¸ªå¢åˆ æ”¹æŸ¥çš„æ“ä½œã€‚æ­¤æ’ä»¶è¿è¡Œæ—¶ä¼šèµ·ä¸€ä¸ªUnixSocket, ç„¶åä¼šåœ¨docker/run/pluginsç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª.sockæ–‡ä»¶ï¼ŒDockerdaemonä¹‹åä¼šå’Œè¿™ä¸ªsock æ–‡ä»¶è¿›è¡Œæ²Ÿé€šå»è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å®ç°å¥½çš„å‡ ä¸ªæ¥å£è¿›è¡ŒIPç®¡ç†ï¼Œä»¥æ­¤æ¥è¾¾åˆ°IPç®¡ç†çš„ç›®çš„ï¼Œé˜²æ­¢IPå†²çªã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;Â Â Â  é€šè¿‡Dockerå‘½ä»¤å»åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘ç»œèµ·åä¸ºâ€œmynetâ€ï¼ŒåŒæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªç½‘æ¡¥br0ï¼Œä¹‹åé€šè¿‡æ›´æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶ï¼ˆåœ¨/etc/sysconfig/network-scripts/ä¸‹ifcfg-br0ã€ifcfg-é»˜è®¤ç½‘ç»œæ¥å£åï¼‰å°†é»˜è®¤ç½‘ç»œæ¥å£æ¡¥æ¥åˆ°br0ä¸Šï¼Œé‡å¯ç½‘ç»œåï¼Œæ¡¥æ¥ç½‘ç»œå°±ä¼šç”Ÿæ•ˆã€‚Dockeré»˜è®¤åœ¨æ¯æ¬¡å¯åŠ¨å®¹å™¨æ—¶éƒ½ä¼šå°†å®¹å™¨å†…çš„é»˜è®¤ç½‘å¡æ¡¥æ¥åˆ°br0ä¸Šï¼Œè€Œä¸”å®¿ä¸»æœºçš„ç‰©ç†ç½‘å¡ä¹ŸåŒæ ·æ¡¥æ¥åˆ°äº†br0ä¸Šäº†ã€‚å…¶å®æ¡¥æ¥çš„åŸç†å°±å¥½åƒæ˜¯ä¸€å°äº¤æ¢æœºï¼ŒDocker å®¹å™¨å’Œå®¿ä¸»æœºç‰©ç†ç½‘ç»œæ¥å£éƒ½æ˜¯æœåŠ¡å™¨ï¼Œé€šè¿‡vethpairè¿™ä¸ªç½‘ç»œè®¾å¤‡åƒä¸€æ ¹ç½‘çº¿æ’åˆ°äº¤æ¢æœºä¸Šã€‚è‡³æ­¤ï¼Œæ‰€æœ‰çš„å®¹å™¨ç½‘ç»œå·²ç»åœ¨åŒä¸€ä¸ªç½‘ç»œä¸Šå¯ä»¥é€šä¿¡äº†ï¼Œæ¯ä¸€ä¸ªDockerå®¹å™¨å°±å¥½æ¯”æ˜¯ä¸€å°ç‹¬ç«‹çš„è™šæ‹Ÿæœºï¼Œæ‹¥æœ‰å’Œå®¿ä¸»æœºåŒä¸€ç½‘æ®µçš„IPï¼Œå¯ä»¥å®ç°è·¨ä¸»æœºè®¿é—®äº†ã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;h2 id=&#34;æ€§èƒ½ç“¶é¢ˆä¸ä¼˜åŒ–&#34;&gt;æ€§èƒ½ç“¶é¢ˆä¸ä¼˜åŒ–&lt;/h2&gt;

&lt;p&gt;Â Â Â  å¤§å®¶å¯èƒ½ä¼šæ‹…å¿ƒè‡ªå®šä¹‰ç½‘ç»œçš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºæ­¤æˆ‘ä»¬ç”¨iperfè¿›è¡Œäº†ç½‘ç»œæ€§èƒ½æµ‹è¯•ã€‚æˆ‘ä»¬å¯¹æ¯”äº†ä¸åŒä¸»æœºå®¹å™¨é—´çš„ç½‘é€Ÿï¼ŒåŒä¸€ä¸»æœºä¸Šçš„ä¸åŒå®¹å™¨å’Œä¸åŒä¸»æœºé—´çš„ç½‘é€Ÿï¼Œç»“æœå¦‚ä¸‹è¡¨ï¼š&lt;/p&gt;

&lt;p&gt;Â &lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_iperf.jpg&#34; alt=&#34;td_yarn_iperf&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Â ä»è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸€ç»„æµ‹è¯•ä¸­ï¼Œå®¹å™¨é—´çš„ç½‘é€Ÿä¸å®¹å™¨æ˜¯åœ¨æƒ³é€šä¸»æœºè¿˜æ˜¯åœ¨ä¸åŒä¸»æœºä¸Šçš„å·®åˆ«ä¸å¤§ï¼Œè¯´æ˜æˆ‘ä»¬çš„ç½‘ç»œæ’ä»¶æ€§èƒ½è¿˜æ˜¯å¾ˆä¼˜å¼‚çš„ã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;h2 id=&#34;hadoopé…ç½®ä¼˜åŒ–&#34;&gt;Hadoopé…ç½®ä¼˜åŒ–Â &lt;/h2&gt;

&lt;p&gt;Â Â Â  å› ä¸ºä½¿ç”¨dockerå°†åŸæ¥ä¸€å°æœºå™¨ä¸€ä¸ªnodemanagerç»™ç»†åŒ–ä¸ºäº†å¤šä¸ªï¼Œä¼šé€ æˆnodemanagerä¸ªæ•°çš„æˆå€å¢åŠ ï¼Œå› æ­¤hadoopçš„ä¸€äº›é…ç½®éœ€è¦ç›¸åº”ä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;â€¢Â  yarn.nodemanager.localizer.fetch.thread-count éšç€å®¹å™¨æ•°é‡å¢åŠ ï¼Œéœ€è¦ç›¸åº”è°ƒæ•´è¯¥å‚æ•°&lt;/p&gt;

&lt;p&gt;â€¢Â  yarn.resourcemanager.amliveliness-monitor.interval-msé»˜è®¤1ç§’ï¼Œæ”¹ä¸º10ç§’ï¼Œå¦åˆ™æ—¶é—´å¤ªçŸ­å¯èƒ½å¯¼è‡´æœ‰äº›èŠ‚ç‚¹æ— æ³•æ³¨å†Œ&lt;/p&gt;

&lt;p&gt;â€¢Â  yarn.resourcemanager.resource-tracker.client.thread-counté»˜è®¤50ï¼Œæ”¹ä¸º100ï¼Œéšç€å®¹å™¨æ•°é‡å¢åŠ ï¼Œéœ€è¦ç›¸åº”è°ƒæ•´è¯¥å‚æ•°&lt;/p&gt;

&lt;p&gt;â€¢Â  yarn.nodemanager.pmem-check-enabledé»˜è®¤trueï¼Œæ”¹ä¸ºfalseï¼Œä¸æ£€æŸ¥ä»»åŠ¡æ­£åœ¨ä½¿ç”¨çš„ç‰©ç†å†…å­˜é‡&lt;/p&gt;

&lt;p&gt;â€¢Â  å®¹å™¨ä¸­hadoop ulimitå€¼ä¿®æ”¹ï¼Œé»˜è®¤4096ï¼Œæ”¹æˆ655350&lt;/p&gt;

&lt;p&gt;é›†ç¾¤ç›‘æ§&lt;/p&gt;

&lt;p&gt;Â &lt;/p&gt;

&lt;p&gt;å¦‚æœä½¿ç”¨shipyardç®¡ç†é›†ç¾¤ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„ç›‘æ§é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸€å®šæ—¶é—´æ®µå†…çš„CPUã€å†…å­˜ã€IOã€ç½‘ç»œä½¿ç”¨çŠ¶å†µã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_monitor.jpg&#34; alt=&#34;td_yarn_monitor&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å…³äºæœªæ¥&#34;&gt;å…³äºæœªæ¥&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/img/yarn-on-docker/td_yarn_os.jpg&#34; alt=&#34;td_yarn_os&#34; /&gt;Â &lt;/p&gt;

&lt;p&gt;Â Â Â  æˆ‘ä»¬æœªæ¥è§„åˆ’åšçš„æ˜¯DCï¼OSï¼ŒåŸºäºDockerçš„åº”ç”¨è‡ªåŠ¨æ‰“åŒ…ç¼–è¯‘åˆ†å‘ç³»ç»Ÿï¼Œè®©å¼€å‘äººå‘˜å¯ä»¥å¾ˆä¾¿æ·çš„ç”³è¯·èµ„æºï¼Œä¸Šä¸‹çº¿æœåŠ¡ï¼Œç®¡ç†åº”ç”¨ã€‚è¦è¾¾åˆ°è¿™ä¸ªç›®æ ‡è¿˜æœ‰å¾ˆå¤šäº‹æƒ…è¦åšï¼š&lt;/p&gt;

&lt;p&gt;â€¢Â  Service Control Panelï¼šç»Ÿä¸€çš„æ ¹æ®æœåŠ¡æ¥ç®¡ç†çš„webé¡µé¢&lt;/p&gt;

&lt;p&gt;â€¢Â  Loadbalanceï¼šå®¹å™¨æ ¹æ®æœºå™¨è´Ÿè½½æƒ…å†µè‡ªåŠ¨è¿ç§»&lt;/p&gt;

&lt;p&gt;â€¢Â  Schedulerï¼šswarmè°ƒåº¦ç­–ç•¥ä¼˜åŒ–&lt;/p&gt;

&lt;p&gt;â€¢Â  æœåŠ¡é…ç½®æ–‡ä»¶ï¼šæä¾›é•œåƒå¯åŠ¨å‚æ•°çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰å¯åŠ¨å‚æ•°å¯é€šè¿‡æ–‡ä»¶é…ç½®&lt;/p&gt;

&lt;p&gt;â€¢Â  ç›‘æ§ï¼šæœåŠ¡çº§åˆ«çš„ç›‘æ§&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« å†™å¥½çš„æ—¶å€™æ˜¯2016å¹´10æœˆï¼Œè·ç¦»ç°åœ¨æˆ‘æ·»åŠ &lt;strong&gt;å‰è¨€&lt;/strong&gt;å’Œ&lt;strong&gt;åè®°&lt;/strong&gt;çš„å·²ç»å¿«åŠå¹´æ—¶é—´äº†ï¼Œè¿™æ®µæ—¶é—´å†…ä¸šç•Œä¹Ÿå‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ï¼Œæ¯”å¦‚dockeræ¨å‡ºCEå’ŒSEç‰ˆæœ¬ï¼ŒGoogleçš„kuberneteså‘å¸ƒäº†1.6ç‰ˆæœ¬ï¼Œäººå·¥æ™ºèƒ½ä¾ç„¶å¤§çƒ­ï¼Œåœ¨å¯é¢„è§çš„æœªæ¥ï¼Œå¯ä»¥è¯´&lt;u&gt;Kubernetesä¸€å®šä¼šè¿œè¿œè¶…è¶ŠDockeræˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„ç‹è€…&lt;/u&gt;ï¼Œè¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œå¯¹äºdocker 17.03-CEæˆ‘ä¹Ÿç ”ç©¶è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œå…¶disgustingçš„pluginè®©æˆ‘å¯¹äºdockerçš„ç¼–æ’å·²ç»å¤±å»ä¿¡å¿ƒã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®å®¹å™¨åœ¨å¤§æ•°æ®åœºæ™¯ä¸‹çš„åº”ç”¨å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæ¯•ç«ŸHadoopé‚£å¥—ç¬¨é‡çš„ä¸œè¥¿æ”¾åœ¨å®¹å™¨ä¸‹è¿è¡Œï¼Œä¸Šç”Ÿäº§ç¯å¢ƒ? Are you kidding me?å¦‚æœè¯´åšåŸå‹éªŒè¯ã€ç ”å‘æµ‹è¯•é‚£è¿˜å¯ä»¥ã€‚è¿™æ ·å°±å¤§å¤§é™åˆ¶äº†å®¹å™¨æŠ€æœ¯åœ¨å¤§æ•°æ®åœºæ™¯ä¸‹çš„åº”ç”¨åœºæ™¯ã€‚ä½¿ç”¨å®¹å™¨çš„ç¼–æ’è°ƒåº¦æ¥å®ç°å¤§æ•°æ®é›†ç¾¤çš„èµ„æºä¼˜åŒ–æœ‰ç‚¹èˆæœ¬é€æœ«ï¼Œ&lt;u&gt;å¦‚æœçœŸçš„è¦ä¼˜åŒ–é›†ç¾¤èµ„æºåˆ©ç”¨ç‡çš„è¯ï¼Œåº”è¯¥è®©ä¸åŒçš„åº”ç”¨æ··è·‘ï¼Œè€Œä¸åº”è¯¥è®©é›†ç¾¤ä¹‹é—´èµ„æºéš”ç¦»ï¼Œæ¯”å¦‚Webåº”ç”¨è·Ÿå¤§æ•°æ®åº”ç”¨æ··å¸ƒã€‚&lt;/u&gt;ç›®å‰çš„è¿™ç§&lt;strong&gt;Yarn on Docker&lt;/strong&gt;æ–¹æ¡ˆå®è´¨ä¸Šæ˜¯å°†åŸæ¥çš„æ•´ä½“Hadoop Yarné›†ç¾¤åˆ’åˆ†æˆå¤šä¸ªä¸åŒçš„Yarnï¼Œå°†å­˜å‚¨å’Œè®¡ç®—åˆ†ç¦»äº†ã€‚å…¶å®è¿™è·Ÿ&lt;strong&gt;Nutanix&lt;/strong&gt;çš„è¶…èåˆæ¶æ„æœ‰ç‚¹åƒï¼ŒNutanixæ˜¯ç”±å‰Googleçš„å·¥ç¨‹å¸ˆåˆ›ç«‹çš„ï¼Œè§£å†³è™šæ‹ŸåŒ–è®¡ç®—ç¯å¢ƒä¸‹çš„å­˜å‚¨é—®é¢˜ï¼Œä¹Ÿæ˜¯å°†å­˜å‚¨å’Œè®¡ç®—åˆ†ç¦»ï¼Œå…±äº«å­˜å‚¨ï¼Œè®¡ç®—æ ¹æ®éœ€è¦è°ƒåº¦ã€‚äº‹å®ä¸ŠYahooå·²ç»æœ‰è§£å†³Hadoopé›†ç¾¤çš„èµ„æºç»†ç²’åº¦åˆ†é…å’Œè°ƒåº¦é—®é¢˜çš„æ–¹æ¡ˆï¼Œè¿™åº”è¯¥æ˜¯ä»Yarnçš„schedulerå±‚æ¥å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;Swarmå·²æ­»ï¼ŒSwarmkitå°†ç»§ç»­å‘å±•ï¼ŒDockerçš„Swarm Modeè¿˜ä¼šåœ¨è‰°éš¾ä¸­å‰è¡Œï¼Œç›®å‰çœ‹åˆ°çš„è¶‹åŠ¿ä»ç„¶æ˜¯æ¨¡ä»¿Kubernentesä¸ºä¸»ï¼Œæ²¡æœ‰è‡ªå·±é²œæ˜çš„ç‰¹è‰²ï¼ˆé™¤äº†éƒ¨ç½²ç®¡ç†æ–¹ä¾¿æ„å¤–ï¼Œè°è®©å®ƒå°±é›†æˆåœ¨äº†dockeré‡Œå‘¢ï¼Œå°±åƒå½“å¹´windowsé›†æˆIEæ‰“è´¥Netscapeï¼Œä¸è¿‡è¿™ä¸ä¼šå†æ­¤ä¸Šæ¼”äº†ï¼‰ï¼ŒKubernentesåˆæ˜¯ä¸€ä¸ªé€šç”¨çš„èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œå®ƒçš„æœ€å°èµ„æºåˆ’åˆ†æ˜¯&lt;strong&gt;Pod&lt;/strong&gt;è€Œä¸æ˜¯dockerï¼Œå®ƒè¿˜å¯ä»¥è¿è¡Œrktã€containerdã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šå‘¨èµ·æˆ‘å¼€å§‹å°†æ³¨æ„åŠ›è½¬ç§»åˆ°kubernentesï¼Œä»¥åè¯·å…³æ³¨æˆ‘çš„&lt;a href=&#34;http://rootsongjc.github.io/tags/kubernetes/&#34;&gt;Kuberenteså®è·µ&lt;/a&gt;ç›¸å…³æ–‡ç« ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>KubernetesåŸºäºflannelçš„ç½‘ç»œé…ç½®</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-network-config/</link>
      <pubDate>Fri, 31 Mar 2017 11:05:18 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-network-config/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2014100402.jpg&#34; alt=&#34;è¥¿å®‰é¼“æ¥¼&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šè¥¿å®‰é¼“æ¥¼ Oct 4,2014ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ä¹¦æ¥ä¸Šæ–‡&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/&#34;&gt;åœ¨CentOSä¸­å®‰è£…Kubernetesè¯¦ç»†æŒ‡å—&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼Œä½œä¸ºå­¦ä¹ Kubernetesçš„å¿ƒè·¯å†ç¨‹å§ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡ä¸»è¦è®²è§£&lt;strong&gt;Kubernetesçš„ç½‘ç»œé…ç½®&lt;/strong&gt;ï¼ŒğŸ‘†æ–‡ä¸­æœ‰ä¸€ä¸ªå®‰è£…&lt;strong&gt;Flannel&lt;/strong&gt;çš„æ­¥éª¤ï¼Œä½†æ˜¯å®‰è£…å¥½åå¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®è¯´æ˜ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é…ç½®flannel&#34;&gt;é…ç½®flannel&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„yumå®‰è£…çš„flannleï¼Œå®‰è£…å¥½åä¼šç”Ÿæˆ&lt;code&gt;/usr/lib/systemd/system/flanneld.service&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Flanneld overlay address etcd agent
After=network.target
After=network-online.target
Wants=network-online.target
After=etcd.service
Before=docker.service

[Service]
Type=notify
EnvironmentFile=/etc/sysconfig/flanneld
EnvironmentFile=-/etc/sysconfig/docker-network
ExecStart=/usr/bin/flanneld-start $FLANNEL_OPTIONS
ExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker
Restart=on-failure

[Install]
WantedBy=multi-user.target
RequiredBy=docker.service
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°flannelç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶åœ¨&lt;code&gt;/etc/sysconfig/flanneld&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;# Flanneld configuration options  

# etcd url location.  Point this to the server where etcd runs
FLANNEL_ETCD_ENDPOINTS=&amp;quot;http://sz-pg-oam-docker-test-001.tendcloud.com:2379&amp;quot;

# etcd config key.  This is the configuration key that flannel queries
# For address range assignment
FLANNEL_ETCD_PREFIX=&amp;quot;/kube-centos/network&amp;quot;

# Any additional options that you want to pass
#FLANNEL_OPTIONS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;etcdçš„åœ°å€&lt;code&gt;FLANNEL_ETCD_ENDPOINT&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;etcdæŸ¥è¯¢çš„ç›®å½•ï¼ŒåŒ…å«dockerçš„IPåœ°å€æ®µé…ç½®ã€‚&lt;code&gt;FLANNEL_ETCD_PREFIX&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;åœ¨etcdä¸­åˆ›å»ºç½‘ç»œé…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¸ºdockeråˆ†é…IPåœ°å€æ®µã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;etcdctl mkdir /kube-centos/network
etcdctl mk /kube-centos/network/config &amp;quot;{ \&amp;quot;Network\&amp;quot;: \&amp;quot;172.30.0.0/16\&amp;quot;, \&amp;quot;SubnetLen\&amp;quot;: 24, \&amp;quot;Backend\&amp;quot;: { \&amp;quot;Type\&amp;quot;: \&amp;quot;vxlan\&amp;quot; } }&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®Docker&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Flannelçš„&lt;a href=&#34;https://github.com/coreos/flannel/blob/master/Documentation/running.md&#34;&gt;æ–‡æ¡£&lt;/a&gt;ä¸­æœ‰å†™&lt;strong&gt;Docker Integration&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;p&gt;Docker daemon accepts &lt;code&gt;--bip&lt;/code&gt; argument to configure the subnet of the docker0 bridge. It also accepts &lt;code&gt;--mtu&lt;/code&gt; to set the MTU for docker0 and veth devices that it will be creating. Since flannel writes out the acquired subnet and MTU values into a file, the script starting Docker can source in the values and pass them to Docker daemon:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;source /run/flannel/subnet.env
docker daemon --bip=${FLANNEL_SUBNET} --mtu=${FLANNEL_MTU} &amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Systemd users can use &lt;code&gt;EnvironmentFile&lt;/code&gt; directive in the .service file to pull in &lt;code&gt;/run/flannel/subnet.env&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹è½½flannel github releaseä¸­çš„taråŒ…ï¼Œè§£å‹åä¼šè·å¾—ä¸€ä¸ª&lt;strong&gt;mk-docker-opts.sh&lt;/strong&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥&lt;code&gt;Generate Docker daemon options based on flannel env file&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;./mk-docker-opts.sh -i&lt;/code&gt;å°†ä¼šç”Ÿæˆå¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶ç¯å¢ƒå˜é‡æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;/run/flannel/subnet.env&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;FLANNEL_NETWORK=172.30.0.0/16
FLANNEL_SUBNET=172.30.46.1/24
FLANNEL_MTU=1450
FLANNEL_IPMASQ=false
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/run/docker_opts.env&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;DOCKER_OPT_BIP=&amp;quot;--bip=172.30.46.1/24&amp;quot;
DOCKER_OPT_IPMASQ=&amp;quot;--ip-masq=true&amp;quot;
DOCKER_OPT_MTU=&amp;quot;--mtu=1450&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨æŸ¥è¯¢etcdä¸­çš„å†…å®¹å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$etcdctl ls /kube-centos/network/subnets
/kube-centos/network/subnets/172.30.14.0-24
/kube-centos/network/subnets/172.30.38.0-24
/kube-centos/network/subnets/172.30.46.0-24
$etcdctl get /kube-centos/network/config
{ &amp;quot;Network&amp;quot;: &amp;quot;172.30.0.0/16&amp;quot;, &amp;quot;SubnetLen&amp;quot;: 24, &amp;quot;Backend&amp;quot;: { &amp;quot;Type&amp;quot;: &amp;quot;vxlan&amp;quot; } }
$etcdctl get /kube-centos/network/subnets/172.30.14.0-24
{&amp;quot;PublicIP&amp;quot;:&amp;quot;172.20.0.114&amp;quot;,&amp;quot;BackendType&amp;quot;:&amp;quot;vxlan&amp;quot;,&amp;quot;BackendData&amp;quot;:{&amp;quot;VtepMAC&amp;quot;:&amp;quot;56:27:7d:1c:08:22&amp;quot;}}
$etcdctl get /kube-centos/network/subnets/172.30.38.0-24
{&amp;quot;PublicIP&amp;quot;:&amp;quot;172.20.0.115&amp;quot;,&amp;quot;BackendType&amp;quot;:&amp;quot;vxlan&amp;quot;,&amp;quot;BackendData&amp;quot;:{&amp;quot;VtepMAC&amp;quot;:&amp;quot;12:82:83:59:cf:b8&amp;quot;}}
$etcdctl get /kube-centos/network/subnets/172.30.46.0-24
{&amp;quot;PublicIP&amp;quot;:&amp;quot;172.20.0.113&amp;quot;,&amp;quot;BackendType&amp;quot;:&amp;quot;vxlan&amp;quot;,&amp;quot;BackendData&amp;quot;:{&amp;quot;VtepMAC&amp;quot;:&amp;quot;e6:b2:fd:f6:66:96&amp;quot;}}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è®¾ç½®docker0ç½‘æ¡¥çš„IPåœ°å€&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;source /run/flannel/subnet.env
ifconfig docker0 $FLANNEL_SUBNET
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·docker0å’Œflannelç½‘æ¡¥ä¼šåœ¨åŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œå¦‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;6: docker0: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc noqueue state DOWN 
    link/ether 02:42:da:bf:83:a2 brd ff:ff:ff:ff:ff:ff
    inet 172.30.38.1/24 brd 172.30.38.255 scope global docker0
       valid_lft forever preferred_lft forever
7: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1450 qdisc noqueue state UNKNOWN 
    link/ether 9a:29:46:61:03:44 brd ff:ff:ff:ff:ff:ff
    inet 172.30.38.0/32 scope global flannel.1
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å°±å¯ä»¥é‡å¯dockeräº†ã€‚&lt;/p&gt;

&lt;p&gt;é‡å¯äº†dockeråè¿˜è¦é‡å¯kubeletï¼Œè¿™æ—¶åˆé‡åˆ°é—®é¢˜ï¼Œkubeletå¯åŠ¨å¤±è´¥ã€‚æŠ¥é”™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Mar 31 16:44:41 sz-pg-oam-docker-test-002.tendcloud.com kubelet[81047]: error: failed to run Kubelet: failed to create kubelet: misconfiguration: kubelet cgroup driver: &amp;quot;cgroupfs&amp;quot; is different from docker cgroup driver: &amp;quot;systemd&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ˜¯kubeletä¸dockerçš„&lt;strong&gt;cgroup driver&lt;/strong&gt;ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œkubeletå¯åŠ¨çš„æ—¶å€™æœ‰ä¸ª&lt;code&gt;â€”cgroup-driver&lt;/code&gt;å‚æ•°å¯ä»¥æŒ‡å®šä¸º&amp;rdquo;cgroupfs&amp;rdquo;æˆ–è€…â€œsystemdâ€ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;--cgroup-driver string                                    Driver that the kubelet uses to manipulate cgroups on the host.  Possible values: &#39;cgroupfs&#39;, &#39;systemd&#39; (default &amp;quot;cgroupfs&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨flannel&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;systemctl daemon-reload
systemctl start flanneld
systemctl status flanneld
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é‡æ–°ç™»å½•è¿™ä¸‰å°ä¸»æœºï¼Œå¯ä»¥çœ‹åˆ°æ¯å°ä¸»æœºéƒ½å¤šäº†ä¸€ä¸ªIPã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒKuberneteså®˜æ–¹æ–‡æ¡£çš„&lt;a href=&#34;https://kubernetes.io/docs/tutorials/stateless-application/expose-external-ip-address/&#34;&gt;Exposing an External IP Address to Access an Application in a Cluster&lt;/a&gt;ï¼Œå®˜æ–¹ä½¿ç”¨çš„Hello Worldæµ‹è¯•ï¼Œæˆ‘ä»¬å¯åŠ¨NginxæœåŠ¡æµ‹è¯•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;#å¯åŠ¨nginxçš„pod
kubectl run nginx --replicas=2 --labels=&amp;quot;run=load-balancer-example&amp;quot; --image=sz-pg-oam-docker-hub-001.tendcloud.com/library/nginx:1.9  --port=80
#åˆ›å»ºåä¸ºexample-serviceçš„æœåŠ¡
kubectl expose deployment nginx --type=NodePort --name=example-service
#æŸ¥çœ‹çŠ¶æ€
kubectl get deployments nginx
kubectl describe deployments nginx
kubectl get replicasets
kubectl describe replicasets
kubectl describe svc example-service
###################################################
Name:			example-service
Namespace:		default
Labels:			run=load-balancer-example
Annotations:		&amp;lt;none&amp;gt;
Selector:		run=load-balancer-example
Type:			NodePort
IP:			10.254.180.209
Port:			&amp;lt;unset&amp;gt;	80/TCP
NodePort:		&amp;lt;unset&amp;gt;	32663/TCP
Endpoints:		172.30.14.2:80,172.30.46.2:80
Session Affinity:	None
Events:			&amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬ä¸Šé¢å¯åŠ¨çš„serivceçš„typeæ˜¯&lt;strong&gt;NodePort&lt;/strong&gt;ï¼ŒKubernetesçš„serviceæ”¯æŒä¸‰ç§ç±»å‹çš„serviceï¼Œå‚è€ƒ&lt;a href=&#34;http://www.cnblogs.com/xuxinkun/p/5331728.html&#34;&gt;Kubernetes Serivceåˆ†æ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨è®¿é—®ä¸‰å°ç‰©ç†æœºçš„IP:80ç«¯å£å°±å¯ä»¥çœ‹åˆ°nginxçš„é¡µé¢äº†ã€‚&lt;/p&gt;

&lt;p&gt;ç¨ç­‰ä¸€ä¼šåœ¨è®¿é—®ClusterIP + Portä¹Ÿå¯ä»¥è®¿é—®åˆ°nginxã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$curl 10.254.180.209:80
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;Welcome to nginx!&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Welcome to nginx!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;For online documentation and support please refer to
&amp;lt;a href=&amp;quot;http://nginx.org/&amp;quot;&amp;gt;nginx.org&amp;lt;/a&amp;gt;.&amp;lt;br/&amp;gt;
Commercial support is available at
&amp;lt;a href=&amp;quot;http://nginx.com/&amp;quot;&amp;gt;nginx.com&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;em&amp;gt;Thank you for using nginx.&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;è™šæ‹Ÿåœ°å€&#34;&gt;è™šæ‹Ÿåœ°å€&lt;/h2&gt;

&lt;p&gt;Kubernetesä¸­çš„Serviceäº†ä½¿ç”¨äº†è™šæ‹Ÿåœ°å€ï¼›è¯¥åœ°å€æ— æ³•pingé€šè¿‡ï¼Œä½†å¯ä»¥è®¿é—®å…¶ç«¯å£ã€‚é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œè¯¥è™šæ‹Ÿåœ°å€æ˜¯è‹¥å¹²æ¡iptablesçš„è§„åˆ™ã€‚åˆ°10.254.124.145:8080ç«¯å£çš„è¯·æ±‚ä¼šè¢«é‡å®šå‘åˆ°172.30.38.2æˆ–172.30.46.2çš„8080ç«¯å£ã€‚è¿™äº›è§„åˆ™æ˜¯ç”±kube-proxyç”Ÿæˆï¼›å¦‚æœéœ€è¦æŸå°æœºå™¨å¯ä»¥è®¿é—®Serviceï¼Œåˆ™éœ€è¦åœ¨è¯¥ä¸»æœºå¯åŠ¨kube-proxyã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹serviceçš„iptables&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$iptables-save|grep example-service
-A KUBE-NODEPORTS -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp --dport 32663 -j KUBE-MARK-MASQ
-A KUBE-NODEPORTS -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp --dport 32663 -j KUBE-SVC-BR4KARPIGKMRMN3E
-A KUBE-SEP-NCPBOLUH5XTTHG3E -s 172.30.46.2/32 -m comment --comment &amp;quot;default/example-service:&amp;quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-NCPBOLUH5XTTHG3E -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp -j DNAT --to-destination 172.30.46.2:80
-A KUBE-SEP-ONEKQBIWICF7RAR3 -s 172.30.14.2/32 -m comment --comment &amp;quot;default/example-service:&amp;quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-ONEKQBIWICF7RAR3 -p tcp -m comment --comment &amp;quot;default/example-service:&amp;quot; -m tcp -j DNAT --to-destination 172.30.14.2:80
-A KUBE-SERVICES -d 10.254.180.209/32 -p tcp -m comment --comment &amp;quot;default/example-service: cluster IP&amp;quot; -m tcp --dport 80 -j KUBE-SVC-BR4KARPIGKMRMN3E
-A KUBE-SVC-BR4KARPIGKMRMN3E -m comment --comment &amp;quot;default/example-service:&amp;quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-ONEKQBIWICF7RAR3
-A KUBE-SVC-BR4KARPIGKMRMN3E -m comment --comment &amp;quot;default/example-service:&amp;quot; -j KUBE-SEP-NCPBOLUH5XTTHG3E
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹clusterIPçš„iptables&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$iptables -t nat -nL|grep 10.254
KUBE-SVC-NPX46M4PTMTKRN6Y  tcp  --  0.0.0.0/0            10.254.0.1           /* default/kubernetes:https cluster IP */ tcp dpt:443
KUBE-SVC-BR4KARPIGKMRMN3E  tcp  --  0.0.0.0/0            10.254.180.209       /* default/example-service: cluster IP */ tcp dpt:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨PREROUTINGç¯èŠ‚ï¼Œk8sè®¾ç½®äº†ä¸€ä¸ªtarget: KUBE-SERVICESã€‚è€ŒKUBE-SERVICESä¸‹é¢åˆè®¾ç½®äº†è®¸å¤štargetï¼Œä¸€æ—¦destinationå’ŒdstportåŒ¹é…ï¼Œå°±ä¼šæ²¿ç€chainè¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ï¼šå½“æˆ‘ä»¬åœ¨podç½‘ç»œcurl 10.254.198.44 80æ—¶ï¼ŒåŒ¹é…åˆ°ä¸‹é¢çš„KUBE-SVC-BR4KARPIGKMRMN3E targetï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;KUBE-SVC-BR4KARPIGKMRMN3E  tcp  --  0.0.0.0/0            10.254.180.209       /* default/example-service: cluster IP */ tcp dpt:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‚è€ƒ&lt;a href=&#34;http://tonybai.com/2017/01/17/understanding-flannel-network-for-kubernetes/&#34;&gt;ç†è§£Kubernetesç½‘ç»œä¹‹Flannelç½‘ç»œ&lt;/a&gt;ï¼ŒTony Baiçš„æ–‡ç« ä¸­æœ‰å¯¹flannelçš„è¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é‡åˆ°çš„é—®é¢˜&#34;&gt;é‡åˆ°çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;åœ¨è®¾ç½®ç½‘ç»œçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œè®°å½•å¦‚ä¸‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é—®é¢˜ä¸€&#34;&gt;é—®é¢˜ä¸€&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Kube-proxyå¼€æ”¾çš„&lt;strong&gt;NodePort&lt;/strong&gt;ç«¯å£æ— æ³•è®¿é—®ã€‚å³æ— æ³•ä½¿ç”¨NodeIPåŠ NodePortçš„æ–¹å¼è®¿é—®serviceï¼Œè€Œä¸”æœ¬åœ°telnetä¹Ÿä¸é€šï¼Œä½†æ˜¯ç«¯å£ç¡®ç¡®å®å®åœ¨é‚£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é—®é¢˜çŠ¶æ€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å·²è§£å†³&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…¶å®è¿™ä¸æ˜¯é—®é¢˜ï¼Œæ˜¯å› ä¸ºä»ä¸Šé¢çš„æ“ä½œè®°å½•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ&lt;strong&gt;åœ¨å¯åŠ¨Nginxçš„Pod&lt;/strong&gt;æ—¶ï¼ŒæŒ‡å®športä¸º80å³å¯ã€‚ä»¥ClusterIP + Portçš„æ–¹å¼è®¿é—®serivceéœ€è¦ç­‰ä¸€æ®µæ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åæ€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘ä»¬å·®ä¸å¤šä¸¤å¤©æ—¶é—´ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„æ ¹æºè¿˜æ˜¯å› ä¸º&lt;u&gt;æ€æƒ³è§‚å¿µæ²¡æœ‰ä»è¿è¡Œdockerçš„å‘½ä»¤ä¸­è§£æ”¾å‡ºæ¥&lt;/u&gt;,è¿˜æŠŠ&lt;code&gt;kubelet run â€”port&lt;/code&gt;å½“æˆæ˜¯docker runä¸­çš„ç«¯å£æ˜ å°„ï¼Œè¿™ç§æƒ³æ³•æ˜¯å¤§é”™ç‰¹é”™çš„ï¼Œè¯¥ç«¯å£æ˜¯imageä¸­çš„åº”ç”¨å®é™…æš´éœ²çš„ç«¯å£ï¼Œå¦‚nginxçš„80ç«¯å£ã€‚ğŸ˜”&lt;/p&gt;

&lt;h3 id=&#34;é—®é¢˜äºŒ&#34;&gt;é—®é¢˜äºŒ&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ²¡æœ‰åˆ é™¤serviceå’Œdeployçš„æƒ…å†µä¸‹å°±é‡å¯kubeletçš„æ—¶å€™ï¼Œä¼šé‡åˆ°kubeletå¯åŠ¨å¤±è´¥çš„æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å‡ºé”™ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Apr 01 14:24:08 sz-pg-oam-docker-test-001.tendcloud.com kubelet[103932]: I0401 14:24:08.359839  103932 kubelet.go:1752] skipping pod synchronization - [Failed to start ContainerManager failed to initialise top level QOS containers: failed to create top level Burstable QOS cgroup : Unit kubepods-burstable.slice already exists.]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://www.osbaike.net/article-show-id-229028.html&#34;&gt;Kubernetes Resource QoSæœºåˆ¶è§£è¯»&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†QoSçš„æœºåˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesæ ¹æ®Podä¸­Containers Resourceçš„&lt;code&gt;request&lt;/code&gt;å’Œ&lt;code&gt;limit&lt;/code&gt;çš„å€¼æ¥å®šä¹‰Podçš„QoS Classã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºæ¯ä¸€ç§Resourceéƒ½å¯ä»¥å°†å®¹å™¨åˆ†ä¸º3ä¸­QoS Classes: Guaranteed, Burstable, and Best-Effortï¼Œå®ƒä»¬çš„QoSçº§åˆ«ä¾æ¬¡é€’å‡ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Guaranteed&lt;/strong&gt;ï¼šå¦‚æœPodä¸­æ‰€æœ‰Containerçš„æ‰€æœ‰Resourceçš„&lt;code&gt;limit&lt;/code&gt;å’Œ&lt;code&gt;request&lt;/code&gt;éƒ½ç›¸ç­‰ä¸”ä¸ä¸º0ï¼Œåˆ™è¿™ä¸ªPodçš„QoS Classå°±æ˜¯Guaranteedã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Burstable&lt;/strong&gt;ï¼šé™¤äº†ç¬¦åˆGuaranteedå’ŒBest-Effortçš„åœºæ™¯ï¼Œå…¶ä»–åœºæ™¯çš„Pod QoS Classéƒ½å±äºBurstableã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Best-Effort&lt;/strong&gt;ï¼šå¦‚æœPodä¸­æ‰€æœ‰å®¹å™¨çš„æ‰€æœ‰Resourceçš„requestå’Œlimitéƒ½æ²¡æœ‰èµ‹å€¼ï¼Œåˆ™è¿™ä¸ªPodçš„QoS Classå°±æ˜¯Best-Effortã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæš‚æ—¶è¿˜æ²¡æ‰¾åˆ°æ ¹æœ¬çš„è§£å†³åŠæ³•ï¼Œå‚è€ƒGithubä¸Šçš„&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/43856&#34;&gt;Failed to start ContainerManager failed to initialize top level QOS containers #43856&lt;/a&gt;ï¼Œé‡å¯ä¸»æœºåç¡®å®æ­£å¸¸äº†ï¼Œä¸è¿‡è¿™åªæ˜¯ä¸´æ—¶è§£å†³æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;å…¶å®æ˜¨å¤©å°±å·²ç»å®‰è£…å®Œæ¯•äº†ï¼Œæ˜¯æˆ‘ä»¬ä½¿ç”¨çš„å§¿åŠ¿ä¸å¯¹ï¼Œç™½ç™½è€½è¯¯è¿™ä¹ˆé•¿æ—¶é—´ï¼Œèº«è¾¹å·®ä¸ªè€å¸æœºå•Šï¼Œæ»´ï½å­¦ç”Ÿå¡ã€‚&lt;/p&gt;

&lt;p&gt;æ„Ÿè°¢&lt;a href=&#34;tonybai.com&#34;&gt;Tony Bai&lt;/a&gt;ã€&lt;a href=&#34;https://godliness.github.io/&#34;&gt;Peter Ma&lt;/a&gt;çš„å¤§åŠ›æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;Apr 1,2017 æ„šäººèŠ‚ï¼Œä¸œç›´é—¨&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨CentOSä¸Šå®‰è£…kubernetesè¯¦ç»†æŒ‡å—</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/</link>
      <pubDate>Thu, 30 Mar 2017 20:44:20 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/2014082501.jpg&#34; alt=&#34;åœ†æ˜å›­&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šåŒ—äº¬åœ†æ˜å›­ Aug 25,2014ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ä½œè€…ï¼š&lt;a href=&#34;rootsongjc.github.io/about&#34;&gt;Jimmy Song&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://godliness.github.io/&#34;&gt;Peter Ma&lt;/a&gt;ï¼Œ2017å¹´3æœˆ30æ—¥&lt;/p&gt;

&lt;p&gt;æœ€è¿‘å†³å®šä»Docker Swarm ModeæŠ•å…¥åˆ°Kubernetesçš„æ€€æŠ±ï¼Œå¯¹Dockerçš„æˆ˜ç•¥å’Œä¼ä¸šåŒ–å‘å±•å‰æ™¯æ¯”è¾ƒå ªå¿§ï¼Œè€ŒKubernetesæ˜¯&lt;a href=&#34;https://www.cncf.io/&#34;&gt;CNCF&lt;/a&gt;çš„æˆå‘˜ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç¯‡æ˜¯æ ¹æ®&lt;a href=&#34;https://kubernetes.io/docs/getting-started-guides/centos/centos_manual_config/#prerequisites&#34;&gt;å®˜æ–¹å®‰è£…æ–‡æ¡£&lt;/a&gt;å®è·µæ•´ç†çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯çº¯å‡€çš„CentOS7.2ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–è¿˜æœ‰ä¸€ä¸ªPeter Maå†™çš„&lt;a href=&#34;https://godliness.github.io/2017/03/29/%E5%9C%A8CentOS7%E4%B8%8A%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85Kubernetes/&#34;&gt;åœ¨CentOSä¸Šæ‰‹åŠ¨å®‰è£…kubernetesçš„æ–‡æ¡£&lt;/a&gt;å¯ä»¥å‚è€ƒã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è§’è‰²åˆ†é…&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢ä»¥åœ¨ä¸‰å°ä¸»æœºä¸Šå®‰è£…Kubernetesä¸ºä¾‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;172.20.0.113 master/node kube-apiserver kube-controller-manager kube-scheduler kubelet kube-proxy etcd flannel
172.20.0.114 node kubectl kube-proxy flannel
172.20.0.115 node kubectl kube-proxy flannel
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¬¬ä¸€å°ä¸»æœºæ—¢ä½œä¸ºmasterä¹Ÿä½œä¸ºnodeã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç³»ç»Ÿç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Centos 7.2.1511&lt;/li&gt;
&lt;li&gt;docker 1.12.6&lt;/li&gt;
&lt;li&gt;etcd 3.1.5&lt;/li&gt;
&lt;li&gt;kubernetes 1.6.0&lt;/li&gt;
&lt;li&gt;flannel 0.7.0-1&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h1&gt;

&lt;p&gt;ä¸‹é¢ç»™å‡ºä¸¤ç§å®‰è£…æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é…ç½®yumæºåï¼Œä½¿ç”¨yumå®‰è£…ï¼Œå¥½å¤„æ˜¯ç®€å•ï¼Œåå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œéœ€è¦googleæ›´æ–°yumæºæ‰èƒ½è·å¾—æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶ï¼Œè€Œæ‰€æœ‰è½¯ä»¶çš„ä¾èµ–åˆä¸èƒ½è‡ªå·±æŒ‡å®šï¼Œå°¤å…¶æ˜¯ä½ çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å¦‚æœä½çš„è¯ï¼Œä½¿ç”¨yumæºå®‰è£…çš„kubernetesçš„ç‰ˆæœ¬ä¹Ÿä¼šå—åˆ°é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ï¼Œå¥½å¤„æ˜¯å¯ä»¥å®‰è£…ä»»æ„ç‰ˆæœ¬çš„kubernetesï¼Œåå¤„æ˜¯é…ç½®æ¯”è¾ƒå¤æ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼å®‰è£…ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡çš„å¾ˆå¤šå®‰è£…æ­¥éª¤å’Œå‘½ä»¤æ˜¯å‚è€ƒçš„Kuberneteså®˜ç½‘&lt;a href=&#34;https://kubernetes.io/docs/getting-started-guides/centos/centos_manual_config/&#34;&gt;CentOS Manual Config&lt;/a&gt;æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç¬¬ä¸€ç§æ–¹å¼-centosç³»ç»Ÿä¸­ç›´æ¥ä½¿ç”¨yumå®‰è£…&#34;&gt;ç¬¬ä¸€ç§æ–¹å¼ï¼šCentOSç³»ç»Ÿä¸­ç›´æ¥ä½¿ç”¨yumå®‰è£…&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ç»™yumæºå¢åŠ ä¸€ä¸ªRepo&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[virt7-docker-common-release]
name=virt7-docker-common-release
baseurl=http://cbs.centos.org/repos/virt7-docker-common-release/x86_64/os/
gpgcheck=0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…dockerã€kubernetesã€etcdã€flannelä¸€æ­¥åˆ°ä½&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;yum -y install --enablerepo=virt7-docker-common-release kubernetes etcd flannel
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®‰è£…å¥½äº†ä¹‹åéœ€è¦ä¿®æ”¹ä¸€ç³»åˆ—é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªrepoåœ¨CentOS7.3ä¸‹æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œå› ä¸ºCentOSå®˜æ–¹æºçš„extrasä¸­å·²ç»åŒ…å«äº†Kubernetes1.5.2ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯CentOS7.3çš„è¯ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…Kubernetes1.5.2ï¼ˆTill March 30,2017ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯CentOS7.2çš„åŒ–ï¼Œè¿™ä¸ªæºå°±æœ‰ç”¨äº†ï¼Œä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…Kubernentes1.1ã€‚æˆ‘ä»¬ç°åœ¨è¦å®‰è£…ç›®å‰çš„æœ€æ–°ç‰ˆæœ¬Kubernetes1.6ï¼Œè€Œä½¿ç”¨çš„åˆæ˜¯CentOS7.2ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä½¿ç”¨yumå®‰è£…ï¼ˆå½“å‰yumæºæ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬çš„kuberentesæ˜¯1.5.2ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç¬¬äºŒç§æ–¹å¼-ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…&#34;&gt;ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…&lt;/h2&gt;

&lt;p&gt;è¿™ç§æ–¹å¼å®‰è£…çš„è¯ï¼Œéœ€è¦è‡ªå·±ä¸€ä¸ªä¸€ä¸ªç»„ä»¶çš„å®‰è£…ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…docker&#34;&gt;å®‰è£…Docker&lt;/h3&gt;

&lt;p&gt;yum localinstall ./docker-engine*&lt;/p&gt;

&lt;p&gt;å°†ä½¿ç”¨CentOSçš„&lt;strong&gt;extras&lt;/strong&gt; repoä¸‹è½½ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³é—­é˜²ç«å¢™å’Œselinux&#34;&gt;å…³é—­é˜²ç«å¢™å’ŒSELinux&lt;/h3&gt;

&lt;p&gt;è¿™æ˜¯å®˜ç½‘ä¸Šå»ºè®®çš„ï¼Œæˆ‘æ˜¯ç›´æ¥å°†iptables-serviceså’Œfirewlldå¸è½½æ‰äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;setenforce 0
systemctl disable iptables-services firewalld
systemctl stop iptables-services firewalld
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;å®‰è£…etcd&#34;&gt;å®‰è£…etcd&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;DOWNLOAD_URL=https://storage.googleapis.com/etcd  #etcdå­˜å‚¨åœ°å€
ETCD_VER=v3.1.5  #è®¾ç½®etcdç‰ˆæœ¬å·
wget ${DOWNLOAD_URL}/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz
tar xvf etcd-${ETCD_VER}-linux-amd64.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;éƒ¨ç½²æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å°†å¦‚ä¸‹å†…å®¹å†™å…¥æ–‡ä»¶ /etc/etcd/etcd.conf ä¸­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;# [member]
ETCD_NAME=default
ETCD_DATA_DIR=&amp;quot;/var/lib/etcd/default.etcd&amp;quot;
# ETCD_WAL_DIR=&amp;quot;&amp;quot;
# ETCD_SNAPSHOT_COUNT=&amp;quot;10000&amp;quot;
# ETCD_HEARTBEAT_INTERVAL=&amp;quot;100&amp;quot;
# ETCD_ELECTION_TIMEOUT=&amp;quot;1000&amp;quot;
# ETCD_LISTEN_PEER_URLS=&amp;quot;http://localhost:2380&amp;quot;
ETCD_LISTEN_CLIENT_URLS=&amp;quot;http://0.0.0.0:2379&amp;quot;
# ETCD_MAX_SNAPSHOTS=&amp;quot;5&amp;quot;
# ETCD_MAX_WALS=&amp;quot;5&amp;quot;
# ETCD_CORS=&amp;quot;&amp;quot;
#
# [cluster]
# ETCD_INITIAL_ADVERTISE_PEER_URLS=&amp;quot;http://localhost:2380&amp;quot;
# if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. &amp;quot;test=http://...&amp;quot;
# ETCD_INITIAL_CLUSTER=&amp;quot;default=http://localhost:2380&amp;quot;
# ETCD_INITIAL_CLUSTER_STATE=&amp;quot;new&amp;quot;
# ETCD_INITIAL_CLUSTER_TOKEN=&amp;quot;etcd-cluster&amp;quot;
ETCD_ADVERTISE_CLIENT_URLS=&amp;quot;http://0.0.0.0:2379&amp;quot;
# ETCD_DISCOVERY=&amp;quot;&amp;quot;
# ETCD_DISCOVERY_SRV=&amp;quot;&amp;quot;
# ETCD_DISCOVERY_FALLBACK=&amp;quot;proxy&amp;quot;
# ETCD_DISCOVERY_PROXY=&amp;quot;&amp;quot;
#
# [proxy]
# ETCD_PROXY=&amp;quot;off&amp;quot;
# ETCD_PROXY_FAILURE_WAIT=&amp;quot;5000&amp;quot;
# ETCD_PROXY_REFRESH_INTERVAL=&amp;quot;30000&amp;quot;
# ETCD_PROXY_DIAL_TIMEOUT=&amp;quot;1000&amp;quot;
# ETCD_PROXY_WRITE_TIMEOUT=&amp;quot;5000&amp;quot;
# ETCD_PROXY_READ_TIMEOUT=&amp;quot;0&amp;quot;
#
# [security]
# ETCD_CERT_FILE=&amp;quot;&amp;quot;
# ETCD_KEY_FILE=&amp;quot;&amp;quot;
# ETCD_CLIENT_CERT_AUTH=&amp;quot;false&amp;quot;
# ETCD_TRUSTED_CA_FILE=&amp;quot;&amp;quot;
# ETCD_PEER_CERT_FILE=&amp;quot;&amp;quot;
# ETCD_PEER_KEY_FILE=&amp;quot;&amp;quot;
# ETCD_PEER_CLIENT_CERT_AUTH=&amp;quot;false&amp;quot;
# ETCD_PEER_TRUSTED_CA_FILE=&amp;quot;&amp;quot;
# [logging]
# ETCD_DEBUG=&amp;quot;false&amp;quot;
# examples for -log-package-levels etcdserver=WARNING,security=DEBUG
# ETCD_LOG_PACKAGE_LEVELS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°† etcd, etcdctlæ”¾å…¥ /usr/bin/ä¸‹ï¼Œå¹¶å°†å¦‚ä¸‹å†…å®¹å†™è¿›/usr/lib/systemd/system/etcd.serviceæ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
WorkingDirectory=/var/lib/etcd/
EnvironmentFile=-/etc/etcd/etcd.conf
User=etcd
# set GOMAXPROCS to number of processors
ExecStart=/bin/bash -c &amp;quot;GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\&amp;quot;${ETCD_NAME}\&amp;quot; --data-dir=\&amp;quot;${ETCD_DATA_DIR}\&amp;quot; --listen-client-urls=\&amp;quot;${ETCD_LISTEN_CLIENT_URLS}\&amp;quot;&amp;quot;
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å¯åŠ¨å¹¶æ ¡éªŒ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;systemctl start etcd
systemctl enable etcd
systemctl status etcd
etcdctl ls
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é›†ç¾¤&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è‹¥è¦éƒ¨ç½²å¤šèŠ‚ç‚¹é›†ç¾¤ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªè¦æ›´æ”¹etcd.confæ–‡ä»¶ä»¥åŠetcd.serviceæ·»åŠ ç›¸åº”é…ç½®å³å¯&lt;/p&gt;

&lt;p&gt;å¯ä»¥å‚è€ƒé“¾æ¥ï¼š&lt;a href=&#34;https://github.com/coreos/etcd/blob/master/Documentation/op-guide/clustering.md&#34;&gt;https://github.com/coreos/etcd/blob/master/Documentation/op-guide/clustering.md&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…flannel&#34;&gt;å®‰è£…flannel&lt;/h3&gt;

&lt;p&gt;å¯ä»¥ç›´æ¥ä½¿ç”¨&lt;code&gt;yum install flannel&lt;/code&gt;å®‰è£…ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºç½‘ç»œè¿™å—çš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å°†åœ¨åç»­æ–‡ç« ä¸­è¯´æ˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…kubernetes&#34;&gt;å®‰è£…Kubernetes&lt;/h3&gt;

&lt;p&gt;æ ¹æ®ã€ŠKubernetesæƒå¨æŒ‡å—ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ä¸­çš„ä»‹ç»ï¼Œç›´æ¥ä½¿ç”¨GitHubä¸Šçš„releaseé‡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£…ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;wget https://github.com/kubernetes/kubernetes/releases/download/v1.6.0/kubernetes.tar.gz
tar kubernetes.tar.gz
cd kubernetes
./cluster/get-kube-binaries.sh
cd server
tar xvf kubernetes-server-linux-amd64.tar.gz
rm -f *_tag *.tar
chmod 755 *
mv * /usr/bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®é™…ä¸‹è½½kubernetes-server-linux-amd64.tar.gz from &lt;a href=&#34;https://storage.googleapis.com/kubernetes-release/release/v1.6.0&#34;&gt;https://storage.googleapis.com/kubernetes-release/release/v1.6.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è§£å‹å®Œåè·å¾—çš„äºŒè¿›åˆ¶æ–‡ä»¶æœ‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cloud-controller-manager
hyperkube
kubeadm
kube-aggregator
kube-apiserver
kube-controller-manager
kubectl
kubefed
kubelet
kube-proxy
kube-scheduler
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;cluster/juju/layers/kubernetes-master/templates&lt;/code&gt;ç›®å½•ä¸‹æœ‰serviceå’Œç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶çš„æ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿æœ¬æ¥æ˜¯ä¸ºäº†ä½¿ç”¨&lt;a href=&#34;https://jujucharms.com/&#34;&gt;juju&lt;/a&gt;å®‰è£…å†™çš„ã€‚&lt;/p&gt;

&lt;h4 id=&#34;masterèŠ‚ç‚¹çš„é…ç½®&#34;&gt;MasterèŠ‚ç‚¹çš„é…ç½®&lt;/h4&gt;

&lt;p&gt;MasterèŠ‚ç‚¹éœ€è¦é…ç½®çš„kubernetesçš„ç»„ä»¶æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;kube-apiserver&lt;/li&gt;
&lt;li&gt;kube-controller-manager&lt;/li&gt;
&lt;li&gt;kube-scheduler&lt;/li&gt;
&lt;li&gt;kube-proxy&lt;/li&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-apiserver&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-apiserver.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;a href=&#34;http://blog.csdn.net/yuesichiu/article/details/51485147&#34;&gt;CentOSä¸­çš„serviceé…ç½®æ–‡ä»¶å‚è€ƒ&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes API Service
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=network.target
After=etcd.service

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/apiserver
ExecStart=/usr/bin/kube-apiserver \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_ETCD_SERVERS \
	    $KUBE_API_ADDRESS \
	    $KUBE_API_PORT \
	    $KUBELET_PORT \
	    $KUBE_ALLOW_PRIV \
	    $KUBE_SERVICE_ADDRESSES \
	    $KUBE_ADMISSION_CONTROL \
	    $KUBE_API_ARGS
Restart=on-failure
Type=notify
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ›å»ºkubernetesçš„é…ç½®æ–‡ä»¶ç›®å½•&lt;code&gt;/etc/kubernetes&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ·»åŠ &lt;code&gt;config&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes system config
#
# The following values are used to configure various aspects of all
# kubernetes services, including
#
#   kube-apiserver.service
#   kube-controller-manager.service
#   kube-scheduler.service
#   kubelet.service
#   kube-proxy.service
# logging to stderr means we get it in the systemd journal
KUBE_LOGTOSTDERR=&amp;quot;--logtostderr=true&amp;quot;

# journal message level, 0 is debug
KUBE_LOG_LEVEL=&amp;quot;--v=0&amp;quot;

# Should this cluster be allowed to run privileged docker containers
KUBE_ALLOW_PRIV=&amp;quot;--allow-privileged=false&amp;quot;

# How the controller-manager, scheduler, and proxy find the apiserver
KUBE_MASTER=&amp;quot;--master=http://sz-pg-oam-docker-test-001.tendcloud.com:8080&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ·»åŠ &lt;code&gt;apiserver&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
## kubernetes system config
##
## The following values are used to configure the kube-apiserver
##
#
## The address on the local server to listen to.
KUBE_API_ADDRESS=&amp;quot;--address=sz-pg-oam-docker-test-001.tendcloud.com&amp;quot;
#
## The port on the local server to listen on.
KUBE_API_PORT=&amp;quot;--port=8080&amp;quot;
#
## Port minions listen on
KUBELET_PORT=&amp;quot;--kubelet-port=10250&amp;quot;
#
## Comma separated list of nodes in the etcd cluster
KUBE_ETCD_SERVERS=&amp;quot;--etcd-servers=http://127.0.0.1:2379&amp;quot;
#
## Address range to use for services
KUBE_SERVICE_ADDREKUBELET_POD_INFRA_CONTAINERSSES=&amp;quot;--service-cluster-ip-range=10.254.0.0/16&amp;quot;
#
## default admission control policies
KUBE_ADMISSION_CONTROL=&amp;quot;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota&amp;quot;
#
## Add your own!
#KUBE_API_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-controller-manager&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-controller.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Ini&#34;&gt;Description=Kubernetes Controller Manager
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/controller-manager
ExecStart=/usr/bin/kube-controller-manager \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_CONTROLLER_MANAGER_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;controller-manager&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# The following values are used to configure the kubernetes controller-manager

# defaults from config and apiserver should be adequate

# Add your own!
KUBE_CONTROLLER_MANAGER_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-scheduler&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-scheduler.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Scheduler Plugin
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/scheduler
ExecStart=/usr/bin/kube-scheduler \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_SCHEDULER_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;scheduler&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes scheduler config

# default config should be adequate

# Add your own!
KUBE_SCHEDULER_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kube-proxy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kube-proxy.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Kube-Proxy Server
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=network.target

[Service]
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/proxy
ExecStart=/usr/bin/kube-proxy \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBE_MASTER \
	    $KUBE_PROXY_ARGS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;proxy&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
# kubernetes proxy config

# default config should be adequate

# Add your own!
KUBE_PROXY_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kubelet&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;/usr/lib/systemd/system/kubelet.service&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[Unit]
Description=Kubernetes Kubelet Server
Documentation=https://github.com/GoogleCloudPlatform/kubernetes
After=docker.service
Requires=docker.service

[Service]
WorkingDirectory=/var/lib/kubelet
EnvironmentFile=-/etc/kubernetes/config
EnvironmentFile=-/etc/kubernetes/kubelet
ExecStart=/usr/bin/kubelet \
	    $KUBE_LOGTOSTDERR \
	    $KUBE_LOG_LEVEL \
	    $KUBELET_API_SERVER \
	    $KUBELET_ADDRESS \
	    $KUBELET_PORT \
	    $KUBELET_HOSTNAME \
	    $KUBE_ALLOW_PRIV \
	    $KUBELET_POD_INFRA_CONTAINER \
	    $KUBELET_ARGS
Restart=on-failure

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/kubernetes&lt;/code&gt;ç›®å½•ä¸‹æ·»åŠ &lt;code&gt;kubelet&lt;/code&gt;é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;###
## kubernetes kubelet (minion) config
#
## The address for the info server to serve on (set to 0.0.0.0 or &amp;quot;&amp;quot; for all interfaces)
KUBELET_ADDRESS=&amp;quot;--address=0.0.0.0&amp;quot;
#
## The port for the info server to serve on
KUBELET_PORT=&amp;quot;--port=10250&amp;quot;
#
## You may leave this blank to use the actual hostname
KUBELET_HOSTNAME=&amp;quot;--hostname-override=sz-pg-oam-docker-test-001.tendcloud.com&amp;quot;
#
## location of the api-server
KUBELET_API_SERVER=&amp;quot;--api-servers=http://sz-pg-oam-docker-test-001.tendcloud.com:8080&amp;quot;
#
## pod infrastructure container
KUBELET_POD_INFRA_CONTAINER=&amp;quot;--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest&amp;quot;
#
## Add your own!
KUBELET_ARGS=&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;âš ï¸&lt;code&gt;KUBELET_POD_INFRA_CONTAINER&lt;/code&gt;åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®æˆè‡ªå·±ç§æœ‰ä»“åº“é‡Œçš„imageã€‚&lt;/p&gt;

&lt;h4 id=&#34;nodeèŠ‚ç‚¹é…ç½®&#34;&gt;NodeèŠ‚ç‚¹é…ç½®&lt;/h4&gt;

&lt;p&gt;NodeèŠ‚ç‚¹éœ€è¦é…ç½®ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;kube-proxy&lt;/li&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;kube-proxy&lt;/code&gt;çš„é…ç½®ä¸masterèŠ‚ç‚¹çš„kube-proxyé…ç½®ç›¸åŒã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;kubectl&lt;/code&gt;çš„é…ç½®éœ€è¦ä¿®æ”¹&lt;code&gt;KUBELET_HOST&lt;/code&gt;ä¸ºæœ¬æœºçš„hostnameï¼Œå…¶å®ƒé…ç½®ç›¸åŒã€‚&lt;/p&gt;

&lt;h1 id=&#34;å¯åŠ¨&#34;&gt;å¯åŠ¨&lt;/h1&gt;

&lt;p&gt;åœ¨&lt;strong&gt;Master&lt;/strong&gt;èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;for SERVICES in etcd kube-apiserver kube-controller-manager kube-scheduler kube-proxy kubelet flanneld; do
    systemctl restart $SERVICES
    systemctl enable $SERVICES
    systemctl status $SERVICES
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨å¦å¤–ä¸¤å°NodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;for SERVICES in kube-proxy kubelet flanneld; do
    systemctl restart $SERVICES
    systemctl enable $SERVICES
    systemctl status $SERVICES
done
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;éªŒè¯&#34;&gt;éªŒè¯&lt;/h1&gt;

&lt;p&gt;åœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$kubectl get all
NAME             CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
svc/kubernetes   10.254.0.1   &amp;lt;none&amp;gt;        443/TCP   1h
$kubectl get nodes
NAME                                      STATUS    AGE       VERSION
sz-pg-oam-docker-test-001.tendcloud.com   Ready     7m        v1.6.0
sz-pg-oam-docker-test-002.tendcloud.com   Ready     4m        v1.6.0
sz-pg-oam-docker-test-003.tendcloud.com   Ready     10s       v1.6.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å•¦ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åè®°&#34;&gt;åè®°&lt;/h3&gt;

&lt;p&gt;å¦å¤–Kuberntesè¿˜æä¾›ç¬¬ä¸‰ä¸­å®‰è£…æ–¹å¼ï¼Œè¯·çœ‹Tony Baiå†™çš„&lt;a href=&#34;http://tonybai.com/2017/01/24/explore-kubernetes-cluster-installed-by-kubeadm/&#34;&gt;ä½¿ç”¨Kubeadmæ–¹å¼å®‰è£…Kubernetesé›†ç¾¤çš„æ¢ç´¢&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ—¶éš”ä¸€å¹´é‡æ–°æ¡èµ·kubernetesï¼Œæ­£å¥½ç°åœ¨KubeConæ­£åœ¨å¾·å›½æŸæ—ä¸¾è¡Œï¼ŒIDC å‘å¸ƒçš„æŠ¥å‘Šæ˜¾ç¤ºï¼Œ2017å¹´å¤§æ•°æ®å…¨çƒå¸‚åœºè§„æ¨¡å°†è¾¾324äº¿ç¾å…ƒï¼Œå¹´å¤åˆå¢é•¿ç‡ä¸º27%ï¼Œå…¶ä¸­å¸‚åœºå¢é•¿æœ€å¿«çš„é¢†åŸŸæ˜¯æ•°æ®å­˜å‚¨é¢†åŸŸï¼ˆ53.4%ï¼‰&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ã€Šäº‘è®¡ç®—æŠ€æœ¯æ¶æ„ä¸å®è·µã€‹è¯»åæ„Ÿ</title>
      <link>http://rootsongjc.github.io/blogs/cloud-computing-architecture-practice/</link>
      <pubDate>Wed, 01 Mar 2017 18:29:36 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/cloud-computing-architecture-practice/</guid>
      <description>&lt;p&gt;æœ€è¿‘å‹äººæ¨èäº†ä¸€æœ¬ä¹¦ï¼Œæ˜¯åä¸ºçš„å·¥ç¨‹å¸ˆå†™çš„ã€Šäº‘è®¡ç®—æ¶æ„ä¸å®è·µç¬¬äºŒç‰ˆã€‹ï¼Œæ­£å¥½åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™æœ¬ä¹¦çš„pdfï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œ&lt;a href=&#34;http://olz1di9xf.bkt.clouddn.com/docs/%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5%E7%AC%AC2%E7%89%88.pdf&#34;&gt;ç‚¹è¿™é‡Œä¸‹è½½&lt;/a&gt;ï¼Œä¹¦æ˜¯æ–‡å­—ç‰ˆçš„ï¼Œå¤§å°13.04MBï¼Œé™¤äº†ç« èŠ‚é¡ºåºæœ‰ç‚¹é—®é¢˜å¤–æ²¡æœ‰å…¶ä»–ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;åç»­æˆ‘å°†ä¼šé™†ç»­åˆ†äº«è¿™æœ¬ä¹¦çš„è¯»åæ„Ÿã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>