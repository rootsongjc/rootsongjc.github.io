<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>Vault - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="宋净超的博客">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.145.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/tags/vault/" />
  <meta property="og:title" content="Vault | Jimmy Song" />
  <meta property="twitter:title" content="Vault | Jimmy Song" />

  
  <meta property="og:description" content="宋净超的博客" />
  <meta property="twitter:description" content="宋净超的博客" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">博客</a>
              
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                资料
              </a>
              <div class="dropdown-menu">
                
                <a class="dropdown-item" href="/book">书籍</a>
                
                <a class="dropdown-item" href="/slide">幻灯片</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">公告</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">联系</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">社区</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">视频 <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>搜索</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>站内搜索</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="关闭"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="请输入搜索词" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="请输入搜索词">
        
        <div class="mt-4">
          <span>搜索类型: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">所有</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">原创</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">译文</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">资料</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">公告</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    Vault
                </p>
                <p class="page-description">
                    
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/">[译] 如何使用 Hashicorp Vault 作为一种更安全的方式来存储 Istio 证书</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2022/12/19</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://tetrate.io/blog/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/" target="_blank" rel="noopener">原文</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('如何使用 Hashicorp Vault 作为一种更安全的方式来存储 Istio 证书', '本文将指导你使用 Vault 存储 Istio 的证书。', '\n在本文中，我们将探讨如何使用 Hashicorp Vault 作为一种比使用 Kubernetes [Secret](https:\/\/kubernetes.io\/docs\/concepts\/configuration\/secret) 更安全的方式来存储 Istio 证书。默认情况下，Secret 使用 base64 编码存储在 *etcd* 中。在安全策略严格的环境中，这可能是不可接受的，因此需要额外的措施来保护它们。一种此类解决方案涉及将机密存储在外部机密存储提供程序中，例如 [HashiCorp Vault](https:\/\/www.vaultproject.io\/)。\n\nVault 可以托管在 Kubernetes 集群内部和外部。在本案例中，我们将探索使用托管在 Kubernetes 外部的 Vault，以便它可以同时为多个集群提供秘密。该设置也非常适合探索 Istio 的[多集群功能](https:\/\/istio.io\/latest\/docs\/setup\/install\/multicluster)，它需要一个共享的信任域。\n\n利用 \u0060vault-agent-init\u0060 容器，我们可以将证书和私钥材料注入实际的 Istio 控制平面 Pod，以便它们使用外部 CA 证书进行引导。这避免了依赖 Secret 来引导 Istio 控制平面。该技术也完全适用于入口和出口证书。\n\n有关如何在 Istio 中使用和管理证书的更多信息，请参见官方文档：\n\n- [身份和证书管理](https:\/\/istio.io\/latest\/zh\/docs\/concepts\/security\/#pki)\n- [插入 CA 证书](https:\/\/istio.io\/latest\/zh\/docs\/tasks\/security\/cert-management\/plugin-ca-cert)\n- [使用 Kubernetes CSR 的自定义 CA 集成](https:\/\/istio.io\/latest\/zh\/docs\/tasks\/security\/cert-management\/custom-ca-k8s)\n\n有关基于实际生产经验的最佳实践，另请查看以下 [Tetrate](https:\/\/tetrate.io\/) 的博客文章：\n\n- [在 Istio 中构建证书信任链：将现有 PKI 作为信任根](\/trans\/istio-trust\/)\n- [在生产中大规模自动化 Istio CA 轮换](\/trans\/automate-istio-ca-rotation-in-production-at-scale)\n\n这篇博文附带的代码可以在以下存储库中找到：\n\nhttps:\/\/github.com\/tetratelabs\/istio-vault-ext-certs\n\n## **Istiod 证书处理**\n\n尽管上述博文中解释了一些决策逻辑，但也值得参考[源代码](https:\/\/github.com\/istio\/istio\/blob\/master\/pilot\/pkg\/bootstrap\/istio_ca.go)以查找一些未记录的行为。\n\n在 Istio 的源码 \u0060istio\/pilot\/pkg\/bootstrap\/istio_ca.go\u0060 文件中，你将看到：为了向后兼容，Istio 保留了对用于自签名证书 \u0060cacerts\u0060 Secret 的支持。它安装在相同的位置，如果发现了就会被使用——创建秘密就足够了，不需要额外的选项。在旧安装程序中，\u0060LocalCertDir\u0060 被硬编码到 \u0060\/etc\/cacerts\u0060 并使用 \u0060cacerts\u0060  Secret 安装。已删除对签署其他根 CA 的支持——太危险，没有明确的用例。\n\n默认配置，用于向后兼容 Citadel：\n\n- 如果 \u0060istio-system\u0060 中存在 \u0060cacerts\u0060 秘密，将被挂载。它可能包含一个可选的 \u0060root-cert.pem\u0060，\n带有额外的根和可选的 \u0060{ca-key, ca-cert, cert-chain}.pem\u0060 由用户提供的根 CA。\n- 如果未找到用户提供的根 CA，则使用 \u0060istio-ca-secret\u0060 Secret，以及 \u0060ca-cert.pem\u0060 和 \u0060ca-key.pem\u0060 文件。\n- 如果两者均未找到，将创建 \u0060istio-ca-secret\u0060。\n- 带有 \u0060caTLSRootCert\u0060 文件的 \u0060istio-security\u0060 ConfigMap 将用于根证书，并在需要时创建。该 ConfigMap 由节点代理使用，不再可能在 sds-agent 中使用，但我们仍保留它以向后兼容。将与 node-agent 一起删除。sds-agent 使用 K8S root 直接调用 \u0060NewCitadelClient\u0060 。\n\n为了指示 Istio 从其他地方获取证书，而不是标准 Kubernetes Secret，我们将利用 *istio-pilot*（又名 istiod 或 Istio 控制平面）的环境变量（[见此文档](https:\/\/istio.io\/latest\/docs\/reference\/commands\/pilot-discovery)），从 Kubernetes Pod 中的另一个位置获取证书。这是必需的，因为 \u0060vault-agent-init\u0060 注入容器将创建一个新的挂载卷 \u0060\/vault\/secrets\u0060 ，以放置从外部 Vault 服务器拉出的证书和私钥。\n\n| 变量名称      | 类型   | 默认值         | 描述                         |\n| ------------- | ------ | -------------- | ---------------------------- |\n| \u0060ROOT_CA_DIR\u0060 | 字符串 | \u0060\/etc\/cacerts\u0060 | 本地或安装的 CA 根目录的位置 |\n\n## Pod 内的 \u0060vault-agent-init\u0060 容器注解\n\n我们将利用 Vault 注入器注解来指示 Sidecar 提取哪些数据以及在这样做时使用什么 Vault 角色。我们还确保容器在我们实际的主容器之前运行，因此后者可以获取证书和密钥材料以正确引导自身。[此处](https:\/\/developer.hashicorp.com\/vault\/docs\/platform\/k8s\/injector\/annotations)列举并记录了 Vault 注解。我们将在本教程中使用的相关注释如下：\n\n| **注解**                                     | **默认值** | **描述**                                                     |\n| -------------------------------------------- | ---------- | ------------------------------------------------------------ |\n| \u0060vault.hashicorp.com\/agent-inject\u0060           | false      | 配置是否为 Pod 显式启用或禁用注入。这应该设置为 true 或 false。 |\n| \u0060vault.hashicorp.com\/agent-init-first\u0060       | false      | 如果为 true，则将 Pod 配置为首先运行 Vault Agent init 容器（如果为 false，则最后运行）。当其他 init 容器需要预填充的秘密时，这很有用。这应该设置为 true 或 false。 |\n| \u0060vault.hashicorp.com\/role\u0060                   | –          | 配置 Vault 代理自动验证方法使用的 Vault 角色。\u0060vault.hashicorp.com\/agent-configmap\u0060 未设置时需要。 |\n| \u0060vault.hashicorp.com\/auth-path\u0060              | –          | 配置 Kubernetes 身份验证方法的身份验证路径。默认为 \u0060auth\/kubernetes\u0060。 |\n| \u0060vault.hashicorp.com\/agent-inject-secret-\u0060   | –          | 配置 Vault 代理以从容器所需的 Vault 中检索秘密。Secret 的名称是 \u0060vault.hashicorp.com\/agent-inject-secret-\u0060 之后的任意唯一字符串，例如 \u0060vault.hashicorp.com\/agent-inject-secret-foobar\u0060 该值是 secret 所在的 Vault 中的路径。 |\n| \u0060vault.hashicorp.com\/agent-inject-template-\u0060 | –          | 配置 Vault Agent 应该用于呈现秘密的模板。模板的名称是 v\u0060ault.hashicorp.com\/agent-inject-template-\u0060 之后的任何唯一字符串，例如 \u0060vault.hashicorp.com\/agent-inject-template-foobar\u0060。这应该映射到 \u0060vault.hashicorp.com\/agent-inject-secret-\u0060 中提供的相同唯一值。如果未提供，则使用默认的通用模板。 |\n\n## Vault 服务器注意事项 {#vault-server-considerations}\n\nVault 支持多种客户端验证自己的方法。我们将利用 [Kubernetes 身份验证后端](https:\/\/developer.hashicorp.com\/vault\/docs\/auth\/kubernetes)，这意味着我们将利用 Kubernetes ServiceAccount JWT 令牌验证。请注意，自 Kubernetes 1.24 以来，不再自动生成 ServiceAccount 令牌。您仍然可以手动创建这些 API 令牌，如[此处所述](https:\/\/kubernetes.io\/docs\/tasks\/configure-pod-container\/configure-service-account\/#manually-create-an-api-token-for-a-serviceaccount)。\n\n至于证书和私钥材料的存储，我们有两种选择：\n\n- [PKI 秘密引擎](https:\/\/developer.hashicorp.com\/vault\/docs\/secrets\/pki)\n- [KV 秘密引擎](https:\/\/developer.hashicorp.com\/vault\/docs\/secrets\/kv)\n\n因为 PKI 秘密引擎不提供精简的 API 来检索我们需要的证书和私钥，并且因为 PKI 秘密引擎会为每次调用（例如，每次 *istiod* 重启）生成一个新的中间证书，我们将使用通用的 KV 秘密引擎，将我们需要的所有值存储在一个简单的键值数据结构中。我们假设中间证书的更新是通过一些服务门户或 CI\/CD 过程在外部处理的，这些过程也将更新的中间证书存储在 Vault 服务器中。\n\nIstio 的控制平面 Pod 需要以下文件才能在 CA 中正确引导其构建：\n\n| Key            | 值（PEM 编码） | 细节                                    |\n| -------------- | -------------- | --------------------------------------- |\n| ca-key.pem     | 私钥           | 中间证书的私钥，用作 *istiod* 的根 CA。 |\n| ca-cert.pem    | CA 公共证书    | 中间证书，用作 *istiod* 的根 CA。       |\n| root-cert.pem  | CA 根证书      | 我们新生成的中间证书的信任根。          |\n| cert-chain.pem | 完整的证书链   | 中间证书在顶部，根证书在底部。          |\n\n## 设置\n\n如果要遵循本地设置，则安装软件的先决条件包括：\n\n- *kubectl* 与 Kubernetes 集群交互（[下载](https:\/\/kubernetes.io\/docs\/tasks\/tools\/#kubectl)）\n- *helm* 安装 Vault injector 和 Istio chart（[下载](https:\/\/helm.sh\/docs\/intro\/install)）\n- 用于配置 Vault 服务器的 *vault cli* 工具（[下载](https:\/\/developer.hashicorp.com\/vault\/tutorials\/getting-started\/getting-started-install#install-vault)）\n\n如果您想要本地演示环境，请按照[此处](https:\/\/github.com\/tetratelabs\/istio-vault-ext-certs\/blob\/main\/local-setup.md)的说明进行操作，该说明使用 \u0060docker-compose\u0060 启动一个 Vault 服务器和两个独立的 k3s 集群。如果您使用自己的 Kubernetes 集群和外部托管的 Vault 实例，请跳至下一节。\n\n- *docker-compose* 启动本地环境（[下载](https:\/\/github.com\/docker\/compose\/releases)）\n\n为了取得进展，我们希望根据您的环境设置以下 shell 变量。\n\n\u0060\u0060\u0060bash\nexport VAULT_SERVER=\nexport K8S_API_SERVER_1=\nexport K8S_API_SERVER_2=\n\u0060\u0060\u0060\n\n## **Vault Kubernetes 身份验证后端**\n\n正如在有关 [Vault 服务器注意事项](#vault-server-considerations)的介绍部分中提到的，我们将使用 [Kubernetes 身份验证后端](https:\/\/developer.hashicorp.com\/vault\/docs\/auth\/kubernetes)。由于 *istiod* 将从 Vault 服务器获取证书和私钥材料，让我们从在两个集群中创建相应的服务账户开始。\n\n\u0060\u0060\u0060bash\nkubectl --kubeconfig kubecfg1.yml create ns istio-system\nkubectl --kubeconfig kubecfg2.yml create ns istio-system\nkubectl --kubeconfig kubecfg1.yml apply -f istio-sa.yml\nkubectl --kubeconfig kubecfg2.yml apply -f istio-sa.yml\n\u0060\u0060\u0060\n\nServiceAccount、Secret 和 ClusterRoleBinding 如下：\n\n\u0060\u0060\u0060yaml\n# istio-sa.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: istiod\n  namespace: istio-system\n  labels: # added for istio helm installation\n    app: istiod\n    app.kubernetes.io\/managed-by: Helm\n    release: istio-istiod\n  annotations: # added for istio helm installation\n    meta.helm.sh\/release-name: istio-istiod\n    meta.helm.sh\/release-namespace: istio-system\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: istiod\n  namespace: istio-system\n  annotations:\n    kubernetes.io\/service-account.name: istiod\ntype: kubernetes.io\/service-account-token\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: role-tokenreview-binding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n  - kind: ServiceAccount\n    name: istiod\n    namespace: istio-system\n\u0060\u0060\u0060\n\n\u003e 注意：*我们在 istiod ServiceAccount 上添加了 Helm 标签和注解，以免与稍后的 Istio Helm 部署发生冲突。*\n\n在两个集群中创建 ServiceAccount 后，让我们将它们的 Secret 令牌和 ca.cert 值存储在 output 文件夹中：\n\n\u0060\u0060\u0060bash\nmkdir -p .\/output\nkubectl --kubeconfig kubecfg1.yml get secret -n istio-system istiod -o go-template=\u0022{{ .data.token }}\u0022 | base64 --decode \u003e output\/istiod1.jwt\nkubectl --kubeconfig kubecfg1.yml config view --raw --minify --flatten -o jsonpath=\u0022{.clusters[].cluster.certificate-authority-data}\u0022 | base64 --decode \u003e output\/k8sapi-cert1.pem\nkubectl --kubeconfig kubecfg2.yml get secret -n istio-system istiod -o go-template=\u0022{{ .data.token }}\u0022 | base64 --decode \u003e output\/istiod2.jwt\nkubectl --kubeconfig kubecfg2.yml config view --raw --minify --flatten -o jsonpath=\u0022{.clusters[].cluster.certificate-authority-data}\u0022 | base64 --decode \u003e output\/k8sapi-cert2.pem\n\u0060\u0060\u0060\n\n关于 Kubernetes API 证书和 istiod ServiceAccount JWT 令牌的详细内容的更多信息可以在[这里](https:\/\/github.com\/tetratelabs\/istio-vault-ext-certs\/blob\/main\/output)找到，在这里我们也更深入地描述了 Vault 的交互过程，即通过 REST API 调用来验证和获取秘密。在调试权限拒绝的问题时，这些可以派上用场。\n\n让我们根据刚刚检索到的 Kubernetes CA 证书和 JWT 令牌创建必要的 Vault 身份验证配置：\n\n\u0060\u0060\u0060bash\nexport VAULT_ADDR=http:\/\/localhost:8200\nvault login root\nvault auth enable --path=kubernetes-cluster1 kubernetes\nvault auth enable --path=kubernetes-cluster2 kubernetes\nvault write auth\/kubernetes-cluster1\/config \\\n  kubernetes_host=\u0022$K8S_API_SERVER_1\u0022 \\\n  kubernetes_ca_cert=@output\/k8sapi-cert1.pem \\\n  token_reviewer_jwt=\u0060cat output\/istiod1.jwt\u0060 \\\n  disable_local_ca_jwt=\u0022true\u0022\nvault write auth\/kubernetes-cluster2\/config \\\n  kubernetes_host=\u0022$K8S_API_SERVER_2\u0022 \\\n  kubernetes_ca_cert=@output\/k8sapi-cert2.pem \\\n  token_reviewer_jwt=\u0060cat output\/istiod2.jwt\u0060 \\\n  disable_local_ca_jwt=\u0022true\u0022\n\u0060\u0060\u0060\n\n\u003e 注意：如果您使用的是 *docker-compose* 提供的环境，则 \u0060VAULT_ADDR\u0060 设置为 localhost。\n\n## *Vault kv* Secret 中的 Istio 证书和私钥\n\n接下来我们将创建一个新的自签名根证书并为我们的两个集群生成中间证书。我们将在[这里](https:\/\/github.com\/istio\/istio\/tree\/master\/tools\/certs)使用上游 Istio 提供的辅助 *Makefile* 脚本：\n\n\u0060\u0060\u0060bash\ncd certs\nmake -f ..\/certs-gen\/Makefile.selfsigned.mk root-ca\nmake -f ..\/certs-gen\/Makefile.selfsigned.mk istiod-cluster1-cacerts\nmake -f ..\/certs-gen\/Makefile.selfsigned.mk istiod-cluster2-cacerts\ncd ..\n\u0060\u0060\u0060\n\n有关实际内容和正在设置的 X509v3 扩展的更多详细信息，请参见[此处](https:\/\/github.com\/tetratelabs\/istio-vault-ext-certs\/blob\/main\/certs)。您可以通过[此处](https:\/\/github.com\/tetratelabs\/istio-vault-ext-certs\/blob\/main\/certs-gen)的 *Makefile*文档和相应的 *Makefile* 覆盖值微调证书。\n\n让我们将生成的证书和私钥添加到 Vault *kv* secret 中：\n\n\u0060\u0060\u0060bash\nexport VAULT_ADDR=http:\/\/localhost:8200\nvault login root\nvault secrets enable -path=kubernetes-cluster1-secrets kv\nvault secrets enable -path=kubernetes-cluster2-secrets kv\nvault kv put kubernetes-cluster1-secrets\/istiod-service\/certs \\\n  ca_key=@certs\/istiod-cluster1\/ca-key.pem \\\n  ca_cert=@certs\/istiod-cluster1\/ca-cert.pem \\\n  cert_chain=@certs\/istiod-cluster1\/cert-chain.pem \\\n  root_cert=@certs\/istiod-cluster1\/root-cert.pem\nvault kv put kubernetes-cluster2-secrets\/istiod-service\/certs \\\n  ca_key=@certs\/istiod-cluster2\/ca-key.pem \\\n  ca_cert=@certs\/istiod-cluster2\/ca-cert.pem \\\n  cert_chain=@certs\/istiod-cluster2\/cert-chain.pem \\\n  root_cert=@certs\/istiod-cluster2\/root-cert.pem\n\u0060\u0060\u0060\n\n通过限制对每个集群的这些证书和私钥的访问，绑定到基于 Kubernetes *istiod* ServiceAccount 的身份验证后端：\n\n\u0060\u0060\u0060bash\necho \u0027path \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022 {\n  capabilities = [\u0022read\u0022]\n}\u0027 | vault policy write istiod-certs-cluster1 -\necho \u0027path \u0022kubernetes-cluster2-secrets\/istiod-service\/certs\u0022 {\n  capabilities = [\u0022read\u0022]\n}\u0027 | vault policy write istiod-certs-cluster2 -\nvault write auth\/kubernetes-cluster1\/role\/istiod \\\n  bound_service_account_names=istiod \\\n  bound_service_account_namespaces=istio-system \\\n  policies=istiod-certs-cluster1 \\\n  ttl=24h\nvault write auth\/kubernetes-cluster2\/role\/istiod \\\n  bound_service_account_names=istiod \\\n  bound_service_account_namespaces=istio-system \\\n  policies=istiod-certs-cluster2  \\\n  ttl=24h\n\u0060\u0060\u0060\n\n## 部署 *vault-inject* 和 Istio Helm Charts\n\n为了部署 Vault 注入器，我们将利用官方 Vault [Helm chart](https:\/\/github.com\/hashicorp\/vault-helm)。\n\n\u0060\u0060\u0060bash\nhelm repo add hashicorp https:\/\/helm.releases.hashicorp.com\nhelm repo update\nkubectl --kubeconfig kubecfg1.yml create ns vault\nkubectl --kubeconfig kubecfg2.yml create ns vault\nhelm --kubeconfig kubecfg1.yml install -n vault vault-inject hashicorp\/vault --set \u0022injector.externalVaultAddr=$VAULT_SERVER\u0022\nhelm --kubeconfig kubecfg2.yml install -n vault vault-inject hashicorp\/vault --set \u0022injector.externalVaultAddr=$VAULT_SERVER\u0022\nkubectl --kubeconfig kubecfg1.yml -n vault get pods\nkubectl --kubeconfig kubecfg2.yml -n vault get pods\n\u0060\u0060\u0060\n\n\u0060\u0060\u0060\nNAME                                           READY   STATUS    RESTARTS   AGE\nvault-inject-agent-injector-5776975795-9vt9w   1\/1     Running   0          92s\nNAME                                           READY   STATUS    RESTARTS   AGE\nvault-inject-agent-injector-5776975795-9vjnx   1\/1     Running   0          91s\n\u0060\u0060\u0060\n\n要安装 Istio，我们将使用 Tetrate Istio Distro [Helm chart](https:\/\/github.com\/tetratelabs\/helm-charts)。\n\n\u0060\u0060\u0060bash\nhelm repo add tetratelabs https:\/\/tetratelabs.github.io\/helm-charts\nhelm repo update\nhelm --kubeconfig kubecfg1.yml install -n istio-system istio-base tetratelabs\/base\nhelm --kubeconfig kubecfg2.yml install -n istio-system istio-base tetratelabs\/base\nhelm --kubeconfig kubecfg1.yml install -n istio-system istio-istiod tetratelabs\/istiod --values=.\/cluster1-values.yaml\nhelm --kubeconfig kubecfg2.yml install -n istio-system istio-istiod tetratelabs\/istiod --values=.\/cluster2-values.yaml\nkubectl --kubeconfig kubecfg1.yml -n istio-system get pods\nkubectl --kubeconfig kubecfg2.yml -n istio-system get pods\n\u0060\u0060\u0060\n\n请注意我们如何利用多个 Istio Helm chart 值覆盖来我们预期的目标：\n\n- 注入一个 pilot Pod 环境变量 \u0060ROOT_CA_DIR\u0060 来告诉 *istiod* 从哪里获取证书和私钥\n- 告诉 \u0060vault-agent-init\u0060 容器在 *istiod* 容器之前运行，因此秘密安装在 \u0060\/vault\/secrets\u0060 的卷中可用\n- 指示 Vault 注入器从正确的位置和数据密钥获取机密\n- 这样做时承担 Vault *istiod* 角色\n- 覆盖默认的 Kubernetes auth-path，因为我们有多个集群 \n\n\u0060\u0060\u0060yaml\npilot:\n  env:\n    ROOT_CA_DIR: \/vault\/secrets\n  podAnnotations:\n    vault.hashicorp.com\/agent-inject: \u0022true\u0022\n    vault.hashicorp.com\/agent-init-first: \u0022true\u0022\n    vault.hashicorp.com\/agent-inject-secret-ca-key.pem: \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022\n    vault.hashicorp.com\/agent-inject-template-ca-key.pem: |\n        {{- with secret \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022 -}}\n        {{ .Data.ca_key }}\n        {{ end -}}\n    vault.hashicorp.com\/agent-inject-secret-ca-cert.pem: \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022\n    vault.hashicorp.com\/agent-inject-template-ca-cert.pem: |\n        {{- with secret \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022 -}}\n        {{ .Data.ca_cert }}\n        {{ end -}}\n    vault.hashicorp.com\/agent-inject-secret-root-cert.pem: \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022\n    vault.hashicorp.com\/agent-inject-template-root-cert.pem: |\n        {{- with secret \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022 -}}\n        {{ .Data.root_cert }}\n        {{ end -}}\n    vault.hashicorp.com\/agent-inject-secret-cert-chain.pem: \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022\n    vault.hashicorp.com\/agent-inject-template-cert-chain.pem: |\n        {{- with secret \u0022kubernetes-cluster1-secrets\/istiod-service\/certs\u0022 -}}\n        {{ .Data.cert_chain }}\n        {{ end -}}\n    vault.hashicorp.com\/role: \u0022istiod\u0022\n    vault.hashicorp.com\/auth-path: \u0022auth\/kubernetes-cluster1\u0022\n\u0060\u0060\u0060\n\n当我们查看 \u0060vault-agent-init\u0060 容器日志时，我们应该看到类似这样的内容。我们的控制平面已经正确地获取了 Vault 注入的秘密。\n\n\u0060\u0060\u0060bash\nkubectl --kubeconfig kubecfg1.yml logs -n istio-system -l app=istiod -c vault-agent-init --tail=-1\n\u0060\u0060\u0060\n\n\u0060\u0060\u0060\n==\u003e Vault agent started! Log data will stream in below:\n\n  ==\u003e Vault agent configuration:\n\n                      Cgo: disabled\n                Log Level: info\n                  Version: Vault v1.12.0, built 2022-10-10T18:14:33Z\n              Version Sha: 558abfa75702b5dab4c98e86b802fb9aef43b0eb\n\n  2022-11-18T11:01:21.398Z [INFO]  sink.file: creating file sink\n  2022-11-18T11:01:21.398Z [INFO]  sink.file: file sink configured: path=\/home\/vault\/.vault-token mode=-rw-r-----\n  2022-11-18T11:01:21.398Z [INFO]  template.server: starting template server\n  2022-11-18T11:01:21.398Z [INFO]  sink.server: starting sink server\n  2022-11-18T11:01:21.398Z [INFO]  auth.handler: starting auth handler\n  2022-11-18T11:01:21.398Z [INFO]  auth.handler: authenticating\n  2022-11-18T11:01:21.398Z [INFO] (runner) creating new runner (dry: false, once: false)\n  2022-11-18T11:01:21.398Z [INFO] (runner) creating watcher\n  2022-11-18T11:01:21.402Z [INFO]  auth.handler: authentication successful, sending token to sinks\n  2022-11-18T11:01:21.402Z [INFO]  auth.handler: starting renewal process\n  2022-11-18T11:01:21.402Z [INFO]  sink.file: token written: path=\/home\/vault\/.vault-token\n  2022-11-18T11:01:21.402Z [INFO]  sink.server: sink server stopped\n  2022-11-18T11:01:21.402Z [INFO]  sinks finished, exiting\n  2022-11-18T11:01:21.402Z [INFO]  template.server: template server received new token\n  2022-11-18T11:01:21.402Z [INFO] (runner) stopping\n  2022-11-18T11:01:21.402Z [INFO] (runner) creating new runner (dry: false, once: false)\n  2022-11-18T11:01:21.402Z [INFO] (runner) creating watcher\n  2022-11-18T11:01:21.402Z [INFO] (runner) starting\n  2022-11-18T11:01:21.403Z [INFO]  auth.handler: renewed auth token\n  2022-11-18T11:01:21.515Z [INFO] (runner) rendered \u0022(dynamic)\u0022 =\u003e \u0022\/vault\/secrets\/root-cert.pem\u0022\n  2022-11-18T11:01:21.515Z [INFO] (runner) rendered \u0022(dynamic)\u0022 =\u003e \u0022\/vault\/secrets\/ca-cert.pem\u0022\n  2022-11-18T11:01:21.515Z [INFO] (runner) rendered \u0022(dynamic)\u0022 =\u003e \u0022\/vault\/secrets\/cert-chain.pem\u0022\n  2022-11-18T11:01:21.516Z [INFO] (runner) rendered \u0022(dynamic)\u0022 =\u003e \u0022\/vault\/secrets\/ca-key.pem\u0022\n  2022-11-18T11:01:21.516Z [INFO] (runner) stopping\n  2022-11-18T11:01:21.516Z [INFO]  template.server: template server stopped\n  2022-11-18T11:01:21.516Z [INFO] (runner) received finish\n  2022-11-18T11:01:21.516Z [INFO]  auth.handler: shutdown triggered, stopping lifetime watcher\n  2022-11-18T11:01:21.516Z [INFO]  auth.handler: auth handler stopped\n\u0060\u0060\u0060\n\n当我们查看 \u0060discovery\u0060 容器日志时，我们应该看到如下内容：\n\n\u0060\u0060\u0060bash\nkubectl --kubeconfig kubecfg1.yml logs -n istio-system -l app=istiod -c discovery --tail=-1\n\u0060\u0060\u0060\n\n\u0060\u0060\u0060\n info\tUsing istiod file format for signing ca files\n  info\tUse plugged-in cert at \/vault\/secrets\/ca-key.pem\n  info\tx509 cert - Issuer: \u0022CN=Intermediate CA,O=Istio,L=istiod-cluster1\u0022, Subject: \u0022\u0022, SN: 39f67569f10d36a1fc91e9d82156b07d, NotBefore: \u00222022-11-18T11:11:59Z\u0022, NotAfter: \u00222032-11-15T11:13:59Z\u0022\n  info\tx509 cert - Issuer: \u0022CN=Root CA,O=Istio\u0022, Subject: \u0022CN=Intermediate CA,O=Istio,L=istiod-cluster1\u0022, SN: dedf298a147681d6, NotBefore: \u00222022-11-17T22:01:54Z\u0022, NotAfter: \u00222024-11-16T22:01:54Z\u0022\n  info\tx509 cert - Issuer: \u0022CN=Root CA,O=Istio\u0022, Subject: \u0022CN=Root CA,O=Istio\u0022, SN: f5bcd7e89bdb6248, NotBefore: \u00222022-11-17T22:01:52Z\u0022, NotAfter: \u00222032-11-14T22:01:52Z\u0022\n  info\tIstiod certificates are reloaded\n  info\tspiffe\tAdded 1 certs to trust domain cluster.local in peer cert verifier\n\u0060\u0060\u0060\n\n我们可以看到我们的 Istio 控制平面已经正确地获取了我们的 Vault 注入证书和私钥。任务完成！\n\n## 结论\n\n在本文中，我们已经使用外部 Vault 存储的证书和私钥成功引导了 Istio 控制平面。实现这一目标的步骤包括：\n\n- 将证书和私钥存储在每个集群专用的 Vault 秘密安装路径中\n- 为每个集群设置 Kubernetes Vault 身份验证后端，链接到正确的 ServiceAccount\n- 定义适当的角色和策略以允许从 *istiod* ServiceAccount 访问 Vault 机密\n- 将 Istio Pilot 引导程序参数调整为：\n  - 注入 *vault-agent-init* sidecar\n  - 获取包含我们的证书和私钥的正确 Vault 机密\n  - 使用正确的角色和身份验证后端来这样做\n  - 从正确的 vault secret 安装路径中获取证书和私钥\n\n我们可以使用完全相同的技术来注入*入口网关*和*出口网关*证书。创建 Istio [Gateway](https:\/\/istio.io\/latest\/docs\/reference\/config\/networking\/gateway\/#ServerTLSSettings) 对象时，请确保将 *serverCertificate*、*privateKey* 和 *caCertificates* 指向 \u0060\/vault\/secrets\u0060 挂载卷中的正确文件。我们将把它作为练习留给读者。\n\n通过将证书注入绑定到 Kubernetes ServiceAccount，我们现在已将证书生命周期管理委托给外部秘密 Vault 实例。现在可以使用专用角色和写入\/更新策略创建服务门户或 CI\/CD 管道等外部流程，以提供必要的证书生命周期管理安全性。\n', '\/trans\/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">本文将指导你使用 Vault 存储 Istio 的证书。</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      专栏
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(87)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(42)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(25)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>随笔</span>
            <span>(22)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>其他</span>
            <span>(21)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(18)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>业态</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>云原生</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(10)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>安全</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>开源</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%b7%a5%e5%85%b7" class="sidebar-item">
            <span>工具</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>旅行</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>可观测性</span>
            <span>(6)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      资料
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>出版物</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>翻译电子书</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>翻译文档</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>翻译图书</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>原创图书</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>教程手册</span>
            <span>(2)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">联系</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">微信公众号</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">博客</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/kubecon-eu-2025-london-recap/">KubeCon EU 2025 参会报告：塑造云原生格局的洞察与趋势</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/mastering-github-copilot-for-open-source/">探索 GitHub Copilot：当 AI 成为你的贴身编码助手</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/beyond-sidecar/">超越 Sidecar：深入解析 Istio Ambient Mode 的流量机制与成本效益</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">链接</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio 服务网格
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate 公司
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  云原生学院|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  云原生开源项目大全
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnativecn.com" target="_blank" rel="noopener noreferrer">
                  云原生社区（中国）
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">教程</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio 基础教程
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes 基础教程
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/envoy-made-simple/" >
                  简明 Envoy 教程
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">通知</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/kcd-beijing-2025/">KCD Beijing 2025 - 提交议题及参会报名</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/cloud-native-community-domain-migration/">云原生社区网站域名变更通知</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">资料分享：云原生应用服务网格代理模型的威胁分析指南</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2025 Jimmy Song 保留所有权利</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />










<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
