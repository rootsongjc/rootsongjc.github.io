<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="utf-8">
  
  <title>Istio - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="å®‹å‡€è¶…çš„åšå®¢">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.129.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.595949bd12db88434115e2a1e70965cf2928cc646e73acc6437c4cbbc323f585.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/tags/istio/" />
  <meta property="og:title" content="Istio | Jimmy Song" />
  <meta property="twitter:title" content="Istio | Jimmy Song" />

  
  <meta property="og:description" content="å®‹å‡€è¶…çš„åšå®¢" />
  <meta property="twitter:description" content="å®‹å‡€è¶…çš„åšå®¢" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/blog">åšå®¢</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/book">èµ„æ–™</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/tags">æ ‡ç­¾</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/notice">å…¬å‘Š</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/contact">è”ç³»</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/about">å…³äº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/community/">ç¤¾åŒº</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener">è§†é¢‘ <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i></a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    <a class="nav-link" href="/en/tags/istio/">English</a>
                    
                  
                
              
              
              
                
                  
                    
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>æœç´¢</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">âŒ˜</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>ç«™å†…æœç´¢</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="å…³é—­"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="è¯·è¾“å…¥æœç´¢è¯" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="è¯·è¾“å…¥æœç´¢è¯">
        
        <div class="mt-4">
          <span>æœç´¢ç±»å‹: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">æ‰€æœ‰</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">åŸåˆ›</label>
              <input type="radio" id="trans" name="search_type" value="trans">
              <label for="trans">è¯‘æ–‡</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">èµ„æ–™</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">å…¬å‘Š</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    Istio
                </p>
                <p class="page-description">
                    
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/secure-apps-with-istio/">[è¯‘] ä½¿ç”¨ç›¸äº’ TLS å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/11/06</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://istio.io/latest/blog/2023/secure-apps-with-istio/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä½¿ç”¨ç›¸äº’ TLS å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡', 'æœ¬æ–‡è®¨è®ºäº†ä½¿ç”¨ç›¸äº’ TLS (mTLS) å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡çš„é‡è¦æ€§ã€‚mTLS æä¾›äº†ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ï¼Œåªæœ‰æºå’Œç›®æ ‡å¯ä»¥è§£å¯†æ•°æ®ï¼Œä»è€Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚ç„¶è€Œï¼Œå¦‚æœæºæˆ–ç›®æ ‡çš„èº«ä»½æ²¡æœ‰åŠ å¯†ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚Istio ä¸­çš„ mTLS å¯ä»¥ç®€å•åœ°å¯ç”¨ï¼Œå¹¶ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åº pod æä¾›èº«ä»½è¯ä¹¦ã€‚ä¸ºäº†å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ mTLSï¼Œå¯ä»¥ä½¿ç”¨ Istio çš„ PeerAuthentication ç­–ç•¥å’Œ AuthorizationPolicyã€‚æœ€åï¼ŒTLS åè®®æ˜¯æœ€å¹¿æ³›å®¡æŸ¥ã€ä¸“å®¶æ‰¹å‡†ã€ç»è¿‡æˆ˜æ–—æµ‹è¯•çš„æ•°æ®å®‰å…¨åè®®ä¹‹ä¸€ï¼ŒIstio é»˜è®¤åœ¨å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡ä¸­ä½¿ç”¨ TLS 1.3 ç‰ˆæœ¬ã€‚', '\n\u003e æ‘˜è¦ï¼šæœ¬æ–‡è®¨è®ºäº†ä½¿ç”¨ç›¸äº’ TLS (mTLS) å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡çš„é‡è¦æ€§ã€‚mTLS æä¾›äº†ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ï¼Œåªæœ‰æºå’Œç›®æ ‡å¯ä»¥è§£å¯†æ•°æ®ï¼Œä»è€Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚ç„¶è€Œï¼Œå¦‚æœæºæˆ–ç›®æ ‡çš„èº«ä»½æ²¡æœ‰åŠ å¯†ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚Istio ä¸­çš„ mTLS å¯ä»¥ç®€å•åœ°å¯ç”¨ï¼Œå¹¶ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åº pod æä¾›èº«ä»½è¯ä¹¦ã€‚ä¸ºäº†å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ mTLSï¼Œå¯ä»¥ä½¿ç”¨ Istio çš„ PeerAuthentication ç­–ç•¥å’Œ AuthorizationPolicyã€‚æœ€åï¼ŒTLS åè®®æ˜¯æœ€å¹¿æ³›å®¡æŸ¥ã€ä¸“å®¶æ‰¹å‡†ã€ç»è¿‡æˆ˜æ–—æµ‹è¯•çš„æ•°æ®å®‰å…¨åè®®ä¹‹ä¸€ï¼ŒIstio é»˜è®¤åœ¨å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡ä¸­ä½¿ç”¨ TLS 1.3 ç‰ˆæœ¬ã€‚\n\nç”¨æˆ·é‡‡ç”¨æœåŠ¡ç½‘æ ¼çš„æœ€å¤§åŸå› ä¹‹ä¸€æ˜¯ä½¿ç”¨ç›¸äº’ TLSï¼ˆmTLSï¼‰åŸºäºå¯é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ¥å¯ç”¨åº”ç”¨ç¨‹åºä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚åœ¨æ­¤åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºåº”ç”¨ç¨‹åºä¹‹é—´å®‰å…¨é€šä¿¡çš„è¦æ±‚ï¼Œä»¥åŠ mTLS å¦‚ä½•å®ç°å¹¶æ»¡è¶³æ‰€æœ‰è¿™äº›è¦æ±‚ï¼Œä»¥åŠä½¿ç”¨ Istio å¯ç”¨åº”ç”¨ç¨‹åºä¹‹é—´ mTLS çš„ç®€å•æ­¥éª¤ã€‚\n\n## æ‚¨éœ€è¦ä»€ä¹ˆæ¥ä¿æŠ¤åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ï¼Ÿ\n\nç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºç»å¸¸åˆ†å¸ƒåœ¨å¤šä¸ª Kubernetes é›†ç¾¤æˆ–è™šæ‹Ÿæœºä¸­ã€‚æ–°ç‰ˆæœ¬ç»å¸¸è¿›è¡Œé˜¶æ®µæ€§éƒ¨ç½²ï¼Œå®ƒä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¯·æ±‚å¿«é€Ÿæ‰©å±•å’Œç¼©å°ã€‚ç”±äºç°ä»£åº”ç”¨ç¨‹åºé€šè¿‡ä¸ä¾èµ–å…±åŒå®šä½æ¥æé«˜èµ„æºåˆ©ç”¨æ•ˆç‡ï¼Œå› æ­¤èƒ½å¤Ÿåº”ç”¨è®¿é—®ç­–ç•¥å¹¶ä¿æŠ¤è¿™äº›åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡è‡³å…³é‡è¦ï¼Œå› ä¸ºå¢åŠ çš„å¤šä¸ªå…¥å£ç‚¹å¯¼è‡´äº†æ›´å¤§çš„æ”»å‡»é¢ã€‚å¿½è§†è¿™ä¸€ç‚¹å°†é‚€è¯·æ•°æ®ä¸¢å¤±ã€æ•°æ®ç›—çªƒã€ä¼ªé€ æ•°æ®æˆ–ç®€å•å¤„ç†ç­‰å·¨å¤§çš„ä¸šåŠ¡é£é™©ã€‚\n\nä»¥ä¸‹æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´å®‰å…¨é€šä¿¡çš„å¸¸è§å…³é”®è¦æ±‚ï¼š\n\n### èº«ä»½\n\nèº«ä»½æ˜¯ä»»ä½•å®‰å…¨æ¶æ„çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥å®‰å…¨åœ°å‘é€æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»ä¸ºåº”ç”¨ç¨‹åºå»ºç«‹**èº«ä»½**ã€‚è¿™ä¸ªå»ºç«‹èº«ä»½çš„è¿‡ç¨‹è¢«ç§°ä¸º**èº«ä»½éªŒè¯** - å®ƒæ¶‰åŠç”±æŸä¸ªçŸ¥åçš„ï¼Œå—ä¿¡ä»»çš„**æƒå¨æœºæ„**å¯¹åº”ç”¨ç¨‹åºå·¥ä½œè´Ÿè½½è¿›è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡æ£€æŸ¥ï¼Œä»¥ç¡®è®¤å®ƒæ˜¯å®ƒæ‰€å£°ç§°çš„é‚£æ ·ã€‚ä¸€æ—¦æƒå¨æœºæ„æ»¡æ„ï¼Œå®ƒå°±ä¼šæˆäºˆå·¥ä½œè´Ÿè½½ä¸€ä¸ªèº«ä»½ã€‚\n\nè€ƒè™‘å‡ºç¤ºæŠ¤ç…§çš„è¡Œä¸º - ä½ ä¼šå‘æŸä¸ªæƒå¨æœºæ„è¯·æ±‚ä¸€ä¸ªï¼Œé‚£ä¸ªæƒå¨æœºæ„å¯èƒ½ä¼šè¦æ±‚ä½ æä¾›å‡ ä¸ªä¸åŒçš„èº«ä»½éªŒè¯è¯æ˜ä½ æ˜¯ä½ æ‰€è¯´çš„é‚£ä¸ªäºº - å‡ºç”Ÿè¯æ˜ã€ç°ä½å€ã€åŒ»ç–—è®°å½•ç­‰ã€‚ä¸€æ—¦ä½ æ»¡è¶³äº†æ‰€æœ‰çš„èº«ä»½éªŒè¯è¦æ±‚ï¼Œä½ å°†ï¼ˆå¸Œæœ›ï¼‰è¢«æˆäºˆèº«ä»½è¯ä»¶ã€‚ä½ å¯ä»¥å°†é‚£ä¸ªèº«ä»½è¯ä»¶ç»™åˆ«äººä½œä¸ºä½ å·²ç»æ»¡è¶³äº†å‘è¯æœºæ„çš„æ‰€æœ‰èº«ä»½éªŒè¯è¦æ±‚çš„è¯æ®ï¼Œå¦‚æœä»–ä»¬ä¿¡ä»»å‘è¯æœºæ„ï¼ˆå’Œèº«ä»½è¯ä»¶æœ¬èº«ï¼‰ï¼Œä»–ä»¬å°±å¯ä»¥ä¿¡ä»»å…³äºä½ çš„æ‰€æœ‰å†…å®¹ï¼ˆæˆ–è€…ä»–ä»¬å¯ä»¥è”ç³»å—ä¿¡ä»»çš„æƒå¨æœºæ„å¹¶éªŒè¯è¯¥æ–‡ä»¶ï¼‰ã€‚\n\nèº«ä»½å¯ä»¥é‡‡å–ä»»ä½•å½¢å¼ï¼Œä½†æ˜¯ï¼Œå°±åƒä»»ä½•å½¢å¼çš„èº«ä»½è¯æ˜ä¸€æ ·ï¼Œèº«ä»½éªŒè¯è¶Šå¼±ï¼Œä¼ªé€ å°±è¶Šå®¹æ˜“ï¼Œèº«ä»½è¯æ˜å¯¹äºä½¿ç”¨å®ƒè¿›è¡Œå†³ç­–çš„ä»»ä½•äººæ¥è¯´å°±è¶Šæ— ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è®¡ç®—ä¸­ï¼Œå¯†ç å¯éªŒè¯çš„èº«ä»½éå¸¸é‡è¦ - å®ƒä»¬ç”±å¯éªŒè¯çš„æƒå¨æœºæ„ç­¾ç½²ï¼Œç±»ä¼¼äºæ‚¨çš„æŠ¤ç…§å’Œé©¾é©¶æ‰§ç…§ã€‚åŸºäºä»»ä½•è¾ƒå°‘çš„èº«ä»½éƒ½æ˜¯ä¸€ä¸ªå¯ä»¥ç›¸å¯¹å®¹æ˜“åœ°åˆ©ç”¨çš„å®‰å…¨å¼±ç‚¹ã€‚\n\næ‚¨çš„ç³»ç»Ÿå¯èƒ½å…·æœ‰æºè‡ªç½‘ç»œå±æ€§ï¼ˆä¾‹å¦‚ IP åœ°å€ï¼‰çš„èº«ä»½ï¼Œå…·æœ‰åˆ†å¸ƒå¼èº«ä»½ç¼“å­˜ï¼Œè·Ÿè¸ªèº«ä»½ä¸è¿™äº›ç½‘ç»œå±æ€§ä¹‹é—´çš„æ˜ å°„ã€‚è¿™äº›èº«ä»½ä¸åƒå¯†ç å¯éªŒè¯çš„èº«ä»½é‚£æ ·å…·æœ‰å¼ºå¤§çš„ä¿è¯ï¼Œå› ä¸º IP åœ°å€å¯èƒ½è¢«é‡æ–°åˆ†é…ç»™ä¸åŒçš„å·¥ä½œè´Ÿè½½ï¼Œå¹¶ä¸”èº«ä»½ç¼“å­˜å¯èƒ½å¹¶ä¸æ€»æ˜¯æ›´æ–°åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚\n\næ‚¨å¸Œæœ›åº”ç”¨ç¨‹åºä½¿ç”¨å¯†ç å¯éªŒè¯çš„èº«ä»½ï¼Œå› ä¸ºåœ¨å»ºç«‹è¿æ¥æ—¶äº¤æ¢åº”ç”¨ç¨‹åºçš„å¯†ç å¯éªŒè¯èº«ä»½æœ¬è´¨ä¸Šæ¯”ä¾èµ–äºå°† IP åœ°å€æ˜ å°„åˆ°èº«ä»½çš„ç³»ç»Ÿæ›´å¯é ï¼Œæ›´å®‰å…¨ã€‚è¿™äº›ç³»ç»Ÿä¾èµ–äºå…·æœ‰æœ€ç»ˆä¸€è‡´æ€§å’Œè¿‡æ—¶é—®é¢˜çš„åˆ†å¸ƒå¼èº«ä»½ç¼“å­˜ï¼Œè¿™å¯èƒ½åœ¨ Kubernetes ä¸­åˆ›å»ºç»“æ„æ€§å¼±ç‚¹ï¼Œå…¶ä¸­é«˜é¢‘ç‡çš„è‡ªåŠ¨ pod è½¬æ¢æ˜¯å¸¸æ€ã€‚\n\n### æœºå¯†æ€§\n\nåŠ å¯†åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“çš„æ•°æ®è‡³å…³é‡è¦ - å› ä¸ºåœ¨ç ´åå¸¸è§ã€æˆæœ¬é«˜æ˜‚å’Œå®é™…ä¸Šå¾®ä¸è¶³é“çš„ä¸–ç•Œä¸­ï¼Œå®Œå…¨ä¾èµ–äº*å®‰å…¨çš„*å†…éƒ¨ç¯å¢ƒæˆ–å…¶ä»–å®‰å…¨è¾¹ç•Œæ—©å·²ä¸å†é€‚ç”¨ã€‚ä¸ºäº†é˜²æ­¢[ä¸­é—´äººæ”»å‡»](https:\/\/en.wikipedia.org\/wiki\/Man-in-the-middle_attack)ï¼Œä½ éœ€è¦ä¸ºæº - ç›®æ ‡å¯¹åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„åŠ å¯†é€šé“ï¼Œå› ä¸ºä½ å¸Œæœ›æœ‰å¼ºå¤§çš„èº«ä»½å”¯ä¸€æ€§ä¿è¯ä»¥é¿å…[æ··æ·†å‰¯æ‰‹é—®é¢˜](https:\/\/en.wikipedia.org\/wiki\/Confused_deputy_problem)ã€‚æ¢å¥è¯è¯´ï¼Œä»…ä»…åŠ å¯†é€šé“æ˜¯ä¸å¤Ÿçš„ - å®ƒå¿…é¡»ä½¿ç”¨ç›´æ¥ä»å”¯ä¸€æºå’Œç›®æ ‡èº«ä»½æ´¾ç”Ÿçš„å”¯ä¸€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œä»¥ä¾¿åªæœ‰æºå’Œç›®æ ‡å¯ä»¥è§£å¯†æ•°æ®ã€‚æ­¤å¤–ï¼Œæ‚¨å¯èƒ½éœ€è¦æ ¹æ®å®‰å…¨å›¢é˜Ÿçš„è¦æ±‚å®šåˆ¶åŠ å¯†ï¼Œä¾‹å¦‚é€šè¿‡é€‰æ‹©ç‰¹å®šçš„å¯†ç ã€‚\n\n### å®Œæ•´æ€§\n\nä»æºå‘é€åˆ°ç›®æ ‡çš„åŠ å¯†æ•°æ®åœ¨å‘é€åä¸èƒ½è¢«é™¤æºå’Œç›®æ ‡ä¹‹å¤–çš„ä»»ä½•èº«ä»½ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®ä¸å‘é€çš„æ•°æ®ç›¸åŒã€‚å¦‚æœä½ æ²¡æœ‰[data integrity](https:\/\/en.wikipedia.org\/wiki\/Data_integrity)ï¼Œé‚£ä¹ˆä¸­é—´çš„äººå¯èƒ½åœ¨æºå’Œç›®æ ‡ä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹ä¸­ä¿®æ”¹ä¸€äº›ä½æˆ–æ•´ä¸ªæ•°æ®çš„å†…å®¹ã€‚\n\n### è®¿é—®ç­–ç•¥æ‰§è¡Œ\n\nåº”ç”¨ç¨‹åºæ‰€æœ‰è€…éœ€è¦å¯¹å…¶åº”ç”¨ç¨‹åºåº”ç”¨è®¿é—®ç­–ç•¥ï¼Œå¹¶æ­£ç¡®ã€ä¸€è‡´ä¸”ä¸å«ç³Šåœ°æ‰§è¡Œå®ƒä»¬ã€‚ä¸ºäº†å¯¹é€šä¿¡æ¸ é“çš„ä¸¤ç«¯åº”ç”¨ç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ç«¯ç¡®å®šä¸€ä¸ªåº”ç”¨ç¨‹åºèº«ä»½ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸ºå¯èƒ½çš„é€šä¿¡æ¸ é“çš„ä¸¤ç«¯éƒ½æœ‰äº†ä¸€ä¸ªå¯ä»¥é€šè¿‡å¯†ç éªŒè¯çš„èº«ä»½ï¼Œå¹¶ä¸”æ¥æºé“¾æ¡æ˜ç¡®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¡®å®šè°å¯ä»¥ä¸ä½•ç‰©è¿›è¡Œé€šä¿¡çš„ç­–ç•¥ã€‚æ ‡å‡†çš„ TLSï¼Œè¿™æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯†ç åè®®ï¼Œç”¨äºä¿æŠ¤å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼ŒWeb æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ï¼ŒWeb æœåŠ¡å™¨ï¼‰ä¹‹é—´çš„é€šä¿¡ï¼ŒåªçœŸæ­£éªŒè¯å¹¶è¦æ±‚ä¸€æ–¹çš„èº«ä»½ - æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œå¯¹äºå…¨é¢çš„ç«¯åˆ°ç«¯ç­–ç•¥æ‰§è¡Œï¼Œå¯¹åŒæ–¹ - å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ä¸€ä¸ªå¯é ã€å¯éªŒè¯ã€æ˜ç¡®çš„èº«ä»½è‡³å…³é‡è¦ã€‚è¿™å¯¹å†…éƒ¨åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯ä¸€ä¸ªå…±åŒçš„éœ€æ±‚ - æƒ³è±¡ä¸€ä¸‹ï¼Œåªæœ‰ä¸€ä¸ª \u0060frontend\u0060 åº”ç”¨ç¨‹åºåº”è¯¥è°ƒç”¨åç«¯ \u0060checkout\u0060 åº”ç”¨ç¨‹åºçš„ **GET** æ–¹æ³•ï¼Œä½†æ˜¯ä¸åº”è¯¥è¢«å…è®¸è°ƒç”¨ \u0060POST\u0060 æˆ– \u0060DELETE\u0060 æ–¹æ³•ã€‚æˆ–è€…ï¼Œåªæœ‰é‚£äº›ç”±ç‰¹å®š JWT å‘è¡Œè€…å‘å‡º JWT ä»¤ç‰Œçš„åº”ç”¨ç¨‹åºæ‰èƒ½è°ƒç”¨ \u0060checkout\u0060 åº”ç”¨ç¨‹åºçš„ \u0060GET\u0060 æ–¹æ³•ã€‚é€šè¿‡åˆ©ç”¨åŒç«¯çš„å¯†ç èº«ä»½ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å¼ºå¤§çš„è®¿é—®ç­–ç•¥è¢«æ­£ç¡®åœ°ã€å®‰å…¨åœ°ã€å¯é åœ°æ‰§è¡Œï¼Œè€Œä¸”æœ‰å¯éªŒè¯çš„å®¡è®¡è½¨è¿¹ã€‚\n\n### FIPS åˆè§„æ€§\n\n[è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡† (FIPS)](https:\/\/www.nist.gov\/standardsgov\/compliance-faqs-federal-information-processing-standards-fips) æ˜¯ç”± [å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ (NIST)](https:\/\/www.nist.gov\/) åˆ¶å®šçš„è”é‚¦è®¡ç®—æœºç³»ç»Ÿçš„æ ‡å‡†å’ŒæŒ‡å—ã€‚å¹¶éæ¯ä¸ªäººéƒ½éœ€è¦ FIPS åˆè§„æ€§ï¼Œä½† FIPS åˆè§„æ€§æ„å‘³ç€æ»¡è¶³äº†ç¾å›½æ”¿åºœä¸ºä¿æŠ¤æ•æ„Ÿä¿¡æ¯è€Œè®¾ç«‹çš„æ‰€æœ‰å¿…è¦å®‰å…¨è¦æ±‚ã€‚ä¸è”é‚¦æ”¿åºœåˆä½œæ—¶éœ€è¦å®ƒã€‚ä¸ºäº†éµå¾ªç¾å›½æ”¿åºœåˆ¶å®šçš„ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„æŒ‡å—ï¼Œè®¸å¤šç§è¥éƒ¨é—¨éƒ½è‡ªæ„¿ä½¿ç”¨è¿™äº› FIPS æ ‡å‡†ã€‚\n\nä¸ºäº†è¯´æ˜ä¸Šè¿°å®‰å…¨åº”ç”¨ç¨‹åºè¦æ±‚ï¼ˆèº«ä»½ã€æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼‰ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ \u0060frontend\u0060 åº”ç”¨ç¨‹åºè°ƒç”¨ \u0060checkout\u0060 åº”ç”¨ç¨‹åºçš„ä¾‹å­ã€‚è®°ä½ï¼Œæ‚¨å¯ä»¥æŠŠå›¾ä¸­çš„ **ID** çœ‹ä½œæ˜¯ä»»ä½•ç±»å‹çš„èº«ä»½è¯æ˜ï¼Œæ¯”å¦‚æ”¿åºœé¢å‘çš„æŠ¤ç…§ã€ç…§ç‰‡è¯†åˆ«å™¨ï¼š\n\n![å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„è¦æ±‚](requirements-flow.png)\n\n## mTLS å¦‚ä½•æ»¡è¶³ä¸Šè¿°è¦æ±‚ï¼Ÿ\n\nTLS 1.3ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶çš„æœ€æ–° TLS ç‰ˆæœ¬ï¼‰ [è§„èŒƒ](https:\/\/datatracker.ietf.org\/doc\/html\/rfc8446) çš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨ä¸¤ä¸ªé€šä¿¡å¯¹ç­‰æ–¹ä¹‹é—´æä¾›ä¸€ä¸ªå®‰å…¨é€šé“ã€‚TLS å®‰å…¨é€šé“å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š\n\n1. éªŒè¯ï¼šé€šé“çš„æœåŠ¡å™¨ç«¯å§‹ç»ˆè¢«éªŒè¯ï¼Œå®¢æˆ·ç«¯å¯é€‰åœ°è¢«éªŒè¯ã€‚å½“å®¢æˆ·ç«¯ä¹Ÿè¢«éªŒè¯æ—¶ï¼Œå®‰å…¨é€šé“æˆä¸ºä¸€ä¸ªç›¸äº’çš„ TLS é€šé“ã€‚\n2. æœºå¯†æ€§ï¼šæ•°æ®è¢«åŠ å¯†ä¸”åªå¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯è§ã€‚å¿…é¡»ä½¿ç”¨ä¸æºå’Œç›®æ ‡èº«ä»½è¯æ˜æ— æ­§ä¹‰åœ°å¯†ç ç»‘å®šçš„å¯†é’¥æ¥åŠ å¯†æ•°æ®ï¼Œä»¥ä¾¿å¯é åœ°ä¿æŠ¤åº”ç”¨ç¨‹åºå±‚çš„æµé‡ã€‚\n3. å®Œæ•´æ€§ï¼šé€šè¿‡é€šé“å‘é€çš„æ•°æ®æ— æ³•åœ¨æœªè¢«æ£€æµ‹åˆ°çš„æƒ…å†µä¸‹è¿›è¡Œä¿®æ”¹ã€‚è¿™æ˜¯é€šè¿‡åªæœ‰æºå’Œç›®æ ‡æ‹¥æœ‰ç»™å®šä¼šè¯çš„åŠ å¯†å’Œè§£å¯†å¯†é’¥çš„äº‹å®æ¥ä¿è¯çš„ã€‚\n\n### mTLS å†…éƒ¨é€»è¾‘\n\næˆ‘ä»¬å·²ç»ç¡®å®šäº†ï¼Œä½¿ç”¨å¯ä»¥é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ ‡è¯†å¯¹äºä¿æŠ¤é€šé“å’Œæ”¯æŒè®¿é—®ç­–ç•¥æ‰§è¡Œè‡³å…³é‡è¦ï¼Œæˆ‘ä»¬ä¹Ÿå·²ç»ç¡®å®šäº†ï¼ŒmTLS æ˜¯ä¸€ç§ç»è¿‡ä¸¥å¯†æµ‹è¯•çš„åè®®ï¼Œå®ƒä¸ºåœ¨é€šé“çš„ä¸¤ç«¯ä½¿ç”¨å¯ä»¥é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ ‡è¯†æä¾›äº†ä¸€äº›æå…¶é‡è¦çš„ä¿è¯ - è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ mTLS åè®®åœ¨å®é™…è¿è¡Œä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\n\n### æ¡æ‰‹åè®®\n\n[æ¡æ‰‹åè®®](https:\/\/datatracker.ietf.org\/doc\/html\/rfc8446#section-4) éªŒè¯äº†é€šä¿¡åŒæ–¹çš„èº«ä»½ï¼Œåå•†äº†åŠ å¯†æ¨¡å¼å’Œå‚æ•°ï¼Œå¹¶å»ºç«‹äº†å…±äº«çš„å¯†é’¥ææ–™ã€‚æ¢å¥è¯è¯´ï¼Œæ¡æ‰‹çš„è§’è‰²æ˜¯éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½å¹¶åå•†ä¼šè¯å¯†é’¥ï¼Œä»¥ä¾¿è¿æ¥çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥æ ¹æ®ä¼šè¯å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºå»ºç«‹ mTLS è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åå•†ä¸€ä¸ªå¯†ç å¥—ä»¶ï¼Œè¯¥å¥—ä»¶è§„å®šäº†æ‚¨çš„åº”ç”¨ç¨‹åºå°†ç”¨äºè¿æ¥å…¶ä½™éƒ¨åˆ†çš„åŠ å¯†ç®—æ³•ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºè¿˜åå•†äº†è¦ä½¿ç”¨çš„åŠ å¯†ä¼šè¯å¯†é’¥ã€‚æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹éƒ½è¢«è®¾è®¡ä¸ºèƒ½æŠµæŠ—ç¯¡æ”¹ - ä»»ä½•æœªæŒæœ‰ä¸æºå’Œ\/æˆ–ç›®æ ‡ç›¸åŒçš„ç‹¬ç‰¹ï¼Œèƒ½å¤Ÿé€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ–‡æ¡£çš„å®ä½“çš„å¹²æ‰°éƒ½ä¼šè¢«æ‹’ç»ã€‚å› æ­¤ï¼Œåœ¨ä»»ä½•é€šä¿¡æ–¹ç»§ç»­è¿›è¡Œåº”ç”¨ç¨‹åºæ•°æ®ä¹‹å‰ï¼Œéƒ½æœ‰å¿…è¦æ£€æŸ¥æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹å¹¶éªŒè¯å…¶å®Œæ•´æ€§ã€‚\n\næ¡æ‰‹å¯ä»¥è¢«è®¤ä¸ºæ˜¯æŒ‰ç…§ TLS 1.3 è§„èŒƒä¸­çš„[æ¡æ‰‹åè®®æ¦‚è¿°](https:\/\/datatracker.ietf.org\/doc\/html\/rfc8446#section-2)æœ‰ä¸‰ä¸ªé˜¶æ®µ - å†æ¬¡ä½¿ç”¨\u0060frontend\u0060åº”ç”¨ç¨‹åºè°ƒç”¨åç«¯\u0060checkout\u0060åº”ç”¨ç¨‹åºçš„ä¾‹å­ï¼š\n\n1. ç¬¬ä¸€é˜¶æ®µï¼š\u0060frontend\u0060å’Œ\u0060checkout\u0060åå•†å¯ä»¥ç”¨æ¥ä¿æŠ¤æ¡æ‰‹å’Œæµé‡æ•°æ®çš„åŠ å¯†å‚æ•°å’Œå¯†é’¥ã€‚\n2. ç¬¬äºŒé˜¶æ®µï¼šåœ¨æ­¤é˜¶æ®µå’Œä¹‹åçš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯åŠ å¯†çš„ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œ\u0060frontend\u0060å’Œ\u0060checkout\u0060å»ºç«‹å…¶ä»–æ¡æ‰‹å‚æ•°ï¼Œå¹¶ç¡®å®šæ˜¯å¦ä¹Ÿå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ - ä¹Ÿå°±æ˜¯è¯´ï¼ŒmTLSã€‚\n3. ç¬¬ä¸‰é˜¶æ®µï¼š\u0060frontend\u0060é€šè¿‡å…¶å¯é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½éªŒè¯\u0060checkout\u0060ï¼ˆåœ¨ mTLS ä¸­ï¼Œ\u0060checkout\u0060ä»¥ç›¸åŒçš„æ–¹å¼éªŒè¯\u0060frontend\u0060ï¼‰ã€‚\n\nè‡ª TLS 1.2 ä»¥æ¥ï¼Œä¸æ¡æ‰‹ç›¸å…³çš„æœ‰å‡ ä¸ªä¸»è¦åŒºåˆ«ï¼Œæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ TLS 1.3 è§„èŒƒï¼š\n\n1. æ‰€æœ‰æ¡æ‰‹æ¶ˆæ¯ï¼ˆç¬¬äºŒé˜¶æ®µå’Œç¬¬ä¸‰é˜¶æ®µï¼‰éƒ½ä½¿ç”¨åœ¨ç¬¬ä¸€é˜¶æ®µåå•†çš„åŠ å¯†å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚\n2. å·²ç»å‰Šå‡äº†é—ç•™çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚\n3. æ·»åŠ äº†é›¶å¾€è¿”æ—¶é—´ï¼ˆ0-RTTï¼‰æ¨¡å¼ï¼ŒèŠ‚çœäº†è¿æ¥è®¾ç½®çš„ä¸€ä¸ªå¾€è¿”æ—¶é—´ã€‚\n\n### è®°å½•åè®®\n\nåœ¨æ¡æ‰‹é˜¶æ®µåå•†äº† TLS åè®®ç‰ˆæœ¬ã€ä¼šè¯å¯†é’¥å’Œ[HMAC](https:\/\/en.wikipedia.org\/wiki\/HMAC)åï¼ŒåŒæ–¹ç°åœ¨å¯ä»¥é€šè¿‡[è®°å½•åè®®](https:\/\/datatracker.ietf.org\/doc\/html\/rfc8446#section-5)å®‰å…¨åœ°äº¤æ¢è¢«åˆ†å—çš„åŠ å¯†æ•°æ®ã€‚ä½¿ç”¨æ¡æ‰‹ä¸­åå•†çš„å®Œå…¨ç›¸åŒçš„å‚æ•°å¯¹æµé‡è¿›è¡ŒåŠ å¯†æ˜¯è‡³å…³é‡è¦çš„ï¼ˆå¹¶ä¸”æ˜¯è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œä»¥ç¡®ä¿æµé‡çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚\n\nå°† TLS 1.3 è§„èŒƒä¸­çš„ä¸¤ä¸ªåè®®æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶ä½¿ç”¨\u0060frontend\u0060å’Œ\u0060checkout\u0060åº”ç”¨ç¨‹åºæ¥è¯´æ˜ä»¥ä¸‹æµç¨‹ï¼š\n\n![å½“å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„ mTLS æµç¨‹](mtls-flow.png)\n\nè°ä¸º\u0060frontend\u0060å’Œ\u0060checkout\u0060å‘å‡ºèº«ä»½è¯ä¹¦ï¼Ÿå®ƒä»¬é€šå¸¸ç”±å…·æœ‰è‡ªå·±çš„[æ ¹è¯ä¹¦](https:\/\/en.wikipedia.org\/wiki\/Root_certificate)æˆ–ä½¿ç”¨å…¶æ ¹ CA çš„ä¸­é—´è¯ä¹¦çš„[è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰](https:\/\/en.wikipedia.org\/wiki\/Certificate_authority)å‘å‡ºã€‚æ ¹è¯ä¹¦åŸºæœ¬ä¸Šæ˜¯ä¸€ä»½æ ‡è¯†æ ¹ CA çš„å…¬é’¥è¯ä¹¦ï¼Œæ‚¨çš„ç»„ç»‡å¯èƒ½å·²ç»æ‹¥æœ‰æ­¤è¯ä¹¦ã€‚æ ¹è¯ä¹¦ä¼šä¸\u0060frontend\u0060ï¼ˆæˆ–\u0060checkout\u0060ï¼‰çš„è‡ªå·±çš„æ ¹ç­¾åèº«ä»½è¯ä¹¦ä¸€èµ·åˆ†å‘åˆ°\u0060frontend\u0060ã€‚è¿™å°±æ˜¯åŸºæœ¬çš„å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰çš„å·¥ä½œæ–¹å¼ - CA è´Ÿè´£éªŒè¯å®ä½“çš„èº«ä»½æ–‡æ¡£ï¼Œç„¶åä»¥è¯ä¹¦çš„å½¢å¼æˆäºˆå®ƒä¸€ä¸ªæ— æ³•ä¼ªé€ çš„èº«ä»½æ–‡æ¡£ã€‚\n\næ‚¨å¯ä»¥ä¾èµ–æ‚¨çš„ CA å’Œä¸­é—´ CA ä½œä¸ºèº«ä»½**çœŸç†**çš„æ¥æºï¼Œä»¥ä¸€ç§ç»´æŒé«˜å¯ç”¨æ€§å¹¶æä¾›ç¨³å®šã€æŒä¹…å¯éªŒè¯çš„èº«ä»½ä¿è¯çš„ç»“æ„åŒ–æ–¹å¼ï¼Œè€Œä¸€ä¸ªåºå¤§çš„åˆ†å¸ƒå¼ IP å’Œèº«ä»½æ˜ å°„ç¼“å­˜åˆ™æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚å½“\u0060frontend\u0060å’Œ\u0060checkout\u0060çš„èº«ä»½è¯ä¹¦ç”±åŒä¸€ä¸ªæ ¹è¯ä¹¦å‘å‡ºæ—¶ï¼Œ\u0060frontend\u0060å’Œ\u0060checkout\u0060å¯ä»¥å§‹ç»ˆä»¥ä¸€è‡´ä¸”å¯é çš„æ–¹å¼éªŒè¯å…¶å¯¹ç­‰èº«ä»½ï¼Œæ— è®ºå®ƒä»¬è¿è¡Œåœ¨å“ªä¸ªé›†ç¾¤æˆ–èŠ‚ç‚¹æˆ–è§„æ¨¡ä¸­ã€‚\n\næ‚¨äº†è§£äº† mTLS å¦‚ä½•æä¾›åŠ å¯†èº«ä»½ã€æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼Œé‚£ä¹ˆå½“æ‚¨çš„åº”ç”¨ç¨‹åºæ•°é‡å¢é•¿åˆ°æ•°åƒä¸ªæˆ–æ›´å¤šï¼Œå¹¶ä¸”è·¨å¤šä¸ªé›†ç¾¤æ—¶ï¼Œå…¶å¯æ‰©å±•æ€§å¦‚ä½•å‘¢ï¼Ÿå¦‚æœæ‚¨åœ¨å¤šä¸ªé›†ç¾¤ä¸­å»ºç«‹ä¸€ä¸ªå•ä¸€çš„æ ¹è¯ä¹¦ï¼Œé‚£ä¹ˆåªè¦å®ƒè¢«æ ¹è¯ä¹¦ä¿¡ä»»ï¼Œç³»ç»Ÿå°±ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºæ”¶åˆ°æ¥è‡ªå¦ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥è¯·æ±‚æ—¶è¿›è¡Œå¤„ç† - ç³»ç»ŸçŸ¥é“è¿æ¥ä¸Šçš„èº«ä»½å·²ç»é€šè¿‡åŠ å¯†è¿›è¡Œäº†éªŒè¯ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åº pod æ›´æ”¹ IP æˆ–è¢«é‡æ–°éƒ¨ç½²åˆ°å¦ä¸€ä¸ªé›†ç¾¤æˆ–ç½‘ç»œæ—¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼ˆæˆ–ä»£è¡¨å…¶è¡ŒåŠ¨çš„ç»„ä»¶ï¼‰åªéœ€ä½¿ç”¨å…¶ç”± CA é“¸é€ çš„å—ä¿¡ä»»è¯ä¹¦å‘ç›®æ ‡å‘èµ·æµé‡å³å¯ã€‚æ— è®ºæ˜¯ 500\u002b ç½‘ç»œè·³è½¬è¿˜æ˜¯ç›´æ¥è¿æ¥ï¼Œæ‚¨çš„è®¿é—®ç­–ç•¥éƒ½ä¼šä»¥ç›¸åŒçš„æ–¹å¼æ‰§è¡Œï¼Œæ— éœ€è·Ÿè¸ªèº«ä»½ç¼“å­˜å¹¶è®¡ç®—å“ªä¸ª IP åœ°å€æ˜ å°„åˆ°å“ªä¸ªåº”ç”¨ç¨‹åº podã€‚\n\né‚£ä¹ˆå…³äº FIPS åˆè§„æ€§å‘¢ï¼Ÿæ ¹æ® TLS 1.3 è§„èŒƒï¼ŒTLS å…¼å®¹çš„åº”ç”¨ç¨‹åºå¿…é¡»å®ç°\u0060TLS_AES_128_GCM_SHA256\u0060å¯†ç å¥—ä»¶ï¼Œå¹¶å»ºè®®å®ç°\u0060TLS_AES_256_GCM_SHA384\u0060ï¼Œè¿™ä¸¤è€…éƒ½åœ¨ NIST çš„[TLS æŒ‡å—](https:\/\/nvlpubs.nist.gov\/nistpubs\/SpecialPublications\/NIST.SP.800-52r2.pdf)ä¸­ã€‚RSA æˆ– ECDSA æœåŠ¡å™¨è¯ä¹¦ä¹Ÿè¢« TLS 1.3 è§„èŒƒå’Œ NIST çš„ TLS æŒ‡å—æ¨èã€‚åªè¦æ‚¨ä¸º mTLS è¿æ¥ä½¿ç”¨ FIPS 140-2 æˆ– 140-3 åˆè§„çš„åŠ å¯†æ¨¡å—ï¼Œæ‚¨å°±ä¼šèµ°ä¸Š[FIPS 140-2 æˆ– 140-3 éªŒè¯](https:\/\/csrc.nist.gov\/projects\/cryptographic-module-validation-program\/validated-modules)çš„æ­£ç¡®è·¯å¾„ã€‚\n\n## å¯èƒ½å‡ºç°çš„é—®é¢˜\n\næŒ‰ç…§ TLS 1.3 è§„èŒƒæ­£ç¡®å®æ–½ mTLS è‡³å…³é‡è¦ã€‚å¦‚æœä¸æŒ‰ç…§ TLS è§„èŒƒæ­£ç¡®ä½¿ç”¨ mTLSï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½åœ¨æœªè¢«æ£€æµ‹çš„æƒ…å†µä¸‹å‡ºç°çš„é—®é¢˜ï¼š\n\n### å¦‚æœæœ‰äººåœ¨è¿æ¥ä¸­é—´é™é»˜åœ°æ•è·åŠ å¯†æ•°æ®ä¼šæ€ä¹ˆæ ·ï¼Ÿ\n\nå¦‚æœè¿æ¥æ²¡æœ‰æŒ‰ç…§ TLS è§„èŒƒä¸­æ¦‚è¿°çš„æ¡æ‰‹å’Œè®°å½•åè®®æ¥è¿›è¡Œï¼Œä¾‹å¦‚ï¼Œè¿æ¥éµå¾ªæ¡æ‰‹åè®®ï¼Œä½†åœ¨è®°å½•åè®®ä¸­æ²¡æœ‰ä½¿ç”¨æ¡æ‰‹ä¸­åå•†çš„ä¼šè¯å¯†é’¥å’Œå‚æ•°ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°æ‚¨çš„è¿æ¥çš„æ¡æ‰‹å’Œè®°å½•åè®®ä¹‹é—´æ²¡æœ‰å…³è”ï¼Œæ¡æ‰‹å’Œè®°å½•åè®®ä¹‹é—´çš„èº«ä»½å¯èƒ½ä¸åŒã€‚TLS è¦æ±‚æ¡æ‰‹å’Œè®°å½•åè®®åœ¨åŒä¸€è¿æ¥ä¸­å…±äº«ï¼Œå› ä¸ºå°†å®ƒä»¬åˆ†å¼€ä¼šå¢åŠ ä¸­é—´äººæ”»å‡»çš„æ”»å‡»é¢ã€‚\n\nmTLS è¿æ¥ä»æ¡æ‰‹å¼€å§‹åˆ°ç»“æŸéƒ½å…·æœ‰ä¸€è‡´çš„ç«¯åˆ°ç«¯å®‰å…¨æ€§ã€‚åŠ å¯†æ•°æ®æ˜¯ç”¨è¯ä¹¦ä¸­å…¬é’¥åå•†çš„ä¼šè¯å¯†é’¥åŠ å¯†çš„ã€‚åªæœ‰æºå’Œç›®æ ‡å¯ä»¥ä½¿ç”¨ç§é’¥è§£å¯†æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œåªæœ‰æ‹¥æœ‰ç§é’¥çš„è¯ä¹¦æ‰€æœ‰è€…æ‰èƒ½è§£å¯†æ•°æ®ã€‚é™¤éé»‘å®¢æ§åˆ¶äº†è¯ä¹¦çš„ç§é’¥ï¼Œå¦åˆ™ä»–æˆ–å¥¹æ²¡æœ‰åŠæ³•æä¹± mTLS è¿æ¥ä»¥æˆåŠŸæ‰§è¡Œä¸­é—´äººæ”»å‡»ã€‚\n\n### å¦‚æœæºæˆ–ç›®æ ‡èº«ä»½æ²¡æœ‰åŠ å¯†å®‰å…¨æ€ä¹ˆåŠï¼Ÿ\n\nå¦‚æœèº«ä»½åŸºäºç½‘ç»œå±æ€§ï¼Œå¦‚ IP åœ°å€ï¼Œè¿™äº›å±æ€§å¯èƒ½ä¼šé‡æ–°åˆ†é…ç»™å…¶ä»– podï¼Œå°±æ— æ³•ä½¿ç”¨åŠ å¯†æŠ€æœ¯éªŒè¯è¯¥èº«ä»½ã€‚ç”±äºæ­¤ç±»èº«ä»½ä¸åŸºäºåŠ å¯†èº«ä»½ï¼Œå› æ­¤æ‚¨çš„ç³»ç»Ÿå¯èƒ½æœ‰ä¸€ä¸ªèº«ä»½ç¼“å­˜ï¼Œç”¨äºè·Ÿè¸ªèº«ä»½ã€pod çš„ç½‘ç»œæ ‡ç­¾ã€ç›¸åº”çš„ IP åœ°å€å’Œéƒ¨ç½² pod çš„ Kubernetes èŠ‚ç‚¹ä¿¡æ¯ä¹‹é—´çš„æ˜ å°„ã€‚ä½¿ç”¨èº«ä»½ç¼“å­˜ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ° pod IP åœ°å€è¢«é‡ç”¨å’Œèº«ä»½é”™è¯¯ï¼Œå½“èº«ä»½ç¼“å­˜åœ¨çŸ­æ—¶é—´å†…åŒæ­¥å‡ºç°é—®é¢˜æ—¶ï¼Œç­–ç•¥å¯èƒ½æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„è¿æ¥ä¹‹é—´çš„å¯¹ç­‰æ–¹æ²¡æœ‰åŠ å¯†èº«ä»½ï¼Œæ‚¨çš„ç³»ç»Ÿå°†ä¸å¾—ä¸ä»å¯èƒ½è¿‡æ—¶æˆ–ä¸å®Œæ•´çš„èº«ä»½ç¼“å­˜ä¸­è·å–èº«ä»½ã€‚\n\nå°†èº«ä»½æ˜ å°„åˆ°å·¥ä½œè´Ÿè½½ IP çš„è¿™äº›èº«ä»½ç¼“å­˜ä¸æ˜¯ ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼‰ï¼Œæ‚¨å¸Œæœ›æ‚¨çš„å®‰å…¨ç³»ç»Ÿåº”ç”¨äºå…·æœ‰å¼ºä¿è¯çš„äº‹ç‰©ã€‚è€ƒè™‘ä»¥ä¸‹å±æ€§å’Œæ‚¨å¯èƒ½æƒ³è¦é—®è‡ªå·±çš„é—®é¢˜ï¼š\n\n- è¿‡æ—¶ï¼šå¯¹ç­‰æ–¹å¦‚ä½•éªŒè¯ç¼“å­˜ä¸­çš„æ¡ç›®æ˜¯å¦æ˜¯**å½“å‰**çš„ï¼Ÿ\n- ä¸å®Œæ•´ï¼šå¦‚æœç¼“å­˜æœªå‘½ä¸­å¹¶ä¸”ç³»ç»Ÿæœªèƒ½å…³é—­è¿æ¥ï¼Œåªæœ‰ç¼“å­˜**åŒæ­¥å™¨**å¤±è´¥æ—¶ç½‘ç»œæ‰ä¼šå˜å¾—ä¸ç¨³å®šå—ï¼Ÿ\n- å¦‚æœæŸä¸ªä¸œè¥¿æ ¹æœ¬æ²¡æœ‰ IP æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒAWS Lambda æœåŠ¡æ²¡æœ‰å…¬å…± IPã€‚\n- éäº‹åŠ¡æ€§ï¼šå¦‚æœæ‚¨è¯»å–ä¸¤æ¬¡èº«ä»½ï¼Œä¼šçœ‹åˆ°ç›¸åŒçš„å€¼å—ï¼Ÿå¦‚æœåœ¨è®¿é—®ç­–ç•¥æˆ–å®¡è®¡å®æ–½ä¸­ä¸å°å¿ƒï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´çœŸæ­£çš„é—®é¢˜ã€‚\n- è°å°†å®ˆæŠ¤å®ˆæŠ¤è€…è‡ªå·±ï¼Ÿæ˜¯å¦æœ‰æ—¢å®šçš„å®è·µæ¥ä¿æŠ¤ç¼“å­˜ï¼Œå°±åƒ CA æœ‰çš„é‚£æ ·ï¼Ÿæ‚¨æœ‰ä»€ä¹ˆè¯æ®è¯æ˜ç¼“å­˜æ²¡æœ‰è¢«ç¯¡æ”¹å—ï¼Ÿæ‚¨æ˜¯å¦è¢«è¿«å¯¹ä¸€äº›ä¸æ˜¯æ‚¨çš„ CA çš„å¤æ‚åŸºç¡€è®¾æ–½çš„å®‰å…¨æ€§è¿›è¡Œæ¨ç†ï¼ˆå’Œå®¡è®¡ï¼‰ï¼Ÿ\n\nä»¥ä¸Šé—®é¢˜ä¸­æœ‰äº›æ¯”å…¶ä»–é—®é¢˜æ›´ç³Ÿã€‚æ‚¨å¯ä»¥åº”ç”¨**å¤±è´¥å…³é—­**åŸåˆ™ï¼Œä½†è¿™å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ã€‚\n\nèº«ä»½ä¹Ÿç”¨äºæ‰§è¡Œè®¿é—®ç­–ç•¥ï¼Œä¾‹å¦‚æˆæƒç­–ç•¥ï¼Œè¿™äº›è®¿é—®ç­–ç•¥åœ¨è¯·æ±‚è·¯å¾„ä¸­ï¼Œæ‚¨çš„ç³»ç»Ÿå¿…é¡»å¿«é€Ÿåšå‡ºå†³å®šï¼Œå…è®¸æˆ–æ‹’ç»è®¿é—®ã€‚æ¯å½“èº«ä»½å‡ºç°é”™è¯¯æ—¶ï¼Œè®¿é—®ç­–ç•¥å¯èƒ½ä¼šè¢«ç»•è¿‡ï¼Œè€Œæ— æ³•è¢«æ£€æµ‹æˆ–å®¡è®¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„èº«ä»½ç¼“å­˜å¯èƒ½å°†æ‚¨çš„\u0060checkout\u0060 pod çš„å…ˆå‰åˆ†é…çš„ IP åœ°å€ä½œä¸º\u0060checkout\u0060èº«ä»½ä¹‹ä¸€ã€‚å¦‚æœ\u0060checkout\u0060 pod è¢«å›æ”¶ï¼ŒåŒä¸€ IP åœ°å€åˆšåˆšè¢«åˆ†é…ç»™ä¸€ä¸ª\u0060frontend\u0060 podï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜æ›´æ–°ä¹‹å‰ï¼Œè¯¥\u0060frontend\u0060 pod å¯èƒ½å…·æœ‰\u0060checkout\u0060çš„èº«ä»½ï¼Œè¿™å¯èƒ½å¯¼è‡´é”™è¯¯çš„è®¿é—®ç­–ç•¥è¢«æ‰§è¡Œã€‚\n\nè®©æˆ‘ä»¬å‡è®¾ä»¥ä¸‹å¤§è§„æ¨¡å¤šé›†ç¾¤éƒ¨ç½²ï¼Œè¯´æ˜èº«ä»½ç¼“å­˜è¿‡æ—¶é—®é¢˜ï¼š\n\n1. 100 ä¸ªé›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤æœ‰ 100 ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ 20 ä¸ª podã€‚æ€»çš„ pod æ•°é‡æ˜¯ 200,000ã€‚\n2. 0.25% çš„ pod ä¸€ç›´åœ¨å˜åŠ¨ï¼ˆæ»šåŠ¨æ›´æ–°ï¼Œé‡å¯ï¼Œæ¢å¤ï¼ŒèŠ‚ç‚¹å˜åŠ¨ç­‰ï¼‰ï¼Œæ¯æ¬¡å˜åŠ¨çš„çª—å£æ˜¯ 10 ç§’ã€‚\n3. æ¯ 10 ç§’æœ‰ 500 ä¸ªæ­£åœ¨å˜åŠ¨çš„ pod åˆ†å¸ƒåˆ° 10,000 ä¸ªèŠ‚ç‚¹ï¼ˆç¼“å­˜ï¼‰ã€‚\n4. å¦‚æœç¼“å­˜åŒæ­¥å™¨åœæ»ï¼Œç³»ç»Ÿåœ¨ 5 åˆ†é’Ÿåè¿‡æ—¶çš„%å¯èƒ½é«˜è¾¾**7.5%**ï¼\n\nä»¥ä¸Šå‡è®¾ç¼“å­˜åŒæ­¥å™¨å¤„äºç¨³æ€ã€‚å¦‚æœç¼“å­˜åŒæ­¥å™¨å‡ºç°é—®é¢˜ï¼Œä¼šå½±å“å…¶å¥åº·æ£€æŸ¥ï¼Œå¢åŠ å˜åŠ¨ç‡ï¼Œå¯¼è‡´çº§è”ä¸ç¨³å®šã€‚\n\nCA ä¹Ÿå¯èƒ½è¢«æ”»å‡»è€…[æ”»å‡»](https:\/\/en.wikipedia.org\/wiki\/Certificate_authority#CA_compromise)ï¼Œæ”»å‡»è€…å‡è£…æ˜¯åˆ«äººï¼Œæ¬ºéª— CA å‘å‡ºè¯ä¹¦ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è¯ä¹¦ä¸å…¶ä»–å¯¹ç­‰æ–¹é€šä¿¡ã€‚è¿™æ˜¯[è¯ä¹¦æ’¤é”€](https:\/\/en.wikipedia.org\/wiki\/Certificate_authority#Certificate_revocation)å¯ä»¥é€šè¿‡æ’¤é”€è¯ä¹¦ä½¿å…¶æ— æ•ˆæ¥è§£å†³é—®é¢˜ã€‚å¦åˆ™ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¢«æ”»å‡»çš„è¯ä¹¦ç›´åˆ°å…¶è¿‡æœŸã€‚ä¿æŒæ ¹è¯ä¹¦çš„ç§é’¥åœ¨ HSM ä¸­è‡³å…³é‡è¦ï¼Œè¯¥ HSM åº”ä¿æŒ[ç¦»çº¿](https:\/\/en.wikipedia.org\/wiki\/Online_and_offline)ï¼Œå¹¶ä½¿ç”¨ä¸­é—´è¯ä¹¦ç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ã€‚åœ¨ CA åœé¡¿æˆ–åœæ» 5 åˆ†é’Ÿçš„æƒ…å†µä¸‹ï¼Œæ‚¨å°†æ— æ³•è·å¾—æ–°çš„æˆ–ç»­æœŸçš„å·¥ä½œè´Ÿè½½è¯ä¹¦ï¼Œä½†ä¹‹å‰å‘å‡ºçš„æœ‰æ•ˆè¯ä¹¦å°†ç»§ç»­ä¸ºæ‚¨çš„å·¥ä½œè´Ÿè½½æä¾›å¼ºå¤§çš„èº«ä»½ä¿è¯ã€‚ä¸ºäº†æé«˜å‘è¡Œçš„å¯é æ€§ï¼Œæ‚¨å¯ä»¥å°†ä¸­é—´ CA éƒ¨ç½²åˆ°ä¸åŒçš„åŒºåŸŸå’Œåœ°åŒºã€‚\n\n## Istio ä¸­çš„ mTLS\n\n### å¯ç”¨ mTLS\n\nåœ¨ Istio ä¸­ä¸ºå†…ç½‘åº”ç”¨ç¨‹åºå¯ç”¨ mTLS éå¸¸ç®€å•ã€‚æ‚¨éœ€è¦åšçš„å°±æ˜¯å°†æ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ åˆ°ç½‘æ ¼ä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡ä¸ºæ‚¨çš„å‘½åç©ºé—´æ ‡è®°ä¾§è½¦æ³¨å…¥æˆ–ç¯å¢ƒæ¥å®Œæˆã€‚åœ¨ä¾§è½¦çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿›è¡Œæ»šåŠ¨é‡å¯ï¼Œä»¥ä¾¿ä¾§è½¦è¢«æ³¨å…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åº pod ä¸­ã€‚\n\n### åŠ å¯†èº«ä»½\n\nåœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œ[Istio](https:\/\/istio.io\/latest\/docs\/concepts\/security\/#istio-identity)æ ¹æ®å…¶æœåŠ¡å¸æˆ·åˆ›å»ºåº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚å°†åº”ç”¨ç¨‹åºæ·»åŠ åˆ°ç½‘æ ¼åï¼Œå°†å‘ç½‘æ ¼ä¸­çš„æ¯ä¸ªåº”ç”¨ç¨‹åº pod æä¾›èº«ä»½è¯ä¹¦ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨çš„ pod çš„èº«ä»½è¯ä¹¦åœ¨ 24 å°æ—¶åè¿‡æœŸï¼ŒIstio æ¯ 12 å°æ—¶æ—‹è½¬ä¸€æ¬¡ pod èº«ä»½è¯ä¹¦ï¼Œä»¥ä¾¿åœ¨å‡ºç°å¦¨å®³è¡Œä¸ºçš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œè¢«æ”»å‡»çš„ CA æˆ–è¢«ç›—çš„ pod çš„ç§é’¥ï¼‰ï¼Œè¢«æ”»å‡»çš„è¯ä¹¦åªèƒ½åœ¨è¯ä¹¦è¿‡æœŸå¹¶å› æ­¤é™åˆ¶å…¶å¯èƒ½é€ æˆçš„æŸå®³çš„éå¸¸æœ‰é™çš„æ—¶é—´å†…å·¥ä½œã€‚\n\n### å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ mTLS\n\né»˜è®¤çš„ mTLS è¡Œä¸ºæ˜¯å°½å¯èƒ½ä½¿ç”¨ mTLSï¼Œä½†å¹¶ä¸å¼ºåˆ¶æ‰§è¡Œã€‚è¦ä¸¥æ ¼å¼ºåˆ¶æ‚¨çš„åº”ç”¨ç¨‹åºåªæ¥å— mTLS æµé‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Istio çš„[PeerAuthentication](https:\/\/istio.io\/latest\/docs\/reference\/config\/security\/peer_authentication\/)ç­–ç•¥ï¼Œå¯¹æ•´ä¸ªç½‘æ ¼æˆ–æ¯ä¸ªå‘½åç©ºé—´æˆ–å·¥ä½œè´Ÿè½½è¿›è¡Œæ“ä½œã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åº”ç”¨ Istio çš„[AuthorizationPolicy](https:\/\/istio.io\/latest\/docs\/reference\/config\/security\/authorization-policy\/)æ¥æ§åˆ¶æ‚¨çš„å·¥ä½œè´Ÿè½½çš„è®¿é—®ã€‚\n\n### TLS ç‰ˆæœ¬\n\nTLS ç‰ˆæœ¬ 1.3 æ˜¯ Istio åœ¨å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡ä¸­çš„é»˜è®¤è®¾ç½®ï¼Œä½¿ç”¨ Envoy çš„[é»˜è®¤å¯†ç å¥—ä»¶](https:\/\/www.envoyproxy.io\/docs\/envoy\/latest\/api-v3\/extensions\/transport_sockets\/tls\/v3\/common.proto)ï¼ˆä¾‹å¦‚ï¼Œå¯¹äº Istio 1.19.0ï¼Œä¸º\u0060TLS_AES_256_GCM_SHA384\u0060ï¼‰ã€‚å¦‚æœæ‚¨éœ€è¦æ—§çš„ TLS ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥ä¸ºæ‚¨çš„å·¥ä½œè´Ÿè½½[é…ç½®ä¸åŒçš„ç½‘æ ¼èŒƒå›´å†…çš„æœ€å° TLS åè®®ç‰ˆæœ¬](https:\/\/istio.io\/latest\/docs\/tasks\/security\/tls-configuration\/workload-min-tls-version\/)ã€‚\n\n## ç»“æŸè¯­\n\nç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰åˆ¶å®šçš„ TLS åè®®æ˜¯å­˜åœ¨çš„æœ€å¹¿æ³›å®¡æŸ¥ã€ä¸“å®¶æ‰¹å‡†ã€ç»è¿‡æˆ˜æ–—æµ‹è¯•çš„æ•°æ®å®‰å…¨åè®®ä¹‹ä¸€ã€‚TLS ä¹Ÿåœ¨å…¨çƒå¹¿æ³›ä½¿ç”¨ - æ¯å½“æ‚¨è®¿é—®ä»»ä½•å®‰å…¨ç½‘ç«™ï¼Œæ‚¨éƒ½å¯ä»¥æ”¾å¿ƒè´­ç‰©ï¼Œéƒ¨åˆ†åŸå› æ˜¯å› ä¸ºé”å®šå›¾æ ‡è¡¨æ˜æ‚¨æ­£åœ¨ä½¿ç”¨ TLS å®‰å…¨è¿æ¥åˆ°å—ä¿¡ä»»çš„ç½‘ç«™ã€‚TLS 1.3 åè®®è®¾è®¡å…·æœ‰ç«¯åˆ°ç«¯çš„èº«ä»½éªŒè¯ã€ä¿å¯†æ€§å’Œå®Œæ•´æ€§ï¼Œä»¥ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºçš„èº«ä»½å’Œé€šä¿¡ä¸è¢«ç ´åï¼Œå¹¶é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼ˆå¹¶è¢«è®¤ä¸ºæ˜¯ç¬¦åˆæ ‡å‡†çš„ TLSï¼‰ï¼Œæ­£ç¡®éªŒè¯é€šä¿¡å¯¹ç­‰æ–¹å¹¶ä½¿ç”¨ä»æ¡æ‰‹åå•†çš„å¯†é’¥åŠ å¯†æµé‡ä¸ä»…é‡è¦ï¼Œè€Œä¸”è‡³å…³é‡è¦ã€‚ç°åœ¨æ‚¨çŸ¥é“ mTLS åœ¨æ»¡è¶³æ‚¨çš„å®‰å…¨åº”ç”¨ç¨‹åºé€šä¿¡è¦æ±‚ï¼ˆåŠ å¯†èº«ä»½ã€ä¿å¯†æ€§ã€å®Œæ•´æ€§å’Œè®¿é—®ç­–ç•¥æ‰§è¡Œï¼‰æ–¹é¢è¡¨ç°ä¼˜ç§€ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ä½¿ç”¨ Istio å°†æ‚¨çš„å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡å‡çº§åˆ° mTLS - é…ç½®éå¸¸å°‘ï¼\n\n*ç‰¹åˆ«æ„Ÿè°¢ Louis Ryanã€Ben Leggettã€John Howardã€Christian Postaã€Justin Pettit èŠ±è´¹å¤§é‡æ—¶é—´å®¡æŸ¥å’Œæå‡ºåšå®¢çš„æ›´æ–°ï¼*\n', '\/trans\/secure-apps-with-istio\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡è®¨è®ºäº†ä½¿ç”¨ç›¸äº’ TLS (mTLS) å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡çš„é‡è¦æ€§ã€‚mTLS æä¾›äº†ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ï¼Œåªæœ‰æºå’Œç›®æ ‡å¯ä»¥è§£å¯†æ•°æ®ï¼Œä»è€Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚ç„¶è€Œï¼Œå¦‚æœæºæˆ–ç›®æ ‡çš„èº«ä»½æ²¡æœ‰åŠ å¯†ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚Istio ä¸­çš„ mTLS å¯ä»¥ç®€å•åœ°å¯ç”¨ï¼Œå¹¶ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åº pod æä¾›èº«ä»½è¯ä¹¦ã€‚ä¸ºäº†å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ mTLSï¼Œå¯ä»¥ä½¿ç”¨ Istio çš„ PeerAuthentication ç­–ç•¥å’Œ AuthorizationPolicyã€‚æœ€åï¼ŒTLS åè®®æ˜¯æœ€å¹¿æ³›å®¡æŸ¥ã€ä¸“å®¶æ‰¹å‡†ã€ç»è¿‡æˆ˜æ–—æµ‹è¯•çš„æ•°æ®å®‰å…¨åè®®ä¹‹ä¸€ï¼ŒIstio é»˜è®¤åœ¨å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡ä¸­ä½¿ç”¨ TLS 1.3 ç‰ˆæœ¬ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/">ä½¿ç”¨ Argo é¡¹ç›® Istio åŠ SkyWalking å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/10/21</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä½¿ç”¨ Argo é¡¹ç›® Istio åŠ SkyWalking å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²', 'æœ¬æ–‡è®¨è®ºå¦‚ä½•ä½¿ç”¨ Kubernetes Deploymentã€Argo é¡¹ç›®å’Œ Istio æ¥å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚', '\n{{\u003ccallout note å…³äºæœ¬æ–‡\u003e}}\n\næœ¬æ–‡æ ¹æ®ç¬”è€…åœ¨ KubeCon\u0026CloudNativeCon China 2023 çš„é€šè¯ä»“æ´»åŠ¨ [IstioCon China](https:\/\/istioconchina2023.sched.com\/event\/1RoVG\/nano-argo-istio-re-skywalking-jiong-gitops-reqi-zha-yao-pi-how-to-achieve-the-perfect-union-of-gitops-and-observability-with-argo-istio-and-skywalking-jimmy-song-tetrate) ä¸Šçš„åˆ†äº«æ•´ç†è€Œæˆï¼ŒåŸæ ‡é¢˜ä¸ºã€Šå¦‚ä½•åœ¨ Argoã€Istio å’Œ SkyWalking ä¸­å®ç° GitOps å’Œå¯è§‚æµ‹æ€§çš„å®Œç¾ç»“åˆã€‹ã€‚\n\n{{\u003c\/callout\u003e}}\n\näº‘åŸç”Ÿåº”ç”¨çš„å‘å±•å¯¼è‡´å¼€å‘å·¦ç§»ï¼Œåº”ç”¨è¿­ä»£é¢‘ç‡æ›´é«˜ï¼Œè¿™å°±å‚¬ç”Ÿäº† GitOps çš„éœ€æ±‚ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Argo é¡¹ç›®ï¼ŒåŒ…æ‹¬ ArgoCD å’Œ Argo Rolloutsï¼Œé€šè¿‡ Istio å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚æ–‡ä¸­è¿˜æœ‰ä¸€ä¸ªæ¼”ç¤ºï¼Œå±•ç¤ºäº†å¦‚ä½•åŸºäº Tetrate Service Expressï¼ˆä¹Ÿé€‚ç”¨äº Tetrate Service Bridgeï¼‰æä¾›çš„ Istio ç¯å¢ƒå®ç° GitOpsã€‚\n\næœ¬æ–‡ demo çš„éƒ¨ç½²æ¶æ„å›¾å¦‚å›¾ 1 æ‰€ç¤ºã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰æœ¬æ–‡ä»‹ç»çš„éƒ¨ç½²ç­–ç•¥å’Œ Argo é¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥è·³åˆ° [demo éƒ¨åˆ†](#demo)ã€‚\n\n![å›¾ 1ï¼šåœ¨ TSE\/TSB ä¸­ä½¿ç”¨ Istio å’Œ Argo é¡¹ç›®å®ç° GitOps å’Œé‡‘ä¸é›€å‘å¸ƒçš„æ¶æ„å›¾](f1.svg)\n\n## éƒ¨ç½²ç­–ç•¥ {#deployment-strategy}\n\né¦–å…ˆï¼Œæˆ‘æƒ³ç®€å•ä»‹ç»ä¸€ä¸‹ Argo Rollouts æ”¯æŒçš„ä¸¤ç§éƒ¨ç½²ç­–ç•¥ï¼Œå¯ä»¥å®ç°é›¶åœæœºéƒ¨ç½²ã€‚\n\nè“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€éƒ¨ç½²çš„æ­¥éª¤å¦‚å›¾ 2 æ‰€ç¤ºã€‚\n\n![Figure 2: Steps of blue-green deployment and canary deployment](f2.svg)\n\n- è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§åœ¨å•ç‹¬çš„ç¯å¢ƒä¸­å¹¶è¡Œéƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºè€Œä¸å½±å“å½“å‰ç”Ÿäº§ç¯å¢ƒçš„ç­–ç•¥ã€‚åœ¨è“ç»¿éƒ¨ç½²ä¸­ï¼Œå½“å‰çš„ç”Ÿäº§ç¯å¢ƒç§°ä¸ºâ€œè“è‰²ç¯å¢ƒâ€ï¼Œéƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºçš„ç¯å¢ƒç§°ä¸ºâ€œç»¿è‰²ç¯å¢ƒâ€ã€‚ä¸€æ—¦ç»¿è‰²ç¯å¢ƒè¢«è®¤ä¸ºç¨³å®šå¹¶é€šè¿‡æµ‹è¯•ï¼Œæµé‡å°†é€æ¸ä»è“è‰²ç¯å¢ƒåˆ‡æ¢åˆ°ç»¿è‰²ç¯å¢ƒï¼Œè®©ç”¨æˆ·é€æ­¥æ¥å…¥æ–°ç‰ˆæœ¬ã€‚å¦‚æœåˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šåˆ°è“ç¯å¢ƒï¼Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“ã€‚è“ç»¿éƒ¨ç½²çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›é«˜å¯ç”¨æ€§å’Œé›¶åœæœºéƒ¨ç½²ã€‚\n- é‡‘ä¸é›€éƒ¨ç½²æ˜¯ä¸€ç§é€æ­¥å°†æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½å¼•å…¥ç”Ÿäº§ç¯å¢ƒçš„ç­–ç•¥ã€‚åœ¨é‡‘ä¸é›€éƒ¨ç½²ä¸­ï¼Œæ–°ç‰ˆæœ¬æˆ–æ–°åŠŸèƒ½é¦–å…ˆéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„å°‘æ•°ç”¨æˆ·ï¼Œç§°ä¸ºâ€œé‡‘ä¸é›€ç”¨æˆ·â€ã€‚é€šè¿‡ç›‘æ§é‡‘ä¸é›€ç”¨æˆ·çš„åé¦ˆå’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥è¯„ä¼°æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥é€æ­¥å°†æ›´å¤šç”¨æˆ·çº³å…¥é‡‘ä¸é›€éƒ¨ç½²ä¸­ï¼Œç›´åˆ°æ‰€æœ‰ç”¨æˆ·éƒ½ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚å¦‚æœå‘ç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šæˆ–ä¿®å¤ï¼Œé¿å…å¯¹æ•´ä¸ªç”¨æˆ·ç¾¤é€ æˆè´Ÿé¢å½±å“ã€‚é‡‘ä¸é›€éƒ¨ç½²çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å¿«é€Ÿå‘ç°é—®é¢˜å¹¶åœ¨å½±å“è¾ƒå°çš„èŒƒå›´å†…è¿›è¡Œè°ƒæ•´ã€‚\n\nè“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€éƒ¨ç½²çš„ä¸»è¦åŒºåˆ«åœ¨äºéƒ¨ç½²æ–¹å¼å’Œå˜æ›´è§„æ¨¡ã€‚è“ç»¿éƒ¨ç½²æ˜¯å°†æ•´ä¸ªåº”ç”¨éƒ¨ç½²åœ¨æ–°çš„ç¯å¢ƒä¸­ï¼Œç„¶åè¿›è¡Œåˆ‡æ¢ï¼Œé€‚åˆå¤§è§„æ¨¡çš„å˜æ›´ï¼Œæ¯”å¦‚æ•´ä¸ªåº”ç”¨çš„é‡å¤§å‡çº§ã€‚é‡‘ä¸é›€éƒ¨ç½²é€æ¸å¼•å…¥æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½ï¼Œé€‚åˆå°è§„æ¨¡æ›´æ”¹ï¼Œä¾‹å¦‚æ·»åŠ æˆ–ä¿®æ”¹å•ä¸ªåŠŸèƒ½ã€‚\n\nä»åº”ç”¨åœºæ™¯æ¥çœ‹ï¼Œè“ç»¿éƒ¨ç½²é€‚åˆå¯¹é«˜å¯ç”¨ã€é›¶å®•æœºéƒ¨ç½²è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿã€‚åœ¨éƒ¨ç½²å¤§è§„æ¨¡å˜æ›´æ—¶ï¼Œè“ç»¿éƒ¨ç½²å¯ä»¥ä¿è¯ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿå›æ»šä»¥åº”å¯¹çªå‘æƒ…å†µã€‚é‡‘ä¸é›€éƒ¨ç½²é€‚åˆéœ€è¦å¿«é€ŸéªŒè¯æ–°åŠŸèƒ½æˆ–ç‰ˆæœ¬çš„ç³»ç»Ÿã€‚é€šè¿‡é€æ­¥å¼•å…¥å˜æ›´ï¼Œå¯ä»¥åŠæ—©å‘ç°é—®é¢˜å¹¶è¿›è¡Œè°ƒæ•´ï¼Œå°½é‡å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“ã€‚\n\n## Kubernetes Deployment çš„å‘å¸ƒç­–ç•¥ {#kuberentes-deployment}\n\nåœ¨ Kubernetes ä¸­ï¼ŒDeployment èµ„æºå¯¹è±¡æ˜¯ç®¡ç†åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œæ›´æ–°çš„ä¸»è¦å·¥å…·ä¹‹ä¸€ã€‚éƒ¨ç½²æä¾›äº†ä¸€ç§å£°æ˜å¼æ–¹å¼æ¥å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸçŠ¶æ€ï¼Œå¹¶é€šè¿‡æ§åˆ¶å™¨çš„åŠŸèƒ½å®ç°å‘å¸ƒç­–ç•¥ã€‚Deployment çš„æ¶æ„å¦‚å›¾ 3 æ‰€ç¤ºï¼Œå…¶ä¸­å½©è‰²æ–¹å—ä»£è¡¨ä¸åŒç‰ˆæœ¬çš„ Podã€‚\n\n![å›¾ 3ï¼šKubernetes Deployment æ¶æ„å›¾](f3.svg)\n\nå‘å¸ƒç­–ç•¥å¯ä»¥åœ¨ Deployment çš„ spec å­—æ®µä¸­é…ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å‘å¸ƒç­–ç•¥é€‰é¡¹ï¼š\n\n1. ReplicaSet çš„ç®¡ç†ï¼šDeployment ä½¿ç”¨ ReplicaSet æ¥åˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å‰¯æœ¬ã€‚å¯ä»¥é€šè¿‡è®¾ç½® \u0060spec.replicas\u0060 å­—æ®µæ¥æŒ‡å®šæ‰€éœ€çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ï¼ŒKubernetes æ§åˆ¶å™¨ä¿è¯æ–°ç‰ˆæœ¬ ReplicaSet çš„å‰¯æœ¬æ•°é‡åœ¨åˆ›å»ºæ—¶é€æ¸å¢åŠ ï¼Œæ—§ç‰ˆæœ¬ ReplicaSet çš„å‰¯æœ¬æ•°é‡åœ¨åˆ é™¤æ—¶é€æ¸å‡å°‘ï¼Œå®ç°å¹³æ»‘åˆ‡æ¢ã€‚\n2. æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼šéƒ¨ç½²æ”¯æŒå¤šç§æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® \u0060spec.strategy.type\u0060 å­—æ®µæ¥é€‰æ‹©ã€‚å¸¸è§æ”¿ç­–åŒ…æ‹¬ï¼š\n   - \u0060RollingUpdate\u0060ï¼šé»˜è®¤ç­–ç•¥ä»¥ä¸€å®šçš„æ—¶é—´é—´éš”é€æ¸æ›´æ–°å‰¯æœ¬ã€‚ä¸åŒæ—¶å¯ç”¨çš„å‰¯æœ¬æ•°é‡ä»¥åŠé¢å¤–å¯ç”¨çš„å‰¯æœ¬æ•°é‡å¯ä»¥é€šè¿‡è®¾ç½® \u0060spec.strategy.rollingUpdate.maxUnavailable\u0060 å’Œ \u0060spec.strategy.rollingUpdate.maxSurge\u0060 å­—æ®µæ¥æ§åˆ¶ã€‚\n   - \u0060ReCreate\u0060ï¼šè¯¥ç­–ç•¥åœ¨æ›´æ–°è¿‡ç¨‹ä¸­é¦–å…ˆåˆ é™¤æ—§ç‰ˆæœ¬çš„æ‰€æœ‰å‰¯æœ¬ï¼Œç„¶ååˆ›å»ºæ–°ç‰ˆæœ¬çš„å‰¯æœ¬ã€‚æ­¤ç­–ç•¥å°†å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨æ›´æ–°æœŸé—´æš‚æ—¶ä¸å¯ç”¨ã€‚\n3. ç‰ˆæœ¬æ§åˆ¶ï¼šDeployment é€šè¿‡ \u0060spec.template.metadata.labels\u0060 å­—æ®µä¸ºæ¯ä¸ªç‰ˆæœ¬çš„ ReplicaSet è®¾ç½®æ ‡ç­¾ï¼Œä»¥ä¾¿æ§åˆ¶å™¨å‡†ç¡®è·Ÿè¸ªå’Œç®¡ç†ã€‚è¿™æ · ReplicaSet çš„å¤šä¸ªç‰ˆæœ¬å¯ä»¥å…±å­˜ï¼Œå¹¶ä¸”å¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªç‰ˆæœ¬çš„å‰¯æœ¬æ•°é‡ã€‚\n\né€šè¿‡ä½¿ç”¨è¿™äº›é…ç½®é€‰é¡¹ï¼ŒDeployment å¯ä»¥å®ç°ä¸åŒçš„å‘å¸ƒç­–ç•¥ã€‚æ›´æ–° Deployment å¯¹è±¡çš„ spec å­—æ®µå¯ä»¥è§¦å‘æ–°ç‰ˆæœ¬çš„å‘å¸ƒã€‚Kubernetes æ§åˆ¶å™¨ä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥è‡ªåŠ¨å¤„ç†å‰¯æœ¬çš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ï¼Œä»¥å®ç°å¹³æ»‘çš„åº”ç”¨æ›´æ–°å’Œéƒ¨ç½²ç­–ç•¥ã€‚\n\n## ä½¿ç”¨ ArgoCD å®æ–½ GitOps {#argocd-gitops}\n\nå¯ä»¥ä½¿ç”¨ Deployment æ¥æ‰‹åŠ¨ç®¡ç†å‘å¸ƒç­–ç•¥ï¼Œä½†è¦å®ç°è‡ªåŠ¨åŒ–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ ArgoCD ç­‰ GitOps å·¥å…·ã€‚\n\nArgoCD æ˜¯ä¸€ä¸ªåŸºäº GitOps çš„æŒç»­äº¤ä»˜å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–å’Œç®¡ç† Kubernetes åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚å®ƒä¸ºæé«˜åº”ç”¨ç¨‹åºéƒ¨ç½²çš„æ•ˆç‡å’Œå¯é æ€§æä¾›äº†ä¸€äº›å…³é”®çš„å¸®åŠ©ã€‚\n\nä»¥ä¸‹æ˜¯ ArgoCD ä¸º Kubernetes åº”ç”¨ç¨‹åºéƒ¨ç½²æä¾›çš„ä¸€äº›å¸®åŠ©ï¼š\n\n1. **å£°æ˜å¼é…ç½®**ï¼šArgoCD ä½¿ç”¨å£°æ˜å¼æ–¹å¼å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸçŠ¶æ€ï¼Œå¹¶å°†åº”ç”¨ç¨‹åºé…ç½®å­˜å‚¨åœ¨ Git å­˜å‚¨åº“ä¸­ã€‚é€šè¿‡ç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆ\/æŒç»­äº¤ä»˜ (CI\/CD) æµç¨‹ï¼Œå¯ä»¥è½»æ¾è·Ÿè¸ªå’Œç®¡ç†åº”ç”¨ç¨‹åºé…ç½®æ›´æ”¹ã€‚\n2. **æŒç»­éƒ¨ç½²**ï¼šArgoCD å¯ä»¥ç›‘æ§ Git å­˜å‚¨åº“ä¸­çš„é…ç½®å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒã€‚æä¾›å¯å®šåˆ¶çš„åŒæ­¥ç­–ç•¥ï¼Œè‡ªåŠ¨è§¦å‘åº”ç”¨éƒ¨ç½²å’Œæ›´æ–°ï¼Œå®ç°æŒç»­éƒ¨ç½²ã€‚\n3. **çŠ¶æ€æ¯”è¾ƒå’Œè‡ªåŠ¨ä¿®å¤**ï¼šArgoCD å®šæœŸæ£€æŸ¥åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€å¹¶å°†å…¶ä¸é¢„æœŸçŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå‘ç°ä¸ä¸€è‡´ï¼Œå®ƒä¼šè‡ªåŠ¨å°è¯•ä¿®å¤å¹¶å°†åº”ç”¨ç¨‹åºæ¢å¤åˆ°æ‰€éœ€çŠ¶æ€ï¼Œä»¥ç¡®ä¿é¢„æœŸçŠ¶æ€ä¸å®é™…çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚\n4. **å¤šç¯å¢ƒç®¡ç†**ï¼šArgoCD æ”¯æŒç®¡ç†å¤šä¸ª Kubernetes ç¯å¢ƒï¼Œä¾‹å¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒã€‚å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒç¯å¢ƒä¹‹é—´éƒ¨ç½²å’ŒåŒæ­¥åº”ç”¨é…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§å’Œå¯æ§æ€§ã€‚\n\nä¸ Deployment èµ„æºå¯¹è±¡ç›¸æ¯”ï¼ŒArgoCD æä¾›äº†æ›´é«˜çº§çš„åŠŸèƒ½å’Œå·¥ä½œæµç¨‹ï¼Œè¡¥å……äº†åŸç”Ÿ Kubernetes èµ„æºå¯¹è±¡çš„åŠŸèƒ½ï¼š\n\n- **åŸºäº GitOps çš„é…ç½®ç®¡ç†**ï¼šArgoCD å°†åº”ç”¨ç¨‹åºé…ç½®å­˜å‚¨åœ¨ Git å­˜å‚¨åº“ä¸­ï¼Œä»è€Œå®ç°åŸºäº GitOps çš„é…ç½®ç®¡ç†ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿é…ç½®æ›´æ”¹æ˜¯å¯è·Ÿè¸ªã€å¯å®¡è®¡çš„ï¼Œå¹¶ä¸”å¯ä»¥ä¸ç°æœ‰çš„ CI\/CD ç®¡é“é›†æˆã€‚\n\n- **è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜**ï¼šArgoCD å¯ä»¥è‡ªåŠ¨æ£€æµ‹ Git å­˜å‚¨åº“ä¸­çš„é…ç½®æ›´æ”¹å¹¶å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒï¼Œä»è€Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜ã€‚\n\n- **çŠ¶æ€ç®¡ç†å’Œè‡ªåŠ¨æ¢å¤**ï¼šArgoCD æŒç»­ç›‘æ§åº”ç”¨ç¨‹åºçš„çŠ¶æ€å¹¶å°†å…¶ä¸é¢„æœŸçŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼Œå®ƒä¼šè‡ªåŠ¨æ¢å¤å¹¶ç¡®ä¿åº”ç”¨ç¨‹åºçŠ¶æ€ä¸é¢„æœŸçŠ¶æ€ä¿æŒä¸€è‡´ã€‚\n\n## ä½¿ç”¨ Istio å®ç°ç»†ç²’åº¦çš„æµé‡è·¯ç”± {#istio-routing-traffic}\n\nè™½ç„¶ ArgoCD å¯ä»¥å®ç° GitOpsï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯åœ¨ Kubernetes éƒ¨ç½²ä¸Šè¿è¡Œå¹¶é€šè¿‡å‰¯æœ¬æ•°é‡æ§åˆ¶æµé‡è·¯ç”±ã€‚ä¸ºäº†å®ç°ç»†ç²’åº¦çš„æµé‡è·¯ç”±ï¼Œä½¿ç”¨äº† Istio ç­‰æœåŠ¡ç½‘æ ¼ã€‚\n\nIstio é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°æ›´ç»†ç²’åº¦çš„æµé‡è·¯ç”±å’Œåº”ç”¨å‘å¸ƒï¼š\n\n**VirtualService**ï¼šIstio ä½¿ç”¨ VirtualService æ¥å®šä¹‰æµé‡è·¯ç”±è§„åˆ™ã€‚é€šè¿‡é…ç½® VirtualServiceï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚å¤´ã€è·¯å¾„ã€æƒé‡ç­‰è¯·æ±‚å±æ€§å¯¹æµé‡è¿›è¡Œè·¯ç”±å’Œåˆ†å‘ï¼Œå°†è¯·æ±‚å®šå‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹æˆ–ç‰ˆæœ¬ã€‚\n\n**DestinationRule**ï¼šIstio çš„ DestinationRule ç”¨äºå®šä¹‰æœåŠ¡ç‰ˆæœ¬ç­–ç•¥å’Œè´Ÿè½½å‡è¡¡è®¾ç½®ã€‚é€šè¿‡æŒ‡å®šä¸åŒç‰ˆæœ¬æœåŠ¡å®ä¾‹ä¹‹é—´ä¸åŒçš„æµé‡æƒé‡ï¼Œå¯ä»¥å®ç°é‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ç­‰é«˜çº§åº”ç”¨å‘å¸ƒç­–ç•¥ã€‚\n\n**æµé‡æ§åˆ¶å’Œç­–ç•¥**ï¼šIstio æä¾›äº†ä¸°å¯Œçš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›ï¼Œå¦‚æµé‡é™åˆ¶ã€æ•…éšœæ³¨å…¥ã€è¶…æ—¶è®¾ç½®ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°æ›´é«˜çº§åˆ«çš„è´Ÿè½½å‡è¡¡ã€å®¹é”™å’Œå¯é æ€§è¦æ±‚ã€‚\n\nä¸ ArgoCD å’Œ Kubernetes Deployment å¯¹è±¡ç›¸æ¯”ï¼ŒIstio åœ¨åº”ç”¨éƒ¨ç½²æ–¹é¢æä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\n**ç»†ç²’åº¦çš„æµé‡è·¯ç”±æ§åˆ¶**ï¼šIstio æä¾›äº†æ›´ä¸°å¯Œçš„æµé‡è·¯ç”±èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®å¤šç§è¯·æ±‚å±æ€§è¿›è¡Œçµæ´»çš„è·¯ç”±å’Œåˆ†å‘ï¼Œä»è€Œå®ç°æ›´ç»†ç²’åº¦çš„æµé‡æ§åˆ¶å’Œç®¡ç†ã€‚\n\n**é«˜çº§å‘å¸ƒç­–ç•¥æ”¯æŒ**ï¼šIstio çš„ DestinationRule å¯ä»¥æŒ‡å®šä¸åŒç‰ˆæœ¬æœåŠ¡å®ä¾‹ä¹‹é—´çš„æµé‡æƒé‡ï¼Œæ”¯æŒé‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ç­‰é«˜çº§åº”ç”¨å‘å¸ƒç­–ç•¥ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæ›´åŠ çµæ´»å¯æ§ã€‚\n\n**å¼ºå¤§çš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›**ï¼šIstio æä¾›äº†ä¸°å¯Œçš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›ï¼Œå¦‚æµé‡é™åˆ¶ã€æ•…éšœæ³¨å…¥ã€è¶…æ—¶è®¾ç½®ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°æ›´é«˜çº§åˆ«çš„è´Ÿè½½å‡è¡¡ã€å®¹é”™å’Œå¯é æ€§è¦æ±‚ã€‚\n\nå°† Istio ä¸ Argo Rollouts ç›¸ç»“åˆï¼Œå¯ä»¥å……åˆ†å‘æŒ¥ Istio ç»†ç²’åº¦æµé‡è·¯ç”±çš„ä¼˜åŠ¿ã€‚ç°åœ¨è®©æˆ‘ä»¬ä¸€èµ·è¿›è¡Œæ¼”ç¤ºã€‚åœ¨æˆ‘ä»¬çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ TSE æä¾›çš„ Kubernetes å’Œ Istio ç¯å¢ƒï¼Œä½¿ç”¨ ArgoCD å®ç° GitOpsï¼Œå¹¶ä½¿ç”¨ Argo Rollouts å®ç°é‡‘ä¸é›€å‘å¸ƒã€‚\n\n## Demo\n\næˆ‘ä»¬çš„æ¼”ç¤ºä¸­ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯ï¼š\n\n-  Kubernetes v1.24.14\n-  Istio v1.15.7\n-  Argo CD v2.7.4\n-  Argo å‘å¸ƒ v1.5.1\n-  TSE Preview 2\n\næˆ‘ä»¬å°†ä½¿ç”¨ Istio çš„ VirtualService å’Œ DestinationRule æ¥å®ç°åŸºäº Subset çš„æµé‡åˆ†ç»„è·¯ç”±ï¼Œå¹¶ä½¿ç”¨ ArgoCD Rollouts è¿›è¡Œæ¸è¿›å¼å‘å¸ƒã€‚\n\n### éƒ¨ç½² ArgoCD å’Œ Argo Rollouts {#deployment-argocd-and-rollouts}\n\næˆ‘æå‰åˆ›å»ºäº†ä¸€ä¸ª Kubernetes é›†ç¾¤å¹¶å°†å…¶æ·»åŠ åˆ° TSE ä¸­ï¼ŒTSE ä¼šè‡ªåŠ¨ä¸ºé›†ç¾¤å®‰è£… Istio æ§åˆ¶å¹³é¢ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®‰è£… ArgoCD å’Œ Argo Rolloutsï¼š\n\n\u0060\u0060\u0060bash\n# Install ArgoCD\nkubectl create namespace argocd\nkubectl apply -n argocd -f https:\/\/raw.githubusercontent.com\/argoproj\/argo-cd\/stable\/manifests\/install.yaml\n\n# Install ArgoCD CLI on macOS\nbrew install argocd\n\n# Change the service type of argocd-server to LoadBalancer\nkubectl patch svc argocd-server -n argocd -p \u0027{\u0022spec\u0022: {\u0022type\u0022: \u0022LoadBalancer\u0022}}\u0027\n\n# Get the ArgoCD UI address\nARGOCD_ADDR=$(kubectl get svc argocd-server -n argocd -o jsonpath=\u0027{.status.loadBalancer.ingress[0].hostname}\u0027)\n\n# Login using ArgoCD CLI, see https:\/\/argo-cd.readthedocs.io\/en\/stable\/getting_started\/#4-login-using-the-cli to get password\nargocd login $ARGOCD_ADDR --skip-test-tls --grpc-web --insecure\n\n# Install Argo Rollouts\nkubectl create namespace argo-rollouts\nkubectl apply -n argo-rollouts -f https:\/\/github.com\/argoproj\/argo-rollouts\/releases\/download\/latest\/install.yaml\n\n# Install rollouts plugin on macOS\ncurl -LO https:\/\/github.com\/argoproj\/argo-rollouts\/releases\/download\/v1.5.0\/kubectl-argo-rollouts-darwin-amd64\nchmod \u002bx .\/kubectl-argo-rollouts-darwin-amd64\nsudo mv .\/kubectl-argo-rollouts-darwin-amd64 \/usr\/local\/bin\/kubectl-argo-rollouts\n\u0060\u0060\u0060\n\nè¯¥åŠŸèƒ½ä¸é€‚ç”¨äº TSE Bridge Modeï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨ TSE Direct Mode æ¥å®ç°æ¸è¿›å¼å‘å¸ƒã€‚\n\n{{\u003ccallout note \u0022ğŸ’¡ä»€ä¹ˆæ˜¯æ¡¥æ¥æ¨¡å¼å’Œç›´æ¥æ¨¡å¼ï¼Ÿ\u0022\u003e}}\n\n\nç›´æ¥æ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼æ˜¯ TSE ä¸­æ§åˆ¶å¹³é¢ä¸‹å‘é…ç½®çš„ä¸¤ç§æ¨¡å¼ã€‚é€‚ç”¨äºæµé‡ã€å®‰å…¨ã€ç½‘å…³ç»„é…ç½®æ¨¡å¼ã€‚BRIDGED æ¨¡å¼æ˜¯ä¸€ç§æç®€æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ Tetrate ç‰¹å®šçš„ API å¿«é€Ÿé…ç½®æœåŠ¡ç½‘æ ¼ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œè€Œ DIRECT æ¨¡å¼ä¸ºé«˜çº§ç”¨æˆ·æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸ä»–ä»¬ç›´æ¥ä½¿ç”¨ Istio API è¿›è¡Œé…ç½®ã€‚\n\n{{\u003c\/callout\u003e}}\n\næ¥ä¸‹æ¥ï¼Œéƒ¨ç½² Rollouts Dashboardï¼š\n\n\u0060\u0060\u0060bash\ngit clone https:\/\/github.com\/argoproj\/argo-rollouts.git\nkustomize build manifests\/dashboard-install|kubectl apply -n argo-rollouts -f -\nkubectl port-forward svc\/argo-rollouts-dashboard -n argo-rollouts 3100:3100\n\u0060\u0060\u0060\n\næ‚¨ç°åœ¨å¯ä»¥é€šè¿‡ \u003chttps:\/\/localhost:3100\/rollouts\/\u003e è®¿é—® Rollouts ä»ªè¡¨æ¿ã€‚\n\n### éƒ¨ç½² Bookinfo åº”ç”¨ {#bookinfo}\n\næˆ‘ä»¬å·²ç»ä¸º Bookinfo åº”ç”¨ç¨‹åºå‡†å¤‡äº†é…ç½®æ–‡ä»¶ï¼ˆä¿å­˜åœ¨ [tse-gitops-demo](https:\/\/github.com\/tetrateio\/tse-gitops-demo\/) å­˜å‚¨åº“ä¸­ï¼‰ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†å…¶ fork åˆ°æ‚¨è‡ªå·±çš„å¸æˆ·å¹¶å°†å…¶æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å­˜å‚¨åº“ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½² Bookinfo åº”ç”¨ç¨‹åºï¼š\n\n\u0060\u0060\u0060bash\nargocd app create bookinfo-app --repo https:\/\/github.com\/tetrateio\/tse-gitops-demo.git --path application --dest-server https:\/\/kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated\n\u0060\u0060\u0060\n\næ³¨æ„ï¼šæˆ‘ä»¬åœ¨ [\u0060reviews\u0060 éƒ¨ç½²](https:\/\/github.com\/tetrateio\/tse-gitops-demo\/blob\/main\/application\/bookinfo.yaml#L151)ä¸­å°† \u0060replicas\u0060 è®¾ç½®ä¸º \u00600\u0060 ï¼Œå› ä¸ºæˆ‘ä»¬å°†åˆ›å»º Argo Rollouts æ¥æ“çºµ \u0060reviews\u0060 çš„å®ä¾‹æ•°é‡æœåŠ¡ã€‚å¦‚æœè¿™é‡Œè®¾ç½®ä¸ºéé›¶æ­£æ•´æ•°ï¼Œæˆ‘ä»¬å°†æ— æ³•å®ç°é‡‘ä¸é›€éƒ¨ç½²ã€‚\n\nç°åœ¨æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ ArgoCD UIï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚\n\n![å›¾ 4ï¼šArgoCD ç”¨æˆ·ç•Œé¢](f4.png)\n\nå¦‚æœæ‚¨å‘ç°åº”ç”¨ç¨‹åºçŠ¶æ€ä¸åŒæ­¥ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æˆ–å•å‡» UI ä¸­çš„ SYNC æŒ‰é’®ã€‚\n\n\u0060\u0060\u0060bash\nargocd app sync bookinfo-app\n\u0060\u0060\u0060\n\n## ä½¿ç”¨ Istio å®æ–½ç»†ç²’åº¦æµé‡ç®¡ç† {#istio-fine-grain-traffic-management}\n\né¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ Argo CD åˆ›å»º Istio ç›¸å…³çš„èµ„æºå¯¹è±¡ï¼š\n\n\u0060\u0060\u0060bash\nargocd app create bookinfo-tse-conf --repo https:\/\/github.com\/tetrateio\/tse-gitops-demo.git --path argo\/tse --dest-server https:\/\/kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated --self-heal\n\n# Check the creation status\nargocd app get bookinfo-tse-conf\n\u0060\u0060\u0060\n\n### å°† Deployment è½¬æ¢ä¸º Rollout {#convert-deployment-to-rollout}\n\nå‡è®¾æˆ‘ä»¬è¦å‘å¸ƒæ–°ç‰ˆæœ¬çš„ \u0060reviews\u0060 æœåŠ¡ã€‚ä¸ºäº†å®ç°é›¶åœæœºæ›´æ–°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é‡‘ä¸é›€éƒ¨ç½²ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. å°† \u0060reviews\u0060 Deployment çš„ \u0060replicas\u0060 å‡å°‘ä¸º 0ï¼›\n2. åˆ›å»ºå¼•ç”¨å…ˆå‰åœ¨ Bookinfo åº”ç”¨ç¨‹åºä¸­éƒ¨ç½²çš„ \u0060reviews\u0060 Deployment çš„ Rolloutï¼›\n3. å°†æµé‡å‘é€åˆ° \u0060reviews\u0060 æœåŠ¡ä»¥å®ç°è‡ªåŠ¨é‡‘ä¸é›€éƒ¨ç½²è¿›åº¦ã€‚\n\næ‚¨å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æœ¬æ¼”ç¤ºä¸­ä½¿ç”¨çš„ Rollout å’Œ AnalysisTemplate é…ç½®ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½² \u0060reivews-rollout\u0060 ï¼š\n\n\u0060\u0060\u0060bash\nargocd app create reviews-rollout --repo https:\/\/github.com\/tetrateio\/tse-gitops-demo.git --path argo\/rollout --dest-server https:\/\/kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated\n\u0060\u0060\u0060\n\næ³¨æ„ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ \u0060argocd\u0060 å‘½ä»¤æ¥éƒ¨ç½²æˆ–ä½¿ç”¨ \u0060kubectl apply\u0060 ã€‚æ¨èä½¿ç”¨ \u0060argocd\u0060 ï¼Œå› ä¸ºæ‚¨å¯ä»¥åŒæ—¶åœ¨ ArgoCD UI å’Œ Argo Rollouts Dashboard ä¸­æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ \u0060argocd\u0060 å‘½ä»¤ç®¡ç†éƒ¨ç½²ã€‚\n\nåœ¨ Argo Rollouts Dashboard ä¸­æŸ¥çœ‹ \u0060reviews\u0060 éƒ¨ç½²çš„çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æµé‡å‘é€åˆ° \u0060reviews\u0060 æœåŠ¡ä¸€æ®µæ—¶é—´ï¼š\n\n\u0060\u0060\u0060bash\nexport GATEWAY_HOSTNAME=$(kubectl -n bookinfo get service tsb-gateway-bookinfo -o jsonpath=\u0027{.status.loadBalancer.ingress[0].hostname}\u0027)\nwhile 1;do curl -H \u0022Host: bookinfo.tetrate.com\u0022 http:\/\/$GATEWAY_HOSTNAME\/api\/v1\/products\/1\/reviews;sleep 3;done\n\u0060\u0060\u0060\n\næ‚¨å°†åœ¨è¾“å‡ºä¸­çœ‹åˆ°æ¥è‡ªå…·æœ‰ä¸åŒ rollouts-pod-template-hash æ ‡ç­¾çš„ pod çš„å“åº”ï¼Œè¿™è¯æ˜é‡‘ä¸é›€éƒ¨ç½²æ˜¯æœ‰æ•ˆçš„ã€‚å¤§çº¦ 10 åˆ†é’Ÿåï¼Œæ‚¨çœ‹åˆ°çš„ Argo Rollouts ä»ªè¡¨æ¿å°†å¦‚å›¾ 5 æ‰€ç¤ºã€‚\n\n![å›¾ 5ï¼šArgo Rollouts ä»ªè¡¨æ¿](f5.png)\n\nä»å›¾ 5 ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡‘ä¸é›€éƒ¨ç½²è¿›å±•é¡ºåˆ©ï¼Œå·²ç»åˆ°äº†ç¬¬ä¸‰æ­¥ã€‚è¿™æ˜¯å› ä¸º \u0060reviews\u0060 æœåŠ¡çš„ \u0060apdex\u0060 ï¼ˆåº”ç”¨æ€§èƒ½æŒ‡æ•°ï¼‰æŒ‡æ ‡æ­£å¸¸ã€‚æ‚¨å¯ä»¥[ä½¿ç”¨ Postman å‘ SkyWalking æäº¤ GraphQL æŸ¥è¯¢](https:\/\/tetrate.io\/blog\/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman\/)æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚\n\n![å›¾ 6ï¼šä½¿ç”¨ Postman å°† GraphQL æŸ¥è¯¢æäº¤åˆ° SkyWalking](f6.png)\n\næˆ‘ä»¬æ„å»ºçš„ GraphQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n\u0060\u0060\u0060graphql\nquery ReadMetricsValues {\n    readMetricsValues(condition: {\n    name: \u0022service_apdex\u0022, entity: {scope: Service, serviceName: \u0022canary|reviews|bookinfo|cluster-1|-\u0022, normal: true}\n  }, duration: {\n    start: \u00222023-07-13 0812\u0022,\n    end: \u00222023-07-13 0813\u0022,\n    step: MINUTE\n  }) {\n        label\n        values {\n            values {\n                id\n                value\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\nè¯¥è¯­å¥ä» UTC \u00602023-07-13 8:12\u0060 åˆ° \u00602023 8:13\u0060 æŸ¥è¯¢ \u0060canary|reviews|bookinfo|cluster-1|-\u0060 æœåŠ¡çš„ \u0060apdex\u0060 æŒ‡æ ‡ï¼ŒæŒç»­ä¸¤åˆ†é’Ÿï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\n\n\u0060\u0060\u0060json\n{\n    \u0022data\u0022: {\n        \u0022readMetricsValues\u0022: {\n            \u0022label\u0022: null,\n            \u0022values\u0022: {\n                \u0022values\u0022: [\n                    {\n                        \u0022id\u0022: \u0022service_apdex_202307130812_Y2FuYXJ5fHJldmlld3N8Ym9va2luZm98Y2x1c3Rlci0xfC0=.1\u0022,\n                        \u0022value\u0022: 10000\n                    },\n                    {\n                        \u0022id\u0022: \u0022service_apdex_202307130813_Y2FuYXJ5fHJldmlld3N8Ym9va2luZm98Y2x1c3Rlci0xfC0=.1\u0022,\n                        \u0022value\u0022: 10000\n                    }\n                ]\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\n\u0060apdex\u0060 æŒ‡æ ‡çš„å€¼å¤§äº 9900ï¼ˆAnalysisTemplate çš„ \u0060successCondition\u0060 ä¸­é…ç½®çš„é˜ˆå€¼ï¼‰ï¼Œå› æ­¤ Rollouts ä¼šé¡ºåˆ©è¿›è¡Œã€‚æ‚¨è¿˜å¯ä»¥åœ¨ Argo Rollouts Dashboard ä¸Šå•å‡»â€œæ‰‹åŠ¨å‡çº§â€æ¥å‡çº§å®ƒï¼Œæˆ–è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n\u0060\u0060\u0060bash\nkubectl argo rollouts promote reviews-rollout -n bookinf\n\u0060\u0060\u0060\n\n## æ¸…ç† {#clean-up}\n\nåˆ é™¤å·²éƒ¨ç½²çš„ ArgoCD åº”ç”¨ç¨‹åºå’Œ Rolloutï¼š\n\n\u0060\u0060\u0060bash\nargocd app delete -y reviews-rollout\nargocd app delete -y bookinfo-tse-conf\nargocd app delete -y bookinfo-app\n\u0060\u0060\u0060\n\n## Argo Rollouts åŸç† {#rollouts-principle}\n\nä¸ Istio é›†æˆæ—¶ï¼ŒArgo Rollouts æ”¯æŒåŸºäº VirtualService å’Œ Subset çš„æµé‡æ‹†åˆ†ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºã€‚\n\n![å›¾ 7ï¼šArgo Rollouts ä½¿ç”¨ Istio è¿›è¡Œæµé‡åˆ†é…](f7.svg)\n\nä¸‹è¡¨æä¾›äº†è¿™ä¸¤ç§æµé‡åˆ†æ®µæ–¹æ³•çš„è¯¦ç»†æ¯”è¾ƒã€‚\n\n| ç±»å‹           | é€‚ç”¨åœºæ™¯                             | èµ„æºå¯¹è±¡                                          | åŸåˆ™                                                         |\n| :------------- | :----------------------------------- | :------------------------------------------------ | :----------------------------------------------------------- |\n| ä¸»æœºçº§æµé‡åˆ†å‰² | é€‚ç”¨äºæ ¹æ®ä¸»æœºåè®¿é—®ä¸åŒç‰ˆæœ¬çš„æœåŠ¡ï¼› | 2 ä¸ªæœåŠ¡ã€1 ä¸ªè™šæ‹ŸæœåŠ¡ã€1 ä¸ªéƒ¨ç½²ï¼›                | Rollout å°† rollouts-pod-template-hash æ ‡ç­¾æ³¨å…¥åˆ° ReplicaSet ä¸­ï¼Œå¹¶é€šè¿‡æ›´æ–° Service ä¸­çš„é€‰æ‹©å™¨æ¥é€‰æ‹©å¸¦æœ‰è¿™äº›æ ‡ç­¾çš„ podï¼› |\n| å­é›†çº§æµé‡åˆ†å‰² | é€‚ç”¨äºæ ¹æ®æ ‡ç­¾è®¿é—®ä¸åŒçš„æœåŠ¡ï¼›       | 1 ä¸ªæœåŠ¡ã€1 ä¸ªè™šæ‹ŸæœåŠ¡ã€1 ä¸ªç›®æ ‡è§„åˆ™å’Œ 1 ä¸ªè½¬å‡ºï¼› | Rollout å°† rollouts-pod-template-hash æ ‡ç­¾æ³¨å…¥åˆ° ReplicaSet ä¸­ï¼Œå¹¶é€šè¿‡æ›´æ–° DestinationRule ä¸­çš„é€‰æ‹©å™¨æ¥é€‰æ‹©å…·æœ‰è¿™äº›æ ‡ç­¾çš„ podï¼› |\n\næœ¬æ¼”ç¤ºä¸­ä½¿ç”¨åŸºäºå­é›†çš„æµé‡åˆ†å‰²ï¼ŒArgo ä¸æ–­æ¨å‡ºï¼š\n\n- ä¿®æ”¹ VirtualService \u0060spec.http[].route[].weight\u0060 ä»¥åŒ¹é…å½“å‰æ‰€éœ€çš„é‡‘ä¸é›€æƒé‡\n- ä¿®æ”¹ DestinationRule \u0060spec.subsets[].labels\u0060 ä»¥åŒ…å« canary å’Œç¨³å®š ReplicaSet çš„ \u0060rollouts-pod-template-hash\u0060 æ ‡ç­¾\n\nè¯·è®¿é—® [Argo Rollouts æ–‡æ¡£](https:\/\/argo-rollouts.readthedocs.io\/en\/stable\/features\/traffic-management\/istio\/)ï¼Œäº†è§£æœ‰å…³ä½¿ç”¨ Istio è¿›è¡Œæµé‡ç®¡ç†çš„è¯¦ç»†ä¿¡æ¯ã€‚\n\n## æ€»ç»“ {#summary}\n\næœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Argo é¡¹ç›®å’Œ Istio å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ ArgoCD å®ç° GitOpsï¼Œç„¶åä½¿ç”¨ Argo Rollout å’Œ SkyWalking å®ç°è‡ªåŠ¨åŒ–é‡‘ä¸é›€å‘å¸ƒã€‚ä» demo ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° TSE éƒ¨ç½²çš„ Istio ä¸å¼€æºç‰ˆæœ¬å®Œå…¨å…¼å®¹ã€‚TSE æœ‰è®¸å¤šåŠŸèƒ½å€¼å¾—æ¢ç´¢ï¼Œè¯·è®¿é—® [Tetrate ç½‘ç«™](https:\/\/tetrate.io\/tetrate-service-express\/)äº†è§£æ›´å¤šä¿¡æ¯ã€‚\n', '\/blog\/implementing-gitops-and-canary-deployment-with-argo-project-and-istio\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡è®¨è®ºå¦‚ä½•ä½¿ç”¨ Kubernetes Deploymentã€Argo é¡¹ç›®å’Œ Istio æ¥å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/demystifying-the-load-balancing-in-istio/">Istio ä¸­çš„è´Ÿè½½å‡è¡¡è¯¦è§£åŠå¤šé›†ç¾¤è·¯ç”±å®è·µ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/09/07</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Istio ä¸­çš„è´Ÿè½½å‡è¡¡è¯¦è§£åŠå¤šé›†ç¾¤è·¯ç”±å®è·µ', 'Istio è´Ÿè½½å‡è¡¡è¯¦è§£å°¤å…¶æ˜¯å¤šé›†ç¾¤å¦‚ä½•å®ç°è·¯ç”±ä¸è´Ÿè½½å‡è¡¡çš„ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªå¤šé›†ç¾¤è·¯ç”±çš„æ¼”ç¤ºã€‚', '\n{{\u003ccallout note ç¼–è€…æŒ‰\u003e}}\n\næœ¬æ–‡ä»‹ç»äº† Istio ä¸­æ”¯æŒçš„è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œç„¶åæå‡ºå¤šé›†ç¾¤ç½‘æ ¼è´Ÿè½½å‡è¡¡çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæ‚¨å·²ç»äº†è§£ Istio ä¸­è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥ç›´æ¥ä»[å¤šé›†ç¾¤ç½‘æ ¼ä¸­çš„è´Ÿè½½å‡è¡¡](#multicluster)éƒ¨åˆ†å¼€å§‹é˜…è¯»ã€‚\n\n{{\u003c\/callout\u003e}}\n\nåœ¨ä¹‹å‰çš„åšå®¢[ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨äº† Kubernetes åä½ å¯èƒ½è¿˜éœ€è¦ Istio](\/blog\/why-do-you-need-istio-when-you-already-have-kubernetes\/) ä¸­æåˆ° Istio æ˜¯åœ¨ Kubernetes çš„åŸºç¡€ä¹‹ä¸Šæ„å»ºèµ·æ¥çš„ï¼ŒKubernetes ä¸­çš„ç»„ä»¶ kube-proxy æœ¬èº«å·²æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä½†æ˜¯åªæ”¯æŒå››å±‚æµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œè€Œä¸”æ— æ³•å®ç°æœåŠ¡è¶…æ—¶ã€ç†”æ–­ç­‰é«˜çº§åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼ŒæœåŠ¡ç½‘æ ¼æ¯”èµ· Kubernetes æ–°å¢äº†ä»¥ä¸‹è´Ÿè½½å‡è¡¡åŠéŸ§æ€§ï¼ˆResiliencyï¼‰ç‰¹æ€§ï¼š\n\n1. **Layer 7 è´Ÿè½½å‡è¡¡**ï¼šæœåŠ¡ç½‘æ ¼åœ¨åº”ç”¨å±‚ï¼ˆLayer 7ï¼‰æ“ä½œå’Œç®¡ç†æµé‡ï¼Œå¯ä»¥æ›´ç»†ç²’åº¦åœ°è¯†åˆ«å’Œæ§åˆ¶æµé‡ã€‚è¿™ä½¿å¾—å®ƒå¯ä»¥å®ç°æ›´é«˜çº§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¦‚åŸºäº HTTP è¯·æ±‚å¤´ã€URL è·¯å¾„ã€Cookie ç­‰çš„è·¯ç”±å’Œæµé‡åˆ†å‘ã€‚\n\n2. **åŠ¨æ€è´Ÿè½½å‡è¡¡**ï¼šæœåŠ¡ç½‘æ ¼é€šå¸¸å…·å¤‡è‡ªåŠ¨è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®åç«¯æœåŠ¡çš„å®æ—¶å¥åº·çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡æ¥åŠ¨æ€åˆ†å‘æµé‡ã€‚è¿™å…è®¸å®ƒå®ç°æ™ºèƒ½è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå°†æµé‡è·¯ç”±åˆ°æ€§èƒ½æœ€ä½³çš„æœåŠ¡å®ä¾‹ã€‚\n\n3. **æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»**ï¼šæœåŠ¡ç½‘æ ¼å…·å¤‡é«˜çº§çš„æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ã€‚å®ƒå¯ä»¥æ£€æµ‹åˆ°åç«¯æœåŠ¡å®ä¾‹çš„æ•…éšœï¼Œå¹¶è‡ªåŠ¨å°†æµé‡ä»æ•…éšœå®ä¾‹è½¬ç§»åˆ°å¥åº·å®ä¾‹ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ã€‚\n\n4. **A\/B æµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒ**ï¼šæœåŠ¡ç½‘æ ¼å…è®¸å®æ–½é«˜çº§éƒ¨ç½²ç­–ç•¥ï¼Œå¦‚ A\/B æµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒã€‚è¿™äº›ç­–ç•¥å…è®¸åœ¨ä¸åŒçš„æœåŠ¡ç‰ˆæœ¬ä¹‹é—´åŠ¨æ€åˆ†é…æµé‡ï¼Œå¹¶æ ¹æ®ç»“æœè¿›è¡Œå†³ç­–ã€‚\n\n5. **ç†”æ–­å’Œé‡è¯•**ï¼šæœåŠ¡ç½‘æ ¼é€šå¸¸åŒ…å«ç†”æ–­å’Œé‡è¯•æœºåˆ¶ï¼Œä»¥æé«˜åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚å®ƒå¯ä»¥æ ¹æ®åç«¯æœåŠ¡çš„æ€§èƒ½å’Œå¯ç”¨æ€§æƒ…å†µæ¥è‡ªåŠ¨æ‰§è¡Œç†”æ–­æ“ä½œï¼Œå¹¶åœ¨å¿…è¦æ—¶é‡è¯•è¯·æ±‚ã€‚\n\n6. **å…¨å±€æµé‡æ§åˆ¶**ï¼šæœåŠ¡ç½‘æ ¼æä¾›äº†é›†ä¸­å¼çš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ï¼Œå…è®¸å¯¹æ•´ä¸ªæœåŠ¡ç½‘æ ¼ä¸­çš„æµé‡è¿›è¡Œå…¨å±€ç®¡ç†ã€‚è¿™ä½¿å¾—å®ç°ç»Ÿä¸€çš„å®‰å…¨æ€§ã€ç›‘æ§å’Œç­–ç•¥æˆä¸ºå¯èƒ½ã€‚\n\n7. **æ·±åº¦é›†æˆçš„ç›‘æ§å’Œè¿½è¸ª**ï¼šæœåŠ¡ç½‘æ ¼é€šå¸¸é›†æˆäº†å¼ºå¤§çš„ç›‘æ§å’Œè¿½è¸ªå·¥å…·ï¼Œå¯ä»¥æä¾›æœ‰å…³æµé‡æ€§èƒ½å’Œå¯è§æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©è¿›è¡Œæ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚\n\nè™½ç„¶ Kubernetes æä¾›äº†åŸºæœ¬çš„è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œä½†æœåŠ¡ç½‘æ ¼åœ¨å…¶ä¹‹ä¸Šæ„å»ºäº†æ›´é«˜çº§çš„è´Ÿè½½å‡è¡¡å’Œæµé‡ç®¡ç†åŠŸèƒ½ï¼Œä»¥æ»¡è¶³å¾®æœåŠ¡æ¶æ„ä¸­å¤æ‚çš„éœ€æ±‚ã€‚\n\n### å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ vs æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡\n\nå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡æ˜¯ä¸¤ç§ä¸åŒçš„è´Ÿè½½å‡è¡¡æ–¹æ³•ï¼Œå®ƒä»¬åœ¨ä¸åŒçš„åœºæ™¯å’Œåº”ç”¨ä¸­æœ‰å„è‡ªçš„ä¼˜åŠ¿ã€‚ä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬çš„è§£é‡Šï¼Œé€‚ç”¨çš„åœºæ™¯ï¼Œå®ç°æ¡ˆä¾‹ä»¥åŠç›¸å…³çš„å¼€æºé¡¹ç›®ï¼š\n\n**å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆClient-Side Load Balancingï¼‰**\n\nå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„ç¤ºæ„å›¾å¦‚å›¾ 1 æ‰€ç¤ºã€‚\n\n![å›¾ 1ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡](client-side-load-balancing.svg)\n\n- **å®šä¹‰**ï¼šåœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸­ï¼Œè´Ÿè½½å‡è¡¡å†³ç­–æ˜¯ç”±æœåŠ¡çš„æ¶ˆè´¹è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰æ¥åšå‡ºçš„ã€‚å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨é€šå¸¸ä¼šç»´æŠ¤ä¸€ä¸ªæœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œå¹¶æ ¹æ®é…ç½®å’Œç­–ç•¥é€‰æ‹©è¦å‘é€è¯·æ±‚çš„å®ä¾‹ã€‚\n\n- **é€‚ç”¨åœºæ™¯**ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\n  - å¤šä¸ªå®¢æˆ·ç«¯éœ€è¦è®¿é—®åŒä¸€ç»„åç«¯æœåŠ¡ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œç­–ç•¥é€‰æ‹©åç«¯æœåŠ¡ã€‚\n  - æœåŠ¡æ¶ˆè´¹è€…éœ€è¦æ›´å¤šçš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ï¼Œä¾‹å¦‚ A\/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒç­‰ã€‚\n\n- **å®ç°æ¡ˆä¾‹**ï¼šå¸¸è§çš„å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å¼€æºé¡¹ç›®åŒ…æ‹¬ï¼š\n  - **Ribbon**ï¼šNetflix Ribbon æ˜¯ä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å¼€æºé¡¹ç›®ï¼Œå®ƒå¯ä»¥ä¸ Spring Cloud é›†æˆã€‚\n  - **Envoy**ï¼šEnvoy æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå¹¿æ³›ç”¨äºæœåŠ¡ç½‘æ ¼å’Œå¾®æœåŠ¡æ¶æ„ä¸­ã€‚\n  - **NGINX**ï¼šè™½ç„¶ NGINX é€šå¸¸ç”¨äºåå‘ä»£ç†ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ä½œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ã€‚\n\n**æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼ˆServer-Side Load Balancingï¼‰**\n\næœåŠ¡ç«¯è´Ÿè½½å‡è¡¡å¦‚å›¾ 2 æ‰€ç¤ºã€‚\n\n![å›¾ 2ï¼šæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡](server-side-load-balancing.svg)\n\n- **å®šä¹‰**ï¼šåœ¨æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ä¸­ï¼Œè´Ÿè½½å‡è¡¡å†³ç­–æ˜¯ç”±æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨æˆ–ä»£ç†æ¥åšå‡ºçš„ã€‚å®¢æˆ·ç«¯åªéœ€å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°å“ªä¸ªåç«¯æœåŠ¡å®ä¾‹ã€‚\n\n- **é€‚ç”¨åœºæ™¯**ï¼šæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\n  - å®¢æˆ·ç«¯ä¸å…³å¿ƒåç«¯æœåŠ¡çš„å…·ä½“å®ä¾‹ï¼Œåªå…³å¿ƒå‘é€è¯·æ±‚åˆ°æœåŠ¡çš„åç§°æˆ–åœ°å€ã€‚\n  - è´Ÿè½½å‡è¡¡ç­–ç•¥éœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œå…¨å±€é…ç½®ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å…³å¿ƒè´Ÿè½½å‡è¡¡ç»†èŠ‚ã€‚\n\n- **å®ç°æ¡ˆä¾‹**ï¼šå¸¸è§çš„å®ç°æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡çš„å¼€æºé¡¹ç›®åŒ…æ‹¬ï¼š\n  - **NGINX**ï¼šNGINX å¯ä»¥ç”¨ä½œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ‰§è¡ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°åç«¯æœåŠ¡ã€‚\n  - **HAProxy**ï¼šHAProxy æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šå¸¸ç”¨äºæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ã€‚\n  - **Amazon ELBï¼ˆElastic Load Balancerï¼‰**ï¼šäºšé©¬é€Šæä¾›çš„è´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œç”¨äºå°†è¯·æ±‚è·¯ç”±åˆ° AWS åç«¯æœåŠ¡å®ä¾‹ã€‚\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæœ‰æ—¶ä¹Ÿä¼šå°†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ç»“åˆä½¿ç”¨ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„éœ€æ±‚ã€‚é€‰æ‹©å“ªç§è´Ÿè½½å‡è¡¡æ–¹æ³•é€šå¸¸å–å†³äºæ‚¨çš„æ¶æ„ã€éƒ¨ç½²éœ€æ±‚ä»¥åŠæ€§èƒ½è¦æ±‚ã€‚æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰é€šå¸¸ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ¥å®ç°ç»†ç²’åº¦çš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ï¼Œè€Œåœ¨äº‘æœåŠ¡æä¾›å•†ä¸­ï¼ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡é€šå¸¸ç”¨äºè‡ªåŠ¨æ‰©å±•å’Œæµé‡ç®¡ç†ã€‚\n\n### Istio å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡ {#how-istio-do-lb}\n\nåœ¨æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡é€šå¸¸æ˜¯é€šè¿‡ Envoy ä»£ç†å®ç°çš„ã€‚Envoy æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥ç”¨äºæ„å»ºæœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢ï¼Œç”¨äºå¤„ç†æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ˜¯ä¸€ç§åœ¨æœåŠ¡æ¶ˆè´¹è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸€ä¾§å®ç°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒå†³å®šäº†è¯·æ±‚åº”è¯¥å¦‚ä½•è·¯ç”±åˆ°åç«¯æœåŠ¡å®ä¾‹ã€‚\n\nå•é›†ç¾¤å•ç½‘ç»œ Istio æœåŠ¡ç½‘æ ¼çš„è´Ÿè½½å‡è¡¡å¦‚å›¾ 3 æ‰€ç¤ºã€‚\n\n![å›¾ 3ï¼šå•é›†ç¾¤å•ç½‘ç»œçš„ Istio æœåŠ¡ç½‘æ ¼çš„è´Ÿè½½å‡è¡¡](istio-load-balancing.svg)\n\nä»¥ä¸‹æ˜¯æœåŠ¡ç½‘æ ¼ä¸­å¦‚ä½•å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„ä¸€èˆ¬æµç¨‹ï¼š\n\n1. **Sidecar ä»£ç†**: åœ¨æœåŠ¡ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªéƒ¨ç½²çš„æœåŠ¡å®ä¾‹é€šå¸¸éƒ½ä¸ä¸€ä¸ª Sidecar ä»£ç†ï¼ˆé€šå¸¸æ˜¯ Envoyï¼‰å…³è”ã€‚è¿™ä¸ª Sidecar ä»£ç†ä½äºæœåŠ¡å®ä¾‹æ—è¾¹ï¼Œè´Ÿè´£å¤„ç†è¯¥æœåŠ¡å®ä¾‹çš„å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚\n\n2. **æœåŠ¡æ³¨å†Œä¸å‘ç°**: åœ¨æœåŠ¡ç½‘æ ¼ä¸­ï¼ŒæœåŠ¡å®ä¾‹çš„æ³¨å†Œå’Œå‘ç°é€šå¸¸ç”±æœåŠ¡æ³¨å†Œè¡¨ï¼ˆKubernetes çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼‰å¤„ç†ã€‚è¿™äº›æ³¨å†Œè¡¨ç»´æŠ¤äº†æœåŠ¡å®ä¾‹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç½‘ç»œåœ°å€å’Œå¥åº·çŠ¶æ€ã€‚\n\n3. **å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡é…ç½®**: åœ¨å®¢æˆ·ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹è€…ï¼‰å‘é€è¯·æ±‚æ—¶ï¼ŒSidecar ä»£ç†ä¼šæ‰§è¡Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚è¿™äº›è´Ÿè½½å‡è¡¡ç­–ç•¥é€šå¸¸åœ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­è·å–çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ä¸Šæ“ä½œã€‚ç­–ç•¥å¯ä»¥åŸºäºå¤šç§å› ç´ è¿›è¡Œé€‰æ‹©ï¼Œä¾‹å¦‚æƒé‡ã€å¥åº·çŠ¶æ€ã€å»¶è¿Ÿç­‰ã€‚\n\n4. **è¯·æ±‚è·¯ç”±**: æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒSidecar ä»£ç†å°†è¯·æ±‚è·¯ç”±åˆ°é€‰æ‹©çš„åç«¯æœåŠ¡å®ä¾‹ã€‚è¿™å¯ä»¥åŒ…æ‹¬ä½¿ç”¨è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥ç­‰ç®—æ³•æ¥é€‰æ‹©ç›®æ ‡å®ä¾‹ã€‚\n\n5. **é€šä¿¡å¤„ç†**: ä¸€æ—¦é€‰æ‹©äº†ç›®æ ‡å®ä¾‹ï¼ŒSidecar ä»£ç†å°†è¯·æ±‚è½¬å‘ç»™è¯¥å®ä¾‹ï¼Œç„¶åå°†å“åº”ä¼ å›ç»™å®¢æˆ·ç«¯ã€‚å®ƒè¿˜å¯ä»¥å¤„ç†è¿æ¥ç®¡ç†ã€æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ç­‰ä»»åŠ¡ã€‚\n\næ€»ä¹‹ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ˜¯åœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸€ä¾§ï¼ˆé€šå¸¸æ˜¯ Envoy ä»£ç†ï¼‰å®ç°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒä½¿æœåŠ¡ç½‘æ ¼èƒ½å¤Ÿæœ‰æ•ˆåœ°åˆ†å‘æµé‡å¹¶å¤„ç†åç«¯æœåŠ¡å®ä¾‹çš„æ•…éšœã€‚è¿™ç§æ–¹å¼ä½¿å¾—è´Ÿè½½å‡è¡¡å†³ç­–åœ¨æœåŠ¡æ¶ˆè´¹è€…çš„æ§åˆ¶ä¸‹ï¼Œå¹¶å…è®¸æ›´ç²¾ç»†çš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ã€‚Envoy ä»£ç†æ˜¯å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å…³é”®ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒå…·æœ‰ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºæ»¡è¶³ä¸åŒçš„è´Ÿè½½å‡è¡¡éœ€æ±‚ã€‚\n\n## Istio ä¸­çš„è´Ÿè½½å‡è¡¡ç±»å‹ {#lb-types}\n\nåœ¨ Istio çš„[DestinationRule](https:\/\/istio.io\/latest\/docs\/reference\/config\/networking\/destination-rule\/)èµ„æºä¸­ï¼Œ\u0060loadBalancer\u0060éƒ¨åˆ†ç”¨äºé…ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ§åˆ¶è¯·æ±‚å¦‚ä½•åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹æˆ–ç‰ˆæœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![å›¾ 4ï¼šIstio ä¸­çš„è´Ÿè½½å‡è¡¡é…ç½®å‚æ•°](istio-loadbalancer.svg)\n\nä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒIstio æ”¯æŒä¸‰ç§ç±»å‹çš„è´Ÿè½½å‡è¡¡ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n- \u0060simple\u0060ï¼šåŸºäºå¸¸ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•çš„ç®€å•è´Ÿè½½å‡è¡¡\n- \u0060consistentHashLB\u0060ï¼šåŸºäºä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„è´Ÿè½½å‡è¡¡\n- \u0060localityLbSetting\u0060ï¼šåŸºäºåœ°åŸŸçš„æœ¬åœ°æ€§è´Ÿè½½å‡è¡¡\n\nä»¥ä¸‹æ˜¯ä¸è´Ÿè½½å‡è¡¡é…ç½®ç›¸å…³çš„å­—æ®µçš„å«ä¹‰ï¼š\n\n1. **simple**ï¼šè¿™ä¸ªéƒ¨åˆ†å®šä¹‰äº†ä¸€äº›ç®€å•çš„è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰é¡¹ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹é€‰é¡¹ï¼š\n   - **ROUND_ROBIN**ï¼šè¯·æ±‚ä¼šä¾æ¬¡åˆ†å‘åˆ°æ‰€æœ‰å¯ç”¨çš„åç«¯å®ä¾‹ï¼Œä»¥è½®è¯¢çš„æ–¹å¼ã€‚\n   - **LEAST_CONN**ï¼šè¯·æ±‚å°†è·¯ç”±åˆ°å½“å‰è¿æ¥æ•°æœ€å°‘çš„åç«¯å®ä¾‹ã€‚\n   - **RANDOM**ï¼šè¯·æ±‚å°†éšæœºè·¯ç”±åˆ°åç«¯å®ä¾‹ã€‚\n   - **PASSTHROUGH**ï¼šIstio ä¸ä¼šè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œè€Œæ˜¯å°†è¯·æ±‚ç›´æ¥è·¯ç”±åˆ°æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œé€‚ç”¨äºç‰¹å®šç”¨ä¾‹ã€‚\n2. **consistentHashLB**ï¼šè¿™ä¸ªéƒ¨åˆ†å…è®¸ä½ é…ç½®ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼š\n   - **httpHeaderName**ï¼šç”¨äºå“ˆå¸Œè®¡ç®—çš„ HTTP æ ‡å¤´çš„åç§°ã€‚\n   - **httpCookie**ï¼šç”¨äºå“ˆå¸Œè®¡ç®—çš„ HTTP Cookie çš„é…ç½®ï¼ŒåŒ…æ‹¬åç§°ã€è·¯å¾„å’Œç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ã€‚\n   - **useSourceIp**ï¼šæ˜¯å¦ä½¿ç”¨è¯·æ±‚çš„æº IP åœ°å€è¿›è¡Œå“ˆå¸Œè®¡ç®—ã€‚\n   - **httpQueryParameterName**ï¼šç”¨äºå“ˆå¸Œè®¡ç®—çš„ HTTP æŸ¥è¯¢å‚æ•°çš„åç§°ã€‚\n   - **ringHash**ï¼šé…ç½®ç¯å½¢å“ˆå¸Œè´Ÿè½½å‡è¡¡ï¼ŒåŒ…æ‹¬æœ€å°ç¯å¤§å°ï¼ˆminimumRingSizeï¼‰ã€‚\n   - **maglev**ï¼šé…ç½® Maglev è´Ÿè½½å‡è¡¡ï¼ŒåŒ…æ‹¬è¡¨æ ¼å¤§å°ï¼ˆtableSizeï¼‰å’Œæœ€å°ç¯å¤§å°ï¼ˆminimumRingSizeï¼‰ã€‚\n3. **localityLbSetting**ï¼šè¿™ä¸ªéƒ¨åˆ†ç”¨äºé…ç½®æœ¬åœ°æ€§è´Ÿè½½å‡è¡¡è®¾ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼š\n   - **distribute**ï¼šå®šä¹‰äº†è¯·æ±‚çš„åˆ†å¸ƒï¼ŒåŒ…æ‹¬èµ·å§‹ä½ç½®ï¼ˆfromï¼‰å’Œç»“æŸä½ç½®ï¼ˆtoï¼‰ã€‚\n   - **failover**ï¼šå®šä¹‰äº†æ•…éšœåˆ‡æ¢ï¼ŒåŒ…æ‹¬èµ·å§‹ä½ç½®ï¼ˆfromï¼‰å’Œç»“æŸä½ç½®ï¼ˆtoï¼‰ã€‚\n   - **failoverPriority**ï¼šæ•…éšœåˆ‡æ¢çš„ä¼˜å…ˆçº§è®¾ç½®ã€‚\n   - **enabled**ï¼šæ˜¯å¦å¯ç”¨æœ¬åœ°æ€§è´Ÿè½½å‡è¡¡ã€‚\n\nè¿™äº›å­—æ®µå…è®¸ä½ æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©é€‚å½“çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶é…ç½®é¢å¤–çš„é€‰é¡¹ï¼Œä»¥ç¡®ä¿è¯·æ±‚æŒ‰ç…§æ‰€éœ€çš„æ–¹å¼åˆ†å‘åˆ°åç«¯æœåŠ¡å®ä¾‹ã€‚ä¸åŒçš„ç­–ç•¥å’Œé…ç½®é€‰é¡¹å¯ä»¥æ»¡è¶³å„ç§è´Ÿè½½å‡è¡¡éœ€æ±‚ï¼Œå¦‚æ€§èƒ½ã€å¯é æ€§å’Œæµé‡æ§åˆ¶ã€‚å…³äºè¿™äº›å­—æ®µçš„è¯¦ç»†ä»‹ç»è¯·è§ [Istio æ–‡æ¡£](https:\/\/istio.io\/latest\/docs\/reference\/config\/networking\/destination-rule\/)ã€‚\n\n## å¦‚ä½•åœ¨ Istio ä¸­ä¸ºæœåŠ¡è®¾ç½®è´Ÿè½½å‡è¡¡ {#istio-lb}\n\næ­£å¦‚æˆ‘åœ¨[å¦‚ä½•ç†è§£ Istio ä¸­çš„ VirtualService å’Œ DestinationRule](\/blog\/understand-istio-vs-and-dr\/)è¿™ç¯‡æ–‡ç« ä¸­æ‰€è¯´çš„ï¼Œ\u0060VirtualService\u0060 ä¸»è¦ç”¨äºè®¾ç½®è·¯ç”±è§„åˆ™ï¼Œè€ŒæœåŠ¡å¼¹æ€§ï¼ˆè´Ÿè½½å‡è¡¡ã€è¶…æ—¶ã€é‡è¯•ã€ç†”æ–­ç­‰ï¼‰éœ€è¦é å®ƒå’Œ DestinationRule æ¥å…±åŒç»´æŒã€‚åªæœ‰åŒæ—¶éƒ¨ç½²äº†ä»¥ä¸Šä¸¤ç§èµ„æºï¼Œè´Ÿè½½å‡è¡¡æ‰èƒ½çœŸæ­£ç”Ÿæ•ˆã€‚\n\nä»¥ä¸‹æ˜¯è®¾ç½®è´Ÿè½½å‡è¡¡çš„ä¸€èˆ¬æ­¥éª¤ï¼š\n\n1. **åˆ›å»º DestinationRule èµ„æº**ï¼šé¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª DestinationRule èµ„æºï¼Œè¯¥èµ„æºå®šä¹‰äº†æœåŠ¡çš„æµé‡ç­–ç•¥å’Œç›®æ ‡è§„åˆ™ã€‚åœ¨ DestinationRule ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šè¦è®¾ç½®è´Ÿè½½å‡è¡¡çš„æœåŠ¡çš„åç§°ï¼ˆhostï¼‰ä»¥åŠè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚\n\n   ä»¥ä¸‹æ˜¯ä¸€ä¸ª DestinationRule çš„ç¤ºä¾‹ï¼Œå…¶ä¸­å°†æµé‡åˆ†å‘åˆ°å…·æœ‰æ ‡ç­¾ \u0022version: v1\u0022 å’Œ \u0022version: v2\u0022 çš„ä¸¤ä¸ªå­é›†ä¸­ï¼Œå¹¶ä½¿ç”¨ \u0060ROUND_ROBIN\u0060 è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š\n\n   \u0060\u0060\u0060yaml\n   apiVersion: networking.istio.io\/v1alpha3\n   kind: DestinationRule\n   metadata:\n     name: my-destination-rule\n   spec:\n     host: my-service.example.com\n     trafficPolicy:\n       loadBalancer:\n         simple: ROUND_ROBIN\n     subsets:\n       - name: v1\n         labels:\n           version: v1\n       - name: v2\n         labels:\n           version: v2\n   \u0060\u0060\u0060\n\n2. **åº”ç”¨ DestinationRule**ï¼šåˆ›å»º DestinationRule åï¼Œå°†å…¶åº”ç”¨äºè¦è¿›è¡Œè´Ÿè½½å‡è¡¡çš„æœåŠ¡ã€‚è¿™é€šå¸¸å¯ä»¥é€šè¿‡ Istio çš„ VirtualService èµ„æºæ¥å®Œæˆï¼Œé€šè¿‡åœ¨ VirtualService ä¸­å¼•ç”¨ DestinationRuleã€‚\n\n   ä»¥ä¸‹æ˜¯ä¸€ä¸ª VirtualService ç¤ºä¾‹ï¼Œå°†æµé‡å¼•å¯¼åˆ°åä¸º \u0022my-destination-rule\u0022 çš„ DestinationRuleï¼š\n\n   \u0060\u0060\u0060yaml\n   apiVersion: networking.istio.io\/v1alpha3\n   kind: VirtualService\n   metadata:\n     name: my-virtual-service\n   spec:\n     hosts:\n       - my-service.example.com\n     http:\n       - route:\n           - destination:\n               host: my-service.example.com\n               subset: v1\n         weight: 80\n       - route:\n           - destination:\n               host: my-service.example.com\n               subset: v2\n         weight: 20\n   \u0060\u0060\u0060\n\n   åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ ¹æ®æƒé‡é…ç½®ï¼Œ80% çš„æµé‡å°†è·¯ç”±åˆ°å­é›† v1ï¼Œè€Œ 20% çš„æµé‡å°†è·¯ç”±åˆ°å­é›† v2ã€‚\n\n3. **åº”ç”¨é…ç½®**ï¼šæœ€åï¼Œå°† VirtualService å’Œ DestinationRule èµ„æºåº”ç”¨åˆ°ä½ çš„ Istio ç¯å¢ƒä¸­ï¼Œä»¥ç¡®ä¿è´Ÿè½½å‡è¡¡è§„åˆ™ç”Ÿæ•ˆã€‚\n\n   ä½¿ç”¨ kubectl å‘½ä»¤å°† VirtualService å’Œ DestinationRule åº”ç”¨åˆ° Istio ä¸­ï¼š\n\n   \u0060\u0060\u0060bash\n   kubectl apply -f your-service.yaml\n   \u0060\u0060\u0060\n\né€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥ä¸ºä½ çš„æœåŠ¡è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ ¹æ®éœ€è¦å°†æµé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡ç‰ˆæœ¬æˆ–å®ä¾‹ï¼Œå¹¶æ§åˆ¶æµé‡çš„æƒé‡ã€‚è¿™æœ‰åŠ©äºå®ç°è¯¸å¦‚é‡‘ä¸é›€å‘å¸ƒã€A\/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒç­‰éƒ¨ç½²ç­–ç•¥ã€‚è¯·æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚å’Œç¯å¢ƒè°ƒæ•´è´Ÿè½½å‡è¡¡é…ç½®ã€‚\n\n### ä¸ºä»€ä¹ˆè¦åˆ†å¼€é…ç½®ï¼Ÿ{#devide}\n\nåœ¨ Istio ä¸­ï¼Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œå®ƒä»¬é€šå¸¸ç”¨äºæ§åˆ¶æœåŠ¡ä¹‹é—´çš„æµé‡å’Œè¡Œä¸ºï¼Œå› æ­¤é€šå¸¸åˆ†åˆ«é…ç½®åœ¨ä¸¤ä¸ªä¸åŒçš„èµ„æºå¯¹è±¡ä¸­ï¼š\u0060DestinationRule\u0060 ç”¨äºè´Ÿè½½å‡è¡¡ï¼Œ\u0060VirtualService\u0060 ç”¨äºè·¯ç”±ã€‚è¿™ç§åˆ†ç¦»çš„è®¾è®¡æœ‰ä¸€äº›ä¼˜ç‚¹ï¼š\n\n1. **æ¨¡å—åŒ–å’Œæ¸…æ™°æ€§ï¼š** å°†è´Ÿè½½å‡è¡¡å’Œè·¯ç”±é…ç½®åˆ†ç¦»æˆä¸¤ä¸ªèµ„æºå¯¹è±¡å¯ä»¥ä½¿é…ç½®æ›´åŠ æ¨¡å—åŒ–å’Œæ¸…æ™°ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£å’Œç»´æŠ¤è¿™ä¸¤ä¸ªæ–¹é¢çš„é…ç½®ï¼Œè€Œä¸ä¼šä½¿é…ç½®å¯¹è±¡è¿‡äºå¤æ‚ã€‚\n\n2. **å¯ç»´æŠ¤æ€§ï¼š** å°†è´Ÿè½½å‡è¡¡å’Œè·¯ç”±é…ç½®åˆ†å¼€å¯ä»¥ä½¿å®ƒä»¬æ›´å®¹æ˜“ç»´æŠ¤å’Œä¿®æ”¹ï¼Œå› ä¸ºå®ƒä»¬ä½äºä¸åŒçš„èµ„æºå¯¹è±¡ä¸­ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥é’ˆå¯¹ä¸åŒçš„éœ€æ±‚æ›´æ”¹è´Ÿè½½å‡è¡¡ç­–ç•¥è€Œä¸ä¼šå½±å“è·¯ç”±è§„åˆ™ï¼Œåä¹‹äº¦ç„¶ã€‚\n\n3. **å¯é‡ç”¨æ€§ï¼š** æ¨¡å—åŒ–çš„é…ç½®å…è®¸æ‚¨æ›´å®¹æ˜“åœ°é‡ç”¨é…ç½®ç‰‡æ®µã€‚æ‚¨å¯ä»¥åœ¨ä¸åŒçš„ \u0060DestinationRule\u0060 æˆ– \u0060VirtualService\u0060 ä¸­ä½¿ç”¨ç›¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥æˆ–è·¯ç”±è§„åˆ™ï¼Œä»¥æé«˜é…ç½®çš„å¯é‡ç”¨æ€§ã€‚\n\n4. **ç²¾ç»†æ§åˆ¶ï¼š** åˆ†ç¦»çš„é…ç½®å…è®¸æ‚¨å¯¹æ¯ä¸ªæ–¹é¢è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡å®šåˆ¶ä¸åŒçš„è·¯ç”±è§„åˆ™å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ç”¨ä¾‹å’Œè¦æ±‚ã€‚\n\nè™½ç„¶è´Ÿè½½å‡è¡¡å’Œè·¯ç”±é€šå¸¸æ˜¯åˆ†å¼€é…ç½®çš„ï¼Œä½†å®ƒä»¬ä¹‹é—´ä»ç„¶å­˜åœ¨ç´§å¯†çš„å…³è”ï¼Œå› ä¸ºè·¯ç”±è§„åˆ™å†³å®šäº†è¯·æ±‚å°†å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡ï¼Œè€Œè´Ÿè½½å‡è¡¡ç­–ç•¥å†³å®šäº†åœ¨æ‰€é€‰ç›®æ ‡æœåŠ¡ä¹‹é—´å¦‚ä½•åˆ†å‘æµé‡ã€‚å› æ­¤ï¼Œåœ¨ Istio ä¸­ï¼Œè¿™ä¸¤ä¸ªé…ç½®å¯¹è±¡é€šå¸¸éœ€è¦ååŒå·¥ä½œï¼Œä»¥å®ç°æ‚¨çš„æµé‡ç®¡ç†éœ€æ±‚ã€‚é€šè¿‡å°†å®ƒä»¬åˆ†å¼€é…ç½®ï¼Œä½¿å¾—é…ç½®æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ï¼Œå¹¶å…è®¸æ›´çµæ´»åœ°æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚\n\n## å¤šé›†ç¾¤ç½‘æ ¼ä¸­çš„è´Ÿè½½å‡è¡¡ {#multicluster}\n\nåœ¨å¾®æœåŠ¡é¢†åŸŸï¼ŒIstio å·²è¢«è¯æ˜æ˜¯ç®¡ç†æœåŠ¡é€šä¿¡çš„æ— ä»·ä¹‹å®ã€‚è™½ç„¶å®ƒåœ¨å•é›†ç¾¤åœºæ™¯ä¸‹è¡¨ç°å‡ºè‰²ï¼Œä½†å¤šé›†ç¾¤è®¾ç½®å¼•å…¥äº†ç‹¬ç‰¹çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è´Ÿè½½å‡è¡¡æ–¹é¢ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ­ç§˜ Istio ä¸­çš„å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œä¸ºæ‚¨æä¾›è§£å†³è¿™ä¸€å¤æ‚ä»»åŠ¡çš„æ¸…æ™°è·¯çº¿å›¾ã€‚\n\n### ä¸¤å±‚å…¥å£ç½‘å…³ï¼šå®ç°å¤šé›†ç¾¤é€šä¿¡çš„å…³é”® {#two-tier-ingress-gateway}\n\nåœ¨æ¶‰åŠæ¥è‡ªä¸åŒä¾›åº”å•†çš„é›†ç¾¤çš„å¤šé›†ç¾¤è®¾ç½®ä¸­ï¼Œç¬¬ä¸€æ­¥æ˜¯ä¸ºæ¯ä¸ªé›†ç¾¤å»ºç«‹ä¸€ä¸ªç½‘å…³ã€‚ç„¶è€Œï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å…³é”®ä¸€ç‚¹æ˜¯éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·è®¿é—®å…¥å£ç‚¹ã€‚å°½ç®¡å¯ä»¥åœ¨åŒä¸€é›†ç¾¤ä¸­éƒ¨ç½²æ­¤ç½‘å…³ï¼Œä½†é€šå¸¸å»ºè®®å°†å…¶æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„é›†ç¾¤ä¸­ã€‚\n\nä¸¤å±‚å…¥å£ç½‘æ ¼çš„éƒ¨ç½²æ¶æ„å¦‚å›¾ 4 æ‰€ç¤ºã€‚\n\n![å›¾ 4ï¼šä¸¤å±‚å…¥å£ç½‘å…³](tier1-gw-listening.svg)\n\n### å¤šé›†ç¾¤é€šä¿¡æ‰€éœ€ç»„ä»¶ {#components}\n\nåŸºäº Istio åˆ›å»ºçš„å¤šé›†ç¾¤ç½‘æ ¼ï¼Œé€šå¸¸æ˜¯[å¤šç½‘æ ¼å¤šç½‘ç»œæ¨¡å¼](https:\/\/istio.io\/latest\/docs\/setup\/install\/multicluster\/multi-primary_multi-network\/)ï¼Œä¸ºäº†è®©ç½‘æ ¼äº’é€šï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªä¸€çº§ï¼ˆTier-1ï¼‰é›†ç¾¤ï¼Œå¹¶åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»ºå¦‚ä¸‹ç»„ä»¶ï¼š\n\n1. **å…¥å£ç½‘å…³**ï¼šæ¯ä¸ªç½‘æ ¼å¿…é¡»æœ‰ä¸€ä¸ªå…¥å£ç½‘å…³ã€‚\n2. **ServiceEntry**ï¼šç”¨äºå…è®¸é›†ç¾¤å‘ç°å½¼æ­¤çš„ç«¯ç‚¹ã€‚\n3. **VirtualServices å’Œ DestinationRules**ï¼šå¯¹äºæ¯ä¸ªé›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè·¯ç”±è‡³å…³é‡è¦ã€‚\n\n## å®æˆ˜æ¼”ç¤ºï¼šä¸€ä¸ªå¤šé›†ç¾¤æ¼”ç¤º {#demo}\n\nåœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘å°†æ¶µç›–ä¸‰ä¸ª GKE ä¸Šçš„ Kubernetes é›†ç¾¤ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„åŒºåŸŸï¼Œå¦‚å›¾ 5 æ‰€ç¤ºã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„ä¾›åº”å•†æˆ–è€…è·¨ä¾›åº”å•†ã€‚åœ¨æ¯ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²äº† Istioï¼Œä¸ºå¤šé›†ç¾¤é€šä¿¡å¥ å®šäº†åŸºç¡€ã€‚\n\nå»ºç«‹äº†ä¸¤å±‚é›†ç¾¤ï¼šä¸€ä¸ªä¸“é—¨æ‰˜ç®¡ \u0060productpage\u0060 æœåŠ¡ï¼Œå¦ä¸€ä¸ªåŒ…å«å®Œæ•´ [bookinfo](https:\/\/istio.io\/latest\/docs\/examples\/bookinfo\/) çš„æœåŠ¡å¥—ä»¶ã€‚\n\n![å›¾ 5ï¼šæ¼”ç¤ºç¯å¢ƒçš„éƒ¨ç½²æƒ…å†µ](init-infra.svg)\n\n### å®ç°å¤šé›†ç¾¤è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ {#multicluster-routing-and-lb}\n\nä¸ºäº†å®ç°è¯¸å¦‚è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ç­‰é«˜çº§åŠŸèƒ½ï¼Œè§£å†³å¤šé›†ç¾¤è·¯ç”±é—®é¢˜è‡³å…³é‡è¦ã€‚ç”±äºä¸€çº§é›†ç¾¤ä¹Ÿéƒ¨ç½²äº† Istioï¼Œå¯ä»¥å°†å…ˆå‰è®¨è®ºçš„è´Ÿè½½å‡è¡¡æŠ€å·§åº”ç”¨äºæ­¤ç½‘å…³ã€‚\n\nå…³é”®æ­¥éª¤ï¼š\n\n1. åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»ºå…¥å£ç½‘å…³ï¼Œå¹¶è·å–ç½‘å…³ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡å™¨çš„ IP åœ°å€ã€‚\n\n2. åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»º **VirtualServicesã€DestinationRules å’Œ ServiceEntries**ã€‚ç¡®ä¿ ServiceEntries åŒ…å«æ¯ä¸ªé›†ç¾¤å…¥å£ç½‘å…³çš„å…¥å£ç‚¹ã€‚\n\n3. ä¸ºè¿›ä¸€æ­¥çš„æµ‹è¯•ï¼Œ**æ£€ç´¢ Tier 1 ç½‘å…³çš„ IP åœ°å€**ã€‚\n\n   \u0060\u0060\u0060bash\n   export GATEWAY_IP=$(kubectl -n tier1 get service tier1-gateway -o jsonpath=\u0027{.status.loadBalancer.ingress[0].ip}\u0027)\n   \u0060\u0060\u0060\n\n   æ³¨æ„ï¼šè¿™ä¸€æ­¥éœ€è¦åœ¨ä¸€çº§é›†ç¾¤ä¸­æ“ä½œã€‚\n\nä¸€çº§é›†ç¾¤çš„ç½‘å…³ä½œä¸ºç»Ÿä¸€ç½‘å…³å…¥å£ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨è¿™ä¸ªé›†ç¾¤ä¸­é…ç½® Gatewayã€VirtualServiceã€DestinationRule å’Œ ServiceEntry èµ„æºå¯¹è±¡ï¼Œå®ç°å¤šé›†ç¾¤çš„è·¯ç”±ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚\n\n![å›¾ 6ï¼šä¸€çº§é›†ç¾¤ä¸­çš„ Istio èµ„æº](istio-resources.svg)\n\nåœ¨è¿™ä¸ªæ¼”ç¤ºä¸­æˆ‘ä»¬å°†å®ç°åŸºäº HTTP header å’Œ prefix çš„å¤šé›†ç¾¤çš„è·¯ç”±ï¼Œæœ€ç»ˆçš„è·¯ç”±è·¯å¾„å¦‚å›¾ 7 æ‰€ç¤ºã€‚\n\n![å›¾ 7ï¼šè·¯ç”±è·¯å¾„](final.svg)\n\nå…³äºæ“ä½œçš„ç»†èŠ‚å¯ä»¥å‚è€ƒ TSB æ–‡æ¡£ä¸­çš„[ç»Ÿä¸€ç½‘å…³](https:\/\/docs.tetrate.io\/service-bridge\/next\/howto\/gateway\/unified-gateway)ã€‚\n\n### æµ‹è¯•è®¾ç½® {#test}\n\næ¼”ç¤ºç»§ç»­è¿›è¡Œå®é™…æµ‹è¯•ï¼Œä½¿ç”¨ \u0060curl\u0060 å‘½ä»¤ï¼š\n\n1. æ— éœ€ HTTP æ ‡å¤´çš„è¯·æ±‚ URLã€‚\n\n   \u0060\u0060\u0060bash\n   curl -Ss \u0022http:\/\/bookinfo.tetrate.io\/productpage\u0022 --resolve \u0022bookinfo.tetrate.io:80:$GATEWAY_IP\u0022 -v \u003e index1.html\n   \u0060\u0060\u0060\n\n2. ä½¿ç”¨æŒ‡ç¤ºé¦–é€‰é›†ç¾¤çš„ HTTP æ ‡å¤´è¯·æ±‚ URLã€‚\n\n   \u0060\u0060\u0060bash\n   curl -Ss \u0022http:\/\/bookinfo.tetrate.io\/productpage\u0022 --resolve \u0022bookinfo.tetrate.io:80:$GATEWAY_IP\u0022 -v -H \u0022X-CLUSTER-SELECTOR: gke-jimmy-us-west1-1\u0022 \u003e index2.html\n   curl -Ss \u0022http:\/\/bookinfo.tetrate.io\/productpage\u0022 --resolve \u0022bookinfo.tetrate.io:80:$GATEWAY_IP\u0022 -v -H \u0022X-CLUSTER-SELECTOR: gke-jimmy-us-west1-2\u0022 \u003e index3.html\n   \u0060\u0060\u0060\n\né€šè¿‡å¯¼å‡ºçš„ HTML æ–‡ä»¶éªŒè¯ç»“æœã€‚åœ¨æµè§ˆå™¨ä¸­åˆ†åˆ«æ‰“å¼€ \u0060index1.html\u0060ã€\u0060index2.html\u0060 å’Œ \u0060index3.html\u0060 è¿™ä¸‰ä¸ªæ–‡ä»¶ï¼Œä½ å°†çœ‹åˆ°é¡µé¢ 1 å’Œé¡µé¢ 2 ä¸­éƒ½æ˜¾ç¤º reviews å’Œ details æœåŠ¡ä¸å¯ç”¨ï¼Œåªæœ‰é¡µé¢ 3 ä¸­çš„æ‰€æœ‰æœåŠ¡éƒ½å¯è®¿é—®ã€‚\n\n### å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡ {#multicluster-lb}\n\næ¼”ç¤ºæˆåŠŸå±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ HTTP æ ‡å¤´å’Œè·¯å¾„è·¯ç”±ã€‚è·¯ç”±æ˜¯è´Ÿè½½å‡è¡¡çš„åŸºç¡€ã€‚å®ç°äº†å¤šé›†ç¾¤è·¯ç”±ä¹‹åï¼Œä½ å°±å¯ä»¥å°†æ¥è‡ªäºŒçº§ï¼ˆTier-2ï¼‰é›†ç¾¤çš„ç«¯ç‚¹æ·»åŠ åˆ°ä¸€ä¸ª subset ä¸­ï¼Œä»è€Œåœ¨ DestinationRule ä¸­å®ç°è´Ÿè½½å‡è¡¡é…ç½®ã€‚\n\nå¯ä»¥é€šè¿‡å°†äºŒçº§é›†ç¾¤ä¸­çš„å…¥å£ç½‘å…³é…ç½®ä¸ºä¸œè¥¿å‘ç½‘å…³ï¼Œä»è€Œè§£å†³ Cluster 1 ä¸­çš„æ•…éšœè½¬ç§»é—®é¢˜ã€‚è¯·å‚è€ƒ [Istio æ–‡æ¡£](https:\/\/istio.io\/latest\/docs\/setup\/install\/multicluster\/multi-primary_multi-network\/)ã€‚\n\n### è‡ªåŠ¨åŒ–çš„å‘¼å£° {#automation}\n\nå°½ç®¡ Istio æä¾›äº†åŸºäº Envoy çš„å„ç§è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œä½†æ‰‹åŠ¨åœ¨å¤šä¸ªé›†ç¾¤ä¸­åˆ›å»ºèµ„æºå¯¹è±¡å®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡ä½ä¸‹ã€‚è‡ªåŠ¨åŒ–ï¼Œæœ€å¥½æ˜¯åœ¨ Istio ä¹‹ä¸Šæ·»åŠ ä¸€ä¸ªè§£é‡Šå±‚ï¼Œæ˜¯ä¸‹ä¸€ä¸ªå‘å±•é˜¶æ®µã€‚\n\nTetrate ä½¿ç”¨ TSB è§£å†³äº†è¿™ä¸ªéœ€æ±‚ï¼ŒTSB ä¸ä¸Šæ¸¸çš„ Istio å…¼å®¹ï¼Œä¸ºå¤šé›†ç¾¤éƒ¨ç½²æä¾›äº†æ— ç¼çš„è§£å†³æ–¹æ¡ˆã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® [Tetrate ç½‘ç«™](https:\/\/tetrate.io)ã€‚\n\n## æ€»ç»“ {#summary}\n\nç²¾é€š Istio ä¸­çš„å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡å¯¹äºåœ¨å¤æ‚ç¯å¢ƒä¸­å‘æŒ¥å¾®æœåŠ¡çš„å…¨éƒ¨æ½œåŠ›è‡³å…³é‡è¦ã€‚é€šè¿‡è°¨æ…çš„é…ç½®å’Œåˆé€‚çš„å·¥å…·ï¼Œæ‚¨å¯ä»¥åœ¨é›†ç¾¤ä¹‹é—´å®ç°å¼ºå¤§ä¸”å¯é çš„é€šä¿¡ï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºæ— è®ºéƒ¨ç½²åœ¨ä½•å¤„éƒ½èƒ½é¡ºåˆ©è¿è¡Œã€‚å¯¹äºæ›´ç²¾ç»†çš„è´Ÿè½½å‡è¡¡è°ƒæ•´ï¼Œè¯·è€ƒè™‘æ¢ç´¢ EnvoyFilterã€‚æ„Ÿè°¢æ‚¨åŠ å…¥æˆ‘ä»¬ä¸€èµ·æ­ç§˜ Istio ä¸­çš„å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡ä¹‹æ—…ï¼\n\n## å‚è€ƒ {#reference}\n\n- [Install Multi-Primary on different networks - istio.io](https:\/\/istio.io\/latest\/docs\/setup\/install\/multicluster\/multi-primary_multi-network\/)\n- [Unified Gateway - docs.tetrate.io](https:\/\/docs.tetrate.io\/service-bridge\/next\/howto\/gateway\/unified-gateway)\n- [DestinationRule - istio.io](https:\/\/istio.io\/latest\/docs\/reference\/config\/networking\/destination-rule\/)\n', '\/blog\/demystifying-the-load-balancing-in-istio\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">Istio è´Ÿè½½å‡è¡¡è¯¦è§£å°¤å…¶æ˜¯å¤šé›†ç¾¤å¦‚ä½•å®ç°è·¯ç”±ä¸è´Ÿè½½å‡è¡¡çš„ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªå¤šé›†ç¾¤è·¯ç”±çš„æ¼”ç¤ºã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/">å¦‚ä½•ä½¿ç”¨ GraphQL å’Œ Postman æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/07/20</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('å¦‚ä½•ä½¿ç”¨ GraphQL å’Œ Postman æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®', 'æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚å®ƒé¦–å…ˆä»‹ç»äº† GraphQL å’Œ SkyWalkingï¼Œç„¶åä»‹ç»äº†å¦‚ä½•è®¾ç½® Postman å‘é€ GraphQL æŸ¥è¯¢ï¼Œæœ€åæä¾›äº†ä¸€äº›ç¤ºä¾‹ GraphQL æŸ¥è¯¢ï¼Œå¯ç”¨äºä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚', '\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ [GraphQL ä¸](https:\/\/graphql.org\/)[Postman](https:\/\/www.postman.com\/) ä¸€èµ·ä» [SkyWalking](https:\/\/skywalking.apache.org\/) æŸ¥è¯¢æ•°æ®ã€‚å®ƒåŒ…æ‹¬è·å–ä¸è®°åä»¤ç‰Œã€æ„å»ºæŸ¥è¯¢ä»¥æ£€ç´¢ç‰¹å®šæœåŠ¡çš„è´Ÿè½½æŒ‡æ ‡ä»¥åŠä½¿ç”¨ GraphQL è‡ªçœæ¥æŸ¥çœ‹ SkyWalking GraphQL API æ¶æ„çš„æ­¥éª¤ã€‚æœ¬æ–‡è¿˜æä¾›äº†æ›´å¤šä¿¡æ¯çš„å‚è€ƒã€‚\n\n## ä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ\n\nGraphQL æ˜¯ Facebook å¼€å‘çš„ä¸€ç§ API æŸ¥è¯¢è¯­è¨€å’Œè¿è¡Œæ—¶ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯å‡†ç¡®æŒ‡å®šä»–ä»¬éœ€è¦çš„æ•°æ®å¹¶ä»…æ¥æ”¶è¯¥æ•°æ®ä½œä¸ºå“åº”ï¼Œä»è€Œä¸ºä¼ ç»Ÿ REST API æä¾›äº†æ›´é«˜æ•ˆã€æ›´å¼ºå¤§ã€æ›´çµæ´»çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä½¿ç”¨ GraphQLï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨å•ä¸ªè¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ªèµ„æºï¼Œä»è€Œå‡å°‘ä¸æœåŠ¡å™¨çš„å¾€è¿”æ¬¡æ•°å¹¶æé«˜æ€§èƒ½ã€‚\n\n## GraphQL å’Œ REST API ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\nGraphQL å…è®¸å®¢æˆ·ç«¯ä»…è¯·æ±‚ä»–ä»¬éœ€è¦çš„æ•°æ®ï¼Œè€Œ REST API è¦æ±‚å®¢æˆ·ç«¯æ£€ç´¢èµ„æºä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œæ— è®ºä»–ä»¬æ˜¯å¦éœ€è¦ã€‚æ­¤å¤–ï¼ŒGraphQL å…è®¸å®¢æˆ·ç«¯åœ¨å•ä¸ªè¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ªèµ„æºï¼Œè¿™ä½¿å…¶æ¯” REST API æ›´é«˜æ•ˆã€æ›´ç®€æ´ã€‚\n\n## å¦‚ä½•æŸ¥è¯¢ SkyWalking æ•°æ®ï¼Ÿ\n\nSkyWalking å®šä¹‰äº†æŸ¥è¯¢é˜¶æ®µçš„é€šä¿¡åè®®ã€‚SkyWalking åŸç”Ÿ UI å’Œ CLI ä½¿ç”¨æ­¤åè®®ä»åç«¯æŒç»­è·å–æ•°æ®ï¼Œæ— éœ€æ‹…å¿ƒåç«¯æ›´æ–°ã€‚\n\nä» SkyWalking æŸ¥è¯¢æŒ‡æ ‡æœ‰ä¸¤ç§æ–¹æ³•ï¼š\n\n1. [GraphQL API](https:\/\/skywalking.apache.org\/docs\/main\/v9.4.0\/en\/api\/query-protocol\/)\n2. [PromQL API](https:\/\/skywalking.apache.org\/docs\/main\/v9.4.0\/en\/api\/promql-service\/)\n\næœ¬æ–‡æä¾›äº†æœ‰å…³å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢æŒ‡æ ‡çš„æŒ‡å—ã€‚å¦‚æœä½ å¯¹ PromQL API æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚é˜…æ–‡ç« [ä¸º Apache SkyWalking æ„å»º Grafana Dashboard - åŸç”Ÿ PromQL æ”¯æŒ](https:\/\/skywalking.apache.org\/zh\/2023-03-17-build-grafana-dashboards-for-apache-skywalking-native-promql-support\/) ã€‚ç»§ç»­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤éœ€è¦å®‰è£… TSBã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œä½†ä»æƒ³ä½“éªŒä½¿ç”¨ GraphQL åœ¨ SkyWalking ä¸­æŸ¥è¯¢æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ SkyWalking æä¾›çš„å…è´¹[æ¼”ç¤ºç¯å¢ƒ](https:\/\/skywalking.apache.org\/)ï¼ˆç”¨æˆ·å \/ å¯†ç ï¼šskywalking\/skywalkingï¼‰ã€‚ç™»å½•æ¼”ç¤ºç½‘ç«™å¹¶è·å–æŸ¥è¯¢ä»¤ç‰Œã€‚GraphQL æŸ¥è¯¢çš„ç«¯ç‚¹åœ°å€æ˜¯ \u003chttp:\/\/demo.skywalking.apache.org\/graphql\u003e ã€‚æ„é€ æŸ¥è¯¢çš„æ­¥éª¤ä¸ä¸‹é¢æè¿°çš„ç›¸åŒã€‚\n\n## è§‚å¯Ÿ TSB ä¸­çš„ GraphQL æŸ¥è¯¢\n\nåœ¨æˆ‘ä»¬ä½¿ç”¨ Postman æ„å»ºè‡ªå·±çš„ GraphQL æŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè§‚å¯Ÿ TSB å¦‚ä½•ä» SkyWalking è·å–æ•°æ®ã€‚\n\n1. æ‰“å¼€ Chrome DevTools å¹¶åˆ‡æ¢åˆ°â€œNetworkâ€é€‰é¡¹å¡ã€‚\n2. è®¿é—®ç½‘ç«™ä¸Šçš„**Organization - Services** é€‰é¡¹å¡ã€‚\n\nè§‚å¯Ÿç½‘ç»œè¯·æ±‚åˆ—è¡¨å¹¶å³é”®å•å‡»å…¶ä¸­ä¸€ä¸ª graphql è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![å›¾ 1ï¼šChrome DevTool](f1.jpg)\n\nä½ çœ‹åˆ°çš„ curl å‘½ä»¤å°†å¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä½ å°†ä» SkyWalking ä¸­è·å– TSB ç®¡ç†çš„æœåŠ¡åˆ—è¡¨ã€‚\n\n\u0060\u0060\u0060bash\ncurl \u0027\u003chttps:\/\/saturn.tetrate.work\/ui\/graphql\u003e\u0027 \\\\\n  -H \u0027Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7,zh-TW;q=0.6\u0027 \\\\\n  -H \u0027Cache-Control: no-cache\u0027 \\\\\n  -H \u0027Client-Timestamp: 1686104776136\u0027 \\\\\n  -H \u0027Connection: keep-alive\u0027 \\\\\n  -H \u0027Content-Type: application\/json\u0027 \\\\\n  -H \u0027Cookie: ...\u0027 \\\\\n  -H \u0027Origin: \u003chttps:\/\/saturn.tetrate.work\u003e\u0027 \\\\\n  -H \u0027Pragma: no-cache\u0027 \\\\\n  -H \u0027Referer: \u003chttps:\/\/saturn.tetrate.work\/mp\/services\u003e\u0027 \\\\\n  -H \u0027Request-Id: ...\u0027 \\\\\n  -H \u0027Sec-Fetch-Dest: empty\u0027 \\\\\n  -H \u0027Sec-Fetch-Mode: cors\u0027 \\\\\n  -H \u0027Sec-Fetch-Site: same-origin\u0027 \\\\\n  -H \u0027User-Agent: Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/114.0.0.0 Safari\/537.36\u0027 \\\\\n  -H \u0027X-Bridge-Csrf-Token: IOmJszLAqY3TRIUNhTuGu7vQgnfQY1FtgYFm\u002bl\/\u002bMu4EmVQU5T8EaQ7bngkCv4hQ12ZGids\u002bI21pHMdepE9\/qQ==\u0027 \\\\\n  -H \u0027X-Csrf-Token: xTbxZerD3t8N3PaS7nbjKCfxk1Q9dtvvrx4D\u002bIJohHicb0VfB4iAZaP0zh1eXDWctQyCYZWaKLhAYT3M6Drk3A==\u0027 \\\\\n  -H \u0027accept: application\/json\u0027 \\\\\n  -H \u0027sec-ch-ua: \u0022Not.A\/Brand\u0022;v=\u00228\u0022, \u0022Chromium\u0022;v=\u0022114\u0022, \u0022Google Chrome\u0022;v=\u0022114\u0022\u0027 \\\\\n  -H \u0027sec-ch-ua-mobile: ?0\u0027 \\\\\n  -H \u0027sec-ch-ua-platform: \u0022macOS\u0022\u0027 \\\\\n  --data-raw $\u0027{\u0022query\u0022:\u0022query ServiceRegistryListMetrics(...)}\u0027 \\\\\n  --compressed\n\u0060\u0060\u0060\n\n**æ³¨æ„ï¼š** *ä¸Šä¾‹ä¸­çš„æŸäº›å­—æ®µå¤ªé•¿ï¼Œç”¨ç‚¹ (...) æ›¿æ¢*ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘å°†æŒ‡å¯¼ä½ æ„å»ºä¸€ä¸ªæŸ¥è¯¢æ¥æ£€ç´¢ç‰¹å®šæœåŠ¡çš„è´Ÿè½½æŒ‡æ ‡ã€‚\n\n## è·å– Bearer Token\n\né¦–å…ˆï¼Œä½ éœ€è¦è·å–ç½‘ç«™çš„ Bearer Tokenã€‚ç™»å½•åˆ° TSB UIï¼Œç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·æŒ‰é’®ï¼Œç„¶åç‚¹å‡»â€œShow token informationâ€ã€‚åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œä½ å°†çœ‹åˆ° Bearer Tokenï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![å›¾ 2ï¼šä» TSB UI è·å– Bear Token](f2.jpg)\n\næ³¨æ„ï¼šBearer token çš„æœ‰æ•ˆæœŸæ¯”è¾ƒçŸ­ã€‚å½“å®ƒè¿‡æœŸæ—¶ï¼Œä½ éœ€è¦é‡æ–°ç™»å½• TSB ä»¥è·å–æ–°çš„ tokenã€‚\n\næˆ‘ä»¬å·²ç»é¢„å…ˆéƒ¨ç½²äº†[bookinfo åº”ç”¨ç¨‹åº](https:\/\/istio.io\/latest\/docs\/examples\/bookinfo\/)å¹¶å‘é€äº†ä¸€äº›æµ‹è¯•æµé‡ã€‚è¦åœ¨ Postman å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ GraphQL æŸ¥è¯¢\u0060reviews\u0060çš„è´Ÿè½½æŒ‡æ ‡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. åˆ›å»ºä¸€ä¸ªæ–°çš„ GraphQL è¯·æ±‚ï¼Œå¹¶è¾“å…¥è¯·æ±‚ URLï¼š\u0060$TSB_ADDRESS\/graphql\u0060\n2. æ·»åŠ å¸¦æœ‰å€¼\u0060Bearer $TOKEN\u0060çš„\u0060Authorization\u0060å¤´\n3. ä½¿ç”¨ GraphQL Introspection æŸ¥çœ‹ SkyWalking GraphQL APIs çš„æ¨¡å¼ã€‚æŸ¥æ‰¾å¹¶å•å‡»\u0060readMetricsValues\u0060é¡¹ã€‚ä½ å°†åœ¨å³ä¾§çœ‹åˆ°å˜é‡ã€‚å¡«å†™\u0060condition\u0060å’Œ\u0060duration\u0060é¡¹ç›®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![å›¾ 3ï¼šPostman æŸ¥è¯¢](f3.jpg)\n\nå˜é‡å¦‚ä¸‹ï¼š\n\n\u0060\u0060\u0060graphql\nquery ReadMetricsValues {\n    readMetricsValues(condition: {\n    name: \u0022service_cpm\u0022, entity: {scope: Service, serviceName: \u0022reviews\u0022, normal: true}\n  }, duration: {\n    start: \u00222023-06-05 0625\u0022,\n    end: \u00222023-06-05 0627\u0022,\n    step: MINUTE\n  }) {\n        label\n        values {\n            values {\n                id\n                value\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\nå•å‡» Query æŒ‰é’®ä»¥è·å–ç»“æœã€‚å®ƒåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š\n\n\u0060\u0060\u0060json\n{\n    \u0022data\u0022: {\n        \u0022readMetricsValues\u0022: {\n            \u0022label\u0022: null,\n            \u0022values\u0022: {\n                \u0022values\u0022: [\n                    {\n                        \u0022id\u0022: \u0022service_cpm_202306050625_cmV2aWV3cw==.1\u0022,\n                        \u0022value\u0022: 0\n                    },\n                    {\n                        \u0022id\u0022: \u0022service_cpm_202306050626_cmV2aWV3cw==.1\u0022,\n                        \u0022value\u0022: 0\n                    },\n                    {\n                        \u0022id\u0022: \u0022service_cpm_202306050627_cmV2aWV3cw==.1\u0022,\n                        \u0022value\u0022: 0\n                    }\n                ]\n            }\n        }\n    }\n}\n\u0060\u0060\u0060\n\nä»¥ä¸Šæ˜¯ä½¿ç”¨ SkyWalking Demo ç¯å¢ƒæµ‹è¯• GraphQL æŸ¥è¯¢ã€‚TSE ä¹Ÿæ”¯æŒ GraphQL æŸ¥è¯¢ï¼Œå¹¶ä¸”ç«¯ç‚¹åœ°å€ä¸º\u0060$TSB_SERVER\/graphql\u0060ã€‚\n\næ³¨æ„ï¼šæ­¤å¤„çš„æŸ¥è¯¢ç«¯ç‚¹ä¸ DevTool ä¸­çœ‹åˆ°çš„ä¸åŒã€‚TSB UI ç‰¹å®šçš„ GraphQL æŸ¥è¯¢ç«¯ç‚¹æ˜¯\u0060$TSB_SERVER\/ui\/graphql\u0060ã€‚\n\næœ‰å…³ SkyWalking GraphQL æŸ¥è¯¢åè®®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[GitHub](https:\/\/github.com\/apache\/skywalking-query-protocol\/tree\/master)ã€‚\n\n## æ€»ç»“\n\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•åœ¨ Postman ä¸­ä½¿ç”¨ GraphQL æŸ¥è¯¢åè®®æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®ã€‚ä½ å¯ä»¥æ ¹æ® SkyWalking çš„ GraphQL æ¨¡å¼æ„å»ºè‡ªå·±çš„æŸ¥è¯¢æ¡ä»¶ã€‚TSB \/ TSE ä¸­ä¹Ÿæä¾›äº†æ­¤åŠŸèƒ½ã€‚\n', '\/blog\/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚å®ƒé¦–å…ˆä»‹ç»äº† GraphQL å’Œ SkyWalkingï¼Œç„¶åä»‹ç»äº†å¦‚ä½•è®¾ç½® Postman å‘é€ GraphQL æŸ¥è¯¢ï¼Œæœ€åæä¾›äº†ä¸€äº›ç¤ºä¾‹ GraphQL æŸ¥è¯¢ï¼Œå¯ç”¨äºä» SkyWalking æŸ¥è¯¢å¯è§‚æµ‹æ€§æ•°æ®ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/understanding-istio-and-open-policy-agent-opa/">[è¯‘] Istio ä¸­çš„å¤–éƒ¨æˆæƒè¿‡æ»¤å™¨ï¼šä½¿ç”¨ OPA å®ç°çµæ´»çš„æˆæƒç­–ç•¥</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/03/28</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://tetrate.io/blog/understanding-istio-and-open-policy-agent-opa/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Istio ä¸­çš„å¤–éƒ¨æˆæƒè¿‡æ»¤å™¨ï¼šä½¿ç”¨ OPA å®ç°çµæ´»çš„æˆæƒç­–ç•¥', 'æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å°†æœåŠ¡ç½‘æ ¼å’Œå¼€æ”¾ç­–ç•¥ä»£ç†ï¼ˆOPAï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥å®ç°åŸºäºèº«ä»½çš„åˆ†å‰²çš„äº”ä¸ªç­–ç•¥æ£€æŸ¥ã€‚æœåŠ¡ç½‘æ ¼ä¸ºå‰å››é¡¹æ£€æŸ¥æä¾›äº†æ‰§è¡Œç‚¹ï¼Œè€Œ OPA åˆ™åœ¨ç¬¬äº”é¡¹ä¸­å‘æŒ¥ä½œç”¨ã€‚æœ¬æ–‡è¿˜æ¢è®¨äº†å¦‚ä½•å°†ç‰¹å®šäºä¸šåŠ¡çš„ç­–ç•¥åº”ç”¨äºè¯·æ±‚ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ OIDC æˆ–ä¸“ç”¨æˆæƒåŸºç¡€è®¾æ–½æ¥å®ç°æœ€ç»ˆç”¨æˆ·å¯¹èµ„æºçš„æˆæƒã€‚', '\nå®¢æˆ·å‘æˆ‘ä»¬è¯¢é—®æœåŠ¡ç½‘æ ¼å®è·µä¸­å…³äºå¼€æ”¾ç­–ç•¥ä»£ç† (OPA) å’ŒæœåŠ¡ç½‘æ ¼å¦‚ä½•ç»“åˆä½¿ç”¨çš„é—®é¢˜ã€‚æˆ‘ä»¬æ¢è®¨äº†å…³äºæœåŠ¡ç½‘æ ¼å’Œ OPA ç­–ç•¥çš„æœ€ä½³å®è·µï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•ç›¸äº’è¡¥å……çš„æƒ³æ³•ã€‚ä¸ºäº†æ„å»ºè®¨è®ºæ¡†æ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† NIST çš„é›¶ä¿¡ä»»æ¶æ„æ ‡å‡†ã€‚åœ¨å³å°†å‘å¸ƒçš„ NIST æ ‡å‡†æ–‡æ¡£ç‰¹åˆ«å‡ºç‰ˆç‰© 800-207A ä¸­ï¼ŒåŸºäºèº«ä»½çš„åˆ†æ®µæ˜¯ä¸€ä¸ªä¸»è¦æ¦‚å¿µã€‚æœ€ä½æ ‡å‡†åŒ…æ‹¬äº”é¡¹ç­–ç•¥æ£€æŸ¥ï¼Œåº”åº”ç”¨äºè¿›å…¥çš„æ¯ä¸ªè¯·æ±‚ç³»ç»Ÿå’Œæ¯ä¸ªåç»­è·ƒç‚¹ã€‚æ‚¨å¯ä»¥è§‚çœ‹æˆ‘ä»¬åœ¨ä»Šå¹´çš„ CloudNativeSecurityCon ä¸Šä¸æ¥è‡ª NIST çš„ Ramaswami Chandramouli è¿›è¡Œçš„æ·±å…¥è®¨è®ºçš„[æ¼”ç¤º](https:\/\/www.youtube.com\/watch?v=s2lIaFhkA8c)ã€‚\n\n**ä½¿ç”¨æœåŠ¡ç½‘æ ¼å®ç°åŸºäºèº«ä»½çš„åˆ†å‰²çš„äº”ä¸ªç­–ç•¥æ£€æŸ¥ï¼š**\n\n1. ä¼ è¾“ä¸­åŠ å¯†\n2. æœåŠ¡èº«ä»½å’Œè®¤è¯\n3. æœåŠ¡åˆ°æœåŠ¡æˆæƒ\n4. æœ€ç»ˆç”¨æˆ·èº«ä»½å’Œèº«ä»½éªŒè¯\n5. æœ€ç»ˆç”¨æˆ·å¯¹èµ„æºçš„æˆæƒ\n\nç®€è€Œè¨€ä¹‹ï¼ŒæœåŠ¡ç½‘æ ¼æ˜¯ä¸€ä¸ªä¸“ç”¨çš„åŸºç¡€è®¾æ–½å±‚ï¼Œä¸“é—¨ç”¨äºä¸ºå‰å››é¡¹æ£€æŸ¥å®æ–½ç­–ç•¥ï¼Œå¹¶åœ¨ç¬¬äº”é¡¹ä¸­å‘æŒ¥ä¸€å®šä½œç”¨ã€‚OPA çš„äº®ç‚¹åœ¨äºç¬¬äº”ç‚¹ï¼šæœ€ç»ˆç”¨æˆ·å¯¹èµ„æºçš„æˆæƒã€‚\n\nIstio çš„ sidecar ä»£ç†å……å½“å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„å®‰å…¨å†…æ ¸ã€‚Envoy æ•°æ®å¹³é¢æ˜¯ä¸€ä¸ªé€šç”¨çš„ç­–ç•¥æ‰§è¡Œç‚¹ (PEP)ï¼Œå¯ä»¥æ‹¦æˆªæ‰€æœ‰æµé‡å¹¶å¯ä»¥åœ¨åº”ç”¨å±‚åº”ç”¨ç­–ç•¥ã€‚å°±æ­¤è€Œè¨€ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‚è€ƒç›‘è§†å™¨ ( [NIST SP 800-204B](https:\/\/csrc.nist.gov\/publications\/detail\/sp\/800-204b\/final) )ã€‚å°† Envoy ä½œä¸º PEPï¼Œæˆ‘ä»¬å¯ä»¥å°†å®‰å…¨é—®é¢˜ä»åº”ç”¨ç¨‹åºè½¬ç§»åˆ°ç½‘æ ¼ä¸­ã€‚\n\nç­–ç•¥**æ£€æŸ¥ 1-2ï¼šä¼ è¾“ä¸­çš„åŠ å¯†å’ŒæœåŠ¡èº«ä»½ä¸è®¤è¯**ã€‚ä¸ºäº†æ»¡è¶³å‰ä¸¤ä¸ªç­–ç•¥æ£€æŸ¥ã€ä¼ è¾“ä¸­çš„åŠ å¯†ä»¥åŠæœåŠ¡èº«ä»½å’Œèº«ä»½éªŒè¯ï¼Œç½‘æ ¼ä¸ºç³»ç»Ÿä¸­çš„æ‰€æœ‰é€šä¿¡å®æ–½ mTLSã€‚\n\n**ç­–ç•¥æ£€æŸ¥ 3ï¼šæœåŠ¡åˆ°æœåŠ¡æˆæƒã€‚** æœåŠ¡ç½‘æ ¼è¿˜æä¾›ç­–ç•¥ä¸‰ï¼Œå³æœåŠ¡åˆ°æœåŠ¡çš„æˆæƒã€‚OPA å¯ä»¥åœ¨è¿™é‡Œå¼€å§‹å‘æŒ¥ä½œç”¨ï¼Œä½†ç”±äº OPA æ˜¯é€šç”¨çš„ï¼Œå®ƒæ²¡æœ‰å›´ç»•æœåŠ¡é€šä¿¡çš„ DSLï¼Œå› æ­¤æ‚¨å¿…é¡»è‡ªå·±åˆ›å»ºå®ƒã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬è®¤ä¸ºç­–ç•¥å¾€å¾€æ›´è‡ªç„¶ï¼Œæ›´å®¹æ˜“ç”¨ä¸“ä¸ºå®ƒæ„å»ºçš„è¯­è¨€æ¥è¡¨è¾¾ã€‚æœåŠ¡ç½‘æ ¼ â€”â€” æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„åº”ç”¨ç¨‹åºè¿æ¥å’Œå®‰å…¨å¹³å° [Tetrate Service Bridge](https:\/\/tetrate.io\/tetrate-service-bridge\/)â€”â€” å…·æœ‰å¯¹ç¼–å†™æœåŠ¡åˆ°æœåŠ¡ç­–ç•¥æœ‰æ„ä¹‰çš„åè¯ã€‚\n\n**ç­–ç•¥æ£€æŸ¥ 4ï¼šæœ€ç»ˆç”¨æˆ·èº«ä»½å’Œèº«ä»½éªŒè¯ã€‚** å¯¹äºç¬¬å››ä¸ªç­–ç•¥æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿçš„æ¯ä¸€è·³éªŒè¯æœ€ç»ˆç”¨æˆ·èº«ä»½ã€‚æœåŠ¡ç½‘æ ¼æä¾›æ‰§è¡Œç‚¹æ¥è¿›è¡Œæ£€æŸ¥ï¼Œä½†æœ‰å…³ç”¨æˆ·èº«ä»½éªŒè¯çš„å®é™…å†³å®šæ—¢ä¸åœ¨æœåŠ¡ç½‘æ ¼é¢†åŸŸä¹Ÿä¸åœ¨ OPA èŒƒå›´å†…ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦å§”æ‰˜ç»™å—ä¿¡ä»»çš„èº«ä»½æä¾›è€…æ¥åœ¨æ­¤å¤„åšå‡ºåˆ¤å†³ã€‚\n\n**ç­–ç•¥æ£€æŸ¥ 5ï¼šæœ€ç»ˆç”¨æˆ·å¯¹èµ„æºçš„æˆæƒã€‚** é›¶ä¿¡ä»»äº‘åŸç”Ÿè®¿é—®æ§åˆ¶çš„ç¬¬äº”ä¸ªç­–ç•¥æ£€æŸ¥æ˜¯ OPA å¯ä»¥å‘æŒ¥é‡è¦ä½œç”¨çš„åœ°æ–¹ã€‚æœåŠ¡ç½‘æ ¼æ²¡æœ‰æœ€ç»ˆç”¨æˆ·å’Œèµ„æºä¹‹é—´å…³ç³»çš„æ¨¡å‹ï¼Œå› æ­¤ä¸é€‚åˆç¼–å†™æœ‰å…³å®ƒçš„ç­–ç•¥ã€‚NIST çš„æŒ‡å—æ˜¯é€šè¿‡ OIDC ä¸ç°æœ‰ç³»ç»Ÿé›†æˆæˆ–åˆ©ç”¨ä¸“ç”¨æˆæƒåŸºç¡€è®¾æ–½ â€”â€” ä¾‹å¦‚ï¼ŒNIST çš„ä¸‹ä¸€ä»£è®¿é—®æ§åˆ¶ (NGAC) å’Œ Open Policy Agentã€‚\n\nä¾‹å¦‚ï¼Œä»¥åª’ä½“æµæœåŠ¡åŠå…¶æ’­æ”¾åˆ—è¡¨ä¸ºä¾‹ã€‚æˆ‘ä»¬å¯èƒ½éœ€è¦æˆæƒæœ€ç»ˆç”¨æˆ·è®¿é—®æ•°ç™¾ä¸‡åˆ°æ•°åäº¿ä¸ªæ’­æ”¾åˆ—è¡¨ã€‚å°±åƒ OPA ä¸æ˜¯ç‰¹åˆ«é€‚åˆæœåŠ¡åˆ°æœåŠ¡çš„æˆæƒä¸€æ ·ï¼ŒIstio æˆæƒç­–ç•¥ä¹Ÿä¸é€‚åˆæœ€ç»ˆç”¨æˆ·åˆ°èµ„æºçš„æˆæƒï¼›ä½†æ˜¯ï¼ŒOPA é€‚åˆã€‚\n\nOPA ä¹Ÿéå¸¸é€‚åˆè¶…è¶Š NIST ZTA ç­–ç•¥æ¡†æ¶çš„æ­¥éª¤ï¼š**å°†ç‰¹å®šäºä¸šåŠ¡çš„ç­–ç•¥åº”ç”¨äºè¯·æ±‚ã€‚** åœ¨æˆ‘ä»¬å®Œæˆé›¶ä¿¡ä»»çš„äº”é¡¹ç­–ç•¥æ£€æŸ¥ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å§”æ‰˜ OPA ä½œä¸ºè§„åˆ™å¼•æ“æ¥æ‰§è¡Œä¸šåŠ¡ç­–ç•¥ã€‚\n\nåœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬å°†å¯¹æ­¤å‘è¡¨æ›´å¤šçœ‹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨ SP 800-207A è¿›å…¥èµ·è‰è¿‡ç¨‹æ—¶ã€‚ä½†æ˜¯ï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨ Cloud Native Security Con ä¸Šçš„è°ˆè¯å½•éŸ³å¯¹è¿™äº›é—®é¢˜è¿›è¡Œäº†æ›´æ·±å…¥çš„è®¨è®ºï¼š\n\n- [ZTA åŸºäºèº«ä»½çš„åˆ†å‰² â€”â€”Zack Butcherã€Tetrate å’Œ Ramaswamy Chandramouliï¼ŒNIST](https:\/\/www.youtube.com\/watch?v=s2lIaFhkA8c)\n- [èµåŠ©ä¸»é¢˜æ¼”è®²ï¼šä» Google åˆ° NIST â€” äº‘åŸç”Ÿå®‰å…¨çš„æœªæ¥ â€” Zack Butcherï¼ŒTetrate](https:\/\/www.youtube.com\/watch?v=YdcVALVwwY4)\n', '\/trans\/understanding-istio-and-open-policy-agent-opa\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å°†æœåŠ¡ç½‘æ ¼å’Œå¼€æ”¾ç­–ç•¥ä»£ç†ï¼ˆOPAï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥å®ç°åŸºäºèº«ä»½çš„åˆ†å‰²çš„äº”ä¸ªç­–ç•¥æ£€æŸ¥ã€‚æœåŠ¡ç½‘æ ¼ä¸ºå‰å››é¡¹æ£€æŸ¥æä¾›äº†æ‰§è¡Œç‚¹ï¼Œè€Œ OPA åˆ™åœ¨ç¬¬äº”é¡¹ä¸­å‘æŒ¥ä½œç”¨ã€‚æœ¬æ–‡è¿˜æ¢è®¨äº†å¦‚ä½•å°†ç‰¹å®šäºä¸šåŠ¡çš„ç­–ç•¥åº”ç”¨äºè¯·æ±‚ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ OIDC æˆ–ä¸“ç”¨æˆæƒåŸºç¡€è®¾æ–½æ¥å®ç°æœ€ç»ˆç”¨æˆ·å¯¹èµ„æºçš„æˆæƒã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/">ä½¿ç”¨ Geneve éš§é“å®ç° Istio Ambient Mesh çš„æµé‡æ‹¦æˆª</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/03/24</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('ä½¿ç”¨ Geneve éš§é“å®ç° Istio Ambient Mesh çš„æµé‡æ‹¦æˆª', 'æœ¬æ–‡ä»‹ç»äº†ä»€ä¹ˆæ˜¯ Geneve éš§é“ï¼Œä¸ VXLAN çš„åŒºåˆ«ï¼Œä»¥åŠå®ƒåœ¨ Istio Ambient Mesh ä¸­çš„åº”ç”¨ï¼Œæœ€åè°ˆåŠä½¿ç”¨ eBPF ä¼˜åŒ–æµé‡æ‹¦æˆªã€‚', '\nåœ¨æˆ‘[ä¹‹å‰çš„åšå®¢](\/blog\/ambient-mesh-l4-traffic-path\/)åˆ†äº«ä¸­æåˆ° Istio Ambient Mesh ä½¿ç”¨ iptables å’Œ Geneve éš§é“å°†åº”ç”¨ç¨‹åº Pod ä¸­çš„æµé‡æ‹¦æˆªåˆ° Ztunnel ä¸­ã€‚å¾ˆå¤šè¯»è€…å¯èƒ½è¿˜ä¸äº†è§£è¿™ç§éš§é“åè®®ï¼Œæœ¬æ–‡å°†ä¸ºä½ ä»‹ç» Geneve éš§é“çš„å®šä¹‰ï¼ŒæŠ¥æ–‡ç»“æ„ï¼Œä»¥åŠä¸ VXLAN åè®®çš„æ¯”è¾ƒæœ‰å“ªäº›ä¼˜åŠ¿ã€‚æœ€åï¼Œæœ¬æ–‡å°†ä»‹ç» Istio Ambient Mesh å¦‚ä½•åº”ç”¨ Geneve éš§é“æ¥å®ç°æµé‡æ‹¦æˆªï¼Œä»¥åŠ Istio 1.18 ä¸­æ–°æ¨å‡ºçš„ eBPF æ¨¡å¼ã€‚\n\n## Geneve éš§é“ç®€ä»‹\n\nGENEVEï¼ˆGeneric Network Virtualization Encapsulationï¼‰æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–å°è£…ï¼ˆéš§é“ï¼‰åè®®ï¼Œå®ƒçš„è®¾è®¡çš„åˆè¡·æ˜¯ä¸ºäº†è§£å†³å½“å‰æ•°æ®ä¼ è¾“ç¼ºä¹çµæ´»æ€§å’Œå®‰å…¨æ€§çš„é—®é¢˜ã€‚Geneve åªå®šä¹‰äº†ä¸€ç§æ•°æ®å°è£…æ ¼å¼ï¼Œä¸åŒ…æ‹¬æ§åˆ¶å¹³é¢çš„ä¿¡æ¯ã€‚GENEVE ç›¸è¾ƒäº VXLAN å°è£…çš„å…³é”®ä¼˜åŠ¿åœ¨äºå…¶é€šè¿‡æ·»åŠ  TLV æ ¼å¼çš„é€‰é¡¹æ¥æ‰©å±•å¯å°è£…çš„åè®®ç±»å‹ã€‚\n\n## Geneve vs VXLAN\n\nVXLAN å’Œ Geneve éƒ½æ˜¯ç½‘ç»œè™šæ‹ŸåŒ–åè®®ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚è™šæ‹ŸåŒ–åè®®æ˜¯ä¸€ç§å°†è™šæ‹Ÿç½‘ç»œä¸ç‰©ç†ç½‘ç»œåˆ†ç¦»çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œç®¡ç†å‘˜åœ¨è™šæ‹Ÿç¯å¢ƒä¸­åˆ›å»ºå¤šä¸ªè™šæ‹Ÿç½‘ç»œï¼Œæ¯ä¸ªè™šæ‹Ÿç½‘ç»œéƒ½å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ VLAN æ ‡è¯†ç¬¦ã€IP åœ°å€å’Œè·¯ç”±ã€‚æ­¤å¤–ï¼ŒVXLAN å’Œ Geneve åè®®éƒ½ä½¿ç”¨ UDP å°è£…ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½å¤Ÿé€šè¿‡ç°æœ‰ç½‘ç»œåŸºç¡€è®¾æ–½è¿›è¡Œæ‰©å±•ã€‚VXLAN å’Œ Geneve åè®®è¿˜å…·æœ‰çµæ´»æ€§ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ä¸ä¸åŒçš„è™šæ‹ŸåŒ–å¹³å°å…¼å®¹ã€‚\n\nå›¾ 1 å±•ç¤ºäº† VXLAN ä¸ Geneve åè®®çš„æŠ¥æ–‡ç»“æ„åŠå…¶å„è‡ªçš„ Header åŒºåˆ«ã€‚\n\n![å›¾ 1ï¼šVXLAN ä¸ Geneve æŠ¥æ–‡æ ¼å¼ç¤ºæ„å›¾](vxlan-vs-geneve.svg)\n\nä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒVXLAN ä¸ Geneve éš§é“æŠ¥æ–‡çš„ç»“æ„ç±»ä¼¼ï¼Œå…¶ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨ä¸åŒçš„ UDP ç«¯å£å·å’Œåè®®å¤´ â€”â€”VXLAN ä½¿ç”¨ 4789 ç«¯å£ï¼ŒGeneve ä½¿ç”¨ 6081 ç«¯å£ï¼›Geneve åè®®å¤´æ¯” VXLAN æ›´å…·æ‰©å±•æ€§ã€‚\n\nGeneve éš§é“åè®®æ¯” VXLAN æ›´åŠ å¯æ‰©å±•æ˜¯å› ä¸º Geneve éš§é“åè®®ä¸­å¢åŠ äº†å˜é•¿é€‰é¡¹ï¼Œå®ƒå¯ä»¥åŒ…å«é›¶æˆ–å¤šä¸ª TLV æ ¼å¼çš„é€‰é¡¹æ•°æ®ã€‚TLV æ˜¯æŒ‡ç±»å‹ - é•¿åº¦ - å€¼ï¼ˆType-Length-Valueï¼‰æ ¼å¼ï¼Œç”¨äºä¼ è¾“å’Œè§£æç½‘ç»œåŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚åœ¨ Geneve åè®®ä¸­ï¼Œæ¯ä¸ªå…ƒæ•°æ®ä¿¡æ¯éƒ½ç”±ä¸€ä¸ª TLV æ ¼å¼çš„å­—æ®µç»„æˆï¼Œä»¥ä¾¿äºçµæ´»åœ°æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹è¿™äº›å…ƒæ•°æ®ã€‚\n\nå…·ä½“æ¥è¯´ï¼ŒTLV æ ¼å¼çš„å­—æ®µåŒ…æ‹¬ï¼š\n\n- Typeï¼š8 ä½çš„ç±»å‹å­—æ®µã€‚\n- Lengthï¼š5 ä½çš„é€‰é¡¹é•¿åº¦å­—æ®µï¼Œä»¥ 4 å­—èŠ‚å€æ•°è¡¨ç¤ºï¼Œä¸åŒ…æ‹¬é€‰é¡¹å¤´ã€‚\n- Dataï¼šå¯å˜é•¿çš„é€‰é¡¹æ•°æ®å­—æ®µï¼Œå¯ä»¥ä¸å­˜åœ¨æˆ–è€…ä¸º 4 åˆ° 128 å­—èŠ‚ä¹‹é—´ã€‚\n\né€šè¿‡ä½¿ç”¨ TLV æ ¼å¼ï¼ŒGeneve åè®®å¯ä»¥è½»æ¾åœ°æ‰©å±•å’Œä¿®æ”¹å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒæ—¶ä¿æŒå…¼å®¹æ€§å’Œçµæ´»æ€§ã€‚\n\nå…³äº VXLAN éš§é“æŠ¥æ–‡çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks](https:\/\/tools.ietf.org\/html\/rfc7348) ã€‚\n\nå…³äº Geneve éš§é“æŠ¥æ–‡çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [RFC 8926 Geneve: Generic Network Virtualization Encapsulation](https:\/\/www.rfc-editor.org\/rfc\/rfc8926#name-geneve-packet-format-over-i) ã€‚\n\n### å·¥ä½œåŸç†\n\nGeneve éš§é“ä¸»è¦åº”ç”¨åœ¨äº‘è®¡ç®—å’Œè™šæ‹ŸæœºåŒ–åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åŒ…å°è£…åœ¨ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ä¸­ï¼Œä»¥ä¾¿åœ¨è™šæ‹Ÿç½‘ç»œä¸­ä¼ è¾“ã€‚Geneve éš§é“ä½¿ç”¨ä¸€ä¸ª 24 ä½çš„è™šæ‹Ÿç½‘ç»œæ ‡è¯†ç¬¦ (VNI)ï¼Œå°†æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚Geneve éš§é“è¿˜å¯ä»¥ä½¿ç”¨å®‰å…¨æ€§åè®®ï¼Œå¦‚ IPsecã€TLï¼Œæ¥ä¿æŠ¤æ•°æ®åŒ…çš„ä¼ è¾“ã€‚\n\nå½“æ•°æ®åŒ…åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶ï¼ŒGeneve éš§é“åè®®ä¼šå°†æ•°æ®åŒ…ä» Geneve åè®®å¤´ä¸­è§£å°è£…å‡ºæ¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è™šæ‹Ÿç½‘ç»œä¸­çš„ç›®çš„åœ°ã€‚åœ¨è§£å°è£…è¿‡ç¨‹ä¸­ï¼ŒGeneve åè®®å¤´ä¸­çš„ VNI ä¿¡æ¯ä¼šè¢«æ¥åˆ¤æ–­æ•°æ®åŒ…çš„ç›®çš„åœ°ï¼Œä»¥ç¡®ä¿æ•°æ®åŒ…è¢«æ­£ç¡®åœ°è·¯ç”±åˆ°è™šæ‹Ÿç½‘ç»œä¸­çš„ç›®çš„åœ°ã€‚\n\nå‡è®¾æœ‰ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œå…¶ VNI ä¸º 1001ã€‚å½“æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨éš§é“å°†æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéš§é“å°†æºç‰©ç†ç½‘ç»œå’Œç›®æ ‡ç‰©ç†ç½‘ç»œä¹‹é—´çš„è™šæ‹Ÿç½‘ç»œæ ‡è¯†ç¬¦ (VNI) è®¾ç½®ä¸º 1001ï¼Œä»¥ä¾¿åœ¨ä¼ è¾“æœŸé—´è·Ÿè¸ªæ•°æ®åŒ…ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡ç‰©ç†ç½‘ç»œæ—¶ï¼Œéš§é“å°† VNI ä»æ•°æ®åŒ…ä¸­åˆ é™¤ï¼Œå¹¶å°†æ•°æ®åŒ…ä¼ é€’ç»™ç›®æ ‡ç‰©ç†ç½‘ç»œã€‚\n\n### å®‰å…¨æ€§\n\nGeneve éš§é“åè®®æœ¬èº«å¹¶æ²¡æœ‰æä¾›ä»»ä½•å®‰å…¨æœºåˆ¶ï¼Œå› æ­¤åœ¨ Geneve éš§é“ä¸­ä¼ è¾“çš„æ•°æ®åŒ…å¯èƒ½ä¼šå—åˆ°å¨èƒï¼Œä¾‹å¦‚æ•°æ®åŒ…è¢«ç¯¡æ”¹ã€æˆªè·ã€é‡æ”¾ç­‰ã€‚\n\nä¸ºäº†ä¿éšœ Geneve éš§é“ä¸­ä¼ è¾“çš„æ•°æ®åŒ…çš„å®‰å…¨æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨åè®®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®‰å…¨åè®®ï¼š\n\n1. IPsecï¼ˆInternet Protocol Securityï¼‰ï¼šIPsec æ˜¯ä¸€ç§ç½‘ç»œå±‚å®‰å…¨åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ã€è®¤è¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚ä½¿ç”¨ IPsec å¯ä»¥æä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ã€‚\n2. TLSï¼ˆTransport Layer Securityï¼‰ï¼šTLS æ˜¯ä¸€ç§åŸºäºä¼ è¾“å±‚çš„åŠ å¯†åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚ä½¿ç”¨ TLS å¯ä»¥æä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ã€‚\n3. MACSecï¼ˆMedia Access Control Securityï¼‰ï¼šMACSec æ˜¯ä¸€ç§æ•°æ®é“¾è·¯å±‚çš„å®‰å…¨åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚ä½¿ç”¨ MACSec å¯ä»¥æä¾›é“¾è·¯å±‚çš„å®‰å…¨æ€§ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šå®‰å…¨åè®®éƒ½éœ€è¦è¿›è¡Œç›¸åº”çš„é…ç½®å’Œéƒ¨ç½²ï¼Œä¸”å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚åœ¨é€‰æ‹©åˆé€‚çš„å®‰å…¨åè®®æ—¶ï¼Œéœ€è¦è€ƒè™‘å®‰å…¨æ€§ã€æ€§èƒ½ã€å¯ç®¡ç†æ€§ç­‰æ–¹é¢çš„å› ç´ ã€‚\n\n### ä¸ºä»€ä¹ˆé€‰æ‹© Geneveï¼Ÿ\n\nä¸‹è¡¨å¯¹æ¯”äº† VXLAN ä¸ Geneve åœ¨å¤šä¸ªæ–¹é¢çš„ç‰¹ç‚¹ã€‚\n\n| ç‰¹æ€§ | VXLAN | Geneve |\n| --- | --- | --- |\n| å¤´éƒ¨æ ¼å¼ | å›ºå®šæ ¼å¼ | å¯æ‰©å±•æ ¼å¼ |\n| å¯æ‰©å±•æ€§ | æ›´å¤šåœ°ä¸“æ³¨äº L2 æ‰©å±• | æ›´å¥½åœ°æ”¯æŒæ–°å…´ç½‘ç»œæœåŠ¡ |\n| å¯æ“ä½œæ€§ | è¾ƒéš¾ç®¡ç†å’Œæ‰©å±• | æ›´å®¹æ˜“ç®¡ç†å’Œæ‰©å±• |\n| æ€§èƒ½ | å¤´éƒ¨è¾ƒçŸ­ï¼Œæ€§èƒ½è¾ƒé«˜ | å¤´éƒ¨è¾ƒé•¿ï¼Œæ€§èƒ½ç•¥ä½ |\n\nä½¿ç”¨ Geneve åè®®çš„ä¸»è¦åŸå› æ˜¯å°†ç›®å‰ç½‘ç»œè™šæ‹ŸåŒ–å°è£…æŠ€æœ¯ï¼ˆä¾‹å¦‚ VXLANã€NVGRE å’Œ STTï¼‰ä¸­çš„ä¼˜ç‚¹åˆå¹¶åˆ°ä¸€ä¸ªåè®®ä¸­ã€‚æˆ‘ä»¬é€šè¿‡å¤šå¹´çš„ç½‘ç»œè™šæ‹ŸåŒ–å¼€å‘ç»éªŒå¾—çŸ¥ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„éœ€æ±‚æ˜¯å¯æ‰©å±•æ€§ã€‚Geneve åè®®ä½¿ç”¨å¯æ‰©å±•çš„ TLV ç»“æ„å¯¹å…ƒæ•°æ®è¿›è¡Œç¼–ç ï¼Œå› æ­¤å¯ä»¥ç‹¬ç«‹åœ°å‘å±•è½¯ä»¶å’Œç¡¬ä»¶ç«¯ç‚¹çš„åŠŸèƒ½ï¼Œä»¥æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚\n\n## Istio Ambient Mesh å¦‚ä½•åº”ç”¨ Geneve éš§é“\n\nåœ¨[ä¹‹å‰çš„åšå®¢](https:\/\/jimmysong.io\/blog\/ambient-mesh-l4-traffic-path\/)ä¸­ï¼Œæˆ‘è®²è§£äº† Istio Ambient Mesh å¦‚ä½•ä½¿ç”¨ Ztunnel å®ç° L4 ä»£ç†çš„ï¼Œå›¾ 2 å±•ç¤ºä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ã€‚\n\n![å›¾ 2ï¼šä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ç¤ºæ„å›¾](geneve-tunnel.svg)\n\nä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n\n- Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºÂ \u0060istioout\u0060Â ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°†èŠ‚ç‚¹ä¸­çš„å‡ºç«™æµé‡é€æ˜åŠ«æŒåˆ°Â \u0060pistioout\u0060Â è™šæ‹Ÿç½‘å¡ï¼›\n- Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»º \u0060istioin\u0060 ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°†èŠ‚ç‚¹ä¸­çš„å…¥ç«™æµé‡é€æ˜åŠ«æŒåˆ° \u0060pistioin\u0060 è™šæ‹Ÿç½‘å¡ï¼›\n- Istio CNI åœ¨ ztunnel ä¸­åˆ›å»º \u0060pistioin\u0060 å’Œ \u0060pistioout\u0060 ç½‘å¡ï¼Œç”¨äºæ¥æ”¶ Geneve éš§é“ä¸­çš„å‘æ¥çš„æ•°æ®åŒ…ï¼›\n\n\u0060pistioin\u0060 å’Œ \u0060pistioout\u0060 è¿™ä¸¤ä¸ªç½‘å¡æ˜¯ç”± ztunnel ä¸­çš„ init å®¹å™¨æˆ– Istio CNIï¼ˆè§ [\u0060CreateRulesWithinNodeProxyNS\u0060](https:\/\/github.com\/istio\/istio\/blob\/master\/cni\/pkg\/ambient\/net_linux.go#L910) å‡½æ•°ï¼‰åˆ›å»ºçš„ï¼Œå…¶ IP åœ°å€å’Œç«¯å£ä¹Ÿæ˜¯å›ºå®šçš„ã€‚åº”ç”¨å®¹å™¨å‘å‡ºçš„æ•°æ®åŒ…éœ€è¦ç»è¿‡ \u0060istioout\u0060 ç½‘å¡å¹¶ä½¿ç”¨ Geneve éš§é“å°è£…åè½¬å‘ç»™ ztunnel å®¹å™¨ã€‚\n\n## ä½¿ç”¨ eBPF è¿›è¡Œé€æ˜æµé‡åŠ«æŒ\n\neBPFï¼ˆextended Berkeley Packet Filterï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨ Linux å†…æ ¸ä¸­è¿è¡Œå®‰å…¨çš„ç”¨æˆ·æ€ç¨‹åºã€‚eBPF æœ€åˆæ˜¯ä¸€ç§ç”¨äºè¿‡æ»¤ç½‘ç»œæ•°æ®åŒ…çš„æŠ€æœ¯ï¼Œä½†ç°åœ¨å·²ç»æ‰©å±•åˆ°å…¶ä»–é¢†åŸŸï¼Œå¦‚è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ã€æ€§èƒ½åˆ†æå’Œå®‰å…¨ç›‘æ§ç­‰ã€‚eBPF çš„ä¼˜åŠ¿åœ¨äºå…¶è½»é‡çº§ã€é«˜æ•ˆã€å®‰å…¨å’Œå¯ç¼–ç¨‹æ€§ã€‚å®ƒå¯ä»¥è¢«ç”¨äºå®æ—¶ç›‘æ§ã€ç½‘ç»œå®‰å…¨ã€åº”ç”¨ç¨‹åºè°ƒè¯•å’Œä¼˜åŒ–ã€å®¹å™¨ç½‘ç»œç­‰å¤šä¸ªé¢†åŸŸã€‚\n\nåœ¨ Istio 1.18 ä¹‹å‰ï¼ŒAmbient æ¨¡å¼ä¸­ä½¿ç”¨ iptables å’Œ Geneve éš§é“å°†åº”ç”¨ç¨‹åºæµé‡é€æ˜åŠ«æŒåˆ° ztunnel ä¸­ã€‚åœ¨ Istio 1.18 ä¸­ï¼Œå¢åŠ äº† eBPF é€‰é¡¹ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ iptables æˆ– eBPF æ¥åšæµé‡åŠ«æŒã€‚å¦‚å›¾ 3 æ‰€ç¤ºï¼ŒeBPF ç¨‹åºç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºå†…æ ¸ï¼Œå°†åº”ç”¨ç¨‹åºçš„æµé‡è½¬å‘åˆ° ztunnel ä¸­ã€‚\n\n![å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡](ebpf.svg)\n\nå›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡\n\n| å¯¹æ¯”é¡¹ | eBPF æ–¹å¼ | ä½¿ç”¨ iptables å’Œ Geneve éš§é“ |\n| --- | --- | --- |\n| æ•ˆç‡ | æ›´é«˜ | ç•¥ä½ |\n| å…¼å®¹æ€§ | éœ€è¦è¾ƒé«˜çš„ Linux å†…æ ¸ç‰ˆæœ¬ | æ›´å¥½ |\n| å®ç°éš¾åº¦ | è¾ƒé«˜ | è¾ƒä½ |\n| æ‰©å±•æ€§ | è¾ƒå¥½ | è¾ƒå·® |\n\næ ¹æ® [Istio å®˜æ–¹åšå®¢](https:\/\/istio.io\/latest\/blog\/2023\/ambient-ebpf-redirection\/)ä»‹ç»ï¼Œä½¿ç”¨ eBPF æ–¹å¼é¿å…äº†éƒ¨åˆ† iptables è§„åˆ™å’Œéš§é“å°è£…ï¼Œç›¸æ¯”ä½¿ç”¨ iptables å’Œ Geneve éš§é“æ›´åŠ é«˜æ•ˆã€‚ç„¶è€Œï¼ŒeBPF å¯¹ Linux å†…æ ¸ç‰ˆæœ¬çš„è¦æ±‚æ›´é«˜ï¼ˆè‡³å°‘ 4.20ï¼‰ï¼Œè€Œ iptables æ–¹å¼åˆ™å…·æœ‰æ›´å¥½çš„å…¼å®¹æ€§ã€‚æ­¤å¤–ï¼ŒeBPF æ–¹å¼çš„å®ç°éš¾åº¦è¾ƒé«˜ï¼Œä½†æ‰©å±•æ€§è¾ƒå¥½ã€‚\n\nè¦æƒ³ä½¿ç”¨ eBPF æ¨¡å¼è¿è¡Œ Ambient Meshï¼Œåªéœ€è¦åœ¨å®‰è£… Istio æ—¶è®¾ç½® \u0060values.cni.ambient.redirectMode\u0060 å‚æ•°å³å¯ï¼Œå¦‚ä¸‹ï¼š\n\n\u0060\u0060\u0060bash\nistioctl install --set profile=ambient --set values.cni.ambient.redirectMode=\u0022ebpf\u0022\n\u0060\u0060\u0060\n\n## æ€»ç»“\n\næœ¬æ–‡ä»‹ç»äº† Geneve éš§é“åè®®çš„å·¥ä½œåŸç†ã€å®‰å…¨æ€§å’Œä¸ VXLAN çš„æ¯”è¾ƒã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº† Istio Ambient Mesh å¦‚ä½•ä½¿ç”¨ Geneve éš§é“å®ç°æµé‡æ‹¦æˆªï¼Œå¹¶è®¨è®ºäº†ä½¿ç”¨ eBPF è¿›è¡Œé€æ˜æµé‡åŠ«æŒçš„ä¼˜ç¼ºç‚¹ã€‚Geneve éš§é“åè®®æ˜¯ä¸€ç§é€šç”¨çš„éš§é“åè®®ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿç½‘ç»œä¸­ä¼ è¾“æ•°æ®åŒ…ï¼Œå…·æœ‰æ›´å¤šçš„ä¼˜åŠ¿ï¼Œå› æ­¤åœ¨é€‰æ‹©éš§é“åè®®æ—¶ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨ Geneve éš§é“ã€‚åœ¨ Istio 1.18 ä¸­æ–°æ¨å‡ºäº† Ambient Mesh çš„çš„ eBPF æ¨¡å¼ï¼Œå¯ä»¥æä¾›ç½‘ç»œæ•ˆç‡ï¼Œä½†å¯¹ Linux å†…æ ¸ç‰ˆæœ¬æœ‰æ›´é«˜è¦æ±‚ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰ç”¨ã€‚\n\n## å‚è€ƒ\n\n- [RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks](https:\/\/tools.ietf.org\/html\/rfc7348)\n- [RFC 8926 Geneve: Generic Network Virtualization Encapsulation](https:\/\/www.rfc-editor.org\/rfc\/rfc8926#name-geneve-packet-format-over-i)\n- [Istio Ambient Mesh](https:\/\/istio.io\/latest\/docs\/ops\/deployment\/architecture\/#istio-ambient-mesh)\n- [Open vSwitch Geneve(8) man page](https:\/\/www.mankier.com\/8\/ovs-vswitchd.conf.db(5))\n', '\/blog\/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡ä»‹ç»äº†ä»€ä¹ˆæ˜¯ Geneve éš§é“ï¼Œä¸ VXLAN çš„åŒºåˆ«ï¼Œä»¥åŠå®ƒåœ¨ Istio Ambient Mesh ä¸­çš„åº”ç”¨ï¼Œæœ€åè°ˆåŠä½¿ç”¨ eBPF ä¼˜åŒ–æµé‡æ‹¦æˆªã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/tsb-tips/">å…³äº TSB ä½ åº”è¯¥çŸ¥é“çš„äº‹æƒ…</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/02/22</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/service-mesh"> 
             Service Mesh
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('å…³äº TSB ä½ åº”è¯¥çŸ¥é“çš„äº‹æƒ…', 'å¦‚æœä½ å¯¹æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰å’Œ Tetrate Service Bridge æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å¯ä»¥è§£ç­”ä½ å¿ƒä¸­å¾ˆå¤šç–‘æƒ‘ã€‚', '\næœ¬æ–‡å‡è®¾ä½ ç†Ÿæ‚‰æœåŠ¡ç½‘æ ¼å’Œ Istioï¼Œå¯¹ Tetrate å‡ºå“çš„å•†ä¸šåŒ–æœåŠ¡ç½‘æ ¼ç®¡ç†å·¥å…· Tetrate Service Bridge æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å¯ä»¥è§£ç­”ä½ å¿ƒä¸­çš„ä¸€äº›å›°æƒ‘ã€‚\n\næœ¬æ–‡ä¸­åŒ…å«äº†ï¼š\n\n- å…³äº TSB çš„ä¸€äº› FAQ\n- TSB çš„ä¸€äº›åŸºæœ¬èµ„æºå¯¹è±¡\n- TSB å®ç°çš„ä¸€äº›ç»†èŠ‚\n\n## TSB FAQ\n\nç¬”è€…å°†ç½—åˆ—ä¸€äº›å…³äº TSB çš„çŸ¥è¯†ç‚¹ï¼Œä¸»è¦æ˜¯å…³äºå®ƒä¸ Istio ä¹‹é—´çš„ä¸åŒç‚¹ï¼š\n\n1. TSB å…¨ç§° Tetrate Service Bridgeï¼Œæ˜¯ Tetrate å…¬å¸çš„æ——èˆ°äº§å“ï¼Œé¦–å‘äº 2018 å¹´ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯ 1.7ï¼Œè¿™æ˜¯ä¸€æ¬¾å•†ä¸šåŒ–äº§å“ï¼Œä½ éœ€è¦è´­ä¹°æ‰èƒ½ä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦äº†è§£æ›´å¤šæˆ–è¯·æ±‚è¯•ç”¨è¯·åœ¨[è¿™é‡Œ](https:\/\/tetrate.io\/tetrate-service-bridge\/)ç™»è®°ï¼›\n2. TSB å¯ä»¥ç§æœ‰åŒ–éƒ¨ç½²ä¹Ÿå¯ä»¥åœ¨ GKEã€AWSã€Azureã€OpenShiftã€EKS Anywhere ç­‰å¹³å°ä¸­å•ç‹¬æˆ–è·¨å¹³å°éƒ¨ç½²ï¼›\n3. TSB å¹¶ä¸æ˜¯å¯¹ Istio çš„æ”¹è¿›ç‰ˆï¼Œå®ƒæ˜¯åœ¨ Istio ä¹‹ä¸Šå»ºç«‹çš„ç®¡ç†å¹³é¢ï¼Œå®ƒå¯ä»¥ä¸ Istio å®Œå…¨å…¼å®¹ï¼Œå¹¶é€‚é…æœ€æ–°ç‰ˆçš„ Istioï¼›\n4. TSB å¹¶ä¸æ˜¯ Kubernetes ç®¡ç†å¹³å°ï¼Œå®ƒä¸èƒ½ç”¨äºç®¡ç† Kubernetes ä¸­çš„èµ„æºï¼›\n5. TSB æ˜¯åŸºäº Istioã€Envoy å’Œ Apache SkyWalking æ„å»ºï¼›\n6. TSB é€šè¿‡å®šä¹‰ Tenantã€Workspace ç­‰èµ„æºå¯¹è±¡ä¸º Istio å¢åŠ äº†å¤šç§Ÿæˆ·å’Œå¤šé›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼›\n7. ä¸ºäº†å®ç°å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼çš„ç®¡ç†ï¼ŒTSB ä¸­å®šä¹‰äº†ä¸€ç³»åˆ— Group èµ„æºï¼Œå¦‚ Trafficã€Securityã€Gateway ç­‰ï¼Œè¿™äº› CRD æœ€ç»ˆå°†è½¬åŒ–ä¸º Istio ä¸­çš„ CRD åº”ç”¨åˆ°æœåŠ¡ç½‘æ ¼ï¼›\n8. TSB å®šä¹‰äº† Tier1Gateway CRD å®ç°äº†è·¨é›†ç¾¤çš„äºŒå±‚ç½‘å…³ï¼›\n9. TSB éƒ¨ç½²å’Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼ŒTetrate å³å°†æ¨å‡ºè½»é‡çº§çš„ Tetrate Service Expressï¼ˆTSEï¼‰ç®€åŒ–æœåŠ¡ç½‘æ ¼ç®¡ç†ï¼›\n\n## TSB ä¸­çš„èµ„æºå¯¹è±¡ {#tsb-resources}\n\nå›¾ 1 å±•ç¤ºäº† TSB çš„åŸºæœ¬èµ„æºå¯¹è±¡ï¼Œå…¶ä¸­åªè¦åˆ†ä¸ºäº”å¤§ç±»ï¼š\n\n- ä¸ºäº†å®ç°å¤šç§Ÿæˆ·å’Œå¤šé›†ç¾¤ç®¡ç†çš„èµ„æºå¯¹è±¡ï¼Œå¦‚ Tenantã€Organizationã€Workspace ç­‰ï¼›\n- ä¸»è¦åŠŸèƒ½å¯¹è±¡é…ç½®ç»„ï¼Œå¦‚ Trafficã€Securityã€Gateway ç­‰ï¼›\n- Istio åŸç”Ÿ CRDï¼›\n- è§’è‰²å’Œæƒé™ç®¡ç†ï¼›\n- å…¶ä»–æ‰©å±•ï¼›\n\n![å›¾ 1ï¼šTetrate Service Bridge ä¸­çš„èµ„æºå¯¹è±¡](tsb-crd.svg)\n\nTSB æ˜¯å»ºç«‹åœ¨ Istio ä¹‹ä¸Šçš„ï¼Œä¸‹è¡¨ä¸­åˆ—å‡ºäº† TSB ä¸­çš„å¯ä»¥é€šè¿‡ tctl å‘½ä»¤è·å–çš„èµ„æºå¯¹è±¡ï¼Œå…¶ä¸­éƒ¨åˆ†åç§°ä¸ Kubernetes ä¸­åŸç”Ÿèµ„æºå¯¹è±¡é‡å¤ï¼Œä½†å®ƒä»¬å¹¶ä¸ç›¸åŒï¼š\n\n| **åç§°**                    | **è¯´æ˜**                                                     |\n| --------------------------- | ------------------------------------------------------------ |\n| ApplicationAccessBindings   | é…ç½®åº”ç”¨ç¨‹åºç”¨æˆ·è®¿é—®æƒé™ã€‚                                   |\n| AccessBindings              | ä¸º TSB ä¸­ä»»ä½•èµ„æºçš„ç”¨æˆ·åˆ†é…è®¿é—®è§’è‰²çš„é…ç½®ã€‚                  |\n| AuthorizationPolicy         | åŒ Istio ä¸­çš„æˆæƒç­–ç•¥ã€‚                                      |\n| APIAccessBindings           | é…ç½® API ç”¨æˆ·è®¿é—®æƒé™ã€‚                                      |\n| Application                 | åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œåº”ç”¨ç¨‹åºè¡¨ç¤ºä¸€ç»„ç›¸äº’å…³è”çš„æœåŠ¡é€»è¾‘åˆ†ç»„ï¼Œå¹¶å…¬å¼€ä¸€ç»„å®ç°å®Œæ•´ä¸šåŠ¡é€»è¾‘çš„ APIã€‚ |\n| Cluster                     | Kubernetes é›†ç¾¤ã€‚è¦æƒ³å°† Kubernetes é›†ç¾¤çº³å…¥ TSB ç®¡ç†ï¼Œé¦–å…ˆéœ€è¦å£°æ˜ Cluster æ·»åŠ ï¼Œç„¶åæ˜¯éƒ¨ç½² TSB Agent å’Œæ§åˆ¶å¹³é¢ï¼ˆåŒ…æ‹¬ Istioã€XCPã€GitOpsã€OAP ç­‰ç»„ä»¶ï¼‰ã€‚ |\n| DestinationRule             | Istio åŸç”Ÿ CRDï¼Œä¸»è¦ç”¨æ¥åˆ’åˆ†å¯è·¯ç”±çš„é›†ç¾¤åŠè´Ÿè½½å‡è¡¡è§„åˆ™ã€‚     |\n| EnvoyFilter                 | Istio åŸç”Ÿ CRDï¼Œä¸»è¦ç”¨æ¥æ‰©å±• Envoy çš„åŠŸèƒ½ã€‚                  |\n| EgressGateway               | é…ç½®å·¥ä½œè´Ÿè½½ä½œä¸ºå‡ºå£ç½‘å…³ã€‚                                   |\n| GatewayAccessBindings       | é…ç½®ç½‘å…³ç»„ç”¨æˆ·è®¿é—®æƒé™ã€‚                                     |\n| GatewayGroup                | ç½‘å…³ç»„ã€‚                                                     |\n| Gateway                     | ç®¡ç† TSB ä¸­è®¾ç½®çš„ç½‘å…³ï¼Œè€Œé Istio ä¸­çš„åŸç”Ÿ Gateway CRDã€‚     |\n| IstioInternalAccessBindings | ä¸º Istio å†…éƒ¨ç»„çš„ç”¨æˆ·åˆ†é…è®¿é—®è§’è‰²çš„é…ç½®ã€‚                    |\n| IngressGateway              | é…ç½®è´Ÿè½½ä½œä¸ºå…¥å£ç½‘å…³ï¼Œç±»ä¼¼äº Istio ä¸­çš„åŸç”Ÿ Gatewayã€‚        |\n| IstioInternalGroup          | é…ç½® Istio å†…éƒ¨çš„ TSB èµ„æºã€‚                                 |\n| OrganizationAccessBindings  | é…ç½®ç»„ç»‡ç”¨æˆ·è®¿é—®æƒé™ã€‚                                       |\n| Organization                | ç»„ç»‡ã€‚                                                       |\n| OrganizationSetting         | ç»„ç»‡çš„é»˜è®¤é…ç½®ï¼Œå¦‚åŒºåŸŸ Failoverã€å®‰å…¨ã€æµé‡ã€ç½‘ç»œé…ç½®ç­‰ã€‚    |\n| Metric                      | è¿è¡Œæ—¶è·å–çš„æœåŠ¡åº¦é‡ã€‚                                       |\n| Source                      | Sources æœåŠ¡å…¬å¼€äº†ç®¡ç†æ¥è‡ªèµ„æºçš„é¥æµ‹æºã€‚                     |\n| PeerAuthentication          | Istio åŸç”Ÿ CRDï¼Œé…ç½®å¯¹ç­‰è®¤è¯ï¼ˆé…ç½® mTLSï¼‰ã€‚                  |\n| RequestAuthentication       | Istio åŸç”Ÿ CRDï¼Œé…ç½®è¯·æ±‚è®¤è¯ï¼ˆJWT è§„åˆ™é…ç½®ï¼‰ã€‚               |\n| ServiceAccount              | ä¸åŒäº Kubernetes ä¸­çš„åŸç”Ÿèµ„æºå¯¹è±¡ï¼ŒTSB è‡ªå®šä¹‰çš„æœåŠ¡è´¦å·é…ç½®ã€‚ |\n| SecurityAccessBindings      | é…ç½®å®‰å…¨ç»„ç”¨æˆ·è®¿é—®æƒé™ã€‚                                     |\n| Sidecar                     | é…ç½®é¢„å®‰è£…çš„ Istio Sidecarã€‚                                 |\n| ServiceEntry                | Istio åŸç”Ÿ CRDï¼Œæ·»åŠ æœåŠ¡å¯¹è±¡ã€‚                               |\n| SecurityGroup               | å®‰å…¨é…ç½®ç»„ã€‚                                                 |\n| ServiceRoute                | é…ç½®æœåŠ¡è·¯ç”±ã€‚                                               |\n| SecuritySetting             | å®‰å…¨è®¾ç½®å°†é…ç½®åº”ç”¨äº SecurityGroup æˆ– Workspace ä¸­çš„ä¸€ç»„ä»£ç†å·¥ä½œè´Ÿè½½ã€‚å½“åº”ç”¨äº SecurityGroup æ—¶ï¼Œç¼ºå¤±çš„å­—æ®µå°†ä» Workspace èŒƒå›´è®¾ç½®ç»§æ‰¿å€¼ (å¦‚æœæœ‰çš„è¯)ã€‚ |\n| ServiceSecuritySetting      | å®‰å…¨ç»„é…ç½®ã€‚                                                 |\n| Service                     | æ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡ï¼Œè¡¨ç¤ºæ‰€æœ‰è¿™äº›å•ç‹¬æœåŠ¡çš„èšåˆå’Œé€»è¾‘è§†å›¾ï¼Œå¹¶æä¾›èšåˆæŒ‡æ ‡ç­‰é«˜çº§åŠŸèƒ½ã€‚ |\n| Tier1Gateway                | TSB ä¸€çº§ç½‘å…³é…ç½®ï¼ŒæŒ‡å®šç½‘å…³è´Ÿè½½ã€‚                             |\n| TrafficAccessBindings       | æµé‡è®¿é—®è§’è‰²é…ç½®ã€‚                                           |\n| TrafficGroup                | æµé‡ç®¡ç†ç»„ã€‚                                                 |\n| TenantAccessBindings        | ç§Ÿæˆ·è§’è‰²é…ç½®ã€‚                                               |\n| TenantSetting               | ç§Ÿæˆ·é…ç½®ã€‚                                                   |\n| TrafficSetting              | æµé‡é…ç½®ã€‚                                                   |\n| VirtualService              | Istio åŸç”Ÿ CRDï¼Œé…ç½®æµé‡è·¯ç”±ã€‚                               |\n| WorkspaceAccessBindings     | Workspace è§’è‰²é…ç½®ã€‚                                         |\n| WasmExtension               | é…ç½®ç®¡ç† Wasm æ‰©å±•ã€‚                                         |\n| WasmPlugin                  | Istio åŸç”Ÿ CRDï¼Œé…ç½® Wasm æ’ä»¶ã€‚                             |\n| Workspace                   | åˆ’å®šå·¥ä½œç©ºé—´ã€‚                                               |\n| WorkspaceSetting            | é…ç½®å·¥ä½œç©ºé—´ã€‚                                               |\n\nä½ å¯ä»¥ä½¿ç”¨ tctl å‘½ä»¤è¡Œå·¥å…·æ¥ç®¡ç† TSBï¼Œå®ƒçš„ä½¿ç”¨æ–¹æ³•ä¸ kubectl ç±»ä¼¼ï¼Œä¸Šé¢çš„åˆ—è¡¨æ˜¯ä½¿ç”¨ \u0060tctl get\u0060 å‘½ä»¤å¯ä»¥åˆ—å‡ºçš„èµ„æºå¯¹è±¡ã€‚å®é™…ä¸Š TSB ä¸­çš„èµ„æºå¯¹è±¡ä¸æ­¢è¿™äº›ï¼Œå…³äº TSB ä¸­ API èµ„æºçš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [TSB æ–‡æ¡£](https:\/\/docs.tetrate.io\/service-bridge\/1.6.x\/en-us\/reference)ã€‚\n\n## TSB æ¶æ„ {#tsb-arch}\n\næˆ‘åœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼ŒTSB æ˜¯åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„ç®¡ç†å¹³é¢ï¼Œä¸º Istio å¢åŠ äº†å¤šç§Ÿæˆ·å’Œå¤šé›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼ŒTSB çš„ç»„ä»¶æ¶æ„åŠå…¶åŠŸèƒ½å¦‚å›¾ 2 æ‰€ç¤ºã€‚\n\n![å›¾ 2ï¼šTSB ç»„ä»¶æ¶æ„å›¾](tsb-arch.svg)\n\nTSB çš„å…¨å±€æ§åˆ¶å¹³é¢å¯ä»¥å’Œç®¡ç†å¹³é¢éƒ¨ç½²åœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å•ç‹¬éƒ¨ç½²ã€‚\n\nTSB ç®¡ç†å¹³é¢çš„æ¶æ„å¦‚å›¾ 3 æ‰€ç¤ºã€‚\n\n![å›¾ 3ï¼šTSB ç®¡ç†å¹³é¢æ¶æ„å›¾](tsb-management-plane.svg)\n\nç®¡ç†å¹³é¢ä¸å„ä¸ª Kubernetes é›†ç¾¤ä¸­çš„ Istio è”ç³»ï¼Œç®¡ç†å¤šé›†ç¾¤ç¯å¢ƒä¸‹çš„æœåŠ¡ç½‘æ ¼ã€‚\n\nTSB æ§åˆ¶å¹³é¢çš„æ¶æ„å¦‚å›¾ 4 æ‰€ç¤ºã€‚\n\n![å›¾ 4ï¼šTSB æ§åˆ¶å¹³é¢æ¶æ„](tsb-control-plane.svg)\n\nä¸ºäº†å®ç°è·¨é›†ç¾¤çš„å¤šç§Ÿæˆ·ç®¡ç†ï¼ŒTSB å®šä¹‰äº†ä¸€ç³»åˆ—é€»è¾‘å¯¹è±¡ï¼Œå¦‚å›¾ 5 æ‰€ç¤ºã€‚\n\n![å›¾ 5ï¼šTSB ä¸­çš„å¤šç§Ÿæˆ·ç®¡ç†å±‚çº§](tsb-resource-hierarchy.svg)\n\n## æ›´å¤š {#more}\n\nå¦‚æœæ‚¨ä¸ç†Ÿæ‚‰æœåŠ¡ç½‘æ ¼å’Œ Kubernetes å®‰å…¨æ€§ï¼Œæˆ‘ä»¬åœ¨ [Tetrate Academy](https:\/\/tetr8.io\/academy) æä¾›äº†ä¸€ç³»åˆ—å…è´¹åœ¨çº¿è¯¾ç¨‹ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿäº†è§£ Istio å’Œ Envoyã€‚\n\nå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ç§å¿«é€Ÿå°† Istio æŠ•å…¥ç”Ÿäº§çš„æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹ [Tetrate Istio Distribution (TID)](https:\/\/tetr8.io\/tid)ã€‚TID æ˜¯ Tetrate çš„å¼ºåŒ–ã€å®Œå…¨ä¸Šæ¸¸çš„ Istio å‘è¡Œç‰ˆï¼Œå…·æœ‰ç»è¿‡ FIPS éªŒè¯çš„æ„å»ºå’Œæ”¯æŒã€‚è¿™æ˜¯å¼€å§‹ä½¿ç”¨ Istio çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºæ‚¨çŸ¥é“æ‚¨æœ‰ä¸€ä¸ªå€¼å¾—ä¿¡èµ–çš„å‘è¡Œç‰ˆï¼Œæœ‰ä¸€ä¸ªæ”¯æŒæ‚¨çš„ä¸“å®¶å›¢é˜Ÿï¼Œå¹¶ä¸”å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥é€‰æ‹©å¿«é€Ÿè·å¾— FIPS åˆè§„æ€§ã€‚\n\nä¸€æ—¦å¯åŠ¨å¹¶è¿è¡Œ Istioï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´ç®€å•çš„æ–¹æ³•æ¥ç®¡ç†å’Œä¿æŠ¤æ‚¨çš„æœåŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ Istio ä¸­å¯ç”¨çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯ Tetrate Service Bridge çš„ç”¨æ­¦ä¹‹åœ°ã€‚æ‚¨å¯ä»¥[åœ¨è¿™é‡Œ](https:\/\/tetr8.io\/tsb)è¯¦ç»†äº†è§£ Tetrate Service Bridge å¦‚ä½•ä½¿æœåŠ¡ç½‘æ ¼æ›´å®‰å…¨ã€æ›´æ˜“äºç®¡ç†å’Œå¼¹æ€§ï¼Œæˆ–[è”ç³»æˆ‘ä»¬è¿›è¡Œå¿«é€Ÿæ¼”ç¤º](https:\/\/tetr8.io\/contact)ã€‚ \n\n## å‚è€ƒ {#refrence}\n\n- [TSB ç®€ä»‹ - tetrate.io](https:\/\/tetrate.io\/tetrate-service-bridge\/)\n- [TSB æ–‡æ¡£ - docs.tetrate.io](https:\/\/docs.tetrate.io\/service-bridge\/)\n- [TSB API å‚è€ƒ - docs.tetrate.io](https:\/\/docs.tetrate.io\/service-bridge\/1.6.x\/en-us\/reference)\n', '\/blog\/tsb-tips\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">å¦‚æœä½ å¯¹æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰å’Œ Tetrate Service Bridge æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å¯ä»¥è§£ç­”ä½ å¿ƒä¸­å¾ˆå¤šç–‘æƒ‘ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/blog/ocsp-stapling-for-istio-gateways/">Istio Gateway ä¸­å¯¹è¯ä¹¦æ’¤é”€çš„æ”¯æŒ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/02/06</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('Istio Gateway ä¸­å¯¹è¯ä¹¦æ’¤é”€çš„æ”¯æŒ', 'è¿™ç¯‡åšå®¢å°†å‘ä½ ä»‹ç»è¯ä¹¦æ’¤é”€çš„æ–¹å¼å’Œ Istio çš„è§£å†³æ–¹æ¡ˆã€‚', '\næœ€è¿‘ Istio ç¤¾åŒºæ­£åœ¨å¤„ç† [Issue 17763](https:\/\/github.com\/istio\/istio\/issues\/17763)ï¼Œä»¥å¢åŠ  Istio å¯¹è¯ä¹¦æ’¤é”€çš„æ”¯æŒï¼Œç›®å‰è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘å·¥ç¨‹ä¸­ï¼Œè§ [PR #42859 - OSCP Stapling](https:\/\/github.com\/istio\/istio\/pull\/42859) å’Œ [OCSP Stapling for Istio Gateways](https:\/\/docs.google.com\/document\/d\/15wwYyVyOluubL2KIM89b2X8NFwyhMVxq2_I1MESrZdI\/edit#)ã€‚è¿™ç¯‡åšå®¢å°†å‘ä½ ä»‹ç»è¯ä¹¦æ’¤é”€çš„æ–¹å¼å’Œ Istio çš„è§£å†³æ–¹æ¡ˆè¿›å±•ã€‚\n\nIstio ä½¿ç”¨ Envoy SDS åˆ†å‘è¯ä¹¦ï¼Œä¸€å…±æœ‰ä¸¤ç§æƒ…å½¢ï¼š\n\n- åˆ†å‘å†…éƒ¨è¯ä¹¦ï¼Œç”¨äº mTLSï¼Œè¿™ç§æƒ…å†µéœ€è¦åˆ†åˆ«éªŒè¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯å¦è¢«æ’¤é”€\n- åˆ†å‘å¤–éƒ¨æœåŠ¡çš„è¯ä¹¦ç»™é›†ç¾¤å†…çš„æœåŠ¡ï¼Œç”¨äºå‘é›†ç¾¤å¤–çš„é€šä¿¡åŠ å¯†ï¼Œæ­¤æ—¶é›†ç¾¤å†…çš„æœåŠ¡ç›¸å½“äºå®¢æˆ·ç«¯ï¼Œä»…éœ€éªŒè¯æœåŠ¡ç«¯è¯ä¹¦æ˜¯å¦è¢«æ’¤é”€\n\næœ¬æ–‡æ¢è®¨çš„æ˜¯ç¬¬äºŒç§æƒ…å½¢ï¼Œå³ Istio Gateway çš„è¯ä¹¦æ’¤é”€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![Istio Gateway çš„è¯ä¹¦æ’¤é”€ç¤ºæ„å›¾](cert-revoke.svg)\n\nCA é€šè¿‡è®¾ç½® TTL æ§åˆ¶è¯ä¹¦çš„å¯¿å‘½ï¼Œå¦‚æœè¦æå‰ç»“æŸè¯ä¹¦å¯ä»¥å°†è¯ä¹¦æ’¤é”€ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ’¤é”€è¯ä¹¦ï¼š\n\n1. é…ç½®è¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼ˆCRLï¼‰\n2. åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰\n\n## CRLï¼ˆè¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼‰\n\nCRLï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰æ˜¯ä¸€ç§ç”¨äºç®¡ç†å’ŒéªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§çš„æœºåˆ¶ã€‚å®ƒåŒ…å«ä¸€ä¸ªå·²è¢«æ’¤é”€çš„è¯ä¹¦åˆ—è¡¨ï¼Œé¢å‘æœºæ„ï¼ˆCAï¼‰å®šæœŸæ›´æ–°è¯¥åˆ—è¡¨ã€‚å½“éªŒè¯è¯ä¹¦çš„å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰æ”¶åˆ°è¯ä¹¦æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è¯¥è¯ä¹¦æ˜¯å¦åœ¨ CRL ä¸­è¢«åˆ—ä¸ºå·²æ’¤é”€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¯¥è¯ä¹¦è¢«è§†ä¸ºæ— æ•ˆã€‚\n\nCRL é€šå¸¸å­˜å‚¨åœ¨é¢å‘æœºæ„ï¼ˆCAï¼‰çš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶å¯ä»¥é€šè¿‡äº’è”ç½‘å…¬å¼€è®¿é—®ã€‚éªŒè¯è¯ä¹¦çš„å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼Œæµè§ˆå™¨ï¼‰å¯ä»¥ä¸‹è½½å¹¶æ£€æŸ¥ CRL ä»¥ç¡®å®šè¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€‚CRL å¯ä»¥ä»¥å¤šç§æ ¼å¼ï¼ˆå¦‚ DER æˆ– PEMï¼‰å­˜å‚¨ï¼Œå¹¶é€šè¿‡ HTTPï¼ŒLDAP æˆ–å…¶ä»–åè®®å‘å¸ƒï¼Œä»¥ä¾¿è¿›è¡ŒéªŒè¯ã€‚\n\nCRL æ–‡ä»¶é€šå¸¸æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨çš„ï¼Œä¸æ˜¯ç›´æ¥å¯è¯»çš„æ–‡æœ¬æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·ï¼ˆä¾‹å¦‚ OpenSSLï¼‰è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼ï¼Œä¾‹å¦‚ PEMï¼Œä»¥æ–¹ä¾¿é˜…è¯»ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåä¸º \u0060crl.pem\u0060 çš„ CRL ç¤ºä¾‹æ–‡ä»¶ï¼Œä»¥ PEM æ ¼å¼è¡¨ç¤ºï¼š\n\n\u0060\u0060\u0060dockerfile\n-----BEGIN X509 CRL-----\nMIIBtjCBqwIBATANBgkqhkiG9w0BAQUFADBBMQswCQYDVQQGEwJVUzERMA8GA1UE\nCBMITmV3IFlvcmsxETAPBgNVBAcTCE5ldyBZb3JrMREwDwYDVQQKEwhNeSBDQTEQ\nMA4GA1UECxMHQ2VydGlmaWNhdGUxGDAWBgNVBAMTD01ZIEJ1c2luZXNzIENBMB4X\nDTA5MDUwMzE1MTQwMFoXDTEwMDUwMjE1MTQwMFqgLzAtMB8GA1UdIwQYMBaAFJ4f\n6Nz7Vuw\/NcZXG0U8O6OZ9XB0MAsGA1UdDwQEAwIFoDAdBgNVHQ4EFgQUU6G9fjRK\nop\u002bJU6vQPnnhxBxHtzUwDQYJKoZIhvcNAQEFBQADgYEAbYoLz7MnJ4ltIS\u002bnCquG\nN\/v\u002b8rE00\/N0pGzN\/dCv\/8t0W0tGTGr2zGRb0mv67MPOmWmHcZZq3sOxgEIp8T\u002bO\nOJxDCD\/xJN6hB0NgN\/Z0\u002bfX9hU6bL\/6zhwUy\/l51xddmSd5KKhJ7FmOh2Py5m9Au\n4fJh7w\u002bOLyjKV7rz55WKjvY=\n-----END X509 CRL-----\n\u0060\u0060\u0060\n\nä½¿ç”¨ OpenSSL å°†å…¶è½¬æ¢ä¸ºå¯è¯»æ ¼å¼ï¼š\n\n\u0060\u0060\u0060bash\nopenssl crl -inform PEM -in crl.pem -noout -text\n\u0060\u0060\u0060\n\nè¾“å‡ºç»“æœä¸ºï¼š\n\n\u0060\u0060\u0060\nCertificate Revocation List (CRL):\n        Version 2 (0x1)\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: \/C=US\/ST=New York\/L=New York\/O=My CA\/OU=Certificate\/CN=My Business CA\n        Last Update: May 3 11:40:00 2009 GMT\n        Next Update: May 2 11:40:00 2010 GMT\n    Revoked Certificates:\n        Serial Number: 1 (0x1)\n            Revocation Date: May 3 11:40:00 2009 GMT\n\u0060\u0060\u0060\n\n**æ³¨æ„**ï¼šè¯¥ CRL æ–‡ä»¶çš„åˆ—è¡¨ä¸­åªä¿å­˜äº†ä¸€ä¸ªæ’¤é”€è¯ä¹¦ã€‚\n\nCRL è™½è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†ä½¿ç”¨ CRL æ–‡ä»¶æ¥æ’¤é”€è¯ä¹¦å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š\n\n1. **æ—¶æ•ˆæ€§**ï¼šCRL æ–‡ä»¶å¿…é¡»å®šæœŸæ›´æ–°ï¼Œå¦åˆ™å°†æ— æ³•è¯†åˆ«è¿‘æœŸæ’¤é”€çš„è¯ä¹¦ï¼›\n2. **å¯ç”¨æ€§**ï¼šå¦‚æœæ— æ³•è®¿é—® CRL æœåŠ¡å™¨ï¼Œåˆ™æ— æ³•éªŒè¯è¯ä¹¦æ˜¯å¦å·²è¢«æ’¤é”€ï¼›\n3. **æ•ˆç‡**ï¼šCRL æ–‡ä»¶éšç€è¯ä¹¦æ•°é‡çš„å¢åŠ è€Œå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤éªŒè¯è¯ä¹¦çš„è¿‡ç¨‹å¯èƒ½ä¼šå˜æ…¢ï¼›\n4. **å®‰å…¨æ€§**ï¼šCRL æ–‡ä»¶æœ¬èº«ä¹Ÿéœ€è¦å®‰å…¨ä¿æŠ¤ï¼Œå¦åˆ™æ”»å‡»è€…å¯èƒ½ä¼šç¯¡æ”¹ CRL ä»¥é€ƒé¿æ’¤é”€è¯ä¹¦çš„é™åˆ¶ï¼›\n\nå› æ­¤ï¼Œç°åœ¨æœ‰æ›´é«˜æ•ˆå’Œå®‰å…¨çš„è¯ä¹¦æ’¤é”€æœºåˆ¶ï¼Œä¾‹å¦‚ OCSPï¼ˆOnline Certificate Status Protocolï¼‰ï¼Œå®ƒå¯ä»¥å®æ—¶éªŒè¯è¯ä¹¦çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¸éœ€è¦å­˜å‚¨æ‰€æœ‰å·²æ’¤é”€è¯ä¹¦çš„åˆ—è¡¨ã€‚\n\n## OCSP Stapling\n\nOCSP Staplingï¼ˆæ­£å¼åç§°ä¸º TLS è¯ä¹¦çŠ¶æ€æŸ¥è¯¢æ‰©å±•ï¼‰æ˜¯ä¸€ç§ TLSï¼ˆTransport Layer Securityï¼‰æ‰©å±•ï¼Œç”¨äºè¯æ˜è¯ä¹¦çš„çŠ¶æ€æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒå…è®¸æœåŠ¡å™¨é¢„å…ˆæ£€ç´¢è¯ä¹¦çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†è¯¥ä¿¡æ¯â€œé’‰â€åˆ° TLS è¯ä¹¦ä¸­ï¼Œä»¥å‡å°‘å¯¹è¯ä¹¦é¢å‘æœºæ„çš„ä¾èµ–ï¼Œå¹¶æé«˜è¯ä¹¦çŠ¶æ€éªŒè¯çš„æ•ˆç‡ã€‚å¯ä»£æ›¿ OCSP æ¥æŸ¥è¯¢ X.509 è¯ä¹¦çš„çŠ¶æ€ã€‚æœåŠ¡å™¨åœ¨ TLS æ¡æ‰‹æ—¶å‘é€äº‹å…ˆç¼“å­˜çš„ OCSP å“åº”ï¼Œç”¨æˆ·åªéœ€éªŒè¯è¯¥å“åº”çš„æœ‰æ•ˆæ€§è€Œä¸ç”¨å†å‘æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼‰å‘é€è¯·æ±‚ã€‚è¯¦è§[ç»´åŸºç™¾ç§‘](https:\/\/en.wikipedia.org\/wiki\/OCSP_stapling)ã€‚\n\nOCSP åªé€‚ç”¨äºå•ä¸ªè¯ä¹¦ï¼Œè€Œä¸æ˜¯åˆ—è¡¨ã€‚å®¢æˆ·ç«¯åœ¨æ”¶åˆ°è¯ä¹¦åï¼Œä¸ CA é€šä¿¡ä»¥æ£€æŸ¥æ’¤é”€çŠ¶æ€ã€‚å“åº”å¯ä»¥æ˜¯ \u0022good\u0022ã€\u0022revoked\u0022 æˆ– \u0022unknown\u0022 ä¹‹ä¸€ã€‚\n\nä½¿ç”¨ OSCP Stapling è™½ç„¶çœå»äº†ç»´æŠ¤ CRL çš„è´Ÿæ‹…ï¼Œä½†æ˜¯å®ƒä¾ç„¶æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š\n\n1. **é¢å¤–çš„èµ„æºå¼€é”€**ï¼šCA æœåŠ¡å™¨éœ€è¦ä¸æ–­åœ°å“åº” OCSP è´¨è¯¢ä»¥ç¡®ä¿è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œè¿™å°†å¯¹æœåŠ¡å™¨çš„ CPU å’Œç½‘ç»œå¸¦å®½é€ æˆé¢å¤–çš„å¼€é”€ï¼›\n2. **å¯ç”¨æ€§é—®é¢˜**ï¼šå¦‚æœ OCSP æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å®¢æˆ·ç«¯å°†æ— æ³•è·å¾—è¯ä¹¦çš„æœ‰æ•ˆæ€§ä¿¡æ¯ï¼›\n3. **å®‰å…¨é—®é¢˜**ï¼šå¦‚æœ OCSP å“åº”è¢«ç¯¡æ”¹æˆ–æœåŠ¡å™¨ä¸å®‰å…¨ï¼Œåˆ™è¯ä¹¦çš„æœ‰æ•ˆæ€§ä¿¡æ¯å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä»è€Œå½±å“å®‰å…¨ï¼›\n4. **å…¼å®¹æ€§é—®é¢˜**ï¼šOCSP Stapling ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒçš„åŠŸèƒ½ï¼Œå› æ­¤å¯èƒ½éœ€è¦åœ¨æ—§æµè§ˆå™¨ä¸Šå®ç°é¢å¤–çš„å…¼å®¹æ€§ã€‚\n\nOCSP çš„æŒ‘æˆ˜æ˜¯ï¼Œå®ƒç»™ CA å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ï¼Œå› ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦ç‹¬ç«‹åœ°è·å¾—è¯ä¹¦çš„éªŒè¯ã€‚æ€»ä½“è€Œè¨€ï¼ŒOCSP Stapling å¯ä»¥æé«˜è¯ä¹¦éªŒè¯çš„æ•ˆç‡å’Œå®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨é‡‡ç”¨è¯¥æŠ€æœ¯æ—¶éœ€è¦ç»¼åˆè€ƒè™‘å¤šæ–¹é¢çš„å› ç´ ã€‚\n\n## Istio å¯¹ OSCP Stapling æ”¯æŒ\n\nå¾ˆå¤š Web æœåŠ¡å™¨éƒ½æ”¯æŒ OSCP Staplingï¼Œäº‘åŸç”Ÿè¾¹ç¼˜ä»£ç† Envoy ä¹Ÿæ”¯æŒè¯¥åŠŸèƒ½ï¼Œéœ€è¦å¯¹ Envoy è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š\n\n- é…ç½® [\u0060DownstreamTlsContext\u0060](https:\/\/www.envoyproxy.io\/docs\/envoy\/latest\/api-v3\/extensions\/transport_sockets\/tls\/v3\/tls.proto#envoy-v3-api-msg-extensions-transport-sockets-tls-v3-downstreamtlscontext) ä¸­çš„ \u0060oscp_staple_policy\u0060ï¼š\n  - \u0060LENIENT_STAPLING\u0060ï¼šOCSP å“åº”æ˜¯å¯é€‰çš„ï¼Œæ­¤ä¸ºé»˜è®¤å€¼\n  - \u0060STRICT_STAPLING\u0060ï¼šOCSP å“åº”æ˜¯å¯é€‰çš„ï¼Œä½†å¦‚æœå­˜åœ¨å¹¶ä¸”æœ‰æ•ˆï¼Œå°±ä¼šä½¿ç”¨ã€‚\n  - \u0060MUST_STAPLE\u0060: OCSP å“åº”æ˜¯å¿…éœ€çš„\n- é…ç½® [\u0060TlsCertificate\u0060](https:\/\/www.envoyproxy.io\/docs\/envoy\/latest\/api-v3\/extensions\/transport_sockets\/tls\/v3\/common.proto#envoy-v3-api-msg-extensions-transport-sockets-tls-v3-tlscertificate) ä¸­çš„ \u0060oscp_staple\u0060ï¼Œå“åº”å¿…é¡»æ˜¯ DER ç¼–ç çš„ï¼Œåªèƒ½é€šè¿‡æ–‡ä»¶åæˆ– \u0060inline_bytes\u0060 æä¾›ã€‚å“åº”å¯èƒ½åªä¸ä¸€ä¸ªè¯ä¹¦æœ‰å…³ã€‚\n\nç›®å‰ Envoy å·²æ”¯æŒ OSCP Staplingï¼Œå…¶ä½œä¸º Istio çš„æ•°æ®å¹³é¢å’Œ Istio Gateway ä¸­çš„ä»£ç†ï¼Œç†è®ºä¸Š Istio ä¹Ÿå¯ä»¥æ”¯æŒè¯¥åŠŸèƒ½ã€‚ä¸è¿‡ Istio çš„ OSCP Stapling è¯ä¹¦æ’¤é”€åŠŸèƒ½æ”¯æŒä»åœ¨è¿›è¡Œä¸­ï¼Œè¯¦è§ [PR #42859 - OSCP Stapling](https:\/\/github.com\/istio\/istio\/pull\/42859)ã€‚è¯¥åŠŸèƒ½çš„æ–°è¿›å±•å°†åœ¨æœ¬æ–‡ä¸­æ›´æ–°ï¼Œè¯·ä¿æŒå…³æ³¨ã€‚\n', '\/blog\/ocsp-stapling-for-istio-gateways\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">è¿™ç¯‡åšå®¢å°†å‘ä½ ä»‹ç»è¯ä¹¦æ’¤é”€çš„æ–¹å¼å’Œ Istio çš„è§£å†³æ–¹æ¡ˆã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/optimize-traffic-management-and-security-with-these-service-mesh-best-practices/">[è¯‘] æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§ä¼˜åŒ–æœ€ä½³å®è·µ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/02/01</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://tetrate.io/blog/optimize-traffic-management-and-security-with-these-service-mesh-best-practices/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§ä¼˜åŒ–æœ€ä½³å®è·µ', 'æœ¬æ–‡æ¨èäº†æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§ä¼˜åŒ–çš„ä¸€äº›æœ€ä½³å®è·µã€‚', '\nè¿™æ˜¯ [æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—æ–‡ç« ](https:\/\/tetrate.io\/blog\/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely\/) ä¸­çš„ç¬¬ä¸‰ç¯‡ï¼Œæ‘˜è‡ª Tetrate åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcher å³å°†å‡ºç‰ˆçš„æ–°ä¹¦ Istio in Productionã€‚\n\nIstio å°±åƒä¸€ç»„ä¹é«˜ç§¯æœ¨ï¼šå®ƒå…·æœ‰è®¸å¤šåŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§ä½ æƒ³è¦çš„ä»»ä½•æ–¹å¼è¿›è¡Œç»„è£…ã€‚å‡ºç°çš„ç»“æ„å–å†³äºä½ å¦‚ä½•ç»„è£…é›¶ä»¶ã€‚åœ¨ [ä¸Šä¸€ç¯‡ä¸­](..\/service-mesh-deployment-best-practices-for-security-and-high-availability\/)ï¼Œæˆ‘ä»¬æè¿°äº†ä¸€ç§è¿è¡Œæ—¶æ‹“æ‰‘ç»“æ„ï¼Œç”¨äºæ„å»ºå¥å£®ã€æœ‰å¼¹æ€§ä¸”å¯é çš„åŸºç¡€æ¶æ„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°ä¸€ç»„ç½‘æ ¼é…ç½®ï¼Œä»¥å¸®åŠ©åœ¨è¿è¡Œæ—¶å®ç°ç¨³å¥æ€§ã€å¼¹æ€§ã€å¯é æ€§å’Œå®‰å…¨æ€§ã€‚\n\nIstio åœ¨å…¶æ‰€è°“çš„ [æ ¹å‘½åç©ºé—´](https:\/\/istio.io\/latest\/docs\/reference\/config\/istio.mesh.v1alpha1\/#MeshConfig-root_namespace) ä¸­æ”¯æŒå…¨å±€é»˜è®¤é…ç½® â€”â€” é»˜è®¤åœ¨ \u0060istio-system\u0060ã€‚åœ¨æ ¹å‘½åç©ºé—´ä¸­å‘å¸ƒçš„é…ç½®é»˜è®¤é€‚ç”¨äºæ‰€æœ‰æœåŠ¡ï¼Œä½†åœ¨æœ¬åœ°å‘½åç©ºé—´ä¸­å‘å¸ƒçš„ä»»ä½•é…ç½®éƒ½ä¼šè¦†ç›–å®ƒã€‚å› æ­¤ï¼Œä¸€äº›é…ç½®åº”è¯¥åœ¨æ ¹å‘½åç©ºé—´ä¸­å‘å¸ƒï¼Œå¹¶ä¸”ä¸å…è®¸åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹å‘å¸ƒï¼ˆä¾‹å¦‚ç”¨äºåœ¨ä¼ è¾“ä¸­å¼ºåˆ¶åŠ å¯†çš„ PeerAuthentication ç­–ç•¥ï¼‰ã€‚å…¶ä»–é…ç½®åº”è¯¥åœ¨æ¯ä¸ªæœåŠ¡è‡ªå·±çš„å‘½åç©ºé—´ä¸­ç¼–å†™ï¼ˆä¾‹å¦‚ VirtualService æ§åˆ¶å®ƒçš„å¼¹æ€§è®¾ç½®ï¼‰ã€‚\n\næˆ‘ä»¬çœ‹åˆ°çš„æœ€æˆåŠŸçš„ç½‘æ ¼é‡‡ç”¨å°†ç½‘æ ¼æœ¬èº«éšè—åœ¨å¦ä¸€ä¸ªç•Œé¢åé¢ï¼šä¾‹å¦‚ Helm æ¨¡æ¿ã€Terraform æˆ–æ›´é«˜çº§çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ [Tetrate Service Bridge (TSB)](https:\/\/tetrate.io\/tetrate-service-bridge\/)ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯åªå…¬å¼€åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜åº”è¯¥é…ç½®çš„ä¸€å°éƒ¨åˆ†ç½‘æ ¼åŠŸèƒ½ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨ä»–ä»¬ç†è§£çš„è¯­è¨€ï¼ˆä¾‹å¦‚ï¼ŒTSB å¯ä»¥ä½¿ç”¨ [å¸¦æ³¨é‡Šçš„ OpenAPI è§„èŒƒ](https:\/\/docs.tetrate.io\/service-bridge\/1.6.x\/en-us\/quickstart\/apps) è¿›è¡Œé…ç½®ï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šå¸¸åªå‘åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å…¬å¼€æµé‡è®¾ç½®å’Œæˆæƒã€‚èº«ä»½éªŒè¯å’Œé¥æµ‹ç”±å„è‡ªçš„å›¢é˜Ÿæˆ–ä»£è¡¨ä»–ä»¬çš„å¹³å°å›¢é˜Ÿé›†ä¸­æ§åˆ¶ã€‚[NIST SP800-204 ç³»åˆ—](https:\/\/tetrate.io\/blog\/nist-standards-for-zero-trust-the-sp-800-204-series\/)ï¼Œå°¤å…¶æ˜¯ [SP 800-204A](https:\/\/csrc.nist.gov\/publications\/detail\/sp\/800-204a\/final) å’Œ [SP 800-204B](https:\/\/csrc.nist.gov\/publications\/detail\/sp\/800-204b\/final)ã€‚Istio é¡¹ç›®ç«™ç‚¹ä¹Ÿæœ‰ä¸€ç»„ [æœ€ä½³å®è·µ](https:\/\/istio.io\/latest\/docs\/ops\/best-practices\/)ï¼Œä¹Ÿå€¼å¾—æ”¶è—ã€‚\n\n## æœåŠ¡ç½‘æ ¼å‘½åçº¦å®š\n\n**å»ºè®®**ï¼šä¸º Istio èµ„æºå¼€å‘å’Œç»´æŠ¤ä¸€è‡´çš„å‘½åæ–¹æ¡ˆï¼Œæœ€å¥½åŸºäºå®ƒä»¬é…ç½®çš„æœåŠ¡æˆ–ä¸»æœºã€‚\n\n**å»ºè®®**ï¼šä¸ºè·¨é›†ç¾¤çš„å›¢é˜Ÿä¿æŒä¸€è‡´çš„åç§°ã€‚å‘½åç©ºé—´åº”è¯¥ç”±ä¸€ä¸ªå›¢é˜Ÿæ‹¥æœ‰ã€‚\n\nIstio èµ„æºåº”è¯¥æ ¹æ®å®ƒä»¬é…ç½®çš„æœåŠ¡æˆ–ä¸»æœºæ¥å‘½åï¼š\u0060ServiceEntry\u0060 æ·»åŠ  \u0060api.example.com\u0060 åˆ°ç½‘æ ¼çš„åº”è¯¥å‘½åä¸º \u0060external-api-example-com\u0060ï¼›æœåŠ¡çš„ \u0060DestinationRule\u0060ã€\u0060VirtualService\u0060ã€\u0060PeerAuthentication\u0060 å’Œ \u0060Authorization\u0060 ç­–ç•¥ä¹Ÿéƒ½åº”è¯¥æœ‰ç›¸åŒçš„åç§°ã€‚PCI å‘½åç©ºé—´ä¸­çš„å†…éƒ¨æœåŠ¡ Paymentsï¼ˆåº”ç”¨ç¨‹åºä»£ç ä¸­çš„ hostname \u0060payments.pci\u0060ï¼‰åº”è¯¥è¢«å‘½åä¸º \u0060payment-pci\u0060ï¼Œå…¶æ‰€æœ‰çš„ç½‘æ ¼é…ç½®åç§°ä¹Ÿåº”è¯¥åŒ¹é…ã€‚è¿™äº›å‘½åæ–¹æ¡ˆå¹¶ä¸æ˜¯ç¡¬æ€§è§„å®šï¼Œä½†ä½ åº”è¯¥åœ¨ä½ çš„ç»„ç»‡å†…å»ºç«‹å¹¶åšæŒä¸€ä¸ªä¸€è‡´çš„æƒ¯ä¾‹ã€‚\n\nè¿™äº›èµ„æºåº”è¯¥å…¨éƒ¨å‘å¸ƒåœ¨å®ƒä»¬é…ç½®çš„æœåŠ¡çš„å‘½åç©ºé—´ä¸­ï¼Œæˆ–è€…å‘å¸ƒåœ¨ \u0060istio-system\u0060 å‘½åç©ºé—´ä¸­ä»¥è¿›è¡Œç½‘æ ¼èŒƒå›´çš„é…ç½®ã€‚å¤–éƒ¨æœåŠ¡é€šå¸¸å‘å¸ƒåˆ° \u0060istio-system\u0060 ä¸­å¹¶ç”±ä¸­å¿ƒå›¢é˜Ÿï¼ˆå¹³å°æˆ–å®‰å…¨å›¢é˜Ÿï¼‰ç®¡ç†ã€‚\n\næˆ‘ä»¬å»ºè®®è·¨é›†ç¾¤çš„å›¢é˜Ÿä½¿ç”¨ä¸€è‡´çš„åç§°ï¼šæ— è®ºé›†ç¾¤ç§Ÿæˆ·æ¨¡å‹å¦‚ä½•ï¼Œå‘½åç©ºé—´éƒ½åº”ç”±å•ä¸ªå›¢é˜Ÿæ‹¥æœ‰ï¼ˆè¯·å‚é˜…ä¸‹ä¸€èŠ‚ï¼‰ã€‚\n\n## æœåŠ¡ç½‘æ ¼å…¨å±€è®¾ç½®\n\n**é…ç½®å¯è§æ€§**ã€‚Istio æœ‰ä¸€ä¸ªé…ç½®å¯è§æ€§çš„æƒ³æ³•ï¼šé…ç½®å¯ä»¥é»˜è®¤åº”ç”¨äºæ•´ä¸ªé›†ç¾¤ï¼Œæˆ–è€…å®ƒå¯ä»¥åªåº”ç”¨äºæœ¬åœ°å‘½åç©ºé—´ï¼Œç”šè‡³å¯ä»¥åªåº”ç”¨äºå•ä¸ªæœåŠ¡ï¼ˆé€‰æ‹©å¯¹æ•´ä¸ªé›†ç¾¤å¯è§ï¼Œæˆ–è€…åªæ˜¯ç‰¹å®šçš„å‘½åç©ºé—´ï¼‰ã€‚ä¸ºäº†æ€§èƒ½å’Œå®‰å…¨ï¼Œä½ åº”è¯¥å°†è¯¥å­—æ®µé»˜è®¤ä¸º \u0060exportTo\u0060 æœ¬åœ°åç§°ç©ºé—´ï¼ˆâ€œ.â€ï¼‰ã€‚ä½ åº”è¯¥åœ¨å®‰è£…æ—¶ä¸º [*Services*](https:\/\/istio.io\/latest\/docs\/reference\/config\/istio.mesh.v1alpha1\/#MeshConfig-default_service_export_to)ã€[*VirtualServices*](https:\/\/istio.io\/latest\/docs\/reference\/config\/istio.mesh.v1alpha1\/#MeshConfig-default_virtual_service_export_to) å’Œ [*DestinationRules*](https:\/\/istio.io\/latest\/docs\/reference\/config\/istio.mesh.v1alpha1\/#MeshConfig-default_destination_rule_export_to) è®¾ç½®è¿™ä¸ªé»˜è®¤å€¼ã€‚æŸ¥çœ‹ Istio çš„ [å…¨å±€é…ç½®](https:\/\/istio.io\/latest\/docs\/reference\/config\/istio.mesh.v1alpha1\/#MeshConfig-default_service_export_to) æ¥é…ç½®è¿™äº›é»˜è®¤å€¼ï¼š\n\n\u0060\u0060\u0060yaml\napiVersion: install.istio.io\/v1alpha1\nkind: IstioOperator\nmetadata:\n name: controlplane\n namespace: istio-system\nspec:\n # profile: default\n # ...\n meshConfig:\n   defaultServiceExportTo:\n   - \u0022.\u0022# only the namespace the resource is published in\n   defaultVirtualServiceExportTo:\n   - \u0022.\u0022\n   # equivalent, just different YAML syntax\n   defaultDestinationRuleExportTo: [\u0022.\u0022]\n\u0060\u0060\u0060\n\nç¤ºä¾‹ 1ï¼šé»˜è®¤å…¨å±€è®¾ç½®\n\n**æ¯ä¸ªå‘½åç©ºé—´çš„ Sidecar èµ„æºé…ç½®**ã€‚Istio çš„ \u0060Sidecar\u0060 ï¼ˆAPIï¼‰èµ„æºæ§åˆ¶ Istio å°†å“ªäº›é…ç½®å‘é€åˆ°æ¯ä¸ªå‘½åç©ºé—´ä¸­çš„ Sidecarã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œæœ€ä½å¼€é”€ï¼Œä½ åº”è¯¥ä¸ºæ¯ä¸ªå‘½åç©ºé—´ç®¡ç†ä¸€ä¸ªé…ç½®ï¼Œå¹¶ç®¡ç† egress éƒ¨åˆ†ä»¥ä»…åŒ…æ‹¬æœåŠ¡å¿…é¡»ä¸ä¹‹é€šä¿¡çš„ä¸»æœºã€‚è¿™å°†å¯¼è‡´ Istio å‘è¯¥å‘½åç©ºé—´ä¸­çš„ Envoy å®ä¾‹å‘é€æ›´å°‘çš„é…ç½®ï¼Œä»è€Œå‡å°‘å®ƒä»¬çš„å†…å­˜å’Œ CPU æ¶ˆè€—ã€‚ç»“åˆä»…æ³¨å†Œè¡¨å‡ºç«™æµé‡ç­–ç•¥ï¼ˆè§ä¸‹ä¸€æ¡ï¼‰ï¼ŒSidecar èµ„æºè¿˜å¯ä»¥å¸®åŠ©é™åˆ¶æ”»å‡»è€…é€šè¿‡ Envoy çš„è¡¨é¢åŒºåŸŸï¼Œå› ä¸ºä¸åœ¨ Sidecar çš„ egress éƒ¨åˆ†çš„ä¸»æœºå°†æ˜¯è¯¥ Envoy å®ä¾‹çš„ \u0022å‡ºç«™æµé‡\u0022ã€‚è¿™æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªè¶³å¤Ÿçš„å®‰å…¨ç­–ç•¥ï¼ˆè§ä¸‹é¢çš„å®‰å…¨éƒ¨åˆ†ï¼‰ï¼Œè€Œæ˜¯å¢åŠ äº†ä¸€ä¸ªæ”»å‡»è€…å¿…é¡»ç©¿è¶Šçš„é¢å¤–é˜²å¾¡å±‚ã€‚\n\n**ç¼–å†™æ˜ç¡®çš„å‡ºç«™ï¼ˆegressï¼‰æµé‡ç­–ç•¥**ã€‚Istio æä¾›äº†ä¸€äº›é€‰é¡¹æ¥é…ç½®å®ƒå¦‚ä½•å¤„ç†ç½‘æ ¼ä¸­çš„æœåŠ¡ï¼Œè¯¥æœåŠ¡è¯•å›¾ä¸ Istio æœªçŸ¥çš„ç«¯ç‚¹è¿›è¡Œé€šä¿¡ï¼š[Outbound Traffic Policy](https:\/\/istio.io\/latest\/docs\/reference\/config\/istio.mesh.v1alpha1\/#MeshConfig-OutboundTrafficPolicy-Mode)ã€‚Istio å¯ä»¥å…è®¸æ‰€æœ‰æµé‡ï¼Œä¹Ÿå¯ä»¥å°†æµé‡é™åˆ¶åœ¨ç½‘æ ¼å·²çŸ¥çš„æœåŠ¡ä¸Šã€‚ä½ åº”è¯¥åœ¨å®‰è£…æ—¶é…ç½® Istioï¼Œåªå…è®¸è¿æ¥åˆ°æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡ã€‚æ­¤å¤–ï¼Œä½ åº”è¯¥å°†æ‰€æœ‰éœ€è¦ä¸ä¹‹é€šä¿¡çš„å¤–éƒ¨æœåŠ¡å»ºæ¨¡ä¸º Mesh ä¸­çš„ ServiceEntriesï¼ˆä¾‹å¦‚ï¼ŒSaaS æœåŠ¡çš„ DNS è§£æç­‰ï¼‰ï¼Œä½¿ç”¨ DestinationRules æ¥é…ç½®ä¸å®ƒä»¬é€šä¿¡çš„ TLSã€‚è¿™äº›å¤–éƒ¨æœåŠ¡åº”è¯¥ç”±å®‰å…¨å›¢é˜Ÿé›†ä¸­ç®¡ç†ï¼Œæˆ–è€…ç”±å¹³å°å›¢é˜Ÿä»£è¡¨ä»–ä»¬ç®¡ç†ã€‚\n\n## è¿è¡Œæ—¶æµé‡ç®¡ç†é…ç½®\n\n**ä¸ºæœåŠ¡ä½¿ç”¨ä¸€è‡´çš„å…¨å±€åç§°ï¼Œå¹¶ä½¿ç”¨ Istio å°†å®ƒä»¬æ˜ å°„åˆ°æœ¬åœ°å®ä¾‹**ã€‚ä½ åº”è¯¥ä½¿ç”¨ä¸€è‡´çš„å…¨å±€åç§°æ¥è®¿é—®æœåŠ¡ã€‚ä½ å¯ä»¥ä½¿ç”¨ Istio å°†è¿™äº›å…¨å±€åç§°æ˜ å°„åˆ°æœ¬åœ°å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œ\u0060payments.tetrate.internal\u0060 å¯ä»¥è¢«æ‰€æœ‰å†…éƒ¨åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œè€Œ Istio å¯ä»¥ç”¨æ¥å°†è¯¥åç§°æ˜ å°„åˆ°æœåŠ¡å®ä¾‹ï¼Œä¾‹å¦‚â€œåœ¨ \u0060us-east-2\u0060 Kubernetes é›†ç¾¤ä¸­çš„ \u0060payments.default.svc.cluster.local\u0060 æœåŠ¡â€ã€‚è¿™ç§å…¨å±€å‘½åæ–¹æ¡ˆä½¿å¼€å‘äººå‘˜å¯ä»¥åƒ SaaS ä¸€æ ·è€ƒè™‘æ‰€æœ‰æœåŠ¡ï¼Œè€Œæ— éœ€ä»”ç»†è€ƒè™‘è¿è¡Œæ—¶æ‹“æ‰‘çš„ç»†èŠ‚ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°æ‰§è¡Œæ•…éšœè½¬ç§»ã€é‡‘ä¸é›€å’Œè·¨é›†ç¾¤è·¯ç”±ç­‰æ“ä½œï¼Œä½œä¸ºä½ çš„ç½‘æ ¼ä½¿ç”¨æˆç†Ÿæˆ–ç»„ç»‡éœ€æ±‚æ¼”å˜ã€‚\n\n**åœ¨æ ¹é…ç½®ä¸­å®šä¹‰ç²—ç•¥çš„é»˜è®¤å¼¹æ€§è®¾ç½®**ã€‚ä½ åº”è¯¥ä¸ºç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡å®šä¹‰ç²—ç•¥çš„è¶…æ—¶ã€é‡è¯•ã€ç†”æ–­å’Œå¼‚å¸¸å€¼æ£€æµ‹è®¾ç½®ã€‚ä½ å¯ä»¥åœ¨æ ¹é…ç½®å‘½åç©ºé—´ä¸­ä½¿ç”¨ \u0060VirtualService\u0060 æ¥å®ç°æ­¤ç›®çš„ã€‚å„ä¸ªå›¢é˜Ÿåº”åœ¨å…¶æœ¬åœ°å‘½åç©ºé—´ä¸­æŒ‡å®šè‡ªå·±çš„åç§°ä»¥è¦†ç›–é»˜è®¤å€¼ã€‚\n\n**ä¸ºåº”ç”¨ç¨‹åºå›¢é˜Ÿæä¾›ç®€åŒ–çš„â€œä½ \/ ä¸­ \/ é«˜â€å¼¹æ€§è®¾ç½®**ã€‚å°†ç½‘æ ¼çš„åº•å±‚ API éšè—åœ¨æ›´é«˜çº§åˆ«æ¥å£åé¢çš„ç³»ç»Ÿä¸­ï¼Œä¸ºé…ç½®é»˜è®¤æ–­è·¯å’Œå¼‚å¸¸å€¼æ£€æµ‹è®¾ç½®çš„åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ç®€åŒ–çš„â€œä½ \/ ä¸­ \/ é«˜â€æ—‹é’®å¾ˆæœ‰ä»·å€¼ï¼Œå› ä¸ºå¾ˆå¤šé¢†åŸŸå®¹æ˜“é…ç½®é”™è¯¯ï¼Œå¯¼è‡´è¯¥åº”ç”¨ç¨‹åºæ€§èƒ½ä¸ä½³ã€‚\n\n## è¿è¡Œæ—¶å®‰å…¨é…ç½®\n\nä»¥ä¸‹å®‰å…¨å»ºè®®æ¥è‡ªæˆ‘ä»¬ä¸ºå¾®æœåŠ¡åº”ç”¨ç¨‹åºå»ºç«‹ç¾å›½å®‰å…¨æ ‡å‡†çš„å·¥ä½œï¼Œè¯¥æ ‡å‡†ç”±ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰åœ¨ [SP 800-204 ç³»åˆ—](https:\/\/tetrate.io\/blog\/nist-standards-for-zero-trust-the-sp-800-204-series\/) ä¸­å‘å¸ƒã€‚[ä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„ç»¼åˆæŒ‡å—](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/) ä¸­é˜…è¯» NIST é’ˆå¯¹å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å®‰å…¨å»ºè®®ã€‚\n\n**æœ€å°æ§åˆ¶**ã€‚è¿è¡Œæ—¶çš„é›¶ä¿¡ä»»è‡³å°‘éœ€è¦ä»¥ä¸‹äº”ä¸ªæ§åˆ¶ï¼š\n\n1. **åŠ å¯†ä¼ è¾“ä¸­çš„æ‰€æœ‰å†…å®¹**ï¼šæä¾›æ¶ˆæ¯çœŸå®æ€§å’Œçªƒå¬ä¿æŠ¤ï¼ˆ[SP 800-204ï¼ŒÂ§MS-SS-4](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n2. **éªŒè¯æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡**ï¼šæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åº”éªŒè¯ä¸ä¹‹é€šä¿¡çš„åº”ç”¨ç¨‹åºçš„èº«ä»½ï¼ˆ[SP 800-204Aï¼ŒÂ§SM-DR16ï¼›SP 800-204Bï¼ŒÂ§APE-SR-3](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n3. **æˆæƒæœåŠ¡åˆ°æœåŠ¡è®¿é—®**ï¼šæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åº”ä½¿ç”¨å…¶è¿è¡Œæ—¶èº«ä»½æˆæƒä¸ä¹‹é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼ˆ[SP 800-204Bï¼ŒÂ§SAUZ-SR-1](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n4. **éªŒè¯æœ€ç»ˆç”¨æˆ·èº«ä»½**ï¼šæ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åœ¨æœåŠ¡è°ƒç”¨å›¾ä¸­çš„æ¯ä¸ªè·ƒç‚¹è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆ[SP 800-204Bï¼ŒÂ§EAUN-SR-1ï¼ŒÂ§EUAZ-SR-3](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n5. **æˆæƒæœ€ç»ˆç”¨æˆ·è®¿é—®èµ„æº**ï¼šå¯¹æ¯ç§èµ„æºçš„æ¯æ¬¡è®¿é—®éƒ½åº”è·å¾—æˆæƒï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å‰é—¨è®¿é—®ä¸€æ¬¡ï¼ˆ[SP 800-204Bï¼ŒÂ§EAUZ-SR-3](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n\nIstio æä¾›ä¼ è¾“ä¸­çš„åŠ å¯†ï¼ˆæˆ‘ä»¬åœ¨ä¸Šé¢è®¨è®ºäº†å…¨å±€å¯ç”¨ï¼‰ï¼Œä»¥åŠå¯éªŒè¯çš„æœåŠ¡èº«ä»½ ([SPIFFE](https:\/\/tetrate.io\/blog\/why-would-you-need-spire-for-authentication-with-istio\/) ) å’ŒæœåŠ¡åˆ°æœåŠ¡çš„è®¿é—®æ§åˆ¶ (Istio \u0060AuthorizationPolicy\u0060)ã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥é…ç½®ä¸ºä»£è¡¨åº”ç”¨ç¨‹åºï¼ˆJWTã€OIDC ä»¤ç‰Œï¼‰éªŒè¯æŸäº›å½¢å¼çš„æœ€ç»ˆç”¨æˆ·èº«ä»½ï¼Œæœ€å Istio æ”¯æŒå¯æ’æ‹”æˆæƒç³»ç»Ÿï¼ˆEnvoy çš„ \u0060ext_authz\u0060ï¼‰ä»¥å¼ºåˆ¶æœ€ç»ˆç”¨æˆ·è®¿é—®èµ„æºã€‚\n\n**å®‰è£…é™åˆ¶æ€§é»˜è®¤æˆæƒç­–ç•¥**ã€‚æ ¹æ® [Istio æœ€ä½³å®è·µ](https:\/\/istio.io\/latest\/docs\/ops\/best-practices\/security\/#use-default-deny-patterns)ï¼Œä½ åº”è¯¥å®‰è£…ä¸€ä¸ªä¸å…è®¸æµé‡çš„é»˜è®¤æˆæƒç­–ç•¥ï¼Œä¸ºæ¯ä¸ªæœåŠ¡å‘å¸ƒå¯¹è±¡åˆ›å»º \u0060AuthorizationPolicy\u0060 å¯¹è±¡ä»¥ç®¡ç†å…è®¸å®ƒä»¬ä¸ä¹‹é€šä¿¡çš„å¯¹è±¡ï¼ˆ[SP 800-204Bï¼ŒSAUZ-SR-1](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚æœ‰åŠ©äºå®ç°è¿™ä¸€ç›®æ ‡çš„ä¸¤ä¸ªæˆæƒç­–ç•¥ï¼š\n\n\u0060\u0060\u0060yaml\napiVersion: security.istio.io\/v1beta1\nkind: AuthorizationPolicy\nmetadata:\n  name: deny-all-audit\n  namespace: istio-system\nspec:\n  action: AUDIT\n\u0060\u0060\u0060\n\nç¤ºä¾‹ 2ï¼š\u0060IstioAuthorizationPolicy\u0060ä¼šæ‹’ç»æ‰€æœ‰æµé‡ï¼Œå¹¶å®¡è®¡è®°å½•å®ƒã€‚ä½ å¯èƒ½ä¼šè¿è¡Œè¿™æ ·çš„ç­–ç•¥å‡ å‘¨ï¼Œä»¥äº†è§£åœ¨å¯ç”¨å¼ºåˆ¶æ‰§è¡Œä¹‹å‰ä½ éœ€è¦çš„ç­–ç•¥ã€‚\n\n\u0060\u0060\u0060yaml\napiVersion: security.istio.io\/v1beta1\nkind: AuthorizationPolicy\nmetadata:\n  name: deny-all\n  namespace: istio-system\nspec:\n  {} # or action: ALLOW\n\u0060\u0060\u0060\n\nç¤ºä¾‹ 3ï¼šæ‹’ç»æ‰€æœ‰æµé‡çš„ Istio AuthorizationPolicyã€‚æˆ–è€…ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå…è®¸ä½†å…·æœ‰ç©ºè§„åˆ™é›†çš„ç­–ç•¥ï¼Œè¿™ä¸ç©ºä¸»ä½“ç›¸åŒã€‚\n\n**é»˜è®¤æƒ…å†µä¸‹éœ€è¦ mTLS è¿›è¡ŒæœåŠ¡åˆ°æœåŠ¡é€šä¿¡**ã€‚é€šè¿‡åœ¨ç”±å®‰å…¨æˆ–å¹³å°å›¢é˜Ÿç®¡ç†çš„æ ¹å‘½åç©ºé—´ä¸­é…ç½® \u0060PeerAuthentication\u0060 èµ„æºï¼Œåº”å°†ä¼ è¾“ä¸­çš„åŠ å¯†è®¾ç½®ä¸ºä¸¥æ ¼ï¼ˆå³ [éœ€è¦ mTLS æ‰èƒ½ä¸æœåŠ¡é€šä¿¡](https:\/\/tetrate.io\/blog\/how-istios-mtls-traffic-encryption-works-as-part-of-a-zero-trust-security-posture\/)ï¼‰ã€‚ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡è°ƒç”¨ç½‘æ ¼ä¸­çš„åº”ç”¨ç¨‹åºåº”è¯¥é€šè¿‡åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³è¿›è¡Œé€šä¿¡ï¼Œå®ƒå¯ä»¥å‘å¤–éƒ¨æœåŠ¡æä¾›ç®€å•çš„ TLSï¼ˆç”šè‡³æ˜æ–‡ï¼‰ï¼Œå› ä¸ºå®ƒä¸å¤ªå¯èƒ½æœ‰è¯ä¹¦æ¥å¯¹ç½‘æ ¼æ‰§è¡Œ mTLSã€‚ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡å‘¼å‡ºåº”é…ç½®ä¸ºä½¿ç”¨ç®€å•çš„ TLS æˆ–æ˜æ–‡ï¼Œå¹¶å¸¦æœ‰ç”¨äºå¤–éƒ¨æœåŠ¡çš„ DestinationRule çš„æ˜æ–‡ ([NIST SP 800-204A, Â§SM-DR8](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/) )ã€‚\n\n**TLS é…ç½®é»˜è®¤å€¼**ã€‚Istio å¼€ç®±å³ç”¨ï¼Œå…·æœ‰è‰¯å¥½çš„ TLS è®¾ç½®ï¼ˆ[TLS æœ€ä½ç‰ˆæœ¬ 1.2ï¼Œå…·æœ‰ä¸€ç»„æœ‰é™çš„å¯†ç å¥—ä»¶](https:\/\/istio.io\/latest\/docs\/concepts\/security\/#mutual-tls-authentication)ï¼‰ï¼Œä½†ä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ çš„ç¯å¢ƒå¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼ˆä¾‹å¦‚ï¼Œåœ¨ [FedRAMP](https:\/\/www.fedramp.gov\/) ç¯å¢ƒä¸­éµå®ˆ [FIPS 140-3](https:\/\/csrc.nist.gov\/publications\/detail\/fips\/140\/3\/final) ï¼‰ï¼š\n\n- Envoy æ”¯æŒé€šè¿‡é…ç½® [ç½‘å…³](https:\/\/istio.io\/latest\/docs\/reference\/config\/networking\/gateway\/#ServerTLSSettings-cipher_suites) ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®æœ€ä½ TLS ç‰ˆæœ¬å’Œä¸€ç»„å—æ”¯æŒçš„å¯†ç å¥—ä»¶ã€‚\n- å¦‚æœå¯èƒ½ï¼Œæˆ‘ä»¬å»ºè®®å°† **TLS 1.3 ä½œä¸ºæœ€ä½ç‰ˆæœ¬** æ‰§è¡Œï¼ˆå¦‚æœä½ åªæ‰§è¡Œ mTLS Envoy-to-Envoyï¼‰ï¼Œå¹¶ä¸ºéœ€è¦è¾ƒæ—§æˆ–å®‰å…¨æ€§è¾ƒä½çš„ TLS é…ç½®çš„å¤–éƒ¨æµé‡ä½¿ç”¨ç½‘å…³ã€‚\n\n**ä¸ºæ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿è¡Œæ—¶èº«ä»½ï¼Œä»¥ä¿ƒè¿›è¡¨è¾¾æ€§å¼ºã€ç»†ç²’åº¦çš„æˆæƒç­–ç•¥å¹¶é™åˆ¶æš´éœ²äºæ”»å‡»**ã€‚ä¸ºä½ æ­£åœ¨éƒ¨ç½²çš„æ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿è¡Œæ—¶æ ‡è¯†ã€‚åœ¨ Kubernetes ä¸­ï¼Œä¸è¦åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­ä½¿ç”¨é»˜è®¤çš„ Kubernetes æœåŠ¡å¸æˆ·ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å¸æˆ·ã€‚æˆæƒç­–ç•¥åªèƒ½åœ¨èº«ä»½çš„ç²’åº¦ä¸Šè½»æ¾ç®¡ç†ã€‚å½“å¤šä¸ªè¿è¡Œæ—¶ç»„ä»¶å…±äº«ç›¸åŒçš„èº«ä»½æ—¶ï¼Œå¾ˆéš¾ç®¡ç†ä¸€ä¸ªè®¿é—®æ§åˆ¶ç­–ç•¥æ¥è¡¨è¾¾ä½ çš„é¢„æœŸè®¿é—®æƒé™ï¼ŒåŒæ—¶ä¸å…è®¸ä½¿ç”¨å…±äº«èº«ä»½çš„æŸäº›ç»„ä»¶è¿›è¡Œè¿‡äºå¹¿æ³›çš„è®¿é—®ã€‚è¿™å¯¼è‡´æ›´å¤§çš„è¡¨é¢ç§¯æš´éœ²ç»™å¯èƒ½å±åŠç³»ç»Ÿçš„ä¸€ä¸ªç»„ä»¶çš„æ”»å‡»è€…ï¼ˆ[NIST SP 800-204A Â§SM-DR11ï¼ŒÂ§SM-DR18](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n\n**å°†æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡é™åˆ¶åœ¨æœ¬åœ°å‘½åç©ºé—´**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡é—´é€šä¿¡åº”é™åˆ¶åœ¨æœ¬åœ°åç§°ç©ºé—´å†…ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸èƒ½å†™ä¸ºæ ¹é…ç½®å‘½åç©ºé—´ä¸­çš„å•ä¸ª AuthorizationPolicyã€‚ç›¸åï¼Œå¯ä»¥å°†ä»…å…è®¸åœ¨æœ¬åœ°å‘½åç©ºé—´ä¸­è®¿é—®çš„é»˜è®¤ AuthorizationPolicy æ¨¡æ¿åŒ–ä¸ºé»˜è®¤å€¼ï¼Œå¹¶ä¸”åº”å…è®¸åº”ç”¨ç¨‹åºå›¢é˜Ÿç¼–å†™ä»–ä»¬è‡ªå·±çš„æ›´ä¸“ä¸šï¼ˆå—é™ï¼‰çš„ç­–ç•¥ï¼ˆ[NIST SP800-204Bï¼ŒÂ§SAUZ-SR-1](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ï¼‰ã€‚\n\n## ä¸‹ä¸€æ­¥\n\næˆ‘ä»¬å¸Œæœ›ä»æˆ‘ä»¬å¤šå¹´å¸®åŠ©å®¢æˆ·æ„å»ºæˆåŠŸçš„æœåŠ¡ç½‘æ ¼å®è·µçš„ç»éªŒä¸­è·å¾—çš„è¿™äº›æœ€ä½³å®è·µå°†æœ‰åŠ©äºä¿ƒè¿›ä½ çš„éƒ¨ç½²ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œè¯·æŸ¥çœ‹æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—ä¸­çš„å…¶ä»–å¸–å­ï¼š \n\n- [ç¬¬ 1 éƒ¨åˆ†ï¼šå¦‚ä½•å°†æœåŠ¡ç½‘æ ¼ä½œä¸ºå®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åˆ†å±‚å½¢å¼å°†å¾®æœåŠ¡å®‰å…¨ä¸ä¼ ç»Ÿå®‰å…¨ç»“åˆèµ·æ¥](\/trans\/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely\/)\n- [ç¬¬ 2 éƒ¨åˆ†ï¼šæœåŠ¡ç½‘æ ¼å®‰å…¨æ€§å’Œé«˜å¯ç”¨æ€§éƒ¨ç½²æœ€ä½³å®è·µ](\/trans\/service-mesh-deployment-best-practices-for-security-and-high-availability\/)\n\nå¦‚éœ€å…¨é¢äº†è§£ NIST å¾®æœåŠ¡å®‰å…¨æ ‡å‡†ï¼Œè¯· [ä¸‹è½½æˆ‘ä»¬çš„å…è´¹æŒ‡å—](https:\/\/tetrate.io\/tetrates-guide-to-federal-security-requirements-for-microservices\/)ã€‚\n\n### æ¥ä¸‹æ¥ï¼šå¤šç§Ÿæˆ·çš„æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µ\n\nåœ¨æˆ‘ä»¬å…³äºæœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæˆ‘ä»¬çœ‹åˆ°å®¢æˆ·æ­£åœ¨åŠªåŠ›è§£å†³çš„å¸¸è§ç§Ÿèµå†³ç­–ç‚¹ï¼Œå¹¶é‡ç‚¹å…³æ³¨ç½‘æ ¼å¦‚ä½•å¸®åŠ©ä¿ƒè¿›è¿™äº›å†³ç­–ã€‚æˆ‘ä»¬å°†æ¶µç›–çš„ä¸»é¢˜åŒ…æ‹¬ Kubernetes é›†ç¾¤æ‰€æœ‰æƒã€å‘½åç©ºé—´æ‰€æœ‰æƒã€é…ç½®æ‰€æœ‰æƒï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨æœåŠ¡ç½‘æ ¼åº”ç”¨ç¨‹åºç½‘å…³æ¥ç¼“è§£ä¸­æ–­ã€‚\n', '\/trans\/optimize-traffic-management-and-security-with-these-service-mesh-best-practices\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡æ¨èäº†æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§ä¼˜åŒ–çš„ä¸€äº›æœ€ä½³å®è·µã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/trans/service-mesh-deployment-best-practices-for-security-and-high-availability/">[è¯‘] æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§å’Œé«˜å¯ç”¨æ€§éƒ¨ç½²æœ€ä½³å®è·µ</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               2023/01/30</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/categories/istio"> 
             Istio
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fas fa-language"></i>
              <a href="https://tetrate.io/blog/service-mesh-deployment-best-practices-for-security-and-high-availability/" target="_blank" rel="noopener">åŸæ–‡</a>
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§å’Œé«˜å¯ç”¨æ€§éƒ¨ç½²æœ€ä½³å®è·µ', 'æœ¬æ–‡å¼ºè°ƒçš„æ˜¯æ§åˆ¶å¹³é¢åº”è¯¥å¦‚ä½•éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºé™„è¿‘ï¼Œå…¥å£åº”è¯¥å¦‚ä½•éƒ¨ç½²ä»¥ä¿ƒè¿›å®‰å…¨æ€§å’Œæ•æ·æ€§ï¼Œå¦‚ä½•ä½¿ç”¨ Envoy ä¿ƒè¿›è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠç½‘æ ¼å†…éƒ¨å¦‚ä½•ä½¿ç”¨è¯ä¹¦ã€‚', '\nè¿™æ˜¯ [æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—æ–‡ç« ](https:\/\/tetrate.io\/blog\/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely\/) ä¸­çš„ç¬¬äºŒç¯‡ï¼Œæ‘˜è‡ª Tetrate åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcher å³å°†å‡ºç‰ˆçš„ä¹¦ç± Istio in Productionã€‚\n\nå½“æ¶‰åŠåˆ°åœ¨å¤šé›†ç¾¤çš„åŸºç¡€è®¾æ–½ä¸­éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶ï¼Œæœ‰ä¸€äº›å¯ç§»åŠ¨çš„éƒ¨åˆ†ã€‚è¿™é‡Œä¸»è¦æƒ³å¼ºè°ƒçš„æ˜¯æ§åˆ¶å¹³é¢åº”è¯¥å¦‚ä½•éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºé™„è¿‘ï¼Œå…¥å£åº”è¯¥å¦‚ä½•éƒ¨ç½²ä»¥ä¿ƒè¿›å®‰å…¨æ€§å’Œæ•æ·æ€§ï¼Œå¦‚ä½•ä½¿ç”¨ Envoy ä¿ƒè¿›è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠç½‘æ ¼å†…éƒ¨å¦‚ä½•ä½¿ç”¨è¯ä¹¦ã€‚\n\n## ä½¿æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢ä¸æ•…éšœåŸŸä¿æŒä¸€è‡´\n\n**å»ºè®®ï¼šå›´ç»•æ•…éšœåŸŸéƒ¨ç½²æ¾æ•£è€¦åˆçš„æ§åˆ¶å¹³é¢ä»¥å®ç°é«˜å¯ç”¨æ€§ã€‚**\n\næ„å»ºé«˜å¯ç”¨æ€§ç³»ç»Ÿå¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œè€Œä¸”é€šå¸¸æˆæœ¬å¾ˆé«˜ã€‚æˆ‘ä»¬çŸ¥é“çš„ä¸€ç§ç»è¿‡éªŒè¯çš„æŠ€æœ¯æ˜¯å›´ç»•æ•…éšœåŸŸæ„å»ºã€‚æ•…éšœåŸŸæ˜¯å½“å…³é”®ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶å—å½±å“çš„åŸºç¡€æ¶æ„éƒ¨åˆ†ã€‚æˆ‘ä»¬æ„å»ºå¯é ç³»ç»Ÿçš„åŸºæœ¬æ–¹æ³•æ˜¯å°†ç³»ç»Ÿè·¨è¶Šçš„æ•…éšœåŸŸåˆ†ç»„ä¸ºå¤šä¸ªç‹¬ç«‹çš„å­¤å²›ã€‚æœ€ç»ˆç³»ç»Ÿçš„æ•´ä½“å¯é æ€§å–å†³äºæˆ‘ä»¬å¯ä»¥ä½¿å­¤å²›çš„ç‹¬ç«‹ç¨‹åº¦ã€‚å®é™…ä¸Šï¼Œæ€»æ˜¯å­˜åœ¨ä¸€äº›ç›¸äº’ä¾èµ–æ€§ï¼Œå°†å…¶æœ€å°åŒ–æ€»æ˜¯æˆæœ¬ä¸å¯ç”¨æ€§çš„æƒè¡¡ã€‚\n\nåœ¨æ²¡æœ‰è€¦åˆæ•…éšœåŸŸçš„æƒ…å†µä¸‹åˆ›å»ºéš”ç¦»å­¤å²›çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªå­¤å²›ä¸­è¿è¡Œå…³é”®æœåŠ¡çš„ç‹¬ç«‹å‰¯æœ¬ã€‚æˆ‘ä»¬å¯ä»¥è¯´è¿™äº›å‰¯æœ¬æ˜¯ç­’ä»“çš„æœ¬åœ°å‰¯æœ¬ â€”â€” å®ƒä»¬å…±äº«ç›¸åŒçš„æ•…éšœåŸŸã€‚åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­ï¼ŒKubernetes é›†ç¾¤å½¢æˆäº†æœ€è‡ªç„¶çš„ç­’ä»“è¾¹ç•Œã€‚Istio æ˜¯ä¸€é¡¹å…³é”®æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ª Istio æ§åˆ¶å¹³é¢å®ä¾‹ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éƒ¨ç½² Istio ä½¿å…¶æ•…éšœåŸŸä¸ä½ çš„åº”ç”¨ç¨‹åºçš„æ•…éšœåŸŸä¿æŒä¸€è‡´ã€‚\n\næ­¤å¤–ï¼Œæˆ‘ä»¬ç¡®ä¿ Istio æ§åˆ¶å¹³é¢å®ä¾‹æ˜¯æ¾æ•£è€¦åˆçš„ï¼Œä¸éœ€è¦ç›´æ¥ä¸å…¶ä»–é›†ç¾¤é€šä¿¡ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘å…¶ä¸å­¤å²›å¤–éƒ¨çš„é€šä¿¡ã€‚æœ‰å…³å¦‚ä½•å®ç°æ­¤ç›®çš„çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸‹é¢çš„å¤šé›†ç¾¤éƒ¨åˆ†ã€‚\n\n## ä½¿ç”¨åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³éš”ç¦»æ¯ä¸ªåº”ç”¨ç¨‹åºçš„æµé‡\n\n**å»ºè®®ï¼šä»æ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–åº”ç”¨ç¨‹åºå›¢é˜Ÿçš„ç½‘å…³ï¼ˆåº”ç”¨ç¨‹åºå…¥å£ç½‘å…³ï¼‰å¼€å§‹ï¼Œä»¥å¸®åŠ©ç¼“è§£å…±äº«ä¸­æ–­ã€‚éšç€æ—¶é—´çš„æ¨ç§»ä½ æ“ä½œç»éªŒçš„å¢åŠ ï¼Œå°†åº”ç”¨ç¨‹åºå…¥å£åˆå¹¶åˆ°å…±äº«ç½‘å…³ä»¥ä¼˜åŒ–æˆæœ¬ã€‚**\n\nè™½ç„¶ Istio é»˜è®¤é™„å¸¦å…±äº« \u0060istio-ingressgateway\u0060ï¼Œä½†æˆ‘ä»¬ä¸å»ºè®®ä½¿ç”¨å…±äº«ç½‘å…³ã€‚å¤§å¤šæ•°é‡‡ç”¨ç½‘æ ¼çš„å›¢é˜Ÿéƒ½éœ€è¦æ—¶é—´æ¥æ„å»ºå®æ–½å…±äº«ç½‘å…³æ¨¡å‹æ‰€éœ€çš„å®¡æŸ¥å®è·µå’Œæ“ä½œï¼Œè€Œæ²¡æœ‰å…±äº«ä¸­æ–­çš„é£é™©ã€‚ç‰¹åˆ«æ˜¯åœ¨ Istio å®æ–½çš„æ—©æœŸï¼Œæˆ‘ä»¬å»ºè®®æ¯ä¸ªå›¢é˜Ÿéƒ¨ç½²ä¸€ä¸ª Envoy ç½‘å…³ã€‚æˆ‘ä»¬ç§°è¿™äº›ä¸ºåº”ç”¨ç¨‹åºå…¥å£ç½‘å…³ã€‚éšç€ä½ è·å¾—æ“ä½œç»éªŒï¼Œä½ å¯ä»¥å¼€å§‹å°†åº”ç”¨ç¨‹åºåˆå¹¶åˆ°å…±äº«ç½‘å…³ä¸Šä»¥ä¼˜åŒ–æˆæœ¬ã€‚\n\nä½¿ç”¨å…±äº«ç½‘å…³æ¨¡å‹å®ç°æ¯ä¸ªå›¢é˜Ÿéš”ç¦»çš„æ·å¾„æ˜¯ä¸ºæ¯ä¸ªå›¢é˜Ÿåˆ†é…ä¸€ä¸ªå•ç‹¬çš„ä¸»æœºåã€‚æŒ‰ä¸»æœºåéš”ç¦»çš„å›¢é˜Ÿå¯ä»¥æ›´å®‰å…¨åœ°é…ç½®å…±äº«ç½‘å…³å®ä¾‹ã€‚ç„¶è€Œï¼Œå…¶ä»–å…±åŒå‘½è¿çš„ä¸­æ–­é£é™©ä»ç„¶å­˜åœ¨ï¼Œä¾‹å¦‚å…¥å£ä»£ç†éƒ¨ç½²çš„é”™è¯¯é…ç½®ã€å˜ˆæ‚çš„é‚»å±…æ¶ˆè€—èµ„æºå’Œå¢åŠ æ‰€æœ‰åº”ç”¨ç¨‹åºçš„å»¶è¿Ÿç­‰ã€‚æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œæ¯ä¸ªå›¢é˜Ÿä¸€ä¸ªç½‘å…³çš„æ–¹æ³•ä¼šäº§ç”Ÿæœ€å¿«çš„å½±å“ï¼Œå¹¶ä¸”å¤±è´¥çš„æœºä¼šæœ€å°‘ï¼Œå¹¶ä¸”æ€»ä½“æˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚\n\næˆ‘ä»¬æœŸæœ›æˆç†Ÿéƒ¨ç½²çš„æœ€ç»ˆçŠ¶æ€æ˜¯ 80-20 çš„æ¯”ä¾‹ï¼šå¤§å¤šæ•°åº”ç”¨ç¨‹åºå°†é€šè¿‡å…±äº«ç½‘å…³æ¥æ”¶æµé‡ï¼Œè€Œä¸€å°éƒ¨åˆ†é«˜åº¦å…³é”®æˆ–æ•æ„Ÿçš„åº”ç”¨ç¨‹åºå°†ä¿ç•™ä¸“ç”¨ç½‘å…³ã€‚\n\n## ä½¿ç”¨åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´åˆ†é…å…¥å£æµé‡\n\n**å»ºè®®ï¼šä½¿ç”¨åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ä¸ºå®¢æˆ·ç«¯æä¾›å•ä¸€åœ°å€ï¼Œä»¥ä¾›å®¢æˆ·ç«¯ä½¿ç”¨å¹¶å°†æµé‡åˆ†é…åˆ°è·¨å¤šä¸ªé›†ç¾¤çš„åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³ã€‚**\n\n![å›¾ 1ï¼šåŸºäº Envoy çš„åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ã€‚](f1.png)\n\næˆ‘ä»¬ç»å¸¸çœ‹åˆ°å®¢æˆ·éœ€è¦è·¨å¤šä¸ªé›†ç¾¤åˆ†é…å…¥å£æµé‡ã€‚ä¾‹å¦‚ï¼Œä»–ä»¬å¯èƒ½å¸Œæœ›å¯ç”¨è“ \/ ç»¿åŸºç¡€è®¾æ–½å‡çº§ï¼Œä»¥ä¿ƒè¿›è·¨åŒºåŸŸæ•…éšœè½¬ç§»ï¼Œæˆ–è€…é€šè¿‡ä½¿ç”¨ Envoy çš„ L7 åŠŸèƒ½å°†æµé‡ä»å•ä½“è¿ç§»åˆ°å¾®æœåŠ¡æ¥å®ç°æ‰¼æ€æ¨¡å¼ã€‚æˆ‘ä»¬ç§°è¿™äº›ä¸ºåº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ã€‚\n\nä¸ºäº†å®ç°è¿™ä¸ªç”¨ä¾‹ï¼Œæˆ‘ä»¬å°†éƒ¨ç½² Envoyâ€”â€” åœ¨ä¸“ç”¨çš„ Kubernetes é›†ç¾¤ä¸­æˆ–ä½œä¸ºä¸€ç»„è™šæ‹Ÿæœº â€”â€” æ¥æ¥æ”¶å¤–éƒ¨æµé‡ã€‚è¿™äº› Envoy å®ä¾‹å°†é€šè¿‡å…¶ Kubernetes å…¥å£æˆ– VM VIP å°†æµé‡è½¬å‘åˆ°ä½ çš„åº”ç”¨ç¨‹åºã€‚è¿™ä¸ ingress-per-team æ–¹æ³•ååŒå·¥ä½œï¼šå¤šé›†ç¾¤ç½‘å…³ä¸ºå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå•ä¸€åœ°å€ä»¥ä¾›ä½¿ç”¨ï¼Œæ ¹æ®ä½ çš„åŸºç¡€è®¾æ–½éœ€è¦æä¾›å°½å¯èƒ½å¤šçš„åº”ç”¨ç¨‹åºç½‘å…³å’Œé›†ç¾¤ã€‚\n\nè™½ç„¶æ­¤ç½‘å…³ç¡®å®å­˜åœ¨å…±äº«æ•…éšœåŸŸï¼Œä½†å…¶é…ç½®è¿œæ¯”æ¯ä¸ªåº”ç”¨ç¨‹åºä¸€ä¸ªå…¥å£ç½‘å…³çš„é…ç½®ç®€å•ã€‚å› æ­¤ï¼Œä½œä¸ºå…±äº«åŸºç¡€æ¶æ„è¿è¡Œèµ·æ¥æ›´å®¹æ˜“ï¼Œä¹Ÿæ›´å®‰å…¨ã€‚æ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå…¥å£ç½‘å…³çš„å…±äº«åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³æ˜¯ä¸€ç§å¼ºå¤§è€Œçµæ´»çš„æ¨¡å‹ï¼Œç”¨äºåœ¨ç½‘æ ¼ä¸Šéƒ¨ç½²å’Œæ“ä½œåº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥æ›´è½»æ¾åœ°æ“ä½œåº•å±‚åŸºç¡€è®¾æ–½ã€‚\n\n## è¯ä¹¦å’Œå…¬é’¥åŸºç¡€è®¾æ–½ (PKI) çš„å»ºè®®\n\n**å»ºè®®ï¼šä»ä½ ç°æœ‰çš„ä¼ä¸šæ ¹ç›®å½•ä¸ºç½‘æ ¼ mTLS åˆ›å»ºä¸€ä¸ªä¸­é—´ç­¾åè¯ä¹¦ã€‚**\n\nIstio ä½¿ç”¨å¸¸è§„ X.509 è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯å¹¶åœ¨ç½‘æ ¼ä¸­å¯ç”¨ä¼ è¾“åŠ å¯†ã€‚æˆ‘ä»¬å»ºè®®ä¸ºç°æœ‰ä¼ä¸šæ ¹ç›®å½•ä¸­çš„æ‰€æœ‰ç½‘æ ¼ mTLS åˆ›å»ºä¸€ä¸ªç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ã€‚å¦‚æœæ¯ä¸ªç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªæ ¹ï¼Œè¯·ä¸ºæ¯ä¸ªç¯å¢ƒåˆ›å»ºä¸€ä¸ªç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ã€‚ä½¿ç”¨è¯¥ç½‘æ ¼ä¸­é—´é¢å‘è¯ä¹¦ä¸ºæ¯ä¸ª Istio å®‰è£…åˆ›å»ºä¸€ä¸ªç­¾åè¯ä¹¦ã€‚æˆ‘ä»¬å»ºè®®åˆ›å»ºä¸€ä¸ªç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ï¼Œä»¥ä¾¿åœ¨ä»»ä½•ç‰¹å®šç¯å¢ƒä¸­ç½‘æ ¼çš„æ•´ä¸ª PKI æ˜¯ä¸€æ£µæ ‘ï¼Œå¦‚æœéœ€è¦å¯ä»¥ä¸€èµ·å¤±æ•ˆã€‚æˆæœ¬æ˜¯ä¸€äº›é¢å¤–çš„è¯ä¹¦ç®¡ç†ï¼Œä¸æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ç›¸æ¯”ï¼Œåœ¨ç®¡ç†ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦çš„ç”Ÿå‘½å‘¨æœŸæ—¶éœ€è¦æ›´åŠ å°å¿ƒã€‚\n\n![å›¾ 2. Tetrate æ¨èçš„å°†ç½‘æ ¼ä¸ç°æœ‰ PKI é›†æˆçš„æ–¹æ³•ï¼šåœ¨ç¯å¢ƒï¼ˆå¦‚ prodï¼‰ä¸­ä¸º Istio ç”Ÿæˆä¸­é—´ç­¾åè¯ä¹¦ï¼Œä½¿ç”¨å®ƒå‘è¯¥ç¯å¢ƒä¸­çš„æ¯ä¸ª Istio æ§åˆ¶å¹³é¢å®ä¾‹é¢å‘ç­¾åè¯ä¹¦ï¼Œå¹¶è®© Istio åƒå¾€å¸¸ä¸€æ ·å‘æ¯ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰ pod é¢å‘å·¥ä½œè´Ÿè½½ï¼ˆå¶ï¼‰è¯ä¹¦ã€‚](f2.png)\n\nIstio ç›‘è§†æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ”¹æ—¶é‡æ–°åŠ è½½å…¶ç­¾åè¯ä¹¦ã€‚å› æ­¤ï¼Œåªè¦ä½ æœ‰ä¸€ä¸ªæ‰¹å‡†çš„æœºåˆ¶æ¥å°†ç§˜å¯†åŠ è½½åˆ° *istiod* pod çš„æ–‡ä»¶ç³»ç»Ÿä¸­ â€”â€” æ¯”å¦‚ *cert-manager*ã€Vault çš„ *init-agent* æˆ– sidecarï¼Œæˆ–è€…åªæ˜¯å­˜å‚¨åœ¨åŠ å¯† *etcd* ä¸­çš„æ™®é€šæ—§ Kubernetes Secretâ€”â€” é›†æˆ Istio è¿›å…¥ä½ çš„ PKI åº”è¯¥å¾ˆå®¹æ˜“ã€‚æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦çš„è½®æ¢åº”ç”±ä½ çš„ PKI è‡ªåŠ¨æ‰§è¡Œã€‚\n\nIstio ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„å¯†ç å­¦åº“ï¼šIstio çš„å†…éƒ¨ CA ä½¿ç”¨ Golang çš„å¯†ç å­¦å¥—ä»¶ï¼ŒEnvoyï¼ˆsidecar å’Œ ingressï¼‰ä½¿ç”¨ BoringSSL è¿›è¡Œè¯ä¹¦éªŒè¯å’Œä¼ è¾“ä¸­çš„åŠ å¯†ã€‚é€šè¿‡ Tetrate çš„å¼€æº Istio å‘è¡Œç‰ˆ [Tetrate Istio Distro](https:\/\/tetr8.io\/tid) ï¼Œç»è¿‡ FIPS éªŒè¯çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢æ„å»ºä¹Ÿä½œä¸º [Tetrate Istio è®¢é˜…](https:\/\/tetr8.io\/tis) çš„ä¸€éƒ¨åˆ†æä¾›ï¼Œå› æ­¤ä½ å¯èƒ½æœŸæœ›çš„æ‰€æœ‰ X.509 çº¦æŸï¼ˆåŸºæœ¬çº¦æŸï¼Œå¦‚ CA å’Œæ·±åº¦ï¼Œå¼€ç®±å³ç”¨åœ°æ”¯æŒå’Œå¼ºåˆ¶æ‰§è¡Œå‘½åçº¦æŸã€ç­–ç•¥çº¦æŸç­‰ï¼‰ã€‚\n\n### ä½¿ç”¨æçŸ­å¯¿å‘½çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ä»¥è½»æ¾åŠé”€\n\n**å»ºè®®ï¼šä½¿ç”¨ Istio æ¥è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ï¼Œä»¥ä¾¿è®¾ç½®æçŸ­çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ TTL å˜å¾—åˆ‡å®å¯è¡Œï¼Œä»è€Œä½¿ [è¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼ˆCRLï¼‰](https:\/\/csrc.nist.gov\/glossary\/term\/certificate_revocation_list) ä¿æŒç®€çŸ­ä¸”æ˜“äºç®¡ç†ã€‚**\n\nåœ¨è¯ä¹¦é¢å‘å’Œè½®æ¢ï¼ˆIstio ä¸ºä½ è‡ªåŠ¨æ‰§è¡Œï¼‰ä¹‹åï¼ŒPKI ä¸­æœ€å¤§çš„æŒ‘æˆ˜æ˜¯è¯ä¹¦åŠé”€ã€‚è¯ä¹¦åŠé”€æ˜¯é€šè¿‡è¯ä¹¦åŠé”€åˆ—è¡¨å®ç°çš„ï¼Œé€šå¸¸ CRL å…·æœ‰ 24 å°æ—¶çš„å¼ºåˆ¶æ‰§è¡Œ SLAï¼šæ·»åŠ åˆ°åˆ—è¡¨ä¸­çš„è¯ä¹¦åœ¨åŠé”€åæœ€å¤š 24 å°æ—¶å†…å¯èƒ½ä¼šè¢«åŸºç¡€è®¾æ–½è§†ä¸ºæœ‰æ•ˆã€‚æ­¤å¤–ï¼Œç”±äºåŠé”€çš„è¯ä¹¦å¿…é¡»åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ (TTL) å†…ä¿ç•™åœ¨åˆ—è¡¨ä¸­ï¼Œå› æ­¤åŠé”€åˆ—è¡¨ä¼šå˜å¾—åºå¤§è€Œç¬¨æ‹™ã€‚\n\nIstio æä¾›çš„ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ï¼Œä»¥ä¾¿è®¾ç½®æçŸ­çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ TTL æ˜¯åˆ‡å®å¯è¡Œçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio é™„å¸¦ 24 å°æ—¶çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ TTLã€‚è¿™è¶³å¤ŸçŸ­ï¼Œå¤§å¤šæ•°å®‰å…¨ç»„ç»‡å¯ä»¥é€‰æ‹©è®©å—æŸçš„è¯ä¹¦è¿‡æœŸï¼Œè€Œä¸æ˜¯æ˜ç¡®åœ°æ’¤é”€å®ƒä»¬ã€‚è€Œä¸”ï¼Œå½“ä½ å‘ CRL æ·»åŠ è¯ä¹¦æ—¶ï¼Œå®ƒåªéœ€è¦åœ¨é‚£é‡Œåœç•™å¾ˆçŸ­çš„æ—¶é—´ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦åœ¨ CRL ä¸Šä¿ç•™è¿‡æœŸçš„è¯ä¹¦ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç½‘æ ¼æœ‰åŠ©äºè§£å†³å¤§å¤šæ•°ç»„ç»‡é¢ä¸´çš„æœ€ç—›è‹¦çš„ PKI é—®é¢˜ï¼šå®ƒé¢å‘å’ŒåŠé”€çŸ­æœŸè¯ä¹¦ï¼Œè¿™æ„å‘³ç€åŠé”€åˆ—è¡¨å¯ä»¥åœ¨éœ€è¦æ—¶ä¿æŒç®€çŸ­ä¸”æ˜“äºç®¡ç†ã€‚\n\n**æ³¨æ„**ï¼šç”±äºç½‘æ ¼ä½¿ç”¨ mTLS è¯ä¹¦ä½œä¸ºèº«ä»½ï¼ŒIstio å°† Envoy é…ç½®ä¸ºè‡ªåŠ¨ä¸¢å¼ƒå·²å»ºç«‹çš„è¿æ¥ï¼Œä»¥å¼ºåˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨ä»»ä½•ä¸€æ–¹è½®æ¢è¯ä¹¦æ—¶é‡æ–°éªŒè¯å½¼æ­¤ã€‚è¿™æ˜¯ Istio å®ç°ä¸­çš„è®¾è®¡å†³ç­–ï¼Œé€šå¸¸é€šè¿‡ Istio çš„å¼¹æ€§åŠŸèƒ½å¯¹åº”ç”¨ç¨‹åºéšè—ï¼šå¯¹åº”ç”¨ç¨‹åºé€æ˜çš„è‡ªåŠ¨é‡è¯•é‡æ–°å»ºç«‹è¿æ¥ã€‚åœ¨ç½‘æ ¼ä¸­è®¾ç½®è¾ƒçŸ­çš„è¯ä¹¦ TTL ä¼šå¼ºåˆ¶è¿™äº›é‡æ–°è¿æ¥æ›´é¢‘ç¹åœ°å‘ç”Ÿã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§è¡Œä¸ºå¶å°”ä¼šä¸­æ–­ä¸€äº›æœŸæœ›é•¿æœŸ TCP è¿æ¥çš„åº”ç”¨ç¨‹åºã€‚\n\n### è¿›ä¸€æ­¥çš„è¯ä¹¦æ¨è\n\nä½ åº”è¯¥ä¸ä½ çš„å®‰å…¨å›¢é˜Ÿåè°ƒï¼Œä¸ºä½ çš„ç½‘æ ¼é¢å‘çš„è¯ä¹¦å»ºç«‹é€‚å½“çš„çº¦æŸã€‚æˆ‘ä»¬æ¨èçš„ä¸€äº›å¸¸è§çº¦æŸå¦‚ä¸‹ã€‚\n\n**è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ (TTL)**ã€‚è¯·æ³¨æ„ï¼Œåªè¦è¯ä¹¦æ˜¯ä»åŒä¸€ä¸ªæ ¹é¢å‘çš„ï¼ŒIstio å°±æ”¯æŒæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦å’Œå·¥ä½œè´Ÿè½½è¯ä¹¦çš„é›¶åœæœºè½®æ¢ã€‚æˆ‘ä»¬å»ºè®®æ¯ä¸ªçº§åˆ«çš„è¯ä¹¦ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š\n\n- ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ 1-3 å¹´\n- æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ 3 ä¸ªæœˆ\n- å·¥ä½œè´Ÿè½½è¯ä¹¦éœ€è¦ 12-24 å°æ—¶\n\nIstio è‡ªåŠ¨å¤„ç†å·¥ä½œè´Ÿè½½è¯ä¹¦çš„è½®æ¢ã€‚è¿™äº›è¯ä¹¦ä¸Šçš„çŸ­ TTLï¼ˆå°‘äº 24 å°æ—¶ï¼‰æœ‰åŠ©äºé™åˆ¶å¯èƒ½è¢«ç›—çš„å‡­æ®è¿›è¡Œæ—¶é—´é™åˆ¶æ”»å‡»ï¼Œè¿˜å¯ä»¥å‡å°‘å¯¹ CRL çš„éœ€æ±‚ã€‚æ§åˆ¶å¹³é¢è¯ä¹¦åº”æŒ‰ä¸€ä¸ªæœˆçš„åç§»è½®æ¢ä»¥ç¡®ä¿å¹³ç¨³è¿‡æ¸¡ â€”â€” æ¢å¥è¯è¯´ï¼Œåœ¨ 3 ä¸ªæœˆçš„ TTL åˆ°æœŸå‰ 1 ä¸ªæœˆè½®æ¢æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ã€‚ç±»ä¼¼åœ°ï¼Œå½“ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦è¿˜å‰©ä¸€åŠåˆ°ä¸‰åˆ†ä¹‹ä¸€çš„ç”Ÿå‘½å‘¨æœŸæ—¶è½®æ¢ï¼ˆä¸€å¹´ TTL æå‰ 3-4 ä¸ªæœˆï¼Œä¸‰å¹´ TTL æå‰ 6-8 ä¸ªæœˆï¼‰ã€‚\n\n**åŸºç¡€ï¼ˆCA å’Œæ·±åº¦ï¼‰**ã€‚æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦åº”è¯¥åªèƒ½é¢å‘å¶è¯ä¹¦ï¼šç”¨äºå·¥ä½œè´Ÿè½½è¯†åˆ«çš„éç­¾åè¯ä¹¦ã€‚å› æ­¤ï¼Œåº”é…ç½®æ·±åº¦é™åˆ¶ä»¥é˜²æ­¢æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦é¢å‘ä»»ä½•å…¶ä»–ç­¾åè¯ä¹¦ã€‚\n\nç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦éœ€è¦åˆ›å»ºæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ï¼Œå› æ­¤å®ƒåº”è¯¥é…ç½®ä¸€ä¸ªæ·±åº¦ï¼Œä»¥ä¾¿èƒ½å¤Ÿ**åœ¨å®ƒä¸‹é¢åˆ›å»ºä¸€ä¸ªçº§åˆ«çš„ç­¾åè¯ä¹¦ï¼Œè€Œä¸æ˜¯æ›´å¤š**ã€‚\n\n**åç§°çº¦æŸ**ã€‚Istio é¢å‘çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ä¸ä¼šå¡«å…… X.509 ä¸»ä½“åç§° (SN) å­—æ®µï¼›ç½‘æ ¼èº«ä»½éªŒè¯ä¾èµ–äºä½œä¸ºä¸»ä½“å¤‡ç”¨åç§° (SAN) å­—æ®µæºå¸¦çš„ SPIFFE èº«ä»½ã€‚é˜…è¯» [SPIFFE è§„èŒƒä»¥è·å–æœ‰å…³éªŒè¯å’Œèº«ä»½éªŒè¯å·¥ä½œçš„ä¿¡æ¯](https:\/\/github.com\/spiffe\/spiffe\/blob\/main\/standards\/X509-SVID.md#4-constraints-and-usage)ï¼Œä»¥åŠ Istio çš„ [æ–‡æ¡£](https:\/\/istio.io\/latest\/docs\/concepts\/security\/#istio-identity) ä»¥äº†è§£ Istio å¦‚ä½•æ ¹æ® SPIFFE å¯¹èº«ä»½è¿›è¡Œç¼–ç ã€‚åœ¨ä¸ºç½‘æ ¼ä¸­é—´å’Œæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ç¼–å†™åç§°çº¦æŸæ—¶ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚\n\n**å¯†é’¥ç”¨æ³•**ã€‚ \u0060keyCertSign\u0060 å¿…é¡»ä¸ºç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦å’Œæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦è®¾ç½®ï¼Œä½†åº”ä¸ºå·¥ä½œè´Ÿè½½è¯ä¹¦ç¦ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œç½‘æ ¼ä¸­é—´å’Œæ§åˆ¶å¹³é¢è¯ä¹¦æ˜¯ç­¾åè¯ä¹¦ï¼Œè€Œå·¥ä½œè´Ÿè½½è¯ä¹¦ä¸æ˜¯ã€‚\n\næ ¹æ® SPIFFE çš„å»ºè®®ï¼Œä¸åº”å°†ç­¾åè¯ä¹¦ç”¨äºä¼ è¾“ä¸­çš„åŠ å¯†ï¼Œå¹¶ä¸”åº”é…ç½®å¯†é’¥ä½¿ç”¨ä»¥é˜²æ­¢å®ƒï¼ˆé€šè¿‡åŠ å¯†çº¦æŸï¼‰ã€‚\n\n**æ‰©å±•å¯†é’¥ç”¨æ³•**ã€‚è™½ç„¶æ­¤å¤„æ²¡æœ‰å…·ä½“è¦æ±‚ï¼Œä½† SPIFFE X.509 SVID è§„èŒƒè¯´æ˜ \u0060id-kp-serverAuth\u0060 å’Œ \u0060id-kp-clientAuth\u0060 åº”é’ˆå¯¹å¶ï¼ˆå·¥ä½œè´Ÿè½½ï¼‰è¯ä¹¦è¿›è¡Œé…ç½®ã€‚\n\nSPIFFE è§„èŒƒè¿˜æ¨èäº† [å„ç§è¯ä¹¦çº¦æŸ](https:\/\/github.com\/spiffe\/spiffe\/blob\/main\/standards\/X509-SVID.md#4-constraints-and-usage)ï¼Œå°½ç®¡å…¶ä¸­å¤§éƒ¨åˆ†ä¸Šé¢å·²ç»çº¦æŸäº†ã€‚\n\n## ä¸‹ä¸€æ­¥\n\næˆ‘ä»¬å¸Œæœ›ä»å¤šå¹´å¸®åŠ©æˆ‘ä»¬çš„å®¢æˆ·å……åˆ†åˆ©ç”¨æœåŠ¡ç½‘æ ¼çš„ç»éªŒä¸­æ”¶é›†çš„è¿™äº›æœ€ä½³å®è·µå°†æœ‰åŠ©äºä¿ƒè¿›ä½ çš„éƒ¨ç½²ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œè¯·æŸ¥çœ‹ [å¦‚ä½•å°†æœåŠ¡ç½‘æ ¼ä½œä¸ºå®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åˆ†å±‚å½¢å¼å°†å¾®æœåŠ¡å®‰å…¨ä¸ä¼ ç»Ÿå®‰å…¨ç»“åˆèµ·æ¥](\/trans\/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely\/) è¿™ç¯‡æ–‡ç« ã€‚\n\næ¥ä¸‹æ¥ï¼šæœåŠ¡ç½‘æ ¼è¿è¡Œæ—¶é…ç½®å»ºè®®ã€‚åœ¨æˆ‘ä»¬çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è°ˆè®ºï¼š\n\n- å‘½åçº¦å®š\n- å…¨å±€è®¾ç½®\n- æµé‡ç®¡ç†\n- å®‰å…¨\n- é¥æµ‹\n\næ•¬è¯·å…³æ³¨ã€‚\n', '\/trans\/service-mesh-deployment-best-practices-for-security-and-high-availability\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">æœ¬æ–‡å¼ºè°ƒçš„æ˜¯æ§åˆ¶å¹³é¢åº”è¯¥å¦‚ä½•éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºé™„è¿‘ï¼Œå…¥å£åº”è¯¥å¦‚ä½•éƒ¨ç½²ä»¥ä¿ƒè¿›å®‰å…¨æ€§å’Œæ•æ·æ€§ï¼Œå¦‚ä½•ä½¿ç”¨ Envoy ä¿ƒè¿›è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠç½‘æ ¼å†…éƒ¨å¦‚ä½•ä½¿ç”¨è¯ä¹¦ã€‚</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> é˜…è¯»åŸæ–‡è¯·è½¬åˆ°ï¼šhttps://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
 <nav aria-label="Page navigation">
   <ul class="pagination justify-content-center">
     
     
     <li class="page-item">
       <a class="page-link" href="/tags/istio/">
         Â«Â«
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a href="/tags/istio/page/4/" class="page-link">
         Â«
       </a>
     </li>
     
     
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/tags/istio/page/3/" class="page-link">
             3
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/tags/istio/page/4/" class="page-link">
             4
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item page-item active ">
           <a href="/tags/istio/page/5/" class="page-link">
             5
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/tags/istio/page/6/" class="page-link">
             6
           </a>
         </li>
       
     
       
       
       
         
         
         
           
             
           
         
       
       
       
       
         <li class="page-item">
           <a href="/tags/istio/page/7/" class="page-link">
             7
           </a>
         </li>
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
       
       
       
         
         
         
           
         
       
       
       
       
     
     
     
     <li class="page-item">
       <a href="/tags/istio/page/6/" class="page-link">
         Â»
       </a>
     </li>
     
     
     
     <li class="page-item">
       <a class="page-link" href="/tags/istio/page/11/">
         Â»Â»
       </a>
     </li>
     
   </ul>
 </nav>
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      ä¸“æ 
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(71)</span>
        </a>
      
        <a href="/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(42)</span>
        </a>
      
        <a href="/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(24)</span>
        </a>
      
        <a href="/categories/%e9%9a%8f%e7%ac%94" class="sidebar-item">
            <span>éšç¬”</span>
            <span>(21)</span>
        </a>
      
        <a href="/categories/%e5%85%b6%e4%bb%96" class="sidebar-item">
            <span>å…¶ä»–</span>
            <span>(18)</span>
        </a>
      
        <a href="/categories/%e4%b8%9a%e6%80%81" class="sidebar-item">
            <span>ä¸šæ€</span>
            <span>(17)</span>
        </a>
      
        <a href="/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(16)</span>
        </a>
      
        <a href="/categories/%e4%ba%91%e5%8e%9f%e7%94%9f" class="sidebar-item">
            <span>äº‘åŸç”Ÿ</span>
            <span>(14)</span>
        </a>
      
        <a href="/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%ae%89%e5%85%a8" class="sidebar-item">
            <span>å®‰å…¨</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e5%bc%80%e6%ba%90" class="sidebar-item">
            <span>å¼€æº</span>
            <span>(9)</span>
        </a>
      
        <a href="/categories/%e6%97%85%e8%a1%8c" class="sidebar-item">
            <span>æ—…è¡Œ</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8f%af%e8%a7%82%e6%b5%8b%e6%80%a7" class="sidebar-item">
            <span>å¯è§‚æµ‹æ€§</span>
            <span>(5)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      èµ„æ–™
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/categories/%e5%87%ba%e7%89%88%e7%89%a9" class="sidebar-item">
            <span>å‡ºç‰ˆç‰©</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e7%94%b5%e5%ad%90%e4%b9%a6" class="sidebar-item">
            <span>ç¿»è¯‘ç”µå­ä¹¦</span>
            <span>(8)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" class="sidebar-item">
            <span>ç¿»è¯‘æ–‡æ¡£</span>
            <span>(7)</span>
        </a>
      
        <a href="/categories/%e7%bf%bb%e8%af%91%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>ç¿»è¯‘å›¾ä¹¦</span>
            <span>(6)</span>
        </a>
      
        <a href="/categories/%e5%8e%9f%e5%88%9b%e5%9b%be%e4%b9%a6" class="sidebar-item">
            <span>åŸåˆ›å›¾ä¹¦</span>
            <span>(2)</span>
        </a>
      
        <a href="/categories/%e6%95%99%e7%a8%8b%e6%89%8b%e5%86%8c" class="sidebar-item">
            <span>æ•™ç¨‹æ‰‹å†Œ</span>
            <span>(1)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">è”ç³»</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">å¾®ä¿¡å…¬ä¼—å·</li>
            
            
            <li class="mb-4"><img src="/images/servicemesher-wechat.webp" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">åšå®¢</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/blog/macao-trip/">æ¾³é—¨ City Walkï¼šæ„Ÿå—ç²¾è‡´æ¿ æ±Ÿ</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/introducing-kmesh-kernel-native-service-mesh/">ä»‹ç» Kmeshï¼šç”¨å†…æ ¸åŸç”ŸæŠ€æœ¯é©æ–°æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢</a></li>
            
            <li class="mb-3"><a class="text-color" href="/blog/service-mesh-data-plane-deployment-modes/">æ·±å…¥è§£ææœåŠ¡ç½‘æ ¼çš„å››ç§æ•°æ®å¹³é¢éƒ¨ç½²æ¨¡å¼ï¼šæ€§èƒ½ã€å®‰å…¨æ€§ä¸æˆæœ¬åˆ†æ</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">é“¾æ¥</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io/latest/zh/" target="_blank" rel="noopener noreferrer">
                  Istio æœåŠ¡ç½‘æ ¼
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate å…¬å¸
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://space.bilibili.com/515485124" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿå­¦é™¢|Bilibili
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿå¼€æºé¡¹ç›®å¤§å…¨
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener noreferrer">
                  äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">æ•™ç¨‹</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Envoy åŸºç¡€æ•™ç¨‹
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals-zh" target="_blank" rel="noopener noreferrer">
                  Istio åŸºç¡€æ•™ç¨‹
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="/book/kubernetes-handbook/" >
                  Kubernetes åŸºç¡€æ•™ç¨‹
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">é€šçŸ¥</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/notice/nist-sp-800-233-service-mesh-proxy-models/">èµ„æ–™åˆ†äº«ï¼šäº‘åŸç”Ÿåº”ç”¨æœåŠ¡ç½‘æ ¼ä»£ç†æ¨¡å‹çš„å¨èƒåˆ†ææŒ‡å—</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/kubecon-china-2024-panel/">KubeCon China 2024ï¼ˆé¦™æ¸¯ï¼‰</a></li>
            
            <li class="mb-3"><a class="text-color" href="/notice/website-revamp-notice/">ç½‘ç«™æ”¹ç‰ˆé€šçŸ¥</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">Â© 2017-2024 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>









<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>










<script src="/js/wowchemy-search.min.7a37268e7bbe4a9160c2e4c33b749816.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
