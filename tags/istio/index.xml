<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song - ä¸“æ³¨äºæ¢ç´¢å Kubernetes æ—¶ä»£çš„äº‘åŸç”Ÿæ–°èŒƒå¼ â€“ Istio</title>
    <link>https://jimmysong.io/tags/istio/</link>
    <description>Recent content in Istio on Jimmy Song - ä¸“æ³¨äºæ¢ç´¢å Kubernetes æ—¶ä»£çš„äº‘åŸç”Ÿæ–°èŒƒå¼</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <copyright>&amp;copy; 2017-2023 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©</copyright>
    <lastBuildDate>Wed, 08 Nov 2023 11:27:49 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/tags/istio/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>CNCF ä¸ Tetrate åˆä½œæ¨å‡º Istio Certificated Associateï¼ˆICAï¼‰è®¤è¯</title>
      <link>https://jimmysong.io/blog/ica-review/</link>
      <pubDate>Wed, 08 Nov 2023 11:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/ica-review/</guid>
      <description>
        
        
        &lt;p&gt;äº‘è®¡ç®—ä¸“ä¸šäººå£«ï¼Œè‡ª &lt;strong&gt;Istio Certified Associate (ICA) è®¤è¯&lt;/strong&gt; æ—…ç¨‹å¼€å§‹å·²ç»ä¸€ä¸ªæœˆäº†ã€‚è¿™æ˜¯äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼ˆCNCFï¼‰ã€Linux åŸºé‡‘ä¼šåŸ¹è®­ä¸è®¤è¯ä»¥åŠ Tetrate åˆä½œçš„æˆæœï¼Œä¸ºå¾®æœåŠ¡ç®¡ç†è®¾ç«‹äº†æ–°çš„æ ‡æ†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tetrate.io&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;
 æ˜¯ Istio é¡¹ç›®çš„å…³é”®è´¡çŒ®è€…ï¼Œæœ€åˆåˆ›å»ºäº† Tetrate è®¤è¯çš„ Istio ç®¡ç†å‘˜ï¼ˆCIATï¼‰ï¼Œä¸º ICA è®¤è¯å¥ å®šäº†åŸºç¡€ã€‚è‡ªä»æ¨å‡ºä»¥æ¥ï¼ŒICA å·²æˆä¸º Kubernetes ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¸®åŠ©æ•°åƒäººæŒæ¡æœåŠ¡ç½‘æ ¼æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;è®¤è¯è¯¾ç¨‹æ¶µç›–äº†è¯¸å¦‚&lt;strong&gt;å®‰è£…&lt;/strong&gt;ã€&lt;strong&gt;æµé‡ç®¡ç†&lt;/strong&gt;å’Œ&lt;strong&gt;å®‰å…¨&lt;/strong&gt;ç­‰åŸºæœ¬é¢†åŸŸï¼Œåæ˜ å‡ºè¯¥é¢†åŸŸæ‰€éœ€çš„å…¨é¢ä¸“ä¸šçŸ¥è¯†ã€‚åœ¨çŸ­çŸ­æ—¶é—´å†…ï¼ŒICA è·å¾—äº†æ˜¾è‘—åŠ¨åŠ›ï¼Œå¾—ç›Šäº Tetrate å¯¹äº‘åŸç”Ÿé¢†åŸŸçš„æ„¿æ™¯å’ŒæŠ•å…¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ ICA æˆç«‹ä¸€ä¸ªæœˆä¹‹é™…ï¼ŒTetrate ç»§ç»­é€šè¿‡å…¶ Tetrate Academy æ‰¿è¯ºå¼€æºæ•™è‚²ï¼Œæä¾›æœ‰å…³æœåŠ¡ç½‘æ ¼å’Œ Kubernetes å®‰å…¨çš„å…è´¹ã€é«˜è´¨é‡è¯¾ç¨‹ã€‚å¯¹äºé‚£äº›æ‰“ç®—åœ¨ç”Ÿäº§ä¸­éƒ¨ç½² Istio çš„äººæ¥è¯´ï¼ŒTetrate æä¾›äº†&lt;strong&gt;Tetrate Istio Distribution (TID)&lt;/strong&gt;ï¼Œä¸€ç§å®‰å…¨ä¸”å¾—åˆ°æ”¯æŒçš„ Istio å‘è¡Œç‰ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨è¿˜æ²¡æœ‰åŠ å…¥ï¼Œç°åœ¨æ˜¯æ—¶å€™åŠ å…¥è¿™ä¸ªä¸æ–­å¢é•¿çš„ Istio ä¸“å®¶ç¤¾åŒºäº†ã€‚æå‡æ‚¨çš„èŒä¸šç”Ÿæ¶¯ï¼Œä¸ºäº‘åŸç”ŸæŠ€æœ¯çš„æ¼”è¿›åšå‡ºè´¡çŒ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-ica-è®¤è¯&#34;&gt;ä»€ä¹ˆæ˜¯ ICA è®¤è¯ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ICA æ˜¯ä¸“ä¸ºå·¥ç¨‹å¸ˆï¼ŒCI/CD ä»ä¸šè€…æˆ–ä»»ä½•å¯¹ Istio æœ‰ç‰¹æ®Šå…´è¶£çš„äººè®¾è®¡çš„ä¸“ä¸šå‰è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;è·å¾—è®¤è¯çš„ ICA å­¦å‘˜å¯ç¡®è®¤ä»–ä»¬å¯¹ Istio åŸåˆ™ã€æœ¯è¯­å’Œæœ€ä½³å®è·µçš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶å±•ç¤ºä»–ä»¬å»ºç«‹ Istio çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ICA è®¤è¯è€ƒè¯•å±•ç¤ºäº†è€ƒç”Ÿå¯¹ Istio åŸåˆ™ã€æœ¯è¯­å’Œå»ºç«‹ Istio çš„æœ€ä½³å®è·µçš„æ·±å…¥ç†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ica-è®¤è¯è€ƒè¯•å†…å®¹&#34;&gt;ICA è®¤è¯è€ƒè¯•å†…å®¹&lt;/h2&gt;
&lt;p&gt;ICA è®¤è¯è€ƒè¯•åŒ…æ‹¬è¿™äº›ä¸€èˆ¬é¢†åŸŸåŠå…¶åœ¨è€ƒè¯•ä¸­çš„æƒé‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…ã€å‡çº§å’Œé…ç½®ï¼š7%&lt;/li&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼š40%&lt;/li&gt;
&lt;li&gt;å¼¹æ€§å’Œæ•…éšœæ³¨å…¥ï¼š20%&lt;/li&gt;
&lt;li&gt;ä¿æŠ¤å·¥ä½œè´Ÿè½½ï¼š20%&lt;/li&gt;
&lt;li&gt;é«˜çº§åœºæ™¯ï¼š13%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦ç»†å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£…ã€å‡çº§å’Œé…ç½®ï¼š7%&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ IstioCLI å®‰è£…åŸºæœ¬é›†ç¾¤&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ IstioOperatorAPI å®šåˆ¶ Istio å®‰è£…&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è¦†ç›–æ¥ç®¡ç† Istio ç»„ä»¶è®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æµé‡ç®¡ç†ï¼š40%&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ§åˆ¶æœåŠ¡ç½‘æ ¼å†…çš„ç½‘ç»œæµé‡&lt;/li&gt;
&lt;li&gt;é…ç½® Sidecar æ³¨å…¥&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Gateway èµ„æºé…ç½®å…¥å£å’Œå‡ºå£æµé‡&lt;/li&gt;
&lt;li&gt;äº†è§£å¦‚ä½•ä½¿ç”¨ ServiceEntry èµ„æºå‘å†…éƒ¨æœåŠ¡æ³¨å†Œä¸­å¿ƒæ·»åŠ æ¡ç›®&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ DestinationRule å®šä¹‰æµé‡ç­–ç•¥&lt;/li&gt;
&lt;li&gt;é…ç½®æµé‡é•œåƒåŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å¼¹æ€§å’Œæ•…éšœæ³¨å…¥ï¼š20%&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®æ–­è·¯å™¨ (å¸¦æˆ–ä¸å¸¦ç¦»ç¾¤å€¼æ£€æµ‹)&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¼¹æ€§ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæ•…éšœæ³¨å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å›ºå®šå·¥ä½œè´Ÿè½½ï¼š20%&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£ Istio å®‰å…¨ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;åœ¨meshä¸­ä¸ºHTTP/TCPæµé‡å»ºç«‹Istioæˆæƒ&lt;/li&gt;
&lt;li&gt;åœ¨ç½‘æ ¼ã€å‘½åç©ºé—´å’Œå·¥ä½œè´Ÿè½½çº§åˆ«é…ç½®ç›¸äº’ TLS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é«˜çº§åœºæ™¯ï¼š13%&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£å¦‚ä½•å°†é kubernetes å·¥ä½œè´Ÿè½½è£…è½½åˆ°ç½‘æ ¼&lt;/li&gt;
&lt;li&gt;æ’é™¤é…ç½®é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•è·å¾—-ica-è®¤è¯&#34;&gt;å¦‚ä½•è·å¾— ICA è®¤è¯ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://training.linuxfoundation.cn/certificates/33&#34; title=&#34;ç‚¹å‡»å¼€å§‹æ‚¨çš„ ICA è®¤è¯å§ï¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»å¼€å§‹æ‚¨çš„ ICA è®¤è¯å§ï¼&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;è¿™åªæ˜¯ä¸€ä¸ªå¼€å§‹ã€‚è®©æˆ‘ä»¬æœŸå¾…åœ¨æœåŠ¡ç½‘æ ¼ç†Ÿç»ƒåº¦ä¸Šè¾¾åˆ°æ›´å¤šé‡Œç¨‹ç¢‘ï¼Œç”± Tetrate å’Œ CNCF å¼•é¢†æ½®æµã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šICA è®¤è¯æä¾›ä¸­æ–‡è®¤è¯è€ƒè¯•ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸ 3 å¹´ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Argo é¡¹ç›® Istio åŠ SkyWalking å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²</title>
      <link>https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/</link>
      <pubDate>Sat, 21 Oct 2023 10:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/</guid>
      <description>
        
        
        &lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äºæœ¬æ–‡
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  æœ¬æ–‡æ ¹æ®ç¬”è€…åœ¨ KubeCon&amp;amp;CloudNativeCon China 2023 çš„é€šè¯ä»“æ´»åŠ¨ &lt;a href=&#34;https://istioconchina2023.sched.com/event/1RoVG/nano-argo-istio-re-skywalking-jiong-gitops-reqi-zha-yao-pi-how-to-achieve-the-perfect-union-of-gitops-and-observability-with-argo-istio-and-skywalking-jimmy-song-tetrate&#34; title=&#34;IstioCon China&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon China&lt;/a&gt;
 ä¸Šçš„åˆ†äº«æ•´ç†è€Œæˆï¼ŒåŸæ ‡é¢˜ä¸ºã€Šå¦‚ä½•åœ¨ Argoã€Istio å’Œ SkyWalking ä¸­å®ç° GitOps å’Œå¯è§‚å¯Ÿæ€§çš„å®Œç¾ç»“åˆã€‹ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;äº‘åŸç”Ÿåº”ç”¨çš„å‘å±•å¯¼è‡´å¼€å‘å·¦ç§»ï¼Œåº”ç”¨è¿­ä»£é¢‘ç‡æ›´é«˜ï¼Œè¿™å°±å‚¬ç”Ÿäº† GitOps çš„éœ€æ±‚ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Argo é¡¹ç›®ï¼ŒåŒ…æ‹¬ ArgoCD å’Œ Argo Rolloutsï¼Œé€šè¿‡ Istio å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚æ–‡ä¸­è¿˜æœ‰ä¸€ä¸ªæ¼”ç¤ºï¼Œå±•ç¤ºäº†å¦‚ä½•åŸºäº Tetrate Service Expressï¼ˆä¹Ÿé€‚ç”¨äº Tetrate Service Bridgeï¼‰æä¾›çš„ Istio ç¯å¢ƒå®ç° GitOpsã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ demo çš„éƒ¨ç½²æ¶æ„å›¾å¦‚å›¾ 1 æ‰€ç¤ºã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰æœ¬æ–‡ä»‹ç»çš„éƒ¨ç½²ç­–ç•¥å’Œ Argo é¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥è·³åˆ° &lt;a href=&#34;#demo&#34; title=&#34;demo éƒ¨åˆ†&#34;&gt;demo éƒ¨åˆ†&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f1.svg&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f1.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šåœ¨ TSE/TSB ä¸­ä½¿ç”¨ Istio å’Œ Argo é¡¹ç›®å®ç° GitOps å’Œé‡‘ä¸é›€å‘å¸ƒçš„æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 1ï¼šåœ¨ TSE/TSB ä¸­ä½¿ç”¨ Istio å’Œ Argo é¡¹ç›®å®ç° GitOps å’Œé‡‘ä¸é›€å‘å¸ƒçš„æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;deployment-strategy&#34;&gt;éƒ¨ç½²ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘æƒ³ç®€å•ä»‹ç»ä¸€ä¸‹ Argo Rollouts æ”¯æŒçš„ä¸¤ç§éƒ¨ç½²ç­–ç•¥ï¼Œå¯ä»¥å®ç°é›¶åœæœºéƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;è“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€éƒ¨ç½²çš„æ­¥éª¤å¦‚å›¾ 2 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f2.svg&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f2.svg&#34; alt=&#34;image&#34; data-caption=&#34;Figure 2: Steps of blue-green deployment and canary deployment&#34;&gt;
    
  
  &lt;figcaption&gt;Figure 2: Steps of blue-green deployment and canary deployment&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§åœ¨å•ç‹¬çš„ç¯å¢ƒä¸­å¹¶è¡Œéƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºè€Œä¸å½±å“å½“å‰ç”Ÿäº§ç¯å¢ƒçš„ç­–ç•¥ã€‚åœ¨è“ç»¿éƒ¨ç½²ä¸­ï¼Œå½“å‰çš„ç”Ÿäº§ç¯å¢ƒç§°ä¸ºâ€œè“è‰²ç¯å¢ƒâ€ï¼Œéƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºçš„ç¯å¢ƒç§°ä¸ºâ€œç»¿è‰²ç¯å¢ƒâ€ã€‚ä¸€æ—¦ç»¿è‰²ç¯å¢ƒè¢«è®¤ä¸ºç¨³å®šå¹¶é€šè¿‡æµ‹è¯•ï¼Œæµé‡å°†é€æ¸ä»è“è‰²ç¯å¢ƒåˆ‡æ¢åˆ°ç»¿è‰²ç¯å¢ƒï¼Œè®©ç”¨æˆ·é€æ­¥æ¥å…¥æ–°ç‰ˆæœ¬ã€‚å¦‚æœåˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šåˆ°è“ç¯å¢ƒï¼Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“ã€‚è“ç»¿éƒ¨ç½²çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›é«˜å¯ç”¨æ€§å’Œé›¶åœæœºéƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;é‡‘ä¸é›€éƒ¨ç½²æ˜¯ä¸€ç§é€æ­¥å°†æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½å¼•å…¥ç”Ÿäº§ç¯å¢ƒçš„ç­–ç•¥ã€‚åœ¨é‡‘ä¸é›€éƒ¨ç½²ä¸­ï¼Œæ–°ç‰ˆæœ¬æˆ–æ–°åŠŸèƒ½é¦–å…ˆéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„å°‘æ•°ç”¨æˆ·ï¼Œç§°ä¸ºâ€œé‡‘ä¸é›€ç”¨æˆ·â€ã€‚é€šè¿‡ç›‘æ§é‡‘ä¸é›€ç”¨æˆ·çš„åé¦ˆå’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥è¯„ä¼°æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥é€æ­¥å°†æ›´å¤šç”¨æˆ·çº³å…¥é‡‘ä¸é›€éƒ¨ç½²ä¸­ï¼Œç›´åˆ°æ‰€æœ‰ç”¨æˆ·éƒ½ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚å¦‚æœå‘ç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šæˆ–ä¿®å¤ï¼Œé¿å…å¯¹æ•´ä¸ªç”¨æˆ·ç¾¤é€ æˆè´Ÿé¢å½±å“ã€‚é‡‘ä¸é›€éƒ¨ç½²çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å¿«é€Ÿå‘ç°é—®é¢˜å¹¶åœ¨å½±å“è¾ƒå°çš„èŒƒå›´å†…è¿›è¡Œè°ƒæ•´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€éƒ¨ç½²çš„ä¸»è¦åŒºåˆ«åœ¨äºéƒ¨ç½²æ–¹å¼å’Œå˜æ›´è§„æ¨¡ã€‚è“ç»¿éƒ¨ç½²æ˜¯å°†æ•´ä¸ªåº”ç”¨éƒ¨ç½²åœ¨æ–°çš„ç¯å¢ƒä¸­ï¼Œç„¶åè¿›è¡Œåˆ‡æ¢ï¼Œé€‚åˆå¤§è§„æ¨¡çš„å˜æ›´ï¼Œæ¯”å¦‚æ•´ä¸ªåº”ç”¨çš„é‡å¤§å‡çº§ã€‚é‡‘ä¸é›€éƒ¨ç½²é€æ¸å¼•å…¥æ–°ç‰ˆæœ¬æˆ–åŠŸèƒ½ï¼Œé€‚åˆå°è§„æ¨¡æ›´æ”¹ï¼Œä¾‹å¦‚æ·»åŠ æˆ–ä¿®æ”¹å•ä¸ªåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»åº”ç”¨åœºæ™¯æ¥çœ‹ï¼Œè“ç»¿éƒ¨ç½²é€‚åˆå¯¹é«˜å¯ç”¨ã€é›¶å®•æœºéƒ¨ç½²è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿã€‚åœ¨éƒ¨ç½²å¤§è§„æ¨¡å˜æ›´æ—¶ï¼Œè“ç»¿éƒ¨ç½²å¯ä»¥ä¿è¯ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿå›æ»šä»¥åº”å¯¹çªå‘æƒ…å†µã€‚é‡‘ä¸é›€éƒ¨ç½²é€‚åˆéœ€è¦å¿«é€ŸéªŒè¯æ–°åŠŸèƒ½æˆ–ç‰ˆæœ¬çš„ç³»ç»Ÿã€‚é€šè¿‡é€æ­¥å¼•å…¥å˜æ›´ï¼Œå¯ä»¥åŠæ—©å‘ç°é—®é¢˜å¹¶è¿›è¡Œè°ƒæ•´ï¼Œå°½é‡å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kuberentes-deployment&#34;&gt;Kubernetes Deployment çš„å‘å¸ƒç­–ç•¥&lt;/h2&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼ŒDeployment èµ„æºå¯¹è±¡æ˜¯ç®¡ç†åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œæ›´æ–°çš„ä¸»è¦å·¥å…·ä¹‹ä¸€ã€‚éƒ¨ç½²æä¾›äº†ä¸€ç§å£°æ˜å¼æ–¹å¼æ¥å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸçŠ¶æ€ï¼Œå¹¶é€šè¿‡æ§åˆ¶å™¨çš„åŠŸèƒ½å®ç°å‘å¸ƒç­–ç•¥ã€‚Deployment çš„æ¶æ„å¦‚å›¾ 3 æ‰€ç¤ºï¼Œå…¶ä¸­å½©è‰²æ–¹å—ä»£è¡¨ä¸åŒç‰ˆæœ¬çš„ Podã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f3.svg&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f3.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 3ï¼šKubernetes Deployment æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 3ï¼šKubernetes Deployment æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‘å¸ƒç­–ç•¥å¯ä»¥åœ¨ Deployment çš„ spec å­—æ®µä¸­é…ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å‘å¸ƒç­–ç•¥é€‰é¡¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ReplicaSet çš„ç®¡ç†ï¼šDeployment ä½¿ç”¨ ReplicaSet æ¥åˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å‰¯æœ¬ã€‚å¯ä»¥é€šè¿‡è®¾ç½® &lt;code&gt;spec.replicas&lt;/code&gt; å­—æ®µæ¥æŒ‡å®šæ‰€éœ€çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ï¼ŒKubernetes æ§åˆ¶å™¨ä¿è¯æ–°ç‰ˆæœ¬ ReplicaSet çš„å‰¯æœ¬æ•°é‡åœ¨åˆ›å»ºæ—¶é€æ¸å¢åŠ ï¼Œæ—§ç‰ˆæœ¬ ReplicaSet çš„å‰¯æœ¬æ•°é‡åœ¨åˆ é™¤æ—¶é€æ¸å‡å°‘ï¼Œå®ç°å¹³æ»‘åˆ‡æ¢ã€‚&lt;/li&gt;
&lt;li&gt;æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼šéƒ¨ç½²æ”¯æŒå¤šç§æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® &lt;code&gt;spec.strategy.type&lt;/code&gt; å­—æ®µæ¥é€‰æ‹©ã€‚å¸¸è§æ”¿ç­–åŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;RollingUpdate&lt;/code&gt;ï¼šé»˜è®¤ç­–ç•¥ä»¥ä¸€å®šçš„æ—¶é—´é—´éš”é€æ¸æ›´æ–°å‰¯æœ¬ã€‚ä¸åŒæ—¶å¯ç”¨çš„å‰¯æœ¬æ•°é‡ä»¥åŠé¢å¤–å¯ç”¨çš„å‰¯æœ¬æ•°é‡å¯ä»¥é€šè¿‡è®¾ç½® &lt;code&gt;spec.strategy.rollingUpdate.maxUnavailable&lt;/code&gt; å’Œ &lt;code&gt;spec.strategy.rollingUpdate.maxSurge&lt;/code&gt; å­—æ®µæ¥æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ReCreate&lt;/code&gt;ï¼šè¯¥ç­–ç•¥åœ¨æ›´æ–°è¿‡ç¨‹ä¸­é¦–å…ˆåˆ é™¤æ—§ç‰ˆæœ¬çš„æ‰€æœ‰å‰¯æœ¬ï¼Œç„¶ååˆ›å»ºæ–°ç‰ˆæœ¬çš„å‰¯æœ¬ã€‚æ­¤ç­–ç•¥å°†å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨æ›´æ–°æœŸé—´æš‚æ—¶ä¸å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‰ˆæœ¬æ§åˆ¶ï¼šDeployment é€šè¿‡ &lt;code&gt;spec.template.metadata.labels&lt;/code&gt; å­—æ®µä¸ºæ¯ä¸ªç‰ˆæœ¬çš„ ReplicaSet è®¾ç½®æ ‡ç­¾ï¼Œä»¥ä¾¿æ§åˆ¶å™¨å‡†ç¡®è·Ÿè¸ªå’Œç®¡ç†ã€‚è¿™æ · ReplicaSet çš„å¤šä¸ªç‰ˆæœ¬å¯ä»¥å…±å­˜ï¼Œå¹¶ä¸”å¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªç‰ˆæœ¬çš„å‰¯æœ¬æ•°é‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨è¿™äº›é…ç½®é€‰é¡¹ï¼ŒDeployment å¯ä»¥å®ç°ä¸åŒçš„å‘å¸ƒç­–ç•¥ã€‚æ›´æ–° Deployment å¯¹è±¡çš„ spec å­—æ®µå¯ä»¥è§¦å‘æ–°ç‰ˆæœ¬çš„å‘å¸ƒã€‚Kubernetes æ§åˆ¶å™¨ä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥è‡ªåŠ¨å¤„ç†å‰¯æœ¬çš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ï¼Œä»¥å®ç°å¹³æ»‘çš„åº”ç”¨æ›´æ–°å’Œéƒ¨ç½²ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;argocd-gitops&#34;&gt;ä½¿ç”¨ ArgoCD å®æ–½ GitOps&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ Deployment æ¥æ‰‹åŠ¨ç®¡ç†å‘å¸ƒç­–ç•¥ï¼Œä½†è¦å®ç°è‡ªåŠ¨åŒ–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ ArgoCD ç­‰ GitOps å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ArgoCD æ˜¯ä¸€ä¸ªåŸºäº GitOps çš„æŒç»­äº¤ä»˜å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–å’Œç®¡ç† Kubernetes åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚å®ƒä¸ºæé«˜åº”ç”¨ç¨‹åºéƒ¨ç½²çš„æ•ˆç‡å’Œå¯é æ€§æä¾›äº†ä¸€äº›å…³é”®çš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ ArgoCD ä¸º Kubernetes åº”ç”¨ç¨‹åºéƒ¨ç½²æä¾›çš„ä¸€äº›å¸®åŠ©ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼é…ç½®&lt;/strong&gt;ï¼šArgoCD ä½¿ç”¨å£°æ˜å¼æ–¹å¼å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸçŠ¶æ€ï¼Œå¹¶å°†åº”ç”¨ç¨‹åºé…ç½®å­˜å‚¨åœ¨ Git å­˜å‚¨åº“ä¸­ã€‚é€šè¿‡ç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆ/æŒç»­äº¤ä»˜ (CI/CD) æµç¨‹ï¼Œå¯ä»¥è½»æ¾è·Ÿè¸ªå’Œç®¡ç†åº”ç”¨ç¨‹åºé…ç½®æ›´æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒç»­éƒ¨ç½²&lt;/strong&gt;ï¼šArgoCD å¯ä»¥ç›‘æ§ Git å­˜å‚¨åº“ä¸­çš„é…ç½®å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒã€‚æä¾›å¯å®šåˆ¶çš„åŒæ­¥ç­–ç•¥ï¼Œè‡ªåŠ¨è§¦å‘åº”ç”¨éƒ¨ç½²å’Œæ›´æ–°ï¼Œå®ç°æŒç»­éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€æ¯”è¾ƒå’Œè‡ªåŠ¨ä¿®å¤&lt;/strong&gt;ï¼šArgoCD å®šæœŸæ£€æŸ¥åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€å¹¶å°†å…¶ä¸é¢„æœŸçŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå‘ç°ä¸ä¸€è‡´ï¼Œå®ƒä¼šè‡ªåŠ¨å°è¯•ä¿®å¤å¹¶å°†åº”ç”¨ç¨‹åºæ¢å¤åˆ°æ‰€éœ€çŠ¶æ€ï¼Œä»¥ç¡®ä¿é¢„æœŸçŠ¶æ€ä¸å®é™…çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šç¯å¢ƒç®¡ç†&lt;/strong&gt;ï¼šArgoCD æ”¯æŒç®¡ç†å¤šä¸ª Kubernetes ç¯å¢ƒï¼Œä¾‹å¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒã€‚å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒç¯å¢ƒä¹‹é—´éƒ¨ç½²å’ŒåŒæ­¥åº”ç”¨é…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§å’Œå¯æ§æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ Deployment èµ„æºå¯¹è±¡ç›¸æ¯”ï¼ŒArgoCD æä¾›äº†æ›´é«˜çº§çš„åŠŸèƒ½å’Œå·¥ä½œæµç¨‹ï¼Œè¡¥å……äº†åŸç”Ÿ Kubernetes èµ„æºå¯¹è±¡çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºäº GitOps çš„é…ç½®ç®¡ç†&lt;/strong&gt;ï¼šArgoCD å°†åº”ç”¨ç¨‹åºé…ç½®å­˜å‚¨åœ¨ Git å­˜å‚¨åº“ä¸­ï¼Œä»è€Œå®ç°åŸºäº GitOps çš„é…ç½®ç®¡ç†ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿é…ç½®æ›´æ”¹æ˜¯å¯è·Ÿè¸ªã€å¯å®¡è®¡çš„ï¼Œå¹¶ä¸”å¯ä»¥ä¸ç°æœ‰çš„ CI/CD ç®¡é“é›†æˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜&lt;/strong&gt;ï¼šArgoCD å¯ä»¥è‡ªåŠ¨æ£€æµ‹ Git å­˜å‚¨åº“ä¸­çš„é…ç½®æ›´æ”¹å¹¶å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒï¼Œä»è€Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çŠ¶æ€ç®¡ç†å’Œè‡ªåŠ¨æ¢å¤&lt;/strong&gt;ï¼šArgoCD æŒç»­ç›‘æ§åº”ç”¨ç¨‹åºçš„çŠ¶æ€å¹¶å°†å…¶ä¸é¢„æœŸçŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼Œå®ƒä¼šè‡ªåŠ¨æ¢å¤å¹¶ç¡®ä¿åº”ç”¨ç¨‹åºçŠ¶æ€ä¸é¢„æœŸçŠ¶æ€ä¿æŒä¸€è‡´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;istio-routing-traffic&#34;&gt;ä½¿ç”¨ Istio å®ç°ç»†ç²’åº¦çš„æµé‡è·¯ç”±&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ ArgoCD å¯ä»¥å®ç° GitOpsï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯åœ¨ Kubernetes éƒ¨ç½²ä¸Šè¿è¡Œå¹¶é€šè¿‡å‰¯æœ¬æ•°é‡æ§åˆ¶æµé‡è·¯ç”±ã€‚ä¸ºäº†å®ç°ç»†ç²’åº¦çš„æµé‡è·¯ç”±ï¼Œä½¿ç”¨äº† Istio ç­‰æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;Istio é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°æ›´ç»†ç²’åº¦çš„æµé‡è·¯ç”±å’Œåº”ç”¨å‘å¸ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VirtualService&lt;/strong&gt;ï¼šIstio ä½¿ç”¨ VirtualService æ¥å®šä¹‰æµé‡è·¯ç”±è§„åˆ™ã€‚é€šè¿‡é…ç½® VirtualServiceï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚å¤´ã€è·¯å¾„ã€æƒé‡ç­‰è¯·æ±‚å±æ€§å¯¹æµé‡è¿›è¡Œè·¯ç”±å’Œåˆ†å‘ï¼Œå°†è¯·æ±‚å®šå‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹æˆ–ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DestinationRule&lt;/strong&gt;ï¼šIstio çš„ DestinationRule ç”¨äºå®šä¹‰æœåŠ¡ç‰ˆæœ¬ç­–ç•¥å’Œè´Ÿè½½å‡è¡¡è®¾ç½®ã€‚é€šè¿‡æŒ‡å®šä¸åŒç‰ˆæœ¬æœåŠ¡å®ä¾‹ä¹‹é—´ä¸åŒçš„æµé‡æƒé‡ï¼Œå¯ä»¥å®ç°é‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ç­‰é«˜çº§åº”ç”¨å‘å¸ƒç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æµé‡æ§åˆ¶å’Œç­–ç•¥&lt;/strong&gt;ï¼šIstio æä¾›äº†ä¸°å¯Œçš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›ï¼Œå¦‚æµé‡é™åˆ¶ã€æ•…éšœæ³¨å…¥ã€è¶…æ—¶è®¾ç½®ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°æ›´é«˜çº§åˆ«çš„è´Ÿè½½å‡è¡¡ã€å®¹é”™å’Œå¯é æ€§è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ ArgoCD å’Œ Kubernetes Deployment å¯¹è±¡ç›¸æ¯”ï¼ŒIstio åœ¨åº”ç”¨éƒ¨ç½²æ–¹é¢æä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»†ç²’åº¦çš„æµé‡è·¯ç”±æ§åˆ¶&lt;/strong&gt;ï¼šIstio æä¾›äº†æ›´ä¸°å¯Œçš„æµé‡è·¯ç”±èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®å¤šç§è¯·æ±‚å±æ€§è¿›è¡Œçµæ´»çš„è·¯ç”±å’Œåˆ†å‘ï¼Œä»è€Œå®ç°æ›´ç»†ç²’åº¦çš„æµé‡æ§åˆ¶å’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é«˜çº§å‘å¸ƒç­–ç•¥æ”¯æŒ&lt;/strong&gt;ï¼šIstio çš„ DestinationRule å¯ä»¥æŒ‡å®šä¸åŒç‰ˆæœ¬æœåŠ¡å®ä¾‹ä¹‹é—´çš„æµé‡æƒé‡ï¼Œæ”¯æŒé‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ç­‰é«˜çº§åº”ç”¨å‘å¸ƒç­–ç•¥ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæ›´åŠ çµæ´»å¯æ§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼ºå¤§çš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›&lt;/strong&gt;ï¼šIstio æä¾›äº†ä¸°å¯Œçš„æµé‡æ§åˆ¶å’Œç­–ç•¥èƒ½åŠ›ï¼Œå¦‚æµé‡é™åˆ¶ã€æ•…éšœæ³¨å…¥ã€è¶…æ—¶è®¾ç½®ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°æ›´é«˜çº§åˆ«çš„è´Ÿè½½å‡è¡¡ã€å®¹é”™å’Œå¯é æ€§è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å°† Istio ä¸ Argo Rollouts ç›¸ç»“åˆï¼Œå¯ä»¥å……åˆ†å‘æŒ¥ Istio ç»†ç²’åº¦æµé‡è·¯ç”±çš„ä¼˜åŠ¿ã€‚ç°åœ¨è®©æˆ‘ä»¬ä¸€èµ·è¿›è¡Œæ¼”ç¤ºã€‚åœ¨æˆ‘ä»¬çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ TSE æä¾›çš„ Kubernetes å’Œ Istio ç¯å¢ƒï¼Œä½¿ç”¨ ArgoCD å®ç° GitOpsï¼Œå¹¶ä½¿ç”¨ Argo Rollouts å®ç°é‡‘ä¸é›€å‘å¸ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;demo&#34;&gt;Demo&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„æ¼”ç¤ºä¸­ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes v1.24.14&lt;/li&gt;
&lt;li&gt;Istio v1.15.7&lt;/li&gt;
&lt;li&gt;Argo CD v2.7.4&lt;/li&gt;
&lt;li&gt;Argo å‘å¸ƒ v1.5.1&lt;/li&gt;
&lt;li&gt;TSE Preview 2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ Istio çš„ VirtualService å’Œ DestinationRule æ¥å®ç°åŸºäº Subset çš„æµé‡åˆ†ç»„è·¯ç”±ï¼Œå¹¶ä½¿ç”¨ ArgoCD Rollouts è¿›è¡Œæ¸è¿›å¼å‘å¸ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;deployment-argocd-and-rollouts&#34;&gt;éƒ¨ç½² ArgoCD å’Œ Argo Rollouts&lt;/h3&gt;
&lt;p&gt;æˆ‘æå‰åˆ›å»ºäº†ä¸€ä¸ª Kubernetes é›†ç¾¤å¹¶å°†å…¶æ·»åŠ åˆ° TSE ä¸­ï¼ŒTSE ä¼šè‡ªåŠ¨ä¸ºé›†ç¾¤å®‰è£… Istio æ§åˆ¶å¹³é¢ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®‰è£… ArgoCD å’Œ Argo Rolloutsï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install ArgoCD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install ArgoCD CLI on macOS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;brew install argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Change the service type of argocd-server to LoadBalancer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl patch svc argocd-server -n argocd -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;spec&amp;#34;: {&amp;#34;type&amp;#34;: &amp;#34;LoadBalancer&amp;#34;}}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Get the ArgoCD UI address&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ARGOCD_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc argocd-server -n argocd -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].hostname}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Login using ArgoCD CLI, see https://argo-cd.readthedocs.io/en/stable/getting_started/#4-login-using-the-cli to get password&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd login &lt;span class=&#34;nv&#34;&gt;$ARGOCD_ADDR&lt;/span&gt; --skip-test-tls --grpc-web --insecure
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install Argo Rollouts&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace argo-rollouts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n argo-rollouts -f https://github.com/argoproj/argo-rollouts/releases/download/latest/install.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install rollouts plugin on macOS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -LO https://github.com/argoproj/argo-rollouts/releases/download/v1.5.0/kubectl-argo-rollouts-darwin-amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod +x ./kubectl-argo-rollouts-darwin-amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mv ./kubectl-argo-rollouts-darwin-amd64 /usr/local/bin/kubectl-argo-rollouts
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥åŠŸèƒ½ä¸é€‚ç”¨äº TSE Bridge Modeï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨ TSE Direct Mode æ¥å®ç°æ¸è¿›å¼å‘å¸ƒã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  ğŸ’¡ä»€ä¹ˆæ˜¯æ¡¥æ¥æ¨¡å¼å’Œç›´æ¥æ¨¡å¼ï¼Ÿ
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  ç›´æ¥æ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼æ˜¯ TSE ä¸­æ§åˆ¶å¹³é¢ä¸‹å‘é…ç½®çš„ä¸¤ç§æ¨¡å¼ã€‚é€‚ç”¨äºæµé‡ã€å®‰å…¨ã€ç½‘å…³ç»„é…ç½®æ¨¡å¼ã€‚BRIDGED æ¨¡å¼æ˜¯ä¸€ç§æç®€æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ Tetrate ç‰¹å®šçš„ API å¿«é€Ÿé…ç½®æœåŠ¡ç½‘æ ¼ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œè€Œ DIRECT æ¨¡å¼ä¸ºé«˜çº§ç”¨æˆ·æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸ä»–ä»¬ç›´æ¥ä½¿ç”¨ Istio API è¿›è¡Œé…ç½®ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œéƒ¨ç½² Rollouts Dashboardï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/argoproj/argo-rollouts.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kustomize build manifests/dashboard-install&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;kubectl apply -n argo-rollouts -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward svc/argo-rollouts-dashboard -n argo-rollouts 3100:3100
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨ç°åœ¨å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://localhost:3100/rollouts/&#34; title=&#34;https://localhost:3100/rollouts/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://localhost:3100/rollouts/&lt;/a&gt;
 è®¿é—® Rollouts ä»ªè¡¨æ¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;bookinfo&#34;&gt;éƒ¨ç½² Bookinfo åº”ç”¨&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»ä¸º Bookinfo åº”ç”¨ç¨‹åºå‡†å¤‡äº†é…ç½®æ–‡ä»¶ï¼ˆä¿å­˜åœ¨ &lt;a href=&#34;https://github.com/tetrateio/tse-gitops-demo/&#34; title=&#34;tse-gitops-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tse-gitops-demo&lt;/a&gt;
 å­˜å‚¨åº“ä¸­ï¼‰ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†å…¶ fork åˆ°æ‚¨è‡ªå·±çš„å¸æˆ·å¹¶å°†å…¶æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å­˜å‚¨åº“ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½² Bookinfo åº”ç”¨ç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app create bookinfo-app --repo https://github.com/tetrateio/tse-gitops-demo.git --path application --dest-server https://kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ &lt;a href=&#34;https://github.com/tetrateio/tse-gitops-demo/blob/main/application/bookinfo.yaml#L151&#34; title=&#34;&amp;lt;code&amp;gt;reviews&amp;lt;/code&amp;gt; éƒ¨ç½²&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;reviews&lt;/code&gt; éƒ¨ç½²&lt;/a&gt;
ä¸­å°† &lt;code&gt;replicas&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;0&lt;/code&gt; ï¼Œå› ä¸ºæˆ‘ä»¬å°†åˆ›å»º Argo Rollouts æ¥æ“çºµ &lt;code&gt;reviews&lt;/code&gt; çš„å®ä¾‹æ•°é‡æœåŠ¡ã€‚å¦‚æœè¿™é‡Œè®¾ç½®ä¸ºéé›¶æ­£æ•´æ•°ï¼Œæˆ‘ä»¬å°†æ— æ³•å®ç°é‡‘ä¸é›€éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ ArgoCD UIï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f4.png&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f4.png&#34; data-width=&#34;3836&#34; data-height=&#34;1928&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 4ï¼šArgoCD ç”¨æˆ·ç•Œé¢&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 4ï¼šArgoCD ç”¨æˆ·ç•Œé¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨å‘ç°åº”ç”¨ç¨‹åºçŠ¶æ€ä¸åŒæ­¥ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æˆ–å•å‡» UI ä¸­çš„ SYNC æŒ‰é’®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app sync bookinfo-app
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;istio-fine-grain-traffic-management&#34;&gt;ä½¿ç”¨ Istio å®æ–½ç»†ç²’åº¦æµé‡ç®¡ç†&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ Argo CD åˆ›å»º Istio ç›¸å…³çš„èµ„æºå¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app create bookinfo-tse-conf --repo https://github.com/tetrateio/tse-gitops-demo.git --path argo/tse --dest-server https://kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated --self-heal
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Check the creation status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app get bookinfo-tse-conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;convert-deployment-to-rollout&#34;&gt;å°† Deployment è½¬æ¢ä¸º Rollout&lt;/h3&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬è¦å‘å¸ƒæ–°ç‰ˆæœ¬çš„ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ã€‚ä¸ºäº†å®ç°é›¶åœæœºæ›´æ–°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é‡‘ä¸é›€éƒ¨ç½²ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°† &lt;code&gt;reviews&lt;/code&gt; Deployment çš„ &lt;code&gt;replicas&lt;/code&gt; å‡å°‘ä¸º 0ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»ºå¼•ç”¨å…ˆå‰åœ¨ Bookinfo åº”ç”¨ç¨‹åºä¸­éƒ¨ç½²çš„ &lt;code&gt;reviews&lt;/code&gt; Deployment çš„ Rolloutï¼›&lt;/li&gt;
&lt;li&gt;å°†æµé‡å‘é€åˆ° &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ä»¥å®ç°è‡ªåŠ¨é‡‘ä¸é›€éƒ¨ç½²è¿›åº¦ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‚¨å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æœ¬æ¼”ç¤ºä¸­ä½¿ç”¨çš„ Rollout å’Œ AnalysisTemplate é…ç½®ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½² &lt;code&gt;reivews-rollout&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app create reviews-rollout --repo https://github.com/tetrateio/tse-gitops-demo.git --path argo/rollout --dest-server https://kubernetes.default.svc --dest-namespace bookinfo --sync-policy automated
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;argocd&lt;/code&gt; å‘½ä»¤æ¥éƒ¨ç½²æˆ–ä½¿ç”¨ &lt;code&gt;kubectl apply&lt;/code&gt; ã€‚æ¨èä½¿ç”¨ &lt;code&gt;argocd&lt;/code&gt; ï¼Œå› ä¸ºæ‚¨å¯ä»¥åŒæ—¶åœ¨ ArgoCD UI å’Œ Argo Rollouts Dashboard ä¸­æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;argocd&lt;/code&gt; å‘½ä»¤ç®¡ç†éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Argo Rollouts Dashboard ä¸­æŸ¥çœ‹ &lt;code&gt;reviews&lt;/code&gt; éƒ¨ç½²çš„çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æµé‡å‘é€åˆ° &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ä¸€æ®µæ—¶é—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GATEWAY_HOSTNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n bookinfo get service tsb-gateway-bookinfo -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].hostname}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; curl -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host: bookinfo.tetrate.com&amp;#34;&lt;/span&gt; http://&lt;span class=&#34;nv&#34;&gt;$GATEWAY_HOSTNAME&lt;/span&gt;/api/v1/products/1/reviews&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;sleep 3&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨å°†åœ¨è¾“å‡ºä¸­çœ‹åˆ°æ¥è‡ªå…·æœ‰ä¸åŒ rollouts-pod-template-hash æ ‡ç­¾çš„ pod çš„å“åº”ï¼Œè¿™è¯æ˜é‡‘ä¸é›€éƒ¨ç½²æ˜¯æœ‰æ•ˆçš„ã€‚å¤§çº¦ 10 åˆ†é’Ÿåï¼Œæ‚¨çœ‹åˆ°çš„ Argo Rollouts ä»ªè¡¨æ¿å°†å¦‚å›¾ 5 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f5.png&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f5.png&#34; data-width=&#34;3584&#34; data-height=&#34;2240&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 5ï¼šArgo Rollouts ä»ªè¡¨æ¿&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 5ï¼šArgo Rollouts ä»ªè¡¨æ¿&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ 5 ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡‘ä¸é›€éƒ¨ç½²è¿›å±•é¡ºåˆ©ï¼Œå·²ç»åˆ°äº†ç¬¬ä¸‰æ­¥ã€‚è¿™æ˜¯å› ä¸º &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡çš„ &lt;code&gt;apdex&lt;/code&gt; ï¼ˆåº”ç”¨æ€§èƒ½æŒ‡æ•°ï¼‰æŒ‡æ ‡æ­£å¸¸ã€‚æ‚¨å¯ä»¥&lt;a href=&#34;https://tetrate.io/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/&#34; title=&#34;ä½¿ç”¨ Postman å‘ SkyWalking æäº¤ GraphQL æŸ¥è¯¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Postman å‘ SkyWalking æäº¤ GraphQL æŸ¥è¯¢&lt;/a&gt;
æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f6.png&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f6.png&#34; data-width=&#34;3584&#34; data-height=&#34;2040&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 6ï¼šä½¿ç”¨ Postman å°† GraphQL æŸ¥è¯¢æäº¤åˆ° SkyWalking&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 6ï¼šä½¿ç”¨ Postman å°† GraphQL æŸ¥è¯¢æäº¤åˆ° SkyWalking&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ„å»ºçš„ GraphQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-graphql&#34; data-lang=&#34;graphql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;ReadMetricsValues&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;readMetricsValues&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;condition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;service_apdex&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;entity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;canary|reviews|bookinfo|cluster-1|-&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;normal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;2023-07-13 0812&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;2023-07-13 0813&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;MINUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥è¯­å¥ä» UTC &lt;code&gt;2023-07-13 8:12&lt;/code&gt; åˆ° &lt;code&gt;2023 8:13&lt;/code&gt; æŸ¥è¯¢ &lt;code&gt;canary|reviews|bookinfo|cluster-1|-&lt;/code&gt; æœåŠ¡çš„ &lt;code&gt;apdex&lt;/code&gt; æŒ‡æ ‡ï¼ŒæŒç»­ä¸¤åˆ†é’Ÿï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;readMetricsValues&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;values&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;values&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service_apdex_202307130812_Y2FuYXJ5fHJldmlld3N8Ym9va2luZm98Y2x1c3Rlci0xfC0=.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service_apdex_202307130813_Y2FuYXJ5fHJldmlld3N8Ym9va2luZm98Y2x1c3Rlci0xfC0=.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;apdex&lt;/code&gt; æŒ‡æ ‡çš„å€¼å¤§äº 9900ï¼ˆAnalysisTemplate çš„ &lt;code&gt;successCondition&lt;/code&gt; ä¸­é…ç½®çš„é˜ˆå€¼ï¼‰ï¼Œå› æ­¤ Rollouts ä¼šé¡ºåˆ©è¿›è¡Œã€‚æ‚¨è¿˜å¯ä»¥åœ¨ Argo Rollouts Dashboard ä¸Šå•å‡»â€œæ‰‹åŠ¨å‡çº§â€æ¥å‡çº§å®ƒï¼Œæˆ–è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl argo rollouts promote reviews-rollout -n bookinf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;clean-up&#34;&gt;æ¸…ç†&lt;/h2&gt;
&lt;p&gt;åˆ é™¤å·²éƒ¨ç½²çš„ ArgoCD åº”ç”¨ç¨‹åºå’Œ Rolloutï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app delete -y reviews-rollout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app delete -y bookinfo-tse-conf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd app delete -y bookinfo-app
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;rollouts-principle&#34;&gt;Argo Rollouts åŸç†&lt;/h2&gt;
&lt;p&gt;ä¸ Istio é›†æˆæ—¶ï¼ŒArgo Rollouts æ”¯æŒåŸºäº VirtualService å’Œ Subset çš„æµé‡æ‹†åˆ†ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f7.svg&#34; data-img=&#34;/blog/implementing-gitops-and-canary-deployment-with-argo-project-and-istio/f7.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 7ï¼šArgo Rollouts ä½¿ç”¨ Istio è¿›è¡Œæµé‡åˆ†é…&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 7ï¼šArgo Rollouts ä½¿ç”¨ Istio è¿›è¡Œæµé‡åˆ†é…&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹è¡¨æä¾›äº†è¿™ä¸¤ç§æµé‡åˆ†æ®µæ–¹æ³•çš„è¯¦ç»†æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ç±»å‹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;èµ„æºå¯¹è±¡&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;åŸåˆ™&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¸»æœºçº§æµé‡åˆ†å‰²&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é€‚ç”¨äºæ ¹æ®ä¸»æœºåè®¿é—®ä¸åŒç‰ˆæœ¬çš„æœåŠ¡ï¼›&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;2 ä¸ªæœåŠ¡ã€1 ä¸ªè™šæ‹ŸæœåŠ¡ã€1 ä¸ªéƒ¨ç½²ï¼›&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Rollout å°† rollouts-pod-template-hash æ ‡ç­¾æ³¨å…¥åˆ° ReplicaSet ä¸­ï¼Œå¹¶é€šè¿‡æ›´æ–° Service ä¸­çš„é€‰æ‹©å™¨æ¥é€‰æ‹©å¸¦æœ‰è¿™äº›æ ‡ç­¾çš„ podï¼›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å­é›†çº§æµé‡åˆ†å‰²&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é€‚ç”¨äºæ ¹æ®æ ‡ç­¾è®¿é—®ä¸åŒçš„æœåŠ¡ï¼›&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1 ä¸ªæœåŠ¡ã€1 ä¸ªè™šæ‹ŸæœåŠ¡ã€1 ä¸ªç›®æ ‡è§„åˆ™å’Œ 1 ä¸ªè½¬å‡ºï¼›&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Rollout å°† rollouts-pod-template-hash æ ‡ç­¾æ³¨å…¥åˆ° ReplicaSet ä¸­ï¼Œå¹¶é€šè¿‡æ›´æ–° DestinationRule ä¸­çš„é€‰æ‹©å™¨æ¥é€‰æ‹©å…·æœ‰è¿™äº›æ ‡ç­¾çš„ podï¼›&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœ¬æ¼”ç¤ºä¸­ä½¿ç”¨åŸºäºå­é›†çš„æµé‡åˆ†å‰²ï¼ŒArgo ä¸æ–­æ¨å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹ VirtualService &lt;code&gt;spec.http[].route[].weight&lt;/code&gt; ä»¥åŒ¹é…å½“å‰æ‰€éœ€çš„é‡‘ä¸é›€æƒé‡&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ DestinationRule &lt;code&gt;spec.subsets[].labels&lt;/code&gt; ä»¥åŒ…å« canary å’Œç¨³å®š ReplicaSet çš„ &lt;code&gt;rollouts-pod-template-hash&lt;/code&gt; æ ‡ç­¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·è®¿é—® &lt;a href=&#34;https://argo-rollouts.readthedocs.io/en/stable/features/traffic-management/istio/&#34; title=&#34;Argo Rollouts æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Argo Rollouts æ–‡æ¡£&lt;/a&gt;
ï¼Œäº†è§£æœ‰å…³ä½¿ç”¨ Istio è¿›è¡Œæµé‡ç®¡ç†çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Argo é¡¹ç›®å’Œ Istio å®ç° GitOps å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ ArgoCD å®ç° GitOpsï¼Œç„¶åä½¿ç”¨ Argo Rollout å’Œ SkyWalking å®ç°è‡ªåŠ¨åŒ–é‡‘ä¸é›€å‘å¸ƒã€‚ä» demo ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° TSE éƒ¨ç½²çš„ Istio ä¸å¼€æºç‰ˆæœ¬å®Œå…¨å…¼å®¹ã€‚TSE æœ‰è®¸å¤šåŠŸèƒ½å€¼å¾—æ¢ç´¢ï¼Œè¯·è®¿é—® &lt;a href=&#34;https://tetrate.io/tetrate-service-express/&#34; title=&#34;Tetrate ç½‘ç«™&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate ç½‘ç«™&lt;/a&gt;
äº†è§£æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio ä¸­çš„è´Ÿè½½å‡è¡¡è¯¦è§£åŠå¤šé›†ç¾¤è·¯ç”±å®è·µ</title>
      <link>https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/</link>
      <pubDate>Thu, 07 Sep 2023 20:16:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/</guid>
      <description>
        
        
        &lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  ç¼–è€…æŒ‰
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  æœ¬æ–‡ä»‹ç»äº† Istio ä¸­æ”¯æŒçš„è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œç„¶åæå‡ºå¤šé›†ç¾¤ç½‘æ ¼è´Ÿè½½å‡è¡¡çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæ‚¨å·²ç»äº†è§£ Istio ä¸­è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥ç›´æ¥ä»&lt;a href=&#34;#multicluster&#34; title=&#34;å¤šé›†ç¾¤ç½‘æ ¼ä¸­çš„è´Ÿè½½å‡è¡¡&#34;&gt;å¤šé›†ç¾¤ç½‘æ ¼ä¸­çš„è´Ÿè½½å‡è¡¡&lt;/a&gt;
éƒ¨åˆ†å¼€å§‹é˜…è¯»ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;åœ¨ä¹‹å‰çš„åšå®¢&lt;a href=&#34;https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/&#34; title=&#34;ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨äº† Kubernetes åä½ å¯èƒ½è¿˜éœ€è¦ Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨äº† Kubernetes åä½ å¯èƒ½è¿˜éœ€è¦ Istio&lt;/a&gt;
 ä¸­æåˆ° Istio æ˜¯åœ¨ Kubernetes çš„åŸºç¡€ä¹‹ä¸Šæ„å»ºèµ·æ¥çš„ï¼ŒKubernetes ä¸­çš„ç»„ä»¶ kube-proxy æœ¬èº«å·²æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä½†æ˜¯åªæ”¯æŒå››å±‚æµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œè€Œä¸”æ— æ³•å®ç°æœåŠ¡è¶…æ—¶ã€ç†”æ–­ç­‰é«˜çº§åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼ŒæœåŠ¡ç½‘æ ¼æ¯”èµ· Kubernetes æ–°å¢äº†ä»¥ä¸‹è´Ÿè½½å‡è¡¡åŠéŸ§æ€§ï¼ˆResiliencyï¼‰ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Layer 7 è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼åœ¨åº”ç”¨å±‚ï¼ˆLayer 7ï¼‰æ“ä½œå’Œç®¡ç†æµé‡ï¼Œå¯ä»¥æ›´ç»†ç²’åº¦åœ°è¯†åˆ«å’Œæ§åˆ¶æµé‡ã€‚è¿™ä½¿å¾—å®ƒå¯ä»¥å®ç°æ›´é«˜çº§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¦‚åŸºäº HTTP è¯·æ±‚å¤´ã€URL è·¯å¾„ã€Cookie ç­‰çš„è·¯ç”±å’Œæµé‡åˆ†å‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼é€šå¸¸å…·å¤‡è‡ªåŠ¨è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®åç«¯æœåŠ¡çš„å®æ—¶å¥åº·çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡æ¥åŠ¨æ€åˆ†å‘æµé‡ã€‚è¿™å…è®¸å®ƒå®ç°æ™ºèƒ½è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå°†æµé‡è·¯ç”±åˆ°æ€§èƒ½æœ€ä½³çš„æœåŠ¡å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼å…·å¤‡é«˜çº§çš„æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ã€‚å®ƒå¯ä»¥æ£€æµ‹åˆ°åç«¯æœåŠ¡å®ä¾‹çš„æ•…éšœï¼Œå¹¶è‡ªåŠ¨å°†æµé‡ä»æ•…éšœå®ä¾‹è½¬ç§»åˆ°å¥åº·å®ä¾‹ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;A/B æµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒ&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼å…è®¸å®æ–½é«˜çº§éƒ¨ç½²ç­–ç•¥ï¼Œå¦‚ A/B æµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒã€‚è¿™äº›ç­–ç•¥å…è®¸åœ¨ä¸åŒçš„æœåŠ¡ç‰ˆæœ¬ä¹‹é—´åŠ¨æ€åˆ†é…æµé‡ï¼Œå¹¶æ ¹æ®ç»“æœè¿›è¡Œå†³ç­–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç†”æ–­å’Œé‡è¯•&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼é€šå¸¸åŒ…å«ç†”æ–­å’Œé‡è¯•æœºåˆ¶ï¼Œä»¥æé«˜åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚å®ƒå¯ä»¥æ ¹æ®åç«¯æœåŠ¡çš„æ€§èƒ½å’Œå¯ç”¨æ€§æƒ…å†µæ¥è‡ªåŠ¨æ‰§è¡Œç†”æ–­æ“ä½œï¼Œå¹¶åœ¨å¿…è¦æ—¶é‡è¯•è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¨å±€æµé‡æ§åˆ¶&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼æä¾›äº†é›†ä¸­å¼çš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ï¼Œå…è®¸å¯¹æ•´ä¸ªæœåŠ¡ç½‘æ ¼ä¸­çš„æµé‡è¿›è¡Œå…¨å±€ç®¡ç†ã€‚è¿™ä½¿å¾—å®ç°ç»Ÿä¸€çš„å®‰å…¨æ€§ã€ç›‘æ§å’Œç­–ç•¥æˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ·±åº¦é›†æˆçš„ç›‘æ§å’Œè¿½è¸ª&lt;/strong&gt;ï¼šæœåŠ¡ç½‘æ ¼é€šå¸¸é›†æˆäº†å¼ºå¤§çš„ç›‘æ§å’Œè¿½è¸ªå·¥å…·ï¼Œå¯ä»¥æä¾›æœ‰å…³æµé‡æ€§èƒ½å’Œå¯è§æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©è¿›è¡Œæ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è™½ç„¶ Kubernetes æä¾›äº†åŸºæœ¬çš„è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œä½†æœåŠ¡ç½‘æ ¼åœ¨å…¶ä¹‹ä¸Šæ„å»ºäº†æ›´é«˜çº§çš„è´Ÿè½½å‡è¡¡å’Œæµé‡ç®¡ç†åŠŸèƒ½ï¼Œä»¥æ»¡è¶³å¾®æœåŠ¡æ¶æ„ä¸­å¤æ‚çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡-vs-æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&#34;&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ vs æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡æ˜¯ä¸¤ç§ä¸åŒçš„è´Ÿè½½å‡è¡¡æ–¹æ³•ï¼Œå®ƒä»¬åœ¨ä¸åŒçš„åœºæ™¯å’Œåº”ç”¨ä¸­æœ‰å„è‡ªçš„ä¼˜åŠ¿ã€‚ä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬çš„è§£é‡Šï¼Œé€‚ç”¨çš„åœºæ™¯ï¼Œå®ç°æ¡ˆä¾‹ä»¥åŠç›¸å…³çš„å¼€æºé¡¹ç›®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆClient-Side Load Balancingï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„ç¤ºæ„å›¾å¦‚å›¾ 1 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/client-side-load-balancing.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/client-side-load-balancing.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 1ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šåœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸­ï¼Œè´Ÿè½½å‡è¡¡å†³ç­–æ˜¯ç”±æœåŠ¡çš„æ¶ˆè´¹è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰æ¥åšå‡ºçš„ã€‚å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨é€šå¸¸ä¼šç»´æŠ¤ä¸€ä¸ªæœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œå¹¶æ ¹æ®é…ç½®å’Œç­–ç•¥é€‰æ‹©è¦å‘é€è¯·æ±‚çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤šä¸ªå®¢æˆ·ç«¯éœ€è¦è®¿é—®åŒä¸€ç»„åç«¯æœåŠ¡ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œç­–ç•¥é€‰æ‹©åç«¯æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡æ¶ˆè´¹è€…éœ€è¦æ›´å¤šçš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ï¼Œä¾‹å¦‚ A/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ¡ˆä¾‹&lt;/strong&gt;ï¼šå¸¸è§çš„å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å¼€æºé¡¹ç›®åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ribbon&lt;/strong&gt;ï¼šNetflix Ribbon æ˜¯ä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å¼€æºé¡¹ç›®ï¼Œå®ƒå¯ä»¥ä¸ Spring Cloud é›†æˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Envoy&lt;/strong&gt;ï¼šEnvoy æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå¹¿æ³›ç”¨äºæœåŠ¡ç½‘æ ¼å’Œå¾®æœåŠ¡æ¶æ„ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NGINX&lt;/strong&gt;ï¼šè™½ç„¶ NGINX é€šå¸¸ç”¨äºåå‘ä»£ç†ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ä½œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼ˆServer-Side Load Balancingï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡å¦‚å›¾ 2 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/server-side-load-balancing.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/server-side-load-balancing.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 2ï¼šæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 2ï¼šæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šåœ¨æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ä¸­ï¼Œè´Ÿè½½å‡è¡¡å†³ç­–æ˜¯ç”±æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨æˆ–ä»£ç†æ¥åšå‡ºçš„ã€‚å®¢æˆ·ç«¯åªéœ€å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°å“ªä¸ªåç«¯æœåŠ¡å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¸å…³å¿ƒåç«¯æœåŠ¡çš„å…·ä½“å®ä¾‹ï¼Œåªå…³å¿ƒå‘é€è¯·æ±‚åˆ°æœåŠ¡çš„åç§°æˆ–åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥éœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œå…¨å±€é…ç½®ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å…³å¿ƒè´Ÿè½½å‡è¡¡ç»†èŠ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ¡ˆä¾‹&lt;/strong&gt;ï¼šå¸¸è§çš„å®ç°æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡çš„å¼€æºé¡¹ç›®åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NGINX&lt;/strong&gt;ï¼šNGINX å¯ä»¥ç”¨ä½œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ‰§è¡ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°åç«¯æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HAProxy&lt;/strong&gt;ï¼šHAProxy æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šå¸¸ç”¨äºæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Amazon ELBï¼ˆElastic Load Balancerï¼‰&lt;/strong&gt;ï¼šäºšé©¬é€Šæä¾›çš„è´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œç”¨äºå°†è¯·æ±‚è·¯ç”±åˆ° AWS åç«¯æœåŠ¡å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæœ‰æ—¶ä¹Ÿä¼šå°†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ç»“åˆä½¿ç”¨ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„éœ€æ±‚ã€‚é€‰æ‹©å“ªç§è´Ÿè½½å‡è¡¡æ–¹æ³•é€šå¸¸å–å†³äºæ‚¨çš„æ¶æ„ã€éƒ¨ç½²éœ€æ±‚ä»¥åŠæ€§èƒ½è¦æ±‚ã€‚æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰é€šå¸¸ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ¥å®ç°ç»†ç²’åº¦çš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ï¼Œè€Œåœ¨äº‘æœåŠ¡æä¾›å•†ä¸­ï¼ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡é€šå¸¸ç”¨äºè‡ªåŠ¨æ‰©å±•å’Œæµé‡ç®¡ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;how-istio-do-lb&#34;&gt;Istio å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;åœ¨æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡é€šå¸¸æ˜¯é€šè¿‡ Envoy ä»£ç†å®ç°çš„ã€‚Envoy æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥ç”¨äºæ„å»ºæœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢ï¼Œç”¨äºå¤„ç†æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ˜¯ä¸€ç§åœ¨æœåŠ¡æ¶ˆè´¹è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸€ä¾§å®ç°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒå†³å®šäº†è¯·æ±‚åº”è¯¥å¦‚ä½•è·¯ç”±åˆ°åç«¯æœåŠ¡å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å•é›†ç¾¤å•ç½‘ç»œ Istio æœåŠ¡ç½‘æ ¼çš„è´Ÿè½½å‡è¡¡å¦‚å›¾ 3 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/istio-load-balancing.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/istio-load-balancing.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 3ï¼šå•é›†ç¾¤å•ç½‘ç»œçš„ Istio æœåŠ¡ç½‘æ ¼çš„è´Ÿè½½å‡è¡¡&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 3ï¼šå•é›†ç¾¤å•ç½‘ç»œçš„ Istio æœåŠ¡ç½‘æ ¼çš„è´Ÿè½½å‡è¡¡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æœåŠ¡ç½‘æ ¼ä¸­å¦‚ä½•å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„ä¸€èˆ¬æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Sidecar ä»£ç†&lt;/strong&gt;: åœ¨æœåŠ¡ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªéƒ¨ç½²çš„æœåŠ¡å®ä¾‹é€šå¸¸éƒ½ä¸ä¸€ä¸ª Sidecar ä»£ç†ï¼ˆé€šå¸¸æ˜¯ Envoyï¼‰å…³è”ã€‚è¿™ä¸ª Sidecar ä»£ç†ä½äºæœåŠ¡å®ä¾‹æ—è¾¹ï¼Œè´Ÿè´£å¤„ç†è¯¥æœåŠ¡å®ä¾‹çš„å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/strong&gt;: åœ¨æœåŠ¡ç½‘æ ¼ä¸­ï¼ŒæœåŠ¡å®ä¾‹çš„æ³¨å†Œå’Œå‘ç°é€šå¸¸ç”±æœåŠ¡æ³¨å†Œè¡¨ï¼ˆKubernetes çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼‰å¤„ç†ã€‚è¿™äº›æ³¨å†Œè¡¨ç»´æŠ¤äº†æœåŠ¡å®ä¾‹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç½‘ç»œåœ°å€å’Œå¥åº·çŠ¶æ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡é…ç½®&lt;/strong&gt;: åœ¨å®¢æˆ·ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹è€…ï¼‰å‘é€è¯·æ±‚æ—¶ï¼ŒSidecar ä»£ç†ä¼šæ‰§è¡Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚è¿™äº›è´Ÿè½½å‡è¡¡ç­–ç•¥é€šå¸¸åœ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­è·å–çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ä¸Šæ“ä½œã€‚ç­–ç•¥å¯ä»¥åŸºäºå¤šç§å› ç´ è¿›è¡Œé€‰æ‹©ï¼Œä¾‹å¦‚æƒé‡ã€å¥åº·çŠ¶æ€ã€å»¶è¿Ÿç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚è·¯ç”±&lt;/strong&gt;: æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒSidecar ä»£ç†å°†è¯·æ±‚è·¯ç”±åˆ°é€‰æ‹©çš„åç«¯æœåŠ¡å®ä¾‹ã€‚è¿™å¯ä»¥åŒ…æ‹¬ä½¿ç”¨è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥ç­‰ç®—æ³•æ¥é€‰æ‹©ç›®æ ‡å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šä¿¡å¤„ç†&lt;/strong&gt;: ä¸€æ—¦é€‰æ‹©äº†ç›®æ ‡å®ä¾‹ï¼ŒSidecar ä»£ç†å°†è¯·æ±‚è½¬å‘ç»™è¯¥å®ä¾‹ï¼Œç„¶åå°†å“åº”ä¼ å›ç»™å®¢æˆ·ç«¯ã€‚å®ƒè¿˜å¯ä»¥å¤„ç†è¿æ¥ç®¡ç†ã€æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ç­‰ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ˜¯åœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸€ä¾§ï¼ˆé€šå¸¸æ˜¯ Envoy ä»£ç†ï¼‰å®ç°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒä½¿æœåŠ¡ç½‘æ ¼èƒ½å¤Ÿæœ‰æ•ˆåœ°åˆ†å‘æµé‡å¹¶å¤„ç†åç«¯æœåŠ¡å®ä¾‹çš„æ•…éšœã€‚è¿™ç§æ–¹å¼ä½¿å¾—è´Ÿè½½å‡è¡¡å†³ç­–åœ¨æœåŠ¡æ¶ˆè´¹è€…çš„æ§åˆ¶ä¸‹ï¼Œå¹¶å…è®¸æ›´ç²¾ç»†çš„æµé‡æ§åˆ¶å’Œç­–ç•¥å®šä¹‰ã€‚Envoy ä»£ç†æ˜¯å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å…³é”®ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒå…·æœ‰ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºæ»¡è¶³ä¸åŒçš„è´Ÿè½½å‡è¡¡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;lb-types&#34;&gt;Istio ä¸­çš„è´Ÿè½½å‡è¡¡ç±»å‹&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio çš„&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/&#34; title=&#34;DestinationRule&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DestinationRule&lt;/a&gt;
èµ„æºä¸­ï¼Œ&lt;code&gt;loadBalancer&lt;/code&gt;éƒ¨åˆ†ç”¨äºé…ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ§åˆ¶è¯·æ±‚å¦‚ä½•åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹æˆ–ç‰ˆæœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/istio-loadbalancer.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/istio-loadbalancer.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 4ï¼šIstio ä¸­çš„è´Ÿè½½å‡è¡¡é…ç½®å‚æ•°&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 4ï¼šIstio ä¸­çš„è´Ÿè½½å‡è¡¡é…ç½®å‚æ•°&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒIstio æ”¯æŒä¸‰ç§ç±»å‹çš„è´Ÿè½½å‡è¡¡ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;simple&lt;/code&gt;ï¼šåŸºäºå¸¸ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•çš„ç®€å•è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;consistentHashLB&lt;/code&gt;ï¼šåŸºäºä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;localityLbSetting&lt;/code&gt;ï¼šåŸºäºåœ°åŸŸçš„æœ¬åœ°æ€§è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸è´Ÿè½½å‡è¡¡é…ç½®ç›¸å…³çš„å­—æ®µçš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;simple&lt;/strong&gt;ï¼šè¿™ä¸ªéƒ¨åˆ†å®šä¹‰äº†ä¸€äº›ç®€å•çš„è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰é¡¹ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹é€‰é¡¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ROUND_ROBIN&lt;/strong&gt;ï¼šè¯·æ±‚ä¼šä¾æ¬¡åˆ†å‘åˆ°æ‰€æœ‰å¯ç”¨çš„åç«¯å®ä¾‹ï¼Œä»¥è½®è¯¢çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LEAST_CONN&lt;/strong&gt;ï¼šè¯·æ±‚å°†è·¯ç”±åˆ°å½“å‰è¿æ¥æ•°æœ€å°‘çš„åç«¯å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RANDOM&lt;/strong&gt;ï¼šè¯·æ±‚å°†éšæœºè·¯ç”±åˆ°åç«¯å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PASSTHROUGH&lt;/strong&gt;ï¼šIstio ä¸ä¼šè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œè€Œæ˜¯å°†è¯·æ±‚ç›´æ¥è·¯ç”±åˆ°æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œé€‚ç”¨äºç‰¹å®šç”¨ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;consistentHashLB&lt;/strong&gt;ï¼šè¿™ä¸ªéƒ¨åˆ†å…è®¸ä½ é…ç½®ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;httpHeaderName&lt;/strong&gt;ï¼šç”¨äºå“ˆå¸Œè®¡ç®—çš„ HTTP æ ‡å¤´çš„åç§°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;httpCookie&lt;/strong&gt;ï¼šç”¨äºå“ˆå¸Œè®¡ç®—çš„ HTTP Cookie çš„é…ç½®ï¼ŒåŒ…æ‹¬åç§°ã€è·¯å¾„å’Œç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;useSourceIp&lt;/strong&gt;ï¼šæ˜¯å¦ä½¿ç”¨è¯·æ±‚çš„æº IP åœ°å€è¿›è¡Œå“ˆå¸Œè®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;httpQueryParameterName&lt;/strong&gt;ï¼šç”¨äºå“ˆå¸Œè®¡ç®—çš„ HTTP æŸ¥è¯¢å‚æ•°çš„åç§°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ringHash&lt;/strong&gt;ï¼šé…ç½®ç¯å½¢å“ˆå¸Œè´Ÿè½½å‡è¡¡ï¼ŒåŒ…æ‹¬æœ€å°ç¯å¤§å°ï¼ˆminimumRingSizeï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maglev&lt;/strong&gt;ï¼šé…ç½® Maglev è´Ÿè½½å‡è¡¡ï¼ŒåŒ…æ‹¬è¡¨æ ¼å¤§å°ï¼ˆtableSizeï¼‰å’Œæœ€å°ç¯å¤§å°ï¼ˆminimumRingSizeï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;localityLbSetting&lt;/strong&gt;ï¼šè¿™ä¸ªéƒ¨åˆ†ç”¨äºé…ç½®æœ¬åœ°æ€§è´Ÿè½½å‡è¡¡è®¾ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;distribute&lt;/strong&gt;ï¼šå®šä¹‰äº†è¯·æ±‚çš„åˆ†å¸ƒï¼ŒåŒ…æ‹¬èµ·å§‹ä½ç½®ï¼ˆfromï¼‰å’Œç»“æŸä½ç½®ï¼ˆtoï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;failover&lt;/strong&gt;ï¼šå®šä¹‰äº†æ•…éšœåˆ‡æ¢ï¼ŒåŒ…æ‹¬èµ·å§‹ä½ç½®ï¼ˆfromï¼‰å’Œç»“æŸä½ç½®ï¼ˆtoï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;failoverPriority&lt;/strong&gt;ï¼šæ•…éšœåˆ‡æ¢çš„ä¼˜å…ˆçº§è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;enabled&lt;/strong&gt;ï¼šæ˜¯å¦å¯ç”¨æœ¬åœ°æ€§è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™äº›å­—æ®µå…è®¸ä½ æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©é€‚å½“çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶é…ç½®é¢å¤–çš„é€‰é¡¹ï¼Œä»¥ç¡®ä¿è¯·æ±‚æŒ‰ç…§æ‰€éœ€çš„æ–¹å¼åˆ†å‘åˆ°åç«¯æœåŠ¡å®ä¾‹ã€‚ä¸åŒçš„ç­–ç•¥å’Œé…ç½®é€‰é¡¹å¯ä»¥æ»¡è¶³å„ç§è´Ÿè½½å‡è¡¡éœ€æ±‚ï¼Œå¦‚æ€§èƒ½ã€å¯é æ€§å’Œæµé‡æ§åˆ¶ã€‚å…³äºè¿™äº›å­—æ®µçš„è¯¦ç»†ä»‹ç»è¯·è§ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-lb&#34;&gt;å¦‚ä½•åœ¨ Istio ä¸­ä¸ºæœåŠ¡è®¾ç½®è´Ÿè½½å‡è¡¡&lt;/h2&gt;
&lt;p&gt;æ­£å¦‚æˆ‘åœ¨&lt;a href=&#34;https://jimmysong.io/blog/understand-istio-vs-and-dr/&#34; title=&#34;å¦‚ä½•ç†è§£ Istio ä¸­çš„ VirtualService å’Œ DestinationRule&#34;&gt;å¦‚ä½•ç†è§£ Istio ä¸­çš„ VirtualService å’Œ DestinationRule&lt;/a&gt;
è¿™ç¯‡æ–‡ç« ä¸­æ‰€è¯´çš„ï¼Œ&lt;code&gt;VirtualService&lt;/code&gt; ä¸»è¦ç”¨äºè®¾ç½®è·¯ç”±è§„åˆ™ï¼Œè€ŒæœåŠ¡å¼¹æ€§ï¼ˆè´Ÿè½½å‡è¡¡ã€è¶…æ—¶ã€é‡è¯•ã€ç†”æ–­ç­‰ï¼‰éœ€è¦é å®ƒå’Œ DestinationRule æ¥å…±åŒç»´æŒã€‚åªæœ‰åŒæ—¶éƒ¨ç½²äº†ä»¥ä¸Šä¸¤ç§èµ„æºï¼Œè´Ÿè½½å‡è¡¡æ‰èƒ½çœŸæ­£ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è®¾ç½®è´Ÿè½½å‡è¡¡çš„ä¸€èˆ¬æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»º DestinationRule èµ„æº&lt;/strong&gt;ï¼šé¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª DestinationRule èµ„æºï¼Œè¯¥èµ„æºå®šä¹‰äº†æœåŠ¡çš„æµé‡ç­–ç•¥å’Œç›®æ ‡è§„åˆ™ã€‚åœ¨ DestinationRule ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šè¦è®¾ç½®è´Ÿè½½å‡è¡¡çš„æœåŠ¡çš„åç§°ï¼ˆhostï¼‰ä»¥åŠè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ª DestinationRule çš„ç¤ºä¾‹ï¼Œå…¶ä¸­å°†æµé‡åˆ†å‘åˆ°å…·æœ‰æ ‡ç­¾ &amp;ldquo;version: v1&amp;rdquo; å’Œ &amp;ldquo;version: v2&amp;rdquo; çš„ä¸¤ä¸ªå­é›†ä¸­ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;ROUND_ROBIN&lt;/code&gt; è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-destination-rule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-service.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;loadBalancer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;simple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ROUND_ROBIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº”ç”¨ DestinationRule&lt;/strong&gt;ï¼šåˆ›å»º DestinationRule åï¼Œå°†å…¶åº”ç”¨äºè¦è¿›è¡Œè´Ÿè½½å‡è¡¡çš„æœåŠ¡ã€‚è¿™é€šå¸¸å¯ä»¥é€šè¿‡ Istio çš„ VirtualService èµ„æºæ¥å®Œæˆï¼Œé€šè¿‡åœ¨ VirtualService ä¸­å¼•ç”¨ DestinationRuleã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ª VirtualService ç¤ºä¾‹ï¼Œå°†æµé‡å¼•å¯¼åˆ°åä¸º &amp;ldquo;my-destination-rule&amp;rdquo; çš„ DestinationRuleï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-virtual-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;my-service.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-service.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-service.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ ¹æ®æƒé‡é…ç½®ï¼Œ80% çš„æµé‡å°†è·¯ç”±åˆ°å­é›† v1ï¼Œè€Œ 20% çš„æµé‡å°†è·¯ç”±åˆ°å­é›† v2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº”ç”¨é…ç½®&lt;/strong&gt;ï¼šæœ€åï¼Œå°† VirtualService å’Œ DestinationRule èµ„æºåº”ç”¨åˆ°ä½ çš„ Istio ç¯å¢ƒä¸­ï¼Œä»¥ç¡®ä¿è´Ÿè½½å‡è¡¡è§„åˆ™ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤å°† VirtualService å’Œ DestinationRule åº”ç”¨åˆ° Istio ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f your-service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥ä¸ºä½ çš„æœåŠ¡è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ ¹æ®éœ€è¦å°†æµé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡ç‰ˆæœ¬æˆ–å®ä¾‹ï¼Œå¹¶æ§åˆ¶æµé‡çš„æƒé‡ã€‚è¿™æœ‰åŠ©äºå®ç°è¯¸å¦‚é‡‘ä¸é›€å‘å¸ƒã€A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒç­‰éƒ¨ç½²ç­–ç•¥ã€‚è¯·æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚å’Œç¯å¢ƒè°ƒæ•´è´Ÿè½½å‡è¡¡é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;devide&#34;&gt;ä¸ºä»€ä¹ˆè¦åˆ†å¼€é…ç½®ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨ Istio ä¸­ï¼Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œå®ƒä»¬é€šå¸¸ç”¨äºæ§åˆ¶æœåŠ¡ä¹‹é—´çš„æµé‡å’Œè¡Œä¸ºï¼Œå› æ­¤é€šå¸¸åˆ†åˆ«é…ç½®åœ¨ä¸¤ä¸ªä¸åŒçš„èµ„æºå¯¹è±¡ä¸­ï¼š&lt;code&gt;DestinationRule&lt;/code&gt; ç”¨äºè´Ÿè½½å‡è¡¡ï¼Œ&lt;code&gt;VirtualService&lt;/code&gt; ç”¨äºè·¯ç”±ã€‚è¿™ç§åˆ†ç¦»çš„è®¾è®¡æœ‰ä¸€äº›ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å—åŒ–å’Œæ¸…æ™°æ€§ï¼š&lt;/strong&gt; å°†è´Ÿè½½å‡è¡¡å’Œè·¯ç”±é…ç½®åˆ†ç¦»æˆä¸¤ä¸ªèµ„æºå¯¹è±¡å¯ä»¥ä½¿é…ç½®æ›´åŠ æ¨¡å—åŒ–å’Œæ¸…æ™°ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£å’Œç»´æŠ¤è¿™ä¸¤ä¸ªæ–¹é¢çš„é…ç½®ï¼Œè€Œä¸ä¼šä½¿é…ç½®å¯¹è±¡è¿‡äºå¤æ‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç»´æŠ¤æ€§ï¼š&lt;/strong&gt; å°†è´Ÿè½½å‡è¡¡å’Œè·¯ç”±é…ç½®åˆ†å¼€å¯ä»¥ä½¿å®ƒä»¬æ›´å®¹æ˜“ç»´æŠ¤å’Œä¿®æ”¹ï¼Œå› ä¸ºå®ƒä»¬ä½äºä¸åŒçš„èµ„æºå¯¹è±¡ä¸­ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥é’ˆå¯¹ä¸åŒçš„éœ€æ±‚æ›´æ”¹è´Ÿè½½å‡è¡¡ç­–ç•¥è€Œä¸ä¼šå½±å“è·¯ç”±è§„åˆ™ï¼Œåä¹‹äº¦ç„¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯é‡ç”¨æ€§ï¼š&lt;/strong&gt; æ¨¡å—åŒ–çš„é…ç½®å…è®¸æ‚¨æ›´å®¹æ˜“åœ°é‡ç”¨é…ç½®ç‰‡æ®µã€‚æ‚¨å¯ä»¥åœ¨ä¸åŒçš„ &lt;code&gt;DestinationRule&lt;/code&gt; æˆ– &lt;code&gt;VirtualService&lt;/code&gt; ä¸­ä½¿ç”¨ç›¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥æˆ–è·¯ç”±è§„åˆ™ï¼Œä»¥æé«˜é…ç½®çš„å¯é‡ç”¨æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç²¾ç»†æ§åˆ¶ï¼š&lt;/strong&gt; åˆ†ç¦»çš„é…ç½®å…è®¸æ‚¨å¯¹æ¯ä¸ªæ–¹é¢è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡å®šåˆ¶ä¸åŒçš„è·¯ç”±è§„åˆ™å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ç”¨ä¾‹å’Œè¦æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è™½ç„¶è´Ÿè½½å‡è¡¡å’Œè·¯ç”±é€šå¸¸æ˜¯åˆ†å¼€é…ç½®çš„ï¼Œä½†å®ƒä»¬ä¹‹é—´ä»ç„¶å­˜åœ¨ç´§å¯†çš„å…³è”ï¼Œå› ä¸ºè·¯ç”±è§„åˆ™å†³å®šäº†è¯·æ±‚å°†å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡ï¼Œè€Œè´Ÿè½½å‡è¡¡ç­–ç•¥å†³å®šäº†åœ¨æ‰€é€‰ç›®æ ‡æœåŠ¡ä¹‹é—´å¦‚ä½•åˆ†å‘æµé‡ã€‚å› æ­¤ï¼Œåœ¨ Istio ä¸­ï¼Œè¿™ä¸¤ä¸ªé…ç½®å¯¹è±¡é€šå¸¸éœ€è¦ååŒå·¥ä½œï¼Œä»¥å®ç°æ‚¨çš„æµé‡ç®¡ç†éœ€æ±‚ã€‚é€šè¿‡å°†å®ƒä»¬åˆ†å¼€é…ç½®ï¼Œä½¿å¾—é…ç½®æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ï¼Œå¹¶å…è®¸æ›´çµæ´»åœ°æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;multicluster&#34;&gt;å¤šé›†ç¾¤ç½‘æ ¼ä¸­çš„è´Ÿè½½å‡è¡¡&lt;/h2&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡é¢†åŸŸï¼ŒIstio å·²è¢«è¯æ˜æ˜¯ç®¡ç†æœåŠ¡é€šä¿¡çš„æ— ä»·ä¹‹å®ã€‚è™½ç„¶å®ƒåœ¨å•é›†ç¾¤åœºæ™¯ä¸‹è¡¨ç°å‡ºè‰²ï¼Œä½†å¤šé›†ç¾¤è®¾ç½®å¼•å…¥äº†ç‹¬ç‰¹çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è´Ÿè½½å‡è¡¡æ–¹é¢ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ­ç§˜ Istio ä¸­çš„å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œä¸ºæ‚¨æä¾›è§£å†³è¿™ä¸€å¤æ‚ä»»åŠ¡çš„æ¸…æ™°è·¯çº¿å›¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;two-tier-ingress-gateway&#34;&gt;ä¸¤å±‚å…¥å£ç½‘å…³ï¼šå®ç°å¤šé›†ç¾¤é€šä¿¡çš„å…³é”®&lt;/h3&gt;
&lt;p&gt;åœ¨æ¶‰åŠæ¥è‡ªä¸åŒä¾›åº”å•†çš„é›†ç¾¤çš„å¤šé›†ç¾¤è®¾ç½®ä¸­ï¼Œç¬¬ä¸€æ­¥æ˜¯ä¸ºæ¯ä¸ªé›†ç¾¤å»ºç«‹ä¸€ä¸ªç½‘å…³ã€‚ç„¶è€Œï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å…³é”®ä¸€ç‚¹æ˜¯éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·è®¿é—®å…¥å£ç‚¹ã€‚å°½ç®¡å¯ä»¥åœ¨åŒä¸€é›†ç¾¤ä¸­éƒ¨ç½²æ­¤ç½‘å…³ï¼Œä½†é€šå¸¸å»ºè®®å°†å…¶æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤å±‚å…¥å£ç½‘æ ¼çš„éƒ¨ç½²æ¶æ„å¦‚å›¾ 4 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/tier1-gw-listening.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/tier1-gw-listening.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 4ï¼šä¸¤å±‚å…¥å£ç½‘å…³&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 4ï¼šä¸¤å±‚å…¥å£ç½‘å…³&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;components&#34;&gt;å¤šé›†ç¾¤é€šä¿¡æ‰€éœ€ç»„ä»¶&lt;/h3&gt;
&lt;p&gt;åŸºäº Istio åˆ›å»ºçš„å¤šé›†ç¾¤ç½‘æ ¼ï¼Œé€šå¸¸æ˜¯&lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/&#34; title=&#34;å¤šç½‘æ ¼å¤šç½‘ç»œæ¨¡å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šç½‘æ ¼å¤šç½‘ç»œæ¨¡å¼&lt;/a&gt;
ï¼Œä¸ºäº†è®©ç½‘æ ¼äº’é€šï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªä¸€çº§ï¼ˆTier-1ï¼‰é›†ç¾¤ï¼Œå¹¶åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»ºå¦‚ä¸‹ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…¥å£ç½‘å…³&lt;/strong&gt;ï¼šæ¯ä¸ªç½‘æ ¼å¿…é¡»æœ‰ä¸€ä¸ªå…¥å£ç½‘å…³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ServiceEntry&lt;/strong&gt;ï¼šç”¨äºå…è®¸é›†ç¾¤å‘ç°å½¼æ­¤çš„ç«¯ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;VirtualServices å’Œ DestinationRules&lt;/strong&gt;ï¼šå¯¹äºæ¯ä¸ªé›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè·¯ç”±è‡³å…³é‡è¦ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;demo&#34;&gt;å®æˆ˜æ¼”ç¤ºï¼šä¸€ä¸ªå¤šé›†ç¾¤æ¼”ç¤º&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘å°†æ¶µç›–ä¸‰ä¸ª GKE ä¸Šçš„ Kubernetes é›†ç¾¤ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„åŒºåŸŸï¼Œå¦‚å›¾ 5 æ‰€ç¤ºã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„ä¾›åº”å•†æˆ–è€…è·¨ä¾›åº”å•†ã€‚åœ¨æ¯ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²äº† Istioï¼Œä¸ºå¤šé›†ç¾¤é€šä¿¡å¥ å®šäº†åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;å»ºç«‹äº†ä¸¤å±‚é›†ç¾¤ï¼šä¸€ä¸ªä¸“é—¨æ‰˜ç®¡ &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡ï¼Œå¦ä¸€ä¸ªåŒ…å«å®Œæ•´ &lt;a href=&#34;https://istio.io/latest/docs/examples/bookinfo/&#34; title=&#34;bookinfo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo&lt;/a&gt;
 çš„æœåŠ¡å¥—ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/init-infra.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/init-infra.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 5ï¼šæ¼”ç¤ºç¯å¢ƒçš„éƒ¨ç½²æƒ…å†µ&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 5ï¼šæ¼”ç¤ºç¯å¢ƒçš„éƒ¨ç½²æƒ…å†µ&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;multicluster-routing-and-lb&#34;&gt;å®ç°å¤šé›†ç¾¤è·¯ç”±å’Œè´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å®ç°è¯¸å¦‚è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ç­‰é«˜çº§åŠŸèƒ½ï¼Œè§£å†³å¤šé›†ç¾¤è·¯ç”±é—®é¢˜è‡³å…³é‡è¦ã€‚ç”±äºä¸€çº§é›†ç¾¤ä¹Ÿéƒ¨ç½²äº† Istioï¼Œå¯ä»¥å°†å…ˆå‰è®¨è®ºçš„è´Ÿè½½å‡è¡¡æŠ€å·§åº”ç”¨äºæ­¤ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;å…³é”®æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»ºå…¥å£ç½‘å…³ï¼Œå¹¶è·å–ç½‘å…³ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡å™¨çš„ IP åœ°å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»º &lt;strong&gt;VirtualServicesã€DestinationRules å’Œ ServiceEntries&lt;/strong&gt;ã€‚ç¡®ä¿ ServiceEntries åŒ…å«æ¯ä¸ªé›†ç¾¤å…¥å£ç½‘å…³çš„å…¥å£ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºè¿›ä¸€æ­¥çš„æµ‹è¯•ï¼Œ&lt;strong&gt;æ£€ç´¢ Tier 1 ç½‘å…³çš„ IP åœ°å€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GATEWAY_IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n tier1 get service tier1-gateway -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼šè¿™ä¸€æ­¥éœ€è¦åœ¨ä¸€çº§é›†ç¾¤ä¸­æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€çº§é›†ç¾¤çš„ç½‘å…³ä½œä¸ºç»Ÿä¸€ç½‘å…³å…¥å£ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨è¿™ä¸ªé›†ç¾¤ä¸­é…ç½® Gatewayã€VirtualServiceã€DestinationRule å’Œ ServiceEntry èµ„æºå¯¹è±¡ï¼Œå®ç°å¤šé›†ç¾¤çš„è·¯ç”±ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/istio-resources.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/istio-resources.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 6ï¼šä¸€çº§é›†ç¾¤ä¸­çš„ Istio èµ„æº&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 6ï¼šä¸€çº§é›†ç¾¤ä¸­çš„ Istio èµ„æº&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­æˆ‘ä»¬å°†å®ç°åŸºäº HTTP header å’Œ prefix çš„å¤šé›†ç¾¤çš„è·¯ç”±ï¼Œæœ€ç»ˆçš„è·¯ç”±è·¯å¾„å¦‚å›¾ 7 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/demystifying-the-load-balancing-in-istio/final.svg&#34; data-img=&#34;/blog/demystifying-the-load-balancing-in-istio/final.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 7ï¼šè·¯ç”±è·¯å¾„&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 7ï¼šè·¯ç”±è·¯å¾„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…³äºæ“ä½œçš„ç»†èŠ‚å¯ä»¥å‚è€ƒ TSB æ–‡æ¡£ä¸­çš„&lt;a href=&#34;https://docs.tetrate.io/service-bridge/next/howto/gateway/unified-gateway&#34; title=&#34;ç»Ÿä¸€ç½‘å…³&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»Ÿä¸€ç½‘å…³&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;test&#34;&gt;æµ‹è¯•è®¾ç½®&lt;/h3&gt;
&lt;p&gt;æ¼”ç¤ºç»§ç»­è¿›è¡Œå®é™…æµ‹è¯•ï¼Œä½¿ç”¨ &lt;code&gt;curl&lt;/code&gt; å‘½ä»¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ— éœ€ HTTP æ ‡å¤´çš„è¯·æ±‚ URLã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -Ss &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://bookinfo.tetrate.io/productpage&amp;#34;&lt;/span&gt; --resolve &lt;span class=&#34;s2&#34;&gt;&amp;#34;bookinfo.tetrate.io:80:&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GATEWAY_IP&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -v &amp;gt; index1.html
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨æŒ‡ç¤ºé¦–é€‰é›†ç¾¤çš„ HTTP æ ‡å¤´è¯·æ±‚ URLã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -Ss &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://bookinfo.tetrate.io/productpage&amp;#34;&lt;/span&gt; --resolve &lt;span class=&#34;s2&#34;&gt;&amp;#34;bookinfo.tetrate.io:80:&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GATEWAY_IP&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -v -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;X-CLUSTER-SELECTOR: gke-jimmy-us-west1-1&amp;#34;&lt;/span&gt; &amp;gt; index2.html
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -Ss &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://bookinfo.tetrate.io/productpage&amp;#34;&lt;/span&gt; --resolve &lt;span class=&#34;s2&#34;&gt;&amp;#34;bookinfo.tetrate.io:80:&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GATEWAY_IP&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -v -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;X-CLUSTER-SELECTOR: gke-jimmy-us-west1-2&amp;#34;&lt;/span&gt; &amp;gt; index3.html
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡å¯¼å‡ºçš„ HTML æ–‡ä»¶éªŒè¯ç»“æœã€‚åœ¨æµè§ˆå™¨ä¸­åˆ†åˆ«æ‰“å¼€ &lt;code&gt;index1.html&lt;/code&gt;ã€&lt;code&gt;index2.html&lt;/code&gt; å’Œ &lt;code&gt;index3.html&lt;/code&gt; è¿™ä¸‰ä¸ªæ–‡ä»¶ï¼Œä½ å°†çœ‹åˆ°é¡µé¢ 1 å’Œé¡µé¢ 2 ä¸­éƒ½æ˜¾ç¤º reviews å’Œ details æœåŠ¡ä¸å¯ç”¨ï¼Œåªæœ‰é¡µé¢ 3 ä¸­çš„æ‰€æœ‰æœåŠ¡éƒ½å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;multicluster-lb&#34;&gt;å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;æ¼”ç¤ºæˆåŠŸå±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ HTTP æ ‡å¤´å’Œè·¯å¾„è·¯ç”±ã€‚è·¯ç”±æ˜¯è´Ÿè½½å‡è¡¡çš„åŸºç¡€ã€‚å®ç°äº†å¤šé›†ç¾¤è·¯ç”±ä¹‹åï¼Œä½ å°±å¯ä»¥å°†æ¥è‡ªäºŒçº§ï¼ˆTier-2ï¼‰é›†ç¾¤çš„ç«¯ç‚¹æ·»åŠ åˆ°ä¸€ä¸ª subset ä¸­ï¼Œä»è€Œåœ¨ DestinationRule ä¸­å®ç°è´Ÿè½½å‡è¡¡é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡å°†äºŒçº§é›†ç¾¤ä¸­çš„å…¥å£ç½‘å…³é…ç½®ä¸ºä¸œè¥¿å‘ç½‘å…³ï¼Œä»è€Œè§£å†³ Cluster 1 ä¸­çš„æ•…éšœè½¬ç§»é—®é¢˜ã€‚è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;automation&#34;&gt;è‡ªåŠ¨åŒ–çš„å‘¼å£°&lt;/h3&gt;
&lt;p&gt;å°½ç®¡ Istio æä¾›äº†åŸºäº Envoy çš„å„ç§è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œä½†æ‰‹åŠ¨åœ¨å¤šä¸ªé›†ç¾¤ä¸­åˆ›å»ºèµ„æºå¯¹è±¡å®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡ä½ä¸‹ã€‚è‡ªåŠ¨åŒ–ï¼Œæœ€å¥½æ˜¯åœ¨ Istio ä¹‹ä¸Šæ·»åŠ ä¸€ä¸ªè§£é‡Šå±‚ï¼Œæ˜¯ä¸‹ä¸€ä¸ªå‘å±•é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;Tetrate ä½¿ç”¨ TSB è§£å†³äº†è¿™ä¸ªéœ€æ±‚ï¼ŒTSB ä¸ä¸Šæ¸¸çš„ Istio å…¼å®¹ï¼Œä¸ºå¤šé›†ç¾¤éƒ¨ç½²æä¾›äº†æ— ç¼çš„è§£å†³æ–¹æ¡ˆã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® &lt;a href=&#34;https://tetrate.io&#34; title=&#34;Tetrate ç½‘ç«™&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate ç½‘ç«™&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç²¾é€š Istio ä¸­çš„å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡å¯¹äºåœ¨å¤æ‚ç¯å¢ƒä¸­å‘æŒ¥å¾®æœåŠ¡çš„å…¨éƒ¨æ½œåŠ›è‡³å…³é‡è¦ã€‚é€šè¿‡è°¨æ…çš„é…ç½®å’Œåˆé€‚çš„å·¥å…·ï¼Œæ‚¨å¯ä»¥åœ¨é›†ç¾¤ä¹‹é—´å®ç°å¼ºå¤§ä¸”å¯é çš„é€šä¿¡ï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºæ— è®ºéƒ¨ç½²åœ¨ä½•å¤„éƒ½èƒ½é¡ºåˆ©è¿è¡Œã€‚å¯¹äºæ›´ç²¾ç»†çš„è´Ÿè½½å‡è¡¡è°ƒæ•´ï¼Œè¯·è€ƒè™‘æ¢ç´¢ EnvoyFilterã€‚æ„Ÿè°¢æ‚¨åŠ å…¥æˆ‘ä»¬ä¸€èµ·æ­ç§˜ Istio ä¸­çš„å¤šé›†ç¾¤è´Ÿè½½å‡è¡¡ä¹‹æ—…ï¼&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/&#34; title=&#34;Install Multi-Primary on different networks - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Install Multi-Primary on different networks - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.tetrate.io/service-bridge/next/howto/gateway/unified-gateway&#34; title=&#34;Unified Gateway - docs.tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Unified Gateway - docs.tetrate.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/&#34; title=&#34;DestinationRule - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DestinationRule - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä½¿ç”¨ GraphQL å’Œ Postman æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®</title>
      <link>https://jimmysong.io/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/</link>
      <pubDate>Thu, 20 Jul 2023 16:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ &lt;a href=&#34;https://graphql.org/&#34; title=&#34;GraphQL ä¸&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GraphQL ä¸&lt;/a&gt;
&lt;a href=&#34;https://www.postman.com/&#34; title=&#34;Postman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Postman&lt;/a&gt;
 ä¸€èµ·ä» &lt;a href=&#34;https://skywalking.apache.org/&#34; title=&#34;SkyWalking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SkyWalking&lt;/a&gt;
 æŸ¥è¯¢æ•°æ®ã€‚å®ƒåŒ…æ‹¬è·å–ä¸è®°åä»¤ç‰Œã€æ„å»ºæŸ¥è¯¢ä»¥æ£€ç´¢ç‰¹å®šæœåŠ¡çš„è´Ÿè½½æŒ‡æ ‡ä»¥åŠä½¿ç”¨ GraphQL è‡ªçœæ¥æŸ¥çœ‹ SkyWalking GraphQL API æ¶æ„çš„æ­¥éª¤ã€‚æœ¬æ–‡è¿˜æä¾›äº†æ›´å¤šä¿¡æ¯çš„å‚è€ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-graphql&#34;&gt;ä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ&lt;/h2&gt;
&lt;p&gt;GraphQL æ˜¯ Facebook å¼€å‘çš„ä¸€ç§ API æŸ¥è¯¢è¯­è¨€å’Œè¿è¡Œæ—¶ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯å‡†ç¡®æŒ‡å®šä»–ä»¬éœ€è¦çš„æ•°æ®å¹¶ä»…æ¥æ”¶è¯¥æ•°æ®ä½œä¸ºå“åº”ï¼Œä»è€Œä¸ºä¼ ç»Ÿ REST API æä¾›äº†æ›´é«˜æ•ˆã€æ›´å¼ºå¤§ã€æ›´çµæ´»çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä½¿ç”¨ GraphQLï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨å•ä¸ªè¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ªèµ„æºï¼Œä»è€Œå‡å°‘ä¸æœåŠ¡å™¨çš„å¾€è¿”æ¬¡æ•°å¹¶æé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;graphql-å’Œ-rest-api-ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«&#34;&gt;GraphQL å’Œ REST API ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;GraphQL å…è®¸å®¢æˆ·ç«¯ä»…è¯·æ±‚ä»–ä»¬éœ€è¦çš„æ•°æ®ï¼Œè€Œ REST API è¦æ±‚å®¢æˆ·ç«¯æ£€ç´¢èµ„æºä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œæ— è®ºä»–ä»¬æ˜¯å¦éœ€è¦ã€‚æ­¤å¤–ï¼ŒGraphQL å…è®¸å®¢æˆ·ç«¯åœ¨å•ä¸ªè¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ªèµ„æºï¼Œè¿™ä½¿å…¶æ¯” REST API æ›´é«˜æ•ˆã€æ›´ç®€æ´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•æŸ¥è¯¢-skywalking-æ•°æ®&#34;&gt;å¦‚ä½•æŸ¥è¯¢ SkyWalking æ•°æ®ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;SkyWalking å®šä¹‰äº†æŸ¥è¯¢é˜¶æ®µçš„é€šä¿¡åè®®ã€‚SkyWalking åŸç”Ÿ UI å’Œ CLI ä½¿ç”¨æ­¤åè®®ä»åç«¯æŒç»­è·å–æ•°æ®ï¼Œæ— éœ€æ‹…å¿ƒåç«¯æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;ä» SkyWalking æŸ¥è¯¢æŒ‡æ ‡æœ‰ä¸¤ç§æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://skywalking.apache.org/docs/main/v9.4.0/en/api/query-protocol/&#34; title=&#34;GraphQL API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GraphQL API&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://skywalking.apache.org/docs/main/v9.4.0/en/api/promql-service/&#34; title=&#34;PromQL API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL API&lt;/a&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡æä¾›äº†æœ‰å…³å¦‚ä½•ä½¿ç”¨ GraphQL ä» SkyWalking æŸ¥è¯¢æŒ‡æ ‡çš„æŒ‡å—ã€‚å¦‚æœä½ å¯¹ PromQL API æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚é˜…æ–‡ç« &lt;a href=&#34;https://skywalking.apache.org/zh/2023-03-17-build-grafana-dashboards-for-apache-skywalking-native-promql-support/&#34; title=&#34;ä¸º Apache SkyWalking æ„å»º Grafana Dashboard - åŸç”Ÿ PromQL æ”¯æŒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸º Apache SkyWalking æ„å»º Grafana Dashboard - åŸç”Ÿ PromQL æ”¯æŒ&lt;/a&gt;
 ã€‚ç»§ç»­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤éœ€è¦å®‰è£… TSBã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œä½†ä»æƒ³ä½“éªŒä½¿ç”¨ GraphQL åœ¨ SkyWalking ä¸­æŸ¥è¯¢æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ SkyWalking æä¾›çš„å…è´¹&lt;a href=&#34;https://skywalking.apache.org/&#34; title=&#34;æ¼”ç¤ºç¯å¢ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¼”ç¤ºç¯å¢ƒ&lt;/a&gt;
ï¼ˆç”¨æˆ·å / å¯†ç ï¼šskywalking/skywalkingï¼‰ã€‚ç™»å½•æ¼”ç¤ºç½‘ç«™å¹¶è·å–æŸ¥è¯¢ä»¤ç‰Œã€‚GraphQL æŸ¥è¯¢çš„ç«¯ç‚¹åœ°å€æ˜¯ &lt;a href=&#34;http://demo.skywalking.apache.org/graphql&#34; title=&#34;http://demo.skywalking.apache.org/graphql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://demo.skywalking.apache.org/graphql&lt;/a&gt;
 ã€‚æ„é€ æŸ¥è¯¢çš„æ­¥éª¤ä¸ä¸‹é¢æè¿°çš„ç›¸åŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§‚å¯Ÿ-tsb-ä¸­çš„-graphql-æŸ¥è¯¢&#34;&gt;è§‚å¯Ÿ TSB ä¸­çš„ GraphQL æŸ¥è¯¢&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ä½¿ç”¨ Postman æ„å»ºè‡ªå·±çš„ GraphQL æŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè§‚å¯Ÿ TSB å¦‚ä½•ä» SkyWalking è·å–æ•°æ®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰“å¼€ Chrome DevTools å¹¶åˆ‡æ¢åˆ°â€œNetworkâ€é€‰é¡¹å¡ã€‚&lt;/li&gt;
&lt;li&gt;è®¿é—®ç½‘ç«™ä¸Šçš„&lt;strong&gt;Organization - Services&lt;/strong&gt; é€‰é¡¹å¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è§‚å¯Ÿç½‘ç»œè¯·æ±‚åˆ—è¡¨å¹¶å³é”®å•å‡»å…¶ä¸­ä¸€ä¸ª graphql è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/f1.jpg&#34; data-img=&#34;/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/f1.jpg&#34; data-width=&#34;2048&#34; data-height=&#34;1440&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šChrome DevTool&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 1ï¼šChrome DevTool&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ çœ‹åˆ°çš„ curl å‘½ä»¤å°†å¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä½ å°†ä» SkyWalking ä¸­è·å– TSB ç®¡ç†çš„æœåŠ¡åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;lt;https://saturn.tetrate.work/ui/graphql&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7,zh-TW;q=0.6&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Cache-Control: no-cache&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Client-Timestamp: 1686104776136&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Connection: keep-alive&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Cookie: ...&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Origin: &amp;lt;https://saturn.tetrate.work&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Pragma: no-cache&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Referer: &amp;lt;https://saturn.tetrate.work/mp/services&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Request-Id: ...&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Sec-Fetch-Dest: empty&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Sec-Fetch-Mode: cors&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Sec-Fetch-Site: same-origin&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Bridge-Csrf-Token: IOmJszLAqY3TRIUNhTuGu7vQgnfQY1FtgYFm+l/+Mu4EmVQU5T8EaQ7bngkCv4hQ12ZGids+I21pHMdepE9/qQ==&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Csrf-Token: xTbxZerD3t8N3PaS7nbjKCfxk1Q9dtvvrx4D+IJohHicb0VfB4iAZaP0zh1eXDWctQyCYZWaKLhAYT3M6Drk3A==&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;accept: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;sec-ch-ua: &amp;#34;Not.A/Brand&amp;#34;;v=&amp;#34;8&amp;#34;, &amp;#34;Chromium&amp;#34;;v=&amp;#34;114&amp;#34;, &amp;#34;Google Chrome&amp;#34;;v=&amp;#34;114&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;sec-ch-ua-mobile: ?0&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;sec-ch-ua-platform: &amp;#34;macOS&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --data-raw &lt;span class=&#34;s1&#34;&gt;$&amp;#39;{&amp;#34;query&amp;#34;:&amp;#34;query ServiceRegistryListMetrics(...)}&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --compressed
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt; &lt;em&gt;ä¸Šä¾‹ä¸­çš„æŸäº›å­—æ®µå¤ªé•¿ï¼Œç”¨ç‚¹ (&amp;hellip;) æ›¿æ¢&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æŒ‡å¯¼ä½ æ„å»ºä¸€ä¸ªæŸ¥è¯¢æ¥æ£€ç´¢ç‰¹å®šæœåŠ¡çš„è´Ÿè½½æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è·å–-bearer-token&#34;&gt;è·å– Bearer Token&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œä½ éœ€è¦è·å–ç½‘ç«™çš„ Bearer Tokenã€‚ç™»å½•åˆ° TSB UIï¼Œç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·æŒ‰é’®ï¼Œç„¶åç‚¹å‡»â€œShow token informationâ€ã€‚åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œä½ å°†çœ‹åˆ° Bearer Tokenï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/f2.jpg&#34; data-img=&#34;/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/f2.jpg&#34; data-width=&#34;2046&#34; data-height=&#34;1036&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 2ï¼šä» TSB UI è·å– Bear Token&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 2ï¼šä» TSB UI è·å– Bear Token&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šBearer token çš„æœ‰æ•ˆæœŸæ¯”è¾ƒçŸ­ã€‚å½“å®ƒè¿‡æœŸæ—¶ï¼Œä½ éœ€è¦é‡æ–°ç™»å½• TSB ä»¥è·å–æ–°çš„ tokenã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»é¢„å…ˆéƒ¨ç½²äº†&lt;a href=&#34;https://istio.io/latest/docs/examples/bookinfo/&#34; title=&#34;bookinfo åº”ç”¨ç¨‹åº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo åº”ç”¨ç¨‹åº&lt;/a&gt;
å¹¶å‘é€äº†ä¸€äº›æµ‹è¯•æµé‡ã€‚è¦åœ¨ Postman å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ GraphQL æŸ¥è¯¢&lt;code&gt;reviews&lt;/code&gt;çš„è´Ÿè½½æŒ‡æ ‡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ GraphQL è¯·æ±‚ï¼Œå¹¶è¾“å…¥è¯·æ±‚ URLï¼š&lt;code&gt;$TSB_ADDRESS/graphql&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ·»åŠ å¸¦æœ‰å€¼&lt;code&gt;Bearer $TOKEN&lt;/code&gt;çš„&lt;code&gt;Authorization&lt;/code&gt;å¤´&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ GraphQL Introspection æŸ¥çœ‹ SkyWalking GraphQL APIs çš„æ¨¡å¼ã€‚æŸ¥æ‰¾å¹¶å•å‡»&lt;code&gt;readMetricsValues&lt;/code&gt;é¡¹ã€‚ä½ å°†åœ¨å³ä¾§çœ‹åˆ°å˜é‡ã€‚å¡«å†™&lt;code&gt;condition&lt;/code&gt;å’Œ&lt;code&gt;duration&lt;/code&gt;é¡¹ç›®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/f3.jpg&#34; data-img=&#34;/blog/how-to-use-graphql-to-query-observability-data-from-skywalking-with-postman/f3.jpg&#34; data-width=&#34;2048&#34; data-height=&#34;1164&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 3ï¼šPostman æŸ¥è¯¢&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 3ï¼šPostman æŸ¥è¯¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å˜é‡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-graphql&#34; data-lang=&#34;graphql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;ReadMetricsValues&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;readMetricsValues&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;condition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;service_cpm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;entity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;reviews&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;normal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;2023-06-05 0625&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;2023-06-05 0627&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;MINUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•å‡» Query æŒ‰é’®ä»¥è·å–ç»“æœã€‚å®ƒåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;readMetricsValues&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;values&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;values&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service_cpm_202306050625_cmV2aWV3cw==.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service_cpm_202306050626_cmV2aWV3cw==.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service_cpm_202306050627_cmV2aWV3cw==.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šæ˜¯ä½¿ç”¨ SkyWalking Demo ç¯å¢ƒæµ‹è¯• GraphQL æŸ¥è¯¢ã€‚TSE ä¹Ÿæ”¯æŒ GraphQL æŸ¥è¯¢ï¼Œå¹¶ä¸”ç«¯ç‚¹åœ°å€ä¸º&lt;code&gt;$TSB_SERVER/graphql&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šæ­¤å¤„çš„æŸ¥è¯¢ç«¯ç‚¹ä¸ DevTool ä¸­çœ‹åˆ°çš„ä¸åŒã€‚TSB UI ç‰¹å®šçš„ GraphQL æŸ¥è¯¢ç«¯ç‚¹æ˜¯&lt;code&gt;$TSB_SERVER/ui/graphql&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…³ SkyWalking GraphQL æŸ¥è¯¢åè®®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://github.com/apache/skywalking-query-protocol/tree/master&#34; title=&#34;GitHub&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•åœ¨ Postman ä¸­ä½¿ç”¨ GraphQL æŸ¥è¯¢åè®®æŸ¥è¯¢ SkyWalking ä¸­çš„æ•°æ®ã€‚ä½ å¯ä»¥æ ¹æ® SkyWalking çš„ GraphQL æ¨¡å¼æ„å»ºè‡ªå·±çš„æŸ¥è¯¢æ¡ä»¶ã€‚TSB / TSE ä¸­ä¹Ÿæä¾›äº†æ­¤åŠŸèƒ½ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Geneve éš§é“å®ç° Istio Ambient Mesh çš„æµé‡æ‹¦æˆª</title>
      <link>https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/</link>
      <pubDate>Fri, 24 Mar 2023 15:03:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨æˆ‘&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/&#34; title=&#34;ä¹‹å‰çš„åšå®¢&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;
åˆ†äº«ä¸­æåˆ° Istio Ambient Mesh ä½¿ç”¨ iptables å’Œ Geneve éš§é“å°†åº”ç”¨ç¨‹åº Pod ä¸­çš„æµé‡æ‹¦æˆªåˆ° Ztunnel ä¸­ã€‚å¾ˆå¤šè¯»è€…å¯èƒ½è¿˜ä¸äº†è§£è¿™ç§éš§é“åè®®ï¼Œæœ¬æ–‡å°†ä¸ºä½ ä»‹ç» Geneve éš§é“çš„å®šä¹‰ï¼ŒæŠ¥æ–‡ç»“æ„ï¼Œä»¥åŠä¸ VXLAN åè®®çš„æ¯”è¾ƒæœ‰å“ªäº›ä¼˜åŠ¿ã€‚æœ€åï¼Œæœ¬æ–‡å°†ä»‹ç» Istio Ambient Mesh å¦‚ä½•åº”ç”¨ Geneve éš§é“æ¥å®ç°æµé‡æ‹¦æˆªï¼Œä»¥åŠ Istio 1.18 ä¸­æ–°æ¨å‡ºçš„ eBPF æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;geneve-éš§é“ç®€ä»‹&#34;&gt;Geneve éš§é“ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;GENEVEï¼ˆGeneric Network Virtualization Encapsulationï¼‰æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–å°è£…ï¼ˆéš§é“ï¼‰åè®®ï¼Œå®ƒçš„è®¾è®¡çš„åˆè¡·æ˜¯ä¸ºäº†è§£å†³å½“å‰æ•°æ®ä¼ è¾“ç¼ºä¹çµæ´»æ€§å’Œå®‰å…¨æ€§çš„é—®é¢˜ã€‚Geneve åªå®šä¹‰äº†ä¸€ç§æ•°æ®å°è£…æ ¼å¼ï¼Œä¸åŒ…æ‹¬æ§åˆ¶å¹³é¢çš„ä¿¡æ¯ã€‚GENEVE ç›¸è¾ƒäº VXLAN å°è£…çš„å…³é”®ä¼˜åŠ¿åœ¨äºå…¶é€šè¿‡æ·»åŠ  TLV æ ¼å¼çš„é€‰é¡¹æ¥æ‰©å±•å¯å°è£…çš„åè®®ç±»å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;geneve-vs-vxlan&#34;&gt;Geneve vs VXLAN&lt;/h2&gt;
&lt;p&gt;VXLAN å’Œ Geneve éƒ½æ˜¯ç½‘ç»œè™šæ‹ŸåŒ–åè®®ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚è™šæ‹ŸåŒ–åè®®æ˜¯ä¸€ç§å°†è™šæ‹Ÿç½‘ç»œä¸ç‰©ç†ç½‘ç»œåˆ†ç¦»çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œç®¡ç†å‘˜åœ¨è™šæ‹Ÿç¯å¢ƒä¸­åˆ›å»ºå¤šä¸ªè™šæ‹Ÿç½‘ç»œï¼Œæ¯ä¸ªè™šæ‹Ÿç½‘ç»œéƒ½å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ VLAN æ ‡è¯†ç¬¦ã€IP åœ°å€å’Œè·¯ç”±ã€‚æ­¤å¤–ï¼ŒVXLAN å’Œ Geneve åè®®éƒ½ä½¿ç”¨ UDP å°è£…ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½å¤Ÿé€šè¿‡ç°æœ‰ç½‘ç»œåŸºç¡€è®¾æ–½è¿›è¡Œæ‰©å±•ã€‚VXLAN å’Œ Geneve åè®®è¿˜å…·æœ‰çµæ´»æ€§ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ä¸ä¸åŒçš„è™šæ‹ŸåŒ–å¹³å°å…¼å®¹ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ 1 å±•ç¤ºäº† VXLAN ä¸ Geneve åè®®çš„æŠ¥æ–‡ç»“æ„åŠå…¶å„è‡ªçš„ Header åŒºåˆ«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/vxlan-vs-geneve.svg&#34; data-img=&#34;/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/vxlan-vs-geneve.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šVXLAN ä¸ Geneve æŠ¥æ–‡æ ¼å¼ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 1ï¼šVXLAN ä¸ Geneve æŠ¥æ–‡æ ¼å¼ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒVXLAN ä¸ Geneve éš§é“æŠ¥æ–‡çš„ç»“æ„ç±»ä¼¼ï¼Œå…¶ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨ä¸åŒçš„ UDP ç«¯å£å·å’Œåè®®å¤´ â€”â€”VXLAN ä½¿ç”¨ 4789 ç«¯å£ï¼ŒGeneve ä½¿ç”¨ 6081 ç«¯å£ï¼›Geneve åè®®å¤´æ¯” VXLAN æ›´å…·æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Geneve éš§é“åè®®æ¯” VXLAN æ›´åŠ å¯æ‰©å±•æ˜¯å› ä¸º Geneve éš§é“åè®®ä¸­å¢åŠ äº†å˜é•¿é€‰é¡¹ï¼Œå®ƒå¯ä»¥åŒ…å«é›¶æˆ–å¤šä¸ª TLV æ ¼å¼çš„é€‰é¡¹æ•°æ®ã€‚TLV æ˜¯æŒ‡ç±»å‹ - é•¿åº¦ - å€¼ï¼ˆType-Length-Valueï¼‰æ ¼å¼ï¼Œç”¨äºä¼ è¾“å’Œè§£æç½‘ç»œåŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚åœ¨ Geneve åè®®ä¸­ï¼Œæ¯ä¸ªå…ƒæ•°æ®ä¿¡æ¯éƒ½ç”±ä¸€ä¸ª TLV æ ¼å¼çš„å­—æ®µç»„æˆï¼Œä»¥ä¾¿äºçµæ´»åœ°æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹è¿™äº›å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼ŒTLV æ ¼å¼çš„å­—æ®µåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Typeï¼š8 ä½çš„ç±»å‹å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;Lengthï¼š5 ä½çš„é€‰é¡¹é•¿åº¦å­—æ®µï¼Œä»¥ 4 å­—èŠ‚å€æ•°è¡¨ç¤ºï¼Œä¸åŒ…æ‹¬é€‰é¡¹å¤´ã€‚&lt;/li&gt;
&lt;li&gt;Dataï¼šå¯å˜é•¿çš„é€‰é¡¹æ•°æ®å­—æ®µï¼Œå¯ä»¥ä¸å­˜åœ¨æˆ–è€…ä¸º 4 åˆ° 128 å­—èŠ‚ä¹‹é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨ TLV æ ¼å¼ï¼ŒGeneve åè®®å¯ä»¥è½»æ¾åœ°æ‰©å±•å’Œä¿®æ”¹å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒæ—¶ä¿æŒå…¼å®¹æ€§å’Œçµæ´»æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº VXLAN éš§é“æŠ¥æ–‡çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://tools.ietf.org/html/rfc7348&#34; title=&#34;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&lt;/a&gt;
 ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Geneve éš§é“æŠ¥æ–‡çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://www.rfc-editor.org/rfc/rfc8926#name-geneve-packet-format-over-i&#34; title=&#34;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&lt;/a&gt;
 ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œåŸç†&#34;&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;p&gt;Geneve éš§é“ä¸»è¦åº”ç”¨åœ¨äº‘è®¡ç®—å’Œè™šæ‹ŸæœºåŒ–åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åŒ…å°è£…åœ¨ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ä¸­ï¼Œä»¥ä¾¿åœ¨è™šæ‹Ÿç½‘ç»œä¸­ä¼ è¾“ã€‚Geneve éš§é“ä½¿ç”¨ä¸€ä¸ª 24 ä½çš„è™šæ‹Ÿç½‘ç»œæ ‡è¯†ç¬¦ (VNI)ï¼Œå°†æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚Geneve éš§é“è¿˜å¯ä»¥ä½¿ç”¨å®‰å…¨æ€§åè®®ï¼Œå¦‚ IPsecã€TLï¼Œæ¥ä¿æŠ¤æ•°æ®åŒ…çš„ä¼ è¾“ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ•°æ®åŒ…åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶ï¼ŒGeneve éš§é“åè®®ä¼šå°†æ•°æ®åŒ…ä» Geneve åè®®å¤´ä¸­è§£å°è£…å‡ºæ¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è™šæ‹Ÿç½‘ç»œä¸­çš„ç›®çš„åœ°ã€‚åœ¨è§£å°è£…è¿‡ç¨‹ä¸­ï¼ŒGeneve åè®®å¤´ä¸­çš„ VNI ä¿¡æ¯ä¼šè¢«æ¥åˆ¤æ–­æ•°æ®åŒ…çš„ç›®çš„åœ°ï¼Œä»¥ç¡®ä¿æ•°æ®åŒ…è¢«æ­£ç¡®åœ°è·¯ç”±åˆ°è™šæ‹Ÿç½‘ç»œä¸­çš„ç›®çš„åœ°ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œå…¶ VNI ä¸º 1001ã€‚å½“æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨éš§é“å°†æ•°æ®åŒ…ä»ä¸€ä¸ªç‰©ç†ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéš§é“å°†æºç‰©ç†ç½‘ç»œå’Œç›®æ ‡ç‰©ç†ç½‘ç»œä¹‹é—´çš„è™šæ‹Ÿç½‘ç»œæ ‡è¯†ç¬¦ (VNI) è®¾ç½®ä¸º 1001ï¼Œä»¥ä¾¿åœ¨ä¼ è¾“æœŸé—´è·Ÿè¸ªæ•°æ®åŒ…ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡ç‰©ç†ç½‘ç»œæ—¶ï¼Œéš§é“å°† VNI ä»æ•°æ®åŒ…ä¸­åˆ é™¤ï¼Œå¹¶å°†æ•°æ®åŒ…ä¼ é€’ç»™ç›®æ ‡ç‰©ç†ç½‘ç»œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®‰å…¨æ€§&#34;&gt;å®‰å…¨æ€§&lt;/h3&gt;
&lt;p&gt;Geneve éš§é“åè®®æœ¬èº«å¹¶æ²¡æœ‰æä¾›ä»»ä½•å®‰å…¨æœºåˆ¶ï¼Œå› æ­¤åœ¨ Geneve éš§é“ä¸­ä¼ è¾“çš„æ•°æ®åŒ…å¯èƒ½ä¼šå—åˆ°å¨èƒï¼Œä¾‹å¦‚æ•°æ®åŒ…è¢«ç¯¡æ”¹ã€æˆªè·ã€é‡æ”¾ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿éšœ Geneve éš§é“ä¸­ä¼ è¾“çš„æ•°æ®åŒ…çš„å®‰å…¨æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨åè®®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®‰å…¨åè®®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IPsecï¼ˆInternet Protocol Securityï¼‰ï¼šIPsec æ˜¯ä¸€ç§ç½‘ç»œå±‚å®‰å…¨åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ã€è®¤è¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚ä½¿ç”¨ IPsec å¯ä»¥æä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;TLSï¼ˆTransport Layer Securityï¼‰ï¼šTLS æ˜¯ä¸€ç§åŸºäºä¼ è¾“å±‚çš„åŠ å¯†åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚ä½¿ç”¨ TLS å¯ä»¥æä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;MACSecï¼ˆMedia Access Control Securityï¼‰ï¼šMACSec æ˜¯ä¸€ç§æ•°æ®é“¾è·¯å±‚çš„å®‰å…¨åè®®ï¼Œå¯ä»¥å¯¹ Geneve éš§é“ä¸­çš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚ä½¿ç”¨ MACSec å¯ä»¥æä¾›é“¾è·¯å±‚çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šå®‰å…¨åè®®éƒ½éœ€è¦è¿›è¡Œç›¸åº”çš„é…ç½®å’Œéƒ¨ç½²ï¼Œä¸”å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚åœ¨é€‰æ‹©åˆé€‚çš„å®‰å…¨åè®®æ—¶ï¼Œéœ€è¦è€ƒè™‘å®‰å…¨æ€§ã€æ€§èƒ½ã€å¯ç®¡ç†æ€§ç­‰æ–¹é¢çš„å› ç´ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆé€‰æ‹©-geneve&#34;&gt;ä¸ºä»€ä¹ˆé€‰æ‹© Geneveï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸‹è¡¨å¯¹æ¯”äº† VXLAN ä¸ Geneve åœ¨å¤šä¸ªæ–¹é¢çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;VXLAN&lt;/th&gt;
&lt;th&gt;Geneve&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤´éƒ¨æ ¼å¼&lt;/td&gt;
&lt;td&gt;å›ºå®šæ ¼å¼&lt;/td&gt;
&lt;td&gt;å¯æ‰©å±•æ ¼å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯æ‰©å±•æ€§&lt;/td&gt;
&lt;td&gt;æ›´å¤šåœ°ä¸“æ³¨äº L2 æ‰©å±•&lt;/td&gt;
&lt;td&gt;æ›´å¥½åœ°æ”¯æŒæ–°å…´ç½‘ç»œæœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯æ“ä½œæ€§&lt;/td&gt;
&lt;td&gt;è¾ƒéš¾ç®¡ç†å’Œæ‰©å±•&lt;/td&gt;
&lt;td&gt;æ›´å®¹æ˜“ç®¡ç†å’Œæ‰©å±•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ€§èƒ½&lt;/td&gt;
&lt;td&gt;å¤´éƒ¨è¾ƒçŸ­ï¼Œæ€§èƒ½è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;å¤´éƒ¨è¾ƒé•¿ï¼Œæ€§èƒ½ç•¥ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä½¿ç”¨ Geneve åè®®çš„ä¸»è¦åŸå› æ˜¯å°†ç›®å‰ç½‘ç»œè™šæ‹ŸåŒ–å°è£…æŠ€æœ¯ï¼ˆä¾‹å¦‚ VXLANã€NVGRE å’Œ STTï¼‰ä¸­çš„ä¼˜ç‚¹åˆå¹¶åˆ°ä¸€ä¸ªåè®®ä¸­ã€‚æˆ‘ä»¬é€šè¿‡å¤šå¹´çš„ç½‘ç»œè™šæ‹ŸåŒ–å¼€å‘ç»éªŒå¾—çŸ¥ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„éœ€æ±‚æ˜¯å¯æ‰©å±•æ€§ã€‚Geneve åè®®ä½¿ç”¨å¯æ‰©å±•çš„ TLV ç»“æ„å¯¹å…ƒæ•°æ®è¿›è¡Œç¼–ç ï¼Œå› æ­¤å¯ä»¥ç‹¬ç«‹åœ°å‘å±•è½¯ä»¶å’Œç¡¬ä»¶ç«¯ç‚¹çš„åŠŸèƒ½ï¼Œä»¥æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ambient-mesh-å¦‚ä½•åº”ç”¨-geneve-éš§é“&#34;&gt;Istio Ambient Mesh å¦‚ä½•åº”ç”¨ Geneve éš§é“&lt;/h2&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/&#34; title=&#34;ä¹‹å‰çš„åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;
ä¸­ï¼Œæˆ‘è®²è§£äº† Istio Ambient Mesh å¦‚ä½•ä½¿ç”¨ Ztunnel å®ç° L4 ä»£ç†çš„ï¼Œå›¾ 2 å±•ç¤ºä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/geneve-tunnel.svg&#34; data-img=&#34;/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/geneve-tunnel.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 2ï¼šä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 2ï¼šä½¿ç”¨ iptables å’Œ Geneve éš§é“çš„ L4 é€æ˜æµé‡åŠ«æŒè·¯å¾„ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºÂ &lt;code&gt;istioout&lt;/code&gt;Â ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°†èŠ‚ç‚¹ä¸­çš„å‡ºç«™æµé‡é€æ˜åŠ«æŒåˆ°Â &lt;code&gt;pistioout&lt;/code&gt;Â è™šæ‹Ÿç½‘å¡ï¼›&lt;/li&gt;
&lt;li&gt;Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»º &lt;code&gt;istioin&lt;/code&gt; ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°†èŠ‚ç‚¹ä¸­çš„å…¥ç«™æµé‡é€æ˜åŠ«æŒåˆ° &lt;code&gt;pistioin&lt;/code&gt; è™šæ‹Ÿç½‘å¡ï¼›&lt;/li&gt;
&lt;li&gt;Istio CNI åœ¨ ztunnel ä¸­åˆ›å»º &lt;code&gt;pistioin&lt;/code&gt; å’Œ &lt;code&gt;pistioout&lt;/code&gt; ç½‘å¡ï¼Œç”¨äºæ¥æ”¶ Geneve éš§é“ä¸­çš„å‘æ¥çš„æ•°æ®åŒ…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;pistioin&lt;/code&gt; å’Œ &lt;code&gt;pistioout&lt;/code&gt; è¿™ä¸¤ä¸ªç½‘å¡æ˜¯ç”± ztunnel ä¸­çš„ init å®¹å™¨æˆ– Istio CNIï¼ˆè§ &lt;a href=&#34;https://github.com/istio/istio/blob/master/cni/pkg/ambient/net_linux.go#L910&#34; title=&#34;&amp;lt;code&amp;gt;CreateRulesWithinNodeProxyNS&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;CreateRulesWithinNodeProxyNS&lt;/code&gt;&lt;/a&gt;
 å‡½æ•°ï¼‰åˆ›å»ºçš„ï¼Œå…¶ IP åœ°å€å’Œç«¯å£ä¹Ÿæ˜¯å›ºå®šçš„ã€‚åº”ç”¨å®¹å™¨å‘å‡ºçš„æ•°æ®åŒ…éœ€è¦ç»è¿‡ &lt;code&gt;istioout&lt;/code&gt; ç½‘å¡å¹¶ä½¿ç”¨ Geneve éš§é“å°è£…åè½¬å‘ç»™ ztunnel å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-ebpf-è¿›è¡Œé€æ˜æµé‡åŠ«æŒ&#34;&gt;ä½¿ç”¨ eBPF è¿›è¡Œé€æ˜æµé‡åŠ«æŒ&lt;/h2&gt;
&lt;p&gt;eBPFï¼ˆextended Berkeley Packet Filterï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨ Linux å†…æ ¸ä¸­è¿è¡Œå®‰å…¨çš„ç”¨æˆ·æ€ç¨‹åºã€‚eBPF æœ€åˆæ˜¯ä¸€ç§ç”¨äºè¿‡æ»¤ç½‘ç»œæ•°æ®åŒ…çš„æŠ€æœ¯ï¼Œä½†ç°åœ¨å·²ç»æ‰©å±•åˆ°å…¶ä»–é¢†åŸŸï¼Œå¦‚è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ã€æ€§èƒ½åˆ†æå’Œå®‰å…¨ç›‘æ§ç­‰ã€‚eBPF çš„ä¼˜åŠ¿åœ¨äºå…¶è½»é‡çº§ã€é«˜æ•ˆã€å®‰å…¨å’Œå¯ç¼–ç¨‹æ€§ã€‚å®ƒå¯ä»¥è¢«ç”¨äºå®æ—¶ç›‘æ§ã€ç½‘ç»œå®‰å…¨ã€åº”ç”¨ç¨‹åºè°ƒè¯•å’Œä¼˜åŒ–ã€å®¹å™¨ç½‘ç»œç­‰å¤šä¸ªé¢†åŸŸã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.18 ä¹‹å‰ï¼ŒAmbient æ¨¡å¼ä¸­ä½¿ç”¨ iptables å’Œ Geneve éš§é“å°†åº”ç”¨ç¨‹åºæµé‡é€æ˜åŠ«æŒåˆ° ztunnel ä¸­ã€‚åœ¨ Istio 1.18 ä¸­ï¼Œå¢åŠ äº† eBPF é€‰é¡¹ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ iptables æˆ– eBPF æ¥åšæµé‡åŠ«æŒã€‚å¦‚å›¾ 3 æ‰€ç¤ºï¼ŒeBPF ç¨‹åºç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºå†…æ ¸ï¼Œå°†åº”ç”¨ç¨‹åºçš„æµé‡è½¬å‘åˆ° ztunnel ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/ebpf.svg&#34; data-img=&#34;/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/ebpf.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 3ï¼šä½¿ç”¨ eBPF åŠ«æŒåº”ç”¨ç¨‹åºçš„æµé‡&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯¹æ¯”é¡¹&lt;/th&gt;
&lt;th&gt;eBPF æ–¹å¼&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ iptables å’Œ Geneve éš§é“&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•ˆç‡&lt;/td&gt;
&lt;td&gt;æ›´é«˜&lt;/td&gt;
&lt;td&gt;ç•¥ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¼å®¹æ€§&lt;/td&gt;
&lt;td&gt;éœ€è¦è¾ƒé«˜çš„ Linux å†…æ ¸ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;æ›´å¥½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®ç°éš¾åº¦&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;è¾ƒä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰©å±•æ€§&lt;/td&gt;
&lt;td&gt;è¾ƒå¥½&lt;/td&gt;
&lt;td&gt;è¾ƒå·®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&#34;https://istio.io/latest/blog/2023/ambient-ebpf-redirection/&#34; title=&#34;Istio å®˜æ–¹åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹åšå®¢&lt;/a&gt;
ä»‹ç»ï¼Œä½¿ç”¨ eBPF æ–¹å¼é¿å…äº†éƒ¨åˆ† iptables è§„åˆ™å’Œéš§é“å°è£…ï¼Œç›¸æ¯”ä½¿ç”¨ iptables å’Œ Geneve éš§é“æ›´åŠ é«˜æ•ˆã€‚ç„¶è€Œï¼ŒeBPF å¯¹ Linux å†…æ ¸ç‰ˆæœ¬çš„è¦æ±‚æ›´é«˜ï¼ˆè‡³å°‘ 4.20ï¼‰ï¼Œè€Œ iptables æ–¹å¼åˆ™å…·æœ‰æ›´å¥½çš„å…¼å®¹æ€§ã€‚æ­¤å¤–ï¼ŒeBPF æ–¹å¼çš„å®ç°éš¾åº¦è¾ƒé«˜ï¼Œä½†æ‰©å±•æ€§è¾ƒå¥½ã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³ä½¿ç”¨ eBPF æ¨¡å¼è¿è¡Œ Ambient Meshï¼Œåªéœ€è¦åœ¨å®‰è£… Istio æ—¶è®¾ç½® &lt;code&gt;values.cni.ambient.redirectMode&lt;/code&gt; å‚æ•°å³å¯ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ambient --set values.cni.ambient.redirectMode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ebpf&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Geneve éš§é“åè®®çš„å·¥ä½œåŸç†ã€å®‰å…¨æ€§å’Œä¸ VXLAN çš„æ¯”è¾ƒã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº† Istio Ambient Mesh å¦‚ä½•ä½¿ç”¨ Geneve éš§é“å®ç°æµé‡æ‹¦æˆªï¼Œå¹¶è®¨è®ºäº†ä½¿ç”¨ eBPF è¿›è¡Œé€æ˜æµé‡åŠ«æŒçš„ä¼˜ç¼ºç‚¹ã€‚Geneve éš§é“åè®®æ˜¯ä¸€ç§é€šç”¨çš„éš§é“åè®®ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿç½‘ç»œä¸­ä¼ è¾“æ•°æ®åŒ…ï¼Œå…·æœ‰æ›´å¤šçš„ä¼˜åŠ¿ï¼Œå› æ­¤åœ¨é€‰æ‹©éš§é“åè®®æ—¶ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨ Geneve éš§é“ã€‚åœ¨ Istio 1.18 ä¸­æ–°æ¨å‡ºäº† Ambient Mesh çš„çš„ eBPF æ¨¡å¼ï¼Œå¯ä»¥æä¾›ç½‘ç»œæ•ˆç‡ï¼Œä½†å¯¹ Linux å†…æ ¸ç‰ˆæœ¬æœ‰æ›´é«˜è¦æ±‚ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc7348&#34; title=&#34;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.rfc-editor.org/rfc/rfc8926#name-geneve-packet-format-over-i&#34; title=&#34;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 8926 Geneve: Generic Network Virtualization Encapsulation&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/architecture/#istio-ambient-mesh&#34; title=&#34;Istio Ambient Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Ambient Mesh&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mankier.com/8/ovs-vswitchd.conf.db%285%29&#34; title=&#34;Open vSwitch Geneve(8) man page&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open vSwitch Geneve(8) man page&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>å…³äº TSB ä½ åº”è¯¥çŸ¥é“çš„äº‹æƒ…</title>
      <link>https://jimmysong.io/blog/tsb-tips/</link>
      <pubDate>Wed, 22 Feb 2023 17:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/tsb-tips/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡å‡è®¾ä½ ç†Ÿæ‚‰æœåŠ¡ç½‘æ ¼å’Œ Istioï¼Œå¯¹ Tetrate å‡ºå“çš„å•†ä¸šåŒ–æœåŠ¡ç½‘æ ¼ç®¡ç†å·¥å…· Tetrate Service Bridge æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å¯ä»¥è§£ç­”ä½ å¿ƒä¸­çš„ä¸€äº›å›°æƒ‘ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸­åŒ…å«äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…³äº TSB çš„ä¸€äº› FAQ&lt;/li&gt;
&lt;li&gt;TSB çš„ä¸€äº›åŸºæœ¬èµ„æºå¯¹è±¡&lt;/li&gt;
&lt;li&gt;TSB å®ç°çš„ä¸€äº›ç»†èŠ‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;tsb-faq&#34;&gt;TSB FAQ&lt;/h2&gt;
&lt;p&gt;ç¬”è€…å°†ç½—åˆ—ä¸€äº›å…³äº TSB çš„çŸ¥è¯†ç‚¹ï¼Œä¸»è¦æ˜¯å…³äºå®ƒä¸ Istio ä¹‹é—´çš„ä¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;TSB å…¨ç§° Tetrate Service Bridgeï¼Œæ˜¯ Tetrate å…¬å¸çš„æ——èˆ°äº§å“ï¼Œé¦–å‘äº 2018 å¹´ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯ 1.7ï¼Œè¿™æ˜¯ä¸€æ¬¾å•†ä¸šåŒ–äº§å“ï¼Œä½ éœ€è¦è´­ä¹°æ‰èƒ½ä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦äº†è§£æ›´å¤šæˆ–è¯·æ±‚è¯•ç”¨è¯·åœ¨&lt;a href=&#34;https://tetrate.io/tetrate-service-bridge/&#34; title=&#34;è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;
ç™»è®°ï¼›&lt;/li&gt;
&lt;li&gt;TSB å¯ä»¥ç§æœ‰åŒ–éƒ¨ç½²ä¹Ÿå¯ä»¥åœ¨ GKEã€AWSã€Azureã€OpenShiftã€EKS Anywhere ç­‰å¹³å°ä¸­å•ç‹¬æˆ–è·¨å¹³å°éƒ¨ç½²ï¼›&lt;/li&gt;
&lt;li&gt;TSB å¹¶ä¸æ˜¯å¯¹ Istio çš„æ”¹è¿›ç‰ˆï¼Œå®ƒæ˜¯åœ¨ Istio ä¹‹ä¸Šå»ºç«‹çš„ç®¡ç†å¹³é¢ï¼Œå®ƒå¯ä»¥ä¸ Istio å®Œå…¨å…¼å®¹ï¼Œå¹¶é€‚é…æœ€æ–°ç‰ˆçš„ Istioï¼›&lt;/li&gt;
&lt;li&gt;TSB å¹¶ä¸æ˜¯ Kubernetes ç®¡ç†å¹³å°ï¼Œå®ƒä¸èƒ½ç”¨äºç®¡ç† Kubernetes ä¸­çš„èµ„æºï¼›&lt;/li&gt;
&lt;li&gt;TSB æ˜¯åŸºäº Istioã€Envoy å’Œ Apache SkyWalking æ„å»ºï¼›&lt;/li&gt;
&lt;li&gt;TSB é€šè¿‡å®šä¹‰ Tenantã€Workspace ç­‰èµ„æºå¯¹è±¡ä¸º Istio å¢åŠ äº†å¤šç§Ÿæˆ·å’Œå¤šé›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†å®ç°å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼çš„ç®¡ç†ï¼ŒTSB ä¸­å®šä¹‰äº†ä¸€ç³»åˆ— Group èµ„æºï¼Œå¦‚ Trafficã€Securityã€Gateway ç­‰ï¼Œè¿™äº› CRD æœ€ç»ˆå°†è½¬åŒ–ä¸º Istio ä¸­çš„ CRD åº”ç”¨åˆ°æœåŠ¡ç½‘æ ¼ï¼›&lt;/li&gt;
&lt;li&gt;TSB å®šä¹‰äº† Tier1Gateway CRD å®ç°äº†è·¨é›†ç¾¤çš„äºŒå±‚ç½‘å…³ï¼›&lt;/li&gt;
&lt;li&gt;TSB éƒ¨ç½²å’Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼ŒTetrate å³å°†æ¨å‡ºè½»é‡çº§çš„ Tetrate Service Expressï¼ˆTSEï¼‰ç®€åŒ–æœåŠ¡ç½‘æ ¼ç®¡ç†ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;tsb-resources&#34;&gt;TSB ä¸­çš„èµ„æºå¯¹è±¡&lt;/h2&gt;
&lt;p&gt;å›¾ 1 å±•ç¤ºäº† TSB çš„åŸºæœ¬èµ„æºå¯¹è±¡ï¼Œå…¶ä¸­åªè¦åˆ†ä¸ºäº”å¤§ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºäº†å®ç°å¤šç§Ÿæˆ·å’Œå¤šé›†ç¾¤ç®¡ç†çš„èµ„æºå¯¹è±¡ï¼Œå¦‚ Tenantã€Organizationã€Workspace ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸»è¦åŠŸèƒ½å¯¹è±¡é…ç½®ç»„ï¼Œå¦‚ Trafficã€Securityã€Gateway ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;Istio åŸç”Ÿ CRDï¼›&lt;/li&gt;
&lt;li&gt;è§’è‰²å’Œæƒé™ç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;å…¶ä»–æ‰©å±•ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/tsb-tips/tsb-crd.svg&#34; data-img=&#34;/blog/tsb-tips/tsb-crd.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šTetrate Service Bridge ä¸­çš„èµ„æºå¯¹è±¡&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 1ï¼šTetrate Service Bridge ä¸­çš„èµ„æºå¯¹è±¡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;TSB æ˜¯å»ºç«‹åœ¨ Istio ä¹‹ä¸Šçš„ï¼Œä¸‹è¡¨ä¸­åˆ—å‡ºäº† TSB ä¸­çš„å¯ä»¥é€šè¿‡ tctl å‘½ä»¤è·å–çš„èµ„æºå¯¹è±¡ï¼Œå…¶ä¸­éƒ¨åˆ†åç§°ä¸ Kubernetes ä¸­åŸç”Ÿèµ„æºå¯¹è±¡é‡å¤ï¼Œä½†å®ƒä»¬å¹¶ä¸ç›¸åŒï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ApplicationAccessBindings&lt;/td&gt;
&lt;td&gt;é…ç½®åº”ç”¨ç¨‹åºç”¨æˆ·è®¿é—®æƒé™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AccessBindings&lt;/td&gt;
&lt;td&gt;ä¸º TSB ä¸­ä»»ä½•èµ„æºçš„ç”¨æˆ·åˆ†é…è®¿é—®è§’è‰²çš„é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AuthorizationPolicy&lt;/td&gt;
&lt;td&gt;åŒ Istio ä¸­çš„æˆæƒç­–ç•¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;APIAccessBindings&lt;/td&gt;
&lt;td&gt;é…ç½® API ç”¨æˆ·è®¿é—®æƒé™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Application&lt;/td&gt;
&lt;td&gt;åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œåº”ç”¨ç¨‹åºè¡¨ç¤ºä¸€ç»„ç›¸äº’å…³è”çš„æœåŠ¡é€»è¾‘åˆ†ç»„ï¼Œå¹¶å…¬å¼€ä¸€ç»„å®ç°å®Œæ•´ä¸šåŠ¡é€»è¾‘çš„ APIã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Cluster&lt;/td&gt;
&lt;td&gt;Kubernetes é›†ç¾¤ã€‚è¦æƒ³å°† Kubernetes é›†ç¾¤çº³å…¥ TSB ç®¡ç†ï¼Œé¦–å…ˆéœ€è¦å£°æ˜ Cluster æ·»åŠ ï¼Œç„¶åæ˜¯éƒ¨ç½² TSB Agent å’Œæ§åˆ¶å¹³é¢ï¼ˆåŒ…æ‹¬ Istioã€XCPã€GitOpsã€OAP ç­‰ç»„ä»¶ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DestinationRule&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œä¸»è¦ç”¨æ¥åˆ’åˆ†å¯è·¯ç”±çš„é›†ç¾¤åŠè´Ÿè½½å‡è¡¡è§„åˆ™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EnvoyFilter&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œä¸»è¦ç”¨æ¥æ‰©å±• Envoy çš„åŠŸèƒ½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EgressGateway&lt;/td&gt;
&lt;td&gt;é…ç½®å·¥ä½œè´Ÿè½½ä½œä¸ºå‡ºå£ç½‘å…³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GatewayAccessBindings&lt;/td&gt;
&lt;td&gt;é…ç½®ç½‘å…³ç»„ç”¨æˆ·è®¿é—®æƒé™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GatewayGroup&lt;/td&gt;
&lt;td&gt;ç½‘å…³ç»„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Gateway&lt;/td&gt;
&lt;td&gt;ç®¡ç† TSB ä¸­è®¾ç½®çš„ç½‘å…³ï¼Œè€Œé Istio ä¸­çš„åŸç”Ÿ Gateway CRDã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IstioInternalAccessBindings&lt;/td&gt;
&lt;td&gt;ä¸º Istio å†…éƒ¨ç»„çš„ç”¨æˆ·åˆ†é…è®¿é—®è§’è‰²çš„é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IngressGateway&lt;/td&gt;
&lt;td&gt;é…ç½®è´Ÿè½½ä½œä¸ºå…¥å£ç½‘å…³ï¼Œç±»ä¼¼äº Istio ä¸­çš„åŸç”Ÿ Gatewayã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IstioInternalGroup&lt;/td&gt;
&lt;td&gt;é…ç½® Istio å†…éƒ¨çš„ TSB èµ„æºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OrganizationAccessBindings&lt;/td&gt;
&lt;td&gt;é…ç½®ç»„ç»‡ç”¨æˆ·è®¿é—®æƒé™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Organization&lt;/td&gt;
&lt;td&gt;ç»„ç»‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OrganizationSetting&lt;/td&gt;
&lt;td&gt;ç»„ç»‡çš„é»˜è®¤é…ç½®ï¼Œå¦‚åŒºåŸŸ Failoverã€å®‰å…¨ã€æµé‡ã€ç½‘ç»œé…ç½®ç­‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Metric&lt;/td&gt;
&lt;td&gt;è¿è¡Œæ—¶è·å–çš„æœåŠ¡åº¦é‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Source&lt;/td&gt;
&lt;td&gt;Sources æœåŠ¡å…¬å¼€äº†ç®¡ç†æ¥è‡ªèµ„æºçš„é¥æµ‹æºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PeerAuthentication&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œé…ç½®å¯¹ç­‰è®¤è¯ï¼ˆé…ç½® mTLSï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RequestAuthentication&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œé…ç½®è¯·æ±‚è®¤è¯ï¼ˆJWT è§„åˆ™é…ç½®ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ServiceAccount&lt;/td&gt;
&lt;td&gt;ä¸åŒäº Kubernetes ä¸­çš„åŸç”Ÿèµ„æºå¯¹è±¡ï¼ŒTSB è‡ªå®šä¹‰çš„æœåŠ¡è´¦å·é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SecurityAccessBindings&lt;/td&gt;
&lt;td&gt;é…ç½®å®‰å…¨ç»„ç”¨æˆ·è®¿é—®æƒé™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Sidecar&lt;/td&gt;
&lt;td&gt;é…ç½®é¢„å®‰è£…çš„ Istio Sidecarã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ServiceEntry&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œæ·»åŠ æœåŠ¡å¯¹è±¡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SecurityGroup&lt;/td&gt;
&lt;td&gt;å®‰å…¨é…ç½®ç»„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ServiceRoute&lt;/td&gt;
&lt;td&gt;é…ç½®æœåŠ¡è·¯ç”±ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SecuritySetting&lt;/td&gt;
&lt;td&gt;å®‰å…¨è®¾ç½®å°†é…ç½®åº”ç”¨äº SecurityGroup æˆ– Workspace ä¸­çš„ä¸€ç»„ä»£ç†å·¥ä½œè´Ÿè½½ã€‚å½“åº”ç”¨äº SecurityGroup æ—¶ï¼Œç¼ºå¤±çš„å­—æ®µå°†ä» Workspace èŒƒå›´è®¾ç½®ç»§æ‰¿å€¼ (å¦‚æœæœ‰çš„è¯)ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ServiceSecuritySetting&lt;/td&gt;
&lt;td&gt;å®‰å…¨ç»„é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;æ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡ï¼Œè¡¨ç¤ºæ‰€æœ‰è¿™äº›å•ç‹¬æœåŠ¡çš„èšåˆå’Œé€»è¾‘è§†å›¾ï¼Œå¹¶æä¾›èšåˆæŒ‡æ ‡ç­‰é«˜çº§åŠŸèƒ½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tier1Gateway&lt;/td&gt;
&lt;td&gt;TSB ä¸€çº§ç½‘å…³é…ç½®ï¼ŒæŒ‡å®šç½‘å…³è´Ÿè½½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TrafficAccessBindings&lt;/td&gt;
&lt;td&gt;æµé‡è®¿é—®è§’è‰²é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TrafficGroup&lt;/td&gt;
&lt;td&gt;æµé‡ç®¡ç†ç»„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TenantAccessBindings&lt;/td&gt;
&lt;td&gt;ç§Ÿæˆ·è§’è‰²é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TenantSetting&lt;/td&gt;
&lt;td&gt;ç§Ÿæˆ·é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TrafficSetting&lt;/td&gt;
&lt;td&gt;æµé‡é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;VirtualService&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œé…ç½®æµé‡è·¯ç”±ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WorkspaceAccessBindings&lt;/td&gt;
&lt;td&gt;Workspace è§’è‰²é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WasmExtension&lt;/td&gt;
&lt;td&gt;é…ç½®ç®¡ç† Wasm æ‰©å±•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WasmPlugin&lt;/td&gt;
&lt;td&gt;Istio åŸç”Ÿ CRDï¼Œé…ç½® Wasm æ’ä»¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Workspace&lt;/td&gt;
&lt;td&gt;åˆ’å®šå·¥ä½œç©ºé—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WorkspaceSetting&lt;/td&gt;
&lt;td&gt;é…ç½®å·¥ä½œç©ºé—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ tctl å‘½ä»¤è¡Œå·¥å…·æ¥ç®¡ç† TSBï¼Œå®ƒçš„ä½¿ç”¨æ–¹æ³•ä¸ kubectl ç±»ä¼¼ï¼Œä¸Šé¢çš„åˆ—è¡¨æ˜¯ä½¿ç”¨ &lt;code&gt;tctl get&lt;/code&gt; å‘½ä»¤å¯ä»¥åˆ—å‡ºçš„èµ„æºå¯¹è±¡ã€‚å®é™…ä¸Š TSB ä¸­çš„èµ„æºå¯¹è±¡ä¸æ­¢è¿™äº›ï¼Œå…³äº TSB ä¸­ API èµ„æºçš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ &lt;a href=&#34;https://docs.tetrate.io/service-bridge/1.6.x/en-us/reference&#34; title=&#34;TSB æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tsb-arch&#34;&gt;TSB æ¶æ„&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼ŒTSB æ˜¯åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„ç®¡ç†å¹³é¢ï¼Œä¸º Istio å¢åŠ äº†å¤šç§Ÿæˆ·å’Œå¤šé›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼ŒTSB çš„ç»„ä»¶æ¶æ„åŠå…¶åŠŸèƒ½å¦‚å›¾ 2 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/tsb-tips/tsb-arch.svg&#34; data-img=&#34;/blog/tsb-tips/tsb-arch.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 2ï¼šTSB ç»„ä»¶æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 2ï¼šTSB ç»„ä»¶æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;TSB çš„å…¨å±€æ§åˆ¶å¹³é¢å¯ä»¥å’Œç®¡ç†å¹³é¢éƒ¨ç½²åœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å•ç‹¬éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;TSB ç®¡ç†å¹³é¢çš„æ¶æ„å¦‚å›¾ 3 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/tsb-tips/tsb-management-plane.svg&#34; data-img=&#34;/blog/tsb-tips/tsb-management-plane.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 3ï¼šTSB ç®¡ç†å¹³é¢æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 3ï¼šTSB ç®¡ç†å¹³é¢æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®¡ç†å¹³é¢ä¸å„ä¸ª Kubernetes é›†ç¾¤ä¸­çš„ Istio è”ç³»ï¼Œç®¡ç†å¤šé›†ç¾¤ç¯å¢ƒä¸‹çš„æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;TSB æ§åˆ¶å¹³é¢çš„æ¶æ„å¦‚å›¾ 4 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/tsb-tips/tsb-control-plane.svg&#34; data-img=&#34;/blog/tsb-tips/tsb-control-plane.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 4ï¼šTSB æ§åˆ¶å¹³é¢æ¶æ„&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 4ï¼šTSB æ§åˆ¶å¹³é¢æ¶æ„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°è·¨é›†ç¾¤çš„å¤šç§Ÿæˆ·ç®¡ç†ï¼ŒTSB å®šä¹‰äº†ä¸€ç³»åˆ—é€»è¾‘å¯¹è±¡ï¼Œå¦‚å›¾ 5 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/tsb-tips/tsb-resource-hierarchy.svg&#34; data-img=&#34;/blog/tsb-tips/tsb-resource-hierarchy.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 5ï¼šTSB ä¸­çš„å¤šç§Ÿæˆ·ç®¡ç†å±‚çº§&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 5ï¼šTSB ä¸­çš„å¤šç§Ÿæˆ·ç®¡ç†å±‚çº§&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;more&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰æœåŠ¡ç½‘æ ¼å’Œ Kubernetes å®‰å…¨æ€§ï¼Œæˆ‘ä»¬åœ¨ &lt;a href=&#34;https://tetr8.io/academy&#34; title=&#34;Tetrate Academy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Academy&lt;/a&gt;
 æä¾›äº†ä¸€ç³»åˆ—å…è´¹åœ¨çº¿è¯¾ç¨‹ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿäº†è§£ Istio å’Œ Envoyã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ç§å¿«é€Ÿå°† Istio æŠ•å…¥ç”Ÿäº§çš„æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://tetr8.io/tid&#34; title=&#34;Tetrate Istio Distribution (TID)&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distribution (TID)&lt;/a&gt;
ã€‚TID æ˜¯ Tetrate çš„å¼ºåŒ–ã€å®Œå…¨ä¸Šæ¸¸çš„ Istio å‘è¡Œç‰ˆï¼Œå…·æœ‰ç»è¿‡ FIPS éªŒè¯çš„æ„å»ºå’Œæ”¯æŒã€‚è¿™æ˜¯å¼€å§‹ä½¿ç”¨ Istio çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºæ‚¨çŸ¥é“æ‚¨æœ‰ä¸€ä¸ªå€¼å¾—ä¿¡èµ–çš„å‘è¡Œç‰ˆï¼Œæœ‰ä¸€ä¸ªæ”¯æŒæ‚¨çš„ä¸“å®¶å›¢é˜Ÿï¼Œå¹¶ä¸”å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥é€‰æ‹©å¿«é€Ÿè·å¾— FIPS åˆè§„æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å¯åŠ¨å¹¶è¿è¡Œ Istioï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´ç®€å•çš„æ–¹æ³•æ¥ç®¡ç†å’Œä¿æŠ¤æ‚¨çš„æœåŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ Istio ä¸­å¯ç”¨çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯ Tetrate Service Bridge çš„ç”¨æ­¦ä¹‹åœ°ã€‚æ‚¨å¯ä»¥&lt;a href=&#34;https://tetr8.io/tsb&#34; title=&#34;åœ¨è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è¿™é‡Œ&lt;/a&gt;
è¯¦ç»†äº†è§£ Tetrate Service Bridge å¦‚ä½•ä½¿æœåŠ¡ç½‘æ ¼æ›´å®‰å…¨ã€æ›´æ˜“äºç®¡ç†å’Œå¼¹æ€§ï¼Œæˆ–&lt;a href=&#34;https://tetr8.io/contact&#34; title=&#34;è”ç³»æˆ‘ä»¬è¿›è¡Œå¿«é€Ÿæ¼”ç¤º&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”ç³»æˆ‘ä»¬è¿›è¡Œå¿«é€Ÿæ¼”ç¤º&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;refrence&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://tetrate.io/tetrate-service-bridge/&#34; title=&#34;TSB ç®€ä»‹ - tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB ç®€ä»‹ - tetrate.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.tetrate.io/service-bridge/&#34; title=&#34;TSB æ–‡æ¡£ - docs.tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB æ–‡æ¡£ - docs.tetrate.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.tetrate.io/service-bridge/1.6.x/en-us/reference&#34; title=&#34;TSB API å‚è€ƒ - docs.tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB API å‚è€ƒ - docs.tetrate.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio Gateway ä¸­å¯¹è¯ä¹¦æ’¤é”€çš„æ”¯æŒ</title>
      <link>https://jimmysong.io/blog/ocsp-stapling-for-istio-gateways/</link>
      <pubDate>Mon, 06 Feb 2023 16:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/ocsp-stapling-for-istio-gateways/</guid>
      <description>
        
        
        &lt;p&gt;æœ€è¿‘ Istio ç¤¾åŒºæ­£åœ¨å¤„ç† &lt;a href=&#34;https://github.com/istio/istio/issues/17763&#34; title=&#34;Issue 17763&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Issue 17763&lt;/a&gt;
ï¼Œä»¥å¢åŠ  Istio å¯¹è¯ä¹¦æ’¤é”€çš„æ”¯æŒï¼Œç›®å‰è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘å·¥ç¨‹ä¸­ï¼Œè§ &lt;a href=&#34;https://github.com/istio/istio/pull/42859&#34; title=&#34;PR #42859 - OSCP Stapling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR #42859 - OSCP Stapling&lt;/a&gt;
 å’Œ &lt;a href=&#34;https://docs.google.com/document/d/15wwYyVyOluubL2KIM89b2X8NFwyhMVxq2_I1MESrZdI/edit#&#34; title=&#34;OCSP Stapling for Istio Gateways&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OCSP Stapling for Istio Gateways&lt;/a&gt;
ã€‚è¿™ç¯‡åšå®¢å°†å‘ä½ ä»‹ç»è¯ä¹¦æ’¤é”€çš„æ–¹å¼å’Œ Istio çš„è§£å†³æ–¹æ¡ˆè¿›å±•ã€‚&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨ Envoy SDS åˆ†å‘è¯ä¹¦ï¼Œä¸€å…±æœ‰ä¸¤ç§æƒ…å½¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†å‘å†…éƒ¨è¯ä¹¦ï¼Œç”¨äº mTLSï¼Œè¿™ç§æƒ…å†µéœ€è¦åˆ†åˆ«éªŒè¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯å¦è¢«æ’¤é”€&lt;/li&gt;
&lt;li&gt;åˆ†å‘å¤–éƒ¨æœåŠ¡çš„è¯ä¹¦ç»™é›†ç¾¤å†…çš„æœåŠ¡ï¼Œç”¨äºå‘é›†ç¾¤å¤–çš„é€šä¿¡åŠ å¯†ï¼Œæ­¤æ—¶é›†ç¾¤å†…çš„æœåŠ¡ç›¸å½“äºå®¢æˆ·ç«¯ï¼Œä»…éœ€éªŒè¯æœåŠ¡ç«¯è¯ä¹¦æ˜¯å¦è¢«æ’¤é”€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡æ¢è®¨çš„æ˜¯ç¬¬äºŒç§æƒ…å½¢ï¼Œå³ Istio Gateway çš„è¯ä¹¦æ’¤é”€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/ocsp-stapling-for-istio-gateways/cert-revoke.svg&#34; data-img=&#34;/blog/ocsp-stapling-for-istio-gateways/cert-revoke.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio Gateway çš„è¯ä¹¦æ’¤é”€ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio Gateway çš„è¯ä¹¦æ’¤é”€ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;CA é€šè¿‡è®¾ç½® TTL æ§åˆ¶è¯ä¹¦çš„å¯¿å‘½ï¼Œå¦‚æœè¦æå‰ç»“æŸè¯ä¹¦å¯ä»¥å°†è¯ä¹¦æ’¤é”€ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ’¤é”€è¯ä¹¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é…ç½®è¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼ˆCRLï¼‰&lt;/li&gt;
&lt;li&gt;åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;crlè¯ä¹¦æ’¤é”€åˆ—è¡¨&#34;&gt;CRLï¼ˆè¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼‰&lt;/h2&gt;
&lt;p&gt;CRLï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰æ˜¯ä¸€ç§ç”¨äºç®¡ç†å’ŒéªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§çš„æœºåˆ¶ã€‚å®ƒåŒ…å«ä¸€ä¸ªå·²è¢«æ’¤é”€çš„è¯ä¹¦åˆ—è¡¨ï¼Œé¢å‘æœºæ„ï¼ˆCAï¼‰å®šæœŸæ›´æ–°è¯¥åˆ—è¡¨ã€‚å½“éªŒè¯è¯ä¹¦çš„å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰æ”¶åˆ°è¯ä¹¦æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è¯¥è¯ä¹¦æ˜¯å¦åœ¨ CRL ä¸­è¢«åˆ—ä¸ºå·²æ’¤é”€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¯¥è¯ä¹¦è¢«è§†ä¸ºæ— æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;CRL é€šå¸¸å­˜å‚¨åœ¨é¢å‘æœºæ„ï¼ˆCAï¼‰çš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶å¯ä»¥é€šè¿‡äº’è”ç½‘å…¬å¼€è®¿é—®ã€‚éªŒè¯è¯ä¹¦çš„å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼Œæµè§ˆå™¨ï¼‰å¯ä»¥ä¸‹è½½å¹¶æ£€æŸ¥ CRL ä»¥ç¡®å®šè¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€‚CRL å¯ä»¥ä»¥å¤šç§æ ¼å¼ï¼ˆå¦‚ DER æˆ– PEMï¼‰å­˜å‚¨ï¼Œå¹¶é€šè¿‡ HTTPï¼ŒLDAP æˆ–å…¶ä»–åè®®å‘å¸ƒï¼Œä»¥ä¾¿è¿›è¡ŒéªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;CRL æ–‡ä»¶é€šå¸¸æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨çš„ï¼Œä¸æ˜¯ç›´æ¥å¯è¯»çš„æ–‡æœ¬æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·ï¼ˆä¾‹å¦‚ OpenSSLï¼‰è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼ï¼Œä¾‹å¦‚ PEMï¼Œä»¥æ–¹ä¾¿é˜…è¯»ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåä¸º &lt;code&gt;crl.pem&lt;/code&gt; çš„ CRL ç¤ºä¾‹æ–‡ä»¶ï¼Œä»¥ PEM æ ¼å¼è¡¨ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----BEGIN X509 CRL-----&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;MIIBtjCBqwIBATANBgkqhkiG9w0BAQUFADBBMQswCQYDVQQGEwJVUzERMA8GA1UE&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;CBMITmV3IFlvcmsxETAPBgNVBAcTCE5ldyBZb3JrMREwDwYDVQQKEwhNeSBDQTEQ&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;MA4GA1UECxMHQ2VydGlmaWNhdGUxGDAWBgNVBAMTD01ZIEJ1c2luZXNzIENBMB4X&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;DTA5MDUwMzE1MTQwMFoXDTEwMDUwMjE1MTQwMFqgLzAtMB8GA1UdIwQYMBaAFJ4f&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;6Nz7Vuw/NcZXG0U8O6OZ9XB0MAsGA1UdDwQEAwIFoDAdBgNVHQ4EFgQUU6G9fjRK&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;op+JU6vQPnnhxBxHtzUwDQYJKoZIhvcNAQEFBQADgYEAbYoLz7MnJ4ltIS+nCquG&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;N/v+8rE00/N0pGzN/dCv/8t0W0tGTGr2zGRb0mv67MPOmWmHcZZq3sOxgEIp8T+O&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;OJxDCD/xJN6hB0NgN/Z0+fX9hU6bL/6zhwUy/l51xddmSd5KKhJ7FmOh2Py5m9Au&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;4fJh7w+OLyjKV7rz55WKjvY&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;-----END X509 CRL-----&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ OpenSSL å°†å…¶è½¬æ¢ä¸ºå¯è¯»æ ¼å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl crl -inform PEM -in crl.pem -noout -text
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¾“å‡ºç»“æœä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Certificate Revocation List (CRL):
        Version 2 (0x1)
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: /C=US/ST=New York/L=New York/O=My CA/OU=Certificate/CN=My Business CA
        Last Update: May 3 11:40:00 2009 GMT
        Next Update: May 2 11:40:00 2010 GMT
    Revoked Certificates:
        Serial Number: 1 (0x1)
            Revocation Date: May 3 11:40:00 2009 GMT
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¯¥ CRL æ–‡ä»¶çš„åˆ—è¡¨ä¸­åªä¿å­˜äº†ä¸€ä¸ªæ’¤é”€è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;CRL è™½è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†ä½¿ç”¨ CRL æ–‡ä»¶æ¥æ’¤é”€è¯ä¹¦å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ—¶æ•ˆæ€§&lt;/strong&gt;ï¼šCRL æ–‡ä»¶å¿…é¡»å®šæœŸæ›´æ–°ï¼Œå¦åˆ™å°†æ— æ³•è¯†åˆ«è¿‘æœŸæ’¤é”€çš„è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨æ€§&lt;/strong&gt;ï¼šå¦‚æœæ— æ³•è®¿é—® CRL æœåŠ¡å™¨ï¼Œåˆ™æ— æ³•éªŒè¯è¯ä¹¦æ˜¯å¦å·²è¢«æ’¤é”€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆç‡&lt;/strong&gt;ï¼šCRL æ–‡ä»¶éšç€è¯ä¹¦æ•°é‡çš„å¢åŠ è€Œå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤éªŒè¯è¯ä¹¦çš„è¿‡ç¨‹å¯èƒ½ä¼šå˜æ…¢ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼šCRL æ–‡ä»¶æœ¬èº«ä¹Ÿéœ€è¦å®‰å…¨ä¿æŠ¤ï¼Œå¦åˆ™æ”»å‡»è€…å¯èƒ½ä¼šç¯¡æ”¹ CRL ä»¥é€ƒé¿æ’¤é”€è¯ä¹¦çš„é™åˆ¶ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› æ­¤ï¼Œç°åœ¨æœ‰æ›´é«˜æ•ˆå’Œå®‰å…¨çš„è¯ä¹¦æ’¤é”€æœºåˆ¶ï¼Œä¾‹å¦‚ OCSPï¼ˆOnline Certificate Status Protocolï¼‰ï¼Œå®ƒå¯ä»¥å®æ—¶éªŒè¯è¯ä¹¦çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¸éœ€è¦å­˜å‚¨æ‰€æœ‰å·²æ’¤é”€è¯ä¹¦çš„åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ocsp-stapling&#34;&gt;OCSP Stapling&lt;/h2&gt;
&lt;p&gt;OCSP Staplingï¼ˆæ­£å¼åç§°ä¸º TLS è¯ä¹¦çŠ¶æ€æŸ¥è¯¢æ‰©å±•ï¼‰æ˜¯ä¸€ç§ TLSï¼ˆTransport Layer Securityï¼‰æ‰©å±•ï¼Œç”¨äºè¯æ˜è¯ä¹¦çš„çŠ¶æ€æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒå…è®¸æœåŠ¡å™¨é¢„å…ˆæ£€ç´¢è¯ä¹¦çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†è¯¥ä¿¡æ¯â€œé’‰â€åˆ° TLS è¯ä¹¦ä¸­ï¼Œä»¥å‡å°‘å¯¹è¯ä¹¦é¢å‘æœºæ„çš„ä¾èµ–ï¼Œå¹¶æé«˜è¯ä¹¦çŠ¶æ€éªŒè¯çš„æ•ˆç‡ã€‚å¯ä»£æ›¿ OCSP æ¥æŸ¥è¯¢ X.509 è¯ä¹¦çš„çŠ¶æ€ã€‚æœåŠ¡å™¨åœ¨ TLS æ¡æ‰‹æ—¶å‘é€äº‹å…ˆç¼“å­˜çš„ OCSP å“åº”ï¼Œç”¨æˆ·åªéœ€éªŒè¯è¯¥å“åº”çš„æœ‰æ•ˆæ€§è€Œä¸ç”¨å†å‘æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼‰å‘é€è¯·æ±‚ã€‚è¯¦è§&lt;a href=&#34;https://en.wikipedia.org/wiki/OCSP_stapling&#34; title=&#34;ç»´åŸºç™¾ç§‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»´åŸºç™¾ç§‘&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;OCSP åªé€‚ç”¨äºå•ä¸ªè¯ä¹¦ï¼Œè€Œä¸æ˜¯åˆ—è¡¨ã€‚å®¢æˆ·ç«¯åœ¨æ”¶åˆ°è¯ä¹¦åï¼Œä¸ CA é€šä¿¡ä»¥æ£€æŸ¥æ’¤é”€çŠ¶æ€ã€‚å“åº”å¯ä»¥æ˜¯ &amp;ldquo;good&amp;rdquo;ã€&amp;ldquo;revoked&amp;rdquo; æˆ– &amp;ldquo;unknown&amp;rdquo; ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ OSCP Stapling è™½ç„¶çœå»äº†ç»´æŠ¤ CRL çš„è´Ÿæ‹…ï¼Œä½†æ˜¯å®ƒä¾ç„¶æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¢å¤–çš„èµ„æºå¼€é”€&lt;/strong&gt;ï¼šCA æœåŠ¡å™¨éœ€è¦ä¸æ–­åœ°å“åº” OCSP è´¨è¯¢ä»¥ç¡®ä¿è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œè¿™å°†å¯¹æœåŠ¡å™¨çš„ CPU å’Œç½‘ç»œå¸¦å®½é€ æˆé¢å¤–çš„å¼€é”€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨æ€§é—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœ OCSP æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å®¢æˆ·ç«¯å°†æ— æ³•è·å¾—è¯ä¹¦çš„æœ‰æ•ˆæ€§ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨é—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœ OCSP å“åº”è¢«ç¯¡æ”¹æˆ–æœåŠ¡å™¨ä¸å®‰å…¨ï¼Œåˆ™è¯ä¹¦çš„æœ‰æ•ˆæ€§ä¿¡æ¯å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä»è€Œå½±å“å®‰å…¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§é—®é¢˜&lt;/strong&gt;ï¼šOCSP Stapling ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒçš„åŠŸèƒ½ï¼Œå› æ­¤å¯èƒ½éœ€è¦åœ¨æ—§æµè§ˆå™¨ä¸Šå®ç°é¢å¤–çš„å…¼å®¹æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;OCSP çš„æŒ‘æˆ˜æ˜¯ï¼Œå®ƒç»™ CA å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ï¼Œå› ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦ç‹¬ç«‹åœ°è·å¾—è¯ä¹¦çš„éªŒè¯ã€‚æ€»ä½“è€Œè¨€ï¼ŒOCSP Stapling å¯ä»¥æé«˜è¯ä¹¦éªŒè¯çš„æ•ˆç‡å’Œå®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨é‡‡ç”¨è¯¥æŠ€æœ¯æ—¶éœ€è¦ç»¼åˆè€ƒè™‘å¤šæ–¹é¢çš„å› ç´ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å¯¹-oscp-stapling-æ”¯æŒ&#34;&gt;Istio å¯¹ OSCP Stapling æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;å¾ˆå¤š Web æœåŠ¡å™¨éƒ½æ”¯æŒ OSCP Staplingï¼Œäº‘åŸç”Ÿè¾¹ç¼˜ä»£ç† Envoy ä¹Ÿæ”¯æŒè¯¥åŠŸèƒ½ï¼Œéœ€è¦å¯¹ Envoy è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½® &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/tls.proto#envoy-v3-api-msg-extensions-transport-sockets-tls-v3-downstreamtlscontext&#34; title=&#34;&amp;lt;code&amp;gt;DownstreamTlsContext&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;DownstreamTlsContext&lt;/code&gt;&lt;/a&gt;
 ä¸­çš„ &lt;code&gt;oscp_staple_policy&lt;/code&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;LENIENT_STAPLING&lt;/code&gt;ï¼šOCSP å“åº”æ˜¯å¯é€‰çš„ï¼Œæ­¤ä¸ºé»˜è®¤å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;STRICT_STAPLING&lt;/code&gt;ï¼šOCSP å“åº”æ˜¯å¯é€‰çš„ï¼Œä½†å¦‚æœå­˜åœ¨å¹¶ä¸”æœ‰æ•ˆï¼Œå°±ä¼šä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MUST_STAPLE&lt;/code&gt;: OCSP å“åº”æ˜¯å¿…éœ€çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é…ç½® &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/common.proto#envoy-v3-api-msg-extensions-transport-sockets-tls-v3-tlscertificate&#34; title=&#34;&amp;lt;code&amp;gt;TlsCertificate&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;TlsCertificate&lt;/code&gt;&lt;/a&gt;
 ä¸­çš„ &lt;code&gt;oscp_staple&lt;/code&gt;ï¼Œå“åº”å¿…é¡»æ˜¯ DER ç¼–ç çš„ï¼Œåªèƒ½é€šè¿‡æ–‡ä»¶åæˆ– &lt;code&gt;inline_bytes&lt;/code&gt; æä¾›ã€‚å“åº”å¯èƒ½åªä¸ä¸€ä¸ªè¯ä¹¦æœ‰å…³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰ Envoy å·²æ”¯æŒ OSCP Staplingï¼Œå…¶ä½œä¸º Istio çš„æ•°æ®å¹³é¢å’Œ Istio Gateway ä¸­çš„ä»£ç†ï¼Œç†è®ºä¸Š Istio ä¹Ÿå¯ä»¥æ”¯æŒè¯¥åŠŸèƒ½ã€‚ä¸è¿‡ Istio çš„ OSCP Stapling è¯ä¹¦æ’¤é”€åŠŸèƒ½æ”¯æŒä»åœ¨è¿›è¡Œä¸­ï¼Œè¯¦è§ &lt;a href=&#34;https://github.com/istio/istio/pull/42859&#34; title=&#34;PR #42859 - OSCP Stapling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR #42859 - OSCP Stapling&lt;/a&gt;
ã€‚è¯¥åŠŸèƒ½çš„æ–°è¿›å±•å°†åœ¨æœ¬æ–‡ä¸­æ›´æ–°ï¼Œè¯·ä¿æŒå…³æ³¨ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ cert-manager ACME Issuer ä¸º Istio ä¸­çš„å…¥å£ç½‘å…³è®¾ç½®è¯ä¹¦</title>
      <link>https://jimmysong.io/blog/secure-ingress-gateway-of-istio/</link>
      <pubDate>Mon, 09 Jan 2023 20:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/secure-ingress-gateway-of-istio/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡å°†ä»¥ Bookinfo åº”ç”¨ä¸ºä¾‹ï¼Œä¸º Istio çš„å…¥å£ç½‘å…³è®¾ç½®ä¸€ä¸ªçœŸå®çš„ TLS/SSL è¯ä¹¦ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Let&amp;rsquo;s Encryptã€cert-manager æ¥ç®¡ç† Istio ä¸­å…¥å£ç½‘å…³çš„è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;prerequisite&#34;&gt;å‡†å¤‡&lt;/h2&gt;
&lt;p&gt;è¯·å…ˆå‚è€ƒ &lt;a href=&#34;https://istio.io/latest/zh/docs/setup/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
å®‰è£… Istio å’Œ &lt;a href=&#34;https://istio.io/latest/zh/docs/examples/bookinfo/&#34; title=&#34;Bookinfo åº”ç”¨&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bookinfo åº”ç”¨&lt;/a&gt;
ï¼Œç¬”è€…åœ¨ GKE ä¸­å®‰è£…äº† Istio 1.16ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸­å®‰è£…çš„å„ç»„ä»¶ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes 1.24.7&lt;/li&gt;
&lt;li&gt;Istio 1.16&lt;/li&gt;
&lt;li&gt;Gateway API 0.5.1&lt;/li&gt;
&lt;li&gt;cert-manager 1.10.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;arch&#34;&gt;æ¶æ„&lt;/h2&gt;
&lt;p&gt;æœ¬å®éªŒä¸­åŒ…å«ä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Cloudflare æä¾› DNS è§£æ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Let&amp;rsquo;s Encrypt åˆ›å»ºè¯ä¹¦&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ cert-manager è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸè¯ä¹¦&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Gateway API æ¥åˆ›å»ºå…¥å£ç½‘å…³&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ç»„ä»¶éƒ¨ç½²åœ¨ GKE ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å›¾ 1 å±•ç¤ºäº†æœ¬å®éªŒçš„æ¶æ„ä»¥åŠæµé‡è·¯ç”±è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/secure-ingress-gateway-of-istio/arch.svg&#34; data-img=&#34;/blog/secure-ingress-gateway-of-istio/arch.svg&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ 1ï¼šIstio å…¥å£ç½‘å…³è¯ä¹¦æŒ‚è½½æ¨¡å¼&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ 1ï¼šIstio å…¥å£ç½‘å…³è¯ä¹¦æŒ‚è½½æ¨¡å¼&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æµé‡è·¯ç”±è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ Gateway åˆ›å»ºå®Œæˆåé€šè¿‡ LoadBalancer æš´éœ²ç½‘å…³ IPï¼Œå°†è¯¥ IP é…ç½®åœ¨ DNS è§£æè®°å½•ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Gateway é€šè¿‡æ³¨è§£å¼•ç”¨ &lt;a href=&#34;https://cert-manager.io/docs/configuration/acme/&#34; title=&#34;ACME Issuer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ACME Issuer&lt;/a&gt;
ï¼›&lt;/li&gt;
&lt;li&gt;ACME Issuer å‘ cert-manager å‘é€è¯·æ±‚è¯ä¹¦ï¼ˆ&lt;a href=&#34;https://cert-manager.io/docs/concepts/acme-orders-challenges/&#34; title=&#34;order å’Œ challenge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;order å’Œ challenge&lt;/a&gt;
ï¼‰ï¼Œå¹¶ä½¿ç”¨ &lt;a href=&#34;https://cert-manager.io/docs/configuration/acme/dns01/&#34; title=&#34;DNS01 Challenge Provider&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DNS01 Challenge Provider&lt;/a&gt;
ï¼›&lt;/li&gt;
&lt;li&gt;cert-manager å‘ ACME æœåŠ¡å™¨ Let&amp;rsquo;s Encrypt è¯·æ±‚è¯ä¹¦å¹¶åˆ›å»º Kubernetes Secretï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ Gateway ä¸­é€šè¿‡åº”ç”¨ Secret æŒ‚è½½ TLS è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;HTTPRoute å°†å…¥å£æµé‡è·¯ç”±åˆ° productpage æœåŠ¡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;acme-issuer&#34;&gt;ACME Issuer&lt;/h2&gt;
&lt;p&gt;Istio åŒ…å«äº†å¼€ç®±å³ç”¨çš„ mTLS æ”¯æŒï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/security/cert-management/plugin-ca-cert/&#34; title=&#34;è‡ªå®šä¹‰ CA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰ CA&lt;/a&gt;
 æˆ– &lt;a href=&#34;https://jimmysong.io/blog/cert-manager-spire-istio/&#34; title=&#34;SPIRE&#34;&gt;SPIRE&lt;/a&gt;
 æ¥ç®¡ç†é›†ç¾¤å†…è¯ä¹¦ï¼Œä½†æ˜¯å¯¹äºå…¥å£ç½‘å…³çš„è¯ä¹¦ï¼Œå°±éœ€è¦æˆ‘ä»¬å•ç‹¬è®¾ç½®ã€‚ä½ å¯ä»¥&lt;a href=&#34;https://istio.tetratelabs.io/zh/istio-in-practice/setting-up-ssl-certs/&#34; title=&#34;æ‰‹åŠ¨ä¸ºå…¥å£ç½‘å…³é…ç½®è¯ä¹¦&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰‹åŠ¨ä¸ºå…¥å£ç½‘å…³é…ç½®è¯ä¹¦&lt;/a&gt;
ï¼Œä¸è¿‡ç®¡ç†èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºä½ éœ€è¦è´Ÿè´£è¯ä¹¦çš„è½®æ¢ä»¥é˜²æ­¢è¯ä¹¦è¿‡æœŸï¼Œæˆ–ä½¿ç”¨ &lt;a href=&#34;https://letsencrypt.org/&#34; title=&#34;Let&amp;amp;rsquo;s Encrypt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt;
 è¿™æ ·çš„ ACME Issuer æ¥è‡ªåŠ¨åŒ–ç®¡ç†è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;ACME (Automated Certificate Management Environment) Issuer æ˜¯ä¸€ç§è®¤è¯æœºæ„ï¼Œå¯ä»¥ä½¿ç”¨ ACME åè®®ä¸ºå®¢æˆ·ç«¯ç”³è¯·å’Œç®¡ç†è¯ä¹¦ã€‚ACME æ˜¯ä¸€ç§ç”¨äºè‡ªåŠ¨åŒ– SSL/TLS è¯ä¹¦é¢å‘å’Œç®¡ç†çš„å¼€æ”¾åè®®ã€‚å®ƒé€šå¸¸ç”¨äºç½‘ç«™æˆ–å…¶ä»–åœ¨çº¿æœåŠ¡çš„è¯ä¹¦ç®¡ç†ï¼Œä»¥ç¡®ä¿å®‰å…¨è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s Encrypt æ˜¯ä¸€ä¸ªéè¥åˆ©æ€§çš„ ACME Issuerï¼Œå¯ä»¥ä¸ºç½‘ç«™æä¾›å…è´¹çš„ SSL/TLS è¯ä¹¦ã€‚å®ƒçš„ç›®æ ‡æ˜¯ä½¿åŠ å¯†æŠ€æœ¯æ™®åŠåŒ–ï¼Œå¹¶å¸®åŠ©æå‡ç½‘ç»œå®‰å…¨æ°´å¹³ã€‚Let&amp;rsquo;s Encrypt ä½¿ç”¨ ACME åè®®ä¸å®¢æˆ·ç«¯é€šä¿¡ï¼Œå¯ä»¥ä¸ºå®¢æˆ·ç«¯ç”³è¯·å’Œç®¡ç†è¯ä¹¦ã€‚ACME åè®®æ˜¯å¼€æ”¾çš„ï¼Œå› æ­¤ä»»ä½•æœºæ„éƒ½å¯ä»¥æˆä¸º ACME Issuerï¼Œåªè¦å®ƒä»¬éµå®ˆ ACME åè®®çš„è§„å®šã€‚&lt;/p&gt;
&lt;h2 id=&#34;details-steps&#34;&gt;è¯¦ç»†æ­¥éª¤&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… Gateway APIï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v0.5.1/standard-install.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… cert-manager&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://gist.githubusercontent.com/rootsongjc/78487acdea70a3c27c1a1b794546d031/raw/0df08b91dfaff6412bbd891ccedffaa882a9a99f/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ƒä¸º cert-manager Deployment å¢åŠ äº†ä»¥ä¸‹å¯åŠ¨é¡¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;args:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - --feature-gates&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ExperimentalGatewayAPISupport&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://dash.cloudflare.com/profile/api-tokens&#34; title=&#34;Cloudflare&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cloudflare&lt;/a&gt;
 ä¸­åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;lets-encrypt-token&lt;/code&gt; çš„ API tokenï¼Œè‡ªå®šä¹‰æ¨¡æ¿è®¾ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;Permissionsï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Zone - DNS - Edit&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Zone - Zone - Read&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Zone Resources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Include - All Zones&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°†è¯¥ token å­˜å‚¨åœ¨ä¸€ä¸ª Secret ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;kubectl apply -n default -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cloudflare-api-token-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Opaque&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stringData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;api-token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;API Token&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-warning-title py-1 px-2&#34;&gt;
  æ³¨æ„
&lt;/div&gt;

&lt;div class=&#34;alert-warning py-1 px-2&#34;&gt;
  æœ¬æ¬¡å®éªŒä¸­è¯¥ Token å®é™…ä¸Šå¹¶æ²¡èµ·åˆ°ä½œç”¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹ cert-manager ä¼šé€šè¿‡ Cloudflare API ä¸ Cloudflare äº¤äº’ï¼Œä¸ºæˆ‘ä»¬é…ç½® DNS è®°å½•ã€‚è¯¥é—®é¢˜è¿˜éœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é…ç½® Let&amp;rsquo;s Encrypt  Issuerï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n default -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: letsencrypt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  acme:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    email: rootsongjc@gmail.com
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    server: https://acme-v02.api.letsencrypt.org/directory
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    privateKeySecretRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      name: lets-encrypt-issuer-account-key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    solvers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - dns01:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        cloudflare:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;          apiTokenSecretRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            name: cloudflare-api-token-secret
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            key: api-token
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      selector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        dnsNames:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        - &amp;#39;bookinfo.jimmysong.io&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é…ç½® Gatewayï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n default -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: bookinfo-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  annotations:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    cert-manager.io/issuer: letsencrypt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  gatewayClassName: istio
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  listeners:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: http
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    hostname: bookinfo.jimmysong.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    port: 443
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    protocol: HTTPS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    allowedRoutes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      namespaces:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        from: Same
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    tls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      mode: Terminate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      certificateRefs:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        kind: Secret
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        group: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        name: bookinfo-tls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ Gateway åˆ›å»ºå®Œæˆåï¼Œä¼šåœ¨ default å‘½åç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªç½‘å…³ Pod ä»¥åŠ LoadBalancer èµ„æºçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;default&lt;/code&gt; å‘½åç©ºé—´ä¸­çš„ Secretï¼Œä½ ä¼šå‘ç° &lt;code&gt;bookinfo-tls&lt;/code&gt;ï¼Œå®ƒæ˜¯ç”± cert-manager åˆ›å»ºçš„ï¼ŒæŸ¥çœ‹è¯¥ Secret ä¸­ä¿å­˜çš„è¯ä¹¦ï¼Œä½ å°†ä¼šçœ‹åˆ°ç”± Let&amp;rsquo;s Encrypt é¢å‘çš„è¯ä¹¦ä¿¡ä»»é“¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bookinfo.jimmysong.io&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ISRG Root X1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DST Root CA X3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é…ç½® HTTPRouteï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n default -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: HTTPRoute
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: bookinfo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  parentRefs:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: bookinfo-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  rules:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - matches:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - path:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        type: Exact
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        value: /productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - path:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        type: PathPrefix
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        value: /static
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - path:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        type: Exact
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        value: /login
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - path:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        type: Exact
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        value: /logout
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - path:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        type: PathPrefix
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        value: /api/v1/products
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    backendRefs:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - name: productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      port: 9080
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Cloudflare ä¸­é…ç½®åŸŸåè®°å½•ï¼šå°†ç½‘å…³æœåŠ¡çš„å¤–ç½‘ IP åŠåŸŸå &lt;code&gt;bookinfo.jimmysong.io&lt;/code&gt; æ·»åŠ åˆ° Cloudflare çš„ DNS è®°å½•ä¸­å°±å¯ä»¥å®ç°åŸŸåè§£æã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-warning-title py-1 px-2&#34;&gt;
  æ³¨æ„
&lt;/div&gt;

&lt;div class=&#34;alert-warning py-1 px-2&#34;&gt;
  æœ¬å®éªŒä¸­å‘ç°ç½‘å…³ Pod å¹¶æ²¡æœ‰æŒ‚è½½ &lt;code&gt;bookinfo-tls&lt;/code&gt;  Secret ä¸­çš„è¯ä¹¦ï¼Œæˆ‘ä»¬åªå¥½é€šè¿‡ Cloudflare æ¥é…ç½® TLS è¯ä¹¦ï¼šä¸ºç½‘ç«™å¼€å¯å…¨ï¼ˆä¸¥æ ¼ï¼‰SSL/TLSï¼Œè¿™å°†ä½¿ç”¨ Cloudflare é¢å‘çš„ TLS è¯ä¹¦ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—® &lt;a href=&#34;https://bookinfo.jimmysong.io/productpage&#34; title=&#34;https://bookinfo.jimmysong.io/productpage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://bookinfo.jimmysong.io/productpage&lt;/a&gt;
 å°±å¯ä»¥è®¿é—® bookinfo åº”ç”¨äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ¬¡å®éªŒè™½ç„¶å®ç°äº†ç½‘å…³çš„ TLS åŠ å¯†ï¼Œä¹Ÿä¸ºç½‘å…³ç”Ÿæˆäº† TLS è¯ä¹¦ï¼Œä½†å®é™…ä¸Šç½‘å…³ä½¿ç”¨çš„æ˜¯ Cloudflare é¢å‘çš„è¯ä¹¦ã€‚è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æœ€åˆçš„ç›®æ ‡ï¼Œå³ä½¿ç”¨ ACME Serverï¼ˆLet&amp;rsquo;s Encryptï¼‰ä¸ºç½‘å…³é¢å‘çš„è¯ä¹¦ã€‚ä¸ºä»€ä¹ˆç½‘å…³ Pod æ²¡æœ‰æŒ‚è½½æˆ‘ä»¬åº”ç”¨çš„ Secret ä¸­çš„è¯ä¹¦ï¼ŒCloudflare DNS01 Challenge Provider ä¸ºä»€ä¹ˆæ²¡æœ‰ç”Ÿæ•ˆï¼Œè¿™ä¸¤ä¸ªé—®é¢˜è¿˜éœ€è¦æˆ‘ä»¬è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.thinktecture.com/en/kubernetes/ssl-certificates-with-cert-manager-in-kubernetes/&#34; title=&#34;Acquire SSL Certificates In Kubernetes From Letâ€™s Encrypt With Cert-Manager - thinktecture.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Acquire SSL Certificates In Kubernetes From Letâ€™s Encrypt With Cert-Manager - thinktecture.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://getbetterdevops.io/k8s-ingress-with-letsencrypt/&#34; title=&#34;How To Secure Kubernetes NGINX Ingress With Cert-Manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How To Secure Kubernetes NGINX Ingress With Cert-Manager&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cert-manager.io/docs/usage/gateway/&#34; title=&#34;Securing gateway.networking.k8s.io Gateway Resources - cert-manager.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Securing gateway.networking.k8s.io Gateway Resources - cert-manager.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ cert-manager å’Œ SPIRE ç®¡ç† Istio ä¸­çš„è¯ä¹¦</title>
      <link>https://jimmysong.io/blog/cert-manager-spire-istio/</link>
      <pubDate>Tue, 27 Dec 2022 16:39:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/cert-manager-spire-istio/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨&lt;a href=&#34;https://jimmysong.io/blog/istio-certificates-management/&#34; title=&#34;ä¸Šä¸€ç¯‡åšå®¢&#34;&gt;ä¸Šä¸€ç¯‡åšå®¢&lt;/a&gt;
ä¸­æˆ‘ä»‹ç»äº† Istio ä¸­æ˜¯å¦‚ä½•ç®¡ç†è¯ä¹¦çš„ï¼Œè¿™ç¯‡æ–‡ç« å°†æŒ‡å¯¼ä½ å¦‚ä½•ä½¿ç”¨å¤–ç½® CAï¼Œé€šè¿‡é›†æˆ &lt;a href=&#34;https://spiffe.io/&#34; title=&#34;SPIRE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE&lt;/a&gt;
 å’Œ &lt;a href=&#34;https://cert-manager.io/&#34; title=&#34;cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager&lt;/a&gt;
 å®ç°ç»†ç²’åº¦çš„è¯ä¹¦ç®¡ç†å’Œè‡ªåŠ¨è¯ä¹¦è½®æ¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ è¿˜ä¸äº†è§£ä»€ä¹ˆæ˜¯ SPIRE ä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨ SPIREï¼Œæ¨èä½ é˜…è¯»ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/why-istio-need-spire/&#34; title=&#34;ä¸ºä»€ä¹ˆ Istio è¦ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ï¼Ÿ&#34;&gt;ä¸ºä»€ä¹ˆ Istio è¦ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ï¼Ÿ&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/how-to-integrate-spire-with-istio/&#34; title=&#34;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIREï¼Ÿ&#34;&gt;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIREï¼Ÿ&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/spiffe/&#34; title=&#34;é›¶ä¿¡ä»»çš„åŸºçŸ³ï¼šä½¿ç”¨ SPIFFE ä¸ºåŸºç¡€è®¾æ–½åˆ›å»ºé€šç”¨èº«ä»½&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›¶ä¿¡ä»»çš„åŸºçŸ³ï¼šä½¿ç”¨ SPIFFE ä¸ºåŸºç¡€è®¾æ–½åˆ›å»ºé€šç”¨èº«ä»½&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;intro&#34;&gt;è¯ä¹¦ç­¾å‘ç®¡ç†æµç¨‹ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†æœ¬æ–‡ä¸­ä½¿ç”¨çš„åŸºäº cert-manager å’Œ SPIRE çš„è¯ä¹¦ä¿¡ä»»é“¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/cert-manager-spire-istio/tree.svg&#34; data-img=&#34;/blog/cert-manager-spire-istio/tree.svg&#34; alt=&#34;image&#34; data-caption=&#34;åŸºäº cert-managerã€SPIRE çš„è¯ä¹¦ä¿¡ä»»é“¾&#34;&gt;
    
  
  &lt;figcaption&gt;åŸºäº cert-managerã€SPIRE çš„è¯ä¹¦ä¿¡ä»»é“¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­ä½ å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cert-manager ä½œä¸ºæ ¹ CA ä¸º &lt;em&gt;istiod&lt;/em&gt; å’Œ SPIRE é¢å‘è¯ä¹¦ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†&lt;a href=&#34;https://cert-manager.io/docs/configuration/selfsigned/&#34; title=&#34;è‡ªç­¾å Issuer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªç­¾å Issuer&lt;/a&gt;
ï¼Œä½ è¿˜å¯ä»¥ä¸ºå…¶é…ç½®ä½¿ç”¨ Let&amp;rsquo;s Encryptã€Vaultã€Venafi ç­‰å†…ç½® Issuerï¼Œæˆ–å…¶ä»–å¤–ç½®çš„ Issuerï¼›å¦å¤–ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨å…¶ä»– &lt;a href=&#34;https://spiffe.io/docs/latest/deploying/spire_server/&#34; title=&#34;UpstreamAuthority&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UpstreamAuthority&lt;/a&gt;
ï¼Œä¾‹å¦‚ Vaultã€SPIRE è”é‚¦ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE ä¸º Istio ç½‘æ ¼å†…å·¥ä½œè´Ÿè½½å’Œ Ingress Gatewayã€Egress Gateway é¢å‘ SVID è¯ä¹¦ï¼Œç”¨äºæœåŠ¡é—´ mTLSï¼›&lt;/li&gt;
&lt;li&gt;å…¶ä¸­ç½‘æ ¼å¤–è®¿é—® Ingress Gateway æ—¶çš„ä½¿ç”¨çš„è¯ä¹¦åŠ Egress Gateway è®¿é—®ç½‘æ ¼å¤–æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦éœ€è¦é¢å¤–é…ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†åœ¨ Istio ä¸­é›†æˆ SPRIE å’Œ cert-manger åçš„è¯ä¹¦é¢å‘å’Œæ›´æ–°æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/cert-manager-spire-istio/steps.svg&#34; data-img=&#34;/blog/cert-manager-spire-istio/steps.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio é›†æˆ SPIRE å’Œ cert-manager åçš„è¯ä¹¦é¢å‘å’Œæ›´æ–°æµç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;Istio é›†æˆ SPIRE å’Œ cert-manager åçš„è¯ä¹¦é¢å‘å’Œæ›´æ–°æµç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SPIRE Server ä¸­çš„ Kubernetes Workload Registar è‡ªåŠ¨æ³¨å†Œ Kubernetes ä¸­çš„å·¥ä½œè´Ÿè½½ï¼Œä¸ºæ‰€æœ‰å·¥ä½œè´Ÿè½½ç”Ÿæˆ SPIFFE æ ‡å‡†çš„èº«ä»½ï¼›&lt;/li&gt;
&lt;li&gt;cert-manager ä¸º &lt;em&gt;istiod&lt;/em&gt; é¢å‘å¹¶ç®¡ç† CA è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;å·¥ä½œè´Ÿè½½ä¸­çš„ Envoy ä»£ç†é€šè¿‡ UNIX Domain Socketï¼ˆUDSï¼‰é€šè¿‡ SDS API å‘åŒèŠ‚ç‚¹ä¸Šçš„ SPIRE Agent å‘é€ CSR è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE Agent å‘ SPIRE Server å‘é€ CSRï¼›&lt;/li&gt;
&lt;li&gt;SPIRE Server å‘ SPIRE Agent è¿”å›ç­¾ååçš„è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE Agent å‘å·¥ä½œè´Ÿè½½è¿”å›ç­¾ååçš„è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE è´Ÿè´£å·¥ä½œè´Ÿè½½çš„è¯ä¹¦ç®¡ç†å’Œæ›´æ–°ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨äº†è§£äº†å¤§è‡´æµç¨‹åï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»æ‰‹å®‰è£…å„ä¸ªç»„ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;install-cert-manager&#34;&gt;å®‰è£… cert-manager&lt;/h2&gt;
&lt;p&gt;è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… cert-managerï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥å®ç°è‡ªåŠ¨è¯ä¹¦è½®æ¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.10.1/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹ CA æ˜¯ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤é…ç½®æ ¹ CAï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;cat &amp;lt;&amp;lt; EOF | kubectl apply -f -&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Issuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;21600h&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;commonName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;certmanager-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organizations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;cert-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuerRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Issuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIssuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åä¸º &lt;em&gt;istiod&lt;/em&gt; é…ç½®è¯ä¹¦ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;kubectl create namespace istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cat &amp;lt;&amp;lt; EOF | kubectl apply -f -&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1440h&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;renewBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;360h&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;commonName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod.istio-system.svc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;usages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;digital signature&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;key encipherment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;cert sign&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istiod.istio-system.svc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuerRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIssuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»å®‰è£…å¥½äº† cert-managerï¼Œå¹¶åˆ›å»ºäº†åä¸º &lt;code&gt;selfsigned-ca&lt;/code&gt; çš„ &lt;code&gt;clusterIssuer&lt;/code&gt;ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®‰è£… SPIRE å¹¶å°† cert-manager ä½œä¸º SPIRE çš„  &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/doc/plugin_server_upstreamauthority_cert_manager.md&#34; title=&#34;&amp;lt;code&amp;gt;UpstreamAuthority&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;UpstreamAuthority&lt;/code&gt;&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;install-spire&#34;&gt;å®‰è£… SPIRE&lt;/h2&gt;
&lt;p&gt;è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¿«é€Ÿå®‰è£… SPIREï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://gist.githubusercontent.com/rootsongjc/5dac0518cc432cbf844114faca74aa40/raw/814587f94bbef8fb1dd376282249dcb2a8f7fa1b/spire-with-cert-manager-upstream-authority-quick-start.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥ YAML æ–‡ä»¶æ¯”èµ· Istio 1.16 å®‰è£…åŒ…ä¸­çš„ &lt;code&gt;samples/security/spire/spire-quickstart.yaml&lt;/code&gt; æ–‡ä»¶å¢åŠ äº†å¯¹ cert-manager çš„é€‚é…ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º &lt;code&gt;spire-server-trust-role&lt;/code&gt; ClusterRole å¢åŠ äº†å¯¹ &lt;code&gt;cert-manager.io&lt;/code&gt; API ç»„çš„æƒé™ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ SPIRE Server çš„é…ç½®ä¸­å¢åŠ äº† &lt;code&gt;UpstreamAuthority &amp;quot;cert-manager&amp;quot;&lt;/code&gt; é…ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  æ³¨æ„
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  SPIRE Server é…ç½®ä¸­çš„ &lt;code&gt;trust_domain&lt;/code&gt; åº”ä¸å®‰è£… Istio æ—¶æŒ‡å®šçš„ &lt;code&gt;TRUST_DOMAIN&lt;/code&gt; ç¯å¢ƒå˜é‡çš„å€¼ä¿æŒä¸€è‡´ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è¯¥å‘½ä»¤ä¸­ä¼šå®‰è£… &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/support/k8s/k8s-workload-registrar/README.md&#34; title=&#34;Kubernetes Workload Registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Workload Registrar&lt;/a&gt;
ï¼Œè‡ªåŠ¨æ³¨å†Œ Kubernetes ä¸­çš„å·¥ä½œè´Ÿè½½ã€‚æ‰€æœ‰å·¥ä½œè´Ÿè½½å°†æ ¹æ®å…¶æœåŠ¡è´¦æˆ·æ³¨å†Œ SPIFFE æ ‡å‡†çš„æœåŠ¡èº«ä»½æ ¼å¼ &lt;code&gt;spiffe://&amp;lt;trust-domain&amp;gt;/ns/&amp;lt;namespace&amp;gt;/sa/&amp;lt;service-account&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³è°ƒæ•´ SPIRE CA å’Œ SVID è¯ä¹¦çš„ TTLï¼Œå¯ä»¥åœ¨ SPIRE Server çš„é…ç½®ä¸­ä¿®æ”¹ &lt;code&gt;ca_ttl&lt;/code&gt;ï¼ˆé»˜è®¤ 24hï¼‰å’Œ &lt;code&gt;default_svid_ttl&lt;/code&gt;ï¼ˆé»˜è®¤ 1hï¼‰ï¼Œè¯¦è§ &lt;a href=&#34;https://spiffe.io/docs/latest/deploying/spire_server/&#34; title=&#34;SPIRE Server é…ç½®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Server é…ç½®&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;install-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… Istio å¹¶å¯ç”¨ CA è¯ä¹¦è‡ªåŠ¨è½®æ¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;istioctl operator init&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istioctl install --skip-confirmation -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä¿¡ä»»åŸŸåº”ä¸ SPIRE Server ä¸­é…ç½®çš„ä¿¡ä»»åŸŸç›¸åŒ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è‡ªå®šä¹‰ sidecar æ¨¡æ¿&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecarInjectorWebhook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            - name: istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                mountPath: /run/secrets/workload-spiffe-uds
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                csi:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  driver: &amp;#34;csi.spiffe.io&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  readOnly: true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pilot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å¦‚æœå¯ç”¨ï¼Œå¦‚æœç”¨æˆ·å¼•å…¥æ–°çš„ä¸­é—´æ’ä»¶ CAï¼Œç”¨æˆ·ä¸éœ€è¦é‡æ–°å¯åŠ¨ istiod æ¥è·å–è¯ä¹¦ã€‚Istiod ä¼šè·å–æ–°æ·»åŠ çš„ä¸­é—´æ’ä»¶ CA çš„è¯ä¹¦å¹¶æ›´æ–°å®ƒã€‚ä¸æ”¯æŒæ’å…¥æ–°çš„ Root-CAã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTO_RELOAD_PLUGIN_CERTS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;overlays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.volumes.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.containers.[name:istio-proxy].volumeMounts.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/run/secrets/workload-spiffe-uds&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨ Istio Operator ä¸­å£°æ˜çš„ &lt;code&gt;spire&lt;/code&gt; æ¨¡æ¿æ¥éƒ¨ç½²å·¥ä½œè´Ÿè½½ï¼Œå› æ­¤æˆ‘ä»¬è¿è¡Œä¸‹é¢çš„å‘½ä»¤éƒ¨ç½² Bookinfo åº”ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl kube-inject -f bookinfo-with-spire-template.yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸Šé¢å‘½ä»¤ä¸­ä½¿ç”¨çš„ &lt;code&gt;bookinfo-with-spire-template.yaml&lt;/code&gt; æ–‡ä»¶å¯ä»¥åœ¨&lt;a href=&#34;https://gist.githubusercontent.com/rootsongjc/5dac0518cc432cbf844114faca74aa40/raw/5f4ce4c857cfb9f45121b6e4d26d01b8d4e29b84/&#34; title=&#34;è¿™ä¸ª Gist&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ä¸ª Gist&lt;/a&gt;
 ä¸­æ‰¾åˆ°ï¼Œä¸ Istio å®‰è£…åŒ…ä¸­çš„ &lt;code&gt;samples/bookinfo/platform/kube/bookinfo.yaml&lt;/code&gt; æ–‡ä»¶å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯æ¯ä¸ª Deployment çš„ template ä¸­éƒ½å¢åŠ äº†ä»¥ä¸‹æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inject.istio.io/templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sidecar,spire&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ£€æŸ¥ SPIRE æ˜¯å¦ç»™å·¥ä½œè´Ÿè½½é¢å‘äº†èº«ä»½è¯æ˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -i -t spire-server-0 -n spire -c spire-server -- /bin/sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;bin/spire-server entry show -socketPath /run/spire/sockets/server.sock&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥åœ¨è¾“å‡ºç»“æœä¸­çœ‹åˆ° protuctpage æœåŠ¡çš„èº«ä»½ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Entry ID         : 68182621-aa9d-448d-9020-9b6ab3640b94
SPIFFE ID        : spiffe://example.org/ns/default/sa/bookinfo-productpage
Parent ID        : spiffe://example.org/k8s-workload-registrar/demo-cluster/node/gke-jimmy-cluster-default-pool-d5041909-5tzd
Revision         : 1
TTL              : default
Selector         : k8s:node-name:gke-jimmy-cluster-default-pool-d5041909-5tzd
Selector         : k8s:ns:default
Selector         : k8s:pod-uid:6244a82c-2862-4452-a592-f79a41e5ccff
DNS name         : productpage-v1-6999d7b9d9-7szxm
DNS name         : productpage.default.svc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;productpage&lt;/code&gt; pod çš„è¯ä¹¦ä¿¡ä»»é“¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl proxy-config secret deployment/productpage-v1 -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹æ ¹è¯ä¹¦ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl proxy-config secret deployment/productpage-v1 -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[1].secret.validationContext.trustedCa.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; root.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ &lt;code&gt;chain.pem&lt;/code&gt; æ–‡ä»¶ï¼Œä½ å°†å¯çœ‹åˆ°å…¶ä¸­æœ‰ä¸¤ä¸ªè¯ä¹¦ï¼Œå°†è¿™ä¸¤ä¸ªè¯ä¹¦åˆ†åˆ«ä¿å­˜åˆ°ç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨ &lt;code&gt;openssl&lt;/code&gt; å‘½ä»¤ &lt;code&gt;openssl x509 -noout -text -in $FILE&lt;/code&gt; è§£æè¯ä¹¦å†…å®¹ï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹çš„è¯ä¹¦ä¿¡ä»»é“¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/cert-manager-spire-istio/chain.svg&#34; data-img=&#34;/blog/cert-manager-spire-istio/chain.svg&#34; alt=&#34;image&#34; data-caption=&#34;Productpage æœåŠ¡çš„è¯ä¹¦ä¿¡ä»»é“¾&#34;&gt;
    
  
  &lt;figcaption&gt;Productpage æœåŠ¡çš„è¯ä¹¦ä¿¡ä»»é“¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ Istiod çš„è¯ä¹¦ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl proxy-config secret deployment/istiod -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¯ä¹¦ä¿¡ä»»é“¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cert-manager åšä¸º PKI çš„æ ¹èŠ‚ç‚¹ä¸º &lt;em&gt;istiod&lt;/em&gt; é¢å‘è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE ä½œä¸ºä¸­é—´ CA å†ä¸ºå„ä¸ªå·¥ä½œè´Ÿè½½é¢å‘è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;Istio ç½‘æ ¼ä¸­å·¥ä½œè´Ÿè½½çš„ X509 v3 ä¸»ä½“åˆ«åä¸­çš„ URI éµå¾ªäº† SPIFF èº«ä»½è§„èŒƒï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cert-auto-rotate&#34;&gt;è®¾ç½®è¯ä¹¦è‡ªåŠ¨è½®æ¢&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ è¦ä¿®æ”¹ &lt;em&gt;istiod&lt;/em&gt; è¯ä¹¦çš„è½®æ¢å‘¨æœŸï¼Œä» 60 å¤©ï¼ˆ1440 å°æ—¶ï¼‰ç¼©çŸ­åˆ° 30 å¤©ï¼ˆ720 å°æ—¶ï¼‰ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;cat &amp;lt;&amp;lt; EOF | kubectl apply -f -&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;720h &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;renewBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;360h&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;commonName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod.istio-system.svc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;usages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;digital signature&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;key encipherment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;cert sign&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istiod.istio-system.svc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuerRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;selfsigned-ca&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIssuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ &lt;em&gt;istiod&lt;/em&gt; çš„æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod -n istio-system -f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿‡ä¸¤åˆ†é’Ÿåï¼Œä½ å°†çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¯ä¹¦æ›´æ”¹è®°å½•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2022-12-23T03:48:42.697360Z	info	Update Istiod cacerts
2022-12-23T03:48:42.697503Z	info	Using kubernetes.io/tls secret type for signing ca files
2022-12-23T03:48:42.778241Z	info	Istiod has detected the newly added intermediate CA and updated its key and certs accordingly
2022-12-23T03:48:42.779459Z	info	x509 cert - Issuer: &amp;#34;CN=istiod.istio-system.svc&amp;#34;, Subject: &amp;#34;&amp;#34;, SN: d7acac2301045f741e5e30cff380deaf, NotBefore: &amp;#34;2022-12-23T03:46:42Z&amp;#34;, NotAfter: &amp;#34;2032-12-20T03:48:42Z&amp;#34;
2022-12-23T03:48:42.779561Z	info	x509 cert - Issuer: &amp;#34;CN=certmanager-ca,O=cert-manager&amp;#34;, Subject: &amp;#34;CN=istiod.istio-system.svc&amp;#34;, SN: 164bf045670a1716ed3f0f1c89b56122, NotBefore: &amp;#34;2022-12-23T03:48:14Z&amp;#34;, NotAfter: &amp;#34;2023-01-22T03:48:14Z&amp;#34;
2022-12-23T03:48:42.779642Z	info	x509 cert - Issuer: &amp;#34;CN=certmanager-ca,O=cert-manager&amp;#34;, Subject: &amp;#34;CN=certmanager-ca,O=cert-manager&amp;#34;, SN: 8533dbfe0b84ed1fc4e3c76be7ef612f, NotBefore: &amp;#34;2022-12-20T07:50:12Z&amp;#34;, NotAfter: &amp;#34;2025-06-07T07:50:12Z&amp;#34;
2022-12-23T03:48:42.779657Z	info	Istiod certificates are reloaded
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¦ä¿®æ”¹å·¥ä½œè´Ÿè½½è¯ä¹¦çš„è‡ªåŠ¨è½®æ¢å‘¨æœŸï¼Œä½ å¯ä»¥è®¾ç½® &lt;code&gt;pilot-agent&lt;/code&gt; å‘½ä»¤çš„ç¯å¢ƒå˜é‡ &lt;code&gt;SECRET_TTL&lt;/code&gt;ï¼Œé»˜è®¤å€¼ä¸º &lt;code&gt;24h0m0s&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† cert-manager ä½œä¸º PKIï¼Œå°† SPIRE é›†æˆåˆ°æˆ‘ä»¬çš„è¯ä¹¦ä¿¡ä»»é“¾ä¸­ï¼Œå¹¶ä¸º Istio ç½‘æ ¼ä¸­çš„å·¥ä½œè´Ÿè½½åˆ›å»ºèº«ä»½å’Œè¯ä¹¦ã€‚é€šè¿‡ä½¿ç”¨ cert-managerï¼Œä½ ä¸ç”¨æ‹…å¿ƒ &lt;em&gt;istiod&lt;/em&gt; è¯ä¹¦è¿‡æœŸçš„é—®é¢˜ï¼Œè¿˜å¯ä»¥æ ¹æ®éœ€è¦æ›´æ–°è¯ä¹¦ã€‚ä½ è¿˜å¯ä»¥æ ¹æ®éœ€è¦å°† cert-manager é›†æˆåˆ°å…¶ä»–è¯ä¹¦ä¾›åº”å•†ï¼Œå¦‚ &lt;a href=&#34;https://letsencrypt.org/&#34; title=&#34;Let&amp;amp;rsquo;s Encrypt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt;
ã€&lt;a href=&#34;https://www.vaultproject.io/&#34; title=&#34;HashiCorp Vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HashiCorp Vault&lt;/a&gt;
ã€&lt;a href=&#34;https://www.venafi.com/&#34; title=&#34;Venafi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Venafi&lt;/a&gt;
 ç­‰ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://github.com/cert-manager/istio-csr&#34; title=&#34;istio-csr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio-csr&lt;/a&gt;
 ç›´æ¥è®© cert-manager æ¥ç®¡ç† Istio ä¸­çš„è¯ä¹¦ï¼Œå‚è€ƒ&lt;a href=&#34;https://istio.tetratelabs.io/zh/blog/external-ca-integration-with-cert-manager-using-istio-csr/&#34; title=&#34;ä½¿ç”¨ istio-csr å°†å¤–éƒ¨ CA ä¸è¯ä¹¦ç®¡ç†å™¨é›†æˆ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ istio-csr å°†å¤–éƒ¨ CA ä¸è¯ä¹¦ç®¡ç†å™¨é›†æˆ&lt;/a&gt;
ï¼Œæˆ–&lt;a href=&#34;https://lib.jimmysong.io/blog/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/&#34; title=&#34;ä½¿ç”¨ Vault æ¥å­˜å‚¨è¯ä¹¦&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Vault æ¥å­˜å‚¨è¯ä¹¦&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/istio-trust/&#34; title=&#34;å°† Istio çº³å…¥ä¿¡ä»»é“¾ï¼šä½¿ç”¨ç°æœ‰ PKI ä½œä¸ºä¿¡ä»»æ ¹ - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°† Istio çº³å…¥ä¿¡ä»»é“¾ï¼šä½¿ç”¨ç°æœ‰ PKI ä½œä¸ºä¿¡ä»»æ ¹ - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/automate-istio-ca-rotation-in-production-at-scale/&#34; title=&#34;åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è‡ªåŠ¨åŒ– Istio CA è½®æ¢ - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è‡ªåŠ¨åŒ– Istio CA è½®æ¢ - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/&#34; title=&#34;å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ä½œä¸ºä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ Istio è¯ä¹¦ - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ä½œä¸ºä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ Istio è¯ä¹¦ - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/istio-spire-integration/&#34; title=&#34;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://spiffe.io/docs/latest/deploying/spire_server/#built-in-plugins&#34; title=&#34;SPIRE Server Configuration Reference - spiffe.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Server Configuration Reference - spiffe.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/spiffe/spire/blob/v1.5.3/doc/plugin_server_upstreamauthority_cert_manager.md&#34; title=&#34;Server plugin: UpstreamAuthority &amp;amp;ldquo;cert-manager&amp;amp;rdquo; - github.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Server plugin: UpstreamAuthority &amp;ldquo;cert-manager&amp;rdquo; - github.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://spiffe.io/docs/latest/deploying/configuring/&#34; title=&#34;Configuring SPIRE - spiffe.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Configuring SPIRE - spiffe.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.tetratelabs.io/zh/blog/external-ca-integration-with-cert-manager-using-istio-csr/&#34; title=&#34;ä½¿ç”¨ istio-csr å°†å¤–éƒ¨ CA ä¸è¯ä¹¦ç®¡ç†å™¨é›†æˆ -  istio.tetratelabs.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ istio-csr å°†å¤–éƒ¨ CA ä¸è¯ä¹¦ç®¡ç†å™¨é›†æˆ -  istio.tetratelabs.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio ä¸­çš„è¯ä¹¦ç®¡ç†æ–¹å¼ä»‹ç»</title>
      <link>https://jimmysong.io/blog/istio-certificates-management/</link>
      <pubDate>Tue, 20 Dec 2022 09:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-certificates-management/</guid>
      <description>
        
        
        &lt;p&gt;æˆ‘åœ¨&lt;a href=&#34;https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/&#34; title=&#34;å¦‚ä½•ç†è§£ Istio ä¸­çš„ mTLS æµé‡åŠ å¯†&#34;&gt;å¦‚ä½•ç†è§£ Istio ä¸­çš„ mTLS æµé‡åŠ å¯†&lt;/a&gt;
è¿™ç¯‡æ–‡ç« ä¸­æå‡ºæµé‡åŠ å¯†çš„å…³é”®æ˜¯è¯ä¹¦ç®¡ç†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Istio ä¸­å†…ç½®äº† CAï¼ˆè¯ä¹¦æˆæƒæœºæ„ï¼‰ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ CA æ¥ç®¡ç†ç½‘æ ¼å†…çš„è¯ä¹¦ã€‚è¿™ç¯‡åšå®¢å°†ä¸ºä½ è®²è§£ Istio æ˜¯å¦‚ä½•è¿›è¡Œè¯ä¹¦ç®¡ç†çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;certificates-introduction&#34;&gt;ä»€ä¹ˆæ˜¯è¯ä¹¦ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨ä»‹ç» Istio çš„è¯ä¹¦ç®¡ç†æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è¯ä¹¦ã€‚è‹¥ä½ å·²äº†è§£è¯ä¹¦çš„ä½œç”¨åŠåŸç†ï¼Œè¯·ç›´æ¥è·³åˆ° Istio ä¸­çš„è¯ä¹¦ç®¡ç†éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;è¯ä¹¦ï¼ˆCertificateï¼‰ï¼Œåˆç§°ç”µå­è¯ä¹¦ï¼Œæ˜¯ç”¨äºèº«ä»½è®¤è¯å’ŒåŠ å¯†é€šä¿¡çš„ä¸€ç§æ•°å­—è¯æ˜æ–‡ä»¶ã€‚åœ¨äº†è§£ Istio çš„è¯ä¹¦ç®¡ç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è¯ä¹¦ã€‚å¦‚æœä½ å·²ç»äº†è§£äº†è¯ä¹¦ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;è¯ä¹¦æœ‰å¾ˆå¤šç±»åˆ«ï¼Œæœ¬æ–‡ä¸­çš„è¯ä¹¦ç‰¹æŒ‡çš„æ˜¯ &lt;a href=&#34;https://datatracker.ietf.org/doc/html/rfc5280&#34; title=&#34;X.509 V3 è¯ä¹¦&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;X.509 V3 è¯ä¹¦&lt;/a&gt;
ã€‚X509 è¯ä¹¦æ˜¯ä¸€ç§å¸¸è§çš„æ•°å­—è¯ä¹¦æ ¼å¼ï¼Œç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¸­è¯†åˆ«å®ä½“çš„èº«ä»½ã€‚X509 æ˜¯å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰çš„å›½é™…æ ‡å‡†ï¼Œä¸»è¦ç”¨äºèº«ä»½è®¤è¯å’Œä¿¡æ¯åŠ å¯†ï¼Œä¾‹å¦‚ TLSã€‚X.509 è¯ä¹¦ä¸­åŒ…å«äº†ä¸ªäººã€ç»„ç»‡æˆ–è®¡ç®—æœºçš„èº«ä»½ä¿¡æ¯å’Œå…¬é’¥ã€‚V3 æ˜¯å®ƒçš„æœ€æ–°ç‰ˆæœ¬ã€‚å®ƒä¸»è¦ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œä¾‹å¦‚åœ¨é€šè¿‡ HTTPS è®¿é—®ç½‘ç«™æ—¶ã€‚x509 è¯ä¹¦é€šå¸¸ç”± CA é¢å‘ï¼Œè¯¥ CA ä¼šéªŒè¯å®ä½“çš„èº«ä»½ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ç¼–ç åˆ°è¯ä¹¦ä¸­ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯æä¾›å…¶ x509 è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œå¹¶é€šè¿‡è¯¥è¯ä¹¦æ¥è¯†åˆ«æœåŠ¡å™¨çš„èº«ä»½ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒåŒæ–¹å¯ä»¥å®‰å…¨åœ°è¿›è¡Œé€šä¿¡ï¼Œå¹¶ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®Œæ•´æ€§å’Œä¿å¯†æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;hash&#34;&gt;å“ˆå¸Œå‡½æ•°&lt;/h3&gt;
&lt;p&gt;è°ˆåˆ°è¯ä¹¦å°±ä¸å¾—ä¸æå“ˆå¸Œï¼ˆHashï¼‰å‡½æ•°ï¼Œå› ä¸ºè¯ä¹¦çš„å†…å®¹ä¼šä½¿ç”¨å“ˆå¸Œå‡½æ•°è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œç„¶åç”¨è¯ä¹¦é¢å‘è€…çš„ç§é’¥è¿›è¡Œç­¾åã€‚è¿™æ ·ï¼Œå½“æ”¶åˆ°ä¸€ä»½è¯ä¹¦æ—¶ï¼Œæ¥æ”¶è€…å°±å¯ä»¥ä½¿ç”¨è¯ä¹¦é¢å‘è€…çš„å…¬é’¥æ¥éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å“ˆå¸Œå‡½æ•°æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„è¾“å…¥ï¼ˆä¹Ÿç§°ä¸ºæ¶ˆæ¯ï¼‰æ˜ å°„ä¸ºå›ºå®šé•¿åº¦çš„è¾“å‡ºçš„å‡½æ•°ã€‚è¿™ä¸ªè¾“å‡ºä¹Ÿç§°ä¸ºå“ˆå¸Œå€¼æˆ–æ¶ˆæ¯æ‘˜è¦ã€‚&lt;/p&gt;
&lt;p&gt;å“ˆå¸Œå‡½æ•°æœ‰è®¸å¤šç”¨é€”ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„ç”¨é€”æ˜¯å¯†ç å­˜å‚¨ã€‚å½“ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­è®¾ç½®å¯†ç æ—¶ï¼Œé€šå¸¸ä¸ä¼šå°†çœŸå®çš„å¯†ç ç›´æ¥å­˜å‚¨åœ¨ç³»ç»Ÿä¸­ã€‚ç›¸åï¼Œä¼šå°†å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶å°†å“ˆå¸Œå€¼å­˜å‚¨åœ¨ç³»ç»Ÿä¸­ã€‚å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šå°†ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œç„¶åä¸å­˜å‚¨çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼Œåˆ™è¯æ˜ç”¨æˆ·è¾“å…¥çš„å¯†ç æ­£ç¡®ï¼Œåä¹‹åˆ™é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å“ˆå¸Œå‡½æ•°æœ‰å¾ˆå¤šç§ç±»å‹ï¼Œä¾‹å¦‚ MD5ã€SHA-1 ç­‰ã€‚è¿™äº›å‡½æ•°éƒ½æœ‰ä¸€äº›å…±åŒçš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚è¾“å‡ºå›ºå®šé•¿åº¦ã€ä¸å¯é€†ã€æ•£åˆ—å†²çªå°‘ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å“ˆå¸Œå‡½æ•°çš„å®‰å…¨æ€§ä¸å…¶è¾“å‡ºçš„é•¿åº¦æœ‰å…³ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¾“å‡ºé•¿åº¦è¶Šé•¿ï¼Œå“ˆå¸Œå‡½æ•°å°±è¶Šå®‰å…¨ã€‚ä½†æ˜¯ï¼Œè¾“å‡ºé•¿åº¦è¶Šé•¿ï¼Œå“ˆå¸Œå¤„ç†çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå› æ­¤è¦åœ¨å®‰å…¨æ€§å’Œæ•ˆç‡ä¹‹é—´è¿›è¡Œå¹³è¡¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cert-works&#34;&gt;è¯ä¹¦çš„ä½œç”¨&lt;/h3&gt;
&lt;p&gt;è¯ä¹¦çš„ç”¨é€”å¹¿æ³›ï¼Œå‡¡æ˜¯éœ€è¦åŠ å¯†ã€è®¤è¯ã€æˆæƒçš„åœºæ™¯éƒ½ä¼šç”¨åˆ°å®ƒï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes ä¸­ä½ éœ€è¦ç»™å„ä¸ªç»„ä»¶é…ç½®è¯ä¹¦ï¼Œä½ å¯ä»¥é€‰æ‹©&lt;a href=&#34;https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/certificates/&#34; title=&#34;æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦&lt;/a&gt;
ï¼›&lt;/li&gt;
&lt;li&gt;Istio ä¸­ä¸ºå®ç°è‡ªåŠ¨ mTLS ç»™å„ä¸ªå·¥ä½œè´Ÿè½½é¢å‘çš„è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;è®¿é—® HTTPS ç½‘ç«™æ‰€ç”¨åˆ°çš„è¯ä¹¦ç­‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯ä¹¦å°±åƒæ˜¯ç”±æƒå¨æœºæ„å°å‘çš„åç‰‡ï¼Œä¾›ä½¿ç”¨è€…è¡¨æ˜å…¶èº«ä»½ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä¸ºä¿¡æ¯åŠ å¯†ï¼Œä¿è¯é€šä¿¡çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯ TLS é€šä¿¡çš„å¤§æ¦‚æ­¥éª¤ï¼Œå…¶ä¸­è¯ä¹¦æ‰¿æ‹…äº†è¯æ˜æœåŠ¡å™¨èº«ä»½å’ŒåŠ å¯†é€šä¿¡çš„èŒè´£ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»¥ä¸€ä¸ªç½‘ç«™çš„ HTTP é“¾æ¥ä¸ºä¾‹ï¼Œé¢å‘æ•°å­—è¯ä¹¦ã€éªŒè¯å’ŒåŠ å¯†é€šä¿¡çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-certificates-management/tls.svg&#34; data-img=&#34;/blog/istio-certificates-management/tls.svg&#34; alt=&#34;image&#34; data-caption=&#34;TLS è¯ä¹¦é¢å‘å’Œæ ¡éªŒè¿‡ç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;TLS è¯ä¹¦é¢å‘å’Œæ ¡éªŒè¿‡ç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å™¨ï¼ˆç½‘ç«™æ‰€æœ‰è€…ï¼‰å‘ CA æäº¤è¯ä¹¦ç­¾åè¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;CA  éªŒè¯æœåŠ¡å™¨çš„èº«ä»½å’Œç½‘ç«™çš„çœŸå®æ€§åä¸ºæœåŠ¡å™¨é¢å‘æ•°å­—è¯ä¹¦ï¼ŒæœåŠ¡å™¨å®‰è£…è¯¥è¯ä¹¦ï¼Œä»¥ä¾¿è®¿é—®è€…èƒ½å¤ŸéªŒè¯ç½‘ç«™çš„å®‰å…¨æ€§ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘ç½‘ç«™å‘é€è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å› TLS è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘ CA éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œè‹¥æœ‰æ•ˆåˆ™å»ºç«‹è¿æ¥ï¼Œè‹¥æ— æ•ˆåˆ™æç¤ºç”¨æˆ·æ‹’ç»è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ç”Ÿæˆä¸€å¯¹éšæœºçš„å…¬é’¥å’Œç§é’¥ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å°†å¹¶å°†è‡ªå·±çš„å…¬é’¥å‘é€ç»™æœåŠ¡ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯ä½¿ç”¨å®¢æˆ·ç«¯çš„å…¬é’¥åŠ å¯†æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å°†åŠ å¯†åçš„æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†æœåŠ¡ç«¯å‘é€çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è‡³æ­¤ï¼ŒåŒæ–¹å»ºç«‹äº†ä¸€ä¸ªå®‰å…¨çš„é€šé“ï¼Œå¹¶å¯ä»¥é€šè¿‡è¯¥é€šé“è¿›è¡ŒåŒå‘åŠ å¯†çš„æ•°æ®ä¼ è¾“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;how-to-generate-certificates&#34;&gt;å¦‚ä½•ç”Ÿæˆè¯ä¹¦ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å¼€æºå·¥å…·ç”Ÿæˆ X.509 è¯ä¹¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/OpenVPN/easy-rsa&#34; title=&#34;Easy-RSA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Easy-RSA&lt;/a&gt;
ï¼šä¸€ä¸ªç®€å•åœ°å‘½ä»¤è¡Œå·¥å…·ï¼Œç”± OpenVPN é¡¹ç›®ç»„ç»´æŠ¤ï¼Œä½¿ç”¨ EasyRSA å¯ä»¥è½»æ¾åœ°ä¸º OpenVPN ç½‘ç»œç”Ÿæˆå®‰å…¨çš„è¯ä¹¦å’Œå¯†é’¥ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/openssl/openssl&#34; title=&#34;OpenSSL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenSSL&lt;/a&gt;
ï¼šç”±ä¸ªäººå‘èµ·äº 1995 å¹´ï¼Œç°ç”±ç‹¬ç«‹ç»„ç»‡ç»´æŠ¤ï¼Œåªæä¾›å‘½ä»¤è¡Œå·¥å…·ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cloudflare/cfssl&#34; title=&#34;CFSSL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CFSSL&lt;/a&gt;
ï¼šç”± CloudFlare å¼€å‘å’Œç»´æŠ¤ï¼Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆè¯ä¹¦çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿˜å¯ä»¥ä½œä¸º PKI æœåŠ¡å™¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/google/boringssl&#34; title=&#34;BoringSSL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BoringSSL&lt;/a&gt;
ï¼šGoogle å¼€å‘å’Œç»´æŠ¤çš„ OpenSSL åˆ†æ”¯ï¼Œå·²ç”¨äº Chrome æµè§ˆå™¨å’Œå®‰å“æ“ä½œç³»ç»Ÿï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸ºå¯èƒ½å¤§å¤šæ•°äººéƒ½å¯¹ OpenSSL æ¯”è¾ƒç†Ÿæ‚‰ï¼Œæ‰€ä»¥ä¸‹æ–‡ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ OpenSSL æ¥åˆ›å»ºè¯ä¹¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cert-component&#34;&gt;è¯ä¹¦çš„ç»„æˆ&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢ä»¥ X.509 V3 è¯ä¹¦ä¸ºä¾‹ï¼Œè®²è§£æ•°å­—è¯ä¹¦çš„ç»„æˆã€‚ä¸‹é¢æ˜¯è¯¥è¯ä¹¦çš„ä¸€ä¸ªç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            fc:c6:18:2e:20:bd:27:b5:6b:60:bc:47:23:6b:8b:d9
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: O=cluster.local
        Validity
            Not Before: Dec 15 07:25:32 2022 GMT
            Not After : Dec 16 07:27:32 2022 GMT
        Subject:
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:eb:40:16:87:6c:17:5a:9c:b2:91:00:94:d1:31:
                    37:bb:d7:1e:e6:06:1c:a1:c1:35:64:54:82:54:af:
                    b8:4b:40:6f:e0:73:86:4e:c1:c6:75:b8:c8:30:ac:
                    69:16:e8:68:25:cb:dd:e8:53:55:ec:7a:bd:a9:d3:
                    42:44:7f:e5:f5:52:dd:99:ae:c2:1a:a2:06:1f:be:
                    1b:e6:3e:69:87:a3:fc:91:21:39:b0:a7:67:11:f2:
                    3c:55:c6:4b:04:15:1b:ff:49:14:88:c4:58:87:79:
                    96:5b:6e:00:1c:c1:e7:2c:53:0c:d1:77:dc:a8:82:
                    cc:fa:26:c1:bb:6c:df:a8:43:0c:b7:cc:f0:a2:11:
                    9b:e8:3f:8a:1d:ed:2a:ff:1f:d1:03:eb:8a:b9:98:
                    40:18:83:24:4f:14:95:a3:59:ef:67:0f:35:6d:ae:
                    91:81:b2:04:02:16:80:d1:39:bd:70:cf:0f:cb:9a:
                    81:39:d9:fe:52:a5:cf:79:4f:a3:69:d8:0d:39:6a:
                    48:24:8d:2b:88:04:fa:81:de:65:50:7d:1a:3d:cd:
                    f3:1c:42:63:29:75:a0:9b:8e:16:44:3a:89:d6:2b:
                    41:76:65:a5:2e:c8:b6:d2:89:42:5d:21:24:33:30:
                    f0:9d:0b:4d:cf:78:d5:45:2d:49:5a:55:50:98:93:
                    03:f5
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Authority Key Identifier:
                keyid:BA:31:8A:9C:ED:EB:49:D2:54:09:98:D9:4C:3A:9C:42:D0:64:8D:B2

            X509v3 Subject Alternative Name: critical
                URI:spiffe://cluster.local/ns/default/sa/httpbin
    Signature Algorithm: sha256WithRSAEncryption
         90:7f:cb:6f:0b:16:cb:59:7d:f4:87:a7:5a:38:fa:0a:16:d8:
         83:0d:b1:36:77:a2:4a:fe:38:52:ab:49:e9:89:50:1a:4c:e9:
         94:07:37:7f:27:bc:2c:ce:c1:d2:33:75:5d:b6:ab:ae:cb:2e:
         71:f4:22:c0:40:15:27:02:75:c1:32:2e:83:49:73:6c:9a:ea:
         04:ef:55:2d:8d:71:30:9b:e4:30:dd:95:20:0d:7c:d2:f4:30:
         2f:07:2e:9f:53:37:e6:3d:14:c7:41:f4:09:8b:a3:76:56:c7:
         c7:92:0f:fc:17:5a:5a:32:6c:9e:87:18:2e:51:75:54:68:d8:
         01:c1:07:cc:b0:35:bf:0b:6c:62:a6:5b:23:61:35:c8:4f:7f:
         e7:1f:a0:e9:11:44:a6:17:52:4d:00:40:21:de:63:ee:02:c8:
         2b:5d:a1:7a:5d:7f:d5:d3:c1:7d:5f:00:40:e8:80:8d:cc:e9:
         8a:c6:b4:98:fe:7a:7d:37:0c:6f:4c:31:91:7a:79:30:84:cd:
         01:a7:14:f6:1b:33:8f:0f:50:1c:36:38:6b:24:da:cf:49:8a:
         5b:28:cf:27:76:e1:a5:c7:e6:d5:6e:d8:36:85:aa:1f:a5:ac:
         fa:f1:2e:a2:36:2e:25:b0:71:24:d1:3e:d5:e5:19:2b:0b:6f:
         b7:17:e4:75
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¯ä¹¦ä¸­å„ä¸ªå­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯ä¹¦ç‰ˆæœ¬ï¼ˆVersionï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦çš„ç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;li&gt;åºåˆ—å·ï¼ˆSerial Numberï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦çš„å”¯ä¸€åºåˆ—å·ã€‚&lt;/li&gt;
&lt;li&gt;ç­¾åç®—æ³•ï¼ˆSignature Algorithmï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦çš„ç­¾åç®—æ³•ï¼Œä¾‹å¦‚ RSAã€DSA æˆ– ECDSA ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;è¯ä¹¦é¢å‘æœºæ„ï¼ˆIssuerï¼‰ï¼šè¡¨ç¤ºé¢å‘è¯¥è¯ä¹¦çš„å¯ä¿¡çš„ç¬¬ä¸‰æ–¹æœºæ„çš„åç§°ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰æ•ˆæœŸï¼ˆValidityï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼ŒåŒ…æ‹¬è¯ä¹¦ç”Ÿæ•ˆæ—¥æœŸï¼ˆNot Beforeï¼‰å’Œè¯ä¹¦å¤±æ•ˆæ—¥æœŸï¼ˆNot Afterï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è€…ï¼ˆSubjectï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦æ‰€æœ‰è€…çš„åç§°ã€‚&lt;/li&gt;
&lt;li&gt;å…¬é’¥ä¿¡æ¯ï¼ˆSubject Public Key Infoï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦æ‰€æœ‰è€…çš„å…¬é’¥ä»¥åŠå…¬é’¥çš„ç®—æ³•ã€‚&lt;/li&gt;
&lt;li&gt;æ‰©å±•ï¼ˆExtensionsï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦çš„æ‰©å±•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;å¯†é’¥ç”¨æ³•æ‰©å±•ï¼ˆKey Usage Extensionï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦æ‰€æœ‰è€…çš„å¯†é’¥å¯ç”¨äºå“ªäº›æ“ä½œï¼Œä¾‹å¦‚æ•°å­—ç­¾åã€å¯†é’¥åŠ å¯†ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰©å±•å¯†é’¥ç”¨æ³•æ‰©å±•ï¼ˆExtended Key Usage Extensionï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦æ‰€æœ‰è€…çš„å¯†é’¥å¯ç”¨äºå“ªäº›æ‰©å±•çš„æ“ä½œï¼Œä¾‹å¦‚ TLS Web Server Authenticationã€TLS Web Client Authentication ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;åŸºæœ¬çº¦æŸæ‰©å±•ï¼ˆBasic Constraints Extensionï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦æ‰€æœ‰è€…æ˜¯å¦æ˜¯è¯ä¹¦é¢å‘æœºæ„çš„ä¸‹çº§æœºæ„ï¼Œä»¥åŠæ˜¯å¦å…è®¸å…¶ä½œä¸ºè¯ä¹¦é¢å‘æœºæ„é¢å‘å…¶ä»–è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»ä½“å¯†é’¥è¡¨ç¤ºæ‰©å±•ï¼ˆAuthority Key Identifierï¼‰ï¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºè¡¨ç¤ºè¯ä¹¦é¢å‘æœºæ„çš„å¯†é’¥ã€‚è¿™äº›æ ‡è¯†ç¬¦å¯ä»¥æ˜¯è¯ä¹¦é¢å‘æœºæ„çš„å…¬é’¥å“ˆå¸Œå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦åºåˆ—å·ã€‚è¯¥æ‰©å±•ç”¨äºéªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Œä¾‹å¦‚åœ¨éªŒè¯è¯ä¹¦é“¾æ—¶ï¼Œç”¨äºéªŒè¯è¯ä¹¦é¢å‘æœºæ„æ˜¯å¦ä¸ºå¯ä¿¡çš„æœºæ„ã€‚è¿™ä¸ªæ‰©å±•å­—æ®µæ˜¯å¯é€‰çš„ï¼Œä½†åœ¨è®¸å¤šæƒ…å†µä¸‹éƒ½ä¼šè¢«ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»ä½“æ›¿ä»£åç§°æ‰©å±•ï¼ˆSubject Alternative Name Extensionï¼‰ï¼šè¡¨ç¤ºè¯ä¹¦æ‰€æœ‰è€…çš„å…¶ä»–åç§°ï¼Œä¾‹å¦‚åŸŸåã€IP åœ°å€ã€ç”µå­é‚®ä»¶åœ°å€ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;certificate-trust-chain&#34;&gt;è¯ä¹¦ä¿¡ä»»é“¾&lt;/h3&gt;
&lt;p&gt;è¯ä¹¦çš„éªŒè¯éœ€è¦é€šè¿‡è¯ä¹¦ä¿¡ä»»é“¾ï¼ˆCertificate Trust Chainï¼‰ã€‚è¯ä¹¦ä¿¡ä»»é“¾æ˜¯æŒ‡ç”¨äºèº«ä»½éªŒè¯çš„ä¸€ç³»åˆ—è¯ä¹¦ï¼Œå®ƒä»¬å½¢æˆä¸€æ¡ä»ä¸€ä¸ªå¯ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„å¼€å§‹ï¼Œé€çº§å‘ä¸‹è¿æ¥ï¼Œç›´åˆ°ç”¨äºéªŒè¯æŸä¸ªç‰¹å®šè¯ä¹¦çš„ä¸­é—´è¯ä¹¦æˆ–ç»ˆç«¯è¯ä¹¦çš„ä¸€ç§æ–¹å¼ã€‚è¯ä¹¦ä¿¡ä»»é“¾å…è®¸æ•°å­—è¯ä¹¦çš„å¯ä¿¡åº¦éšç€è¯ä¹¦çº§åˆ«çš„å‡é«˜è€Œæé«˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸‹é¢çš„è¯ä¹¦ä¿¡ä»»é“¾ç¤ºæ„å›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å››æ¡ä¿¡ä»»é“¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-certificates-management/certificate-trust-chain.svg&#34; data-img=&#34;/blog/istio-certificates-management/certificate-trust-chain.svg&#34; alt=&#34;image&#34; data-caption=&#34;è¯ä¹¦ä¿¡ä»»é“¾&#34;&gt;
    
  
  &lt;figcaption&gt;è¯ä¹¦ä¿¡ä»»é“¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯ä¹¦çš„ä¿¡ä»»é“¾æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ª CA éƒ½å¯ä»¥æœ‰ä¸€æˆ–å¤šä¸ªå­ CAï¼Œä¸€å…±æœ‰ä¸‰ç§è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹ CAï¼šæœ€é¡¶å±‚çš„ CAï¼Œå¯ä»¥é¢å‘è¯ä¹¦ç»™ä¸­é—´ CAï¼›&lt;/li&gt;
&lt;li&gt;ä¸­é—´ CAï¼šé™¤æ ¹ CA ä»¥å¤–çš„ CAï¼Œå¯é¢å‘ç»ˆç«¯è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;ç»ˆç«¯å®ä½“ï¼šæ‹¥æœ‰ç»ˆç«¯è¯ä¹¦çš„è®¾å¤‡æˆ–æœåŠ¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¹ CA æ˜¯æ•°å­—è¯ä¹¦çš„æœ€é¡¶çº§é¢å‘æœºæ„ï¼Œå› æ­¤å®ƒæ‰€é¢å‘çš„è¯ä¹¦æ˜¯æœ€å¯ä¿¡çš„ã€‚æ ¹è¯ä¹¦é¢å‘æœºæ„é€šå¸¸ç”±æ”¿åºœæœºæ„æˆ–å…¶ä»–æƒå¨æœºæ„ï¼ˆå¦‚å›½é™…åŸºç¡€è®¾æ–½å®‰å…¨ç»„ç»‡ï¼‰ç»è¥å’Œç›‘ç®¡ã€‚å¸¸è§çš„æ ¹ CA åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Symantec/VeriSign&lt;/li&gt;
&lt;li&gt;Comodo&lt;/li&gt;
&lt;li&gt;DigiCert&lt;/li&gt;
&lt;li&gt;GlobalSign&lt;/li&gt;
&lt;li&gt;GoDaddy&lt;/li&gt;
&lt;li&gt;Entrust&lt;/li&gt;
&lt;li&gt;GeoTrust&lt;/li&gt;
&lt;li&gt;RapidSSL&lt;/li&gt;
&lt;li&gt;Baltimore CyberTrust Root&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œä¸Šè¿°åˆ—è¡¨åªæ˜¯ä¸€ä¸ªæ ·ä¾‹ï¼Œå®é™…ä¸Šæœ‰è®¸å¤šå…¶ä»–æ ¹ CAã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€ä¸€ä¸ª HTTPS ç½‘é¡µï¼Œä½ å¯ä»¥é€šè¿‡ç‚¹å‡»åœ°å€æ å·¦ä¾§çš„é”å›¾æ ‡æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬è¯ä¹¦ä¿¡ä»»é“¾ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://tetrate.io&#34; title=&#34;https://tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://tetrate.io&lt;/a&gt;
 çš„è¯ä¹¦ä¿¡ä»»é“¾å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;tetrate-cert.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Tetrate.io çš„è¯ä¹¦ä¿¡ä»»é“¾&#34; width=&#34;60%&#34;data-img=&#34;tetrate-cert.jpg&#34;
         data-caption=&#34;Tetrate.io çš„è¯ä¹¦ä¿¡ä»»é“¾&#34;
         
         
         data-width=&#34;800&#34;
         data-height=&#34;979&#34;
         
         
    /&gt;&lt;figcaption&gt;
            Tetrate.io çš„è¯ä¹¦ä¿¡ä»»é“¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;è¯ä¹¦ä¿¡ä»»é“¾å…è®¸å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼ŒWeb æµè§ˆå™¨ï¼‰åœ¨éªŒè¯ç»ˆç«¯è¯ä¹¦æ—¶ï¼Œé€çº§å‘ä¸ŠéªŒè¯æ¯ä¸ªè¯ä¹¦ï¼Œä»¥ç¡®å®šå®ƒæ˜¯å¦å¯ä¿¡ã€‚æ•°å­—è¯ä¹¦ç­¾å‘çš„åŸç†æ˜¯ CA å°†è¯ä¹¦æ‹¥æœ‰è€…çš„å…¬é’¥ä¸èº«ä»½ä¿¡æ¯ç»‘å®šåœ¨ä¸€èµ·ï¼Œç„¶å CA ä½¿ç”¨å…¶ä¸“æœ‰çš„ç§é’¥ç”Ÿæˆæ­£å¼çš„æ•°å­—ç­¾åï¼Œç”¨ä»¥è¡¨ç¤ºè¿™ä¸ªè¯ä¹¦æ˜¯ç» CA ç­¾å‘çš„ã€‚åœ¨è¯ä¹¦æ ¡éªŒæ—¶ä½¿ç”¨ CA çš„å…¬é’¥å¯¹è¿™ä¸ªè¯ä¹¦ä¸Šçš„æ•°å­—ç­¾å­—è¿›è¡ŒéªŒè¯å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-pki&#34;&gt;å°† Istio çº³å…¥ PKI è¯ä¹¦ä¿¡ä»»é“¾&lt;/h2&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ Istio ä¹‹å‰ï¼Œä¼ä¸šé€šå¸¸æœ‰è‡ªå·±çš„å†…éƒ¨ PKIï¼ˆå…¬é’¥åŸºç¡€è®¾æ–½ï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•å°† Istio çº³å…¥åˆ° PKI çš„è¯ä¹¦ä¿¡ä»»é“¾ä¸­å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ Istio å†…ç½®äº†è¯ä¹¦ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å¼€ç®±å³ç”¨ï¼ŒIstio å¯åŠ¨æ—¶ä¼šä¸º &lt;em&gt;istiod&lt;/em&gt; åˆ›å»ºè‡ªç­¾åè¯ä¹¦ï¼Œä½œä¸ºç½‘æ ¼å†…æ‰€æœ‰å·¥ä½œè´Ÿè½½çš„æ ¹è¯ä¹¦ã€‚è¿™æ ·åšæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ æœ‰å¤šç½‘æ ¼ï¼Œå†…ç½®çš„æ ¹è¯ä¹¦æ— æ³•åšåˆ°ç½‘æ ¼é—´äº’ä¿¡ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä¸ä½¿ç”¨ Istio è‡ªç­¾åè¯ä¹¦ï¼Œè€Œæ˜¯å°† Istio çº³å…¥åˆ°ä½ çš„è¯ä¹¦ä¿¡ä»»é“¾ä¸­ï¼Œå°† Istio é›†æˆåˆ°ä½ çš„ PKIï¼Œä¸º PKI æ¯ä¸ªç½‘æ ¼åˆ›å»ºä¸€ä¸ªä¸­é—´è¯ä¹¦ï¼Œè¿™æ ·ä¸¤ä¸ªç½‘æ ¼æ‹¥æœ‰äº†å…±åŒçš„ä¿¡ä»»æ ¹ï¼Œå°±å¯ä»¥åšåˆ°ç½‘æ ¼é—´äº’ä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸º Istio ç½‘æ ¼åˆ›å»ºä¸­é—´ CA ä½¿å…¶çº³å…¥åˆ°ä¼ä¸šå†…éƒ¨ PKI è¯ä¹¦ä¿¡ä»»é“¾ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-certificates-management/cluster-ca.svg&#34; data-img=&#34;/blog/istio-certificates-management/cluster-ca.svg&#34; alt=&#34;image&#34; data-caption=&#34;ä¸ºå¤šç½‘æ ¼åˆ›å»ºä¸­é—´ CA ä½¿å¾— Istio çº³å…¥åˆ°ä¼ä¸šå†…éƒ¨ PKI è¯ä¹¦ä¿¡ä»»é“¾&#34;&gt;
    
  
  &lt;figcaption&gt;ä¸ºå¤šç½‘æ ¼åˆ›å»ºä¸­é—´ CA ä½¿å¾— Istio çº³å…¥åˆ°ä¼ä¸šå†…éƒ¨ PKI è¯ä¹¦ä¿¡ä»»é“¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å°† Istio çº³å…¥ä¼ä¸šå†…éƒ¨ PKI è¯ä¹¦ä¿¡ä»»é“¾åæœ‰è¯¸å¤šå¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥å®ç°è·¨ç½‘æ ¼/é›†ç¾¤ä¹‹é—´çš„é€šä¿¡ï¼šæœ‰äº†å…±åŒçš„ä¿¡ä»»æ ¹ï¼Œé›†ç¾¤ä¹‹é—´å°±å¯ä»¥äº’ç›¸éªŒè¯èº«ä»½ï¼Œè¿›è€Œå®ç°è·¨é›†ç¾¤é€šä¿¡ï¼›&lt;/li&gt;
&lt;li&gt;æ›´ç»†ç²’åº¦çš„è¯ä¹¦æ’¤é”€ï¼šä½ å¯ä»¥æ’¤é”€æŸä¸ªå®ä½“æˆ–ä¸­é—´ CA çš„è¯ä¹¦æ¥æ’¤é”€æŸä¸ªæœåŠ¡æˆ–é›†ç¾¤çš„è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;è½»æ¾å®ç°è¯ä¹¦è½®æ¢ï¼šä½ å¯ä»¥æŒ‰é›†ç¾¤/ç½‘æ ¼å®ç°è¯ä¹¦è½®æ¢ï¼Œè€Œä¸æ˜¯è½®æ¢æ ¹èŠ‚ç‚¹è¯ä¹¦ï¼Œè¿™æ ·ä¼šå‡å°‘åœæœºæ—¶é—´ï¼Œæ¨èæ‚¨ä½¿ç”¨ &lt;a href=&#34;https://github.com/cert-manager/cert-manager&#34; title=&#34;cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager&lt;/a&gt;
 æ¥å®ç°è‡ªåŠ¨åŒ–çš„å¤§è§„æ¨¡ CA è¯ä¹¦è½®æ¢ï¼Œè¯¦æƒ…è¯·å‚è€ƒ&lt;a href=&#34;https://lib.jimmysong.io/blog/automate-istio-ca-rotation-in-production-at-scale/&#34; title=&#34;åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è‡ªåŠ¨åŒ– Istio CA è½®æ¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è‡ªåŠ¨åŒ– Istio CA è½®æ¢&lt;/a&gt;
ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºå°† Istio çº³å…¥ä¼ä¸šå†…éƒ¨ PKI çš„è¯ä¹¦ä¿¡ä»»é“¾çš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ&lt;a href=&#34;https://lib.jimmysong.io/blog/istio-trust/&#34; title=&#34;è¿™ç¯‡åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡åšå®¢&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-custom-ca&#34;&gt;Istio ä¸­ä½¿ç”¨è‡ªå®šä¹‰ CA çš„æ­¥éª¤&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio CA ä¼šç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„æ ¹è¯ä¹¦å’Œå¯†é’¥ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥ç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ã€‚ä¸ºäº†ä¿æŠ¤æ ¹ CA å¯†é’¥ï¼Œä½ åº”è¯¥ä½¿ç”¨åœ¨å®‰å…¨æœºå™¨ä¸Šç¦»çº¿è¿è¡Œçš„æ ¹ CAï¼Œå¹¶ä½¿ç”¨æ ¹ CA å‘è¿è¡Œåœ¨æ¯ä¸ªé›†ç¾¤ä¸Šçš„ Istio CA ç­¾å‘ä¸­é—´è¯ä¹¦ã€‚Istio CA å¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜æŒ‡å®šçš„è¯ä¹¦å’Œå¯†é’¥æ¥ç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ï¼Œå¹¶å°†ç®¡ç†å‘˜æŒ‡å®šçš„æ ¹è¯ä¹¦ä½œä¸ºä¿¡ä»»æ ¹åˆ†é…ç»™å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Istio ä¸­çš„è¯ä¹¦ç­¾å‘å’ŒæŒ‚è½½è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-certificates-management/cert-process.svg&#34; data-img=&#34;/blog/istio-certificates-management/cert-process.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­çš„è¯ä¹¦ç­¾å‘å’ŒæŒ‚è½½è¿‡ç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;Istio ä¸­çš„è¯ä¹¦ç­¾å‘å’ŒæŒ‚è½½è¿‡ç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Istio å‘ Pod ä¸­æ³¨å…¥çš„ Envoy ä»£ç†ä¸­æœ‰ä¸¤ä¸ªè¿›ç¨‹â€”â€”&lt;code&gt;envoy&lt;/code&gt; å’Œ &lt;code&gt;pilot-agent&lt;/code&gt;ã€‚&lt;code&gt;pilot-agent&lt;/code&gt; ä¸º Envoy ç”Ÿæˆç§é’¥ï¼Œé€šè¿‡ UNIX Domain Socektï¼ˆUDSï¼‰ä½¿ç”¨ Secret Discovery Serviceï¼ˆSDSï¼‰å‘ CA å‘èµ·è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ï¼Œå¦‚æœä½ æ²¡æœ‰é…ç½® CA æ’ä»¶çš„è¯ï¼ŒIstio é»˜è®¤å‘ &lt;em&gt;istiod&lt;/em&gt; å‘èµ· CSRï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;istiod&lt;/code&gt; å†…ç½® CA å‘ &lt;code&gt;pilot-agent&lt;/code&gt; è¿”å›è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pilot-agent&lt;/code&gt; å°†ç”Ÿæˆçš„ç§é’¥å’Œ CA è¿”å›çš„è¯ä¹¦å‘é€ç»™ &lt;code&gt;envoy&lt;/code&gt; æŒ‚è½½ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Istio é»˜è®¤ä½¿ç”¨å†…ç½®äº &lt;em&gt;istiod&lt;/em&gt; ä¸­çš„ CAï¼Œä¹Ÿæ”¯æŒæ’å…¥å…¶ä»– CAï¼Œè§ &lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/security/cert-management/plugin-ca-cert/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚è‹¥æƒ³ä½¿ç”¨è‡ªå®šä¹‰çš„ CA è¯ä¹¦å’Œå¯†é’¥ä¸ºæœåŠ¡åˆ›å»ºèº«ä»½ï¼Œä½ éœ€è¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º CA é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºè‡ªç­¾åçš„ CA æ ¹è¯ä¹¦å’Œå¯†é’¥ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºæœåŠ¡åˆ›å»ºç§é’¥ã€ç­¾åè¯·æ±‚é…ç½®æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºæœåŠ¡åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ ¹è¯ä¹¦å’Œå¯†é’¥ä»¥åŠæœåŠ¡çš„ç­¾åè¯·æ±‚æ–‡ä»¶ä¸ºæœåŠ¡åˆ›å»ºè¯ä¹¦ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»¥ä¸º Bookinfo çš„ productpage æœåŠ¡åˆ›å»ºå’ŒæŒ‚è½½è¯ä¹¦ä¸ºä¾‹è¯¦è¿° Istio å†…ç½® CA ç­¾å‘è¯ä¹¦çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ca&#34;&gt;Istio å†…ç½® CA ç­¾å‘è¯ä¹¦æµç¨‹ &lt;/h2&gt;
&lt;p&gt;Istio å¯åŠ¨æ—¶å°†åˆ›å»ºä¸€ä¸ªè‡ªç­¾åçš„ CA è¯ä¹¦ï¼Œç„¶åå†ç”¨è¯¥ CA è¯ä¹¦ä¸ºç½‘æ ¼å†…çš„æœåŠ¡é¢å‘è¯ä¹¦ã€‚ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿ Istio å†…ç½® CA ç­¾å‘è¯ä¹¦çš„æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»º CA ç§é’¥ &lt;code&gt;ca.key&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl genrsa -out ca.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»º CA é…ç½®æ–‡ä»¶ &lt;code&gt;ca.conf&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[ req ]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;default_bits&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;2048&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;utf8&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;encrypt_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;distinguished_name&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;req_dn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;req_extensions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;req_ext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;x509_extensions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;req_ext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[ req_dn ]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;O&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Istio&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;CN&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Root CA&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[ req_ext ]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;subjectKeyIdentifier&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;hash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;basicConstraints&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;critical, CA:true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;keyUsage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;critical, digitalSignature, nonRepudiation, keyEncipherment, keyCertSign&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ CA ç§é’¥ &lt;code&gt;ca.key&lt;/code&gt; ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ &lt;code&gt;ca.pem&lt;/code&gt;ï¼Œå…¶ä¸­ä¸»é¢˜ä¸­åŒ…å« CA çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl req -x509 -new -nodes -key ca.key -days &lt;span class=&#34;m&#34;&gt;365&lt;/span&gt; -out ca.pem -config ca.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº PEM æ–‡ä»¶
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;p&gt;PEM æ–‡ä»¶æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨è¯ä¹¦ã€å…¬é’¥æˆ–ç§é’¥çš„æ–‡ä»¶ã€‚å®ƒé‡‡ç”¨ Base64 ç¼–ç çš„ ASCII æ ¼å¼ï¼Œå¹¶ä½¿ç”¨ç‰¹å®šçš„æ–‡ä»¶æ‰©å±•åï¼Œä¾‹å¦‚ &lt;code&gt;.pem&lt;/code&gt;ã€&lt;code&gt;.crt&lt;/code&gt;ã€&lt;code&gt;.cer&lt;/code&gt; æˆ– &lt;code&gt;.key&lt;/code&gt;ã€‚PEM æ–‡ä»¶é€šå¸¸ç”¨äºå­˜å‚¨åŠ å¯†å¯†é’¥ã€æ•°å­—è¯ä¹¦å’Œå…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;PEM æ–‡ä»¶çš„å†…å®¹é€šå¸¸ä»¥ä¸€ç»„ç‰¹å®šçš„æ ‡å¤´å’Œè„šæœ¬å¼€å§‹ï¼Œä¾‹å¦‚ &lt;code&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/code&gt; å’Œ &lt;code&gt;-----END RSA PRIVATE KEY-----&lt;/code&gt;ã€‚è¿™äº›æ ‡å¤´å’Œè„šæœ¬æŒ‡å®šäº†æ–‡ä»¶çš„ç±»å‹å’Œæ•°æ®çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;PEM æ–‡ä»¶å¯ä»¥é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥æ‰“å¼€ï¼Œä½†å¹¶ä¸å¯è¯»ï¼Œå› ä¸ºå®ƒæ˜¯ç”±äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ DERï¼ˆå¯åˆ†è¾¨ç¼–ç è§„åˆ™ï¼‰è½¬åŒ–è€Œæ¥ï¼Œè¦æƒ³è§£æå®ƒéœ€è¦ä½¿ç”¨ç‰¹åˆ«çš„å·¥å…·ï¼Œä¾‹å¦‚ OpenSSLã€‚&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºç§é’¥ &lt;code&gt;workload.key&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl genrsa -out workload.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚é…ç½®æ–‡ä»¶ &lt;code&gt;csr.conf&lt;/code&gt;ï¼Œå…¶ä¸­åŒ…å« CA çš„åœ°å€åŠé™„åŠ ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[ req ]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;default_bits&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;2048&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;utf8&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;encrypt_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;distinguished_name&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;req_extensions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;req_ext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;x509_extensions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;req_ext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[ req_dn ]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;O&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Istio&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;CN&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;productpage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[ req_ext ]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;subjectKeyIdentifier&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;hash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;basicConstraints&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;critical, CA:true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;keyUsage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;critical, digitalSignature, nonRepudiation, keyEncipherment, keyCertSign&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºå·¥ä½œè´Ÿè½½çš„ CSR é…ç½®æ–‡ä»¶ &lt;code&gt;csr.conf&lt;/code&gt; å’Œå·¥ä½œè´Ÿè½½çš„ç§é’¥æ–‡ä»¶ &lt;code&gt;workload.key&lt;/code&gt; åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚ &lt;code&gt;workload.csr&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl req -new -key workload.key -out workload.csr -config csr.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäº CA çš„ç§é’¥ &lt;code&gt;ca.key&lt;/code&gt;ã€CA çš„è¯ä¹¦ &lt;code&gt;ca.pem&lt;/code&gt; å’Œå·¥ä½œè´Ÿè½½çš„è¯ä¹¦ç­¾åè¯·æ±‚åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦ &lt;code&gt;workload.pem&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl x509 -req -in workload.csr -CA ca.pem -CAkey ca.key &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -CAcreateserial -out workload.pem -days &lt;span class=&#34;m&#34;&gt;365&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -extensions req_ext -extfile csr.conf -sha256
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Istiod åœ¨æ”¶åˆ°å·¥ä½œè´Ÿè½½çš„ CSR åå°†æ ¹è¯ä¹¦ &lt;code&gt;ca.pem&lt;/code&gt; å’ŒæœåŠ¡è¯ä¹¦ä¸‹å‘ç»™å·¥ä½œè´Ÿè½½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥çœ‹å·¥ä½œè´Ÿè½½ä¸­ Envoy ä»£ç†æŒ‚è½½çš„è¯ä¹¦é“¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl proxy-config secret deployment/productpage-v1 -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;chain.pem&lt;/code&gt; æ–‡ä»¶ä¸­ä¿å­˜ç€ &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡çš„è¯ä¹¦é“¾ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„ Istio å†…ç½® CA ä½œä¸ºæ ¹ CAï¼Œæ‰€ä»¥è¯¥æ–‡ä»¶ä¸­åªä¿å­˜æœ‰ä¸€ä¸ªè¯ä¹¦ï¼Œå¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl x509 -noout -text -in chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥çœ‹ Envoy ä»£ç†æŒ‚è½½çš„æ ¹è¯ä¹¦ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl proxy-config secret deployment/productpage-v1 -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[1].secret.validationContext.trustedCa.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; root.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;root.pem&lt;/code&gt; å³ä¸ºæ ¹è¯ä¹¦ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl x509 -noout -text -in root.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  æç¤º
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;code&gt;root.pem&lt;/code&gt; ä¸­çš„å†…å®¹ä¸ &lt;code&gt;istiod-ca-cert&lt;/code&gt; ConfigMap ä¸­çš„ &lt;code&gt;root-cert.pem&lt;/code&gt; åŠ &lt;code&gt;istio-ca-secret&lt;/code&gt; ä¸­çš„ &lt;code&gt;ca-cert.pem&lt;/code&gt; æ˜¯ä¸€æ ·çš„ï¼Œè™½ç„¶ç°åœ¨ Envoy å·²ä¸åœ¨é€šè¿‡è¯»å–æŒ‚è½½å·æ¥è·å¾—è¯ä¹¦å†…å®¹ï¼Œä½†ä¹‹æ‰€ä»¥ä¿ç•™äº†è¿™äº›å·æ˜¯ä¸ºäº†å‘åå…¼å®¹ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è¯ä¹¦æŒ‚è½½åˆ° Envoy ä»£ç†ä¹‹åï¼Œ&lt;em&gt;istiod&lt;/em&gt; å°†è´Ÿè´£å®šæœŸæ›¿æ¢å¯†é’¥è¯ä¹¦ï¼Œä»¥åŠæ ¹æ®éœ€è¦æ’¤é”€å¯†é’¥è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡å‘ä½ ä»‹ç»äº†æ•°å­—è¯ä¹¦çš„ä½œç”¨ã€ç»„æˆå’Œè¯ä¹¦ä¿¡ä»»é“¾ï¼Œä»¥åŠ Istio ä¸­å†…ç½®çš„å¼€ç®±å³ç”¨çš„è¯ä¹¦ç®¡ç†å™¨è¿ä½œçš„æµç¨‹ã€‚ä½†æ˜¯ Istio å†…ç½® CA ä»ç„¶æœ‰ä¸€å®šé™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­æˆ‘å°†å‘ä½ ä»‹ç»å¦‚ä½•ä½¿ç”¨æ’ä»¶ SPIRE å’Œ cert-manager æ¥å®ç°ç»†ç²’åº¦çš„è¯ä¹¦ç®¡ç†å’Œè‡ªåŠ¨è¯ä¹¦è½®æ¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/security/cert-management/plugin-ca-cert/&#34; title=&#34;æ’å…¥ CA è¯ä¹¦ - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ’å…¥ CA è¯ä¹¦ - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.tetratelabs.io/zh/istio-in-practice/setting-up-ssl-certs/&#34; title=&#34;å¦‚ä½•è®¾ç½® SSL è¯ä¹¦ - istio.tetratelabs.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•è®¾ç½® SSL è¯ä¹¦ - istio.tetratelabs.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh-cn/docs/tasks/tls/managing-tls-in-a-cluster/&#34; title=&#34;ç®¡ç†é›†ç¾¤ä¸­çš„ TLS è®¤è¯ - kubernetes.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç†é›†ç¾¤ä¸­çš„ TLS è®¤è¯ - kubernetes.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/certificates/&#34; title=&#34;æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦ - kubernetes.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦ - kubernetes.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/istio-trust/&#34; title=&#34;å°† Istio çº³å…¥ä¿¡ä»»é“¾ï¼šä½¿ç”¨ç°æœ‰ PKI ä½œä¸ºä¿¡ä»»æ ¹ - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°† Istio çº³å…¥ä¿¡ä»»é“¾ï¼šä½¿ç”¨ç°æœ‰ PKI ä½œä¸ºä¿¡ä»»æ ¹ - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/&#34; title=&#34;å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ä½œä¸ºä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ Istio è¯ä¹¦ - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ä½œä¸ºä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ Istio è¯ä¹¦ - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ SkyWalking è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼Ÿ</title>
      <link>https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/</link>
      <pubDate>Wed, 07 Dec 2022 11:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨äº‘åŸç”Ÿåº”ç”¨ä¸­ï¼Œä¸€æ¬¡è¯·æ±‚å¾€å¾€éœ€è¦ç»è¿‡ä¸€ç³»åˆ—çš„ API æˆ–åå°æœåŠ¡å¤„ç†æ‰èƒ½å®Œæˆï¼Œè¿™äº›æœåŠ¡æœ‰äº›æ˜¯å¹¶è¡Œçš„ï¼Œæœ‰äº›æ˜¯ä¸²è¡Œçš„ï¼Œè€Œä¸”ä½äºä¸åŒçš„å¹³å°æˆ–èŠ‚ç‚¹ã€‚é‚£ä¹ˆå¦‚ä½•ç¡®å®šä¸€æ¬¡è°ƒç”¨çš„ç»è¿‡çš„æœåŠ¡è·¯å¾„å’ŒèŠ‚ç‚¹ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œé—®é¢˜æ’æŸ¥ï¼Ÿè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ°åˆ†å¸ƒå¼è¿½è¸ªã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†å‘ä½ ä»‹ç»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†å¸ƒå¼è¿½è¸ªçš„åŸç†&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é€‰æ‹©åˆ†å¸ƒå¼è¿½è¸ªè½¯ä»¶&lt;/li&gt;
&lt;li&gt;åœ¨ Istio ä¸­å¦‚ä½•ä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ª&lt;/li&gt;
&lt;li&gt;ä»¥ Bookinfo å’Œ SkyWalking ä¸ºä¾‹è¯´æ˜å¦‚ä½•æŸ¥çœ‹åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;tracing-basic&#34;&gt;åˆ†å¸ƒå¼è¿½è¸ªåŸºç¡€&lt;/h2&gt;
&lt;p&gt;åˆ†å¸ƒå¼è¿½è¸ªæ˜¯ä¸€ç§ç”¨æ¥è·Ÿè¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¯·æ±‚çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£ã€æ§åˆ¶å’Œä¼˜åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿã€‚åˆ†å¸ƒå¼è¿½è¸ªä¸­ç”¨åˆ°äº†ä¸¤ä¸ªæ¦‚å¿µï¼šTraceID å’Œ SpanIDã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;TraceID æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªè¯·æ±‚çš„è¿½è¸ªä¿¡æ¯ã€‚ä¸€ä¸ªè¯·æ±‚çš„æ‰€æœ‰è¿½è¸ªä¿¡æ¯éƒ½å±äºåŒä¸€ä¸ª TraceIDï¼ŒTraceID åœ¨æ•´ä¸ªè¯·æ±‚çš„è¿½è¸ªè¿‡ç¨‹ä¸­éƒ½æ˜¯ä¸å˜çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SpanID æ˜¯ä¸€ä¸ªå±€éƒ¨å”¯ä¸€çš„ IDï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªè¯·æ±‚åœ¨æŸä¸€æ—¶åˆ»çš„è¿½è¸ªä¿¡æ¯ã€‚ä¸€ä¸ªè¯·æ±‚åœ¨ä¸åŒçš„æ—¶é—´æ®µä¼šäº§ç”Ÿä¸åŒçš„ SpanIDï¼ŒSpanID ç”¨æ¥åŒºåˆ†ä¸€ä¸ªè¯·æ±‚åœ¨ä¸åŒæ—¶é—´æ®µçš„è¿½è¸ªä¿¡æ¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;TraceID å’Œ SpanID æ˜¯åˆ†å¸ƒå¼è¿½è¸ªçš„åŸºç¡€ï¼Œå®ƒä»¬ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¯·æ±‚çš„è¿½è¸ªæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ ‡è¯†ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥è¯¢ã€ç®¡ç†å’Œåˆ†æè¯·æ±‚çš„è¿½è¸ªä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/basic.svg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/basic.svg&#34; alt=&#34;image&#34; data-caption=&#34;åˆ†å¸ƒå¼è¿½è¸ªåŸç†å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;åˆ†å¸ƒå¼è¿½è¸ªåŸç†å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åˆ†å¸ƒå¼è¿½è¸ªçš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“ä¸€ä¸ªç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¼šä¸ºè¯¥è¯·æ±‚åˆ†é…ä¸€ä¸ª TraceIDï¼Œç”¨äºä¸²è”èµ·æ•´ä¸ªè°ƒç”¨é“¾ï¼›&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¼šä¸ºè¯¥è¯·æ±‚åœ¨ç³»ç»Ÿå†…çš„æ¯ä¸€æ¬¡æœåŠ¡è°ƒç”¨ç”Ÿæˆä¸€ä¸ª SpanID å’Œ ParentIDï¼Œç”¨äºè®°å½•è°ƒç”¨çš„çˆ¶å­å…³ç³»ï¼Œæ²¡æœ‰ ParentID çš„ Span å°†ä½œä¸ºè°ƒç”¨é“¾çš„å…¥å£ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæœåŠ¡è°ƒç”¨è¿‡ç¨‹ä¸­éƒ½è¦ä¼ é€’ TraceID å’Œ SpanIDï¼›&lt;/li&gt;
&lt;li&gt;åœ¨æŸ¥çœ‹åˆ†å¸ƒå¼è¿½è¸ªæ—¶ï¼Œé€šè¿‡ TraceID æŸ¥è¯¢æŸæ¬¡è¯·æ±‚çš„å…¨è¿‡ç¨‹ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;distributed-tracing-in-istio&#34;&gt;Istio å¦‚ä½•å®ç°åˆ†å¸ƒå¼è¿½è¸ª&lt;/h2&gt;
&lt;p&gt;Istio ä¸­çš„åˆ†å¸ƒå¼è¿½è¸ªæ˜¯åŸºäºæ•°æ®å¹³é¢ä¸­çš„ Envoy ä»£ç†å®ç°çš„ã€‚æœåŠ¡è¯·æ±‚åœ¨è¢«åŠ«æŒåˆ° Envoy ä¸­åï¼ŒEnvoy åœ¨è½¬å‘è¯·æ±‚æ—¶ä¼šé™„åŠ å¤§é‡ Headerï¼Œå…¶ä¸­ä¸åˆ†å¸ƒå¼è¿½è¸ªç›¸å…³çš„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸º TraceIDï¼š&lt;code&gt;x-request-id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”¨äºåœ¨ LightStep è¿½è¸ªç³»ç»Ÿä¸­å»ºç«‹ Span çš„çˆ¶å­å…³ç³»ï¼š&lt;code&gt;x-ot-span-context&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”¨äº Zipkinï¼ŒåŒæ—¶é€‚ç”¨äº Jaegerã€SkyWalkingï¼Œè¯¦è§ &lt;a href=&#34;https://github.com/openzipkin/b3-propagation&#34; title=&#34;b3-propagation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;b3-propagation&lt;/a&gt;
ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;x-b3-traceid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x-b3-spanid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x-b3-parentspanid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x-b3-sampled&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x-b3-flags&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;b3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”¨äº Datadogï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;x-datadog-trace-id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x-datadog-parent-id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x-datadog-sampling-priority&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”¨äº SkyWalkingï¼š&lt;code&gt;sw8&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”¨äº AWS X-Rayï¼š&lt;code&gt;x-amzn-trace-id&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºè¿™äº› Header çš„è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/headers&#34; title=&#34;Envoy æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä¼šåœ¨ Ingress Gateway ä¸­ä¸ºä½ äº§ç”Ÿç”¨äºè¿½è¸ªçš„ Headerï¼Œä¸è®ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨ä½•ç§è¯­è¨€å¼€å‘ï¼ŒEnvoy éƒ½ä¼šå°†è¿™äº› Header è½¬å‘åˆ°ä¸Šæ¸¸é›†ç¾¤ã€‚ä½†æ˜¯ï¼Œä½ è¿˜è¦å¯¹åº”ç”¨ç¨‹åºä»£ç åšä¸€äº›å°çš„ä¿®æ”¹ï¼Œæ‰èƒ½ä¸ºä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ªåŠŸèƒ½ã€‚è¿™æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºæ— æ³•è‡ªåŠ¨ä¼ æ’­è¿™äº› Headerï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­é›†æˆåˆ†å¸ƒå¼è¿½è¸ªçš„ Agentï¼Œæˆ–è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨ä¼ æ’­è¿™äº› Headerã€‚Envoy ä¼šå°†è¿½è¸ªæ•°æ®å‘é€åˆ° tracer åç«¯å¤„ç†ï¼Œç„¶åå°±å¯ä»¥åœ¨ UI ä¸­æŸ¥çœ‹è¿½è¸ªæ•°æ®äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚åœ¨ Bookinfo åº”ç”¨ä¸­çš„ Productpage æœåŠ¡ï¼Œå¦‚æœä½ æŸ¥çœ‹å®ƒçš„ä»£ç å¯ä»¥å‘ç°ï¼Œå…¶ä¸­é›†æˆäº† Jaeger å®¢æˆ·ç«¯åº“ï¼Œå¹¶åœ¨ &lt;code&gt;getForwardHeaders (request)&lt;/code&gt; æ–¹æ³•ä¸­å°† Envoy ç”Ÿæˆçš„ Header åŒæ­¥ç»™å¯¹ Details å’Œ Reviews æœåŠ¡çš„ HTTP è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getForwardHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨ Jaeger agent è·å– x-b3-* header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;span&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_current_span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;carrier&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;tracer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;span_context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;span&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Format&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HTTP_HEADERS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;carrier&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;carrier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;carrier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# æ‰‹åŠ¨å¤„ç†é x-b3-* header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;user&amp;#39;&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end-user&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;incoming_headers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;x-request-id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;x-ot-span-context&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;x-datadog-trace-id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;x-datadog-parent-id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;x-datadog-sampling-priority&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;traceparent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;tracestate&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;x-cloud-trace-context&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;grpc-trace-bin&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;sw8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;user-agent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;cookie&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;authorization&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;jwt&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ihdr&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;incoming_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ihdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ihdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äº Istio ä¸­åˆ†å¸ƒå¼è¿½è¸ªçš„å¸¸è§é—®é¢˜è¯·è§ &lt;a href=&#34;https://istio.io/latest/zh/about/faq/#distributed-tracing&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;how-to-choose-a-distributed-tracing-system&#34;&gt;åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿå¦‚ä½•é€‰æ‹©&lt;/h2&gt;
&lt;p&gt;åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿçš„åŸç†ç±»ä¼¼ï¼Œå¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šè¿™æ ·çš„ç³»ç»Ÿï¼Œä¾‹å¦‚ &lt;a href=&#34;https://github.com/apache/skywalking&#34; title=&#34;Apache SkyWalking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache SkyWalking&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/jaegertracing/jaeger&#34; title=&#34;Jaeger&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jaeger&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/openzipkin/zipkin/&#34; title=&#34;Zipkin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Zipkin&lt;/a&gt;
ã€&lt;a href=&#34;https://lightstep.com/&#34; title=&#34;LightStep&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LightStep&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/pinpoint-apm/pinpoint&#34; title=&#34;Pinpoint&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pinpoint&lt;/a&gt;
 ç­‰ã€‚æˆ‘ä»¬å°†é€‰æ‹©å…¶ä¸­ä¸‰ä¸ªï¼Œä»å¤šä¸ªç»´åº¦è¿›è¡Œå¯¹æ¯”ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©å®ƒä»¬æ˜¯å› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒä»¬æ˜¯å½“å‰æœ€æµè¡Œçš„å¼€æºåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼›&lt;/li&gt;
&lt;li&gt;éƒ½æ˜¯åŸºäº OpenTracing è§„èŒƒï¼›&lt;/li&gt;
&lt;li&gt;éƒ½æ”¯æŒä¸ Istio åŠ Envoy é›†æˆï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»åˆ«&lt;/th&gt;
&lt;th&gt;Apache SkyWalking&lt;/th&gt;
&lt;th&gt;Jaeger&lt;/th&gt;
&lt;th&gt;Zipkin&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å®ç°æ–¹å¼&lt;/td&gt;
&lt;td&gt;åŸºäºè¯­è¨€çš„æ¢é’ˆã€æœåŠ¡ç½‘æ ¼æ¢é’ˆã€eBPF agentã€ç¬¬ä¸‰æ–¹æŒ‡æ ‡åº“ï¼ˆå½“å‰æ”¯æŒ Zipkinï¼‰&lt;/td&gt;
&lt;td&gt;åŸºäºè¯­è¨€çš„æ¢é’ˆ&lt;/td&gt;
&lt;td&gt;åŸºäºè¯­è¨€çš„æ¢é’ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®å­˜å‚¨&lt;/td&gt;
&lt;td&gt;ESã€H2ã€MySQLã€TiDBã€Sharding-sphereã€BanyanDB&lt;/td&gt;
&lt;td&gt;ESã€MySQLã€Cassandraã€å†…å­˜&lt;/td&gt;
&lt;td&gt;ESã€MySQLã€Cassandraã€å†…å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ”¯æŒè¯­è¨€&lt;/td&gt;
&lt;td&gt;Javaã€Rustã€PHPã€NodeJSã€Goã€Pythonã€C++ã€.NETã€Lua&lt;/td&gt;
&lt;td&gt;Javaã€Goã€Pythonã€NodeJSã€C#ã€PHPã€Rubyã€C++&lt;/td&gt;
&lt;td&gt;Javaã€Goã€Pythonã€NodeJSã€C#ã€PHPã€Rubyã€C++&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å‘èµ·è€…&lt;/td&gt;
&lt;td&gt;ä¸ªäºº&lt;/td&gt;
&lt;td&gt;Uber&lt;/td&gt;
&lt;td&gt;Twitter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ²»ç†æ–¹å¼&lt;/td&gt;
&lt;td&gt;Apache Foundation&lt;/td&gt;
&lt;td&gt;CNCF&lt;/td&gt;
&lt;td&gt;CNCF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;9.3.0&lt;/td&gt;
&lt;td&gt;1.39.0&lt;/td&gt;
&lt;td&gt;2.23.19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Star æ•°é‡&lt;/td&gt;
&lt;td&gt;20.9k&lt;/td&gt;
&lt;td&gt;16.8k&lt;/td&gt;
&lt;td&gt;15.8k&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;figcaption class=&#34;text-center&#34;&gt;
    åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿå¯¹æ¯”è¡¨ï¼ˆæ•°æ®æˆªæ­¢æ—¶é—´ 2022-12-07ï¼‰
&lt;/figcaption&gt;

&lt;p&gt;è™½ç„¶ Apache SkyWalking çš„ Agent æ”¯æŒçš„è¯­è¨€æ²¡æœ‰ Jaeger å’Œ Zipkin å¤šï¼Œä½†æ˜¯ SkyWalking çš„å®ç°æ–¹å¼æ›´ä¸°å¯Œï¼Œå¹¶ä¸”ä¸ Jaegerã€Zipkin çš„è¿½è¸ªæ•°æ®å…¼å®¹ï¼Œå¼€å‘æ›´ä¸ºæ´»è·ƒï¼Œä¸”ä¸ºå›½äººå¼€å‘ï¼Œä¸­æ–‡èµ„æ–™ä¸°å¯Œï¼Œæ˜¯æ„å»ºé¥æµ‹å¹³å°çš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;demo&#34;&gt;å®éªŒ&lt;/h2&gt;
&lt;p&gt;å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/distributed-tracing/skywalking/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
æ¥å®‰è£…å’Œé…ç½® Apache SkyWalkingã€‚&lt;/p&gt;
&lt;h3 id=&#34;environments&#34;&gt;ç¯å¢ƒè¯´æ˜&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘ä»¬å®éªŒçš„ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes 1.24.5&lt;/li&gt;
&lt;li&gt;Istio 1.16&lt;/li&gt;
&lt;li&gt;SkyWalking 9.1.0&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;install-istio&#34;&gt;å®‰è£… Istio&lt;/h3&gt;
&lt;p&gt;å®‰è£…ä¹‹å‰å¯ä»¥å…ˆæ£€æŸ¥ä¸‹ç¯å¢ƒæ˜¯å¦æœ‰é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl experimental precheck
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;âœ” No issues found when checking the cluster. Istio is safe to install or upgrade!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  To get started, check out https://istio.io/latest/docs/setup/getting-started/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå®‰è£… Istio åŒæ—¶é…ç½®å‘é€è¿½è¸ªä¿¡æ¯çš„ç›®çš„åœ°ä¸º SkyWalkingï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åˆå§‹åŒ– Istio Operator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl operator init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å®‰è£… Istio å¹¶é…ç½®ä½¿ç”¨ SkyWalking&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: install.istio.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: IstioOperator
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: istio-with-skywalking
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  meshConfig:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    defaultProviders:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      tracing:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      - &amp;#34;skywalking&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    enableTracing: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    extensionProviders:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - name: &amp;#34;skywalking&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      skywalking:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        service: tracing.istio-system.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        port: 11800
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;install-skywalking&#34;&gt;éƒ¨ç½² Apache SkyWalking&lt;/h3&gt;
&lt;p&gt;Istio 1.16 æ”¯æŒä½¿ç”¨ Apache SkyWalking è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç å®‰è£… SkyWalkingï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.16/samples/addons/extras/skywalking.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ƒå°†åœ¨ &lt;code&gt;istio-system&lt;/code&gt; å‘½åç©ºé—´ä¸‹å®‰è£…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://skywalking.apache.org/docs/main/v9.3.0/en/concepts-and-designs/backend-overview/&#34; title=&#34;SkyWalking OAP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SkyWalking OAP&lt;/a&gt;
 (Observability Analysis Platform) ï¼šç”¨äºæ¥æ”¶è¿½è¸ªæ•°æ®ï¼Œæ”¯æŒ SkyWalking åŸç”Ÿæ•°æ®æ ¼å¼ï¼ŒZipkin v1 å’Œ v2 ä»¥åŠ Jaeger æ ¼å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://skywalking.apache.org/docs/main/v9.3.0/en/ui/readme/&#34; title=&#34;UI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UI&lt;/a&gt;
ï¼šç”¨äºæŸ¥è¯¢åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº SkyWalking çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://skywalking.apache.org/docs/main/v9.3.0/readme/&#34; title=&#34;SkyWalking æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SkyWalking æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;install-bookinfo&#34;&gt;éƒ¨ç½² Bookinfo åº”ç”¨&lt;/h3&gt;
&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… bookinfo ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰“å¼€ SkyWalking UIï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl dashboard skywalking
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;SkyWalking çš„ General Service é¡µé¢å±•ç¤ºäº† bookinfo åº”ç”¨ä¸­çš„æ‰€æœ‰æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/general-service.jpg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/general-service.jpg&#34; data-width=&#34;1622&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;SkyWalking çš„ General Service é¡µé¢&#34;&gt;
    
  
  &lt;figcaption&gt;SkyWalking çš„ General Service é¡µé¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ è¿˜å¯ä»¥çœ‹åˆ°å®ä¾‹ã€ç«¯ç‚¹ã€æ‹“æ‰‘ã€è¿½è¸ªç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ä¸‹å›¾å±•ç¤ºäº† bookinfo åº”ç”¨çš„æœåŠ¡æ‹“æ‰‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/topology.jpg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/topology.jpg&#34; data-width=&#34;1622&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Bookinfo åº”ç”¨çš„æœåŠ¡æ‹“æ‰‘&#34;&gt;
    
  
  &lt;figcaption&gt;Bookinfo åº”ç”¨çš„æœåŠ¡æ‹“æ‰‘&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;SkyWalking çš„è¿½è¸ªè§†å›¾æœ‰å¤šç§æ˜¾ç¤ºå½¢å¼ï¼Œå¦‚åˆ—è¡¨ã€æ ‘å½¢ã€è¡¨æ ¼å’Œç»Ÿè®¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/gs-styles.jpg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/gs-styles.jpg&#34; data-width=&#34;2062&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;SkyWalking é€šç”¨æœåŠ¡è¿½è¸ªæ”¯æŒå¤šç§æ˜¾ç¤ºæ ·å¼&#34;&gt;
    
  
  &lt;figcaption&gt;SkyWalking é€šç”¨æœåŠ¡è¿½è¸ªæ”¯æŒå¤šç§æ˜¾ç¤ºæ ·å¼&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æ£€æŸ¥ï¼Œå°†è¿½è¸ªçš„é‡‡æ ·ç‡è®¾ç½®ä¸º 100%ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: telemetry.istio.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Telemetry
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: mesh-default
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  tracing:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - randomSamplingPercentage: 100.00
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;purge&#34;&gt;å¸è½½&lt;/h3&gt;
&lt;p&gt;åœ¨å®éªŒå®Œåï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¸è½½ Istio å’Œ SkyWalkingï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;samples/bookinfo/platform/kube/cleanup.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl unintall --purge
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;bookinfo-tracing&#34;&gt;Bookinfo demo è¿½è¸ªä¿¡æ¯è¯´æ˜&lt;/h2&gt;
&lt;p&gt;åœ¨ Apache SkyWalking UI ä¸­å¯¼èˆªåˆ° General Service åˆ†é¡µï¼ŒæŸ¥çœ‹æœ€è¿‘çš„ &lt;code&gt;istio-ingressgateway&lt;/code&gt; æœåŠ¡çš„è¿½è¸ªä¿¡æ¯ï¼Œè¡¨è§†å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚å›¾ä¸­å±•ç¤ºäº†æ­¤æ¬¡è¯·æ±‚æ‰€æœ‰ Span çš„åŸºæœ¬ä¿¡æ¯ï¼Œç‚¹å‡»æ¯ä¸ª Span å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/span-table.jpg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/span-table.jpg&#34; data-width=&#34;1495&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;è¡¨æ ¼è§†å›¾ä¸­æ˜¾ç¤ºäº† Span çš„åŸºæœ¬ä¿¡æ¯&#34;&gt;
    
  
  &lt;figcaption&gt;è¡¨æ ¼è§†å›¾ä¸­æ˜¾ç¤ºäº† Span çš„åŸºæœ¬ä¿¡æ¯&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åˆ‡æ¢ä¸ºåˆ—è¡¨è§†å›¾ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ª Span çš„æ‰§è¡Œé¡ºåºåŠæŒç»­æ—¶é—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/trace-list.jpg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/trace-list.jpg&#34; data-width=&#34;1190&#34; data-height=&#34;816&#34; alt=&#34;image&#34; data-caption=&#34;åˆ—è¡¨è§†å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;åˆ—è¡¨è§†å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªåº”ç”¨ä¼šäº§ç”Ÿå¦‚æ­¤å¤šçš„ Span ä¿¡æ¯ï¼Ÿå› ä¸ºæˆ‘ä»¬ä¸º Pod æ³¨å…¥äº† Envoy ä»£ç†ä¹‹åï¼Œæ¯ä¸ªæœåŠ¡é—´çš„è¯·æ±‚éƒ½ä¼šè¢« Envoy æ‹¦æˆªå’Œå¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/span.svg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/span.svg&#34; alt=&#34;image&#34; data-caption=&#34;Envoy æ‹¦æˆªè¯·æ±‚äº§ç”Ÿ Span&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy æ‹¦æˆªè¯·æ±‚äº§ç”Ÿ Span&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ•´ä¸ªè¿½è¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/distributed-tracing-with-skywalking-in-istio/bookinfo-spans-with-time.svg&#34; data-img=&#34;/blog/distributed-tracing-with-skywalking-in-istio/bookinfo-spans-with-time.svg&#34; alt=&#34;image&#34; data-caption=&#34;Bookinfo çš„åˆ†å¸ƒå¼è¿½è¸ªç—•è¿¹&#34;&gt;
    
  
  &lt;figcaption&gt;Bookinfo çš„åˆ†å¸ƒå¼è¿½è¸ªç—•è¿¹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ç»™æ¯ä¸€ä¸ª Span æ ‡è®°äº†åºå·ï¼Œå¹¶åœ¨æ‹¬å·é‡Œæ³¨æ˜äº†è€—æ—¶ã€‚ä¸ºäº†ä¾¿äºè¯´æ˜æˆ‘ä»¬å°†æ‰€æœ‰ Span æ±‡æ€»åœ¨ä¸‹é¢çš„è¡¨æ ¼ä¸­ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åºå·&lt;/th&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;æ€»è€—æ—¶ï¼ˆmsï¼‰&lt;/th&gt;
&lt;th&gt;ç»„ä»¶è€—æ—¶ï¼ˆmsï¼‰&lt;/th&gt;
&lt;th&gt;å½“å‰æœåŠ¡&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;/productpage&lt;/td&gt;
&lt;td&gt;190&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;istio-ingressgateway&lt;/td&gt;
&lt;td&gt;Envoy Outbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;/productpage&lt;/td&gt;
&lt;td&gt;190&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;istio-ingressgateway&lt;/td&gt;
&lt;td&gt;Ingress -&amp;gt; Productpage ç½‘ç»œä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;/productpage&lt;/td&gt;
&lt;td&gt;189&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;Envoy Inbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;/productpage&lt;/td&gt;
&lt;td&gt;188&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;åº”ç”¨å†…éƒ¨å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;/details/0&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;Envoy Outbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;/details/0&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;Productpage -&amp;gt; Details ç½‘ç»œä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;/details/0&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;details&lt;/td&gt;
&lt;td&gt;Envoy Inbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;/details/0&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;details&lt;/td&gt;
&lt;td&gt;åº”ç”¨å†…éƒ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;/reviews/0&lt;/td&gt;
&lt;td&gt;159&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;Envoy Outbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;/reviews/0&lt;/td&gt;
&lt;td&gt;159&lt;/td&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;Productpage -&amp;gt; Reviews ç½‘ç»œä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;/reviews/0&lt;/td&gt;
&lt;td&gt;145&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;reviews&lt;/td&gt;
&lt;td&gt;Envoy Inbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;/reviews/0&lt;/td&gt;
&lt;td&gt;144&lt;/td&gt;
&lt;td&gt;109&lt;/td&gt;
&lt;td&gt;reviews&lt;/td&gt;
&lt;td&gt;åº”ç”¨å†…éƒ¨å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;/ratings/0&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;reviews&lt;/td&gt;
&lt;td&gt;Envoy Outbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;/ratings/0&lt;/td&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;reviews&lt;/td&gt;
&lt;td&gt;Reviews -&amp;gt; Ratings ç½‘ç»œä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;/ratings/0&lt;/td&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;ratings&lt;/td&gt;
&lt;td&gt;Envoy Inbound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;/ratings/0&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;ratings&lt;/td&gt;
&lt;td&gt;åº”ç”¨å†…éƒ¨å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä»ä»¥ä¸Šä¿¡æ¯å¯ä»¥å‘ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬æ¬¡è¯·æ±‚æ€»è€—æ—¶ 190msï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ Istio sidecar æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡æµé‡åœ¨è¿›å‡ºåº”ç”¨å®¹å™¨æ—¶éƒ½éœ€è¦ç»è¿‡ä¸€æ¬¡ Envoy ä»£ç†ï¼Œæ¯æ¬¡è€—æ—¶åœ¨ 0 åˆ° 2 msï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ Pod é—´çš„ç½‘ç»œè¯·æ±‚è€—æ—¶åœ¨ 1 åˆ° 16ms ä¹‹é—´ï¼›&lt;/li&gt;
&lt;li&gt;å°†è€—æ—¶åšå¤šçš„è°ƒç”¨é“¾ Ingress Gateway -&amp;gt; Productpage -&amp;gt; Reviews -&amp;gt; Ratings ä¸Šçš„æ‰€æœ‰è€—æ—¶ç´¯è®¡ 182 msï¼Œå°äºè¯·æ±‚æ€»è€—æ—¶ 190msï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®æœ¬èº«æœ‰è¯¯å·®ï¼Œä»¥åŠ Span çš„å¼€å§‹æ—¶é—´å¹¶ä¸ä¸€å®šç­‰äºçˆ¶ Span çš„ç»“æŸæ—¶é—´ï¼Œå¦‚æœä½ åœ¨ SkyWalking çš„è¿½è¸ªé¡µé¢ï¼Œé€‰æ‹©ã€Œåˆ—è¡¨ã€æ ·å¼æŸ¥çœ‹è¿½è¸ªæ•°æ®ï¼ˆè§å›¾ 2ï¼‰å¯ä»¥æ›´ç›´è§‚çš„å‘ç°è¿™ä¸ªé—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°æœ€è€—æ—¶çš„éƒ¨åˆ†æ˜¯ Reviews åº”ç”¨ï¼Œè€—æ—¶ 109msï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¯¥åº”ç”¨è¿›è¡Œä¼˜åŒ–ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åªè¦å¯¹åº”ç”¨ä»£ç ç¨ä½œä¿®æ”¹å°±å¯ä»¥åœ¨ Istio å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ªåŠŸèƒ½ã€‚åœ¨ Istio æ”¯æŒçš„ä¼—å¤šåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¸­ï¼Œ&lt;a href=&#34;https://skywalking.apache.org/&#34; title=&#34;Apache SkyWalking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache SkyWalking&lt;/a&gt;
 æ˜¯å…¶ä¸­çš„ä½¼ä½¼è€…ã€‚å®ƒä¸ä»…æ”¯æŒåˆ†å¸ƒå¼è¿½è¸ªï¼Œè¿˜æ”¯æŒæŒ‡æ ‡å’Œæ—¥å¿—æ”¶é›†ã€æŠ¥è­¦ã€Kubernetes å’ŒæœåŠ¡ç½‘æ ¼ç›‘æ§ï¼Œ&lt;a href=&#34;https://skywalking.apache.org/zh/diagnose-service-mesh-network-performance-with-ebpf/&#34; title=&#34;ä½¿ç”¨ eBPF è¯Šæ–­æœåŠ¡ç½‘æ ¼æ€§èƒ½&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ eBPF è¯Šæ–­æœåŠ¡ç½‘æ ¼æ€§èƒ½&lt;/a&gt;
ç­‰åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„äº‘åŸç”Ÿåº”ç”¨åˆ†æå¹³å°ã€‚æœ¬æ–‡ä¸­ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå°†è¿½è¸ªé‡‡æ ·ç‡è®¾ç½®ä¸ºäº† 100%ï¼Œåœ¨ç”Ÿäº§ä½¿ç”¨æ—¶è¯·æ ¹æ®éœ€è¦è°ƒæ•´é‡‡æ ·ç­–ç•¥ï¼ˆé‡‡æ ·ç™¾åˆ†æ¯”ï¼‰ï¼Œé˜²æ­¢äº§ç”Ÿè¿‡å¤šçš„è¿½è¸ªæ—¥å¿—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/observability/distributed-tracing/overview/&#34; title=&#34;Istio åˆ†å¸ƒå¼è¿½è¸ªæ¦‚è§ˆ - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åˆ†å¸ƒå¼è¿½è¸ªæ¦‚è§ˆ - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/about/faq/#distributed-tracing&#34; title=&#34;Istio åˆ†å¸ƒå¼è¿½è¸ª FAQ - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åˆ†å¸ƒå¼è¿½è¸ª FAQ - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•ç†è§£ Istio ä¸­çš„ mTLS æµé‡åŠ å¯†ï¼Ÿ</title>
      <link>https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/</link>
      <pubDate>Mon, 28 Nov 2022 11:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/</guid>
      <description>
        
        
        &lt;p&gt;Istio æœåŠ¡ç½‘æ ¼å¯ä»¥å¸®åŠ©äº‘åŸç”Ÿåº”ç”¨å®ç°è‡ªåŠ¨ mTLSï¼Œå®Œæˆç½‘æ ¼å†…çš„æµé‡åŠ å¯†ï¼Œæœ‰åŠ©äºç¼©å°äº‘åŸç”Ÿéƒ¨ç½²çš„æ”»å‡»é¢ï¼Œæ˜¯æ„å»ºé›¶ä¿¡ä»»åº”ç”¨ç½‘ç»œçš„å…³é”®æ¡†æ¶ã€‚ä¸ºäº†ç†è§£ Istio ä¸­çš„ mTLS æµé‡åŠ å¯†ï¼Œæœ¬æ–‡å°†åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»‹ç»ä»€ä¹ˆæ˜¯ TLSã€mTLS å’Œ TLS ç»ˆæ­¢&lt;/li&gt;
&lt;li&gt;ä»‹ç» Istio ä¸­å¦‚ä½•å®ç° TLS åŠ å¯†&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨ Istio ä¸º Kubernetes ä¸­çš„æœåŠ¡å®ç° mTLSï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½•æ—¶éœ€è¦ mTLSï¼Ÿä½•æ—¶ä¸éœ€è¦ mTLSï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;what-is-tls-and-mtls&#34;&gt;ä»€ä¹ˆæ˜¯ TLS å’Œ mTLSï¼Ÿ&lt;/h2&gt;
&lt;p&gt;TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰æ˜¯ä¸€ç§å¹¿æ³›é‡‡ç”¨çš„å®‰å…¨åè®®ï¼Œç”¨äºåœ¨è”ç½‘è®¡ç®—æœºä¹‹é—´å»ºç«‹ç»è¿‡èº«ä»½éªŒè¯å’ŒåŠ å¯†çš„é“¾æ¥ï¼Œæ—¨åœ¨ä¿ƒè¿›äº’è”ç½‘é€šä¿¡çš„ç§å¯†æ€§å’Œæ•°æ®å®‰å…¨æ€§ã€‚TLS ä½œä¸º &lt;a href=&#34;https://www.ssl.com/faqs/faq-what-is-ssl/&#34; title=&#34;SSL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SSL&lt;/a&gt;
ï¼ˆSecure Socket Layerï¼Œå®‰å…¨å¥—æ¥å­—å±‚ï¼‰çš„ç»§ä»»è€…ï¼Œå®é™…ä¸Šæ˜¯ç”± SSL æ”¹åè€Œæ¥ï¼Œå› æ­¤äººä»¬ç»å¸¸å°† TLS/SSL æ··ç”¨ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å°†ç»Ÿç§°ä¸º TLSã€‚TLS 1.0 å‘å¸ƒäº 1999 å¹´ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º 1.3ï¼ˆå‘å¸ƒäº 2018 å¹´ 8 æœˆï¼‰ï¼Œ1.0 å’Œ 1.1 ç‰ˆæœ¬å·²å¼ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æµè§ˆç½‘é¡µæ—¶çœ‹åˆ°çš„ HTTPS å®é™…ä¸Šå°±ä½¿ç”¨äº† TLSï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚TLS æ˜¯å»ºç«‹åœ¨ TCP ä¹‹ä¸Šçš„ï¼Œä½œä¸º OSI æ¨¡å‹ä¸­çš„ä¼šè¯å±‚ã€‚ä¸ºäº†ä¿è¯å…¼å®¹æ€§ï¼ŒTLS é€šå¸¸ä½¿ç”¨ 443 ç«¯å£ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»æ„ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/http-vs-https.svg&#34; data-img=&#34;/blog/understanding-the-tls-encryption-in-istio/http-vs-https.svg&#34; alt=&#34;image&#34; data-caption=&#34;HTTP vs HTTPS&#34;&gt;
    
  
  &lt;figcaption&gt;HTTP vs HTTPS&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“å®¢æˆ·ç«¯éœ€è¦éªŒè¯æœåŠ¡ç«¯èº«ä»½ï¼Œä»¥é˜²ä¸­é—´äººæ”»å‡»åŒæ—¶ä¿è¯é€šä¿¡å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œåœ¨å’ŒæœåŠ¡ç«¯é€šä¿¡æ—¶ä¼šè¦æ±‚ TLS åŠ å¯†ã€‚ä¸‹å›¾å±•ç¤ºäº†çš„æ˜¯ TLS åŠ å¯†é€šä¿¡çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/tls-flow.svg&#34; data-img=&#34;/blog/understanding-the-tls-encryption-in-istio/tls-flow.svg&#34; alt=&#34;image&#34; data-caption=&#34;TLS åŠ å¯†é€šä¿¡æµç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;TLS åŠ å¯†é€šä¿¡æµç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å™¨å‘å—ä¿¡ä»»çš„ CAï¼ˆè¯ä¹¦ç®¡ç†æœºæ„ï¼‰ç”³è¯·å¹¶è·å¾—è¯ä¹¦ï¼ˆX.509 è¯ä¹¦ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«å®¢æˆ·ç«¯æ”¯æŒçš„ TLS ç‰ˆæœ¬å’Œå¯†ç ç»„åˆç­‰ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨å›åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶é™„ä¸Šæ•°å­—è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦çš„çŠ¶æ€ã€æœ‰æ•ˆæœŸå’Œæ•°å­—ç­¾åç­‰ä¿¡æ¯ï¼Œç¡®è®¤æœåŠ¡å™¨çš„èº«ä»½ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å…±äº«ç§˜é’¥å®ç°åŠ å¯†é€šä¿¡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šä»…æ˜¯å¯¹ TLS é€šä¿¡æµç¨‹çš„ä¸€ä¸ªæ¦‚è¦æè¿°ï¼Œå®é™…çš„ TLS æ¡æ‰‹è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/&#34; title=&#34;è¿™ç¯‡æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä»¥ä¸Šè¿‡ç¨‹ä¸­ä½ ä¼šå‘ç°ï¼Œè¯ä¹¦æ˜¯ä»£è¡¨æœåŠ¡å™¨èº«ä»½çš„å…³é”®è¦ç´ ï¼Œå¯¹äºäº’è”ç½‘å…¬å¼€æœåŠ¡ï¼ŒæœåŠ¡å™¨éœ€è¦ä½¿ç”¨æƒå¨è®¤è¯çš„ CA é¢å‘çš„è¯ä¹¦ï¼Œè€Œå¯¹äºç§æœ‰ç¯å¢ƒå†…éƒ¨çš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ PKIï¼ˆPrivate Key Infrastructureï¼Œç§é’¥åŸºç¡€è®¾æ–½ï¼‰æ¥ç®¡ç†è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;åŒå‘ TLS æˆ–ç›¸äº’ TLSï¼ˆMutual TLS æˆ– mTLSï¼‰æ˜¯æŒ‡åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´ä½¿ç”¨åŒå‘åŠ å¯†é€šé“ï¼Œéœ€è¦åŒæ–¹ç›¸äº’æä¾›è¯ä¹¦å¹¶éªŒè¯å¯¹æ–¹èº«ä»½ã€‚å…³äºå¦‚ä½•åœ¨ Kubernetes ä¸­ä½¿ç”¨ mTLS è¯·å‚è€ƒ&lt;a href=&#34;https://lib.jimmysong.io/blog/mtls-guide/&#34; title=&#34;è¿™ç¯‡æ–‡ç« &#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;
ã€‚å…³äº mTLS çš„è¯¦ç»†ä»‹ç»è¯·è§&lt;a href=&#34;https://www.cloudflare.com/zh-cn/learning/access-management/what-is-mutual-tls/&#34; title=&#34;è¿™ç¯‡æ–‡ç« &#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;what-is-tls-termination&#34;&gt;ä»€ä¹ˆæ˜¯ TLS ç»ˆæ­¢ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;TLS ç»ˆæ­¢ï¼ˆTLS Terminationï¼‰æŒ‡çš„æ˜¯åœ¨å°† TLS åŠ å¯†æµé‡ä¼ é€’ç»™ Web æœåŠ¡å™¨ä¹‹å‰å¯¹å…¶è¿›è¡Œè§£å¯†çš„è¿‡ç¨‹ã€‚å°† TLS æµé‡å¸è½½åˆ°å…¥å£ç½‘å…³æˆ–ä¸“ç”¨è®¾å¤‡ä¸Šï¼Œå¯ä»¥æé«˜ Web åº”ç”¨çš„æ€§èƒ½ï¼ŒåŒæ—¶ç¡®ä¿åŠ å¯†æµé‡çš„å®‰å…¨æ€§ã€‚ä¸€èˆ¬è¿è¡Œåœ¨é›†ç¾¤å…¥å£å¤„ï¼Œå½“æµé‡åˆ°è¾¾å…¥å£å¤„æ—¶å®æ–½ TLS ç»ˆæ­¢ï¼Œå…¥å£ä¸é›†ç¾¤å†…æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å°†ç›´æ¥ä½¿ç”¨ HTTP æ˜æ–‡ï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/tls-termination.svg&#34; data-img=&#34;/blog/understanding-the-tls-encryption-in-istio/tls-termination.svg&#34; alt=&#34;image&#34; data-caption=&#34;TLS ç»ˆæ­¢&#34;&gt;
    
  
  &lt;figcaption&gt;TLS ç»ˆæ­¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio é»˜è®¤åœ¨å…¥å£ç½‘å…³å¤„ç»ˆæ­¢ TLSï¼Œç„¶åå†ä¸ºç½‘æ ¼å†…çš„æœåŠ¡å¼€å¯ mTLSã€‚ä½ ä¹Ÿå¯ä»¥è®©æµé‡ç›´é€šï¼ˆpassthroughï¼‰åˆ°åç«¯æœåŠ¡å¤„ç†ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sample-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PASSTHROUGH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¦è§&lt;a href=&#34;https://istio.io/latest/zh/docs/ops/configuration/traffic-management/tls-configuration/#gateways&#34; title=&#34;ç½‘å…³ TLS  é…ç½®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³ TLS  é…ç½®&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-mtls&#34;&gt;Istio ä¸­å¦‚ä½•å®ç°è‡ªåŠ¨ mTLSï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾ä¸­å±•ç¤ºçš„æ˜¯ Istio å®‰å…¨æ¶æ„å›¾ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°åœ¨å…¥å£å¤„ä½¿ç”¨ JWS + TLS è®¤è¯å’ŒåŠ å¯†ï¼Œåœ¨ Istio ç½‘æ ¼å†…éƒ¨çš„æ‰€æœ‰æœåŠ¡é—´éƒ½å¼€å¯äº† mTLSã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/understanding-the-tls-encryption-in-istio/istio-security.svg&#34; data-img=&#34;/blog/understanding-the-tls-encryption-in-istio/istio-security.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio å®‰å…¨æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio å®‰å…¨æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio ä¸­å†…ç½®äº† CAï¼Œä½¿ç”¨ xDS ä¸­çš„ SDSï¼ˆSecret Discovery Serviceï¼Œç§˜å¯†å‘ç°æœåŠ¡ï¼‰å®ç° SVID è¯ä¹¦çš„ç­¾å‘å’Œè½®æ¢ã€‚Istio ç½‘æ ¼å†…çš„ mTLS æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Sidecar ä»£æ›¿å·¥ä½œè´Ÿè½½å‘ Istiod ç”³è¯·è¯ä¹¦ï¼ŒIstiod ç­¾å‘ &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/auth/spiffe/#svid&#34; title=&#34;SVID&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SVID&lt;/a&gt;
 è¯ä¹¦ï¼ˆè¯¥è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å°†åœ¨ä»Šåçš„åšå®¢ä¸­è¯´æ˜ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¯·æ±‚è¢« Pod å†…çš„ sidecar æ‹¦æˆªï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ sidecar ä¸æœåŠ¡ç«¯ sidecar å¼€å§‹ mTLS æ¡æ‰‹ã€‚åœ¨æ¡æ‰‹çš„åŒæ—¶ï¼Œå®¢æˆ·ç«¯ sidecar ä¸­çš„ JWT å’Œè®¤è¯è¿‡æ»¤å™¨å°†å¯¹è¯·æ±‚çš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè®¤è¯é€šè¿‡åå°†èº«ä»½å­˜å‚¨åœ¨è¿‡æ»¤å™¨å…ƒæ•°æ®ä¸­ï¼Œç„¶åè¯·æ±‚ç»è¿‡æˆæƒè¿‡æ»¤å™¨ï¼Œåˆ¤æ–­è¯·æ±‚æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥è¯·æ±‚é€šè¿‡äº†è®¤è¯ä¸æˆæƒï¼Œåˆ™å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¼€å§‹å»ºç«‹è¿æ¥è¿›è¡Œé€šä¿¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Istio ä¸­æœ‰ä¸‰ä¸ªèµ„æºå¯¹è±¡å¯ç”¨äºé…ç½®æœåŠ¡é—´çš„è®¤è¯ä¸æˆæƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;RequestAuthentication&lt;/code&gt;ï¼šç”¨äºå®šä¹‰æœåŠ¡æ”¯æŒçš„è¯·æ±‚çº§è®¤è¯æ–¹å¼ï¼Œç›®å‰åªæ”¯æŒ  JWTï¼ˆ&lt;a href=&#34;https://lib.jimmysong.io/blog/jwt-components-explained/&#34; title=&#34;æŸ¥çœ‹ JWT ç»„ä»¶è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹ JWT ç»„ä»¶è¯¦è§£&lt;/a&gt;
ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PeerAuthentication&lt;/code&gt;ï¼šé…ç½®æœåŠ¡é—´çš„ä¼ è¾“è®¤è¯æ¨¡å¼ï¼Œå¦‚ &lt;code&gt;STRICT&lt;/code&gt;ã€&lt;code&gt;PERMISSIVE&lt;/code&gt; æˆ– &lt;code&gt;DISABLE&lt;/code&gt; ç­‰ï¼Œä»¥å¼€å¯ mTLS æˆ–æ˜æ–‡è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AuthorizationPolicy&lt;/code&gt;ï¼šç”¨äºæˆæƒæœåŠ¡é—´çš„æµé‡ï¼Œå®šä¹‰è°å¯ä»¥åšä»€ä¹ˆï¼Ÿä¾‹å¦‚ä¸»ä½“ A å…è®¸ï¼ˆ&lt;code&gt;ALLOW&lt;/code&gt;ï¼‰æˆ–æ‹’ç»ï¼ˆ&lt;code&gt;DENY&lt;/code&gt;ï¼‰æ¥è‡ªä¸»ä½“ B çš„æµé‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;how-to-setup-mtls&#34;&gt;å¦‚ä½•ä½¿ç”¨ Istio ä¸ºæœåŠ¡å¼€å¯è‡ªåŠ¨ mTLSï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨ &lt;code&gt;PeerAuthentication&lt;/code&gt; ä¸­æŒ‡å®šå¯¹ç›®æ ‡å·¥ä½œè´Ÿè½½å®æ–½çš„ mTLS æ¨¡å¼ã€‚å¯¹ç­‰è®¤è¯æ”¯æŒä»¥ä¸‹æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PERMISSIVE&lt;/code&gt;ï¼šé»˜è®¤å€¼ï¼Œå·¥ä½œè´Ÿè½½å¯æ¥å—åŒå‘ TLS æˆ–çº¯æ–‡æœ¬æµé‡ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;STRICT&lt;/code&gt;ï¼šå·¥ä½œè´Ÿè½½ä»…æ¥å— mTLS æµé‡ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DISABLE&lt;/code&gt;ï¼šç¦ç”¨ mTLSã€‚ä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œé™¤éä½ æœ‰è‡ªå·±çš„å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œå¦åˆ™ä¸åº”ç¦ç”¨ mTLSï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UNSET&lt;/code&gt;ï¼šä»çˆ¶çº§ç»§æ‰¿ï¼Œä¼˜å…ˆçº§ä¸ºæœåŠ¡ç‰¹å®š &amp;gt; å‘½åç©ºé—´èŒƒå›´ &amp;gt; ç½‘æ ¼èŒƒå›´çš„è®¾ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio çš„å¯¹ç­‰è®¤è¯é»˜è®¤ä½¿ç”¨ &lt;code&gt;PERMISSIVE&lt;/code&gt; æ¨¡å¼ï¼Œè‡ªåŠ¨å°† mTLS æµé‡å‘é€åˆ°è¿™äº›å·¥ä½œè´Ÿè½½ï¼Œå°†çº¯æ–‡æœ¬æµé‡å‘é€åˆ°æ²¡æœ‰ sidecar çš„å·¥ä½œè´Ÿè½½ã€‚åœ¨å°† Kubernetes æœåŠ¡çº³å…¥ Istio ç½‘æ ¼åï¼Œä¸ºäº†é˜²æ­¢æœåŠ¡æ— æ³•é€šè¿‡ mTLSï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨ &lt;code&gt;PERMISSIVE&lt;/code&gt; æ¨¡å¼ã€‚å½“æˆ‘æƒ³ä¸ºæŸäº›æœåŠ¡å¼€å¯ä¸¥æ ¼çš„ mTLS æ¨¡å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;PeerAuthentication&lt;/code&gt; å®šä¹‰æµé‡å¦‚ä½•åœ¨ sidecar ä¹‹é—´ä¼ è¾“ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;DestinationRule&lt;/code&gt; å®šä¹‰æµé‡è·¯ç”±ç­–ç•¥ä¸­çš„ TLS è®¾ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢ä»¥ä¸º &lt;code&gt;default&lt;/code&gt; å‘½åç©ºé—´ä¸‹çš„ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡è®¾ç½® mTLS ä¸ºä¾‹è¯´æ˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;peerauthentication-tls-setting&#34;&gt;ä½¿ç”¨ PeerAuthentication ä¸ºå·¥ä½œè´Ÿè½½è®¾ç½® mTLS&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;namespace&lt;/code&gt; å’Œ &lt;code&gt;selector&lt;/code&gt; æŒ‡å®šæŸä¸ªå‘½åç©ºé—´ä¸‹çš„æŸä¸ªå·¥ä½œè´Ÿè½½å¼€å¯ä¸¥æ ¼çš„ mTLSã€‚ä¾‹å¦‚ä¸‹é¢çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PeerAuthentication&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-peer-policy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mtls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;STRICT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ç»™å®‰è£… Istio  çš„å‘½åç©ºé—´ &lt;code&gt;istio-system&lt;/code&gt; è®¾ç½®ä¸¥æ ¼çš„ mTLSï¼Œé‚£æ ·ä¼šä¸ºç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡å¼€å¯ä¸¥æ ¼çš„ mTLSï¼Œè¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/security/authentication/mtls-migration/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;destinationrule-tls-setting&#34;&gt;ä½¿ç”¨ DestinationRule ä¸ºå·¥ä½œè´Ÿè½½è®¾ç½® mTLS&lt;/h3&gt;
&lt;p&gt;DestinationRule ç”¨äºè®¾ç½®æµé‡è·¯ç”±ç­–ç•¥ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€å¼‚å¸¸ç‚¹æ£€æµ‹ã€TLS è®¾ç½®ç­‰ã€‚å…¶ä¸­ TLS è®¾ç½®ä¸­åŒ…å«&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/#ClientTLSSettings-TLSmode&#34; title=&#34;å¤šç§æ¨¡å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šç§æ¨¡å¼&lt;/a&gt;
ï¼Œä½¿ç”¨ &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt; æ¨¡å¼å¯ä»¥ä¸ºå·¥ä½œè´Ÿè½½å¼€å¯ Istio çš„è‡ªåŠ¨ TLSï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;when-use-mtls&#34;&gt;ä»€ä¹ˆæ—¶å€™ç”¨ mTLSï¼Ÿ&lt;/h2&gt;
&lt;p&gt;äº’è”ç½‘å®¢æˆ·ç«¯å¯¹ Web æœåŠ¡çš„è®¿é—®ï¼Œä¸€èˆ¬ä½¿ç”¨å•å‘ TLSï¼Œå³åªéœ€è¦æœåŠ¡ç«¯æä¾›èº«ä»½è¯æ˜ï¼Œè€Œä¸å…³å¿ƒå®¢æˆ·ç«¯çš„èº«ä»½ã€‚å½“ä½ éœ€è¦éªŒè¯å®¢æˆ·ç«¯èº«ä»½æ—¶ï¼Œä½¿ç”¨å•å‘ TLS å¯ä»¥ä½¿ç”¨å¯†ç ã€tokenã€åŒå› å­è®¤è¯ç­‰æ–¹å¼ã€‚ä¸è¿‡è¿™æ ·çš„è®¤è¯æ–¹å¼éœ€è¦åº”ç”¨ç¨‹åºå†…éƒ¨æ”¯æŒï¼Œè€ŒåŒå‘ TLS æ˜¯è¿è¡Œåœ¨åº”ç”¨ç¨‹åºä¹‹å¤–çš„ï¼Œä¸éœ€è¦å¤šåº”ç”¨é€»è¾‘è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ éœ€è¦æ­£å¦‚ä½ åœ¨ä¸Šæ–‡ä¸­çœ‹åˆ°çš„ï¼Œå®æ–½ mTLS çš„æœåŠ¡é—´éœ€è¦äº¤æ¢è¯ä¹¦ï¼Œå½“æœåŠ¡æ•°é‡å˜å¤§æ—¶ï¼Œå°±éœ€è¦ç®¡ç†å¤§é‡çš„è¯ä¹¦ï¼Œè¿™éœ€è¦æ¶ˆè€—å¤§é‡çš„ç²¾åŠ›ï¼Œä½¿ç”¨æœåŠ¡ç½‘æ ¼å¯ä»¥å¸®åŠ©ä½ å®ç°è‡ªåŠ¨ mTLSï¼Œå½»åº•è§£å†³è¯ä¹¦ç®¡ç†çš„éš¾é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;when-not-use-mtls&#34;&gt;ä»€ä¹ˆæ—¶å€™ä¸ç”¨ mTLSï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ mTLS æ˜¯ç¡®ä¿äº‘åŸç”Ÿåº”ç”¨ç¨‹åºæœåŠ¡é—´é€šä¿¡å®‰å…¨çš„é¦–é€‰åè®®ï¼Œä½†æ˜¯åº”ç”¨ mTLS éœ€è¦å®Œæˆå¤æ‚çš„å¯¹ç§°åŠ å¯†ã€è§£å¯†è¿‡ç¨‹ï¼Œè¿™å°†éå¸¸è€—æ—¶ä¸”æ¶ˆè€—å¤§é‡çš„ CPU èµ„æºã€‚å¯¹äºæŸäº›å®‰å…¨çº§åˆ«ä¸é«˜çš„æµé‡ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æµé‡å…¥å£å¤„ç»ˆæ­¢ TLSï¼Œå¹¶ç½‘æ ¼å†…éƒ¨ä»…å¯¹é’ˆå¯¹æ€§çš„æœåŠ¡å¼€å¯ mTLSï¼Œå°±å¯ä»¥åŠ å¿«è¯·æ±‚å“åº”å’Œå‡å°‘è®¡ç®—èµ„æºæ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–å½“æœ‰çš„æœåŠ¡æ— æ³•è·å–è¯ä¹¦ï¼Œä¾‹å¦‚ Kubelet ä¸Šä½¿ç”¨ HTTP çš„å¥åº·æ£€æŸ¥ï¼Œæ— æ³•é€šè¿‡ TLS è®¿é—®æœåŠ¡å†…çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œè¿™æ—¶å€™å°±éœ€è¦&lt;a href=&#34;https://istio.io/latest/zh/docs/ops/configuration/mesh/app-health-check/#disable-the-http-probe-rewrite-for-a-pod&#34; title=&#34;ä¸º Pod ç¦ç”¨æ¢é’ˆé‡å†™&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸º Pod ç¦ç”¨æ¢é’ˆé‡å†™&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åå½“ç½‘æ ¼ä¸­çš„æœåŠ¡è®¿é—®ä¸€äº›å¤–éƒ¨æœåŠ¡æ—¶ï¼Œä¹Ÿä¸éœ€è¦ mTLSã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;mTLS å®ç°äº†ç½‘æ ¼å†…æµé‡çš„åŠ å¯†ï¼Œæ˜¯æ„å»ºé›¶ä¿¡ä»»åº”ç”¨ç½‘ç»œçš„å…³é”®ä¸€æ­¥ã€‚å€ŸåŠ© Istio æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸º Kubernetes ä¸­çš„æœåŠ¡å¼€å¯è‡ªåŠ¨ mTLSï¼Œçœå»ç®¡ç†è¯ä¹¦çš„éº»çƒ¦ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é’ˆå¯¹æ€§çš„ä¸ºç½‘æ ¼å†…çš„éƒ¨åˆ†æœåŠ¡å¼€å¯ mTLSï¼Œä¾¿äºæˆ‘ä»¬å°† Kubernetes ä¸­çš„æœåŠ¡è¿ç§»åˆ°ç½‘æ ¼å†…ã€‚å…³äº Istio ä¸­çš„è¯ä¹¦ç®¡ç†ï¼Œæˆ‘ä»¬å°†åœ¨ä»Šåçš„åšå®¢ä¸­å†åšè¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cloudflare.com/zh-cn/learning/ssl/transport-layer-security-tls/&#34; title=&#34;ä»€ä¹ˆæ˜¯ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰ï¼Ÿ- cloudflare.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰ï¼Ÿ- cloudflare.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cloudflare.com/zh-cn/learning/access-management/what-is-mutual-tls/&#34; title=&#34;ä»€ä¹ˆæ˜¯ç›¸äº’ TLSï¼ˆmTLSï¼‰ï¼Ÿ- cloudflare.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ç›¸äº’ TLSï¼ˆmTLSï¼‰ï¼Ÿ- cloudflare.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/&#34; title=&#34;What happens in a TLS handshake? | SSL handshake - cloudflare.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What happens in a TLS handshake? | SSL handshake - cloudflare.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/mtls-guide/&#34; title=&#34;å†™ç»™ Kubernetes å·¥ç¨‹å¸ˆçš„ mTLS æŒ‡å— - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†™ç»™ Kubernetes å·¥ç¨‹å¸ˆçš„ mTLS æŒ‡å— - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cncf/tag-security/blob/main/security-whitepaper/v1/cloud-native-security-whitepaper-simplified-chinese.md&#34; title=&#34;äº‘åŸç”Ÿå®‰å…¨ç™½çš®ä¹¦ä¸­æ–‡ç‰ˆ - github.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿå®‰å…¨ç™½çš®ä¹¦ä¸­æ–‡ç‰ˆ - github.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/docs/concepts/security/&#34; title=&#34;Istio å®‰å…¨ - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®‰å…¨ - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/jwt-components-explained/&#34; title=&#34;JWT ç»„ä»¶è¯¦è§£ - lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JWT ç»„ä»¶è¯¦è§£ - lib.jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio Ambient æ¨¡å¼ä¸­çš„ä¸ƒå±‚æµé‡è·¯ç”±è·¯å¾„è¯¦è§£</title>
      <link>https://jimmysong.io/blog/ambient-mesh-l7-traffic-path/</link>
      <pubDate>Thu, 17 Nov 2022 21:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/ambient-mesh-l7-traffic-path/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/&#34; title=&#34;ä¸Šä¸€ç¯‡åšå®¢ä¸­&#34;&gt;ä¸Šä¸€ç¯‡åšå®¢ä¸­&lt;/a&gt;
æˆ‘ä»‹ç»äº† Ambient æ¨¡å¼ä¸­çš„é€æ˜æµé‡åŠ«æŒå’Œå››å±‚æµé‡è·¯ç”±ï¼Œåœ¨è¿™ä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»åœ¨ Istio çš„ Ambient æ¨¡å¼ä¸­ï¼Œä¸ƒå±‚æµé‡æ˜¯å¦‚ä½•è·¯ç”±çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Ambient æ¨¡å¼ä¸­ä¸ƒå±‚ç½‘ç»œæµé‡è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/ambient-mesh-l7-traffic-path/ambient-mesh-l7-traffic-path.svg&#34; data-img=&#34;/blog/ambient-mesh-l7-traffic-path/ambient-mesh-l7-traffic-path.svg&#34; alt=&#34;image&#34; data-caption=&#34;Ambient Mesh ä¸­çš„ä¸ƒå±‚ç½‘ç»œæµé‡è·¯å¾„&#34;&gt;
    
  
  &lt;figcaption&gt;Ambient Mesh ä¸­çš„ä¸ƒå±‚ç½‘ç»œæµé‡è·¯å¾„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šWaypoint Proxy å¯ä»¥ä½äºåº”ç”¨ç¨‹åºæ‰€åœ¨èŠ‚ç‚¹ï¼Œç”šè‡³å›¾ä¸­çš„æœåŠ¡ Aã€æœåŠ¡ B å’Œ Waypoint Proxy éƒ½å¯ä»¥ä½äºåŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹‹æ‰€ä»¥å°†å®ƒä»¬ç”»åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šæ˜¯ä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œä½†æ˜¯å¯¹äºå®é™…çš„æµé‡è·¯å¾„æ²¡æœ‰å¤§çš„å½±å“ï¼Œåªä¸è¿‡æ˜¯ä¸å†é€šè¿‡ eth0 å‘é€åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ–‡æˆ‘ä»¬å°†ä»æ‰‹æ“ä½œæ¢ç©¶å›¾ä¸­è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;environment&#34;&gt;ç¯å¢ƒè¯´æ˜&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä¸Šä¸€ç¯‡åšå®¢ä¸­éƒ¨ç½²çš„ Ambient æ¨¡å¼çš„ Istioï¼Œ&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/#environment&#34; title=&#34;æŸ¥çœ‹ç¯å¢ƒè¯´æ˜&#34;&gt;æŸ¥çœ‹ç¯å¢ƒè¯´æ˜&lt;/a&gt;
ã€‚ä¸ºäº†è¯´æ˜ä¸ƒå±‚ç½‘è·¯è·¯ç”±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šå†åˆ›å»ºä¸€ä¸ª Gatewayï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; name: productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; annotations:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;   istio.io/service-account: bookinfo-productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; gatewayClassName: istio-mesh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œå®Œè¯¥å‘½ä»¤åï¼Œ&lt;code&gt;default&lt;/code&gt; å‘½åç©ºé—´ä¸‹ä¼šåˆ›å»ºäº†ä¸€ä¸ª Waypoint proxyï¼Œåœ¨æˆ‘çš„ç¯å¢ƒä¸­è¿™ä¸ª pod çš„åå­—æ˜¯ &lt;code&gt;bookinfo-productpage-waypoint-proxy-6f88c55d59-4dzdx&lt;/code&gt;ï¼Œä¸“é—¨ç”¨äºå¤„ç†å‘å¾€ productpage æœåŠ¡ï¼ˆæœåŠ¡ Bï¼‰çš„ L7 æµé‡ï¼Œæˆ‘å°†å®ƒç§°ä¹‹ä¸º Waypoint Proxy Bã€‚&lt;/p&gt;
&lt;p&gt;Waypoint ä»£ç†å¯ä»¥ä½äºä¸å·¥ä½œè´Ÿè½½ç›¸åŒæˆ–è€…ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå®ƒä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨ç‹¬ç«‹çš„å‘½åç©ºé—´ä¸­ï¼Œä¸è®ºå®ƒä½äºå“ªä¸ªèŠ‚ç‚¹ï¼Œå¯¹äº L7 æµé‡è·¯å¾„æ²¡æœ‰å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;Ambient mesh ä¸­é€æ˜æµé‡çš„æ–¹å¼åœ¨ L4 å’Œ L7 ç½‘ç»œä¸­æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œå› æ­¤åœ¨è¿™ç¯‡åšå®¢ä¸­æˆ‘ä»¬å°†ç•¥è¿‡ Inbound å’Œ Outbound æµé‡åŠ«æŒéƒ¨åˆ†ï¼Œä½ å¯ä»¥æŸ¥çœ‹&lt;a href=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/&#34; title=&#34;ä¸Šä¸€ç¯‡åšå®¢&#34;&gt;ä¸Šä¸€ç¯‡åšå®¢&lt;/a&gt;
äº†è§£è¯¦æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å°†ç›´æ¥ä»æµé‡è¢«åŠ«æŒåˆ° Ztunnel A åï¼Œè¢«è½¬å‘åˆ° Envoy çš„ 15006 ç«¯å£å¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ztunel-a-outbound&#34;&gt;Ztunnel A ä¸Šçš„å‡ºç«™æµé‡è·¯ç”±&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯¼å‡º Ztunnel A ä¸Šçš„ Envoy ä»£ç†é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n istio-system ztunnel-hptxk -c istio-proxy -- curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1:15000/config_dump?include_eds&amp;#34;&lt;/span&gt;&amp;gt;ztunnel-a-all-include-eds.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;ztunnel-a-all-include-eds.json&lt;/code&gt; æ–‡ä»¶ä¸­çš„ Listener é…ç½®éƒ¨åˆ†ï¼Œæ ¹æ®ç›®çš„ç«¯å£å’Œæ¥æº IP çš„åŒ¹é…å…³ç³»ï¼Œä½ å°†çœ‹åˆ° &lt;code&gt;ztunnel_outbound&lt;/code&gt; ç›‘å¬å™¨ä¸­æœ‰å¦‚ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.8.14.226&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher_tree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.matching.common_inputs.network.v3.DestinationPortInput&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact_match_map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_server_waypoint_proxy_spiffe://cluster.local/ns/default/sa/bookinfo-productpage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/google.protobuf.StringValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_server_waypoint_proxy_spiffe://cluster.local/ns/default/sa/bookinfo-productpage&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;10.8.14.226&lt;/code&gt; æ˜¯ç›®æ ‡æœåŠ¡çš„ Cluster  IPï¼ŒæœåŠ¡ç«¯å£æ˜¯ 9080ã€‚æµé‡å°†è¢«è·¯ç”±åˆ° &lt;code&gt;spiffe://cluster.local/ns/default/sa/sleep_to_server_waypoint_proxy_spiffe://cluster.local/ns/default/sa/bookinfo-productpage&lt;/code&gt; é›†ç¾¤ï¼ŒæŸ¥çœ‹è¯¥é›†ç¾¤çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_server_waypoint_proxy_spiffe://cluster.local/ns/default/sa/bookinfo-productpage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;EDS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_cluster_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;initial_fetch_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;resource_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;err&#34;&gt;/*&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;çœç•¥&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯¥é›†ç¾¤ä½¿ç”¨ EDS æœåŠ¡å‘ç°ã€‚æŸ¥çœ‹è¯¥é›†ç¾¤çš„ EDS ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.endpoint.v3.ClusterLoadAssignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.3.14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_check_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HEALTHY&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_balancing_weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;overprovisioning_factor&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;140&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ³¨æ„ï¼šè¿™é‡Œè¿˜æ˜¯ç¼ºå°‘è¾“å‡º &lt;code&gt;cluster_name&lt;/code&gt; å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œç›´æ¥å°†æµé‡è½¬å‘ç»™ Waypoint Proxy çš„ç«¯ç‚¹ &lt;code&gt;10.4.3.14:15006&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;waypoint-proxy-b&#34;&gt;Waypoint Proxy B ä¸Šçš„æµé‡è½¬å‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å†å¯¼å‡º Waypoint Proxy B ä¸­çš„ Envoy é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n default bookinfo-productpage-waypoint-proxy-6f88c55d59-4dzdx -c istio-proxy -- curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1:15000/config_dump?include_eds&amp;#34;&lt;/span&gt;&amp;gt;waypoint-a-all-include-eds.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;inbound_CONNECT_terminate&lt;/code&gt; ç›‘å¬å™¨çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_terminate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_terminate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;capture_tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/udpa.type.v1.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.tls_passthrough.v1.CaptureTLS&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_hcm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;local_route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;connect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;:authority&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.8.14.226:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|internal|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;http_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;tracing&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;allow_connect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_remote_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stream_idle_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;normalize_path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_id_extension&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;path_with_escaped_slashes_action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;KEEP_UNCHANGED&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_terminate&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T06:24:51.467Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç›®çš„åœ°ä¸º &lt;code&gt;10.8.14.226:9080&lt;/code&gt; çš„ TCP æµé‡å°†è¢«è½¬å‘åˆ° &lt;code&gt;inbound-vip|9080|internal|productpage.default.svc.cluster.local&lt;/code&gt;ï¼Œå¹¶å°† HTTP ç±»å‹ä¿®æ”¹ä¸º &lt;code&gt;CONNECT&lt;/code&gt;ï¼ŒæŸ¥çœ‹è¯¥é›†ç¾¤çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|internal|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;STATIC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.internal_upstream&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.internal_upstream.v3.InternalUpstreamTransport&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;passthrough_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.raw_buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.raw_buffer.v3.RawBuffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_assignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|internal|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_internal_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_listener_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080||productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.137Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯¥é›†ç¾¤çš„ç«¯ç‚¹æ˜¯ä¸€ä¸ªå†…éƒ¨ç›‘å¬å™¨ &lt;code&gt;inbound-vip|9080||productpage.default.svc.cluster.local&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;94
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080||productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080||productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;restore_tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/udpa.type.v1.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.tls_passthrough.v1.RestoreTLS&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_0.0.0.0_9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|http|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|http|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_stream_duration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_stream_duration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_timeout_header_max&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_remote_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;forward_client_cert_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;APPEND_FORWARD&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;set_current_client_cert_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;subject&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;uri&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;websocket&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;stream_idle_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;normalize_path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_id_extension&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.request_id.uuid.v3.UuidRequestIdConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_request_id_for_trace_sampling&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;path_with_escaped_slashes_action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;KEEP_UNCHANGED&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080||productpage.default.svc.cluster.local-http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;set_dst_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/xds.type.v3.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.set_internal_dst_address.v1.Config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.listener.metadata_to_peer_node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/udpa.type.v1.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.telemetry.metadatatopeernode.v1.Config&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;traffic_direction&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;INBOUND&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;internal_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.300Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ•°æ®åŒ…è¢«è½¬å‘åˆ° &lt;code&gt;inbound-vip|9080|http|productpage.default.svc.cluster.local&lt;/code&gt; é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|http|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;EDS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_cluster_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;initial_fetch_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;resource_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|http|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.internal_upstream&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.internal_upstream.v3.InternalUpstreamTransport&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.raw_buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.raw_buffer.v3.RawBuffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.138Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯¥é›†ç¾¤æ˜¯ EDS ç±»å‹ï¼ŒæŸ¥çœ‹ Endpoint é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.endpoint.v3.ClusterLoadAssignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|http|productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;region&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;us-west2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;zone&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;us-west2-a&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_internal_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_listener_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_check_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HEALTHY&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;workload&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage-v1;default;productpage;v1;Kubernetes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_balancing_weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;overprovisioning_factor&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;140&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ•°æ®åŒ…è¢«è½¬å‘åˆ° &lt;code&gt;inbound-pod|9080||10.4.0.5&lt;/code&gt; ç›‘å¬å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;restore_tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/udpa.type.v1.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.tls_passthrough.v1.RestoreTLS&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_0.0.0.0_9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_stream_duration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_stream_duration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_timeout_header_max&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;http_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.http.rbac&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.http.rbac.v3.RBAC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;rules&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;policies&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;ns[default]-policy[productpage-viewer]-rule[0]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;permissions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;and_rules&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;rules&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;nt&#34;&gt;&amp;#34;any&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;principals&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;and_ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;nt&#34;&gt;&amp;#34;or_ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;authenticated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;principal_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;authenticated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;principal_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;shadow_rules_stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio_dry_run_allow_&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_remote_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;forward_client_cert_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;APPEND_FORWARD&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;set_current_client_cert_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;subject&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;uri&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;websocket&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;stream_idle_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;normalize_path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_id_extension&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.request_id.uuid.v3.UuidRequestIdConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_request_id_for_trace_sampling&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;path_with_escaped_slashes_action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;KEEP_UNCHANGED&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5-http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;set_dst_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/xds.type.v3.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.set_internal_dst_address.v1.Config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;traffic_direction&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;INBOUND&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;internal_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.339Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ•°æ®åŒ…è¢«è½¬å‘åˆ° &lt;code&gt;inbound-pod|9080||10.4.0.5&lt;/code&gt; é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;STATIC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.internal_upstream&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.internal_upstream.v3.InternalUpstreamTransport&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;passthrough_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tunnel&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.raw_buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.raw_buffer.v3.RawBuffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_assignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-pod|9080||10.4.0.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_internal_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_listener_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_originate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint_id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.0.5:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;tunnel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.0.5:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.0.5:15008&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.139Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯¥é›†ç¾¤æ˜¯ &lt;code&gt;STATIC&lt;/code&gt; ç±»å‹ï¼Œå…¶ä¸­åŒ…å«äº† HBONE éš§é“é…ç½®ï¼ˆHTTP/2 CONNECT åœ°å€æ˜¯ &lt;code&gt;10.4.0.15008&lt;/code&gt;ï¼‰ï¼Œç«¯ç‚¹æ˜¯ Envoy å†…éƒ¨ç›‘å¬å™¨ &lt;code&gt;inbound_CONNECT_originate&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_originate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_originate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.tcp_proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_originate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_originate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;tunneling_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;hostname&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%DYNAMIC_METADATA(tunnel:destination)%&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;header&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;x-envoy-original-dst-host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%DYNAMIC_METADATA([\&amp;#34;tunnel\&amp;#34;, \&amp;#34;destination\&amp;#34;])%&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_original_dst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;set_dst_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/xds.type.v3.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.set_internal_dst_address.v1.Config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;internal_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.339Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;listener_filters&lt;/code&gt; ä¸­çš„ &lt;code&gt;set_dst_address&lt;/code&gt; å°†ç›®çš„åœ°åœ°å€è®¾ç½®ä¸º &lt;code&gt;10.4.0.5.15008&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨éš§é“ä¸­æ–°å¢äº†ä¸€ä¸ª Headerï¼š&lt;code&gt;x-envoy-original-dst-host&lt;/code&gt;ï¼Œå®ƒçš„å€¼æ˜¯ &lt;code&gt;10.4.0.5:9080&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;è¯¥é›†ç¾¤çš„ç«¯ç‚¹æ˜¯ &lt;code&gt;inbound_CONNECT_originate&lt;/code&gt; é›†ç¾¤ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;inbound_CONNECT_originate&lt;/code&gt; é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:45Z/82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_CONNECT_originate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ORIGINAL_DST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CLUSTER_PROVIDED&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cleanup_interval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;60s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_params&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_minimum_protocol_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TLSv1_3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_maximum_protocol_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TLSv1_3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;alpn_protocols&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;h2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate_sds_secret_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;set_node_on_first_message_only&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;initial_fetch_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;resource_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;combined_validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;default_validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;match_subject_alt_names&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;validation_context_sds_secret_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROOTCA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;set_node_on_first_message_only&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;initial_fetch_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;resource_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_extension_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy.extensions.upstreams.http.v3.HttpProtocolOptions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;explicit_http_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;allow_connect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-17T03:27:46.140Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯¥é›†ç¾¤çš„ç±»å‹æ˜¯ &lt;code&gt;ORIGINAL_DST&lt;/code&gt;ï¼Œç›´æ¥ä¸ä¸Šæ¸¸å»ºç«‹ HBONE éš§é“ï¼Œå°†æ•°æ®åŒ…å‘é€åˆ° Pod B çš„ 15008 ç«¯å£ã€‚åœ¨èŠ‚ç‚¹ B çš„ Ztunnel çš„æµé‡åŠ«æŒå’Œè·¯ç”±æ–¹å¼å°±è·Ÿ L4 æ˜¯ä¸€æ ·çš„äº†ï¼Œåœ¨è¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;L7 æµé‡è·¯ç”±æ˜¯åœ¨ L4 çš„åŸºç¡€ä¸Šå¢åŠ äº† Waypoint ä»£ç†ï¼Œè¯¥ä»£ç†ä¸­ Envoy å¤„ç†æ¯”è¾ƒå¤æ‚ã€‚Waypoint ä»£ç†ä½¿ç”¨ Gateway API ç”ŸæˆåŸºäº Deployment éƒ¨ç½²çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸ªåˆ«æœåŠ¡çš„è´Ÿè½½æƒ…å†µï¼Œå•ç‹¬æ‰©ç¼©å®¹å…¶ Waypoint ä»£ç†ï¼Œä¹Ÿå¯ä»¥åˆ›å»º HPA æ¥åŠ¨æ€æ‰©å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-original-destination&#34; title=&#34;Original destination - envoyproxy.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Original destination - envoyproxy.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/TXMyxbzBSfuYNquOZJmZTg&#34; title=&#34;ä¸€æ–‡è¯»æ‡‚ Ambient Mesh ä¸ƒå±‚æœåŠ¡æ²»ç† - mp.weixin.qq.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ–‡è¯»æ‡‚ Ambient Mesh ä¸ƒå±‚æœåŠ¡æ²»ç† - mp.weixin.qq.com&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio Ambient æ¨¡å¼ä¸­çš„é€æ˜æµé‡åŠ«æŒå››å±‚ç½‘ç»œè·¯ç”±è·¯å¾„è¯¦è§£</title>
      <link>https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/</link>
      <pubDate>Mon, 14 Nov 2022 22:09:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡é€šè¿‡åŠ¨æ‰‹æ“ä½œï¼Œå¸¦é¢†è¯»è€…ä¸€æ­¥æ­¥äº†è§£ Istio ambient æ¨¡å¼ä¸­çš„å››å±‚æµé‡è·¯å¾„ã€‚å¦‚æœä½ è¿˜ä¸äº†è§£ä»€ä¹ˆæ˜¯ Ambient æ¨¡å¼ï¼Œä»¥ä¸‹æ–‡ç« å¯ä»¥å¸®åŠ©ä½ äº†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/istio-ambient-mode/&#34; title=&#34;å…³äº Istio æ¨å‡º Ambient æ•°æ®å¹³é¢æ¨¡å¼çš„çœ‹æ³•&#34;&gt;å…³äº Istio æ¨å‡º Ambient æ•°æ®å¹³é¢æ¨¡å¼çš„çœ‹æ³•&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/introducing-ambient-mesh/&#34; title=&#34;Istio æ—  sidecar ä»£ç†æ•°æ®å¹³é¢ ambient æ¨¡å¼ç®€ä»‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ—  sidecar ä»£ç†æ•°æ®å¹³é¢ ambient æ¨¡å¼ç®€ä»‹&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/ambient-security/&#34; title=&#34;Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/what-is-ambient-mesh/&#34; title=&#34;ä»€ä¹ˆæ˜¯ Ambient Meshï¼Œå®ƒä¸ sidecar æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ Ambient Meshï¼Œå®ƒä¸ sidecar æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½ æƒ³ç•¥è¿‡å®é™…åŠ¨æ‰‹æ­¥éª¤ï¼Œåªæ˜¯æƒ³çŸ¥é“ Ambient æ¨¡å¼ä¸­çš„å››å±‚æµé‡è·¯å¾„ï¼Œè¯·çœ‹ä¸‹é¢æœåŠ¡ A çš„ä¸€ä¸ª Pod è®¿é—®ä¸åŒèŠ‚ç‚¹ä¸ŠæœåŠ¡ B çš„ Pod çš„å››å±‚æµé‡è·¯å¾„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/ambient-mesh-l4-traffic-path/ambient-mesh-l4-traffic-path.svg&#34; data-img=&#34;/blog/ambient-mesh-l4-traffic-path/ambient-mesh-l4-traffic-path.svg&#34; alt=&#34;image&#34; data-caption=&#34;Ambient æ¨¡å¼ä¸­çš„å››å±‚æµé‡è·¯å¾„&#34;&gt;
    
  
  &lt;figcaption&gt;Ambient æ¨¡å¼ä¸­çš„å››å±‚æµé‡è·¯å¾„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;principles&#34;&gt;åŸç†&lt;/h2&gt;
&lt;p&gt;Ambient æ¨¡å¼ä½¿ç”¨ &lt;strong&gt;tproxy&lt;/strong&gt; å’Œ &lt;strong&gt;HBONE&lt;/strong&gt; è¿™ä¸¤ä¸ªå…³é”®æŠ€æœ¯å®ç°é€æ˜æµé‡åŠ«æŒå’Œè·¯ç”±çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ tproxy å°†ä¸»æœº Pod ä¸­çš„æµé‡åŠ«æŒåˆ° Ztunnelï¼ˆEnvoy Proxyï¼‰ä¸­ï¼Œå®ç°é€æ˜æµé‡åŠ«æŒï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ HBONE å»ºç«‹åœ¨ Ztunnel ä¹‹é—´ä¼ é€’ TCP æ•°æ®æµéš§é“ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;what-is-tproxy&#34;&gt;ä»€ä¹ˆæ˜¯ tproxyï¼Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;tproxy&lt;/code&gt; æ˜¯ Linux å†…æ ¸è‡ª 2.2 ç‰ˆæœ¬ä»¥æ¥æ”¯æŒçš„é€æ˜ä»£ç†ï¼ˆTransparent proxyï¼‰ï¼Œå…¶ä¸­çš„ t ä»£è¡¨ transparentï¼Œå³é€æ˜ã€‚ä½ éœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ &lt;code&gt;NETFILTER_TPROXY&lt;/code&gt; å’Œç­–ç•¥è·¯ç”±ã€‚é€šè¿‡ tproxyï¼ŒLinux å†…æ ¸å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°†æ•°æ®åŒ…é‡å®šå‘åˆ°ç”¨æˆ·ç©ºé—´ã€‚è¯¦è§ &lt;a href=&#34;http://lxr.linux.no/linux&amp;#43;v3.10/Documentation/networking/tproxy.txt&#34; title=&#34;tproxy æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tproxy æ–‡æ¡£&lt;/a&gt;
 ã€‚&lt;/p&gt;
&lt;h3 id=&#34;what-is-hbone&#34;&gt;ä»€ä¹ˆæ˜¯ HBONEï¼Ÿ&lt;/h3&gt;
&lt;p&gt;HBONE æ˜¯ HTTP-Based Overlay Network Environment çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨ HTTP åè®®æä¾›éš§é“èƒ½åŠ›çš„æ–¹æ³•ã€‚å®¢æˆ·ç«¯å‘ HTTP ä»£ç†æœåŠ¡å™¨å‘é€ HTTP CONNECT è¯·æ±‚ï¼ˆå…¶ä¸­åŒ…å«äº†ç›®çš„åœ°å€ï¼‰ä»¥å»ºç«‹éš§é“ï¼Œä»£ç†æœåŠ¡å™¨ä»£è¡¨å®¢æˆ·ç«¯ä¸ç›®çš„åœ°å»ºç«‹ TCP è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨é€æ˜çš„ä¼ è¾“ TCP æ•°æ®æµåˆ°ç›®çš„æœåŠ¡å™¨ã€‚åœ¨ Ambient æ¨¡å¼ä¸­ï¼ŒZtunnelï¼ˆå…¶ä¸­çš„ Envoyï¼‰å®é™…ä¸Šæ˜¯å……å½“äº†é€æ˜ä»£ç†ï¼Œå®ƒä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/other_features/internal_listener&#34; title=&#34;Envoy Internal Listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Internal Listener&lt;/a&gt;
 æ¥æ¥æ”¶ HTTP CONNECT è¯·æ±‚å’Œä¼ é€’ TCP æµç»™ä¸Šæ¸¸é›†ç¾¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;environment&#34;&gt;ç¯å¢ƒè¯´æ˜&lt;/h2&gt;
&lt;p&gt;åœ¨å¼€å§‹åŠ¨æ‰‹æ“ä½œä¹‹å‰ï¼Œéœ€è¦å…ˆè¯´æ˜ä¸€ä¸‹ç¬”è€…çš„æ¼”ç¤ºç¯å¢ƒï¼Œæœ¬æ–‡ä¸­å¯¹åº”çš„å¯¹è±¡åç§°ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä»£å·&lt;/th&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;IP&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡ A Pod&lt;/td&gt;
&lt;td&gt;sleep-5644bdc767-2dfg7&lt;/td&gt;
&lt;td&gt;10.4.4.19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡ B Pod&lt;/td&gt;
&lt;td&gt;productpage-v1-5586c4d4ff-qxz9f&lt;/td&gt;
&lt;td&gt;10.4.3.20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ztunnel A Pod&lt;/td&gt;
&lt;td&gt;ztunnel-rts54&lt;/td&gt;
&lt;td&gt;10.4.4.18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ztunnel B Pod&lt;/td&gt;
&lt;td&gt;ztunnel-z4qmh&lt;/td&gt;
&lt;td&gt;10.4.3.14&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èŠ‚ç‚¹ A&lt;/td&gt;
&lt;td&gt;gke-jimmy-cluster-default-pool-d5041909-d10i&lt;/td&gt;
&lt;td&gt;10.168.15.222&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èŠ‚ç‚¹ B&lt;/td&gt;
&lt;td&gt;gke-jimmy-cluster-default-pool-d5041909-c1da&lt;/td&gt;
&lt;td&gt;10.168.15.224&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡ B Cluster&lt;/td&gt;
&lt;td&gt;productpage&lt;/td&gt;
&lt;td&gt;10.8.14.226&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ³¨æ„ï¼šå› ä¸ºè¿™äº›åç§°å°†åœ¨åç»­çš„å‘½ä»¤è¡Œä¸­ç”¨åˆ°ï¼Œæ–‡ä¸­å°†ä½¿ç”¨ä»£ç§°ï¼Œä»¥ä¾¿ä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­å®éªŒã€‚&lt;/p&gt;
&lt;p&gt;ç¬”è€…åœ¨ GKE ä¸­å®‰è£…äº† Ambient æ¨¡å¼çš„ Istioï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/blog/istio-ambient-mode/#setup&#34; title=&#34;è¯¥æ­¥éª¤&#34;&gt;è¯¥æ­¥éª¤&lt;/a&gt;
å®‰è£…ï¼Œæ³¨æ„ä¸è¦å®‰è£… Gatewayï¼Œä»¥å…å¯ç”¨ L7 åŠŸèƒ½ï¼Œå¦åˆ™æµé‡è·¯å¾„å°†äº L4 æµé‡ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å°†åŠ¨æ‰‹å®éªŒï¼Œæ·±å…¥æ¢ç©¶ &lt;code&gt;sleep&lt;/code&gt; æœåŠ¡çš„ Pod è®¿é—®ä¸åŒèŠ‚ç‚¹ä¸Š &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡çš„ Pod çš„å››å±‚æµé‡è·¯å¾„ã€‚æˆ‘ä»¬å°†åˆ†åˆ«æ£€è§† Pod çš„ outbound å’Œ inbound æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;outbound&#34;&gt;Outbound æµé‡åŠ«æŒ&lt;/h2&gt;
&lt;p&gt;Ambient mesh çš„ pod å‡ºç«™æµé‡çš„é€æ˜æµé‡åŠ«æŒæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»º &lt;code&gt;istioout&lt;/code&gt; ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°† Ambient mesh ä¸­çš„ Pod IP åŠ å…¥ &lt;a href=&#34;https://ipset.netfilter.org/&#34; title=&#34;IP é›†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IP é›†&lt;/a&gt;
ï¼Œå¹¶é€šè¿‡ netfilter &lt;code&gt;nfmark&lt;/code&gt; æ ‡è®°å’Œè·¯ç”±è§„åˆ™ï¼Œå°† Ambient mesh ä¸­çš„å‡ºç«™æµé‡é€šè¿‡ Geneve éš§é“é€æ˜åŠ«æŒåˆ° &lt;code&gt;pistioout&lt;/code&gt; è™šæ‹Ÿç½‘å¡ï¼›&lt;/li&gt;
&lt;li&gt;ztunnel ä¸­çš„ init å®¹å™¨åˆ›å»º iptables è§„åˆ™ï¼Œå°† &lt;code&gt;pistioout&lt;/code&gt; ç½‘å¡ä¸­çš„æ‰€æœ‰æµé‡è½¬å‘åˆ° ztunnel ä¸­çš„ Envoy ä»£ç†çš„ 15001 ç«¯å£ï¼›&lt;/li&gt;
&lt;li&gt;Envoy å¯¹æ•°æ®åŒ…è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸ä¸Šæ¸¸ç«¯ç‚¹å»ºç«‹ HBONE éš§é“ï¼ˆHTTP CONNECTï¼‰ï¼Œå°†æ•°æ®åŒ…è½¬å‘åˆ°ä¸Šæ¸¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;node-a-rules&#34;&gt;æ£€æŸ¥èŠ‚ç‚¹ A ä¸Šçš„è·¯ç”±è§„åˆ™&lt;/h3&gt;
&lt;p&gt;ç™»å½•åˆ°æœåŠ¡ A æ‰€åœ¨çš„èŠ‚ç‚¹ Aï¼Œä½¿ç”¨ &lt;code&gt;iptables-save&lt;/code&gt; æŸ¥çœ‹è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables-save
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -j ztunnel-PREROUTING
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes service portals&amp;#34;&lt;/span&gt; -j KUBE-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-POSTROUTING -m mark --mark 0x100/0x100 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m mark --mark 0x100/0x100 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*mangle
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -j ztunnel-PREROUTING
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A INPUT -j ztunnel-INPUT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A FORWARD -j ztunnel-FORWARD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A OUTPUT -j ztunnel-OUTPUT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A OUTPUT -s 169.254.169.254/32 -j DROP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A POSTROUTING -j ztunnel-POSTROUTING
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-FORWARD -m mark --mark 0x220/0x220 -j CONNMARK --save-mark --nfmask 0x220 --ctmask 0x220
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-FORWARD -m mark --mark 0x210/0x210 -j CONNMARK --save-mark --nfmask 0x210 --ctmask 0x210
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-INPUT -m mark --mark 0x220/0x220 -j CONNMARK --save-mark --nfmask 0x220 --ctmask 0x220
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-INPUT -m mark --mark 0x210/0x210 -j CONNMARK --save-mark --nfmask 0x210 --ctmask 0x210
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-OUTPUT -s 10.4.4.1/32 -j MARK --set-xmark 0x220/0xffffffff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -i istioin -j MARK --set-xmark 0x200/0x200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -i istioin -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -i istioout -j MARK --set-xmark 0x200/0x200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -i istioout -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -p udp -m udp --dport &lt;span class=&#34;m&#34;&gt;6081&lt;/span&gt; -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m connmark --mark 0x220/0x220 -j MARK --set-xmark 0x200/0x200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m mark --mark 0x200/0x200 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING ! -i veth300a1d80 -m connmark --mark 0x210/0x210 -j MARK --set-xmark 0x40/0x40
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m mark --mark 0x40/0x40 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING ! -s 10.4.4.18/32 -i veth300a1d80 -j MARK --set-xmark 0x210/0x210
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m mark --mark 0x200/0x200 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -i veth300a1d80 -j MARK --set-xmark 0x220/0x220
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -p udp -j MARK --set-xmark 0x220/0x220
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m mark --mark 0x200/0x200 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -p tcp -m &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --match-set ztunnel-pods-ips src -j MARK --set-xmark 0x100/0x100&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;iptables è§„åˆ™è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 3 è¡Œï¼šPREROUTING é“¾æ˜¯æœ€å…ˆè¿è¡Œçš„ï¼Œæ‰€æœ‰æ•°æ®åŒ…å°†å…ˆè¿›å…¥ &lt;code&gt;ztunnel-PREROUTING&lt;/code&gt; é“¾ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 4 è¡Œï¼šå°†æ•°æ®åŒ…å‘å¾€ &lt;code&gt;KUBE-SERVICES&lt;/code&gt; é“¾ï¼Œåœ¨é‚£é‡Œå°† Kubernetes Service çš„ Cluster IP è¿›è¡Œ DNAT è½¬æ¢ä¸º Pod IPï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 6 è¡Œï¼šå¸¦æœ‰ &lt;code&gt;0x100/0x100&lt;/code&gt; æ ‡è®°çš„æ•°æ®åŒ…é€šè¿‡ PREROUTING é“¾ï¼Œä¸å†ç»è¿‡ &lt;code&gt;KUBE-SERVICES&lt;/code&gt; é“¾ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 35 è¡Œï¼šè¿™æ˜¯æ·»åŠ åˆ° &lt;code&gt;ztunnel-PREROUTING&lt;/code&gt; é“¾ä¸Šçš„æœ€åä¸€æ¡è§„åˆ™ï¼Œè¿›å…¥ &lt;code&gt;ztunnel-PREROUTING&lt;/code&gt; é“¾ä¸­çš„åœ¨ &lt;code&gt;ztunnel-pods-ips&lt;/code&gt; IP é›†ä¸­çš„æ‰€æœ‰ TCP æ•°æ®åŒ…éƒ½ä¼šè¢«æ‰“ä¸Š &lt;code&gt;0x100/0x100&lt;/code&gt; çš„æ ‡è®°ï¼Œå®ƒå°†è¦†ç›–å‰é¢çš„æ‰€æœ‰æ ‡è®°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº iptables è®¾ç½® mark å’Œ xmark æ ‡è®°
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;p&gt;&lt;code&gt;MARK&lt;/code&gt; è¿™ä¸ªæ‰©å±•ç›®æ ‡å¯ä»¥ç”¨æ¥ç»™æ•°æ®åŒ…æ‰“æ ‡è®°ï¼Œæ ‡è®°åˆ†ä¸¤ç§ï¼šä¸€ç§æ˜¯ç”¨äºæ ‡è®°é“¾æ¥çš„ &lt;code&gt;ctmark&lt;/code&gt;ï¼Œä¸€ç§æ˜¯ç”¨äºæ ‡è®°æ•°æ®åŒ…çš„ &lt;code&gt;nfmark&lt;/code&gt; ã€‚&lt;code&gt;nfmark&lt;/code&gt;å å››ä¸ªå­—èŠ‚å…± 32 ä½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 32 ä½çš„æ— ç¬¦å·æ•´æ•°ï¼Œä¸€èˆ¬ç”¨ 16 è¿›åˆ¶æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;Mark çš„è®¾ç½®ä¸€å…±æœ‰äº”ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯ &lt;code&gt;--set-xmark&lt;/code&gt;ã€&lt;code&gt;--set-mark&lt;/code&gt;ã€&lt;code&gt;--and-mark&lt;/code&gt;ã€&lt;code&gt;--and-mark&lt;/code&gt;ã€&lt;code&gt;--or-mark&lt;/code&gt; å’Œ &lt;code&gt;--xor-mark&lt;/code&gt;ã€‚åœ¨æœ¬æ–‡ç”¨åˆ°äº†å‰ä¸¤ç§ï¼Œä¸‹é¢å°†åˆ†åˆ«ä¸ºå¤§å®¶ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;--set-xmark value[/mask]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„ &lt;code&gt;value&lt;/code&gt; å’Œæ©ç  &lt;code&gt;mask&lt;/code&gt; éƒ½æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œä¸€èˆ¬ç”¨ 16 è¿›åˆ¶è¡¨ç¤ºã€‚å†…æ ¸è®¾ç½®æ•°æ®åŒ… nfmark å€¼çš„æµç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆï¼Œå†…æ ¸ä¼šå…ˆç”¨ mask é¢„å¤„ç†æ•°æ®åŒ…åŸæ¥çš„ nfmarkï¼Œå¤„ç†æ–¹æ³•æ˜¯ï¼šå¦‚æœ mask çš„ç¬¬ N ä½ï¼ˆäºŒè¿›åˆ¶ï¼‰ä¸º 1ï¼Œåˆ™å°†æ•°æ®åŒ…çš„ nfmark ç¬¬çš„ N ä½ï¼ˆäºŒè¿›åˆ¶ï¼‰æ¸…é›¶ï¼ˆZero outï¼‰ ï¼Œå¦‚æœ mask çš„ç¬¬ N ä½ä¸º 0ï¼Œé‚£ä¹ˆæ•°æ®åŒ…çš„ nfmark ä½ä¿æŒä¸å˜&lt;/li&gt;
&lt;li&gt;å†ç”¨ä¸Šé¢é¢„å¤„ç†åçš„ nfmark å’Œ value åšå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°æ•°æ®åŒ…æœ€åçš„ nfmark å€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬è®¾ç½®äº† &lt;code&gt;--set-xmark 0x4000/0xffffffff&lt;/code&gt;ï¼Œæ©ç ä¸º &lt;code&gt;0xffffffff&lt;/code&gt;ï¼Œæ©ç è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶çš„è¯ 32 ä½æ¯ä¸€ä½éƒ½æ˜¯ &lt;code&gt;1&lt;/code&gt;ï¼Œé‚£ä¹ˆå†…æ ¸é¦–å…ˆä¼šå°†æ•°æ®åŒ…åŸæ¥çš„ &lt;code&gt;nfmark&lt;/code&gt; æ‰€æœ‰çš„ä½éƒ½æ¸…é›¶ï¼ˆå¼‚æˆ–è¿ç®—ï¼Œç›¸å½“äºæ˜¯å…ˆæŠŠ &lt;code&gt;nfmark&lt;/code&gt; ç½® 0ï¼‰ï¼Œç„¶åå†å’Œ value åšå¼‚æˆ–æ“ä½œï¼Œé‚£ä¹ˆå¾—åˆ°çš„æœ€åçš„ &lt;code&gt;nfmark&lt;/code&gt; å€¼å°±æ˜¯ &lt;code&gt;0x4000&lt;/code&gt;ã€‚æ‰€ä»¥ï¼Œæ•°æ®åŒ…ç»è¿‡è¿™æ¡è§„åˆ™åï¼Œå®ƒçš„ nfmark å€¼å°±æ˜¯ &lt;code&gt;0x4000&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„æ©ç  &lt;code&gt;mask&lt;/code&gt; æ˜¯ä¸ªå¯é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸º &lt;code&gt;0xffffffff&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œçœç•¥ &lt;code&gt;mask&lt;/code&gt; çš„å€¼æˆ–è€…å°† &lt;code&gt;mask&lt;/code&gt; å’Œ &lt;code&gt;value&lt;/code&gt; çš„å€¼è®¾ç½®æˆä¸€æ ·å¯ä»¥å¿«é€Ÿè®¾ç½®æ•°æ®åŒ…çš„ &lt;code&gt;nfmark&lt;/code&gt; å€¼ä¸º &lt;code&gt;value&lt;/code&gt;ã€‚è¯»è€…å¯ä»¥è‡ªå·±æ¨å¯¼ä¸€ä¸‹ï¼š&lt;code&gt;value XOR 0xFFFFFFFF XOR value =value&lt;/code&gt;ï¼Œ&lt;code&gt;value XOR value XOR value = value&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;--set-mark value[/mask]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®æ­¥éª¤ä¸ä¸Šæ–‡ç±»ä¼¼ã€‚ç¬¬ä¸€æ­¥é¢„å¤„ç†ä¹Ÿæ˜¯å°†åŸæ¥çš„ &lt;code&gt;nfmark&lt;/code&gt; ä¸ mask è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç¬¬äºŒæ­¥ä¸åŒï¼Œè¯¥æ–¹æ³•æ˜¯å°†é¢„å¤„ç†çš„ nfmark å’Œ value åšæˆ–ï¼ˆORï¼‰è¿ç®—ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œçœç•¥ &lt;code&gt;mask&lt;/code&gt; çš„å€¼ï¼Œæˆ–è€…å°† &lt;code&gt;mask&lt;/code&gt; ä¸ &lt;code&gt;value&lt;/code&gt; å€¼è®¾ç½®æˆä¸€æ ·å¯ä»¥å¿«é€Ÿè®¾ç½®æ•°æ®åŒ…çš„ &lt;code&gt;nfmark&lt;/code&gt; å€¼ä¸º &lt;code&gt;value&lt;/code&gt;ã€‚è¯»è€…å¯ä»¥è‡ªå·±æ¨å¯¼ä¸€ä¸‹ï¼š&lt;code&gt;value XOR 0xFFFFFFFF OR value = value&lt;/code&gt;ï¼Œ&lt;code&gt;0 OR value = value&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;a href=&#34;https://ipset.netfilter.org/iptables-extensions.man.html#lbDD&#34; title=&#34;netfilter æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;netfilter æ–‡æ¡£&lt;/a&gt;
 äº†è§£è¯¦æƒ…ã€‚&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸Š iptables è§„åˆ™ï¼Œå¯ä»¥ç¡®ä¿ Ambient Mesh ä»…æ‹¦æˆª &lt;code&gt;ztunnel-pods-ips&lt;/code&gt; IP é›† Pod ä¸­çš„æ•°æ®åŒ…å¹¶ç»™æ•°æ®åŒ…æ‰“ä¸Š &lt;code&gt;0x100/0x100&lt;/code&gt; æ ‡è®°ï¼ˆ&lt;code&gt;nfmark&lt;/code&gt;ï¼Œæ ¼å¼ä¸º &lt;code&gt;å€¼/æ©ç &lt;/code&gt;ï¼Œå€¼å’Œæ©ç éƒ½æ˜¯ 32 ä½çš„äºŒè¿›åˆ¶æ•´æ•°ï¼Œï¼‰ï¼Œè€Œä¸å½±å“å…¶ä»– Podã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº ztunnel-pods-ips IP é›†
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;code&gt;ztunnel-pods-ips&lt;/code&gt; æ˜¯ç”± Istio CNI åˆ›å»ºçš„ &lt;a href=&#34;https://ipset.netfilter.org/&#34; title=&#34;IP é›†ï¼ˆIP Setï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IP é›†ï¼ˆIP Setï¼‰&lt;/a&gt;
ï¼Œè¿™é‡Œé¢ä¿å­˜ç€è¯¥èŠ‚ç‚¹ä¸Š Ambient Mesh ä¸­çš„æ‰€æœ‰ Pod çš„ IP åœ°å€ã€‚IP é›†æ˜¯ Linux å†…æ ¸ä¸­çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ç”± &lt;a href=&#34;https://ipset.netfilter.org/ipset.man.html&#34; title=&#34;ipset&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ipset&lt;/a&gt;
 å®ç”¨ç¨‹åºç®¡ç†ã€‚IP é›†å¯ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ IP åœ°å€ã€ç½‘ç»œã€ï¼ˆTCP/UDPï¼‰ç«¯å£å·ã€MAC åœ°å€ã€æ¥å£åç§°æˆ–å®ƒä»¬çš„ç»„åˆï¼Œä»è€Œç¡®ä¿åœ¨æ¡ç›®ä¸é›†åˆåŒ¹é…æ—¶å…·æœ‰é—ªç”µèˆ¬çš„é€Ÿåº¦ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;details class=&#34;spoiler&#34; id=&#34;spoiler-3&#34;&gt;
  &lt;summary&gt;ç”¨ &lt;code&gt;iptables -t nat -L&lt;/code&gt; æŒ‰é¡ºåºæŸ¥çœ‹ iptables è§„åˆ™ï¼Œå°†å¯ä»¥æ›´æ˜æ˜¾çš„çœ‹åˆ°è·¯ç”±è·¯å¾„ã€‚&lt;/summary&gt;
  &lt;p&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain PREROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æ•°æ®åŒ…é¦–å…ˆè¿›å…¥ ztunnel-PREROUTING é“¾å¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ztunnel-PREROUTING  all  --  anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç„¶åè¿›å…¥ KUBE-SERVICES é“¾å¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SERVICES  all  --  anywhere             anywhere             /* kubernetes service portals */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SERVICES  all  --  anywhere             anywhere             /* kubernetes service portals */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain POSTROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ztunnel-POSTROUTING  all  --  anywhere             anywhere            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-POSTROUTING  all  --  anywhere             anywhere             /* kubernetes postrouting rules */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP-MASQ    all  --  anywhere             anywhere             /* ip-masq: ensure nat POSTROUTING directs all non-LOCAL destination traffic to our custom IP-MASQ chain */ ADDRTYPE match dst-type !LOCAL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* Omit KUBE-SVC chains */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ztunnel-POSTROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ACCEPT     all  --  anywhere             anywhere             mark match 0x100/0x100
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ztunnel-PREROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# é€šè¿‡æ‰€æœ‰è¢«æ‰“ä¸Š 0x100/0x100 æ ‡è®°çš„æ•°æ®åŒ…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ACCEPT     all  --  anywhere             anywhere             mark match 0x100/0x100
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;/details&gt;

&lt;p&gt;æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹è¯¥èŠ‚ç‚¹çš„è·¯ç”±è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip rule
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0:      from all lookup &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;100:    from all fwmark 0x200/0x200 goto &lt;span class=&#34;m&#34;&gt;32766&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;101:    from all fwmark 0x100/0x100 lookup &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;102:    from all fwmark 0x40/0x40 lookup &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;103:    from all lookup &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32766:  from all lookup main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32767:  from all lookup default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·¯ç”±è¡¨å°†æŒ‰é¡ºåºæ‰§è¡Œï¼Œç¬¬ä¸€åˆ—è¡¨ç¤ºçš„æ˜¯è·¯ç”±è¡¨çš„ä¼˜å…ˆçº§ï¼Œç¬¬äºŒåˆ—è¡¨ç¤ºè¦æŸ¥æ‰¾æˆ–è·³è½¬çš„è·¯ç”±è¡¨ã€‚ä½ ä¼šçœ‹åˆ°æ‰€æœ‰å¸¦æœ‰ &lt;code&gt;0x100/0x100&lt;/code&gt; æ ‡è®°çš„æ•°æ®åŒ…å°†æŸ¥æ‰¾ 101 è·¯ç”±è¡¨ã€‚æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹è¯¥è·¯ç”±è¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip route show table &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default via 192.168.127.2 dev istioout 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.4.18 dev veth52b75946 scope link 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šçœ‹åˆ° &lt;code&gt;101&lt;/code&gt; è·¯ç”±è¡¨ä¸­å¸¦æœ‰å…³é”®å­— &lt;code&gt;via&lt;/code&gt; ï¼Œè¿™è¡¨ç¤ºæ•°æ®åŒ…å°†é€šè¿‡ç½‘å…³ä¼ è¾“ï¼ŒæŸ¥çœ‹ &lt;a href=&#34;http://linux-ip.net/html/tools-ip-route.html#tools-ip-route-show&#34; title=&#34;ip route å‘½ä»¤çš„ç”¨æ³•&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ip route å‘½ä»¤çš„ç”¨æ³•&lt;/a&gt;
ã€‚æ‰€æœ‰æ•°æ®åŒ…è¢«é€šè¿‡ &lt;code&gt;istioout&lt;/code&gt; ç½‘å¡å‘é€åˆ°ç½‘å…³ï¼ˆIP æ˜¯ &lt;code&gt;192.168.127.2&lt;/code&gt;ï¼‰ã€‚å¦ä¸€è¡Œè¡¨ç¤ºæ˜¯å½“å‰èŠ‚ç‚¹ä¸Š ztunnel pod çš„è·¯ç”±é“¾è·¯ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº 101 è·¯ç”±è¡¨
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;p&gt;æ‰€è°“è·¯ç”±è¡¨ï¼ˆRouting Tableï¼‰ï¼ŒæŒ‡çš„æ˜¯è·¯ç”±å™¨æˆ–è€…å…¶ä»–äº’è”ç½‘ç½‘ç»œè®¾å¤‡ä¸Šå­˜å‚¨çš„è¡¨ï¼Œè¯¥è¡¨ä¸­å­˜æœ‰åˆ°è¾¾ç‰¹å®šç½‘ç»œç»ˆç«¯çš„è·¯å¾„ã€‚è·¯ç”±å™¨çš„ä¸»è¦å·¥ä½œå°±æ˜¯ä¸ºç»è¿‡è·¯ç”±å™¨çš„æ¯ä¸ªæ•°æ®åŒ…å¯»æ‰¾ä¸€æ¡æœ€ä½³çš„ä¼ è¾“è·¯å¾„ï¼Œå¹¶å°†è¯¥æ•°æ®æœ‰æ•ˆåœ°ä¼ é€åˆ°ç›®çš„ç«™ç‚¹ã€‚ä¸ºäº†å®Œæˆè¿™é¡¹å·¥ä½œï¼Œåœ¨è·¯ç”±å™¨ä¸­ä¿å­˜ç€å„ç§ä¼ è¾“è·¯å¾„çš„ç›¸å…³æ•°æ®ï¼Œä¾›è·¯ç”±é€‰æ‹©æ—¶ä½¿ç”¨ï¼Œè¡¨ä¸­åŒ…å«çš„ä¿¡æ¯å†³å®šäº†æ•°æ®è½¬å‘çš„ç­–ç•¥ã€‚è·¯ç”±è¡¨æ ¹æ®å…¶å»ºç«‹çš„æ–¹æ³•ï¼Œå¯ä»¥åˆ†ä¸º&lt;strong&gt;åŠ¨æ€è·¯ç”±è¡¨&lt;/strong&gt;å’Œ&lt;strong&gt;é™æ€è·¯ç”±è¡¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;101 è·¯ç”±è¡¨æ˜¯ç”± Istio CNI åˆ›å»ºçš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å¸¦æœ‰ &lt;code&gt;0x100/0x00&lt;/code&gt; fwmark çš„æ•°æ®åŒ…è½¬å‘åˆ° ztunnel ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç¼–å· 1 åˆ° 252 çš„è·¯ç”±è¡¨ï¼ŒLinux ç³»ç»Ÿç»´æŠ¤äº† 4 ä¸ªè·¯ç”±è¡¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0ï¼šç³»ç»Ÿä¿ç•™è¡¨&lt;/li&gt;
&lt;li&gt;253ï¼šdefulte è¡¨ï¼Œæ²¡ç‰¹åˆ«æŒ‡å®šçš„é»˜è®¤è·¯ç”±éƒ½æ”¾åœ¨æ”¹è¡¨&lt;/li&gt;
&lt;li&gt;254ï¼šmain è¡¨ï¼Œæ²¡æŒ‡æ˜è·¯ç”±è¡¨çš„æ‰€æœ‰è·¯ç”±æ”¾åœ¨è¯¥è¡¨ï¼Œé»˜è®¤è¡¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;ip route list&lt;/code&gt; æˆ– &lt;code&gt;route -n&lt;/code&gt; æˆ– &lt;code&gt;netstat -rn&lt;/code&gt; æŸ¥çœ‹çš„è·¯ç”±è®°å½•å³ä¸º main è¡¨ä¸­çš„è®°å½•&lt;/li&gt;
&lt;li&gt;255ï¼šlocale è¡¨ï¼Œä¿å­˜æœ¬åœ°æ¥å£åœ°å€ï¼Œå¹¿æ’­åœ°å€ã€NAT åœ°å€ ç”±ç³»ç»Ÿç»´æŠ¤ï¼Œç”¨æˆ·ä¸å¾—æ›´æ”¹&lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹ &lt;code&gt;istioout&lt;/code&gt; ç½‘å¡çš„è¯¦ç»†ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d addr show istioout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;24: istioout: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1410&lt;/span&gt; qdisc noqueue state UNKNOWN group default 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether 62:59:1b:ad:79:01 brd ff:ff:ff:ff:ff:ff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    geneve id &lt;span class=&#34;m&#34;&gt;1001&lt;/span&gt; remote 10.4.4.18 ttl auto dstport &lt;span class=&#34;m&#34;&gt;6081&lt;/span&gt; noudpcsum udp6zerocsumrx numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 192.168.127.1/30 brd 192.168.127.3 scope global istioout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet6 fe80::6059:1bff:fead:7901/64 scope link 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Pod A ä¸­çš„ &lt;code&gt;istioout&lt;/code&gt; ç½‘å¡é€šè¿‡ Geneve tunnel ä¸ ztunnel A ä¸­çš„ &lt;code&gt;pstioout&lt;/code&gt; ç½‘å¡è¿é€šã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº istioout ç½‘å¡
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;code&gt;istioout&lt;/code&gt; æ˜¯ä¸€ä¸ª &lt;a href=&#34;https://datatracker.ietf.org/doc/html/draft-gross-geneve-00&#34; title=&#34;Geneveï¼ˆGeneric Network Virtualization Encapsulationï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Geneveï¼ˆGeneric Network Virtualization Encapsulationï¼‰&lt;/a&gt;
ç±»å‹çš„è™šæ‹Ÿç½‘å¡ï¼Œå®ƒçš„ IP æ˜¯ &lt;code&gt;192.168.127.1&lt;/code&gt;ï¼Œè¿œç«¯æ˜¯ &lt;code&gt;10.4.2.19&lt;/code&gt;ï¼ˆèŠ‚ç‚¹ A ä¸Šçš„ ztunnel Pod çš„ IPï¼‰ï¼Œç½‘å…³æ˜¯ &lt;code&gt;192.168.127.2&lt;/code&gt;ï¼ˆèŠ‚ç‚¹ A ä¸Š ztunnel Pod ä¸­ &lt;code&gt;pistioout&lt;/code&gt; ç½‘å¡çš„ IPï¼Œåœ¨ä¸‹æ–‡ä¼šçœ‹åˆ°ï¼‰ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;ztunnel-a-rules&#34;&gt;æ£€æŸ¥ Ztunnel A ä¸Šçš„è·¯ç”±è§„åˆ™&lt;/h3&gt;
&lt;p&gt;è¿›å…¥ Ztunnel A Podï¼Œä½¿ç”¨ &lt;code&gt;ip -d a&lt;/code&gt; å‘½ä»¤æ£€æŸ¥å®ƒçš„ç½‘å¡ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; qdisc noqueue state UNKNOWN group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 127.0.0.1/8 scope host lo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2: eth0@if16: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1460&lt;/span&gt; qdisc noqueue state UP group default 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether 06:3e:d1:5d:95:16 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    veth numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 10.4.2.1/24 brd 10.4.4.255 scope global eth0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;3: pistioin: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1410&lt;/span&gt; qdisc noqueue state UNKNOWN group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether 06:18:ee:29:7e:e4 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65485&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    geneve id &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt; remote 10.4.2.1 ttl auto dstport &lt;span class=&#34;m&#34;&gt;6081&lt;/span&gt; noudpcsum udp6zerocsumrx numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 192.168.126.2/30 scope global pistioin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;4: pistioout: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1410&lt;/span&gt; qdisc noqueue state UNKNOWN group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether aa:40:40:7c:07:b2 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65485&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    geneve id &lt;span class=&#34;m&#34;&gt;1001&lt;/span&gt; remote 10.4.2.1 ttl auto dstport &lt;span class=&#34;m&#34;&gt;6081&lt;/span&gt; noudpcsum udp6zerocsumrx numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 192.168.127.2/30 scope global pistioout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä½ å°†å‘ç°å…¶ä¸­æœ‰ä¸¤ä¸ªç½‘å¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pistioin&lt;/code&gt; ï¼šIP ä¸º &lt;code&gt;192.168.126.2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pistioout&lt;/code&gt;ï¼šIP ä¸º &lt;code&gt;192.168.127.2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº pistioin å’Œ pistioout ç½‘å¡
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  è¿™ä¸¤ä¸ªç½‘å¡éƒ½æ˜¯ç”± ztunnel ä¸­çš„ init å®¹å™¨åˆ›å»ºçš„ Geneve ç±»å‹çš„è™šæ‹Ÿç½‘å¡ï¼Œå…¶ IP åœ°å€ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œå¦‚æœä½ æŸ¥çœ‹ ztunnel çš„ YAML é…ç½®å°†å‘ç°å…¶ä¸­çš„ç½‘å¡åˆ›å»ºå‘½ä»¤ï¼Œåœ¨æ­¤æˆ‘ä»¬æŒ‰ä¸‹ä¸è¡¨ï¼Œå› ä¸º Ambient æ¨¡å¼è¿˜åœ¨å¼€å‘åˆæœŸï¼Œè¿™äº›å¯åŠ¨å‘½ä»¤æœªæ¥å¯èƒ½æœ‰å¾ˆå¤§å˜åŒ–ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è‡ª Pod A çš„æµé‡è¿›å…¥ ztunnel ä¹‹åï¼Œå¦‚ä½•å¯¹æµé‡è¿›è¡Œå¤„ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ iptablesï¼ŒæŸ¥çœ‹ ztunnel A ä¸­çš„ iptables è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables-save
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*mangle
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;:PREROUTING ACCEPT &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;185880:96984381&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;:INPUT ACCEPT &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;185886:96984813&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;:FORWARD ACCEPT &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;:OUTPUT ACCEPT &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;167491:24099839&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;:POSTROUTING ACCEPT &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;167491:24099839&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -j LOG --log-prefix &lt;span class=&#34;s2&#34;&gt;&amp;#34;mangle pre [ ztunnel-rts54] &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -i pistioin -p tcp -m tcp --dport &lt;span class=&#34;m&#34;&gt;15008&lt;/span&gt; -j TPROXY --on-port &lt;span class=&#34;m&#34;&gt;15008&lt;/span&gt; --on-ip 127.0.0.1 --tproxy-mark 0x400/0xfff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -i pistioout -p tcp -j TPROXY --on-port &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; --on-ip 127.0.0.1 --tproxy-mark 0x400/0xfff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -i pistioin -p tcp -j TPROXY --on-port &lt;span class=&#34;m&#34;&gt;15006&lt;/span&gt; --on-ip 127.0.0.1 --tproxy-mark 0x400/0xfff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ° ztunnel A ä¸­çš„æ‰€æœ‰å‘å¾€ &lt;code&gt;pistioin&lt;/code&gt; ç½‘å¡çš„ TCP æµé‡é€æ˜è½¬å‘åˆ° &lt;code&gt;15001&lt;/code&gt; ç«¯å£ï¼ˆEnvoy çš„ outbound ç«¯å£ï¼‰ï¼Œå¹¶æ‰“ä¸Šäº† &lt;code&gt;0x400/0xfff&lt;/code&gt; çš„æ ‡è®°ã€‚è¿™ä¸ªæ ‡è®°å¯ä»¥ä¿è¯æ•°æ®åŒ…å‘å¾€æ­£ç¡®çš„ç½‘å¡ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº tproxy
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;code&gt;tproxy&lt;/code&gt; æ˜¯ Linux å†…æ ¸è‡ª 2.2 ç‰ˆæœ¬ä»¥æ¥æ”¯æŒçš„é€æ˜ä»£ç†ï¼ˆTransparent proxyï¼‰ï¼Œå…¶ä¸­çš„ t ä»£è¡¨ transparentï¼Œå³é€æ˜ã€‚ä½ éœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ &lt;code&gt;NETFILTER_TPROXY&lt;/code&gt; å’Œç­–ç•¥è·¯ç”±ã€‚é€šè¿‡ tproxyï¼ŒLinux å†…æ ¸å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°†æ•°æ®åŒ…é‡å®šå‘åˆ°ç”¨æˆ·ç©ºé—´ã€‚è¯¦è§ &lt;a href=&#34;http://lxr.linux.no/linux&amp;#43;v3.10/Documentation/networking/tproxy.txt&#34; title=&#34;tproxy æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tproxy æ–‡æ¡£&lt;/a&gt;
ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;æŸ¥çœ‹ Ztunnel A ä¸­çš„è·¯ç”±è¡¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip rule
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0:      from all lookup &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;20000:  from all fwmark 0x400/0xfff lookup &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;20001:  from all fwmark 0x401/0xfff lookup &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;20002:  from all fwmark 0x402/0xfff lookup &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;20003:  from all fwmark 0x4d3/0xfff lookup &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32766:  from all lookup main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32767:  from all lookup default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šçœ‹åˆ°æ‰€æœ‰æ ‡è®° &lt;code&gt;0x400/0xfff&lt;/code&gt; çš„æ•°æ®åŒ…åº”ç”¨ 101 è·¯ç”±è¡¨ï¼Œæˆ‘ä»¬æŸ¥çœ‹è¯¥è·¯ç”±è¡¨è¯¦æƒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip route show table &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; default dev lo scope host 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šçœ‹åˆ°è¿™æ˜¯ä¸€æ¡æœ¬åœ°è·¯ç”±ï¼Œæ•°æ®åŒ…å‘é€åˆ°æœ¬åœ°çš„å›ç¯ç½‘å¡ï¼Œå³ &lt;code&gt;127.0.0.1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ Pod ä¸­å‡ºç«™æµé‡çš„é€æ˜åŠ«æŒè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ztunnel-a-outbound&#34;&gt;Ztunnel A ä¸Šçš„å‡ºç«™æµé‡è·¯ç”±&lt;/h2&gt;
&lt;p&gt;å‡ºç«™æµé‡åœ¨è¢«åŠ«æŒåˆ° Ztunnel ä¸Šï¼Œè¿›å…¥ Envoy çš„ 15001 ç«¯å£å¤„ç†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æŸ¥çœ‹ Ztunnel å¦‚ä½•è·¯ç”±å‡ºç«™æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šZtunnel ä¸­çš„ Envoy è¿‡æ»¤å™¨è§„åˆ™ä¸ Sidecar æ¨¡å¼ä¸­çš„ Envoy è¿‡æ»¤å™¨è§„åˆ™å®Œå…¨ä¸åŒï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ &lt;code&gt;istioctl proxy-config&lt;/code&gt; å‘½ä»¤æ¥æ£€è§† Listenerã€Clusterã€Endpoint ç­‰é…ç½®ï¼Œè€Œæ˜¯ç›´æ¥å¯¼å‡º ztunnel ä¸­çš„ Envoy å®Œæ•´é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç›´æ¥åœ¨è‡ªå·±çš„æœ¬åœ°æœºå™¨ä¸Šè¿œç¨‹è·å– ztunnel A ä¸­çš„ Envoy é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n istio-system ztunnel-hptxk -c istio-proxy -- curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1:15000/config_dump?include_eds&amp;#34;&lt;/span&gt;&amp;gt;ztunnel-a-all-include-eds.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼šä¸è¦ä½¿ç”¨ &lt;code&gt;istioctl proxy-config all ztunnel-rts54 -n istio-system&lt;/code&gt; å‘½ä»¤æ¥è·å– Envoy é…ç½®ï¼Œå› ä¸ºè¿™æ ·è·å–çš„é…ç½®ä¸­ä¸åŒ…å« EDS éƒ¨åˆ†ã€‚å¯¼å‡ºçš„ Json æ–‡ä»¶å°†æœ‰ä¸Šä¸‡è¡Œï¼Œä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œå»ºè®®ä½¿ç”¨ &lt;a href=&#34;https://github.com/antonmedv/fx&#34; title=&#34;fx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;fx&lt;/a&gt;
 æˆ–å…¶ä»–å·¥å…·æ¥è§£æè¯¥æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ztunnel_outbound-listener&#34;&gt;ztunnel_outbound ç›‘å¬å™¨&lt;/h3&gt;
&lt;p&gt;åœ¨è¿™ä¸ª Envoy é…ç½®ä¸­åŒ…å«äº†è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Pod è®¿é—®çš„æµé‡è§„åˆ™é…ç½®ï¼ŒæŸ¥çœ‹ &lt;code&gt;ztunnel_outbound&lt;/code&gt; Listener éƒ¨åˆ†é…ç½®ï¼ˆå› é…ç½®å¤ªå¤šï¼Œçœç•¥éƒ¨åˆ†å†…å®¹ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;132
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;133
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;134
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;135
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;136
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;137
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;138
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;139
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;140
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;141
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;142
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;143
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;144
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;145
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;146
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;147
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;148
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;149
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;150
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ztunnel_outbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:10:40Z/13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ztunnel_outbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_original_dst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.listener.original_dst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.listener.original_dst.v3.OriginalDst&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.listener.original_src&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.listener.original_src.v3.OriginalSrc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;mark&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1234&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.listener.workload_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;config_discovery&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;initial_fetch_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;30s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_urls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.telemetry.workloadmetadata.v1.WorkloadMetadataResources&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;transparent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Set socket mark to packets coming back from outbound listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;level&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;36&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;int_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1025&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;access_log&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;default_filter_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chain_matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher_tree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.matching.common_inputs.network.v3.DestinationPortInput&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact_match_map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;15001&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/google.protobuf.StringValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;on_no_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher_tree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;source-ip&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.matching.common_inputs.network.v3.SourceIPInput&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact_match_map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.168.15.222&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.4.4.19&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher_tree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ip&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.matching.common_inputs.network.v3.DestinationIPInput&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact_match_map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.8.4.226&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;matcher_tree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;nt&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.matching.common_inputs.network.v3.DestinationPortInput&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;nt&#34;&gt;&amp;#34;exact_match_map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_http_productpage.default.svc.cluster.local_outbound_internal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/google.protobuf.StringValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_http_productpage.default.svc.cluster.local_outbound_internal&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;err&#34;&gt;{...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.4.4.7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.4.4.11&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;on_no_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PassthroughFilterChain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/google.protobuf.StringValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PassthroughFilterChain&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:33:10.485Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 10ã€11ã€59ã€62ã€64ã€69ã€76ã€82ã€85 è¡Œï¼šEnvoy ç›‘å¬ 15001 ç«¯å£ï¼Œå¤„ç†å†…æ ¸ä¸­ä½¿ç”¨ tproxy è½¬å‘çš„æµé‡ï¼›å¯¹äºç›®çš„åœ°æ˜¯ 15001 ç«¯å£çš„æ•°æ®åŒ…ç›´æ¥æŠ›å¼ƒï¼Œå¯¹äºç›®çš„åœ°æ˜¯å…¶ä»–ç«¯å£çš„æµé‡å†æ ¹æ®æº IP åœ°å€åŒ¹é…å†³å®šæ•°æ®åŒ…å»å‘ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 43 è¡Œï¼šä½¿ç”¨ &lt;code&gt;IP_TRANSPARENT&lt;/code&gt; å¥—æ¥å­—é€‰é¡¹ï¼Œå¼€å¯ tproxy é€æ˜ä»£ç†ï¼Œè½¬å‘ç›®çš„åœ°é ztunnel IP çš„æµé‡åŒ…ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 88 åˆ° 123 è¡Œï¼šæ ¹æ®æº IPï¼ˆ&lt;code&gt;10.4.4.19&lt;/code&gt; æ˜¯ Pod A çš„ IPï¼‰ã€ç›®çš„ IPï¼ˆ&lt;code&gt;10.8.14.226&lt;/code&gt; æ˜¯æœåŠ¡ B çš„ Cluster IPï¼‰å’Œç«¯å£ï¼ˆ9080ï¼‰è§„åˆ™åŒ¹é…ï¼Œæ•°æ®åŒ…å°†è¢«å‘å¾€ &lt;code&gt;spiffe://cluster.local/ns/default/sa/sleep_to_http_productpage.default.svc.cluster.local_outbound_internal&lt;/code&gt; é›†ç¾¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;sleep-é›†ç¾¤&#34;&gt;Sleep é›†ç¾¤&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹è¯¥é›†ç¾¤çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-08T06:40:06Z/63&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_http_productpage.default.svc.cluster.local_outbound_internal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;EDS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_cluster_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;initial_fetch_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;resource_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket_matches&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;internal_upstream&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;tunnel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;h2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.internal_upstream&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.internal_upstream.v3.InternalUpstreamTransport&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;passthrough_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tunnel&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.raw_buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.raw_buffer.v3.RawBuffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tlsMode-disabled&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.raw_buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.raw_buffer.v3.RawBuffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-08T06:40:06.619Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 6 è¡Œï¼šè¯¥ Cluster é…ç½®ä½¿ç”¨ EDS è·å–ç«¯ç‚¹&lt;/li&gt;
&lt;li&gt;ç¬¬ 18 è¡Œï¼šå¯¹æ‰€æœ‰å…·æœ‰ &lt;code&gt;tunnel: h2&lt;/code&gt; å…ƒæ•°æ®çš„å­—èŠ‚æµåº”ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/internal_upstream/v3/internal_upstream.proto#envoy-v3-api-msg-extensions-transport-sockets-internal-upstream-v3-internalupstreamtransport&#34; title=&#34;&amp;lt;code&amp;gt;InternalUpstreamTransport&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;InternalUpstreamTransport&lt;/code&gt;&lt;/a&gt;
ï¼Œç”¨äºå†…éƒ¨åœ°å€ï¼Œå®šä¹‰ä½äºåŒä¸€ä»£ç†å®ä¾‹ä¸­çš„ç¯å›ç”¨æˆ·ç©ºé—´ socketã€‚é™¤äº†å¸¸è§„å­—èŠ‚æµä¹‹å¤–ï¼Œè¯¥æ‰©å±•è¿˜å…è®¸è·¨ç”¨æˆ·ç©ºé—´ socket ä¼ é€’é¢å¤–çš„ç»“æ„åŒ–çŠ¶æ€ï¼ˆ&lt;code&gt;passthrough_metadata&lt;/code&gt;ï¼‰ã€‚ç›®çš„æ˜¯ä¿ƒè¿›ä¸‹æ¸¸è¿‡æ»¤å™¨å’Œä¸Šæ¸¸å†…éƒ¨è¿æ¥ä¹‹é—´çš„é€šä¿¡ã€‚ä¸ä¸Šæ¸¸è¿æ¥å…±äº«çš„æ‰€æœ‰è¿‡æ»¤å™¨çŠ¶æ€å¯¹è±¡ä¹Ÿé€šè¿‡æ­¤ä¼ è¾“ socket ä¸ä¸‹æ¸¸å†…éƒ¨è¿æ¥å…±äº«ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 23 åˆ° 37 è¡Œï¼šå‘ä¸Šæ¸¸ä¼ é€’çš„ç»“æ„åŒ–æ•°æ®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;sleep-endpoints&#34;&gt;Sleep é›†ç¾¤çš„ç«¯ç‚¹&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å†æ£€æŸ¥ä¸‹ EDSï¼Œä½ ä¼šå‘ç°åœ¨ä¼—å¤šçš„ &lt;code&gt;endpoint_config&lt;/code&gt; ä¸­æœ‰è¿™æ ·ä¸€æ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.endpoint.v3.ClusterLoadAssignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep_to_http_productpage.default.svc.cluster.local_outbound_internal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_internal_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_listener_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_tunnel_lis_spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint_id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.3.20:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_check_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HEALTHY&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy.transport_socket_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;tunnel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;h2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;tunnel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.3.20:15008&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.3.20:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_balancing_weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;overprovisioning_factor&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;140&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 4 è¡Œï¼šæˆªæ­¢ 2022 å¹´ 11 æœˆ 14 æ—¥ï¼Œå®é™…åœ¨å¯¼å‡º Envoy é…ç½®çš„æ—¶å€™å¹¶æ²¡æœ‰è¯¥å­—æ®µï¼Œä½†æ˜¯ç†åº”æœ‰è¿™ä¸ªå­—æ®µï¼Œå¦åˆ™æ— æ³•åˆ¤æ–­ Endpoint å±äºå“ªä¸ª Clusterï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 13 è¡Œï¼šè¯¥ç«¯ç‚¹çš„åœ°å€æ˜¯ä¸€ä¸ª &lt;code&gt;envoy_internal_address&lt;/code&gt;ï¼ŒEnvoy å†…éƒ¨ç›‘å¬å™¨ &lt;code&gt;outbound_tunnel_lis_spiffe://cluster.local/ns/default/sa/sleep&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 20 - 30 è¡Œï¼šå®šä¹‰è¿‡æ»¤å™¨å…ƒæ•°æ®ï¼Œä½¿ç”¨ HBONE éš§é“ä¼ é€’ç»™ Envoy å†…éƒ¨ç›‘å¬å™¨ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-warning-title py-1 px-2&#34;&gt;
  å…³äº endpoint_config ä¸­æœªæ˜¾ç¤º cluster_name å­—æ®µçš„é—®é¢˜
&lt;/div&gt;

&lt;div class=&#34;alert-warning py-1 px-2&#34;&gt;
  è¿™é‡Œçš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/endpoint/v3/endpoint.proto&#34; title=&#34;&amp;lt;code&amp;gt;endpoint_config&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;endpoint_config&lt;/code&gt;&lt;/a&gt;
 ä¸­ç¼ºå°‘äº†å¿…é€‰çš„ &lt;code&gt;cluster_name&lt;/code&gt; å­—æ®µï¼Œè¿™å¯èƒ½æ˜¯ Ambient æ¨¡å¼çš„ä¸€ä¸ª bug å¯¼è‡´äº†åœ¨å¯¼å‡º Envoy çš„é…ç½®æ—¶ç¼ºå°‘äº†è¯¥å­—æ®µã€‚æˆ‘åœ¨ GItHub ä¸Šåˆ›å»ºäº†ä¸€ä¸ª Issue æ¥è¿½è¸ªè¿™ä¸ªé—®é¢˜ï¼Œè¯¦è§ &lt;a href=&#34;https://github.com/istio/istio/issues/42022&#34; title=&#34;Istio Issue-42022&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Issue-42022&lt;/a&gt;
ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;sleep-internal-upstream&#34;&gt;é€šè¿‡ Envoy å†…éƒ¨ç›‘å¬å™¨å»ºç«‹ HBONE éš§é“&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å†çœ‹ä¸‹è¿™ä¸ªç›‘å¬å™¨ &lt;code&gt;outbound_tunnel_lis_spiffe://cluster.local/ns/default/sa/sleep&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_tunnel_lis_spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-08T06:40:06Z/63&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_tunnel_lis_spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.tcp_proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_tunnel_lis_spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_tunnel_clus_spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;access_log&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;tunneling_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;hostname&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%DYNAMIC_METADATA(tunnel:destination)%&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;header&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;x-envoy-original-dst-host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%DYNAMIC_METADATA([\&amp;#34;tunnel\&amp;#34;, \&amp;#34;destination\&amp;#34;])%&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_original_dst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;set_dst_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/xds.type.v3.TypedStruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type_url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/istio.set_internal_dst_address.v1.Config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;internal_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-08T06:40:06.750Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 14 è¡Œï¼šæ•°æ®åŒ…å°†è¢«è½¬å‘åˆ° &lt;code&gt;outbound_tunnel_clus_spiffe://cluster.local/ns/default/sa/sleep&lt;/code&gt; é›†ç¾¤ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 18 - 28 è¡Œï¼š &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig&#34; title=&#34;&amp;lt;code&amp;gt;tunneling_config&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;tunneling_config&lt;/code&gt;&lt;/a&gt;
 ï¼Œç”¨æ¥é…ç½®ä¸Šæ¸¸ HTTP CONNECT éš§é“ã€‚å¦å¤–è¯¥ç›‘å¬å™¨ä¸­çš„ &lt;code&gt;TcpProxy&lt;/code&gt; è¿‡æ»¤å™¨å°†æµé‡ä¼ ç»™ä¸Šæ¸¸ &lt;code&gt;outbound_tunnel_clus_spiffe://cluster.local/ns/default/sa/sleep&lt;/code&gt; é›†ç¾¤ã€‚TCP è¿‡æ»¤å™¨ä¸Šè®¾ç½®äº† HTTP CONNECT éš§é“ï¼ˆæ‰¿è½½å‘é€åˆ° &lt;code&gt;10.4.3.20:9080&lt;/code&gt; çš„æµé‡ï¼‰ï¼Œä¾› &lt;code&gt;productpage&lt;/code&gt; æ‰€åœ¨èŠ‚ç‚¹çš„ ztunnel ä½¿ç”¨ã€‚æœ‰å¤šå°‘ä¸ªç«¯ç‚¹ï¼Œå°±ä¼šåˆ›å»ºå¤šå°‘æ¡éš§é“ã€‚HTTP éš§é“æ˜¯ Ambient ç»„ä»¶ä¹‹é—´å®‰å…¨é€šä¿¡çš„æ‰¿è½½åè®®ã€‚åŒæ—¶åœ¨éš§é“ä¸­çš„æ•°æ®åŒ…æ·»åŠ äº† &lt;code&gt;x-envoy-original-dst-host&lt;/code&gt; headerï¼Œæ ¹æ®ä¸Šä¸€æ­¥ EDS ä¸­é€‰æ‹©çš„ç«¯ç‚¹çš„ &lt;code&gt;metadata&lt;/code&gt; é‡Œçš„å‚æ•°è®¾ç½®ç›®çš„åœ°å€ã€‚å‰é¢ EDS  é€‰æ‹©çš„ç«¯ç‚¹æ˜¯ &lt;code&gt;10.4.3.20:9080&lt;/code&gt; ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ tunnel ç›‘å¬å™¨å°±ä¼š header çš„å€¼è®¾ç½®ä¸º &lt;code&gt;10.4.3.20:9080&lt;/code&gt;ï¼Œè¯·ç•™æ„è¿™ä¸ª headerï¼Œå®ƒä¼šåœ¨éš§é“çš„å¦ä¸€ç«¯è¢«ç”¨åˆ°ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 40 è¡Œï¼šç›‘å¬å™¨ä¸­é¦–å…ˆæ‰§è¡Œç›‘å¬å™¨è¿‡æ»¤å™¨ï¼Œ&lt;code&gt;set_dst_address&lt;/code&gt; è¿‡æ»¤å™¨å°†ä¸Šæ¸¸åœ°å€è®¾ç½®ä¸ºä¸‹æ¸¸çš„ç›®çš„åœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº HBONE éš§é“
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  HBONE æ˜¯ HTTP-Based Overlay Network Environment çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨ HTTP åè®®æä¾›éš§é“èƒ½åŠ›çš„æ–¹æ³•ã€‚å®¢æˆ·ç«¯å‘ HTTP ä»£ç†æœåŠ¡å™¨å‘é€ HTTP CONNECT è¯·æ±‚ï¼ˆå…¶ä¸­åŒ…å«äº†ç›®çš„åœ°å€ï¼‰ä»¥å»ºç«‹éš§é“ï¼Œä»£ç†æœåŠ¡å™¨ä»£è¡¨å®¢æˆ·ç«¯ä¸ç›®çš„åœ°å»ºç«‹ TCP è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨é€æ˜çš„ä¼ è¾“ TCP æ•°æ®æµåˆ°ç›®çš„æœåŠ¡å™¨ã€‚åœ¨ Ambient æ¨¡å¼ä¸­ï¼ŒZtunnelï¼ˆå…¶ä¸­çš„ Envoyï¼‰å®é™…ä¸Šæ˜¯å……å½“äº†é€æ˜ä»£ç†ï¼Œå®ƒä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/other_features/internal_listener&#34; title=&#34;Envoy Internal Listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Internal Listener&lt;/a&gt;
 æ¥æ¥æ”¶ HTTP CONNECT è¯·æ±‚å’Œä¼ é€’ TCP æµç»™ä¸Šæ¸¸é›†ç¾¤ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;sleep-tunnel-cluster&#34;&gt;Sleep é›†ç¾¤çš„ HBONE éš§é“ç«¯ç‚¹&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹ &lt;code&gt;outbound_tunnel_clus_spiffe://cluster.local/ns/default/sa/sleep&lt;/code&gt; é›†ç¾¤çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:30:10Z/37&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_pod_tunnel_clus_spiffe://cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ORIGINAL_DST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CLUSTER_PROVIDED&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cleanup_interval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;60s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_params&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_minimum_protocol_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TLSv1_3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_maximum_protocol_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TLSv1_3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;alpn_protocols&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;h2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate_sds_secret_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/sleep~sleep-5644bdc767-2dfg7~85c8c34e-7ae3-4d29-9582-0819e2b10c69&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;set_node_on_first_message_only&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;resource_api_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;V3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;original_dst_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;upstream_port_override&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15008&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_extension_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy.extensions.upstreams.http.v3.HttpProtocolOptions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;explicit_http_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;allow_connect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:30:10.754Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 6 è¡Œï¼šè¯¥é›†ç¾¤çš„ç±»å‹æ˜¯ &lt;code&gt;ORIGINAL_DST&lt;/code&gt;ï¼Œå³å‰æ–‡ä¸­ EDS è·å–åˆ°çš„åœ°å€ &lt;code&gt;10.4.3.20:9080&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 22 - 41 è¡Œï¼šé…ç½®äº†ä¸Šæ¸¸çš„ TLS è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 45 - 48 è¡Œï¼šå°†ä¸Šæ¸¸ç«¯å£ä¿®æ”¹ä¸º 15008ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ tproxy å’Œ HBONE éš§é“å®ç°çš„å‡ºç«™æµé‡é€æ˜åŠ«æŒçš„å…¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;inbound&#34;&gt;Inbound æµé‡åŠ«æŒ&lt;/h2&gt;
&lt;p&gt;èŠ‚ç‚¹ B æ¥æ”¶èŠ‚ç‚¹ A å¯¹ &lt;code&gt;10.4.3.20:15008&lt;/code&gt; çš„è¯·æ±‚ã€‚Ambient æ¨¡å¼çš„å…¥ç«™æµé‡åŠ«æŒä¸å‡ºç«™æµé‡ç±»ä¼¼ï¼ŒåŒæ ·ä½¿ç”¨ tproxy å’Œ HBONE å®ç°é€æ˜æµé‡åŠ«æŒã€‚&lt;/p&gt;
&lt;p&gt;Ambient mesh çš„ pod å…¥ç«™æµé‡çš„é€æ˜æµé‡åŠ«æŒæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Istio CNI åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»º &lt;code&gt;istioin&lt;/code&gt; ç½‘å¡å’Œ iptables è§„åˆ™ï¼Œå°† Ambient mesh ä¸­çš„ Pod IP åŠ å…¥ IP é›†ï¼Œå¹¶é€šè¿‡ netfilter &lt;code&gt;nfmark&lt;/code&gt; æ ‡è®°å’Œè·¯ç”±è§„åˆ™ï¼Œå°† Ambient mesh ä¸­çš„å‡ºç«™æµé‡é€šè¿‡ Geneve éš§é“é€æ˜åŠ«æŒåˆ° &lt;code&gt;pistioin&lt;/code&gt; è™šæ‹Ÿæœºç½‘å¡ï¼›&lt;/li&gt;
&lt;li&gt;ztunnel ä¸­çš„ init å®¹å™¨åˆ›å»º iptables è§„åˆ™ï¼Œå°† &lt;code&gt;pistioin&lt;/code&gt; ç½‘å¡ä¸­çš„æ‰€æœ‰æµé‡è½¬å‘åˆ° ztunnel ä¸­çš„ Envoy ä»£ç†çš„ 15008 ç«¯å£ï¼›&lt;/li&gt;
&lt;li&gt;Envoy å¯¹æ•°æ®åŒ…è¿›è¡Œå¤„ç†åè½¬å‘ç»™ Pod Bã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºæ“ä½œæ­¥éª¤ä¸ä¸Šæ–‡ä¸­çš„æ£€æŸ¥å‡ºç«™æµé‡æ—¶ç›¸åŒï¼Œå› æ­¤ä¸‹æ–‡å°†çœç•¥éƒ¨åˆ†è¾“å‡ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;node-b-rules&#34;&gt;æ£€æŸ¥èŠ‚ç‚¹ B ä¸Šçš„è·¯ç”±è§„åˆ™&lt;/h3&gt;
&lt;p&gt;ç™»å½•åˆ°æœåŠ¡ B æ‰€åœ¨çš„èŠ‚ç‚¹ Bï¼ŒæŸ¥çœ‹èŠ‚ç‚¹ä¸Šçš„ iptablesï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables-save
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -m mark --mark 0x200/0x200 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A ztunnel-PREROUTING -p tcp -m &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --match-set ztunnel-pods-ips src -j MARK --set-xmark 0x100/0x100
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/* çœç•¥ */
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å°†çœ‹åˆ°åœ¨å‰æ–‡ä¸­æåˆ°çš„ç»™æ‰€æœ‰ &lt;code&gt;ztunnel-pods-ips&lt;/code&gt; IP é›†ä¸­ Pod å‘é€çš„æ•°æ®åŒ…æ‰“ä¸Š &lt;code&gt;0x100/0x100&lt;/code&gt; æ ‡è®°çš„ä¸Šä¸€æ¡å‘½ä»¤ï¼šç»™æ‰€æœ‰æ•°æ®åŒ…æ‰“ä¸Š &lt;code&gt;0x200/0x200&lt;/code&gt; æ ‡è®°ï¼Œç„¶åç»§ç»­æ‰§è¡Œ iptablesã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹èŠ‚ç‚¹ B ä¸Šçš„è·¯ç”±è¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0:      from all lookup &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;100:    from all fwmark 0x200/0x200 goto &lt;span class=&#34;m&#34;&gt;32766&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;101:    from all fwmark 0x100/0x100 lookup &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;102:    from all fwmark 0x40/0x40 lookup &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;103:    from all lookup &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32766:  from all lookup main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32767:  from all lookup default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰ Ambient Mesh èŠ‚ç‚¹ä¸­çš„è·¯ç”±è¡¨æ•°é‡å’Œè§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Œè·¯ç”±è¡¨è§„åˆ™å°†æŒ‰é¡ºåºæ‰§è¡Œï¼Œé¦–å…ˆæŸ¥æ‰¾ &lt;code&gt;local&lt;/code&gt; è¡¨ï¼Œç„¶åæ‰€æœ‰å¸¦æœ‰ &lt;code&gt;0x200/0x200&lt;/code&gt; æ ‡è®°çš„æ•°æ®åŒ…å°†é¦–å…ˆè·³è½¬åˆ° &lt;code&gt;main&lt;/code&gt; è¡¨ï¼ˆå…¶ä¸­å®šä¹‰äº† veth è·¯ç”±ï¼‰ï¼Œç„¶åæŸ¥æ‰¾ &lt;code&gt;100&lt;/code&gt; è¡¨ï¼Œåœ¨ &lt;code&gt;100&lt;/code&gt; è¡¨ä¸­æœ‰ä»¥ä¸‹è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip route show table &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.14 dev veth28865c45 scope link 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.15 via 192.168.126.2 dev istioin src 10.4.3.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.16 via 192.168.126.2 dev istioin src 10.4.3.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.17 via 192.168.126.2 dev istioin src 10.4.3. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.18 via 192.168.126.2 dev istioin src 10.4.3. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.19 via 192.168.126.2 dev istioin src 10.4.3.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.4.3.20 via 192.168.126.2 dev istioin src 10.4.3.1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä½ ä¼šçœ‹åˆ°å‘å¾€ &lt;code&gt;10.4.3.20&lt;/code&gt; çš„æ•°æ®åŒ…å°†è¢«è·¯ç”±åˆ° &lt;code&gt;istioin&lt;/code&gt; ç½‘å¡ä¸Šçš„ &lt;code&gt;192.168.126.2&lt;/code&gt; ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;istioin&lt;/code&gt; ç½‘å¡çš„è¯¦ç»†ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d addr show istioin 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;17: istioin: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1410&lt;/span&gt; qdisc noqueue state UNKNOWN group default 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether 36:2a:2f:f1:5c:97 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65485&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    geneve id &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt; remote 10.4.3.14 ttl auto dstport &lt;span class=&#34;m&#34;&gt;6081&lt;/span&gt; noudpcsum udp6zerocsumrx numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 192.168.126.1/30 brd 192.168.126.3 scope global istioin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet6 fe80::342a:2fff:fef1:5c97/64 scope link 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;istioin&lt;/code&gt; æ˜¯ä¸€ä¸ª Geneve ç±»å‹è™šæ‹Ÿç½‘å¡ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ª Geneve éš§é“ï¼Œè¿œç«¯çš„ IP æ˜¯ &lt;code&gt;10.4.3.14 &lt;/code&gt;ï¼Œè¿™æ˜¯ Ztunnel B çš„ Pod IPã€‚&lt;/p&gt;
&lt;h3 id=&#34;ztunnel-b-rules&#34;&gt;æ£€æŸ¥ Ztunnel B Pod ä¸Šçš„è·¯ç”±è§„åˆ™&lt;/h3&gt;
&lt;p&gt;è¿›å…¥ Ztunnel B Podï¼Œä½¿ç”¨ &lt;code&gt;ip -d a&lt;/code&gt; å‘½ä»¤æ£€æŸ¥å®ƒçš„ç½‘å¡ä¿¡æ¯ï¼Œä½ ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ª &lt;code&gt;pistioout&lt;/code&gt; ç½‘å¡ï¼Œå®ƒçš„ IP ä¸º &lt;code&gt;192.168.127.2&lt;/code&gt;ï¼Œè¿™æ­£æ˜¯ä¸ &lt;code&gt;istioin&lt;/code&gt; è™šæ‹Ÿç½‘å¡å»ºç«‹çš„ Geneve éš§é“çš„è¿œç«¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;iptables-save&lt;/code&gt; æŸ¥çœ‹ Pod å†…çš„ iptables è§„åˆ™ï¼Œä½ ä¼šçœ‹åˆ°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -i pistioin -p tcp -m tcp --dport &lt;span class=&#34;m&#34;&gt;15008&lt;/span&gt; -j TPROXY --on-port &lt;span class=&#34;m&#34;&gt;15008&lt;/span&gt; --on-ip 127.0.0.1 --tproxy-mark 0x400/0xfff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A PREROUTING -i pistioin -p tcp -j TPROXY --on-port &lt;span class=&#34;m&#34;&gt;15006&lt;/span&gt; --on-ip 127.0.0.1 --tproxy-mark 0x400/0xfff
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰å‘å¾€ &lt;code&gt;10.4.3.20:15008&lt;/code&gt; çš„æµé‡å°†ä½¿ç”¨ tproxy è¢«è·¯ç”±åˆ° 15008 ç«¯å£ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº 15006 å’Œ 15008 ç«¯å£
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;ul&gt;
&lt;li&gt;15006 ç«¯å£ç”¨äºå¤„ç†éåŠ å¯†çš„ï¼ˆplainï¼‰TCP æ•°æ®åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;15008 ç«¯å£ç”¨äºå¤„ç†åŠ å¯†çš„ï¼ˆTLSï¼‰TCP æ•°æ®åŒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ Pod ä¸­å…¥ç«™æµé‡çš„é€æ˜åŠ«æŒè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ztunnel-b-inbound&#34;&gt;Ztunnel B ä¸Šçš„å…¥ç«™æµé‡è·¯ç”±&lt;/h2&gt;
&lt;p&gt;å‡ºç«™çš„ TLS åŠ å¯†æµé‡åœ¨è¢«åŠ«æŒåˆ° Ztunnel ä¸Šï¼Œè¿›å…¥ Envoy çš„ 15008 ç«¯å£å¤„ç†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æŸ¥çœ‹ Ztunnel å¦‚ä½•è·¯ç”±å…¥ç«™æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç›´æ¥åœ¨è‡ªå·±çš„æœ¬åœ°æœºå™¨ä¸Šè¿œç¨‹è·å– ztunnel B ä¸­çš„ Envoy é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n istio-system 	ztunnel-z4qmh -c istio-proxy -- curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1:15000/config_dump?include_eds&amp;#34;&lt;/span&gt;&amp;gt;ztunnel-b-all-include-eds.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ztunnel_inbound-listener&#34;&gt;ztunnel_inbound ç›‘å¬å™¨&lt;/h3&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;ztunnel_inbound&lt;/code&gt; ç›‘å¬å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ztunnel_inbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:12:01Z/16&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.listener.v3.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ztunnel_inbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15008&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chain_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix_ranges&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.3.20&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix_len&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.rbac&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.rbac.v3.RBAC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;rules&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tcp.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;shadow_rules_stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio_dry_run_allow_&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_hcm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;local_route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;local_service&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_matcher&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtual_inbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;http_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.http.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.http.router.v3.Router&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;allow_connect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;access_log&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;upgrade_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_10.4.3.20&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_original_dst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{},&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;transparent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;access_log&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-14T03:54:07.040Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»ä¸Šé¢çš„é…ç½®ä¸­å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘å¾€ &lt;code&gt;10.4.3.20&lt;/code&gt; çš„æµé‡å°†è¢«è·¯ç”±åˆ° &lt;code&gt;virtual_inbound&lt;/code&gt; é›†ç¾¤ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 78 - 82 è¡Œï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#config-route-v3-routeaction-upgradeconfig&#34; title=&#34;&amp;lt;code&amp;gt;upgrade_type: &amp;amp;quot;CONNECT&amp;amp;quot;&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;upgrade_type: &amp;quot;CONNECT&amp;quot;&lt;/code&gt;&lt;/a&gt;
 ä¸º Envoy çš„ HCM å¯ç”¨ HTTP Connect éš§é“ï¼Œå°†è¯¥éš§é“ä¸­çš„ TCP æ•°æ®å‘é€åˆ°ä¸Šæ¸¸ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;virtual_inbound-cluster&#34;&gt;virtual_inbound é›†ç¾¤&lt;/h3&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;virtual_inbound&lt;/code&gt; é›†ç¾¤çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:10:40Z/13&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.config.cluster.v3.Cluster&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtual_inbound&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;ORIGINAL_DST&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;CLUSTER_PROVIDED&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;original_dst_lb_config&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;s2&#34;&gt;&amp;#34;use_http_header&amp;#34;&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-11-11T07:10:42.111Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 7 è¡Œï¼šè¯¥é›†ç¾¤çš„ç±»å‹æ˜¯ &lt;code&gt;ORIGINAL_DST&lt;/code&gt;ï¼Œè¡¨ç¤ºä½¿ç”¨ä¸‹æ¸¸çš„åŸå§‹ç›®çš„åœ°ä½œä¸ºè·¯ç”±ç›®çš„åœ°ï¼Œå³ &lt;code&gt;10.4.3.20:15008&lt;/code&gt;ï¼Œæ˜¾ç„¶è¿™ä¸ªåœ°å€ä¸­çš„ç«¯å£ä¸æ­£ç¡®ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ 9 è¡Œï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/cluster.proto#config-cluster-v3-cluster-originaldstlbconfig&#34; title=&#34;&amp;lt;code&amp;gt;use_http_header&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;use_http_header&lt;/code&gt;&lt;/a&gt;
 ä¸º &lt;code&gt;true&lt;/code&gt; æ—¶å°†ä½¿ç”¨ HTTP header &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/headers#config-http-conn-man-headers-x-envoy-original-dst-host&#34; title=&#34;&amp;lt;code&amp;gt;x-envoy-original-dst-host&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;x-envoy-original-dst-host&lt;/code&gt;&lt;/a&gt;
 ä½œä¸ºç›®çš„åœ°å€ï¼Œè€Œè¿™ä¸ª header &lt;a href=&#34;https://jimmysong.io/#sleep-internal-upstream&#34; title=&#34;åœ¨å‡ºç«™çš„ Ztunnel ä¸­å·²è®¾ç½®&#34;&gt;åœ¨å‡ºç«™çš„ Ztunnel ä¸­å·²è®¾ç½®&lt;/a&gt;
ä¸º &lt;code&gt;10.4.3.20:9080&lt;/code&gt;ï¼Œå®ƒå°†è¦†ç›–ä¹‹å‰è®¾ç½®çš„ç›®çš„åœ°å€ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡³æ­¤ï¼Œå…¥ç«™æµé‡è¢« ztunnel å‡†ç¡®åœ°è·¯ç”±åˆ°äº†ç›®çš„åœ°ã€‚ä»¥ä¸Šå°±æ˜¯ Ambient æ¨¡å¼ä¸­ä¸åŒèŠ‚ç‚¹é—´ L4 æµé‡åŠ«æŒå’Œè·¯ç”±æµç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæœ¬æ–‡ä¸­å±•ç¤ºçš„æ˜¯ä¸åŒèŠ‚ç‚¹ä¸Šçš„æœåŠ¡ L4 ç½‘ç»œè®¿é—®æ•°æ®åŒ…çš„è·¯å¾„ï¼Œå³ä½¿ä¸¤ä¸ªæœåŠ¡åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šè·¯å¾„ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚æ ¹æ®æœ¬æ–‡ä¸­æä¾›çš„æ“ä½œè¯´æ˜ï¼Œè¯»è€…å¯ä»¥åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­å°è¯•ã€‚Istio çš„ Ambient æ¨¡å¼è¿˜åœ¨åˆçº§é˜¶æ®µï¼Œåœ¨ç¬”è€…æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°å¯¼å‡ºçš„ Envoy é…ç½®ä¸­ EDS ç¼ºå°‘ &lt;code&gt;cluster_name&lt;/code&gt; å­—æ®µçš„é—®é¢˜ï¼ˆ&lt;a href=&#34;https://github.com/istio/istio/issues/42022&#34; title=&#34;Issue Istio-42022&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Issue Istio-42022&lt;/a&gt;
ï¼‰ã€‚å¦å¤– Ambient æ¨¡å¼ä½¿ç”¨ Istio CNI åœ¨èŠ‚ç‚¹ä¸­æ³¨å…¥ iptables è§„åˆ™ï¼Œé€šè¿‡è®¾ç½® &lt;code&gt;nfmark&lt;/code&gt; çš„æ–¹å¼æ‹¦æˆª Pod çš„æµé‡åˆ° Ztunnel ä¸­ï¼Œè¿™ç§æ–¹å¼å¯èƒ½é€ æˆå¯¹å…¶ä»– CNI çš„å…¼å®¹æ€§é—®é¢˜ï¼Œ&lt;a href=&#34;https://merbridge.io/zh/blog/2022/11/11/ambient-mesh-support/&#34; title=&#34;Merbridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge&lt;/a&gt;
 é¡¹ç›®æ­£åœ¨å¯»æ±‚ä½¿ç”¨ eBPF æ¥ç»•è¿‡ IPtablesï¼Œä»è€Œæ— éœ€å®‰è£… Istio CNIï¼Œè¿™æ ·ä¹Ÿå°±ä¸ä¼šå­˜åœ¨ CNI å…¼å®¹æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº†è§£äº† L4 æµé‡è·¯å¾„ä¹‹åï¼Œä»Šåç¬”è€…ä¼šå†åˆ†äº« Ambient æ¨¡å¼ä¸­çš„ L7 æµé‡è·¯å¾„ï¼Œæ¬¢è¿å…³æ³¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2022/get-started-ambient/&#34; title=&#34;å®‰è£… Ambient Mesh - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Ambient Mesh - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/PpP0pmxdJR8PknHeR-pVHQ&#34; title=&#34;æ·±å…¥ Ambient Mesh - æµé‡è·¯å¾„ - mp.weixin.qq.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥ Ambient Mesh - æµé‡è·¯å¾„ - mp.weixin.qq.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/TXMyxbzBSfuYNquOZJmZTg&#34; title=&#34;ä¸€æ–‡è¯»æ‡‚ Ambient Mesh ä¸ƒå±‚æœåŠ¡æ²»ç† - mp.weixin.qq.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ–‡è¯»æ‡‚ Ambient Mesh ä¸ƒå±‚æœåŠ¡æ²»ç† - mp.weixin.qq.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/B0q73ACAvmY4SjW42A2GVw&#34; title=&#34;æ·±åº¦å‰–æï¼Istio å…±äº«ä»£ç†æ–°æ¨¡å¼ Ambient Mesh - mp.weixin.qq.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±åº¦å‰–æï¼Istio å…±äº«ä»£ç†æ–°æ¨¡å¼ Ambient Mesh - mp.weixin.qq.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhaohuabing.com/post/2022-09-11-ambient-deep-dive-1/&#34; title=&#34;Istio Ambient æ¨¡å¼æµé‡ç®¡ç†å®ç°æœºåˆ¶è¯¦è§£ï¼ˆä¸€ï¼‰- zhaohuabing.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Ambient æ¨¡å¼æµé‡ç®¡ç†å®ç°æœºåˆ¶è¯¦è§£ï¼ˆä¸€ï¼‰- zhaohuabing.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhaohuabing.com/post/2022-09-11-ambient-deep-dive-2/&#34; title=&#34;Istio Ambient æ¨¡å¼æµé‡ç®¡ç†å®ç°æœºåˆ¶è¯¦è§£ï¼ˆäºŒï¼‰ - zhaohuabing.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Ambient æ¨¡å¼æµé‡ç®¡ç†å®ç°æœºåˆ¶è¯¦è§£ï¼ˆäºŒï¼‰ - zhaohuabing.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhaohuabing.com/post/2022-10-17-ambient-deep-dive-3/&#34; title=&#34;Istio Ambient æ¨¡å¼æµé‡ç®¡ç†å®ç°æœºåˆ¶è¯¦è§£ï¼ˆä¸‰ï¼‰- zhaohuabing.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Ambient æ¨¡å¼æµé‡ç®¡ç†å®ç°æœºåˆ¶è¯¦è§£ï¼ˆä¸‰ï¼‰- zhaohuabing.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://merbridge.io/zh/blog/2022/11/11/ambient-mesh-support/&#34; title=&#34;Merbridge æ”¯æŒ Ambient Meshï¼Œæ— æƒ§ CNI å…¼å®¹æ€§ï¼- merbridge.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge æ”¯æŒ Ambient Meshï¼Œæ— æƒ§ CNI å…¼å®¹æ€§ï¼- merbridge.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Linux åŸºé‡‘ä¼šå¼€æºè½¯ä»¶å­¦å›­åˆ†äº«ï¼šIstio çš„æ¶æ„ä¸æµé‡ç®¡ç†æœºåˆ¶è§£æ</title>
      <link>https://jimmysong.io/notice/istio-traffic-routing-deep-dive/</link>
      <pubDate>Fri, 11 Nov 2022 11:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/notice/istio-traffic-routing-deep-dive/</guid>
      <description>
        
        
        &lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯æ ¹æ®ç¬”è€…åœ¨ Linux Foundation APACâ€œæºæ¥å¦‚æ­¤â€ &lt;a href=&#34;https://mp.weixin.qq.com/s/LSnr7R4ZqCqnr1veOq11nQ&#34; title=&#34;å¼€æºè½¯ä»¶å­¦å›­æŠ€æœ¯å…¬å¼€è¯¾&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€æºè½¯ä»¶å­¦å›­æŠ€æœ¯å…¬å¼€è¯¾&lt;/a&gt;
ã€ŠIstio æ¶æ„ä¸æµé‡ç®¡ç†æœºåˆ¶è§£æã€‹åˆ†äº«å†…å®¹æ•´ç†è€Œæˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœ¬æ¬¡åˆ†äº«çš„å¹»ç¯ç‰‡å¯ä»¥&lt;a href=&#34;https://docs.qq.com/pdf/DRUZTVXZCS25QTlZy&#34; title=&#34;åœ¨è…¾è®¯æ–‡æ¡£ä¸­è§‚çœ‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è…¾è®¯æ–‡æ¡£ä¸­è§‚çœ‹&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://www.bilibili.com/video/BV1YG4y1t7kh&#34; title=&#34;B ç«™&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;B ç«™&lt;/a&gt;
ä¸­è§‚çœ‹ç›´æ’­å›æ”¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/notice/istio-traffic-routing-deep-dive/slides.jpg&#34; data-img=&#34;/notice/istio-traffic-routing-deep-dive/slides.jpg&#34; data-width=&#34;1200&#34; data-height=&#34;750&#34; alt=&#34;image&#34; data-caption=&#34;å¹»ç¯ç‰‡è§†å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å¹»ç¯ç‰‡è§†å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;Istio è‡ª 2017 å¹´å¼€æºï¼Œè‡³ä»Šå·²æœ‰ 5 å¹´å¤šæ—¶é—´ï¼Œä¸šç•Œå·²ç»å‡ºç‰ˆäº†å¾ˆå¤šæœ¬ä»‹ç» Istio çš„å›¾ä¹¦ï¼ŒåŒ…æ‹¬ç¬”è€…å‚ä¸ç¼–å†™çš„ã€Šæ·±å…¥ç†è§£ Istioã€‹ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹å’Œæ–‡ç« ä»‹ç» Istio é…ç½®çš„ç”¨æ³•ï¼Œä½†æ˜¯ç¬”è€…è§‰å¾—éƒ½è¿˜ä¸å¤Ÿç”ŸåŠ¨å½¢è±¡ï¼Œæœ¬æ–‡å°†å‘æŒ¥äº’è”ç½‘å¤šåª’ä½“çš„ä¼˜åŠ¿ï¼Œç¬”è€…æ•´ç†äº†ä»¥å‰æ’°å†™çš„ä»‹ç» Istio çš„æ–‡ç« åŠç»˜åˆ¶çš„å›¾ç‰‡ï¼ŒåŒæ—¶ç»“åˆ Istio çš„æœ€æ–°è¿›å±•ï¼Œé‡æ–°æ’°å†™ä¸€ç¯‡ä»‹ç» Istio æ¶æ„å’ŒåŸºç¡€çš„æµé‡ç®¡ç†åŠŸèƒ½çš„æ–‡ç« ã€‚è¯»è€…å¯ä»¥è·Ÿç€æˆ‘ä¸€èµ·æ¥åŠ¨æ‰‹ä½“éªŒï¼Œä¸€æ­¥æ­¥æ·±å…¥äº†è§£ Istioã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡åˆ†äº«å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio çš„æ¶æ„ä¸éƒ¨ç½²æ¨¡å¼ï¼šSidecarã€Proxyless å’Œ Ambient æ¨¡å¼è§£æ&lt;/li&gt;
&lt;li&gt;Istio ä¸­çš„æµé‡ç®¡ç†æœºåˆ¶åŠèµ„æºå¯¹è±¡ä»‹ç»&lt;/li&gt;
&lt;li&gt;Istio éƒ¨ç½²ä¸å®‰è£…ç¤ºä¾‹&lt;/li&gt;
&lt;li&gt;Istio ä¸­çš„æµé‡æ‹¦æˆªä¸è·¯ç”±è¿‡ç¨‹è¯¦è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‡†å¤‡æ¡ä»¶&#34;&gt;å‡†å¤‡æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿè‡ªå·±åŠ¨æ‰‹å®éªŒï¼Œä½ éœ€è¦å‡†å¤‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes é›†ç¾¤ 1.21+&lt;/li&gt;
&lt;li&gt;Istio 1.15&lt;/li&gt;
&lt;li&gt;Kubectl&lt;/li&gt;
&lt;li&gt;Lensï¼ˆæˆ‘æ¨èçš„ä¸€ä¸ª Kubernetes UIï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;istio-çš„æ¶æ„&#34;&gt;Istio çš„æ¶æ„&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å°±ä»¥ Istio å®˜æ–¹ task &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/request-routing/&#34; title=&#34;Requst routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Requst routing&lt;/a&gt;
 ä¸­çš„ä¾‹å­æ¥è¯´æ˜ï¼Œsidecar æ¨¡å¼ä¸‹ VirtualService æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆç®€è¦æè¿°ä¸‹è¿™ä¸ªä¾‹å­åœ¨å¼€å§‹å‰çš„ Istio Mesh çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£…å¥½ Istioï¼Œå¹¶ä¸º &lt;code&gt;default&lt;/code&gt; namespace å¼€å¯äº†è‡ªåŠ¨ sidecar æ³¨å…¥ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;default&lt;/code&gt; namespace ä¸‹å®‰è£…äº† bookinfo ç¤ºä¾‹ï¼ŒBookinfo ç¤ºä¾‹ä¸­çš„ Kubernetes Service ä¼šè‡ªåŠ¨æ³¨å†Œåˆ° Istio Mesh çš„ Cluster ä¸­ï¼Œä¾‹å¦‚ &lt;code&gt;outbound|9080||details.default.svc.cluster.local&lt;/code&gt;ï¼Œæ³¨æ„åœ¨å…¶ä¸­æ²¡æœ‰ &lt;code&gt;subset&lt;/code&gt; ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»ºäº†ä¸€ç³»åˆ—çš„ Istio CRï¼ŒåŒ…æ‹¬ï¼š
&lt;ol&gt;
&lt;li&gt;Gateway ï¼š &lt;code&gt;bookinfo-gateway&lt;/code&gt; ç”¨äºé€‰æ‹© Istio çš„ Ingress Gatewayï¼Œä½œä¸º bookinfo çš„å¯¹å¤–æµé‡å…¥å£ï¼›&lt;/li&gt;
&lt;li&gt;DestinationRuleï¼š&lt;code&gt;productpage&lt;/code&gt;ã€&lt;code&gt;reviews&lt;/code&gt;ã€&lt;code&gt;ratings&lt;/code&gt;ã€&lt;code&gt;details&lt;/code&gt; å°†è¿™äº›æµé‡è·¯å¾„é€šè¿‡ &lt;code&gt;subset&lt;/code&gt; ä¸ Kubernetes çš„ Service å…³è”èµ·æ¥ï¼Œå°†ç”¨äºæœªæ¥çš„åˆ†ç‰ˆæœ¬è·¯ç”±ã€‚å®é™…ä¸Šä¸ºäº†è®© Bookinfo å¯ä»¥è¿è¡Œèµ·æ¥ï¼Œè¿™äº› DestinationRule ç›®å‰éƒ½æ˜¯ä¸å¿…è¦çš„ï¼›ä½†æ˜¯ä½ åˆ›å»ºäº†è¿™äº› DestinationRule ä¹‹åï¼Œå°±ä¼šåœ¨ Istio Mesh ä¸­åˆ›å»ºæ–°çš„ Cluster é…ç½®ï¼Œæ¯”å¦‚ &lt;code&gt;outbound|9080|v1|reviews.default.svc.cluster.local&lt;/code&gt; è¿™äº› &lt;code&gt;dynamic_active_clusters &lt;/code&gt;ï¼Œåœ¨åˆ›å»º VirtualService æŒ‡å®šè·¯ç”±çš„æ—¶å€™ï¼ŒIstiod å°±ä¼šä¸‹å‘ &lt;code&gt;dynamic_route_configs&lt;/code&gt; ç»™ sidecarï¼Œå…¶ä¸­ä¼šåŒ…å« &lt;code&gt;reviews.default.svc.cluster.local:9080&lt;/code&gt; è·¯ç”±ï¼Œå…¶ä¸­æŒ‡å®šäº†å°†è·¯ç”±åˆ°çš„ clusterï¼Œè¿™ä¸ª cluster å°±æ˜¯åœ¨ VirtualService ä¸­é…ç½®çš„é‚£ä¸ª host çš„ &lt;code&gt;subset&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;VirtualServiceï¼š&lt;code&gt;bookinfo&lt;/code&gt; æŒ‡å®šäº†æµé‡åœ¨é€šè¿‡ &lt;code&gt;bookinfo-gateway&lt;/code&gt; è¿›å…¥ Istio Mesh ä¹‹åæ€ä¹ˆèµ°ï¼Œå…¶ä¸­æŒ‡å®šäº† URI åŒ¹é…çš„ç›®çš„åœ°æ˜¯ &lt;code&gt;productpage&lt;/code&gt;ï¼Œè¯·æ³¨æ„è¿™é‡Œçš„ &lt;code&gt;productpage&lt;/code&gt; å¯¹åº”çš„æ˜¯ Kubernetes ä¸­çš„ Serviceã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¦æƒ³å®ç°åœ¨ bookinfo ç¤ºä¾‹çš„ç½‘é¡µä¸­æ¯æ¬¡åˆ·æ–°æ˜¾ç¤ºçš„ä¹¦ç±è¯„åˆ†éƒ½æ˜¾ç¤ºæ˜Ÿçº§ï¼Œåªéœ€è¦åˆ›å»ºå¹¶åº”ç”¨å¦‚ä¸‹çš„ VirtualService å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯éƒ¨ç½²äº† VirtualService ä¹‹å Istio ç½‘æ ¼èƒŒåå‘ç”Ÿçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤ä¸€æµé‡æ‹¦æˆª&#34;&gt;æ­¥éª¤ä¸€ï¼šæµé‡æ‹¦æˆª&lt;/h3&gt;
&lt;p&gt;å½“ä½ ä¸ºæŸä¸ª namespace å¼€å¯äº† sidecar è‡ªåŠ¨æ³¨å…¥æˆ–è€…æ‰‹åŠ¨å‘ Deployment çš„ pod ä¸­æ³¨å…¥äº† sidecarï¼Œè¿›å‡ºè¯¥ pod çš„ TCP æœåŠ¡æµé‡ç»è¿‡ iptables æ‹¦æˆªåˆ° Envoy çš„ 15006 ç«¯å£ï¼Œè¯¦ç»†è¿‡ç¨‹è¯·è§&lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; title=&#34;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤äºŒé…ç½®ä¸‹å‘&#34;&gt;æ­¥éª¤äºŒï¼šé…ç½®ä¸‹å‘&lt;/h3&gt;
&lt;p&gt;ä½ ä½¿ç”¨ kubectl åº”ç”¨äº† YAML é…ç½®åˆ° Istio Meshï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒIstiod ä½¿ç”¨ xDS å°†é…ç½®ä¸‹å‘åˆ°æ‰€æœ‰ namespace ä¸‹çš„ pod ä¸­ï¼Œé™¤éä½ ä¸º VirtualService é…ç½®äº† &lt;code&gt;exportTo&lt;/code&gt; å­—æ®µã€‚è¿™äº›é…ç½®è¢«åº”ç”¨åˆ° pod å†…çš„ Envoy ä¸Šï¼Œä½ å¯ä»¥ç”¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æŸä¸ª pod ä¸­çš„ Envoy çš„å½“å‰é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n default port-forward deploy/productpage-v1 &lt;span class=&#34;m&#34;&gt;15000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ &lt;code&gt;http://localhost:15000&lt;/code&gt; å°±å¯ä»¥è¿›å…¥ Envoy çš„ admin é¡µé¢ï¼ŒæŸ¥çœ‹ Envoy çš„å½“å‰é…ç½®ã€‚åœ¨åº”ç”¨æ–°çš„ VirtualService ä¹‹å‰ï¼Œä½ å¯ä»¥ä¿å­˜å½“å‰ Envoy çš„é…ç½®ï¼Œç„¶ååº”ç”¨åçš„ Envoy é…ç½®åšå¯¹æ¯”ã€‚å…³äº sidecar ä¸­å„ä¸ªç«¯å£çš„è¯¦ç»†ç”¨æ³•è¯·è§&lt;a href=&#34;https://jimmysong.io/blog/istio-components-and-ports/&#34; title=&#34;Istio ä¸­çš„å„ç»„ä»¶ç«¯å£åŠåŠŸèƒ½è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ä¸­çš„å„ç»„ä»¶ç«¯å£åŠåŠŸèƒ½è¯¦è§£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤ä¸‰envoy-å¤„ç†æµé‡&#34;&gt;æ­¥éª¤ä¸‰ï¼šEnvoy å¤„ç†æµé‡&lt;/h3&gt;
&lt;p&gt;è¢«æ‹¦æˆªçš„æµé‡åœ¨è¿›å…¥ Pod çš„ Envoy Inbound Handler åï¼Œç„¶åè¿›å…¥ Envoy çš„ Filter Chainï¼Œå¯¹äº HTTP æµé‡ä¼šè¿›å…¥ HttpConnectionManagerï¼ˆHCMï¼‰è¿™ä¸ªé«˜çº§ç½‘ç»œè¿‡æ»¤å™¨é“¾ï¼Œè¿™é‡Œé¢æœ‰ä¸€ç³»åˆ—çš„ HTTP è¿‡æ»¤å™¨ã€‚Productpage é¡µé¢å¯¹ reviews æœåŠ¡çš„è®¿é—®ç©¶ç«Ÿèµ°å“ªä¸ª subsetï¼Œè¿˜å¾—çœ‹ &lt;code&gt;prodcutpage&lt;/code&gt; pod ä¸­çš„ Envoy é…ç½®ã€‚åœ¨æ­¥éª¤äºŒçš„é‚£ä¸ªé¡µé¢ä¸ŠæŸ¥çœ‹ &lt;code&gt;config_dump&lt;/code&gt;ï¼Œä½ å°†çœ‹åˆ° Envoy çš„è¯¦ç»†é…ç½®ï¼Œå…¶ä¸­çš„ &lt;code&gt;dynamic_route_configs&lt;/code&gt; ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¯¹ &lt;code&gt;reviews.default.svc.cluster.local:9080&lt;/code&gt; æœåŠ¡çš„ Route é…ç½®æ˜¯ &lt;code&gt;outbound|9080|v2|reviews.default.svc.cluster.local&lt;/code&gt; Clusterï¼Œå†æŸ¥çœ‹è¿™ä¸ª Cluster çš„é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç”¨ EDS æ¥è·å–çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl proxy-config endpoint xxx&lt;/code&gt; æŸ¥çœ‹è¯¥ pod ä¸Šå¯è¯†åˆ«çš„æ‰€æœ‰ Endpointã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¯¦ç»†æµç¨‹è¯·å‚è€ƒ&lt;a href=&#34;https://docs.qq.com/pdf/DRUZTVXZCS25QTlZy&#34; title=&#34;åˆ†äº«çš„å¹»ç¯ç‰‡&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†äº«çš„å¹»ç¯ç‰‡&lt;/a&gt;
åŠæ¼”ç¤ºè§†é¢‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´å¤šèµ„æº&#34;&gt;æ›´å¤šèµ„æº&lt;/h2&gt;
&lt;p&gt;å½’æ ¹ç»“åº•ï¼Œåœ¨ Istio ç½‘æ ¼ä¸­æ˜¯ Envoy å¤„ç†çš„ä¸ƒå±‚æµé‡ï¼Œè¦æƒ³äº†è§£æ›´åº•å±‚çš„åŸç†ï¼Œéœ€è¦å¯¹ Envoy æœ‰æ›´è¯¦ç»†çš„äº†è§£ã€‚æ¨èå¤§å®¶å­¦ä¹  Envoy åŸºç¡€æ•™ç¨‹ï¼Œè¿˜æœ‰ä¸‹é¢è¿™äº›å­¦ä¹ èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://academy.tetrate.io&#34; title=&#34;Tetrate å­¦é™¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate å­¦é™¢&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://academy.tetrate.io/courses/istio-fundamentals-zh&#34; title=&#34;Istio åŸºç¡€æ•™ç¨‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŸºç¡€æ•™ç¨‹&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://academy.tetrate.io/courses/envoy-fundamentals-zh&#34; title=&#34;Envoy åŸºç¡€æ•™ç¨‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy åŸºç¡€æ•™ç¨‹&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‘åŸç”Ÿèµ„æ–™åº“ï¼š&lt;a href=&#34;http://lib.jimmysong.io&#34; title=&#34;lib.jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lib.jimmysong.io&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‘åŸç”Ÿç¤¾åŒºï¼š&lt;a href=&#34;http://cloudnative.to&#34; title=&#34;cloudnative.to&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cloudnative.to&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://academy.tetrate.io/courses/certified-istio-administrator&#34; title=&#34;Istio ç®¡ç†å‘˜è®¤è¯&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç®¡ç†å‘˜è®¤è¯&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³äº&#34;&gt;å…³äº&lt;/h2&gt;
&lt;p&gt;â€œæºæ¥å¦‚æ­¤â€æ˜¯ç”± Linux åŸºé‡‘ä¼šå¼€æºè½¯ä»¶å­¦å›­ä¸»åŠçš„å¼€æºæŠ€æœ¯å…¬å¼€è¯¾ç³»åˆ—æ´»åŠ¨ã€‚Linux åŸºé‡‘ä¼šå¼€æºè½¯ä»¶å­¦å›­æ˜¯ Linux åŸºé‡‘ä¼šä¸­å›½åŒºå®˜æ–¹åŸ¹è®­å¹³å°ï¼Œè‡´åŠ›äºä¸ºä¸­å›½è½¯ä»¶è¡Œä¸šåŸ¹å…»å…·å¤‡ä¸“ä¸šå¼€æºæŠ€èƒ½çš„äººæ‰ï¼Œä¸ä»…ä¸ºä¸­å›½å¼€å‘è€…æä¾›æ¥è‡ªæºå¤´çš„å¼€æºæŠ€æœ¯è¯¾ç¨‹ï¼Œæ›´å‘æŒ¥ Linux åŸºé‡‘ä¼šå¼€æºé¢†å¯¼èƒ½åŠ›ï¼Œç§¯æä¸å›½å†…æƒå¨æŠ€æœ¯ä¸“å®¶ã€çŸ¥åè½¯ä»¶ä¼ä¸šåˆä½œï¼Œå¼€å±•å¼€æºæŠ€æœ¯å…¬å¼€è¯¾ç³»åˆ—æ´»åŠ¨ï¼Œè®©æ›´å¤šäººäº†è§£å¼€æºçŸ¥è¯†ï¼Œä»¥å¼€æºæŠ€æœ¯å…¬å¼€è¯¾ä¸ºçª—å£äº†è§£å¼€æºä¸–ç•Œã€‚&lt;/p&gt;
&lt;p&gt;Linux Foundation å¼€æºè½¯ä»¶å­¦å›­ï¼ˆLFOSSAï¼‰ä¾æ‰˜äºå…¨çƒæœ€å¤§çš„å¼€æºè½¯ä»¶ç»„ç»‡ï¼Œæ˜¯é¢†å…ˆå…¨çƒçš„é«˜ç«¯ä¸“ä¸šè½¯ä»¶äººæ‰æ•™è‚²æœºæ„ï¼Œä¸ºç§‘æŠ€ä¼ä¸šåŸ¹å…»äº†å¤§é‡è½¯ä»¶äººæ‰ï¼ŒLinux åŸºé‡‘ä¼šå¼€æºè½¯ä»¶å­¦å›­ä¸ä»…æ‹¥æœ‰ä¸°å¯Œçš„çº¿ä¸Šä¸“ä¸šè¯¾ç¨‹ï¼Œé¢æˆè¯¾ç¨‹çš„å¯¼å¸ˆåŒæ ·æ˜¯ç”±ä¸šå†…èµ„æ·±ä¸“å®¶æ‹…ä»»ï¼Œæ‰€é¢å‘çš„è¯ä¹¦æ›´æ˜¯å…¨çƒè®¤å¯çš„ä¸“ä¸šèµ„è´¨ã€‚Linux åŸºé‡‘ä¼šåšä¸ºéç‰Ÿåˆ©å›½é™…æŠ€æœ¯ç»„ç»‡ï¼Œè‡´åŠ›äºé€šè¿‡å¼€æºæ¨åŠ¨åˆ›æ–°å’Œä¿ƒè¿›ç§‘æŠ€å‘å±•ï¼Œæˆ‘ä»¬å”¯ä¸€çš„ç›®æ ‡å°±æ˜¯å¸®åŠ©æ‚¨çš„äº‹ä¸šå‘å±•æ›´ä¸Šä¸€å±‚æ¥¼ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•ç†è§£ Istio ä¸­çš„ VirtualService å’Œ DestinationRuleï¼Ÿ</title>
      <link>https://jimmysong.io/blog/understand-istio-vs-and-dr/</link>
      <pubDate>Fri, 14 Oct 2022 16:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/understand-istio-vs-and-dr/</guid>
      <description>
        
        
        &lt;p&gt;Istio åœ¨åˆšå¼€æºçš„æ—¶å€™å°±å®šä¹‰äº†å‡ åä¸ª CRDï¼Œå…¶ä¸­ç”¨äºæµé‡æ²»ç†çš„æœ‰ &lt;code&gt;RouteRule&lt;/code&gt;ã€&lt;code&gt;DestinationPolicy&lt;/code&gt;ã€&lt;code&gt;EgressRule&lt;/code&gt; ç­‰ï¼Œåæ¥æ¨å‡ºäº† &lt;a href=&#34;https://istio.io/v1.13/blog/2018/v1alpha3-routing/&#34; title=&#34;v1alpha3 API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v1alpha3 API&lt;/a&gt;
 ä½¿ç”¨ &lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;DestinationRule&lt;/code&gt; ç­‰å–ä»£äº†ä¹‹å‰çš„ APIã€‚ä½†æ˜¯è¿™äº›èµ„æºå¯¹è±¡çš„å®šä¹‰ï¼Œå¹¶ä¸åƒ Kubernetes ä¸­é‚£ä¹ˆç›´è§‚ï¼Œåè€Œä¼šæœ‰äº›éš¾ä»¥ç†è§£ï¼Œæ¯”å¦‚ &lt;code&gt;VirtualService&lt;/code&gt;ï¼Œåªçœ‹åå­—ä½ å¯èƒ½è®¤ä¸ºåªæ˜¯ç¬¬ä¸€ä¸ªäº†ä¸€ä¸ªâ€œè™šæ‹Ÿçš„æœåŠ¡â€ï¼Œä½†å®é™…å¹¶éå¦‚æ­¤ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†ä¸ºä½ é€šè¿‡ä¸å®é™…çš„äº¤é€šåšç±»æ¯”ï¼Œç›´è§‚ç®€è¦çš„ä»‹ç» Istio ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒçš„ç”¨äºæµé‡æ²»ç†çš„å¯¹è±¡â€”â€”&lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;DestinationRule&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµé‡-vs-äº¤é€š&#34;&gt;æµé‡ vs äº¤é€š&lt;/h2&gt;
&lt;p&gt;å¾ˆå¤šåˆšæ¥è§¦ Istio çš„äººå¯èƒ½å¯¹ &lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;DestinationRule&lt;/code&gt; å’Œä¸¤ä¸ªèµ„æºå¯¹è±¡ä¸æ˜¯å¾ˆç†è§£ï¼Œå¦‚æœæˆ‘ä»¬å°†ç¯å¢ƒä»…é™å®šäº Kubernetes é›†ç¾¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¯ç”±æ¯”å–»æˆç°å®ä¸–ç•Œä¸­çš„äº¤é€šï¼Œæœ‰å¾ˆå¤šè½¦è¾†åœ¨é“è·¯ä¸Šè¡Œé©¶ï¼Œè¿™å°±æ˜¯æµé‡ã€‚&lt;code&gt;DestinationRule&lt;/code&gt; ç›¸å½“äºå¼€è¾Ÿäº†é“è·¯/è·¯å¾„/è½¦é“ï¼Œç¡®ä¿äº†ä¸¤ç‚¹ä¹‹é—´å¯è¾¾å¹¶æ§åˆ¶è½¦é“çš„æ•°é‡ã€å®½åº¦ç­‰ã€‚è€Œ &lt;code&gt;VirtualService&lt;/code&gt; å°±åƒæ˜¯çº¢ç»¿ç¯å’Œé“è·¯æ ‡çº¿ï¼ŒæŒ‡æŒ¥è½¦è¾†å‘å“ªè¡Œé©¶å’Œå¦‚ä½•è¡Œé©¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ åªå®šä¹‰äº† DR å°†ä¸ä¼šå¯¹æµé‡äº§ç”Ÿä»»ä½•å½±å“ï¼Œå› ä¸ºä½ æ²¡æœ‰æŒ‡æŒ¥æµé‡æ€ä¹ˆèµ°ï¼Œæ‰€ä»¥ä½ å¿…é¡»å®šä¹‰ VirtualService æ‰å¯ä»¥æ§åˆ¶æµé‡çš„èµ°å‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å¥è¯æ¥æ¦‚æ‹¬ï¼šDestinationRule æ‰“é€šäº†ä¸¤åœ°ä¹‹é—´çš„é€šè·¯ï¼ŒçŠ¹å¦‚ä¿®è·¯æ¶æ¡¥é€šéš§é“ï¼ŒåŒæ—¶æ§åˆ¶è½¦é“è®¾è·¯éšœï¼›VirtualService åšè½¦è¾†æŒ‡æŒ¥è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;è¯·çœ‹ä¸‹é¢è¿™å¼ å°†æµé‡ä¸äº¤é€šçš„å¯¹æ¯”å›¾ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´ç›´è§‚çš„ç†è§£è¿™ç§æ¯”å–»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/understand-istio-vs-and-dr/traffic.jpg&#34; data-img=&#34;/blog/understand-istio-vs-and-dr/traffic.jpg&#34; data-width=&#34;1601&#34; data-height=&#34;1068&#34; alt=&#34;image&#34; data-caption=&#34;æµé‡ä¸äº¤é€šå¯¹æ¯”å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;æµé‡ä¸äº¤é€šå¯¹æ¯”å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æµé‡æ²»ç†&#34;&gt;æµé‡æ²»ç†&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢åˆ—ä¸¾äº†ä½ åˆ†åˆ«å¯ä»¥åœ¨è¿™ä¸¤ä¸ªèµ„æºå¯¹è±¡ä¸Šåšçš„æµé‡æ²»ç†è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VirtualService&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è·¯ç”±ï¼šé‡‘ä¸é›€å‘å¸ƒã€åŸºäºç”¨æˆ·èº«ã€URIã€Header ç­‰åŒ¹é…è·¯ç”±ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;é”™è¯¯æ³¨å…¥ï¼šHTTP é”™è¯¯ä»£ç æ³¨å…¥ã€HTTP å»¶æ—¶æ³¨å…¥ï¼›&lt;/li&gt;
&lt;li&gt;æµé‡åˆ‡åˆ†ï¼šåŸºäºç™¾åˆ†æ¯”çš„æµé‡åˆ‡åˆ†è·¯ç”±ï¼›&lt;/li&gt;
&lt;li&gt;æµé‡é•œåƒï¼šå°†ä¸€å®šç™¾åˆ†æ¯”çš„æµé‡é•œåƒå‘é€åˆ°å…¶ä»–é›†ç¾¤ï¼›&lt;/li&gt;
&lt;li&gt;è¶…æ—¶ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è®¾ç½®çš„æ—¶é—´è¯·æ±‚å°†å¤±è´¥ï¼›&lt;/li&gt;
&lt;li&gt;é‡è¯•ï¼šè®¾ç½®é‡è¯•ç­–ç•¥ï¼Œå¦‚è§¦å‘æ¡ä»¶ã€é‡è¯•æ¬¡æ•°ã€é—´éš”æ—¶é—´ç­‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;DestinationRule&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡ï¼šè®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¦‚ç®€å•è´Ÿè½½å‡è¡¡ã€åŒºåŸŸæ„ŸçŸ¥è´Ÿè½½å‡è¡¡ã€åŒºåŸŸæƒé‡è´Ÿè½½å‡è¡¡ï¼›&lt;/li&gt;
&lt;li&gt;ç†”æ–­ï¼ˆCircuit Breakingï¼‰ï¼šé€šè¿‡å¼‚å¸¸ç‚¹æ£€æµ‹ï¼ˆOutlier Detectionï¼‰å’Œè¿æ¥æ± è®¾ç½®å°†å¼‚å¸¸èŠ‚ç‚¹ä»è´Ÿè½½å‡è¡¡æ± ä¸­å‰”é™¤ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡å°†æŠ½è±¡çš„æµé‡æ²»ç†ä¸ç°å®ä¸­çš„äº¤é€šç®¡ç†ç›¸ç±»æ¯”ï¼Œå¸®åŠ©ä½ æ›´ç›´è§‚çš„ç†è§£ Istio ä¸­çš„æµé‡ç®¡ç†å¯¹è±¡ &lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;DestinationRule&lt;/code&gt;ã€‚åŒæ—¶ä»‹ç»äº†åŸºäºå®ƒä»¬å¯ä»¥è¿›è¡Œçš„æµé‡æ²»ç†åŠŸèƒ½ã€‚&lt;code&gt;VirtualService&lt;/code&gt; ä¸»è¦ç”¨äºè®¾ç½®è·¯ç”±è§„åˆ™ï¼Œè€ŒæœåŠ¡å¼¹æ€§ï¼ˆè¶…æ—¶ã€é‡è¯•ã€ç†”æ–­ç­‰ï¼‰éœ€è¦é å®ƒå’Œ DestinationRule æ¥å…±åŒç»´æŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/v1.13/blog/2018/v1alpha3-routing/&#34; title=&#34;Introducing the Istio v1alpha3 routing API - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Introducing the Istio v1alpha3 routing API - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/&#34; title=&#34;Traffic Management - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traffic Management - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä¸åœæœºå‡çº§ Istioï¼Ÿ</title>
      <link>https://jimmysong.io/blog/istio-canary-upgrade/</link>
      <pubDate>Fri, 14 Oct 2022 11:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-canary-upgrade/</guid>
      <description>
        
        
        &lt;h2 id=&#34;å¼€å§‹ä¹‹å‰&#34;&gt;å¼€å§‹ä¹‹å‰&lt;/h2&gt;
&lt;p&gt;æˆªæ­¢åˆ°æ’°å†™æœ¬æ–‡æ—¶ Istio çš„æœ€é«˜ç‰ˆæœ¬ä¸º 1.15.2ï¼Œ1.13 ç‰ˆæœ¬çš„å®˜æ–¹æ”¯æŒå·²ç»ç»“æŸã€‚è¯·å¯¹ç…§ &lt;a href=&#34;https://istio.io/latest/docs/releases/supported-releases/#support-status-of-istio-releases&#34; title=&#34;Istio æ–‡æ¡£ä¸­çš„å‘å¸ƒçŠ¶æ€æè¿°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£ä¸­çš„å‘å¸ƒçŠ¶æ€æè¿°&lt;/a&gt;
ç¡®å®šæ˜¯å¦éœ€è¦å¯¹ Istio è¿›è¡Œå‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®˜ç½‘ä¸Šç»™å‡ºäº†å‡çº§ Istio çš„&lt;a href=&#34;https://istio.io/latest/docs/setup/upgrade/&#34; title=&#34;å‡ ç§æ–¹å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡ ç§æ–¹å¼&lt;/a&gt;
ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡‘ä¸é›€å‡çº§&lt;/li&gt;
&lt;li&gt;åŸåœ°å‡çº§&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Helm å‡çº§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†å®é™…ä¸Šï¼Œä¸ºäº†å‡å°‘åœ¨å‡çº§æ—¶å¯¹ç½‘æ ¼å†…ä¸šåŠ¡çš„å½±å“ï¼Œå»ºè®®åœ¨å‡çº§ Istio çš„æ—¶å€™ï¼Œä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/setup/upgrade/canary/&#34; title=&#34;canary upgrade&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;canary upgrade&lt;/a&gt;
ï¼Œå®ƒæ¯” &lt;a href=&#34;https://istio.io/latest/docs/setup/upgrade/in-place/&#34; title=&#34;in-place upgrade&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;in-place upgrade&lt;/a&gt;
 æ›´åŠ å®‰å…¨ï¼Œè€Œä¸”æ”¯æŒå›æ»šã€‚ä½¿ç”¨ canary upgrade æ”¯æŒè·¨è¶Šä¸¤ä¸ªå°ç‰ˆæœ¬ï¼Œè€Œ in-place upgrade å¿…é¡»ä¸€ä¸ªä¸€ä¸ªå°ç‰ˆæœ¬çš„å‡çº§ã€‚ä¸è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œå…¶ä¸­ Ingress Gateway éƒ½æ˜¯ in-place upgrade çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/setup/upgrade/canary/&#34; title=&#34;Istio å®˜æ–¹æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;
å¯¹å‡çº§çš„æ­¥éª¤æè¿°çš„ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œæœ¬æ–‡æ˜¯å¯¹å®˜æ–¹æ–‡æ¡£çš„ä¸€ä¸ªè¡¥å……ï¼Œåœ¨å‡çº§å®Œæˆåæœ‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºéœ€è¦è‡ªåŠ¨ sidecar æ³¨å…¥çš„ namespace æ‰“ä¸Šå¯¹åº”çš„ labelï¼›&lt;/li&gt;
&lt;li&gt;åˆ é™¤åŸæœ‰çš„ &lt;code&gt;validatingwebhookconfiguration&lt;/code&gt; å¹¶æ·»åŠ æ–°çš„ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è¯¦ç»†çš„å‡çº§æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‡çº§æ­¥éª¤&#34;&gt;å‡çº§æ­¥éª¤&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨çš„æ˜¯ä»¥ä¸‹å‘½ä»¤å®‰è£…çš„ canary ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å°†æ–°ç‰ˆæœ¬çš„ revision å‘½åä¸º canary&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;revision&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;canary
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å–æ¶ˆåŸå…ˆè‡ªåŠ¨æ³¨å…¥ sidecar çš„ namespace ä¸­çš„ label å¹¶è®¾ç½®æ–°çš„ labelï¼Œè¿™æ ·è¯¥ namespace å°±å¯ä»¥æ³¨å…¥ canary ç‰ˆæœ¬å¯¹åº”çš„ sidecar&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace test-ns istio-injection- istio.io/rev&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;canary
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# é‡å¯æ•°æ®å¹³é¢ä¸­çš„å·¥ä½œè´Ÿè½½ï¼Œå°†å®Œæˆæ–°ç‰ˆæœ¬çš„ sidecar è‡ªåŠ¨æ³¨å…¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl rollout restart deployment -n test-ns
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„åœ¨å‡çº§å®Œæˆåï¼Œä¸ºæ–°çš„ namespace å¼€å¯ sidecar è‡ªåŠ¨æ³¨å…¥æ—¶ï¼Œéœ€è¦ç»™ namespace æ‰“ä¸Šå®‰è£… canary Istio æ—¶å€™è®¾ç½®çš„ labelï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace new-ns istio-injection- istio.io/rev&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;canary
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;istio-å‡çº§å®Œæˆåçš„æ³¨æ„äº‹é¡¹&#34;&gt;Istio å‡çº§å®Œæˆåçš„æ³¨æ„äº‹é¡¹&lt;/h2&gt;
&lt;p&gt;åœ¨å‡çº§å®Œæˆåï¼Œè¿˜æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚ä¾‹å¦‚å¦‚æœä½ å·²ç»ä¸ºå…¶ä»– namespace æ‰“ä¸Šäº† sidecar è‡ªåŠ¨æ³¨å…¥çš„ labelï¼Œè¯·ä¸€å®šè¦å°†å®ƒåˆ æ‰ï¼Œå¹¶å°† label è®¾ç½®ä¸º &lt;code&gt;istio.io/rev=canary&lt;/code&gt;ï¼Œå› ä¸ºå¯ä»¥ä¿è¯åœ¨ pod ä¸­æ³¨å…¥æ–°ç‰ˆè¢« sidecarï¼Œå¹¶ä¸”è¿æ¥åˆ°æ–°ç‰ˆçš„ Istiodã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä½ éœ€è¦æŠŠæœ€æ—©å®‰è£… Istio æ—¶è®¾ç½®çš„ &lt;code&gt;ValidatingWebhookConfiguration&lt;/code&gt; åˆ æ‰ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete validatingwebhookconfiguration istiod-default-validator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äº ValidatingWebhookConfiguration
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  åœ¨ä½ å®‰è£…æ–°ç‰ˆæœ¬çš„ Istio çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;istio-validator-canary-istio-system&lt;/code&gt; çš„ ValidatingWebhookConfigurationï¼Œè¯¥é…ç½®çš„ç›®çš„æ˜¯åœ¨åˆ›å»ºå’Œæ›´æ–° Istio CR çš„æ—¶å€™ï¼Œå…ˆæ£€æµ‹æ‰€æœ‰è¿æ¥çš„ Istiod æ˜¯å¦æœ‰æ•ˆã€‚å…³äºåŠ¨æ€å‡†å…¥æ§åˆ¶çš„è¯¦ç»†æè¿°è¯·è§ &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/extensible-admission-controllers/&#34; title=&#34;Kubernetes æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æ–‡æ¡£&lt;/a&gt;
ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;å› ä¸ºåœ¨å®‰è£…æ–°ç‰ˆæœ¬ Istio çš„æ—¶å€™ï¼Œå®‰è£…äº†æ–°çš„ &lt;code&gt;istio-validator-canary-istio-system&lt;/code&gt;ã€‚å¦‚æœä½ ä¸å°†æ—§çš„åˆ é™¤è¯ï¼Œä½ åœ¨åˆ›å»º Istio CR çš„æ—¶å€™å°†ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Error from server (InternalError): error when creating &amp;#34;samples/bookinfo/networking/bookinfo-gateway.yaml&amp;#34;: Internal error occurred: failed calling webhook &amp;#34;validation.istio.io&amp;#34;: failed to call webhook: Post &amp;#34;https://istiod.istio-system.svc:443/validate?timeout=10s&amp;#34;: service &amp;#34;istiod&amp;#34; not found
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»¥ä¸Šå†…å®¹åœ¨ Istio çš„å®˜æ–¹æ–‡æ¡£ä¸­é‡Œå¹¶æ²¡æœ‰è¯´æ˜ï¼Œä½†æ˜¯åœ¨ &lt;a href=&#34;https://github.com/istio/istio/issues/36526&#34; title=&#34;Istio Issue-36526&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Issue-36526&lt;/a&gt;
 ä¸­æœ‰æåŠã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/extensible-admission-controllers/&#34; title=&#34;åŠ¨æ€å‡†å…¥æ§åˆ¶ - kubernetes.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€å‡†å…¥æ§åˆ¶ - kubernetes.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/releases/supported-releases/&#34; title=&#34;Istio Supported Releases - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Supported Releases - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/setup/upgrade/canary/&#34; title=&#34;Canary Upgrades - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Canary Upgrades - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>å…³äº Istio æ¨å‡º ambient æ•°æ®å¹³é¢æ¨¡å¼çš„çœ‹æ³•</title>
      <link>https://jimmysong.io/blog/istio-ambient-mode/</link>
      <pubDate>Thu, 08 Sep 2022 11:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-ambient-mode/</guid>
      <description>
        
        
        &lt;p&gt;ä»Šå¤© &lt;a href=&#34;https://lib.jimmysong.io/blog/introducing-ambient-mesh/&#34; title=&#34;Istio ç¤¾åŒºæ¨å‡ºäº† Ambient Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç¤¾åŒºæ¨å‡ºäº† Ambient Mesh&lt;/a&gt;
ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„ Istio æ•°æ®å¹³é¢æ¨¡å¼ï¼Œæ—¨åœ¨ç®€åŒ–æ“ä½œã€æ‰©å¤§åº”ç”¨å…¼å®¹æ€§å¹¶é™ä½åŸºç¡€è®¾æ–½æˆæœ¬ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©å°† Ambient Mesh é›†æˆåˆ°å…¶åŸºç¡€è®¾æ–½çš„ç½‘æ ¼æ•°æ®å¹³é¢ï¼Œæ”¾å¼ƒ sidecar ä»£ç†ï¼ŒåŒæ—¶ä¿æŒ Istio çš„é›¶ä¿¡ä»»å®‰å…¨ã€é¥æµ‹å’Œæµé‡ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚è¯¥æ¨¡å¼ç›®å‰è¿˜æ˜¯é¢„è§ˆç‰ˆï¼ŒIstio ç¤¾åŒºå‡†å¤‡åœ¨æœªæ¥å‡ ä¸ªæœˆå†…å°†å…¶æ¨å‘ç”Ÿäº§å°±ç»ªã€‚&lt;/p&gt;
&lt;p&gt;Ambient Mesh æ¨å‡ºçš„æ¶ˆæ¯å¯¹äºç¤¾åŒºæ¥è¯´å¯èƒ½æ˜¾å¾—æœ‰äº›çªç„¶ï¼Œä½†å…¶å®å…³äº sidecar æ¨¡å¼å¯¹äºèµ„æºçš„æ¶ˆè€—è¿‡å¤§ï¼Œä»¥åŠç®€åŒ–æœåŠ¡ç½‘æ ¼çš„å‘¼å£°åœ¨ç¤¾åŒºé‡Œå·²ç»å­˜åœ¨å¾ˆä¹…äº†ï¼ŒGoogle ä»å¤šå¹´å‰å°±åœ¨å¯»æ±‚ HBONEï¼ˆHTTP-Based Overlay Network Environmentï¼ŒåŸºäº HTTP çš„é‡å ç½‘ç»œç¯å¢ƒï¼‰è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰ç¤¾åŒºæå‡ºçš„&lt;a href=&#34;https://jimmysong.io/blog/beyond-istio-oss/#sidecar-management&#34; title=&#34;å¤šç§ sidecar éƒ¨ç½²æ¨¡å¼&#34;&gt;å¤šç§ sidecar éƒ¨ç½²æ¨¡å¼&lt;/a&gt;
ã€&lt;a href=&#34;https://jimmysong.io/blog/beyond-istio-oss/#proxyless-pattern&#34; title=&#34;proxyless æ¨¡å¼&#34;&gt;proxyless æ¨¡å¼&lt;/a&gt;
 ç­‰éƒ½æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;what-is-ambient-mode&#34;&gt;ä»€ä¹ˆæ˜¯ Ambient æ¨¡å¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Ambient æ¨¡å¼æ˜¯ Istio ç¤¾åŒºåœ¨ 2022 å¹´ 9 æœˆæ¨å‡ºçš„ä¸€ç§æ—  sidecar çš„ Istio æ•°æ®å¹³é¢éƒ¨ç½²æ¨¡å¼ï¼Œä¸‹å›¾å±•ç¤ºäº† Ambient æ¨¡å¼çš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-ambient-mode/ambient-mesh-arch.svg&#34; data-img=&#34;/blog/istio-ambient-mode/ambient-mesh-arch.svg&#34; alt=&#34;image&#34; data-caption=&#34;Ambient æ¨¡å¼æ¶æ„&#34;&gt;
    
  
  &lt;figcaption&gt;Ambient æ¨¡å¼æ¶æ„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Ambient æ¨¡å¼å¯¹åº”ç”¨ç¨‹åºæœ¬èº«æ²¡æœ‰ä»»ä½•ä¾µå…¥ï¼Œè€Œæ˜¯åœ¨åº”ç”¨ç¨‹åºå¤–å›´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŒ node ä¸Šéƒ¨ç½² ztunnelï¼šä½¿ç”¨ Envoy å®ç°çš„å…±äº«ä»£ç†ï¼Œå¤šç§Ÿæˆ·æ¨¡å¼ï¼Œè´Ÿè´£ L4 ç½‘ç»œï¼Œä¸»è¦æ˜¯å®‰å…¨æ€§æ–¹é¢ï¼›&lt;/li&gt;
&lt;li&gt;ä»¥æœåŠ¡è´¦æˆ·ä¸ºå•ä½éƒ¨ç½² Waypoint proxyï¼šåŒæ ·ä½¿ç”¨ Envoy å®ç°ï¼Œå•ç§Ÿæˆ·æ¨¡å¼ï¼Œä½¿ç”¨ Gateway API éƒ¨ç½²çš„ Gateway èµ„æºï¼Œè´Ÿè´£ L7 ç½‘ç»œï¼Œå½“æœåŠ¡éœ€è¦ L7 ç½‘ç»œåŠŸèƒ½çš„æ—¶å€™æ‰éƒ¨ç½²ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Ambient æ¨¡å¼çš„åŠŸèƒ½åˆ†å±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-ambient-mode/ambient-mesh-layers.svg&#34; data-img=&#34;/blog/istio-ambient-mode/ambient-mesh-layers.svg&#34; alt=&#34;image&#34; data-caption=&#34;Ambient æ¨¡å¼çš„åŠŸèƒ½åˆ†å±‚&#34;&gt;
    
  
  &lt;figcaption&gt;Ambient æ¨¡å¼çš„åŠŸèƒ½åˆ†å±‚&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…³äº Ambient æ¨¡å¼çš„æ›´å¤šä»‹ç»è¯·é˜…è¯»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/introducing-ambient-mesh/&#34; title=&#34;Istio æ—  sidecar ä»£ç†æ•°æ®å¹³é¢ ambient æ¨¡å¼ç®€ä»‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ—  sidecar ä»£ç†æ•°æ®å¹³é¢ ambient æ¨¡å¼ç®€ä»‹&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/ambient-security/&#34; title=&#34;Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/what-is-ambient-mesh/&#34; title=&#34;ä»€ä¹ˆæ˜¯ Ambient Meshï¼Œå®ƒä¸ sidecar æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ Ambient Meshï¼Œå®ƒä¸ sidecar æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ambient-core&#34;&gt;Ambient æ¨¡å¼çš„æ ¸å¿ƒæŠ€æœ¯&lt;/h2&gt;
&lt;p&gt;Ambient æ¨¡å¼ä¸­çš„ ztunnel å’Œ Waypoint proxy ç›®å‰è¿˜æ˜¯ä½¿ç”¨ Envoy æ¥å®ç°çš„ï¼Œæœªæ¥ä¸æ’é™¤ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼ˆé C++ï¼Œå¦‚ Rustï¼‰æ¥å®ç°ä¸€ä¸ªè½»é‡çº§çš„ ztunnelã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒæ˜¯æ‰€è°“çš„ HBONEï¼ˆHTTP Based Overlay Network Environmentï¼ŒåŸºäº HTTP çš„è¦†ç›–ç½‘ç»œç¯å¢ƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;HBONE åŸºäº HTTP/2 CONNECTï¼Œå°†å·¥ä½œè´Ÿè½½ä¹‹é—´çš„è¯·æ±‚ä»¥æµçš„å½¢å¼è¿›è¡Œéš§é“ä¼ è¾“ï¼Œå°½å¯èƒ½åœ°å¤ç”¨ HTTP/2 è¿æ¥ã€‚HBONE å¯¹å·¥ä½œè´Ÿè½½æ¥è¯´æ˜¯é€æ˜çš„ï¼Œæ”¯æŒæ›´å¥½çš„ä¼ è¾“æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šåè®®ï¼ŒåŒ…æ‹¬ &lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#server-first-protocols&#34; title=&#34;Server First åè®®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Server First åè®®&lt;/a&gt;
ï¼Œå¦‚ MySQLã€‚Istio å¯ä»¥è‡ªåŠ¨æ£€æµ‹å‡º HTTP å’Œ HTTP/2 æµé‡ã€‚å¦‚æœæœªè‡ªåŠ¨æ£€æµ‹å‡ºåè®®ï¼Œæµé‡å°†ä¼šè§†ä¸ºæ™®é€š TCP æµé‡ã€‚å¯¹äº Server First åè®®å¿…é¡»æ˜ç¡®å£°æ˜ï¼Œå¦åˆ™å°†ä½œä¸º TCP æµé‡å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹äºä½¿ç”¨è‡ªå·± TLS è¯ä¹¦çš„åº”ç”¨ç¨‹åºå¯ä»¥é€æ­¥é‡‡ç”¨ Istioï¼›&lt;/li&gt;
&lt;li&gt;æ”¯æŒç»•è¿‡ Istio mTLS å°è£…ç›´æ¥è°ƒç”¨ Pod IPï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;sidecar-limitations&#34;&gt;Sidecar æ¨¡å¼çš„é™åˆ¶&lt;/h2&gt;
&lt;p&gt;å…¶å® ambient æ¨¡å¼çš„å‡ºç°ï¼Œä¸»è¦æ˜¯å› ä¸º sidecar æ¨¡å¼æœ‰ä»¥ä¸‹é™åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar å®¹å™¨ä¸æ˜¯ pod ä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸å—æ§åˆ¶ï¼Œæœ‰å¯èƒ½åœ¨ sidecar å°±æ²¡å‡†å¤‡å¥½çš„æƒ…å†µä¸‹ï¼Œpod å°±å¼€å§‹æ¥æ”¶è¿æ¥ï¼Œè®© sidecar çš„ç”Ÿå‘½å‘¨æœŸä¸åº”ç”¨ç¨‹åº pod ç»‘å®šï¼Œè¿™æœ¬èº«å°±æ˜¯å¯¹åº”ç”¨ç¨‹åºçš„ä¸€ç§ä¾µå…¥&lt;/li&gt;
&lt;li&gt;Sidecar æ— æ³•è§£é‡Šä¸è§„èŒƒçš„ä¸ƒå±‚ç³»åˆ—ï¼Œå¦‚ HTTP å’Œ gRPCï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä»…éœ€æœåŠ¡ç½‘æ ¼çš„å®‰å…¨åŠŸèƒ½ï¼Œé‚£ä¹ˆå¼•å…¥ sidecar æ˜¯ä¸€æ¬¡è¿‡å¤§çš„æŠ•èµ„ï¼Œå› ä¸ºå®ƒå¢åŠ äº†å¾ˆå¤šä¸ƒå±‚ç½‘ç»œåŠŸèƒ½ï¼Œè¿™äº›æ˜¯ç”¨ä¸åˆ°çš„ï¼Œå®¢æˆ·æ— æ³•åšåˆ°æ¸è¿›å¼é‡‡ç”¨æœåŠ¡ç½‘æ ¼ï¼›&lt;/li&gt;
&lt;li&gt;Sidecar å‡çº§æ—¶ï¼Œåº”ç”¨ç¨‹åºéœ€è¦é‡æ–°éƒ¨ç½²æˆ–è€…å¯åŠ¨ï¼Œè¿™éœ€è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œåè°ƒï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ambient-insight&#34;&gt;å…³äº Ambient æ¨¡å¼çš„çœ‹æ³•&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æˆ‘å°†è°ˆè°ˆå¯¹ ambient æ¨¡å¼çš„å‡ ç‚¹çœ‹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…³äº Ambient Mesh çš„å‘½å&lt;/strong&gt;ï¼šæˆ‘è§‰å¾—å«åš &lt;strong&gt;Ambient Mode&lt;/strong&gt; ä¼šæ›´å¥½ï¼Œæœ‰äº›æ¥è§¦ Istio çš„åˆå­¦è€…å¯èƒ½ä¼šè§‰å¾—å®ƒæ˜¯ä¸€ç§å…¨æ–°çš„ä¸åŒäº Istio çš„ service meshï¼›å¦å¤–å…³äºè¿™ä¸ªæ¨¡å¼çš„ä¸­æ–‡ç¿»è¯‘ï¼Œå¦‚æœç›´æ¥ç¿»è¯‘æˆâ€œç¯å¢ƒç½‘æ ¼â€ä¼¼ä¹è®©äººå¾ˆéš¾ç†è§£ï¼Œæˆ‘è¿˜æƒ³åˆ°äº†å…¶ä»–è¯æ±‡ï¼Œå¦‚â€œå¤–å›´â€ã€â€œæ°›å›´â€ã€â€œå‘¨å›´â€ã€â€œç¯ç»•â€ã€â€æƒ…æ™¯â€ç­‰ï¼Œæ²¡æœ‰ä¸€ä¸ªæ±‰è¯­è¯æ±‡å¯ä»¥å‡†ç¡®è¡¨è¾¾è¿™ä¸ª ambient çš„å«ä¹‰ï¼Œå› ä¸ºç›¸å¯¹äº sidecar æ¨¡å¼ï¼Œambient æ¨¡å¼å¯¹åº”ç”¨ç¨‹åº pod æ²¡æœ‰ä¾µå…¥æ€§ï¼Œæš‚ä¸”å°†å…¶ç§°ä¹‹ä¸º&lt;strong&gt;å¤–å›´æ¨¡å¼&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ambient Mode çš„æœ¬è´¨&lt;/strong&gt;ï¼šå®ƒçš„æœ¬è´¨æ˜¯åˆ†ç¦» sidecar proxyï¼ˆEnvoyï¼‰ä¸­çš„ L4 å’Œ L7 åŠŸèƒ½ï¼Œè®©ä¸€éƒ¨åˆ†ä»…éœ€è¦å®‰å…¨åŠŸèƒ½çš„ç”¨æˆ·å¯ä»¥æœ€å°é˜»åŠ›ï¼ˆä½èµ„æºæ¶ˆè€—ã€è¿ç»´æˆæœ¬ï¼‰åœ°ä½¿ç”¨ Istio service meshã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ambient Mode çš„æ„ä¹‰&lt;/strong&gt;ï¼šå› ä¸ºå®ƒ sidecar æ¨¡å¼å…¼å®¹ï¼Œç”¨æˆ·åœ¨é‡‡çº³ Ambient Mode è·å¾—äº† mTLS å’Œæœ‰é™çš„å¯è§‚å¯Ÿæ€§åŠ TPC è·¯ç”±ç­‰ L4 åŠŸèƒ½ï¼Œä¹‹åå¯ä»¥æ›´æ–¹ä¾¿çš„è¿‡åº¦åˆ° sidecar mode ä»¥è·å¾—å®Œå…¨çš„ L7 åŠŸèƒ½ã€‚è¿™ç»™ç”¨æˆ·é‡‡çº³ Istio æä¾›äº†æ›´å¤šæ¨¡å¼é€‰æ‹©ï¼Œä¼˜åŒ–äº† Istio é‡‡çº³è·¯å¾„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ambient Mode çš„åå¤„&lt;/strong&gt;ï¼šProxylessã€sidecarã€ambient æ¨¡å¼ï¼Œä½¿å¾— Istio è¶Šæ¥è¶Šå¤æ‚ï¼Œç”¨æˆ·ç†è§£èµ·æ¥æ›´åŠ è´¹åŠ›ï¼›æ§åˆ¶å¹³é¢ä¸ºäº†æ”¯æŒå¤šç§æ•°æ®å¹³é¢éƒ¨ç½²æ¨¡å¼ï¼Œå…¶å®ç°å°†æ›´åŠ å¤æ‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å…¶ä»–æœåŠ¡ç½‘æ ¼çš„å…³ç³»&lt;/strong&gt;ï¼šæœ‰çš„ service mesh ä»åŸå…ˆçš„ per-proxy per-node æ¨¡å¼è½¬å˜ä¸º sidecar modeï¼Œå¦‚ Linkerdï¼›è¿˜æœ‰çš„ä» CNI åšåˆ° service meshï¼Œå¦‚ Cilium ä½¿ç”¨ per-proxy per-node æ¨¡å¼ï¼›å¦‚ä»Š Istio åœ¨ sidecar mode çš„åŸºç¡€ä¸Šå¢åŠ äº† ambient modeï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰å”¯ä¸€åŒæ—¶æ”¯æŒè¿™ä¸¤ç§éƒ¨ç½²æ¨¡å¼çš„æœåŠ¡ç½‘æ ¼ï¼Œä¸ºç”¨æˆ·æä¾›äº†å¤šæ ·çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨é—®é¢˜&lt;/strong&gt;ï¼šè™½ç„¶ &lt;a href=&#34;https://lib.jimmysong.io/blog/ambient-security/&#34; title=&#34;Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£&lt;/a&gt;
 è¯´æ˜äº† ambient æ¨¡å¼çš„è®¾è®¡ä¸»æ—¨æ˜¯ä¸ºäº†å°†åº”ç”¨ç¨‹åºä¸æ•°æ®å¹³é¢åˆ†ç¦»ï¼Œè®©å®‰å…¨è¦†ç›–å±‚çš„ç»„ä»¶ï¼ˆztunnelï¼‰å¤„äºç±»ä¼¼äº CNI çš„ç½‘æ ¼åº•å±‚ï¼Œè€ƒè™‘åˆ° ztunnel æœ‰é™çš„ L4 æ”»å‡»é¢ï¼Œè¯¥æ¨¡å¼çš„å®‰å…¨é£é™©æ˜¯å¯ä»¥æ¥å—çš„ï¼›ä½†æ˜¯ï¼Œztunnel ä½œä¸º DaemonSet éƒ¨ç½²åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéœ€è¦å¤„ç†å’Œåˆ†å‘è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ pod çš„è¯ä¹¦æ¥å»ºç«‹ mTLS è¿æ¥ï¼Œä¸€æ—¦ ä¸€ä¸ª ztunnel è¢«æ”»ç ´ï¼Œå®ƒçš„çˆ†ç‚¸åŠå¾„ç¡®å®æ˜¯å¤§äºä¸€ä¸ª sidecarï¼Œå®‰å…¨è¯¦è§£çš„åšå®¢ä¸­è¯´ Envoy çš„ CVE é—®é¢˜ä¼šå½±å“æ‰€æœ‰ sidecarï¼Œå‡çº§ sidecar ä¹Ÿä¼šå¸¦æ¥å¾ˆå¤§çš„è¿è¥æˆæœ¬ï¼Œæ‰€ä»¥æƒè¡¡ä¹‹ä¸‹é€‰æ‹© ambient æ¨¡å¼ï¼Œå®‰å…¨é—®é¢˜å†æ¬¡ç»™ç”¨æˆ·é€ æˆäº†å›°æƒ‘ï¼Œä¸è¿‡æœ€ç»ˆé€‰æ‹©çš„æƒåˆ©è¿˜æ˜¯åœ¨ç”¨æˆ·è‡ªå·±ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;setup&#34;&gt;å®‰è£…è¯•ç”¨&lt;/h2&gt;
&lt;p&gt;å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/blog/2022/get-started-ambient/&#34; title=&#34;Istio å®˜ç½‘ä¸­çš„æ­¥éª¤&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘ä¸­çš„æ­¥éª¤&lt;/a&gt;
å®‰è£…ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://gcsweb.istio.io/gcs/istio-build/dev/0.0.0-ambient.191fe680b52c1754ee72a06b3e0d3f9d116f2e82&#34; title=&#34;ä¸‹è½½ Ambient Mesh é¢„è§ˆç‰ˆ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½ Ambient Mesh é¢„è§ˆç‰ˆ&lt;/a&gt;
ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ£€æŸ¥ Kubernetes ç‰ˆæœ¬ï¼Œå»ºè®®çš„å¤§äºç­‰äº 1.21ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… Ambient profileï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ambient
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/linsun/sample-apps/main/sleep/sleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/linsun/sample-apps/main/sleep/notsleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†åº”ç”¨æ·»åŠ åˆ° Ambient Meshï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio.io/dataplane-mode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ambient
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘é€æµ‹è¯•æµé‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; deploy/sleep -- curl -s http://istio-ingressgateway.istio-system/productpage &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; head -n1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; deploy/sleep -- curl -s http://productpage:9080/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; head -n1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; deploy/notsleep -- curl -s http://productpage:9080/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; head -n1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å°† Pod åŠ å…¥åˆ° Ambient Mesh ä¸­ä¹‹åï¼Œå°±å¯ä»¥ç»™è¿™äº› Pod åº”ç”¨ L4 çš„æˆæƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: security.istio.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: AuthorizationPolicy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; name: productpage-viewer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; namespace: default
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; selector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;   matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;     app: productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; action: ALLOW
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; rules:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; - from:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;   - source:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;       principals: [&amp;#34;cluster.local/ns/default/sa/sleep&amp;#34;, &amp;#34;cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢è¿™ä¸ªç­–ç•¥åªå…è®¸ sleep æœåŠ¡å’Œ istio ingress gateway è®¿é—® productpageã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº”ç”¨ L7 ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; name: productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; annotations:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;   istio.io/service-account: bookinfo-productpage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; gatewayClassName: istio-mesh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ Gateway API åˆ›å»ºäº†ä¸€ä¸ª Gatewayï¼Œè¿™é‡Œå®é™…æ˜¯åœ¨ &lt;code&gt;default&lt;/code&gt; å‘½åç©ºé—´ä¸‹åˆ›å»ºäº†ä¸€ä¸ª waypoint proxyï¼Œä¸“é—¨ç”¨äºå¤„ç† L7 æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»™å®ƒåº”ç”¨æˆæƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;kubectl apply -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-viewer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALLOW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;principals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªç­–ç•¥è·Ÿä¹‹å‰æœ‰æ‰€ä¸åŒçš„æ˜¯æœ€åçš„ &lt;code&gt;to&lt;/code&gt; å­—æ®µå®šä¹‰äº† HTTP æ–¹æ³•ï¼Œç°åœ¨ä½ åœ¨ sleep pod ä¸­å¯¹ productpage æœåŠ¡æ‰§è¡Œé™¤ GET ä»¥å¤–çš„å…¶ä»–è¯·æ±‚éƒ½å°†å¤±è´¥ã€‚ä» notsleep pod ä¸­å¯¹ productpage æœåŠ¡çš„ GET è¯·æ±‚å°†æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ å¯ä»¥ä»å‰é¢åˆ›å»ºçš„è¿™ä¸ª productpage Gateway ä¸­è·å–åˆ° HTTP è¯·æ±‚çš„ Prometheus æŒ‡æ ‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; deploy/bookinfo-productpage-waypoint-proxy -- curl -s http://localhost:15020/stats/prometheus &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep istio_requests_total
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»™ Reviews æœåŠ¡åˆ›å»º Gatewayï¼ˆWaypoint proxyï¼‰ï¼Œæ‰€æœ‰è®¿é—® Reviews æœåŠ¡çš„ L7 æµé‡éƒ½ä¼šç»è¿‡å®ƒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;kubectl apply -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.networking.k8s.io/v1alpha2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/service-account&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gatewayClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†ç»™å®ƒåº”ç”¨æµé‡åˆ’åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-90-10.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/destination-rule-reviews.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘é€ 100 æ¬¡è¯·æ±‚æµ‹è¯•æµé‡åˆ‡åˆ†ç»“æœã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it deploy/sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;for i in $(seq 1 100); do curl -s http://istio-ingressgateway.istio-system/productpage | grep reviews-v.-; done&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å°†è·å¾—è¯·æ±‚ç»“æœï¼Œè¯´æ˜ä¸€åˆ‡è¿è¡Œæ­£å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¸…ç†ç¯å¢ƒå’Œåˆ é™¤ Istioã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f samples/bookinfo/networking/virtual-service-reviews-90-10.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f samples/bookinfo/networking/destination-rule-reviews.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f https://raw.githubusercontent.com/linsun/sample-apps/main/sleep/sleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f https://raw.githubusercontent.com/linsun/sample-apps/main/sleep/notsleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio.io/dataplane-mode-   
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;enable-ambient&#34;&gt;å¦‚ä½•å¼€å¯ Ambient Meshï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨å®‰è£…æœ‰ Istio çš„ Kubernetes ä¸­éƒ¨ç½²äº†ä½ çš„åº”ç”¨ä¹‹åï¼Œå¦‚æœæƒ³è¦ç»™å‘½åç©ºé—´ &lt;code&gt;ns-a&lt;/code&gt; å¯ç”¨ Ambient Modeï¼Œåªéœ€è¦è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace ns-a istio.io/dataplane-mode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ambient
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ambient Mesh é»˜è®¤å¯ç”¨ L4 å®‰å…¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;enable-l7&#34;&gt;å¦‚ä½•å¯ç”¨ L7 ç½‘ç»œåŠŸèƒ½ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Ambient æ¨¡å¼çš„ L7 ç½‘ç»œåŠŸèƒ½æ˜¯æŒ‰éœ€å¯ç”¨çš„ï¼šå‡å¦‚ä½ æƒ³ç»™æœåŠ¡ A è®¿é—®æœåŠ¡ B çš„è·¯å¾„å¼€å¯ L7 ç½‘ç»œåŠŸèƒ½ï¼Œé‚£ä¹ˆä½ éœ€è¦ç»™æœåŠ¡ B åˆ›å»º Gatewayã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼ŒL7 ç½‘ç»œåŠŸèƒ½æ˜¯ä¸æœåŠ¡è´¦æˆ·ç»‘å®šçš„ï¼Œå‡å¦‚æœåŠ¡ &lt;code&gt;svc-a&lt;/code&gt; çš„æœåŠ¡è´¦æˆ·æ˜¯ &lt;code&gt;sa-svc-a&lt;/code&gt;ï¼Œé‚£ä¹ˆç»™å®ƒéƒ¨ç½²ä¸€ä¸ª Gatewayï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.networking.k8s.io/v1alpha2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;svc-a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/service-account&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-svc-a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gatewayClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åä½ å°±å¯ä»¥åˆ›å»º &lt;code&gt;VirtualService&lt;/code&gt;ã€&lt;code&gt;DestinationRule&lt;/code&gt; ç­‰èµ„æºç®¡ç†æœåŠ¡ &lt;code&gt;svc-a&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ Gateway å®é™…ä¸Šæ˜¯ä¸€ä¸ª Deploymentï¼Œå®ƒå¯ä»¥éƒ¨ç½²åœ¨ä¸åº”ç”¨ç¨‹åºä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œä½ å¯ä»¥å¯¹è¿™ä¸ª Deployment å•ç‹¬ç®¡ç†å’Œæ‰©ç¼©å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;limitation&#34;&gt;Ambient æ¨¡å¼çš„é™åˆ¶&lt;/h2&gt;
&lt;p&gt;ç›®å‰ ambient æ¨¡å¼çš„ä»£ç ä½äº Istio ä»£ç åº“çš„ &lt;a href=&#34;https://github.com/istio/istio/tree/experimental-ambient&#34; title=&#34;&amp;lt;code&amp;gt;experimental-ambient&amp;lt;/code&amp;gt; åˆ†æ”¯&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;experimental-ambient&lt;/code&gt; åˆ†æ”¯&lt;/a&gt;
ï¼Œ&lt;a href=&#34;https://twitter.com/mattklein123/status/1567870635568955392?ref_src=twsrc%5Etfw&#34; title=&#34;æ ¹æ® Matt Klein å’Œ Louis Ryan çš„è¯´æ³•&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ¹æ® Matt Klein å’Œ Louis Ryan çš„è¯´æ³•&lt;/a&gt;
ï¼Œztunnel å’Œ Waypoint proxy æ˜¯ç”¨ Envoy å®ç°çš„ï¼Œå…¶ä¸­ ztunnel æ˜¯ç²¾ç®€åçš„ Envoyï¼Œåªè´Ÿè´£ L4 åŠŸèƒ½ä¸”ç»§ç»­ä½¿ç”¨ xDS åè®®æ¥æ§åˆ¶ã€‚ä½†æ˜¯ ambient æ¨¡å¼ä¾ç„¶æœ‰å¾ˆå¤š&lt;a href=&#34;https://github.com/istio/istio/tree/experimental-ambient#limitations&#34; title=&#34;é™åˆ¶&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™åˆ¶&lt;/a&gt;
ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ Kubernetes ç‰ˆæœ¬çš„è¦æ±‚ä¸ä½äº 1.21&lt;/li&gt;
&lt;li&gt;ä¸æ”¯æŒ &lt;code&gt;EnvoyFilter&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ä¸æ”¯æŒ IPv6ï¼›&lt;/li&gt;
&lt;li&gt;ç›´æ¥å¯¹ Pod IP è€Œä¸æ˜¯ service çš„è¯·æ±‚åœ¨æŸäº›æƒ…å†µä¸‹å°†æ— æ•ˆï¼›&lt;/li&gt;
&lt;li&gt;Ambient æ¨¡å¼ä¸‹çš„æœåŠ¡æ— æ³•é€šè¿‡ &lt;code&gt;LoadBalancer&lt;/code&gt; å’Œ &lt;code&gt;NodePort&lt;/code&gt; æ–¹å¼è®¿é—®ï¼Œä¸è¿‡ä½ å¯ä»¥éƒ¨ç½²ä¸€ä¸ªå…¥å£ç½‘å…³ï¼ˆæœªå¯ç”¨ ambient æ¨¡å¼ï¼‰ä»¥ä»å¤–éƒ¨è®¿é—®æœåŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;ä¸æ”¯æŒ Calico CNI å’Œ Dataplane V2 CNIï¼Œå› ä¸º Ambient æ¨¡å¼ä¼šä½¿ç”¨ Istio CNIï¼Œä¸å…¶ä»– CNI å†²çªï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/istio/istio/tree/experimental-ambient#supported-environments&#34; title=&#34;è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;
æœ‰å®‰è£… ambient æ¨¡å¼çš„è¯¦ç»†ç¯å¢ƒè¦æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;more&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ç¬”è€…å¯¹ ambient æ¨¡å¼ï¼ˆå¤–å›´æ¨¡å¼ï¼‰çš„çœ‹æ³•ï¼Œè¯¥æ¨¡å¼è¿˜å¤„äºè¯•éªŒé˜¶æ®µï¼Œä½†ç»ä¸æ˜¯ç©å…·ï¼Œæ®ä¿¡å·²åœ¨æŸäº›åœºæ™¯è¯•éªŒè¿‡ã€‚ç¬”è€…ä¹Ÿå°†ç»§ç»­è¿½è¸ªè¯¥æ¨¡å¼çš„æœ€æ–°è¿›å±•ï¼Œè¯·ä¿æŒå…³æ³¨ã€‚ä¹Ÿæ¬¢è¿æ›´å¤šå…³æ³¨ Istio çš„æœ‹å‹&lt;a href=&#34;https://cloudnative.to/community/join/&#34; title=&#34;åŠ å…¥äº‘åŸç”Ÿç¤¾åŒº Istio è®¨è®ºç¾¤&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥äº‘åŸç”Ÿç¤¾åŒº Istio è®¨è®ºç¾¤&lt;/a&gt;
ï¼Œä¸ç¤¾åŒºå¤§å’–ä¸€èµ·æ¢è®¨ï¼Œæˆ–è€…åœ¨æœ¬æ–‡ä¸‹é¢è¯„è®ºèŠèŠä½ çš„çœ‹æ³•ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio 1.15 æ–°å¢å¯¹ arm64 æ¶æ„å¤„ç†å™¨çš„æ”¯æŒ</title>
      <link>https://jimmysong.io/blog/istio-arm64-support/</link>
      <pubDate>Wed, 31 Aug 2022 21:47:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-arm64-support/</guid>
      <description>
        
        
        &lt;p&gt;Istio æ˜¯åŸºäºå®¹å™¨çš„äº‘åŸç”ŸæŠ€æœ¯æ ˆçš„ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ Kubernetes å’Œ Knativeã€‚å…¶ä¸­ Kubernetes å’Œ Knative æ—©å·²æ”¯æŒäº† arm64 æ¶æ„ï¼Œç”šè‡³è¿ Istio çš„æ•°æ®å¹³é¢ Envoy æ—©åœ¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.16.0/install/building#arm-binaries&#34; title=&#34;1.16 ç‰ˆæœ¬&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.16 ç‰ˆæœ¬&lt;/a&gt;
å°±å·²æ”¯æŒ arm64 æ¶æ„ï¼ˆ2020 å¹´ 10 æœˆï¼‰ã€‚éšç€ &lt;a href=&#34;https://istio.io/latest/news/releases/1.15.x/announcing-1.15/&#34; title=&#34;Istio 1.15 çš„å‘å¸ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.15 çš„å‘å¸ƒ&lt;/a&gt;
ï¼Œä½ å¯ä»¥å¼€ç®±å³ç”¨å¾—åœ¨ arm64 æ¶æ„ä¸Šéƒ¨ç½² Istioï¼Œä¸éœ€è¦è‡ªå·±æ¥ç¼–è¯‘ arm æ¶æ„çš„é•œåƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨-istio-115-ä¹‹å‰å¦‚ä½•åœ¨-arm-æ¶æ„ä¸Šå®‰è£…-istio&#34;&gt;åœ¨ Istio 1.15 ä¹‹å‰å¦‚ä½•åœ¨ arm æ¶æ„ä¸Šå®‰è£… Istioï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Istio é»˜è®¤ä½¿ç”¨ Docker Hub ä½œä¸ºç”Ÿäº§é•œåƒä»“åº“ï¼ŒGoogle Container Registry ä½œä¸ºç”Ÿäº§å’Œæµ‹è¯•ä»“åº“ã€‚å¯¹äº 1.14 åŠä»¥å‰çš„ç‰ˆæœ¬ï¼ŒIstio å®˜æ–¹çš„é•œåƒä»“åº“ä¸­åªæœ‰ amd64 æ¶æ„çš„é•œåƒï¼Œå¦‚æœä½ çš„ Kubernetes é›†ç¾¤æ˜¯è¿è¡Œåœ¨ arm æ¶æ„ä¸‹ï¼Œåœ¨å®‰è£… Istio æ—¶ä¼šå‡ºç°å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;exec user process caused: exec format error
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ—¶ä½ éœ€è¦ä¸º Istio å®‰è£…é‡æ–°æŒ‡å®šä¸€ä¸ªåŒ…å« arm64 æ¶æ„é•œåƒçš„ä»“åº“ï¼Œåœ¨å®‰è£… Istio æ—¶æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŒ‡å®šè¯¥é•œåƒä»“åº“ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo --set &lt;span class=&#34;nv&#34;&gt;hub&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;docker.io/mydockerhub -y
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶è¦æƒ³åœ¨ arm64 æ¶æ„ä¸Šä½¿ç”¨ Istioï¼Œä½ å¯ä»¥ä½¿ç”¨ Istio ç¤¾åŒºä¸­æœ‰äººä¸º Istio å•ç‹¬æ„å»ºäº† arm64 æ¶æ„çš„&lt;a href=&#34;https://github.com/resf/istio&#34; title=&#34;é•œåƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é•œåƒ&lt;/a&gt;
ï¼Œæˆ–è€…è‡ªå·±æ„å»ºé•œåƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸ºäº†æ”¯æŒ-arm-åšäº†å“ªäº›å·¥ä½œ&#34;&gt;Istio ä¸ºäº†æ”¯æŒ arm åšäº†å“ªäº›å·¥ä½œï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è®© Istio æ”¯æŒ armï¼Œéœ€è¦å°†ä»¥ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…é•œåƒåŸºäº arm æ¶æ„ç¼–è¯‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;istioctl&lt;/code&gt;ï¼šè¿™æ˜¯æœ€ç®€å•çš„éƒ¨åˆ†ï¼Œåªéœ€è¦ä½¿ç”¨ Go è¯­è¨€çš„äº¤å‰ç¼–è¯‘å³å¯ï¼ŒIstio çš„æ—©æœŸç‰ˆæœ¬å°±å·²ç»æ”¯æŒï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pilot&lt;/code&gt;ï¼šæ§åˆ¶å¹³é¢ Istiod ä¸­è¿è¡Œçš„é•œåƒï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;proxyv2&lt;/code&gt;ï¼šåœ¨ Ingress Gatewayã€Egress Gateway å’Œ Sidecar ä¸­ä½¿ç”¨çš„é•œåƒï¼Œé€šè¿‡ Kubernetes &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook&#34; title=&#34;mutating webhook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mutating webhook&lt;/a&gt;
 è‡ªåŠ¨æ³¨å…¥ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio æ•°æ®å¹³é¢ä¸­çš„ Envoy æ˜¯ä» Envoy å®˜æ–¹ä»“åº“ä¸­ fork å‡ºæ¥çš„ï¼Œä½†æ˜¯ Envoy æ—©å°±æ”¯æŒäº† arm64ï¼Œä¸ºä»€ä¹ˆ Istio å®˜æ–¹è¿˜ä¸æ”¯æŒå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸€æ–¹é¢ Istio çš„å®˜æ–¹ CI ç¯å¢ƒ &lt;a href=&#34;https://prow.istio.io/&#34; title=&#34;prow.istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prow.istio.io&lt;/a&gt;
 è¿è¡Œåœ¨ GKE ä¸Šçš„ï¼Œè€Œ GKE ä¸Šå¹¶æ²¡æœ‰ arm64 æ¶æ„çš„ç¯å¢ƒï¼Œæ‰€ä»¥æ— æ³•æ‰§è¡Œæµ‹è¯•ã€‚ç›´åˆ° 2022 å¹´ 7 æœˆ GKE æ‰æ­£å¼æä¾› arm64 æ¶æ„çš„è™šæ‹Ÿæœºï¼Œé‚£æ—¶æ‰å¯ä»¥æ–¹ä¾¿çš„ç¼–è¯‘å’Œæµ‹è¯• arm64 æ¶æ„çš„ Istioï¼Œè¯¦è§ &lt;a href=&#34;https://cloud.google.com/blog/products/containers-kubernetes/gke-supports-new-arm-based-tau-t2a-vms&#34; title=&#34;Run your Arm workloads on Google Kubernetes Engine with Tau T2A VMs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Run your Arm workloads on Google Kubernetes Engine with Tau T2A VMs&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  æ³¨æ„
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  Istio å®˜æ–¹ä»…æä¾›äº† amd64 å’Œ arm64 æ¶æ„çš„é•œåƒï¼Œä¸æ”¯æŒ arm32ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è‡³äº arm æ¶æ„çš„é•œåƒæ„å»ºï¼Œå¯ä»¥ä½¿ç”¨ Docker BuildKit æ¥å®ç°å¤šå¹³å°æ„å»ºï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç¼–è¯‘æŒ‡å®š arm å¹³å°æ¶æ„çš„é•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker buildx build --platform linux/arm64
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äº &lt;code&gt;docker buildx&lt;/code&gt; çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://docs.docker.com/build/buildx/multiplatform-images/&#34; title=&#34;Docker æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åƒå¾€å¸¸ä¸€æ ·æ¥å®‰è£… Istioï¼ŒKubernetes Node ä¼šæ ¹æ®èŠ‚ç‚¹çš„æ¶æ„è‡ªåŠ¨æ‹‰èµ·å¯¹åº”å¹³å°æ¶æ„çš„é•œåƒã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>IstioCon 2022 å›é¡¾åŠå½•åƒã€PPT åˆ†äº«</title>
      <link>https://jimmysong.io/blog/istiocon-2022-recap/</link>
      <pubDate>Wed, 17 Aug 2022 15:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istiocon-2022-recap/</guid>
      <description>
        
        
        &lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡å›é¡¾æ–‡ç« å¯èƒ½æ¥çš„æœ‰ç‚¹æ™šäº†ï¼Œä¹‹å‰åœ¨äº‘åŸç”Ÿç¤¾åŒºä¸­å›½å°±æœ‰å¥½å‡ æ¬¡æœ‰äººé—®æˆ‘ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥åœ¨ B ç«™ä¸Šè§‚çœ‹åˆ° IstioCon 2022 çš„å½•åƒï¼ˆIstioCon ç»„å§”ä¼šæ—©å·²å°†å½•åƒä¸Šä¼ åˆ°äº† YouTubeï¼Œä½†æ˜¯å›½å†…æœ‰äº›äººå¯èƒ½æ— æ³•è®¿é—® YouTubeï¼‰ï¼Œæ­£å¥½æœ€è¿‘æˆ‘è·Ÿä¼šåŠ¡äººå‘˜è¦åˆ°äº†ä¼šè®®å½•åƒï¼Œå°†å…¶å…¨éƒ¨ä¸Šä¼ åˆ°äº† B ç«™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§†é¢‘å›æ”¾ä¸-ppt&#34;&gt;è§†é¢‘å›æ”¾ä¸ PPT&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://space.bilibili.com/1865134855/channel/collectiondetail?sid=641840&#34; title=&#34;B ç«™è§‚çœ‹è§†é¢‘å›æ”¾&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;B ç«™è§‚çœ‹è§†é¢‘å›æ”¾&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://events.istio.io/istiocon-2022/sessions/&#34; title=&#34;IstioCon 2022 Sessions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon 2022 Sessions&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤§éƒ¨åˆ†å†…å®¹å·²ä¸Šä¼ åˆ° B ç«™ï¼Œé™¤äº†ä»¥ä¸‹ä¸‰ä¸ªï¼Œæœ‰äººå·²ç»æå‰ä¸Šä¼ åˆ°äº† B ç«™ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;bilibili.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;æœ‰ä¸‰ä¸ªè§†é¢‘æ’è½¦äº†&#34; width=&#34;60%&#34;data-img=&#34;bilibili.jpg&#34;
         data-caption=&#34;æœ‰ä¸‰ä¸ªè§†é¢‘æ’è½¦äº†&#34;
         
         
         data-width=&#34;1262&#34;
         data-height=&#34;1080&#34;
         
         
    /&gt;&lt;figcaption&gt;
            æœ‰ä¸‰ä¸ªè§†é¢‘æ’è½¦äº†
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;PPT å¯ä»¥ç›´æ¥é€šè¿‡ä¸Šé¢çš„é“¾æ¥é€‰æ‹©ä½ æ„Ÿå…´è¶£çš„è¯é¢˜ä¸‹è½½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;IstioCon 2022 ä»Šå¹´æ˜¯ç¬¬äºŒå±Šäº†ï¼Œäº 4 æœˆ 25 æ—¥åˆ° 29 æ—¥åœ¨çº¿ä¸Šä¸¾è¡Œï¼Œç¬”è€…ä½œä¸º IstioCon çš„ä¸­æ–‡åœºç»„ç»‡è€…ä¹‹ä¸€å‚ä¸äº†æœ¬å±Šæ´»åŠ¨ä¸­æ–‡åœºå¼€åœºåŠåœ†æ¡Œè®¨è®ºç¯èŠ‚ï¼Œæˆ‘ä»¬è®¨è®ºçš„è®®é¢˜æ˜¯ã€ŠIstio çš„å¼€æºç”Ÿæ€å±•æœ›ã€‹ï¼Œä¸‹é¢æ˜¯è®ºå›å˜‰å®¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istiocon-2022-recap/guests.jpg&#34; data-img=&#34;/blog/istiocon-2022-recap/guests.jpg&#34; data-width=&#34;2346&#34; data-height=&#34;658&#34; alt=&#34;image&#34; data-caption=&#34;ä¸­æ–‡åœºå¼€åœºæ¼”è®²ï¼šIstio çš„å¼€æºç”Ÿæ€å±•æœ›è®ºå›å˜‰å®¾&#34;&gt;
    
  
  &lt;figcaption&gt;ä¸­æ–‡åœºå¼€åœºæ¼”è®²ï¼šIstio çš„å¼€æºç”Ÿæ€å±•æœ›è®ºå›å˜‰å®¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ä¸¤å¹´æ¥ï¼Œå›´ç»• Istioï¼Œåœ¨ä¸­å›½æ¶Œç°å‡ºäº†å‡ ä¸ªä»£è¡¨æ€§çš„å¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚è…¾è®¯å¼€æºçš„ Aerakiã€DaoCloud å¼€æºçš„ Merbridge è¿˜æœ‰ç½‘æ˜“å¼€æºçš„ Slime ç­‰ã€‚åŸºäº Istio å¼€å‘çš„æ‰©å±•ï¼Œæˆ‘çœ‹åˆ°çš„åŸºæœ¬éƒ½æ˜¯æ¥è‡ªä¸­å›½ï¼Œè¿™ä¸€ç‚¹å¯ä»¥è¯´æ˜¯ä¸­å›½ç‰¹è‰²ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡ IstioCon çš„å…³é”®è¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›¶ä¿¡ä»»&lt;/li&gt;
&lt;li&gt;å¤šé›†ç¾¤&lt;/li&gt;
&lt;li&gt;Proxyless&lt;/li&gt;
&lt;li&gt;eBPF&lt;/li&gt;
&lt;li&gt;Gateway&lt;/li&gt;
&lt;li&gt;å®‰å…¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŒæ—¶ï¼ŒGoogle Cloud çš„ VP Eric Brewer å®£å¸ƒäº†ä¸€ä¸ªå¤§æ¶ˆæ¯ï¼Œå°† Istio æçŒ®ç»™ CNCFï¼Œä¸€æ—¦æˆåŠŸï¼Œé‚£ä¹ˆç”± Google ä¸»å¯¼çš„ä¸‰ä¸ªå¼€æºé¡¹ç›® Kubernetesã€Istioã€Knative å°†æˆä¸º CNCF ä¸­å®¹å™¨ç¼–æ’ã€æœåŠ¡ç½‘æ ¼ã€Serverless ç­‰ Kubernetes æŠ€æœ¯æ ˆçš„ä¸‰é©¾é©¬è½¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istiocon-2022-recap/k8s-stack.jpg&#34; data-img=&#34;/blog/istiocon-2022-recap/k8s-stack.jpg&#34; data-width=&#34;1918&#34; data-height=&#34;790&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes æŠ€æœ¯æ ˆçš„ä¸‰é©¾é©¬è½¦&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes æŠ€æœ¯æ ˆçš„ä¸‰é©¾é©¬è½¦&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-istio-ä½ åº”è¯¥äº†è§£&#34;&gt;å…³äº Istio ä½ åº”è¯¥äº†è§£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Istio åªé€‚ç”¨äºç‰¹åˆ«åœºæ™¯ä¸è§„æ¨¡&lt;/li&gt;
&lt;li&gt;ä¸ä¼šä¸€å£åƒå‡ºä¸€ä¸ªèƒ–å­ï¼Œè¦ä¸€ä¸ªä¸€ä¸ªç‰ˆæœ¬çš„æ¸è¿›å¼æé«˜&lt;/li&gt;
&lt;li&gt;ç†è§£ Envoy å¯¹äºåº”ç”¨ Istio ç‰¹åˆ«é‡è¦&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·ä¸æƒ³å†å­¦ä¹ å¦ä¸€å¥— CRDï¼Œè¯·è€ƒè™‘åœ¨ Istio ä¹‹ä¸Šå¢åŠ ä¸€å±‚æŠ½è±¡&lt;/li&gt;
&lt;li&gt;ä¸è¦ä½ä¼° Day 2 operation éœ€è¦æ¶ˆè€—çš„ç²¾åŠ›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;istio-åœ¨-2022-å¹´çš„è®¡åˆ’&#34;&gt;Istio åœ¨ 2022 å¹´çš„è®¡åˆ’&lt;/h2&gt;
&lt;p&gt;æœ¬å±Šå¤§ä¼šä¸Šè¿˜å…¬å¸ƒäº† Istio åœ¨ 2022 å¹´çš„å…³æ³¨ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¨³å®šæ€§ä¸é‡æ–°å®šä¹‰-istio-çš„-api-å¹³é¢&#34;&gt;ç¨³å®šæ€§ä¸é‡æ–°å®šä¹‰ Istio çš„ API å¹³é¢&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¨åŠ¨å½“å‰ç‰¹æ€§å’Œ API åˆ°ç¨³å®šç‰ˆ&lt;/li&gt;
&lt;li&gt;å°† API é…ç½®ä» MeshConfig ä¸­ç§»åˆ°æ•°æ®å¹³é¢ä¸­å¹¶ä½¿å…¶ç¨³å®š&lt;/li&gt;
&lt;li&gt;ç»§ç»­å¸®åŠ© Kubernetes API å®šä¹‰ä¸ Istio API å¯¹é½ï¼ˆKubernetes Gateway APIï¼‰&lt;/li&gt;
&lt;li&gt;ç»§ç»­å¢å¼º Telemetry APIï¼šå¢åŠ å¯¹ä½¿ç”¨ OpenTelemetry ç­‰ä¾›åº”å•†çš„æ—¥å¿—è®°å½•çš„æ”¯æŒï¼Œè¿‡æ»¤è®¿é—®æ—¥å¿—ï¼Œä»¥åŠè‡ªå®šä¹‰è·Ÿè¸ªæœåŠ¡åç§°&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¢å¼ºå‡çº§ä¸æ•…éšœæ’æŸ¥&#34;&gt;å¢å¼ºå‡çº§ä¸æ•…éšœæ’æŸ¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¨åŠ¨åŸºäºä¿®è®¢æ ‡ç­¾çš„å‡çº§åˆ°ç¨³å®šç‰ˆ&lt;/li&gt;
&lt;li&gt;å°† Helm å®‰è£…æ¨å¹¿åˆ° Beta ç‰ˆ&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;istioctl&lt;/code&gt; ä¸­æ·»åŠ æ›´å¤šçš„åˆ†æå™¨ï¼Œå¹¶æ‰©å±•å½“å‰çš„åˆ†æå™¨ï¼ŒåŒ…æ‹¬é’ˆå¯¹ Kubernetes é›†ç¾¤ä»¥å¤–ç¯å¢ƒçš„åˆ†æå™¨&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·å¸Œæœ›ç”¨æœåŠ¡ç½‘æ ¼æ¥æ’é™¤æœåŠ¡æ•…éšœï¼Œè€Œä¸æ˜¯å¯¹æœåŠ¡ç½‘æ ¼è¿›è¡Œæ•…éšœæ’é™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¢å¼ºå¯æ‰©å±•æ€§&#34;&gt;å¢å¼ºå¯æ‰©å±•æ€§&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Wasm Plugin&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰æˆæƒ&lt;/li&gt;
&lt;li&gt;å¢åŠ æ ‡å‡†åŒ–é›†æˆç‚¹ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ CA æˆ–ç½‘å…³&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ‰©å±•-istio-çš„ä½¿ç”¨åœºæ™¯&#34;&gt;æ‰©å±• Istio çš„ä½¿ç”¨åœºæ™¯&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ IPv6 å’ŒåŒæ ˆç½‘ç»œï¼ˆDual Stack Networkingï¼‰&lt;/li&gt;
&lt;li&gt;æ”¯æŒ ARM&lt;/li&gt;
&lt;li&gt;æ‰©å±•ä½¿ç”¨ gRPC çš„ proxyless Istio&lt;/li&gt;
&lt;li&gt;æ€§èƒ½å¢å¼ºï¼šå¢é‡ xDSã€é™ä½ sidecar å»¶è¿Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  ä»€ä¹ˆæ˜¯åŒæ ˆç½‘ç»œï¼Ÿ
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  åŒåè®®æ ˆæŠ€æœ¯å°±æ˜¯æŒ‡åœ¨ä¸€å°è®¾å¤‡ä¸ŠåŒæ—¶å¯ç”¨ IPv4 åè®®æ ˆå’Œ IPv6 åè®®æ ˆã€‚è¿™æ ·çš„è¯ï¼Œè¿™å°è®¾å¤‡æ—¢èƒ½å’Œ IPv4 ç½‘ç»œé€šä¿¡ï¼Œåˆèƒ½å’Œ IPv6 ç½‘ç»œé€šä¿¡ã€‚å¦‚æœè¿™å°è®¾å¤‡æ˜¯ä¸€ä¸ªè·¯ç”±å™¨ï¼Œé‚£ä¹ˆè¿™å°è·¯ç”±å™¨çš„ä¸åŒæ¥å£ä¸Šï¼Œåˆ†åˆ«é…ç½®äº† IPv4 åœ°å€å’Œ IPv6 åœ°å€ï¼Œå¹¶å¾ˆå¯èƒ½åˆ†åˆ«è¿æ¥äº† IPv4 ç½‘ç»œå’Œ IPv6 ç½‘ç»œã€‚Kubernetes ä¸­æ”¯æŒ IPv4/IPv6 åŒåè®®æ ˆï¼Œè¯¦è§ &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/services-networking/dual-stack/&#34; title=&#34;Kubernetes æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æ–‡æ¡£&lt;/a&gt;
ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;å®‰å…¨åŠ å›º&#34;&gt;å®‰å…¨åŠ å›º&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤å°½å¯èƒ½å®‰å…¨&lt;/li&gt;
&lt;li&gt;ç»§ç»­å®Œå–„å®‰å…¨æœ€ä½³å®è·µæ–‡æ¡£&lt;/li&gt;
&lt;li&gt;æ¨åŠ¨ distroless é•œåƒ&lt;/li&gt;
&lt;li&gt;è½¯ä»¶ BOMï¼ˆBill of Materialsï¼Œä¾èµ–æœåŠ¡æ¸…å•ï¼‰&lt;/li&gt;
&lt;li&gt;å¢åŠ æ ¼å¤–çš„æ¨¡ç³Šæµ‹è¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å…¶ä»–å¢å¼º&#34;&gt;å…¶ä»–å¢å¼º&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨è‡ªåŠ¨åŒ–ä½¿å‡çº§æ›´å®¹æ˜“ï¼šè®© Istio çš„å‡çº§åƒå…¶ä»–å‡çº§ä¸€æ ·å·¥ä½œï¼Œå‘å¸ƒå‡çº§è‡ªåŠ¨åŒ–çš„å‚è€ƒå®ç°&lt;/li&gt;
&lt;li&gt;å¤šè§„æ¨¡å’Œå¤§è§„æ¨¡é›†ç¾¤&lt;/li&gt;
&lt;li&gt;å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬å·²ç»å°†æ¯å‘¨çš„å·¥ä½œå°ç»„ä¼šè®®åˆå¹¶åˆ°ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬å·²ç»å°†æ¯å‘¨çš„å·¥ä½œç»„ä¼šè®®åˆå¹¶ï¼Œä¸€ä¸ªåœ¨ç¾å›½ï¼Œä¸€ä¸ªåœ¨äºšå¤ªåœ°åŒºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†™åœ¨æœ€å&#34;&gt;å†™åœ¨æœ€å&lt;/h2&gt;
&lt;p&gt;å¸Œæœ› Istio æ­£å¼è¿›å…¥ CNCF çš„é‚£å¤©æ—©æ—¥åˆ°æ¥ï¼Œæˆ‘ä¹Ÿå¸Œæœ›èƒ½å¤Ÿåœ¨ç¤¾åŒºé‡Œçœ‹åˆ°æ›´å¤šæºäº Istio çš„ç»ˆç«¯æ¡ˆä¾‹åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶&lt;a href=&#34;https://cloudnative.to/community/join/&#34; title=&#34;åŠ å…¥åˆ°äº‘åŸç”Ÿç¤¾åŒº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥åˆ°äº‘åŸç”Ÿç¤¾åŒº&lt;/a&gt;
ä¸­æ¥ï¼Œæˆ‘ä»¬æœ‰ä¸“é—¨çš„ Istio è®¨è®ºç¾¤ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Beyond Istio OSS â€”â€” Istio æœåŠ¡ç½‘æ ¼çš„ç°çŠ¶ä¸æœªæ¥</title>
      <link>https://jimmysong.io/blog/beyond-istio-oss/</link>
      <pubDate>Sat, 23 Jul 2022 15:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/beyond-istio-oss/</guid>
      <description>
        
        
        &lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äºæœ¬æ–‡
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  æœ¬æ–‡æ ¹æ®ç¬”è€…åœ¨ GIAC æ·±åœ³ 2022 å¹´å¤§ä¼šä¸Šçš„çš„æ¼”è®²&lt;a href=&#34;https://giac.msup.com.cn/2022sz/course?id=16093&#34; title=&#34;ã€ŠBeyond Istio OSS â€”â€” Istio çš„ç°çŠ¶åŠæœªæ¥ã€‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€ŠBeyond Istio OSS â€”â€” Istio çš„ç°çŠ¶åŠæœªæ¥ã€‹&lt;/a&gt;
æ•´ç†è€Œæˆï¼Œæ¼”è®²å¹»ç¯ç‰‡è§ &lt;a href=&#34;https://docs.qq.com/pdf/DRWxETHNDZmRsS0l5&#34; title=&#34;è…¾è®¯æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è…¾è®¯æ–‡æ¡£&lt;/a&gt;
ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;æœ¬æ–‡å›é¡¾äº† Istio å¼€æºè¿‘äº”å¹´æ¥çš„å‘å±•ï¼Œå¹¶å±•æœ›äº† Istio æœåŠ¡ç½‘æ ¼çš„æœªæ¥æ–¹å‘ã€‚æœ¬æ–‡çš„ä¸»è¦è§‚ç‚¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸º Kubernetesã€å¾®æœåŠ¡ã€DevOps åŠäº‘åŸç”Ÿæ¶æ„çš„æµè¡Œï¼Œå¯¼è‡´æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„å…´èµ·ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes å’Œå¯ç¼–ç¨‹ä»£ç†ï¼Œä¸º Istio çš„å‡ºç°æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼›&lt;/li&gt;
&lt;li&gt;è™½ç„¶ eBPF å¯ä»¥åŠ é€Ÿ Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒï¼Œä½†æ— æ³•å–ä»£æœåŠ¡ç½‘æ ¼ä¸­çš„ sidecarï¼›&lt;/li&gt;
&lt;li&gt;Istio çš„æœªæ¥åœ¨äºæ„å»ºåŸºäºæ··åˆäº‘çš„é›¶ä¿¡ä»»ç½‘ç»œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;the-dawn-of-istio&#34;&gt;Istio è¯ç”Ÿçš„å‰å¤œ&lt;/h2&gt;
&lt;p&gt;2013 å¹´èµ·ï¼Œéšç€ç§»åŠ¨äº’è”ç½‘çš„çˆ†å‘ï¼Œä¼ä¸šå¯¹åº”ç”¨è¿­ä»£çš„æ•ˆç‡è¦æ±‚æ›´é«˜ï¼Œåº”ç”¨ç¨‹åºæ¶æ„å¼€å§‹ä»å•ä½“è½¬å‘å¾®æœåŠ¡ï¼ŒDevOps ä¹Ÿå¼€å§‹å˜å¾—æµè¡Œã€‚åŒå¹´éšç€ Docker çš„å¼€æºï¼Œè§£å†³äº†åº”ç”¨å°è£…å’Œéš”ç¦»çš„é—®é¢˜ï¼Œä½¿å¾—åº”ç”¨åœ¨ç¼–æ’ç³»ç»Ÿä¸­è°ƒåº¦å˜å¾—æ›´å®¹æ˜“ã€‚2014 å¹´ Kubernetesã€Spring Boot å¼€æºï¼ŒSpring æ¡†æ¶å¼€å‘å¾®æœåŠ¡åº”ç”¨å¼€å§‹æµè¡Œï¼Œåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é—´å¤§æ‰¹çš„ RPC ä¸­é—´ä»¶å¼€æºé¡¹ç›®å‡ºç°ï¼Œå¦‚ Google åœ¨ 2016 å¹´å‘å¸ƒ gRPC 1.0ï¼Œèš‚èšåœ¨ 2018 å¹´å¼€æº &lt;a href=&#34;https://www.sofastack.tech/&#34; title=&#34;SOFAStack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOFAStack&lt;/a&gt;
 ç­‰ï¼Œå¾®æœåŠ¡æ¡†æ¶ç™¾èŠ±é½æ”¾ã€‚ä¸ºäº†èŠ‚çº¦æˆæœ¬ï¼Œå¢åŠ å¼€å‘æ•ˆç‡ï¼Œä½¿åº”ç”¨æ›´å…·å¼¹æ€§ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šæ­£åœ¨è¿ç§»ä¸Šäº‘ï¼Œä½†è¿™ä¸ä»…ä»…æ˜¯å°†åº”ç”¨æ¬åˆ°äº‘ä¸Šé‚£ä¹ˆç®€å•ï¼Œä¸ºäº†æ›´é«˜æ•ˆåœ°åˆ©ç”¨äº‘è®¡ç®—ï¼Œä¸€å¥—ã€Œäº‘åŸç”Ÿã€æ–¹æ³•å’Œç†å¿µä¹Ÿå‘¼ä¹‹æ¬²å‡ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-open-time-line&#34;&gt;Istio å¼€æºæ—¶é—´çº¿&lt;/h2&gt;
&lt;p&gt;Istio å¼€æºå‘å±•æ—¶é—´çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istio-history.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istio-history.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio å¼€æºå‘å±•æ—¶é—´çº¿ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio å¼€æºå‘å±•æ—¶é—´çº¿ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•å›é¡¾ä¸‹ Istio å¼€æºå¤§äº‹ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2016 å¹´ 9 æœˆï¼šå› ä¸º Envoy æ˜¯ Istio ä¸­çš„é‡è¦ç»„æˆï¼ŒIstio çš„å¼€æºæ—¶é—´çº¿åº”è¯¥æœ‰ Envoy ä¸€éƒ¨åˆ†ã€‚èµ·åˆ Envoy åœ¨ Lyft å†…éƒ¨ä»…ä½œä¸ºè¾¹ç¼˜ä»£ç†ï¼Œå¼€æºå‰å·²åœ¨ Lyft å†…éƒ¨å¾—åˆ°å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯å¹¶å—åˆ°äº† Google å·¥ç¨‹å¸ˆçš„æ³¨æ„ &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œé‚£æ—¶å€™ Google æ­£æ‰“ç®—æ¨å‡ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼çš„å¼€æºé¡¹ç›®ã€‚2017 å¹´ï¼ŒLyft å°† Envoy æçŒ®ç»™äº† &lt;a href=&#34;https://cncf.io&#34; title=&#34;CNCF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF&lt;/a&gt;
ã€‚&lt;/li&gt;
&lt;li&gt;2017 å¹´ 5 æœˆï¼šIstio ç”± Googleã€IBM å’Œ Lyft è”åˆå®£å¸ƒå¼€æº &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚ä¸€å¼€å§‹å°±ä½¿ç”¨äº†å¾®æœåŠ¡æ¶æ„ï¼Œç¡®å®šäº†æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„ç»„æˆä»¥åŠ Sidecar æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;2018 å¹´ 3 æœˆï¼šKubernetes é¡ºåˆ©çš„æˆä¸ºä» CNCF ä¸­ç¬¬ä¸€ä¸ªæ¯•ä¸šçš„é¡¹ç›®ï¼Œå˜å¾—è¶Šæ¥è¶Šã€Œæ— èŠã€ï¼ŒåŸºç¡€ API å·²ç»å®šå‹ï¼ŒCNCF æ­£å¼å°†æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰å†™å…¥åˆ°äº†äº‘åŸç”Ÿçš„ç¬¬äºŒç‰ˆå®šä¹‰ &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; ä¸­ã€‚ç¬”è€…å½“å‰å°±èŒçš„å…¬å¸ &lt;a href=&#34;https://tetrate.io&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;
ï¼Œä¹Ÿæ˜¯åœ¨é‚£æ—¶ç”± Google Istio åˆåˆ›å›¢é˜Ÿåˆ›ä¸šæˆç«‹çš„ã€‚æœåŠ¡ç½‘æ ¼åœ¨ä¸­å›½å¼€å§‹çˆ†å‘ï¼ŒServiceMesher ç¤¾åŒºä¹Ÿåœ¨èš‚èšé›†å›¢çš„æ”¯æŒä¸‹æˆç«‹ï¼Œåœ¨ä¸­å›½å¸ƒé“æœåŠ¡ç½‘æ ¼æŠ€æœ¯ã€‚&lt;/li&gt;
&lt;li&gt;2018 å¹´ 7 æœˆï¼šIstio 1.0 å‘å¸ƒï¼Œå·ç§°ã€Œç”Ÿäº§å¯ç”¨ã€ï¼ŒIstio å›¢é˜Ÿé‡ç»„ã€‚&lt;/li&gt;
&lt;li&gt;2020 å¹´ 3 æœˆï¼šIstio 1.5 å‘å¸ƒï¼Œæ¶æ„å›å½’å•ä½“ï¼Œå‘å¸ƒå‘¨æœŸç¡®å®šï¼Œæ¯ä¸‰ä¸ªæœˆå‘å¸ƒä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼ŒAPI è¶‹äºç¨³å®šã€‚&lt;/li&gt;
&lt;li&gt;2020 å¹´è‡³ä»Šï¼šIstio çš„å‘å±•ä¸»è¦ç€é‡äº Day 2 Operation &lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€æ€§èƒ½ä¼˜åŒ–å’Œæ‰©å±•æ€§å‘é¢ï¼Œå¤šä¸ªå›´ç»• Istio ç”Ÿæ€çš„å¼€æºé¡¹ç›®å¼€å§‹å‡ºç°ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://github.com/slime-io/slime/&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/aeraki-mesh/aeraki&#34; title=&#34;Areaki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Areaki&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/merbridge/merbridge&#34; title=&#34;Merbridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge&lt;/a&gt;
ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;why-istio-born-after-kubernetes&#34;&gt;ä¸ºä»€ä¹ˆ Istio ä¼šåœ¨ Kubernetes ä¹‹åå‡ºç°ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¾®æœåŠ¡å’Œå®¹å™¨åŒ–ä¹‹åï¼Œå¼‚æ„è¯­è¨€ä½¿ç”¨çš„å¢åŠ ï¼ŒæœåŠ¡çš„æ•°é‡æ¿€å¢ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå˜çŸ­æ˜¯å¯¼è‡´æœåŠ¡ç½‘æ ¼å‡ºç°çš„æ ¹æœ¬åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœåŠ¡ä»éƒ¨ç½²åœ¨ Kubernetes åˆ° Istio ä¸­æ¶æ„çš„å˜è¿ï¼Œç„¶åå†æ¢è®¨æ¶æ„æ¼”è¿›è¿‡ç¨‹ä¸­ Istio çš„éœ€æ±‚ï¼Œä¸‹æ–‡å‡å®šè¯»è€…å·²äº†è§£ &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/architecture/&#34; title=&#34;Kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt;
 å’Œ &lt;a href=&#34;https://istio.io/latest/zh/docs/ops/deployment/architecture/&#34; title=&#34;Istio çš„æ¶æ„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio çš„æ¶æ„&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/kubernetes-to-istio.svg&#34; data-img=&#34;/blog/beyond-istio-oss/kubernetes-to-istio.svg&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes åˆ° Istio çš„æ¶æ„æ”¹å˜ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes åˆ° Istio çš„æ¶æ„æ”¹å˜ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä» Kubernetes åˆ° Istioï¼Œæ¦‚æ‹¬çš„è®²åº”ç”¨çš„éƒ¨ç½²æ¶æ„æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†ï¼ˆæ‰©ç¼©å®¹ã€è‡ªåŠ¨æ¢å¤ã€å‘å¸ƒç­–ç•¥ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäº Kubernetes çš„è‡ªåŠ¨ sidecar æ³¨å…¥ï¼Œå®ç°äº†é€æ˜æµé‡æ‹¦æˆªã€‚å…ˆé€šè¿‡ sidecar ä»£ç†æ‹¦æˆªåˆ°å¾®æœåŠ¡é—´æµé‡ï¼Œå†é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ç®¡ç†å¾®æœåŠ¡çš„è¡Œä¸ºã€‚å¦‚ä»ŠæœåŠ¡ç½‘æ ¼çš„éƒ¨ç½²æ¨¡å¼ä¹Ÿè¿æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼Œsidecar å·²ç»ä¸æ˜¯ Istio æœåŠ¡ç½‘æ ¼æ‰€å¿…é¡»çš„ï¼ŒåŸºäº gRPC çš„æ— ä»£ç†çš„æœåŠ¡ç½‘æ ¼ &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt; ä¹Ÿåœ¨æµ‹è¯•ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å°†æµé‡ç®¡ç†ä» Kubernetes ä¸­è§£è€¦ï¼ŒæœåŠ¡ç½‘æ ¼å†…éƒ¨çš„æµé‡æ— é¡» &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶çš„æ”¯æŒï¼Œé€šè¿‡ç±»ä¼¼äºå¾®æœåŠ¡åº”ç”¨å±‚çš„æŠ½è±¡ï¼Œç®¡ç†æœåŠ¡é—´çš„æµé‡ï¼Œå®ç°å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢é€šè¿‡ xDS åè®®å‘æ”¾ä»£ç†é…ç½®ç»™æ•°æ®å¹³é¢ï¼Œå·²å®ç° xDS çš„ä»£ç†æœ‰ &lt;a href=&#34;https://envoyproxy.io&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
 å’Œèš‚èšå¼€æºçš„ &lt;a href=&#34;https://mosn.io&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡æ—¶ï¼ŒåŸå…ˆæ˜¯é€šè¿‡ Kubernetes &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/concepts/ingress/&#34; title=&#34;Ingress&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress&lt;/a&gt;
ï¼Œåœ¨æœ‰äº† Istio ä¹‹åï¼Œä¼šé€šè¿‡ Gateway æ¥è®¿é—® &lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Kubernetes å®¹å™¨ç¼–æ’ä¸å¯ç¼–ç¨‹ä»£ç† Envoy ä¸º Istio çš„å‡ºç°æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ä¸Šé¢ Kubernetes åˆ° Istio çš„æ¶æ„çš„è½¬å˜çš„æè¿°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸ºäº†è®©å¼€å‘è€…æœ€å°æˆæœ¬åœ°ç®¡ç†æœåŠ¡é—´çš„æµé‡ï¼ŒIstio éœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é€æ˜åŠ«æŒåº”ç”¨é—´çš„æµé‡&lt;/strong&gt;ï¼šIstio å¼€æºæœ€åˆçš„ç›®æ ‡æ˜¯æˆä¸ºç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œå°±åƒæ°´å’Œç”µäººç±»çš„åŸºç¡€è®¾æ–½ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨æ°´ç”µä¸éœ€è¦å…³å¿ƒå¦‚ä½•å–æ°´å’Œå‘ç”µï¼Œåªéœ€è¦æ‰“å¼€æ°´é¾™å¤´ï¼ŒæŒ‰ä¸‹å¼€å…³å³å¯ã€‚é€æ˜æµé‡åŠ«æŒå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå°±åƒä½¿ç”¨æ°´å’Œç”µï¼Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºå°±å¯ä»¥å¿«é€Ÿä½¿ç”¨ Istio å¸¦æ¥çš„æµé‡ç®¡ç†èƒ½åŠ›ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†é›†ç¾¤çš„è¿ç»´&lt;/strong&gt;ï¼šå¦‚ä½•ä¸ºæ¯ä¸ªåº”ç”¨æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼ŒåŒæ—¶é«˜æ•ˆåœ°ç®¡ç†è¿™äº›åˆ†å¸ƒå¼çš„ sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç¼–ç¨‹ä»£ç†&lt;/strong&gt;ï¼šä»£ç†å¯ä»¥é€šè¿‡ API åŠ¨æ€é…ç½®ï¼Œè¿˜è¦æœ‰å‡ºè‰²çš„æ€§èƒ½ä¸å¯æ‰©å±•æ€§ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶å¯¹äº Istio æœåŠ¡ç½‘æ ¼æ¥è¯´ç¼ºä¸€ä¸å¯ï¼Œè€Œä¸”ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›è¦æ±‚åŸºæœ¬éƒ½æ˜¯å¯¹äº sidecar ä»£ç†çš„è¦æ±‚ï¼Œè¿™ä¸ªä»£ç†çš„é€‰æ‹©å°†ç›´æ¥å½±å“è¯¥é¡¹ç›®çš„èµ°å‘ä¸æˆè´¥ã€‚ä¸ºäº†è§£å†³ä»¥ä¸Šä¸‰ä¸ªé—®é¢˜ï¼ŒIstio é€‰æ‹©äº† Kubernetes å®¹å™¨ç¼–æ’å’Œå¯ç¼–ç¨‹ä»£ç† Envoyã€‚&lt;/p&gt;
&lt;h3 id=&#34;traffic-intercept&#34;&gt;é€æ˜æµé‡åŠ«æŒ&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¦‚ gRPC è¿™ç±»ä¸­é—´ä»¶å¼€å‘å¾®æœåŠ¡ï¼Œåœ¨ç¨‹åºä¸­é›†æˆ SDK åï¼ŒSDK ä¸­çš„æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨ä¸ºä½ æ‹¦æˆªæµé‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/grpc.svg&#34; data-img=&#34;/blog/beyond-istio-oss/grpc.svg&#34; alt=&#34;image&#34; data-caption=&#34;gRPC çš„æ‹¦æˆªå™¨ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;gRPC çš„æ‹¦æˆªå™¨ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚ä½•è®© Kubernetes  pod ä¸­çš„æµé‡éƒ½é€šè¿‡ä»£ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åº pod ä¸­æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼Œä¸åº”ç”¨å…±äº«ç½‘ç»œç©ºé—´ï¼Œå†é€šè¿‡ä¿®æ”¹ pod å†…çš„æµé‡è·¯å¾„ï¼Œè®©æ‰€æœ‰è¿›å‡º pod çš„æµé‡éƒ½ç»è¿‡ sidecarï¼Œå…¶æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istio-route-iptables.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istio-route-iptables.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸€å¥—éå¸¸å¤æ‚çš„ iptables æµé‡åŠ«æŒé€»è¾‘ï¼ˆè¯¦è§ &lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; title=&#34;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&#34;&gt;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&lt;/a&gt;
ï¼‰ï¼Œä½¿ç”¨ iptables çš„å¥½å¤„æ˜¯é€‚ç”¨äºä»»ä½• Linux æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯è¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›å‰¯ä½œç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Istio ç½‘æ ¼ä¸­æ‰€æœ‰çš„æœåŠ¡éƒ½éœ€è¦åœ¨è¿›å‡º pod æ—¶éƒ½å¢åŠ äº†ä¸€ä¸ªç½‘ç»œè·³è·ƒç‚¹ï¼ˆhopï¼‰ï¼Œè™½ç„¶æ¯æ¬¡ hop å¯èƒ½åªæœ‰ä¸¤ä¸‰æ¯«ç§’ï¼Œä½†æ˜¯éšç€ç½‘æ ¼ä¸­æœåŠ¡å’ŒæœåŠ¡é—´çš„ä¾èµ–å¢åŠ ï¼Œè¿™ç§å»¶è¿Ÿå¯èƒ½ä¼šæ˜¾è‘—å¢åŠ ï¼Œå¯¹äºé‚£ç§è¿½æ±‚ä½å»¶è¿Ÿçš„æœåŠ¡å¯èƒ½å°±ä¸é€‚ç”¨äºæœåŠ¡ç½‘æ ¼äº†ï¼›&lt;/li&gt;
&lt;li&gt;å› ä¸º Istio å‘æ•°æ®å¹³é¢ä¸­æ³¨å…¥äº†å¤§é‡çš„ sidecarï¼Œå°¤å…¶æ˜¯å½“æœåŠ¡æ•°é‡å¢å¤§æ—¶ï¼Œæ§åˆ¶å¹³é¢éœ€è¦ä¸‹å‘æ›´å¤šçš„ Envoy ä»£ç†é…ç½®åˆ°æ•°æ®å¹³é¢ï¼Œè¿™æ ·ä¼šä½¿æ•°æ®å¹³é¢å ç”¨å¤§é‡çš„ç³»ç»Ÿå†…å­˜å’Œç½‘ç»œèµ„æºï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¼˜åŒ–æœåŠ¡ç½‘æ ¼å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ proxyless æ¨¡å¼ï¼šå–æ¶ˆ sidecar ä»£ç†ï¼Œé‡æ–°å›åˆ° SDKï¼›&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ•°æ®å¹³é¢ï¼šå‡å°‘ä¸‹å‘åˆ°æ•°æ®å¹³é¢çš„é…ç½®çš„é¢‘ç‡å’Œå¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;eBPFï¼šä½¿ç”¨ eBPF ä¼˜åŒ–ç½‘ç»œåŠ«æŒï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡å°†åœ¨åé¢&lt;a href=&#34;#performance-optimizing&#34; title=&#34;æ€§èƒ½ä¼˜åŒ–&#34;&gt;æ€§èƒ½ä¼˜åŒ–&lt;/a&gt;
ä¸€èŠ‚è®²è§£è¿™äº›ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sidecar-management&#34;&gt;Sidecar è¿ç»´ç®¡ç†&lt;/h3&gt;
&lt;p&gt;Istio æ˜¯åœ¨ Kubernetes çš„åŸºç¡€ä¸Šæ„å»ºçš„ï¼Œå®ƒå¯ä»¥åˆ©ç”¨ Kubernetes çš„å®¹å™¨ç¼–æ’å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œåœ¨ Kubernetes åˆ›å»º pod æ—¶ï¼Œé€šè¿‡å‡†å…¥æ§åˆ¶å™¨è‡ªåŠ¨å‘ pod ä¸­æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³ Sidecar çš„èµ„æºæ¶ˆè€—é—®é¢˜ï¼Œæœ‰äººä¸ºæœåŠ¡ç½‘æ ¼æå‡ºäº†æœ‰å››ç§éƒ¨ç½²æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/deployment-model.svg&#34; data-img=&#34;/blog/beyond-istio-oss/deployment-model.svg&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡ç½‘æ ¼çš„å››ç§éƒ¨ç½²æ¨¡å¼ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;æœåŠ¡ç½‘æ ¼çš„å››ç§éƒ¨ç½²æ¨¡å¼ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹è¡¨ä¸­è¯¦ç»†å¯¹æ¯”äº†è¿™å››ç§éƒ¨ç½²æ–¹å¼ï¼Œå®ƒä»¬å„æœ‰ä¼˜åŠ£ï¼Œå…·ä½“é€‰æ‹©å“ªç§æ ¹æ®å®é™…æƒ…å†µè€Œå®šã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;å†…å­˜å¼€é”€&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;æ•…éšœåŸŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;è¿ç»´&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;Sidecar ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å› ä¸ºä¸ºæ¯ä¸ª pod éƒ½æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼Œæ‰€ä»¥å¼€é”€æœ€å¤§ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç”±äº sidecar å¿…é¡»ä¸å·¥ä½œè´Ÿè½½ä¸€èµ·éƒ¨ç½²ï¼Œå·¥ä½œè´Ÿè½½æœ‰å¯èƒ½ç»•è¿‡ sidecarã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Pod çº§åˆ«éš”ç¦»ï¼Œå¦‚æœæœ‰ä»£ç†å‡ºç°æ•…éšœï¼Œåªå½±å“åˆ° Pod ä¸­çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯ä»¥å•ç‹¬å‡çº§æŸä¸ªå·¥ä½œè´Ÿè½½çš„ sidecar è€Œä¸å½±å“å…¶ä»–å·¥ä½œè´Ÿè½½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;èŠ‚ç‚¹å…±äº«ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªä»£ç†ï¼Œä¸ºè¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å·¥ä½œè´Ÿè½½æ‰€å…±äº«ï¼Œå¼€é”€å°ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯¹åŠ å¯†å†…å®¹å’Œç§é’¥çš„ç®¡ç†å­˜åœ¨å®‰å…¨éšæ‚£ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;èŠ‚ç‚¹çº§åˆ«éš”ç¦»ï¼Œå¦‚æœå…±äº«ä»£ç†å‡çº§æ—¶å‡ºç°ç‰ˆæœ¬å†²çªã€é…ç½®å†²çªæˆ–æ‰©å±•ä¸å…¼å®¹ç­‰é—®é¢˜ï¼Œåˆ™å¯èƒ½ä¼šå½±å“è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å·¥ä½œè´Ÿè½½ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¸éœ€è¦è€ƒè™‘æ³¨å…¥ Sidecar çš„é—®é¢˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;Service Account / èŠ‚ç‚¹å…±äº«ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœåŠ¡è´¦æˆ· / èº«ä»½ä¸‹çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½éƒ½ä½¿ç”¨å…±äº«ä»£ç†ï¼Œå¼€é”€å°ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å·¥ä½œè´Ÿè½½å’Œä»£ç†ä¹‹é—´çš„è¿æ¥çš„è®¤è¯åŠå®‰å…¨æ€§æ— æ³•ä¿éšœã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;èŠ‚ç‚¹å’ŒæœåŠ¡è´¦å·ä¹‹é—´çº§åˆ«éš”ç¦»ï¼Œæ•…éšœåŒâ€œèŠ‚ç‚¹å…±äº«ä»£ç†â€ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;åŒâ€œèŠ‚ç‚¹å…±äº«ä»£ç†â€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;å¸¦æœ‰å¾®ä»£ç†çš„å…±äº«è¿œç¨‹ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å› ä¸ºä¸ºæ¯ä¸ª pod éƒ½æ³¨å…¥ä¸€ä¸ªå¾®ä»£ç†ï¼Œå¼€é”€æ¯”è¾ƒå¤§ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¾®ä»£ç†ä¸“é—¨å¤„ç† mTLSï¼Œä¸è´Ÿè´£ L7 è·¯ç”±ï¼Œå¯ä»¥ä¿éšœå®‰å…¨æ€§ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å½“éœ€è¦åº”ç”¨ 7 å±‚ç­–ç•¥æ—¶ï¼Œå·¥ä½œè´Ÿè½½å®ä¾‹çš„æµé‡ä¼šè¢«é‡å®šå‘åˆ° L7 ä»£ç†ä¸Šï¼Œè‹¥ä¸éœ€è¦ï¼Œåˆ™å¯ä»¥ç›´æ¥ç»•è¿‡ã€‚è¯¥ L7 ä»£ç†å¯ä»¥é‡‡ç”¨å…±äº«èŠ‚ç‚¹ä»£ç†ã€æ¯ä¸ªæœåŠ¡è´¦æˆ·ä»£ç†ï¼Œæˆ–è€…è¿œç¨‹ä»£ç†çš„æ–¹å¼è¿è¡Œã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;åŒâ€œSidecar ä»£ç†â€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;figcaption class=&#34;text-center&#34;&gt;
    æœåŠ¡ç½‘æ ¼çš„å››ç§éƒ¨ç½²æ¨¡å¼å¯¹æ¯”
&lt;/figcaption&gt;

&lt;h3 id=&#34;programmable-proxy&#34;&gt;å¯ç¼–ç¨‹ä»£ç†&lt;/h3&gt;
&lt;p&gt;Flomesh çš„å¼ æ™“è¾‰æ›¾åœ¨ &lt;a href=&#34;https://cloudnative.to/blog/what-and-why-programmable-proxy/&#34; title=&#34;ä¸ºä»€ä¹ˆéœ€è¦å¯ç¼–ç¨‹ä»£ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦å¯ç¼–ç¨‹ä»£ç†&lt;/a&gt;
 åšå®¢ä¸­è¯¦ç»†è¯´æ˜äº†ä»£ç†è½¯ä»¶çš„å‘å±•æ¼”åŒ–è¿‡ç¨‹ï¼Œæˆ‘ä¸‹é¢å°†å¼•ç”¨ä»–çš„ä¸€äº›è§‚ç‚¹ï¼Œè¯´æ˜å¯ç¼–ç¨‹ä»£ç† Envoy åœ¨ Istio ä¸­çš„å…³é”®ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†ä»£ç†ä»é…ç½®åˆ°å¯ç¼–ç¨‹æ¨¡å¼çš„æ¼”åŒ–è¿‡ç¨‹ï¼ŒåŠæ¯ä¸ªé˜¶æ®µä¸­çš„ä»£è¡¨æ€§ä»£ç†è½¯ä»¶ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;proxy-evolution.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;ä»£ç†è½¯ä»¶çš„æ¼”åŒ–ç¤ºæ„å›¾&#34; width=&#34;70%&amp;#34;&#34;data-img=&#34;proxy-evolution.svg&#34;
         data-caption=&#34;ä»£ç†è½¯ä»¶çš„æ¼”åŒ–ç¤ºæ„å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            ä»£ç†è½¯ä»¶çš„æ¼”åŒ–ç¤ºæ„å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æ•´ä¸ªä»£ç†æ¼”åŒ–è¿‡ç¨‹éƒ½æ˜¯éšç€åº”ç”¨ä»æœ¬åœ°å’Œå•ä½“ï¼Œè¶Šæ¥è¶Šèµ°å‘å¤§è§„æ¨¡å’Œåˆ†å¸ƒå¼ã€‚ä¸‹é¢æˆ‘å°†ç®€è¦æ¦‚æ‹¬ä»£ç†è½¯ä»¶çš„å‘å±•è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶æ—¶ä»£&lt;/strong&gt;ï¼šå‡ ä¹æ‰€æœ‰è½¯ä»¶éƒ½æœ‰é…ç½®æ–‡ä»¶ï¼Œä»£ç†è½¯ä»¶å› ä¸ºå…¶ç›¸å¯¹å¤æ‚çš„åŠŸèƒ½ï¼Œæ›´ç¦»ä¸å¼€é…ç½®æ–‡ä»¶ã€‚è¯¥é˜¶æ®µçš„ä»£ç†ä¸»è¦ä½¿ç”¨ C è¯­è¨€å¼€å‘ï¼ŒåŒ…æ‹¬å…¶æ‰©å±•æ¨¡å—ï¼Œçªå‡ºçš„ä»£ç†æœ¬èº«çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨ä»£ç†æœ€åŸå§‹æœ€åŸºç¡€çš„å½¢å¼ï¼Œè¿™äº›ä»£ç†åŒ…æ‹¬ Nginxã€Apache HTTP Serverã€&lt;a href=&#34;http://www.squid-cache.org/&#34; title=&#34;Squid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Squid&lt;/a&gt;
 ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®è¯­è¨€æ—¶ä»£&lt;/strong&gt;ï¼šè¿™ä¸ªæ—¶ä»£çš„ä»£ç†ï¼Œæ›´å…·æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œæ¯”å¦‚åŠ¨æ€æ•°æ®è·å–å’Œé…å¥—çš„é€»è¾‘åˆ¤æ–­ã€‚ä»£è¡¨æ€§ä»£ç†åŒ…æ‹¬æ‰© &lt;a href=&#34;https://varnish-cache.org/&#34; title=&#34;Varnish&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Varnish&lt;/a&gt;
 å’Œ HAProxyï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è„šæœ¬è¯­è¨€æ—¶ä»£&lt;/strong&gt;ï¼šä»è„šæœ¬è¯­è¨€çš„å¼•å…¥å¼€å§‹ï¼Œä»£ç†è½¯ä»¶æ‰çœŸæ­£èµ°å‘çš„å¯ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨è„šæœ¬åœ¨ä»£ç†ä¸­å¢åŠ åŠ¨æ€é€»è¾‘ï¼Œå¢åŠ äº†å¼€å‘æ•ˆç‡ã€‚ä»£è¡¨æ€§çš„ä»£ç†æ˜¯ Nginx åŠå…¶æ”¯æŒçš„è„šæœ¬è¯­è¨€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤æ—¶ä»£&lt;/strong&gt;ï¼šéšç€äº‘è®¡ç®—çš„æ™®åŠï¼Œå¤§è§„æ¨¡éƒ¨ç½²å’ŒåŠ¨æ€é…ç½® API æˆäº†ä»£ç†æ‰€å¿…éœ€çš„èƒ½åŠ›ï¼Œè€Œä¸”éšç€ç½‘ç»œæµé‡çš„å¢åŠ ï¼Œå¤§è§„æ¨¡ä»£ç†é›†ç¾¤ä¹Ÿåº”è¿è€Œç”Ÿã€‚è¿™ä¸ªæ—¶ä»£çš„ä»£è¡¨æ€§ä»£ç†æœ‰ Envoyã€Kong ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘åŸç”Ÿæ—¶ä»£&lt;/strong&gt;ï¼šå¤šç§Ÿæˆ·ã€å¼¹æ€§ã€å¼‚æ„æ··åˆäº‘ã€å¤šé›†ç¾¤ã€å®‰å…¨å’Œå¯è§‚æµ‹ï¼Œè¿™äº›éƒ½æ˜¯äº‘åŸç”Ÿæ—¶ä»£å¯¹ä»£ç†æ‰€æå‡ºçš„æ›´é«˜è¦æ±‚ï¼Œä»£è¡¨æ€§è½¯ä»¶æœ‰ Istioã€Linkerdã€&lt;a href=&#34;https://flomesh.io/&#34; title=&#34;Pypi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pypi&lt;/a&gt;
ï¼Œå®ƒä»¬éƒ½ä¸ºä»£ç†æ„å»ºäº†æ§åˆ¶å¹³é¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;are-they-service-mesh&#34;&gt;è¿™äº›éƒ½æ˜¯æœåŠ¡ç½‘æ ¼å—ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘å°†åˆ—ä¸¾ä¸€äº›æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢æœåŠ¡ç½‘æ ¼çš„å‘å±•è§„å¾‹å’Œæœ¬è´¨ã€‚ä¸‹è¡¨å¯¹æ¯”äº†å½“å‰æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›® &lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¯¹æ¯”é¡¹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Istio&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Linkerd&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Consul Connect&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Traefik Mesh&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Kuma&lt;/th&gt;
&lt;th&gt;Open Service Mesh (OSM)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å½“å‰ç‰ˆæœ¬&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.14&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;2.11&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.12&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1.5&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è®¸å¯è¯&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Mozilla License&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Apache License 2.0&lt;/td&gt;
&lt;td&gt;Apache License 2.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å‘èµ·è€…&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Googleã€IBMã€Lyft&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Buoyant&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;HashiCorp&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Traefik Labs&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kong&lt;/td&gt;
&lt;td&gt;Microsoft&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœåŠ¡ä»£ç†&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Envoyï¼Œæ”¯æŒ gRPC çš„ proxyless æ¨¡å¼&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://github.com/linkerd/linkerd2-proxy&#34; title=&#34;Linkerd2-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd2-proxy&lt;/a&gt;
&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é»˜è®¤ä¸º &lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
ï¼Œå¯æ›¿æ¢&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://traefik.io/traefik/&#34; title=&#34;Traefik Proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik Proxy&lt;/a&gt;
&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å…¥å£æ§åˆ¶å™¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Envoyï¼Œè‡ªå®šä¹‰çš„ Ingressï¼Œæ”¯æŒ Kubernetes  Gateway API&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ— å†…ç½®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Envoyï¼Œæ”¯æŒ Kubernetes Gateway API&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ— å†…ç½®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kong&lt;/td&gt;
&lt;td&gt;æ”¯æŒ Contourã€Nginxï¼Œå…¼å®¹å…¶ä»–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ²»ç†&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Istio Community å’Œ Open Usage Commonsï¼Œå·²æè®®æçŒ®ç»™ CNCF&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;CNCF&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŸ¥çœ‹ &lt;a href=&#34;https://github.com/hashicorp/consul/blob/master/.github/CONTRIBUTING.md&#34; title=&#34;è´¡çŒ®æŒ‡å—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¡çŒ®æŒ‡å—&lt;/a&gt;
&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŸ¥çœ‹ &lt;a href=&#34;https://github.com/traefik/mesh/blob/master/CONTRIBUTING.md&#34; title=&#34;è´¡çŒ®æŒ‡å—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¡çŒ®æŒ‡å—&lt;/a&gt;
&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;CNCF&lt;/td&gt;
&lt;td&gt;CNCF&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;figcaption class=&#34;text-center&#34;&gt;
    æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®å¯¹æ¯”è¡¨
&lt;/figcaption&gt;

&lt;p&gt;ä¸Šè¡¨ä¸­åˆ—å‡ºçš„éƒ½æ˜¯æœåŠ¡ç½‘æ ¼ï¼Œä¸‹é¢å†ç®€å•è¯„è®ºä¸€ä¸‹è¿™äº›é¡¹ç›®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
ï¼šç›®å‰æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ä¹‹ä¸€ï¼Œåœ¨ä¸­å›½å‡ ä¹æˆä¸ºäº†æœåŠ¡ç½‘æ ¼çš„ä»£åè¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkerd.io&#34; title=&#34;Linkerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt;
ï¼šæœ€æ—©å‡ºç°çš„æœåŠ¡ç½‘æ ¼ï¼Œã€ŒService Meshã€æ¦‚å¿µæå‡ºè€…ï¼Œç¬¬ä¸€ä¸ªè¿›å…¥ CNCF çš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼Œä½¿ç”¨è‡ªç ”çš„ Rust è¯­è¨€ç¼–å†™è½»é‡çº§ sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://traefik.io/traefik-mesh/&#34; title=&#34;Traefik Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik Mesh&lt;/a&gt;
ï¼šç”± Traefik æ¨å‡ºçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼Œä½¿ç”¨ Treafik proxy ä½œä¸º sidecarï¼Œæ”¯æŒ SMIï¼ˆæ¥ä¸‹æ¥ä¼šæåˆ°ï¼‰ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å¯¹åº”ç”¨çš„æ— ä¾µå…¥æ€§ï¼Œä¸ä¼šåœ¨ pod ä¸­æ³¨å…¥ sidecarï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kuma.io/&#34; title=&#34;Kuma&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kuma&lt;/a&gt;
ï¼šç”± Kong æ¨å‡ºçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼Œä½¿ç”¨ Envoy ä½œä¸º Sidecar ä»£ç†ï¼Œç‰¹è‰²æ˜¯ä½¿ç”¨ Kong è‡ªå®¶çš„ç½‘å…³ä½œä¸ºå…¥å£ç½‘å…³ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.consul.io/docs/connect&#34; title=&#34;Consul Connect&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul Connect&lt;/a&gt;
ï¼šConsul æœåŠ¡ç½‘æ ¼ï¼Œä½¿ç”¨ Envoy ä½œä¸º sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://openservicemesh.io/&#34; title=&#34;Open Service Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Service Mesh&lt;/a&gt;
ï¼šç”±å¾®è½¯å¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼Œä½¿ç”¨ Envoy ä½œä¸º sidecarï¼Œå…¼å®¹ SMIï¼ˆåŒæ ·æ˜¯å¾®è½¯æå‡ºï¼‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–è¿˜æœ‰å‡ ä¸ªé¡¹ç›®ï¼Œä¹ŸæœåŠ¡ç½‘æ ¼é¢†åŸŸä¹Ÿç»å¸¸è¢«æåŠï¼Œä½†å®ƒä»¬éƒ½ä¸æ˜¯æœåŠ¡ç½‘æ ¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://envoyproxy.io&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
ï¼šEnvoy æœ¬èº«åªæ˜¯ä»£ç†ï¼Œä¹Ÿç»å¸¸è¢«ä½œä¸ºå…¶ä»–åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼çš„ sidecarï¼Œä¹Ÿç»å¸¸è¢«ç”¨æ¥æ„å»º API Gatewayï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://smp-spec.io/&#34; title=&#34;Service Mesh Performanceï¼ˆSMPï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh Performanceï¼ˆSMPï¼‰&lt;/a&gt;
ï¼šæ ‡å‡†åŒ–äº†æœåŠ¡ç½‘æ ¼å€¼çš„æŒ‡æ ‡ï¼Œé€šè¿‡æ•è·åŸºç¡€è®¾æ–½å®¹é‡ã€æœåŠ¡ç½‘æ ¼é…ç½®å’Œå·¥ä½œè´Ÿè½½å…ƒæ•°æ®çš„ç»†èŠ‚æ¥æè¿°ä»»ä½•éƒ¨ç½²çš„æ€§èƒ½ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://smi-spec.io/&#34; title=&#34;Service Mesh Interfaceï¼ˆSMIï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh Interfaceï¼ˆSMIï¼‰&lt;/a&gt;
ï¼šå®ƒä¸æ˜¯æœåŠ¡ç½‘æ ¼ï¼Œè€Œåªæ˜¯ä¸€å¥—æœåŠ¡ç½‘æ ¼å®ç°æ ‡å‡†ï¼Œä¸ OAMã€SPIFFEã€CNIã€CSI ç­‰ç±»ä¼¼éƒ½æ˜¯å®šä¹‰æ¥å£æ ‡å‡†ï¼Œå…·ä½“å®ç°å°±ä¸ä¸€è€Œè¶³äº†ã€‚ç›®å‰ Traefik Mesh å’Œ Open Service Mesh å£°æ˜æ”¯æŒè¯¥è§„èŒƒï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://networkservicemesh.io/&#34; title=&#34;Network Service Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Network Service Mesh&lt;/a&gt;
ï¼šæœ‰å¿…è¦æä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œå› ä¸ºç»å¸¸æœ‰äººæŠŠå®ƒé”™è®¤ä¸ºæ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ã€‚å®é™…ä¸Šï¼Œå®ƒé¢å‘çš„æ˜¯ä¸‰å±‚ç½‘ç»œï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ä¸æ›´æ¢ CNI æ’ä»¶çš„å‰æä¸‹ï¼Œè¿æ¥å¤šäº‘/æ··åˆäº‘ã€‚å®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€å®šä¹‰çš„ã€ŒæœåŠ¡ç½‘æ ¼ã€ï¼Œè€Œæ˜¯æœåŠ¡ç½‘æ ¼çš„ä¸€ä¸ªæœ‰åŠ›è¡¥å……ï¼ˆè™½ç„¶åå­—é‡Œå¸¦æœ‰æœåŠ¡ç½‘æ ¼æ¯”è¾ƒæœ‰è¿·æƒ‘æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çºµè§‚ä»¥ä¸Šé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¤§éƒ¨åˆ†æœåŠ¡ç½‘æ ¼é¡¹ç›®çš„å‘èµ·è€…éƒ½æ˜¯æ ¹æ®ä»£ç†èµ·å®¶ï¼Œç„¶ååšæ§åˆ¶å¹³é¢ã€‚è€Œä¸” Istioã€Consul Connectã€Open Service Meshã€Kuma éƒ½æ˜¯ä½¿ç”¨ Envoy ä½œä¸º sidecar ä»£ç†ã€‚åªæœ‰ Linkerd å’Œ Traefik Mesh æ¨å‡ºäº†è‡ªå·±çš„ä»£ç†ã€‚è€Œæ‰€æœ‰çš„æœåŠ¡ç½‘æ ¼é¡¹ç›®éƒ½æ”¯æŒ sidecar æ¨¡å¼ã€‚é™¤äº† Istioã€Linkerdã€Consul Connect å·²åº”ç”¨äºç”Ÿäº§ä¸Šï¼Œå…¶ä»–æœåŠ¡ç½‘æ ¼é¡¹ç›®è¿˜æ²¡æœ‰çœ‹åˆ°è¢«å¤§è§„æ¨¡åœ¨ç”Ÿäº§ä¸Šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;performance-optimizing&#34;&gt;Istio çš„æ€§èƒ½ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio 1.5 ç‰ˆæœ¬ç¡®å®šäº†ç¨³å®šçš„æ¶æ„ä¹‹åï¼Œç¤¾åŒºçš„ä¸»è¦ç²¾åŠ›åœ¨äºä¼˜åŒ– Istio çš„æ€§èƒ½ã€‚ä¸‹é¢æˆ‘å°†å‘ä½ è¯¦ç»†ä»‹ç» Istio ä¸­çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨ Proxyless æ¨¡å¼ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ eBPF ä¼˜åŒ–æµé‡åŠ«æŒï¼›&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®å¹³é¢æ€§èƒ½ä¼˜åŒ–ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;proxyless-pattern&#34;&gt;Proxyless æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;Proxyless æ¨¡å¼æ˜¯ Istio åœ¨ 1.11 ç‰ˆæœ¬ä¸­æå‡ºçš„å®éªŒç‰¹æ€§ â€”â€” &lt;a href=&#34;https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/&#34; title=&#34;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&lt;/a&gt;
ã€‚ä½¿ç”¨è¯¥æ¨¡å¼å¯ä»¥ç›´æ¥å°† gRPC æœåŠ¡æ·»åŠ åˆ° Istio ä¸­ï¼Œè€Œä¸éœ€è¦å†å‘ Pod ä¸­æ³¨å…¥ Envoy ä»£ç†ã€‚ä¸‹å›¾å±•ç¤ºäº† sidecar æ¨¡å¼ä¸ proxyless æ¨¡å¼çš„å¯¹æ¯”å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;sidecar-to-proxyless.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Sidecar æ¨¡å¼ vs Proxyless æ¨¡å¼&#34; width=&#34;100%&#34;data-img=&#34;sidecar-to-proxyless.svg&#34;
         data-caption=&#34;Sidecar æ¨¡å¼ vs Proxyless æ¨¡å¼&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Sidecar æ¨¡å¼ vs Proxyless æ¨¡å¼
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ proxyless æ¨¡å¼ä¸ä½¿ç”¨ proxy è¿›è¡Œæ•°æ®å¹³é¢é€šä¿¡ï¼Œä½†ä»ç„¶éœ€è¦ä¸€ä¸ª agentï¼ˆå³ &lt;code&gt;pilot-agent&lt;/code&gt;ï¼‰æ¥è¿›è¡Œåˆå§‹åŒ–å’Œä¸æ§åˆ¶å¹³é¢çš„é€šä¿¡ã€‚é¦–å…ˆï¼Œagent åœ¨å¯åŠ¨æ—¶ç”Ÿæˆä¸€ä¸ª&lt;a href=&#34;https://github.com/grpc/proposal/blob/master/A27-xds-global-load-balancing.md#xdsclient-and-bootstrap-file&#34; title=&#34;å¼•å¯¼æ–‡ä»¶&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼•å¯¼æ–‡ä»¶&lt;/a&gt;
ï¼Œä¸ä¸º Envoy ç”Ÿæˆå¼•å¯¼æ–‡ä»¶çš„æ–¹å¼ç›¸åŒã€‚è¿™å‘Šè¯‰ gRPC åº“å¦‚ä½•è¿æ¥åˆ° &lt;code&gt;istiod&lt;/code&gt;ï¼Œåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°ç”¨äºæ•°æ®å¹³é¢é€šä¿¡çš„è¯ä¹¦ï¼Œå‘æ§åˆ¶å¹³é¢å‘é€ä»€ä¹ˆå…ƒæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œagent ä½œä¸º xDS proxyï¼Œä»£è¡¨åº”ç”¨ç¨‹åºä¸ &lt;code&gt;istiod&lt;/code&gt; è¿›è¡Œè¿æ¥å’Œè®¤è¯ã€‚æœ€åï¼Œagent è·å–å¹¶è½®æ¢æ•°æ®å¹³é¢é€šä¿¡ä¸­ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¿™å…¶å®ä¸ Sidecar æ¨¡å¼çš„æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å°† Envoy ä»£ç†çš„åŠŸèƒ½å†…ç½®åˆ° SDK ä¸­äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;æœåŠ¡ç½‘æ ¼çš„æœ¬è´¨ä¸æ˜¯ Sidecar æ¨¡å¼ï¼Œä¹Ÿä¸æ˜¯é…ç½®ä¸­å¿ƒæˆ–é€æ˜æµé‡æ‹¦æˆªï¼Œè€Œæ˜¯æ ‡å‡†åŒ–çš„æœåŠ¡é—´é€šä¿¡æ ‡å‡†ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰äººè¯´ proxyless æ¨¡å¼åˆå›åˆ°äº†åŸºäº SDK å¼€å‘å¾®æœåŠ¡çš„è€è·¯ï¼ŒæœåŠ¡ç½‘æ ¼çš„ä¼˜åŠ¿ä¸§å¤±æ®†å°½ï¼Œé‚£è¿˜èƒ½å«åšæœåŠ¡ç½‘æ ¼å— &lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;ï¼Ÿå…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§å¯¹æ€§èƒ½çš„å¦¥å â€”â€” å¦‚æœä½ ä¸»è¦ä½¿ç”¨ gRPC æ¥å¼€å‘å¾®æœåŠ¡çš„è¯ï¼Œåªéœ€è¦ç»´æŠ¤ä¸åŒè¯­è¨€çš„ gRPC ç‰ˆæœ¬ï¼Œå³å¯ä»¥é€šè¿‡æ§åˆ¶å¹³é¢æ¥ç®¡ç†å¾®æœåŠ¡äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Envoy xDS å·²ç»æˆä¸ºæœåŠ¡ç½‘æ ¼ä¸­æœåŠ¡é—´é€šä¿¡çš„äº‹å®æ ‡å‡†ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ebpf&#34;&gt;ä½¿ç”¨ eBPF ä¼˜åŒ–æµé‡åŠ«æŒ&lt;/h3&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;#traffic-intercept&#34; title=&#34;é€æ˜æµé‡åŠ«æŒ&#34;&gt;é€æ˜æµé‡åŠ«æŒ&lt;/a&gt;
ä¸€èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœåŠ¡é—´çš„æµé‡åœ¨åˆ°è¾¾ç›®çš„åœ° pod æ—¶ç»è¿‡çš„ iptables è§„åˆ™å’Œè·¯å¾„ï¼Œå…¶ä¸­éœ€è¦ç»è¿‡å¤šæ¡ iptables è§„åˆ™ï¼Œå¦‚ &lt;code&gt;PREROUTING&lt;/code&gt;ã€&lt;code&gt;ISTIO_INBOUND&lt;/code&gt;ã€&lt;code&gt;ISTIO_IN_REDIRECT&lt;/code&gt;ã€&lt;code&gt;OUTPUT&lt;/code&gt;ã€&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt;ã€&lt;code&gt;POSTROUTING&lt;/code&gt; ç­‰ã€‚å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæœåŠ¡ A æƒ³è¦è°ƒç”¨éæœ¬åœ°ä¸»æœºä¸Šçš„å¦ä¸€ä¸ª pod ä¸­çš„æœåŠ¡ Bï¼Œç»è¿‡çš„ç½‘ç»œå †æ ˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/iptables-process.svg&#34; data-img=&#34;/blog/beyond-istio-oss/iptables-process.svg&#34; alt=&#34;image&#34; data-caption=&#34;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆiptables æ¨¡å¼ï¼‰&#34;&gt;
    
  
  &lt;figcaption&gt;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆiptables æ¨¡å¼ï¼‰&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªè°ƒç”¨æµç¨‹ä¸­ç»è¿‡å››æ¬¡ iptablesï¼Œå…¶ä¸­ Pod A ä¸­çš„ä» Envoy çš„å‡ºç«™ï¼ˆiptables2ï¼‰å’Œ Pod B ä¸­çš„ä» eth0 çš„å…¥ç«™ï¼ˆiptables3ï¼‰çš„ iptables è·¯ç”±æ˜¯æ— æ³•é¿å…çš„ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ä¸¤ä¸ª iptables1 å’Œ iptables4 æ˜¯å¦å¯ä»¥ä¼˜åŒ–å‘¢ï¼Ÿè®©ä¸¤ä¸ª socket ç›´æ¥é€šä¿¡ï¼Œä¸å°±å¯ä»¥ç¼©çŸ­ç½‘ç»œè·¯å¾„äº†å—ï¼Ÿè¿™å°±éœ€è¦é€šè¿‡ eBPF ç¼–ç¨‹ï¼Œä½¿å¾—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Service A çš„æµé‡ä»ç›´æ¥å‘é€åˆ° Envoy çš„ Inbound socket ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;Pod B ä¸­ Envoy æ¥æ”¶åˆ°å…¥ç«™æµé‡åï¼Œå·²ç»ç¡®å®šæµé‡æ˜¯è¦å‘é€ç»™æœ¬åœ°çš„æœåŠ¡ï¼Œç›´æ¥å¯¹æ¥ Outbound socket ä¸ Service Bï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ eBPF æ¨¡å¼çš„é€æ˜æµé‡æ‹¦æˆªç½‘ç»œè·¯å¾„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/ebpf-diff-node.svg&#34; data-img=&#34;/blog/beyond-istio-oss/ebpf-diff-node.svg&#34; alt=&#34;image&#34; data-caption=&#34;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&#34;&gt;
    
  
  &lt;figcaption&gt;éåŒä¸»æœº Pod é—´çš„æœåŠ¡è®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦è®¿é—®çš„æœåŠ¡ A å’ŒæœåŠ¡ B åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆç½‘ç»œè·¯å¾„å°†æ›´çŸ­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/ebpf-same-node.svg&#34; data-img=&#34;/blog/beyond-istio-oss/ebpf-same-node.svg&#34; alt=&#34;image&#34; data-caption=&#34;åŒä¸»æœº Pod é—´çš„ç½‘ç»œè®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&#34;&gt;
    
  
  &lt;figcaption&gt;åŒä¸»æœº Pod é—´çš„ç½‘ç»œè®¿é—®è·¯å¾„ï¼ˆeBPF æ¨¡å¼ï¼‰&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„æœåŠ¡é—´è®¿é—®å®Œå…¨ç»•è¿‡äº† TCP/IP å †æ ˆï¼Œå˜æˆäº† socket é—´çš„ç›´æ¥è®¿é—®ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  ä»€ä¹ˆæ˜¯ eBPFï¼Ÿ
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;p&gt;æˆ‘ä»¬çŸ¥é“ä¿®æ”¹ Linux å†…æ ¸ä»£ç å¾ˆéš¾ï¼Œæ–°ç‰¹æ€§å‘å¸ƒåˆ°å†…æ ¸ä¸­éœ€è¦å¾ˆé•¿çš„å‘¨æœŸã€‚eBPF æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸å†…åŠ è½½å’Œè¿è¡Œè‡ªå®šä¹‰ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº† eBPFï¼Œä½ ä¸éœ€è¦ç›´æ¥ä¿®æ”¹å†…æ ¸ï¼Œå°±å¯ä»¥æ‰©å±•å’Œæ”¹å˜å†…æ ¸çš„è¡Œä¸ºã€‚ä¸‹é¢æˆ‘å°†ç®€è¦çš„ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹ eBPFï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;eBPF ç¨‹åºåŠ è½½åˆ°å†…æ ¸ä¸­åéœ€è¦é€šè¿‡éªŒè¯å™¨çš„éªŒè¯æ‰å¯ä»¥è¿è¡Œï¼ŒéªŒè¯å™¨å¯ä»¥é˜²æ­¢ eBPF ç¨‹åºè¶…è¶Šæƒé™çš„è®¿é—®ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å†…æ ¸çš„å®‰å…¨ï¼›&lt;/li&gt;
&lt;li&gt;eBPF ç¨‹åºæ˜¯é™„ç€äºå†…æ ¸äº‹ä»¶ä¸Šçš„ï¼Œå½“æœ‰è¿›å…¥æˆ–é€€å‡ºå†…æ ¸å‡½æ•°æ—¶è¢«è§¦å‘ï¼›&lt;/li&gt;
&lt;li&gt;å†…æ ¸ç©ºé—´çš„ eBPF ç¨‹åºå¿…é¡»ä½¿ç”¨èƒ½å¤Ÿæ”¯æŒç”Ÿæˆ eBPF å­—èŠ‚ç æ ¼å¼çš„ç¼–è¯‘å™¨çš„è¯­è¨€ç¼–å†™ï¼Œç›®å‰ä½ å¯ä»¥ç”¨ C å’Œ Rust è¯­è¨€ç¼–å†™ eBPF ç¨‹åºï¼›&lt;/li&gt;
&lt;li&gt;eBPF ç¨‹åºå¯¹äºä¸åŒçš„ Linux ç‰ˆæœ¬å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äº eBPF ç¨‹åºå¯ä»¥ç›´æ¥ç›‘å¬å’Œæ“ä½œ Linux å†…æ ¸ï¼Œå…·æœ‰å¯¹ç³»ç»Ÿæœ€åº•å±‚çš„é€è§†ï¼Œå°±å¯ä»¥åœ¨æµé‡ç®¡ç†ã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨å‘æŒ¥ä½œç”¨ã€‚æœ‰å…³ eBPF çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒç¬”è€…ç¿»è¯‘çš„&lt;a href=&#34;https://lib.jimmysong.io/what-is-ebpf/&#34; title=&#34;ã€Šä»€ä¹ˆæ˜¯ eBPFã€‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€Šä»€ä¹ˆæ˜¯ eBPFã€‹&lt;/a&gt;
ç”µå­ä¹¦ã€‚&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;å¼€æºé¡¹ç›® &lt;a href=&#34;https://github.com/merbridge/merbridge&#34; title=&#34;Merbridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge&lt;/a&gt;
 æ­£æ˜¯åˆ©ç”¨ eBPF ç¼©çŸ­äº†é€æ˜æµé‡åŠ«æŒçš„è·¯å¾„ï¼Œä¼˜åŒ–äº†æœåŠ¡ç½‘æ ¼çš„æ€§èƒ½ã€‚å…³äº Merbridge å®ç°çš„ä¸€äº›ç»†èŠ‚ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/zh/blog/2022/merbridge/&#34; title=&#34;Istio åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åšå®¢&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-warning-title py-1 px-2&#34;&gt;
  æ³¨æ„
&lt;/div&gt;

&lt;div class=&#34;alert-warning py-1 px-2&#34;&gt;
  Merbridge ä½¿ç”¨çš„ eBPF å‡½æ•°éœ€è¦ Linux å†…æ ¸ç‰ˆæœ¬ â‰¥ 5.7ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;ä¹çœ‹ä¸Šå» eBPF ä¼¼ä¹ä»æ›´åº•å±‚å®ç°äº† Istio çš„åŠŸèƒ½ï¼Œæ›´å¤§æœ‰å–ä»£ sidecar çš„è¶‹åŠ¿ã€‚ä½†æ˜¯ eBPF ä¹Ÿå­˜åœ¨å¾ˆå¤šå±€é™æ€§ï¼Œå¯¼è‡´åœ¨å¯ä»¥é¢„è§çš„æœªæ¥æ— æ³•å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecarã€‚å¦‚æœå–æ¶ˆ sidecar è½¬è€Œä½¿ç”¨æ¯ä¸ªä¸»æœºä¸€ä¸ªä»£ç†çš„æ¨¡å¼ï¼Œä¼šå¯¼è‡´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»£ç†å¤±è´¥çš„çˆ†ç‚¸åŠå¾„æ‰©å¤§åˆ°æ•´ä¸ªèŠ‚ç‚¹ï¼Œå³ä¸€ä¸ªä»£ç†å¤±è´¥äº†ï¼Œä»£ç†æ‰€åœ¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å·¥ä½œè´Ÿè½½éƒ½ä¼šå—åˆ°å½±å“ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿å¾—å®‰å…¨é—®é¢˜æ›´åŠ å¤æ‚ï¼Œå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¿å­˜åœ¨å¤ªå¤šè´Ÿè½½çš„è¯ä¹¦ï¼Œä¸€æ—¦è¢«æ”»å‡»ï¼Œä¼šå­˜åœ¨ç§˜é’¥æ³„éœ²çš„é£é™©ï¼›&lt;/li&gt;
&lt;li&gt;ä¸»æœºä¸Šçš„ Pod ä¹‹é—´çš„æµé‡äº‰æŠ¢é—®é¢˜ï¼Œå³èŠ‚ç‚¹ä¸Šå¦‚æœæœ‰ä¸€ä¸ªå·¥ä½œè´Ÿè½½æ¶ˆè€—æ‰ä»£ç†çš„æ‰€æœ‰èµ„æºï¼Œå…¶ä»–å·¥ä½œè´Ÿè½½å°†æ— æ³•è·å¾—æµé‡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œä¸” eBPF ä¸»è¦è´Ÿè´£ä¸‰/å››å±‚æµé‡ï¼Œå¯ä»¥ä¸ CNI ä¸€èµ·è¿è¡Œï¼Œä½†æ˜¯ä¸ƒå±‚æµé‡ä½¿ç”¨ eBPF æ¥å¤„ç†å°±ä¸å¤ªåˆé€‚äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;åœ¨å¯ä»¥é¢„è§çš„æœªæ¥ eBPF æŠ€æœ¯æ— æ³•å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecarã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…³äº eBPF ä¸æœåŠ¡ç½‘æ ¼çš„å…³ç³»çš„æ›´è¯¦ç»†ä»‹ç»è¯·å‚è€ƒåšå®¢&lt;a href=&#34;https://jimmysong.io/blog/ebpf-sidecar-and-service-mesh/&#34; title=&#34;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecar æ¨¡å¼çš„å¹»æƒ³&#34;&gt;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ Sidecar æ¨¡å¼çš„å¹»æƒ³&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;control-plane-perf-optimizing&#34;&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šä¸¤ç§ä¼˜åŒ–éƒ½æ˜¯é’ˆå¯¹æ•°æ®å¹³é¢è¿›è¡Œçš„ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹æ§åˆ¶å¹³é¢çš„æ€§èƒ½ä¼˜åŒ–ã€‚ä½ å¯ä»¥æŠŠæœåŠ¡ç½‘æ ¼æƒ³è±¡æˆæ˜¯ä¸€åœºæ¼”å‡ºï¼Œæ§åˆ¶å¹³é¢æ˜¯æ€»å¯¼æ¼”ï¼Œæ•°æ®å¹³é¢æ˜¯æ‰€æœ‰æ¼”å‘˜ï¼Œå¯¼æ¼”ä¸å‚ä¸æ¼”å‡ºï¼Œä½†æ˜¯è´Ÿè´£æŒ‡æŒ¥æ¼”å‘˜ã€‚å¦‚æœè¿™åœºæ¼”å‡ºçš„æƒ…èŠ‚å¾ˆç®€å•ï¼Œæ—¶é•¿åˆå¾ˆçŸ­ï¼Œé‚£è¦æ¯ä¸ªæ¼”å‘˜åˆ†é…çš„æˆä»½å°±ä¼šå¾ˆå°‘ï¼Œæ’ç»ƒèµ·æ¥å°±ä¼šå¾ˆå®¹æ˜“ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå¤§å‹æ¼”å‡ºï¼Œæ¼”å‘˜çš„æ•°é‡å¤šï¼Œæƒ…èŠ‚æœ‰å¾ˆå¤æ‚ï¼Œè¦æƒ³æ’ç»ƒå¥½è¿™åœºæ¼”å‡ºï¼Œä¸€ä¸ªå¯¼æ¼”å¯èƒ½æ˜¯ä¸å¤Ÿçš„ï¼Œä»–æŒ‡æŒ¥ä¸äº†è¿™ä¹ˆå¤šæ¼”å‘˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¤šåå‰¯å¯¼æ¼”ï¼ˆæ‰©å¤§æ§åˆ¶å¹³é¢å®ä¾‹æ•°é‡ï¼‰ï¼›æˆ‘ä»¬è¿˜éœ€è¦ç»™æ¼”å‘˜å‡†å¤‡å¥½å°è¯å’Œè„šæœ¬ï¼Œå¦‚æœæ¼”å‘˜ä¹Ÿå¯ä»¥ä¸€ä¸ªé•œå¤´å®Œæˆä¸€è¿ä¸²çš„å°è¯å’Œåœºæ™¯çš„è¡¨æ¼”ï¼ˆå‡å°‘éƒ½æ•°æ®å¹³é¢çš„æ‰“æ‰°ï¼Œæ‰¹é‡æ¨é€æ›´æ–°ï¼‰ï¼Œé‚£æˆ‘ä»¬çš„æ’ç»ƒæ˜¯ä¸æ˜¯æ›´åŠ é«˜æ•ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ç±»æ¯”ä¸­ï¼Œä½ åº”è¯¥å¯ä»¥æ‰¾åˆ°æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘äº†ï¼Œé‚£å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘éœ€è¦æ¨é€çš„é…ç½®å¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;æ‰¹å¤„ç†ä»£ç†æ¨é€ï¼›&lt;/li&gt;
&lt;li&gt;æ‰©å¤§æ§åˆ¶å¹³é¢è§„æ¨¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;reduce-config-size&#34;&gt;å‡å°‘éœ€è¦æ¨é€çš„é…ç½®&lt;/h4&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯å‡å°‘è¦å‘æ•°æ®å¹³é¢æ¨é€çš„ä»£ç†é…ç½®å¤§å°ã€‚å‡è®¾æœ‰å·¥ä½œè´Ÿè½½ Aï¼Œå¦‚æœä»…å°†ä¸ A ç›¸å…³çš„ä»£ç†é…ç½®ï¼ˆå³ A ä¾èµ–çš„æœåŠ¡ï¼‰æ¨é€ç»™ Aï¼Œè€Œä¸æ˜¯å°†ç½‘æ ¼å†…æ‰€æœ‰æœåŠ¡çš„é…ç½®éƒ½æ¨é€ç»™ Aï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§å‹ç¼©è¦æ¨é€çš„å·¥ä½œè´Ÿè½½èŒƒå›´åŠé…ç½®å¤§å°ã€‚Istio ä¸­çš„ Sidecar èµ„æºå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç‚¹ã€‚ä¸‹é¢æ˜¯ Sidecar é…ç½®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Sidecar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cn-bj&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;app-a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;cn-bj/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é€šè¿‡ &lt;code&gt;workloadSelector&lt;/code&gt; å­—æ®µå¯ä»¥é™åˆ¶è¯¥ Sidecar é…ç½®é€‚ç”¨çš„å·¥ä½œè´Ÿè½½èŒƒå›´ï¼Œè€Œ &lt;code&gt;egress&lt;/code&gt; å­—æ®µå¯ä»¥ç¡®å®šè¯¥å·¥ä½œè´Ÿè½½ä¾èµ–çš„æœåŠ¡èŒƒå›´ï¼Œè¿™æ ·æ§åˆ¶å¹³é¢å°±å¯ä»¥ä»…å‘æœåŠ¡ A æ¨é€å…¶ä¾èµ–çš„æœåŠ¡é…ç½®ï¼Œå¤§å¤§å‡ä½è¦å‘æ•°æ®å¹³é¢æ¨é€çš„é…ç½®å¤§å°ï¼Œå‡å°‘äº†æœåŠ¡ç½‘æ ¼çš„å†…å­˜å’Œç½‘ç»œæ¶ˆè€—ã€‚&lt;/p&gt;
&lt;h4 id=&#34;batch-push-conf&#34;&gt;æ‰¹å¤„ç†ä»£ç†é…ç½®æ¨é€&lt;/h4&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢ Istiod å‘æ•°æ®å¹³é¢æ¨é€ä»£ç†é…ç½®çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¸‹å›¾å±•ç¤ºäº†å…¶ä¸­çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istiod-push.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istiod-push.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istiod å‘æ•°æ®å¹³é¢æ¨é€ä»£ç†é…ç½®çš„æµç¨‹å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istiod å‘æ•°æ®å¹³é¢æ¨é€ä»£ç†é…ç½®çš„æµç¨‹å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®¡ç†å‘˜é…ç½® Istio ç½‘æ ¼åï¼ŒIstiod ä¸­æ¨é€ä»£ç†é…ç½®çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®¡ç†å‘˜æ›´æ–° Istio é…ç½®çš„äº‹ä»¶ä¼šè§¦å‘æ•°æ®å¹³é¢ä»£ç†çš„é…ç½®åŒæ­¥ï¼›&lt;/li&gt;
&lt;li&gt;Istio çš„ &lt;code&gt;DiscoveryServer&lt;/code&gt; ç»„ä»¶ç›‘å¬åˆ°è¿™äº›äº‹ä»¶åä¸ä¼šç«‹å³å°†é…ç½®æ¨é€åˆ°æ•°æ®å¹³é¢ï¼Œè€Œæ˜¯å°†è¿™äº›äº‹ä»¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ŒæŒç»­åˆå¹¶ä¸€æ®µæ—¶é—´å†…çš„äº‹ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå»æŠ–åŠ¨ï¼ˆdebouncingï¼‰ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢é¢‘ç¹çš„æ›´æ–°æ•°æ®å¹³é¢é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨å»æŠ–åŠ¨å‘¨æœŸè¿‡åï¼Œè¿™äº›äº‹ä»¶å°†è¢«æ¨é€åˆ°é˜Ÿåˆ—ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istiod ä¼šé™åˆ¶åŒæ—¶æ¨é€çš„è¯·æ±‚æ•°é‡ï¼Œä»¥åŠ å¿«æ¨é€è¿›åº¦ï¼›&lt;/li&gt;
&lt;li&gt;äº‹ä»¶è¢«è½¬æ¢æˆ Envoy çš„é…ç½®æ¨é€åˆ°æ•°æ®å¹³é¢çš„å·¥ä½œè´Ÿè½½ä¸Šï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»ä»¥ä¸Šæµç¨‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¼˜åŒ–é…ç½®æ¨é€çš„å…³é”®å°±æ˜¯æ­¥éª¤ 2 ä¸­å»æŠ–åŠ¨å‘¨æœŸå’Œæ­¥éª¤ 4 ä¸­çš„é™æµè®¾ç½®ã€‚æœ‰è¿™æ ·å‡ ä¸ªç¯å¢ƒå˜é‡å¯ä»¥å¸®åŠ©ä½ è®¾ç½®æ§åˆ¶å¹³é¢çš„æ¨é€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PILOT_DEBOUNCE_AFTER&lt;/code&gt;ï¼šæŒ‡å®šå»æŠ–åŠ¨çš„æ—¶é—´ï¼Œå°†äº‹ä»¶æ·»åŠ åˆ°æ¨é€é˜Ÿåˆ—ä¸­ï¼Œé»˜è®¤ä¸º 100 æ¯«ç§’ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PILOT_DEBOUNCE_MAX&lt;/code&gt;ï¼šæŒ‡å®šå…è®¸äº‹ä»¶å»æŠ–åŠ¨çš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…äº‹ä»¶æ²¡æœ‰æ–°çš„å˜åŒ–åˆ™æ¨é€äº‹ä»¶ï¼Œé»˜è®¤ä¸º 10 ç§’ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PILOT_ENABLE_EDS_DEBOUNCE&lt;/code&gt;ï¼šæŒ‡å®šç«¯ç‚¹æ›´æ–°æ˜¯å¦ç¬¦åˆå»æŠ–åŠ¨è§„åˆ™æˆ–å…·æœ‰ä¼˜å…ˆæƒå¹¶ç«‹å³è½å…¥æ¨é€é˜Ÿåˆ—ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå…³é—­å®ƒåå¯ä»¥åŠ é€Ÿ EDS æ¨é€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PILOT_PUSH_THROTTLE&lt;/code&gt;ï¼šæŒ‡å®šåŒæ—¶å¤„ç†çš„æ¨é€è¯·æ±‚ï¼Œé»˜è®¤æ˜¯ 100ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºè¿™äº›ç¯å¢ƒå˜é‡çš„é»˜è®¤å€¼å’Œå…·ä½“é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/reference/commands/pilot-agent/#envvars&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å€¼ç©¶ç«Ÿå¦‚ä½•è®¾ç½®ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ§åˆ¶å¹³é¢èµ„æºç©ºé—²ï¼Œä¸ºäº†åŠ å¿«é…ç½®æ›´æ–°çš„ä¼ æ’­é€Ÿåº¦ï¼Œä½ å¯ä»¥ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼©çŸ­å»æŠ–åŠ¨å‘¨æœŸï¼Œå¢åŠ æ¨é€æ¬¡æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å¢åŠ åŒæ—¶å¤„ç†çš„æ¨é€è¯·æ±‚æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœæ§åˆ¶å¹³é¢é¥±å’Œï¼Œä¸ºäº†é™ä½æ€§èƒ½ç“¶é¢ˆï¼Œä½ å¯ä»¥ï¼š
&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿå»æŠ–åŠ¨å‘¨æœŸï¼Œå‡å°‘æ¨é€æ¬¡æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å¢åŠ åŒæ—¶å¤„ç†çš„æ¨é€è¯·æ±‚çš„æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡³äºå¦‚ä½•è®¾ç½®æœ€ä¼˜è§£ï¼Œéœ€è¦ç»“åˆä½ çš„å¯è§‚æµ‹ç³»ç»Ÿæ¥è°ƒè¯•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;scale-up-control-plane&#34;&gt;æ‰©å¤§æ§åˆ¶å¹³é¢è§„æ¨¡&lt;/h4&gt;
&lt;p&gt;å¦‚æœè®¾ç½®å»æŠ–åŠ¨æ‰¹å¤„ç†å’Œ Sidecar è¿˜æ— æ³•ä¼˜åŒ–æ§åˆ¶å¹³é¢æ€§èƒ½çš„è¯ï¼Œæœ€åçš„é€‰æ‹©å°±æ˜¯æ‰©å¤§æ§åˆ¶å¹³é¢çš„è§„æ¨¡ï¼ŒåŒ…æ‹¬æ‰©å¤§å•ä¸ª Istiod å®ä¾‹çš„èµ„æºå’Œå¢åŠ  Istiod çš„å®ä¾‹ä¸ªæ•°ï¼Œç©¶ç«Ÿé‡‡ç”¨å“ªç§æ‰©å±•æ–¹å¼è§†æƒ…å†µè€Œå®šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å•ä¸ª Istiod çš„èµ„æºå ç”¨é¥±å’Œæ—¶ï¼Œä¼˜å…ˆæ¨èä½ æ‰©å¤§ Istiod çš„å®ä¾‹å¤§å°ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºæœåŠ¡ç½‘æ ¼ä¸­æœ‰å¤ªå¤šçš„èµ„æºï¼ˆIstio çš„è‡ªå®šä¹‰èµ„æºï¼Œå¦‚ VirtualServiceã€DestinationRule ç­‰ï¼‰éœ€è¦å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå¢åŠ  Istiod å®ä¾‹çš„ CPU å’Œå†…å­˜ä¾ç„¶ä¸èµ·æ•ˆçš„è¯ï¼Œå¢åŠ  Istiod çš„å®ä¾‹ä¸ªæ•°ï¼Œè¿™æ ·å¯ä»¥åˆ†æ•£å•ä¸ªå®ä¾‹è¦ç®¡ç†çš„å·¥ä½œè´Ÿè½½æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;data-plane-performance&#34;&gt;æ•°æ®å¹³é¢æ€§èƒ½ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;Apache SkyWalking å¯ä»¥ä½œä¸º Istio æä¾›å¯è§‚æµ‹æ€§å·¥å…·ï¼Œè¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨è¿›è¡ŒæœåŠ¡åŠ¨æ€è°ƒè¯•å’Œæ•…éšœæ’é™¤å‰–ææœåŠ¡çš„æ€§èƒ½ï¼Œå…¶æœ€æ–°æ¨å‡ºçš„ &lt;a href=&#34;https://github.com/apache/skywalking-rover&#34; title=&#34;Apache SkyWalking Rover&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache SkyWalking Rover&lt;/a&gt;
 ç»„ä»¶å¯ä»¥åˆ©ç”¨ eBPF æŠ€æœ¯æ¥å‡†ç¡®å®šä½ Istio çš„å…³é”®æ€§èƒ½é—®é¢˜ &lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt;ã€‚åœ¨æ•°æ®å¹³é¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å¢åŠ  Envoy çš„ååé‡ä»¥ä¼˜åŒ– Istio çš„æ€§èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¦ç”¨ Zipkin è¿½è¸ªæˆ–å‡å°‘é‡‡æ ·ç‡&lt;/li&gt;
&lt;li&gt;ç®€åŒ–è®¿é—®æ—¥å¿—æ ¼å¼&lt;/li&gt;
&lt;li&gt;ç¦ç”¨ Envoy çš„è®¿é—®æ—¥å¿—æœåŠ¡ï¼ˆALSï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šä¼˜åŒ–æ–¹å¼å¯¹ Envoy ååé‡çš„å½±å“æ•°æ®è¯·å‚é˜… &lt;a href=&#34;https://lib.jimmysong.io/blog/pinpoint-service-mesh-critical-performance-impact-by-using-ebpf/#introducing-skywalking-rover&#34; title=&#34;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;starring-envoy&#34;&gt;Envoy â€”â€” æœåŠ¡ç½‘æ ¼çš„é¢†è¡”ä¸»æ¼”&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“æœåŠ¡ç½‘æ ¼æ˜¯ç”±æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ç»„æˆçš„ï¼Œä»ä¸Šé¢çš„æœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®åˆ—è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäº Envoyï¼Œç„¶åå¼€å‘è‡ªå·±çš„æ§åˆ¶å¹³é¢ã€‚è¿˜è®°å¾—æˆ‘åœ¨æœ¬æ–‡å‰é¢å°†æœåŠ¡ç½‘æ ¼æ¯”ä½œæ¼”å‡ºå—ï¼Ÿåœ¨è¿™åœºæœåŠ¡ç½‘æ ¼çš„æ¼”å‡ºä¸­ï¼Œæ¯«æ— ç–‘é—® Envoy å°±æ˜¯é¢†è¡”ä¸»æ¼” â€”â€” Envoy å‘æ˜çš„ xDS åè®®ï¼ŒåŸºæœ¬æˆä¸ºæœåŠ¡ç½‘æ ¼çš„é€šç”¨ APIã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ Envoy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/envoy-arch.svg&#34; data-img=&#34;/blog/beyond-istio-oss/envoy-arch.svg&#34; alt=&#34;image&#34; data-caption=&#34;Envoy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;xDS æ˜¯ Envoy åŒºåˆ«äºå…¶ä»–ä»£ç†çš„å…³é”®ï¼Œå®ƒçš„ä»£ç å’Œè§£ææµç¨‹ååˆ†å¤æ‚ &lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;ï¼Œç›´æ¥æ‰©å±•èµ·æ¥ä¹Ÿå¾ˆæœ‰éš¾åº¦ã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ Istio ç»„ä»¶æ‹“æ‰‘å›¾ï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Istio æ•°æ®å¹³é¢çš„ Sidecar å®¹å™¨ä¸­ä¸æ­¢æœ‰ &lt;code&gt;envoy&lt;/code&gt; è¿™ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿˜æœ‰ä¸€ä¸ª &lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;istio-components.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Istio ç»„ä»¶æ‹“æ‰‘å›¾&#34; id=&#34;istio-components&#34;data-img=&#34;istio-components.svg&#34;
         data-caption=&#34;Istio ç»„ä»¶æ‹“æ‰‘å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Istio ç»„ä»¶æ‹“æ‰‘å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹çš„ä½œç”¨å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸º &lt;code&gt;envoy&lt;/code&gt; çš„çˆ¶è¿›ç¨‹ï¼Œè´Ÿè´£ Envoy çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ¥è‡ªæ§åˆ¶å¹³é¢çš„æ¨é€ï¼Œé…ç½®ä»£ç†å’Œè¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;æ”¶é›† Envoy ç»Ÿè®¡ä¿¡æ¯ï¼Œæ±‡æ€» sidecar çš„ç»Ÿè®¡æ•°æ®ä¾› Prometheus æœé›†ï¼›&lt;/li&gt;
&lt;li&gt;å†…ç½®æœ¬åœ° DNS ä»£ç†ï¼Œç”¨äºè§£æ Kubernetes DNS è§£æä¸äº†çš„é›†ç¾¤å†…éƒ¨åŸŸåçš„åœºæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹ Envoy å’Œ DNS ä»£ç†è¿›è¡Œå¥åº·æ£€æŸ¥ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä»¥ä¸ŠåŠŸèƒ½ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º &lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹ä¸»è¦æ˜¯ç”¨äºä¸ Istiod äº¤äº’ï¼Œä¸º Envoy èµ·åˆ°æŒ‡æŒ¥å’Œè¾…åŠ©çš„ä½œç”¨ï¼ŒIstio çš„æ ¸å¿ƒç»„ä»¶æ˜¯ Envoyã€‚é‚£ä¹ˆ Envoy ä¼šä¸ä¼šã€Œæ¼”è€Œä¼˜åˆ™å¯¼ã€ï¼Œä¸å†é…åˆ Istioï¼Œæ„å»ºä¸€å¥—è‡ªå·±çš„æ§åˆ¶å¹³é¢å‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;åœ¨ Sidecar å®¹å™¨ä¸­ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; å°±åƒæ˜¯ Envoy çš„â€œSidecarâ€ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  è¯·è¯»è€…æ€è€ƒä¸€ä¸‹
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;code&gt;pilot-agent&lt;/code&gt; çš„åŠŸèƒ½èƒ½å¦ç›´æ¥å†…ç½®åˆ° Envoy ä¸­ï¼Œä»è€Œå–æ¶ˆ &lt;code&gt;pilot-agent&lt;/code&gt; å‘¢ï¼Ÿ
&lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;envoy-gateway&#34;&gt;Envoy Gateway ç»Ÿä¸€æœåŠ¡ç½‘æ ¼ç½‘å…³&lt;/h2&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œé™¤ Service èµ„æºå¯¹è±¡ä¹‹å¤–ï¼Œæœ€æ—©ç”¨æ¥æš´éœ²é›†ç¾¤ä¸­æœåŠ¡çš„èµ„æºå¯¹è±¡æ˜¯ Ingressã€‚ä½¿ç”¨ Ingress ä½ åªéœ€è¦ä¸ºé›†ç¾¤å¼€æ”¾ä¸€ä¸ªå¯¹å¤–çš„è®¿é—®ç‚¹å³å¯ï¼Œé€šè¿‡ HTTP Hosts å’Œ &lt;code&gt;path&lt;/code&gt; æ¥è·¯ç”±æµé‡åˆ°å…·ä½“çš„æœåŠ¡ã€‚ç›¸å¯¹äºç›´æ¥åœ¨ &lt;code&gt;service&lt;/code&gt; èµ„æºä¸Šæš´éœ²æœåŠ¡æ¥è¯´ï¼Œå¯ä»¥å‡å°‘é›†ç¾¤çš„ç½‘ç»œè®¿é—®ç‚¹ï¼ˆPEPï¼‰&lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt; ï¼Œé™ä½é›†ç¾¤è¢«ç½‘ç»œæ”»å‡»çš„é£é™©ã€‚ä½¿ç”¨ Ingress è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/ingress.svg&#34; data-img=&#34;/blog/beyond-istio-oss/ingress.svg&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes Ingress æµé‡è®¿é—®æµç¨‹å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes Ingress æµé‡è®¿é—®æµç¨‹å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¹‹å‰ï¼ŒAPI Gateway è½¯ä»¶å°±å·²ç»è¢«å¹¿æ³›ç”¨ä½œè¾¹ç¼˜è·¯ç”±äº†ï¼Œåœ¨å¼•ç”¨ Istio æ—¶åˆå¢åŠ äº† Istio è‡ªå®šä¹‰çš„ Gateway èµ„æºï¼Œä½¿å¾—è®¿é—® Istio æœåŠ¡ç½‘æ ¼ä¸­çš„èµ„æºåˆå¤šäº†ä¸€ç§é€‰æ‹©ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/access-cluster.svg&#34; data-img=&#34;/blog/beyond-istio-oss/access-cluster.svg&#34; alt=&#34;image&#34; data-caption=&#34;è®¿é—® Istio ç½‘æ ¼ä¸­çš„æœåŠ¡çš„æ–¹å¼&#34;&gt;
    
  
  &lt;figcaption&gt;è®¿é—® Istio ç½‘æ ¼ä¸­çš„æœåŠ¡çš„æ–¹å¼&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œè¦æƒ³æš´éœ²å•ä¸ª Istio ç½‘æ ¼ä¸­çš„æœåŠ¡ï¼Œ&lt;code&gt;NodePort&lt;/code&gt;ã€&lt;code&gt;LoadBalance&lt;/code&gt;ã€Istio è‡ªå®šä¹‰ Gatewayã€Kubernetes Ingress å’Œ API Gateway è½¯ä»¶ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿå¦‚æœæ˜¯å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ï¼Œå®¢æˆ·ç«¯å¦‚ä½•è®¿é—®ç½‘æ ¼å†…çš„æœåŠ¡ï¼Ÿæˆ‘ä»¬çš„æœåŠ¡ç½‘æ ¼é¢†è¡”ä¸»æ¼” Envoy å·²ç»åœ¨è¿™æ–¹é¢åšè¶³äº†åŠŸå¤«ï¼Œè¢«ä»¥å¤šç§å½¢å¼ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar Proxyï¼šæ­£å¦‚åœ¨&lt;a href=&#34;#are-they-service-mesh&#34; title=&#34;å‰æ–‡ä¸­&#34;&gt;å‰æ–‡ä¸­&lt;/a&gt;
æåˆ°çš„ï¼ŒIstioã€Kumaã€Consul Connect éƒ½ä½¿ç”¨äº† Envoy ä½œä¸º sidecar ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes Ingress Controller/API Gatewayï¼š&lt;a href=&#34;https://github.com/projectcontour/contour&#34; title=&#34;Contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contour&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/emissary-ingress/emissary&#34; title=&#34;Emissary&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Emissary&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/hango-io/hango-gateway&#34; title=&#34;Hango&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hango&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/solo-io/gloo&#34; title=&#34;Gloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo&lt;/a&gt;
 ç­‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›é¡¹ç›®åˆ©ç”¨ Envoy æ¥å®ç°æœåŠ¡ç½‘æ ¼å’Œ API ç½‘å…³ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šåŠŸèƒ½é‡å ï¼ŒåŒæ—¶åˆæœ‰å¾ˆå¤šä¸“æœ‰åŠŸèƒ½ï¼Œæˆ–è€…ç¼ºä¹ç¤¾åŒºå¤šæ ·æ€§ï¼Œè¿™ç§ç°çŠ¶ç”±äº Envoy ç¤¾åŒºæ²¡æœ‰æä¾›æ§åˆ¶å¹³é¢å®ç°è€Œå¯¼è‡´çš„ã€‚ä¸ºäº†æ”¹å˜ç°çŠ¶ï¼ŒEnvoy ç¤¾åŒºå‘èµ·äº† &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; title=&#34;Envoy Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt;
 é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨ç»“åˆç°æœ‰çš„åŸºäº Envoy çš„ API Gateway ç›¸å…³é¡¹ç›®çš„ç»éªŒ &lt;sup id=&#34;fnref:12&#34;&gt;&lt;a href=&#34;#fn:12&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;12&lt;/a&gt;&lt;/sup&gt;ï¼Œåˆ©ç”¨å¸¦æœ‰ä¸€äº› Envoy ç‰¹å®šæ‰©å±•çš„  &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; title=&#34;Kubernetes Gateway API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt;
 é™ä½ Envoy ç”¨æˆ·ä½¿ç”¨ç½‘å…³çš„é—¨æ§›ã€‚å› ä¸º Envoy Gateway ä»ç„¶é€šè¿‡ xDS ä¸‹å‘é…ç½®ç»™ Envoy ä»£ç†ï¼Œå› æ­¤ä½ è¿˜å¯ä»¥ç”¨å®ƒæ¥ç®¡ç†æ”¯æŒ xDS çš„ç½‘å…³ï¼Œå¦‚ Istio Gatewayã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨æ‰€è§çš„ç½‘å…³åŸºæœ¬éƒ½æ˜¯åœ¨å•é›†ç¾¤ä¸­ä½œä¸ºå…¥å£ç½‘å…³ï¼Œå¯¹äºå¤šé›†ç¾¤å’Œå¤šç½‘æ ¼å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚ä¸ºäº†åº”å¯¹å¤šé›†ç¾¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Istio ä¹‹ä¸Šå†æ·»åŠ ä¸€å±‚ç½‘å…³ï¼Œå’Œä¸€ä¸ªå…¨å±€çš„æ§åˆ¶å¹³é¢ä»¥åœ¨å¤šé›†ç¾¤é—´è·¯ç”±æµé‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/t2-gateway.svg&#34; data-img=&#34;/blog/beyond-istio-oss/t2-gateway.svg&#34; alt=&#34;image&#34; data-caption=&#34;å¤šé›†ç¾¤å¤šç½‘æ ¼çš„ä¸¤çº§ç½‘å…³ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;å¤šé›†ç¾¤å¤šç½‘æ ¼çš„ä¸¤çº§ç½‘å…³ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  å…³äºä¸¤çº§ç½‘å…³çš„ç®€è¦ä»‹ç»
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;ul&gt;
&lt;li&gt;ä¸€çº§ç½‘å…³ï¼ˆä¸‹æ–‡ç®€ç§° T1ï¼‰ä½äºåº”ç”¨è¾¹ç¼˜ï¼Œç”¨äºå¤šé›†ç¾¤ç¯å¢ƒã€‚åŒä¸€åº”ç”¨ä¼šåŒæ—¶æ‰˜ç®¡åœ¨ä¸åŒçš„é›†ç¾¤ä¸Šï¼ŒT1 ç½‘å…³å°†å¯¹è¯¥åº”ç”¨çš„è¯·æ±‚æµé‡åœ¨è¿™äº›é›†ç¾¤ä¹‹é—´è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;äºŒçº§ç½‘å…³ï¼ˆä¸‹æ–‡ç®€ç§° T2ï¼‰ä½äºä¸€ä¸ªçš„é›†ç¾¤è¾¹ç¼˜ï¼Œç”¨äºå°†æµé‡è·¯ç”±åˆ°è¯¥é›†ç¾¤å†…ç”±æœåŠ¡ç½‘æ ¼ç®¡ç†çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;é€šè¿‡åœ¨ Istio æ§åˆ¶å¹³é¢ä»¥å¤–å¢åŠ ä¸€å±‚å…¨å±€æ§åˆ¶å¹³é¢å’Œ APIï¼Œæ¥å®ç°å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ç®¡ç†ã€‚å°† T1 ç½‘å…³éƒ¨ç½²ä¸ºé›†ç¾¤ï¼Œå¯ä»¥é˜²æ­¢å•ç‚¹æ•…éšœã€‚æƒ³è¦äº†è§£å…³äºä¸¤çº§ç½‘å…³çš„æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://lib.jimmysong.io/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/&#34; title=&#34;é€šè¿‡ä¸¤çº§ç½‘å…³è®¾è®¡æ¥è·¯ç”±æœåŠ¡ç½‘æ ¼æµé‡&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ä¸¤çº§ç½‘å…³è®¾è®¡æ¥è·¯ç”±æœåŠ¡ç½‘æ ¼æµé‡&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;T1 ç½‘å…³çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Tier1Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1-tier1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-gw-group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-tenant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway-t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;externalServers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cluster1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;75&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cluster2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥é…ç½®å°† &lt;code&gt;servicea.example.com&lt;/code&gt; é€šè¿‡ T1 ç½‘å…³æš´éœ²åˆ°ç½‘æ ¼å¤–ï¼Œå¹¶å°†ç½‘æ ¼å¤–è®¿é—®è¯¥æœåŠ¡çš„æµé‡çš„ &lt;code&gt;75%&lt;/code&gt; è½¬å‘åˆ° &lt;code&gt;cluster1&lt;/code&gt;ï¼Œ&lt;code&gt;25%&lt;/code&gt; çš„æµé‡è½¬å‘åˆ° &lt;code&gt;cluster2&lt;/code&gt;ï¼Œå¦å¤–ä¸ºäº†åº”å¯¹å¤šé›†ç¾¤ä¸­çš„æµé‡ã€æœåŠ¡å’Œå®‰å…¨é…ç½®ï¼ŒTetrate æ——èˆ°äº§å“ Tetrate Service Bridge ä¸­è¿˜å¢åŠ äº† ä¸€ç³»åˆ— Group APIï¼Œè¯¦è§ &lt;a href=&#34;https://docs.tetrate.io/service-bridge/1.4.x&#34; title=&#34;TSB æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ecosystem&#34;&gt;Istio å¼€æºç”Ÿæ€&lt;/h2&gt;
&lt;p&gt;Istio å¼€æºåœ¨è‡³ä»Šå·²ç»äº”å¹´å¤šäº†ï¼Œè¿‘ä¸¤å¹´æ¥å‡ºç°äº†å¾ˆå¤šåŸºäº Istio çš„å¼€æºé¡¹ç›®ï¼Œå…¶ä¸­æ¯”è¾ƒä»£è¡¨æ€§çš„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘æ˜“å¼€æºçš„ Slime&lt;/li&gt;
&lt;li&gt;è…¾è®¯å¼€æºçš„ Aeraki&lt;/li&gt;
&lt;li&gt;Istio å®˜æ–¹å¯¹ Wasm æ’ä»¶çš„æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒä»¬çš„å‡ºç°ä½¿å¾— Istio æ›´åŠ æ™ºèƒ½åŒ–å¹¶æ‰©å±•äº† Istio çš„é€‚ç”¨èŒƒå›´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;slime&#34;&gt;Slime&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/slime-io/slime/&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt;
 æ˜¯ç”±ç½‘æ˜“æ•°å¸†å¾®æœåŠ¡å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾åŸºäº Istio çš„æ™ºèƒ½ç½‘æ ¼ç®¡ç†å™¨ã€‚Slime åŸºäº Kubernetes Operator å®ç°ï¼Œå¯ä½œä¸º Istio çš„ CRD ç®¡ç†å™¨ï¼Œæ— é¡»å¯¹ Istio åšä»»ä½•å®šåˆ¶åŒ–æ”¹é€ ï¼Œå°±å¯ä»¥å®šä¹‰åŠ¨æ€çš„æœåŠ¡æ²»ç†ç­–ç•¥ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨ä¾¿æ·ä½¿ç”¨ Istio å’Œ Envoy é«˜é˜¶åŠŸèƒ½çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å‰æ–‡çš„&lt;a href=&#34;#control-plane-perf-optimizing&#34; title=&#34;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–&#34;&gt;æ§åˆ¶å¹³é¢æ€§èƒ½ä¼˜åŒ–&lt;/a&gt;
ä¸­æåˆ°äº†é€šè¿‡ã€Œå‡å°‘éœ€è¦æ¨é€çš„é…ç½®ã€çš„æ–¹å¼æ¥ä¼˜åŒ– Istio çš„æ€§èƒ½ï¼Œä½†æ˜¯ Istio æ— æ³•åšåˆ°è‡ªåŠ¨è¯†åˆ«æ— æ³•ä¾èµ–ä»¥æœ€ä¼˜åŒ–éœ€è¦æ¨é€åˆ°æ¯ä¸ª sidecar çš„ä»£ç†é…ç½®ï¼ŒSlime æä¾›äº† &lt;code&gt;lazyload&lt;/code&gt; æ§åˆ¶å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°é…ç½®æ‡’åŠ è½½ï¼Œç”¨æˆ·æ— é¡»æ‰‹åŠ¨é…ç½® &lt;code&gt;SidecarScope&lt;/code&gt; &lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt;ï¼ŒIstio å¯ä»¥æŒ‰éœ€åŠ è½½æœåŠ¡é…ç½®å’ŒæœåŠ¡å‘ç°ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Slime ä½œä¸º Istio çš„ç®¡ç†å¹³é¢æ›´æ–°æ•°æ®å¹³é¢é…ç½®çš„æµç¨‹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/slime-process.svg&#34; data-img=&#34;/blog/beyond-istio-oss/slime-process.svg&#34; alt=&#34;image&#34; data-caption=&#34;ä½¿ç”¨ Slime æ›´æ–° Istio æ•°æ®å¹³é¢é…ç½®çš„æµç¨‹å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;ä½¿ç”¨ Slime æ›´æ–° Istio æ•°æ®å¹³é¢é…ç½®çš„æµç¨‹å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼ŒGlobal Proxy ä½¿ç”¨ Envoy æ„å»ºï¼Œåœ¨æ¯ä¸ªéœ€è¦å¯åŠ¨é…ç½®æ‡’åŠ è½½çš„å‘½åç©ºé—´ä¸­éƒ¨ç½²ä¸€ä¸ªæˆ–åœ¨æ•´ä¸ªç½‘æ ¼ä¸­åªéƒ¨ç½²ä¸€ä¸ªï¼Œæ‰€æœ‰ç¼ºå¤±æœåŠ¡å‘ç°ä¿¡æ¯çš„è°ƒç”¨ï¼ˆä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®æœåŠ¡è°ƒç”¨å…³ç³»ï¼‰ï¼Œéƒ½ä¼šè¢«å…œåº•è·¯ç”±åŠ«æŒåˆ° Global Proxyï¼Œç»è¿‡å…¶é¦–æ¬¡è½¬å‘åï¼ŒSlime ä¾¿å¯æ„ŸçŸ¥åˆ°è¢«è°ƒç”¨æ–¹çš„ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å…¶å¯¹åº”æœåŠ¡çš„ VirtualServiceï¼Œæ‰¾åˆ°æœåŠ¡åå’ŒçœŸå®åç«¯çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸¤è€…çš„éƒ½åŠ å…¥ SidecarScopeï¼Œä»¥åè¯¥æœåŠ¡çš„è°ƒç”¨å°±ä¸å†éœ€è¦ç»è¿‡ Global Proxy äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®å¹³é¢é…ç½®æ›´æ–°çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Slime Operator æ ¹æ®ç®¡ç†å‘˜çš„é…ç½®åœ¨ Kubernetes ä¸­å®Œæˆ Slime ç»„ä»¶çš„åˆå§‹åŒ–ï¼Œå¼€å‘è€…åˆ›å»ºç¬¦åˆ Slime CRD è§„èŒƒçš„é…ç½®å¹¶åº”ç”¨åˆ° Kubernetes é›†ç¾¤ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Slime æŒç»­ç›‘å¬ Slime CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Slime æŸ¥è¯¢ Prometheus ä¸­ä¿å­˜çš„ç›¸å…³æœåŠ¡çš„ç›‘æ§æ•°æ®ï¼Œç»“åˆ Slime CRD ä¸­è‡ªé€‚åº”éƒ¨åˆ†çš„é…ç½®ï¼Œå°† Slime CRD è½¬æ¢ä¸º Istio CRDï¼ŒåŒæ—¶å°†å…¶æ¨é€åˆ° Global Proxy ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istio ç›‘å¬ Istio CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Istio å°†ä»£ç†çš„é…ç½®ä¿¡æ¯æ¨é€åˆ°æ•°æ®å¹³é¢ç›¸åº”çš„ Sidecar Proxy ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºæ•°æ®å¹³é¢ä¸­çš„æ‰€æœ‰æœåŠ¡çš„é¦–æ¬¡è°ƒç”¨éƒ½é€šè¿‡ Global Proxyï¼Œè¯¥ Proxy å¯ä»¥è®°å½•æ‰€æœ‰æœåŠ¡çš„è°ƒç”¨å’Œä¾èµ–ä¿¡æ¯ï¼Œæ ¹æ®è¯¥ä¾èµ–ä¿¡æ¯æ›´æ–° Istio ä¸­ Sidecar èµ„æºçš„é…ç½®ï¼›å½“æŸä¸ªæœåŠ¡çš„è°ƒç”¨é“¾è¢« VirtualService ä¸­çš„è·¯ç”±ä¿¡æ¯é‡æ–°å®šä¹‰æ—¶ï¼ŒGlobal Proxy åŸæœ‰è®°å½•å°±å¤±æ•ˆäº†ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤è¯¥æœåŠ¡çš„è°ƒç”¨å…³ç³»ã€‚Slime åˆ›å»ºäº†åä¸º &lt;code&gt;ServiceFence&lt;/code&gt; çš„ CRD æ¥ç»´æŠ¤æœåŠ¡è°ƒç”¨å…³ç³»ä»¥è§£å†³æœåŠ¡ä¿¡æ¯ç¼ºå¤±é—®é¢˜ï¼Œè¯¦è§ &lt;a href=&#34;https://jimmysong.io/blog/slime-intro/&#34; title=&#34;Slime ç®€ä»‹&#34;&gt;Slime ç®€ä»‹&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;aeraki&#34;&gt;Aeraki&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aeraki-mesh/aeraki&#34; title=&#34;Aeraki Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki Mesh&lt;/a&gt;
 æ˜¯è…¾è®¯äº‘åœ¨ 2021 å¹´ 3 æœˆå¼€æºçš„ä¸€ä¸ªæœåŠ¡ç½‘æ ¼é¢†åŸŸçš„é¡¹ç›®ï¼ŒåŸºäº Istio æ‰©å±•å…¶å¯¹ä¸ƒå±‚åè®®çš„æ”¯æŒï¼Œä¸“æ³¨äºè§£å†³ Istio ä¸­çš„&lt;strong&gt;é HTTP åè®®&lt;/strong&gt;çš„æœåŠ¡æ²»ç†ï¼Œå·²äº 2022 å¹´ 6 æœˆè¿›å…¥ CNCF Sandboxã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;aeraki-arch.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾&#34; width=&#34;60%&#34;data-img=&#34;aeraki-arch.svg&#34;
         data-caption=&#34;Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Aeraki å°†é HTTP åè®®çº³å…¥åˆ° Istio ç½‘æ ¼ä¸­çš„æµç¨‹å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;å…¶è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Aeraki çš„ X2Istio ç»„ä»¶å¯¹æ¥æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè·å–é HTTP æœåŠ¡çš„æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆ ServiceEntry å‘ Istio ä¸­æ³¨å†Œï¼›&lt;/li&gt;
&lt;li&gt;Aeraki ä½œä¸º Istio ä¹‹ä¸Šçš„ç®¡ç†å¹³é¢ï¼Œå®ƒä» Istio ä¸­è·å– ServiceEntry é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;Aeraki é€šè¿‡ç«¯å£å‘½åè§„åˆ¤æ–­æœåŠ¡çš„åè®®ç±»å‹ï¼ˆå¦‚ &lt;code&gt;tcp-metaprotocol-dubbo&lt;/code&gt;ï¼‰ï¼Œç„¶åç”Ÿæˆ MetaProtocol Proxy Filterï¼ˆå…¼å®¹ EnvoyFilterï¼‰é…ç½®ï¼ŒåŒæ—¶ä¿®æ”¹ RDS åœ°å€ï¼Œå°†å…¶æŒ‡å‘ Aerakiï¼›&lt;/li&gt;
&lt;li&gt;Istio ä½¿ç”¨ xDS åè®®å°†é…ç½®ï¼ˆLDSã€CDSã€EDS ç­‰ï¼‰ä¸‹å‘ç»™æ•°æ®å¹³é¢ï¼›&lt;/li&gt;
&lt;li&gt;Aeraki æ ¹æ®æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯å’Œç”¨æˆ·è®¾ç½®ç”Ÿæˆè·¯ç”±è§„åˆ™ï¼Œé€šè¿‡ RDS å‘é€ç»™æ•°æ®å¹³é¢ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Istio ä¸­æ¥å…¥é HTTP æœåŠ¡çš„æ•´ä¸ªæµç¨‹ä¸­çš„å…³é”®æ˜¯ &lt;strong&gt;MetaProtocol Proxy&lt;/strong&gt; ã€‚Istio é»˜è®¤æ”¯æŒ HTTP/HTTP2ã€TCP å’Œ gRPC åè®®ï¼Œå®éªŒæ€§æ”¯æŒ Mongoã€MySQL å’Œ Redis åè®® &lt;sup id=&#34;fnref:14&#34;&gt;&lt;a href=&#34;#fn:14&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;14&lt;/a&gt;&lt;/sup&gt;ã€‚è‹¥è¦ä½¿ç”¨ Istio è·¯ç”±å…¶ä»–åè®®çš„æµé‡ï¼Œä¸ä»…éœ€è¦ä¿®æ”¹ Istio æ§åˆ¶å¹³é¢å¹¶æ‰©å±• Envoyï¼Œè¿™å°†å¸¦æ¥å·¨å¤§çš„å·¥ä½œé‡ï¼Œè€Œä¸”ä¸åŒåè®®å…±äº«é€šç”¨çš„æ§åˆ¶é€»è¾‘ï¼Œè¿™è¿˜ä¼šå¸¦æ¥å¾ˆå¤šé‡å¤æ€§å·¥ä½œã€‚MetaProtocol Proxy æ˜¯åœ¨ Envoy ä»£ç åŸºç¡€ä¸Šçš„æ‰©å±•ï¼Œä¸ºä¸ƒå±‚åè®®ç»Ÿä¸€å®ç°äº†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€RDS åŠ¨æ€è·¯ç”±ã€æµé‡é•œåƒã€æ•…éšœæ³¨å…¥ã€æœ¬åœ°/å…¨å±€é™æµç­‰åŸºç¡€èƒ½åŠ›ï¼Œå¤§å¤§é™ä½äº†åœ¨ Envoy ä¸Šå¼€å‘ç¬¬ä¸‰æ–¹åè®®çš„éš¾åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„ MetaProtocol Proxy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/metaprotocol-proxy.svg&#34; data-img=&#34;/blog/beyond-istio-oss/metaprotocol-proxy.svg&#34; alt=&#34;image&#34; data-caption=&#34;MetaProtocol Proxy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;MetaProtocol Proxy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬æƒ³æ‰©å±• Istio ä½¿å…¶æ”¯æŒ Kafkaã€Dubboã€Thrift ç­‰å…¶ä»–ä¸ƒå±‚åè®®æ—¶ï¼Œåªéœ€è¦å®ç°ä¸Šå›¾ä¸­çš„ç¼–è§£ç çš„æ¥å£ï¼ˆDecode å’Œ Encodeï¼‰ï¼Œå°±å¯ä»¥åŸºäº MetaProtocol å¿«é€Ÿå¼€å‘ä¸€ä¸ªç¬¬ä¸‰æ–¹åè®®æ’ä»¶ã€‚MetaProtocol Proxy æ˜¯åœ¨ Envoy åŸºç¡€ä¸Šçš„æ‰©å±•ï¼Œå› æ­¤ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨å¤šç§è¯­è¨€ä¸ºå…¶å¼€å‘è¿‡æ»¤å™¨ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;EnvoyFilter&lt;/code&gt; èµ„æºå°†é…ç½®ä¸‹å‘åˆ°æ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;wasmplugin-api&#34;&gt;WasmPlugin API&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; title=&#34;WasmPlugin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt;
 æ˜¯ Istio 1.12 ç‰ˆæœ¬å¼•å…¥çš„ APIï¼Œä½œä¸ºä»£ç†æ‰©å±•æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå°†è‡ªå®šä¹‰å’Œç¬¬ä¸‰æ–¹çš„ Wasm æ¨¡å—æ·»åŠ åˆ°æ•°æ®å¹³é¢ä¸­ã€‚ä¸‹å›¾ä¸­å±•ç¤ºäº†å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ WasmPluginã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/wasmplugin.svg&#34; data-img=&#34;/blog/beyond-istio-oss/wasmplugin.svg&#34; alt=&#34;image&#34; data-caption=&#34;åœ¨ Istio ä¸­ä½¿ç”¨ WasmPlugin çš„æµç¨‹å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;åœ¨ Istio ä¸­ä½¿ç”¨ WasmPlugin çš„æµç¨‹å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·ä½¿ç”¨ &lt;a href=&#34;https://github.com/proxy-wasm&#34; title=&#34;Proxy-Wasm SDK&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy-Wasm SDK&lt;/a&gt;
ï¼ˆç›®å‰æœ‰ AssemblyScriptã€C++ã€Rustã€Zig å’Œ Go è¯­è¨€ç‰ˆæœ¬ï¼‰æ¥å¼€å‘æ‰©å±•ï¼Œå¹¶æ„å»ºæˆ OCI é•œåƒï¼ˆå¦‚ Docker é•œåƒï¼‰ä¸Šä¼ åˆ°é•œåƒä»“åº“ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·ç¼–å†™ &lt;code&gt;WasmPlugin&lt;/code&gt; é…ç½®å¹¶åº”ç”¨åˆ° Istioï¼›&lt;/li&gt;
&lt;li&gt;Istio æ§åˆ¶å¹³é¢æ ¹æ® &lt;code&gt;WasmPlugin&lt;/code&gt; é…ç½®ä¸­çš„å·¥ä½œè´Ÿè½½é€‰æ‹©é…ç½®ï¼Œå°† Wasm æ¨¡å—æ³¨å…¥åˆ°æŒ‡å®šçš„ Pod ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Sidecar ä¸­çš„ &lt;code&gt;pilot-agent&lt;/code&gt; &lt;sup id=&#34;fnref:15&#34;&gt;&lt;a href=&#34;#fn:15&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;15&lt;/a&gt;&lt;/sup&gt; ä»è¿œç¨‹æˆ–æœ¬åœ°æ–‡ä»¶ä¸­è·å– Wasm æ¨¡å—å¹¶å°†å…¶åŠ è½½åˆ° Envoy ä¸­è¿è¡Œï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;whos-should-use-istio&#34;&gt;è°åº”è¯¥ä½¿ç”¨ Istioï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¥½äº†ï¼Œè¯´äº†è¿™ä¹ˆè¯´ï¼Œè¿™è·Ÿä½ æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼ŸIstio è·Ÿä½ çš„å…³ç³»å–å†³äºä½ çš„è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ æ˜¯å¹³å°è´Ÿè´£äººï¼Œåº”ç”¨æœåŠ¡ç½‘æ ¼åï¼Œå¯èƒ½å¢å¼ºä½ çš„å¹³å°å¯è§‚æµ‹æ€§ï¼Œå…·æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°æ¥ç®¡ç†å¾®æœåŠ¡ï¼Œä½ å°†æ˜¯ç›´æ¥å—ç›Šè€…ï¼Œä¹Ÿåº”è¯¥æ˜¯æœåŠ¡ç½‘æ ¼çš„ä¸»è¦å®æ–½è€…ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åº”ç”¨ç¨‹åºå¼€å‘è€…ï¼Œä¹Ÿä¼šä»æœåŠ¡ç½‘æ ¼ä¸­æ”¶ç›Šï¼Œå› ä¸ºä½ å¯ä»¥æ›´åŠ ä¸“å±äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸ç”¨æ‹…å¿ƒé‡è¯•ç­–ç•¥ã€TLS ç­‰å…¶ä»–éåŠŸèƒ½æ€§é—®é¢˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/adopt.svg&#34; data-img=&#34;/blog/beyond-istio-oss/adopt.svg&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è·¯å¾„&#34;&gt;
    
  
  &lt;figcaption&gt;æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è·¯å¾„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ˜¯å¦é‡‡ç”¨æœåŠ¡ç½‘æ ¼å–å†³äºä½ å…¬å¸çš„æŠ€æœ¯å‘å±•é˜¶æ®µï¼Œåº”ç”¨æ˜¯å¦å®ç°å®¹å™¨åŒ–å’Œå¾®æœåŠ¡ï¼Œå¯¹å¤šè¯­è¨€çš„éœ€æ±‚ï¼Œæ˜¯å¦éœ€è¦ mTLS ä»¥åŠå¯¹æ€§èƒ½æŸè€—çš„æ¥çº³åº¦ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-mesh-positioning&#34;&gt;æœåŠ¡ç½‘æ ¼åœ¨äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­çš„å®šä½&lt;/h2&gt;
&lt;p&gt;æŠ€æœ¯çš„å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œè¿‘ä¸¤å¹´æ¥æœ‰ä¸€äº›æ–°æŠ€æœ¯å‡ºç°ï¼Œä¼¼ä¹æŒ‘æˆ˜äº†æœåŠ¡ç½‘æ ¼çš„åœ°ä½ï¼Œæ›´æœ‰äººå£°ç§°å¯ä»¥ç›´æ¥å–ä»£ç°æœ‰ç»å…¸çš„ sidecar æ¨¡å¼çš„æœåŠ¡ç½‘æ ¼ &lt;sup id=&#34;fnref:16&#34;&gt;&lt;a href=&#34;#fn:16&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;16&lt;/a&gt;&lt;/sup&gt;ï¼Œæˆ‘ä»¬ä¸è¦è¢«å¤–ç•Œå˜ˆæ‚çš„å£°éŸ³æ‰€è¿·æƒ‘ï¼Œè®¤æ¸…æœåŠ¡ç½‘æ ¼åœ¨äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­çš„å®šä½ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;ä¸€å‘³åœ°æ¨å¹¿æŸé¡¹æŠ€æœ¯è€Œå¿½ç•¥å®ƒçš„é€‚ç”¨åœºæ™¯ï¼Œå°±æ˜¯è€æµæ°“ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯äº‘åŸç”ŸæŠ€æœ¯å †æ ˆã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;cloud-native-stack.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;äº‘åŸç”ŸæŠ€æœ¯å †æ ˆç¤ºæ„å›¾&#34; width=&#34;60%&#34;data-img=&#34;cloud-native-stack.svg&#34;
         data-caption=&#34;äº‘åŸç”ŸæŠ€æœ¯å †æ ˆç¤ºæ„å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            äº‘åŸç”ŸæŠ€æœ¯å †æ ˆç¤ºæ„å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨äº‘åŸç”ŸæŠ€æœ¯å †æ ˆå›¾ä¸­çš„ã€Œäº‘åŸºç¡€è®¾æ–½ã€ã€ã€Œä¸­é—´ä»¶ã€å’Œã€Œåº”ç”¨ã€å±‚éƒ½åˆ—ä¸¾äº†ä¸€äº›æ ‡å¿—æ€§çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®æ„å»ºäº†å®ƒä»¬æ‰€åœ¨é¢†åŸŸçš„æ ‡å‡†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨äº‘åŸºç¡€è®¾æ–½é¢†åŸŸï¼ŒKubernetes ç»Ÿä¸€äº†å®¹å™¨ç¼–æ’å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ ‡å‡†ï¼ŒOperator æ¨¡å¼å¥ å®šäº†æ‰©å±• Kubernetes API åŠç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥çš„æ ‡å‡†ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ä¸­é—´ä»¶é¢†åŸŸï¼ŒæœåŠ¡ç½‘æ ¼æ‰¿æ‹…èµ·äº†äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­çš„ä¸ƒå±‚ç½‘ç»œã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨ç­‰å¤šä¸ªæ–¹é¢çš„éƒ¨åˆ†æˆ–å…¨éƒ¨è´£ä»»ï¼Œå®ƒè¿è¡Œåœ¨åº”ç”¨ç¨‹åºä¸‹å±‚ï¼Œå¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´å‡ ä¹æ˜¯æ— æ„ŸçŸ¥çš„ï¼›Daprï¼ˆåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼‰å®šä¹‰äº‘åŸç”Ÿä¸­é—´ä»¶çš„èƒ½åŠ›æ¨¡å‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨åº”ç”¨ä¸­é›†æˆ Dapr çš„å¤šè¯­è¨€ SDKï¼Œé¢å‘ Dapr æä¾›çš„åˆ†å¸ƒå¼èƒ½åŠ›ç¼–ç¨‹ï¼Œè€Œä¸ç”¨å…³å¿ƒåº”ç”¨æ‰€è¿è¡Œçš„ç¯å¢ƒåŠå¯¹æ¥çš„åç«¯åŸºç¡€è®¾æ–½ã€‚å› ä¸ºåœ¨å’Œåº”ç”¨ç¨‹åºè¿è¡Œåœ¨åŒä¸€ä¸ª Pod ä¸­çš„ Dapr è¿è¡Œæ—¶ï¼ˆSidecar æ¨¡å¼éƒ¨ç½²ï¼Œå…¶ä¸­åŒ…å«å„ç§æ„å»ºå—ï¼‰è‡ªåŠ¨å¸®æˆ‘ä»¬å¯¹æ¥äº†åç«¯ç»„ä»¶ï¼ˆComponentï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨åº”ç”¨ç¨‹åºé¢†åŸŸï¼šOAM æ—¨åœ¨å»ºç«‹ä¸€ä¸ªåº”ç”¨æ¨¡å‹æ ‡å‡†ï¼Œé€šè¿‡ç»„ä»¶ã€ç‰¹å¾ã€ç­–ç•¥å’Œå·¥ä½œæµæ¥ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯¦è§&lt;a href=&#34;https://lib.jimmysong.io/cloud-native-handbook/intro/define-cloud-native-app/&#34; title=&#34;äº‘åŸç”Ÿèµ„æ–™åº“&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿèµ„æ–™åº“&lt;/a&gt;
ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Istio åœ¨äº‘åŸç”Ÿéƒ¨ç½²ä¸­å®šä½äºä¸ƒå±‚ç½‘æ ¼ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/istio-role.svg&#34; data-img=&#34;/blog/beyond-istio-oss/istio-role.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­å®šä½åœ¨ä¸ƒå±‚ç½‘ç»œ&#34;&gt;
    
  
  &lt;figcaption&gt;Istio åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­å®šä½åœ¨ä¸ƒå±‚ç½‘ç»œ&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  Dapr ä¸ Istio æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;p&gt;åœ¨äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­ï¼ŒIstio å’Œ Dapr åŒæ—¶ä½äºä¸­é—´ä»¶å±‚ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤šåŒºåˆ«å’Œè”ç³»ã€‚&lt;/p&gt;
&lt;p&gt;Istio å’Œ Dapr ä¹‹é—´çš„ç›¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio å’Œ Dapr éƒ½å¯ä»¥ä½¿ç”¨ Sidecar æ¨¡å¼çš„éƒ¨ç½²æ¨¡å‹ï¼›&lt;/li&gt;
&lt;li&gt;åŒå±äºä¸­é—´ä»¶ï¼ŒåŒæ ·å¯ä»¥ç®¡ç†æœåŠ¡é—´é€šä¿¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å’Œ Dapr ä¹‹é—´çš„ä¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®æ ‡ä¸åŒï¼šIstio çš„ç›®æ ‡æ˜¯æ„å»ºé›¶ä¿¡ä»»ç½‘ç»œï¼Œå®šä¹‰æœåŠ¡é—´é€šä¿¡æ ‡å‡†ï¼ŒDapr ç›®æ ‡æ˜¯æ„å»ºæ ‡å‡†çš„ä¸­é—´ä»¶èƒ½åŠ›çš„ APIï¼›&lt;/li&gt;
&lt;li&gt;æ¶æ„ä¸åŒï¼šIstio = Envoy + é€æ˜æµé‡åŠ«æŒ + æ§åˆ¶å¹³é¢ï¼ŒDapr = å¤šè¯­è¨€ SDK + æ ‡å‡†åŒ– API + åˆ†å¸ƒå¼èƒ½åŠ›ç»„ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;é¢å‘çš„äººç¾¤ä¸åŒï¼šä½†æ˜¯åº”ç”¨ Istio å¯¹äºå¼€å‘è€…æ¥è¯´å‡ ä¹æ— æ„ŸçŸ¥ï¼Œä¸»è¦éœ€è¦åŸºç¡€è®¾æ–½è¿ç»´å›¢é˜Ÿå®æ–½ï¼Œè€Œåº”ç”¨ Dapr éœ€è¦å¼€å‘è€…è‡ªä¸»é€‰æ‹©é›†æˆ Dapr SDKï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;istio-future&#34;&gt;æœåŠ¡ç½‘æ ¼çš„æœªæ¥&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨å‰æ–‡ä¸­ä»‹ç»äº† Istio çš„å‘å±•è„‰ç»œåŠå¼€æºç”Ÿæ€ï¼Œæ¥ä¸‹æ¥æˆ‘å°†ä¸ºå¤§å®¶ä»‹ç» Istio æœåŠ¡ç½‘æ ¼çš„æœªæ¥è¶‹åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºé›¶ä¿¡ä»»ç½‘ç»œ&lt;/li&gt;
&lt;li&gt;æˆä¸ºæ··åˆäº‘ç®¡ç†å¹³å°çš„ç½‘ç»œåŸºç¡€è®¾æ–½&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;æœåŠ¡ç½‘æ ¼çš„æœªæ¥åœ¨äºæˆä¸ºé›¶ä¿¡ä»»ç½‘ç»œå’Œæ··åˆäº‘çš„åŸºç¡€è®¾æ–½ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ç¬”è€…æ‰€åœ¨çš„å…¬å¸ä¼ä¸šçº§æœåŠ¡ç½‘æ ¼æä¾›å•† &lt;a href=&#34;https://www.tetrate.io/&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;
 çš„åŠªåŠ›æ–¹å‘ï¼Œæˆ‘ä»¬è‡´åŠ›äºæ„å»ºä¸€ä¸ªåŸºäºé›¶ä¿¡ä»»çš„é€‚ç”¨äºä»»æ„ç¯å¢ƒã€ä»»æ„è´Ÿè½½çš„åº”ç”¨æ„ŸçŸ¥ç½‘ç»œã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ Tetrate æ——èˆ°äº§å“ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/tsb.svg&#34; data-img=&#34;/blog/beyond-istio-oss/tsb.svg&#34; alt=&#34;image&#34; data-caption=&#34;TSB æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;TSB æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Tetrate å…¬å¸æ˜¯ç”± Istio é¡¹ç›®çš„å‘èµ·äººåˆ›ç«‹çš„ï¼ŒTSB æ˜¯åŸºäºå¼€æºçš„ Istioã€Envoy å’Œ Apache SkyWalking å¼€å‘çš„ã€‚æˆ‘ä»¬åŒæ—¶ç§¯æå¾—è´¡çŒ®ä¸Šæ¸¸ç¤¾åŒºï¼Œå¹¶å‚ä¸äº†æ—¨åœ¨ç®€åŒ–å°† Envoy ç½‘å…³ä½¿ç”¨çš„ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; title=&#34;Envoy Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt;
 é¡¹ç›®çš„åˆ›å»ºï¼ˆä¸Šå›¾ä¸­çš„ XCP å³ä½¿ç”¨ Envoy æ„å»ºçš„ç½‘å…³ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;zero-trust&#34;&gt;é›¶ä¿¡ä»»&lt;/h2&gt;
&lt;p&gt;é›¶ä¿¡ä»»ï¼ˆZero Trustï¼‰æ˜¯ IstioCon 2022 é‡Œçš„ä¸€ä¸ªé‡è¦è¯é¢˜ï¼ŒIstio æ­£åœ¨æˆä¸ºé›¶ä¿¡ä»»ç½‘ç»œçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  ä»€ä¹ˆæ˜¯é›¶ä¿¡ä»»ï¼Ÿ
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  é›¶ä¿¡ä»»ï¼ˆZero Trustï¼‰æ˜¯ä¸€ç§å®‰å…¨ç†å¿µï¼Œè€Œä¸æ˜¯ä¸€ç§æ‰€æœ‰å®‰å…¨å›¢é˜Ÿéƒ½è¦éµå¾ªçš„æœ€ä½³å®è·µã€‚é›¶ä¿¡ä»»æ¦‚å¿µçš„æå‡ºæ˜¯ä¸ºäº†ç»™äº‘åŸç”Ÿä¸–ç•Œå¸¦æ¥æ›´å®‰å…¨çš„ç½‘ç»œã€‚é›¶ä¿¡ä»»æ˜¯ä¸€ç§ç†è®ºçŠ¶æ€ï¼Œå³ç½‘ç»œå†…çš„æ‰€æœ‰æ¶ˆè´¹è€…ä¸ä»…æ²¡æœ‰ä»»ä½•æƒé™ï¼Œè€Œä¸”ä¹Ÿä¸å…·å¤‡å¯¹å‘¨å›´ç½‘ç»œçš„æ„ŸçŸ¥ã€‚é›¶ä¿¡ä»»çš„ä¸»è¦æŒ‘æˆ˜æ˜¯å°±è¶Šæ¥è¶Šç»†åŒ–çš„æˆæƒå’Œå’Œå¯¹ç”¨æˆ·æˆæƒçš„æ—¶é—´é™åˆ¶ã€‚å…³äºæ›´å¤šé›¶ä¿¡ä»»çš„ä»‹ç»ï¼Œè¯·é˜…è¯»&lt;a href=&#34;https://jimmysong.io/blog/what-is-zero-trust/&#34; title=&#34;è¿™ç¯‡åšå®¢&#34;&gt;è¿™ç¯‡åšå®¢&lt;/a&gt;
ã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;authn&#34;&gt;èº«ä»½è®¤è¯&lt;/h3&gt;
&lt;p&gt;é›¶ä¿¡ä»»ç½‘ç»œä¸­æœ€é‡è¦çš„æ˜¯&lt;strong&gt;é¢å‘èº«ä»½çš„æ§åˆ¶&lt;/strong&gt;è€Œä¸æ˜¯é¢å‘ç½‘ç»œçš„æ§åˆ¶ã€‚Istio 1.14 ä¸­å¢åŠ äº†å¯¹ SPIRE çš„æ”¯æŒï¼ŒSPIREï¼ˆSPIFFE Runtime Environmentï¼ŒCNCF å­µåŒ–é¡¹ç›®ï¼‰æ˜¯ SPIFFEï¼ˆSecure Production Identity Framework For Everyoneï¼ŒCNCF å­µåŒ–é¡¹ç›®ï¼‰çš„ä¸€ä¸ªå®ç°ã€‚åœ¨ Kubernetes ä¸­æˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/auth/serviceaccount/&#34; title=&#34;ServiceAccount&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServiceAccount&lt;/a&gt;
 ä¸º Pod ä¸­çš„å·¥ä½œè´Ÿè½½æä¾›èº«ä»½ä¿¡æ¯ï¼Œå…¶æ ¸å¿ƒæ˜¯åŸºäº Tokenï¼ˆä½¿ç”¨ Secret èµ„æºå­˜å‚¨ï¼‰æ¥è¡¨ç¤ºè´Ÿè½½èº«ä»½ã€‚è€Œ Token æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„èµ„æºï¼Œå¯¹äºå¤šé›†ç¾¤åŠè¿è¡Œåœ¨é Kubernetes ç¯å¢ƒï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºï¼‰ä¸­çš„è´Ÿè½½ï¼Œå¦‚ä½•ç»Ÿä¸€å®ƒä»¬çš„èº«ä»½ï¼Ÿè¿™å°±æ˜¯ SPIFFE è¦è§£å†³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;SPIFFE çš„ç›®çš„æ˜¯åŸºäºé›¶ä¿¡ä»»çš„ç†å¿µï¼Œå»ºç«‹ä¸€ä¸ªå¼€æ”¾ã€ç»Ÿä¸€çš„å·¥ä½œè´Ÿè½½èº«ä»½æ ‡å‡†ï¼Œè¿™æœ‰åŠ©äºå»ºç«‹ä¸€ä¸ªé›¶ä¿¡ä»»çš„å…¨é¢èº«ä»½åŒ–çš„æ•°æ®ä¸­å¿ƒç½‘ç»œã€‚SPIFFE çš„æ ¸å¿ƒæ˜¯é€šè¿‡ç®€å• API å®šä¹‰äº†ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçŸ­æš‚çš„åŠ å¯†èº«ä»½æ–‡ä»¶â€”â€” SVIDï¼ˆSPFFE Verifiable Identity Documentï¼‰ï¼Œç”¨ä½œå·¥ä½œè´Ÿè½½è®¤è¯æ—¶ä½¿ç”¨çš„èº«ä»½æ–‡ä»¶ï¼ˆåŸºäº X.509 è¯ä¹¦æˆ– JWT ä»¤ç‰Œï¼‰ã€‚SPIRE å¯ä»¥æ ¹æ®ç®¡ç†å‘˜å®šä¹‰çš„ç­–ç•¥è‡ªåŠ¨è½®æ¢ SVID è¯ä¹¦å’Œç§˜é’¥ï¼ŒåŠ¨æ€åœ°æä¾›å·¥ä½œè´Ÿè½½æ ‡è¯†ï¼ŒåŒæ—¶ Istio å¯ä»¥é€šè¿‡ SPIRE åŠ¨æ€çš„æ¶ˆè´¹è¿™äº›å·¥ä½œè´Ÿè½½æ ‡è¯†ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº Kubernetes çš„ SPIRE æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/spire-with-kubernetes.svg&#34; data-img=&#34;/blog/beyond-istio-oss/spire-with-kubernetes.svg&#34; alt=&#34;image&#34; data-caption=&#34;SPIRE éƒ¨ç½²åœ¨ Kubernetes ä¸­çš„æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;SPIRE éƒ¨ç½²åœ¨ Kubernetes ä¸­çš„æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio ä¸­åŸå…ˆæ˜¯ä½¿ç”¨ Istiod ä¸­ Citadel æœåŠ¡ &lt;sup id=&#34;fnref:17&#34;&gt;&lt;a href=&#34;#fn:17&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;17&lt;/a&gt;&lt;/sup&gt; è´Ÿè´£æœåŠ¡ç½‘æ ¼ä¸­è¯ä¹¦ç®¡ç†ï¼Œé€šè¿‡ xDSï¼ˆå‡†ç¡®çš„è¯´æ˜¯ SDS APIï¼‰åè®®å°†è¯ä¹¦ä¸‹å‘ç»™æ•°æ®å¹³é¢ã€‚æœ‰äº† SPIRE ä¹‹åï¼Œè¯ä¹¦ç®¡ç†çš„å·¥ä½œå°±äº¤ç»™äº† SPIRE Serverã€‚SPIRE åŒæ ·æ”¯æŒ Envoy SDS APIï¼Œæˆ‘ä»¬åœ¨ Istio ä¸­å¯ç”¨ SPIRE ä¹‹åï¼Œè¿›å…¥å·¥ä½œè´Ÿè½½ Pod ä¸­çš„æµé‡åœ¨è¢«é€æ˜æ‹¦æˆªåˆ° Sidecar ä¸­åï¼Œä¼šç»è¿‡ä¸€æ¬¡èº«ä»½è®¤è¯ã€‚èº«ä»½è®¤è¯çš„ç›®çš„æ˜¯å¯¹æ¯”è¯¥å·¥ä½œè´Ÿè½½çš„èº«ä»½ï¼Œä¸å®ƒæ‰€è¿è¡Œçš„ç¯å¢ƒä¿¡æ¯ï¼ˆæ‰€åœ¨çš„èŠ‚ç‚¹ã€Pod çš„ ServiceAccount å’Œ Namespace ç­‰ï¼‰æ˜¯å¦ä¸€è‡´ï¼Œä»¥é˜²æ­¢ä¼ªé€ èº«ä»½ã€‚è¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/blog/how-to-integrate-spire-with-istio/&#34; title=&#34;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE&#34;&gt;å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE&lt;/a&gt;
 ä»¥äº†è§£å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/support/k8s/k8s-workload-registrar/README.md&#34; title=&#34;Kubernetes Workload Registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Workload Registrar&lt;/a&gt;
 åœ¨ Kubernetes ä¸­éƒ¨ç½² SPIREï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ³¨å†Œ Kubernetes ä¸­çš„å·¥ä½œè´Ÿè½½å¹¶ç”Ÿæˆ SVIDã€‚è¯¥æ³¨å†Œæœºæ˜¯ Server-Agent æ¶æ„ï¼Œå®ƒåœ¨æ¯ä¸ª Node ä¸Šéƒ¨ç½²ä¸€ä¸ª SPIRE Agentï¼ŒAgent ä¸å·¥ä½œè´Ÿè½½é€šè¿‡å…±äº«çš„ UNIX Domain Socket é€šä¿¡ã€‚é›¶ä¿¡ä»»ç½‘ç»œä¸­æ¯ä¸ªæµé‡ä¼šè¯éƒ½éœ€è¦ç»è¿‡èº«ä»½è®¤è¯ï¼ŒIstio åœ¨é€æ˜æµé‡åŠ«æŒæ—¶ï¼ŒSidecar åŒæ—¶å¯¹æµé‡è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯ã€‚ä¸‹å›¾å±•ç¤ºäº†åœ¨ Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œèº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;workload-attestation.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Istio ä¸­åŸºäº SPIRE çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾&#34; width=&#34;40%&#34;data-img=&#34;workload-attestation.svg&#34;
         data-caption=&#34;Istio ä¸­åŸºäº SPIRE çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Istio ä¸­åŸºäº SPIRE çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œå·¥ä½œè´Ÿè½½è®¤è¯çš„æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·¥ä½œè´Ÿè½½çš„ sidecar ä¸­çš„ &lt;code&gt;pilot-agent&lt;/code&gt; é€šè¿‡å…±äº«çš„ UDS è°ƒç”¨ SPIRE Agent æ¥è·å– SVID å¹¶ç¼“å­˜åœ¨ SPIRE Agent ä¸­ç”¨äºåç»­èº«ä»½è®¤è¯ï¼›&lt;/li&gt;
&lt;li&gt;SPIRE Agent è¯¢é—® Kubernetesï¼ˆå‡†ç¡®çš„è¯´æ˜¯èŠ‚ç‚¹ä¸Šçš„ kubeletï¼‰è·å–å·¥ä½œè´Ÿè½½çš„ä¿¡æ¯ï¼Œå¦‚æ‰€åœ¨çš„ namespaceã€èŠ‚ç‚¹åç§°ã€æœåŠ¡è´¦å·ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;Kubelet æŠŠä» API æœåŠ¡å™¨ä¸­æŸ¥è¯¢åˆ°çš„ä¿¡æ¯è¿”å›ç»™å·¥ä½œè´Ÿè½½éªŒè¯å™¨ï¼›&lt;/li&gt;
&lt;li&gt;éªŒè¯å™¨å°† kubelet è¿”å›çš„ç»“æœä¸ SPIRE æŸ¥è¯¢å¾—åˆ°çš„èº«ä»½ä¿¡æ¯æ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å°†æ­£ç¡®çš„ SVID ç¼“å­˜è¿”å›ç»™å·¥ä½œè´Ÿè½½ï¼Œå¦‚æœä¸åŒåˆ™è®¤è¯å¤±è´¥ï¼Œæ‹’ç»æµé‡è¯·æ±‚ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…³äºå·¥ä½œè´Ÿè½½çš„æ³¨å†Œå’Œè®¤è¯çš„è¯¦ç»†è¿‡ç¨‹è¯·å‚è€ƒ &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/concepts/spire/&#34; title=&#34;SPIRE æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE æ–‡æ¡£&lt;/a&gt;
 ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ngac&#34;&gt;NGAC&lt;/h3&gt;
&lt;p&gt;å½“æ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½æœ‰å‡†ç¡®çš„èº«ä»½ä¹‹åï¼Œå¦‚ä½•å¯¹è¿™äº›èº«ä»½çš„æƒé™è¿›è¡Œé™åˆ¶ï¼ŸKubernetes ä¸­é»˜è®¤ä½¿ç”¨ RBAC æ¥åšè®¿é—®æ§åˆ¶ï¼Œæ­£å¦‚å…¶åï¼Œè¿™ç§è®¿é—®æ§åˆ¶æ˜¯åŸºäºè§’è‰²çš„ï¼Œè™½ç„¶ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¯¹äºå¤§è§„æ¨¡é›†ç¾¤ï¼Œå­˜åœ¨è§’è‰²çˆ†ç‚¸é—®é¢˜ â€”â€” å³å­˜åœ¨å¤ªå¤šè§’è‰²ï¼Œè€Œä¸”è§’è‰²çš„ç±»å‹ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéš¾ä»¥å¯¹è§’è‰²æƒé™æœºå‹è·Ÿè¸ªå’Œå®¡è®¡ã€‚å¦å¤– RBAC ä¸­çš„è§’è‰²çš„è®¿é—®æƒé™æ˜¯å›ºå®šï¼Œæ²¡æœ‰è§„å®šçŸ­æš‚çš„ä½¿ç”¨æƒé™ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘ä½ç½®ã€æ—¶é—´æˆ–è®¾å¤‡ç­‰å±æ€§ã€‚ä½¿ç”¨ RBAC çš„ä¼ä¸šå¾ˆéš¾æ»¡è¶³å¤æ‚çš„è®¿é—®æ§åˆ¶è¦æ±‚ï¼Œä»¥æ»¡è¶³å…¶ä»–ç»„ç»‡éœ€æ±‚çš„ç›‘ç®¡è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;NGACï¼Œå³ä¸‹ä¸€ä»£è®¿é—®æ§åˆ¶ï¼Œé‡‡ç”¨å°†è®¿é—®å†³å®šæ•°æ®å»ºæ¨¡ä¸º DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰çš„æ–¹æ³•ã€‚NGAC å¯ä»¥å®ç°ç³»ç»ŸåŒ–ã€ç­–ç•¥ä¸€è‡´çš„è®¿é—®æ§åˆ¶æ–¹æ³•ï¼Œä»¥é«˜ç²¾ç»†åº¦æˆäºˆæˆ–æ‹’ç»ç”¨æˆ·ç®¡ç†èƒ½åŠ›ã€‚NGAC ç”± &lt;a href=&#34;https://www.nist.gov/&#34; title=&#34;NIST&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST&lt;/a&gt;
 ï¼ˆç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶æ‰€ï¼‰å¼€å‘ï¼Œç›®å‰å·²ç”¨äº &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 ä¸­çš„æƒé™ç®¡ç†ã€‚å…³äºä¸ºä»€ä¹ˆé€‰æ‹© NGACï¼Œè€Œä¸æ˜¯ ABAC å’Œ RBAC çš„æ›´å¤šå†…å®¹è¯·å‚è€ƒåšå®¢&lt;a href=&#34;https://jimmysong.io/blog/why-you-should-choose-ngac-as-your-access-control-model/&#34; title=&#34;ä¸ºä»€ä¹ˆåº”è¯¥é€‰æ‹©ä½¿ç”¨ NGAC ä½œä¸ºæƒé™æ§åˆ¶æ¨¡å‹&#34;&gt;ä¸ºä»€ä¹ˆåº”è¯¥é€‰æ‹©ä½¿ç”¨ NGAC ä½œä¸ºæƒé™æ§åˆ¶æ¨¡å‹&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;hybrid-cloud&#34;&gt;æ··åˆäº‘&lt;/h2&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å‡ºäºè´Ÿè½½å‡è¡¡ã€éš”ç¦»å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒã€è§£è€¦æ•°æ®å¤„ç†å’Œæ•°æ®å­˜å‚¨ã€è·¨äº‘å¤‡ä»½å’Œç¾éš¾æ¢å¤ä»¥åŠé¿å…å‚å•†é”å®šç­‰åŸå› ï¼Œåœ¨å¤šç§ç¯å¢ƒä¸‹éƒ¨ç½²å¤šä¸ª Kubernetes é›†ç¾¤ã€‚Kubernetes ç¤¾åŒºæä¾›äº†ã€Œé›†ç¾¤è”é‚¦ã€åŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºå¤šé›†ç¾¤æ¶æ„ï¼Œä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ç§å¸¸ç”¨çš„ Kubernetes å¤šé›†ç¾¤æ¶æ„ï¼Œå…¶ä¸­ Host Cluster ä½œä¸ºæ§åˆ¶å¹³é¢ï¼Œæœ‰ä¸¤ä¸ªæˆå‘˜é›†ç¾¤ï¼Œåˆ†åˆ«æ˜¯ West å’Œ Eastã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/multicluster.svg&#34; data-img=&#34;/blog/beyond-istio-oss/multicluster.svg&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes é›†ç¾¤è”é‚¦æ¶æ„&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes é›†ç¾¤è”é‚¦æ¶æ„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é›†ç¾¤è”é‚¦è¦æ±‚ Host é›†ç¾¤ä¸æˆå‘˜é›†ç¾¤çš„ä¹‹é—´çš„ç½‘ç»œèƒ½å¤Ÿäº’é€šï¼Œå¯¹æˆå‘˜é›†ç¾¤ä¹‹é—´çš„ç½‘ç»œè¿æ¥æ€§æ²¡æœ‰è¦æ±‚ã€‚Host é›†ç¾¤ä½œä¸º API å…¥å£ï¼Œå¤–ç•Œæ‰€æœ‰å¯¹ Host é›†ç¾¤çš„èµ„æºè¯·æ±‚ä¼šè½¬å‘åˆ°æˆå‘˜é›†ç¾¤ä¸­ã€‚Host é›†ç¾¤ä¸­éƒ¨ç½²æœ‰é›†ç¾¤è”é‚¦çš„æ§åˆ¶å¹³é¢ï¼Œå…¶ä¸­çš„ã€ŒPush Reconcilerã€ä¼šå°†è”é‚¦ä¸­çš„èº«ä»½ã€è§’è‰²åŠè§’è‰²ç»‘å®šä¼ æ’­åˆ°æ‰€æœ‰çš„æˆå‘˜é›†ç¾¤ä¸­ã€‚é›†ç¾¤è”é‚¦åªæ˜¯ç®€å•åœ°å°†å¤šä¸ªé›†ç¾¤ç®€å•çš„ã€Œè¿æ¥åˆ°äº†ä¸€èµ·ã€ï¼Œåœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´å¤åˆ¶å·¥ä½œè´Ÿè½½ï¼Œè€Œæˆå‘˜é›†ç¾¤ä¹‹é—´çš„æµé‡æ— æ³•è°ƒåº¦ï¼Œä¹Ÿæ— æ³•å®ç°çœŸæ­£çš„å¤šç§Ÿæˆ·ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤è”é‚¦ä¸è¶³ä»¥å®ç°æ··åˆäº‘ï¼Œä¸ºäº†å®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„æ··åˆäº‘ï¼Œå°±è¦è®©é›†ç¾¤ä¹‹é—´åšåˆ°äº’è”äº’é€šï¼ŒåŒæ—¶å®ç°å¤šç§Ÿæˆ·ã€‚TSB åœ¨ Istio ä¹‹ä¸Šæ„å»ºä¸€ä¸ªå¤šé›†ç¾¤ç®¡ç†çš„é€šç”¨æ§åˆ¶å¹³é¢ï¼Œç„¶åå†å¢åŠ ä¸€ä¸ªç®¡ç†å¹³é¢æ¥ç®¡ç†å¤šé›†ç¾¤ï¼Œæä¾›å¤šç§Ÿæˆ·ã€ç®¡ç†é…ç½®ã€å¯è§‚å¯Ÿæ€§ç­‰åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯ Istio ç®¡ç†å¹³é¢çš„å¤šç§Ÿæˆ·å’Œ API ç¤ºæ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/beyond-istio-oss/tsb-management-plane.svg&#34; data-img=&#34;/blog/beyond-istio-oss/tsb-management-plane.svg&#34; alt=&#34;image&#34; data-caption=&#34;TSB åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„ç®¡ç†å¹³é¢ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;TSB åœ¨ Istio ä¹‹ä¸Šæ„å»ºçš„ç®¡ç†å¹³é¢ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;TSB ä¸ºç®¡ç†æ··åˆäº‘ï¼ŒåŸºäº Istio æ„å»ºäº†ä¸€ä¸ªç®¡ç†å¹³é¢ï¼Œæ–°å»ºäº† Tenant å’Œ Workspace çš„èµ„æºï¼Œå¹¶é€šè¿‡é€‰æ‹©å™¨ï¼Œå°†ç½‘å…³ç»„ã€æµé‡ç»„å’Œå®‰å…¨ç»„åº”ç”¨åˆ°å¯¹åº”é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½ä¸Šã€‚å…³äº TSB çš„è¯¦ç»†æ¶æ„è¯·å‚è€ƒ &lt;a href=&#34;https://docs.tetrate.io/service-bridge/1.4.x/en-us/concepts/architecture&#34; title=&#34;TSB æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;more&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Istio å’Œäº‘åŸç”Ÿçš„å†…å®¹ï¼Œä¸‹é¢æœ‰ä¸€äº›èµ„æ–™åˆ†äº«ç»™ä½ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½çš„äº†è§£ Istio å’Œäº‘åŸç”Ÿï¼Œç¬”è€…åœ¨ 2020 å¹´å‘èµ·äº†&lt;a href=&#34;https://cloudnative.to&#34; title=&#34;äº‘åŸç”Ÿç¤¾åŒº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº&lt;/a&gt;
ï¼Œæ¬¢è¿å¤§å®¶åŠ å…¥æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å Kubernetes æ—¶ä»£çš„äº‘åŸç”Ÿæ–°èŒƒå¼ï¼›&lt;/li&gt;
&lt;li&gt;2022 å¹´ 6 æœˆï¼Œäº‘åŸç”Ÿç¤¾åŒºè‘—çš„&lt;a href=&#34;https://jimmysong.io/blog/istio-service-mesh-book/&#34; title=&#34;ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹&#34;&gt;ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹&lt;/a&gt;
å·²å›¾ä¹¦ç”±ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆï¼Œæ¬¢è¿å¤§å®¶è´­ä¹°ï¼›&lt;/li&gt;
&lt;li&gt;ç¬”è€…äº 2022 å¹´ 5 æœˆï¼Œå°†ä¹‹å‰æ‰€ä½œç”µå­ä¹¦ã€æ•™ç¨‹å’Œè¯‘æ–‡å…¨éƒ¨è¿ç§»åˆ°äº†&lt;a href=&#34;https://lib.jimmysong.io&#34; title=&#34;äº‘åŸç”Ÿèµ„æ–™åº“&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿèµ„æ–™åº“&lt;/a&gt;
ï¼Œæ¬¢è¿é˜…è¯»å’Œç•™è¨€è¯„è®ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;æœ‰å…³ Envoy å¼€æºçš„è¯¦ç»†è¿‡ç¨‹ï¼Œæ¨èä½ é˜…è¯» Envoy ä½œè€… Matt Klein çš„è¿™ç¯‡æ–‡ç« &lt;a href=&#34;https://lib.jimmysong.io/translation/envoy-oss-5-year/&#34; title=&#34;ç½‘ç»œä»£ç† Envoy å¼€æºäº”å‘¨å¹´ï¼Œåˆ›å§‹äºº Matt Klein äº²è¿°å¼€æºå¿ƒè·¯å†ç¨‹åŠç»éªŒæ•™è®­&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œä»£ç† Envoy å¼€æºäº”å‘¨å¹´ï¼Œåˆ›å§‹äºº Matt Klein äº²è¿°å¼€æºå¿ƒè·¯å†ç¨‹åŠç»éªŒæ•™è®­&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;åæ¥ IBM ä¸ Google åç›®ï¼Œå¤§ä¸¾æŠ¨å‡» Google æ²¡æœ‰éµå®ˆå°† Istio æçŒ®ç»™ CNCF çš„çº¦å®šï¼ŒGoogle å¯¹ Istio å•†æ ‡çš„ç®¡ç†ä¹Ÿå—åˆ°äº†&lt;a href=&#34;https://thenewstack.io/googles-management-of-the-istio-service-mesh-raises-questions-in-the-cloud-native-community/&#34; title=&#34;è´¨ç–‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¨ç–‘&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;2018 å¹´ï¼ŒCNCF ä¸ºäº‘åŸç”Ÿçš„é‡æ–°å®šä¹‰æ˜¯ï¼šäº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ APIã€‚è¯¦è§ &lt;a href=&#34;https://lib.jimmysong.io/cloud-native-handbook/intro/what-is-cloud-native/&#34; title=&#34;ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;Day-2 Operation æ˜¯åœ¨ç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸç»“æŸå‰ï¼Œå¯¹ç³»ç»Ÿä¸æ–­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œä»¥å®ç°æ•ˆç›Šæœ€å¤§åŒ–ã€‚å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/blog/what-is-day-2-operation/&#34; title=&#34;ä»€ä¹ˆæ˜¯ Day-2 Operation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ Day-2 Operation&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34;&gt;
&lt;p&gt;Istio ç°å·²æ¨å‡º proxyless æ¨¡å¼æµ‹è¯•ç‰ˆï¼Œè¯¦è§ &lt;a href=&#34;https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/&#34; title=&#34;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34;&gt;
&lt;p&gt;Kubernetes é¢„è®¡æ¨å‡º &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/concepts/gateway/&#34; title=&#34;Gateway API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt;
ï¼ŒIstio ä¹Ÿæœ‰è®¡åˆ’ä½¿ç”¨ Kubernetes çš„ Gateway API æ›¿æ¢å½“å‰ Istio è‡ªå®šä¹‰çš„ Gateway èµ„æºã€‚&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34;&gt;
&lt;p&gt;æœ‰å…³æœåŠ¡ç½‘æ ¼é¡¹ç›®çš„è¯¦ç»†å¯¹æ¯”è¯·å‚è€ƒ &lt;a href=&#34;https://servicemesh.es/&#34; title=&#34;servicemesh.es&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;servicemesh.es&lt;/a&gt;
 ç½‘ç«™ã€‚&amp;#160;&lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34;&gt;
&lt;p&gt;åœ¨ç™¾åº¦çš„æœåŠ¡ç½‘æ ¼å›¢é˜Ÿåˆ†äº«çš„ &lt;a href=&#34;https://mp.weixin.qq.com/s/G8vmlJyaimux_K-548kFbA&#34; title=&#34;æ®Šé€”åŒå½’ï¼ŒProxyless Service Mesh åœ¨ç™¾åº¦çš„å®è·µä¸æ€è€ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ®Šé€”åŒå½’ï¼ŒProxyless Service Mesh åœ¨ç™¾åº¦çš„å®è·µä¸æ€è€ƒ&lt;/a&gt;
 è¿™ç¯‡æ–‡ç« é‡Œï¼Œè¯¦ç»†ä»‹ç»äº†ç™¾åº¦çš„æœåŠ¡ç½‘æ ¼é‡‡ç”¨è·¯å¾„ï¼Œä»¥åŠå¯¹æœåŠ¡ç½‘æ ¼æœ¬è´¨çš„æ¢ç´¢ã€‚&amp;#160;&lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34;&gt;
&lt;p&gt;Apache SkyWalking çš„ Rover ç»„ä»¶åˆ©ç”¨ eBPF æŠ€æœ¯æ”¹è¿›äº† SkyWalking çš„å‰–æåŠŸèƒ½ï¼Œå¯ç”¨äºåˆ†ææœåŠ¡ç½‘æ ¼çš„æ€§èƒ½é—®é¢˜ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://lib.jimmysong.io/blog/pinpoint-service-mesh-critical-performance-impact-by-using-ebpf/&#34; title=&#34;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ eBPF å‡†ç¡®å®šä½æœåŠ¡ç½‘æ ¼çš„å…³é”®æ€§èƒ½é—®é¢˜&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34;&gt;
&lt;p&gt;å…³äº xDS åè®®ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://cloudnative.to/blog/envoy-xds-protocol/&#34; title=&#34;Envoy ä¸­çš„ xDS REST å’Œ gRPC åè®®è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­çš„ xDS REST å’Œ gRPC åè®®è¯¦è§£&lt;/a&gt;
 è¿™ç¯‡æ–‡ç« ã€‚&amp;#160;&lt;a href=&#34;#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:11&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.oreilly.com/library/view/network-access-control/9780470398678/9780470398678_policy_enforcement_point.html&#34; title=&#34;PEP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PEP&lt;/a&gt;
ï¼Œå…¨ç§° Policy Enforcement Pointï¼Œç­–ç•¥æ‰§è¡Œç‚¹ï¼ˆPEPï¼‰æ˜¯æ§åˆ¶ç”¨æˆ·è®¿é—®å¹¶ç¡®ä¿ç­–ç•¥å†³ç­–ç‚¹ (PDP) åšå‡ºæˆæƒå†³ç­–çš„ç½‘ç»œæˆ–å®‰å…¨è®¾å¤‡ã€‚åœ¨ä¸€äº› NAC å®ç°ä¸­ï¼ŒPDP æ˜¯æœ‰çº¿äº¤æ¢æœºæˆ–æ— çº¿æ¥å…¥ç‚¹ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼ŒPEP æ˜¯é˜²ç«å¢™ã€IPSã€æœåŠ¡å™¨æˆ–å†…è”è®¾å¤‡ã€‚æ ¹æ®å®æ–½æƒ…å†µï¼ŒPEP å’Œ PDP å¯ä»¥æ˜¯ç‹¬ç«‹è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥åˆå¹¶ä¸ºå•ä¸ªè®¾å¤‡ã€‚&amp;#160;&lt;a href=&#34;#fnref:11&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:12&#34;&gt;
&lt;p&gt;æœ‰å¤šå®¶å…¬å¸æ­£åœ¨åˆä½œå¼€å‘ Envoy Gatewayï¼ŒåŒ…æ‹¬ &lt;a href=&#34;https://www.getambassador.io/&#34; title=&#34;Ambassador Labs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;
ã€&lt;a href=&#34;https://www.fidelity.com/&#34; title=&#34;Fidelity Investments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fidelity Investments&lt;/a&gt;
ã€&lt;a href=&#34;https://projectcontour.io/&#34; title=&#34;Project Contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Project Contour&lt;/a&gt;
 å’Œ &lt;a href=&#34;https://www.vmware.com/&#34; title=&#34;VMware&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:12&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:13&#34;&gt;
&lt;p&gt;SidecarScope æ˜¯åœ¨ Istio 1.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç›´æ¥é¢å‘ç”¨æˆ·çš„é…ç½®é¡¹ï¼Œè€Œæ˜¯ Sidecar èµ„æºçš„åŒ…è£…å™¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ Sidecar èµ„æºä¸­çš„ &lt;code&gt;egress&lt;/code&gt; é€‰é¡¹ã€‚é€šè¿‡è¯¥é…ç½®å¯ä»¥å‡å°‘ Istio å‘ Sidecar ä¸‹å‘çš„æ•°æ®é‡ï¼Œä¾‹å¦‚åªå‘æŸä¸ªå‘½åç©ºé—´ä¸­çš„æŸäº›æœåŠ¡ä¸‹å‘æŸäº› hosts çš„è®¿é—®é…ç½®ï¼Œä»è€Œæé«˜åº”ç”¨æé«˜æ€§èƒ½ã€‚&amp;#160;&lt;a href=&#34;#fnref:13&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:14&#34;&gt;
&lt;p&gt;Istio ä»…å¯ä»¥è·¯ç”± TCP æµé‡ï¼Œé»˜è®¤æ”¯æŒ HTTPã€HTTPSã€gRPC å’ŒåŸå§‹ TCP åè®®ï¼Œå…¶ä¸­ Sidecar å’Œ Gateway æ‰€æ”¯æŒçš„åè®®èŒƒå›´æœ‰æ‰€ä¸åŒï¼Œè¯¦è§ &lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&amp;#160;&lt;a href=&#34;#fnref:14&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:15&#34;&gt;
&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; æ˜¯ sidecar å®¹å™¨ä¸­çš„ä¸»è¿›ç¨‹ï¼Œä½ å¯ä»¥åœ¨ &lt;a href=&#34;#istio-components&#34; title=&#34;Istio çš„ç»„æˆæ¶æ„å›¾&#34;&gt;Istio çš„ç»„æˆæ¶æ„å›¾&lt;/a&gt;
ä¸­çœ‹åˆ°ã€‚&lt;code&gt;pilot-agent&lt;/code&gt; ä¸­çš„é•œåƒæå–æœºåˆ¶ï¼ˆåœ¨ Istio 1.9 ä¸­å¼•å…¥ï¼‰ï¼Œä»è¿œç¨‹ HTTP æºå¯é åœ°æ£€ç´¢ Wasm äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå·²è¢«æ‰©å±•åˆ°æ”¯æŒä»ä»»ä½• OCI æ³¨å†Œå¤„æ£€ç´¢ Wasm OCI é•œåƒï¼ŒåŒ…æ‹¬ Docker Hubã€Google Container Registryï¼ˆGCRï¼‰ã€Amazon Elastic Container Registryï¼ˆAmazon ECRï¼‰å’Œå…¶ä»–åœ°æ–¹ã€‚&amp;#160;&lt;a href=&#34;#fnref:15&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:16&#34;&gt;
&lt;p&gt;ã€Š&lt;a href=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/&#34; title=&#34;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘Šåˆ« Sidecarâ€”â€” ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼&lt;/a&gt;
ã€‹è¿™ç¯‡æ–‡ç« åœ¨äº‘åŸç”Ÿç¤¾åŒºé‡Œå¼•èµ·äº†ä¸€ç³»åˆ—å…³äºæœåŠ¡ç½‘æ ¼å°†è¢« eBPF æŠ€æœ¯æ‰€å–ä»£çš„è®¨è®ºã€‚&lt;a href=&#34;https://jimmysong.io/blog/epbf-sidecar-and-service-mesh/&#34; title=&#34;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecar æ¨¡å¼çš„å¹»æƒ³&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·æš‚æ—¶æŠ›å¼ƒä½¿ç”¨ eBPF å–ä»£æœåŠ¡ç½‘æ ¼å’Œ sidecar æ¨¡å¼çš„å¹»æƒ³&lt;/a&gt;
ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ eBPFï¼Œåœ¨å¯é¢„è§çš„æœªæ¥ï¼ŒæœåŠ¡ç½‘æ ¼éƒ½ä¼šåŸºäºè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ sidecar ä»£ç†ï¼ˆproxyless æ¨¡å¼é™¤å¤–ï¼‰ã€‚&amp;#160;&lt;a href=&#34;#fnref:16&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:17&#34;&gt;
&lt;p&gt;Istio å…·æœ‰èº«ä»½å’Œè¯ä¹¦ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å®ç°æœåŠ¡é—´çš„ç»ˆç«¯ç”¨æˆ·è®¤è¯ï¼Œåœ¨æ§åˆ¶å¹³é¢è¿˜é‡‡ç”¨å¾®æœåŠ¡æ¶æ„çš„æ—¶å€™ï¼Œå…¶ä¸­çš„ Citadel ç»„ä»¶è´Ÿè´£è¯ä¹¦ç®¡ç†ï¼Œåœ¨ Istio 1.5 ç‰ˆæœ¬è¢«åˆå¹¶åˆ°å•ä½“ Istiod ä¸­äº†ã€‚&amp;#160;&lt;a href=&#34;#fnref:17&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIREï¼Ÿ</title>
      <link>https://jimmysong.io/blog/how-to-integrate-spire-with-istio/</link>
      <pubDate>Thu, 30 Jun 2022 18:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/how-to-integrate-spire-with-istio/</guid>
      <description>
        
        
        &lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  è¯»è€…é¡»çŸ¥
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  SPIRE æ”¯æŒæ˜¯ Istio 1.14 çš„æ–°ç‰¹æ€§ï¼Œè¯·ç¡®ä¿å®‰è£… 1.14 åŠä»¥ä¸Šç‰ˆæœ¬çš„ Istioã€‚
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;SPIRE æ˜¯ SPIFFE è§„èŒƒçš„ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„å®ç°ï¼Œå®ƒå¯ä»¥æ‰§è¡ŒèŠ‚ç‚¹å’Œå·¥ä½œè´Ÿè½½è¯æ˜ï¼Œä»¥ä¾¿å®‰å…¨åœ°å°†åŠ å¯†èº«ä»½å‘ç»™åœ¨å¼‚æ„ç¯å¢ƒä¸­è¿è¡Œçš„å·¥ä½œè´Ÿè½½ã€‚é€šè¿‡ä¸ Envoy çš„ SDS API é›†æˆï¼ŒSPIRE å¯ä»¥è¢«é…ç½®ä¸º Istio å·¥ä½œè´Ÿè½½çš„åŠ å¯†èº«ä»½æ¥æºã€‚Istio å¯ä»¥æ£€æµ‹åˆ° UNIX åŸŸå¥—æ¥å­—çš„å­˜åœ¨ï¼Œè¯¥å¥—æ¥å­—åœ¨å®šä¹‰çš„å¥—æ¥å­—è·¯å¾„ä¸Šå®ç°äº† Envoy SDS APIï¼Œå…è®¸ Envoy ç›´æ¥ä»å®ƒé‚£é‡Œè¿›è¡Œé€šä¿¡å’Œè·å–èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨&lt;a href=&#34;https://jimmysong.io/blog/why-istio-need-spire/&#34; title=&#34;ä¸Šä¸€ç¯‡æ–‡ç« &#34;&gt;ä¸Šä¸€ç¯‡æ–‡ç« &lt;/a&gt;
ä¸­ä»‹ç»äº†ä¸ºä»€ä¹ˆ Istio è¦ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ï¼Œåœ¨è¿™ç¯‡åšå®¢ä¸­æˆ‘å°†ä¸ºä½ ä»‹ç»å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIREã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;åˆ° &lt;a href=&#34;https://github.com/istio/istio/releases&#34; title=&#34;GitHub&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt;
 ä¸Šä¸‹è½½ Istio å®‰è£…åŒ…ï¼Œè§£å‹åï¼Œå»ºè®®ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å®‰è£… Istioã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ å®‰è£…äº†ä½äº 1.14 ç‰ˆæœ¬çš„ Istioï¼Œè¯·å…ˆå‡çº§ Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-spire&#34;&gt;å®‰è£… SPIRE&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ Istio æä¾›çš„å¿«é€Ÿå®‰è£…æ–¹å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/security/spire/spire-quickstart.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†å®‰è£…ä»¥ä¸‹ç»„ä»¶ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;namespace/spire created
csidriver.storage.k8s.io/csi.spiffe.io created
customresourcedefinition.apiextensions.k8s.io/spiffeids.spiffeid.spiffe.io created
clusterrolebinding.rbac.authorization.k8s.io/k8s-workload-registrar-role-binding created
clusterrole.rbac.authorization.k8s.io/k8s-workload-registrar-role created
configmap/k8s-workload-registrar created
serviceaccount/spire-server created
configmap/trust-bundle created
clusterrole.rbac.authorization.k8s.io/spire-server-trust-role created
clusterrolebinding.rbac.authorization.k8s.io/spire-server-trust-role-binding created
configmap/spire-server created
statefulset.apps/spire-server created
service/spire-server created
serviceaccount/spire-agent created
clusterrole.rbac.authorization.k8s.io/spire-agent-cluster-role created
clusterrolebinding.rbac.authorization.k8s.io/spire-agent-cluster-role-binding created
configmap/spire-agent created
daemonset.apps/spire-agent created
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;éœ€è¦ç»™æ‰“ patchï¼Œè¿™æ˜¯ä¸ºäº†è®©æ‰€æœ‰ sidecar å’Œ Ingress éƒ½å¯ä»¥å…±äº«  SPIRE agent çš„ UNIX Domain Socketã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;istioctl install --skip-confirmation -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This is used to customize the sidecar template&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecarInjectorWebhook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            - name: istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                mountPath: /run/secrets/workload-spiffe-uds
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                csi:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  driver: &amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;overlays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.volumes.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.containers.[name:istio-proxy].volumeMounts.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/run/secrets/workload-spiffe-uds&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£…å¥½ Istio å’Œ SPIRE åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ³¨å†Œè´Ÿè½½äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è‡ªåŠ¨æ³¨å†Œ-kubernetes-è´Ÿè½½&#34;&gt;è‡ªåŠ¨æ³¨å†Œ Kubernetes è´Ÿè½½&lt;/h2&gt;
&lt;p&gt;åœ¨å¿«é€Ÿå®‰è£… SPIRE çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…äº† SPRIE &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/support/k8s/k8s-workload-registrar/README.md&#34; title=&#34;Kubernetes Workload Registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Workload Registrar&lt;/a&gt;
ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å·²ç»å¼€å¯è‡ªåŠ¨è´Ÿè½½æ³¨å†Œã€‚ç°åœ¨æ£€æŸ¥ä¸€ä¸‹ SPIRE æ˜¯å¦ç»™è´Ÿè½½é¢å‘äº†èº«ä»½è¯æ˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -i -t spire-server-0 -n spire -c spire-server -- /bin/sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;bin/spire-server entry show -socketPath /run/spire/sockets/server.sock&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å°†çœ‹åˆ°ä¾‹å¦‚ä¸‹é¢è¿™æ ·çš„ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Node&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : 3f17c8be-1379-4b7c-9a01-90805165d59f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/k8s-workload-registrar/demo-cluster/node/gke-jimmy-cluster-default-pool-d5041909-3atb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/spire/server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:agent_node_uid:cbab5123-b32f-49d0-89f2-0a7e4d2b0edd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:cluster:demo-cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Ingress gateway&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : ffc76b2e-e602-4ad3-8069-993ffbf4440e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/k8s-workload-registrar/demo-cluster/node/gke-jimmy-cluster-default-pool-d5041909-0ucb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:node-name:gke-jimmy-cluster-default-pool-d5041909-0ucb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:be32b10a-b5a4-4716-adaf-eab778f58c13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway-6989cbc776-87qb6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# SPIRE Server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : 54444848-95ec-4b4d-a7c5-902a4049c96a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/spire/sa/spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/k8s-workload-registrar/demo-cluster/node/gke-jimmy-cluster-default-pool-d5041909-0ucb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:node-name:gke-jimmy-cluster-default-pool-d5041909-0ucb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:spire
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:4917defc-9b5a-42d8-9b98-c0e0a48c0313
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : spire-server-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : spire-server.spire.svc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯ä¸ª node çš„ parent ID æ˜¯ &lt;code&gt;spiffe://example.org/ns/spire/sa/spire-server&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;spiffe://example.org/ns/spire/sa/spire-server&lt;/code&gt; çš„ parent æ˜¯ &lt;code&gt;spiffe://example.org/k8s-workload-registrar/demo-cluster/node/gke-jimmy-cluster-default-pool-d5041909-0ucb&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å·¥ä½œè´Ÿè½½çš„å±‚çº§æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;SPIRE Serverï¼š&lt;code&gt;spiffe://example.org/spire/server&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes èŠ‚ç‚¹ï¼š&lt;code&gt;spiffe://example.org/k8s-workload-registrar/demo-cluster/node/&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ™®é€šæœåŠ¡è´¦æˆ·ï¼š&lt;code&gt;spiffe://example.org/{namespace}/spire/sa/{service_acount}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;SPIRE é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©å·¥ä½œè´Ÿè½½ï¼Œä¸ºå®ƒä»¬åˆ›å»º SPIFFE IDã€‚&lt;/p&gt;
&lt;p&gt;å·¥ä½œè´Ÿè½½çš„ SPIFEE ID æ ¼å¼ä¸º &lt;code&gt;spiffe://&amp;lt;trust.domain&amp;gt;/ns/&amp;lt;namespace&amp;gt;/sa/&amp;lt;service-account&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²åº”ç”¨&#34;&gt;éƒ¨ç½²åº”ç”¨&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªåº”ç”¨ï¼Œç„¶åæ£€æŸ¥ä¸‹ SPIRE ä¸ºè¯¥åº”æä¾›çš„èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤éƒ¨ç½² Istio æä¾›çš„ç¤ºä¾‹åº”ç”¨ &lt;code&gt;sleep&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl kube-inject --filename samples/security/spire/sleep-spire.yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬åœ¨å®‰è£… Istio çš„æ—¶å€™æ‰“äº†è¡¥ä¸ï¼Œåšäº† SPIRE è‡ªåŠ¨æ³¨å…¥ï¼Œç„¶åæ‰€æœ‰ pod éƒ½ä¼šå…±äº« SPIRE Agent ä¸­çš„ UNIX Domain Socketï¼š&lt;code&gt;/run/secrets/workload-spiffe-uds/socket&lt;/code&gt;ã€‚è·å–æ­£åœ¨è¿è¡Œçš„ &lt;code&gt;sleep&lt;/code&gt; pod çš„ YAMLï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ volume é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;csi.spiffe.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥åŠ &lt;code&gt;volumeMounts&lt;/code&gt; å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/run/secrets/workload-spiffe-uds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/run/secrets/workload-spiffe-uds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/run/secrets/workload-spiffe-credentials&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod-ca-cert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™éƒ½è¯å®äº† SPRIE Agent ä¸å·¥ä½œè´Ÿè½½ pod å…±äº« UNIX Domain Socketã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†æŸ¥è¯¢ä¸‹ Kubernetes é›†ç¾¤ä¸­çš„ SPIRE æ¡ç›®ï¼Œä½ å°†å¯ä»¥çœ‹åˆ° sleep çš„æ¡ç›®å·²æ³¨å†Œã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Entry ID         : bd4457af-c55c-4d8c-aee2-4d477a79b465
SPIFFE ID        : spiffe://example.org/ns/default/sa/sleep
Parent ID        : spiffe://example.org/k8s-workload-registrar/demo-cluster/node/gke-jimmy-cluster-default-pool-d5041909-3atb
Revision         : 1
TTL              : default
Selector         : k8s:node-name:gke-jimmy-cluster-default-pool-d5041909-3atb
Selector         : k8s:ns:default
Selector         : k8s:pod-uid:81f116ce-6538-4492-a78a-98b163b58310
DNS name         : sleep-9df96d88-tvl49
DNS name         : sleep.default.svc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å†æ£€æŸ¥ä¸‹ sleep çš„ SVIDã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl proxy-config secret &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢è¿™æ¡å‘½ä»¤è·å– sleep pod ä¸­ Envoy çš„ secret å¹¶è§£æå…¶ä¸­çš„ TLS è¯ä¹¦ï¼Œå°†å…¶ base64 è§£ç åä¿å­˜åˆ° &lt;code&gt;chain.pem&lt;/code&gt; æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl x509 -in chain.pem -text &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep SPIRE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ OpenSSL è§£æå…¶ä¸­çš„å‘è¡Œå•†ï¼Œå°†å¾—åˆ°å¦‚ä¸‹çš„ç»“æœã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Subject: &lt;span class=&#34;nv&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;US, &lt;span class=&#34;nv&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;SPIRE, &lt;span class=&#34;nv&#34;&gt;CN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep-9df96d88-tvl49
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;SPIFFE è¿˜æ”¯æŒè”é‚¦ï¼Œä½ å¯ä»¥ä¸º SPIRE Agent SDS é…ç½® bundleï¼Œè¿˜éœ€è¦ä¸º pod å¢åŠ æ³¨è§£ &lt;code&gt;spiffe.io/federatesWith: &amp;quot;&amp;lt;trust.domain&amp;gt;&amp;quot;&lt;/code&gt;ï¼Œç„¶å Envoy å°±ä¼šå‘ SPRIE Server è·å– bundle äº†ï¼Œè¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#verifying-that-identities-were-created-for-workloads&#34; title=&#34;Istio å®˜æ–¹æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯åœ¨ Istio ä¸­é›†æˆ SPIRE çš„å…¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/&#34; title=&#34;SPIRE -istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE -istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>ä¸ºä»€ä¹ˆ Istio è¦ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ï¼Ÿ</title>
      <link>https://jimmysong.io/blog/why-istio-need-spire/</link>
      <pubDate>Tue, 21 Jun 2022 19:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/why-istio-need-spire/</guid>
      <description>
        
        
        &lt;p&gt;ä»Šå¹´ 6 æœˆåˆï¼Œ&lt;a href=&#34;https://istio.io/latest/news/releases/1.14.x/announcing-1.14/&#34; title=&#34;Istio 1.14 å‘å¸ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.14 å‘å¸ƒ&lt;/a&gt;
ï¼Œè¯¥ç‰ˆæœ¬ä¸­æœ€å€¼å¾—å…³æ³¨çš„ç‰¹æ€§æ˜¯æ–°å¢å¯¹ SPIRE çš„æ”¯æŒã€‚&lt;a href=&#34;https://spiffe.io&#34; title=&#34;SPIFFE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE&lt;/a&gt;
 å’Œ SPIRE éƒ½æ˜¯ CNCF å­µåŒ–é¡¹ç›®ï¼Œå…¶ä¸­ SPIRE æ˜¯ SPIFFE çš„å®ç°ä¹‹ä¸€ã€‚æœ¬æ–‡å°†å¸¦ä½ äº†è§£ SPIRE å¯¹äºé›¶ä¿¡ä»»æ¶æ„çš„æ„ä¹‰ï¼Œä»¥åŠ Istio æ˜¯ä¸ºä½•ä½¿ç”¨ SPIRE å®ç°èº«ä»½è®¤è¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸­çš„èº«ä»½è®¤è¯&#34;&gt;Kubernetes ä¸­çš„èº«ä»½è®¤è¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ Istio æœ€åˆæ˜¯åŸºäº Kubernetes å»ºç«‹èµ·æ¥çš„ï¼Œåœ¨è°ˆåœ¨ Istio ä¸­ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Kubernetes ä¸­å¦‚ä½•åšèº«ä»½è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª pod çš„ token çš„ä¾‹å­ï¼Œä¸‹é¢æ˜¯ default å‘½åç©ºé—´ä¸‹ sleep pod çš„ Service Account çš„ tokenã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;data:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ca.crt: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;CA_CRT&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: &lt;span class=&#34;nv&#34;&gt;ZGVmYXVsdA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  token: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;TOKEN_STRING&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/service-account.name: sleep
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/service-account.uid: 2c0d00e8-13a2-48d0-9ff8-f987f3325ecf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  creationTimestamp: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2022-06-14T03:01:35Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: sleep-token-gwhwd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  resourceVersion: &lt;span class=&#34;s2&#34;&gt;&amp;#34;244535398&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  uid: b8822ceb-9553-4a17-96dc-d525bbaed0e0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;type: kubernetes.io/service-account-token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°å…¶ä¸­æœ‰ &lt;code&gt;ca.crt&lt;/code&gt; å’Œ &lt;code&gt;token&lt;/code&gt; å­—æ®µï¼Œå¦‚æœè¿™ä¸ª token è¢«çªƒå–ï¼Œä¼šæœ‰ä»€ä¹ˆåæœï¼ŸKubernetes ä¸­ä½¿ç”¨ Service Account æ¥ç®¡ç† Pod çš„èº«ä»½ï¼Œç„¶ååˆ©ç”¨ RBAC æŒ‡å®šå…·æœ‰æŸ Service Account çš„ Pod å¯¹ Kubernetes  API çš„æƒé™ã€‚Service Account çš„ token å­˜å‚¨åœ¨ Secret ä¸­ï¼Œtoken ä¸­å¹¶ä¸åŒ…å«å·¥ä½œè´Ÿè½½æ‰€è¿è¡Œçš„èŠ‚ç‚¹ã€pod çš„å£°æ˜ï¼Œä¸€æ—¦ token è¢«çªƒå–ç ´åè€…å°±è·å¾—äº†è¯¥è´¦æˆ·çš„æ‰€æœ‰æƒé™ï¼Œä¼ªè£…æˆè¯¥ç”¨æˆ·çªƒå–ä¿¡æ¯æˆ–ç ´åã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª token åªèƒ½åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­æ ‡è®°è´Ÿè½½èº«ä»½ï¼ŒIstio åŒæ—¶æ”¯æŒ Kubernetes ç¯å¢ƒå’Œè™šæ‹Ÿæœºï¼Œè¿˜æœ‰å¤šé›†ç¾¤å¤šç½‘æ ¼ï¼Œå¦‚ä½•ç»Ÿä¸€è¿™äº›å¼‚æ„ç¯å¢ƒä¸­çš„å·¥ä½œè´Ÿè½½èº«ä»½ï¼Ÿè¿™æ—¶ï¼Œä¸€ä¸ªç»Ÿä¸€çš„å·¥ä½œè´Ÿè½½èº«ä»½æ ‡å‡†å°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;spiffe-ä¸-spire-ç®€ä»‹&#34;&gt;SPIFFE ä¸ SPIRE ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;SPIFFE çš„ç›®çš„æ˜¯åŸºäºé›¶ä¿¡ä»»çš„ç†å¿µï¼Œå»ºç«‹ä¸€ä¸ªå¼€æ”¾ã€ç»Ÿä¸€çš„å·¥ä½œè´Ÿè½½èº«ä»½æ ‡å‡†ï¼Œè¿™æœ‰åŠ©äºå»ºç«‹ä¸€ä¸ªé›¶ä¿¡ä»»çš„å…¨é¢èº«ä»½åŒ–çš„æ•°æ®ä¸­å¿ƒç½‘ç»œã€‚SPIFFE çš„æ ¸å¿ƒæ˜¯é€šè¿‡ç®€å• API å®šä¹‰äº†ä¸€ä¸ªçŸ­æœŸçš„åŠ å¯†èº«ä»½æ–‡ä»¶ SVIDï¼Œç”¨ä½œå·¥ä½œè´Ÿè½½è®¤è¯æ—¶ä½¿ç”¨çš„èº«ä»½æ–‡ä»¶ï¼Œä¾‹å¦‚å»ºç«‹ TLS è¿æ¥æˆ–ç­¾ç½²å’ŒéªŒè¯ JWT ä»¤ç‰Œç­‰ã€‚SPIRE å¯ä»¥æ ¹æ®ç®¡ç†å‘˜å®šä¹‰çš„ç­–ç•¥è‡ªåŠ¨è½®æ¢ X.509 SVID è¯ä¹¦å’Œç§˜é’¥ã€‚Istio å¯ä»¥é€šè¿‡ SPIRE åŠ¨æ€çš„æ¶ˆè´¹å·¥ä½œè´Ÿè½½æ ‡è¯†ï¼ŒSPIRE å¯ä»¥åŠ¨æ€çš„æä¾›å·¥ä½œè´Ÿè½½æ ‡è¯†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å°†ä¸ºä½ ç®€å•ä»‹ç»ä¸€ä¸‹ä¸ SPIFFE ç›¸å…³çš„ä¸€äº›æœ¯è¯­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SPIFFE&lt;/strong&gt;ï¼ˆSecure Production Identity Framework For Everyoneï¼‰æ˜¯ä¸€å¥—èº«ä»½è®¤è¯æ ‡å‡†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SPIRE&lt;/strong&gt;ï¼ˆSPIFFE Runtime Environmentï¼‰æ˜¯ SPIFFE æ ‡å‡†çš„ä¸€å¥—ç”Ÿäº§å°±ç»ªå®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SVID&lt;/strong&gt;ï¼ˆSPIFFE Verifiable Identity Documentï¼‰æ˜¯å·¥ä½œè´Ÿè½½å‘èµ„æºæˆ–è°ƒç”¨è€…è¯æ˜å…¶èº«ä»½çš„æ–‡ä»¶ã€‚SVID åŒ…å«ä¸€ä¸ª SPIFFE IDï¼Œä»£è¡¨äº†æœåŠ¡çš„èº«ä»½ã€‚å®ƒå°† SPIFFE ID ç¼–ç åœ¨ä¸€ä¸ªå¯åŠ å¯†éªŒè¯çš„æ–‡ä»¶ä¸­ï¼Œç›®å‰æ”¯æŒä¸¤ç§æ ¼å¼ï¼šX.509 è¯ä¹¦æˆ– JWT ä»¤ç‰Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SPIFFE ID&lt;/strong&gt; æ˜¯ä¸€ä¸ªç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰ï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š&lt;code&gt;spiffe://trust_domain/workload_identifier&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SPIRE åŒ…å« Server å’Œ Agent ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SPIRE Server&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èº«ä»½æ˜ å°„&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹è®¤è¯&lt;/li&gt;
&lt;li&gt;SVID é¢å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;SPIRE Agent&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·¥ä½œè´Ÿè½½è®¤è¯&lt;/li&gt;
&lt;li&gt;æä¾›å·¥ä½œè´Ÿè½½ API&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;spiffe-ä¸é›¶ä¿¡ä»»å®‰å…¨&#34;&gt;SPIFFE ä¸é›¶ä¿¡ä»»å®‰å…¨&lt;/h2&gt;
&lt;p&gt;é›¶ä¿¡ä»»çš„æœ¬è´¨æ˜¯ä»¥èº«ä»½ä¸ºä¸­å¿ƒçš„åŠ¨æ€è®¿é—®æ§åˆ¶ã€‚åŠ¨æ€è¯ä¹¦è½®æ¢ã€åŠ¨æ€è¯ä¹¦ä¸‹å‘ã€åŠ¨æ€æƒé™æ§åˆ¶ã€‚SPIFFE è§£å†³çš„æ˜¯æ ‡è¯†å·¥ä½œè´Ÿè½½çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è™šæ‹Ÿæœºæ—¶ä»£æˆ‘ä»¬å¯èƒ½æ ¹æ®ä¸€ä¸ª IP åœ°å€å’Œç«¯å£æ¥æ ‡è¯†ä¸€ä¸ªå·¥ä½œè´Ÿè½½ï¼ŒåŸºäº IP åœ°å€æ ‡è¯†å­˜åœ¨å¤šä¸ªæœåŠ¡å…±äº«ä¸€ä¸ª IP åœ°å€ï¼ŒIP åœ°å€ä¼ªé€ å’Œè®¿é—®æ§åˆ¶åˆ—è¡¨è¿‡å¤§ç­‰é—®é¢˜ã€‚åˆ°äº† Kubernetes æ—¶ä»£ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œæˆ‘ä»¬æ— æ³•å†ç”¨ IP åœ°å€æ¥æ ‡è¯†è´Ÿè½½ï¼Œè€Œæ˜¯é€šè¿‡ pod æˆ– service åç§°ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„äº‘ã€è½¯ä»¶å¹³å°å¯¹å·¥ä½œè´Ÿè½½æ ‡è¯†çš„æ–¹æ³•ä¸åŒï¼Œç›¸äº’ä¹‹é—´å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚å°¤å…¶æ˜¯åœ¨å¼‚æ„æ··åˆäº‘çš„ä¸­ï¼ŒåŒæ—¶å­˜åœ¨è™šæ‹Ÿæœºå’Œå®¹å™¨çš„å·¥ä½œè´Ÿè½½ã€‚è¿™æ—¶ï¼Œå»ºç«‹ä¸€ä¸ªç»†ç²’åº¦ã€å…·æœ‰äº’æ“ä½œæ€§çš„æ ‡è¯†ç³»ç»Ÿï¼Œå°†å…·æœ‰é‡è¦æ„ä¹‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨-istio-ä¸­ä½¿ç”¨-spire-åšèº«ä»½è®¤è¯&#34;&gt;åœ¨ Istio ä¸­ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯&lt;/h2&gt;
&lt;p&gt;Istio ä¼šåˆ©ç”¨ SPIRE ä¸ºæ¯ä¸ªå·¥ä½œè´Ÿè½½æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼ŒæœåŠ¡ç½‘æ ¼ä¸­çš„å·¥ä½œè´Ÿè½½åœ¨è¿›è¡Œå¯¹ç­‰èº«ä»½è®¤è¯ã€è¯·æ±‚èº«ä»½è®¤è¯å’Œæˆæƒç­–ç•¥éƒ½ä¼šä½¿ç”¨åˆ°æœåŠ¡æ ‡è¯†ï¼Œç”¨äºéªŒè¯è®¿é—®æ˜¯å¦è¢«å…è®¸ã€‚SPIRE åŸç”Ÿæ”¯æŒ Envoy SDS APIï¼ŒSPIRE Agent ä¸­çš„é€šè¿‡ä¸å·¥ä½œè´Ÿè½½ä¸­å…±äº«çš„ UNIX Domain Socket é€šä¿¡ï¼Œä¸ºå·¥ä½œè´Ÿè½½é¢å‘ SVIDã€‚è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
äº†è§£å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ SPIRE åšèº«ä»½è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;SDS æœ€é‡è¦çš„å¥½å¤„å°±æ˜¯ç®€åŒ–äº†è¯ä¹¦ç®¡ç†ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨ Kubernetes deployment ä¸­ï¼Œè¯ä¹¦å°±å¿…é¡»ä»¥ secret çš„æ–¹å¼è¢«åˆ›å»ºï¼Œç„¶åæŒ‚è½½è¿›ä»£ç†å®¹å™¨ã€‚å¦‚æœè¯ä¹¦è¿‡æœŸäº†ï¼Œå°±éœ€è¦æ›´æ–° secret ä¸”ä»£ç†å®¹å™¨éœ€è¦è¢«é‡æ–°éƒ¨ç½²ã€‚å¦‚æœä½¿ç”¨ SDSï¼ŒIstio å¯ä»¥ä½¿ç”¨ SDS æœåŠ¡å™¨ä¼šå°†è¯ä¹¦æ¨é€ç»™æ‰€æœ‰çš„ Envoy å®ä¾‹ã€‚å¦‚æœè¯ä¹¦è¿‡æœŸäº†ï¼ŒæœåŠ¡å™¨ä»…éœ€è¦å°†æ–°è¯ä¹¦æ¨é€è‡³ Envoy å®ä¾‹ï¼ŒEnvoy å°†ä¼šç«‹å³ä½¿ç”¨æ–°è¯ä¹¦ä¸”ä¸éœ€è¦é‡æ–°éƒ¨ç½²ä»£ç†å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œèº«ä»½è®¤è¯çš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/why-istio-need-spire/spire-with-kubernetes.svg&#34; data-img=&#34;/blog/why-istio-need-spire/spire-with-kubernetes.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œèº«ä»½è®¤è¯çš„æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio ä¸­ä½¿ç”¨ SPIRE è¿›è¡Œèº«ä»½è®¤è¯çš„æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes é›†ç¾¤ä¸­çš„ &lt;code&gt;spire&lt;/code&gt; å‘½åç©ºé—´ä¸­ä½¿ç”¨ StatefulSet éƒ¨ç½² SPIRE Server å’Œ Kubernetes Workload Registrarï¼Œä½¿ç”¨ DaemonSet èµ„æºä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ¨ç½²ä¸€ä¸ª SPIRE Agentã€‚å‡è®¾ä½ åœ¨å®‰è£… Kubernetes æ—¶ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ DNS åç§° &lt;code&gt;cluster.local&lt;/code&gt;ï¼Œ&lt;a href=&#34;https://github.com/spiffe/spire/blob/main/support/k8s/k8s-workload-registrar/README.md&#34; title=&#34;Kubernetes Workload Registar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Workload Registar&lt;/a&gt;
 ä¼šä¸º Istio Mesh ä¸­çš„å·¥ä½œè´Ÿè½½åˆ›å»ºå¦‚ä¸‹æ ¼å¼çš„èº«ä»½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SPRRE Server:&lt;code&gt;spiffe://cluster.local/ns/spire/sa/server&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;SPIRE Agent:&lt;code&gt;spiffe://cluster.local/ns/spire/sa/spire-agent&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Kubernetes Node:&lt;code&gt;spiffe://cluster.local/k8s-workload-registrar/demo-cluster/node/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Kubernetes Worload Pod:&lt;code&gt;spiffe://cluster.local/{namespace}/spire/sa/{service_acount}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·ä¸è®ºæ˜¯èŠ‚ç‚¹è¿˜æ˜¯æ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½æœ‰å®ƒä»¬å…¨å±€å”¯ä¸€çš„èº«ä»½ï¼Œè€Œä¸”è¿˜å¯ä»¥æ ¹æ®é›†ç¾¤ï¼ˆä¿¡ä»»åŸŸï¼‰æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;Istio ä¸­çš„å·¥ä½œè´Ÿè½½èº«ä»½éªŒè¯è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;workload-attestation.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Istio æœåŠ¡ç½‘æ ¼ä¸­çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾&#34; width=&#34;50%&#34;data-img=&#34;workload-attestation.svg&#34;
         data-caption=&#34;Istio æœåŠ¡ç½‘æ ¼ä¸­çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Istio æœåŠ¡ç½‘æ ¼ä¸­çš„å·¥ä½œè´Ÿè½½èº«ä»½è®¤è¯è¿‡ç¨‹ç¤ºæ„å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·¥ä½œè´Ÿè½½çš„ sidecar ä¸­çš„ &lt;code&gt;pilot-agent&lt;/code&gt; ä¼šé€šè¿‡å…±äº«çš„ UDS è°ƒç”¨ SPIRE Agent æ¥è·å– SVID&lt;/li&gt;
&lt;li&gt;SPIRE Agent è¯¢é—® Kubernetesï¼ˆå‡†ç¡®çš„è¯´æ˜¯èŠ‚ç‚¹ä¸Šçš„ kubeletï¼‰è·å–è´Ÿè½½çš„ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;Kubelet å°†ä» API server æŸ¥è¯¢åˆ°çš„ä¿¡æ¯è¿”å›ç»™å·¥ä½œè´Ÿè½½éªŒè¯å™¨&lt;/li&gt;
&lt;li&gt;éªŒè¯å™¨å°† kubelet è¿”å›çš„ç»“æœä¸ sidecar å…±äº«çš„èº«ä»½ä¿¡æ¯æ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å°†æ­£ç¡®çš„ SVID ç¼“å­˜è¿”å›ç»™å·¥ä½œè´Ÿè½½ï¼Œå¦‚æœä¸åŒï¼Œåˆ™èº«ä»½è®¤è¯å¤±è´¥&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…³äºå·¥ä½œè´Ÿè½½çš„æ³¨å†Œå’Œè®¤è¯çš„è¯¦ç»†è¿‡ç¨‹è¯·å‚è€ƒ &lt;a href=&#34;https://lib.jimmysong.io/kubernetes-handbook/concepts/spire/&#34; title=&#34;SPIRE æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;èº«ä»½æ˜¯é›¶ä¿¡ä»»ç½‘ç»œçš„åŸºç¡€ï¼ŒSPIFFE ç»Ÿä¸€äº†å¼‚æ„ç¯å¢ƒä¸‹çš„èº«ä»½æ ‡å‡†ã€‚åœ¨ Istio ä¸­ä¸è®ºæˆ‘ä»¬æ˜¯å¦ä½¿ç”¨ SPIREï¼Œèº«ä»½éªŒè¯å¯¹äºå·¥ä½œè´Ÿè½½æ¥è¯´æ˜¯ä¸ä¼šæœ‰ä»»ä½•æ„ŸçŸ¥çš„ã€‚é€šè¿‡ SPIRE æ¥ä¸ºå·¥ä½œè´Ÿè½½æä¾›èº«ä»½éªŒè¯ï¼Œå¯ä»¥æœ‰æ•ˆçš„ç®¡ç†å·¥ä½œè´Ÿè½½çš„èº«ä»½ï¼Œä¸ºå®ç°é›¶ä¿¡ä»»ç½‘ç»œæ‰“å¥½åŸºç¡€ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒºè‘—ã€Šæ·±å…¥ç†è§£ Istioã€‹æ­£å¼ä¸Šå¸‚å¼€å”®</title>
      <link>https://jimmysong.io/blog/istio-service-mesh-book/</link>
      <pubDate>Wed, 15 Jun 2022 20:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-service-mesh-book/</guid>
      <description>
        
        
        &lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-service-mesh-book/istio-book.jpg&#34; data-img=&#34;/blog/istio-service-mesh-book/istio-book.jpg&#34; data-width=&#34;1200&#34; data-height=&#34;800&#34; alt=&#34;image&#34; data-caption=&#34;äº‘åŸç”Ÿç¤¾åŒºæœ€æ–°åŠ›ä½œ â€”â€” ã€Šæ·±å…¥ç†è§£ Istioã€‹ä¸Šå¸‚å¼€å”®&#34;&gt;
    
  
  &lt;figcaption&gt;äº‘åŸç”Ÿç¤¾åŒºæœ€æ–°åŠ›ä½œ â€”â€” ã€Šæ·±å…¥ç†è§£ Istioã€‹ä¸Šå¸‚å¼€å”®&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;2017 å¹´ 5 æœˆï¼ŒGoogleã€IBM å’Œ Lyft è”åˆ &lt;a href=&#34;https://istio.io/latest/news/releases/0.x/announcing-0.1/&#34; title=&#34;å®£å¸ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒ&lt;/a&gt;
 å°† &lt;a href=&#34;https://istio.io&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
 å¼€æºï¼Œä¸çŸ¥ä¸è§‰ä¸­è·ä»Šå·² 5 å¹´æœ‰ä½™ã€‚åœ¨è¿™ 5 å¹´å¤šçš„æ—¶é—´é‡Œï¼ŒIstio é¡¹ç›®ä»ä¸€é¢—ç§å­é•¿æˆäº†å‚å¤©å¤§æ ‘ã€‚å°¤å…¶æ˜¯åœ¨ 2018 å¹´ Istio 1.0 ç‰ˆæœ¬å‘å¸ƒçš„æ¥ä¸‹æ¥ä¸¤å¹´é‡Œï¼Œå›½å†…æœ‰å¤šæœ¬å…³äº Istio æœåŠ¡ç½‘æ ¼çš„å›¾ä¹¦ä¸Šå¸‚ã€‚åœ¨ Istio å›¾ä¹¦å‡ºç‰ˆé¢†åŸŸï¼Œæˆ‘å›½èµ°åœ¨äº†ä¸–ç•Œçš„å‰åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-service-mesh-book/istio-history.svg&#34; data-img=&#34;/blog/istio-service-mesh-book/istio-history.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio å¼€æºæ—¶é—´çº¿&#34;&gt;
    
  
  &lt;figcaption&gt;Istio å¼€æºæ—¶é—´çº¿&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼äº‘åŸç”Ÿçš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€&#34;&gt;æœåŠ¡ç½‘æ ¼ï¼šäº‘åŸç”Ÿçš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€&lt;/h2&gt;
&lt;p&gt;å¦‚ä»Šåœ¨å›½å†…ï¼ŒIstio å‡ ä¹å¯ä»¥ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„ä»£åè¯ï¼Œä½œä¸º &lt;a href=&#34;https://github.com/cncf/toc/blob/main/DEFINITION.md&#34; title=&#34;CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰å®šä¹‰çš„äº‘åŸç”Ÿ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰å®šä¹‰çš„äº‘åŸç”Ÿ&lt;/a&gt;
å…³é”®æŠ€æœ¯ä¹‹ä¸€ï¼ŒæœåŠ¡ç½‘æ ¼å‘å±•è‡³ä»Šç»å†äº†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¢ç´¢é˜¶æ®µï¼š2017 â€”2018 å¹´&lt;/li&gt;
&lt;li&gt;æ—©æœŸé‡‡ç”¨è€…é˜¶æ®µï¼š2019â€”2020 å¹´&lt;/li&gt;
&lt;li&gt;å¤§è§„æ¨¡è½åœ°åŠç”Ÿæ€å‘å±•é˜¶æ®µï¼š2021 å¹´è‡³ä»Š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2018 å¹´ï¼ŒCNCF å¯¹äº‘åŸç”Ÿçš„å®šä¹‰æ˜¯ï¼šäº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ APIã€‚&lt;/p&gt;
&lt;p&gt;å¯è§ï¼ŒCNCF å°†æœåŠ¡ç½‘æ ¼åŠ å…¥äº†äº‘åŸç”Ÿå®šä¹‰ä¸­ï¼Œå³æœåŠ¡ç½‘æ ¼æ˜¯äº‘åŸç”Ÿçš„ä»£è¡¨æ€§æŠ€æœ¯ä¹‹ä¸€ã€‚å¦‚ä»Šï¼ŒGoogle æ­£åœ¨å°† Istio æçŒ®ç»™ CNCFï¼Œæˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡ï¼Œæˆä¸º CNCF é¡¹ç›®åï¼ŒIstio çš„ç¤¾åŒºä¼šå¼€æ”¾ï¼Œå®ƒæœªæ¥çš„å‘å±•ä¹‹è·¯ä¹Ÿä¼šæ›´é¡ºç•…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼ä¸äº‘åŸç”Ÿåº”ç”¨&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸äº‘åŸç”Ÿåº”ç”¨&lt;/h2&gt;
&lt;p&gt;äº‘åŸç”Ÿçš„å‘å±•æ–¹å…´æœªè‰¾ï¼Œè™½ç„¶ä¸æ–­æœ‰æ–°çš„æŠ€æœ¯å’Œäº§å“å‡ºç°ï¼Œä½†ä½œä¸ºæ•´ä¸ªäº‘åŸç”ŸæŠ€æœ¯æ ˆçš„ä¸€éƒ¨åˆ†ï¼ŒæœåŠ¡ç½‘æ ¼åœ¨è¿‡å»ä¸€å¹´é‡Œä¸æ–­å¤¯å®äº†å®ƒä½œä¸ºâ€œäº‘åŸç”Ÿç½‘ç»œåŸºç¡€è®¾æ–½â€çš„å®šä½ã€‚ä¸‹å›¾å±•ç¤ºäº†äº‘åŸç”ŸæŠ€æœ¯æ ˆæ¨¡å‹ï¼Œå…¶ä¸­çš„æ¯ä¸€å±‚éƒ½æœ‰ä¸€äº›ä»£è¡¨æ€§çš„æŠ€æœ¯æ¥å®šä¹‰æ ‡å‡†ã€‚ä½œä¸ºæ–°æ—¶ä»£çš„ä¸­é—´ä»¶ï¼ŒæœåŠ¡ç½‘æ ¼ä¸å…¶ä»–äº‘åŸç”ŸæŠ€æœ¯äº¤ç›¸è¾‰æ˜ ï¼Œå¦‚ Daprï¼ˆåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼‰å®šä¹‰äº†äº‘åŸç”Ÿä¸­é—´ä»¶çš„èƒ½åŠ›æ¨¡å‹ï¼ŒOAM å®šä¹‰äº†äº‘åŸç”Ÿåº”ç”¨ç¨‹åºæ¨¡å‹ç­‰ï¼Œè€ŒæœåŠ¡ç½‘æ ¼å®šä¹‰äº†äº‘åŸç”Ÿä¸ƒå±‚ç½‘ç»œæ¨¡å‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;cloud-native-stack.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;äº‘åŸç”Ÿåº”ç”¨æŠ€æœ¯æ ˆ&#34; width=&#34;80%&#34;data-img=&#34;cloud-native-stack.svg&#34;
         data-caption=&#34;äº‘åŸç”Ÿåº”ç”¨æŠ€æœ¯æ ˆ&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            äº‘åŸç”Ÿåº”ç”¨æŠ€æœ¯æ ˆ
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘æ ¼&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨æœåŠ¡ç½‘æ ¼å¹¶éæ„å‘³ç€ä¸ Kubernetes å†³è£‚ï¼Œè€Œæ˜¯è‡ªç„¶è€Œç„¶çš„äº‹æƒ…ã€‚Kubernetes çš„æœ¬è´¨æ˜¯é€šè¿‡å£°æ˜é…ç½®å¯¹åº”ç”¨è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè€ŒæœåŠ¡ç½‘æ ¼çš„æœ¬è´¨æ˜¯æä¾›åº”ç”¨é—´çš„æµé‡æ§åˆ¶å’Œå®‰å…¨æ€§ç®¡ç†ï¼Œä»¥åŠå¯è§‚å¯Ÿæ€§ã€‚å‡å¦‚å·²ç»ä½¿ç”¨ Kubernetes æ„å»ºäº†ç¨³å®šçš„å¾®æœåŠ¡å¹³å°ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾ç½®æœåŠ¡é—´è°ƒç”¨çš„è´Ÿè½½å‡è¡¡å’Œæµé‡æ§åˆ¶å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Envoy åˆ›é€ çš„ xDS åè®®è¢«ä¼—å¤šå¼€æºè½¯ä»¶æ‰€æ”¯æŒï¼Œå¦‚ Istioã€Linkerdã€MOSN ç­‰ã€‚Envoy å¯¹æœåŠ¡ç½‘æ ¼æˆ–äº‘åŸç”Ÿè€Œè¨€æœ€å¤§çš„è´¡çŒ®å°±æ˜¯å®šä¹‰äº† xDSã€‚Envoy æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç½‘ç»œä»£ç†ï¼Œæ˜¯é€šè¿‡ API é…ç½®çš„ç°ä»£ç‰ˆä»£ç†ï¼ŒåŸºäºå®ƒè¡ç”Ÿå‡ºäº†å¾ˆå¤šä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚ API ç½‘å…³ã€æœåŠ¡ç½‘æ ¼ä¸­çš„ sidecar ä»£ç†å’Œè¾¹ç¼˜ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;æŠ€æœ¯å‘å±•ä» Kubernetes åˆ° Istioï¼Œæ¦‚æ‹¬æ¥è®²æœ‰ä»¥ä¸‹åŸå› ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes çš„æœ¬è´¨æ˜¯åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†ï¼ˆæ‰©ç¼©å®¹ã€è‡ª åŠ¨æ¢å¤ã€å‘å¸ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ä¸ºå¾®æœåŠ¡æä¾›äº†å¯æ‰©å±•ã€é«˜å¼¹æ€§çš„éƒ¨ç½²å’Œç®¡ç†å¹³å°ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼çš„åŸºç¡€æ˜¯é€æ˜ä»£ç†ï¼Œå…ˆé€šè¿‡ sidecar ä»£ç†æ‹¦æˆªå¾®æœåŠ¡é—´çš„æµé‡ï¼Œå†é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ç®¡ç†å¾®æœåŠ¡çš„è¡Œä¸ºã€‚å¦‚ä»Šï¼ŒæœåŠ¡ç½‘æ ¼çš„éƒ¨ç½²æ¨¡å¼ä¹Ÿè¿æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼Œsidecar å·²ç»ä¸æ˜¯æœåŠ¡ç½‘æ ¼æ‰€å¿…é¡»çš„ï¼ŒåŸºäº gRPC çš„æ— ä»£ç†çš„æœåŠ¡ç½‘æ ¼ä¹Ÿåœ¨æµ‹è¯•ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;xDS å®šä¹‰äº†æœåŠ¡ç½‘æ ¼é…ç½®çš„åè®®æ ‡å‡†ï¼Œç›®å‰åŸºäº gRPC çš„ xDS ä¹Ÿæ­£åœ¨å¼€å‘ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼å°†æµé‡ç®¡ç†ä» Kubernetes ä¸­è§£è€¦ï¼ŒæœåŠ¡ç½‘æ ¼å†…éƒ¨çš„æµé‡æ— é¡» kube-proxy ç»„ä»¶çš„æ”¯æŒï¼Œé€šè¿‡æ¥è¿‘å¾®æœåŠ¡åº”ç”¨å±‚çš„æŠ½è±¡ï¼Œç®¡ç†æœåŠ¡é—´çš„æµé‡ï¼Œå®ç°å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼æ˜¯å¯¹ Kubernetes ä¸­ service æ›´ä¸Šå±‚çš„æŠ½è±¡ï¼Œå®ƒçš„ä¸‹ä¸€æ­¥æ˜¯ Serverlessï¼Œè¿™ä¹Ÿæ˜¯ Google åœ¨ Istio ä¹‹åç´§æ¥ç€æ¨å‡ºåŸºäº Kubernetes å’Œ Istio ä¹‹ä¸Šçš„ Knative çš„åŸå› ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä»¥ç¤¾åŒºä¹‹åæˆå°±å¼€æº&#34;&gt;ä»¥ç¤¾åŒºä¹‹åæˆå°±å¼€æº&lt;/h2&gt;
&lt;p&gt;2018 å¹´ 5 æœˆï¼Œåœ¨èš‚èšé‡‘æœçš„æ”¯æŒä¸‹ï¼ŒServiceMesher ç¤¾åŒºæˆç«‹ã€‚éšåï¼Œå›½å†…åˆ®èµ·äº†æœåŠ¡ç½‘æ ¼çš„æ—‹é£ï¼Œç”±ç¤¾åŒºé¢†å¯¼çš„ Istio å®˜æ–¹æ–‡æ¡£ç¿»è¯‘å·¥ä½œä¹Ÿè¿›å…¥ç™½çƒ­åŒ–é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘æ„Ÿå—åˆ°ç³»ç»Ÿä»‹ç» Istio çš„ä¸­æ–‡èµ„æ–™åŒ®ä¹ï¼Œäºæ˜¯åœ¨ 2018 å¹´ 9 æœˆå¼€å§‹æ„æ€å†™ä¸€æœ¬å…³äº Istio çš„å›¾ä¹¦ï¼Œå¹¶åœ¨ GitHub ä¸Šå‘èµ·äº† Istio Handbook çš„å¼€æºç”µå­ä¹¦é¡¹ç›®ã€‚å‡ ä¸ªæœˆåï¼Œéšç€æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„æ¨å¹¿åŠ ServiceMesher ç¤¾åŒºè§„æ¨¡çš„æ‰©å¤§ï¼Œæˆ‘åœ¨ç¤¾åŒºçš„çº¿ä¸Šçº¿ä¸‹æ´»åŠ¨ä¸­ç»“è¯†äº†å¾ˆå¤šåŒæ ·çƒ­è¡·äº Istio å’ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„æœ‹å‹ã€‚æˆ‘ä»¬ä¸€è‡´å†³å®šï¼Œä¸€èµ·å†™ä¸€æœ¬ Istio çš„å¼€æºç”µå­ä¹¦ï¼Œå°†ç¤¾åŒºç§¯ç´¯çš„å®è´µæ–‡ç« å’Œç»éªŒé›†ç»“æˆç³»ç»Ÿçš„æ–‡å­—ï¼Œåˆ†äº«ç»™å¹¿å¤§å¼€å‘è€…ã€‚&lt;/p&gt;
&lt;p&gt;2019 å¹´ 3 æœˆï¼Œåœ¨ç¤¾åŒºç®¡ç†å§”å‘˜ä¼šçš„ç»„ç»‡ä¸‹ï¼Œå‡ åä½æˆå‘˜è‡ªæ„¿å‚ä¸å¹¶å¼€å§‹å…±åŒæ’°å†™æ­¤ä¹¦ã€‚2020 å¹´ 5 æœˆï¼Œä¸ºäº†æ›´å¥½åœ°æ¨å¹¿äº‘åŸç”ŸæŠ€æœ¯ï¼Œä¸°å¯Œç¤¾åŒºåˆ†äº«çš„æŠ€æœ¯å†…å®¹ï¼Œæˆ‘ä»¬æˆç«‹äº†äº‘åŸç”Ÿç¤¾åŒºï¼Œå¹¶å°†åŸæœ‰çš„ ServiceMesher ç¤¾åŒºçº³å…¥å…¶ä¸­ï¼Œç¤¾åŒºè¿è¥çš„å†…å®¹ä¹Ÿä»æœåŠ¡ç½‘æ ¼æŠ€æœ¯æ‰©å±•åˆ°æ›´åŠ å…¨é¢çš„äº‘åŸç”ŸæŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;2020 å¹´ 10 æœˆï¼Œè¿™æœ¬ä¹¦ä¸»è¦çš„å†…å®¹è´¡çŒ®è€…ç»„æˆäº†ç¼–å§”ä¼šï¼Œæˆå‘˜åˆ†åˆ«æœ‰æˆ‘ã€é©¬è‹¥é£ã€ç‹ä½°å¹³ã€ç‹ç‚œã€ç½—å¹¿æ˜ã€èµµåŒ–å†°ã€é’Ÿåå’Œéƒ­æ—­ä¸œã€‚æˆ‘ä»¬åœ¨å‡ºç‰ˆç¤¾çš„æŒ‡å¯¼ä¸å¸®åŠ©ä¸‹ï¼Œå¯¹æœ¬ä¹¦è¿›è¡Œäº†åç»­çš„ç‰ˆæœ¬å‡çº§ã€å®Œå–„ã€ä¼˜åŒ–ç­‰å·¥ä½œã€‚ç»è¿‡åå¤çš„è¿­ä»£ï¼Œè¿™æœ¬ã€Šæ·±å…¥ç†è§£ Isitoï¼šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹ç»ˆäºå’Œå¤§å®¶è§é¢äº†ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;cover.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹å°é¢&#34; width=&#34;70%&#34;data-img=&#34;cover.jpg&#34;
         data-caption=&#34;ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹å°é¢&#34;
         
         
         data-width=&#34;1200&#34;
         data-height=&#34;1569&#34;
         
         
    /&gt;&lt;figcaption&gt;
            ã€Šæ·±å…¥ç†è§£ Istio â€”â€” äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹å°é¢
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;å…³äºæœ¬ä¹¦&#34;&gt;å…³äºæœ¬ä¹¦&lt;/h2&gt;
&lt;p&gt;Istio åœ¨ 1.5 ç‰ˆæœ¬åæœ‰äº†é‡å¤§çš„æ¶æ„å˜åŒ–ï¼ŒåŒæ—¶å¼•å…¥æˆ–æ”¹è¿›äº†å¤šé¡¹åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œå¼•å…¥äº†æ™ºèƒ½ DNS ä»£ç†ã€æ–°çš„èµ„æºå¯¹è±¡ï¼Œæ”¹è¿›äº†å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦ä»¥ Istio æ–°ç‰ˆæœ¬ä¸ºåŸºç¡€ç¼–å†™è€Œæˆï¼Œåœ¨æŒç»­è¿½è¸ª Istio ç¤¾åŒºæœ€æ–°åŠ¨å‘çš„åŸºç¡€ä¸Šï¼ŒåŠ›æ±‚ä¸ºè¯»è€…æ ä¾›æœ€æ–°ã€æœ€å…¨é¢çš„å†…å®¹ã€‚å¦å¤–ï¼Œæœ¬ä¹¦çš„å¤šä½ä½œè€…éƒ½æ˜¯ä¸€çº¿çš„å¼€å‘æˆ–è¿ç»´å·¥ç¨‹å¸ˆï¼Œå…·æœ‰ä¸°å¯Œçš„ Istio å®æˆ˜ç»éªŒï¼Œä¸ºæœ¬ä¹¦æä¾›äº†ç¿”å®ã€å®è´µçš„å‚è€ƒæ¡ˆä¾‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;feature.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;70%&#34;data-img=&#34;feature.jpg&#34;
         data-caption=&#34;&#34;
         
         
         data-width=&#34;800&#34;
         data-height=&#34;802&#34;
         
         
    /&gt;
&lt;/figure&gt;

&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;target-reader.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;70%&#34;data-img=&#34;target-reader.jpg&#34;
         data-caption=&#34;&#34;
         
         
         data-width=&#34;800&#34;
         data-height=&#34;957&#34;
         
         
    /&gt;
&lt;/figure&gt;

&lt;p&gt;ç›®å‰ï¼Œè¿™æœ¬ä¹¦å·²ç»åœ¨äº¬ä¸œå¹³å°ä¸Šçº¿ï¼Œè¦æƒ³äº†è§£æ›´å¤šæœ‰å…³ Istio çš„ç›¸å…³çŸ¥è¯†ï¼Œå°±æ¥è¯»ä¸€è¯»è¿™æœ¬ã€Šæ·±å…¥ç†è§£ Isitoï¼šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹å§ï¼&lt;/p&gt;
&lt;p&gt;äº¬ä¸œ 618ï¼Œæ»¡ 100 å‡ 50ï¼Œæ‰«ç å³è´­ï¼&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;a href=&#34;https://item.jd.com/13200745.html&#34;&gt;&lt;img src=&#34;qrcode.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;30%&#34;data-img=&#34;qrcode.jpg&#34;
         data-caption=&#34;&#34;
         
         
         data-width=&#34;400&#34;
         data-height=&#34;401&#34;
         
         
    /&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;a href=&#34;https://item.jd.com/13200745.html&#34; title=&#34;ç‚¹æ­¤è´­ä¹°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹æ­¤è´­ä¹°&lt;/a&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;


      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•ç¼–è¯‘ Istioï¼Ÿ</title>
      <link>https://jimmysong.io/blog/how-to-build-istio/</link>
      <pubDate>Sun, 15 May 2022 14:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/how-to-build-istio/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡å°†æŒ‡å¯¼ä½ å¦‚ä½•åœ¨ macOS ä¸Šç¼–è¯‘ Istio äºŒè¿›åˆ¶æ–‡ä»¶å’Œ Docker é•œåƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ„å»ºå‰çš„å‡†å¤‡&#34;&gt;æ„å»ºå‰çš„å‡†å¤‡&lt;/h2&gt;
&lt;p&gt;åœ¨æ­£å¼å¼€å§‹æ„å»ºå‰ï¼Œ&lt;a href=&#34;https://github.com/istio/istio/wiki/Preparing-for-Development-Mac&#34; title=&#34;å‚è€ƒè¿™ç¯‡æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‚è€ƒè¿™ç¯‡æ–‡æ¡£&lt;/a&gt;
 ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„æ„å»ºç¯å¢ƒä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;macOS 12.3.1 Darwin AMD64&lt;/li&gt;
&lt;li&gt;Docker Desktop 4.8.1(78998)&lt;/li&gt;
&lt;li&gt;Docker Engine v20.10.14&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¼€å§‹æ„å»º&#34;&gt;å¼€å§‹æ„å»º&lt;/h2&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://github.com/istio/istio/wiki/Using-the-Code-Base&#34; title=&#34;è¿™ç¯‡æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡æ¡£&lt;/a&gt;
 ç¼–è¯‘ Istioã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåœ¨ &lt;a href=&#34;https://github.com/istio/istio&#34; title=&#34;GitHub ä¸Š&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub ä¸Š&lt;/a&gt;
 ä¸‹è½½ Istio ä»£ç ï¼Œå°†ä»£ç ä¸‹è½½åˆ° &lt;code&gt;$GOPATH/src/istio.io/istio&lt;/code&gt; ç›®å½•ä¸‹ï¼Œä¸‹æ–‡ä¸­çš„å‘½ä»¤éƒ½åœ¨è¯¥æ ¹ç›®å½•ä¸‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶&#34;&gt;ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¸‹è½½ Istio ä¾èµ–çš„åŒ…ï¼Œè¿™äº›åŒ…å°†ä¸‹è½½åˆ° &lt;code&gt;vendor&lt;/code&gt; ç›®å½•ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go mod vendor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ„å»º Istioï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo make build
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ æ²¡æœ‰åœ¨å‘½ä»¤å‰åŠ  &lt;code&gt;sudo&lt;/code&gt;ï¼Œä½ å¯èƒ½é‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fatal: unsafe repository &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/work&amp;#39;&lt;/span&gt; is owned by someone &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;To add an exception &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; this directory, call:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	git config --global --add safe.directory /work
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fatal: unsafe repository &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/work&amp;#39;&lt;/span&gt; is owned by someone &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;To add an exception &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; this directory, call:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	git config --global --add safe.directory /work
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Makefile.core.mk:170: *** &lt;span class=&#34;s2&#34;&gt;&amp;#34;TAG cannot be empty&amp;#34;&lt;/span&gt;.  Stop.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make: *** &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;build&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å³ä½¿ä½ æŒ‰ç…§æç¤ºæ‰§è¡Œäº† &lt;code&gt;git config --global --add safe.directory /work&lt;/code&gt; åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¼šå‡ºç°é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºå®Œçš„äºŒè¿›åˆ¶æ–‡ä»¶å°†ä¿å­˜åœ¨ &lt;code&gt;out&lt;/code&gt; ç›®å½•ä¸‹ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;out
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ darwin_amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ bug-report
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ client
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ extauthz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ install-cni
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ istio-cni
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ istio-cni-taint
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ istio-iptables
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ istio_is_init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ istioctl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ logs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ operator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ pilot-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ pilot-discovery
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ release
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â””â”€â”€ server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ linux_amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â”œâ”€â”€ envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â”œâ”€â”€ envoy-centos
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â”œâ”€â”€ logs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â””â”€â”€ release
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ—¶æ„å»ºå‡ºäº† &lt;code&gt;linux_amd64&lt;/code&gt; å’Œ &lt;code&gt;darwin_amd64&lt;/code&gt; æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼–è¯‘æˆ-docker-é•œåƒ&#34;&gt;ç¼–è¯‘æˆ Docker é•œåƒ&lt;/h3&gt;
&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å°† Istio ç¼–è¯‘æˆ Docker é•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo make docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–è¯‘æ ¹æ®ä½ çš„ç½‘ç»œæƒ…å†µï¼Œå¤§æ¦‚è€—æ—¶ 3 åˆ° 5 åˆ†é’Ÿã€‚ç¼–è¯‘å®Œæˆåï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä½ å°†çœ‹åˆ° Istio çš„ Docker é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker images
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REPOSITORY                                         TAG                          IMAGE ID       CREATED              SIZE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/app_sidecar_centos_7                latest                       2044037df94b   &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; seconds ago       524MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/app_sidecar_ubuntu_jammy            latest                       5d8ae5ed55b7   About a minute ago   362MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/proxyv2                             latest                       d4679412385f   About a minute ago   243MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/install-cni                         latest                       78f46d5771d2   About a minute ago   270MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/istioctl                            latest                       c38130a5adc8   About a minute ago   190MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/pilot                               latest                       2aa9185ec202   About a minute ago   190MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/app                                 latest                       473adafaeb8d   About a minute ago   188MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/operator                            latest                       9ac1fedcdd12   About a minute ago   191MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/ext-authz                           latest                       1fb5aaf20791   About a minute ago   117MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/app_sidecar_debian_11               latest                       61376a02b95d   &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; minutes ago        407MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:5000/app_sidecar_ubuntu_xenial           latest                       7e8efe666611   &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; minutes ago        418MB
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–è¯‘å‡ºé•œåƒä»¥åï¼Œä½ å°±å¯ä»¥ä¿®æ”¹é•œåƒåå­—å¹¶æ¨é€åˆ°è‡ªå·±çš„é•œåƒä»“åº“é‡Œäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯åœ¨ macOS ä¸Šæ„å»º Istio çš„è¿‡ç¨‹ï¼Œå¦‚æœä½ å·²ç»ä¸‹è½½å¥½äº†æ„å»ºæ‰€éœ€è¦çš„çš„ Docker é•œåƒï¼Œé‚£ä¹ˆæ„å»ºæ—¶é—´å°†ä¸è¶…è¿‡ä¸€åˆ†é’Ÿï¼Œæ„å»º Docker é•œåƒä¹Ÿåªéœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/wiki/Using-the-Code-Base&#34; title=&#34;Using the Code Base - github.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Using the Code Base - github.com&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£</title>
      <link>https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/</link>
      <pubDate>Thu, 12 May 2022 21:08:59 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡æœ€æ—©æ˜¯åŸºäº Istio 1.11 æ’°å†™ï¼Œä¹‹åéšç€ Istio çš„ç‰ˆæœ¬é™†ç»­æ›´æ–°ï¼Œæœ€æ–°æ›´æ–°æ—¶é—´ä¸º 2022 å¹´ 5 æœˆ 12 æ—¥ï¼Œå…³äºæœ¬æ–‡å†å²ç‰ˆæœ¬çš„æ›´æ–°è¯´æ˜è¯·è§æ–‡ç« æœ€åã€‚æœ¬æ–‡è®°å½•äº†è¯¦ç»†çš„å®è·µè¿‡ç¨‹ï¼ŒåŠ›å›¾èƒ½å¤Ÿè®©è¯»è€…å¤ç°ï¼Œå› æ­¤äº‹æ— å·¨ç»†ï¼Œæƒ³è¦ç†è§£æŸä¸ªéƒ¨åˆ†è¿‡ç¨‹çš„è¯»è€…å¯ä»¥ä½¿ç”¨ç›®å½•è·³è½¬åˆ°å¯¹åº”çš„å°èŠ‚é˜…è¯»ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿è¯»è€…èƒ½å¤Ÿæ›´åŠ ç›´è§‚çš„äº†è§£æœ¬æ–‡ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œåœ¨é˜…è¯»æœ¬æ–‡å‰ä½ ä¹Ÿå¯ä»¥å…ˆè§‚çœ‹ä¸‹ &lt;a href=&#34;https://bilibili.com/video/BV1cF411T72o/&#34; title=&#34;Istio Workshop ç¬¬å…«è®²è§†é¢‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Workshop ç¬¬å…«è®²è§†é¢‘&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;a href=&#34;https://bilibili.com/video/BV1cF411T72o/&#34;&gt;&lt;img src=&#34;bilibili.jpg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;è§‚çœ‹è§†é¢‘&#34; width=&#34;70%&#34;data-img=&#34;bilibili.jpg&#34;
         data-caption=&#34;è§‚çœ‹è§†é¢‘&#34;
         
         
         data-width=&#34;689&#34;
         data-height=&#34;350&#34;
         
         
    /&gt;&lt;/a&gt;&lt;figcaption&gt;
            è§‚çœ‹è§†é¢‘&lt;p&gt;&lt;a href=&#34;https://bilibili.com/video/BV1cF411T72o/&#34; title=&#34;ç‚¹å‡»è§‚çœ‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»è§‚çœ‹&lt;/a&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;ä¸ºäº†ç†è§£æœ¬æ–‡å¸Œæœ›ä½ å…ˆé˜…è¯»ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/understanding-iptables/&#34; title=&#34;ç†è§£ iptables&#34;&gt;ç†è§£ iptables&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/istio-pod-process-lifecycle/&#34; title=&#34;Istio æ•°æ®å¹³é¢ Pod å¯åŠ¨è¿‡ç¨‹è¯¦è§£&#34;&gt;Istio æ•°æ®å¹³é¢ Pod å¯åŠ¨è¿‡ç¨‹è¯¦è§£&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†…å®¹ä»‹ç»&#34;&gt;å†…å®¹ä»‹ç»&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº Istio 1.13 ç‰ˆæœ¬ï¼Œå°†ä¸ºå¤§å®¶ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯ sidecar æ¨¡å¼å’Œå®ƒçš„ä¼˜åŠ¿åœ¨å“ªé‡Œã€‚&lt;/li&gt;
&lt;li&gt;Istio ä¸­æ˜¯å¦‚ä½•åš sidecar æ³¨å…¥çš„ã€‚&lt;/li&gt;
&lt;li&gt;Sidecar ä»£ç†æ˜¯å¦‚ä½•åšé€æ˜æµé‡åŠ«æŒçš„ã€‚&lt;/li&gt;
&lt;li&gt;iptables çš„è·¯ç”±è§„åˆ™ã€‚&lt;/li&gt;
&lt;li&gt;Envoy ä»£ç†æ˜¯å¦‚ä½•è·¯ç”±æµé‡åˆ°ä¸Šæ¸¸çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·å¤§å®¶ç»“åˆä¸‹å›¾ç†è§£æœ¬æ–‡ä¸­çš„å†…å®¹ï¼Œæœ¬å›¾åŸºäº Istio å®˜æ–¹æä¾›çš„ Bookinfo ç¤ºä¾‹ç»˜åˆ¶ï¼Œå±•ç¤ºçš„æ˜¯ &lt;code&gt;reviews&lt;/code&gt; Pod çš„å†…éƒ¨ç»“æ„ï¼ŒåŒ…æ‹¬ Linux Kernel ç©ºé—´ä¸­çš„ iptables è§„åˆ™ã€Sidecar å®¹å™¨ã€åº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/istio-iptables.svg&#34; data-img=&#34;/blog/sidecar-injection-iptables-and-traffic-routing/istio-iptables.svg&#34; alt=&#34;image&#34; data-caption=&#34;Istio æµé‡åŠ«æŒç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio æµé‡åŠ«æŒç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;code&gt;productpage&lt;/code&gt; è®¿é—® &lt;code&gt;reviews&lt;/code&gt; Podï¼Œå…¥ç«™æµé‡å¤„ç†è¿‡ç¨‹å¯¹åº”äºå›¾ç¤ºä¸Šçš„æ­¥éª¤ï¼š1ã€2ã€3ã€4ã€Envoy Inbound Handlerã€5ã€6ã€7ã€8ã€åº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; Pod è®¿é—® &lt;code&gt;rating&lt;/code&gt; æœåŠ¡çš„å‡ºç«™æµé‡å¤„ç†è¿‡ç¨‹å¯¹åº”äºå›¾ç¤ºä¸Šçš„æ­¥éª¤æ˜¯ï¼š9ã€10ã€11ã€12ã€Envoy Outbound Handlerã€13ã€14ã€15ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå›¾ä¸­çš„è·¯å¾„ 16 è¿‘ç”¨äºè·¯ç”±è§„åˆ™è¯´æ˜ï¼Œå®ƒä¸ä¸å‡ºç°åœ¨å½“å‰ç¤ºä¾‹ä¸­ã€‚å®é™…ä¸Šä»…å½“ Pod å†…å‘å‡ºçš„å¯¹å½“å‰ Pod å†…çš„æœåŠ¡è®¿é—®çš„æ—¶å€™æ‰ä¼šé€”å¾„å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­å…³äºæµé‡è·¯ç”±éƒ¨åˆ†ï¼ŒåŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;productpage&lt;/code&gt; æœåŠ¡è¯·æ±‚è®¿é—® &lt;code&gt;http://reviews.default.svc.cluster.local:9080/&lt;/code&gt;ï¼Œå½“æµé‡è¿›å…¥ &lt;code&gt;reviews&lt;/code&gt; Pod å†…éƒ¨æ—¶ï¼Œæµé‡æ˜¯å¦‚ä½•è¢« iptables åŠ«æŒåˆ° Envoy ä»£ç†è¢« Inbound Handler å¤„ç†çš„ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;reviews&lt;/code&gt; è¯·æ±‚è®¿é—® &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡çš„ Podï¼Œåº”ç”¨ç¨‹åºå‘å‡ºçš„å‡ºç«™æµé‡è¢« iptables åŠ«æŒåˆ° Envoy ä»£ç†çš„ Outbound Handler çš„å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨é˜…è¯»ä¸‹æ–‡æ—¶ï¼Œè¯·å¤§å®¶ç¡®ç«‹ä»¥ä¸‹å·²çŸ¥ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œ&lt;code&gt;productpage&lt;/code&gt; å‘å‡ºçš„å¯¹ &lt;code&gt;reivews&lt;/code&gt; çš„è®¿é—®æµé‡ï¼Œæ˜¯åœ¨ Envoy å·²ç»é€šè¿‡ EDS é€‰æ‹©å‡ºäº†è¦è¯·æ±‚çš„ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡çš„æŸä¸ª Podï¼ŒçŸ¥æ™“äº†å…¶ IP åœ°å€ï¼Œç›´æ¥å‘è¯¥ IP å‘é€çš„ TCP è¿æ¥è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸‰ä¸ªç‰ˆæœ¬ä¸­çš„ sidecar å·¥ä½œæ­¥éª¤ç±»ä¼¼ï¼Œä¸‹æ–‡åªä»¥å…¶ä¸­ä¸€ä¸ª Pod ä¸­çš„ sidecar æµé‡è½¬å‘æ­¥éª¤æ¥è¯´æ˜ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰è¿›å…¥ &lt;code&gt;reviews&lt;/code&gt; Pod çš„ TCP æµé‡éƒ½æ ¹æ® Pod ä¸­çš„ iptables è§„åˆ™è½¬å‘åˆ°äº† Envoy ä»£ç†çš„ 15006 ç«¯å£ï¼Œç„¶åç»è¿‡ Envoy çš„å¤„ç†ç¡®å®šè½¬å‘ç»™ Pod å†…çš„åº”ç”¨å®¹å™¨è¿˜æ˜¯é€ä¼ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;sidecar-æ¨¡å¼&#34;&gt;Sidecar æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;å°†åº”ç”¨ç¨‹åºçš„åŠŸèƒ½åˆ’åˆ†ä¸ºå•ç‹¬çš„è¿›ç¨‹è¿è¡Œåœ¨åŒä¸€ä¸ªæœ€å°è°ƒåº¦å•å…ƒä¸­ï¼ˆä¾‹å¦‚ Kubernetes ä¸­çš„ Podï¼‰å¯ä»¥è¢«è§†ä¸º &lt;strong&gt;sidecar æ¨¡å¼&lt;/strong&gt;ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œsidecar æ¨¡å¼å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºæ—è¾¹æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼Œè€Œæ— éœ€é¢å¤–ç¬¬ä¸‰æ–¹ç»„ä»¶é…ç½®æˆ–ä¿®æ”¹åº”ç”¨ç¨‹åºä»£ç ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;sidecar-pattern.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Sidecar æ¨¡å¼ç¤ºæ„å›¾&#34; width=&#34;60%&#34;data-img=&#34;sidecar-pattern.svg&#34;
         data-caption=&#34;Sidecar æ¨¡å¼ç¤ºæ„å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Sidecar æ¨¡å¼ç¤ºæ„å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;å°±åƒè¿æ¥äº† Sidecar çš„ä¸‰è½®æ‘©æ‰˜è½¦ä¸€æ ·ï¼Œåœ¨è½¯ä»¶æ¶æ„ä¸­ï¼ŒSidecar è¿æ¥åˆ°çˆ¶åº”ç”¨å¹¶ä¸”ä¸ºå…¶æ·»åŠ æ‰©å±•æˆ–è€…å¢å¼ºåŠŸèƒ½ã€‚Sidecar åº”ç”¨ä¸ä¸»åº”ç”¨ç¨‹åºæ¾æ•£è€¦åˆã€‚å®ƒå¯ä»¥å±è”½ä¸åŒç¼–ç¨‹è¯­è¨€çš„å·®å¼‚ï¼Œç»Ÿä¸€å®ç°å¾®æœåŠ¡çš„å¯è§‚å¯Ÿæ€§ã€ç›‘æ§ã€æ—¥å¿—è®°å½•ã€é…ç½®ã€æ–­è·¯å™¨ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-sidecar-æ¨¡å¼çš„ä¼˜åŠ¿&#34;&gt;ä½¿ç”¨ Sidecar æ¨¡å¼çš„ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ sidecar æ¨¡å¼éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶ï¼Œæ— éœ€åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œä»£ç†ï¼Œä½†æ˜¯é›†ç¾¤ä¸­å°†è¿è¡Œå¤šä¸ªç›¸åŒçš„ sidecar å‰¯æœ¬ã€‚åœ¨ sidecar éƒ¨ç½²æ–¹å¼ä¸­ï¼Œæ¯ä¸ªåº”ç”¨çš„å®¹å™¨æ—éƒ½ä¼šéƒ¨ç½²ä¸€ä¸ªä¼´ç”Ÿå®¹å™¨ï¼ˆå¦‚ Envoy æˆ– MOSNï¼‰ï¼Œè¿™ä¸ªå®¹å™¨ç§°ä¹‹ä¸º sidecar å®¹å™¨ã€‚Sidecar æ¥ç®¡è¿›å‡ºåº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡ã€‚åœ¨ Kubernetes çš„ Pod ä¸­ï¼Œåœ¨åŸæœ‰çš„åº”ç”¨å®¹å™¨æ—è¾¹æ³¨å…¥ä¸€ä¸ª Sidecar å®¹å™¨ï¼Œä¸¤ä¸ªå®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºï¼Œå¯ä»¥å¹¿ä¹‰çš„å°†è¿™ä¸ªåŒ…å«äº† sidecar å®¹å™¨çš„ Pod ç†è§£ä¸ºä¸€å°ä¸»æœºï¼Œä¸¤ä¸ªå®¹å™¨å…±äº«ä¸»æœºèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å› å…¶ç‹¬ç‰¹çš„éƒ¨ç½²ç»“æ„ï¼Œä½¿å¾— sidecar æ¨¡å¼å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†ä¸åº”ç”¨ä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½æŠ½è±¡åˆ°å…±åŒåŸºç¡€è®¾æ–½ï¼Œé™ä½äº†å¾®æœåŠ¡ä»£ç çš„å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;å› ä¸ºä¸å†éœ€è¦ç¼–å†™ç›¸åŒçš„ç¬¬ä¸‰æ–¹ç»„ä»¶é…ç½®æ–‡ä»¶å’Œä»£ç ï¼Œæ‰€ä»¥èƒ½å¤Ÿé™ä½å¾®æœåŠ¡æ¶æ„ä¸­çš„ä»£ç é‡å¤åº¦ã€‚&lt;/li&gt;
&lt;li&gt;Sidecar å¯ç‹¬ç«‹å‡çº§ï¼Œé™ä½åº”ç”¨ç¨‹åºä»£ç å’Œåº•å±‚å¹³å°çš„è€¦åˆåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥ç¤ºä¾‹åˆ†æ&#34;&gt;Sidecar æ³¨å…¥ç¤ºä¾‹åˆ†æ&lt;/h2&gt;
&lt;p&gt;ä»¥ Istio å®˜æ–¹æä¾›çš„ &lt;code&gt;bookinfo&lt;/code&gt; ä¸­ &lt;code&gt;productpage&lt;/code&gt; çš„ YAML ä¸ºä¾‹ï¼Œå…³äº &lt;code&gt;bookinfo&lt;/code&gt; åº”ç”¨çš„è¯¦ç»† YAML é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/istio/istio/blob/master/samples/bookinfo/platform/kube/bookinfo.yaml&#34; title=&#34;bookinfo.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo.yaml&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ–‡å°†ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è®²è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar å®¹å™¨çš„æ³¨å…¥&lt;/li&gt;
&lt;li&gt;iptables è§„åˆ™çš„åˆ›å»º&lt;/li&gt;
&lt;li&gt;è·¯ç”±çš„è¯¦ç»†è¿‡ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/examples-bookinfo-productpage-v1:1.15.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;emptyDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æŸ¥çœ‹ä¸‹ &lt;code&gt;productpage&lt;/code&gt; å®¹å™¨çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/samples/bookinfo/src/productpage/Dockerfile&#34; title=&#34;Dockerfile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dockerfile&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-docker&#34; data-lang=&#34;docker&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; python:3.7.4-slim&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; requirements.txt ./&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; pip install --no-cache-dir -r requirements.txt&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; test-requirements.txt ./&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; pip install --no-cache-dir -r test-requirements.txt&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; productpage.py /opt/microservices/&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; tests/unit/* /opt/microservices/&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; templates /opt/microservices/templates&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; static /opt/microservices/static&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; requirements.txt /opt/microservices/&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ARG&lt;/span&gt; flood_factor&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENV&lt;/span&gt; FLOOD_FACTOR &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;flood_factor&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;:-&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPOSE&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; 9080&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; /opt/microservices&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; python -m unittest discover&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USER&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CMD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;python&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.py&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;Dockerfile&lt;/code&gt; ä¸­æ²¡æœ‰é…ç½® &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œæ‰€ä»¥ &lt;code&gt;CMD&lt;/code&gt; çš„é…ç½® &lt;code&gt;python productpage.py 9080&lt;/code&gt; å°†ä½œä¸ºé»˜è®¤çš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼Œå†çœ‹ä¸‹æ³¨å…¥ sidecar ä¹‹åçš„é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åªæˆªå–å…¶ä¸­ä¸ &lt;code&gt;productpage&lt;/code&gt; ç›¸å…³çš„ &lt;code&gt;Deployment&lt;/code&gt; é…ç½®ä¸­çš„éƒ¨åˆ† YAML é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/examples-bookinfo-productpage-v1:1.15.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åº”ç”¨é•œåƒ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sidecar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;$(POD_NAMESPACE).svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;configPath&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/etc/istio/proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;binaryPath&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/usr/local/bin/envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;serviceCluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;productpage.$(POD_NAMESPACE)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;drainDuration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;45s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;parentShutdownDuration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;1m0s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;discoveryAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istiod.istio-system.svc:15012&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;zipkinAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;zipkin.istio-system:9411&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;proxyLogLevel=warning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;proxyComponentLogLevel=misc:error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;connectTimeout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;10s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;proxyAdminPort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15000&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;concurrency&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;controlPlaneAuthPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NONE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;dnsRefreshRate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;300s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;statusPort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15020&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;trust-domain=cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;controlPlaneBootstrap=false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/proxyv2:1.5.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# sidecar proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15090&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-envoy-prom&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;initContainers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istio-iptables&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15001&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15006&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;1337&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;REDIRECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;m&#34;&gt;15090&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15020&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/proxyv2:1.5.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# init å®¹å™¨&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-init&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Istio ç»™åº”ç”¨ Pod æ³¨å…¥çš„é…ç½®ä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Init å®¹å™¨ &lt;code&gt;istio-init&lt;/code&gt;ï¼šç”¨äº pod ä¸­è®¾ç½® iptables ç«¯å£è½¬å‘&lt;/li&gt;
&lt;li&gt;Sidecar å®¹å™¨ &lt;code&gt;istio-proxy&lt;/code&gt;ï¼šè¿è¡Œ sidecar ä»£ç†ï¼Œå¦‚ Envoy æˆ– MOSNã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;iptables-è§„åˆ™æ³¨å…¥è§£æ&#34;&gt;iptables è§„åˆ™æ³¨å…¥è§£æ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æŸ¥çœ‹ iptables é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦ç™»é™†åˆ° sidecar å®¹å™¨ä¸­ä½¿ç”¨ root ç”¨æˆ·æ¥æŸ¥çœ‹ï¼Œå› ä¸º &lt;code&gt;kubectl&lt;/code&gt; æ— æ³•ä½¿ç”¨ç‰¹æƒæ¨¡å¼æ¥è¿œç¨‹æ“ä½œ docker å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç™»é™†åˆ° &lt;code&gt;productpage&lt;/code&gt; pod æ‰€åœ¨çš„ä¸»æœºä¸Šä½¿ç”¨ &lt;code&gt;docker&lt;/code&gt; å‘½ä»¤ç™»é™†å®¹å™¨ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ä½¿ç”¨ minikube éƒ¨ç½²çš„ Kubernetesï¼Œå¯ä»¥ç›´æ¥ç™»å½•åˆ° minikube çš„è™šæ‹Ÿæœºä¸­å¹¶åˆ‡æ¢ä¸º root ç”¨æˆ·ã€‚æŸ¥çœ‹ iptables é…ç½®ï¼Œåˆ—å‡º NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå› ä¸ºåœ¨ Init å®¹å™¨å¯åŠ¨çš„æ—¶å€™é€‰æ‹©ç»™ &lt;code&gt;istio-iptables&lt;/code&gt; ä¼ é€’çš„å‚æ•°ä¸­æŒ‡å®šå°†å…¥ç«™æµé‡é‡å®šå‘åˆ° sidecar çš„æ¨¡å¼ä¸º &lt;code&gt;REDIRECT&lt;/code&gt;ï¼Œå› æ­¤åœ¨ iptables ä¸­å°†åªæœ‰ NAT è¡¨çš„è§„æ ¼é…ç½®ï¼Œå¦‚æœé€‰æ‹© &lt;code&gt;TPROXY&lt;/code&gt; è¿˜ä¼šæœ‰ &lt;code&gt;mangle&lt;/code&gt; è¡¨é…ç½®ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; title=&#34;iptables&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables&lt;/a&gt;
 å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»…æŸ¥çœ‹ä¸ &lt;code&gt;productpage&lt;/code&gt; æœ‰å…³çš„ iptables è§„åˆ™å¦‚ä¸‹ï¼Œå› ä¸ºè¿™äº›è§„åˆ™æ˜¯è¿è¡Œåœ¨è¯¥å®¹å™¨ç‰¹å®šçš„ç½‘ç»œç©ºé—´ä¸‹ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ &lt;code&gt;nsenter&lt;/code&gt; å‘½ä»¤è¿›å…¥å…¶ç½‘ç»œç©ºé—´ã€‚è¿›å…¥çš„æ—¶å€™éœ€è¦æŒ‡å®šè¿›ç¨‹ IDï¼ˆPIDï¼‰ï¼Œå› æ­¤é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ° &lt;code&gt;productpage&lt;/code&gt; å®¹å™¨çš„ PIDã€‚å¯¹äºåœ¨ä¸åŒå¹³å°ä¸Šå®‰è£…çš„ Kubernetesï¼ŒæŸ¥æ‰¾å®¹å™¨çš„æ–¹å¼ä¼šç•¥æœ‰ä¸åŒï¼Œä¾‹å¦‚åœ¨ GKE ä¸Šï¼Œæ‰§è¡Œ &lt;code&gt;docker ps -a&lt;/code&gt; å‘½ä»¤æ˜¯æŸ¥çœ‹ä¸åˆ°ä»»ä½•å®¹å™¨è¿›ç¨‹çš„ã€‚ä¸‹é¢å·² minikube å’Œ GKE ä¸¤ä¸ªå…¸å‹çš„å¹³å°ä¸ºä¾‹ï¼ŒæŒ‡å¯¼ä½ å¦‚ä½•è¿›å…¥å®¹å™¨çš„ç½‘ç»œç©ºé—´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-minikube-ä¸­æŸ¥çœ‹å®¹å™¨ä¸­çš„-iptabes-è§„åˆ™&#34;&gt;åœ¨ minikube ä¸­æŸ¥çœ‹å®¹å™¨ä¸­çš„ iptabes è§„åˆ™&lt;/h3&gt;
&lt;p&gt;å¯¹äº minikubeï¼Œå› ä¸ºæ‰€æœ‰çš„è¿›ç¨‹éƒ½è¿è¡Œåœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå› æ­¤ä½ åªéœ€è¦ç™»å½•åˆ° minikube è™šæ‹Ÿæœºï¼Œåˆ‡æ¢ä¸º root ç”¨æˆ·ç„¶åæŸ¥æ‰¾ &lt;code&gt;productpage&lt;/code&gt; è¿›ç¨‹å³å¯ï¼Œå‚è€ƒä¸‹é¢çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# è¿›å…¥ minikube å¹¶åˆ‡æ¢ä¸º root ç”¨æˆ·ï¼Œminikube é»˜è®¤ç”¨æˆ·ä¸º docker&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ minikube ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo -i
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹ productpage pod çš„ istio-proxy å®¹å™¨ä¸­çš„è¿›ç¨‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker top &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;docker ps&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-proxy_productpage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;cut -d &lt;span class=&#34;s2&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt; -f1&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt;                &lt;span class=&#34;m&#34;&gt;10576&lt;/span&gt;               &lt;span class=&#34;m&#34;&gt;10517&lt;/span&gt;               &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;                   08:09               ?                   00:00:07            /usr/local/bin/pilot-agent proxy sidecar --domain default.svc.cluster.local --configPath /etc/istio/proxy --binaryPath /usr/local/bin/envoy --serviceCluster productpage.default --drainDuration 45s --parentShutdownDuration 1m0s --discoveryAddress istiod.istio-system.svc:15012 --zipkinAddress zipkin.istio-system:9411 --proxyLogLevel&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;warning --proxyComponentLogLevel&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;misc:error --connectTimeout 10s --proxyAdminPort &lt;span class=&#34;m&#34;&gt;15000&lt;/span&gt; --concurrency &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; --controlPlaneAuthPolicy NONE --dnsRefreshRate 300s --statusPort &lt;span class=&#34;m&#34;&gt;15020&lt;/span&gt; --trust-domain&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cluster.local --controlPlaneBootstrap&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt;                &lt;span class=&#34;m&#34;&gt;10660&lt;/span&gt;               &lt;span class=&#34;m&#34;&gt;10576&lt;/span&gt;               &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;                   08:09               ?                   00:00:33            /usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; --service-cluster productpage.default --service-node sidecar~172.17.0.16~productpage-v1-7f44c4d57c-ksf9b.default~default.svc.cluster.local --max-obj-name-len &lt;span class=&#34;m&#34;&gt;189&lt;/span&gt; --local-address-ip-version v4 --log-format &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Envoy &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Epoch 0&lt;span class=&#34;o&#34;&gt;)]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;%Y-%m-%d %T.%e&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;%t&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;%l&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;%n&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; %v -l warning --component-log-level misc:error --concurrency &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨ nsenter è¿›å…¥ sidecar å®¹å™¨çš„å‘½åç©ºé—´ï¼ˆä»¥ä¸Šä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ nsenter -n --target &lt;span class=&#34;m&#34;&gt;10660&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹ NAT è¡¨ä¸­è§„åˆ™é…ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åœ¨-gke-ä¸­æŸ¥çœ‹å®¹å™¨çš„-iptables-è§„åˆ™&#34;&gt;åœ¨ GKE ä¸­æŸ¥çœ‹å®¹å™¨çš„ iptables è§„åˆ™&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ åœ¨ GKE ä¸­å®‰è£…çš„å¤šèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ï¼Œé¦–å…ˆä½ éœ€è¦ç¡®å®šè¿™ä¸ª Pod è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œç„¶åç™»é™†åˆ°é‚£å°ä¸»æœºï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥æ‰¾è¿›ç¨‹çš„ PIDï¼Œä½ ä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ps aux&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chronos     &lt;span class=&#34;m&#34;&gt;4268&lt;/span&gt;  0.0  0.6  &lt;span class=&#34;m&#34;&gt;43796&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;24856&lt;/span&gt; ?        Ss   Apr22   0:00 python productpage.py &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chronos     &lt;span class=&#34;m&#34;&gt;4329&lt;/span&gt;  0.9  0.6 &lt;span class=&#34;m&#34;&gt;117524&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;24616&lt;/span&gt; ?        Sl   Apr22  13:43 /usr/local/bin/python /opt/microservices/productpage.py &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root      &lt;span class=&#34;m&#34;&gt;361903&lt;/span&gt;  0.0  0.0   &lt;span class=&#34;m&#34;&gt;4536&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;812&lt;/span&gt; pts/0    S+   01:54   0:00 grep --colour&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;auto productpage
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œproductpage è¿›ç¨‹çš„ PID æ˜¯ &lt;code&gt;4329&lt;/code&gt;ï¼Œä½¿ç”¨ &lt;code&gt;nsenter -n --target 4329&lt;/code&gt; è¿›å…¥è¯¥è¿›ç¨‹çš„å‘½åç©ºé—´ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¾“å…¥ &lt;code&gt;iptables -t nat -L&lt;/code&gt; å³å¯æŸ¥çœ‹ iptables è§„åˆ™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;iptables-æµé‡åŠ«æŒè¿‡ç¨‹è¯¦è§£&#34;&gt;iptables æµé‡åŠ«æŒè¿‡ç¨‹è¯¦è§£&lt;/h2&gt;
&lt;p&gt;ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œä½ å·²ç»å¯ä»¥æŸ¥çœ‹åˆ° init å®¹å™¨å‘ Pod ä¸­æ³¨å…¥çš„ iptables è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# PREROUTING é“¾ï¼šç”¨äºç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ï¼Œå°†æ‰€æœ‰å…¥ç«™ TCP æµé‡è·³è½¬åˆ° ISTIO_INBOUND é“¾ä¸Šã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain PREROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;2701&lt;/span&gt; packets, 162K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2701&lt;/span&gt;  162K ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# INPUT é“¾ï¼šå¤„ç†è¾“å…¥æ•°æ®åŒ…ï¼Œé TCP æµé‡å°†ç»§ç»­ OUTPUT é“¾ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;2701&lt;/span&gt; packets, 162K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# OUTPUT é“¾ï¼šå°†æ‰€æœ‰å‡ºç«™æ•°æ®åŒ…è·³è½¬åˆ° ISTIO_OUTPUT é“¾ä¸Šã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;79&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;6761&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;900&lt;/span&gt; ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# POSTROUTING é“¾ï¼šæ‰€æœ‰æ•°æ®åŒ…æµå‡ºç½‘å¡æ—¶éƒ½è¦å…ˆè¿›å…¥ POSTROUTING é“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬å‘å‡ºå»ï¼Œæˆ‘ä»¬çœ‹åˆ°æ­¤å¤„æœªåšä»»ä½•å¤„ç†ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain POSTROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;79&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;6761&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_INBOUND é“¾ï¼šå°†æ‰€æœ‰å…¥ç«™æµé‡é‡å®šå‘åˆ° ISTIO_IN_REDIRECT é“¾ä¸Šã€‚ç›®çš„åœ°ä¸º 15090ï¼ˆPrometheus ä½¿ç”¨ï¼‰å’Œ 15020ï¼ˆIngress gateway ä½¿ç”¨ï¼Œç”¨äº Pilot å¥åº·æ£€æŸ¥ï¼‰ç«¯å£çš„æµé‡é™¤å¤–ï¼Œå‘é€åˆ°ä»¥ä¸Šä¸¤ä¸ªç«¯å£çš„æµé‡å°†è¿”å› iptables è§„åˆ™é“¾çš„è°ƒç”¨ç‚¹ï¼Œå³ PREROUTING é“¾çš„åç»§ INPUT åç›´æ¥è°ƒç”¨åŸå§‹ç›®çš„åœ°ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_INBOUND &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15090
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2699&lt;/span&gt;  162K RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15020
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_IN_REDIRECT é“¾ï¼šå°†æ‰€æœ‰çš„å…¥ç«™æµé‡è·³è½¬åˆ°æœ¬åœ°çš„ 15006 ç«¯å£ï¼Œè‡³æ­¤æˆåŠŸçš„æ‹¦æˆªäº†æµé‡åˆ° sidecar ä»£ç†çš„ Inbound Handler ä¸­ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_IN_REDIRECT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span class=&#34;m&#34;&gt;15006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_OUTPUT é“¾ï¼šè§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œå°†åœ¨ä¸‹æ–‡è§£é‡Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    lo      127.0.0.6            anywhere &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ISTIO_IN_REDIRECT  all  --  any    lo      anywhere            !localhost            owner UID match &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    lo      anywhere             anywhere             ! owner UID match &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;900&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner UID match &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ISTIO_IN_REDIRECT  all  --  any    lo      anywhere            !localhost            owner GID match &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    lo      anywhere             anywhere             ! owner GID match &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner GID match &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             localhost &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere &lt;span class=&#34;c1&#34;&gt;#è§„åˆ™9&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_REDIRECT é“¾ï¼šå°†æ‰€æœ‰æµé‡é‡å®šå‘åˆ° Envoy ä»£ç†çš„ 15001 ç«¯å£ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_REDIRECT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œç€é‡éœ€è¦è§£é‡Šçš„æ˜¯ &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾ä¸­çš„ 9 æ¡è§„åˆ™ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œæˆ‘å°†ä»¥ä¸Šè§„åˆ™ä¸­çš„éƒ¨åˆ†å†…å®¹ä½¿ç”¨è¡¨æ ¼çš„å½¢å¼æ¥å±•ç¤ºå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è§„åˆ™&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;target&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;in&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;out&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;source&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;destination&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;127.0.0.6&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;ISTIO_IN_REDIRECT&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;!localhost owner UID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere !owner UID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere owner UID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;ISTIO_IN_REDIRECT&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;!localhost owner GID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere !owner GID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere owner GID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;localhost&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;ISTIO_REDIRECT&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;figcaption class=&#34;text-center&#34;&gt;
    ISTIO_OUTPUT é“¾ä¸­çš„è·¯ç”±è§„åˆ™
&lt;/figcaption&gt;

&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† &lt;code&gt;ISTIO_ROUTE&lt;/code&gt; è§„åˆ™çš„è¯¦ç»†æµç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;istio-route-iptables.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;Istio_ROUTE iptalbes è§„åˆ™åˆ¤æ–­æµç¨‹å›¾&#34; width=&#34;70%&#34;data-img=&#34;istio-route-iptables.svg&#34;
         data-caption=&#34;Istio_ROUTE iptalbes è§„åˆ™åˆ¤æ–­æµç¨‹å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            Istio_ROUTE iptalbes è§„åˆ™åˆ¤æ–­æµç¨‹å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æˆ‘å°†æŒ‰ç…§è§„åˆ™çš„å‡ºç°é¡ºåºæ¥è§£é‡Šæ¯æ¡è§„åˆ™çš„ç›®çš„ã€å¯¹åº”æ–‡ç« å¼€å¤´å›¾ç¤ºä¸­çš„æ­¥éª¤åŠè¯¦æƒ…ã€‚å…¶ä¸­è§„åˆ™ 5ã€6ã€7 æ˜¯åˆ†åˆ«å¯¹è§„åˆ™ 2ã€3ã€4 çš„åº”ç”¨èŒƒå›´æ‰©å¤§ï¼ˆä» UID æ‰©å¤§ä¸º GIDï¼‰ï¼Œä½œç”¨æ˜¯ç±»ä¼¼çš„ï¼Œå°†åˆå¹¶è§£é‡Šã€‚æ³¨æ„ï¼Œå…¶ä¸­çš„è§„åˆ™æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ’åºè¶Šé åçš„è§„åˆ™å°†ä½œä¸ºé»˜è®¤å€¼ã€‚å‡ºç«™ç½‘å¡ï¼ˆoutï¼‰ä¸º &lt;code&gt;lo&lt;/code&gt; ï¼ˆæœ¬åœ°å›ç¯åœ°å€ï¼Œloopback æ¥å£ï¼‰æ—¶ï¼Œè¡¨ç¤ºæµé‡çš„ç›®çš„åœ°æ˜¯æœ¬åœ° Podï¼Œå¯¹äº Pod å‘å¤–éƒ¨å‘é€çš„æµé‡å°±ä¸ä¼šç»è¿‡è¿™ä¸ªæ¥å£ã€‚æ‰€æœ‰ &lt;code&gt;review&lt;/code&gt; Pod çš„å‡ºç«™æµé‡åªé€‚ç”¨äºè§„åˆ™ 4ã€7ã€8ã€9ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™ 1&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®çš„ï¼š&lt;strong&gt;é€ä¼ &lt;/strong&gt; Envoy ä»£ç†å‘é€åˆ°æœ¬åœ°åº”ç”¨å®¹å™¨çš„æµé‡ï¼Œä½¿å…¶ç»•è¿‡ Envoy ä»£ç†ï¼Œç›´è¾¾åº”ç”¨å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹åº”å›¾ç¤ºä¸­çš„æ­¥éª¤ï¼š6 åˆ° 7ã€‚&lt;/li&gt;
&lt;li&gt;è¯¦æƒ…ï¼šè¯¥è§„åˆ™ä½¿å¾—æ‰€æœ‰æ¥è‡ª &lt;code&gt;127.0.0.6&lt;/code&gt;ï¼ˆè¯¥ IP åœ°å€å°†åœ¨ä¸‹æ–‡è§£é‡Šï¼‰çš„è¯·æ±‚ï¼Œè·³å‡ºè¯¥é“¾ï¼Œè¿”å› iptables çš„è°ƒç”¨ç‚¹ï¼ˆå³ &lt;code&gt;OUTPUT&lt;/code&gt;ï¼‰åç»§ç»­æ‰§è¡Œå…¶ä½™è·¯ç”±è§„åˆ™ï¼Œå³ &lt;code&gt;POSTROUTING&lt;/code&gt; è§„åˆ™ï¼ŒæŠŠæµé‡å‘é€åˆ°ä»»æ„ç›®çš„åœ°å€ï¼Œå¦‚æœ¬åœ° Pod å†…çš„åº”ç”¨å®¹å™¨ã€‚å¦‚æœæ²¡æœ‰è¿™æ¡è§„åˆ™ï¼Œç”± Pod å†… Envoy ä»£ç†å‘å‡ºçš„å¯¹ Pod å†…å®¹å™¨è®¿é—®çš„æµé‡å°†ä¼šæ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ï¼Œå³è§„åˆ™ 2ï¼Œæµé‡å°†å†æ¬¡è¿›å…¥åˆ°äº† Inbound Handler ä¸­ï¼Œä»è€Œå½¢æˆäº†æ­»å¾ªç¯ã€‚å°†è¿™æ¡è§„åˆ™æ”¾åœ¨ç¬¬ä¸€ä½å¯ä»¥é¿å…æµé‡åœ¨ Inbound Handler ä¸­æ­»å¾ªç¯çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™ 2ã€5&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®çš„ï¼šå¤„ç† Envoy ä»£ç†å‘å‡ºçš„ç«™å†…æµé‡ï¼ˆPod å†…éƒ¨çš„æµé‡ï¼‰ï¼Œä½†ä¸æ˜¯å¯¹ localhost çš„è¯·æ±‚ï¼Œé€šè¿‡åç»­è§„åˆ™å°†å…¶è½¬å‘ç»™ Envoy ä»£ç†çš„ Inbound Handlerã€‚è¯¥è§„åˆ™é€‚ç”¨äº Pod å¯¹è‡ªèº« IP åœ°å€è°ƒç”¨çš„åœºæ™¯ï¼Œå³ Pod å†…æœåŠ¡ä¹‹é—´çš„è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;è¯¦æƒ…ï¼šå¦‚æœæµé‡çš„ç›®çš„åœ°é localhostï¼Œä¸”æ•°æ®åŒ…æ˜¯ç”± 1337 UIDï¼ˆå³ &lt;code&gt;istio-proxy&lt;/code&gt; ç”¨æˆ·ï¼ŒEnvoy ä»£ç†ï¼‰å‘å‡ºçš„ï¼Œæµé‡å°†è¢«ç»è¿‡ &lt;code&gt;ISTIO_IN_REDIRECT&lt;/code&gt; æœ€ç»ˆè½¬å‘åˆ° Envoy çš„ Inbound Handlerã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™ 3ã€6&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®çš„ï¼š&lt;strong&gt;é€ä¼ &lt;/strong&gt; Pod å†…çš„åº”ç”¨å®¹å™¨çš„ç«™å†…æµé‡ã€‚è¯¥è§„åˆ™é€‚ç”¨äºå®¹å™¨å†…éƒ¨çš„æµé‡ã€‚ä¾‹å¦‚åœ¨ Pod å†…å¯¹ Pod IP æˆ– localhost çš„è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹åº”å›¾ç¤ºä¸­çš„æ­¥éª¤ï¼š6 åˆ° 7ã€‚&lt;/li&gt;
&lt;li&gt;è¯¦æƒ…ï¼šå¦‚æœæµé‡ä¸æ˜¯ç”± Envoy ç”¨æˆ·å‘å‡ºçš„ï¼Œé‚£ä¹ˆå°±è·³å‡ºè¯¥é“¾ï¼Œè¿”å› &lt;code&gt;OUTPUT&lt;/code&gt; è°ƒç”¨ &lt;code&gt;POSTROUTING&lt;/code&gt;ï¼Œç›´è¾¾ç›®çš„åœ°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™ 4ã€7&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®çš„ï¼š&lt;strong&gt;é€ä¼ &lt;/strong&gt;  Envoy ä»£ç†å‘å‡ºçš„å‡ºç«™è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹åº”å›¾ç¤ºä¸­çš„æ­¥éª¤ï¼š14 åˆ° 15ã€‚&lt;/li&gt;
&lt;li&gt;è¯¦æƒ…ï¼šå¦‚æœè¯·æ±‚æ˜¯ç”± Envoy ä»£ç†å‘å‡ºçš„ï¼Œåˆ™è¿”å› &lt;code&gt;OUTPUT&lt;/code&gt; ç»§ç»­è°ƒç”¨ &lt;code&gt;POSTROUTING&lt;/code&gt; è§„åˆ™ï¼Œæœ€ç»ˆç›´æ¥è®¿é—®ç›®çš„åœ°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™ 8&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®çš„ï¼š&lt;strong&gt;é€ä¼ &lt;/strong&gt; Pod å†…éƒ¨å¯¹ localhost çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;è¯¦æƒ…ï¼šå¦‚æœè¯·æ±‚çš„ç›®çš„åœ°æ˜¯ localhostï¼Œåˆ™è¿”å› OUTPUT è°ƒç”¨ &lt;code&gt;POSTROUTING&lt;/code&gt;ï¼Œç›´æ¥è®¿é—® localhostã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™ 9&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®çš„ï¼šæ‰€æœ‰å…¶ä»–çš„æµé‡å°†è¢«è½¬å‘åˆ° &lt;code&gt;ISTIO_REDIRECT&lt;/code&gt; åï¼Œæœ€ç»ˆè¾¾åˆ° Envoy ä»£ç†çš„ Outbound Handlerã€‚&lt;/li&gt;
&lt;li&gt;å¯¹åº”å›¾ç¤ºä¸­çš„æ­¥éª¤ï¼š10 åˆ° 11ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šè§„åˆ™é¿å…äº† Envoy ä»£ç†åˆ°åº”ç”¨ç¨‹åºçš„è·¯ç”±åœ¨ iptables è§„åˆ™ä¸­çš„æ­»å¾ªç¯ï¼Œä¿éšœäº†æµé‡å¯ä»¥è¢«æ­£ç¡®çš„è·¯ç”±åˆ° Envoy ä»£ç†ä¸Šï¼Œä¹Ÿå¯ä»¥å‘å‡ºçœŸæ­£çš„å‡ºç«™è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äº RETURN target&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½ç•™æ„åˆ°ä¸Šè¿°è§„åˆ™ä¸­æœ‰å¾ˆå¤š RETURN targetï¼Œå®ƒçš„æ„æ€æ˜¯ï¼ŒæŒ‡å®šåˆ°è¿™æ¡è§„åˆ™æ—¶ï¼Œè·³å‡ºè¯¥è§„åˆ™é“¾ï¼Œè¿”å› iptables çš„è°ƒç”¨ç‚¹ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å³ &lt;code&gt;OUTPUT&lt;/code&gt;ï¼‰åç»§ç»­æ‰§è¡Œå…¶ä½™è·¯ç”±è§„åˆ™ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å³ &lt;code&gt;POSTROUTING&lt;/code&gt; è§„åˆ™ï¼ŒæŠŠæµé‡å‘é€åˆ°ä»»æ„ç›®çš„åœ°å€ï¼Œä½ å¯ä»¥æŠŠå®ƒç›´è§‚çš„ç†è§£ä¸º&lt;strong&gt;é€ä¼ &lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äº 127.0.0.6 IP åœ°å€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;127.0.0.6 è¿™ä¸ª IP æ˜¯ Istio ä¸­é»˜è®¤çš„ &lt;code&gt;InboundPassthroughClusterIpv4&lt;/code&gt;ï¼Œåœ¨ Istio çš„ä»£ç ä¸­æŒ‡å®šã€‚å³æµé‡åœ¨è¿›å…¥ Envoy ä»£ç†åè¢«ç»‘å®šçš„ IP åœ°å€ï¼Œä½œç”¨æ˜¯è®© Outbound æµé‡é‡æ–°å‘é€åˆ°  Pod ä¸­çš„åº”ç”¨å®¹å™¨ï¼Œå³ &lt;strong&gt;Passthoughtï¼ˆé€ä¼ ï¼‰ï¼Œç»•è¿‡ Outbound Handler&lt;/strong&gt;ã€‚è¯¥æµé‡æ˜¯å¯¹ Pod è‡ªèº«çš„è®¿é—®ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„å¯¹å¤–æµé‡ã€‚è‡³äºä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ª IP ä½œä¸ºæµé‡é€ä¼ ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://github.com/istio/istio/issues/29603&#34; title=&#34;Istio Issue-29603&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Issue-29603&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&#34;&gt;æµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ä¸Šæ–‡ï¼Œä½ å·²ç»äº†è§£äº† Istio æ˜¯å¦‚ä½•åœ¨ Pod ä¸­åšé€æ˜æµé‡åŠ«æŒçš„ï¼Œé‚£ä¹ˆæµé‡è¢«åŠ«æŒåˆ° Envoy ä»£ç†ä¸­ä¹‹åæ˜¯å¦‚ä½•è¢«å¤„ç†çš„å‘¢ï¼Ÿæµé‡è·¯ç”±åˆ†ä¸º Inbound å’Œ Outbound ä¸¤ä¸ªè¿‡ç¨‹ï¼Œä¸‹é¢å°†æ ¹æ®ä¸Šæ–‡ä¸­çš„ç¤ºä¾‹åŠ sidecar çš„é…ç½®ä¸ºè¯»è€…è¯¦ç»†åˆ†ææ­¤è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç†è§£-inbound-handler&#34;&gt;ç†è§£ Inbound Handler&lt;/h3&gt;
&lt;p&gt;Inbound Handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„ downstream çš„æµé‡è½¬å‘ç»™ Pod å†…çš„åº”ç”¨ç¨‹åºå®¹å™¨ã€‚åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­ï¼Œå‡è®¾å…¶ä¸­ä¸€ä¸ª Pod çš„åå­—æ˜¯ &lt;code&gt;reviews-v1-545db77b95-jkgv2&lt;/code&gt;ï¼Œè¿è¡Œ &lt;code&gt;istioctl proxy-config listener reviews-v1-545db77b95-jkgv2 --port 15006&lt;/code&gt; æŸ¥çœ‹è¯¥ Pod ä¸­ 15006 ç«¯å£ä¸Šçš„ç›‘å¬å™¨æƒ…å†µï¼Œä½ å°†çœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;ADDRESS PORT  MATCH                                                                                           DESTINATION&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Addr: *:15006                                                                                   Non-HTTP/Non-TCP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: tls; App: istio-http/1.0,istio-http/1.1,istio-h2; Addr: 0.0.0.0/0                        InboundPassthroughClusterIpv4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: raw_buffer; App: http/1.1,h2c; Addr: 0.0.0.0/0                                           InboundPassthroughClusterIpv4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: tls; App: TCP TLS; Addr: 0.0.0.0/0                                                       InboundPassthroughClusterIpv4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: raw_buffer; Addr: 0.0.0.0/0                                                              InboundPassthroughClusterIpv4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: tls; Addr: 0.0.0.0/0                                                                     InboundPassthroughClusterIpv4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: tls; App: istio,istio-peer-exchange,istio-http/1.0,istio-http/1.1,istio-h2; Addr: *:9080 Cluster: inbound|9080||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0 15006 Trans: raw_buffer; Addr: *:9080                                                                 Cluster: inbound|9080||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢åˆ—å‡ºäº†ä»¥ä¸Šè¾“å‡ºä¸­å„å­—æ®µçš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ADDRESSï¼šä¸‹æ¸¸åœ°å€&lt;/li&gt;
&lt;li&gt;PORTï¼šEnvoy ç›‘å¬å™¨ç›‘å¬çš„ç«¯å£&lt;/li&gt;
&lt;li&gt;MATCHï¼šè¯·æ±‚ä½¿ç”¨çš„ä¼ è¾“åè®®æˆ–åŒ¹é…çš„ä¸‹æ¸¸åœ°å€&lt;/li&gt;
&lt;li&gt;DESTINATIONï¼šè·¯ç”±ç›®çš„åœ°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; Pod ä¸­çš„ Iptables å°†å…¥ç«™æµé‡åŠ«æŒåˆ° 15006 ç«¯å£ä¸Šï¼Œä»ä¸Šé¢çš„è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Envoy çš„ Inbound Handler åœ¨ 15006 ç«¯å£ä¸Šç›‘å¬ï¼Œå¯¹ç›®çš„åœ°ä¸ºä»»ä½• IP çš„ 9080 ç«¯å£çš„è¯·æ±‚å°†è·¯ç”±åˆ° &lt;code&gt;inbound|9080||&lt;/code&gt; Cluster ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä»è¯¥ Pod çš„ Listener åˆ—è¡¨çš„æœ€åä¸¤è¡Œä¸­å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;0.0.0.0:15006/TCP&lt;/code&gt; çš„ Listenerï¼ˆå…¶å®é™…åå­—æ˜¯ &lt;code&gt;virtualInbound&lt;/code&gt;ï¼‰ç›‘å¬æ‰€æœ‰çš„ Inbound æµé‡ï¼Œå…¶ä¸­åŒ…å«äº†åŒ¹é…è§„åˆ™ï¼Œæ¥è‡ªä»»æ„ IP çš„å¯¹ &lt;code&gt;9080&lt;/code&gt; ç«¯å£çš„è®¿é—®æµé‡ï¼Œå°†ä¼šè·¯ç”±åˆ° &lt;code&gt;inbound|9080||&lt;/code&gt; Clusterï¼Œå¦‚æœä½ æƒ³ä»¥ Json æ ¼å¼æŸ¥çœ‹è¯¥ Listener çš„è¯¦ç»†é…ç½®ï¼Œå¯ä»¥æ‰§è¡Œ &lt;code&gt;istioctl proxy-config listeners reviews-v1-545db77b95-jkgv2 --port 15006 -o json&lt;/code&gt; å‘½ä»¤ï¼Œä½ å°†è·å¾—ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualInbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destinationPort&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;applicationProtocols&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-peer-exchange&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-http/1.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-http/1.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-h2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;typedConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;statPrefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound_0.0.0.0_9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;routeConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtualHosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxStreamDuration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxStreamDuration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpcTimeoutHeaderMax&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;validateClusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;listenerFilters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;listenerFiltersTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;continueOnListenerFiltersTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;trafficDirection&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;INBOUND&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ—¢ç„¶ Inbound Handler çš„æµé‡ä¸­å°†æ¥è‡ªä»»æ„åœ°å€çš„å¯¹è¯¥ Pod &lt;code&gt;9080&lt;/code&gt; ç«¯å£çš„æµé‡è·¯ç”±åˆ° &lt;code&gt;inbound|9080||&lt;/code&gt; Clusterï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿è¡Œ &lt;code&gt;istioctl pc cluster reviews-v1-545db77b95-jkgv2 --port 9080 --direction inbound -o json&lt;/code&gt; æŸ¥çœ‹ä¸‹è¯¥ Cluster é…ç½®ï¼Œä½ å°†è·å¾—ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ORIGINAL_DST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;connectTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;lbPolicy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CLUSTER_PROVIDED&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxConnections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxPendingRequests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxRequests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxRetries&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;trackRemaining&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cleanupInterval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;60s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;upstreamBindConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;sourceAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterMetadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹å…¶ä¸­çš„ &lt;code&gt;TYPE&lt;/code&gt; ä¸º &lt;code&gt;ORIGINAL_DST&lt;/code&gt;ï¼Œå°†æµé‡å‘é€åˆ°åŸå§‹ç›®æ ‡åœ°å€ï¼ˆPod IPï¼‰ï¼Œå› ä¸ºåŸå§‹ç›®æ ‡åœ°å€å³å½“å‰ Podï¼Œä½ è¿˜åº”è¯¥æ³¨æ„åˆ° &lt;code&gt;upstreamBindConfig.sourceAddress.address&lt;/code&gt; çš„å€¼è¢«æ”¹å†™ä¸ºäº† &lt;code&gt;127.0.0.6&lt;/code&gt;ï¼Œè€Œä¸”å¯¹äº Pod å†…æµé‡æ˜¯é€šè¿‡ &lt;code&gt;lo&lt;/code&gt; ç½‘å¡å‘é€çš„ï¼Œè¿™åˆšå¥½å‘¼åº”äº†ä¸Šæ–‡ä¸­çš„ iptables &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾ä¸­çš„ç¬¬ä¸€æ¡è§„åˆ™ï¼Œæ ¹æ®è¯¥è§„åˆ™ï¼Œæµé‡å°†è¢«é€ä¼ åˆ° Pod å†…çš„åº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç†è§£-outbound-handler&#34;&gt;ç†è§£ Outbound Handler&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬ç¤ºä¾‹ä¸­ &lt;code&gt;reviews&lt;/code&gt; ä¼šå‘ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚çš„åœ°å€æ˜¯ï¼š&lt;code&gt;http://ratings.default.svc.cluster.local:9080/&lt;/code&gt;ï¼ŒOutbound Handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„æœ¬åœ°åº”ç”¨ç¨‹åºå‘å¤–å‘å‡ºçš„æµé‡ï¼Œç»ç”± Envoy ä»£ç†è·¯ç”±åˆ°ä¸Šæ¸¸ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ç›‘å¬åœ¨ 15001 ç«¯å£ä¸Šç›‘å¬æ‰€æœ‰ Outbound æµé‡ï¼ŒOutbound Handler å¤„ç†ï¼Œç„¶åç»è¿‡ &lt;code&gt;virtualOutbound&lt;/code&gt; Listenerã€&lt;code&gt;0.0.0.0_9080&lt;/code&gt; Listenerï¼Œç„¶åé€šè¿‡ Route 9080 æ‰¾åˆ°ä¸Šæ¸¸çš„ clusterï¼Œè¿›è€Œé€šè¿‡ EDS æ‰¾åˆ° Endpoint æ‰§è¡Œè·¯ç”±åŠ¨ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ratings.default.svc.cluster.local:9080&lt;/code&gt; è·¯ç”±&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl proxy-config routes reviews-v1-545db77b95-jkgv2 --name 9080 -o json&lt;/code&gt; æŸ¥çœ‹ route é…ç½®ï¼Œå› ä¸º sidecar ä¼šæ ¹æ® HTTP header ä¸­çš„ domains æ¥åŒ¹é… VirtualHostï¼Œæ‰€ä»¥ä¸‹é¢åªåˆ—ä¸¾äº† &lt;code&gt;ratings.default.svc.cluster.local:9080&lt;/code&gt; è¿™ä¸€ä¸ª VirtualHostã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtualHosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.8.8.106&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.8.8.106:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;nt&#34;&gt;&amp;#34;retryPolicy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;retryOn&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;connect-failure,refused-stream,unavailable,cancelled,retriable-status-codes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;numRetries&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;retryHostPredicate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.retry_host_predicates.previous_hosts&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;hostSelectionRetryMaxAttempts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;retriableStatusCodes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;mi&#34;&gt;503&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxStreamDuration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxStreamDuration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpcTimeoutHeaderMax&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                       &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;includeRequestAttemptCount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;err&#34;&gt;/*çœç•¥éƒ¨åˆ†å†…å®¹*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;validateClusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¯¥ Virtual Host é…ç½®ä¸­å¯ä»¥çœ‹åˆ°å°†æµé‡è·¯ç”±åˆ°&lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt; é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt; é›†ç¾¤çš„ç«¯ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl proxy-config endpoint reviews-v1-545db77b95-jkgv2 --port 9080 -o json --cluster &amp;quot;outbound|9080||ratings.default.svc.cluster.local&amp;quot;&lt;/code&gt; æŸ¥çœ‹é›†ç¾¤çš„ Endpoint é…ç½®ï¼Œç»“æœå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;addedViaApi&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;hostStatuses&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.4.1.12&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;stats&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;cx_connect_fail&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;cx_total&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rq_error&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rq_success&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rq_timeout&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rq_total&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GAUGE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;cx_active&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GAUGE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rq_active&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;healthStatus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;edsHealthStatus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HEALTHY&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;region&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;us-west2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;zone&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;us-west2-a&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxConnections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxPendingRequests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxRequests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxRetries&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4294967295&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;priority&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HIGH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxConnections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxPendingRequests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxRequests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxRetries&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;observabilityName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°ç«¯ç‚¹çš„åœ°å€æ˜¯ &lt;code&gt;10.4.1.12&lt;/code&gt;ã€‚å®é™…ä¸Šï¼ŒEndpoint å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œsidecar å°†æ ¹æ®ä¸€å®šè§„åˆ™é€‰æ‹©é€‚å½“çš„ Endpoint æ¥è·¯ç”±ã€‚è‡³æ­¤ &lt;code&gt;review&lt;/code&gt; Pod æ‰¾åˆ°äº†å®ƒä¸Šæ¸¸æœåŠ¡ &lt;code&gt;rating&lt;/code&gt; çš„ Endpointã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨äº† Istio å®˜æ–¹æä¾›çš„ bookinfo ç¤ºä¾‹ï¼ŒæŒ‰å›¾ç´¢éª¥å¾—å¸¦é¢†è¯»è€…äº†è§£äº† sidecar æ³¨å…¥ã€iptables é€æ˜æµé‡åŠ«æŒåŠ sidecar ä¸­æµé‡è·¯ç”±èƒŒåçš„å®ç°ç»†èŠ‚ã€‚Sidecar æ¨¡å¼å’Œæµé‡é€æ˜åŠ«æŒæ˜¯ Istio æœåŠ¡ç½‘æ ¼çš„ç‰¹è‰²å’ŒåŸºç¡€åŠŸèƒ½ï¼Œç†è§£è¯¥åŠŸèƒ½çš„èƒŒåè¿‡ç¨‹åŠå®ç°ç»†èŠ‚ï¼Œå°†æœ‰åŠ©äºå¤§å®¶ç†è§£ Service Mesh çš„åŸç†å’Œ &lt;a href=&#34;https://www.servicemesher.com/istio-handbook/&#34; title=&#34;Istio Handbook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Handbook&lt;/a&gt;
 åé¢ç« èŠ‚ä¸­çš„å†…å®¹ï¼Œå› æ­¤å¸Œæœ›è¯»è€…å¯ä»¥åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­ä»å¤´æ¥è¯•éªŒä¸€éä»¥åŠ æ·±ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ iptables åšæµé‡åŠ«æŒåªæ˜¯ service mesh çš„æ•°æ®å¹³é¢ä¸­åšæµé‡åŠ«æŒçš„æ–¹å¼ä¹‹ä¸€ï¼Œè¿˜æœ‰æ›´å¤šçš„æµé‡åŠ«æŒæ–¹æ¡ˆï¼Œä¸‹é¢å¼•ç”¨è‡ª &lt;a href=&#34;https://mosn.io/docs/products/structure/traffic-hijack/&#34; title=&#34;äº‘åŸç”Ÿç½‘ç»œä»£ç† MOSN å®˜ç½‘ä¸­ç»™å‡ºçš„æµé‡åŠ«æŒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç½‘ç»œä»£ç† MOSN å®˜ç½‘ä¸­ç»™å‡ºçš„æµé‡åŠ«æŒ&lt;/a&gt;
éƒ¨åˆ†çš„æè¿°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-iptables-åšæµé‡åŠ«æŒæ—¶å­˜åœ¨çš„é—®é¢˜&#34;&gt;ä½¿ç”¨ iptables åšæµé‡åŠ«æŒæ—¶å­˜åœ¨çš„é—®é¢˜&lt;/h3&gt;
&lt;p&gt;ç›®å‰ Istio ä½¿ç”¨ iptables å®ç°é€æ˜åŠ«æŒï¼Œä¸»è¦å­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€è¦å€ŸåŠ©äº conntrack æ¨¡å—å®ç°è¿æ¥è·Ÿè¸ªï¼Œåœ¨è¿æ¥æ•°è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œä¼šé€ æˆè¾ƒå¤§çš„æ¶ˆè€—ï¼ŒåŒæ—¶å¯èƒ½ä¼šé€ æˆ track è¡¨æ»¡çš„æƒ…å†µï¼Œä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä¸šå†…æœ‰å…³é—­ conntrack çš„åšæ³•ã€‚&lt;/li&gt;
&lt;li&gt;iptables å±äºå¸¸ç”¨æ¨¡å—ï¼Œå…¨å±€ç”Ÿæ•ˆï¼Œä¸èƒ½æ˜¾å¼çš„ç¦æ­¢ç›¸å…³è”çš„ä¿®æ”¹ï¼Œå¯ç®¡æ§æ€§æ¯”è¾ƒå·®ã€‚&lt;/li&gt;
&lt;li&gt;iptables é‡å®šå‘æµé‡æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ loopback äº¤æ¢æ•°æ®ï¼Œoutbond æµé‡å°†ä¸¤æ¬¡ç©¿è¶Šåè®®æ ˆï¼Œåœ¨å¤§å¹¶å‘åœºæ™¯ä¸‹ä¼šæŸå¤±è½¬å‘æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šè¿°å‡ ä¸ªé—®é¢˜å¹¶éåœ¨æ‰€æœ‰åœºæ™¯ä¸­éƒ½å­˜åœ¨ï¼Œæ¯”æ–¹è¯´æŸäº›åœºæ™¯ä¸‹ï¼Œè¿æ¥æ•°å¹¶ä¸å¤šï¼Œä¸” NAT è¡¨æœªè¢«ä½¿ç”¨åˆ°çš„æƒ…å†µä¸‹ï¼Œiptables æ˜¯ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„ç®€å•æ–¹æ¡ˆã€‚ä¸ºäº†é€‚é…æ›´åŠ å¹¿æ³›çš„åœºæ™¯ï¼Œé€æ˜åŠ«æŒéœ€è¦è§£å†³ä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€æ˜åŠ«æŒæ–¹æ¡ˆä¼˜åŒ–&#34;&gt;é€æ˜åŠ«æŒæ–¹æ¡ˆä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä¼˜åŒ– Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒçš„æ€§èƒ½ï¼Œä¸šç•Œæå‡ºäº†ä»¥ä¸‹æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ Merbridge å¼€æºé¡¹ç›®åˆ©ç”¨ eBPF åŠ«æŒæµé‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/merbridge/merbridge&#34; title=&#34;Merbridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Merbridge&lt;/a&gt;
 æ˜¯ç”± DaoCloud åœ¨ 2022 å¹´åˆå¼€æºçš„çš„ä¸€æ¬¾åˆ©ç”¨ eBPF åŠ é€Ÿ Istio æœåŠ¡ç½‘æ ¼çš„æ’ä»¶ã€‚ä½¿ç”¨ Merbridge å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼˜åŒ–æ•°æ®å¹³é¢çš„ç½‘ç»œæ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Merbridge åˆ©ç”¨ eBPF çš„ &lt;code&gt;sockops&lt;/code&gt; å’Œ &lt;code&gt;redir&lt;/code&gt; èƒ½åŠ›ï¼Œå¯ä»¥ç›´æ¥å°†æ•°æ®åŒ…ä» inbound socket ä¼ è¾“åˆ° outbound socketã€‚eBPF æä¾›äº† &lt;code&gt;bpf_msg_redirect_hash&lt;/code&gt; å‡½æ•°å¯ä»¥ç›´æ¥è½¬å‘åº”ç”¨ç¨‹åºçš„æ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;è¯¦è§ &lt;a href=&#34;https://jimmysong.io/istio-handbook/ecosystem/merbridge.html&#34; title=&#34;Istio æœåŠ¡ç½‘æ ¼ â€”â€” äº‘åŸç”Ÿåº”ç”¨ç½‘ç»œæ„å»ºæŒ‡å—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœåŠ¡ç½‘æ ¼ â€”â€” äº‘åŸç”Ÿåº”ç”¨ç½‘ç»œæ„å»ºæŒ‡å—&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ tproxy å¤„ç† inbound æµé‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;tproxy å¯ä»¥ç”¨äº inbound æµé‡çš„é‡å®šå‘ï¼Œä¸”æ— éœ€æ”¹å˜æŠ¥æ–‡ä¸­çš„ç›®çš„ IP/ç«¯å£ï¼Œä¸éœ€è¦æ‰§è¡Œè¿æ¥è·Ÿè¸ªï¼Œä¸ä¼šå‡ºç° conntrack æ¨¡å—åˆ›å»ºå¤§é‡è¿æ¥çš„é—®é¢˜ã€‚å—é™äºå†…æ ¸ç‰ˆæœ¬ï¼Œtproxy åº”ç”¨äº outbound å­˜åœ¨ä¸€å®šç¼ºé™·ã€‚ç›®å‰ Istio æ”¯æŒé€šè¿‡ tproxy å¤„ç† inbound æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ hook connect å¤„ç† outbound æµé‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é€‚é…æ›´å¤šåº”ç”¨åœºæ™¯ï¼Œoutbound æ–¹å‘é€šè¿‡ hook connect æ¥å®ç°ï¼Œå®ç°åŸç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
    &lt;img src=&#34;hook-connect.svg&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;
         alt=&#34;hook-connect åŸç†ç¤ºæ„å›¾&#34; width=&#34;50%&#34;data-img=&#34;hook-connect.svg&#34;
         data-caption=&#34;hook-connect åŸç†ç¤ºæ„å›¾&#34;
         
         
         
    /&gt;&lt;figcaption&gt;
            hook-connect åŸç†ç¤ºæ„å›¾
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æ— è®ºé‡‡ç”¨å“ªç§é€æ˜åŠ«æŒæ–¹æ¡ˆï¼Œå‡éœ€è¦è§£å†³è·å–çœŸå®ç›®çš„ IP/ç«¯å£çš„é—®é¢˜ï¼Œä½¿ç”¨ iptables æ–¹æ¡ˆé€šè¿‡ getsockopt æ–¹å¼è·å–ï¼Œtproxy å¯ä»¥ç›´æ¥è¯»å–ç›®çš„åœ°å€ï¼Œé€šè¿‡ä¿®æ”¹è°ƒç”¨æ¥å£ï¼Œhook connect æ–¹æ¡ˆè¯»å–æ–¹å¼ç±»ä¼¼äº tproxyã€‚&lt;/p&gt;
&lt;p&gt;å®ç°é€æ˜åŠ«æŒåï¼Œåœ¨å†…æ ¸ç‰ˆæœ¬æ»¡è¶³è¦æ±‚ï¼ˆ4.16 ä»¥ä¸Šï¼‰çš„å‰æä¸‹ï¼Œé€šè¿‡ sockmap å¯ä»¥ç¼©çŸ­æŠ¥æ–‡ç©¿è¶Šè·¯å¾„ï¼Œè¿›è€Œæ”¹å–„ outbound æ–¹å‘çš„è½¬å‘æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´æ–°è¯´æ˜&#34;&gt;æ›´æ–°è¯´æ˜&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æœ¬æ–‡çš„å‡ æ¬¡æ›´æ–°è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2020 å¹´ 4 æœˆ 27 æ—¥ï¼Œç¬¬ä¸€ç‰ˆï¼ŒåŸºäº Istio 1.5&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡çš„ç¬¬ä¸€ç‰ˆï¼ŒåŸºäº Istio 1.5 åˆ›ä½œï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘æ›¾å†™è¿‡åŸºäº Istio 1.1 ç‰ˆæœ¬çš„&lt;a href=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; title=&#34;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;
ï¼Œä¸ºäº†æ›´ç»†è‡´çš„ç†è§£ Istio ä¸­é€æ˜æµé‡åŠ«æŒçš„å…¨è¿‡ç¨‹ï¼Œä¸“é—¨åˆ›ä½œæœ¬æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2022 å¹´  1 æœˆ 17 æ—¥ï¼Œç¬¬äºŒç‰ˆï¼ŒåŸºäº Istio 1.11&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ç¬¬ä¸€ç‰ˆå‘å¸ƒåï¼Œåœ¨ç¤¾åŒºé‡Œè·å¾—äº†æ¯”è¾ƒå¤§çš„åå“ï¼Œæ”¶åˆ°äº†å¾ˆå¤šè¯»è€…çš„è¯„è®ºå’Œç•™è¨€ã€‚åŸºäºè¿™äº›è¯„è®ºï¼Œæˆ‘ä¹Ÿå‘ç°äº†ç¬¬ä¸€ç‰ˆä¸­çš„å¾ˆå¤šé”™è¯¯ï¼Œåœ¨åŠ ä¸Š Istio ç‰ˆæœ¬å‘å¸ƒé¢‘ç¹ï¼Œåœ¨è¿‘ä¸¤å¹´çš„æ—¶é—´å†…ï¼ŒIstio å·²ç»ä½œå‡ºäº†ä¼—å¤šæ›´æ–°ï¼Œå…¶ä¸­ä¸ä¹é‡å¤§æ›´æ–°ã€‚å› æ­¤ç¬”è€…æ’°å†™äº†æœ¬æ–‡çš„ç¬¬äºŒç‰ˆï¼Œä¿®æ”¹äº†ä¹‹å‰ç‰ˆæœ¬ä¸­çš„çº°æ¼å¹¶æ ¹æ®æ—¶ä¸‹ Istio çš„æœ€æ–°ç‰ˆæœ¬æ›´æ–°äº†æœ¬æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.11 ä¸ Istio 1.1 ä¸­çš„ sidecar æ³¨å…¥å’Œæµé‡åŠ«æŒç¯èŠ‚æœ€å¤§çš„å˜åŒ–æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;iptables æ”¹ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸å†ä½¿ç”¨ shell è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;sidecar inbound å’Œ outbound åˆ†åˆ«æŒ‡å®šäº†ç«¯å£ï¼Œè€Œä¹‹å‰æ˜¯ä½¿ç”¨åŒä¸€ä¸ªç«¯å£ï¼ˆ15001ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2022 å¹´ 4 æœˆ 24ï¼Œç¬¬ä¸‰ç‰ˆï¼ŒåŸºäº Istio  1.13&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç‰ˆæœ¬çš„æ–‡ç« ä¸»è¦æ˜¯æ ¹æ®å½“æ—¶ Istio çš„æœ€æ–°ç‰ˆæœ¬æ›´æ–°äº†æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ï¼Œå¹¶é‡æ–°æ’ç‰ˆï¼Œå¢åŠ æ›´æ–°è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.13 ç›¸æ¯” Istio 1.11 çš„å˜åŒ–æ˜¯ &lt;code&gt;istioctl proxy-config&lt;/code&gt; å‘½ä»¤çš„è¾“å‡ºæœ‰äº†è¾ƒå¤§å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2022 å¹´ 5 æœˆ 6 æ—¥ï¼Œç¬¬å››ç‰ˆï¼ŒåŸºäº Istio 1.13&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹äº†å¯¹ &lt;code&gt;ISTIO_ROUTE&lt;/code&gt; iptables è§„åˆ™ 2ã€5 çš„è§£é‡Š&lt;/li&gt;
&lt;li&gt;åœ¨ç¤ºæ„å›¾ä¸­å¢åŠ äº†è·¯å¾„ 16&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2022 å¹´ 5 æœˆ 12 æ—¥ï¼Œç¬¬äº”ç‰ˆï¼ŒåŸºäº Istio 1.13&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°† iptables è¯´æ˜å’Œ sidecar æ³¨å…¥ã€init å®¹å™¨éƒ¨åˆ†ç‹¬ç«‹æˆäº†ä¸¤ç¯‡å•ç‹¬çš„åšå®¢ï¼Œä»¥ç¼©å‡åšå®¢çš„ç¯‡å¹…ï¼Œè§ &lt;a href=&#34;https://jimmysong.io/blog/istio-pod-process-lifecycle/&#34; title=&#34;Istio æ•°æ®å¹³é¢ Pod å¯åŠ¨è¿‡ç¨‹è¯¦è§£&#34;&gt;Istio æ•°æ®å¹³é¢ Pod å¯åŠ¨è¿‡ç¨‹è¯¦è§£&lt;/a&gt;
å’Œ&lt;a href=&#34;https://jimmysong.io/blog/understanding-iptables/&#34; title=&#34;ç†è§£ iptables&#34;&gt;ç†è§£ iptables&lt;/a&gt;
ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2023 å¹´ 7 æœˆ 17 æ—¥ï¼Œç¬¬å…­ç‰ˆï¼ŒåŸºäº Istio 1.13&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹äº†å¯¹ ISTIO_INBOUND é“¾çš„è¯´æ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/ops/diagnostic-tools/proxy-cmd/&#34; title=&#34;Debugging Envoy and Istiod - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Debugging Envoy and Istiod - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/blog/2019/data-plane-setup/&#34; title=&#34;æ­å¼€ Istio Sidecar æ³¨å…¥æ¨¡å‹çš„ç¥ç§˜é¢çº± - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­å¼€ Istio Sidecar æ³¨å…¥æ¨¡å‹çš„ç¥ç§˜é¢çº± - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mosn.io/docs/products/structure/traffic-hijack/&#34; title=&#34;MOSN ä½œä¸º Sidecar ä½¿ç”¨æ—¶çš„æµé‡åŠ«æŒæ–¹æ¡ˆ - mosn.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN ä½œä¸º Sidecar ä½¿ç”¨æ—¶çš„æµé‡åŠ«æŒæ–¹æ¡ˆ - mosn.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio æ•°æ®å¹³é¢ Pod å¯åŠ¨è¿‡ç¨‹è¯¦è§£</title>
      <link>https://jimmysong.io/blog/istio-pod-process-lifecycle/</link>
      <pubDate>Thu, 12 May 2022 19:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-pod-process-lifecycle/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡å°†ä¸ºä½ è®²è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio ä¸­ sidecar è‡ªåŠ¨æ³¨å…¥è¿‡ç¨‹&lt;/li&gt;
&lt;li&gt;Istio ä¸­çš„ init å®¹å™¨å¯åŠ¨è¿‡ç¨‹&lt;/li&gt;
&lt;li&gt;å¯ç”¨äº† Sidecar è‡ªåŠ¨æ³¨å…¥çš„ Pod çš„å¯åŠ¨æµç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾ä¸­å±•ç¤ºäº† Istio æ•°æ®å¹³é¢ä¸­çš„ Pod å¯åŠ¨å®Œåçš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-pod-process-lifecycle/istio-pod-lifecycle.webp&#34; data-img=&#34;/blog/istio-pod-process-lifecycle/istio-pod-lifecycle.webp&#34; data-width=&#34;1200&#34; data-height=&#34;813&#34; alt=&#34;image&#34; data-caption=&#34;Istio æ•°æ®å¹³é¢ Pod å†…éƒ¨ç»„ä»¶&#34;&gt;
    
  
  &lt;figcaption&gt;Istio æ•°æ®å¹³é¢ Pod å†…éƒ¨ç»„ä»¶&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­çš„-sidecar-æ³¨å…¥&#34;&gt;Istio ä¸­çš„ sidecar æ³¨å…¥&lt;/h2&gt;
&lt;p&gt;Istio ä¸­æä¾›äº†ä»¥ä¸‹ä¸¤ç§ sidecar æ³¨å…¥æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; æ‰‹åŠ¨æ³¨å…¥ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº Kubernetes çš„ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/&#34; title=&#34;çªå˜ webhook å‡†å…¥æ§åˆ¶å™¨ï¼ˆmutating webhook addmission controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çªå˜ webhook å‡†å…¥æ§åˆ¶å™¨ï¼ˆmutating webhook addmission controller&lt;/a&gt;
 çš„è‡ªåŠ¨ sidecar æ³¨å…¥æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸è®ºæ˜¯æ‰‹åŠ¨æ³¨å…¥è¿˜æ˜¯è‡ªåŠ¨æ³¨å…¥ï¼Œsidecar çš„æ³¨å…¥è¿‡ç¨‹éƒ½éœ€è¦éµå¾ªå¦‚ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Kubernetes éœ€è¦äº†è§£å¾…æ³¨å…¥çš„ sidecar æ‰€è¿æ¥çš„ Istio é›†ç¾¤åŠå…¶é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes éœ€è¦äº†è§£å¾…æ³¨å…¥çš„ sidecar å®¹å™¨æœ¬èº«çš„é…ç½®ï¼Œå¦‚é•œåƒåœ°å€ã€å¯åŠ¨å‚æ•°ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes æ ¹æ® sidecar æ³¨å…¥æ¨¡æ¿å’Œä»¥ä¸Šé…ç½®å¡«å…… sidecar çš„é…ç½®å‚æ•°ï¼Œå°†ä»¥ä¸Šé…ç½®æ³¨å…¥åˆ°åº”ç”¨å®¹å™¨çš„ä¸€ä¾§ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ‰‹åŠ¨æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl kube-inject -f &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;YAML_FILE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kuebectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å‘½ä»¤ä¼šä½¿ç”¨ Istio å†…ç½®çš„ sidecar é…ç½®æ¥æ³¨å…¥ï¼Œä¸‹é¢ä½¿ç”¨ Istio è¯¦ç»†é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#manual-sidecar-injection&#34; title=&#34;Istio å®˜ç½‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨å…¥å®Œæˆåæ‚¨å°†çœ‹åˆ° Istio ä¸ºåŸæœ‰ pod template æ³¨å…¥äº† &lt;code&gt;initContainer&lt;/code&gt; åŠ sidecar proxy ç›¸å…³çš„é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨&#34;&gt;Init å®¹å™¨&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨æ˜¯ä¸€ç§ä¸“ç”¨å®¹å™¨ï¼Œå®ƒåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª Pod ä¸­å¯ä»¥æŒ‡å®šå¤šä¸ª Init å®¹å™¨ï¼Œå¦‚æœæŒ‡å®šäº†å¤šä¸ªï¼Œé‚£ä¹ˆ Init å®¹å™¨å°†ä¼šæŒ‰é¡ºåºä¾æ¬¡è¿è¡Œã€‚åªæœ‰å½“å‰é¢çš„ Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸåï¼Œæ‰å¯ä»¥è¿è¡Œä¸‹ä¸€ä¸ª Init å®¹å™¨ã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆåï¼ŒKubernetes æ‰åˆå§‹åŒ– Pod å’Œè¿è¡Œåº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨ä½¿ç”¨ Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œå®ƒä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—® Secret çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºå®¹å™¨åˆ™ä¸èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Pod å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒInit å®¹å™¨ä¼šæŒ‰é¡ºåºåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åå¯åŠ¨ã€‚æ¯ä¸ªå®¹å™¨å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸé€€å‡ºã€‚å¦‚æœç”±äºè¿è¡Œæ—¶æˆ–å¤±è´¥é€€å‡ºï¼Œå°†å¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå®ƒä¼šæ ¹æ® Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; æŒ‡å®šçš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; è®¾ç½®ä¸º Alwaysï¼ŒInit å®¹å™¨å¤±è´¥æ—¶ä¼šä½¿ç”¨ &lt;code&gt;RestartPolicy&lt;/code&gt; ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ‰€æœ‰çš„ Init å®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼ŒPod å°†ä¸ä¼šå˜æˆ &lt;code&gt;Ready&lt;/code&gt; çŠ¶æ€ã€‚Init å®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨ Service ä¸­è¿›è¡Œèšé›†ã€‚æ­£åœ¨åˆå§‹åŒ–ä¸­çš„ Pod å¤„äº &lt;code&gt;Pending&lt;/code&gt; çŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°† &lt;code&gt;Initializing&lt;/code&gt; çŠ¶æ€è®¾ç½®ä¸º trueã€‚Init å®¹å™¨è¿è¡Œå®Œæˆä»¥åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Init å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34; title=&#34;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;init-å®¹å™¨è§£æ&#34;&gt;Init å®¹å™¨è§£æ&lt;/h2&gt;
&lt;p&gt;Istio åœ¨ pod ä¸­æ³¨å…¥çš„ Init å®¹å™¨åä¸º &lt;code&gt;istio-init&lt;/code&gt;ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢ Istio æ³¨å…¥å®Œæˆåçš„ YAML æ–‡ä»¶ä¸­çœ‹åˆ°äº†è¯¥å®¹å™¨çš„å¯åŠ¨å‘½ä»¤æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-iptables -p &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; -z &lt;span class=&#34;m&#34;&gt;15006&lt;/span&gt; -u &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -d 15090,15020
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å†æ£€æŸ¥ä¸‹è¯¥å®¹å™¨çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/pilot/docker/Dockerfile.proxyv2&#34; title=&#34;Dockerfile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dockerfile&lt;/a&gt;
 çœ‹çœ‹ &lt;code&gt;ENTRYPOINT&lt;/code&gt; æ˜¯æ€ä¹ˆç¡®å®šå¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-docker&#34; data-lang=&#34;docker&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# å‰é¢çš„å†…å®¹çœç•¥&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# The pilot-agent will bootstrap Envoy.&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/pilot-agent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å…¥å£æ˜¯ &lt;code&gt;/usr/local/bin/istio-iptables&lt;/code&gt; å‘½ä»¤è¡Œï¼Œè¯¥å‘½ä»¤è¡Œå·¥å…·çš„ä»£ç çš„ä½ç½®åœ¨ Istio æºç ä»“åº“çš„ &lt;a href=&#34;https://github.com/istio/istio/tree/master/tools/istio-iptables&#34; title=&#34;tools/istio-iptables&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tools/istio-iptables&lt;/a&gt;
 ç›®å½•ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨ Istio 1.1 ç‰ˆæœ¬æ—¶è¿˜æ˜¯ä½¿ç”¨ &lt;code&gt;isito-iptables.sh&lt;/code&gt; å‘½ä»¤è¡Œæ¥æ“ä½œ IPtablesã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨å¯åŠ¨å…¥å£&#34;&gt;Init å®¹å™¨å¯åŠ¨å…¥å£&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨çš„å¯åŠ¨å…¥å£æ˜¯ &lt;code&gt;istio-iptables&lt;/code&gt; å‘½ä»¤è¡Œï¼Œè¯¥å‘½ä»¤è¡Œå·¥å…·çš„ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istio-iptables &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;flags&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p: æŒ‡å®šé‡å®šå‘æ‰€æœ‰ TCP æµé‡çš„ sidecar ç«¯å£ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 15001ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -m: æŒ‡å®šå…¥ç«™è¿æ¥é‡å®šå‘åˆ° sidecar çš„æ¨¡å¼ï¼Œâ€œREDIRECTâ€ æˆ– â€œTPROXYâ€ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_INTERCEPTION_MODE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -b: é€—å·åˆ†éš”çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œå…¶æµé‡å°†é‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰ç«¯å£ã€‚ä¸ºç©ºæ—¶è¡¨ç¤ºç¦ç”¨æ‰€æœ‰å…¥ç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -d: æŒ‡å®šè¦ä»é‡å®šå‘åˆ° sidecar ä¸­æ’é™¤çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ï¼Œä»¥é€—å·æ ¼å¼åˆ†éš”ã€‚ä½¿ç”¨é€šé…ç¬¦â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å…¥ç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_LOCAL_EXCLUDE_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -oï¼šé€—å·åˆ†éš”çš„å‡ºç«™ç«¯å£åˆ—è¡¨ï¼Œä¸åŒ…æ‹¬é‡å®šå‘åˆ° Envoy çš„ç«¯å£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -i: æŒ‡å®šé‡å®šå‘åˆ° sidecar çš„ IP åœ°å€èŒƒå›´ï¼ˆå¯é€‰ï¼‰ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ã€‚ç©ºåˆ—è¡¨å°†ç¦ç”¨æ‰€æœ‰å‡ºç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_CIDR&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -x: æŒ‡å®šå°†ä»é‡å®šå‘ä¸­æ’é™¤çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_EXCLUDE_CIDR&lt;/span&gt;ï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -kï¼šé€—å·åˆ†éš”çš„è™šæ‹Ÿæ¥å£åˆ—è¡¨ï¼Œå…¶å…¥ç«™æµé‡ï¼ˆæ¥è‡ªè™šæ‹Ÿæœºçš„ï¼‰å°†è¢«è§†ä¸ºå‡ºç«™æµé‡ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -gï¼šæŒ‡å®šä¸åº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ GIDã€‚&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;é»˜è®¤å€¼ä¸ -u param ç›¸åŒ&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -uï¼šæŒ‡å®šä¸åº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ UIDã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä»£ç†å®¹å™¨çš„ UIDï¼ˆé»˜è®¤å€¼æ˜¯ 1337ï¼Œå³ istio-proxy çš„ UIDï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -z: æ‰€æœ‰è¿›å…¥ pod/VM çš„ TCP æµé‡åº”è¢«é‡å®šå‘åˆ°çš„ç«¯å£ï¼ˆé»˜è®¤ &lt;span class=&#34;nv&#34;&gt;$INBOUND_CAPTURE_PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 15006ï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šä¼ å…¥çš„å‚æ•°éƒ½ä¼šé‡æ–°ç»„è£…æˆ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; title=&#34;&amp;lt;code&amp;gt;iptables&amp;lt;/code&amp;gt; &#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;iptables&lt;/code&gt; &lt;/a&gt;
è§„åˆ™ï¼Œå…³äºè¯¥å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•è¯·è®¿é—® &lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/istio-iptables/pkg/cmd/root.go&#34; title=&#34;tools/istio-iptables/pkg/cmd/root.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tools/istio-iptables/pkg/cmd/root.go&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å®¹å™¨å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®© sidecar ä»£ç†å¯ä»¥æ‹¦æˆªæ‰€æœ‰çš„è¿›å‡º pod çš„æµé‡ï¼Œ15090 ç«¯å£ï¼ˆMixer ä½¿ç”¨ï¼‰å’Œ 15092 ç«¯å£ï¼ˆIngress Gatewayï¼‰é™¤å¤–çš„æ‰€æœ‰å…¥ç«™ï¼ˆinboundï¼‰æµé‡é‡å®šå‘åˆ° 15006 ç«¯å£ï¼ˆsidecarï¼‰ï¼Œå†æ‹¦æˆªåº”ç”¨å®¹å™¨çš„å‡ºç«™ï¼ˆoutboundï¼‰æµé‡ç»è¿‡ sidecar å¤„ç†ï¼ˆé€šè¿‡ 15001 ç«¯å£ç›‘å¬ï¼‰åå†å‡ºç«™ã€‚å…³äº Istio ä¸­ç«¯å£ç”¨é€”è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/zh/docs/ops/deployment/requirements/&#34; title=&#34;Istio å®˜æ–¹æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‘½ä»¤è§£æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¡å¯åŠ¨å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†åº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡éƒ½è½¬å‘åˆ° sidecar çš„ 15006 ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istio-proxy&lt;/code&gt; ç”¨æˆ·èº«ä»½è¿è¡Œï¼ŒUID ä¸º 1337ï¼Œå³ sidecar æ‰€å¤„çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç”¨æˆ·ï¼Œè§ YAML é…ç½®ä¸­çš„ &lt;code&gt;runAsUser&lt;/code&gt; å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼æ¥é‡å®šå‘æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½é‡å®šå‘åˆ° sidecar ä»£ç†ï¼ˆé€šè¿‡ 15001 ç«¯å£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸º Init å®¹å™¨åˆå§‹åŒ–å®Œæ¯•åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç™»é™†åˆ°å®¹å™¨ä¸­æŸ¥çœ‹ iptables ä¿¡æ¯ï¼Œä½†æ˜¯ Init å®¹å™¨åˆå§‹åŒ–ç»“æœä¼šä¿ç•™åˆ°åº”ç”¨å®¹å™¨å’Œ sidecar å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;pod-å¯åŠ¨æµç¨‹&#34;&gt;Pod å¯åŠ¨æµç¨‹&lt;/h2&gt;
&lt;p&gt;å¯ç”¨äº† Sidecar è‡ªåŠ¨æ³¨å…¥çš„ Pod å¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Init å®¹å™¨å…ˆå¯åŠ¨ï¼Œå‘ Pod ä¸­æ³¨å…¥ iptables è§„åˆ™ï¼Œè¿›è¡Œé€æ˜æµé‡æ‹¦æˆªã€‚&lt;/li&gt;
&lt;li&gt;éšåï¼ŒKubernetes ä¼šæ ¹æ® Pod Spec ä¸­å®¹å™¨çš„å£°æ˜é¡ºåºä¾æ¬¡å¯åŠ¨å®¹å™¨ï¼Œä½†è¿™æ˜¯éé˜»å¡çš„ï¼Œæ— æ³•ä¿è¯ç¬¬ä¸€ä¸ªå®¹å™¨å¯åŠ¨å®Œæˆåæ‰å¯åŠ¨ä¸‹ä¸€ä¸ªã€‚&lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨å¯åŠ¨æ—¶ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; å°†ä½œä¸º PID 1 å·è¿›ç¨‹ï¼Œå®ƒæ˜¯ Linux ç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œè´Ÿè´£æ‹‰èµ·å…¶ä»–è¿›ç¨‹å’Œå¤„ç†åƒµå°¸è¿›ç¨‹ã€‚&lt;code&gt;pilot-agent&lt;/code&gt; å°†ç”Ÿæˆ Envoy bootstrap é…ç½®å¹¶æ‹‰èµ· &lt;code&gt;envoy&lt;/code&gt; è¿›ç¨‹ï¼›åº”ç”¨å®¹å™¨å‡ ä¹è·Ÿ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨åŒæ—¶å¯åŠ¨ï¼Œä¸ºäº†é˜²æ­¢ Pod å†…çš„å®¹å™¨åœ¨è¿˜æ²¡å¯åŠ¨å¥½çš„æƒ…å†µè€Œæ¥æ”¶åˆ°å¤–ç•Œæµé‡ï¼Œè¿™æ—¶å€™å°±ç»ªæ¢é’ˆå°±æ´¾ä¸Šç”¨åœºäº†ã€‚Kubernetes ä¼šåœ¨ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨çš„ 15021 ç«¯å£è¿›è¡Œå°±ç»ªæ£€æŸ¥ï¼Œç›´åˆ° &lt;code&gt;isito-proxy&lt;/code&gt; å¯åŠ¨å®Œæˆå kubelet æ‰ä¼šå°†æµé‡è·¯ç”±åˆ° Pod å†…ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Pod å¯åŠ¨å®Œæˆåï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt;  å°†å˜ä¸ºå®ˆæŠ¤è¿›ç¨‹ç›‘è§†ç³»ç»Ÿå…¶ä»–è¿›ç¨‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¯¥è¿›ç¨‹è¿˜ä¸º Envoy æä¾› Bootstrap é…ç½®ã€è¯ä¹¦ã€å¥åº·æ£€æŸ¥ã€é…ç½®çƒ­åŠ è½½ã€èº«ä»½æ”¯æŒåŠè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;pod-å†…å®¹å™¨å¯åŠ¨é¡ºåºé—®é¢˜&#34;&gt;Pod å†…å®¹å™¨å¯åŠ¨é¡ºåºé—®é¢˜&lt;/h2&gt;
&lt;p&gt;åœ¨ Pod å¯åŠ¨çš„è¿‡ç¨‹ä¸­å­˜åœ¨å®¹å™¨å¯åŠ¨é¡ºåºé—®é¢˜ï¼Œå‡è®¾ä¸‹é¢è¿™ç§æƒ…å†µï¼Œåº”ç”¨å®¹å™¨å…ˆå¯åŠ¨ï¼Œè¯·æ±‚å…¶ä»–æœåŠ¡ï¼Œè¿™æ—¶å€™ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨è¿˜æ²¡å¯åŠ¨å®Œæˆï¼Œé‚£ä¹ˆè¯¥è¯·æ±‚å°†ä¼šå¤±è´¥ï¼Œå¦‚æœä½ çš„åº”ç”¨çš„å¥å£®æ€§ä¸è¶³ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´åº”ç”¨å®¹å™¨å´©æºƒï¼Œè¿›è€Œ Pod é‡å¯ã€‚å¯¹äºè¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹åº”ç”¨ç¨‹åºï¼Œå¢åŠ è¶…æ—¶é‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ åº”ç”¨å®¹å™¨ä¸­è¿›ç¨‹çš„å¯åŠ¨å»¶è¿Ÿï¼Œæ¯”å¦‚å¢åŠ  &lt;code&gt;sleep&lt;/code&gt; æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åº”ç”¨å®¹å™¨ä¸­å¢åŠ ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/zh/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/&#34; title=&#34;&amp;lt;code&amp;gt;postStart&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;postStart&lt;/code&gt;&lt;/a&gt;
 é…ç½®ï¼Œæ£€æµ‹åº”ç”¨è¿›ç¨‹æ˜¯å¦å¯åŠ¨å®Œæˆï¼Œåªæœ‰å½“æ£€æµ‹æˆåŠŸæ—¶ï¼ŒKubernetes æ‰ä¼šå°† Pod çš„çŠ¶æ€æ ‡è®°ä¸º &lt;code&gt;Running&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å¸¦é¢†å¤§å®¶äº†è§£äº† Istio æ•°æ®å¹³é¢ä¸­çš„ Pod å¯åŠ¨è¿‡ç¨‹ï¼Œè¿˜æœ‰å› ä¸º Pod å†…å®¹å™¨å¯åŠ¨é¡ºåºå¸¦æ¥çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://imroc.cc/post/202105/sidecar-startup-order/&#34; title=&#34;istio å¸¸è§é—®é¢˜ï¼šSidecar å¯åŠ¨é¡ºåºé—®é¢˜ - imroc.cc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio å¸¸è§é—®é¢˜ï¼šSidecar å¯åŠ¨é¡ºåºé—®é¢˜ - imroc.cc&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio ä¸­çš„å„ç»„ä»¶ç«¯å£åŠåŠŸèƒ½è¯¦è§£</title>
      <link>https://jimmysong.io/blog/istio-components-and-ports/</link>
      <pubDate>Sun, 08 May 2022 10:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-components-and-ports/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨æˆ‘çš„å‰ä¸¤ç¯‡åšå®¢ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; title=&#34;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±è¿‡ç¨‹è¯¦è§£&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/&#34; title=&#34;Sidecar ä¸­çš„æµé‡ç±»å‹åŠ iptables è§„åˆ™è¯¦è§£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar ä¸­çš„æµé‡ç±»å‹åŠ iptables è§„åˆ™è¯¦è§£&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å‘ä½ è¯¦ç»†ä»‹ç»äº† Istio æ•°æ®å¹³é¢ä¸­çš„æµé‡ï¼Œä½†æ•°æ®å¹³é¢å¹¶ä¸èƒ½å­¤ç«‹çš„å­˜åœ¨ï¼Œæœ¬æ–‡å°†å‘ä½ å±•ç¤º Istio ä¸­çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢å„ç»„ä»¶çš„ç«¯å£åŠå…¶åŠŸèƒ½ï¼Œæœ‰åŠ©äºä½ äº†è§£è¿™äº›æµé‡ä¹‹é—´çš„å…³ç³»åŠæ•…éšœæ’æŸ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­çš„ç»„ä»¶åŠç«¯å£ç¤ºæ„å›¾&#34;&gt;Istio ä¸­çš„ç»„ä»¶åŠç«¯å£ç¤ºæ„å›¾&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§ä¹ æƒ¯ï¼Œæˆ‘ä»¬é¦–å…ˆå±•ç¤ºä¸€ä¸ªå…¨å±€ç¤ºæ„å›¾ã€‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Istio æ•°æ®å¹³é¢ä¸­ sidecar çš„ç»„æˆï¼Œä»¥åŠä¸å…¶äº¤äº’çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/istio-ports-components.webp&#34; data-img=&#34;/blog/istio-components-and-ports/istio-ports-components.webp&#34; data-width=&#34;5230&#34; data-height=&#34;2506&#34; alt=&#34;image&#34; data-caption=&#34;Istio sidecar ç»„æˆç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio sidecar ç»„æˆç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;nsenter&lt;/code&gt; å‘½ä»¤è¿›å…¥ Bookinfo ç¤ºä¾‹çš„ &lt;code&gt;productpage&lt;/code&gt;  Pod çš„ç½‘ç»œç©ºé—´ï¼ŒæŸ¥çœ‹å…¶å†…éƒ¨ç›‘å¬çš„ç«¯å£ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/sidecar-ports.webp&#34; data-img=&#34;/blog/istio-components-and-ports/sidecar-ports.webp&#34; data-width=&#34;1566&#34; data-height=&#34;740&#34; alt=&#34;image&#34; data-caption=&#34;Istio sidecar ä¸­ç›‘å¬çš„ç«¯å£ä¿¡æ¯&#34;&gt;
    
  
  &lt;figcaption&gt;Istio sidecar ä¸­ç›‘å¬çš„ç«¯å£ä¿¡æ¯&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é™¤äº† &lt;code&gt;productpage&lt;/code&gt; åº”ç”¨æœ¬èº«ç›‘å¬çš„ 9080 ç«¯å£ä»¥å¤–ï¼ŒSidecar å®¹å™¨è¿˜æœ‰ç›‘å¬å¤§é‡çš„å…¶ä»–ç«¯å£ï¼Œå¦‚ &lt;code&gt;15000&lt;/code&gt;ã€&lt;code&gt;15001&lt;/code&gt;ã€&lt;code&gt;15004&lt;/code&gt;ã€&lt;code&gt;15006&lt;/code&gt;ã€&lt;code&gt;15021&lt;/code&gt;ã€&lt;code&gt;15090&lt;/code&gt; ç­‰ï¼Œä½ å¯ä»¥åœ¨ &lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ä¸Šäº†è§£ Istio ä¸­ä½¿ç”¨çš„ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†è¿›å…¥ &lt;code&gt;productpage&lt;/code&gt; Pod ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;lsof -i&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹å®ƒæ‰“å¼€çš„ç«¯å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/product-pod-ports.webp&#34; data-img=&#34;/blog/istio-components-and-ports/product-pod-ports.webp&#34; data-width=&#34;2714&#34; data-height=&#34;902&#34; alt=&#34;image&#34; data-caption=&#34;Productpage Pod ä¸­æ‰“å¼€çš„ç«¯å£&#34;&gt;
    
  
  &lt;figcaption&gt;Productpage Pod ä¸­æ‰“å¼€çš„ç«¯å£&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ &lt;code&gt;pilot-agent&lt;/code&gt; ä¸ &lt;code&gt;istiod&lt;/code&gt; å»ºç«‹äº† TCP è¿æ¥ï¼Œä¸Šæ–‡ä¸­æ‰€è¿°çš„ç›‘å¬ä¸­çš„ç«¯å£ï¼Œè¿˜æœ‰åœ¨ Pod å†…éƒ¨å»ºç«‹çš„ TCP è¿æ¥ï¼Œè¿™äº›è¿æ¥å¯¹åº”äº†æ–‡ç« å¼€å¤´çš„ç¤ºæ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;Sidecar å®¹å™¨ï¼ˆ&lt;code&gt;istio-proxy&lt;/code&gt; ï¼‰çš„æ ¹è¿›ç¨‹æ˜¯ &lt;code&gt;pilot-agent&lt;/code&gt;ï¼Œå¯åŠ¨å‘½ä»¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/sidecar-procecces.webp&#34; data-img=&#34;/blog/istio-components-and-ports/sidecar-procecces.webp&#34; data-width=&#34;2768&#34; data-height=&#34;540&#34; alt=&#34;image&#34; data-caption=&#34;Sidecar ä¸­çš„è¿›ç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;Sidecar ä¸­çš„è¿›ç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒ &lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹çš„ PID æ˜¯ 1ï¼Œæ˜¯å®ƒæ‹‰èµ·äº† &lt;code&gt;envoy&lt;/code&gt; è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;istiod&lt;/code&gt; çš„ Pod ä¸­æŸ¥çœ‹å®ƒæ‰“å¼€çš„ç«¯å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/sidecar-lsof.webp&#34; data-img=&#34;/blog/istio-components-and-ports/sidecar-lsof.webp&#34; data-width=&#34;2544&#34; data-height=&#34;760&#34; alt=&#34;image&#34; data-caption=&#34;Istiod ä¸­çš„ç«¯å£&#34;&gt;
    
  
  &lt;figcaption&gt;Istiod ä¸­çš„ç«¯å£&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ç›‘å¬çš„ç«¯å£ã€è¿›ç¨‹é—´å’Œè¿œç¨‹é€šä¿¡è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­å„ç«¯å£çš„åŠŸèƒ½æ¦‚è¿°&#34;&gt;Istio ä¸­å„ç«¯å£çš„åŠŸèƒ½æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;è¿™äº›ç«¯å£åœ¨ä½ è¿›è¡Œé—®é¢˜æ’æŸ¥æ—¶å¯ä»¥èµ·ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ä¸‹é¢å°†æ ¹æ®ç«¯å£æ‰€åœ¨çš„ç»„ä»¶å’ŒåŠŸèƒ½åˆ†ç±»æè¿°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istiod-ä¸­çš„ç«¯å£&#34;&gt;Istiod ä¸­çš„ç«¯å£&lt;/h2&gt;
&lt;p&gt;Istiod ä¸­çš„ç«¯å£ç›¸å¯¹æ¯”è¾ƒå°‘ä¸”åŠŸèƒ½å•ä¸€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;9876ï¼šControlZ ç”¨æˆ·ç•Œé¢ï¼Œæš´éœ² &lt;code&gt;istiod&lt;/code&gt; çš„è¿›ç¨‹ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;8080ï¼š&lt;code&gt;istiod&lt;/code&gt; è°ƒè¯•ç«¯å£ï¼Œé€šè¿‡è¯¥ç«¯å£å¯ä»¥æŸ¥è¯¢ç½‘æ ¼çš„é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;15010ï¼šæš´éœ² xDS API å’Œé¢å‘çº¯æ–‡æœ¬è¯ä¹¦&lt;/li&gt;
&lt;li&gt;15012ï¼šåŠŸèƒ½åŒ 15010 ç«¯å£ï¼Œä½†ä½¿ç”¨ TLS é€šä¿¡&lt;/li&gt;
&lt;li&gt;15014ï¼šæš´éœ²æ§åˆ¶å¹³é¢çš„æŒ‡æ ‡ç»™ Prometheus&lt;/li&gt;
&lt;li&gt;15017ï¼šSidecar æ³¨å…¥å’Œé…ç½®æ ¡éªŒç«¯å£&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;sidecar-ä¸­çš„ç«¯å£&#34;&gt;Sidecar ä¸­çš„ç«¯å£&lt;/h2&gt;
&lt;p&gt;ä»ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° sidecar ä¸­æœ‰ä¼—å¤šç«¯å£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;15000ï¼šEnvoy &lt;a href=&#34;https://jimmysong.io/envoy-handbook/admin-interface/enabling-admin-interface.html&#34; title=&#34;ç®¡ç†æ¥å£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç†æ¥å£&lt;/a&gt;
ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥æŸ¥è¯¢å’Œä¿®æ”¹ Envoy ä»£ç†çš„çš„é…ç½®ï¼Œè¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/operations/admin&#34; title=&#34;Envoy æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/li&gt;
&lt;li&gt;15001ï¼šç”¨äºå¤„ç†å‡ºç«™æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;15004ï¼šè°ƒè¯•ç«¯å£ï¼Œå°†åœ¨ä¸‹æ–‡ä¸­è§£é‡Šã€‚&lt;/li&gt;
&lt;li&gt;15006ï¼šç”¨äºå¤„ç†å…¥ç«™æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;15020ï¼šæ±‡æ€»ç»Ÿè®¡æ•°æ®ï¼Œå¯¹ Envoy å’Œ DNS ä»£ç†è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œè°ƒè¯• &lt;code&gt;pilot-agent&lt;/code&gt;  è¿›ç¨‹ï¼Œå°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†è§£é‡Šã€‚&lt;/li&gt;
&lt;li&gt;15021ï¼šç”¨äº sidecar å¥åº·æ£€æŸ¥ï¼Œä»¥åˆ¤æ–­å·²æ³¨å…¥ Pod æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚æˆ‘ä»¬åœ¨è¯¥ç«¯å£çš„ &lt;code&gt;/healthz/ready&lt;/code&gt; è·¯å¾„ä¸Šè®¾ç½®äº†å°±ç»ªæ¢é’ˆï¼ŒIstio æŠŠ sidecar çš„å°±ç»ªæ£€æµ‹äº¤ç»™äº† &lt;code&gt;kubelet&lt;/code&gt;ï¼Œæœ€å¤§åŒ–åˆ©ç”¨ Kubernetes å¹³å°è‡ªèº«çš„åŠŸèƒ½ã€‚&lt;code&gt;envoy&lt;/code&gt;  è¿›ç¨‹å°†å¥åº·æ£€æŸ¥è·¯ç”±åˆ° &lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹çš„ 15020 ç«¯å£ï¼Œå®é™…çš„å¥åº·æ£€æŸ¥å°†å‘ç”Ÿåœ¨é‚£é‡Œã€‚&lt;/li&gt;
&lt;li&gt;15053ï¼šæœ¬åœ° DNS ä»£ç†ï¼Œç”¨äºè§£æ Kubernetes DNS è§£æä¸äº†çš„é›†ç¾¤å†…éƒ¨åŸŸåçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;15090ï¼šEnvoy Prometheus æŸ¥è¯¢ç«¯å£ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; å°†é€šè¿‡æ­¤ç«¯å£æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šç«¯å£å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè´£è¿›ç¨‹é—´é€šä¿¡ï¼Œä¾‹å¦‚ 15001ã€15006ã€15053&lt;/li&gt;
&lt;li&gt;è´Ÿè´£å¥åº·æ£€æŸ¥å’Œä¿¡æ¯ç»Ÿè®¡ï¼Œä¾‹å¦‚ 150021ã€15090&lt;/li&gt;
&lt;li&gt;è°ƒè¯•ï¼š15000ã€15004&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹æ–‡å°†å¯¹å‡ ä¸ªé‡ç‚¹ç«¯å£è¯¦è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;15000-ç«¯å£&#34;&gt;15000 ç«¯å£&lt;/h2&gt;
&lt;p&gt;15000 æ˜¯ Envoy çš„ Admin æ¥å£ï¼Œè¯¥æ¥å£å…è®¸æˆ‘ä»¬ä¿®æ”¹ Envoyï¼Œå¹¶è·å¾—ä¸€ä¸ªè§†å›¾å’ŒæŸ¥è¯¢æŒ‡æ ‡å’Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç®¡ç†æ¥å£ç”±ä¸€ä¸ªå…·æœ‰å¤šä¸ªç«¯ç‚¹çš„ REST API å’Œä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç•Œé¢ç»„æˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¼€å¯ &lt;code&gt;productpage&lt;/code&gt; Pod ä¸­çš„ Envoy ç®¡ç†æ¥å£è§†å›¾ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n default port-forward deploy/productpage-v1 &lt;span class=&#34;m&#34;&gt;15000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—® &lt;code&gt;http://localhost:15000&lt;/code&gt;ï¼Œä½ å°†çœ‹åˆ° Envoy Admin ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/envoy-admin.webp&#34; data-img=&#34;/blog/istio-components-and-ports/envoy-admin.webp&#34; data-width=&#34;660&#34; data-height=&#34;1158&#34; alt=&#34;image&#34; data-caption=&#34;Envoy Admin ç•Œé¢&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy Admin ç•Œé¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;15004-ç«¯å£&#34;&gt;15004 ç«¯å£&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;pilot-agent&lt;/code&gt; ä»£ç† &lt;code&gt;istiod&lt;/code&gt; 8080 ç«¯å£ä¸Šçš„è°ƒè¯•ç«¯ç‚¹ï¼Œä½ å¯ä»¥è¿›å…¥æ•°æ®å¹³é¢ Pod ä¸­è®¿é—® localhost çš„ 15004 ç«¯å£æŸ¥è¯¢ç½‘æ ¼ä¿¡æ¯ï¼Œå…¶æ•ˆæœä¸ä¸‹é¢çš„ 8080 ç«¯å£ç­‰åŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;8080-ç«¯å£&#34;&gt;8080 ç«¯å£&lt;/h2&gt;
&lt;p&gt;ä½ è¿˜å¯ä»¥åœ¨æœ¬åœ°è½¬å‘ &lt;code&gt;istiod&lt;/code&gt;  8080 ç«¯å£ï¼Œè¯·è¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system port-forward deploy/istiod &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—® &lt;code&gt;http://localhost:8080/debug&lt;/code&gt;ï¼Œä½ å°†çœ‹åˆ°è°ƒè¯•ç«¯ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/pilot-debug-console.webp&#34; data-img=&#34;/blog/istio-components-and-ports/pilot-debug-console.webp&#34; data-width=&#34;1080&#34; data-height=&#34;1243&#34; alt=&#34;image&#34; data-caption=&#34;Pilot è°ƒè¯•æ§åˆ¶å°&#34;&gt;
    
  
  &lt;figcaption&gt;Pilot è°ƒè¯•æ§åˆ¶å°&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ç§è·å–ç½‘æ ¼ä¿¡æ¯å’Œè°ƒè¯•ç½‘æ ¼çš„æ–¹å¼ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤æˆ– Kiali æ¥è°ƒè¯•ï¼Œé‚£æ ·å°†æ›´åŠ é«˜æ•ˆå’Œç›´è§‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;15020-ç«¯å£&#34;&gt;15020 ç«¯å£&lt;/h2&gt;
&lt;p&gt;15020 ç«¯å£æœ‰ä¸‰å¤§åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ±‡æ€»ç»Ÿè®¡æ•°æ®ï¼šæŸ¥è¯¢ 15090 ç«¯å£è·å– &lt;code&gt;envoy&lt;/code&gt; çš„æŒ‡æ ‡ï¼Œä¹Ÿå¯ä»¥é…ç½®æŸ¥è¯¢åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ï¼Œå°† &lt;code&gt;envoy&lt;/code&gt;ã€åº”ç”¨ç¨‹åºå’Œè‡ªèº«çš„æŒ‡æ ‡æ±‡æ€»ä»¥ä¾› Prometheus æ”¶é›†ã€‚å¯¹åº”çš„è°ƒè¯•ç«¯ç‚¹æ˜¯ &lt;code&gt;/stats/prometheus&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ Envoy å’Œ DNS ä»£ç†è¿›è¡Œå¥åº·æ£€æŸ¥ï¼šå¯¹åº”çš„è°ƒè¯•ç«¯ç‚¹æ˜¯ &lt;code&gt;/healthz/ready&lt;/code&gt; å’Œ &lt;code&gt;/app-health&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒè¯• &lt;code&gt;pilot-agent&lt;/code&gt;  è¿›ç¨‹ï¼šå¯¹åº”çš„è°ƒè¯•ç«¯ç‚¹æ˜¯ &lt;code&gt;/quitquitquit&lt;/code&gt;ã€&lt;code&gt;debug/ndsz&lt;/code&gt; å’Œ &lt;code&gt;/debug/pprof&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ä½¿ç”¨æœ¬åœ°ç«¯å£è½¬å‘åï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ &lt;code&gt;http://localhost:15020/debug/pprof&lt;/code&gt; çœ‹åˆ°çš„è°ƒè¯•ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-components-and-ports/pprof.webp&#34; data-img=&#34;/blog/istio-components-and-ports/pprof.webp&#34; data-width=&#34;1761&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;pprof ç«¯ç‚¹&#34;&gt;
    
  
  &lt;figcaption&gt;pprof ç«¯ç‚¹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ä¿¡æ¯å±•ç¤ºçš„æ˜¯ &lt;code&gt;pilot-agent&lt;/code&gt; çš„å †æ ˆä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡å¯¹ Istio ä¸­å„ç»„ä»¶ç«¯å£çš„äº†è§£ï¼Œä½ åº”è¯¥å¯¹ Istio ä¸­å„ç»„ä»¶çš„å…³ç³»åŠå…¶å†…éƒ¨æµé‡æœ‰äº†æ›´è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œç†Ÿæ‚‰è¿™äº›ç«¯å£çš„åŠŸèƒ½ï¼Œæœ‰åŠ©äºå¯¹ç½‘æ ¼çš„æ•…éšœæ’é™¤ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio sidecar ä¸­çš„æµé‡ç±»å‹åŠ iptables è§„åˆ™è¯¦è§£</title>
      <link>https://jimmysong.io/blog/istio-sidecar-traffic-types/</link>
      <pubDate>Sat, 07 May 2022 11:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-sidecar-traffic-types/</guid>
      <description>
        
        
        &lt;p&gt;æˆ‘åœ¨&lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; title=&#34;ä¹‹å‰çš„ä¸€ç¯‡åšå®¢ä¸­&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¹‹å‰çš„ä¸€ç¯‡åšå®¢ä¸­&lt;/a&gt;
è®²è§£è¿‡ Istio ä¸­ sidecar çš„æ³¨å…¥ã€ä½¿ç”¨ iptables è¿›è¡Œé€æ˜æµé‡æ‹¦æˆªåŠæµé‡è·¯ç”±çš„è¯¦ç»†è¿‡ç¨‹ï¼Œå¹¶ä»¥ Bookinfo ç¤ºä¾‹ä¸­çš„ &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡è®¿é—® &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ï¼Œå’Œ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡è®¿é—® &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ä¸ºä¾‹ç»˜åˆ¶äº†é€æ˜æµé‡åŠ«æŒç¤ºæ„å›¾ã€‚åœ¨é‚£ä¸ªç¤ºæ„å›¾ä¸­ä»…å±•ç¤ºäº† &lt;code&gt;reviews&lt;/code&gt; pod æ¥æ”¶æµé‡å’Œå¯¹å¤–è®¿é—®çš„è·¯ç”±ï¼Œå®é™…ä¸Š sidecar å†…çš„æµé‡è¿œä¸æ­¢äºæ­¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio_output-è§„åˆ™&#34;&gt;ISTIO_OUTPUT è§„åˆ™&lt;/h2&gt;
&lt;p&gt;åœ¨æ‰€æœ‰çš„ iptables è°ƒç”¨é“¾ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªæ˜¯ &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt;ï¼Œå…¶ä¸­å…±æœ‰ 9 æ¡è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Rule&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Target&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;In&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Out&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Source&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Destination&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;127.0.0.6&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;ISTIO_IN_REDIRECT&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;!localhost owner UID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere !owner UID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere owner UID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;ISTIO_IN_REDIRECT&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;!localhost owner GID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;lo&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere !owner GID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere owner GID match 1337&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;RETURN&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;localhost&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;ISTIO_REDIRECT&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;any&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;td&gt;anywhere&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœ¬æ–‡å°†å‘ä½ å±•ç¤º Istio sidecar ä¸­çš„å…­ç§æµé‡ç±»å‹åŠå…¶ iptables è§„åˆ™ï¼Œä»¥ç¤ºæ„å›¾çš„å½¢å¼å¸¦ä½ ä¸€è§ˆå…¶å…¨è²Œï¼Œå…¶ä¸­è¯¦ç»†æŒ‡å‡ºäº†è·¯ç”±å…·ä½“ä½¿ç”¨çš„æ˜¯ &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; ä¸­çš„å“ªä¸€æ¡è§„åˆ™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-ä¸­çš„-iptables-æµé‡è·¯ç”±&#34;&gt;Sidecar ä¸­çš„ iptables æµé‡è·¯ç”±&lt;/h2&gt;
&lt;p&gt;Sidecar ä¸­çš„æµé‡å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿œç¨‹æœåŠ¡è®¿é—®æœ¬åœ°æœåŠ¡ï¼šRemote Pod -&amp;gt; Local Pod&lt;/li&gt;
&lt;li&gt;æœ¬åœ°æœåŠ¡è®¿é—®è¿œç¨‹æœåŠ¡ï¼šLocal Pod -&amp;gt; Remote Pod&lt;/li&gt;
&lt;li&gt;Prometheus æŠ“å–æœ¬åœ°æœåŠ¡çš„ metricsï¼šPrometheus -&amp;gt; Local Pod&lt;/li&gt;
&lt;li&gt;æœ¬åœ° Pod æœåŠ¡é—´çš„æµé‡ï¼šLocal Pod -&amp;gt; Local Pod&lt;/li&gt;
&lt;li&gt;Envoy å†…éƒ¨çš„è¿›ç¨‹é—´ TCP æµé‡&lt;/li&gt;
&lt;li&gt;Sidecar åˆ° Istiod çš„æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢å°†ä¾æ¬¡è§£é‡Šæ¯ä¸ªåœºæ™¯ä¸‹ Sidecar å†…çš„ iptables è·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç±»å‹ä¸€remote-pod---local-pod&#34;&gt;ç±»å‹ä¸€ï¼šRemote Pod -&amp;gt; Local Pod&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è¿œç¨‹æœåŠ¡ã€åº”ç”¨æˆ–å®¢æˆ·ç«¯è®¿é—®æ•°æ®å¹³é¢æœ¬åœ° Pod IP çš„ iptables è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;Remote Pod -&amp;gt; &lt;code&gt;RREROUTING&lt;/code&gt; -&amp;gt; &lt;code&gt;ISTIO_INBOUND&lt;/code&gt; -&amp;gt; &lt;code&gt;ISTIO_IN_REDIRECT&lt;/code&gt; -&amp;gt; Envoy 15006ï¼ˆInboundï¼‰-&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 1&lt;/strong&gt; -&amp;gt; &lt;code&gt;POSTROUTING&lt;/code&gt; -&amp;gt; Local Pod&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°æµé‡åªç»è¿‡ä¸€æ¬¡ Envoy 15006 Inbound ç«¯å£ã€‚è¿™ç§åœºæ™¯ä¸‹çš„ iptables è§„åˆ™çš„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/remote-pod-local-pod.svg&#34; data-img=&#34;/blog/istio-sidecar-traffic-types/remote-pod-local-pod.svg&#34; alt=&#34;image&#34; data-caption=&#34;Remote Pod åˆ° Local Pod&#34;&gt;
    
  
  &lt;figcaption&gt;Remote Pod åˆ° Local Pod&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç±»å‹äºŒlocal-pod---remote-pod&#34;&gt;ç±»å‹äºŒï¼šLocal Pod -&amp;gt; Remote Pod&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æœ¬åœ° Pod IP è®¿é—®è¿œç¨‹æœåŠ¡ç»è¿‡çš„ iptables è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;Local Pod-&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 9&lt;/strong&gt; -&amp;gt; ISTIO_REDIRECT -&amp;gt; Envoy 15001 (Outbound)-&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 4&lt;/strong&gt; -&amp;gt; &lt;code&gt;POSTROUTING&lt;/code&gt; -&amp;gt; Remote Pod&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°æµé‡åªç»è¿‡ Envoy 15001 Outbound ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/local-pod-remote-pod.svg&#34; data-img=&#34;/blog/istio-sidecar-traffic-types/local-pod-remote-pod.svg&#34; alt=&#34;image&#34; data-caption=&#34;Local Pod åˆ° Remote Pod&#34;&gt;
    
  
  &lt;figcaption&gt;Local Pod åˆ° Remote Pod&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šä¸¤ç§åœºæ™¯ä¸­çš„æµé‡éƒ½åªç»è¿‡ä¸€æ¬¡ Envoyï¼Œå› ä¸ºè¯¥ Pod ä¸­åªæœ‰å‘å‡ºæˆ–æ¥å—è¯·æ±‚ä¸€ç§åœºæ™¯å‘ç”Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç±»å‹ä¸‰prometheus---local-pod&#34;&gt;ç±»å‹ä¸‰ï¼šPrometheus -&amp;gt; Local Pod&lt;/h2&gt;
&lt;p&gt;Prometheus æŠ“å–æ•°æ®å¹³é¢ metrics çš„æµé‡ä¸ä¼šä¹Ÿæ— é¡»ç»è¿‡ Envoy ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æµé‡é€šè¿‡çš„ iptables è§„åˆ™å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Prometheus-&amp;gt; &lt;code&gt;RREROUTING&lt;/code&gt; -&amp;gt; &lt;code&gt;ISTIO_INBOUND&lt;/code&gt;ï¼ˆå¯¹ç›®çš„åœ°ä¸º 15020ã€15090 ç«¯å£æµé‡å°†è½¬åˆ° &lt;code&gt;INPUT&lt;/code&gt;ï¼‰-&amp;gt; &lt;code&gt;INPUT&lt;/code&gt; -&amp;gt;  Local Pod&lt;/p&gt;
&lt;p&gt;è¿™ç§åœºæ™¯ä¸‹çš„ iptables è§„åˆ™çš„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/prometheus-local-pod.svg&#34; data-img=&#34;/blog/istio-sidecar-traffic-types/prometheus-local-pod.svg&#34; alt=&#34;image&#34; data-caption=&#34;Prometheus åˆ° Local Pod&#34;&gt;
    
  
  &lt;figcaption&gt;Prometheus åˆ° Local Pod&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç±»å‹å››local-pod---local-pod&#34;&gt;ç±»å‹å››ï¼šLocal Pod -&amp;gt; Local Pod&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ª Pod å¯èƒ½åŒæ—¶å­˜åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªæœåŠ¡ï¼Œå¦‚æœ Local Pod è®¿é—®çš„æœåŠ¡ä¹Ÿåœ¨è¯¥å½“å‰ Pod ä¸Šï¼Œæµé‡ä¼šä¾æ¬¡ç»è¿‡ Envoy 15001 å’Œ Envoy 15006 ç«¯å£æœ€ååˆ°è¾¾æœ¬åœ° Pod çš„æœåŠ¡ç«¯å£ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æµé‡é€šè¿‡çš„ iptables è§„åˆ™å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Local Pod-&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 9&lt;/strong&gt; -&amp;gt; &lt;code&gt;ISTIO_REDIRECT&lt;/code&gt; -&amp;gt; Envoy 15001ï¼ˆOutboundï¼‰-&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 2&lt;/strong&gt; -&amp;gt; &lt;code&gt;ISTIO_IN_REDIRECT&lt;/code&gt; -&amp;gt; Envoy 15006ï¼ˆInboundï¼‰-&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 1&lt;/strong&gt; -&amp;gt; &lt;code&gt;POSTROUTING&lt;/code&gt; -&amp;gt; Local Pod&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/local-pod-local-pod.svg&#34; data-img=&#34;/blog/istio-sidecar-traffic-types/local-pod-local-pod.svg&#34; alt=&#34;image&#34; data-caption=&#34;Local Pod åˆ° Local Pod&#34;&gt;
    
  
  &lt;figcaption&gt;Local Pod åˆ° Local Pod&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç±»å‹äº”envoy-å†…éƒ¨çš„è¿›ç¨‹é—´-tcp-æµé‡&#34;&gt;ç±»å‹äº”ï¼šEnvoy å†…éƒ¨çš„è¿›ç¨‹é—´ TCP æµé‡&lt;/h2&gt;
&lt;p&gt;Envoy å†…éƒ¨è¿›ç¨‹çš„ UID å’Œ GID ä¸º 1337ï¼Œå®ƒä»¬ä¹‹é—´çš„æµé‡å°†ä½¿ç”¨ lo ç½‘å¡ï¼Œä½¿ç”¨ localhost åŸŸåæ¥é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æµé‡é€šè¿‡çš„ iptables è§„åˆ™å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Envoy è¿›ç¨‹ï¼ˆLocalhostï¼‰ -&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 8&lt;/strong&gt; -&amp;gt; &lt;code&gt;POSTROUTING&lt;/code&gt; -&amp;gt; Envoy è¿›ç¨‹ï¼ˆLocalhostï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/envoy-internal-tcp-traffic.svg&#34; data-img=&#34;/blog/istio-sidecar-traffic-types/envoy-internal-tcp-traffic.svg&#34; alt=&#34;image&#34; data-caption=&#34;Envoy å†…éƒ¨çš„è¿›ç¨‹é—´ TCP æµé‡&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy å†…éƒ¨çš„è¿›ç¨‹é—´ TCP æµé‡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç±»å‹å…­sidecar-åˆ°-istiod-çš„æµé‡&#34;&gt;ç±»å‹å…­ï¼šSidecar åˆ° Istiod çš„æµé‡&lt;/h2&gt;
&lt;p&gt;Sidecar éœ€è¦è®¿é—® Istiod ä»¥åŒæ­¥é…ç½®ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹ä¼šå‘ Istiod å‘é€è¯·æ±‚ï¼Œä»¥åŒæ­¥é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æµé‡é€šè¿‡çš„ iptables è§„åˆ™å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; è¿›ç¨‹ -&amp;gt; &lt;code&gt;OUTPUT&lt;/code&gt; -&amp;gt; &lt;strong&gt;&lt;code&gt;Istio_OUTPUT&lt;/code&gt; RULE 9&lt;/strong&gt; -&amp;gt; Envoy 15001 (Outbound Handler) -&amp;gt; OUTPUT -&amp;gt; &lt;strong&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; RULE 4&lt;/strong&gt; -&amp;gt; &lt;code&gt;POSTROUTING&lt;/code&gt;  -&amp;gt; Istiod&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-sidecar-traffic-types/sidecar-istiod.svg&#34; data-img=&#34;/blog/istio-sidecar-traffic-types/sidecar-istiod.svg&#34; alt=&#34;image&#34; data-caption=&#34;Sidecar åˆ° Istiod çš„æµé‡&#34;&gt;
    
  
  &lt;figcaption&gt;Sidecar åˆ° Istiod çš„æµé‡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;Istio æ³¨å…¥åœ¨ Pod å†…æˆ–è™šæ‹Ÿæœºä¸­å®‰è£…çš„æ‰€æœ‰ sidecar ä»£ç†ç»„æˆäº†æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢ï¼Œä¹Ÿæ˜¯ Istio çš„ä¸»è¦å·¥ä½œè´Ÿè½½æ‰€åœ¨åœ°ï¼Œé€šè¿‡ &lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; title=&#34;Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ä¸­çš„é€æ˜æµé‡åŠ«æŒ&lt;/a&gt;
 åŠè¿™ç¯‡åšå®¢ï¼Œç›¸ä¿¡ä½ ä¸€å®šå¯¹ sidecar ä»£ç†ä¸­çš„æµé‡æœ‰äº†ä¸€ä¸ªæ·±åˆ»çš„äº†è§£ï¼Œä½†è¿™è¿˜åªæ˜¯ç®¡ä¸­çª¥è±¹ï¼Œç•¥è§ä¸€æ–‘ï¼Œåœ¨æˆ‘çš„&lt;a href=&#34;https://jimmysong.io/blog/istio-components-and-ports/&#34; title=&#34;ä¸‹ä¸€ç¯‡åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹ä¸€ç¯‡åšå®¢&lt;/a&gt;
ä¸­ï¼Œæˆ‘å°†å¸¦ä½ äº†è§£ Envoy ä¸­å„ä¸ªç»„ä»¶çš„ç«¯å£åŠå…¶åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥è®©æˆ‘ä»¬å¯¹ Istio ä¸­çš„æµé‡æœ‰ä¸€ä¸ªæ›´å…¨é¢çš„äº†è§£ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio æçŒ®ç»™ CNCF æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</title>
      <link>https://jimmysong.io/blog/istio-has-applied-to-join-the-cncf/</link>
      <pubDate>Tue, 26 Apr 2022 09:27:49 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-has-applied-to-join-the-cncf/</guid>
      <description>
        
        
        &lt;p&gt;åœ¨ 2022 å¹´ 4 æœˆ 25 æ—¥ï¼ŒIstioCon 2022 å¼€å¹•çš„å½“å¤©ï¼ŒIstio ç¤¾åŒºå®£å¸ƒæ­£åœ¨&lt;a href=&#34;https://istio.io/latest/blog/2022/istio-has-applied-to-join-the-cncf/&#34; title=&#34;ç”³è¯·å°†é¡¹ç›®æçŒ®ç»™ CNCF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”³è¯·å°†é¡¹ç›®æçŒ®ç»™ CNCF&lt;/a&gt;
ï¼Œè¿™æ˜¯ Istio é¡¹ç›®çš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ï¼Œä¼ä¸šçº§æœåŠ¡ç½‘æ ¼å…¬å¸ Tetrate çš„ CEO/Istio é¡¹ç›®è”åˆåˆ›å§‹äºº Varun Talwar å¯¹æ­¤è¿›è¡Œäº†è§£è¯»ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æ¥è‡ª Varun å¯¹ Istio æçŒ®ç»™ CNCF çš„&lt;a href=&#34;https://www.tetrate.io/blog/istio-has-applied-to-join-the-cncf/&#34; title=&#34;è§£è¯»&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§£è¯»&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å°† Istio çº³å…¥ CNCFï¼Œä½¿å¾— Istio å’Œ Envoy çš„å‘å±•æ›´å®¹æ˜“åŒæ­¥æ¨è¿›ã€‚å®ƒè¿˜æœ‰åŠ©äºå°† Istio ä¸ Envoy ä¸€èµ·å®šä½ä¸º CNCF éªŒè¯çš„ &amp;ldquo;äº‘åŸç”ŸæŠ€æœ¯æ ˆ&amp;rdquo; çš„ä¸€éƒ¨åˆ†ã€‚æ ¹æ® CNCF çš„å¹´åº¦&lt;a href=&#34;https://www.cncf.io/reports/cncf-annual-survey-2021/&#34; title=&#34;è°ƒæŸ¥&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒæŸ¥&lt;/a&gt;
ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒIstio æ˜¯ç”Ÿäº§ä¸­æœ€å—æ¬¢è¿å’Œä½¿ç”¨æœ€å¤šçš„æœåŠ¡ç½‘æ ¼ã€‚æœ‰ 20 å¤šå®¶ä¸åŒçš„å…¬å¸åœ¨æ¨åŠ¨ Istio ç¤¾åŒºçš„å‘å±•ï¼Œè¿™ä¸€å®£å¸ƒä¸º CNCF ç®¡ç†ä¸‹çš„æŒç»­åˆ›æ–°å’Œå¢é•¿åˆ›é€ äº†æ¡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2016istio-çš„èµ·æº&#34;&gt;2016ï¼šIstio çš„èµ·æº&lt;/h2&gt;
&lt;p&gt;æˆ‘æƒ³å€Ÿæ­¤æœºä¼šè§£é‡Šä¸€ä¸‹ Istio çš„èµ·æºã€‚Istio æ¥è‡ªè°·æ­Œçš„ API å¹³å°å›¢é˜Ÿï¼Œåä¸º One Platformã€‚(ä»Šå¤©ï¼Œå…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼ŒIstio æ˜¯ç¾å›½æ”¿åºœé¡¹ç›® &lt;a href=&#34;https://www.tetrate.io/blog/tetrate-first-to-provide-hardened-istio-to-dods-iron-bank/&#34; title=&#34;Platform One&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Platform One&lt;/a&gt;
 çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä½¿ç”¨ Tetrate äº§å“å’ŒæœåŠ¡ï¼‰ã€‚ä¸€ä¸ªå¹³å°åˆ©ç”¨äº†è°·æ­Œæ‰€æœ‰çš„åŸºç¡€è®¾æ–½ä¼˜åŠ¿ï¼ˆstubbyã€monarchã€loas ç­‰ï¼‰ï¼Œå¹¶å¢åŠ äº†æœ€åˆçš„æœåŠ¡ç®¡ç†ç»éªŒï¼Œå¹¶å°†å…¶å…¨éƒ¨æš´éœ²ç»™åº”ç”¨å›¢é˜Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªå›¢é˜Ÿéƒ½ä¼šç¼–å†™ä»–ä»¬çš„æ–¹æ¡ˆå’Œæ–¹æ³•ï¼Œå¹¶å®šä¹‰ä»–ä»¬çš„ &amp;ldquo;One Platform API&amp;rdquo;ã€‚ä¸€æ—¦ä¸ API å¹³å°å›¢é˜Ÿè¾¾æˆä¸€è‡´ï¼Œå„å›¢é˜Ÿå°±ä¸å¿…å†å¤„ç†ä»»ä½•è·¨é¢†åŸŸçš„é—®é¢˜ï¼Œå› ä¸º Istio å¤„ç†äº†è¿™äº›æœåŠ¡ï¼šæµé‡ç®¡ç†ã€å¼¹æ€§ã€å¯è§‚å¯Ÿæ€§ï¼ˆä½¿ç”¨å…·æœ‰ä¸€è‡´åè¯çš„æ¯ä¸ªæœåŠ¡çš„é¢„å»ºä»ªè¡¨æ¿ï¼‰ã€è®¤è¯ã€æˆæƒã€é€Ÿç‡é™åˆ¶ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Istio çš„æƒ³æ³•æ¥è‡ªäºæ­¤ï¼›æˆ‘ä»¬åŸºæœ¬ä¸Šé‡‡ç”¨äº† One Platform çš„æƒ³æ³•ï¼Œå°† Envoy åŠ å…¥å…¶ä¸­ï¼ˆä½œä¸ºä¸€ä¸ªæ›´å¥½çš„æ•°æ®å¹³é¢ï¼‰ï¼Œå¹¶å°†å…¶ä¸ LOAS æœåŠ¡èº«ä»½æ¦‚å¿µç›¸ç»“åˆï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©ä¸–äººæ‰€çŸ¥çš„ Spiffeï¼‰ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªæƒ³æ³•å‘Šè¯‰äº† 12 å®¶å…¬å¸ï¼Œä»–ä»¬éƒ½å¾ˆå–œæ¬¢è¿™ä¸ªæƒ³æ³•ã€‚è¿™äº›å…¬å¸åŒ…æ‹¬å¤§å‹äº’è”ç½‘å…¬å¸ã€é‡‘èæœåŠ¡å…¬å¸å’Œç§‘æŠ€å…¬å¸ï¼Œç‰¹åˆ«æ˜¯ SaaS ä¾›åº”å•†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2017å½¢æˆæ ¸å¿ƒ&#34;&gt;2017ï¼šå½¢æˆæ ¸å¿ƒ&lt;/h2&gt;
&lt;p&gt;2017 å¹´ 5 æœˆçš„ï¼ŒIstio åœ¨ Gluecon ä¸Š&lt;a href=&#34;https://cloud.google.com/blog/products/gcp/istio-modern-approach-to-developing-and&#34; title=&#34;é¦–æ¬¡å…¬å¸ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¦–æ¬¡å…¬å¸ƒ&lt;/a&gt;
ã€‚0.1 å±•ç¤ºäº† Istio çš„æ½œåŠ›ï¼Œå¼•å‘äº†å¤§é‡çš„å…³æ³¨å’Œè®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;2018-2019ç¨³å®šæ ¸å¿ƒå¢åŠ èƒ½åŠ›&#34;&gt;2018-2019ï¼šç¨³å®šæ ¸å¿ƒï¼Œå¢åŠ èƒ½åŠ›&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„ä¸¤å¹´é‡Œï¼Œæˆ‘ä»¬æ”¶é›†äº†å®¢æˆ·çš„éœ€æ±‚ï¼Œå°†ä½¿ç”¨åé¦ˆå†…åŒ–ï¼Œå¹¶ç¨³å®šäº†æ ¸å¿ƒåŠŸèƒ½ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åšå‡ºäº†ä¸€äº›å…³é”®çš„æ¶æ„å†³å®šï¼Œå¦‚å®šä¹‰å¤šé›†ç¾¤æ¨¡å‹ï¼Œå¹¶å°†ä»£ç é‡æ–°æ¶æ„ä¸ºä¸€ä¸ªå•ä¸€çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥æ–¹ä¾¿ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2020å›¢ç»“ç¤¾åŒº&#34;&gt;2020ï¼šå›¢ç»“ç¤¾åŒº&lt;/h2&gt;
&lt;p&gt;éšç€ Istio çš„é‡‡ç”¨å’Œç”¨æˆ·ç”Ÿæ€ç³»ç»Ÿçš„å‘å±•ï¼Œäººä»¬å¯¹ç®¡ç†å’Œå•†æ ‡ä¿æŠ¤çš„æ‹…å¿§ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨&lt;a href=&#34;https://www.tetrate.io/blog/istio-ouc/&#34; title=&#34;è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;
æ‰€æåˆ°çš„ï¼Œä½œä¸ºä¸€ä¸ªç¤¾åŒºä¿æŒå›¢ç»“æ˜¯é¡¹ç›®æˆåŠŸçš„å…³é”®ã€‚æˆ‘å¯ä»¥è‡ªè±ªåœ°è¯´ï¼ŒIstio å°±æ˜¯è¿™æ ·åšçš„ã€‚å› æ­¤ï¼Œä»Šå¤©åŠ å…¥ CNCF çš„è¡ŒåŠ¨æ˜¯å‘å±•ç¤¾åŒºå’Œå»ºç«‹æœ€ç»ˆç”¨æˆ·ä¿¡ä»»çš„åˆä¸€æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2021å‘-wasm-å’Œå…¶ä»–é¢†åŸŸå‘å±•&#34;&gt;2021ï¼šå‘ Wasm å’Œå…¶ä»–é¢†åŸŸå‘å±•&lt;/h2&gt;
&lt;p&gt;äººä»¬å¯¹åŠ å…¥å…¶ä»–åŸºç¡€è®¾æ–½ï¼Œå¦‚è™šæ‹Ÿæœºã€åŠŸèƒ½å’Œè£¸æœºå·¥ä½œè´Ÿè½½ï¼Œä»¥åŠä½¿ç”¨ Wasm ç­‰æŠ€æœ¯çš„å®šåˆ¶å’Œå…¶ä»–åŠŸèƒ½ä½œä¸ºæœ¬åœ° API çš„å…´è¶£è¶Šæ¥è¶Šå¤§ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸å¿…å†ä½¿ç”¨ Envoy è¿‡æ»¤å™¨äº†ã€‚2021 å¹´è§è¯äº†å…¶ä¸­ä¸€äº›åŠŸèƒ½çš„å»ºç«‹å’Œæ¨å¹¿ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Varun Talwar æ˜¯é¡¹ç›®çš„åˆ›å§‹äººä¹‹ä¸€ï¼Œä»–ä¸€ç›´è®¤ä¸º Istio æ˜¯äº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä»Šå¤©çš„å…¬å‘ŠéªŒè¯äº†ä»–å¯¹é¡¹ç›®çš„æ„¿æ™¯ï¼Œæˆ‘è¦æ„Ÿè°¢ Tetrate æˆä¸º Istio å’Œæˆ‘ä»¬ç¤¾åŒºçš„æœ‰åŠ›æ”¯æŒè€…ã€‚&amp;quot;â€”â€”Louis Ryanï¼ˆIstio è”åˆåˆ›å§‹äººï¼Œè°·æ­Œå·¥ç¨‹è´Ÿè´£äººï¼‰&lt;/p&gt;
&lt;h2 id=&#34;é›¶ä¿¡ä»»çš„åŸºç¡€&#34;&gt;é›¶ä¿¡ä»»çš„åŸºç¡€&lt;/h2&gt;
&lt;p&gt;å…³äºé›¶ä¿¡ä»»çš„è¯é¢˜å·²ç»æœ‰å¾ˆå¤šè®¨è®ºï¼Œä½†å¾ˆå°‘æœ‰æ˜ç¡®çš„è¯´æ³•ã€‚æ­£å¦‚ Eric Brewer ä»Šå¤©åœ¨ IstioCon çš„&lt;a href=&#34;https://events.istio.io/istiocon-2022/sessions/zero-trust-istio/&#34; title=&#34;ä¸»é¢˜æ¼”è®²&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»é¢˜æ¼”è®²&lt;/a&gt;
ä¸­æåˆ°çš„ï¼ŒIstio æ­£åœ¨æˆä¸ºé›¶ä¿¡ä»»çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯é¢å‘èº«ä»½çš„æ§åˆ¶ï¼Œè€Œä¸æ˜¯é¢å‘ç½‘ç»œçš„æ§åˆ¶ã€‚è¿™æ–¹é¢çš„æ ¸å¿ƒåŸåˆ™åœ¨è°·æ­Œç™½çš®ä¹¦&lt;a href=&#34;https://cloud.google.com/blog/products/identity-security/beyondprod-whitepaper-discusses-cloud-native-security-at-google&#34; title=&#34;ã€ŠBeyondProdï¼šäº‘åŸç”Ÿå®‰å…¨çš„æ–°æ–¹æ³•ã€‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€ŠBeyondProdï¼šäº‘åŸç”Ÿå®‰å…¨çš„æ–°æ–¹æ³•ã€‹&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œä½œä¸ºä¸€ä¸ªè¡Œä¸šï¼Œè¿™é‡Œæœ‰æ›´å¤šçš„äº‹æƒ…è¦åšã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬å¯ä»¥æŠŠåº”ç”¨ç”¨æˆ·å’Œæ•°æ®æœåŠ¡éƒ½å¸¦è¿›æ¥ã€‚å¦‚æœæˆ‘ä»¬èƒ½å°†èº«ä»½æ¦‚å¿µæ‰©å±•åˆ°ç”¨æˆ·ï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾›çµæ´»è€Œä¸°å¯Œçš„ç­–ç•¥æœºåˆ¶æ¥æŒ‡å®šã€ç›‘æ§å’Œè·Ÿè¸ªè®¿é—®æ§åˆ¶ï¼Œæˆ‘ä»¬å°±èƒ½è¾¾åˆ°ä¸€ä¸ªå¯æ“ä½œçš„é›¶ä¿¡ä»»ç»“æ„ â€”â€” ä¸€ä¸ªå°†ç”¨æˆ·ã€æœåŠ¡å’Œæ•°æ®ç»Ÿä¸€åˆ°ä¸€ä¸ªç®¡ç†å±‚çš„ç»“æ„ã€‚æˆ‘åœ¨ 2020 å¹´ä¸ºç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰ä¸¾åŠçš„å›´ç»•ä¿¡ä»»äº‘åŸç”Ÿåº”ç”¨çš„ä¸»é¢˜æ¼”è®²ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ Tetrate åˆ›å»ºäº† &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
â€”â€” ä¸€ä¸ªç®¡ç†å¹³é¢ï¼Œä½¿å¤§å‹ç»„ç»‡å¯æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;Tetrate Service Bridge çš„åŸºç¡€æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·ã€æœåŠ¡å’Œæ•°æ®çš„èº«ä»½ã€‚æ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªåŠ å¯†èº«ä»½ï¼Œæ„æˆæ‰€æœ‰æ”¿ç­–çš„éª¨å¹²ã€‚&lt;/li&gt;
&lt;li&gt;ç­–ç•¥å’Œè®¿é—®æ§åˆ¶ã€‚å®šä¹‰ Istio ç­–ç•¥ï¼Œä¹ŸåŒ…æ‹¬åº”ç”¨å’Œç»„ç»‡ç­–ç•¥ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œè®¾å¤‡ï¼Œä»¥åŠå¤§è§„æ¨¡ç®¡ç†å®ƒä»¬çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–ã€‚åœ¨è¿è¡Œæ—¶è‡ªåŠ¨åŒ–ã€æµ‹é‡å’ŒæŒç»­ç›‘æµ‹ç­–ç•¥çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬èƒ½è®©ä¼ä¸šä»¥è¿™ç§æ–¹å¼ä¸ºäº‘åŸç”Ÿå·¥ä½œè´Ÿè½½éƒ¨ç½²å’Œè¿è¥å®‰å…¨ï¼Œæˆ‘ä»¬å°±èƒ½ä½œä¸ºä¸€ä¸ªè¡Œä¸šå–å¾—å·¨å¤§è¿›æ­¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äººæ‰&#34;&gt;äººæ‰&lt;/h2&gt;
&lt;p&gt;å½’æ ¹ç»“åº•ï¼Œæ²¡æœ‰é«˜ç´ è´¨ã€å¯Œæœ‰åˆ›é€ æ€§çš„äººæ‰ï¼Œä»»ä½•é¡¹ç›®æˆ–æŠ€æœ¯éƒ½ä¸ä¼šæˆä¸ºä¸»æµã€‚åœ¨ Tetrateï¼Œæˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬éœ€è¦å¯¹ç¤¾åŒºè¿›è¡Œæœ‰å…³è¿™é¡¹æŠ€æœ¯çš„æ•™è‚²ï¼Œå¹¶ä¸ºè´Ÿè´£ä»»çš„é‡‡ç”¨è·¯å¾„åšå‡ºè´¡çŒ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æä¾›ä¸–ç•Œçº§çš„è®¤è¯å’Œå…è´¹çš„åœ¨çº¿åŸ¹è®­è¯¾ç¨‹ï¼Œä½¿ç¤¾åŒºä¸­çš„ä»»ä½•äººéƒ½å¯ä»¥åœ¨ &lt;a href=&#34;https://academy.tetrate.io/&#34; title=&#34;academy.terate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;academy.terate.io&lt;/a&gt;
 è½»æ¾å‚åŠ  Istio å’Œ Envoy çš„åˆçº§å’Œé«˜çº§è¯¾ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ Tetrate çš„æ‰€æœ‰äººï¼Œç‰¹åˆ«æ˜¯æˆ‘è‡ªå·±ï¼Œéƒ½æœŸå¾…ç€ä¸‹ä¸€æ­¥çš„å‘å±•ï¼Œæˆ‘ä»¬å°†å§‹ç»ˆæ”¯æŒ Istio é¡¹ç›®å’Œç¤¾åŒºã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio 1.13 æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„æ›´æ–°ï¼Ÿ</title>
      <link>https://jimmysong.io/blog/what-is-new-in-istio-1-13/</link>
      <pubDate>Tue, 22 Mar 2022 17:16:50 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/what-is-new-in-istio-1-13/</guid>
      <description>
        
        
        &lt;p&gt;2022 å¹´ 2 æœˆ Istio å‘å¸ƒ &lt;a href=&#34;https://istio.io/latest/news/releases/1.13.x/announcing-1.13/&#34; title=&#34;1.13.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.13.0&lt;/a&gt;
 å’Œ &lt;a href=&#34;https://istio.io/latest/news/releases/1.13.x/announcing-1.13.1/&#34; title=&#34;1.13.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.13.1&lt;/a&gt;
ï¼Œè¿™ç¯‡åšå®¢å°†æƒ³ä½ ä»‹ç»è¿™ä¸¤ä¸ªç‰ˆæœ¬ä¸­æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„æ–°ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.13 æ˜¯ 2022 å¹´çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼ŒIstio å›¢é˜Ÿä¼šä¾ç„¶æŒ‰ç…§æ¯ä¸ªå­£åº¦çš„é¢‘ç‡å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚æ€»ä½“æ¥çœ‹ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­çš„æ–°ç‰¹æ€§åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ Kubernetes æ›´æ–°ç‰ˆæœ¬çš„æ”¯æŒ&lt;/li&gt;
&lt;li&gt;å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ APIâ€”â€”ProxyConfigï¼Œç”¨æ¥é…ç½® sidecar proxy&lt;/li&gt;
&lt;li&gt;å®Œå–„äº† Telemetry API&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤šç½‘ç»œç½‘å…³çš„åŸºäºä¸»æœºåçš„è´Ÿè½½å‡è¡¡å™¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¯¹-kubernetes-ç‰ˆæœ¬çš„æ”¯æŒ&#34;&gt;å¯¹ Kubernetes ç‰ˆæœ¬çš„æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;æˆ‘ç»å¸¸çœ‹åˆ°æœ‰äººåœ¨ç¤¾åŒºé‡Œé—® Istio æ”¯æŒå“ªäº› Kubernetes ç‰ˆæœ¬ï¼Œå…¶å® Istio å®˜ç½‘ä¸­å·²ç»æ˜ç¡®åˆ—å‡ºäº†æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬ï¼Œä½ å¯ä»¥åœ¨&lt;a href=&#34;https://istio.io/latest/docs/releases/supported-releases/#support-status-of-istio-releases&#34; title=&#34;è¿™é‡Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;
çœ‹åˆ°ï¼ŒIstio 1.13 æ”¯æŒ Kubernetes 1.20ã€1.21ã€1.22 å’Œ 1.23 ç‰ˆæœ¬ï¼Œå¹¶åœ¨ Kubernetes 1.16ã€1.17ã€1.18ã€1.19 ä¸­æµ‹è¯•è¿‡ï¼Œä½†å¹¶å¾—åˆ°å®˜æ–¹æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é…ç½® Istio çš„æ—¶å€™ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šæ£€æŸ¥åˆ—è¡¨ï¼Œæˆ‘å°†ä»–ä»¬éƒ½è®°å½•åˆ°äº† &lt;a href=&#34;https://github.com/tetratelabs/istio-cheatsheet&#34; title=&#34;Istio cheatsheet&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio cheatsheet&lt;/a&gt;
 ä¸­ï¼Œè¿™ä¸ªé¡¹ç›®ä¸­æ•´ç†äº†å¾ˆå¤šå…³äºé…ç½® Istioã€èµ„æºå¯¹è±¡çš„ä½¿ç”¨ã€å¸¸è§é—®é¢˜å¤„ç†ç­‰ç›¸å…³çš„ cheatsheetï¼Œå°†äºè¿‘æœŸä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/what-is-new-in-istio-1-13/istio-cheatsheet.jpg&#34; data-img=&#34;/blog/what-is-new-in-istio-1-13/istio-cheatsheet.jpg&#34; data-width=&#34;1728&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Istio cheatsheet é¡µé¢æˆªå›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio cheatsheet é¡µé¢æˆªå›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å¼•å…¥æ–°çš„-proxyconfig-api&#34;&gt;å¼•å…¥æ–°çš„ ProxyConfig API&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio 1.13 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³è‡ªå®šä¹‰ sidecar proxy çš„é…ç½®ï¼Œæœ‰ä¸¤ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;æ–¹å¼ä¸€ï¼šMeshConfig&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;MeshConfig&lt;/code&gt;ï¼Œåœ¨ Mesh çº§åˆ«ä½¿ç”¨ IstioOperator æ¥ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸‹é¢çš„é…ç½®æ¥ä¿®æ”¹ &lt;code&gt;istiod&lt;/code&gt; çš„é»˜è®¤å‘ç°ç«¯å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;discoveryAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod:15012&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ–¹å¼äºŒï¼šPod ä¸­çš„ annotation&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥åœ¨ Pod çº§åˆ«ä½¿ç”¨ annotation çš„æ–¹å¼è‡ªå®šä¹‰é…ç½®ï¼Œä¾‹å¦‚åœ¨ Pod ä¸­å¢åŠ ä¸‹é¢çš„é…ç½®åŒæ ·å¯ä»¥ä¿®æ”¹å·¥ä½œè´Ÿè½½æ‰€æœ‰è¿æ¥çš„ &lt;code&gt;istiod&lt;/code&gt; çš„é»˜è®¤ç«¯å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;anannotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;proxy.istio.io/config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;discoveryAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod:15012&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ä½ åŒæ—¶ä½¿ç”¨äº†ä»¥ä¸Šä¸¤ç§æ–¹å¼é…ç½®äº† sidecarï¼Œ&lt;code&gt;annotations&lt;/code&gt; ä¸­è®¾ç½®çš„å­—æ®µå°†å®Œå…¨è¦†ç›– &lt;code&gt;MeshConfig&lt;/code&gt; é»˜è®¤çš„å­—æ®µã€‚å…³äº &lt;code&gt;ProxyConfig&lt;/code&gt; çš„æ‰€æœ‰é…ç½®é¡¹è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–°æ–¹å¼ï¼š&lt;code&gt;ProxyConfig&lt;/code&gt; API&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨ 1.13 ç‰ˆæœ¬ä¸­ï¼Œæ–°å¢äº†ä¸€ä¸ªé¡¶çº§è‡ªå®šä¹‰èµ„æº &lt;code&gt;ProxyConfig&lt;/code&gt;ï¼Œä½ å¯ä»¥ä¸€ç«™å¼çš„åœ¨ä¸€ä¸ªåœ°æ–¹æ¥è‡ªå®šä¹‰ sidecar proxy çš„é…ç½®ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®š namespaceã€ä½¿ç”¨ &lt;code&gt;selector&lt;/code&gt; æ¥é€‰æ‹©å·¥ä½œè´Ÿè½½çš„èŒƒå›´ï¼Œå°±åƒå…¶ä»– CRD ä¸€æ ·ã€‚ç›®å‰ Istio å¯¹è¯¥ API çš„æ”¯æŒæœ‰é™ï¼Œå…³äº &lt;code&gt;ProxyConfig&lt;/code&gt; API çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/proxy-config/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä¸è®ºä½ ç”¨å“ªç§æ–¹å¼è‡ªå®šä¹‰ sidecar proxy çš„é…ç½®ï¼Œè¯¥é…ç½®éƒ½æ— æ³•åŠ¨æ€ç”Ÿæ•ˆï¼Œéœ€è¦é‡å¯å·¥ä½œè´Ÿè½½æ‰å¯ä»¥ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸Šé¢çš„é…ç½®ï¼Œå› ä¸ºä½ ä¿®æ”¹äº† &lt;code&gt;istiod&lt;/code&gt; çš„é»˜è®¤ç«¯å£ï¼Œmesh ä¸­çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½éƒ½éœ€è¦é‡å¯æ‰å¯ä»¥ä¸ control plane å»ºç«‹è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;telemetry-api&#34;&gt;Telemetry API&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­ï¼Œå¾ˆå¤šæ‰©å±•å’Œè‡ªå®šä¹‰çš„é…ç½®éƒ½æ˜¯é€šè¿‡ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ExtensionProvider&#34; title=&#34;&amp;lt;code&amp;gt;MeshConfig&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;MeshConfig&lt;/code&gt;&lt;/a&gt;
 çš„æ–¹å¼æ¥å®Œæˆçš„ã€‚å¯è§‚å¯Ÿæ€§çš„ä¸‰ç§ç±»å‹ Metricã€é¥æµ‹å’Œæ—¥å¿—ï¼Œåˆ†åˆ«å¯ä»¥å¯¹æ¥ä¸åŒçš„æä¾›è€…ï¼Œ&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/telemetry/&#34; title=&#34;Telemetry API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Telemetry API&lt;/a&gt;
 å¯ä»¥è®©ä½ æœ‰ä¸€ä¸ªä¸€ç«™å¼çš„çµæ´»çš„é…ç½®å®ƒä»¬ã€‚ä¸ ProxyConfig API ç±»ä¼¼ï¼ŒTelemetry API ä¹Ÿéµå¾ªç€å·¥ä½œè´Ÿè½½é€‰æ‹©å™¨&amp;gt;æœ¬åœ°å‘½åç©ºé—´&amp;gt;æ ¹é…ç½®å‘½åç©ºé—´çš„é…ç½®å±‚çº§å…³ç³»ã€‚è¯¥ API æ˜¯åœ¨ Istio 1.11 ä¸­å¼•å…¥ï¼Œåœ¨è¯¥ç‰ˆæœ¬ä¸­å¾—åˆ°äº†è¿›ä¸€æ­¥å®Œå–„ï¼Œå¢åŠ äº† &lt;code&gt;OpenTelemetry&lt;/code&gt; æ—¥å¿—ã€è¿‡æ»¤è®¿é—®æ—¥å¿—ä»¥åŠè‡ªå®šä¹‰è·Ÿè¸ªæœåŠ¡åç§°çš„æ”¯æŒã€‚è¯¦è§ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/telemetry/&#34; title=&#34;Telemetry é…ç½®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Telemetry é…ç½®&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è‡ªåŠ¨è§£æå¤šç½‘ç»œç½‘å…³ä¸»æœºå&#34;&gt;è‡ªåŠ¨è§£æå¤šç½‘ç»œç½‘å…³ä¸»æœºå&lt;/h2&gt;
&lt;p&gt;2021 å¹´ 9 æœˆï¼ŒIstio ç¤¾åŒºé‡Œ&lt;a href=&#34;https://szabo.jp/2021/09/22/multicluster-istio-on-eks/&#34; title=&#34;æœ‰äººæŠ¥å‘Š&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ‰äººæŠ¥å‘Š&lt;/a&gt;
ï¼Œåœ¨ AWS EKS ä¸­è¿è¡Œå¤šé›†ç¾¤å¤šä¸»çš„ Istio æ—¶ï¼Œå‡ºç° EKS çš„è´Ÿè½½å‡è¡¡å™¨æ— æ³•è§£æçš„é—®é¢˜ã€‚å¯¹äºå¤šé›†ç¾¤å¤šç½‘ç»œçš„ç½‘æ ¼ï¼Œè·¨é›†ç¾¤è¾¹ç•Œçš„æœåŠ¡è´Ÿè½½ï¼Œéœ€è¦é€šè¿‡ä¸“ç”¨çš„ä¸œè¥¿å‘ç½‘å…³ï¼Œä»¥é—´æ¥çš„æ–¹å¼é€šè®¯ã€‚ä½ å¯ä»¥æŒ‰ç…§ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/&#34; title=&#34;Istio å®˜ç½‘ä¸Šçš„è¯´æ˜&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘ä¸Šçš„è¯´æ˜&lt;/a&gt;
é…ç½®å¤šç½‘ç»œçš„ primary-remote é›†ç¾¤ï¼ŒIstio ä¼šæ ¹æ®ä¸»æœºåè‡ªåŠ¨è§£æè´Ÿè½½å‡è¡¡å™¨çš„ IP åœ°å€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-1131-ä¿®å¤é‡å¤§å®‰å…¨æ¼æ´&#34;&gt;Istio 1.13.1 ä¿®å¤é‡å¤§å®‰å…¨æ¼æ´&lt;/h2&gt;
&lt;p&gt;å½“æœˆï¼ŒIstio 1.13.1 å‘å¸ƒï¼Œä¿®å¤äº†ä¸€ä¸ªå·²çŸ¥çš„&lt;a href=&#34;https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE-2022-23635&#34; title=&#34;é‡å¤§æ¼æ´&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡å¤§æ¼æ´&lt;/a&gt;
ï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœªç»è®¤è¯çš„æ§åˆ¶å¹³é¢æ‹’ç»æœåŠ¡æ”»å‡»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/what-is-new-in-istio-1-13/primary-remote-cluster-mesh.jpg&#34; data-img=&#34;/blog/what-is-new-in-istio-1-13/primary-remote-cluster-mesh.jpg&#34; data-width=&#34;1424&#34; data-height=&#34;1200&#34; alt=&#34;image&#34; data-caption=&#34;è·¨ç½‘ç»œçš„ä¸»ä»é›†ç¾¤&#34;&gt;
    
  
  &lt;figcaption&gt;è·¨ç½‘ç»œçš„ä¸»ä»é›†ç¾¤&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å®‰è£…å¤šç½‘ç»œçš„ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/&#34; title=&#34;primary-remote&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;primary-remote&lt;/a&gt;
 æ¨¡å¼çš„ Istio ç½‘æ ¼æ—¶ï¼Œä¸ºäº†è®© remote Kubernetes é›†ç¾¤èƒ½å¤Ÿè®¿é—®æ§åˆ¶å¹³é¢ï¼Œéœ€è¦åœ¨ primary é›†ç¾¤ä¸­å®‰è£…ä¸€ä¸ªä¸œè¥¿å‘çš„ Gatewayï¼Œå°†æ§åˆ¶å¹³é¢ &lt;code&gt;istiod&lt;/code&gt; çš„ 15012 ç«¯å£æš´éœ²åˆ°äº’è”ç½‘ã€‚æ”»å‡»è€…å¯èƒ½å‘è¯¥ç«¯å£å‘é€ç‰¹åˆ¶çš„æ¶ˆæ¯ï¼Œå¯¼è‡´æ§åˆ¶å¹³é¢å´©æºƒã€‚å¦‚æœä½ è®¾ç½®äº†é˜²ç«å¢™ï¼Œåªå…è®¸æ¥è‡ªéƒ¨åˆ† IP çš„æµé‡è®¿é—®è¯¥ç«¯å£ï¼Œå°†å¯ä»¥ç¼©å°è¯¥é—®é¢˜çš„å½±å“èŒƒå›´ã€‚å»ºè®®ä½ ç«‹å³å‡çº§åˆ° Istio 1.13.1 æ¥å½»åº•è§£å†³è¯¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istiocon-2022&#34;&gt;IstioCon 2022&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/what-is-new-in-istio-1-13/istiocon-2022.jpg&#34; data-img=&#34;/blog/what-is-new-in-istio-1-13/istiocon-2022.jpg&#34; data-width=&#34;1318&#34; data-height=&#34;736&#34; alt=&#34;image&#34; data-caption=&#34;IstioCon 2022&#34;&gt;
    
  
  &lt;figcaption&gt;IstioCon 2022&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä½œä¸ºä¸Šä¸€å±Šå’Œæœ¬å±Š IstioCon çš„ç­¹å¤‡å§”å‘˜ä¼šæˆå‘˜ä¹‹ä¸€ï¼Œæˆ‘å·å¬å¤§å®¶æŠ¥åå‚åŠ  4 æœˆ 25 æ—¥åœ¨çº¿ä¸Šä¸¾è¡Œçš„ &lt;a href=&#34;https://events.istio.io/istiocon-2022/&#34; title=&#34;IstioCon 2022&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon 2022&lt;/a&gt;
ï¼IstioCon 2022 æ˜¯ä¸€ä¸ªä»¥è¡Œä¸šä¸ºé‡ç‚¹çš„æ´»åŠ¨ï¼Œä¸€ä¸ªè¿æ¥è´¡çŒ®è€…å’Œç”¨æˆ·çš„å¹³å°ï¼Œè®¨è®º Istio åœ¨ä¸åŒæ¶æ„è®¾ç½®ä¸­çš„ç”¨é€”ï¼Œæœ‰å“ªäº›é™åˆ¶ï¼Œä»¥åŠé¡¹ç›®çš„ä¸‹ä¸€æ­¥å‘å±•æ–¹å‘ã€‚ä¸»è¦çš„ç„¦ç‚¹å°†æ˜¯åœ¨æœ€ç»ˆç”¨æˆ·å…¬å¸ï¼Œå› ä¸ºæˆ‘ä»¬æœŸå¾…ç€åˆ†äº«å¤šæ ·åŒ–çš„æ¡ˆä¾‹ç ”ç©¶ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ Istioã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ç½‘æ˜“å¼€æº Istio æ‰©å±•é¡¹ç›® Slime ç®€ä»‹â€”â€”åŸºäº Istio çš„æ™ºèƒ½æœåŠ¡ç½‘æ ¼ç®¡ç†å™¨</title>
      <link>https://jimmysong.io/blog/slime-intro/</link>
      <pubDate>Wed, 24 Nov 2021 14:43:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/slime-intro/</guid>
      <description>
        
        
        &lt;p&gt;æœ€è¿‘æˆ‘åœ¨ç ”ç©¶ Istio ç”Ÿæ€ä¸­çš„å¼€æºé¡¹ç›®ï¼Œ&lt;a href=&#34;https://github.com/slime-io/slime/&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt;
 è¿™ä¸ªé¡¹ç›®å¼€æºä¸ 2021 å¹´åˆï¼Œæ˜¯ç”±ç½‘æ˜“æ•°å¸†å¾®æœåŠ¡å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾åŸºäº Istio çš„æ™ºèƒ½ç½‘æ ¼ç®¡ç†å™¨ã€‚Slime åŸºäº Kubernetes Operator å®ç°ï¼Œå¯ä½œä¸º Istio çš„ CRD ç®¡ç†å™¨ï¼Œæ— é¡»å¯¹ Istio åšä»»ä½•å®šåˆ¶åŒ–æ”¹é€ ï¼Œå°±å¯ä»¥å®šä¹‰åŠ¨æ€çš„æœåŠ¡æ²»ç†ç­–ç•¥ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨ä¾¿æ·ä½¿ç”¨ Istio å’Œ Envoy é«˜é˜¶åŠŸèƒ½çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;slime-è¯•å›¾è§£å†³çš„é—®é¢˜&#34;&gt;Slime è¯•å›¾è§£å†³çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;Slime é¡¹ç›®çš„è¯ç”Ÿä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç½‘æ ¼å†…æ‰€æœ‰æœåŠ¡é…ç½®å…¨é‡ä¸‹åˆ°æ‰€æœ‰ Sidecar Proxyï¼Œå¯¼è‡´å…¶æ¶ˆè€—å¤§é‡èµ„æºä½¿å¾—åº”ç”¨æ€§èƒ½å˜å·®çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åœ¨ Istio ä¸­å®ç°é«˜é˜¶æ‰©å±•çš„é—®é¢˜ï¼šæ¯”å¦‚æ‰©å±• HTTP æ’ä»¶ï¼›æ ¹æ®æœåŠ¡çš„èµ„æºä½¿ç”¨ç‡åšåˆ°è‡ªé€‚åº”é™æµ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Slime è§£å†³ä»¥ä¸Šé—®é¢˜çš„ç­”æ¡ˆæ˜¯æ„å»º Istio çš„æ§åˆ¶å¹³é¢ï¼Œå…·ä½“åšæ³•æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºå¯æ‹”æ’æ§åˆ¶å™¨&lt;/li&gt;
&lt;li&gt;æ•°æ®å¹³é¢ç›‘æ§&lt;/li&gt;
&lt;li&gt;CRD è½¬æ¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ–¹å¼ Slime å¯ä»¥å®ç°&lt;strong&gt;é…ç½®æ‡’åŠ è½½&lt;/strong&gt;å’Œ&lt;strong&gt;æ’ä»¶ç®¡ç†å™¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;slime-æ¶æ„&#34;&gt;Slime æ¶æ„&lt;/h2&gt;
&lt;p&gt;Slime å†…éƒ¨åˆ†ä¸ºä¸‰å¤§æ¨¡å—ï¼Œå…¶æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/slime-intro/slime-internal-arch.jpg&#34; data-img=&#34;/blog/slime-intro/slime-internal-arch.jpg&#34; data-width=&#34;1468&#34; data-height=&#34;778&#34; alt=&#34;image&#34; data-caption=&#34;Slime å†…éƒ¨æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Slime å†…éƒ¨æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Slime å†…éƒ¨ä¸‰å¤§ç»„ä»¶ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;slime-boot&lt;/code&gt;ï¼šåœ¨ Kubernetes ä¸Šéƒ¨ç½² Slime æ¨¡å—çš„ operatorã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slime-controller&lt;/code&gt;ï¼šSlime çš„æ ¸å¿ƒç»„ä»¶ï¼Œç›‘å¬ Slime CRD å¹¶å°†å…¶è½¬æ¢ä¸º Istio CRDã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slime-metric&lt;/code&gt;ï¼šç”¨äºè·å–æœåŠ¡ metrics ä¿¡æ¯çš„ç»„ä»¶ï¼Œ&lt;code&gt;slime-controller&lt;/code&gt; ä¼šæ ¹æ®å…¶è·å–çš„ä¿¡æ¯åŠ¨æ€è°ƒæ•´æœåŠ¡æ²»ç†è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç›®å‰ Slime å†…ç½®äº†ä¸‰ä¸ªæ§åˆ¶å™¨å­æ¨¡å—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ‡’åŠ è½½ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰&lt;/strong&gt;ï¼šç”¨æˆ·æ— é¡»æ‰‹åŠ¨é…ç½® &lt;code&gt;SidecarScope&lt;/code&gt;ï¼ŒIstio å¯ä»¥æŒ‰éœ€åŠ è½½æœåŠ¡é…ç½®å’ŒæœåŠ¡å‘ç°ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP æ’ä»¶ç®¡ç†&lt;/strong&gt;ï¼šä½¿ç”¨æ–°çš„ CRDâ€”â€”&lt;code&gt;pluginmanager/envoyplugin&lt;/code&gt; åŒ…è£…äº†å¯è¯»æ€§ï¼Œæ‘’å¼ƒäº†å¯ç»´æŠ¤æ€§è¾ƒå·®çš„ &lt;code&gt;envoyfilter&lt;/code&gt;ï¼Œä½¿å¾—æ’ä»¶æ‰©å±•æ›´ä¸ºä¾¿æ·ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªé€‚åº”é™æµ&lt;/strong&gt;ï¼šç»“åˆç›‘æ§ä¿¡æ¯è‡ªåŠ¨è°ƒæ•´é™æµç­–ç•¥ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯ SidecarScopeï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SidecarScope æ˜¯åœ¨ Istio 1.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç›´æ¥é¢å‘ç”¨æˆ·çš„é…ç½®é¡¹ï¼Œè€Œæ˜¯ Sidecar èµ„æºçš„åŒ…è£…å™¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ &lt;a href=&#34;../config/networking/sidecar.md&#34; title=&#34;Sidecar èµ„æº&#34;&gt;Sidecar èµ„æº&lt;/a&gt;
ä¸­çš„ &lt;code&gt;egress&lt;/code&gt; é€‰é¡¹ã€‚é€šè¿‡è¯¥é…ç½®å¯ä»¥å‡å°‘ Istio å‘ Sidecar ä¸‹å‘çš„æ•°æ®é‡ï¼Œä¾‹å¦‚åªå‘æŸä¸ªå‘½åç©ºé—´ä¸­çš„æŸäº›æœåŠ¡ä¸‹å‘æŸäº› hosts çš„è®¿é—®é…ç½®ï¼Œä»è€Œæé«˜åº”ç”¨æé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä½¿ç”¨-slime-ä½œä¸º-istio-çš„æ§åˆ¶å¹³é¢&#34;&gt;ä½¿ç”¨ Slime ä½œä¸º Istio çš„æ§åˆ¶å¹³é¢&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒSlime åœ¨ Istio ä¹‹ä¸Šæ„å»ºäº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œç›¸å½“äºä¸º Istio æ„å»ºäº†ä¸€å±‚ç®¡ç†å¹³é¢ï¼Œå…¶å·¥ä½œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/slime-intro/slime-flow-chart.jpg&#34; data-img=&#34;/blog/slime-intro/slime-flow-chart.jpg&#34; data-width=&#34;2134&#34; data-height=&#34;1172&#34; alt=&#34;image&#34; data-caption=&#34;Slime å·¥ä½œæµç¨‹å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Slime å·¥ä½œæµç¨‹å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Slime Operator æ ¹æ®ç®¡ç†å‘˜çš„é…ç½®åœ¨ Kubernetes ä¸­å®Œæˆ Slime ç»„ä»¶çš„åˆå§‹åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;å¼€å‘è€…åˆ›å»ºç¬¦åˆ Slime CRD è§„èŒƒçš„é…ç½®å¹¶åº”ç”¨åˆ° Kubernetes é›†ç¾¤ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Slime æŸ¥è¯¢ Prometheus ä¸­ä¿å­˜çš„ç›¸å…³æœåŠ¡çš„ç›‘æ§æ•°æ®ï¼Œç»“åˆ Slime CRD ä¸­è‡ªé€‚åº”éƒ¨åˆ†çš„é…ç½®ï¼Œå°† Slime CRD è½¬æ¢ä¸º Istio CRDï¼ŒåŒæ—¶å°†å…¶æ¨é€åˆ° Global Proxy ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istio ç›‘å¬ Istio CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Istio å°† Sidecar Proxy çš„é…ç½®ä¿¡æ¯æ¨é€åˆ°æ•°æ®å¹³é¢ç›¸åº”çš„ Sidecar Proxy ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šåªæ˜¯ä¸€ä¸ªå¯¹ Slime å·¥ä½œæµç¨‹çš„ä¸€ä¸ªç¬¼ç»Ÿçš„ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/slime-io/slime/&#34; title=&#34;Slime GitHub&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime GitHub&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®æ‡’åŠ è½½&#34;&gt;é…ç½®æ‡’åŠ è½½&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æ•°æ®å¹³é¢ä¸­ Sidecar Proxy èµ„æºæ¶ˆè€—è¿‡å¤§åŠç½‘ç»œå»¶è¿Ÿé—®é¢˜ï¼ŒSlime ä½¿ç”¨äº†é…ç½®æ‡’åŠ è½½ï¼ˆæŒ‰éœ€åŠ è½½ Sidecar é…ç½®ï¼‰çš„æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯å‘æ¯ä¸ª Sidecar Proxy ä¸­åªä¸‹å‘å…¶æ‰€ Pod ä¸­æœåŠ¡æ‰€éœ€çš„é…ç½®ï¼Œè€Œä¸æ˜¯å°†ç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡ä¿¡æ¯å…¨é‡ä¸‹å‘ã€‚æ‰€ä»¥ Slime éœ€è¦è·å–æ¯ä¸ªæœåŠ¡çš„è°ƒç”¨å…³ç³»è¿™æ ·æ‰èƒ½å¾—åˆ°å…¶æ‰€éœ€çš„ Sidecar Proxy é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;Slime å®ç° Sidecar Proxy é…ç½®æ‡’åŠ è½½çš„æ–¹æ³•æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®©æ•°æ®å¹³é¢ä¸­çš„æ‰€æœ‰æœåŠ¡çš„é¦–æ¬¡è°ƒç”¨éƒ½é€šè¿‡ä¸€ä¸ª Global Proxyï¼Œè¯¥ Proxy å¯ä»¥è®°å½•æ‰€æœ‰æœåŠ¡çš„è°ƒç”¨å’Œä¾èµ–ä¿¡æ¯ï¼Œæ ¹æ®è¯¥ä¾èµ–ä¿¡æ¯æ›´æ–° Istio ä¸­ Sidecar èµ„æºçš„é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;å½“æŸä¸ªæœåŠ¡çš„è°ƒç”¨é“¾è¢« VirtualService ä¸­çš„è·¯ç”±ä¿¡æ¯é‡æ–°å®šä¹‰æ—¶ï¼ŒGlobal Proxy åŸæœ‰è®°å½•å°±å¤±æ•ˆäº†ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤è¯¥æœåŠ¡çš„è°ƒç”¨å…³ç³»ã€‚Slime åˆ›å»ºäº†åä¸º &lt;code&gt;ServiceFence&lt;/code&gt;  çš„ CRD æ¥ç»´æŠ¤æœåŠ¡è°ƒç”¨å…³ç³»ä»¥è§£å†³æœåŠ¡ä¿¡æ¯ç¼ºå¤±é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½¿ç”¨-global-proxy-åˆå§‹åŒ–æœåŠ¡è°ƒç”¨æ‹“æ‰‘&#34;&gt;ä½¿ç”¨ Global Proxy åˆå§‹åŒ–æœåŠ¡è°ƒç”¨æ‹“æ‰‘&lt;/h3&gt;
&lt;p&gt;Slime åœ¨æ•°æ®å¹³é¢ä¸­éƒ¨ç½² Global Proxyï¼ˆä¹Ÿå«åš Global Sidecarï¼Œä½†å…¶ä¸åº”ç”¨çš„ Pod ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œç¬”è€…æ›´å€¾å‘äºç§°å…¶ä¸º Global Proxyï¼‰ï¼Œè¯¥ä»£ç†åŒæ ·ä½¿ç”¨ Envoy æ„å»ºï¼Œåœ¨æ¯ä¸ªéœ€è¦å¯åŠ¨é…ç½®æ‡’åŠ è½½çš„å‘½åç©ºé—´ä¸­éƒ¨ç½²ä¸€ä¸ªæˆ–åœ¨æ•´ä¸ªç½‘æ ¼ä¸­åªéƒ¨ç½²ä¸€ä¸ªï¼Œæ‰€æœ‰ç¼ºå¤±æœåŠ¡å‘ç°ä¿¡æ¯çš„è°ƒç”¨ï¼ˆä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®æœåŠ¡è°ƒç”¨å…³ç³»ï¼‰ï¼Œéƒ½ä¼šè¢«å…œåº•è·¯ç”±åŠ«æŒåˆ° Global Proxyï¼Œç»è¿‡å…¶é¦–æ¬¡è½¬å‘åï¼ŒSlime ä¾¿å¯æ„ŸçŸ¥åˆ°è¢«è°ƒç”¨æ–¹çš„ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å…¶å¯¹åº”æœåŠ¡çš„ VirtualServiceï¼Œæ‰¾åˆ°æœåŠ¡åå’ŒçœŸå®åç«¯çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸¤è€…çš„éƒ½åŠ å…¥ SidecarScopeï¼Œä»¥åè¯¥æœåŠ¡çš„è°ƒç”¨å°±ä¸å†éœ€è¦ç»è¿‡ Global Proxy äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-servicefence-ç»´æŠ¤æœåŠ¡è°ƒç”¨æ‹“æ‰‘&#34;&gt;ä½¿ç”¨ ServiceFence ç»´æŠ¤æœåŠ¡è°ƒç”¨æ‹“æ‰‘&lt;/h3&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ Global Proxy åˆå§‹åŒ–æœåŠ¡è°ƒç”¨æ‹“æ‰‘åï¼Œä¸€æ—¦æœåŠ¡è°ƒç”¨é“¾æœ‰å˜åŠ¨çš„è¯æ€ä¹ˆåŠï¼Ÿå¯¹æ­¤ Slime åˆ›å»ºäº† ServiceFence çš„ CRDã€‚ä½¿ç”¨ ServiceFence å¯ä»¥ç»´æŠ¤æœåŠ¡åå’Œåç«¯æœåŠ¡çš„æ˜ å°„å…³ç³»ã€‚Slime æ ¹æ®å…¶å¯¹åº”æœåŠ¡çš„ VirtualServiceï¼Œæ‰¾åˆ° Kubernetes æœåŠ¡åå’ŒçœŸå®åç«¯ï¼ˆhostï¼‰çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸¤è€…çš„éƒ½åŠ å…¥ Sidecar çš„é…ç½®ä¸­ã€‚ServiceFence ç®¡ç†ç”Ÿæˆçš„ SidecarScope çš„ç”Ÿå‘½å‘¨æœŸï¼Œè‡ªåŠ¨æ¸…ç†é•¿æ—¶é—´ä¸ç”¨çš„è°ƒç”¨å…³ç³»ï¼Œä»è€Œé¿å…ä¸Šè¿°é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•å¼€å¯é…ç½®æ‡’åŠ è½½&#34;&gt;å¦‚ä½•å¼€å¯é…ç½®æ‡’åŠ è½½&lt;/h3&gt;
&lt;p&gt;é…ç½®æ‡’åŠ è½½åŠŸèƒ½å¯¹äºç»ˆç«¯ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œåªéœ€è¦ Kubernetes  Service ä¸Šæ‰“ä¸Š &lt;code&gt;istio.dependency.servicefence/status:&amp;quot;true&amp;quot;&lt;/code&gt; çš„æ ‡ç­¾ï¼Œè¡¨æ˜è¯¥æœåŠ¡éœ€è¦å¼€å¯é…ç½®æ‡’åŠ è½½ï¼Œå‰©ä¸‹çš„äº‹æƒ…äº¤ç»™ Slime Operator æ¥å®Œæˆå³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;http-æ’ä»¶ç®¡ç†&#34;&gt;HTTP æ’ä»¶ç®¡ç†&lt;/h2&gt;
&lt;p&gt;Istio ä¸­çš„æ’ä»¶æ‰©å±•åªèƒ½é€šè¿‡ EnvoyFilter æ¥å®ç°ï¼Œå› ä¸ºå®ƒæ˜¯ xDS å±‚é¢çš„é…ç½®ï¼Œç®¡ç†å’Œç»´æŠ¤è¿™æ ·çš„é…ç½®éœ€è¦è€—è´¹å¤§é‡çš„ç²¾åŠ›ï¼Œä¹Ÿæå®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼ŒSlime åœ¨ EnvoyFilter çš„åŸºç¡€ä¸Šåšäº†ä¸€å±‚é¢å‘æ’ä»¶çš„æŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;Slime å…±æœ‰ä¸¤ä¸ª CRD ç”¨äº HTTP æ’ä»¶ç®¡ç†ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PluginManager&lt;/strong&gt;ï¼šé…ç½®ä¸ºå“ªäº›è´Ÿè½½å¼€å¯å“ªäº›æ’ä»¶ï¼Œæ’ä»¶çš„é…ç½®é¡ºåºå³ä¸ºæ‰§è¡Œé¡ºåºï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EnvoyPlugin&lt;/strong&gt;ï¼šEnvoyPlugin ä¸å…³å¿ƒæ¯ä¸ªæ’ä»¶çš„å…·ä½“é…ç½®ï¼Œå…·ä½“é…ç½®ä¼šè¢«æ”¾åœ¨ EnvoyFilter èµ„æºçš„ &lt;code&gt;patch.typed_config&lt;/code&gt; ç»“æ„ä¸­é€ä¼ ï¼‰ï¼ŒEnvoyPlugin çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ’ä»¶é…ç½®åœ¨éœ€è¦çš„ç»´åº¦ä¸­åšèšåˆï¼Œä»è€Œé™å®šæ’ä»¶çš„ç”Ÿé²œèŒƒå›´ã€‚è¿™æ ·åšä¸€æ–¹é¢æ›´åŠ è´´åˆæ’ä»¶ä½¿ç”¨è€…çš„ä¹ æƒ¯ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿé™ä½äº†ä¸Šå±‚é…ç½®çš„å†—ä½™ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Slime ä¸­æ’ä»¶ç®¡ç†çš„è¯¦ç»†ä½¿ç”¨æ–¹å¼è¯·è§ &lt;a href=&#34;https://github.com/slime-io/slime/blob/master/doc/zh/plugin_manager.md&#34; title=&#34;Slime GitHub&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime GitHub&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è‡ªé€‚åº”é™æµ&#34;&gt;è‡ªé€‚åº”é™æµ&lt;/h2&gt;
&lt;p&gt;Envoy å†…ç½®çš„é™æµç»„ä»¶åŠŸèƒ½å•ä¸€ï¼Œåªèƒ½ä»¥å®ä¾‹ç»´åº¦é…ç½®é™æµå€¼ï¼Œæ— æ³•åšåˆ°æ ¹æ®åº”ç”¨è´Ÿè½½çš„è‡ªé€‚åº”é™æµã€‚Slime é€šè¿‡ä¸ Prometheus metric server å¯¹æ¥ï¼Œå®æ—¶çš„è·å–ç›‘æ§æƒ…å†µï¼Œæ¥åŠ¨æ€é…ç½®é™æµå€¼ã€‚&lt;/p&gt;
&lt;p&gt;Slime è‡ªé€‚åº”é™æµçš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/slime-intro/slime-smart-limiter.jpg&#34; data-img=&#34;/blog/slime-intro/slime-smart-limiter.jpg&#34; data-width=&#34;1196&#34; data-height=&#34;898&#34; alt=&#34;image&#34; data-caption=&#34;Slime çš„è‡ªé€‚åº”é™æµæµç¨‹å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Slime çš„è‡ªé€‚åº”é™æµæµç¨‹å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Slime çš„è‡ªé€‚åº”é™æµçš„æµç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸º SmartLimiter åˆ° EnvoyFilter çš„è½¬æ¢ï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºè·å–ç›‘æ§æ•°æ®ã€‚ç›®å‰ Slime æ”¯æŒä» Kubernetes Metric Server è·å–æœåŠ¡çš„ CPUã€å†…å­˜ã€å‰¯æœ¬æ•°ç­‰æ•°æ®ã€‚Slime è¿˜å¯¹å¤–æä¾›äº†ä¸€å¥—ç›‘æ§æ•°æ®æ¥å£ï¼ˆMetric Discovery Serverï¼‰ï¼Œé€šè¿‡ MDSï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„ç›‘æ§æŒ‡æ ‡åŒæ­¥ç»™é™æµç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Slime åˆ›å»ºçš„ CRD &lt;code&gt;SmartLimiter&lt;/code&gt; ç”¨äºé…ç½®è‡ªé€‚åº”é™æµã€‚å…¶çš„é…ç½®æ˜¯æ¥è¿‘è‡ªç„¶è¯­ä¹‰ï¼Œä¾‹å¦‚å¸Œæœ›åœ¨ CPU è¶…è¿‡ 80% æ—¶è§¦å‘æœåŠ¡ A çš„è®¿é—®é™åˆ¶ï¼Œé™é¢ä¸º 30QPSï¼Œå¯¹åº”çš„ SmartLimiter å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;microservice.netease.com/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SmartLimiter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fill_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;quota&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;30/{pod}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 30 ä¸ºè¯¥æœåŠ¡çš„é¢åº¦ï¼Œå°†å…¶å‡åˆ†ç»™æ¯ä¸ª podï¼ŒåŠ å…¥æœ‰ 3 ä¸ª podï¼Œåˆ™æ¯ä¸ª pod çš„é™æµä¸º 10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;condition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{cpu}&amp;gt;0.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ ¹æ®ç›‘æ§é¡¹{cpu}çš„å€¼è‡ªåŠ¨å¡«å……è¯¥æ¨¡æ¿&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ›´å¤š&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;p&gt;Slime å¼€æºäº 2021 å¹´åˆï¼Œæœ¬æ–‡å‘ç¨¿æ—¶è¯¥é¡¹ç›®ä»å¤„äºåˆçº§é˜¶æ®µï¼Œæœ¬æ–‡å¤§é‡å‚è€ƒäº†æ¨ç¬›èˆªåœ¨äº‘åŸç”Ÿç¤¾åŒºä¸­çš„åˆ†äº« &lt;a href=&#34;https://cloudnative.to/blog/netease-slime/&#34; title=&#34;Slimeï¼šè®© Istio æœåŠ¡ç½‘æ ¼å˜å¾—æ›´åŠ é«˜æ•ˆä¸æ™ºèƒ½&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slimeï¼šè®© Istio æœåŠ¡ç½‘æ ¼å˜å¾—æ›´åŠ é«˜æ•ˆä¸æ™ºèƒ½&lt;/a&gt;
 åŠ Slime çš„ &lt;a href=&#34;https://github.com/slime-io/slime&#34; title=&#34;GitHub&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt;
ã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å…³æ³¨ä¸‹è¿™ä¸ªé¡¹ç›®çš„ GitHubï¼Œè¿›ä¸€æ­¥äº†è§£å®ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–æ¬¢è¿å…³æ³¨æœåŠ¡ç½‘æ ¼å’Œ Istio çš„æœ‹å‹åŠ å…¥&lt;a href=&#34;https://cloudnative.to/sig-istio/&#34; title=&#34;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&lt;/a&gt;
ï¼Œä¸€èµ·å‚ä¸è®¨è®ºå’Œäº¤æµã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/netease-slime/&#34; title=&#34;Slimeï¼šè®© Istio æœåŠ¡ç½‘æ ¼å˜å¾—æ›´åŠ é«˜æ•ˆä¸æ™ºèƒ½ - cloudnative.to&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slimeï¼šè®© Istio æœåŠ¡ç½‘æ ¼å˜å¾—æ›´åŠ é«˜æ•ˆä¸æ™ºèƒ½ - cloudnative.to&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/slime-io/slime/blob/master/README_ZH.md&#34; title=&#34;Slime GitHub æ–‡æ¡£ - github.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime GitHub æ–‡æ¡£ - github.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/sidecar/&#34; title=&#34;Sidecar - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼ç°çŠ¶ä¹‹æˆ‘è§</title>
      <link>https://jimmysong.io/blog/service-mesh-insight/</link>
      <pubDate>Tue, 23 Nov 2021 16:43:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/service-mesh-insight/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡æ ¹æ® 2021 å¹´ 11 æœˆ 22 æ—¥æ™šæˆ‘åº”æå®¢é‚¦é‚€è¯·åœ¨ã€Œæå®¢æ—¶é—´è®­ç»ƒè¥ã€çš„ç›´æ’­åˆ†äº«ã€Šäº‘åŸç”Ÿæ¼«è°ˆï¼šèŠèŠ Service Mesh çš„ç°çŠ¶ã€‹æ•´ç†è€Œæˆã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¥æå®¢æ—¶é—´æ˜¯æƒ³é‚€è¯·æˆ‘åˆ†äº«äº‘åŸç”Ÿçš„ï¼Œä½†æˆ‘è§‰å¾—é‚£ä¸ªèŒƒå›´å¤ªå¤§ï¼Œåœ¨ä¸€æ¬¡åˆ†äº«ä¸­åªèƒ½æ³›æ³›è€Œè°ˆï¼Œæ— æ³•èšç„¦åˆ°ä¸€ä¸ªå…·ä½“çš„ç‚¹ï¼Œå› æ­¤æˆ‘æƒ³è¿˜æ˜¯å…ˆèšç„¦åœ¨æœåŠ¡ç½‘æ ¼è¿™ä¸€ä¸ªä¸“é¢˜ä¸Šå§ã€‚äº‘åŸç”Ÿç¤¾åŒºæœ€è¿‘å€’æ˜¯åœ¨åšä¸€ä¸ª&lt;a href=&#34;https://mp.weixin.qq.com/s/FWUkc1HJobhZgb26pG73Cg&#34; title=&#34;äº‘åŸç”Ÿç³»åˆ—çš„åˆ†äº«&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç³»åˆ—çš„åˆ†äº«&lt;/a&gt;
ï¼Œå¤§å®¶å¯ä»¥å…³æ³¨ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ä»Šå¤©åˆ†äº«çš„å¤§çº²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€æ¢è®¨ä¸‹æœåŠ¡ç½‘æ ¼è·Ÿäº‘åŸç”Ÿçš„å…³ç³»&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ˜¯ç»™å¤§å®¶é™ˆè¿°ä¸‹æˆ‘è§‚å¯Ÿåˆ°çš„ç›®å‰ç¤¾åŒºé‡Œå…³äºæœåŠ¡ç½‘æ ¼æœ‰å“ªäº›äº‰è®º&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ˜¯ç»™å¤§å®¶ä»‹ç»å‡ ä¸ªæœåŠ¡ç½‘æ ¼çš„ç›¸å…³çš„å¼€æºé¡¹ç›®&lt;/li&gt;
&lt;li&gt;æœ€åæ˜¯ç•…æƒ³ä¸‹æœåŠ¡ç½‘æ ¼æœªæ¥çš„å‘å±•&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼ä¸äº‘åŸç”Ÿçš„å…³ç³»&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸äº‘åŸç”Ÿçš„å…³ç³»&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å°†æ¢è®¨ä¸‹æœåŠ¡ç½‘æ ¼ä¸äº‘åŸç”Ÿçš„å…³ç³»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼å®¹å™¨ç¼–æ’å¤§æˆ˜åçš„äº§ç‰©&#34;&gt;æœåŠ¡ç½‘æ ¼â€”â€”å®¹å™¨ç¼–æ’å¤§æˆ˜åçš„äº§ç‰©&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp7oq2980j313w0eqq56.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp7oq2980j313w0eqq56.jpg&#34; data-width=&#34;1436&#34; data-height=&#34;530&#34; alt=&#34;image&#34; data-caption=&#34;Docker Swarm vs Kubernetes vs Mesos&#34;&gt;
    
  
  &lt;figcaption&gt;Docker Swarm vs Kubernetes vs Mesos&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å…³æ³¨äº‘åŸç”Ÿé¢†åŸŸè¶³å¤Ÿæ—©çš„è¯ï¼Œåº”è¯¥è¿˜ä¼šå¯¹ 2015 åˆ° 2017 å¹´é—´çš„å®¹å™¨ç¼–æ’å¤§æˆ˜è®°å¿†çŠ¹æ–°ã€‚å…³äºæœåŠ¡ç½‘æ ¼çš„èµ·æºå·²ç»æ— éœ€å¤šè¨€ã€‚2017 å¹´ Kubernetes è·å¾—äº†å®¹å™¨å¤§æˆ˜çš„èƒœåˆ©ï¼Œå¾®æœåŠ¡çš„ç†å¿µå·²ç»æ·±å…¥äººå¿ƒï¼Œå®¹å™¨åŒ–çš„è¶‹åŠ¿å¯è°“åŠ¿ä¸å¯æŒ¡ã€‚Kubernetes æ¶æ„è¶‹å‘æˆç†Ÿï¼Œæ…¢æ…¢å˜å¾—æ— èŠï¼Œä»¥ Linkerdã€Istio ä¸ºä»£è¡¨çš„æœåŠ¡ç½‘æ ¼æŠ€æœ¯è¿›å…¥äº† CNCF å®šä¹‰çš„äº‘åŸç”Ÿå…³é”®æŠ€æœ¯è§†é‡ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å°†å¾®æœåŠ¡ä¸­çš„é€šç”¨çš„åŠŸèƒ½ç»™ä¸‹æ²‰åˆ°äº†åŸºç¡€è®¾æ–½å±‚ï¼Œè®©å¼€å‘è€…å¯ä»¥æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œä»è€ŒåŠ å¿«æœåŠ¡äº¤ä»˜ï¼Œè¿™ä¸æ•´ä¸ªäº‘åŸç”Ÿçš„ç†å¿µçš„ä¸€è‡´çš„ã€‚ä½ ä¸éœ€è¦å†åœ¨åº”ç”¨ä¸­é›†æˆç¬¨é‡çš„ SDKï¼Œä¸ºä¸åŒè¯­è¨€å¼€å‘å’Œç»´æŠ¤ SDKï¼Œåº”ç”¨éƒ¨ç½²å®Œåï¼Œä½¿ç”¨æœåŠ¡ç½‘æ ¼è¿›è¡Œ Day 2 æ“ä½œå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes è®¾è®¡ä¹‹åˆå°±æ˜¯æŒ‰ç…§äº‘åŸç”Ÿçš„ç†å¿µè®¾è®¡çš„ï¼Œäº‘åŸç”Ÿä¸­æœ‰ä¸ªé‡è¦æ¦‚å¿µå°±æ˜¯å¾®æœåŠ¡çš„æ¶æ„è®¾è®¡ï¼Œå½“å°†å•ä½“åº”ç”¨æ‹†åˆ†å¾®æœåŠ¡åï¼Œéšç€æœåŠ¡æ•°é‡çš„å¢å¤šï¼Œå¦‚ä½•å¾®æœåŠ¡è¿›è¡Œç®¡ç†ä»¥ä¿è¯æœåŠ¡çš„ SLA å‘¢ï¼Ÿä¸ºäº†ä»æ¶æ„å±‚é¢ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè§£æ”¾ç¨‹åºå‘˜çš„åˆ›é€ æ€§ï¼Œé¿å…ç¹ççš„æœåŠ¡å‘ç°ã€ç›‘æ§ã€åˆ†å¸ƒå¼è¿½è¸ªç­‰äº‹åŠ¡ï¼ŒæœåŠ¡ç½‘æ ¼åº”è¿è€Œç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp7qas2vtj30v70u0whb.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp7qas2vtj30v70u0whb.jpg&#34; data-width=&#34;1123&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;å¾®æœåŠ¡å…³æ³¨ç‚¹&#34;&gt;
    
  
  &lt;figcaption&gt;å¾®æœåŠ¡å…³æ³¨ç‚¹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥æºï¼š&lt;em&gt;&lt;a href=&#34;https://developers.redhat.com/blog/2016/12/09/spring-cloud-for-microservices-compared-to-kubernetes&#34; title=&#34;https://developers.redhat.com/blog/2016/12/09/spring-cloud-for-microservices-compared-to-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developers.redhat.com/blog/2016/12/09/spring-cloud-for-microservices-compared-to-kubernetes&lt;/a&gt;
&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼è¢«èª‰ä¸ºä¸‹ä¸€ä»£å¾®æœåŠ¡ï¼Œä»å³é¢è¿™å¹…å›¾é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾®æœåŠ¡çš„ä¸€äº›å…³æ³¨ç‚¹ï¼Œè¿™äº›å…³æ³¨ç‚¹å¾ˆå¤šä¸ Kubernetes çš„åŠŸèƒ½æ˜¯é‡åˆçš„ï¼Œæ—¢ç„¶è¿™äº›ä½œä¸ºå¹³å°çº§çš„åŠŸèƒ½ Kubernetes å·²ç»æä¾›äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨æœåŠ¡ç½‘æ ¼å‘¢ï¼Ÿå…¶å® Kubernetes å…³æ³¨çš„è¿˜æ˜¯åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒç®¡ç†çš„å¯¹è±¡æ˜¯èµ„æºå’Œéƒ¨ç½²ï¼Œå¯¹äºæœåŠ¡çš„ç®¡æ§åŠ›åº¦å¾ˆå°ã€‚è€ŒæœåŠ¡ç½‘æ ¼æ­£å¥½å¼¥è¡¥äº†è¿™ä¸ªç¼ºé™·ã€‚æœåŠ¡ç½‘æ ¼å¯ä»¥è¿æ¥ã€æ§åˆ¶ã€è§‚å¯Ÿå’Œä¿æŠ¤å¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-vs-xds-vs-istio&#34;&gt;Kubernetes vs xDS vs Istio&lt;/h3&gt;
&lt;p&gt;è¿™å¹…å›¾å±•ç¤ºçš„æ˜¯ Kubernetes å’Œ Istio çš„åˆ†å±‚æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gxdhnnh4lxj31820p0gps.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gxdhnnh4lxj31820p0gps.jpg&#34; data-width=&#34;1586&#34; data-height=&#34;900&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes vs Service mesh&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes vs Service mesh&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° kube-proxy çš„è®¾ç½®æ˜¯å…¨å±€çš„ï¼Œæ— æ³•å¯¹æ¯ä¸ªæœåŠ¡è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ï¼ŒKubernetes å¯ä»¥åšçš„åªæœ‰æ‹“æ‰‘æ„ŸçŸ¥è·¯ç”±ã€å°†æµé‡å°±è¿‘è·¯ç”±ï¼Œä¸º Pod è®¾ç½®è¿›å‡ºç«™çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;è€ŒæœåŠ¡ç½‘æ ¼é€šè¿‡ sidecar proxy çš„æ–¹å¼å°† Kubernetes ä¸­çš„æµé‡æ§åˆ¶ä»æœåŠ¡å±‚ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œä¸ºæ¯ä¸ª Pod ä¸­æ³¨å…¥ä»£ç†ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæ§åˆ¶å¹³é¢æ¥æ“æ§è¿™äº›åˆ†å¸ƒå¼ä»£ç†ã€‚è¿™æ ·å¯ä»¥å®ç°æ›´å¤§çš„å¼¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Kube-proxy å®ç°äº†ä¸€ä¸ª Kubernetes æœåŠ¡çš„å¤šä¸ª pod å®ä¾‹ä¹‹é—´çš„æµé‡è´Ÿè½½å‡è¡¡ï¼Œä½†å¦‚ä½•å¯¹è¿™äº›æœåŠ¡ä¹‹é—´çš„æµé‡è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶â€“æ¯”å¦‚å°†æµé‡æŒ‰ç™¾åˆ†æ¯”åˆ’åˆ†ç»™ä¸åŒçš„åº”ç”¨ç‰ˆæœ¬ï¼ˆè¿™äº›åº”ç”¨ç‰ˆæœ¬éƒ½æ˜¯åŒä¸€ä¸ªæœåŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†åœ¨ä¸åŒçš„éƒ¨ç½²ä¸Šï¼‰ï¼Œæˆ–è€…åšé‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰å’Œè“ç»¿å‘å¸ƒï¼Ÿ&lt;/p&gt;
&lt;p&gt;Kubernetes ç¤¾åŒºç»™å‡ºäº†ä¸€ä¸ªä½¿ç”¨ Deployment åšé‡‘ä¸é›€å‘å¸ƒçš„æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¿®æ”¹ pod çš„æ ‡ç­¾æ¥ç»™éƒ¨ç½²çš„æœåŠ¡åˆ†é…ä¸åŒçš„ podã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/envoy-arch.jpg&#34; data-img=&#34;/blog/service-mesh-insight/envoy-arch.jpg&#34; data-width=&#34;1492&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Envoy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›®å‰åœ¨ä¸­å›½æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºå®ç°æ˜¯ Istioï¼Œä¹Ÿæœ‰å¾ˆå¤šå…¬å¸å¯¹ Istio è¿›è¡Œäº†äºŒæ¬¡å¼€å‘ï¼Œæ¯”å¦‚èš‚èšã€ç½‘æ˜“ã€è…¾è®¯ç­‰ï¼Œå…¶å® Istio æ˜¯åœ¨ Envoy çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œä»å®ƒå¼€æºçš„ç¬¬ä¸€å¤©èµ·å°±é»˜è®¤ä½¿ç”¨äº† Envoy ä½œä¸ºå®ƒçš„åˆ†å¸ƒå¼ä»£ç†ã€‚Envoy å¼€åˆ›æ€§çš„åˆ›é€ äº† xDS åè®®ï¼Œç”¨äºåˆ†å¸ƒå¼ç½‘å…³é…ç½®ï¼Œå¤§å¤§ç®€åŒ–äº†å¤§è§„æ¨¡åˆ†å¸ƒå¼ç½‘ç»œçš„é…ç½®ã€‚2019 å¹´èš‚èšå¼€æºçš„ MOSN åŒæ ·æ”¯æŒäº† xDSã€‚Envoy è¿˜æ˜¯ CNCF ä¸­æœ€æ—©æ¯•ä¸šçš„é¡¹ç›®ä¹‹ä¸€ï¼Œç»è¿‡å¤§è§„æ¨¡çš„ç”Ÿäº§åº”ç”¨è€ƒéªŒã€‚å¯ä»¥è¯´ Istio çš„è¯ç”Ÿå·²ç»æœ‰äº†å¾ˆå¥½çš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è¡¨æ˜¯ Kubernetesã€xDSã€Istio ä¸‰è€…ä¹‹é—´çš„èµ„æºæŠ½è±¡å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;xDS&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Istio æœåŠ¡ç½‘æ ¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;WorkloadEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;VirtualService&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;DestinationRule&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;EnvoyFilter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ingress&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;Gateway&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Cluster&lt;/td&gt;
&lt;td&gt;ServiceEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;kube-proxy ç»„ä»¶ã€xDS å’Œ Istio å¯¹æµé‡ç®¡ç†çš„æŠ½è±¡åï¼Œç°åœ¨æˆ‘ä»¬ä»…ä»æµé‡ç®¡ç†çš„è§’åº¦æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªç»„ä»¶ / åè®®çš„æ¯”è¾ƒã€‚è¯·æ³¨æ„ï¼Œä¸‰è€…å¹¶ä¸å®Œå…¨ç­‰åŒã€‚Kubernetes æ›´åŠ æ³¨é‡çš„æ˜¯åº”ç”¨å±‚é¢çš„æµé‡ç®¡ç†ï¼ŒxDS æ˜¯æ›´åŠ æŠ½è±¡çš„åè®®å±‚é¢çš„é…ç½®ä¸‹å‘ï¼Œè€Œ Istio æ˜¯æœåŠ¡å±‚é¢çš„é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼äº‘åŸç”Ÿç½‘ç»œåŸºç¡€è®¾æ–½&#34;&gt;æœåŠ¡ç½‘æ ¼â€”â€”äº‘åŸç”Ÿç½‘ç»œåŸºç¡€è®¾æ–½&lt;/h3&gt;
&lt;p&gt;åœ¨åˆ—ä¸¾è¿‡ä»¥ä¸Š Kubernetes å’ŒæœåŠ¡ç½‘æ ¼çš„å¯¹æ¯”åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæœåŠ¡ç½‘æ ¼åœ¨äº‘åŸç”Ÿåº”ç”¨æ¶æ„ä¸­çš„åœ°ä½ã€‚é‚£å°±æ˜¯æ„å»ºä¸€ä¸ªäº‘åŸç”Ÿç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼šæ§åˆ¶æœåŠ¡é—´çš„æµé‡å’Œ API è°ƒç”¨æµï¼Œä½¿è°ƒç”¨æ›´å¯é ï¼Œå¢å¼ºä¸åŒç¯å¢ƒä¸‹çš„ç½‘ç»œé²æ£’æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§ï¼šäº†è§£æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œå®ƒä»¬ä¹‹é—´çš„æ€§è´¨å’Œæµé‡ï¼Œæä¾›å¿«é€Ÿè¯†åˆ«å®šä½é—®é¢˜çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;ç­–ç•¥å®æ–½ï¼šé€šè¿‡é…ç½®ç½‘æ ¼è€Œä¸æ˜¯ä»¥æ”¹å˜ä»£ç çš„æ–¹å¼æ¥æ§åˆ¶æœåŠ¡ä¹‹é—´çš„è®¿é—®ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡è¯†åˆ«ä¸å®‰å…¨ï¼šæä¾›åœ¨ç½‘æ ¼é‡Œçš„æœåŠ¡å¯è¯†åˆ«æ€§å’Œå®‰å…¨æ€§ä¿æŠ¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¤¾åŒºé‡Œå…³äº-istio-å’ŒæœåŠ¡ç½‘æ ¼çš„äº‰è®º&#34;&gt;ç¤¾åŒºé‡Œå…³äº Istio å’ŒæœåŠ¡ç½‘æ ¼çš„äº‰è®º&lt;/h2&gt;
&lt;p&gt;ç„¶è€Œæ„å»ºåŸºç¡€è®¾æ–½ï¼Œå¯è°“ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚ç†æƒ³å¾ˆä¸°æ»¡ï¼Œç°å®å¾ˆéª¨æ„Ÿã€‚å…³äºæœåŠ¡ç½‘æ ¼å’Œ Istioï¼Œåœ¨ç¤¾åŒºä¸­ä¹Ÿä¸ä¹äº‰è®ºã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰è¿™äº›äº‰è®ºä¸»è¦æœ‰å“ªäº›ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåˆ—ä¸¾äº†æˆ‘åœ¨ç¤¾åŒºä¸­è§‚å¯Ÿåˆ°çš„å…³äº Istio å’ŒæœåŠ¡ç½‘æ ¼æœ€å¸¸è§çš„å‡ ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰äººåœ¨ç”Ÿäº§ä½¿ç”¨ Istio å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸º pod æ³¨å…¥ sidecar åå¸¦æ¥çš„å¤§é‡èµ„æºæ¶ˆè€—ï¼Œå½±å“åº”ç”¨æ€§èƒ½ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Istio æ”¯æŒçš„åè®®æœ‰é™ï¼Œä¸æ˜“æ‰©å±•ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Istio å¤ªè¿‡å¤æ‚ï¼Œè€çš„æœåŠ¡è¿ç§»æˆæœ¬å¤ªé«˜ï¼Œä¸šç•Œç»éªŒå¤ªå°‘ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯å¾ˆå¤šäººåˆšåŠ å…¥ç¤¾åŒºå’Œäº†è§£è¿™é—¨æŠ€æœ¯çš„æ—¶å€™ï¼Œé—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œé‚£æ˜¯æœ‰äººåœ¨ç”Ÿäº§ä½¿ç”¨ Istio å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;éšç€å¯¹ Istio ç ”ç©¶çš„æ·±å…¥ï¼Œå¾ˆå¤šäººå°±ä¼šæŠ›å‡ºç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸º pod æ³¨å…¥ sidecar åå¸¦æ¥çš„å¤§é‡èµ„æºæ¶ˆè€—ï¼Œä¼šå½±å“åº”ç”¨æ€§èƒ½å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœèƒ½é—®åˆ°ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œè¯´æ˜å¯¹ Istio æœ‰æ¯”è¾ƒå¼ºçš„éœ€æ±‚äº†ï¼Œå¤§å¤šæ˜¯ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ RPCï¼Œå¯¹ Istio çš„åè®®æ‰©å±•æœ‰éœ€æ±‚ã€‚
æœ€åä¸€ä¸ªé—®é¢˜æ˜¯æŠ±æ€¨ Istio çš„æ¦‚å¿µå¤ªè¿‡å¤æ‚ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„è¿ç§»è·¯å¾„å¯ä»¥ä½¿ç”¨ï¼Œå­¦ä¹ æ›²çº¿å¤ªè¿‡é™¡å³­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å°†ä¸€ä¸€å›ç­”è¿™äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-æ¶æ„ç¨³å®šç”Ÿäº§å¯ç”¨ç”Ÿæ€æ¸èµ·&#34;&gt;Istio æ¶æ„ç¨³å®šï¼Œç”Ÿäº§å¯ç”¨ï¼Œç”Ÿæ€æ¸èµ·&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp7wvt1g8j32yo0nk78g.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp7wvt1g8j32yo0nk78g.jpg&#34; data-width=&#34;3840&#34; data-height=&#34;848&#34; alt=&#34;image&#34; data-caption=&#34;Istio å‘å¸ƒæ—¶é—´è¡¨&#34;&gt;
    
  
  &lt;figcaption&gt;Istio å‘å¸ƒæ—¶é—´è¡¨&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ Istio çš„å‘å¸ƒæ—¶é—´è¡¨ï¼Œ1.12 ç‰ˆæœ¬åœ¨ä¸Šå‘¨åˆšåˆšå‘å¸ƒï¼Œè¿™é‡Œåˆ—ä¸¾äº†ä»å®ƒå¼€æºåˆ° 1.8 ç‰ˆæœ¬å‘å¸ƒçš„æ—¶é—´è¡¨ã€‚2018 å¹´å¯ä»¥è¯´æ˜¯æœåŠ¡ç½‘æ ¼çˆ†å‘ä¹‹å¹´ï¼ŒTetrate ä¹Ÿåœ¨è¿™ä¸€å¹´æˆç«‹ã€‚è‡ª 1.5 ç‰ˆæœ¬èµ· Istio æ­£å¼ç¡®ç«‹äº†å½“å‰çš„æ¶æ„ã€‚Istio ç¤¾åŒºä¹Ÿä¹Ÿä¸¾åŠäº†ä¸°å¯Œå¤šå½©çš„æ´»åŠ¨ï¼Œ2021 å¹´ 3 æœˆé¦–å±Š IstioCon å¬å¼€ï¼Œ7 æœˆ Istio Meetup China åœ¨åŒ—äº¬ä¸¾è¡Œï¼Œ2022 å¹´ 1 æœˆï¼ŒService Mesh Summit 2022 ä¹Ÿå°†åœ¨ä¸Šæµ·ä¸¾è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Istio æœ‰ç€åºå¤§çš„ç¤¾åŒºä»¥åŠ&lt;a href=&#34;https://istio.io/latest/about/case-studies/&#34; title=&#34;ä¾›åº”å•†å’Œç”¨æˆ·ç¾¤ä½“&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¾›åº”å•†å’Œç”¨æˆ·ç¾¤ä½“&lt;/a&gt;
ã€‚ç›®å‰ä¸»æµå…¬æœ‰äº‘å…¨éƒ½æ”¯æŒäº† Istio æœåŠ¡ç½‘æ ¼ï¼Œå¦‚é˜¿é‡Œäº‘ã€åä¸ºäº‘ã€è…¾è®¯äº‘ã€ç½‘æ˜“äº‘ç­‰ï¼ŒIstio çš„å®˜ç½‘ä¸Šä¹Ÿåˆ—ä¸¾äº†å‡ åä¸ªç¤¾åŒºç”¨æˆ·ï¼Œäº‘åŸç”Ÿç¤¾åŒº Istio SIG è¿˜é™†ç»­ä¸¾åŠäº†å…«åœº &lt;a href=&#34;https://cloudnative.to/sig-istio/big-talk/overview.html&#34; title=&#34;Istio å¤§å’–è¯´&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å¤§å’–è¯´&lt;/a&gt;
ï¼Œç™¾åº¦ã€è…¾è®¯ã€ç½‘æ˜“ã€å°çº¢ä¹¦ã€å°ç”µç§‘æŠ€éƒ½æ¥åˆ†äº«è¿‡ä»–ä»¬çš„ Istio å®è·µã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å¾ˆå¤šä¼ä¸šåŸºäº Istio åšäº†äºŒæ¬¡å¼€å‘æˆ–è€…é€‚é…æˆ–è€…ä¸ºå…¶å¼€å‘æ’ä»¶ï¼Œå¯ä»¥è¯´æ˜¯ Istio æ¶æ„å·²ç¨³å®šï¼Œç”Ÿäº§å¯ç”¨ï¼Œç”Ÿæ€æ­£åœ¨èŒèŠ½ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“&#34;&gt;æœåŠ¡ç½‘æ ¼å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼ä¸ºäº†åšåˆ°å¯¹åº”ç”¨ç¨‹åºé€æ˜ï¼Œé»˜è®¤é‡‡ç”¨äº† iptables æµé‡åŠ«æŒçš„æ–¹å¼ï¼Œå½“æœåŠ¡æ•°é‡å¤§çš„æ—¶å€™ä¼šæœ‰å¤§é‡çš„ iptables è§„åˆ™ï¼Œå½±å“ç½‘ç»œæ€§èƒ½ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://cloudnative.to/blog/how-ebpf-streamlines-the-service-mesh/&#34; title=&#34;eBPF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF&lt;/a&gt;
 è¿™æ ·çš„æŠ€æœ¯æ¥æé«˜åº”ç”¨æ€§èƒ½ï¼Œä½†æ˜¯è¯¥æŠ€æœ¯å¯¹æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç‰ˆæœ¬è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¾ˆå°‘æœ‰ä¼ä¸šèƒ½å¤Ÿè¾¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp81fy0vqj31lq0nq41q.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp81fy0vqj31lq0nq41q.jpg&#34; data-width=&#34;2078&#34; data-height=&#34;854&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­çš„æ™ºèƒ½ DNS ä»£ç†&#34;&gt;
    
  
  &lt;figcaption&gt;Istio ä¸­çš„æ™ºèƒ½ DNS ä»£ç†&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥æºï¼š&lt;a href=&#34;https://cloudnative.to/blog/istio-dns-proxy/&#34; title=&#34;https://cloudnative.to/blog/istio-dns-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cloudnative.to/blog/istio-dns-proxy/&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯&lt;a href=&#34;https://cloudnative.to/sig-istio/big-talk/ep08.html&#34; title=&#34;å°çº¢ä¹¦ä½¿ç”¨çš„æ–¹å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°çº¢ä¹¦ä½¿ç”¨çš„æ–¹å¼&lt;/a&gt;
ï¼Œé‚£å°±æ˜¯åˆ©ç”¨ Istio 1.8 ä¸­å¼•å…¥çš„æ™ºèƒ½ DNS ä»£ç†åŠŸèƒ½ã€‚é¦–å…ˆä½¿ç”¨ ServiceEntry å®šä¹‰æœåŠ¡ï¼Œè®©æ‰€æœ‰æœåŠ¡å±äºä¸€ä¸ª VIP èŒƒå›´ï¼Œå†åˆ©ç”¨ Istio çš„æ™ºèƒ½ DNS ä»£ç†åŠŸèƒ½ï¼Œè®© sidecar åªæ‹¦æˆª VIP ç½‘æ®µçš„æµé‡ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ iptables è§„åˆ™ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚å¦‚æœæƒ³æ·±å…¥äº†è§£è¿™ä¸ªåšæ³•çš„ç»†èŠ‚ï¼Œå¤§å®¶å¯ä»¥å»æµè§ˆ &lt;a href=&#34;https://www.bilibili.com/video/BV12b4y187ae/&#34; title=&#34;Istio å¤§å’–è¯´ç¬¬å…«æœŸçš„åˆ†äº«è§†é¢‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å¤§å’–è¯´ç¬¬å…«æœŸçš„åˆ†äº«è§†é¢‘&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;Istio åœ¨åˆæœŸæ˜¯å°†æ•´ä¸ªç½‘æ ¼å†…çš„æ‰€æœ‰æœåŠ¡çš„è·¯ç”±ä¿¡æ¯å…¨é‡ä¸‹å‘åˆ°æ‰€æœ‰çš„ proxy sidecar ä¸­ï¼Œä¼šå¯¼è‡´ sidecar å ç”¨å¤§é‡èµ„æºï¼Œåæ¥ Istio å¼•å…¥äº† &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/sidecar/&#34; title=&#34;Sidecar èµ„æº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar èµ„æº&lt;/a&gt;
æ¥ç²¾ç»†åŒ–æ§åˆ¶éœ€è¦ä¸‹å‘çš„ä»£ç†é…ç½®èŒƒå›´ï¼Œå¦å¤–è¿˜æœ‰ä¼ä¸šè‡ªå·±å¼€å‘äº†é…ç½®æ‡’åŠ è½½åŠŸèƒ½ï¼Œä¾‹å¦‚è…¾è®¯äº‘å¼€æºçš„ &lt;a href=&#34;https://github.com/aeraki-framework/aeraki&#34; title=&#34;Aeraki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki&lt;/a&gt;
ã€ç½‘æ˜“å¼€æºçš„ &lt;a href=&#34;https://github.com/slime-io/slime&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt;
 éƒ½å¯ä»¥å®ç°é…ç½®æ‡’åŠ è½½ã€‚æˆ‘ä»¬ä¼šåœ¨ Istio å¼€æºç”Ÿæ€ä¸­ä»‹ç»è¿™ä¸¤ä¸ªå¼€æºé¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæ˜¯ä¸€ä¸ªæ¶‰åŠåˆ° Sidecar proxy è¿ç»´çš„é—®é¢˜ï¼Œå¦‚ä½•åœ¨ä¿è¯æµé‡ä¸æ–­çš„æƒ…å†µä¸‹ï¼Œå‡çº§æ‰€æœ‰ Envoy ä»£ç†ï¼Œè¿™ä¸ªé˜¿é‡Œå¼€æºçš„ &lt;a href=&#34;https://github.com/openkruise/kruise&#34; title=&#34;OpenKruise&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenKruise&lt;/a&gt;
 ä¸­çš„ &lt;a href=&#34;https://xie.infoq.cn/article/23ae6d3f0d0260b4797a708a0&#34; title=&#34;SidecarSet&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SidecarSet&lt;/a&gt;
 èµ„æºå·²ç»ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤– Sidecar çš„å¼•å…¥å¸¦æ¥çš„èµ„æºæ¶ˆè€—ä»¥åŠç½‘ç»œå»¶è¿Ÿä¹Ÿæ˜¯åœ¨åˆç†çš„èŒƒå›´å†…ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ Istio å®˜æ–¹åšå®¢ä¸Šçš„ &lt;a href=&#34;https://istio.io/latest/zh/blog/2019/performance-best-practices/&#34; title=&#34;Service Mesh åŸºå‡†æ€§èƒ½æµ‹è¯•&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh åŸºå‡†æ€§èƒ½æµ‹è¯•&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ‰©å±•-istio-æœåŠ¡ç½‘æ ¼&#34;&gt;æ‰©å±• Istio æœåŠ¡ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯å…³äºæ‰©å±• Istio æœåŠ¡ç½‘æ ¼çš„ã€‚ç›®å‰å®˜æ–¹ç¤¾åŒºç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ WebAssemblyï¼Œç›®å‰è¿™ç§æ‰©å±•æ–¹å¼åœ¨å›½å†…ç”¨çš„è¿˜æ¯”è¾ƒå°‘ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå ªå¿§ã€‚æˆ‘è§‚å¯Ÿåˆ°çš„å¤§éƒ¨åˆ†è§£å†³æ–¹æ¡ˆéƒ½æ˜¯è‡ªå®šä¹‰ CRDï¼ŒåŸºäº Istio æ„å»ºæœåŠ¡ç½‘æ ¼ç®¡ç†å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œè®© Istio æ”¯æŒå¼‚æ„ç¯å¢ƒï¼Œé€‚ç”¨äºä¸€åˆ‡å·¥ä½œè´Ÿè½½ï¼Œå¦‚è™šæ‹Ÿæœºã€å®¹å™¨ï¼Œè¿™ä¸ªå¯¹äºç»ˆç«¯ç”¨æˆ·æ¥è¯´ä¹Ÿæœ‰å¾ˆå¼ºçš„éœ€æ±‚ï¼Œå› ä¸ºè¿™å¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„ä»ä¼ ç»Ÿè´Ÿè½½è¿ç§»åº”ç”¨åˆ°æœåŠ¡ç½‘æ ¼ä¸­ã€‚æœ€åæ˜¯å¤šé›†ç¾¤ã€å¤šç½‘æ ¼çš„æ··åˆäº‘æµé‡ç®¡ç†ï¼Œè¿™ä¸ªå±äºæ¯”è¾ƒé«˜é˜¶çš„éœ€æ±‚äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é™¡å³­çš„å­¦ä¹ æ›²çº¿&#34;&gt;é™¡å³­çš„å­¦ä¹ æ›²çº¿&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹åˆ—ä¸¾çš„æ˜¯ Istio å­¦ä¹ èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/&#34; title=&#34;Istio å®˜ç½‘ä¸­æ–‡æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘ä¸­æ–‡æ–‡æ¡£&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://events.istio.io/istiocon-2021/&#34; title=&#34;IstioCon 2021&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon 2021&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;Istio Meetup China&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/tetratelabs/istio-weekly&#34; title=&#34;Istio å¤§å’–è¯´/Istio Weekly&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å¤§å’–è¯´/Istio Weekly&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/sig-istio/&#34; title=&#34;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://academy.tetrate.io/courses/istio-fundamentals-zh&#34; title=&#34;Istio åŸºç¡€æ•™ç¨‹ï¼ˆä¸­æ–‡ï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŸºç¡€æ•™ç¨‹ï¼ˆä¸­æ–‡ï¼‰&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://academy.tetrate.io/courses/certified-istio-administrator&#34; title=&#34;Certified Istio Administrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Certified Istio Administrator&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å¼€æºè‡³ä»Šå·²æœ‰ 4 å¹´æ—¶é—´ï¼Œ2018 å¹´æ—¶æˆ‘å’Œæ•–å°å‰‘ä¸€èµ·åˆ›å»ºäº† ServiceMesher ç¤¾åŒºï¼Œå½“æ—¶ç»„ç»‡è¿‡ 9 æ¬¡ Service Mesh Meetupï¼ŒåŒå…¶ä»–æœåŠ¡ç½‘æ ¼çˆ±å¥½è€…ä¸€èµ·ç¿»è¯‘äº† Istio çš„å®˜æ–¹æ–‡æ¡£ã€‚æˆ‘è¿˜åœ¨ä»Šå¹´åˆå‚ä¸äº† IstioCon 2021 çš„ç­¹åŠåŠé¦–å±Š Istio Meetup Chinaã€‚å¯ä»¥è¯´æ˜¯äº²çœ¼ç›®ç¹äº†å›½å†…æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„åº”ç”¨å’Œå‘å±•ï¼Œåœ¨è¿™æœŸé—´ä¹Ÿå†™è¿‡å’Œç¿»è¯‘è¿‡å¤§é‡çš„æ–‡ç« ï¼ŒåŠ å…¥ Tetrate åï¼Œæˆ‘è¿˜å‚ä¸å‘å¸ƒäº† Istio åŸºç¡€æ•™ç¨‹ï¼Œå…è´¹æä¾›ç»™å¤§å®¶å­¦ä¹ ã€‚åŒæ—¶ Tetrate ä¹Ÿæ¨å‡ºäº†è®¤è¯ Istio ç®¡ç†å‘˜è€ƒè¯•ï¼Œç”¨äºåŸ¹å…»æ›´å¤šè¡Œä¸šäººæ‰ã€‚&lt;/p&gt;
&lt;p&gt;äº‘åŸç”Ÿç¤¾åŒºç»„ç»‡äº† Istio SIGï¼Œè¿˜æ¨å‡ºäº† Istio å¤§å’–è¯´ç›´æ’­æ ç›®ï¼Œä¸ºå¤§å®¶åˆ†äº« Istio æœåŠ¡ç½‘æ ¼å®è·µç»éªŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ &lt;a href=&#34;https://academy.tetrate.io/courses/istio-fundamentals-zh&#34; title=&#34;Istio åŸºç¡€æ•™ç¨‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŸºç¡€æ•™ç¨‹&lt;/a&gt;
çš„é¦–é¡µæˆªå›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp8rr51ikj31ah0u043i.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp8rr51ikj31ah0u043i.jpg&#34; data-width=&#34;1673&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Istio åŸºç¡€æ•™ç¨‹ï¼ˆTetrate å‡ºå“ï¼‰&#34;&gt;
    
  
  &lt;figcaption&gt;Istio åŸºç¡€æ•™ç¨‹ï¼ˆTetrate å‡ºå“ï¼‰&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ˜¯åˆšå¼€å§‹æ¥è§¦æœåŠ¡ç½‘æ ¼å’Œ Istioï¼Œå¯ä»¥å…ˆä» Istio åŸºç¡€æ•™ç¨‹å¼€å§‹å­¦èµ·ã€‚è¿™ä¸ªçº¿ä¸Šç³»åˆ—è¯¾ç¨‹æ˜¯å›¾æ–‡å¹¶èŒ‚çš„ä¸­æ–‡è¯¾ç¨‹ï¼Œå¯ä»¥å…è´¹å‚åŠ ã€‚&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸‹æœåŠ¡ç½‘æ ¼çš„ç¤¾åŒºé¡¹ç›®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å¼€æºç”Ÿæ€&#34;&gt;Istio å¼€æºç”Ÿæ€&lt;/h2&gt;
&lt;p&gt;ä¸‹è¡¨ä¸­ç½—åˆ—çš„æ˜¯åŸºäº Istio çš„å¼€æºé¡¹ç›®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é¡¹ç›®åç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¼€æºæ—¶é—´&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç±»åˆ«&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸»å¯¼å…¬å¸&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Star æ•°é‡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸ Istio çš„å…³ç³»&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/envoyproxy/envoy&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2016 å¹´ 9 æœˆ&lt;/td&gt;
&lt;td&gt;ç½‘ç»œä»£ç†&lt;/td&gt;
&lt;td&gt;äº‘åŸç”Ÿé«˜æ€§èƒ½è¾¹ç¼˜/ä¸­é—´æœåŠ¡ä»£ç†&lt;/td&gt;
&lt;td&gt;Lyft&lt;/td&gt;
&lt;td&gt;18300&lt;/td&gt;
&lt;td&gt;é»˜è®¤çš„æ•°æ®å¹³é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/istio/istio/&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2017 å¹´ 5 æœˆ&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç½‘æ ¼&lt;/td&gt;
&lt;td&gt;è¿æ¥ã€ä¿æŠ¤ã€æ§åˆ¶å’Œè§‚å¯ŸæœåŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;Google&lt;/td&gt;
&lt;td&gt;28400&lt;/td&gt;
&lt;td&gt;æ§åˆ¶å¹³é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/emissary-ingress/emissary&#34; title=&#34;Emissary Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Emissary Gateway&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2018 å¹´ 2 æœˆ&lt;/td&gt;
&lt;td&gt;ç½‘å…³&lt;/td&gt;
&lt;td&gt;ç”¨äºå¾®æœåŠ¡çš„ Kubernetes åŸç”Ÿ API ç½‘å…³ï¼ŒåŸºäº Envoy æ„å»º&lt;/td&gt;
&lt;td&gt;Ambassador&lt;/td&gt;
&lt;td&gt;3500&lt;/td&gt;
&lt;td&gt;å¯è¿æ¥ Istio&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/apache/apisix&#34; title=&#34;APISIX&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;APISIX&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2019 å¹´ 6 æœˆ&lt;/td&gt;
&lt;td&gt;ç½‘å…³&lt;/td&gt;
&lt;td&gt;äº‘åŸç”Ÿ API ç½‘å…³&lt;/td&gt;
&lt;td&gt;API7&lt;/td&gt;
&lt;td&gt;7400&lt;/td&gt;
&lt;td&gt;å¯ä½œä¸º Istio çš„æ•°æ®å¹³é¢è¿è¡Œä¹Ÿå¯ä»¥å•ç‹¬ä½œä¸ºç½‘å…³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/mosn/mosn&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2019 å¹´ 12 æœˆ&lt;/td&gt;
&lt;td&gt;ä»£ç†&lt;/td&gt;
&lt;td&gt;äº‘åŸç”Ÿè¾¹ç¼˜ç½‘å…³åŠä»£ç†&lt;/td&gt;
&lt;td&gt;èš‚èš&lt;/td&gt;
&lt;td&gt;3400&lt;/td&gt;
&lt;td&gt;å¯ä½œä¸º Istio æ•°æ®å¹³é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/slime-io/slime&#34; title=&#34;Slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2021 å¹´ 1 æœˆ&lt;/td&gt;
&lt;td&gt;æ‰©å±•&lt;/td&gt;
&lt;td&gt;åŸºäº Istio çš„æ™ºèƒ½æœåŠ¡ç½‘æ ¼ç®¡ç†å™¨&lt;/td&gt;
&lt;td&gt;ç½‘æ˜“&lt;/td&gt;
&lt;td&gt;204&lt;/td&gt;
&lt;td&gt;ä¸º Istio å¢åŠ ä¸€ä¸ªç®¡ç†å¹³é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/tetratelabs/getmesh&#34; title=&#34;GetMesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GetMesh&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2021 å¹´ 2 æœˆ&lt;/td&gt;
&lt;td&gt;å·¥å…·&lt;/td&gt;
&lt;td&gt;Istio é›†æˆå’Œå‘½ä»¤è¡Œç®¡ç†å·¥å…·&lt;/td&gt;
&lt;td&gt;Tetrate&lt;/td&gt;
&lt;td&gt;91&lt;/td&gt;
&lt;td&gt;å®ç”¨å·¥å…·ï¼Œå¯ç”¨äº Istio å¤šç‰ˆæœ¬ç®¡ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/aeraki-framework/aeraki&#34; title=&#34;Aeraki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2021 å¹´ 3 æœˆ&lt;/td&gt;
&lt;td&gt;æ‰©å±•&lt;/td&gt;
&lt;td&gt;ç®¡ç† Istio çš„ä»»ä½•ä¸ƒå±‚è´Ÿè½½&lt;/td&gt;
&lt;td&gt;è…¾è®¯&lt;/td&gt;
&lt;td&gt;280&lt;/td&gt;
&lt;td&gt;æ‰©å±•å¤šåè®®æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/mosn/layotto/&#34; title=&#34;Layotto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Layotto&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2021 å¹´ 6 æœˆ&lt;/td&gt;
&lt;td&gt;è¿è¡Œæ—¶&lt;/td&gt;
&lt;td&gt;äº‘åŸç”Ÿåº”ç”¨è¿è¡Œæ—¶&lt;/td&gt;
&lt;td&gt;èš‚èš&lt;/td&gt;
&lt;td&gt;325&lt;/td&gt;
&lt;td&gt;å¯ä»¥ä½œä¸º Istio çš„æ•°æ®å¹³é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/hango-io/hango-gateway&#34; title=&#34;Hango Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hango Gateway&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;2021 å¹´ 8 æœˆ&lt;/td&gt;
&lt;td&gt;ç½‘å…³&lt;/td&gt;
&lt;td&gt;åŸºäº Envoy å’Œ Istio æ„å»ºçš„ API ç½‘å…³&lt;/td&gt;
&lt;td&gt;ç½‘æ˜“&lt;/td&gt;
&lt;td&gt;187&lt;/td&gt;
&lt;td&gt;å¯ä¸ Istio é›†æˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä» 2017 å¹´ 5 æœˆ Istio å¼€æºè‡³ä»Šä¹Ÿæœ‰ 4 å¹´å¤šäº†ï¼Œè™½ç„¶è¯¥é¡¹ç›®åœ¨ GitHub ä¸Šå·²ç»æœ‰å¾ˆé«˜çš„å…³æ³¨åº¦ï¼Œå¹¶å‘å¸ƒäº† 10 å‡ ä¸ªç‰ˆæœ¬ï¼Œä½†å…¶å¼€æºç”Ÿæ€è¿˜åœ¨èŒèŠ½æœŸã€‚è¿™å¼ è¡¨åˆ—ä¸¾äº† Istio ç”Ÿæ€ä¸­çš„å¼€æºé¡¹ç›®ï¼Œç»Ÿè®¡æˆªæ­¢åˆ° 2021 å¹´ 11 æœˆ 11 æ—¥ï¼Œè¡¨æ ¼æŒ‰ç…§å¼€æºæ—¶é—´æ’åºã€‚è¿™äº›é¡¹ç›®åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¹‹ä¸Šå¢å¼ºäº†ç½‘å…³ã€æ‰©å±•å’Œå®ç”¨å·¥å…·ç­‰ã€‚æˆ‘å°†æŒ‘é€‰å…¶ä¸­ 2 ä¸ªæ¥ç€é‡åˆ†äº«ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;slimeåŸºäº-istio-çš„æ™ºèƒ½æœåŠ¡ç½‘æ ¼ç®¡ç†å™¨&#34;&gt;Slimeï¼šåŸºäº Istio çš„æ™ºèƒ½æœåŠ¡ç½‘æ ¼ç®¡ç†å™¨&lt;/h3&gt;
&lt;p&gt;Slime æ˜¯ç”±ç½‘æ˜“æ•°å¸†å¾®æœåŠ¡å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾åŸºäº Istio çš„æ™ºèƒ½ç½‘æ ¼ç®¡ç†å™¨ã€‚Slime åŸºäº Kubernetes Operator å®ç°ï¼Œå¯ä½œä¸º Istio çš„ CRD ç®¡ç†å™¨ï¼Œæ— ç¼å¯¹æ¥ Istioï¼Œæ— é¡»åšä»»ä½•å®šåˆ¶åŒ–æ”¹é€ ï¼Œå®šä¹‰åŠ¨æ€çš„æœåŠ¡æ²»ç†ç­–ç•¥ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨ä¾¿æ·ä½¿ç”¨ Istio å’Œ Envoy é«˜é˜¶åŠŸèƒ½çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;Slime è¯•å›¾è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Istio ä¸­å¦‚ä½•å®ç°é«˜é˜¶æ‰©å±•çš„é—®é¢˜ï¼Œæ¯”å¦‚æ‰©å±• HTTP æ’ä»¶ï¼Œé™æµåŠŸèƒ½æ¯”è¾ƒå•è–„ï¼Œæ— æ³•æ ¹æ®æœåŠ¡çš„èµ„æºä½¿ç”¨ç‡åšåˆ°è‡ªé€‚åº”é™æµ&lt;/li&gt;
&lt;li&gt;è§£å†³ Sidecar é…ç½®å…¨é‡ä¸‹å‘æ¶ˆè€—å¤§é‡èµ„æºå¯¼è‡´åº”ç”¨æ€§èƒ½å˜å·®çš„é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Slime è§£å†³ä»¥ä¸Šé—®é¢˜çš„ç­”æ¡ˆæ˜¯æ„å»º Istio çš„ç®¡ç†å¹³é¢ï¼Œå…¶æ ¸å¿ƒæ€è·¯æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºå¯æ‹”æ’æ§åˆ¶å™¨&lt;/li&gt;
&lt;li&gt;æ•°æ®å¹³é¢ç›‘æ§&lt;/li&gt;
&lt;li&gt;CRD è½¬æ¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ Istio ä½œä¸º Istio ç®¡ç†å¹³é¢çš„æµç¨‹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp8td6cowj31i90u0aei.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp8td6cowj31i90u0aei.jpg&#34; data-width=&#34;1953&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Slime å¦‚ä½•ä½œä¸º Istio çš„æ§åˆ¶å¹³é¢&#34;&gt;
    
  
  &lt;figcaption&gt;Slime å¦‚ä½•ä½œä¸º Istio çš„æ§åˆ¶å¹³é¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Slime ç®¡ç† Istio çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Slime Operator æ ¹æ®ç®¡ç†å‘˜çš„é…ç½®åœ¨ Kubernetes ä¸­å®Œæˆ Slime ç»„ä»¶çš„åˆå§‹åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;å¼€å‘è€…åˆ›å»ºç¬¦åˆ Slime CRD è§„èŒƒçš„é…ç½®å¹¶åº”ç”¨åˆ° Kubernetes é›†ç¾¤ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Slime æŸ¥è¯¢ Prometheus ä¸­ä¿å­˜çš„ç›¸å…³æœåŠ¡çš„ç›‘æ§æ•°æ®ï¼Œç»“åˆ Slime CRD ä¸­è‡ªé€‚åº”éƒ¨åˆ†çš„é…ç½®ï¼Œå°† Slime CRD è½¬æ¢ä¸º Istio CRDï¼ŒåŒæ—¶å°†å…¶æ¨é€åˆ° Global Proxy ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istio ç›‘å¬ Istio CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Istio å°† Sidecar Proxy çš„é…ç½®ä¿¡æ¯æ¨é€åˆ°æ•°æ®å¹³é¢ç›¸åº”çš„ Sidecar Proxy ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„ Slime çš„å†…éƒ¨æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp8uzsj2wj31ac0oktb4.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp8uzsj2wj31ac0oktb4.jpg&#34; data-width=&#34;1668&#34; data-height=&#34;884&#34; alt=&#34;image&#34; data-caption=&#34;Slime å†…éƒ¨æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Slime å†…éƒ¨æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½œä¸º Istio çš„ç®¡ç†å¹³é¢ï¼Œå¯ä»¥å°† Slime çš„æ ¸å¿ƒçœ‹åšæ˜¯ Istio çš„ä¸€ä¸ª Operatorã€‚&lt;/p&gt;
&lt;p&gt;Slime å†…éƒ¨åˆ†ä¸ºä¸‰å¤§ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;slime-boot&lt;/strong&gt;ï¼šåœ¨ Kubernetes ä¸Šéƒ¨ç½² Slime æ¨¡å—çš„ operatorã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;slime-controller&lt;/strong&gt;ï¼šSlime çš„æ ¸å¿ƒç»„ä»¶ï¼Œç›‘å¬ Slime CRD å¹¶å°†å…¶è½¬æ¢ä¸º Istio CRDã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;slime-metric&lt;/strong&gt;ï¼šç”¨äºè·å–æœåŠ¡ metrics ä¿¡æ¯çš„ç»„ä»¶ï¼Œslime-controller ä¼šæ ¹æ®å…¶è·å–çš„ä¿¡æ¯åŠ¨æ€è°ƒæ•´æœåŠ¡æ²»ç†è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Slime è‡ªé€‚åº”é™æµçš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp8xghoh2j311k0u0dim.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp8xghoh2j311k0u0dim.jpg&#34; data-width=&#34;1352&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Slime è‡ªé€‚åº”é™æµæ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Slime è‡ªé€‚åº”é™æµæ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoy å†…ç½®çš„é™æµç»„ä»¶åŠŸèƒ½å•ä¸€ï¼Œåªèƒ½ä»¥å®ä¾‹ç»´åº¦é…ç½®é™æµå€¼ï¼Œæ— æ³•åšåˆ°æ ¹æ®åº”ç”¨è´Ÿè½½çš„è‡ªé€‚åº”é™æµã€‚Slime é€šè¿‡ä¸ Prometheus metric server å¯¹æ¥ï¼Œå®æ—¶çš„è·å–ç›‘æ§æƒ…å†µï¼Œæ¥åŠ¨æ€é…ç½®é™æµå€¼ã€‚&lt;/p&gt;
&lt;p&gt;Slime çš„è‡ªé€‚åº”é™æµçš„æµç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸º SmartLimiter åˆ° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/envoy-filter/&#34; title=&#34;EnvoyFilter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter&lt;/a&gt;
 çš„è½¬æ¢ï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºè·å–ç›‘æ§æ•°æ®ã€‚ç›®å‰ Slime æ”¯æŒä» Kubernetes Metric Server è·å–æœåŠ¡çš„ CPUã€å†…å­˜ã€å‰¯æœ¬æ•°ç­‰æ•°æ®ã€‚Slime è¿˜å¯¹å¤–æä¾›äº†ä¸€å¥—ç›‘æ§æ•°æ®æ¥å£ï¼ˆMetric Discovery Serverï¼‰ï¼Œé€šè¿‡ MDSï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„ç›‘æ§æŒ‡æ ‡åŒæ­¥ç»™é™æµç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Slime åˆ›å»ºçš„ CRD SmartLimiter ç”¨äºé…ç½®è‡ªé€‚åº”é™æµã€‚å…¶çš„é…ç½®æ˜¯æ¥è¿‘è‡ªç„¶è¯­ä¹‰ï¼Œä¾‹å¦‚å¸Œæœ›åœ¨ CPU è¶…è¿‡ 80% æ—¶è§¦å‘æœåŠ¡ A çš„è®¿é—®é™åˆ¶ï¼Œé™é¢ä¸º 30QPSï¼Œå¯¹åº”çš„ SmartLimiter å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;microservice.netease.com/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SmartLimiter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fill_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;quota&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;30/{pod}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 30 ä¸ºè¯¥æœåŠ¡çš„é¢åº¦ï¼Œå°†å…¶å‡åˆ†ç»™æ¯ä¸ª podï¼ŒåŠ å…¥æœ‰ 3 ä¸ª podï¼Œåˆ™æ¯ä¸ª pod çš„é™æµä¸º 10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;condition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{cpu}&amp;gt;0.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ ¹æ®ç›‘æ§é¡¹{cpu}çš„å€¼è‡ªåŠ¨å¡«å……è¯¥æ¨¡æ¿&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;aerakiåœ¨-istio-ä¸­ç®¡ç†ä»»ä½•ä¸ƒå±‚åè®®&#34;&gt;Aerakiï¼šåœ¨ Istio ä¸­ç®¡ç†ä»»ä½•ä¸ƒå±‚åè®®&lt;/h3&gt;
&lt;p&gt;Aeraki æ˜¯è…¾è®¯äº‘åœ¨ 2021 å¹´ 3 æœˆå¼€æºçš„ä¸€ä¸ªæœåŠ¡ç½‘æ ¼é¢†åŸŸçš„é¡¹ç›®ã€‚Aeraki æä¾›äº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼åè®®æ‰©å±•è§£å†³æ–¹æ¡ˆï¼Œä»¥ä¸€ç§éä¾µå…¥çš„æ–¹å¼ä¸º Istio æä¾›äº†å¼ºå¤§çš„ç¬¬ä¸‰æ–¹åè®®æ‰©å±•èƒ½åŠ›ï¼Œæ”¯æŒåœ¨ Istio ä¸­å¯¹ Dubboã€Thriftã€Redisï¼Œä»¥åŠå¯¹ç§æœ‰åè®®è¿›è¡Œæµé‡ç®¡ç†ã€‚Aeraki çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp8ytw57sj31f40u0785.png&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp8ytw57sj31f40u0785.png&#34; data-width=&#34;1033&#34; data-height=&#34;521&#34; alt=&#34;image&#34; data-caption=&#34;Aeraki æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Aeraki æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥æºï¼š&lt;a href=&#34;https://istio.io/latest/blog/2021/aeraki/&#34; title=&#34;https://istio.io/latest/blog/2021/aeraki/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/latest/blog/2021/aeraki/&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;ä» Aeraki æ¶æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒAeraki åè®®æ‰©å±•è§£å†³æ–¹æ¡ˆåŒ…å«äº†ä¸¤ä¸ªç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Aerakiï¼šAeraki ä½œä¸ºä¸€ä¸ª Istio å¢å¼ºç»„ä»¶è¿è¡Œåœ¨æ§åˆ¶é¢ï¼Œé€šè¿‡è‡ªå®šä¹‰ CRD å‘è¿ç»´æä¾›äº†ç”¨æˆ·å‹å¥½çš„æµé‡è§„åˆ™é…ç½®ã€‚Aeraki å°†è¿™äº›æµé‡è§„åˆ™é…ç½®ç¿»è¯‘ä¸º Envoy é…ç½®ï¼Œé€šè¿‡ Istio ä¸‹å‘åˆ°æ•°æ®é¢çš„ sidecar ä»£ç†ä¸Šã€‚Aeraki è¿˜ä½œä¸ºä¸€ä¸ª RDS æœåŠ¡å™¨ä¸ºæ•°æ®é¢çš„ MetaProtocol Proxy æä¾›åŠ¨æ€è·¯ç”±ã€‚Aeraki æä¾›çš„ RDS å’Œ Envoy çš„ RDS æœ‰æ‰€ä¸åŒï¼ŒEnvoy RDS ä¸»è¦ä¸º HTTP åè®®æä¾›åŠ¨æ€è·¯ç”±ï¼Œè€Œ Aeraki RDS æ—¨åœ¨ä¸ºæ‰€æœ‰åŸºäº MetaProtocol æ¡†æ¶å¼€å‘çš„ä¸ƒå±‚åè®®æä¾›åŠ¨æ€è·¯ç”±èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;MetaProtocol Proxyï¼šåŸºäº Envoy å®ç°çš„ä¸€ä¸ªé€šç”¨ä¸ƒå±‚åè®®ä»£ç†ã€‚ä¾æ‰˜ Envoy æˆç†Ÿçš„åŸºç¡€åº“ï¼ŒMetaProtocol Proxy æ˜¯åœ¨ Envoy ä»£ç åŸºç¡€ä¸Šçš„æ‰©å±•ã€‚å®ƒä¸ºä¸ƒå±‚åè®®ç»Ÿä¸€å®ç°äº†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€RDS åŠ¨æ€è·¯ç”±ã€æµé‡é•œåƒã€æ•…éšœæ³¨å…¥ã€æœ¬åœ°/å…¨å±€é™æµç­‰åŸºç¡€èƒ½åŠ›ï¼Œå¤§å¤§é™ä½äº†åœ¨ Envoy ä¸Šå¼€å‘ç¬¬ä¸‰æ–¹åè®®çš„éš¾åº¦ï¼Œåªéœ€è¦å®ç°ç¼–è§£ç çš„æ¥å£ï¼Œå°±å¯ä»¥åŸºäº MetaProtocol å¿«é€Ÿå¼€å‘ä¸€ä¸ªç¬¬ä¸‰æ–¹åè®®æ’ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰ä½¿ç”¨ MetaProtocol Proxyï¼Œè¦è®© Envoy è¯†åˆ«ä¸€ä¸ªä¸ƒå±‚åè®®ï¼Œåˆ™éœ€è¦ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„ TCP filterï¼Œè¿™ä¸ª filter éœ€è¦å®ç°è·¯ç”±ã€é™æµã€é¥æµ‹ç­‰èƒ½åŠ›ï¼Œéœ€è¦æŠ•å…¥å¤§é‡çš„äººåŠ›ã€‚å¯¹äºå¤§éƒ¨åˆ†çš„ä¸ƒå±‚åè®®æ¥è¯´ï¼Œéœ€è¦çš„æµé‡ç®¡ç†èƒ½åŠ›æ˜¯ç±»ä¼¼çš„ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦åœ¨æ¯ä¸ªä¸ƒå±‚åè®®çš„ filter å®ç°ä¸­é‡å¤è¿™éƒ¨åˆ†å·¥ä½œã€‚Aeraki é¡¹ç›®é‡‡ç”¨äº†ä¸€ä¸ª MetaProtocol Proxy æ¥ç»Ÿä¸€å®ç°è¿™äº›èƒ½åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/metaprotocol-proxy.png&#34; data-img=&#34;/blog/service-mesh-insight/metaprotocol-proxy.png&#34; data-width=&#34;2464&#34; data-height=&#34;722&#34; alt=&#34;image&#34; data-caption=&#34;MetaProtocol Proxy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;MetaProtocol Proxy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŸºäº MetaProtocol Proxyï¼Œåªéœ€è¦å®ç°ç¼–è§£ç æ¥å£éƒ¨åˆ†çš„ä»£ç å°±å¯ä»¥ç¼–å†™ä¸€ä¸ªæ–°çš„ä¸ƒå±‚åè®® Envoy Filterã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ— éœ€æ·»åŠ ä¸€è¡Œä»£ç ï¼ŒAeraki å°±å¯ä»¥åœ¨æ§åˆ¶é¢æä¾›è¯¥ä¸ƒå±‚åè®®çš„é…ç½®ä¸‹å‘å’Œ RDS åŠ¨æ€è·¯ç”±é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/metaprotocol-proxy-codec.png&#34; data-img=&#34;/blog/service-mesh-insight/metaprotocol-proxy-codec.png&#34; data-width=&#34;875&#34; data-height=&#34;391&#34; alt=&#34;image&#34; data-caption=&#34;é‡‡ç”¨ MetaProtocol ç¼–å†™ Envoy Filter çš„å¯¹æ¯”&#34;&gt;
    
  
  &lt;figcaption&gt;é‡‡ç”¨ MetaProtocol ç¼–å†™ Envoy Filter çš„å¯¹æ¯”&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Aeraki + MetaProtocol å¥—ä»¶é™ä½äº†åœ¨ Istio ä¸­ç®¡ç†ç¬¬ä¸‰æ–¹åè®®çš„éš¾åº¦ï¼Œå°† Istio æ‰©å±•æˆä¸ºä¸€ä¸ªæ”¯æŒæ‰€æœ‰åè®®çš„å…¨æ ˆæœåŠ¡ç½‘æ ¼ã€‚ç›®å‰ Aeraki é¡¹ç›®å·²ç»åŸºäº MetaProtocol å®ç°äº† Dubbo å’Œ Thrift åè®®ã€‚ç›¸å¯¹ Envoy è‡ªå¸¦çš„ Dubbo å’Œ Thrift Filterï¼ŒåŸºäº MetaProtocol çš„ Dubbo å’Œ Thrift å®ç°åŠŸèƒ½æ›´ä¸ºå¼ºå¤§ï¼Œæä¾›äº† RDS åŠ¨æ€è·¯ç”±ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­å­˜é‡é“¾æ¥çš„æƒ…å†µä¸‹å¯¹æµé‡è¿›è¡Œé«˜çº§çš„è·¯ç”±ç®¡ç†ï¼Œå¹¶ä¸”æä¾›äº†éå¸¸çµæ´»çš„ Metadata è·¯ç”±æœºåˆ¶ï¼Œç†è®ºä¸Šå¯ä»¥é‡‡ç”¨åè®®æ•°æ®åŒ…ä¸­æºå¸¦çš„ä»»æ„å­—æ®µè¿›è¡Œè·¯ç”±ã€‚QQ éŸ³ä¹å’Œå¤®è§†é¢‘ APP ç­‰ä¸šåŠ¡ä¹Ÿæ­£åœ¨åŸºäº Aeraki å’Œ MetaProtocol è¿›è¡Œå¼€å‘ï¼Œä»¥å°†ä¸€äº›ç§æœ‰åè®®çº³å…¥åˆ°æœåŠ¡ç½‘æ ¼ä¸­è¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œ&lt;a href=&#34;https://github.com/aeraki-framework&#34; title=&#34;Aeraki Framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki Framework&lt;/a&gt;
 ä¸­è¿˜æä¾›äº† xDS é…ç½®ä¸‹å‘ä¼˜åŒ–çš„ lazyXDS æ’ä»¶ã€Consulã€etcdã€Zookeeper ç­‰å„ç§ç¬¬ä¸‰æ–¹æœåŠ¡æ³¨å†Œè¡¨å¯¹æ¥é€‚é…ï¼ŒIstio è¿ç»´å®æˆ˜ç”µå­ä¹¦ç­‰å·¥å…·ï¼Œæ—¨åœ¨è§£å†³ Istio åœ¨è½åœ°ä¸­é‡åˆ°çš„å„ç§å®é™…é—®é¢˜ï¼ŒåŠ é€ŸæœåŠ¡ç½‘æ ¼çš„æˆç†Ÿå’Œäº§å“åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼çš„æœªæ¥å‘å±•&#34;&gt;æœåŠ¡ç½‘æ ¼çš„æœªæ¥å‘å±•&lt;/h2&gt;
&lt;p&gt;æœ€åæˆ‘æƒ³è®²ä¸€ä¸‹å¯¹äºæœåŠ¡ç½‘æ ¼æœªæ¥å‘å±•çš„ä¸€äº›çœ‹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®©-istio-é€‚ç”¨äºä¸€åˆ‡ç¯å¢ƒå’Œä¸€åˆ‡å·¥ä½œè´Ÿè½½&#34;&gt;è®© Istio é€‚ç”¨äºä¸€åˆ‡ç¯å¢ƒå’Œä¸€åˆ‡å·¥ä½œè´Ÿè½½&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°äº†ç½‘æ˜“ã€è…¾è®¯ä¸»è¦æ˜¯é€šè¿‡æ„å»º Operator æ¥æ‰©å±• Istioï¼Œç„¶è€Œè¿™ç§æ‰©å±•å¯¹äºå¤šé›†ç¾¤ç®¡ç†æ¥è¯´å¹¶ä¸å¤Ÿç”¨ã€‚æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬ç›®å‰çš„åŸºç¡€è®¾æ–½å¾ˆå¤šæ˜¯åœ¨å‘äº‘åŸç”ŸåŒ–æˆ–è€…æ˜¯å®¹å™¨åŒ–è½¬å‹ï¼Œé‚£ä¹ˆå°±å­˜åœ¨ä¸€ä¸ªå®¹å™¨ã€è™šæ‹Ÿæœºç­‰å…±å­˜çš„ç¯å¢ƒã€‚è¿™å°±æ˜¯å¼‚æ„ç¯å¢ƒï¼Œè¿™äº›ä¸åŒç¯å¢ƒçš„æµé‡å¦‚ä½•ç»Ÿä¸€ç®¡ç†å‘¢ï¼Ÿå…¶å®ä½¿ç”¨ Istio æ˜¯å¯ä»¥åšåˆ°çš„ã€‚åŒæ ·æ˜¯è¦åœ¨ Istio ä¹‹ä¸Šæ„å»ºä¸€ä¸ªç®¡ç†å¹³é¢ï¼Œå¹¶å¢åŠ ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå¢åŠ é€‚ç”¨äºé›†ç¾¤ç®¡ç†çš„ CRDï¼Œæ¯”å¦‚é›†ç¾¤æµé‡é…ç½®ã€é›†ç¾¤ç­–ç•¥é…ç½®ç­‰ã€‚å¦å¤–è¿˜è¦åœ¨æ¯ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª Gatewayï¼Œç»Ÿä¸€è¿æ¥åˆ°ä¸€ä¸ªè¾¹ç¼˜ä»£ç†ï¼Œè®©æ‰€æœ‰çš„é›†ç¾¤äº’è”ã€‚è¿™ä¹Ÿæ˜¯ Tetrate Service Bridge çš„äº§å“ç†å¿µã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/tsb.png&#34; data-img=&#34;/blog/service-mesh-insight/tsb.png&#34; data-width=&#34;1888&#34; data-height=&#34;894&#34; alt=&#34;image&#34; data-caption=&#34;Tetrate Service Bridge æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Tetrate Service Bridge æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;api-ç½‘å…³ä¸æœåŠ¡ç½‘æ ¼çš„èåˆ&#34;&gt;API ç½‘å…³ä¸æœåŠ¡ç½‘æ ¼çš„èåˆ&lt;/h3&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨ Istio Gatewayã€Kubernetes Ingressã€API Gateway åŠ NodePort/LB æš´éœ² Istio mesh ä¸­æœåŠ¡çš„å››ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-insight/008i3skNly1gwp935mcd0j31200u0n10.jpg&#34; data-img=&#34;/blog/service-mesh-insight/008i3skNly1gwp935mcd0j31200u0n10.jpg&#34; data-width=&#34;1368&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;è®¿é—® Istio ç½‘æ ¼ä¸­æœåŠ¡çš„å‡ ç§æ–¹å¼&#34;&gt;
    
  
  &lt;figcaption&gt;è®¿é—® Istio ç½‘æ ¼ä¸­æœåŠ¡çš„å‡ ç§æ–¹å¼&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­é˜´å½±è¡¨ç¤ºçš„æ˜¯ Istio meshï¼Œmesh ä¸­çš„çš„æµé‡å±äºé›†ç¾¤å†…éƒ¨ï¼ˆä¸œè¥¿å‘ï¼‰æµé‡ï¼Œè€Œå®¢æˆ·ç«¯è®¿é—® Kubernetes é›†ç¾¤å†…æœåŠ¡çš„æµé‡å±äºå¤–éƒ¨ï¼ˆå—åŒ—å‘ï¼‰æµé‡ã€‚ä¸è¿‡å› ä¸º Ingressã€Gateway ä¹Ÿæ˜¯éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤å†…çš„ï¼Œè¿™äº›èŠ‚ç‚¹è®¿é—®é›†ç¾¤å†…å…¶ä»–æœåŠ¡çš„æµé‡å°±éš¾ä»¥å½’å±äº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio mesh ä¸­ä½ å¯ä»¥ä½¿ç”¨å¤šç§ Kubernetes Ingress Controller æ¥å……å½“å…¥å£ç½‘å…³ï¼Œå½“ç„¶ä½ è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ Istio å†…ç½®çš„ Istio ç½‘å…³ï¼Œå¯¹äºç­–ç•¥æ§åˆ¶ã€æµé‡ç®¡ç†å’Œç”¨é‡ç›‘æ§å¯ä»¥ç›´æ¥é€šè¿‡ Istio ç½‘å…³æ¥å®Œæˆï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯é€šè¿‡ Istio çš„æ§åˆ¶å¹³é¢æ¥ç›´æ¥ç®¡ç†ç½‘å…³ï¼Œè€Œä¸éœ€è¦å†å€ŸåŠ©å…¶ä»–å·¥å…·ã€‚ä½†æ˜¯å¯¹äº API å£°æ˜å‘¨æœŸç®¡ç†ã€å¤æ‚çš„è®¡è´¹ã€åè®®è½¬æ¢å’Œè®¤è¯ç­‰åŠŸèƒ½ï¼Œä¼ ç»Ÿçš„ API ç½‘å…³å¯èƒ½æ›´é€‚åˆä½ ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è¡¨ä¸­åˆ—å‡ºäº† Istio Mesh ä¸­æš´éœ²æœåŠ¡çš„å››ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ§åˆ¶å™¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;NodePort/LoadBalancer&lt;/td&gt;
&lt;td&gt;Kubernetes&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Kubernetes Ingress&lt;/td&gt;
&lt;td&gt;Ingress Controller&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ã€TLSã€è™šæ‹Ÿä¸»æœºã€æµé‡è·¯ç”±&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio Gateway&lt;/td&gt;
&lt;td&gt;Istio&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ã€TLSã€è™šæ‹Ÿä¸»æœºã€é«˜çº§æµé‡è·¯ç”±ã€å…¶ä»– Istio çš„é«˜çº§åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;API ç½‘å…³&lt;/td&gt;
&lt;td&gt;API Gateway&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ã€TLSã€è™šæ‹Ÿä¸»æœºã€æµé‡è·¯ç”±ã€API ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æƒé™è®¤è¯ã€æ•°æ®èšåˆã€è´¦å•å’Œé€Ÿç‡é™åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç›®å‰æœ‰äº›ä¼ ç»Ÿçš„åå‘ä»£ç†ä¹Ÿåœ¨å‘ Service Mesh æ–¹å‘å‘å±•ï¼Œå¦‚ Nginx æ„å»ºäº† Nginx Service Meshï¼ŒTraefik æ„å»ºäº† Traefik Meshã€‚è¿˜æœ‰çš„ API ç½‘å…³äº§å“ä¹Ÿå‘ Service Mesh æ–¹å‘æŒºè¿›ï¼Œæ¯”å¦‚ Kong å‘å±•å‡ºäº† Kumaã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ›´å¤š API ç½‘å…³ã€åå‘ä»£ç†å’ŒæœåŠ¡ç½‘æ ¼çš„èåˆäº§å“å‡ºç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½ æ˜¯å¦çœŸçš„éœ€è¦æœåŠ¡ç½‘æ ¼&#34;&gt;ä½ æ˜¯å¦çœŸçš„éœ€è¦æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨ä½¿ç”¨æœåŠ¡ç½‘æ ¼å‰ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ çš„å›¢é˜Ÿå¤šå°‘äººé‡ŒæŠ•å…¥æœåŠ¡ç½‘æ ¼å¼€å‘ï¼Ÿä½¿ç”¨ Kubernetesã€Istio çš„ç»éªŒï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ æœ‰å¤šå°‘å¾®æœåŠ¡ï¼Ÿè¿™äº›å¾®æœåŠ¡ä½¿ç”¨ä»€ä¹ˆè¯­è¨€ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ çš„æœåŠ¡éƒ½è¿è¡Œåœ¨å“ªäº›å¹³å°ä¸Šï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ çš„åº”ç”¨å·²ç»å®¹å™¨åŒ–å¹¶ä½¿ç”¨ Kubernetes ç®¡ç†äº†å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ çš„æœåŠ¡æœ‰å¤šå°‘æ˜¯éƒ¨ç½²åœ¨è™šæ‹Ÿæœºã€æœ‰å¤šå°‘æ˜¯éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸Šï¼Œæ¯”ä¾‹å¦‚ä½•ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ çš„å›¢é˜Ÿæœ‰åˆ¶å®šè½¬ç§»åˆ°äº‘åŸç”Ÿæ¶æ„çš„è®¡åˆ’å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ æƒ³ä½¿ç”¨ Istio çš„ä»€ä¹ˆåŠŸèƒ½ï¼ŸIstio çš„ç¨³å®šæ€§æ˜¯å¦èƒ½å¤Ÿæ»¡è¶³ä½ çš„éœ€æ±‚ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ æ˜¯å¦å¯ä»¥å¿å— Istio å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ é€‰æ‹©è‡ªå»ºæˆ–è€…é‡‡è´­ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ€åæ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„åˆ†äº«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»å®¹å™¨ç¼–æ’äº‰éœ¸åˆ°æœåŠ¡ç½‘æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‘åŸç”Ÿä¹ƒè‡³æ•´ä¸ªäº‘è®¡ç®—å°±æ˜¯æ ‡å‡†ä¹‹äº‰ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼çš„ç›®æ ‡æ˜¯æˆä¸ºäº‘åŸç”Ÿçš„ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œä»»é‡è€Œé“è¿œã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼åªæ˜¯äº‘åŸç”Ÿåºå¤§æŠ€æœ¯æ ˆä¸­çš„ä¸€ç¯ï¼Œä¸è¦ä¸€å¶éšœç›®ï¼ŒæŠ€æœ¯çš„å‘å±•æ˜¯æ°¸æ— æ­¢å¢ƒçš„ã€‚&lt;/li&gt;
&lt;li&gt;Istio æ¶æ„å·²ç»ç¨³å®šï¼Œç”Ÿäº§å¯ç”¨ï¼Œç”Ÿæ€æ­£å¤„äºèŒèŠ½ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç»ˆç«¯ç”¨æˆ·æ¥è¯´é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬äººæ‰ç–å­¦æµ…ï¼Œå› ä¸ºæ—¶é—´çš„åŸå› ï¼Œå¾ˆå¤šå†…å®¹æ²¡æœ‰æ·±å…¥å±•å¼€å’Œæ¢è®¨ï¼Œæœ€åæ¬¢è¿å¤§å®¶åŠ å…¥&lt;a href=&#34;https://cloudnative.to/sig-istio/&#34; title=&#34;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&lt;/a&gt;
 ä¸€èµ·äº¤æµå­¦ä¹  Istio å’ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•ç†è§£ Istio Ingressï¼Œå®ƒä¸ API Gateway æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</title>
      <link>https://jimmysong.io/blog/istio-servicemesh-api-gateway/</link>
      <pubDate>Fri, 06 Aug 2021 10:22:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-servicemesh-api-gateway/</guid>
      <description>
        
        
        &lt;p&gt;API ç½‘å…³ä½œä¸ºå®¢æˆ·ç«¯è®¿é—®åç«¯çš„å…¥å£ï¼Œå·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´äº†ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥ç®¡ç†â€å—åŒ—å‘â€œçš„æµé‡ï¼›è¿‘å‡ å¹´æœåŠ¡ç½‘æ ¼å¼€å§‹æµè¡Œï¼Œå®ƒä¸»è¦æ˜¯ç®¡ç†ç³»ç»Ÿå†…éƒ¨ï¼Œå³â€œä¸œè¥¿å‘â€æµé‡ï¼Œè€Œåƒ Istio è¿™æ ·çš„æœåŠ¡ç½‘æ ¼è¿˜å†…ç½®äº†ç½‘å…³ï¼Œä»è€Œå°†ç³»ç»Ÿå†…å¤–éƒ¨çš„æµé‡çº³å…¥äº†ç»Ÿä¸€ç®¡æ§ã€‚è¿™ç»å¸¸ç»™åˆæ¬¡æ¥è§¦ Istio çš„äººå¸¦æ¥å›°æƒ‘â€”â€”æœåŠ¡ç½‘æ ¼ä¸ API ç½‘å…³ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿæ˜¯ä¸æ˜¯ä½¿ç”¨äº† Istio å°±å¯ä»¥æ›¿ä»£äº† API ç½‘å…³ï¼ŸIstio çš„ API ç½‘å…³æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿæœ‰å“ªäº›æ–¹å¼æš´éœ² Istio mesh ä¸­çš„æœåŠ¡ï¼Ÿè¿™ç¯‡æ–‡ç« ç»™ä¸ºä½ è§£ç­”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»è¦è§‚ç‚¹&#34;&gt;ä¸»è¦è§‚ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼è¯ç”Ÿçš„åˆè¡·æ˜¯ä¸ºäº†è§£å†³åˆ†å¸ƒå¼åº”ç”¨çš„å†…éƒ¨æµé‡çš„ç®¡ç†é—®é¢˜ï¼Œè€Œåœ¨æ­¤ä¹‹å‰ API ç½‘å…³å·²å­˜åœ¨å¾ˆä¹…äº†ã€‚&lt;/li&gt;
&lt;li&gt;è™½ç„¶ Istio ä¸­å†…ç½®äº† Gatewayï¼Œä½†æ˜¯ä½ ä»å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ Ingress Controller æ¥ä»£ç†å¤–éƒ¨æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;API ç½‘å…³å’ŒæœåŠ¡ç½‘æ ¼æ­£æœç€èåˆçš„æ–¹å‘å‘å±•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•æš´éœ²-istio-mesh-ä¸­çš„æœåŠ¡&#34;&gt;å¦‚ä½•æš´éœ² Istio mesh ä¸­çš„æœåŠ¡ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨ Istio Gatewayã€Kubernetes Ingressã€API Gateway åŠ NodePort/LB æš´éœ² Istio mesh ä¸­æœåŠ¡çš„å››ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-servicemesh-api-gateway/access-cluster.svg&#34; data-img=&#34;/blog/istio-servicemesh-api-gateway/access-cluster.svg&#34; alt=&#34;image&#34; data-caption=&#34;æš´éœ² Kubernetes ä¸­æœåŠ¡çš„å‡ ç§æ–¹å¼&#34;&gt;
    
  
  &lt;figcaption&gt;æš´éœ² Kubernetes ä¸­æœåŠ¡çš„å‡ ç§æ–¹å¼&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­é˜´å½±è¡¨ç¤ºçš„æ˜¯ Istio meshï¼Œmesh ä¸­çš„çš„æµé‡å±äºé›†ç¾¤å†…éƒ¨ï¼ˆä¸œè¥¿å‘ï¼‰æµé‡ï¼Œè€Œå®¢æˆ·ç«¯è®¿é—® Kubernetes é›†ç¾¤å†…æœåŠ¡çš„æµé‡å±äºå¤–éƒ¨ï¼ˆå—åŒ—å‘ï¼‰æµé‡ã€‚ä¸è¿‡å› ä¸º Ingressã€Gateway ä¹Ÿæ˜¯éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤å†…çš„ï¼Œè¿™äº›èŠ‚ç‚¹è®¿é—®é›†ç¾¤å†…å…¶ä»–æœåŠ¡çš„æµé‡å°±éš¾ä»¥å½’å±äº†ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹å¼&lt;/th&gt;
&lt;th&gt;æ§åˆ¶å™¨&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;NodePort/LoadBalancer&lt;/td&gt;
&lt;td&gt;Kubernetes&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Kubernetes Ingress&lt;/td&gt;
&lt;td&gt;Ingress Controller&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ã€TLSã€è™šæ‹Ÿä¸»æœºã€æµé‡è·¯ç”±&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio Gateway&lt;/td&gt;
&lt;td&gt;Istio&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ã€TLSã€è™šæ‹Ÿä¸»æœºã€é«˜çº§æµé‡è·¯ç”±ã€å…¶ä»– Istio çš„é«˜çº§åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;API ç½‘å…³&lt;/td&gt;
&lt;td&gt;API Gateway&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ã€TLSã€è™šæ‹Ÿä¸»æœºã€æµé‡è·¯ç”±ã€API ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æƒé™è®¤è¯ã€æ•°æ®èšåˆã€è´¦å•å’Œé€Ÿç‡é™åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç”±äº NodePort/LoadBalancer æ˜¯ Kubernetes å†…ç½®çš„åŸºæœ¬çš„æš´éœ²æœåŠ¡çš„æ–¹å¼ï¼Œæœ¬æ–‡å°±ä¸è®¨è®ºè¿™ç§æ–¹å¼äº†ã€‚ä¸‹æ–‡å°†å¯¹å…¶ä»–ä¸‰ç§æ–¹å¼åˆ†åˆ«ä½œå‡ºè¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-kubernetes-ingress-æš´éœ²æœåŠ¡&#34;&gt;ä½¿ç”¨ Kubernetes Ingress æš´éœ²æœåŠ¡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ Kubernetes é›†ç¾¤çš„å®¢æˆ·ç«¯æ˜¯æ— æ³•ç›´æ¥è®¿é—® Pod çš„ IP åœ°å€çš„ï¼Œå› ä¸º Pod æ˜¯å¤„äº Kubernetes å†…ç½®çš„ä¸€ä¸ªç½‘ç»œå¹³é¢ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å°† Kubernetes å†…çš„æœåŠ¡ä½¿ç”¨ NodePort æˆ–è€… LoadBlancer çš„æ–¹å¼æš´éœ²åˆ°é›†ç¾¤ä»¥å¤–ã€‚åŒæ—¶ä¸ºäº†æ”¯æŒè™šæ‹Ÿä¸»æœºã€éšè—å’ŒèŠ‚çœ IP åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; title=&#34;Ingress&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress&lt;/a&gt;
 æ¥æš´éœ² Kubernetes ä¸­çš„æœåŠ¡ã€‚Kubernetes Ingress åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-servicemesh-api-gateway/ingress.svg&#34; data-img=&#34;/blog/istio-servicemesh-api-gateway/ingress.svg&#34; alt=&#34;image&#34; data-caption=&#34;ä½¿ç”¨ Kubernetes Ingress æš´éœ²æœåŠ¡&#34;&gt;
    
  
  &lt;figcaption&gt;ä½¿ç”¨ Kubernetes Ingress æš´éœ²æœåŠ¡&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®€å•çš„è¯´ï¼ŒIngress å°±æ˜¯ä» Kubernetes é›†ç¾¤å¤–è®¿é—®é›†ç¾¤çš„å…¥å£ï¼Œå°†ç”¨æˆ·çš„ URL è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„æœåŠ¡ä¸Šã€‚Ingress ç›¸å½“äº Nginxã€Apache ç­‰è´Ÿè½½å‡è¡¡æ–¹å‘ä»£ç†æœåŠ¡å™¨ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬è§„åˆ™å®šä¹‰ï¼Œå³ URL çš„è·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±ä¿¡æ¯å¾—çš„åˆ·æ–°ç”± &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers&#34; title=&#34;Ingress controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress controller&lt;/a&gt;
æ¥æä¾›ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/ingress.class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/status/*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„ä¾‹å­ä¸­çš„ &lt;code&gt;kubernetes.io/ingress.class: istio&lt;/code&gt; æ³¨è§£è¡¨æ˜è¯¥ Ingress ä½¿ç”¨çš„ Istio Ingress Controllerã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-istio-gateway-æš´éœ²æœåŠ¡&#34;&gt;ä½¿ç”¨ Istio Gateway æš´éœ²æœåŠ¡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ Istio æ˜¯ç»§æ‰¿ Kubernetes ä¹‹åå‘å±•å‡ºæ¥çš„ä¸€ä¸ªæµè¡Œçš„æœåŠ¡ç½‘æ ¼å®ç°ï¼Œå®ƒå®ç°äº† Kubernetes æ²¡æœ‰çš„ä¸€äº›åŠŸèƒ½ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/blog/what-is-istio-and-why-does-kubernetes-need-it/&#34; title=&#34;ä»€ä¹ˆæ˜¯ Istioï¼Ÿä¸ºä»€ä¹ˆ Kubernetes éœ€è¦ Istioï¼Ÿ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»€ä¹ˆæ˜¯ Istioï¼Ÿä¸ºä»€ä¹ˆ Kubernetes éœ€è¦ Istioï¼Ÿ&lt;/a&gt;
ç®€è¦æ¥è¯´ï¼Œæ­£æ˜¯å› ä¸º Istio è¡¥è¶³äº† Kubernetes å¯¹äºäº‘åŸç”Ÿåº”ç”¨çš„æµé‡ç®¡ç†ã€å¯è§‚å¯Ÿæ€§å’Œå®‰å…¨æ–¹é¢çš„çŸ­æ¿ï¼Œä½¿å¾—æµé‡ç®¡ç†å˜å¾—å¯¹åº”ç”¨ç¨‹åºé€æ˜ï¼Œä½¿è¿™éƒ¨åˆ†åŠŸèƒ½ä»åº”ç”¨ç¨‹åºä¸­è½¬ç§»åˆ°äº†å¹³å°å±‚ï¼Œæˆä¸ºäº†äº‘åŸç”ŸåŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;p&gt;Istio 0.8 ä»¥å‰ç‰ˆæœ¬ä¸­ä½¿ç”¨ Kubernetes &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; title=&#34;Ingress&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress&lt;/a&gt;
 æ¥ä½œä¸ºæµé‡å…¥å£ï¼Œå…¶ä¸­ä½¿ç”¨ Envoy ä½œä¸º Ingress Controllerã€‚åœ¨ Istio 0.8 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼ŒIstio åˆ›å»ºäº† Gateway å¯¹è±¡ã€‚Gateway å’Œ VirtualService ç”¨äºè¡¨ç¤º Istio Ingress çš„é…ç½®æ¨¡å‹ï¼ŒIstio Ingress çš„ç¼ºçœå®ç°åˆ™é‡‡ç”¨äº†å’Œ sidecar ç›¸åŒçš„ Envoy ä»£ç†ã€‚é€šè¿‡è¯¥æ–¹å¼ï¼ŒIstio æ§åˆ¶é¢ç”¨ä¸€è‡´çš„é…ç½®æ¨¡å‹åŒæ—¶æ§åˆ¶äº†å…¥å£ç½‘å…³å’Œå†…éƒ¨çš„ sidecar ä»£ç†ã€‚è¿™äº›é…ç½®åŒ…æ‹¬è·¯ç”±è§„åˆ™ï¼Œç­–ç•¥æ£€æŸ¥ã€é¥æµ‹æ”¶é›†ä»¥åŠå…¶ä»–æœåŠ¡ç®¡æ§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Istio Gateway çš„åŠŸèƒ½ä¸ Kubernetes Ingress ç±»ä¼¼ï¼Œå®ƒè´Ÿè´£è¿›å‡ºé›†ç¾¤çš„å—åŒ—æµé‡ã€‚Istio Gateway æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½è¿›å‡ºæœåŠ¡ç½‘æ ¼è¾¹ç¼˜çš„è¿æ¥ã€‚è¯¥è§„èŒƒæè¿°äº†ä¸€ç»„å¼€æ”¾ç«¯å£å’Œè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ï¼Œä»¥åŠç”¨äºè´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Istio Gateway èµ„æºæœ¬èº«åªèƒ½é…ç½® L4 åˆ° L6 çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æš´éœ²çš„ç«¯å£ã€TLS è®¾ç½®ç­‰ï¼›ä½† Gateway å¯ä¸ VirtualService ç»‘å®šï¼Œåœ¨ VirtualService ä¸­å¯ä»¥é…ç½®ä¸ƒå±‚è·¯ç”±è§„åˆ™ï¼Œä¾‹å¦‚æŒ‰æ¯”ä¾‹å’Œç‰ˆæœ¬çš„æµé‡è·¯ç”±ï¼Œæ•…éšœæ³¨å…¥ï¼ŒHTTP é‡å®šå‘ï¼ŒHTTP é‡å†™ç­‰æ‰€æœ‰ Mesh å†…éƒ¨æ”¯æŒçš„è·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ª Gateway ä¸ VirtualService ç»‘å®šçš„ç¤ºä¾‹ã€‚æ‹¥æœ‰ &lt;code&gt;istio: ingressgateway&lt;/code&gt; æ ‡ç­¾çš„ pod å°†ä½œä¸º Ingress Gateway å¹¶è·¯ç”±å¯¹ &lt;code&gt;httpbin.example.com&lt;/code&gt; è™šæ‹Ÿä¸»æœºçš„ 80 ç«¯å£çš„ HTTP è®¿é—®ï¼Œè¿™ç›¸å½“äºç»™ Kubernetes æ•å¼€äº†ä¸€ä¸ªå¤–éƒ¨è®¿é—®çš„å…¥å£ã€‚è¿™ä¸ä½¿ç”¨ Kubernetes Ingress æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å°† VirtualService ä¸ Gateway ç»‘å®šï¼Œå¹¶æŒ‡å®š Gateway æ‰€åœ¨çš„ podã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢è¿™ä¸ª VirtualService é€šè¿‡ &lt;code&gt;gateways&lt;/code&gt; ä¸ä¸Šé¢çš„ç½‘å…³ç»‘å®šåœ¨äº†ä¸€èµ·ï¼Œä»¥æ¥å—æ¥è‡ªè¯¥ç½‘å…³çš„æµé‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;httpbin-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/status&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä½¿ç”¨-api-ç½‘å…³æš´éœ²æœåŠ¡&#34;&gt;ä½¿ç”¨ API ç½‘å…³æš´éœ²æœåŠ¡&lt;/h2&gt;
&lt;p&gt;API ç½‘å…³æ˜¯ä½äºå®¢æˆ·ç«¯å’Œåç«¯æœåŠ¡ä¹‹é—´çš„ API ç®¡ç†å·¥å…·ï¼Œä¸€ç§å°†å®¢æˆ·ç«¯æ¥å£ä¸åç«¯å®ç°åˆ†ç¦»çš„æ–¹å¼ï¼Œåœ¨å¾®æœåŠ¡ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚å½“å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚æ—¶ï¼ŒAPI ç½‘å…³ä¼šå°†å…¶åˆ†è§£ä¸ºå¤šä¸ªè¯·æ±‚ï¼Œç„¶åå°†å®ƒä»¬è·¯ç”±åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œç”Ÿæˆå“åº”ï¼Œå¹¶è·Ÿè¸ªæ‰€æœ‰å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;API Gateway æ˜¯å¾®æœåŠ¡æ¶æ„ä½“ç³»ä¸­çš„ä¸€ç±»å‹ç‰¹æ®ŠæœåŠ¡ï¼Œå®ƒæ˜¯æ‰€æœ‰å¾®æœåŠ¡çš„å…¥å£ï¼Œå®ƒçš„èŒè´£æ˜¯æ‰§è¡Œè·¯ç”±è¯·æ±‚ã€åè®®è½¬æ¢ã€èšåˆæ•°æ®ã€è®¤è¯ã€é™æµã€ç†”æ–­ç­‰ã€‚å¤§å¤šæ•°ä¼ä¸š API éƒ½æ˜¯é€šè¿‡ API ç½‘å…³éƒ¨ç½²çš„ã€‚API ç½‘å…³é€šå¸¸ä¼šå¤„ç†è·¨ API æœåŠ¡ç³»ç»Ÿçš„å¸¸è§ä»»åŠ¡ï¼Œä¾‹å¦‚ç”¨æˆ·èº«ä»½éªŒè¯ã€é€Ÿç‡é™åˆ¶å’Œç»Ÿè®¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç½‘æ ¼ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª API Gatewayã€‚API ç½‘å…³çš„èŒè´£æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯·æ±‚è·¯ç”±å’Œç‰ˆæœ¬æ§åˆ¶&lt;/li&gt;
&lt;li&gt;æ–¹ä¾¿å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡çš„è¿‡æ¸¡&lt;/li&gt;
&lt;li&gt;æƒé™è®¤è¯&lt;/li&gt;
&lt;li&gt;æ•°æ®èšåˆï¼šç›‘æ§å’Œè®¡è´¹&lt;/li&gt;
&lt;li&gt;åè®®è½¬æ¢&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯å’Œç¼“å­˜&lt;/li&gt;
&lt;li&gt;å®‰å…¨å’ŒæŠ¥è­¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šå¾ˆå¤šåŸºæœ¬åŠŸèƒ½æ¯”å¦‚è·¯ç”±å’Œæƒé™è®¤è¯é€šè¿‡ Istio Gateway ä¹Ÿå¯ä»¥å®ç°ï¼Œåªæ˜¯åœ¨åŠŸèƒ½çš„ä¸°å¯Œåº¦å’Œæ‰©å±•æ€§æ–¹é¢æœ‰äº›æˆç†Ÿçš„ API Gateway å¯èƒ½æ›´å ä¼˜åŠ¿ï¼Œä¸è¿‡åœ¨ Istio mesh ä¸­å†å¼•å…¥ API Gateway ä¹Ÿå¯èƒ½å¸¦æ¥ä¸€äº›å¼Šç«¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼•å…¥äº† API Gatewayï¼Œéœ€è¦è€ƒè™‘ API Gateway æœ¬èº«çš„éƒ¨ç½²ã€è¿ç»´ã€è´Ÿè½½å‡è¡¡ç­‰åœºæ™¯ï¼Œå¢åŠ äº†åç«¯æœåŠ¡çš„å¤æ‚åº¦&lt;/li&gt;
&lt;li&gt;API Gateway ä¸­æ‰¿è½½äº†å¤§é‡çš„æ¥å£é€‚é…ï¼Œå¯¼è‡´éš¾ä»¥ç»´æŠ¤&lt;/li&gt;
&lt;li&gt;å¯¹äºéƒ¨åˆ†åœºæ™¯ï¼Œå¢åŠ äº†ä¸€è·³å¯èƒ½å¯¼è‡´æ€§èƒ½çš„é™ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio mesh ä¸­ä½ å¯ä»¥ä½¿ç”¨å¤šç§ Kubernetes Ingress Controller æ¥å……å½“å…¥å£ç½‘å…³ï¼Œå½“ç„¶ä½ è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ Istio å†…ç½®çš„ Istio ç½‘å…³ï¼Œå¯¹äºç­–ç•¥æ§åˆ¶ã€æµé‡ç®¡ç†å’Œç”¨é‡ç›‘æ§å¯ä»¥ç›´æ¥é€šè¿‡ Istio ç½‘å…³æ¥å®Œæˆï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯é€šè¿‡ Istio çš„æ§åˆ¶å¹³é¢æ¥ç›´æ¥ç®¡ç†ç½‘å…³ï¼Œè€Œä¸éœ€è¦å†å€ŸåŠ©å…¶ä»–å·¥å…·ã€‚ä½†æ˜¯å¯¹äº API ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å¤æ‚çš„è®¡è´¹ã€åè®®è½¬æ¢å’Œè®¤è¯ç­‰åŠŸèƒ½ï¼Œä¼ ç»Ÿçš„ API ç½‘å…³å¯èƒ½æ›´é€‚åˆä½ ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æœ‰äº›ä¼ ç»Ÿçš„åå‘ä»£ç†ä¹Ÿåœ¨å‘ Service Mesh æ–¹å‘å‘å±•ï¼Œå¦‚ Nginx æ„å»ºäº† &lt;a href=&#34;https://www.nginx.com/products/nginx-service-mesh/&#34; title=&#34;Nginx Service Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nginx Service Mesh&lt;/a&gt;
ï¼ŒTraefik æ„å»ºäº† &lt;a href=&#34;https://traefik.io/traefik-mesh/&#34; title=&#34;Traefik Mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik Mesh&lt;/a&gt;
ã€‚è¿˜æœ‰çš„ API ç½‘å…³äº§å“ä¹Ÿå‘ Service Mesh æ–¹å‘æŒºè¿›ï¼Œæ¯”å¦‚ Kong å‘å±•å‡ºäº† &lt;a href=&#34;https://kuma.io&#34; title=&#34;Kuma&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kuma&lt;/a&gt;
ã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ›´å¤š API ç½‘å…³ã€åå‘ä»£ç†å’ŒæœåŠ¡ç½‘æ ¼çš„èåˆäº§å“å‡ºç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/evolving-kubernetes-networking-with-the-gateway-api/&#34; title=&#34;åˆ©ç”¨ Gateway API å‘å±• Kubernetes ç½‘ç»œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ©ç”¨ Gateway API å‘å±• Kubernetes ç½‘ç»œ&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/how-to-pick-gateway-for-service-mesh/&#34; title=&#34;å¦‚ä½•ä¸ºæœåŠ¡ç½‘æ ¼é€‰æ‹©å…¥å£ç½‘å…³ï¼Ÿ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•ä¸ºæœåŠ¡ç½‘æ ¼é€‰æ‹©å…¥å£ç½‘å…³ï¼Ÿ&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/service-mesh-and-api-gateway/&#34; title=&#34;Service Mesh å’Œ API Gateway å…³ç³»æ·±åº¦æ¢è®¨&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh å’Œ API Gateway å…³ç³»æ·±åº¦æ¢è®¨&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/using-traefik-ingress-controller-with-istio-service-mesh/&#34; title=&#34;åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨ Traefik Ingress Controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨ Traefik Ingress Controller&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼ä¹‹æ—…â€”â€”ä½¿ç”¨ Kubernetes å’Œ Istio Service Mesh æ„å»ºæ··åˆäº‘</title>
      <link>https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/</link>
      <pubDate>Mon, 12 Jul 2021 22:22:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/</guid>
      <description>
        
        
        &lt;p&gt;è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ äº†è§£ä½¿ç”¨ Kubernetes å’Œ Istio Service Mesh æ„å»ºå¤šé›†ç¾¤åŠæ··åˆäº‘çš„è¿‡ç¨‹å’Œéœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes&#34;&gt;Kubernetes&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Kubernetes å¯ä»¥å¿«é€Ÿéƒ¨ç½²ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒï¼Œå®ç°äº†äº‘çš„äº’æ“ä½œæ€§ï¼Œç»Ÿä¸€äº†äº‘ä¸Šçš„æ§åˆ¶å¹³é¢ã€‚å¹¶æä¾›äº† Serviceã€Ingress å’Œ &lt;a href=&#34;https://kubernetes.io/blog/2021/04/22/evolving-kubernetes-networking-with-the-gateway-api/&#34; title=&#34;Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;
 ç­‰èµ„æºå¯¹è±¡æ¥å¤„ç†åº”ç”¨ç¨‹åºçš„æµé‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒKubernetes ä¸­é»˜è®¤ä½¿ç”¨ Service åšæœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ŒæœåŠ¡ä¹‹é—´å¯ä»¥ä½¿ç”¨æœåŠ¡åç§°æ¥è®¿é—®ã€‚Kubernetes API Server ä¸é›†ç¾¤å†…çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶é€šä¿¡ï¼Œä¸ºèŠ‚ç‚¹åˆ›å»º iptables è§„åˆ™ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»– pod ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å‡å®šç°åœ¨å®¢æˆ·ç«¯è¦è®¿é—® Kubernetes ä¸­çš„æœåŠ¡ï¼Œé¦–å…ˆè¯·æ±‚ä¼šå‘é€åˆ° Ingress/Gateway ä¸Šï¼Œç„¶åæ ¹æ® Ingress/Gateway é‡Œçš„è·¯ç”±é…ç½®è½¬å‘åˆ°åç«¯æœåŠ¡ä¸Šï¼ˆå›¾ä¸­æ˜¯æœåŠ¡ Aï¼‰ï¼Œæ¥ç€æœåŠ¡ A å¯¹æœåŠ¡ B è¯·æ±‚çš„æµé‡è½¬å‘è½®è¯¢åˆ°æœåŠ¡ B çš„å®ä¾‹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg6a11l1j31lu0u042s.jpg&#34; data-img=&#34;/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg6a11l1j31lu0u042s.jpg&#34; data-width=&#34;2082&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-å¤šé›†ç¾¤ç®¡ç†&#34;&gt;Kubernetes å¤šé›†ç¾¤ç®¡ç†&lt;/h2&gt;
&lt;p&gt;å¤šé›†ç¾¤ç®¡ç†æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬æœåŠ¡æµé‡è´Ÿè½½å‡è¡¡ã€éš”ç¦»å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒã€è§£è€¦æ•°æ®å¤„ç†å’Œæ•°æ®å­˜å‚¨ã€è·¨äº‘å¤‡ä»½å’Œç¾éš¾æ¢å¤ã€çµæ´»åˆ†é…è®¡ç®—èµ„æºã€è·¨åŒºåŸŸæœåŠ¡çš„ä½å»¶è¿Ÿè®¿é—®ä»¥åŠé¿å…å‚å•†é”å®šç­‰ã€‚ä¸€ä¸ªä¼ä¸šå†…éƒ¨å¾€å¾€æœ‰å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œç”± MultiCluster SIG å¼€å‘çš„ KubeFed å®ç° Kubernetes é›†ç¾¤è”é‚¦å¯ä»¥å®ç°å¤šé›†ç¾¤ç®¡ç†çš„åŠŸèƒ½ï¼Œè¿™ä½¿å¾—æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½é€šè¿‡åŒä¸€ä¸ªæ¥å£æ¥ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨é›†ç¾¤è”é‚¦æ—¶éœ€è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé€šç”¨é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®éœ€è¦è”é‚¦å“ªäº›é›†ç¾¤&lt;/li&gt;
&lt;li&gt;éœ€è¦åœ¨é›†ç¾¤ä¸­ä¼ æ’­çš„ API èµ„æº&lt;/li&gt;
&lt;li&gt;é…ç½® API èµ„æºå¦‚ä½•åˆ†é…åˆ°ä¸åŒçš„é›†ç¾¤&lt;/li&gt;
&lt;li&gt;å¯¹é›†ç¾¤ä¸­ DNS è®°å½•æ³¨å†Œä»¥å®ç°è·¨é›†ç¾¤çš„æœåŠ¡å‘ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ KubeSphere çš„å¤šé›†ç¾¤æ¶æ„ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§ Kubernetes å¤šé›†ç¾¤ç®¡ç†æ¶æ„ï¼Œå…¶ä¸­ Host Cluster ä½œä¸ºæ§åˆ¶å¹³é¢ï¼Œæœ‰ä¸¤ä¸ªæˆå‘˜é›†ç¾¤ï¼Œåˆ†åˆ«æ˜¯ West å’Œ Eastã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg7a2ojvj31aa0u0491.jpg&#34; data-img=&#34;/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg7a2ojvj31aa0u0491.jpg&#34; data-width=&#34;1666&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Multicluster&#34;&gt;
    
  
  &lt;figcaption&gt;Multicluster&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Host é›†ç¾¤éœ€è¦èƒ½å¤Ÿè®¿é—® Member é›†ç¾¤çš„ API Serverï¼ŒMember é›†ç¾¤ä¹‹é—´çš„ç½‘ç»œè¿é€šæ€§æ²¡æœ‰è¦æ±‚ã€‚ç®¡ç†é›†ç¾¤ Host Cluster ç‹¬ç«‹äºå…¶æ‰€ç®¡ç†çš„æˆå‘˜é›†ç¾¤ï¼ŒMember Cluster å¹¶ä¸çŸ¥é“ Host Cluster å­˜åœ¨ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å½“æ§åˆ¶å¹³é¢å‘ç”Ÿæ•…éšœæ—¶ä¸ä¼šå½±å“åˆ°æˆå‘˜é›†ç¾¤ï¼Œå·²ç»éƒ¨ç½²çš„è´Ÿè½½ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå—åˆ°å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;Host é›†ç¾¤åŒæ—¶æ‰¿æ‹…ç€ API å…¥å£çš„ä½œç”¨ï¼Œç”± Host Cluster å°†å¯¹ Member é›†ç¾¤çš„èµ„æºè¯·æ±‚è½¬å‘åˆ° Member é›†ç¾¤ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯æ–¹ä¾¿èšåˆï¼Œè€Œä¸”ä¹Ÿåˆ©äºåšç»Ÿä¸€çš„æƒé™è®¤è¯ã€‚æˆ‘ä»¬çœ‹åˆ°åœ¨ Host Cluster ä¸­æœ‰è”é‚¦æ§åˆ¶å¹³é¢ï¼Œå…¶ä¸­çš„ Push Reconciler ä¼šå°†è”é‚¦é›†ç¾¤ä¸­èº«ä»½ã€è§’è‰²åŠè§’è‰²ç»‘å®šä¼ æ’­åˆ°æ‰€æœ‰æˆå‘˜é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio&#34;&gt;Istio&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœ¨ Kubernetes ä¸­è¿è¡Œç€å¤šè¯­è¨€ã€å¤šç‰ˆæœ¬çš„å¾®æœåŠ¡ï¼Œå¹¶éœ€è¦æ›´ç»†ç²’åº¦çš„é‡‘ä¸é›€å‘å¸ƒå’Œç»Ÿä¸€çš„å®‰å…¨ç­–ç•¥ç®¡ç†ï¼Œå®ç°æœåŠ¡é—´çš„å¯è§‚å¯Ÿæ€§æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Istio æœåŠ¡ç½‘æ ¼ã€‚Istio é€šè¿‡å‘åº”ç”¨ç¨‹åº Pod ä¸­æ³¨å…¥ sidecar proxyï¼Œç¼ºçœä½¿ç”¨ IPTables é€æ˜å¾—æ‹¦æˆªè¿›å‡ºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰æµé‡ï¼Œä»è€Œå®ç°äº†åº”ç”¨å±‚åˆ°é›†ç¾¤ä¸­å…¶ä»–å¯ç”¨æœåŠ¡ç½‘æ ¼çš„æœåŠ¡çš„æ™ºèƒ½åº”ç”¨æ„ŸçŸ¥è´Ÿè½½å‡è¡¡ï¼Œå¹¶ç»•è¿‡äº†åˆçº§çš„ kube-proxy è´Ÿè½½å‡è¡¡ã€‚Istio æ§åˆ¶å¹³é¢ä¸ Kubernetes API Server é€šä¿¡å¯ä»¥è·å–é›†ç¾¤ä¸­æ‰€æœ‰æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† Istio çš„åŸºæœ¬åŸç†ï¼Œå…¶ä¸­æ‰€æœ‰èŠ‚ç‚¹å±äºåŒä¸€ä¸ª Kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg6sdrk2j32v60u0qbb.jpg&#34; data-img=&#34;/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg6sdrk2j32v60u0qbb.jpg&#34; data-width=&#34;3714&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Istio Service Mesh&#34;&gt;
    
  
  &lt;figcaption&gt;Istio Service Mesh&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½æœ€ç»ˆä¼šæœ‰è‡³å°‘å‡ ä¸ª Kubernetes é›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æ‰¿è½½ç€å¾®æœåŠ¡ã€‚Istio çš„å¤šé›†ç¾¤éƒ¨ç½²æ ¹æ®ç½‘ç»œéš”ç¦»ã€ä¸»å¤‡æƒ…å†µå­˜åœ¨å¤šç§&lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/&#34; title=&#34;éƒ¨ç½²æ¨¡å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨ç½²æ¨¡å¼&lt;/a&gt;
ï¼Œå¯ä»¥ä½¿ç”¨ Istio Operator éƒ¨ç½²æ—¶é€šè¿‡å£°æ˜æ¥æŒ‡å®šã€‚é›†ç¾¤ä¸­çš„è¿™äº›å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡æœåŠ¡ç½‘æ ¼æ¥åŠ å¼ºã€‚åœ¨é›†ç¾¤å†…éƒ¨ï¼ŒIstio æä¾›é€šç”¨çš„é€šä¿¡æ¨¡å¼ï¼Œä»¥æé«˜å¼¹æ€§ã€å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šéƒ½æ˜¯å…³äº Kubernetes ä¸Šçš„åº”ç”¨è´Ÿè½½ç®¡ç†ï¼Œä½†æ˜¯å¯¹äºè™šæ‹Ÿæœºä¸Šé—ç•™åº”ç”¨ï¼Œå¦‚ä½•åœ¨åŒä¸€ä¸ªå¹³é¢ä¸­ç®¡ç†ï¼Ÿå¦‚ä½•ç®¡ç†å¤šé›†ç¾¤ä¸­çš„æµé‡åˆ’åˆ†ã€ç½‘å…³å’Œå®‰å…¨æ€§å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;ç®¡ç†å¹³é¢&#34;&gt;ç®¡ç†å¹³é¢&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio ä¹‹ä¸Šå†å¢åŠ ä¸€å±‚æŠ½è±¡ï¼Œå°†ç½‘å…³ã€æµé‡å’Œå®‰å…¨åˆ†ç»„ç®¡ç†ï¼Œå¹¶å°†å®ƒä»¬åº”ç”¨åˆ°ä¸åŒçš„é›†ç¾¤å’Œå‘½åç©ºé—´ä¸Šã€‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 çš„å¤šç§Ÿæˆ·æ¨¡å‹ï¼Œåˆ©ç”¨ NGAC æ¥ç®¡ç†ç”¨æˆ·çš„è®¿é—®æƒé™ï¼ŒåŒæ—¶ä¹Ÿæœ‰åˆ©äºæ„å»ºé›¶ä¿¡ä»»ç½‘ç»œã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg8ndcajj31il0u00z9.jpg&#34; data-img=&#34;/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg8ndcajj31il0u00z9.jpg&#34; data-width=&#34;1965&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Management Plane&#34;&gt;
    
  
  &lt;figcaption&gt;Management Plane&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio æä¾›äº†å·¥ä½œè´Ÿè½½è¯†åˆ«ï¼Œå¹¶ç”±å¼ºå¤§çš„ mTLS åŠ å¯†ä¿æŠ¤ã€‚è¿™ç§é›¶ä¿¡ä»»æ¨¡å‹æ¯”åŸºäºæº IP ç­‰æ‹“æ‰‘ä¿¡æ¯æ¥ä¿¡ä»»å·¥ä½œè´Ÿè½½æ›´å¥½ã€‚åœ¨ Istio ä¹‹ä¸Šæ„å»ºä¸€ä¸ªå¤šé›†ç¾¤ç®¡ç†çš„é€šç”¨æ§åˆ¶å¹³é¢ï¼Œç„¶åå†å¢åŠ ä¸€ä¸ªç®¡ç†å¹³é¢æ¥ç®¡ç†å¤šé›†ç¾¤ï¼Œæä¾›å¤šç§Ÿæˆ·ã€ç®¡ç†é…ç½®ã€å¯è§‚å¯Ÿæ€§ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Tetrate Service Bridge çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg951mknj314g0u0dnf.jpg&#34; data-img=&#34;/blog/multicluster-management-with-kubernetes-and-istio/008i3skNly1gsgg951mknj314g0u0dnf.jpg&#34; data-width=&#34;1456&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Tetrate Service Bridge&#34;&gt;
    
  
  &lt;figcaption&gt;Tetrate Service Bridge&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Kubernetes å®ç°äº†å¼‚æ„é›†ç¾¤çš„äº’æ“ä½œæ€§ï¼ŒIstio å°†å®¹å™¨åŒ–è´Ÿè½½å’Œè™šæ‹Ÿæœºè´Ÿè½½çº³å…¥åˆ°ä¸€ä¸ªåŒä¸€ä¸ªæ§åˆ¶å¹³é¢å†…ï¼Œç»Ÿä¸€ç®¡ç†é›†ç¾¤å†…çš„æµé‡ã€å®‰å…¨å’Œå¯è§‚å¯Ÿæ€§ã€‚ä½†æ˜¯ï¼Œéšç€é›†ç¾¤æ•°é‡ã€ç½‘ç»œç¯å¢ƒå’Œç”¨æˆ·æƒé™çš„è¶Šå‘å¤æ‚ï¼Œäººä»¬è¿˜éœ€è¦åœ¨ Istio çš„æ§åˆ¶å¹³é¢è‡³ä¸Šå†æ„å»ºä¸€å±‚ç®¡ç†å¹³é¢æ¥è¿›è¡Œæ··åˆäº‘ç®¡ç†ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•è°ƒè¯• Kubernetes ä¸­çš„å¾®æœåŠ¡ â€”â€”proxyã€sidecar è¿˜æ˜¯ service meshï¼Ÿ</title>
      <link>https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/</link>
      <pubDate>Mon, 05 Jul 2021 22:22:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/</guid>
      <description>
        
        
        &lt;p&gt;Kubernetes å¯ä»¥è¯´æ˜¯ç›®å‰ä¸ºæ­¢ç”¨æ¥è¿è¡Œå¾®æœåŠ¡çš„æœ€ä½³è½½ä½“ï¼Œä½†æ˜¯åœ¨è°ƒè¯• Kubernetes ç¯å¢ƒä¸­çš„å¾®æœåŠ¡æ—¶çš„ä½“éªŒå¯èƒ½å°±æ²¡é‚£ä¹ˆå‹å¥½äº†ã€‚æœ¬æ–‡å°†å¸¦ä½ äº†è§£å¦‚ä½•è°ƒè¯• Kubernetes ä¸­çš„å¾®æœåŠ¡ï¼Œä»‹ç»å¸¸ç”¨çš„å·¥å…·ï¼Œä»¥åŠ Istio çš„å¼•å…¥ä¸ºå¾®æœåŠ¡çš„è°ƒè¯•å¸¦æ¥çš„å˜é©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è°ƒè¯•å¾®æœåŠ¡ä¸ä¼ ç»Ÿå•ä½“åº”ç”¨æœ‰å·¨å¤§çš„ä¸åŒ&#34;&gt;è°ƒè¯•å¾®æœåŠ¡ä¸ä¼ ç»Ÿå•ä½“åº”ç”¨æœ‰å·¨å¤§çš„ä¸åŒ&lt;/h2&gt;
&lt;p&gt;å¾®æœåŠ¡çš„è°ƒè¯•æ˜¯ä¸€ç›´é•¿æœŸå›°æ‰°è½¯ä»¶å¼€å‘äººå‘˜çš„é—®é¢˜ï¼Œè¿™åœ¨ä¼ ç»Ÿçš„å•ä½“åº”ç”¨ä¸­ä¸å­˜åœ¨ï¼Œå› ä¸ºå¼€å‘è€…å¯ä»¥åˆ©ç”¨ IDE ä¸­çš„è°ƒè¯•å™¨ï¼Œä¸ºåº”ç”¨ç¨‹åºå¢åŠ æ–­ç‚¹ã€ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œå•æ­¥æ‰§è¡Œç­‰ï¼Œè¿™äº›éƒ½ä¸ºè½¯ä»¶è°ƒè¯•æä¾›äº†å·¨å¤§å¸®åŠ©ã€‚éšç€ Kubernetes çš„æµè¡Œï¼Œå¾®æœåŠ¡çš„è°ƒè¯•å°±æˆäº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼Œå…¶ä¸­ç›¸æ¯”ä¼ ç»Ÿå•ä½“åº”ç”¨çš„è°ƒè¯•å¤šäº†ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;h3 id=&#34;å¤šä¾èµ–&#34;&gt;å¤šä¾èµ–&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå¾®æœåŠ¡å¾€å¾€ä¾èµ–å¤šä¸ªå…¶ä»–å¾®æœåŠ¡ï¼Œåœ¨è°ƒè¯•æŸä¸ªå¾®æœåŠ¡æ—¶ï¼Œå¦‚ä½•éƒ¨ç½²å…¶ä»–ä¾èµ–æœåŠ¡ä»¥å¿«é€Ÿæ­å»ºä¸€å¥—æœ€æ–°çš„ stagging ç¯å¢ƒï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;ä»æœ¬åœ°æœºå™¨è®¿é—®&#34;&gt;ä»æœ¬åœ°æœºå™¨è®¿é—®&lt;/h3&gt;
&lt;p&gt;å¾®æœåŠ¡åœ¨å¼€å‘è€…çš„æœ¬åœ°ç”µè„‘ä¸Šè¿è¡Œæ—¶ï¼Œé€šå¸¸æ— æ³•ç›´æ¥è®¿é—®åˆ° Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡ï¼Œå¦‚ä½•åƒè°ƒè¯•æœ¬åœ°æœåŠ¡ä¸€æ ·è°ƒè¯•éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­çš„å¾®æœåŠ¡ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;å¼€å‘æ•ˆç‡ä½ä¸‹&#34;&gt;å¼€å‘æ•ˆç‡ä½ä¸‹&lt;/h3&gt;
&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œä»£ç ä»æ›´æ–°åˆ°æ„å»ºæˆé•œåƒå†æ¨é€åˆ°é›†ç¾¤ä¸­éœ€è¦ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œå¦‚ä½•åŠ å¿«å¼€å‘é€Ÿåº¦ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹å“ªäº›å·¥å…·èƒ½å¤Ÿè§£å†³ä»¥ä¸Šé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å·¥å…·&#34;&gt;å·¥å…·&lt;/h2&gt;
&lt;p&gt;è°ƒè¯• Kubernetes ä¸­çš„å¾®æœåŠ¡çš„ä¸»è¦è§£å†³æ–¹æ¡ˆæœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Proxyï¼šåœ¨ Kubernetes é›†ç¾¤å’Œæœ¬åœ°è°ƒè¯•ç»ˆç«¯ä¸­éƒ¨ç½²ä¸€ä¸ªä»£ç†ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ª VPNï¼Œä½¿å¾—æœ¬åœ°åº”ç”¨å¯ä»¥ç›´æ¥è®¿é—®åˆ° Kubernetes ä¸­çš„æœåŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;Sidecarï¼šæ›¿æ¢åŸæ¥åº”ç”¨å®¹å™¨çš„é•œåƒä¸ºå¼€å‘é•œåƒï¼Œå¯ä»¥åœ¨è¿™ä¸ªå®¹å™¨ä¸­ä¸­å¯¹è¯¥æœåŠ¡è¿›è¡Œè°ƒè¯•ï¼ŒåŒæ—¶åœ¨è¦è°ƒè¯•çš„å¾®æœåŠ¡ pod ä¸­æ³¨å…¥ä¸€ä¸ª sidecar ä½œä¸ºè¾…åŠ©å·¥å…·æ¥åŒæ­¥ä»£ç ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼ï¼šè¦æƒ³äº†è§£åº”ç”¨çš„æ•´ä½“æƒ…å†µï¼Œå°±éœ€è¦åœ¨æ‰€æœ‰å¾®æœåŠ¡ä¸­æ³¨å…¥ sidecarï¼Œè¿™æ ·ä½ å°±å¯ä»¥è·å¾—ä¸€ä¸ªç›‘æ§å…¨å±€çŠ¶æ€çš„ä»ªè¡¨æ¿ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å®ç°ä»¥ä¸Šè§£å†³æ–¹æ¡ˆçš„ä¸‰ä¸ªå…¸å‹çš„å¼€æºé¡¹ç›®ï¼Œå®ƒä»¬åˆ†åˆ«ä»ä¸åŒçš„è§’åº¦å¯ä»¥å¸®åŠ©ä½ è°ƒè¯•å¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;proxy-æ¨¡å¼telepresence&#34;&gt;Proxy æ¨¡å¼ï¼šTelepresence&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.telepresence.io/&#34; title=&#34;Telesprence&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Telesprence&lt;/a&gt;
 æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœ¬åœ°ä»£ç†ï¼Œè¯¥ä»£ç†å°† Kubernetes é›†ç¾¤ä¸­çš„æ•°æ®å·ã€ç¯å¢ƒå˜é‡ã€ç½‘ç»œéƒ½ä»£ç†åˆ°äº†æœ¬åœ°ã€‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Teleprence çš„ä¸»è¦ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/telepresence.jpg&#34; data-img=&#34;/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/telepresence.jpg&#34; data-width=&#34;1080&#34; data-height=&#34;1197&#34; alt=&#34;image&#34; data-caption=&#34;Proxy æ¨¡å¼ï¼šTelepresence&#34;&gt;
    
  
  &lt;figcaption&gt;Proxy æ¨¡å¼ï¼šTelepresence&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·éœ€è¦åœ¨æœ¬åœ°è‡ªä¸»åœ°æ‰§è¡Œ &lt;code&gt;telepresence&lt;/code&gt; å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨å°†ä»£ç†éƒ¨ç½²åˆ° Kubernetes ä¸­ï¼Œæœ‰äº†è¯¥ä»£ç†ä¹‹åï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°çš„æœåŠ¡å°±å¯ä»¥å®Œæ•´çš„è®¿é—®åˆ° Kubernetes é›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡ã€ç¯å¢ƒå˜é‡ã€Secretã€ConfigMap ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ä¸­çš„æœåŠ¡è¿˜èƒ½ç›´æ¥è®¿é—®åˆ°æœ¬åœ°æš´éœ²å‡ºæ¥çš„ç«¯ç‚¹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯è¿™ç§æ–¹å¼ä»ç„¶ä¸å¤Ÿè¿è´¯ï¼Œè¿˜éœ€è¦ç”¨æˆ·åœ¨æœ¬åœ°è°ƒè¯•æ—¶è¿è¡Œå¤šæ¬¡å‘½ä»¤ï¼Œè€Œä¸”åœ¨æŸäº›ç½‘ç»œç¯å¢ƒä¸‹å¯èƒ½æ— æ³•ä¸ Kubernetes é›†ç¾¤å»ºç«‹ VPN è¿æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sidecar-æ¨¡å¼nocalhost&#34;&gt;Sidecar æ¨¡å¼ï¼šNocalhost&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://nocalhost.dev/&#34; title=&#34;Nocalhost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nocalhost&lt;/a&gt;
 æ˜¯ä¸€ä¸ªåŸºäº Kubernetes çš„äº‘ç«¯å¼€å‘ç¯å¢ƒã€‚è¦æƒ³ä½¿ç”¨å®ƒï¼Œä½ åªéœ€è¦åœ¨ä½ çš„ IDEâ€”â€”VS Code ä¸­å®‰è£…ä¸€ä¸ªæ’ä»¶å³å¯æ‰©å±• Kubernetesï¼Œå¹¶ç¼©çŸ­å¼€å‘åé¦ˆå‘¨æœŸã€‚é€šè¿‡ä¸ºä¸åŒçš„ç”¨æˆ·åˆ›å»ºä¸åŒçš„ namespaceï¼Œå¹¶ä½¿ç”¨ ServiceAccount ç»‘å®šåˆ°ä¸åŒç”¨æˆ·è§’èº«ä¸Šæ—¶ï¼Œå°±å¯ä»¥å®ç°å¼€å‘ç¯å¢ƒéš”ç¦»ã€‚åŒæ—¶ï¼ŒNocalhost è¿˜æä¾›äº† Web æ§åˆ¶å°å’Œ APIï¼Œæ–¹ä¾¿ç®¡ç†å‘˜æ¥ç®¡ç†ä¸åŒçš„å¼€å‘ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/sidecar-nocalhost.jpg&#34; data-img=&#34;/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/sidecar-nocalhost.jpg&#34; data-width=&#34;1928&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Sidecar æ¨¡å¼ï¼šNocalhost&#34;&gt;
    
  
  &lt;figcaption&gt;Sidecar æ¨¡å¼ï¼šNocalhost&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h4&gt;
&lt;p&gt;å‚è€ƒ &lt;a href=&#34;https://nocalhost.dev/getting-started.html&#34; title=&#34;Nocalhost æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nocalhost æ–‡æ¡£&lt;/a&gt;
ï¼Œæˆ‘ä»¬åœ¨ macOS ä¸Šå®‰è£… Nocalhostï¼Œå¹¶ä½¿ç”¨ Minikube æ¥æ¼”ç¤ºå¦‚ä½•è°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… Nocalhost å®¢æˆ·ç«¯å¹¶æŸ¥çœ‹ &lt;code&gt;nhctl&lt;/code&gt; å‘½ä»¤è¡Œå·¥å…·çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;brew install nocalhost/repo/nocalhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nhctl version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å‡è®¾ä½ æœºçš„ &lt;code&gt;kubeconfig&lt;/code&gt; æ–‡ä»¶ä½äº &lt;code&gt;~/.kube/config&lt;/code&gt;ï¼ˆè‹¥ä¸åœ¨æ­¤ä½ç½®éœ€è¦åœ¨ä¸‹é¢çš„å‘½ä»¤ä¸­ä½¿ç”¨ &lt;code&gt;--kubeconfig&lt;/code&gt; æ‰‹åŠ¨æŒ‡å®šï¼‰å¹¶æ‹¥æœ‰ Kubernetes é›†ç¾¤çš„ admin è§’è‰²ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ Helm3 åœ¨ Kubernetes ä¸Šå®‰è£… Nocalhost æœåŠ¡ç«¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nhctl init demo -n nocalhost 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ Minikube éš§é“å¹¶æŸ¥çœ‹ Nocalhost web ç«¯åœ°å€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;minikube tunnel
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get service nocalhost-web
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—® &lt;code&gt;http://&amp;lt;EXTERNAL-IP&amp;gt;&lt;/code&gt; å³å¯ï¼Œç”¨æˆ·å/å¯†ç ä¸ºï¼š&lt;code&gt;admin@admin.com/123456&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³åœ¨ VS Code ä¸­ä½¿ç”¨ï¼Œä½ è¿˜æƒ³éœ€è¦åˆ›å»ºä¸€ä¸ª ServiceAccount å¹¶ç»‘å®š admin è§’è‰²ï¼Œç„¶åå°†è¯¥ ServiceAccount ä½œä¸º Kubeconfig æ–‡ä»¶å¯¼å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create serviceaccount my-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create rolebinding admin --clusterrole&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin --serviceaccount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;default:my-service-account
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åªè¦ä½ æœ‰ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå¹¶æœ‰é›†ç¾¤çš„ admin æƒé™ï¼Œå°±å¯ä»¥å‚è€ƒ Nocalhost çš„æ–‡æ¡£å¿«é€Ÿå¼€å§‹è¯•ç”¨ã€‚åœ¨ VS Code ä¸­ä½¿ç”¨ Nocalhost æ’ä»¶æ—¶éœ€è¦å…ˆä¸ºæ’ä»¶ä¸­é…ç½® Kubernetes é›†ç¾¤ã€‚é€‰æ‹©ä½ åˆšå¯¼å‡ºçš„ Kubeconfig æ–‡ä»¶æˆ–è€…ç›´æ¥å¤åˆ¶æ–‡ä»¶ä¸­çš„å†…å®¹ç²˜è´´åˆ°é…ç½®é‡Œã€‚ç„¶åé€‰æ‹©ä½ éœ€è¦æµ‹è¯•çš„æœåŠ¡ï¼Œå¹¶é€‰æ‹©å¯¹åº”çš„ Dev Containerï¼ŒVS Code ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªæ–°çš„ä»£ç çª—å£ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä»¥ Istio å®˜æ–¹æä¾›çš„ &lt;a href=&#34;https://istio.io/latest/docs/examples/bookinfo/&#34; title=&#34;bookinfo ç¤ºä¾‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo ç¤ºä¾‹&lt;/a&gt;
ä¸ºä¾‹ï¼Œä½ å¯ä»¥åœ¨æœ¬åœ° IDE ä¸­æ‰“å¼€å…‹éš†ä¸‹æ¥çš„ä»£ç ï¼Œç„¶åç‚¹å‡»ä»£ç æ–‡ä»¶æ—è¾¹çš„é”¤å­å³å¯è¿›å…¥å¼€å‘æ¨¡å¼ã€‚é€‰æ‹©å¯¹åº”çš„ DevContainerï¼Œnocalhost ä¼šè‡ªåŠ¨å‘ pod ä¸­æ³¨å…¥ä¸€ä¸ªå¼€å‘å®¹å™¨ sidecarï¼Œå¹¶åœ¨ç»ˆç«¯ä¸­è‡ªåŠ¨è¿›å…¥è¯¥å®¹å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/nocalhost-vs-code.jpg&#34; data-img=&#34;/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/nocalhost-vs-code.jpg&#34; data-width=&#34;1722&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Nocalhost VS code ç•Œé¢&#34;&gt;
    
  
  &lt;figcaption&gt;Nocalhost VS code ç•Œé¢&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å‘æ¨¡å¼ä¸­ï¼Œæœ¬åœ°ä¿®æ”¹ä»£ç ï¼Œæ— éœ€é‡æ–°æ„å»ºé•œåƒï¼Œè¿œç«¯å¼€å‘ç¯å¢ƒå®æ—¶ç”Ÿæ•ˆï¼Œè¿™æ ·å¯ä»¥æå¤§çš„åŠ å¿«å¼€å‘é€Ÿåº¦ã€‚åŒæ—¶ï¼ŒNocalhost è¿˜æä¾›äº†æœåŠ¡ç«¯ï¼Œå¯ç”¨äºå¼€å‘ç¯å¢ƒå’Œç”¨æˆ·æƒé™è¿›è¡Œç®¡ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/nocalhost-web-admin.jpg&#34; data-img=&#34;/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/nocalhost-web-admin.jpg&#34; data-width=&#34;2354&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Nocalhost web ç«¯&#34;&gt;
    
  
  &lt;figcaption&gt;Nocalhost web ç«¯&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;service-mesh-æ¨¡å¼istio&#34;&gt;Service Mesh æ¨¡å¼ï¼šIstio&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šä½¿ç”¨ proxy å’Œ sidecar çš„æ–¹å¼ï¼Œä¸€æ¬¡åªèƒ½å¯¹ä¸€ä¸ªæœåŠ¡è¿›è¡Œè°ƒè¯•ï¼Œå¦‚æœæƒ³è¦æŒæ¡æœåŠ¡çš„å…¨å±€çŠ¶å†µï¼Œæ¯”å¦‚è·å–çš„æœåŠ¡çš„æŒ‡æ ‡ï¼Œä»¥åŠé€šè¿‡åˆ†å¸ƒå¼è¿½è¸ªäº†è§£æœåŠ¡çš„ä¾èµ–å’Œè°ƒç”¨æµç¨‹ï¼Œå¯¹æœåŠ¡çš„æ€§èƒ½è¿›è¡Œè°ƒè¯•ã€‚è¿™äº›&lt;a href=&#34;https://istio.io/latest/zh/docs/concepts/observability/&#34; title=&#34;å¯è§‚å¯Ÿæ€§&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯è§‚å¯Ÿæ€§&lt;/a&gt;
çš„åŠŸèƒ½ï¼Œéœ€è¦ä¸ºæ‰€æœ‰æœåŠ¡ç»Ÿä¸€æ³¨å…¥ sidecar æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”ï¼Œå½“ä½ çš„æœåŠ¡æ­£å¤„äºä»è™šæ‹Ÿæœºè¿ç§»åˆ° Kubernetes çš„è¿‡ç¨‹ä¸­æ—¶ï¼Œä½¿ç”¨ Istio å¯ä»¥å°†è™šæ‹Ÿæœºä¸ Kubernetes çº³å…¥ä¸€ä¸ªç½‘ç»œå¹³é¢ä¸­ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œæ–¹ä¾¿å¼€å‘è€…è°ƒè¯•å’Œåšæ¸è¿›å¼çš„è¿ç§»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/istio-service-mesh.jpg&#34; data-img=&#34;/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/istio-service-mesh.jpg&#34; data-width=&#34;1956&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Serivce Mesh æ¨¡å¼ï¼šIstio&#34;&gt;
    
  
  &lt;figcaption&gt;Serivce Mesh æ¨¡å¼ï¼šIstio&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¦è·å¾—è¿™äº›å¥½å¤„ä¹Ÿä¸æ˜¯ä¸€ç‚¹â€œä»£ä»·â€ä¹Ÿä¸æ²¡æœ‰çš„ï¼Œå¼•å…¥ Istio åï¼Œä½ çš„ Kubernetes  service éœ€è¦éµå®ˆ Istio çš„&lt;a href=&#34;https://istio.io/latest/zh/docs/ops/deployment/requirements/&#34; title=&#34;å‘½åè§„èŒƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘½åè§„èŒƒ&lt;/a&gt;
ï¼Œå­¦ä¹ ä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/ops/diagnostic-tools/istioctl-analyze/&#34; title=&#34;Istioctl&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istioctl&lt;/a&gt;
 å‘½ä»¤è¡Œå’Œæ—¥å¿—çš„æ–¹å¼æ¥è°ƒè¯•å¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istioctl analyze&lt;/code&gt; å‘½ä»¤æ¥è°ƒè¯•é›†ç¾¤ä¸­çš„å¾®æœåŠ¡éƒ¨ç½²æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ YAML æ–‡ä»¶æ¥æ£€æŸ¥æŸä¸ªå‘½åç©ºé—´æˆ–æ•´ä¸ªé›†ç¾¤ä¸­çš„èµ„æºéƒ¨ç½²æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istioctl proxy-config secret&lt;/code&gt;  æ¥è°ƒè¯• service mesh ä¸­çš„ pod çš„ secret è¢«æ­£ç¡®çš„åŠ è½½å¹¶æœ‰æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio çš„é…ç½®ä¿¡æ¯åœ¨å¤§å‹çš„é›†ç¾¤éƒ¨ç½²ä¸­ä¼ æ’­å°†ä¼šè€—æ—¶æ›´é•¿å¹¶ä¸”å¯èƒ½æœ‰å‡ ç§’é’Ÿçš„å»¶è¿Ÿæ—¶é—´ï¼Œsidecar çš„å¼•å…¥ä¼šç»™æœåŠ¡é—´è°ƒç”¨å¸¦æ¥ä¸€å®šå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨åº”ç”¨å¾®æœåŠ¡åŒ–å’Œä»è™šæ‹Ÿæœºè¿ç§»åˆ° Kubernetes çš„è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…éœ€è¦å¾ˆå¤šè§‚å¿µå’Œä¹ æƒ¯ä¸Šçš„è½¬å˜ã€‚é€šè¿‡ proxy åœ¨æœ¬åœ°è·Ÿ Kubernetes é—´æ„å»º VPNï¼Œå¯ä»¥æ–¹ä¾¿å¼€å‘è€…åƒè°ƒè¯•æœ¬åœ°æœåŠ¡ä¸€æ ·è°ƒè¯• Kubernetes ä¸­çš„æœåŠ¡ã€‚é€šè¿‡å‘ pod ä¸­æ³¨å…¥ sidecarï¼Œå¯ä»¥å®ç°å®æ—¶è°ƒè¯•ï¼ŒåŠ å¿«å¼€å‘è¿›åº¦ã€‚æœ€åï¼ŒIstio service mesh çœŸæ­£å®ç°äº†å…¨å±€çš„å¯è§‚å¯Ÿæ€§ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨åƒ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 è¿™æ ·çš„å·¥å…·æ¥ç®¡ç†å¼‚æ„å¹³å°ï¼Œå¸®åŠ©ä½ æ¸æ¸åœ°ä»å•ä½“åº”ç”¨è¿‡åº¦åˆ°å¾®æœåŠ¡ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio å¼€æºå››å‘¨å¹´å›é¡¾ä¸å±•æœ›</title>
      <link>https://jimmysong.io/blog/istio-4-year-birthday/</link>
      <pubDate>Mon, 24 May 2021 08:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-4-year-birthday/</guid>
      <description>
        
        
        &lt;p&gt;Istio æ˜¯ç”± &lt;a href=&#34;https://tetrate.io/&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;
 åˆ›å§‹äºº Varun Talwar å’Œè°·æ­Œé¦–å¸­å·¥ç¨‹å¸ˆ Louis Ryan å‘½åå¹¶åœ¨ 2017 å¹´ 5 æœˆ 24 æ—¥å¼€æºã€‚ä»Šå¤©æ˜¯ Istio å¼€æºå››å‘¨å¹´ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹ Istio å››å¹´æ¥çš„å‘å±•å¹¶å±•æœ›ä¸€ä¸‹å®ƒçš„æœªæ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„å¼€æºå†å²&#34;&gt;Istio çš„å¼€æºå†å²&lt;/h2&gt;
&lt;p&gt;2017 å¹´æ˜¯ Kubernetes ç»“æŸå®¹å™¨ç¼–æ’ä¹‹æˆ˜çš„ä¸€å¹´ï¼ŒGoogle ä¸ºäº†å·©å›ºåœ¨äº‘åŸç”Ÿé¢†åŸŸçš„ä¼˜åŠ¿ï¼Œå¹¶å¼¥è¡¥ Kubernetes åœ¨æœåŠ¡é—´æµé‡ç®¡ç†æ–¹é¢çš„åŠ£åŠ¿ï¼Œè¶åŠ¿å¼€æºäº† Istioã€‚ä¸‹é¢æ˜¯æˆªæ­¢ç›®å‰ Istio å†å²ä¸Šæœ€é‡è¦çš„å‡ æ¬¡ç‰ˆæœ¬å‘å¸ƒã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ—¥æœŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;ç‰ˆæœ¬&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;2017-05-24&lt;/td&gt;
&lt;td&gt;0.1&lt;/td&gt;
&lt;td&gt;æ­£å¼å¼€æºï¼Œè¯¥ç‰ˆæœ¬å‘å¸ƒæ—¶ä»…ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚ç¡®ç«‹äº†åŠŸèƒ½èŒƒå›´å’Œ sidecar éƒ¨ç½²æ¨¡å¼ï¼Œç¡®ç«‹çš„ Envoy ä½œä¸ºé»˜è®¤ sidecar proxy çš„åœ°ä½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2017-10-10&lt;/td&gt;
&lt;td&gt;0.2&lt;/td&gt;
&lt;td&gt;æ”¯æŒå¤šè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¦‚è™šæ‹Ÿæœºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2018-06-01&lt;/td&gt;
&lt;td&gt;0.8&lt;/td&gt;
&lt;td&gt;API é‡æ„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2018-07-31&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§å°±ç»ªï¼Œæ­¤å Istio å›¢é˜Ÿè¢«å¤§è§„æ¨¡é‡ç»„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2019-03-19&lt;/td&gt;
&lt;td&gt;1.1&lt;/td&gt;
&lt;td&gt;ä¼ä¸šå°±ç»ªï¼Œæ”¯æŒå¤š Kubernetes é›†ç¾¤ï¼Œæ€§èƒ½ä¼˜åŒ–ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2020-03-03&lt;/td&gt;
&lt;td&gt;1.5&lt;/td&gt;
&lt;td&gt;å›å½’å•ä½“æ¶æ„ï¼Œæ”¯æŒ WebAssembly æ‰©å±•ï¼Œä½¿å¾— Istio çš„ç”Ÿæ€æ›´åŠ å¼ºå¤§ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2020-11-18&lt;/td&gt;
&lt;td&gt;1.8&lt;/td&gt;
&lt;td&gt;æ­£å¼æ”¾å¼ƒ Mixerï¼Œè¿›ä¸€æ­¥å®Œå–„å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Istio å¼€æºåç»è¿‡äº†ä¸€å¹´æ—¶é—´çš„å‘å±•ï¼Œåœ¨ 1.0 å‘å¸ƒçš„å‰ä¸¤ä¸ªæœˆå‘å¸ƒäº† 0.8 ç‰ˆæœ¬ï¼Œè¿™æ˜¯å¯¹ API çš„ä¸€æ¬¡å¤§è§„æ¨¡é‡æ„ã€‚è€Œåœ¨ 2018 å¹´ 7 æœˆåº•å‘å¸ƒ 1.0 æ—¶ï¼ŒIstio è¾¾åˆ°äº†ç”Ÿäº§å¯ç”¨çš„ä¸´ç•Œç‚¹ï¼Œæ­¤å Google å¯¹ Istio å›¢é˜Ÿè¿›è¡Œäº†å¤§è§„æ¨¡é‡ç»„ï¼Œå¤šå®¶ä»¥ Istio ä¸ºåŸºç¡€çš„ Service Mesh &lt;a href=&#34;https://istio.io/latest/about/ecosystem/#providers&#34; title=&#34;åˆ›ä¸šå…¬å¸&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ›ä¸šå…¬å¸&lt;/a&gt;
è¯ç”Ÿï¼Œå¯ä»¥è¯´ 2018 å¹´æ˜¯æœåŠ¡ç½‘æ ¼è¡Œä¸šè¯ç”Ÿçš„å…ƒå¹´ã€‚&lt;/p&gt;
&lt;p&gt;2019 å¹´ 3 æœˆ Istio 1.1 å‘å¸ƒï¼Œè€Œè¿™è·ç¦» 1.0 å‘å¸ƒå·²ç»è¿‡å»äº†è¿‘ 9 ä¸ªæœˆï¼Œè¿™å·²ç»è¿œè¿œè¶…å‡ºä¸€ä¸ªå¼€æºé¡¹ç›®çš„å¹³å‡å‘å¸ƒå‘¨æœŸã€‚æˆ‘ä»¬çŸ¥é“è¿­ä»£å’Œè¿›åŒ–é€Ÿåº¦æ˜¯åŸºç¡€è½¯ä»¶çš„æ ¸å¿ƒç«äº‰åŠ›ï¼Œæ­¤å Istio å¼€å§‹ä»¥æ¯ä¸ªå­£åº¦ä¸€ä¸ªç‰ˆæœ¬çš„å›ºå®š&lt;a href=&#34;https://istio.io/v1.7/about/release-cadence/&#34; title=&#34;å‘å¸ƒèŠ‚å¥&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒèŠ‚å¥&lt;/a&gt;
ï¼Œå¹¶åœ¨ 2019 å¹´æˆä¸ºäº† &lt;a href=&#34;https://octoverse.github.com/#fastest-growing-oss-projects-by-contributors&#34; title=&#34;GitHub å¢é•¿æœ€å¿«çš„åå¤§é¡¹ç›®ä¸­æ’åç¬¬ 4 å&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub å¢é•¿æœ€å¿«çš„åå¤§é¡¹ç›®ä¸­æ’åç¬¬ 4 å&lt;/a&gt;
ï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-ç¤¾åŒº&#34;&gt;Istio ç¤¾åŒº&lt;/h2&gt;
&lt;p&gt;Istio å¼€æºå››å¹´æ¥ï¼Œå·²ç»åœ¨ GitHub ä¸Šæ”¶è·äº† 2.7 ä¸‡é¢—æ˜Ÿï¼Œè·å¾—äº†å¤§é‡çš„&lt;a href=&#34;https://istio.io/latest/about/case-studies/&#34; title=&#34;ç¤¾åŒºç”¨æˆ·&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒºç”¨æˆ·&lt;/a&gt;
ã€‚ä¸‹å›¾æ˜¯ &lt;a href=&#34;https://github.com/istio/istio&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
 çš„ GitHub star æ•°å¢é•¿æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-4-year-birthday/008i3skNly1gqtm7n2hm1j31me0n2tag.jpg&#34; data-img=&#34;/blog/istio-4-year-birthday/008i3skNly1gqtm7n2hm1j31me0n2tag.jpg&#34; data-width=&#34;2102&#34; data-height=&#34;830&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
    
  
  &lt;figcaption&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;2020 å¹´ Istio çš„é¡¹ç›®ç®¡ç†å¼€å§‹èµ°å‘æˆç†Ÿï¼Œæ²»ç†æ–¹å¼ä¹Ÿåˆ°äº†è¿›åŒ–çš„é˜¶æ®µã€‚2020 å¹´ï¼ŒIstio ç¤¾åŒºè¿›è¡Œäº†ç¬¬ä¸€æ¬¡&lt;a href=&#34;https://istio.io/latest/blog/2020/steering-election-results/&#34; title=&#34;ç®¡å§”ä¼šé€‰ä¸¾&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡å§”ä¼šé€‰ä¸¾&lt;/a&gt;
ï¼Œè¿˜æŠŠå•†æ ‡è½¬è®©ç»™äº† &lt;a href=&#34;https://istio.io/latest/blog/2020/open-usage/&#34; title=&#34;Open Usage Commons&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Usage Commons&lt;/a&gt;
ã€‚é¦–å±Š &lt;a href=&#34;https://events.istio.io/istiocon-2021/&#34; title=&#34;IstioCon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon&lt;/a&gt;
 åœ¨ 2021 å¹´ 2 æœˆä»½æˆåŠŸä¸¾åŠï¼Œå‡ åƒäººå‚åŠ äº†çº¿ä¸Šä¼šè®®ã€‚åœ¨ä¸­å›½ä¹Ÿæœ‰å¤§é‡çš„ Istio ç¤¾åŒºç”¨æˆ·ï¼Œ2021 å¹´ä¹Ÿä¼šæœ‰çº¿ä¸‹é¢å¯¹é¢çš„ Istio ç¤¾åŒº meetup åœ¨ä¸­å›½ä¸¾åŠã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-4-year-birthday/008i3skNly1gquicfqg14j31lw0smwl2.jpg&#34; data-img=&#34;/blog/istio-4-year-birthday/008i3skNly1gquicfqg14j31lw0smwl2.jpg&#34; data-width=&#34;2084&#34; data-height=&#34;1030&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
    
  
  &lt;figcaption&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ ¹æ® CNCF 2020 å¹´è°ƒæŸ¥ï¼Œ46% çš„ç»„ç»‡åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æœåŠ¡ç½‘æ ¼æˆ–è®¡åˆ’åœ¨æœªæ¥ 12 ä¸ªæœˆå†…ä½¿ç”¨ã€‚Istio æ˜¯åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨çš„æœ€å¤šçš„ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœªæ¥&#34;&gt;æœªæ¥&lt;/h2&gt;
&lt;p&gt;ç»è¿‡ 4 å¹´çš„å‘å±•ï¼Œå›´ç»• Istio ä¸ä»…å½¢æˆäº†åºå¤§çš„ç”¨æˆ·ç¾¤ï¼Œè¿˜è¯ç”Ÿäº†å¤šå®¶ Istio ä¾›åº”å•†ï¼Œä½ å¯ä»¥åœ¨æœ€è¿‘æ”¹ç‰ˆçš„ &lt;a href=&#34;https://istio.io&#34; title=&#34;Istio çš„å®˜ç½‘é¦–é¡µ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio çš„å®˜ç½‘é¦–é¡µ&lt;/a&gt;
ä¸­çœ‹åˆ°ã€‚åœ¨æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼ŒIstio å·²ç»å°†å‘å±•ä¸­å¿ƒè½¬ç§»åˆ°äº†æå‡ Day 2 Operation ä½“éªŒä¸Šæ¥äº†ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›çœ‹åˆ°æ›´å¤šçš„ Istio çš„é‡‡çº³è·¯å¾„å»ºè®®ã€æ¡ˆä¾‹ç ”ç©¶ã€å­¦ä¹ èµ„æ–™ã€åŸ¹è®­åŠè®¤è¯ï¼ˆä¾‹å¦‚æ¥è‡ª Tetrate çš„ä¸šç•Œçš„ç¬¬ä¸€ä¸ª &lt;a href=&#34;https://academy.tetrate.io/courses/certified-istio-administrator&#34; title=&#34;Istio ç®¡ç†å‘˜è®¤è¯&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç®¡ç†å‘˜è®¤è¯&lt;/a&gt;
ï¼‰ï¼Œè¿™äº›éƒ½å°†æœ‰åˆ©äº Istio çš„æ¨å¹¿å’Œé‡‡ç”¨ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ä»€ä¹ˆæ˜¯ Istioï¼Ÿä¸ºä»€ä¹ˆ Kubernetes éœ€è¦ Istioï¼Ÿ</title>
      <link>https://jimmysong.io/blog/what-is-istio-and-why-does-kubernetes-need-it/</link>
      <pubDate>Wed, 28 Apr 2021 09:06:14 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/what-is-istio-and-why-does-kubernetes-need-it/</guid>
      <description>
        
        
        &lt;p&gt;Istio æ˜¯å½“å‰&lt;a href=&#34;https://www.cncf.io/blog/2020/03/04/2019-cncf-survey-results-are-here-deployments-are-growing-in-size-and-speed-as-cloud-native-adoption-becomes-mainstream/&#34; title=&#34;æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼å®ç°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼å®ç°&lt;/a&gt;
ï¼Œå®ƒæ˜¯åœ¨ Kubernetes çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œå®ƒè·Ÿ Kubernetes åœ¨äº‘åŸç”Ÿåº”ç”¨çš„ç”Ÿæ€ä¸­æ‹¥æœ‰ç€ä¸åŒçš„å®šä½ã€‚æœ¬æ–‡ä¸æ˜¯ç›´æ¥ä¸ºä½ ä»‹ç» Istio å…·æœ‰å“ªäº›åŠŸèƒ½ï¼Œè€Œæ˜¯å…ˆå‘ä½ ä»‹ç» Istio è¯ç”Ÿçš„å†å²æ¡ä»¶ï¼Œç„¶åå¸¦ä½ ä» Kubernetes ä¸ Istio çš„åˆ†å·¥å¼€å§‹ï¼Œäº†è§£ä»€ä¹ˆæ˜¯ Istioã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³è§£é‡Šä»€ä¹ˆæ˜¯ Istioï¼Œè¿˜å¾—å…ˆäº†è§£ Istio æ˜¯åœ¨ä»€ä¹ˆæ ·çš„æƒ…å†µä¸‹å‡ºç°çš„â€”â€”å³ä¸ºä»€ä¹ˆä¼šæœ‰ Istioï¼Ÿ&lt;/p&gt;
&lt;p&gt;å®¹å™¨ä½œä¸ºäº‘åŸç”Ÿåº”ç”¨çš„äº¤ä»˜ç‰©ï¼Œæ—¢è§£å†³äº†ç¯å¢ƒä¸€è‡´æ€§çš„é—®é¢˜ï¼Œåˆå¯ä»¥æ›´ç»†ç²’åº¦çš„é™åˆ¶åº”ç”¨èµ„æºï¼Œä½†æ˜¯éšç€å¾®æœåŠ¡å’Œ DevOps çš„æµè¡Œï¼Œå®¹å™¨ä½œä¸ºå¾®æœåŠ¡çš„è½½ä½“å¾—ä»¥å¹¿æ³›åº”ç”¨ã€‚2014 å¹´ï¼ŒGoogle å¼€æºäº† Kubernetesï¼Œéšåå‡ å¹´å¾—åˆ°è¿…çŒ›å‘å±•ï¼Œåœ¨ 2017 å¹´å¥ å®šäº†å®¹å™¨ç¼–æ’è°ƒåº¦æ ‡å‡†çš„åœ°ä½ã€‚Kubernetes ä½œä¸ºä¸€ç§å®¹å™¨ç¼–æ’è°ƒåº¦å·¥å…·ï¼Œè§£å†³äº†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œè°ƒåº¦é—®é¢˜ã€‚å› ä¸ºä¸€å°å•æœºçš„èµ„æºæœ‰é™ï¼Œè€Œäº’è”ç½‘åº”ç”¨å¯èƒ½å› ä¸ºç”¨æˆ·è§„æ¨¡çš„æ€¥é€Ÿæ‰©å¼ ï¼Œæˆ–ç”¨æˆ·å±æ€§çš„ä¸åŒåœ¨ä¸åŒæ—¶é—´æ®µä¼šå‡ºç°æµé‡æ´ªå³°ï¼Œå› æ­¤å¯¹è®¡ç®—èµ„æºçš„å¼¹æ€§è¦æ±‚æ¯”è¾ƒé«˜ã€‚è€Œä¸€å°å•æœºæ˜¾ç„¶æ— æ³•æ»¡è¶³ä¸€ä¸ªå¦‚ä½•è§„æ¨¡åºå¤§çš„åº”ç”¨ï¼Œåä¹‹ï¼Œå¯¹äºä¸€ä¸ªè§„æ¨¡å¾ˆå°çš„åº”ç”¨ä¹Ÿæ²¡å¿…è¦å ç”¨æ•´å°ä¸»æœºï¼Œé‚£å°†å¯¼è‡´å·¨å¤§çš„æµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼ŒKubernetes å®šä¹‰æœåŠ¡çš„æœ€ç»ˆçŠ¶æ€ï¼Œå¹¶ä½¿ç³»ç»Ÿè‡ªåŠ¨åœ°è¾¾åˆ°å’Œç»´æŒåœ¨è¯¥çŠ¶æ€ã€‚é‚£ä¹ˆåœ¨åº”ç”¨éƒ¨ç½²å®Œæˆåï¼Œå¦‚ä½•ç®¡ç†æœåŠ¡ä¸Šçš„æµé‡å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°†çœ‹ä¸‹ Kubernetes ä¸­å¦‚ä½•åšæœåŠ¡ç®¡ç†ï¼ŒåŠåœ¨ Istio ä¸­çš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸­å¦‚ä½•åšæœåŠ¡ç®¡ç†&#34;&gt;Kubernetes ä¸­å¦‚ä½•åšæœåŠ¡ç®¡ç†ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Kubernetes ä¸­çš„æœåŠ¡æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/what-is-istio-and-why-does-kubernetes-need-it/service-model.jpg&#34; data-img=&#34;/blog/what-is-istio-and-why-does-kubernetes-need-it/service-model.jpg&#34; data-width=&#34;1920&#34; data-height=&#34;1200&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes æœåŠ¡æ¨¡å‹&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes æœåŠ¡æ¨¡å‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒä¸€ä¸ªæœåŠ¡çš„çš„ä¸åŒç¤ºä¾‹å¯èƒ½è¢«è°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes é€šè¿‡ Service å¯¹è±¡å°†ä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªå®ä¾‹ç»„åˆåœ¨äº†ä¸€èµ·ï¼Œç»Ÿä¸€å¯¹å¤–æœåŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes åœ¨æ¯ä¸ª node ä¸­å®‰è£…äº† &lt;code&gt;kube-proxy&lt;/code&gt;  ç»„ä»¶æ¥è½¬å‘æµé‡ï¼Œå®ƒæ‹¥æœ‰çš„ç®€å•çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼›&lt;/li&gt;
&lt;li&gt;Kubernetes é›†ç¾¤å¤–éƒ¨æµé‡å¯ä»¥é€šè¿‡ Ingress è¿›å…¥é›†ç¾¤ä¸­ï¼ˆKubernetes è¿˜æœ‰å…¶ä»–å‡ ç§æš´éœ²æœåŠ¡çš„æ–¹å¼ï¼Œå¦‚ NodePortã€LoadBalancer ç­‰ï¼‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kubernetes æ˜¯ç”¨äºèµ„æºé›†çº¦ç®¡ç†çš„å·¥å…·ã€‚ä½†åœ¨ä¸ºåº”ç”¨åˆ†é…å¥½èµ„æºåï¼Œå¦‚ä½•ä¿è¯åº”ç”¨çš„å¥å£®æ€§ã€å†—ä½™æ€§ï¼Œå¦‚ä½•å®ç°æ›´ç»†ç²’åº¦çš„æµé‡åˆ’åˆ†ï¼ˆä¸æ˜¯æ ¹æ®æœåŠ¡ä¸­å®ä¾‹ä¸ªæ•°æ¥å®ç°ï¼‰ï¼Œå¦‚ä½•ä¿éšœæœåŠ¡çš„å®‰å…¨æ€§ï¼Œå¦‚ä½•è¿›è¡Œå¤šé›†ç¾¤ç®¡ç†ç­‰ï¼Œè¿™äº›é—®é¢˜ Kubernetes éƒ½ä¸èƒ½å¾ˆå¥½åœ°è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡å…·æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œéœ€è¦è¿­ä»£å’Œä¸Šçº¿ï¼Œåœ¨æ–°ç‰ˆå‘å¸ƒçš„æ—¶å€™éœ€è¦åˆ‡åˆ†æµé‡ï¼Œå®ç°é‡‘ä¸é›€å‘å¸ƒï¼›åŒæ—¶æˆ‘ä»¬åº”è¯¥å‡å®šæœåŠ¡æ˜¯ä¸å¯é çš„ï¼Œå¯èƒ½å› ä¸ºå„ç§åŸå› å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦é¢å‘å¤±è´¥æ¥ç¼–ç¨‹ï¼Œå¦‚ä½•ç›‘æ§åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ï¼Œäº†è§£æ¯ä¸ªè¯·æ±‚çš„è€—æ—¶å’ŒçŠ¶æ€ï¼ŸIstio çš„å‘èµ·è¿™ä»¬å°±æƒ³åˆ°äº†åœ¨æ¯ä¸ª pod ä¸­æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼Œå°†ä»£ç†çš„é…ç½®é€šè¿‡ä¸€ä¸ªæ§åˆ¶å¹³é¢é›†ä¸­åˆ†å‘ï¼Œç„¶åå°†ä» pod ä¸­åº”ç”¨å®¹å™¨å‘èµ·çš„æ¯ä¸ªè¯·æ±‚éƒ½åŠ«æŒåˆ° sidecar ä»£ç†ä¸­ï¼Œç„¶åè½¬å‘ï¼Œè¿™æ ·ä¸å°±å¯ä»¥å®Œç¾çš„è§£å†³ä»¥ä¸Šé—®é¢˜äº†å—ï¼ŸKubernetes ä¼˜ç§€çš„æ¶æ„å’Œå¯æ‰©å±•æ€§ï¼Œä¾‹å¦‚ CRDï¼Œpod å†…çš„éƒ¨ç½²æ¨¡å¼ï¼Œå¯ä»¥å®Œç¾çš„è§£å†³å¤§é‡ sidecar çš„æ³¨å…¥å’Œç®¡ç†é—®é¢˜ï¼Œä½¿å¾— Istio çš„å®ç°æˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„åŸºæœ¬åŸç†&#34;&gt;Istio çš„åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ Istio ä¸­çš„æœåŠ¡æ¨¡å‹ï¼Œå®ƒæ—¢å¯ä»¥æ”¯æŒ Kubernetes ä¸­çš„å·¥ä½œè´Ÿè½½ï¼Œåˆå¯ä»¥æ”¯æŒè™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/what-is-istio-and-why-does-kubernetes-need-it/istio.jpg&#34; data-img=&#34;/blog/what-is-istio-and-why-does-kubernetes-need-it/istio.jpg&#34; data-width=&#34;1999&#34; data-height=&#34;1134&#34; alt=&#34;image&#34; data-caption=&#34;Istio&#34;&gt;
    
  
  &lt;figcaption&gt;Istio&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istiod ä½œä¸ºæ§åˆ¶å¹³é¢ï¼Œå°†é…ç½®ä¸‹å‘ç»™æ‰€æœ‰çš„ sidecar proxy å’Œ gatewayï¼ˆä¸ºäº†ç¾è§‚ï¼Œå›¾ä¸­æ²¡æœ‰ç”» Istiod åŠ sidecar ä¹‹é—´çš„è¿æ¥ï¼‰&lt;/li&gt;
&lt;li&gt;Istio ä¸å†ä½¿ç”¨ &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶åšæµé‡è½¬å‘ï¼Œè€Œæ˜¯ä¾æ‰˜åœ¨æ¯ä¸ª pod ä¸­æ³¨å…¥çš„ sidecar proxyï¼Œæ‰€æœ‰çš„ proxy ç»„æˆäº† Istio çš„æ•°æ®å¹³é¢ï¼›&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºç®¡ç†å‘˜å¯ä»¥å’Œç®¡ç† Kubernetes ä¸­çš„å·¥ä½œè´Ÿè½½ä¸€æ ·ï¼Œé€šè¿‡å£°æ˜å¼ API æ“ä½œ Istio mesh ä¸­æµé‡çš„è¡Œä¸ºï¼›&lt;/li&gt;
&lt;li&gt;Ingress è¢« Gateway èµ„æºæ‰€æ›¿ä»£ï¼ŒGateway æ˜¯ä¸€ç§ç‰¹æ®Šçš„ proxyï¼Œå®é™…ä¸Šä¹Ÿæ˜¯å¤ç”¨çš„ Sidecar proxyï¼›&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­å®‰è£… sidecar proxyï¼Œå°†è™šæ‹Ÿæœºå¼•å…¥çš„ Istio mesh ä¸­ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®é™…ä¸Šåœ¨ Istio ä¹‹å‰ï¼Œäººä»¬å¯ä»¥ä½¿ç”¨ SpringCloudã€Netflix OSS ç­‰ï¼Œé€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­é›†æˆ SDKï¼Œç¼–ç¨‹çš„æ–¹å¼æ¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„æµé‡ã€‚ä½†æ˜¯è¿™é€šå¸¸ä¼šæœ‰ç¼–ç¨‹è¯­è¨€é™åˆ¶ï¼Œè€Œä¸”åœ¨ SDK å‡çº§çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹ä»£ç å¹¶é‡æ–°ä¸Šçº¿åº”ç”¨ï¼Œä¼šå¢å¤§äººåŠ›è´Ÿæ‹…ã€‚Istio ä½¿å¾—æµé‡ç®¡ç†å˜å¾—å¯¹åº”ç”¨ç¨‹åºé€æ˜ï¼Œä½¿è¿™éƒ¨åˆ†åŠŸèƒ½ä»åº”ç”¨ç¨‹åºä¸­è½¬ç§»åˆ°äº†å¹³å°å±‚ï¼Œæˆä¸ºäº†äº‘åŸç”ŸåŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;p&gt;æ­£æ˜¯å› ä¸º Istio è¡¥è¶³äº† Kubernetes å¯¹äºäº‘åŸç”Ÿåº”ç”¨çš„æµé‡ç®¡ç†ã€å¯è§‚å¯Ÿæ€§å’Œå®‰å…¨æ–¹é¢çš„çŸ­æ¿ï¼Œåœ¨ 2017 å¹´ç”± Googleã€IBM å’Œ Lyft å…±åŒå‘èµ·çš„è¿™ä¸ªæœåŠ¡ç½‘æ ¼å¼€æºé¡¹ç›®ï¼Œå¹¶åœ¨ä¸‰å¹´æ¥å–å¾—äº†é•¿è¶³çš„å‘å±•ã€‚å…³äº Istio æ ¸å¿ƒåŠŸèƒ½çš„ä»‹ç»å¯ä»¥å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/concepts/what-is-istio/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Service Mesh ç›¸å½“äºäº‘åŸç”Ÿæ—¶ä»£çš„ TCP/IPï¼Œè§£å†³åº”ç”¨ç¨‹åºç½‘ç»œé€šä¿¡ã€å®‰å…¨åŠå¯è§æ€§é—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;Istio æ˜¯ç›®å‰æœ€æµè¡Œçš„ service mesh å®ç°ï¼Œä¾æ‰˜äº Kubernetesï¼Œä½†ä¹Ÿå¯ä»¥æ‰©å±•åˆ°è™šæ‹Ÿæœºè´Ÿè½½ï¼›&lt;/li&gt;
&lt;li&gt;Istio çš„æ ¸å¿ƒç”±æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢ç»„æˆï¼ŒEnvoy æ˜¯é»˜è®¤çš„æ•°æ®å¹³é¢ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;Istio ä½œä¸ºäº‘åŸç”ŸåŸºç¡€è®¾æ–½çš„ç½‘ç»œå±‚ï¼Œå¯¹åº”ç”¨é€æ˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨äº† Kubernetes åä½ å¯èƒ½è¿˜éœ€è¦ Istioï¼Ÿ</title>
      <link>https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/</link>
      <pubDate>Wed, 07 Apr 2021 08:27:17 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/</guid>
      <description>
        
        
        &lt;p&gt;å¦‚æœä½ å¬è¯´è¿‡æœåŠ¡ç½‘æ ¼ï¼Œå¹¶å°è¯•è¿‡ &lt;a href=&#34;https://istio.io/&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
ï¼Œä½ å¯èƒ½æœ‰ä»¥ä¸‹é—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ Istio è¦åœ¨ Kubernetes ä¸Šè¿è¡Œï¼Ÿ&lt;/li&gt;
&lt;li&gt;Kubernetes å’ŒæœåŠ¡ç½‘æ ¼åœ¨äº‘åŸç”Ÿåº”ç”¨æ¶æ„ä¸­åˆ†åˆ«æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Istio æ‰©å±•äº† Kubernetes çš„å“ªäº›æ–¹é¢ï¼Ÿå®ƒè§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Kubernetesã€Envoy å’Œ Istio ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡å°†å¸¦å¤§å®¶äº†è§£ Kubernetes å’Œ Istio çš„å†…éƒ¨å·¥ä½œåŸç†ã€‚æ­¤å¤–ï¼Œæˆ‘ä¼šä»‹ç» Kubernetes ä¸­çš„è´Ÿè½½å‡è¡¡æ–¹æ³•ï¼Œå¹¶è§£é‡Šä¸ºä»€ä¹ˆæœ‰äº† Kubernetes åè¿˜éœ€è¦ Istioã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes æœ¬è´¨ä¸Šæ˜¯é€šè¿‡å£°æ˜å¼é…ç½®æ¥å®ç°åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè€ŒæœåŠ¡ç½‘æ ¼æœ¬è´¨ä¸Šæ˜¯æä¾›åº”ç”¨é—´çš„æµé‡ã€å®‰å…¨ç®¡ç†å’Œå¯è§‚å¯Ÿæ€§ã€‚å¦‚æœä½ å·²ç»ä½¿ç”¨ Kubernetes æ­å»ºäº†ä¸€ä¸ªç¨³å®šçš„åº”ç”¨å¹³å°ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾ç½®æœåŠ¡é—´è°ƒç”¨çš„è´Ÿè½½å‡è¡¡å’Œæµé‡æ§åˆ¶ï¼Ÿæ˜¯å¦æœ‰è¿™æ ·ä¸€ä¸ªé€šç”¨çš„å·¥å…·æˆ–è€…è¯´å¹³å°ï¼ˆé SDKï¼‰ï¼Œå¯ä»¥å®ç°ï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ°æœåŠ¡ç½‘æ ¼äº†ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å¼•å…¥äº† xDS åè®®ï¼Œè¿™ä¸ªåè®®å¾—åˆ°äº†å„ç§å¼€æºè½¯ä»¶çš„æ”¯æŒï¼Œæ¯”å¦‚ Istioã€&lt;a href=&#34;https://mosn.io/&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
 ç­‰ã€‚Envoy å°† xDS è´¡çŒ®ç»™æœåŠ¡ç½‘æ ¼æˆ–äº‘åŸç”ŸåŸºç¡€è®¾æ–½ã€‚Envoy æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç°ä»£ç‰ˆçš„ä»£ç†ï¼Œå¯ä»¥é€šè¿‡ API è¿›è¡Œé…ç½®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¡ç”Ÿå‡ºè®¸å¤šä¸åŒçš„ä½¿ç”¨åœºæ™¯â€“æ¯”å¦‚ API Gatewayã€æœåŠ¡ç½‘æ ¼ä¸­çš„ sidecar ä»£ç†å’Œè¾¹ç¼˜ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡åŒ…å«ä»¥ä¸‹å†…å®¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kube-proxy çš„ä½œç”¨æè¿°ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes åœ¨å¾®æœåŠ¡ç®¡ç†æ–¹é¢çš„å±€é™æ€§ã€‚&lt;/li&gt;
&lt;li&gt;Istio æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½ä»‹ç»ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesã€Envoy å’Œ Istio æœåŠ¡ç½‘æ ¼ä¸­ä¸€äº›æ¦‚å¿µçš„æ¯”è¾ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubernetes-vs-service-mesh&#34;&gt;Kubernetes vs Service Mesh&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾æ˜¾ç¤ºäº† Kubernetes ä¸­çš„æœåŠ¡è®¿é—®å…³ç³»å’ŒæœåŠ¡ç½‘æ ¼ï¼ˆæ¯ä¸ª pod æ¨¡å‹ä¸€ä¸ª sidecarï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7knfo4dj31hk0redrz.jpg&#34; data-img=&#34;/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7knfo4dj31hk0redrz.jpg&#34; data-width=&#34;1928&#34; data-height=&#34;986&#34; alt=&#34;image&#34; data-caption=&#34;Kubernetes vs Service Mesh&#34;&gt;
    
  
  &lt;figcaption&gt;Kubernetes vs Service Mesh&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æµé‡è½¬å‘&#34;&gt;æµé‡è½¬å‘&lt;/h3&gt;
&lt;p&gt;Kubernetes é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éƒ¨ç½²äº†ä¸€ä¸ª kube-proxy ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¸ Kubernetes API Server è¿›è¡Œé€šä¿¡ï¼Œè·å–é›†ç¾¤ä¸­çš„æœåŠ¡ä¿¡æ¯ï¼Œç„¶åè®¾ç½® iptables è§„åˆ™ï¼Œå°†æœåŠ¡è¯·æ±‚ç›´æ¥å‘é€åˆ°å¯¹åº”çš„ Endpointï¼ˆå±äºåŒä¸€ç»„æœåŠ¡çš„ podï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡å‘ç°&#34;&gt;æœåŠ¡å‘ç°&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7knwb79j30kq0fcjs9.jpg&#34; data-img=&#34;/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7knwb79j30kq0fcjs9.jpg&#34; data-width=&#34;746&#34; data-height=&#34;552&#34; alt=&#34;image&#34; data-caption=&#34;Service Discovery&#34;&gt;
    
  
  &lt;figcaption&gt;Service Discovery&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio å¯ä»¥è·Ÿè¸ª Kubernetes ä¸­çš„æœåŠ¡æ³¨å†Œï¼Œä¹Ÿå¯ä»¥åœ¨æ§åˆ¶å¹³é¢ä¸­é€šè¿‡å¹³å°é€‚é…å™¨ä¸å…¶ä»–æœåŠ¡å‘ç°ç³»ç»Ÿå¯¹æ¥ï¼›ç„¶åç”Ÿæˆæ•°æ®å¹³é¢çš„é…ç½®ï¼ˆä½¿ç”¨ CRDï¼Œè¿™äº›é…ç½®å­˜å‚¨åœ¨ etcd ä¸­ï¼‰ï¼Œæ•°æ®å¹³é¢çš„é€æ˜ä»£ç†ã€‚æ•°æ®å¹³é¢çš„é€æ˜ä»£ç†ä»¥ sidecar å®¹å™¨çš„å½¢å¼éƒ¨ç½²åœ¨æ¯ä¸ªåº”ç”¨æœåŠ¡çš„ pod ä¸­ï¼Œè¿™äº›ä»£ç†éƒ½éœ€è¦è¯·æ±‚æ§åˆ¶å¹³é¢åŒæ­¥ä»£ç†é…ç½®ã€‚ä»£ç†ä¹‹æ‰€ä»¥â€œé€æ˜â€ï¼Œæ˜¯å› ä¸ºåº”ç”¨å®¹å™¨å®Œå…¨ä¸çŸ¥é“ä»£ç†çš„å­˜åœ¨ã€‚è¿‡ç¨‹ä¸­çš„ kube-proxy ç»„ä»¶ä¹Ÿéœ€è¦æ‹¦æˆªæµé‡ï¼Œåªä¸è¿‡ kube-proxy æ‹¦æˆªçš„æ˜¯è¿›å‡º Kubernetes èŠ‚ç‚¹çš„æµé‡â€“è€Œ sidecar ä»£ç†æ‹¦æˆªçš„æ˜¯è¿›å‡º pod çš„æµé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼çš„åŠ£åŠ¿&#34;&gt;æœåŠ¡ç½‘æ ¼çš„åŠ£åŠ¿&lt;/h3&gt;
&lt;p&gt;ç”±äº Kubernetes çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€å¾ˆå¤š podï¼Œæ‰€ä»¥åœ¨æ¯ä¸ª pod ä¸­æ”¾å…¥åŸæœ‰çš„ kube-proxy è·¯ç”±è½¬å‘åŠŸèƒ½ï¼Œä¼šå¢åŠ å“åº”å»¶è¿Ÿâ€“ç”±äº sidecar æ‹¦æˆªæµé‡æ—¶è·³æ•°æ›´å¤šï¼Œæ¶ˆè€—æ›´å¤šçš„èµ„æºã€‚ä¸ºäº†å¯¹æµé‡è¿›è¡Œç²¾ç»†åŒ–ç®¡ç†ï¼Œå°†å¢åŠ ä¸€ç³»åˆ—æ–°çš„æŠ½è±¡åŠŸèƒ½ã€‚è¿™å°†è¿›ä¸€æ­¥å¢åŠ ç”¨æˆ·çš„å­¦ä¹ æˆæœ¬ï¼Œä½†éšç€æŠ€æœ¯çš„æ™®åŠï¼Œè¿™ç§æƒ…å†µä¼šæ…¢æ…¢å¾—åˆ°ç¼“è§£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼çš„ä¼˜åŠ¿&#34;&gt;æœåŠ¡ç½‘æ ¼çš„ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;kube-proxy çš„è®¾ç½®æ˜¯å…¨å±€çš„ï¼Œæ— æ³•å¯¹æ¯ä¸ªæœåŠ¡è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè€Œ service mesh é€šè¿‡ sidecar proxy çš„æ–¹å¼å°† Kubernetes ä¸­çš„æµé‡æ§åˆ¶ä»æœåŠ¡å±‚ä¸­æŠ½ç¦»å‡ºæ¥â€“å¯ä»¥å®ç°æ›´å¤§çš„å¼¹æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kube-proxy-çš„ä¸è¶³ä¹‹å¤„&#34;&gt;Kube-proxy çš„ä¸è¶³ä¹‹å¤„&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¦‚æœè½¬å‘çš„ pod ä¸èƒ½æ­£å¸¸æœåŠ¡ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨å°è¯•å…¶ä»– podã€‚æ¯ä¸ª pod éƒ½æœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå½“ä¸€ä¸ª pod å‡ºç°å¥åº·é—®é¢˜æ—¶ï¼Œkubelet ä¼šé‡å¯ podï¼Œkube-proxy ä¼šåˆ é™¤ç›¸åº”çš„è½¬å‘è§„åˆ™ã€‚å¦å¤–ï¼ŒèŠ‚ç‚¹ Port ç±»å‹çš„æœåŠ¡ä¸èƒ½æ·»åŠ  TLS æˆ–æ›´å¤æ‚çš„æ¶ˆæ¯è·¯ç”±æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;Kube-proxy å®ç°äº†ä¸€ä¸ª Kubernetes æœåŠ¡çš„å¤šä¸ª pod å®ä¾‹ä¹‹é—´çš„æµé‡è´Ÿè½½å‡è¡¡ï¼Œä½†å¦‚ä½•å¯¹è¿™äº›æœåŠ¡ä¹‹é—´çš„æµé‡è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶â€“æ¯”å¦‚å°†æµé‡æŒ‰ç™¾åˆ†æ¯”åˆ’åˆ†ç»™ä¸åŒçš„åº”ç”¨ç‰ˆæœ¬ï¼ˆè¿™äº›åº”ç”¨ç‰ˆæœ¬éƒ½æ˜¯åŒä¸€ä¸ªæœåŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†åœ¨ä¸åŒçš„éƒ¨ç½²ä¸Šï¼‰ï¼Œæˆ–è€…åšé‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰å’Œè“ç»¿å‘å¸ƒï¼Ÿ&lt;/p&gt;
&lt;p&gt;Kubernetes ç¤¾åŒºç»™å‡ºäº†ä¸€ä¸ªä½¿ç”¨ Deployment åš&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments&#34; title=&#34;é‡‘ä¸é›€å‘å¸ƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡‘ä¸é›€å‘å¸ƒ&lt;/a&gt;
çš„æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¿®æ”¹ pod çš„æ ‡ç­¾æ¥ç»™éƒ¨ç½²çš„æœåŠ¡åˆ†é…ä¸åŒçš„ podã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-ingress-vs-istio-gateway&#34;&gt;Kubernetes Ingress vs Istio Gateway&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œkube-proxy åªèƒ½åœ¨ Kubernetes é›†ç¾¤å†…è·¯ç”±æµé‡ã€‚Kubernetes é›†ç¾¤çš„ pod ä½äº CNI åˆ›å»ºçš„ç½‘ç»œä¸­ã€‚Ingress æ˜¯åœ¨ Kubernetes ä¸­åˆ›å»ºçš„èµ„æºå¯¹è±¡ï¼Œç”¨äºé›†ç¾¤å¤–éƒ¨çš„é€šä¿¡ã€‚å®ƒç”±ä½äº Kubernetes è¾¹ç¼˜èŠ‚ç‚¹ä¸Šçš„å…¥å£æ§åˆ¶å™¨é©±åŠ¨ï¼Œè´Ÿè´£ç®¡ç†å—åŒ—å‘æµé‡ã€‚Ingress å¿…é¡»ä¸å„ç§ Ingress æ§åˆ¶å™¨å¯¹æ¥ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34; title=&#34;nginx ingress æ§åˆ¶å™¨&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx ingress æ§åˆ¶å™¨&lt;/a&gt;
å’Œ &lt;a href=&#34;https://traefik.io/&#34; title=&#34;traefik&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;traefik&lt;/a&gt;
ã€‚Ingress åªé€‚ç”¨äº HTTP æµé‡ï¼Œä½¿ç”¨ç®€å•ã€‚å®ƒåªèƒ½é€šè¿‡åŒ¹é…æœ‰é™çš„å­—æ®µæ¥è·¯ç”±æµé‡â€”â€”å¦‚æœåŠ¡ã€ç«¯å£ã€HTTP è·¯å¾„ç­‰ã€‚è¿™ä½¿å¾—å®ƒæ— æ³•å¯¹ TCP æµé‡è¿›è¡Œè·¯ç”±ï¼Œå¦‚ MySQLã€Redis å’Œå„ç§ RPCã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¼šçœ‹åˆ°äººä»¬åœ¨ ingress èµ„æºæ³¨é‡Šä¸­å†™ Nginx é…ç½®è¯­è¨€çš„åŸå› ï¼ˆæ³¨ï¼šä½¿ç”¨ Nginx Ingress Controller å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/&#34; title=&#34;é…ç½® ConfigMap å’Œ Service çš„æ–¹å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½® ConfigMap å’Œ Service çš„æ–¹å¼&lt;/a&gt;
æ¥å˜é€šæ”¯æŒ TCP å’Œ UDP  æµé‡è½¬å‘ï¼‰ã€‚ç›´æ¥è·¯ç”±å—åŒ—æµé‡çš„å”¯ä¸€é€šè¡Œæ–¹æ³•æ˜¯ä½¿ç”¨æœåŠ¡çš„ LoadBalancer æˆ– NodePortï¼Œå‰è€…éœ€è¦äº‘å‚å•†æ”¯æŒï¼Œåè€…éœ€è¦é¢å¤–çš„ç«¯å£ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;Istio Gateway çš„åŠŸèƒ½ä¸ Kubernetes Ingress ç±»ä¼¼ï¼Œå®ƒè´Ÿè´£è¿›å‡ºé›†ç¾¤çš„å—åŒ—æµé‡ã€‚Istio Gateway æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½è¿›å‡ºæœåŠ¡ç½‘æ ¼è¾¹ç¼˜çš„è¿æ¥ã€‚è¯¥è§„èŒƒæè¿°äº†ä¸€ç»„å¼€æ”¾ç«¯å£å’Œè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ï¼Œä»¥åŠç”¨äºè´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰ã€‚Gateway æ˜¯ä¸€ä¸ª CRD æ‰©å±•ï¼Œå®ƒä¹Ÿé‡ç”¨äº† sidecar ä»£ç†çš„åŠŸèƒ½ï¼›è¯¦ç»†é…ç½®è¯·å‚è§ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/gateway/&#34; title=&#34;Istio ç½‘ç«™&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç½‘ç«™&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy&#34;&gt;Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio ä¸­é»˜è®¤çš„ sidecar ä»£ç†ã€‚Istio åŸºäº Enovy çš„ xDS åè®®æ‰©å±•äº†å…¶æ§åˆ¶å¹³é¢ã€‚åœ¨è®¨è®º Envoy çš„ xDS åè®®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†Ÿæ‚‰ Envoy çš„åŸºæœ¬æœ¯è¯­ã€‚ä¸‹é¢æ˜¯ Envoy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/envoy-arch.jpg&#34; data-img=&#34;/blog/why-do-you-need-istio-when-you-already-have-kubernetes/envoy-arch.jpg&#34; data-width=&#34;1492&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Envoy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åŸºç¡€æ¦‚å¿µ&#34;&gt;åŸºç¡€æ¦‚å¿µ&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ Enovy ä¸­ä½ åº”è¯¥çŸ¥é“çš„åŸºæœ¬æœ¯è¯­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸‹æ¸¸ã€‚ä¸‹æ¸¸ä¸»æœºè¿æ¥åˆ° Envoyï¼Œå‘é€è¯·æ±‚ï¼Œå¹¶æ¥æ”¶å“åº”ï¼Œå³å‘é€è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šæ¸¸ï¼šä¸Šæ¸¸ä¸»æœºã€‚ä¸Šæ¸¸ä¸»æœºæ¥æ”¶æ¥è‡ª Envoy çš„è¿æ¥å’Œè¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ï¼›å³æ¥æ”¶è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;Listenerï¼šç›‘å¬å™¨ã€‚ç›‘å¬å™¨æ˜¯ä¸€ä¸ªå‘½åçš„ç½‘ç»œåœ°å€ï¼ˆå¦‚ç«¯å£ã€UNIX åŸŸå¥—æ¥å­—ç­‰ï¼‰ï¼›ä¸‹æ¸¸å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°è¿™äº›ç›‘å¬å™¨ã€‚Envoy å°†ä¸€ä¸ªæˆ–å¤šä¸ªç›‘å¬å™¨æš´éœ²ç»™ä¸‹æ¸¸ä¸»æœºè¿›è¡Œè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ã€‚é›†ç¾¤æ˜¯ä¸€ç»„é€»è¾‘ä¸Šç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºï¼ŒEnvoy è¿æ¥åˆ°å®ƒä»¬ã€‚Envoy é€šè¿‡æœåŠ¡å‘ç°æ¥å‘ç°é›†ç¾¤çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡ä¸»åŠ¨çš„å¥åº·æ£€æŸ¥æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥æ¥å†³å®šé›†ç¾¤ä¸­å“ªä¸ªæˆå‘˜çš„è¯·æ±‚è·¯ç”±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Envoy ä¸­å¯ä»¥è®¾ç½®å¤šä¸ªç›‘å¬å™¨ï¼Œæ¯ä¸ªç›‘å¬å™¨å¯ä»¥è®¾ç½®ä¸€ä¸ªè¿‡æ»¤é“¾ï¼ˆè¿‡æ»¤é“¾è¡¨ï¼‰ï¼Œè€Œä¸”è¿‡æ»¤é“¾æ˜¯å¯æ‰©å±•çš„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°æ“çºµæµé‡çš„è¡Œä¸ºâ€“æ¯”å¦‚è®¾ç½®åŠ å¯†ã€ç§æœ‰ RPC ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;xDS åè®®æ˜¯ç”± Envoy æå‡ºçš„ï¼Œæ˜¯ Istio ä¸­é»˜è®¤çš„ sidecar ä»£ç†ï¼Œä½†åªè¦å®ç°äº† xDS åè®®ï¼Œç†è®ºä¸Šä¹Ÿå¯ä»¥ä½œä¸º Istio ä¸­çš„ sidecar ä»£ç† â€”â€” æ¯”å¦‚èš‚èšé›†å›¢å¼€æºçš„ &lt;a href=&#34;https://mosn.io&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cdn.thenewstack.io/media/2021/03/b800bf17-image3.png&#34; title=&#34;&amp;lt;figure class=&amp;#34;mx-auto text-center&amp;#34;&amp;gt;
  
  
  
  
    
    &amp;lt;img src=&amp;#34;/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7kk7wk4j31060lqgqx.jpg&amp;#34; data-img=&amp;#34;/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7kk7wk4j31060lqgqx.jpg&amp;#34; data-width=&amp;#34;1302&amp;#34; data-height=&amp;#34;782&amp;#34; alt=&amp;#34;image&amp;#34; data-caption=&amp;#34;img&amp;#34;&amp;gt;
    
  
  &amp;lt;figcaption&amp;gt;img&amp;lt;/figcaption&amp;gt;
&amp;lt;/figure&amp;gt;
&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7kk7wk4j31060lqgqx.jpg&#34; data-img=&#34;/blog/why-do-you-need-istio-when-you-already-have-kubernetes/008eGmZEly1gpb7kk7wk4j31060lqgqx.jpg&#34; data-width=&#34;1302&#34; data-height=&#34;782&#34; alt=&#34;image&#34; data-caption=&#34;img&#34;&gt;
    
  
  &lt;figcaption&gt;img&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;Istio æ˜¯ä¸€ä¸ªåŠŸèƒ½éå¸¸ä¸°å¯Œçš„æœåŠ¡ç½‘æ ¼ï¼ŒåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†ã€‚è¿™æ˜¯ Istio æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç­–ç•¥æ§åˆ¶ã€‚å®ç°è®¿é—®æ§åˆ¶ç³»ç»Ÿã€é¥æµ‹é‡‡é›†ã€é…é¢ç®¡ç†ã€è®¡è´¹ç­‰åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§ã€‚åœ¨ sidecar ä»£ç†ä¸­å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨è®¤è¯ã€‚ç”± Citadel ç»„ä»¶è¿›è¡Œå¯†é’¥å’Œè¯ä¹¦ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;istio-ä¸­çš„æµé‡ç®¡ç†&#34;&gt;Istio ä¸­çš„æµé‡ç®¡ç†&lt;/h2&gt;
&lt;p&gt;Istio ä¸­å®šä¹‰äº†ä»¥ä¸‹ CRD æ¥å¸®åŠ©ç”¨æˆ·è¿›è¡Œæµé‡ç®¡ç†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘å…³ã€‚ç½‘å…³æè¿°äº†ä¸€ä¸ªè¿è¡Œåœ¨ç½‘ç»œè¾¹ç¼˜çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ¥æ”¶ä¼ å…¥æˆ–ä¼ å‡ºçš„ HTTP/TCP è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;è™šæ‹ŸæœåŠ¡ï¼ˆVirtualServiceï¼‰ã€‚VirtualService å®é™…ä¸Šæ˜¯å°† Kubernetes æœåŠ¡è¿æ¥åˆ° Istio ç½‘å…³ã€‚å®ƒè¿˜å¯ä»¥æ‰§è¡Œé¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚å®šä¹‰ä¸€ç»„æµé‡è·¯ç”±è§„åˆ™ï¼Œä»¥ä¾¿åœ¨ä¸»æœºå¯»å€æ—¶åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;DestinationRuleã€‚DestinationRule å®šä¹‰çš„ç­–ç•¥å†³å®šäº†æµé‡è¢«è·¯ç”±åçš„è®¿é—®ç­–ç•¥ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå®šä¹‰äº†æµé‡çš„è·¯ç”±æ–¹å¼ã€‚å…¶ä¸­ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥å®šä¹‰ä¸ºè´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å¤§å°å’Œå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºè¯†åˆ«å’Œé©±é€è´Ÿè½½å‡è¡¡æ± ä¸­ä¸å¥åº·çš„ä¸»æœºï¼‰é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;EnvoyFilterã€‚EnvoyFilter å¯¹è±¡æè¿°äº†ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰ Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ç§é…ç½®ä¸€èˆ¬å¾ˆå°‘è¢«ä¸»ç”¨æˆ·ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ServiceEntryã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio æœåŠ¡ Mesh ä¸­çš„æœåŠ¡æ— æ³•å‘ç° Mesh ä¹‹å¤–çš„æœåŠ¡ã€‚ServiceEntry å¯ä»¥åœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­æ·»åŠ é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œå…è®¸ Mesh ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡è®¿é—®å¹¶è·¯ç”±åˆ°è¿™äº›æ‰‹åŠ¨æ·»åŠ çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubernetes-vs-xds-vs-istio&#34;&gt;Kubernetes vs xDS vs Istio&lt;/h2&gt;
&lt;p&gt;åœ¨å›é¡¾äº† Kubernetes çš„ kube-proxy ç»„ä»¶ã€xDS å’Œ Istio å¯¹æµé‡ç®¡ç†çš„æŠ½è±¡åï¼Œç°åœ¨æˆ‘ä»¬ä»…ä»æµé‡ç®¡ç†çš„è§’åº¦æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªç»„ä»¶ / åè®®çš„æ¯”è¾ƒï¼ˆæ³¨æ„ï¼Œä¸‰è€…å¹¶ä¸å®Œå…¨ç­‰åŒï¼‰ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;xDS&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Istio service mesh&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;WorkloadEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;VirtualService&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;DestinationRule&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;EnvoyFilter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ingress&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;Gateway&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Cluster&lt;/td&gt;
&lt;td&gt;ServiceEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ ¸å¿ƒè§‚ç‚¹&#34;&gt;æ ¸å¿ƒè§‚ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes çš„æœ¬è´¨æ˜¯åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯éƒ¨ç½²å’Œç®¡ç†ï¼ˆä¼¸ç¼©ã€è‡ªåŠ¨æ¢å¤ã€å‘å¸ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ä¸ºå¾®æœåŠ¡æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•ã€é«˜å¼¹æ€§çš„éƒ¨ç½²å’Œç®¡ç†å¹³å°ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼æ˜¯åŸºäºé€æ˜ä»£ç†ï¼Œé€šè¿‡ sidecar ä»£ç†æ‹¦æˆªæœåŠ¡ä¹‹é—´çš„æµé‡ï¼Œç„¶åé€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ç®¡ç†å®ƒä»¬çš„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼å°†æµé‡ç®¡ç†ä¸ Kubernetes è§£è€¦ï¼Œä¸éœ€è¦ kube-proxy ç»„ä»¶æ¥æ”¯æŒæœåŠ¡ç½‘æ ¼å†…çš„æµé‡ï¼›é€šè¿‡æä¾›æ›´æ¥è¿‘å¾®æœåŠ¡åº”ç”¨å±‚çš„æŠ½è±¡æ¥ç®¡ç†æœåŠ¡é—´çš„æµé‡ã€å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§ã€‚&lt;/li&gt;
&lt;li&gt;xDS æ˜¯æœåŠ¡ç½‘æ ¼çš„åè®®æ ‡å‡†ä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼æ˜¯ Kubernetes ä¸­æœåŠ¡çš„ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¦‚æœè¯´ Kubernetes ç®¡ç†çš„å¯¹è±¡æ˜¯ä¸€ä¸ª podï¼Œé‚£ä¹ˆæœåŠ¡ç½‘æ ¼ç®¡ç†çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥ç”¨ Kubernetes ç®¡ç†å¾®æœåŠ¡ï¼Œç„¶ååº”ç”¨æœåŠ¡ç½‘æ ¼å°±å¯ä»¥äº†ã€‚å¦‚æœä½ è¿æœåŠ¡éƒ½ä¸æƒ³ç®¡ç†ï¼Œé‚£å°±ç”¨ &lt;a href=&#34;https://knative.dev/&#34; title=&#34;Knative&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Knative&lt;/a&gt;
 è¿™æ ·çš„æ— æœåŠ¡å™¨å¹³å°ï¼Œä¸è¿‡è¿™æ˜¯åè¯ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ EKS-D å’Œ Istio ä¿è¯æ··åˆäº‘ç¯å¢ƒä¸€è‡´æ€§</title>
      <link>https://jimmysong.io/blog/eks-eksd-istio-hybrid-cloud/</link>
      <pubDate>Mon, 28 Dec 2020 14:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/eks-eksd-istio-hybrid-cloud/</guid>
      <description>
        
        
        &lt;p&gt;AWS åœ¨ 2020 å¹´ 12 æœˆä¸¾è¡Œçš„ re:Invent å¤§ä¼šä¸Šå‘å¸ƒäº† &lt;a href=&#34;https://distro.eks.amazonaws.com/&#34; title=&#34;EKS-D&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EKS-D&lt;/a&gt;
ï¼Œæ­¤ä¸¾æ—¨åœ¨è”åˆåˆä½œä¼™ä¼´ï¼Œå¼€æº AWS ç»´æŠ¤å¤§è§„æ¨¡ EKS é›†ç¾¤çš„ç»éªŒï¼Œå¸®åŠ©ç”¨æˆ·å®ç°æ··åˆäº‘åœºæ™¯ä¸‹ Kubernetes çš„ä¸€è‡´æ€§çš„ä½“éªŒã€‚æœ¬æ–‡å°†ä¸ºä½ è§£æ EKS-D çš„æˆ˜ç•¥æ„ä¹‰ï¼Œè¯´æ˜å®ƒæ˜¯å¦‚ä½•ä¸ Istio å…±åŒä¿è¯æ··åˆäº‘ç¯å¢ƒä¸€è‡´æ€§çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-eks-d&#34;&gt;ä»€ä¹ˆæ˜¯ EKS-Dï¼Ÿ&lt;/h2&gt;
&lt;p&gt;EKS-D æ˜¯ Amazon EKS çš„ä¸€ä¸ªå‘è¡Œç‰ˆï¼Œå¯ä»¥è¿è¡Œåœ¨ä¼ä¸šå†…éƒ¨ã€äº‘ç«¯æˆ–è‡ªå·±çš„ç³»ç»Ÿä¸Šã€‚EKS-D ä¿æŒä¸ Kubernetes æ–°ç‰ˆæœ¬åŒæœŸå‘å¸ƒã€‚åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œå°†ä»¥ EKS Anywhereï¼ˆEKS-Aï¼‰ä¸ºåï¼Œæä¾› EKS-D çš„æ”¯æŒã€æ‰“åŒ…äº§å“å’Œå®‰è£…æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† AWSã€EKS-Dã€Kubernetes åŠç”¨æˆ·ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/eks-eksd-istio-hybrid-cloud/0081Kckwly1gm3oyi69h3j31af0u0ju1.jpg&#34; data-img=&#34;/blog/eks-eksd-istio-hybrid-cloud/0081Kckwly1gm3oyi69h3j31af0u0ju1.jpg&#34; data-width=&#34;1671&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
    
  
  &lt;figcaption&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;EKS-D å¯¹äº AWSã€åˆä½œä¼™ä¼´åŠç”¨æˆ·æ¥è¯´å…·æœ‰ä¸åŒçš„æ„ä¹‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AWSï¼šå¢åŠ  AWS çš„å¸‚åœºæ‹¥æœ‰ç‡&lt;/li&gt;
&lt;li&gt;åˆä½œä¼™ä¼´ï¼šæ•´åˆ AWS çš„æ¸ é“å’Œå®¢æˆ·èµ„æºä»¥è§¦è¾¾æ›´å¤šç”¨æˆ·&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·ï¼šä¿è¯äº†å¼‚æ„ç¯å¢ƒä¸‹çš„ Kubernetes çš„ä¸€è‡´æ€§ï¼Œç®€åŒ–è¿ç»´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚ä»Šä¼ä¸šè¦è€ƒè™‘é€‰æ‹©å“ªä¸ªäº‘ä¾›åº”å•†è¦è€ƒè™‘å¾ˆå¤šå› ç´ ï¼ŒåŒæ—¶ï¼Œè¿˜æœ‰å¾ˆå¤šä¼ä¸šçš„ IT éš¾ä»¥è·¨å…¥äº‘ï¼Œè€Œæ˜¯ç»§ç»­ä¾èµ–ç©¶ç«Ÿè€ƒéªŒçš„ä¼ ç»Ÿ IT æ¶æ„ä»¥å¼€å±•ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šäº‘çš„æ—¶å€™å®¢æˆ·å¸Œæœ›åœ¨ä¼ä¸šå†…éƒ¨å’Œäº‘ç«¯è·å¾—ä¸€è‡´çš„ä½“éªŒï¼Œä»¥ä¾¿è¿›è¡Œè¿ç§»æˆ–å®ç°æ··åˆäº‘è®¾ç½®ã€‚ä¸æ˜¯æ‰€æœ‰åº”ç”¨éƒ½é€‚åˆè·¨äº‘è¿ç§»ï¼Œä¸ºäº†åˆè§„ã€æ•°æ®å®‰å…¨ç­‰ç§ç§åŸå› ï¼Œå¤šé›†ç¾¤ã€æ··åˆäº‘çš„ä½¿ç”¨åœºæ™¯å°†å¾ˆæ™®éã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆä½¿ç”¨å¤šé›†ç¾¤å’Œæ··åˆäº‘&#34;&gt;ä¸ºä»€ä¹ˆä½¿ç”¨å¤šé›†ç¾¤å’Œæ··åˆäº‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ–ä½¿ç”¨å¤šé›†ç¾¤ã€æ··åˆäº‘ç­‰éƒ¨ç½²æ–¹å¼ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºäº†é¿å…å‚å•†é”å®šï¼Œä¾¿äºåº”ç”¨è·¨é›†ç¾¤è¿ç§»ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†å®ç°åº”ç”¨çš„é«˜å¯ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;å½“ä¸€ä¸ªé›†ç¾¤çš„è§„æ¨¡è¿‡å¤§é€ æˆæ€§èƒ½ç“¶é¢ˆæ—¶ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†åˆè§„å’Œæ•°æ®å®‰å…¨ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†å°±è¿‘éƒ¨ç½²ï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†è¿›è¡Œä¸€äº›æµ‹è¯•ï¼›&lt;/li&gt;
&lt;li&gt;çªå‘ä¸šåŠ¡ï¼Œéœ€è¦é›†ç¾¤æ‰©å®¹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šæƒ…å†µç»å¸¸å‘ç”Ÿï¼Œå¯¹é›†ç¾¤çš„ç®¡ç†é€ æˆäº†æŒ‘æˆ˜ã€‚Kubernetes ç»Ÿä¸€äº†å®¹å™¨ç¼–æ’çš„æ ‡å‡†ï¼Œéšç€å…¶è¿›ä¸€æ­¥æ™®åŠï¼Œæ›´æœ‰æœ›æˆä¸ºäº‘åŸç”Ÿåº”ç”¨çš„åº•å±‚ APIã€‚ä½†æ˜¯å¯¹äºå¦‚ä½•ç®¡ç†å¤šé›†ç¾¤å’Œæ··åˆäº‘ç¯å¢ƒä¸­çš„ Kubernetes é›†ç¾¤ï¼Œåˆä¸ºæˆ‘ä»¬å¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-istio-service-mesh-ç®¡ç†æ··åˆäº‘&#34;&gt;ä½¿ç”¨ Istio service mesh ç®¡ç†æ··åˆäº‘&lt;/h2&gt;
&lt;p&gt;Istio æœåŠ¡ç½‘æ ¼ä½œä¸ºäº‘åŸç”Ÿåº”ç”¨çš„ç½‘ç»œåŸºç¡€è®¾æ–½å±‚ï¼Œå¯ä»¥åŒæ—¶ç®¡ç† Kubernetes åŠéå®¹å™¨è´Ÿè½½ï¼Œå¦‚&lt;a href=&#34;https://thenewstack.io/how-to-integrate-virtual-machines-into-istio-service-mesh/&#34; title=&#34;è™šæ‹Ÿæœº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è™šæ‹Ÿæœº&lt;/a&gt;
ã€‚Istio å¯ä»¥åœ¨&lt;a href=&#34;https://istio.io/latest/docs/setup/platform-setup/&#34; title=&#34;å¤šç§å¹³å°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šç§å¹³å°&lt;/a&gt;
ä¸­éƒ¨ç½²ï¼Œåˆæ”¯æŒå¤šç§&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/deployment-models/&#34; title=&#34;éƒ¨ç½²æ¨¡å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨ç½²æ¨¡å¼&lt;/a&gt;
ï¼Œå…¼å…·ç®¡ç†å¤šé›†ç¾¤å’Œæ··åˆäº‘çš„åŠŸèƒ½ã€‚åœ¨éƒ¨ç½²æ—¶éœ€è¦å……åˆ†è€ƒè™‘ Regionã€Zone çš„åˆ†å¸ƒã€ç½‘ç»œéš”ç¦»ã€å¤šç§Ÿæˆ·ã€æ§åˆ¶å¹³é¢çš„é«˜å¯ç”¨ç­‰å› ç´ ã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚æˆ‘ä»¬åŒæ—¶ä½¿ç”¨ EKS å’Œéƒ¨ç½²åœ¨ç§æœ‰æ•°æ®ä¸­å¿ƒä¸­çš„ EKS-Dï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸¤ä¸ªé›†ç¾¤ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶å¹³é¢ç®¡ç†èµ·æ¥å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œcluster1 å’Œ cluster2 åˆ†åˆ«è¡¨ç¤ºéƒ¨ç½²åœ¨ EKS å’Œ EKS-D çš„ Kubernetes é›†ç¾¤ï¼Œè¿™ä¸¤ä¸ªé›†ç¾¤çš„ç½‘ç»œæ˜¯éš”ç¦»çš„ï¼Œç°å› ä¸ºä¸Šæ–‡æ‰€è¯´çš„é€‚åˆä½¿ç”¨æ··åˆäº‘æŸä¸ªåœºæ™¯ï¼Œç°åœ¨ä¸ºäº†å°†å®ƒä»¬çº³å…¥åŒä¸€ä¸ªæœåŠ¡ç½‘æ ¼ä½¿ç”¨ä¸€ä¸ªæ§åˆ¶å¹³é¢æ¥ç®¡ç†ï¼Œæˆ‘ä»¬é‡‡ç”¨äº† &lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/primary-remote_multi-network/&#34; title=&#34;Primary-Remote å¤šç½‘ç»œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Primary-Remote å¤šç½‘ç»œ&lt;/a&gt;
çš„éƒ¨ç½²æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/eks-eksd-istio-hybrid-cloud/0081Kckwly1gm3oyiyq4fj315m0u0wi2.jpg&#34; data-img=&#34;/blog/eks-eksd-istio-hybrid-cloud/0081Kckwly1gm3oyiyq4fj315m0u0wi2.jpg&#34; data-width=&#34;1498&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
    
  
  &lt;figcaption&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ç¤ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å›¾ä¸­é»‘è‰²ç®­å¤´è¡¨ç¤ºæ§åˆ¶å¹³é¢å†…è·å–æœåŠ¡å’Œç«¯ç‚¹é…ç½®çš„è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;å›¾ä¸­è“è‰²ç®­å¤´è¡¨ç¤ºæœåŠ¡ A è®¿é—®æœåŠ¡ B çš„è·¯ç”±ï¼›&lt;/li&gt;
&lt;li&gt;å›¾ä¸­ç»¿è‰²ç®­å¤´è¡¨ç¤ºæœåŠ¡ A/B å‘æ§åˆ¶å¹³é¢è·å–æœåŠ¡ç«¯ç‚¹çš„è·¯ç”±ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨è¯¥æ¨¡å¼éƒ¨ç½² Istio æ—¶ï¼Œéœ€è¦ä¿è¯æ§åˆ¶å¹³é¢å¯¹ Kubernetes çš„ API Server çš„è¿æ¥æ€§ï¼Œå…·ä½“çš„å®‰è£…è¿‡ç¨‹è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster/primary-remote_multi-network/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;EKS-D ä¿è¯äº†åœ¨æ··åˆäº‘ç¯å¢ƒä¸‹ Kubernetes é›†ç¾¤çš„ä¸€è‡´æ€§ï¼Œé™ä½äº†é›†ç¾¤çš„è¿ç»´æˆæœ¬ã€‚Istio å›ºæœ‰çš„å¤šé›†ç¾¤æ„ŸçŸ¥èƒ½åŠ›ï¼Œè¿›ä¸€æ­¥ä»æœåŠ¡å±‚é¢å¢å¼ºäº†ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ï¼Œå¸®åŠ©æˆ‘ä»¬å°†å¤šé›†ç¾¤ä¸­çš„æœåŠ¡çº³å…¥ç»Ÿä¸€çš„æ§åˆ¶å¹³é¢ç®¡ç†ã€‚EKS-D å‘å¸ƒçš„æ—¶æœ‰ä¼—å¤šçš„åˆä½œä¼™ä¼´çš„å“åº”ï¼Œå…¶ä¸­ Tetrate ä½œä¸º Istio service mesh çš„è§£å†³æ–¹æ¡ˆä¾›åº”å•†æä¾›äº† &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridgeï¼ˆTSBï¼‰&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridgeï¼ˆTSBï¼‰&lt;/a&gt;
åœ¨ EKS å’Œ EKS-D ä¸Šå®ç°äº†è·¨å·¥ä½œè´Ÿè½½çš„ç»Ÿä¸€åº”ç”¨è¿æ¥å’Œå®‰å…¨æ€§ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio å¯¹è™šæ‹Ÿæœºæ”¯æŒå²è¯</title>
      <link>https://jimmysong.io/blog/istio-vm-odysssey/</link>
      <pubDate>Fri, 25 Dec 2020 14:18:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-vm-odysssey/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡å°†ä¸ºä½ ä»‹ç» Istio å†å²ä¸Šå¯¹è™šæ‹Ÿæœºè´Ÿè½½çš„æ”¯æŒæƒ…å†µï¼Œå°¤å…¶æ˜¯ Istio 1.8 ä¸­å¼•å…¥çš„æ™ºèƒ½ DNS ä»£ç†åŠ &lt;code&gt;WorkloadGroup&lt;/code&gt; ä½¿å¾—è™šæ‹Ÿæœºä¸å®¹å™¨åœ¨èµ„æºæŠ½è±¡å±‚é¢å¯ä»¥ç­‰åŒè§†ä¹‹ã€‚æˆ‘å°†ä¸ºä½ å±•ç°ä¸€å¹… Istio æ”¯æŒè™šæ‹Ÿæœºçš„æ³¢æ¾œå£®é˜”çš„å¥¥å¾·èµ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘&lt;a href=&#34;https://thenewstack.io/how-to-integrate-virtual-machines-into-istio-service-mesh/&#34; title=&#34;ä¹‹å‰çš„åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;
ä¸­è°ˆåˆ° Istio 1.7 å¦‚ä½•æ”¯æŒè™šæ‹Ÿæœºï¼Œä½†é‚£æ—¶è™šæ‹Ÿæœºä»ç„¶æ— æ³•æ— ç¼çš„é›†æˆåˆ° Istio ä¸­ï¼Œå› ä¸ºè¿˜éœ€è¦åšå¾ˆå¤šæ‰‹åŠ¨çš„æ“ä½œã€‚ç°åœ¨ï¼ŒIstio 1.8 æ–°å¢äº† WorkloadGroup åŠ&lt;a href=&#34;https://istio.io/latest/blog/2020/dns-proxy/&#34; title=&#34;æ™ºèƒ½ DNS ä»£ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ™ºèƒ½ DNS ä»£ç†&lt;/a&gt;
ï¼Œè¿™ä½¿å¾—å¦‚è™šæ‹Ÿæœºè¿™æ ·çš„é Kubernetes å·¥ä½œè´Ÿè½½å¯ä»¥åœ¨ Istio ä¸­æˆä¸ºåƒ Pod ä¸€æ ·çš„ä¸€ç­‰å…¬æ°‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è®ºæœ‰æ²¡æœ‰ä¸ºè™šæ‹Ÿæœºå®‰è£… sidecarï¼Œè™šæ‹Ÿæœºé€šå¸¸æƒ…å†µä¸‹æ— æ³•ç›´æ¥è®¿é—® Kubernetes é›†ç¾¤ä¸­çš„ DNS æœåŠ¡å™¨ä»¥è§£æ Kubernetes  æœåŠ¡çš„ Cluster IP çš„ï¼ˆè™½ç„¶ä½ ä¹Ÿè®¸å¯ä»¥é€šè¿‡ä¸€äº›é»‘å®¢çš„æ‰‹æ®µåšåˆ°ï¼‰ï¼Œè¿™æ˜¯åœ¨ Istio ä¸­é›†æˆè™šæ‹Ÿçš„æœ€åä¸€å—çŸ­æ¿ï¼Œç»ˆäºåœ¨ Istio 1.8 ä¸­å®Œæˆäº†çªç ´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¦æ”¯æŒè™šæ‹Ÿæœº&#34;&gt;ä¸ºä»€ä¹ˆè¦æ”¯æŒè™šæ‹Ÿæœºï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å°†åº”ç”¨åœ¨è¿ç§»åˆ°äº‘åŸç”Ÿæ¶æ„ï¼Œä¸æ–­å®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå°†ç»å†ä¸‰ä¸ªé˜¶æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-vm-odysssey/0081Kckwly1gm0d6t775lj31s80k8go8.jpg&#34; data-img=&#34;/blog/istio-vm-odysssey/0081Kckwly1gm0d6t775lj31s80k8go8.jpg&#34; data-width=&#34;2312&#34; data-height=&#34;728&#34; alt=&#34;image&#34; data-caption=&#34;äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰ä¸ªé˜¶æ®µ&#34;&gt;
    
  
  &lt;figcaption&gt;äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰ä¸ªé˜¶æ®µ&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜¶æ®µä¸€ï¼šåº”ç”¨å…¨éƒ¨éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Š&lt;/li&gt;
&lt;li&gt;é˜¶æ®µäºŒï¼šåº”ç”¨æ—¢éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šä¹Ÿéƒ¨ç½²åœ¨å®¹å™¨é‡Œï¼Œæ­£åœ¨ä»è™šæ‹Ÿæœºå‘å®¹å™¨ä¸­è¿ç§»ï¼Œå¹¶ä½¿ç”¨ Kubernetes ç®¡ç†å®¹å™¨&lt;/li&gt;
&lt;li&gt;é˜¶æ®µä¸‰ï¼šæ‰€æœ‰çš„åº”ç”¨ä¼˜å…ˆéƒ¨ç½²åœ¨å®¹å™¨é‡Œï¼Œä½¿ç”¨ Kubernetes ç®¡ç†å®¹å™¨ï¼Œä½¿ç”¨ Istio ç®¡ç†åº”ç”¨é—´çš„é€šä¿¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šå›¾ä»…æ˜¯å¯¹ä»¥ä¸Šä¸‰ä¸ªé˜¶æ®µçš„æœ€ç®€åŒ–æè¿°ï¼Œå®é™…ä¸Šè¿˜ä¼šæœ‰å¤šæ··åˆäº‘ã€å¤šæœºæˆ¿ã€å¤šé›†ç¾¤ç­‰æƒ…å†µï¼Œä¸”é˜¶æ®µä¸‰åªæ˜¯ä¸ªç†æƒ³åŒ–çš„é˜¶æ®µï¼Œå®¹å™¨å’Œè™šæ‹Ÿæœºå°†æ˜¯é•¿æœŸå…±å­˜çš„ï¼Œä½†æ˜¯å®¹å™¨åŒ–è¶‹åŠ¿ä¸å˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é˜¶æ®µäºŒä¸­ï¼Œäººä»¬é€šå¸¸ä¼šå°†æ–°ä¸šåŠ¡å’Œå°‘é‡åº”ç”¨ç‡å…ˆå®ç°å®¹å™¨åŒ–ï¼Œå¹¶éƒ¨ç½²åˆ° Kubernetes ä¸­ï¼Œåœ¨åº”ç”¨å°šæœªå®Œå…¨å®ç°å®¹å™¨åŒ–çš„æ—¶å€™ï¼Œå¤„äºè¿‡åº¦çŠ¶æ€æ—¶ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œå¦‚ä½•è®©åº”ç”¨ä¸éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸­çš„æœåŠ¡äº¤äº’ï¼Ÿè™šæ‹Ÿæœºå¦‚ä½•è®¿é—®å®¹å™¨ä¸­çš„æœåŠ¡ï¼Ÿåœ¨æœåŠ¡è¿ç§»çš„è¿‡ç¨‹ä¸­å¦‚ä½•ä¿è¯ç¨³å®šæ— ç¼ï¼Ÿæ˜¯å¦å¯ä»¥å°†å®¹å™¨å’Œè™šæ‹Ÿæœºçº³å…¥ä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶å¹³é¢æ¥ç®¡ç†ï¼ŸIstio ä»å¼€æºåˆæœŸå°±è€ƒè™‘å¹¶ç€æ‰‹è§£å†³è¿™ä¸€é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-æ”¯æŒè™šæ‹Ÿæœºçš„å†å²&#34;&gt;Istio æ”¯æŒè™šæ‹Ÿæœºçš„å†å²&lt;/h2&gt;
&lt;p&gt;Istio å¯¹äºè™šæ‹Ÿæœºçš„æ”¯æŒæ˜¯ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œå ªç§°æ˜¯ä¸€éƒ¨å¥¥å¾·èµ›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-mesh-æ‰©å¼ &#34;&gt;Istio mesh æ‰©å¼ &lt;/h3&gt;
&lt;p&gt;Istio ä» 0.2 ç‰ˆæœ¬å¼€å§‹é€šè¿‡ &lt;a href=&#34;https://istio.io/v0.2/docs/setup/kubernetes/mesh-expansion.html&#34; title=&#34;Istio Mesh Expansion&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Mesh Expansion&lt;/a&gt;
 å°†è™šæ‹ŸæœºåŠ å…¥çš„ Mesh ä¸­ï¼Œä½†æ˜¯éœ€è¦æ»¡è¶³ä»¥ä¸‹å‰ææ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è™šæ‹Ÿæœºå¿…é¡»å¯ä»¥é€šè¿‡ IP åœ°å€ç›´æ¥è®¿é—®åˆ°åº”ç”¨çš„ Podï¼Œè¿™å°±è¦æ±‚å®¹å™¨ä¸ VM ä¹‹é—´é€šè¿‡ VPC æˆ–è€… VPN å»ºç«‹æ‰å¹³ç½‘ç»œï¼Œè™šæ‹Ÿæœºä¸éœ€è¦è®¿é—® Cluster IPï¼Œç›´æ¥å¯¹æœåŠ¡çš„ Endpoint ç«¯ç‚¹è®¿é—®å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿæœºå¿…é¡»å¯ä»¥è®¿é—®åˆ° Istio çš„æ§åˆ¶å¹³é¢æœåŠ¡ï¼ˆPilotã€Mixerã€CAï¼Œç°åœ¨å·²æ­£æ•´åˆä¸º Istiodï¼‰ï¼Œå¯ä»¥é€šè¿‡åœ¨ Istio Mesh ä¸­éƒ¨ç½²è´Ÿè½½å‡è¡¡å™¨å°†æ§åˆ¶å¹³é¢ç«¯ç‚¹æš´éœ²ç»™è™šæ‹Ÿæœºã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå¯é€‰ï¼‰è™šæ‹Ÿæœºå¯ä»¥è®¿é—®åˆ° Mesh å†…éƒ¨çš„ï¼ˆéƒ¨ç½²åœ¨ Kubernetes ä¸­ï¼‰çš„ DNS serverã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é›†æˆè™šæ‹Ÿæœºçš„æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸º Istio æ§åˆ¶å¹³é¢æœåŠ¡åŠ Kubernetes é›†ç¾¤çš„ DNS æœåŠ¡åˆ›å»º Internal è´Ÿè½½å‡è¡¡å™¨ï¼›&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆ Istio Service CIDRã€Service Account tokenã€å®‰å…¨è¯ä¹¦ã€Istio æ§åˆ¶å¹³é¢æœåŠ¡çš„ IPï¼ˆé€šè¿‡ Internal è´Ÿè½½å‡è¡¡å™¨æš´éœ²å‡ºæ¥çš„ IPï¼‰çš„é…ç½®æ–‡ä»¶å¹¶å‘é€ç»™è™šæ‹Ÿæœºï¼›&lt;/li&gt;
&lt;li&gt;ï¼ˆå¯é€‰ï¼‰åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…ã€é…ç½®å¹¶å¯åŠ¨ Istio çš„ç»„ä»¶ã€dnsmaqï¼ˆç”¨äº DNS å‘ç°ï¼‰ï¼Œæ­¤æ—¶è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨   FQDN è®¿é—® mesh ä¸­çš„æœåŠ¡äº†ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸ºäº†ä¿è¯è™šæ‹Ÿæœºå¯ä»¥æ­£ç¡®è§£æå‡º mesh ä¸­æœåŠ¡çš„ Cluster IPï¼›&lt;/li&gt;
&lt;li&gt;è‹¥è¦åœ¨è™šæ‹Ÿæœºä¸­è¿è¡ŒæœåŠ¡ï¼Œéœ€è¦é…ç½® sidecarï¼Œæ–°å¢éœ€è¦æ‹¦æˆªçš„ inbound ç«¯å£ï¼Œç„¶åé‡å¯ istioï¼Œè¿˜éœ€è¦è¿è¡Œ istioctl ä¸ºæœåŠ¡æ³¨å†Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„ä»é›†æˆè™šæ‹Ÿæœºåˆ°åœ¨ mesh ä¸­è®¿é—®è™šæ‹Ÿæœºä¸­æœåŠ¡çš„è¯¦ç»†æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-vm-odysssey/0081Kckwly1gm0d6rogojj30u00yhdil.jpg&#34; data-img=&#34;/blog/istio-vm-odysssey/0081Kckwly1gm0d6rogojj30u00yhdil.jpg&#34; data-width=&#34;1080&#34; data-height=&#34;1241&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ä¸€ï¼šä»é›†æˆè™šæ‹Ÿæœºåˆ°åœ¨ mesh ä¸­è®¿é—®è™šæ‹Ÿæœºä¸­æœåŠ¡çš„è¯¦ç»†æµç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ä¸€ï¼šä»é›†æˆè™šæ‹Ÿæœºåˆ°åœ¨ mesh ä¸­è®¿é—®è™šæ‹Ÿæœºä¸­æœåŠ¡çš„è¯¦ç»†æµç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DNS è¢«è™šæ‹Ÿæœºä¸­éƒ¨ç½²çš„ &lt;code&gt;dnsmasq&lt;/code&gt; åŠ«æŒï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥æ­£ç¡®çš„è·å– Istio æœåŠ¡ã€Kubernetes å†…ç½® DNS çš„ç«¯ç‚¹ IPï¼›&lt;/li&gt;
&lt;li&gt;è®¿é—® Kubernetes çš„å†…ç½® DNS æœåŠ¡ï¼ˆè¯¥æœåŠ¡å·²é€šè¿‡ Internal è´Ÿè½½å‡è¡¡å™¨æš´éœ²åˆ°é›†ç¾¤å¤–ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è¿”å› &lt;code&gt;productpage.bookinfo.svc.cluster.local&lt;/code&gt; è¢«è§£æå‡ºæ¥çš„ Cluster IPï¼Œæ³¨æ„è¯¥ IP åœ°å€æ— æ³•ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯å¦‚æœæ— æ³•è¢« DNS è§£æçš„è¯å°†å¯¼è‡´ VM å¯¹è¯¥æœåŠ¡çš„è¯·æ±‚å¤±è´¥ï¼›&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿæœºå¯¹ mesh ä¸­æœåŠ¡çš„è®¿é—®è¢« sidecar proxy åŠ«æŒï¼›&lt;/li&gt;
&lt;li&gt;å› ä¸º proxy å·²è¿æ¥ Istio æ§åˆ¶å¹³é¢ï¼Œå¯é€šè¿‡ xDS æŸ¥è¯¢åˆ°è¯¥æœåŠ¡çš„ç«¯ç‚¹ï¼Œå› æ­¤æµé‡å°†è¢«è½¬å‘åˆ°å…¶ä¸­çš„ä¸€ä¸ªç«¯ç‚¹ã€‚å…³äºè¿™ä¸€æ­¥çš„è¯¦ç»†è¿‡ç¨‹è¯·å‚è€ƒ &lt;a href=&#34;https://www.servicemesher.com/istio-handbook/concepts/sidecar-traffic-route.html&#34; title=&#34;Istio Handbook ä¸­çš„ sidecar æµé‡è·¯ç”±æœºåˆ¶åˆ†æ ä¸€èŠ‚&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Handbook ä¸­çš„ sidecar æµé‡è·¯ç”±æœºåˆ¶åˆ†æ ä¸€èŠ‚&lt;/a&gt;
ï¼›&lt;/li&gt;
&lt;li&gt;è¦æƒ³åœ¨ mesh ä¸­è®¿é—® VM ä¸­çš„æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨ &lt;code&gt;istioctl register&lt;/code&gt; å‘½ä»¤æ‰‹åŠ¨å°† VM ä¸­çš„æœåŠ¡æ·»åŠ åˆ° mesh ä¸­ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯å°† VM ä¸­çš„æœåŠ¡ï¼Œæ³¨å†Œåˆ° Kubernetes ä¸­çš„ service å’Œ endpointï¼›&lt;/li&gt;
&lt;li&gt;mesh ä¸­çš„æœåŠ¡å¯ä»¥ä½¿ç”¨ VM æ³¨å†Œçš„æœåŠ¡åç§°ï¼ˆFQDNï¼Œä¾‹å¦‚ &lt;code&gt;mysql.vm.svc.cluster.local&lt;/code&gt;ï¼‰æ¥è®¿é—®ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Š Istio å¯¹è™šæ‹Ÿæœºæ”¯æŒçš„æ–¹å¼ä¸€ç›´å»¶ç»­åˆ° Istio 1.0ï¼Œåœ¨ Istio 1.1 çš„æ—¶å€™å¼•å…¥äº†æ–°çš„ API &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/service-entry/&#34; title=&#34;ServiceEntry&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServiceEntry&lt;/a&gt;
ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ Istio çš„å†…éƒ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­æ·»åŠ é¢å¤–çš„æ¡ç›®ï¼Œè¿™æ · mesh ä¸­çš„æœåŠ¡å°±å¯ä»¥è®¿é—®/è·¯ç”±åˆ°è¿™äº›æ‰‹åŠ¨æŒ‡å®šçš„æœåŠ¡äº†ï¼Œä¸å†éœ€è¦è¿è¡Œ &lt;code&gt;istioctl register&lt;/code&gt; å‘½ä»¤ï¼Œè€Œä¸”è¯¥å‘½ä»¤åœ¨ Istio 1.9 ä¸­å°†è¢«åºŸå¼ƒã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.5 ä¸­å¢åŠ äº† &lt;code&gt;istioctl experimental add-to-mesh&lt;/code&gt; å‘½ä»¤ï¼Œå¯ä»¥å°†è™šæ‹Ÿæœºä¸­çš„æœåŠ¡æ·»åŠ åˆ° mesh ä¸­ï¼Œå…¶åŠŸèƒ½ä¸ &lt;code&gt;istioctl register&lt;/code&gt; ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–°å¢èµ„æºæŠ½è±¡&#34;&gt;æ–°å¢èµ„æºæŠ½è±¡&lt;/h3&gt;
&lt;p&gt;Istio ä» &lt;a href=&#34;https://istio.io/latest/news/releases/1.6.x/announcing-1.6/&#34; title=&#34;1.6 ç‰ˆæœ¬&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.6 ç‰ˆæœ¬&lt;/a&gt;
å¼€å§‹åœ¨&lt;a href=&#34;https://istio.io/latest/news/releases/1.6.x/announcing-1.6/change-notes/&#34; title=&#34;æµé‡ç®¡ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµé‡ç®¡ç†&lt;/a&gt;
ä¸­å¼•å…¥äº†æ–°çš„èµ„æºç±»å‹ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/workload-entry/&#34; title=&#34;WorkloadEntry&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WorkloadEntry&lt;/a&gt;
ï¼Œç”¨ä»¥å°†è™šæ‹Ÿæœºè¿›è¡ŒæŠ½è±¡ï¼Œä½¿å¾—è™šæ‹Ÿæœºåœ¨åŠ å…¥ mesh åå¯ä»¥ä½œä¸ºä¸ Kubernetes ä¸­çš„ Pod ç­‰åŒçš„è´Ÿè½½ï¼Œå…·å¤‡æµé‡ç®¡ç†ã€å®‰å…¨ç®¡ç†ã€å¯è§†åŒ–ç­‰èƒ½åŠ›ã€‚é€šè¿‡ &lt;code&gt;WorkloadEntry&lt;/code&gt; å¯ä»¥ç®€åŒ–è™šæ‹Ÿæœºçš„ç½‘æ ¼åŒ–é…ç½®è¿‡ç¨‹ã€‚&lt;code&gt;WorkloadEntry&lt;/code&gt; å¯¹è±¡å¯ä»¥æ ¹æ®æœåŠ¡æ¡ç›®ä¸­æŒ‡å®šçš„æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©å¤šä¸ªå·¥ä½œè´Ÿè½½æ¡ç›®å’Œ Kubernetes podã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.8 ä¸­å¢åŠ äº† &lt;a href=&#34;http://istio.io/latest/docs/reference/config/networking/workload-group/&#34; title=&#34;&amp;lt;code&amp;gt;WorkloadGroup&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;WorkloadGroup&lt;/code&gt;&lt;/a&gt;
 çš„èµ„æºå¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè§„èŒƒï¼Œå¯ä»¥åŒæ—¶åŒ…æ‹¬è™šæ‹Ÿæœºå’Œ Kubernetes å·¥ä½œè´Ÿè½½ï¼Œæ—¨åœ¨æ¨¡ä»¿ç°æœ‰çš„ç”¨äº Kubernetes å·¥ä½œè´Ÿè½½çš„ sidecar æ³¨å…¥å’Œéƒ¨ç½²è§„èŒƒæ¨¡å‹æ¥å¼•å¯¼ Istio ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è™šæ‹Ÿæœºä¸ Kubernetes ä¸­è´Ÿè½½çš„èµ„æºæŠ½è±¡å±‚çº§å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯¹æ¯”é¡¹&lt;/th&gt;
&lt;th&gt;Kubernetes&lt;/th&gt;
&lt;th&gt;è™šæ‹Ÿæœº&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŸºç¡€è°ƒåº¦å•ä½&lt;/td&gt;
&lt;td&gt;Pod&lt;/td&gt;
&lt;td&gt;WorkloadEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¼–æ’ç»„åˆ&lt;/td&gt;
&lt;td&gt;Deployment&lt;/td&gt;
&lt;td&gt;WorkloadGroup&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/td&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;ServiceEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä»ä¸Šé¢çš„å›¾è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºè™šæ‹Ÿæœºå·¥ä½œè´Ÿè½½æ˜¯å¯ä»¥ä¸ Kubernetes ä¸­çš„è´Ÿè½½ä¸€ä¸€å¯¹å¯¹åº”çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶çœ‹ä¼¼ä¸€åˆ‡éƒ½æ¯”è¾ƒå®Œç¾äº†ï¼Œä½†æ˜¯ç›´æ¥å°† Kubernetes é›†ç¾¤ä¸­çš„ DNS server æš´éœ²å‡ºæ¥ä¼šå¸¦æ¥å¾ˆå¤§çš„&lt;a href=&#34;https://blog.aquasec.com/dns-spoofing-kubernetes-clusters&#34; title=&#34;å®‰å…¨é£é™©&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨é£é™©&lt;/a&gt;
ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬æ‰‹åŠ¨å°†è™šæ‹Ÿæœºéœ€è¦è®¿é—®çš„æœåŠ¡çš„åŸŸåå’Œ Cluster IP å¯¹å†™åˆ°æœ¬æœºçš„ &lt;code&gt;/etc/hosts&lt;/code&gt; ä¸­ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªèŠ‚ç‚¹æ•°é‡åºå¤§çš„åˆ†å¸ƒå¼é›†ç¾¤æ¥è¯´ï¼Œè¿™ç§åšæ³•åˆæœ‰äº›ä¸ç°å®ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡é…ç½®è™šæ‹Ÿæœºæœ¬åœ° &lt;code&gt;/etc/hosts&lt;/code&gt; è®¿é—® mesh å†…æœåŠ¡çš„æµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-vm-odysssey/0081Kckwly1gm0d6qx2o0j30sq0v440v.jpg&#34; data-img=&#34;/blog/istio-vm-odysssey/0081Kckwly1gm0d6qx2o0j30sq0v440v.jpg&#34; data-width=&#34;1034&#34; data-height=&#34;1120&#34; alt=&#34;image&#34; data-caption=&#34;å›¾äºŒï¼šé€šè¿‡é…ç½®è™šæ‹Ÿæœºæœ¬åœ° /etc/hosts è®¿é—® mesh å†…æœåŠ¡çš„æµç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾äºŒï¼šé€šè¿‡é…ç½®è™šæ‹Ÿæœºæœ¬åœ° /etc/hosts è®¿é—® mesh å†…æœåŠ¡çš„æµç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†è™šæ‹Ÿæœºä¸­çš„æœåŠ¡æ³¨å†Œåˆ° mesh ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;å°†è¦è®¿é—®çš„æœåŠ¡çš„åŸŸåã€Cluster IP å¯¹æ‰‹åŠ¨å†™å…¥è™šæ‹Ÿæœºæœ¬åœ°çš„ &lt;code&gt;/etc/hosts&lt;/code&gt; æ–‡ä»¶ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿæœºè·å¾—è®¿é—®æœåŠ¡çš„ Cluster IPï¼›&lt;/li&gt;
&lt;li&gt;æµé‡è¢« sidecar proxy æ‹¦æˆªå¹¶è§£æå‡ºè¦è®¿é—®çš„æœåŠ¡çš„ç«¯ç‚¹åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;è®¿é—®æœåŠ¡çš„æŒ‡å®šç«¯ç‚¹ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Service å¯¹è±¡æ¥å®ç°æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ DNS åç§°ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æœåŠ¡åç§°æ¥äº’ç›¸è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ServiceEntry å°†è™šæ‹Ÿæœºä¸­çš„æœåŠ¡æ³¨å†Œåˆ° Istio çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­ï¼Œä½†æ˜¯åœ¨ Kubernetes é›†ç¾¤ä¸­çš„ DNS server æ— æ³•å¯¹ mesh å¤–éƒ¨æš´éœ²çš„æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºæ— æ³•è®¿é—® Kubernetes é›†ç¾¤ä¸­çš„ DNS æœåŠ¡ä»¥è·å–æœåŠ¡çš„ Cluster IPï¼Œä»è€Œå¯¼è‡´è™šæ‹Ÿæœºè®¿é—® mesh ä¸­çš„æœåŠ¡å¤±è´¥ã€‚å¦‚æœèƒ½åœ¨è™šæ‹Ÿæœºä¸­å¢åŠ ä¸€ä¸ª sidecar å¯ä»¥é€æ˜åœ°æ‹¦æˆª DNS è¯·æ±‚ï¼Œå¯è·å– mesh å†…æ‰€æœ‰æœåŠ¡çš„ ClusterIPï¼Œç±»ä¼¼äºå›¾ä¸€ä¸­çš„ &lt;code&gt;dnsmasq&lt;/code&gt; çš„è§’è‰²ï¼Œè¿™æ ·ä¸å°±å¯ä»¥è§£å†³é—®é¢˜äº†å—ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;æ™ºèƒ½-dns-ä»£ç†&#34;&gt;æ™ºèƒ½ DNS ä»£ç†&lt;/h3&gt;
&lt;p&gt;Istio 1.8 ä¸­å¼•å…¥äº†&lt;a href=&#34;https://cloudnative.to/blog/istio-dns-proxy/&#34; title=&#34;æ™ºèƒ½ DNS ä»£ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ™ºèƒ½ DNS ä»£ç†&lt;/a&gt;
ï¼Œè™šæ‹Ÿæœºè®¿é—® mesh å†…æœåŠ¡æ— éœ€å†é…ç½® &lt;code&gt;/ect/hosts&lt;/code&gt;ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-vm-odysssey/0081Kckwly1gm0d6sgfpxj30oi0rsjt5.jpg&#34; data-img=&#34;/blog/istio-vm-odysssey/0081Kckwly1gm0d6sgfpxj30oi0rsjt5.jpg&#34; data-width=&#34;882&#34; data-height=&#34;1000&#34; alt=&#34;image&#34; data-caption=&#34;å›¾ä¸‰ï¼šå¼•å…¥äº†æ™ºèƒ½ DNS ä»£ç†åè™šæ‹Ÿæœºè®¿é—® mesh å†…æœåŠ¡çš„æµç¨‹&#34;&gt;
    
  
  &lt;figcaption&gt;å›¾ä¸‰ï¼šå¼•å…¥äº†æ™ºèƒ½ DNS ä»£ç†åè™šæ‹Ÿæœºè®¿é—® mesh å†…æœåŠ¡çš„æµç¨‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;DNS proxy æ˜¯ç”¨ Go ç¼–å†™çš„ Istio sidecar ä»£ç†ã€‚Sidecar ä¸Šçš„ Istio agent å°†é™„å¸¦ä¸€ä¸ªç”± Istiod åŠ¨æ€ç¼–ç¨‹çš„ç¼“å­˜ DNS ä»£ç†ã€‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ DNS æŸ¥è¯¢ä¼šè¢« pod æˆ– VM ä¸­çš„ Istio ä»£ç†é€æ˜åœ°æ‹¦æˆªå’ŒæœåŠ¡ï¼Œè¯¥ä»£ç†ä¼šæ™ºèƒ½åœ°å“åº” DNS æŸ¥è¯¢è¯·æ±‚ï¼Œå¯ä»¥å®ç°è™šæ‹Ÿæœºåˆ°æœåŠ¡ç½‘æ ¼çš„æ— ç¼å¤šé›†ç¾¤è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼ŒIstio 1.8 ä¸­å¼•å…¥çš„ WordloadGroup åŠæ™ºèƒ½ DNS ä»£ç†ï¼Œè¡¥è¶³äº† Istio å¯¹è™šæ‹Ÿæœºæ”¯æŒçš„æœ€åä¸€å—çŸ­æ¿ï¼Œä½¿å¾—éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸­çš„é—ç•™åº”ç”¨å¯ä»¥è·Ÿ Kubernetes ä¸­çš„ Pod ä¸€æ ·å®Œå…¨ç­‰åŒçœ‹å¾…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™éƒ¨ Istio æ”¯æŒè™šæ‹Ÿæœºçš„å¥¥å¾·èµ›ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šä»æœ€åˆçš„å°† mesh ä¸­çš„ DNS server æš´éœ²ç»™å¤–éƒ¨ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å®‰è£…é…ç½® &lt;code&gt;dnsmasq&lt;/code&gt;ï¼Œåˆ°æœ€åçš„ä½¿ç”¨æ™ºèƒ½ DNS ä»£ç†ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;WorkloadEntry&lt;/code&gt;ã€&lt;code&gt;WorkloadGroup&lt;/code&gt; å’Œ &lt;code&gt;ServiceEntry&lt;/code&gt; ç­‰èµ„æºæŠ½è±¡ï¼Œé€æ­¥å®ç°äº†è™šæ‹Ÿæœºå’Œ pod çš„ç»Ÿä¸€ç®¡ç†ã€‚æœ¬æ–‡ä»…ä»…æ˜¯é’ˆå¯¹å•é›†ç¾¤çš„æƒ…å†µï¼Œåœ¨å®é™…çš„ç”Ÿäº§ä¸­ä½¿ç”¨è¿˜è¿œè¿œä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†å®‰å…¨ã€å¤šé›†ç¾¤ã€å¤šç§Ÿæˆ·ç­‰è¯¸å¤šé—®é¢˜ï¼Œæ¬¢è¿å…³æ³¨ Tetrate çš„æ——èˆ°äº§å“ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 äº†è§£æ›´å¤šå…³äº Istio åº”ç”¨åœ¨ç”Ÿäº§ä¸Šçš„æœ€ä½³å®è·µã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Istio 1.8â€”â€”ç”¨æˆ·è‡³ä¸Šçš„é€‰æ‹©</title>
      <link>https://jimmysong.io/blog/istio-18-release/</link>
      <pubDate>Fri, 20 Nov 2020 08:34:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-18-release/</guid>
      <description>
        
        
        &lt;p&gt;ä»Šå¤© &lt;a href=&#34;https://istio.io/latest/news/releases/1.8.x/announcing-1.8/&#34; title=&#34;Istio 1.8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.8&lt;/a&gt;
 å‘å¸ƒäº†ï¼Œè¿™æ˜¯ Istio åœ¨ 2020 å¹´å‘å¸ƒçš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼ŒæŒ‰ç…§ Istio ç¤¾åŒºåœ¨&lt;a href=&#34;https://istio.io/latest/blog/2020/tradewinds-2020/&#34; title=&#34;ä»Šå¹´åˆè®¾å®šçš„ç›®æ ‡&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šå¹´åˆè®¾å®šçš„ç›®æ ‡&lt;/a&gt;
ç»§ç»­æ¨è¿›ï¼Œè¯¥ç‰ˆæœ¬ä¸»è¦æœ‰ä»¥ä¸‹æ›´æ–°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒä½¿ç”¨ Helm 3 è¿›è¡Œå®‰è£…å’Œå‡çº§&lt;/li&gt;
&lt;li&gt;æ­£å¼ç§»é™¤äº† Mixer&lt;/li&gt;
&lt;li&gt;æ–°å¢äº† Istio DNS proxyï¼Œé€æ˜åœ°æ‹¦æˆªåº”ç”¨ç¨‹åºçš„ DNS æŸ¥è¯¢ï¼Œå®ç°æ™ºèƒ½åº”ç­”&lt;/li&gt;
&lt;li&gt;æ–°å¢äº† &lt;code&gt;WorkloadGroup&lt;/code&gt; ä»¥ç®€åŒ–å¯¹è™šæ‹Ÿæœºçš„å¼•å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;WorkloadGroup &lt;/code&gt;æ˜¯ä¸€ä¸ªæ–°çš„ API å¯¹è±¡ï¼Œæ—¨åœ¨ä¸è™šæ‹Ÿæœºç­‰é Kubernetes å·¥ä½œè´Ÿè½½ä¸€èµ·ä½¿ç”¨ï¼Œæ¨¡ä»¿ç°æœ‰çš„ç”¨äº Kubernetes å·¥ä½œè´Ÿè½½çš„ sidecar æ³¨å…¥å’Œéƒ¨ç½²è§„èŒƒæ¨¡å‹æ¥å¼•å¯¼ Istio ä»£ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…ä¸å‡çº§&#34;&gt;å®‰è£…ä¸å‡çº§&lt;/h2&gt;
&lt;p&gt;Istio ä» 1.5 ç‰ˆæœ¬å¼€å§‹å¼ƒç”¨äº† Helmï¼Œä½¿ç”¨ &lt;code&gt;istioctl manifest&lt;/code&gt; æ–¹å¼å®‰è£…ï¼Œåæ¥åˆæ”¹æˆäº† &lt;code&gt;istioctl install&lt;/code&gt;ï¼Œç°åœ¨åˆé‡æ–°å›å½’äº† Helmï¼ŒHelm ä½œä¸º Kubernetes ç¯å¢ƒä¸‹æœ€å¸¸ç”¨çš„åº”ç”¨å®‰è£…ç®¡ç†ç»„ä»¶ï¼Œæ­¤æ¬¡å›å½’ä¹Ÿæ˜¯å€¾å¬ç”¨æˆ·å£°éŸ³ï¼Œä¼˜åŒ–å®‰è£…ä½“éªŒçš„çš„ååº”å§ï¼Œä¸è¿‡ Istio Operator ä¾ç„¶å°†æ˜¯ Istio å®‰è£…çš„æœ€ç»ˆå½¢å¼ï¼Œä» 1.8 ç‰ˆæœ¬å¼€å§‹ Istio æ”¯æŒä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/helm/&#34; title=&#34;Helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt;
 è¿›è¡Œ in-place å‡çº§å’Œ canary å‡çº§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¢å¼º-istio-çš„æ˜“ç”¨æ€§&#34;&gt;å¢å¼º Istio çš„æ˜“ç”¨æ€§&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤è¡Œå·¥å…·æ–°çš„äº† bug reporting åŠŸèƒ½ï¼ˆ&lt;code&gt;istioctl bug-report&lt;/code&gt;ï¼‰ï¼Œå¯ä»¥ç”¨æ¥æ”¶é›†è°ƒè¯•ä¿¡æ¯å’Œè·å–é›†ç¾¤çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/blog/2020/addon-rework/&#34; title=&#34;å®‰è£… add-on&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… add-on&lt;/a&gt;
 çš„æ–¹å¼å˜äº†ï¼Œåœ¨ 1.7 ä¸­å·²ç»ä¸æ¨èä½¿ç”¨ istioctl æ¥å®‰è£…ï¼Œåœ¨ 1.8 ä¸­ç›´æ¥è¢«ç§»é™¤äº†ï¼Œè¿™æ ·æœ‰åˆ©äºè§£å†³ add-on è½åäºä¸Šæ¸¸åŠéš¾ä»¥ç»´æŠ¤çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¼ç§»é™¤äº† Mixerï¼Œæ¨èä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/blog/2020/wasm-announce/&#34; title=&#34;WebAssembly&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly&lt;/a&gt;
 é€šè¿‡æ‰©å±• Envoy çš„æ–¹å¼æ¥æ‰©å±• Istioï¼Œä¹Ÿæ¨èå¤§å®¶ä½¿ç”¨ &lt;a href=&#34;https://www.getenvoy.io/reference/getenvoy_extension_toolkit_reference/&#34; title=&#34;GetEnvoy Toolkit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GetEnvoy Toolkit&lt;/a&gt;
 æ¥è¿›è¡Œ Envoy çš„æ‰©å±•å¼€å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒ&#34;&gt;å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘&lt;a href=&#34;https://thenewstack.io/how-to-integrate-virtual-machines-into-istio-service-mesh/&#34; title=&#34;ä¹‹å‰çš„åšå®¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;
ä¸­è°ˆåˆ° Istio 1.7 å¦‚ä½•æ”¯æŒè™šæ‹Ÿæœºï¼Œåœ¨ Istio 1.8 ä¸­æ–°å¢äº†&lt;a href=&#34;https://istio.io/latest/blog/2020/dns-proxy/&#34; title=&#34;æ™ºèƒ½ DNS ä»£ç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ™ºèƒ½ DNS ä»£ç†&lt;/a&gt;
ï¼Œå®ƒæ˜¯ç”± Go ç¼–å†™çš„ Istio sidecar ä»£ç†ï¼Œsidecar ä¸Šçš„ Istio agent å°†é™„å¸¦ä¸€ä¸ªç”± Istiod åŠ¨æ€ç¼–ç¨‹çš„ç¼“å­˜ DNS ä»£ç†ã€‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ DNS æŸ¥è¯¢ä¼šè¢« pod æˆ– VM ä¸­çš„ Istio ä»£ç†é€æ˜åœ°æ‹¦æˆªå’ŒæœåŠ¡ï¼Œè¯¥ä»£ç†ä¼šæ™ºèƒ½åœ°å“åº” DNS æŸ¥è¯¢è¯·æ±‚ï¼Œå¯ä»¥å®ç°è™šæ‹Ÿæœºåˆ°æœåŠ¡ç½‘æ ¼çš„æ— ç¼å¤šé›†ç¾¤è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æ–°å¢äº† &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/workload-group/&#34; title=&#34;WorkloadGroup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WorkloadGroup&lt;/a&gt;
 ï¼Œå®ƒæè¿°äº†å·¥ä½œè´Ÿè½½å®ä¾‹çš„é›†åˆã€‚æä¾›äº†ä¸€ä¸ªè§„èŒƒï¼Œå·¥ä½œè´Ÿè½½å®ä¾‹å¯ä»¥ç”¨æ¥å¼•å¯¼å®ƒä»¬çš„ä»£ç†ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®å’Œèº«ä»½ã€‚å®ƒåªæ‰“ç®—ä¸è™šæ‹Ÿæœºç­‰é Kubernetes å·¥ä½œè´Ÿè½½ä¸€èµ·ä½¿ç”¨ï¼Œæ—¨åœ¨æ¨¡ä»¿ç°æœ‰çš„ç”¨äº Kubernetes å·¥ä½œè´Ÿè½½çš„ sidecar æ³¨å…¥å’Œéƒ¨ç½²è§„èŒƒæ¨¡å‹æ¥å¼•å¯¼ Istio ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://tetrate.io&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;
ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·çš„å¤šé›†ç¾¤éƒ¨ç½²ä¸­å¹¿æ³›ä½¿ç”¨è¿™ç§æœºåˆ¶ï¼Œä»¥ä½¿ sidecar èƒ½å¤Ÿä¸ºæš´éœ²åœ¨ç½‘æ ¼ä¸­æ‰€æœ‰é›†ç¾¤çš„å…¥å£ç½‘å…³çš„ä¸»æœºè§£æ DNSï¼Œå¹¶é€šè¿‡ mTLS è®¿é—®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼ŒIstio å›¢é˜Ÿå±¥è¡Œäº†&lt;a href=&#34;https://istio.io/latest/blog/2020/tradewinds-2020/&#34; title=&#34;å¹´åˆçš„æ‰¿è¯º&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¹´åˆçš„æ‰¿è¯º&lt;/a&gt;
ï¼Œè‡ª 2018 å¹´å‘å¸ƒ 1.1 ç‰ˆæœ¬å‘å¸ƒèµ·ï¼Œä¿æŒäº†å›ºå®šçš„å‘å¸ƒèŠ‚å¥ï¼Œæ¯ 3 ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒä¸ŠæŒç»­ä¼˜åŒ–ï¼Œä»¥æ»¡è¶³ brownfiled åº”ç”¨ä¸ greenfield åº”ç”¨åœ¨ Istio ä¸Šçš„æ— ç¼ä½“éªŒã€‚æˆ‘ä»¬æœŸå¾… Istio åœ¨ 2021 å¹´å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥æ›´å¤šæƒŠå–œã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæ„Ÿè°¢&lt;a href=&#34;https://github.com/malphi&#34; title=&#34;é©¬è‹¥é£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é©¬è‹¥é£&lt;/a&gt;
å¯¹æœ¬æ–‡çš„å®¡é˜…ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Istio Service Mesh ä¸­é›†æˆè™šæ‹Ÿæœºï¼Ÿ</title>
      <link>https://jimmysong.io/blog/how-to-integrate-virtual-machines-into-istio-service-mesh/</link>
      <pubDate>Mon, 02 Nov 2020 16:43:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/how-to-integrate-virtual-machines-into-istio-service-mesh/</guid>
      <description>
        
        
        &lt;p&gt;Istio æ˜¯ç›®å‰æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼ï¼Œç”¨äºè¿æ¥ã€ä¿æŠ¤ã€æ§åˆ¶å’Œè§‚å¯ŸæœåŠ¡ã€‚å½“å…¶ 2017 å¹´å¼€æºæ—¶ï¼ŒKubernetes å·²èµ¢å¾—å®¹å™¨ç¼–æ’ä¹‹æˆ˜ï¼ŒIstio ä¸ºäº†æ»¡è¶³ç»„ç»‡è½¬å‘å¾®æœåŠ¡çš„éœ€æ±‚ã€‚è™½ç„¶ Istio å£°ç§°æ”¯æŒå¼‚æ„ç¯å¢ƒï¼Œå¦‚ Nomadã€Consulã€Eurekaã€Cloud Foundryã€Mesos ç­‰ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒä¸€ç›´ä¸ Kubernetes åˆä½œå¾—æœ€å¥½â€“å®ƒçš„æœåŠ¡å‘ç°å°±æ˜¯åŸºäº Kubernetesã€‚&lt;/p&gt;
&lt;p&gt;Istio åœ¨å‘å±•åˆæœŸå°±å› ä¸ºä¸€äº›é—®é¢˜è€Œé¥±å—è¯Ÿç—…ï¼Œæ¯”å¦‚ç»„ä»¶æ•°é‡å¤šã€å®‰è£…å’Œç»´æŠ¤å¤æ‚ã€è°ƒè¯•å›°éš¾ã€ç”±äºå¼•å…¥äº†å¤ªå¤šçš„æ–°æ¦‚å¿µå’Œå¯¹è±¡ï¼ˆå¤šè¾¾ 50 ä¸ª CRDï¼‰è€Œå¯¼è‡´å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œä»¥åŠ Mixer ç»„ä»¶å¯¹æ€§èƒ½çš„å½±å“ã€‚ä½†è¿™äº›é—®é¢˜æ­£åœ¨è¢« Istio å›¢é˜Ÿé€æ¸å…‹æœã€‚ä» 2020 å¹´åˆå‘å¸ƒçš„&lt;a href=&#34;https://istio.io/latest/zh/blog/2020/tradewinds-2020/&#34; title=&#34;è·¯çº¿å›¾&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯çº¿å›¾&lt;/a&gt;
ä¸­å¯ä»¥çœ‹å‡ºï¼ŒIstio å·²ç»å–å¾—äº†é•¿è¶³çš„è¿›æ­¥ã€‚&lt;/p&gt;
&lt;p&gt;å°†åŸºäºè™šæ‹Ÿæœºçš„å·¥ä½œè´Ÿè½½æ›´å¥½åœ°é›†æˆåˆ°æœåŠ¡ç½‘æ ¼ä¸­ï¼Œæ˜¯ Istio å›¢é˜Ÿä»Šå¹´çš„ä¸€å¤§é‡ç‚¹ã€‚Tetrate è¿˜é€šè¿‡å…¶äº§å“ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; title=&#34;Tetrate Service Bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;
 æä¾›äº†æ— ç¼çš„å¤šäº‘è¿æ¥ã€å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§ï¼ŒåŒ…æ‹¬é’ˆå¯¹è™šæ‹Ÿæœºçš„ã€‚æœ¬æ–‡å°†å¸¦æ‚¨äº†è§£ä¸ºä»€ä¹ˆ Istio éœ€è¦ä¸è™šæ‹Ÿæœºæ•´åˆï¼Œä»¥åŠå¦‚ä½•æ•´åˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸ºä»€ä¹ˆè¦æ”¯æŒè™šæ‹Ÿæœº&#34;&gt;Istio ä¸ºä»€ä¹ˆè¦æ”¯æŒè™šæ‹Ÿæœºï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ç°åœ¨å®¹å™¨å’Œ Kubernetes å·²ç»è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†ä»ç„¶æœ‰å¾ˆå¤šéƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šçš„æœåŠ¡å’Œ Kubernetes é›†ç¾¤ä¹‹å¤–çš„ API éœ€è¦ç”± Istio mesh æ¥ç®¡ç†ã€‚å¦‚ä½•å°†æ£•åœ°ç¯å¢ƒä¸ç»¿åœ°ç¯å¢ƒç»Ÿä¸€ç®¡ç†ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°†è™šæ‹Ÿæœºå¼•å…¥åˆ°ç½‘æ ¼ä¸­éœ€è¦å…·å¤‡ä»€ä¹ˆæ¡ä»¶&#34;&gt;å°†è™šæ‹Ÿæœºå¼•å…¥åˆ°ç½‘æ ¼ä¸­éœ€è¦å…·å¤‡ä»€ä¹ˆæ¡ä»¶ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨ä»‹ç»å¦‚ä½•é›†æˆè™šæ‹Ÿæœºä¹‹å‰ï¼Œæˆ‘å…ˆä»‹ç»ä¸€ä¸‹å°†è™šæ‹Ÿæœºæ·»åŠ åˆ° Mesh ä¸­éœ€è¦ä»€ä¹ˆæ¡ä»¶ã€‚åœ¨æ”¯æŒè™šæ‹Ÿæœºæµé‡æ—¶ï¼ŒIstio å¿…é¡»çŸ¥é“å‡ ä»¶äº‹ï¼šå“ªäº›è™šæ‹Ÿæœºçš„æœåŠ¡è¦æ·»åŠ åˆ° Mesh ä¸­ï¼Œä»¥åŠå¦‚ä½•è®¿é—®è™šæ‹Ÿæœºã€‚æ¯ä¸ªè™šæ‹Ÿæœºè¿˜éœ€è¦ä¸€ä¸ªèº«ä»½ï¼Œä»¥ä¾¿ä¸æœåŠ¡ç½‘æ ¼çš„å…¶ä»–éƒ¨åˆ†å®‰å…¨åœ°é€šä¿¡ã€‚è¿™äº›éœ€æ±‚å¯ä»¥å’Œ Kubernetes CRD ä¸€èµ·å·¥ä½œï¼Œä¹Ÿå¯ä»¥å’Œ Consul è¿™æ ·çš„å®Œæ•´çš„æœåŠ¡æ³¨å†Œè¡¨ä¸€èµ·å·¥ä½œã€‚è€ŒåŸºäºæœåŠ¡è´¦æˆ·çš„èº«ä»½å¼•å¯¼æœºåˆ¶ï¼Œä¸ºæ²¡æœ‰å¹³å°èº«ä»½çš„è™šæ‹Ÿæœºåˆ†é…å·¥ä½œè´Ÿè½½èº«ä»½ã€‚å¯¹äºæœ‰å¹³å°èº«ä»½çš„è™šæ‹Ÿæœºï¼ˆå¦‚ EC2ã€GCPã€Azure ç­‰ï¼‰ï¼ŒIstio æ­£åœ¨è¿›è¡Œè¿™æ–¹é¢çš„å·¥ä½œï¼Œå°†å¹³å°èº«ä»½ä¸ Kubernetes èº«ä»½è¿›è¡Œäº¤æ¢ï¼Œæ–¹ä¾¿è®¾ç½® mTLS é€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å¦‚ä½•æ”¯æŒè™šæ‹Ÿæœº&#34;&gt;Istio å¦‚ä½•æ”¯æŒè™šæ‹Ÿæœºï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Istio å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒå§‹äºå…¶æœåŠ¡æ³¨å†Œè¡¨æœºåˆ¶ã€‚Istio mesh ä¸­çš„æœåŠ¡å’Œå®ä¾‹ä¿¡æ¯æ¥è‡ª Istio çš„æœåŠ¡æ³¨å†Œè¡¨ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒIstio çš„æœåŠ¡æ³¨å†Œè¡¨åªå…³æ³¨æˆ–è·Ÿè¸ª podã€‚åœ¨æ–°çš„ç‰ˆæœ¬ä¸­ï¼ŒIstio ç°åœ¨æœ‰èµ„æºç±»å‹æ¥è·Ÿè¸ªå’Œè§‚å¯Ÿè™šæ‹Ÿæœºã€‚ç½‘æ ¼å†…çš„ sidecar æ— æ³•è§‚å¯Ÿå’Œæ§åˆ¶ç½‘æ ¼å¤–æœåŠ¡çš„æµé‡ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ä»»ä½•ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;Istio ç¤¾åŒºå’Œ &lt;a href=&#34;https://www.tetrate.io/&#34; title=&#34;Tetrate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;
 åœ¨ Istio å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒä¸Šåšäº†&lt;a href=&#34;https://www.tetrate.io/blog/istio-bringing-vms-into-the-mesh-with-cynthia-coan/&#34; title=&#34;å¾ˆå¤šå·¥ä½œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾ˆå¤šå·¥ä½œ&lt;/a&gt;
ã€‚1.6 ç‰ˆæœ¬ä¸­å¢åŠ äº† WorkloadEntryï¼Œå®ƒå…è®¸ä½ åƒæè¿° Kubernetes ä¸­è¿è¡Œçš„ä¸»æœºä¸€æ ·æè¿°è™šæ‹Ÿæœºã€‚åœ¨ 1.7 ç‰ˆæœ¬ä¸­ï¼Œè¯¥ç‰ˆæœ¬å¼€å§‹å¢åŠ äº†é€šè¿‡ä»¤ç‰Œå°†è™šæ‹Ÿæœºè‡ªåŠ¨å¼•å¯¼åˆ° service mesh ä¸­çš„åŸºç¡€ï¼ŒIstio åšäº†å¤§é‡çš„å·¥ä½œã€‚Istio 1.8 å°†é¦–æ¬¡æ¨å‡ºå¦ä¸€ä¸ªåä¸º WorkloadGroup çš„æŠ½è±¡ï¼Œå®ƒç±»ä¼¼äº Kubernetes Deployment å¯¹è±¡ â€”â€” ä½†é€‚ç”¨äºè™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¾ç¤ºäº† Istio å¦‚ä½•åœ¨ç½‘æ ¼ä¸­å¯¹æœåŠ¡è¿›è¡Œå»ºæ¨¡ã€‚æœ€ä¸»è¦çš„ä¿¡æ¯æ¥æºæ¥è‡ªäº Kubernetes è¿™æ ·çš„å¹³å°æœåŠ¡æ³¨å†Œè¡¨ï¼Œæˆ–è€… Consul è¿™æ ·çš„ç³»ç»Ÿã€‚æ­¤å¤–ï¼ŒServiceEntry ä½œä¸ºç”¨æˆ·å®šä¹‰çš„æœåŠ¡æ³¨å†Œè¡¨ï¼Œå¯¹è™šæ‹Ÿæœºä¸Šçš„æœåŠ¡æˆ–ç»„ç»‡å¤–éƒ¨çš„æœåŠ¡è¿›è¡Œå»ºæ¨¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-integrate-virtual-machines-into-istio-service-mesh/0081Kckwly1gkc4ldbqzhj30p30ehwf5.jpg&#34; data-img=&#34;/blog/how-to-integrate-virtual-machines-into-istio-service-mesh/0081Kckwly1gkc4ldbqzhj30p30ehwf5.jpg&#34; data-width=&#34;903&#34; data-height=&#34;521&#34; alt=&#34;image&#34; data-caption=&#34;Istio ä¸­çš„æœåŠ¡æ³¨å†Œå‘ç°æ¨¡å‹&#34;&gt;
    
  
  &lt;figcaption&gt;Istio ä¸­çš„æœåŠ¡æ³¨å†Œå‘ç°æ¨¡å‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ ServiceEntry å¼•å…¥è™šæ‹Ÿæœºä¸­çš„æœåŠ¡ï¼Œå´è¿˜è¦å¤§è´¹å‘¨æŠ˜åœ¨è™šæ‹Ÿæœºä¸­å®‰è£… Istioï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ ServiceEntryï¼Œä½ å¯ä»¥è®©ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè®¿é—®å¤–éƒ¨æœåŠ¡ï¼›æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç®¡ç†è¿™äº›å¤–éƒ¨æœåŠ¡çš„æµé‡ã€‚ç»“åˆ VirtualServiceï¼Œä½ è¿˜å¯ä»¥ä¸ºç›¸åº”çš„å¤–éƒ¨æœåŠ¡é…ç½®è®¿é—®è§„åˆ™ï¼Œæ¯”å¦‚è¯·æ±‚è¶…æ—¶ã€æ•…éšœæ³¨å…¥ç­‰ï¼Œä»è€Œå®ç°å¯¹æŒ‡å®šå¤–éƒ¨æœåŠ¡çš„æ§åˆ¶è®¿é—®ã€‚å³ä¾¿å¦‚æ­¤ï¼Œå®ƒä¹Ÿåªèƒ½æ§åˆ¶å®¢æˆ·ç«¯çš„æµé‡ï¼Œè€Œä¸èƒ½æ§åˆ¶å¼•å…¥çš„å¤–éƒ¨æœåŠ¡å¯¹å…¶ä»–æœåŠ¡çš„è®¿é—®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸èƒ½æ§åˆ¶ä½œä¸ºè°ƒç”¨å‘èµ·è€…çš„æœåŠ¡çš„è¡Œä¸ºã€‚åœ¨è™šæ‹Ÿæœºä¸­éƒ¨ç½² sidecarï¼Œé€šè¿‡å·¥ä½œè´Ÿè½½é€‰æ‹©å™¨å¼•å…¥è™šæ‹Ÿæœºå·¥ä½œè´Ÿè½½ï¼Œå¯ä»¥åƒ Kubernetes ä¸­çš„ pod ä¸€æ ·ï¼Œå¯¹è™šæ‹Ÿæœºè¿›è¡Œæ— å·®åˆ«ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;demo&#34;&gt;Demo&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸‹é¢è¿™ä¸ª demo ä¸­æˆ‘ä»¬å°†ä½¿åœ¨ GKE ä¸­éƒ¨ç½² Istio å¹¶è¿è¡Œ bookinfo ç¤ºä¾‹ï¼Œå…¶ä¸­ ratings æœåŠ¡çš„åç«¯ä½¿ç”¨çš„æ˜¯éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šçš„ MySQLï¼Œè¯¥ç¤ºä¾‹å¯ä»¥åœ¨ &lt;a href=&#34;https://istio.io/latest/docs/examples/virtual-machines/bookinfo/&#34; title=&#34;Istio å®˜æ–¹æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;
ä¸­æ‰¾åˆ°ï¼Œæˆ‘ä½œå‡ºäº†éƒ¨åˆ†æ”¹åŠ¨ï¼Œæœ€ç»ˆçš„æµé‡è·¯ç”±å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/how-to-integrate-virtual-machines-into-istio-service-mesh/0081Kckwly1gkc4lch5epj318g0avwfx.jpg&#34; data-img=&#34;/blog/how-to-integrate-virtual-machines-into-istio-service-mesh/0081Kckwly1gkc4lch5epj318g0avwfx.jpg&#34; data-width=&#34;1600&#34; data-height=&#34;391&#34; alt=&#34;image&#34; data-caption=&#34;Bookinfo ç¤ºä¾‹ä¸­çš„æµé‡ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Bookinfo ç¤ºä¾‹ä¸­çš„æµé‡ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å®‰è£…æµç¨‹&#34;&gt;å®‰è£…æµç¨‹&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç¤ºä¾‹çš„å®‰è£…æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ Google Cloud ä¸­éƒ¨ç½² Kubernetes é›†ç¾¤ï¼ŒKubernetes ç‰ˆæœ¬æ˜¯ 1.16.13ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ GKE ä¸­å®‰è£… Istio 1.7.1ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ Google Cloud ä¸­å¯åŠ¨ä¸€å°è™šæ‹Ÿæœºå¹¶é…ç½® Istioï¼Œå°†å…¶åŠ å…¥åˆ° Istio Mesh ä¸­ï¼Œè¿™ä¸€æ­¥éœ€è¦å¾ˆå¤šæ‰‹åŠ¨æ“ä½œï¼Œç”Ÿæˆè¯ä¹¦ã€åˆ›å»º tokenã€é…ç½® hosts ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ Istio Mesh ä¸­éƒ¨ç½² bookinfo ç¤ºä¾‹ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨è™šæ‹Ÿæœºä¸­å®‰è£… MySQLï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºè™šæ‹Ÿæœºè®¾ç½® VPC é˜²ç«ç®±è§„åˆ™ï¼›&lt;/li&gt;
&lt;li&gt;å°†è™šæ‹Ÿæœºä¸­çš„ MySQL æœåŠ¡ä½œä¸º ServiceEntry å¼•å…¥åˆ° Mesh ä¸­å¹¶ä½œä¸º rating æœåŠ¡çš„åç«¯ï¼›&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ MySQL è¡¨ä¸­çš„æ•°æ®ï¼ŒéªŒè¯ bookinfo ä¸­çš„ rating ç›¸åº”çš„è¡Œä¸ºç¬¦åˆé¢„æœŸï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æœªæ¥æ–¹å‘&#34;&gt;æœªæ¥æ–¹å‘&lt;/h2&gt;
&lt;p&gt;ä» &lt;a href=&#34;https://istio.io/latest/docs/examples/virtual-machines/bookinfo/&#34; title=&#34;bookinfo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo&lt;/a&gt;
 çš„æ¼”ç¤ºä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„äººå·¥å·¥ä½œå¤ªå¤šï¼Œå¾ˆå®¹æ˜“å‡ºé”™ã€‚åœ¨æœªæ¥ï¼ŒIstio ä¼šæ”¹è¿›è™šæ‹Ÿæœºæµ‹è¯•çš„å¯æ“ä½œæ€§ï¼Œæ ¹æ®å¹³å°èº«ä»½è‡ªåŠ¨å¼•å¯¼ï¼Œæ”¹è¿› DNS æ”¯æŒå’Œ istioctl è°ƒè¯•ç­‰ã€‚å¤§å®¶å¯ä»¥å…³æ³¨ &lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md&#34; title=&#34;Istio ç¯å¢ƒå·¥ä½œç»„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç¯å¢ƒå·¥ä½œç»„&lt;/a&gt;
ï¼Œäº†è§£æ›´å¤šå…³äºè™šæ‹Ÿæœºæ”¯æŒçš„ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒé˜…è¯»&#34;&gt;å‚è€ƒé˜…è¯»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/setup/install/virtual-machine/&#34; title=&#34;Virtual Machine Installation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Machine Installation&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/examples/virtual-machines/single-network/&#34; title=&#34;Virtual Machines in Single-Network Meshes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Machines in Single-Network Meshes&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tetrate.io/blog/istio-bringing-vms-into-the-mesh-with-cynthia-coan/&#34; title=&#34;Istio: Bringing VMs into the Mesh (with Cynthia Coan)&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio: Bringing VMs into the Mesh (with Cynthia Coan)&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tetrate.io/blog/bridging-traditional-and-modern-workloads/&#34; title=&#34;Bridging Traditional and Modern Workloads&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bridging Traditional and Modern Workloads&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Service Meshâ€”â€”å Kubernetes æ—¶ä»£çš„å¾®æœåŠ¡</title>
      <link>https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/</link>
      <pubDate>Wed, 01 Apr 2020 11:56:04 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/</guid>
      <description>
        
        
        &lt;p&gt;å¦‚æœä½ åˆšå¬è¯´ Service Mesh ä¸ä¹…ï¼Œå¹¶è¯•ç”¨è¿‡ &lt;a href=&#34;https://istio.io&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
 çš„è¯ï¼Œé‚£ä¹ˆä½ å¯èƒ½éƒ½ä¼šæœ‰ä¸‹é¢å‡ ä¸ªç–‘é—®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ Istio è¦è¿è¡Œåœ¨ Kubernetes ä¸Šå‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Kubernetes å’Œ Service Mesh åˆ†åˆ«åœ¨äº‘åŸç”Ÿä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Istio æ‰©å±•äº† Kubernetes çš„å“ªäº›æ–¹é¢ï¼Ÿè§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Kubernetesã€xDS åè®®ï¼ˆ&lt;a href=&#34;https://github.com/envoyproxy/envoy&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
ã€&lt;a href=&#34;https://github.com/mosn/mosn&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
 ç­‰ï¼‰ä¸ Istio ä¹‹é—´åˆæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åˆ°åº•è¯¥ä¸è¯¥ä¸Š Service Meshï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¯•å›¾å¸¦æ‚¨æ¢³ç†æ¸…æ¥š Kubernetesã€xDS åè®®ä»¥åŠ Istio Service Mesh ä¹‹é—´çš„å†…åœ¨è”ç³»ã€‚æ­¤å¤–ï¼Œæœ¬èŠ‚è¿˜å°†ä»‹ç» Kubernetes ä¸­çš„è´Ÿè½½å‡è¡¡æ–¹å¼ï¼ŒxDS åè®®å¯¹äº Service Mesh çš„æ„ä¹‰ä»¥åŠä¸ºä»€ä¹ˆè¯´åŠæ—¶æœ‰äº† Kubernetes è¿˜éœ€è¦ Istioã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Service Mesh å¹¶ä¸æ˜¯è¯´ä¸ Kubernetes å†³è£‚ï¼Œè€Œæ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…ã€‚Kubernetes çš„æœ¬è´¨æ˜¯é€šè¿‡å£°æ˜å¼é…ç½®å¯¹åº”ç”¨è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè€Œ Service Mesh çš„æœ¬è´¨æ˜¯æä¾›åº”ç”¨é—´çš„æµé‡å’Œå®‰å…¨æ€§ç®¡ç†ä»¥åŠå¯è§‚å¯Ÿæ€§ã€‚å‡å¦‚ä½ å·²ç»ä½¿ç”¨ Kubernetes æ„å»ºäº†ç¨³å®šçš„åº”ç”¨å¹³å°ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾ç½®æœåŠ¡é—´è°ƒç”¨çš„è´Ÿè½½å‡è¡¡å’Œæµé‡æ§åˆ¶ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Envoy åˆ›é€ çš„ xDS åè®®è¢«ä¼—å¤šå¼€æºè½¯ä»¶æ‰€æ”¯æŒï¼Œå¦‚ &lt;a href=&#34;https://github.com/istio/istio&#34; title=&#34;Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;
ã€&lt;a href=&#34;https:/github.com/mosn/mosn&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
 ç­‰ã€‚Envoy å¯¹äº Service Mesh æˆ–äº‘åŸç”Ÿæ¥è¯´æœ€å¤§çš„è´¡çŒ®å°±æ˜¯å®šä¹‰äº† xDSï¼ŒEnvoy æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª proxyï¼Œæ˜¯å¯é€šè¿‡ API é…ç½®çš„ç°ä»£ç‰ˆ proxyï¼ŒåŸºäºå®ƒè¡ç”Ÿå‡ºæ¥å¾ˆå¤šä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚ API Gatewayã€Service Mesh ä¸­çš„ Sidecar proxy å’Œè¾¹ç¼˜ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬èŠ‚åŒ…å«ä»¥ä¸‹å†…å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯´æ˜ kube-proxy çš„ä½œç”¨ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes åœ¨å¾®æœåŠ¡ç®¡ç†ä¸Šçš„å±€é™æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä»‹ç» Istio Service Mesh çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä»‹ç» xDS åŒ…å«å“ªäº›å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;æ¯”è¾ƒ Kubernetesã€Envoy å’Œ Istio Service Mesh ä¸­çš„ä¸€äº›æ¦‚å¿µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é‡è¦è§‚ç‚¹&#34;&gt;é‡è¦è§‚ç‚¹&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æƒ³è¦æå‰äº†è§£ä¸‹æ–‡çš„æ‰€æœ‰å†…å®¹ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆé˜…è¯»ä¸‹é¢åˆ—å‡ºçš„æœ¬æ–‡ä¸­çš„ä¸€äº›ä¸»è¦è§‚ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes çš„æœ¬è´¨æ˜¯åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯éƒ¨ç½²å’Œç®¡ç†ï¼ˆæ‰©ç¼©å®¹ã€è‡ªåŠ¨æ¢å¤ã€å‘å¸ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ä¸ºå¾®æœåŠ¡æä¾›äº†å¯æ‰©å±•ã€é«˜å¼¹æ€§çš„éƒ¨ç½²å’Œç®¡ç†å¹³å°ã€‚&lt;/li&gt;
&lt;li&gt;Service Mesh çš„åŸºç¡€æ˜¯é€æ˜ä»£ç†ï¼Œé€šè¿‡ sidecar proxy æ‹¦æˆªåˆ°å¾®æœåŠ¡é—´æµé‡åå†é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ç®¡ç†å¾®æœåŠ¡çš„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;Service Mesh å°†æµé‡ç®¡ç†ä» Kubernetes ä¸­è§£è€¦ï¼ŒService Mesh å†…éƒ¨çš„æµé‡æ— éœ€ &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶çš„æ”¯æŒï¼Œé€šè¿‡ä¸ºæ›´æ¥è¿‘å¾®æœåŠ¡åº”ç”¨å±‚çš„æŠ½è±¡ï¼Œç®¡ç†æœåŠ¡é—´çš„æµé‡ã€å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§ã€‚&lt;/li&gt;
&lt;li&gt;xDS å®šä¹‰äº† Service Mesh é…ç½®çš„åè®®æ ‡å‡†ã€‚&lt;/li&gt;
&lt;li&gt;Service Mesh æ˜¯å¯¹ Kubernetes ä¸­çš„ service æ›´ä¸Šå±‚çš„æŠ½è±¡ï¼Œå®ƒçš„ä¸‹ä¸€æ­¥æ˜¯ serverlessã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubernetes-vs-service-mesh&#34;&gt;Kubernetes vs Service Mesh&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Kubernetes ä¸ Service Mesh ä¸­çš„çš„æœåŠ¡è®¿é—®å…³ç³»ï¼ˆæ¯ä¸ª pod ä¸€ä¸ª sidecar çš„æ¨¡å¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/kubernetes-vs-service-mesh.png&#34; data-img=&#34;/blog/service-mesh-the-microservices-in-post-kubernetes-era/kubernetes-vs-service-mesh.png&#34; data-width=&#34;1928&#34; data-height=&#34;986&#34; alt=&#34;image&#34; data-caption=&#34;kubernetes å¯¹æ¯” service mesh&#34;&gt;
    
  
  &lt;figcaption&gt;kubernetes å¯¹æ¯” service mesh&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æµé‡è½¬å‘&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Kubernetes é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éƒ¨ç½²äº†ä¸€ä¸ª &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¼šä¸ Kubernetes API Server é€šä¿¡ï¼Œè·å–é›†ç¾¤ä¸­çš„ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; title=&#34;service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;service&lt;/a&gt;
 ä¿¡æ¯ï¼Œç„¶åè®¾ç½® iptables è§„åˆ™ï¼Œç›´æ¥å°†å¯¹æŸä¸ª service çš„è¯·æ±‚å‘é€åˆ°å¯¹åº”çš„ Endpointï¼ˆå±äºåŒä¸€ç»„ service çš„ podï¼‰ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-service-registry.png&#34; data-img=&#34;/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-service-registry.png&#34; data-width=&#34;746&#34; data-height=&#34;552&#34; alt=&#34;image&#34; data-caption=&#34;Service Mesh ä¸­çš„æœåŠ¡æ³¨å†Œ&#34;&gt;
    
  
  &lt;figcaption&gt;Service Mesh ä¸­çš„æœåŠ¡æ³¨å†Œ&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio å¯ä»¥æ²¿ç”¨ Kubernetes ä¸­çš„ service åšæœåŠ¡æ³¨å†Œï¼Œè¿˜å¯ä»¥é€šè¿‡æ§åˆ¶å¹³é¢çš„å¹³å°é€‚é…å™¨å¯¹æ¥å…¶ä»–æœåŠ¡å‘ç°ç³»ç»Ÿï¼Œç„¶åç”Ÿæˆæ•°æ®å¹³é¢çš„é…ç½®ï¼ˆä½¿ç”¨ CRD å£°æ˜ï¼Œä¿å­˜åœ¨ etcd ä¸­ï¼‰ï¼Œæ•°æ®å¹³é¢çš„&lt;strong&gt;é€æ˜ä»£ç†&lt;/strong&gt;ï¼ˆtransparent proxyï¼‰ä»¥ sidecar å®¹å™¨çš„å½¢å¼éƒ¨ç½²åœ¨æ¯ä¸ªåº”ç”¨æœåŠ¡çš„ pod ä¸­ï¼Œè¿™äº› proxy éƒ½éœ€è¦è¯·æ±‚æ§åˆ¶å¹³é¢æ¥åŒæ­¥ä»£ç†é…ç½®ã€‚ä¹‹æ‰€ä»¥è¯´æ˜¯é€æ˜ä»£ç†ï¼Œæ˜¯å› ä¸ºåº”ç”¨ç¨‹åºå®¹å™¨å®Œå…¨æ— æ„ŸçŸ¥ä»£ç†çš„å­˜åœ¨ï¼Œè¯¥è¿‡ç¨‹ kube-proxy ç»„ä»¶ä¸€æ ·éœ€è¦æ‹¦æˆªæµé‡ï¼Œåªä¸è¿‡ &lt;code&gt;kube-proxy&lt;/code&gt; æ‹¦æˆªçš„æ˜¯è¿›å‡º Kubernetes èŠ‚ç‚¹çš„æµé‡ï¼Œè€Œ sidecar proxy æ‹¦æˆªçš„æ˜¯è¿›å‡ºè¯¥ Pod çš„æµé‡ï¼Œè¯¦è§&lt;a href=&#34;https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/&#34; title=&#34;ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Service Mesh çš„åŠ£åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸º Kubernetes æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šè¿è¡Œä¼—å¤šçš„ Podï¼Œå°†åŸå…ˆ &lt;code&gt;kube-proxy&lt;/code&gt; æ–¹å¼çš„è·¯ç”±è½¬å‘åŠŸèƒ½ç½®äºæ¯ä¸ª pod ä¸­ï¼Œå› ä¸ºæœ‰ sidecar æ‹¦æˆªæµé‡ä¼šå¤šä¸€æ¬¡è·³è½¬æ—¶ï¼Œå¢åŠ å“åº”å»¶è¿Ÿï¼ŒåŒæ—¶å¤§é‡çš„é…ç½®åˆ†å‘ã€é…ç½®åŒæ­¥ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨æ€§èƒ½ã€‚ä¸ºäº†ç»†ç²’åº¦åœ°è¿›è¡Œæµé‡ç®¡ç†ï¼Œå¿…å°†æ·»åŠ ä¸€ç³»åˆ—æ–°çš„æŠ½è±¡ï¼Œä»è€Œä¼šè¿›ä¸€æ­¥å¢åŠ ç”¨æˆ·çš„å­¦ä¹ æˆæœ¬ï¼Œä½†éšç€æŠ€æœ¯çš„æ™®åŠï¼Œè¿™æ ·çš„æƒ…å†µä¼šæ…¢æ…¢åœ°å¾—åˆ°ç¼“è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Service Mesh çš„ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kube-proxy&lt;/code&gt; çš„è®¾ç½®éƒ½æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œæ— æ³•å¯¹æ¯ä¸ªæœåŠ¡åšç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè€Œ Service Mesh é€šè¿‡ sidecar proxy çš„æ–¹å¼å°† Kubernetes ä¸­å¯¹æµé‡çš„æ§åˆ¶ä» service ä¸€å±‚æŠ½ç¦»å‡ºæ¥ï¼Œå¯ä»¥åšæ›´å¤šçš„æ‰©å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kube-proxy-ç»„ä»¶&#34;&gt;kube-proxy ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª Node è¿è¡Œä¸€ä¸ª &lt;code&gt;kube-proxy&lt;/code&gt; è¿›ç¨‹ã€‚&lt;code&gt;kube-proxy&lt;/code&gt; è´Ÿè´£ä¸º &lt;code&gt;Service&lt;/code&gt; å®ç°äº†ä¸€ç§ VIPï¼ˆè™šæ‹Ÿ IPï¼‰çš„å½¢å¼ã€‚åœ¨ Kubernetes v1.0 ç‰ˆæœ¬ï¼Œä»£ç†å®Œå…¨åœ¨ userspace å®ç°ã€‚Kubernetes v1.1 ç‰ˆæœ¬æ–°å¢äº† &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html#iptables-%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f&#34; title=&#34;iptables ä»£ç†æ¨¡å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables ä»£ç†æ¨¡å¼&lt;/a&gt;
ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ã€‚ä» Kubernetes v1.2 èµ·ï¼Œé»˜è®¤ä½¿ç”¨ iptables ä»£ç†ã€‚åœ¨ Kubernetes v1.8.0-beta.0 ä¸­ï¼Œæ·»åŠ äº† &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html#ipvs-%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f&#34; title=&#34;ipvs ä»£ç†æ¨¡å¼&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ipvs ä»£ç†æ¨¡å¼&lt;/a&gt;
ã€‚å…³äº kube-proxy ç»„ä»¶çš„æ›´å¤šä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/&#34; title=&#34;kubernetes ç®€ä»‹ï¼šservice å’Œ kube-proxy åŸç†&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes ç®€ä»‹ï¼šservice å’Œ kube-proxy åŸç†&lt;/a&gt;
 å’Œ &lt;a href=&#34;https://jishu.io/kubernetes/ipvs-loadbalancer-for-kubernetes/&#34; title=&#34;ä½¿ç”¨ IPVS å®ç° Kubernetes å…¥å£æµé‡è´Ÿè½½å‡è¡¡&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ IPVS å®ç° Kubernetes å…¥å£æµé‡è´Ÿè½½å‡è¡¡&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kube-proxy-çš„ç¼ºé™·&#34;&gt;kube-proxy çš„ç¼ºé™·&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/&#34; title=&#34;kube-proxy çš„ä¸è¶³ä¹‹å¤„&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-proxy çš„ä¸è¶³ä¹‹å¤„&lt;/a&gt;
ï¼š&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¦‚æœè½¬å‘çš„ pod ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨å°è¯•å¦ä¸€ä¸ª podï¼Œæ¯ä¸ª pod éƒ½æœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥çš„æœºåˆ¶ï¼Œå½“æœ‰ pod å¥åº·çŠ¶å†µæœ‰é—®é¢˜æ—¶ï¼Œkubelet ä¼šé‡å¯å¯¹åº”çš„ podï¼Œkube-proxy ä¼šåˆ é™¤å¯¹åº”çš„è½¬å‘è§„åˆ™ã€‚å¦å¤–ï¼Œ&lt;code&gt;nodePort&lt;/code&gt; ç±»å‹çš„æœåŠ¡ä¹Ÿæ— æ³•æ·»åŠ  TLS æˆ–è€…æ›´å¤æ‚çš„æŠ¥æ–‡è·¯ç”±æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;Kube-proxy å®ç°äº†æµé‡åœ¨ Kubernetes service å¤šä¸ª pod å®ä¾‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯å¦‚ä½•å¯¹è¿™äº› service é—´çš„æµé‡åšç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ¯”å¦‚æŒ‰ç…§ç™¾åˆ†æ¯”åˆ’åˆ†æµé‡åˆ°ä¸åŒçš„åº”ç”¨ç‰ˆæœ¬ï¼ˆè¿™äº›åº”ç”¨éƒ½å±äºåŒä¸€ä¸ª serviceï¼Œä½†ä½äºä¸åŒçš„ deployment ä¸Šï¼‰ï¼Œåšé‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰å’Œè“ç»¿å‘å¸ƒï¼ŸKubernetes ç¤¾åŒºç»™å‡ºäº† &lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments&#34; title=&#34;ä½¿ç”¨ Deployment åšé‡‘ä¸é›€å‘å¸ƒçš„æ–¹æ³•&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Deployment åšé‡‘ä¸é›€å‘å¸ƒçš„æ–¹æ³•&lt;/a&gt;
ï¼Œè¯¥æ–¹æ³•æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ä¿®æ”¹ pod çš„ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/label.html&#34; title=&#34;label&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label&lt;/a&gt;
 æ¥å°†ä¸åŒçš„ pod åˆ’å½’åˆ° Deployment çš„ Service ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ingress-vs-istio-gateway&#34;&gt;Kubernetes Ingress vs Istio Gateway&lt;/h2&gt;
&lt;p&gt;ä¸Šæ–‡è¯´åˆ° &lt;code&gt;kube-proxy&lt;/code&gt; åªèƒ½è·¯ç”± Kubernetes é›†ç¾¤å†…éƒ¨çš„æµé‡ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ Kubernetes é›†ç¾¤çš„ Pod ä½äº &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/cni.html&#34; title=&#34;CNI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNI&lt;/a&gt;
 åˆ›å»ºçš„ç½‘ç»œä¸­ï¼Œé›†ç¾¤å¤–éƒ¨æ˜¯æ— æ³•ç›´æ¥ä¸å…¶é€šä¿¡çš„ï¼Œå› æ­¤ Kubernetes ä¸­åˆ›å»ºäº† &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/ingress.html&#34; title=&#34;ingress&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress&lt;/a&gt;
 è¿™ä¸ªèµ„æºå¯¹è±¡ï¼Œå®ƒç”±ä½äº Kubernetes &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/practice/edge-node-configuration.html&#34; title=&#34;è¾¹ç¼˜èŠ‚ç‚¹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹&lt;/a&gt;
ï¼ˆè¿™æ ·çš„èŠ‚ç‚¹å¯ä»¥æ˜¯å¾ˆå¤šä¸ªä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„ï¼‰çš„ Ingress controller é©±åŠ¨ï¼Œè´Ÿè´£ç®¡ç†&lt;strong&gt;å—åŒ—å‘æµé‡&lt;/strong&gt;ï¼ŒIngress å¿…é¡»å¯¹æ¥å„ç§ Ingress Controller æ‰èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34; title=&#34;nginx ingress controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx ingress controller&lt;/a&gt;
ã€&lt;a href=&#34;https://traefik.io/&#34; title=&#34;traefik&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;traefik&lt;/a&gt;
ã€‚Ingress åªé€‚ç”¨äº HTTP æµé‡ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåªèƒ½å¯¹ serviceã€portã€HTTP è·¯å¾„ç­‰æœ‰é™å­—æ®µåŒ¹é…æ¥è·¯ç”±æµé‡ï¼Œè¿™å¯¼è‡´å®ƒæ— æ³•è·¯ç”±å¦‚ MySQLã€Redis å’Œå„ç§ç§æœ‰ RPC ç­‰ TCP æµé‡ã€‚è¦æƒ³ç›´æ¥è·¯ç”±å—åŒ—å‘çš„æµé‡ï¼Œåªèƒ½ä½¿ç”¨ Service çš„ LoadBalancer æˆ– NodePortï¼Œå‰è€…éœ€è¦äº‘å‚å•†æ”¯æŒï¼Œåè€…éœ€è¦è¿›è¡Œé¢å¤–çš„ç«¯å£ç®¡ç†ã€‚æœ‰äº› Ingress controller æ”¯æŒæš´éœ² TCP å’Œ UDP æœåŠ¡ï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨ Service æ¥æš´éœ²ï¼ŒIngress æœ¬èº«æ˜¯ä¸æ”¯æŒçš„ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/&#34; title=&#34;nginx ingress controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx ingress controller&lt;/a&gt;
ï¼ŒæœåŠ¡æš´éœ²çš„ç«¯å£æ˜¯é€šè¿‡åˆ›å»º ConfigMap çš„æ–¹å¼æ¥é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;Istio Gateway çš„åŠŸèƒ½ä¸ Kubernetes Ingress ç±»ä¼¼ï¼Œéƒ½æ˜¯è´Ÿè´£é›†ç¾¤çš„å—åŒ—å‘æµé‡ã€‚Istio &lt;code&gt;Gateway&lt;/code&gt; æè¿°çš„è´Ÿè½½å‡è¡¡å™¨ç”¨äºæ‰¿è½½è¿›å‡ºç½‘æ ¼è¾¹ç¼˜çš„è¿æ¥ã€‚è¯¥è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£å’Œè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚Gateway æ˜¯ä¸€ç§ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/crd.html&#34; title=&#34;CRD æ‰©å±•&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CRD æ‰©å±•&lt;/a&gt;
ï¼Œå®ƒåŒæ—¶å¤ç”¨äº† sidecar proxy çš„èƒ½åŠ›ï¼Œè¯¦ç»†é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/docs/reference/config/networking/gateway/&#34; title=&#34;Istio å®˜ç½‘&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;xds-åè®®&#34;&gt;xDS åè®®&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢è¿™å¼ å›¾å¤§å®¶åœ¨äº†è§£ Service Mesh çš„æ—¶å€™å¯èƒ½éƒ½çœ‹åˆ°è¿‡ï¼Œæ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªæœåŠ¡çš„å®ä¾‹ï¼Œä¾‹å¦‚ Kubernetes ä¸­çš„ä¸€ä¸ª Podï¼ˆå…¶ä¸­åŒ…å«äº† sidecar proxyï¼‰ï¼ŒxDS åè®®æ§åˆ¶äº† Istio Service Mesh ä¸­æ‰€æœ‰æµé‡çš„å…·ä½“è¡Œä¸ºï¼Œå³å°†ä¸‹å›¾ä¸­çš„æ–¹å—é“¾æ¥åˆ°äº†ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/service-mesh-schematic-diagram.png&#34; data-img=&#34;/blog/service-mesh-the-microservices-in-post-kubernetes-era/service-mesh-schematic-diagram.png&#34; data-width=&#34;736&#34; data-height=&#34;626&#34; alt=&#34;image&#34; data-caption=&#34;Service Mesh ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Service Mesh ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;xDS åè®®æ˜¯ç”± &lt;a href=&#34;https://envoyproxy.io/&#34; title=&#34;Envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;
 æå‡ºçš„ï¼Œåœ¨ Envoy v2 ç‰ˆæœ¬ API ä¸­æœ€åŸå§‹çš„ xDS åè®®æŒ‡çš„æ˜¯ CDSï¼ˆCluster Discovery Serviceï¼‰ã€EDSï¼ˆEndpoint Discovery serviceï¼‰ã€LDSï¼ˆListener Discovery Serviceï¼‰å’Œ RDSï¼ˆRoute Discovery Serviceï¼‰ï¼Œåæ¥åœ¨ v3 ç‰ˆæœ¬ä¸­åˆå‘å±•å‡ºäº† Scoped Route Discovery Serviceï¼ˆSRDSï¼‰ã€Virtual Host Discovery Serviceï¼ˆVHDSï¼‰ã€Secret Discovery Serviceï¼ˆSDSï¼‰ã€Runtime Discovery Serviceï¼ˆRTDSï¼‰ç­‰ï¼Œè¯¦è§ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; title=&#34;xDS REST and gRPC protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS REST and gRPC protocol&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ä»¥å„æœ‰ä¸¤ä¸ªå®ä¾‹çš„ serviceï¼Œæ¥çœ‹ä¸‹ xDS åè®®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/xds-protocol.png&#34; data-img=&#34;/blog/service-mesh-the-microservices-in-post-kubernetes-era/xds-protocol.png&#34; data-width=&#34;1016&#34; data-height=&#34;688&#34; alt=&#34;image&#34; data-caption=&#34;xDS åè®®&#34;&gt;
    
  
  &lt;figcaption&gt;xDS åè®®&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­çš„ç®­å¤´ä¸æ˜¯æµé‡è¿›å…¥ Proxy åçš„è·¯å¾„æˆ–è·¯ç”±ï¼Œä¹Ÿä¸æ˜¯å®é™…é¡ºåºï¼Œè€Œæ˜¯æƒ³è±¡çš„ä¸€ç§ xDS æ¥å£å¤„ç†é¡ºåºï¼Œå…¶å® xDS ä¹‹é—´ä¹Ÿæ˜¯æœ‰äº¤å‰å¼•ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ”¯æŒ xDS åè®®çš„ä»£ç†é€šè¿‡æŸ¥è¯¢æ–‡ä»¶æˆ–ç®¡ç†æœåŠ¡å™¨æ¥åŠ¨æ€å‘ç°èµ„æºã€‚æ¦‚æ‹¬åœ°è®²ï¼Œå¯¹åº”çš„å‘ç°æœåŠ¡åŠå…¶ç›¸åº”çš„ API è¢«ç§°ä½œ &lt;em&gt;xDS&lt;/em&gt;ã€‚Envoy é€šè¿‡ &lt;strong&gt;è®¢é˜…ï¼ˆsubscriptionï¼‰&lt;/strong&gt; çš„æ–¹å¼æ¥è·å–èµ„æºï¼Œè®¢é˜…æ–¹å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶è®¢é˜…&lt;/strong&gt;ï¼šç›‘æ§æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå‘ç°åŠ¨æ€èµ„æºçš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å°†å…¶ä¿å­˜äºæ–‡ä»¶ï¼Œå¹¶å°†è·¯å¾„é…ç½®åœ¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-configsource&#34; title=&#34;ConfigSource&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ConfigSource&lt;/a&gt;
 ä¸­çš„ &lt;code&gt;path&lt;/code&gt; å‚æ•°ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;gRPC æµå¼è®¢é˜…&lt;/strong&gt;ï¼šæ¯ä¸ª xDS API å¯ä»¥å•ç‹¬é…ç½® &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-apiconfigsource&#34; title=&#34;&amp;lt;code&amp;gt;ApiConfigSource&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ApiConfigSource&lt;/code&gt;&lt;/a&gt;
ï¼ŒæŒ‡å‘å¯¹åº”çš„ä¸Šæ¸¸ç®¡ç†æœåŠ¡å™¨çš„é›†ç¾¤åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½®è¯¢ REST-JSON è½®è¯¢è®¢é˜…&lt;/strong&gt;ï¼šå•ä¸ª xDS API å¯å¯¹ REST ç«¯ç‚¹è¿›è¡Œçš„åŒæ­¥ï¼ˆé•¿ï¼‰è½®è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šçš„ xDS è®¢é˜…æ–¹å¼è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html&#34; title=&#34;xDS åè®®è§£æ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®è§£æ&lt;/a&gt;
ã€‚Istio ä½¿ç”¨ gRPC æµå¼è®¢é˜…çš„æ–¹å¼é…ç½®æ‰€æœ‰çš„æ•°æ®å¹³é¢çš„ sidecar proxyã€‚&lt;/p&gt;
&lt;h3 id=&#34;xds-åè®®è¦ç‚¹&#34;&gt;xDS åè®®è¦ç‚¹&lt;/h3&gt;
&lt;p&gt;æœ€åæ€»ç»“ä¸‹å…³äº xDS åè®®çš„è¦ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CDSã€EDSã€LDSã€RDS æ˜¯æœ€åŸºç¡€çš„ xDS åè®®ï¼Œå®ƒä»¬å¯ä»¥åˆ†åˆ«ç‹¬ç«‹æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰çš„å‘ç°æœåŠ¡ï¼ˆDiscovery Serviceï¼‰å¯ä»¥è¿æ¥ä¸åŒçš„ Management Serverï¼Œä¹Ÿå°±æ˜¯è¯´ç®¡ç† xDS çš„æœåŠ¡å™¨å¯ä»¥æ˜¯å¤šä¸ªã€‚&lt;/li&gt;
&lt;li&gt;Envoy åœ¨åŸå§‹ xDS åè®®çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›åˆ—æ‰©å……ï¼Œå¢åŠ äº† SDSï¼ˆç§˜é’¥å‘ç°æœåŠ¡ï¼‰ã€ADSï¼ˆèšåˆå‘ç°æœåŠ¡ï¼‰ã€HDSï¼ˆå¥åº·å‘ç°æœåŠ¡ï¼‰ã€MSï¼ˆMetric æœåŠ¡ï¼‰ã€RLSï¼ˆé€Ÿç‡é™åˆ¶æœåŠ¡ï¼‰ç­‰ APIã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œè‹¥ç›´æ¥ä½¿ç”¨ xDS åŸå§‹ API çš„è¯ï¼Œéœ€è¦ä¿è¯è¿™æ ·çš„é¡ºåºæ›´æ–°ï¼šCDS &amp;ndash;&amp;gt; EDS &amp;ndash;&amp;gt; LDS &amp;ndash;&amp;gt; RDSï¼Œè¿™æ˜¯éµå¾ªç”µå­å·¥ç¨‹ä¸­çš„&lt;strong&gt;å…ˆåˆåæ–­&lt;/strong&gt;ï¼ˆMake-Before-Breakï¼‰åŸåˆ™ï¼Œå³åœ¨æ–­å¼€åŸæ¥çš„è¿æ¥ä¹‹å‰å…ˆå»ºç«‹å¥½æ–°çš„è¿æ¥ï¼Œåº”ç”¨åœ¨è·¯ç”±é‡Œå°±æ˜¯ä¸ºäº†é˜²æ­¢è®¾ç½®äº†æ–°çš„è·¯ç”±è§„åˆ™çš„æ—¶å€™å´æ— æ³•å‘ç°ä¸Šæ¸¸é›†ç¾¤è€Œå¯¼è‡´æµé‡è¢«ä¸¢å¼ƒçš„æƒ…å†µï¼Œç±»ä¼¼äºç”µè·¯é‡Œçš„æ–­è·¯ã€‚&lt;/li&gt;
&lt;li&gt;CDS è®¾ç½® Service Mesh ä¸­æœ‰å“ªäº›æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;EDS è®¾ç½®å“ªäº›å®ä¾‹ï¼ˆEndpointï¼‰å±äºè¿™äº›æœåŠ¡ï¼ˆClusterï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;LDS è®¾ç½®å®ä¾‹ä¸Šç›‘å¬çš„ç«¯å£ä»¥é…ç½®è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;RDS æœ€ç»ˆæœåŠ¡é—´çš„è·¯ç”±å…³ç³»ï¼Œåº”è¯¥ä¿è¯æœ€åæ›´æ–° RDSã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;envoy&#34;&gt;Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio Service Mesh ä¸­é»˜è®¤çš„ Sidecarï¼ŒIstio åœ¨ Enovy çš„åŸºç¡€ä¸ŠæŒ‰ç…§ Envoy çš„ xDS åè®®æ‰©å±•äº†å…¶æ§åˆ¶å¹³é¢ï¼Œåœ¨è®²åˆ° Envoy xDS åè®®ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦å…ˆç†Ÿæ‚‰ä¸‹ Envoy çš„åŸºæœ¬æœ¯è¯­ã€‚ä¸‹é¢åˆ—ä¸¾äº† Envoy é‡Œçš„åŸºæœ¬æœ¯è¯­åŠå…¶æ•°æ®ç»“æ„è§£æï¼Œå…³äº Envoy çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;http://cloudnative.to/envoy/&#34; title=&#34;Envoy å®˜æ–¹æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy å®˜æ–¹æ–‡æ¡£&lt;/a&gt;
ï¼Œè‡³äº Envoy åœ¨ Service Meshï¼ˆä¸ä»…é™äº Istioï¼‰ä¸­æ˜¯å¦‚ä½•ä½œä¸ºè½¬å‘ä»£ç†å·¥ä½œçš„è¯·å‚è€ƒç½‘æ˜“äº‘åˆ˜è¶…çš„è¿™ç¯‡&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; title=&#34;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ &#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ &lt;/a&gt;
ä»¥åŠ&lt;a href=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; title=&#34;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;
ï¼Œæœ¬æ–‡å¼•ç”¨å…¶ä¸­çš„ä¸€äº›è§‚ç‚¹ï¼Œè¯¦ç»†å†…å®¹ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/envoy-arch.jpg&#34; data-img=&#34;/blog/service-mesh-the-microservices-in-post-kubernetes-era/envoy-arch.jpg&#34; data-width=&#34;1492&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Envoy proxy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy proxy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åŸºæœ¬æœ¯è¯­&#34;&gt;åŸºæœ¬æœ¯è¯­&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ‚¨åº”è¯¥äº†è§£çš„ Enovy é‡Œçš„åŸºæœ¬æœ¯è¯­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Downstreamï¼ˆä¸‹æ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸‹æ¸¸ä¸»æœºè¿æ¥åˆ° Envoyï¼Œå‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼Œå³å‘é€è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Upstreamï¼ˆä¸Šæ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸Šæ¸¸ä¸»æœºæ¥æ”¶æ¥è‡ª Envoy çš„è¿æ¥å’Œè¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ï¼Œå³æ¥å—è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Listenerï¼ˆç›‘å¬å™¨ï¼‰&lt;/strong&gt;ï¼šç›‘å¬å™¨æ˜¯å‘½åç½‘åœ°å€ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unix domain socket ç­‰)ï¼Œä¸‹æ¸¸å®¢æˆ·ç«¯å¯ä»¥è¿æ¥è¿™äº›ç›‘å¬å™¨ã€‚Envoy æš´éœ²ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›‘å¬å™¨ç»™ä¸‹æ¸¸ä¸»æœºè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Clusterï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šé›†ç¾¤æ˜¯æŒ‡ Envoy è¿æ¥çš„ä¸€ç»„é€»è¾‘ç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery&#34; title=&#34;æœåŠ¡å‘ç°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;
æ¥å‘ç°é›†ç¾¤çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking&#34; title=&#34;ä¸»åŠ¨å¥åº·æ£€æŸ¥&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;
æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing&#34; title=&#34;è´Ÿè½½å‡è¡¡ç­–ç•¥&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;
å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤çš„å“ªä¸ªæˆå‘˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy ä¸­å¯ä»¥è®¾ç½®å¤šä¸ª Listenerï¼Œæ¯ä¸ª Listener ä¸­åˆå¯ä»¥è®¾ç½® filter chainï¼ˆè¿‡æ»¤å™¨é“¾è¡¨ï¼‰ï¼Œè€Œä¸”è¿‡æ»¤å™¨æ˜¯å¯æ‰©å±•çš„ï¼Œè¿™æ ·å°±å¯ä»¥æ›´æ–¹ä¾¿æˆ‘ä»¬æ“ä½œæµé‡çš„è¡Œä¸ºï¼Œä¾‹å¦‚è®¾ç½®åŠ å¯†ã€ç§æœ‰ RPC ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;xDS åè®®æ˜¯ç”± Envoy æå‡ºçš„ï¼Œç°åœ¨æ˜¯ Istio ä¸­é»˜è®¤çš„ sidecar proxyï¼Œä½†åªè¦å®ç° xDS åè®®ç†è®ºä¸Šéƒ½æ˜¯å¯ä»¥ä½œä¸º Istio ä¸­çš„ sidecar proxy çš„ï¼Œä¾‹å¦‚èš‚èšé›†å›¢å¼€æºçš„ &lt;a href=&#34;https://github.com/mosn/mosn&#34; title=&#34;MOSN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-service-mesh&#34;&gt;Istio Service Mesh&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-mesh-arch.png&#34; data-img=&#34;/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-mesh-arch.png&#34; data-width=&#34;1302&#34; data-height=&#34;782&#34; alt=&#34;image&#34; data-caption=&#34;Istio service mesh æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio service mesh æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio æ˜¯ä¸€ä¸ªåŠŸèƒ½ååˆ†ä¸°å¯Œçš„ Service Meshï¼Œå®ƒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼šè¿™æ˜¯ Istio çš„æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç­–ç•¥æ§åˆ¶ï¼šé€šè¿‡ Mixer ç»„ä»¶å’Œå„ç§é€‚é…å™¨æ¥å®ç°ï¼Œå®ç°è®¿é—®æ§åˆ¶ç³»ç»Ÿã€é¥æµ‹æ•è·ã€é…é¢ç®¡ç†å’Œè®¡è´¹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§ï¼šåœ¨ sidecar proxy ä¸­å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨è®¤è¯ï¼šCitadel ç»„ä»¶åšå¯†é’¥å’Œè¯ä¹¦ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;istio-ä¸­çš„æµé‡ç®¡ç†&#34;&gt;Istio ä¸­çš„æµé‡ç®¡ç†&lt;/h3&gt;
&lt;p&gt;Istio ä¸­å®šä¹‰äº†å¦‚ä¸‹çš„ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/custom-resource.html&#34; title=&#34;CRD&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CRD&lt;/a&gt;
 æ¥å¸®åŠ©ç”¨æˆ·è¿›è¡Œæµé‡ç®¡ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gateway&lt;/strong&gt;ï¼š&lt;a href=&#34;https://istio.io/docs/reference/config/networking/gateway/&#34; title=&#34;Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;
 æè¿°äº†åœ¨ç½‘ç»œè¾¹ç¼˜è¿è¡Œçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ¥æ”¶ä¼ å…¥æˆ–ä¼ å‡ºçš„ HTTP / TCP è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;VirtualService&lt;/strong&gt;ï¼š&lt;a href=&#34;https://istio.io/docs/reference/config/networking/virtual-service/&#34; title=&#34;VirtualService&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualService&lt;/a&gt;
 å®é™…ä¸Šå°† Kubernetes æœåŠ¡è¿æ¥åˆ° Istio Gatewayã€‚å®ƒè¿˜å¯ä»¥æ‰§è¡Œæ›´å¤šæ“ä½œï¼Œä¾‹å¦‚å®šä¹‰ä¸€ç»„æµé‡è·¯ç”±è§„åˆ™ï¼Œä»¥ä¾¿åœ¨ä¸»æœºè¢«å¯»å€æ—¶åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DestinationRule&lt;/strong&gt;ï¼š&lt;a href=&#34;https://istio.io/zh/docs/reference/config/networking/destination-rule/&#34; title=&#34;&amp;lt;code&amp;gt;DestinationRule&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;DestinationRule&lt;/code&gt;&lt;/a&gt;
 æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚ç®€å•çš„è¯´å°±æ˜¯å®šä¹‰æµé‡å¦‚ä½•è·¯ç”±ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EnvoyFilter&lt;/strong&gt;ï¼š&lt;a href=&#34;https://istio.io/docs/reference/config/networking/envoy-filter/&#34; title=&#34;&amp;lt;code&amp;gt;EnvoyFilter&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt;&lt;/a&gt;
 å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸ªé…ç½®åˆçº§ç”¨æˆ·ä¸€èˆ¬å¾ˆå°‘ç”¨åˆ°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ServiceEntry&lt;/strong&gt;ï¼šé»˜è®¤æƒ…å†µä¸‹ Istio Service Mesh ä¸­çš„æœåŠ¡æ˜¯æ— æ³•å‘ç° Mesh å¤–çš„æœåŠ¡çš„ï¼Œ&lt;a href=&#34;https://istio.io/docs/reference/config/networking/service-entry/&#34; title=&#34;&amp;lt;code&amp;gt;ServiceEntry&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ServiceEntry&lt;/code&gt;&lt;/a&gt;
 èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubernetes-vs-xds-vs-istio&#34;&gt;Kubernetes vs xDS vs Istio&lt;/h2&gt;
&lt;p&gt;åœ¨é˜…è¯»å®Œä¸Šæ–‡å¯¹ Kubernetes çš„ &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶ã€xDS å’Œ Istio ä¸­æµé‡ç®¡ç†çš„æŠ½è±¡æ¦‚å¿µä¹‹åï¼Œä¸‹é¢å°†å¸¦æ‚¨ä»…å°±æµé‡ç®¡ç†æ–¹é¢æ¯”è¾ƒä¸‹ä¸‰è€…å¯¹åº”çš„ç»„ä»¶/åè®®ï¼ˆæ³¨æ„ï¼Œä¸‰è€…ä¸å¯ä»¥å®Œå…¨ç­‰åŒï¼‰ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Kubernetes&lt;/th&gt;
&lt;th&gt;xDS&lt;/th&gt;
&lt;th&gt;Istio Service Mesh&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;WorkloadEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;VirtualService&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;DestinationRule&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;EnvoyFilter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ingress&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;Gateway&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Cluster&lt;/td&gt;
&lt;td&gt;ServiceEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¦‚æœè¯´ Kubernetes ç®¡ç†çš„å¯¹è±¡æ˜¯ Podï¼Œé‚£ä¹ˆ Service Mesh ä¸­ç®¡ç†çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªä¸ª Serviceï¼Œæ‰€ä»¥è¯´ä½¿ç”¨ Kubernetes ç®¡ç†å¾®æœåŠ¡åå†åº”ç”¨ Service Mesh å°±æ˜¯æ°´åˆ°æ¸ æˆäº†ï¼Œå¦‚æœè¿ Service ä½ ä¹Ÿä¸æƒ³ç®¡äº†ï¼Œé‚£å°±ç”¨å¦‚ &lt;a href=&#34;https://github.com/knative/&#34; title=&#34;knative&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;knative&lt;/a&gt;
 è¿™æ ·çš„ serverless å¹³å°ï¼Œä½†è¿™å°±æ˜¯åè¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;Envoy/MOSN çš„åŠŸèƒ½ä¹Ÿä¸åªæ˜¯åšæµé‡è½¬å‘ï¼Œä»¥ä¸Šæ¦‚å¿µåªä¸è¿‡æ˜¯ Istio åœ¨ Kubernetes ä¹‹ä¸Šæ–°å¢ä¸€å±‚æŠ½è±¡å±‚ä¸­çš„å†°å±±ä¸€è§’ï¼Œä½†å› ä¸ºæµé‡ç®¡ç†æ˜¯æœåŠ¡ç½‘æ ¼æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™å°†æˆä¸ºæœ¬ä¹¦çš„å¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; title=&#34;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ - cnblogs.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ - cnblogs.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; title=&#34;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/&#34; title=&#34;kubernetes ç®€ä»‹ï¼šservice å’Œ kube-proxy åŸç† - cizixs.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes ç®€ä»‹ï¼šservice å’Œ kube-proxy åŸç† - cizixs.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jishu.io/kubernetes/ipvs-loadbalancer-for-kubernetes/&#34; title=&#34;ä½¿ç”¨ IPVS å®ç° Kubernetes å…¥å£æµé‡è´Ÿè½½å‡è¡¡ - jishu.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ IPVS å®ç° Kubernetes å…¥å£æµé‡è´Ÿè½½å‡è¡¡ - jishu.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; title=&#34;xDS REST and gRPC protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS REST and gRPC protocol&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istio å›¾ä¹¦</title>
      <link>https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/</link>
      <pubDate>Sat, 03 Aug 2019 15:24:37 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;https://item.jd.com/12538407.html&#34; title=&#34;ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æï¼ˆå¼ è¶…ç›Ÿã€ç« é‘«ã€å¾ä¸­è™ã€å¾é£ç¼–è‘—ï¼‰ã€‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æï¼ˆå¼ è¶…ç›Ÿã€ç« é‘«ã€å¾ä¸­è™ã€å¾é£ç¼–è‘—ï¼‰ã€‹&lt;/a&gt;
æ˜¯ 2019 å¹´å›½å†…å‡ºç‰ˆçš„ç¬¬å››æœ¬ Istio ç›¸å…³å›¾ä¹¦ï¼Œå‰ä¸‰æœ¬åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://item.jd.com/12527008.html&#34; title=&#34;æ·±å…¥æµ…å‡º Istioï¼šService Mesh å¿«é€Ÿå…¥é—¨ä¸å®è·µï¼Œå´”ç§€é¾™ è‘—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥æµ…å‡º Istioï¼šService Mesh å¿«é€Ÿå…¥é—¨ä¸å®è·µï¼Œå´”ç§€é¾™ è‘—&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://item.jd.com/12516473.html&#34; title=&#34;Service Mesh å®æˆ˜ï¼šç”¨ Istio è½¯è´Ÿè½½å®ç°æœåŠ¡ç½‘æ ¼ï¼Œå‘¨é¥ è‘—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh å®æˆ˜ï¼šç”¨ Istio è½¯è´Ÿè½½å®ç°æœåŠ¡ç½‘æ ¼ï¼Œå‘¨é¥ è‘—&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://item.jd.com/12601120.html&#34; title=&#34;Istio å…¥é—¨ä¸å®æˆ˜ï¼Œæ¯›å¹¿çŒ® è‘—&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å…¥é—¨ä¸å®æˆ˜ï¼Œæ¯›å¹¿çŒ® è‘—&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™å››æœ¬ä¹¦åˆšä¸Šå¸‚æ—¶æˆ‘éƒ½è·å¾—äº†ä½œè€…çš„èµ ä¹¦ï¼Œè¿™æœ¬ä¹¦æ˜¯ç”±å››ä½åä¸ºçš„åŒå­¦ç¼–å†™ï¼Œäº 2019 å¹´  7 æœˆç¬¬ä¸€æ¬¡å°åˆ·ï¼Œå…¨ä¹¦å…± 24 ç« ï¼Œ606 é¡µï¼Œå”®ä»· 139 å…ƒã€‚æˆ‘æ˜¯åœ¨ KubeCon China 2019 çš„ä¸Šæµ·å¤§ä¼šç°åœºå¼ è¶…ç›Ÿäº²æ‰‹èµ ä¸æˆ‘çš„ï¼Œå¼ è¶…ç›Ÿä¹Ÿæ˜¯ 2018 å¹´&lt;a href=&#34;https://www.servicemesher.com/blog/service-mesh-meetup-shenzhen-20180825/&#34; title=&#34;ç¬¬ä¸‰å±Š Service Mesh Meetup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸‰å±Š Service Mesh Meetup&lt;/a&gt;
 çš„è®²å¸ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/006tNc79ly1g60ml3q3i4j30xc0m8wg2.jpg&#34; data-img=&#34;/blog/cloud-native-service-mesh-istio-book/006tNc79ly1g60ml3q3i4j30xc0m8wg2.jpg&#34; data-width=&#34;1200&#34; data-height=&#34;800&#34; alt=&#34;image&#34; data-caption=&#34;å³ä¾§æ˜¯äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼ˆåä¸ºäº‘åŸç”ŸæŠ€æœ¯ä¸›ä¹¦ï¼‰ä½œè€…ä¹‹ä¸€å¼ è¶…ç›Ÿ&#34;&gt;
    
  
  &lt;figcaption&gt;å³ä¾§æ˜¯äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼ˆåä¸ºäº‘åŸç”ŸæŠ€æœ¯ä¸›ä¹¦ï¼‰ä½œè€…ä¹‹ä¸€å¼ è¶…ç›Ÿ&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æœ¬ä¹¦ç»“æ„&#34;&gt;æœ¬ä¹¦ç»“æ„&lt;/h2&gt;
&lt;p&gt;å…¨ä¹¦å…±åˆ†å››ä¸ªç¯‡ç« ï¼Œ24 ä¸ªç« èŠ‚ï¼Œ606 é¡µï¼Œæ¯ä¸ªç« èŠ‚çš„é¡µæ•°å æ¯”ç»Ÿè®¡å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/006tNc79ly1g5nsbm4pkej30u00uj0vw.jpg&#34; data-img=&#34;/blog/cloud-native-service-mesh-istio-book/006tNc79ly1g5nsbm4pkej30u00uj0vw.jpg&#34; data-width=&#34;1080&#34; data-height=&#34;1099&#34; alt=&#34;image&#34; data-caption=&#34;äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹å›¾ä¹¦ç« èŠ‚é¡µæ•°å å…¨ä¹¦ç™¾åˆ†æ¯” - è¡¨æ ¼&#34;&gt;
    
  
  &lt;figcaption&gt;äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹å›¾ä¹¦ç« èŠ‚é¡µæ•°å å…¨ä¹¦ç™¾åˆ†æ¯” - è¡¨æ ¼&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/cloud-native-service-mesh-istio-book/006tNc79ly1g60mjr3lirj30v20u0q5g.jpg&#34; data-img=&#34;/blog/cloud-native-service-mesh-istio-book/006tNc79ly1g60mjr3lirj30v20u0q5g.jpg&#34; data-width=&#34;1118&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹å›¾ä¹¦ç« èŠ‚é¡µæ•°å å…¨ä¹¦ç™¾åˆ†æ¯” - é¥¼å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹å›¾ä¹¦ç« èŠ‚é¡µæ•°å å…¨ä¹¦ç™¾åˆ†æ¯” - é¥¼å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»ç»Ÿè®¡ç»“æœä¸­å¯ä»¥çœ‹å‡ºä¹¦ä¸­ç¬¬ 3 ç« ï¼ˆéä¾µå…¥çš„æµé‡æ²»ç†ï¼‰ã€ç¬¬ 14 ç« ï¼ˆå¸ä»¤å®˜ Pilotï¼‰ä¸€å…±å å…¨ä¹¦çš„é¡µæ•°ç™¾åˆ†æ¯”ä¸º 24%ï¼Œå‡ ä¹å äº†å››åˆ†ä¹‹ä¸€çš„ç¯‡å¹…ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦æ˜¯ç›®å‰ï¼ˆ2019 å¹´ 08 æœˆ 15 æ—¥ï¼‰å¸‚é¢ä¸Šèƒ½ä¹°åˆ°çš„æœ€å…¨çš„ä¸€æœ¬ Istio ç›¸å…³çš„å›¾ä¹¦äº†ï¼Œè¯è¯´å›½å¤–è¿˜ä¸€æœ¬ Istio çš„ä¹¦ä¹Ÿå‡ºæ¥ï¼Œå›½å†…åˆ°ç°åœ¨éƒ½å‡ºäº†å››æœ¬äº†ï¼Œæ˜¯ä¸æ˜¯æœ‰ç§å¢™å¤–å¼€èŠ±å¢™å†…é¦™çš„æ„Ÿè§‰ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å»ºè®®å¤§å®¶ç»“åˆ &lt;a href=&#34;https://istio.io&#34; title=&#34;Istio å®˜æ–¹æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;
ä¸€èµ·æ¥çœ‹è¿™æœ¬ä¹¦ï¼ŒIstio ç‰ˆæœ¬æ›´æ–°è™½ç„¶æ²¡æœ‰ Kubernetes é‚£ä¹ˆå¿«ï¼Œä½†æ˜¯åœ¨æœ¬ä¹¦å‘è¡Œä¸€ä¸ªå¤šæœˆåä¹Ÿè¦å‘å¸ƒ 1.2 ç‰ˆæœ¬äº†ï¼Œæ¬¢è¿å¤§å®¶&lt;a href=&#34;https://www.servicemesher.com&#34; title=&#34;åŠ å…¥ ServiceMesher ç¤¾åŒº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥ ServiceMesher ç¤¾åŒº&lt;/a&gt;
æ¥å­¦ä¹  Istioï¼&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘</title>
      <link>https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/</link>
      <pubDate>Wed, 26 Dec 2018 18:32:27 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡ä»¥ Istio å®˜æ–¹çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/examples/bookinfo&#34; title=&#34;bookinfo ç¤ºä¾‹&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo ç¤ºä¾‹&lt;/a&gt;
æ¥è®²è§£åœ¨è¿›å…¥ Pod çš„æµé‡è¢« iptables è½¬äº¤ç»™ Envoy sidecar åï¼ŒEnvoy æ˜¯å¦‚ä½•åšè·¯ç”±è½¬å‘çš„ï¼Œè¯¦è¿°äº† Inbound å’Œ Outbound å¤„ç†è¿‡ç¨‹ã€‚å…³äºæµé‡æ‹¦æˆªçš„è¯¦ç»†åˆ†æè¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; title=&#34;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio å®˜æ–¹æä¾›çš„ bookinfo çš„è¯·æ±‚æµç¨‹å›¾ï¼Œå‡è®¾ bookinfo åº”ç”¨çš„æ‰€æœ‰æœåŠ¡ä¸­æ²¡æœ‰é…ç½® DestinationRuleã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwgy1fvlwjd3302j31bo0ro0x5.jpg&#34; data-img=&#34;/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwgy1fvlwjd3302j31bo0ro0x5.jpg&#34; data-width=&#34;1716&#34; data-height=&#34;996&#34; alt=&#34;image&#34; data-caption=&#34;Bookinfo ç¤ºä¾‹&#34;&gt;
    
  
  &lt;figcaption&gt;Bookinfo ç¤ºä¾‹&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio è‡ªèº«ç»„ä»¶ä¸ Bookinfo ç¤ºä¾‹çš„è¿æ¥å…³ç³»å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ HTTP è¿æ¥éƒ½åœ¨ 9080 ç«¯å£ç›‘å¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyitp0jsghj31o70u0x6p.jpg&#34; data-img=&#34;/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyitp0jsghj31o70u0x6p.jpg&#34; data-width=&#34;2167&#34; data-height=&#34;1080&#34; alt=&#34;image&#34; data-caption=&#34;Bookinfo ç¤ºä¾‹ä¸ Istio ç»„ä»¶è¿æ¥å…³ç³»å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Bookinfo ç¤ºä¾‹ä¸ Istio ç»„ä»¶è¿æ¥å…³ç³»å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨ &lt;a href=&#34;https://drive.google.com/open?id=19ed3_tkjf6RgGboxllMdt_Ytd5_cocib&#34; title=&#34;Google Drive&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Drive&lt;/a&gt;
 ä¸Šä¸‹è½½åŸå›¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥åŠæµé‡åŠ«æŒæ­¥éª¤æ¦‚è¿°&#34;&gt;Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒæ­¥éª¤æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä» Sidecar æ³¨å…¥ã€Pod å¯åŠ¨åˆ° Sidecar proxy æ‹¦æˆªæµé‡åŠ Envoy å¤„ç†è·¯ç”±çš„æ­¥éª¤æ¦‚è§ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; Kubernetes é€šè¿‡ Admission Controller è‡ªåŠ¨æ³¨å…¥ï¼Œæˆ–è€…ç”¨æˆ·ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤æ‰‹åŠ¨æ³¨å…¥ sidecar å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; åº”ç”¨ YAML é…ç½®éƒ¨ç½²åº”ç”¨ï¼Œæ­¤æ—¶ Kubernetes API server æ¥æ”¶åˆ°çš„æœåŠ¡åˆ›å»ºé…ç½®æ–‡ä»¶ä¸­å·²ç»åŒ…å«äº† Init å®¹å™¨åŠ sidecar proxyã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; åœ¨ sidecar proxy å®¹å™¨å’Œåº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰ï¼Œé¦–å…ˆè¿è¡Œ Init å®¹å™¨ï¼ŒInit å®¹å™¨ç”¨äºè®¾ç½® iptablesï¼ˆIstio ä¸­é»˜è®¤çš„æµé‡æ‹¦æˆªæ–¹å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ BPFã€IPVS ç­‰æ–¹å¼ï¼‰å°†è¿›å…¥ pod çš„æµé‡åŠ«æŒåˆ° Envoy sidecar proxyã€‚æ‰€æœ‰ TCP æµé‡ï¼ˆEnvoy ç›®å‰åªæ”¯æŒ TCP æµé‡ï¼‰å°†è¢« sidecar åŠ«æŒï¼Œå…¶ä»–åè®®çš„æµé‡å°†æŒ‰åŸæ¥çš„ç›®çš„åœ°è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; å¯åŠ¨ Pod ä¸­çš„ Envoy sidecar proxy å’Œåº”ç”¨ç¨‹åºå®¹å™¨ã€‚è¿™ä¸€æ­¥çš„è¿‡ç¨‹è¯·å‚è€ƒ&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#%E9%80%9A%E8%BF%87%E7%AE%A1%E7%90%86%E6%8E%A5%E5%8F%A3%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE&#34; title=&#34;é€šè¿‡ç®¡ç†æ¥å£è·å–å®Œæ•´é…ç½®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ç®¡ç†æ¥å£è·å–å®Œæ•´é…ç½®&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Sidecar proxy ä¸åº”ç”¨å®¹å™¨çš„å¯åŠ¨é¡ºåºé—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ sidecar proxy å’Œåº”ç”¨å®¹å™¨ï¼Œç©¶ç«Ÿå“ªä¸ªå®¹å™¨å…ˆå¯åŠ¨å‘¢ï¼Ÿæ­£å¸¸æƒ…å†µæ˜¯ Envoy Sidecar å’Œåº”ç”¨ç¨‹åºå®¹å™¨å…¨éƒ¨å¯åŠ¨å®Œæˆåå†å¼€å§‹æ¥æ”¶æµé‡è¯·æ±‚ã€‚ä½†æ˜¯æˆ‘ä»¬æ— æ³•é¢„æ–™å“ªä¸ªå®¹å™¨ä¼šå…ˆå¯åŠ¨ï¼Œé‚£ä¹ˆå®¹å™¨å¯åŠ¨é¡ºåºæ˜¯å¦ä¼šå¯¹ Envoy åŠ«æŒæµé‡æœ‰å½±å“å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¸è¿‡åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ…å†µ 1ï¼šåº”ç”¨å®¹å™¨å…ˆå¯åŠ¨ï¼Œè€Œ sidecar proxy ä»æœªå°±ç»ª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œæµé‡è¢« iptables è½¬ç§»åˆ° 15001 ç«¯å£ï¼Œè€Œ Pod ä¸­æ²¡æœ‰ç›‘å¬è¯¥ç«¯å£ï¼ŒTCP é“¾æ¥å°±æ— æ³•å»ºç«‹ï¼Œè¯·æ±‚å¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ…å†µ 2ï¼šSidecar å…ˆå¯åŠ¨ï¼Œè¯·æ±‚åˆ°è¾¾è€Œåº”ç”¨ç¨‹åºä»æœªå°±ç»ª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹è¯·æ±‚ä¹Ÿè‚¯å®šä¼šå¤±è´¥ï¼Œè‡³äºæ˜¯åœ¨å“ªä¸€æ­¥å¼€å§‹å¤±è´¥çš„ï¼Œç•™ç»™è¯»è€…æ¥æ€è€ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœä¸º sidecar proxy å’Œåº”ç”¨ç¨‹åºå®¹å™¨æ·»åŠ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34; title=&#34;å°±ç»ªå’Œå­˜æ´»æ¢é’ˆ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°±ç»ªå’Œå­˜æ´»æ¢é’ˆ&lt;/a&gt;
æ˜¯å¦å¯ä»¥è§£å†³è¯¥é—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5.&lt;/strong&gt; ä¸è®ºæ˜¯è¿›å…¥è¿˜æ˜¯ä» Pod å‘å‡ºçš„ TCP è¯·æ±‚éƒ½ä¼šè¢« iptables åŠ«æŒï¼Œinbound æµé‡è¢«åŠ«æŒåç» Inbound Handler å¤„ç†åè½¬äº¤ç»™åº”ç”¨ç¨‹åºå®¹å™¨å¤„ç†ï¼Œoutbound æµé‡è¢« iptables åŠ«æŒåè½¬äº¤ç»™ Outbound Handler å¤„ç†ï¼Œå¹¶ç¡®å®šè½¬å‘çš„ upstream å’Œ Endpointã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6.&lt;/strong&gt; Sidecar proxy è¯·æ±‚ Pilot ä½¿ç”¨ xDS åè®®åŒæ­¥ Envoy é…ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ LDSã€EDSã€CDS ç­‰ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯æ›´æ–°çš„é¡ºåºï¼ŒEnvoy ä¼šç›´æ¥ä½¿ç”¨ ADS å‘ Pilot è¯·æ±‚é…ç½®æ›´æ–°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-å¦‚ä½•å¤„ç†è·¯ç”±è½¬å‘&#34;&gt;Envoy å¦‚ä½•å¤„ç†è·¯ç”±è½¬å‘&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡è¯·æ±‚è®¿é—® &lt;code&gt;http://reviews.default.svc.cluster.local:9080/&lt;/code&gt;ï¼Œå½“æµé‡è¿›å…¥ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡å†…éƒ¨æ—¶ï¼Œ&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡å†…éƒ¨çš„ Envoy Sidecar æ˜¯å¦‚ä½•åšæµé‡æ‹¦æˆªå’Œè·¯ç”±è½¬å‘çš„ã€‚å¯ä»¥åœ¨ &lt;a href=&#34;https://drive.google.com/file/d/1n-h235tm8DnL_RqxTTA95rgGtrLkBsyr/view?usp=sharing&#34; title=&#34;Google Drive&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Drive&lt;/a&gt;
 ä¸Šä¸‹è½½åŸå›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/envoy-sidecar-traffic-interception-zh-20210818.png&#34; data-img=&#34;/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/envoy-sidecar-traffic-interception-zh-20210818.png&#34; data-width=&#34;3080&#34; data-height=&#34;1870&#34; alt=&#34;image&#34; data-caption=&#34;Envoy sidecar æµé‡åŠ«æŒä¸è·¯ç”±è½¬å‘ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy sidecar æµé‡åŠ«æŒä¸è·¯ç”±è½¬å‘ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥å¼€å§‹æ—¶ï¼Œ&lt;code&gt;productpage&lt;/code&gt; Pod ä¸­çš„ Envoy sidecar å·²ç»é€šè¿‡ EDS é€‰æ‹©å‡ºäº†è¦è¯·æ±‚çš„ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡çš„ä¸€ä¸ª Podï¼ŒçŸ¥æ™“äº†å…¶ IP åœ°å€ï¼Œå‘é€ TCP è¿æ¥è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®˜ç½‘ä¸­çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/#envoy-%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90&#34; title=&#34;Envoy é…ç½®æ·±åº¦è§£æ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy é…ç½®æ·±åº¦è§£æ&lt;/a&gt;
ä¸­æ˜¯ä»¥å‘èµ· HTTP è¯·æ±‚çš„ä¸€æ–¹æ¥è¯¦è¿° Envoy åšæµé‡è½¬å‘çš„è¿‡ç¨‹ï¼Œè€Œæœ¬æ–‡ä¸­è€ƒè™‘çš„æ˜¯æ¥å— downstream çš„æµé‡çš„ä¸€æ–¹ï¼Œå®ƒæ—¢è¦æ¥æ”¶ downstream å‘æ¥çš„è¯·æ±‚ï¼Œè‡ªå·±è¿˜éœ€è¦è¯·æ±‚å…¶ä»–æœåŠ¡ï¼Œä¾‹å¦‚ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ä¸­çš„ Pod è¿˜éœ€è¦è¯·æ±‚ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸‰ä¸ªç‰ˆæœ¬ä¸­çš„ sidecar å·¥ä½œæ­¥éª¤ç±»ä¼¼ï¼Œä¸‹æ–‡åªä»¥ &lt;code&gt;reviews-v1-cb8655c75-b97zc&lt;/code&gt; è¿™ä¸€ä¸ª Pod ä¸­çš„ Sidecar æµé‡è½¬å‘æ­¥éª¤æ¥è¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-inbound-handler&#34;&gt;ç†è§£ Inbound Handler&lt;/h2&gt;
&lt;p&gt;Inbound handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„ downstream çš„æµé‡è½¬äº¤ç»™ localhostï¼Œä¸ Pod å†…çš„åº”ç”¨ç¨‹åºå®¹å™¨å»ºç«‹è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ä¸‹ &lt;code&gt;reviews-v1-cb8655c75-b97zc&lt;/code&gt; pod ä¸­çš„ Listenerã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc listener reviews-v1-cb8655c75-b97zc&lt;/code&gt; æŸ¥çœ‹è¯¥ Pod ä¸­çš„å…·æœ‰å“ªäº› Listenerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;ADDRESS            PORT      TYPE &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;172.33.3.3         9080      HTTP &amp;lt;--- æ¥æ”¶æ‰€æœ‰ Inbound HTTP æµé‡ï¼Œè¯¥åœ°å€å³ä¸ºå½“å‰ Pod çš„ IP åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.0.1         443       TCP  &amp;lt;--+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.4.253       80        TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.4.253       8080      TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.109.182     443       TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       15011     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       853       TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.79.114      443       TCP     | &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.143.179     15011     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.0.2         53        TCP     | æ¥æ”¶ä¸ 0.0.0.0_15001 ç›‘å¬å™¨é…å¯¹çš„ Outbound é HTTP æµé‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       443       TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.16.64       42422     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.127.202     16686     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       31400     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       8060      TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.169.13      14267     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.169.13      14268     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.32.134      8443      TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.118.196     443       TCP  &amp;lt;--+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15004     HTTP &amp;lt;--+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            8080      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15010     HTTP    | &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            8088      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15031     HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9090      HTTP    | &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9411      HTTP    | æ¥æ”¶ä¸ 0.0.0.0_15001 é…å¯¹çš„ Outbound HTTP æµé‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            80        HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15030     HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9080      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9093      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            3000      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            8060      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9091      HTTP &amp;lt;--+    &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15001     TCP  &amp;lt;--- æ¥æ”¶æ‰€æœ‰ç» iptables æ‹¦æˆªçš„ Inbound å’Œ Outbound æµé‡å¹¶è½¬äº¤ç»™è™šæ‹Ÿç›‘å¬å™¨å¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æ¥è‡ª &lt;code&gt;productpage&lt;/code&gt; çš„æµé‡æŠµè¾¾ &lt;code&gt;reviews&lt;/code&gt; Pod çš„æ—¶å€™å·²ç»ï¼Œdownstream å¿…é¡»æ˜ç¡®çŸ¥é“ Pod çš„ IP åœ°å€ä¸º &lt;code&gt;172.33.3.3&lt;/code&gt; æ‰€ä»¥æ‰ä¼šè®¿é—®è¯¥ Podï¼Œæ‰€ä»¥è¯¥è¯·æ±‚æ˜¯ &lt;code&gt;172.33.3.3:9080&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;virtual&lt;/code&gt; Listener&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»è¯¥ Pod çš„ Listener åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ0.0.0.0:15001/TCP çš„ Listenerï¼ˆå…¶å®é™…åå­—æ˜¯ &lt;code&gt;virtual&lt;/code&gt;ï¼‰ç›‘å¬æ‰€æœ‰çš„ Inbound æµé‡ï¼Œä¸‹é¢æ˜¯è¯¥ Listener çš„è¯¦ç»†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtual&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.tcp_proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;useOriginalDst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;UseOriginalDst&lt;/strong&gt;ï¼šä»é…ç½®ä¸­å¯ä»¥çœ‹å‡º &lt;code&gt;useOriginalDst&lt;/code&gt; é…ç½®æŒ‡å®šä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç¼ºçœä¸º falseï¼Œä½¿ç”¨ iptables é‡å®šå‘è¿æ¥æ—¶ï¼Œproxy æ¥æ”¶çš„ç«¯å£å¯èƒ½ä¸&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34; title=&#34;åŸå§‹ç›®çš„åœ°å€&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;
çš„ç«¯å£ä¸ä¸€æ ·ï¼Œå¦‚æ­¤å¤„ proxy æ¥æ”¶çš„ç«¯å£ä¸º 15001ï¼Œè€ŒåŸå§‹ç›®çš„åœ°ç«¯å£ä¸º 9080ã€‚å½“æ­¤æ ‡å¿—è®¾ç½®ä¸º true æ—¶ï¼ŒListener å°†è¿æ¥é‡å®šå‘åˆ°ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œæ­¤å¤„ä¸º &lt;code&gt;172.33.3.3:9080&lt;/code&gt;ã€‚å¦‚æœæ²¡æœ‰ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œåˆ™è¿æ¥ç”±æ¥æ”¶å®ƒçš„ Listener å¤„ç†ï¼Œå³è¯¥ &lt;code&gt;virtual&lt;/code&gt; Listenerï¼Œç»è¿‡ &lt;code&gt;envoy.tcp_proxy&lt;/code&gt; è¿‡æ»¤å™¨å¤„ç†è½¬å‘ç»™ &lt;code&gt;BlackHoleCluster&lt;/code&gt;ï¼Œè¿™ä¸ª Cluster çš„ä½œç”¨æ­£å¦‚å®ƒçš„åå­—ï¼Œå½“ Envoy æ‰¾ä¸åˆ°åŒ¹é…çš„è™šæ‹Ÿç›‘å¬å™¨æ—¶ï¼Œå°±ä¼šå°†è¯·æ±‚å‘é€ç»™å®ƒï¼Œå¹¶è¿”å› 404ã€‚è¿™ä¸ªå°†äºä¸‹æ–‡æåˆ°çš„ Listener ä¸­è®¾ç½® &lt;code&gt;bindToPort&lt;/code&gt; ç›¸å‘¼åº”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¯¥å‚æ•°å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34; title=&#34;åŸå§‹ç›®çš„åœ°å€&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;
çš„ Listener filter æ›¿ä»£ã€‚è¯¥å‚æ•°çš„ä¸»è¦ç”¨é€”æ˜¯ï¼šEnvoy é€šè¿‡ç›‘å¬ 15001 ç«¯å£å°† iptables æ‹¦æˆªçš„æµé‡ç»ç”±å…¶ä»– Listener å¤„ç†è€Œä¸æ˜¯ç›´æ¥è½¬å‘å‡ºå»ï¼Œè¯¦æƒ…è§ &lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#virtual-listener&#34; title=&#34;Virtual Listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Listener&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener 172.33.3.3_9080&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šæ–‡è¯´åˆ°è¿›å…¥ Inbound handler çš„æµé‡è¢« &lt;code&gt;virtual&lt;/code&gt; Listener è½¬ç§»åˆ° &lt;code&gt;172.33.3.3_9080&lt;/code&gt; Listenerï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹ä¸‹è¯¥ Listener é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc listener reviews-v1-cb8655c75-b97zc --address 172.33.3.3 --port 9080 -o json&lt;/code&gt; æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.33.3.3_9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.33.3.3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;raw_buffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_remote_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;deprecatedV1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;bindToPort&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tls&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;tlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;bindToPort&lt;/strong&gt;ï¼šæ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.6.0/api-v1/listeners/listeners&#34; title=&#34;&amp;lt;code&amp;gt;bindToPort&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;bindToPort&lt;/code&gt;&lt;/a&gt;
 çš„é…ç½®ï¼Œå…¶å€¼ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œè¯¥é…ç½®çš„ç¼ºçœå€¼ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¡¨ç¤ºå°† Listener ç»‘å®šåˆ°ç«¯å£ä¸Šï¼Œæ­¤å¤„è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt; åˆ™è¯¥ Listener åªèƒ½å¤„ç†å…¶ä»– Listener è½¬ç§»è¿‡æ¥çš„æµé‡ï¼Œå³ä¸Šæ–‡æ‰€è¯´çš„ &lt;code&gt;virtual&lt;/code&gt; Listenerï¼Œæˆ‘ä»¬çœ‹å…¶ä¸­çš„ filterChains.filters ä¸­çš„ &lt;code&gt;envoy.http_connection_manager&lt;/code&gt; é…ç½®éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥é…ç½®è¡¨ç¤ºæµé‡å°†è½¬äº¤ç»™ Cluster &lt;code&gt;inbound|9080||reviews.default.svc.cluster.local&lt;/code&gt; å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cluster &lt;code&gt;inbound|9080||reviews.default.svc.cluster.local&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc cluster reviews-v1-cb8655c75-b97zc --fqdn reviews.default.svc.cluster.local --direction inbound -o json&lt;/code&gt; æŸ¥çœ‹è¯¥ Cluster çš„é…ç½®å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;connectTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°è¯¥ Cluster çš„ Endpoint ç›´æ¥å¯¹åº”çš„å°±æ˜¯ localhostï¼Œå†ç»è¿‡ iptables è½¬å‘æµé‡å°±è¢«åº”ç”¨ç¨‹åºå®¹å™¨æ¶ˆè´¹äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-outbound-handler&#34;&gt;ç†è§£ Outbound Handler&lt;/h2&gt;
&lt;p&gt;å› ä¸º &lt;code&gt;reviews&lt;/code&gt; ä¼šå‘ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚çš„åœ°å€æ˜¯ï¼š&lt;code&gt;http://ratings.default.svc.cluster.local:9080/&lt;/code&gt;ï¼ŒOutbound handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„æœ¬åœ°åº”ç”¨ç¨‹åºå‘å‡ºçš„æµé‡ï¼Œç»ç”± Envoy åˆ¤æ–­å¦‚ä½•è·¯ç”±åˆ° upstreamã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºå®¹å™¨å‘å‡ºçš„è¯·æ±‚ä¸º Outbound æµé‡ï¼Œè¢« iptables åŠ«æŒåè½¬ç§»ç»™ Envoy  Outbound handler å¤„ç†ï¼Œç„¶åç»è¿‡ &lt;code&gt;virtual&lt;/code&gt; Listenerã€&lt;code&gt;0.0.0.0_9080&lt;/code&gt; Listenerï¼Œç„¶åé€šè¿‡ Route 9080 æ‰¾åˆ° upstream çš„ clusterï¼Œè¿›è€Œé€šè¿‡ EDS æ‰¾åˆ° Endpoint æ‰§è¡Œè·¯ç”±åŠ¨ä½œã€‚è¿™ä¸€éƒ¨åˆ†å¯ä»¥å‚è€ƒ Istio å®˜ç½‘ä¸­çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/#envoy-%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90&#34; title=&#34;Envoy æ·±åº¦é…ç½®è§£æ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æ·±åº¦é…ç½®è§£æ&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Route 9080&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; ä¼šè¯·æ±‚ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ï¼Œè¿è¡Œ &lt;code&gt;istioctl proxy-config routes reviews-v1-cb8655c75-b97zc --name 9080 -o json&lt;/code&gt; æŸ¥çœ‹ route é…ç½®ï¼Œå› ä¸º Envoy ä¼šæ ¹æ® HTTP header ä¸­çš„ domains æ¥åŒ¹é… VirtualHostï¼Œæ‰€ä»¥ä¸‹é¢åªåˆ—ä¸¾äº† &lt;code&gt;ratings.default.svc.cluster.local:9080&lt;/code&gt; è¿™ä¸€ä¸ª VirtualHostã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.234.130&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.234.130:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxGrpcTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;perFilterConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¯¥ Virtual Host é…ç½®ä¸­å¯ä»¥çœ‹åˆ°å°†æµé‡è·¯ç”±åˆ° Cluster &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Endpoint &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio 1.1 ä»¥å‰ç‰ˆæœ¬ä¸æ”¯æŒä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤ç›´æ¥æŸ¥è¯¢ Cluster çš„ Endpointï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢ Pilot çš„ debug ç«¯ç‚¹çš„æ–¹å¼æŠ˜ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; reviews-v1-cb8655c75-b97zc -c istio-proxy curl http://istio-pilot.istio-system.svc.cluster.local:9093/debug/edsz &amp;gt; endpoints.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;endpoints.json&lt;/code&gt; æ–‡ä»¶ä¸­åŒ…å«äº†æ‰€æœ‰ Cluster çš„ Endpoint ä¿¡æ¯ï¼Œæˆ‘ä»¬åªé€‰å–å…¶ä¸­çš„ &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt; Cluster çš„ç»“æœå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusterName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;lbEndpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.33.100.2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterMetadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;uid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes://ratings-v1-8558d4458d-ns6lk.default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Endpoint å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ŒEnvoy å°†æ ¹æ®ä¸€å®šè§„åˆ™é€‰æ‹©é€‚å½“çš„ Endpoint æ¥è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šIstio 1.1 å°†æ”¯æŒ &lt;code&gt;istioctl pc endpoint&lt;/code&gt; å‘½ä»¤æ¥æŸ¥è¯¢ Endpointã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/&#34; title=&#34;è°ƒè¯• Envoy å’Œ Pilot - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒè¯• Envoy å’Œ Pilot - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; title=&#34;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/&#34; title=&#34;Istio æµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ - zhaohuabing.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ - zhaohuabing.com&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio ä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹</title>
      <link>https://jimmysong.io/blog/istio-service-and-traffic-model/</link>
      <pubDate>Mon, 17 Dec 2018 21:37:35 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-service-and-traffic-model/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚è™½ç„¶ Istio ä¸€å¼€å§‹ç¡®å®šçš„æŠ½è±¡æ¨¡å‹ä¸å¯¹æ¥çš„åº•å±‚å¹³å°æ— å…³ï¼Œä½†ç›®å‰æ¥çœ‹åŸºæœ¬ç»‘å®š Kubernetesï¼Œæœ¬æ–‡ä»…ä»¥ Kubernetes è¯´æ˜ã€‚å¦å¤–åœ¨ &lt;a href=&#34;http://www.servicemesher.com&#34; title=&#34;ServiceMesher ç¤¾åŒº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServiceMesher ç¤¾åŒº&lt;/a&gt;
ä¸­æœ€è¿‘æœ‰å¾ˆå¤šå…³äº Istioã€Envoyã€Kubernetes ä¹‹ä¸­çš„æœåŠ¡æ¨¡å‹å…³ç³»çš„è®¨è®ºï¼Œæœ¬æ–‡ä½œä¸ºä¸€ä¸ªå¼€ç¯‡è¯´æ˜ï¼ŒKubernetes å’Œ Isito ä¹‹é—´æœ‰å“ªäº›å…±æœ‰çš„æœåŠ¡æ¨¡å‹ï¼ŒIstio åœ¨ Kubernetes çš„æœåŠ¡æ¨¡å‹ä¹‹ä¸Šåˆå¢åŠ äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å…·æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚&lt;/strong&gt; åœ¨ CI/CD è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªæœåŠ¡å¯èƒ½åŒæ—¶éƒ¨ç½²åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œå¦‚å¼€å‘ã€ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒç­‰ï¼Œè¿™äº›æœåŠ¡ç‰ˆæœ¬ä¸ä¸€å®šå…·æœ‰ä¸åŒçš„ APIï¼Œå¯èƒ½åªæ˜¯ä¸€äº›å°çš„æ›´æ”¹å¯¼è‡´çš„è¿­ä»£ç‰ˆæœ¬ã€‚åœ¨ A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒä¸­ç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸-istio-ä¸­å…±æœ‰çš„æ¨¡å‹&#34;&gt;Kubernetes ä¸ Istio ä¸­å…±æœ‰çš„æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;å› ä¸º Istio åŸºæœ¬å°±æ˜¯ç»‘å®šåœ¨ Kubernetes ä¸Šï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ Kubernetes åŠ Istio ä¸­å…±æœ‰çš„æœåŠ¡æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­ iptables ä»£ç†æ¨¡å¼ï¼ˆå¦å¤–è¿˜æœ‰ IPVS æ¨¡å¼ï¼‰ä¸‹çš„ serviceï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨ kube-proxy ä¸­é…ç½®ç®€å•çš„è´Ÿè½½å‡è¡¡ï¼Œå¯¹æ•´ä¸ª node ç”Ÿæ•ˆï¼Œæ— æ³•é…ç½®åˆ°å•ä¸ªæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œå…¶ä»–å¾®æœåŠ¡çš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚ç†”æ–­ã€é™æµã€è¿½è¸ªç­‰ï¼Œè¿™äº›åŠŸèƒ½åªèƒ½åœ¨åº”ç”¨ä¸­å®ç°äº†ï¼Œè€Œåœ¨ Istio çš„æ¦‚å¿µæ¨¡å‹ä¸­å®Œå…¨å»æ‰äº† &lt;code&gt;kube-proxy&lt;/code&gt;  è¿™ä¸ªç»„ä»¶ï¼Œå°†å…¶åˆ†æ•£åˆ°æ¯ä¸ªåº”ç”¨ Pod ä¸­åŒæ—¶éƒ¨ç½²çš„ Envoy ä¸­å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢åˆ—ä¸¾çš„æ˜¯ Kubernetes å’Œ Istio ä¸­å…±æœ‰çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;service&#34;&gt;Service&lt;/h3&gt;
&lt;p&gt;è¿™å®é™…ä¸Šè·Ÿ Kubernetes ä¸­çš„ service æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; title=&#34;Kubernetes ä¸­çš„ service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä¸­çš„ service&lt;/a&gt;
ã€‚Istio æ¨å‡ºäº†æ¯” service æ›´å¤æ‚çš„æ¨¡å‹ &lt;code&gt;VirtualService&lt;/code&gt;ï¼Œè¿™ä¸å•çº¯æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡äº†ï¼Œè€Œæ˜¯åœ¨æœåŠ¡ä¹‹ä¸Šå®šä¹‰äº†è·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå®Œå…¨é™å®šçš„åŸŸåï¼ˆFQDNï¼‰ï¼Œç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ã€‚æœåŠ¡è¿˜å¯ä»¥æœ‰ä¸å…¶ç›¸å…³è”çš„å•ä¸ªè´Ÿè½½å‡è¡¡å™¨æˆ–è™šæ‹Ÿ IP åœ°å€ã€‚é’ˆå¯¹ FQDN çš„ DNS æŸ¥è¯¢å°†è§£æä¸ºè¯¥è´Ÿè½½å‡è¡¡å™¨æˆ–è€…è™šæ‹Ÿ IP çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ Kubernetes ä¸­ä¸€ä¸ªæœåŠ¡ä¸º &lt;code&gt;foo.default.svc.cluster.local&lt;/code&gt; ï¼Œè™šæ‹Ÿ IP /ClusterIP æ˜¯ 10.0.1.1ï¼Œç›‘å¬çš„ç«¯å£æ˜¯ 80 å’Œ 8080ã€‚&lt;/p&gt;
&lt;h3 id=&#34;endpoint&#34;&gt;Endpoint&lt;/h3&gt;
&lt;p&gt;è¿™é‡ŒæŒ‡çš„æ˜¯ Kubernetes ä¸­çš„ endpointï¼Œä¸€ä¸ª endpoint æ˜¯å®ç°äº†æŸæœåŠ¡çš„å…·ä½“å®ä¾‹ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª Endpointï¼Œè¡¨ç¤ºä¸º IP åœ°å€åŠ ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä¸º DNS åç§°åŠ ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®åˆ°åº•å“ªäº›å®ä¾‹å±äºåŒä¸€ä¸ª serviceï¼Œè¿˜æ˜¯éœ€è¦ é€šè¿‡ label åŒ¹é…æ¥é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;label&#34;&gt;Label&lt;/h3&gt;
&lt;p&gt;æœåŠ¡çš„ç‰ˆæœ¬ã€å¯¹åº”çš„å¼•ç”¨åç§°ç­‰æ˜¯é€šè¿‡ label æ¥æ ‡è®°çš„ï¼Œä¾‹å¦‚ä¸‹é¢ Kubernetes ä¸­ä¸€ä¸ªåº”ç”¨çš„ YAML é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ratings-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ratings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ratings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio/examples-bookinfo-ratings-v1:1.8.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;version: v1&lt;/code&gt; æ ‡è®°è¯¥æœåŠ¡æ˜¯ v1 ç‰ˆæœ¬ï¼Œ&lt;code&gt;version&lt;/code&gt; æ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„æ ‡ç­¾ï¼Œå»ºè®®å¤§å®¶çš„æœåŠ¡ä¸Šéƒ½å¸¦ä¸Šè¯¥æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶æœåŠ¡çš„ label å¯ä»¥è®¾ç½®ä»»æ„å¤šä¸ªï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨åšè·¯ç”±çš„æ—¶å€™å¯ä»¥æ ¹æ®æ ‡ç­¾åŒ¹é…æ¥åšç»†ç²’åº¦çš„æµé‡åˆ’åˆ†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®å¹³é¢-envoy&#34;&gt;æ•°æ®å¹³é¢ Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio ä¸­é»˜è®¤çš„ sidecar proxyï¼Œè´Ÿè´£æœåŠ¡é—´çš„æµé‡ç®¡æ§ã€è®¤è¯ä¸å®‰å…¨åŠ å¯†ã€å¯è§‚å¯Ÿæ€§ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Envoy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-service-and-traffic-model/envoy-arch-20190114.png&#34; data-img=&#34;/blog/istio-service-and-traffic-model/envoy-arch-20190114.png&#34; data-width=&#34;1460&#34; data-height=&#34;1072&#34; alt=&#34;image&#34; data-caption=&#34;Envoy æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘å†ç»™å¤§å®¶ä»‹ç» Envoy ä¸­çš„å¦‚ä¸‹å‡ ä¸ªé‡è¦æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster&#34;&gt;Cluster&lt;/h3&gt;
&lt;p&gt;é›†ç¾¤ï¼ˆclusterï¼‰æ˜¯ Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery&#34; title=&#34;æœåŠ¡å‘ç°&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;
å‘ç°é›†ç¾¤ä¸­çš„æˆå‘˜ã€‚Envoy å¯ä»¥é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking#arch-overview-health-checking&#34; title=&#34;ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥&lt;/a&gt;
æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶å†µã€‚Envoy å¦‚ä½•å°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤æˆå‘˜ç”±&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing#arch-overview-load-balancing&#34; title=&#34;è´Ÿè½½å‡è¡¡ç­–ç•¥&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;
ç¡®å®šã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¸ Kubernetes ä¸­çš„ Service æ¦‚å¿µç±»ä¼¼ï¼Œåªä¸è¿‡ Kubernetes ä¸­çš„æœåŠ¡å‘ç°ä¸­å¹¶ä¸åŒ…å«å¥åº·çŠ¶å†µæ£€æŸ¥ï¼Œè€Œæ˜¯é€šè¿‡&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34; title=&#34;é…ç½® Pod çš„ liveness å’Œ readiness æ¢é’ˆ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½® Pod çš„ liveness å’Œ readiness æ¢é’ˆ&lt;/a&gt;
æ¥å®ç°ï¼ŒæœåŠ¡å‘ç°é»˜è®¤ä¹Ÿæ˜¯é€šè¿‡ DNS æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener&#34;&gt;Listener&lt;/h3&gt;
&lt;p&gt;ç›‘å¬å™¨ï¼ˆlistenerï¼‰æ˜¯å¯ä»¥ç”±ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥çš„å‘½åç½‘ç»œä½ç½®ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unix åŸŸå¥—æ¥å­—ç­‰ï¼‰ã€‚Envoy å…¬å¼€ä¸€ä¸ªæˆ–å¤šä¸ªä¸‹æ¸¸ä¸»æœºè¿æ¥çš„ä¾¦å¬å™¨ã€‚ä¸€èˆ¬æ˜¯æ¯å°ä¸»æœºè¿è¡Œä¸€ä¸ª Envoyï¼Œä½¿ç”¨å•è¿›ç¨‹è¿è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨ä»»æ„æ•°é‡çš„ Listenerï¼ˆç›‘å¬å™¨ï¼‰ï¼Œç›®å‰åªç›‘å¬ TCPï¼Œæ¯ä¸ªç›‘å¬å™¨éƒ½ç‹¬ç«‹é…ç½®ä¸€å®šæ•°é‡çš„ï¼ˆL3/L4ï¼‰ç½‘ç»œè¿‡æ»¤å™¨ã€‚Listenter ä¹Ÿå¯ä»¥é€šè¿‡ Listener Discovery Serviceï¼ˆ&lt;strong&gt;LDS&lt;/strong&gt;ï¼‰åŠ¨æ€è·å–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener-filter&#34;&gt;Listener filter&lt;/h3&gt;
&lt;p&gt;Listener ä½¿ç”¨ listener filterï¼ˆç›‘å¬å™¨è¿‡æ»¤å™¨ï¼‰æ¥æ“ä½œé“¾æ¥çš„å…ƒæ•°æ®ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨ä¸æ›´æ”¹ Envoy çš„æ ¸å¿ƒåŠŸèƒ½çš„æƒ…å†µä¸‹æ·»åŠ æ›´å¤šçš„é›†æˆåŠŸèƒ½ã€‚Listener filter çš„ API ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºè¿™äº›è¿‡æ»¤å™¨æœ€ç»ˆæ˜¯åœ¨æ–°æ¥å—çš„å¥—æ¥å­—ä¸Šè¿è¡Œã€‚åœ¨é“¾ä¸­å¯ä»¥äº’ç›¸è¡”æ¥ä»¥æ”¯æŒæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚è°ƒç”¨é€Ÿç‡é™åˆ¶ã€‚Envoy å·²ç»åŒ…å«äº†å¤šä¸ªç›‘å¬å™¨è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­å¢åŠ çš„æµé‡æ¨¡å‹&#34;&gt;Istio ä¸­å¢åŠ çš„æµé‡æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;VirtualService&lt;/code&gt;ã€&lt;code&gt;DestinationRule&lt;/code&gt;ã€&lt;code&gt;Gateway&lt;/code&gt;ã€&lt;code&gt;ServiceEntry&lt;/code&gt; å’Œ &lt;code&gt;EnvoyFilter&lt;/code&gt; éƒ½æ˜¯ Istio ä¸­ä¸ºæµé‡ç®¡ç†æ‰€åˆ›å»ºçš„ CRDï¼Œè¿™äº›æ¦‚å¿µå…¶å®æ˜¯åšè·¯ç”±é…ç½®å’Œæµé‡ç®¡ç†çš„ï¼Œè€Œ Kubernetes ä¸­çš„ service åªæ˜¯ç”¨æ¥åšæœåŠ¡å‘ç°ã€‚Service Mesh ä¸­çœŸæ­£çš„æœåŠ¡æ¨¡å‹åº”è¯¥æ˜¯ Envoy çš„ &lt;a href=&#34;https://cloudnative.to/blog/envoy-xds-protocol/&#34; title=&#34;xDS åè®®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®&lt;/a&gt;
ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æœåŠ¡çš„æµé‡æ²»ç†ï¼ŒæœåŠ¡çš„ç«¯ç‚¹æ˜¯é€šè¿‡ EDS æ¥é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-service-and-traffic-model/istio-pilot.png&#34; data-img=&#34;/blog/istio-service-and-traffic-model/istio-pilot.png&#34; data-width=&#34;800&#34; data-height=&#34;438&#34; alt=&#34;image&#34; data-caption=&#34;Istio pilot æ¶æ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Istio pilot æ¶æ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ Pilot è®¾è®¡å›¾ï¼Œæ¥è‡ª&lt;a href=&#34;https://github.com/istio/old_pilot_repo/blob/master/doc/design.md&#34; title=&#34;Istio Pilot design overview&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Pilot design overview&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;routing&#34;&gt;Routing&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­çš„ service æ˜¯æ²¡æœ‰ä»»ä½•è·¯ç”±å±æ€§å¯ä»¥é…ç½®çš„ï¼ŒIstio åœ¨è®¾è®¡ä¹‹åˆå°±é€šè¿‡åœ¨åŒä¸€ä¸ª Pod ä¸­ï¼Œåœ¨åº”ç”¨å®¹å™¨æ—è¿è¡Œä¸€ä¸ª sidecar proxy æ¥é€æ˜å¾—å®ç°ç»†ç²’åº¦çš„è·¯ç”±æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;virtualservice&#34;&gt;VirtualService&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;VirtualService&lt;/code&gt; å®šä¹‰é’ˆå¯¹æŒ‡å®šæœåŠ¡æµé‡çš„è·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½é’ˆå¯¹ç‰¹å®šåè®®çš„åŒ¹é…è§„åˆ™ã€‚å¦‚æœæµé‡ç¬¦åˆè¿™äº›ç‰¹å¾ï¼Œå°±ä¼šæ ¹æ®è§„åˆ™å‘é€åˆ°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ç›®æ ‡æœåŠ¡ï¼ˆæˆ–è€…ç›®æ ‡æœåŠ¡çš„å­é›†æˆ–ç‰ˆæœ¬ï¼‰ã€‚å¯¹äº A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒç­‰åœºæ™¯ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨åˆ’åˆ† &lt;code&gt;subset&lt;/code&gt;ï¼ŒVirtualService ä¸­æ ¹æ® destination ä¸­çš„ subset é…ç½®æ¥é€‰æ‹©è·¯ç”±ï¼Œä½†æ˜¯è¿™äº› subset ç©¶ç«Ÿå¯¹åº”å“ªäº›æœåŠ¡ç¤ºä¾‹ï¼Œè¿™å°±éœ€è¦ &lt;code&gt;DestionationRule&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;destinationrule&#34;&gt;DestinationRule&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;DestinationRule&lt;/code&gt; æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;gateway&#34;&gt;Gateway&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Gateway&lt;/code&gt; æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½ç½‘æ ¼è¾¹ç¼˜çš„è¿›å…¥å’Œå‘å‡ºè¿æ¥ã€‚è¿™ä¸€è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£ï¼Œä»¥åŠè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯å®šä¹‰æœåŠ¡ç½‘æ ¼çš„è¾¹ç¼˜è·¯ç”±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;serviceentry&#34;&gt;ServiceEntry&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ServiceEntry&lt;/code&gt; èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚&lt;code&gt;ServiceEntry&lt;/code&gt; æè¿°äº†æœåŠ¡çš„å±æ€§ï¼ˆDNS åç§°ã€VIPã€ç«¯å£ã€åè®®ä»¥åŠç«¯ç‚¹ï¼‰ã€‚è¿™ç±»æœåŠ¡å¯èƒ½æ˜¯ç½‘æ ¼å¤–çš„ APIï¼Œæˆ–è€…æ˜¯å¤„äºç½‘æ ¼å†…éƒ¨ä½†å´ä¸å­˜åœ¨äºå¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ¡ç›®ï¼ˆä¾‹å¦‚éœ€è¦å’Œ Kubernetes æœåŠ¡æ²Ÿé€šçš„ä¸€ç»„è™šæ‹ŸæœºæœåŠ¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰é…ç½® ServiceEntry çš„è¯ï¼ŒIstio å®é™…ä¸Šæ˜¯æ— æ³•å‘ç°æœåŠ¡ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoyfilter&#34;&gt;EnvoyFilter&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt; å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸€åŠŸèƒ½ä¸€å®šè¦è°¨æ…ä½¿ç”¨ã€‚é”™è¯¯çš„é…ç½®å†…å®¹ä¸€æ—¦å®Œæˆä¼ æ’­ï¼Œå¯èƒ½ä¼šä»¤æ•´ä¸ªæœåŠ¡ç½‘æ ¼è¿›å…¥ç˜«ç—ªçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä¸­çš„ listener å¯ä»¥é…ç½®å¤šä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listener_filters&#34; title=&#34;filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;filter&lt;/a&gt;
ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é€šè¿‡ Istio æ¥æ‰©å±• Envoy çš„æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; title=&#34;Kubernetes ä¸­çš„ service - jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä¸­çš„ service - jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/old_pilot_repo/blob/master/doc/service-registry.md&#34; title=&#34;Istio services model - github.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio services model - github.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io&#34; title=&#34;Istio æ–‡æ¡£ - istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£ - istio.io&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ</title>
      <link>https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/</link>
      <pubDate>Tue, 11 Sep 2018 10:39:42 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡æœ€æ–°æ›´æ–°äº 2022 å¹´ 3 æœˆ 7 æ—¥ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥å¾€æœ‰å¾ˆå¤šæ–‡ç« è®²è§£ Istio æ˜¯å¦‚ä½•åš Sidecar æ³¨å…¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰è®²è§£æ³¨å…¥ä¹‹å Sidecar å·¥ä½œçš„ç»†èŠ‚ã€‚æœ¬æ–‡å°†å¸¦å¤§å®¶è¯¦ç»†äº†è§£ Istio æ˜¯å¦‚ä½•å°† Envoy ä½œä¸º Sidecar çš„æ–¹å¼æ³¨å…¥åˆ°åº”ç”¨ç¨‹åº Pod ä¸­ï¼ŒåŠ Sidecar æ˜¯å¦‚ä½•åšåŠ«æŒæµé‡çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨è®²è§£ Istio å¦‚ä½•å°† Envoy ä»£ç†æ³¨å…¥åˆ°åº”ç”¨ç¨‹åº Pod ä¸­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar æ¨¡å¼ï¼šå®¹å™¨åº”ç”¨æ¨¡å¼ä¹‹ä¸€ï¼ŒService Mesh æ¶æ„çš„ä¸€ç§å®ç°æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;Init å®¹å™¨ï¼šPod ä¸­çš„ä¸€ç§ä¸“ç”¨çš„å®¹å™¨ï¼Œåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;iptablesï¼šæµé‡åŠ«æŒæ˜¯é€šè¿‡ iptables è½¬å‘å®ç°çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥çœ‹ç›®å‰ &lt;code&gt;reviews-v1-745ffc55b7-2l2lw&lt;/code&gt; Pod ä¸­è¿è¡Œçš„å®¹å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n default get pod reviews-v1-745ffc55b7-2l2lw -o&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{..spec.containers[*].name}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; å³åº”ç”¨å®¹å™¨ï¼Œ&lt;code&gt;istio-proxy&lt;/code&gt; å³ Envoy ä»£ç†çš„ sidecar å®¹å™¨ã€‚å¦å¤–è¯¥ Pod ä¸­å®é™…ä¸Šè¿˜è¿è¡Œè¿‡ä¸€ä¸ª Init å®¹å™¨ï¼Œå› ä¸ºå®ƒæ‰§è¡Œç»“æŸå°±è‡ªåŠ¨ç»ˆæ­¢äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸åˆ°è¯¥å®¹å™¨çš„å­˜åœ¨ã€‚å…³æ³¨ &lt;code&gt;jsonpath&lt;/code&gt; çš„ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://kubernetes.io/docs/reference/kubectl/jsonpath/&#34; title=&#34;JSONPath Support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSONPath Support&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ¨¡å¼&#34;&gt;Sidecar æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;åœ¨äº†è§£ Istio ä½¿ç”¨ Sidecar æ³¨å…¥ä¹‹å‰ï¼Œéœ€è¦å…ˆè¯´æ˜ä¸‹ä»€ä¹ˆæ˜¯ Sidecar æ¨¡å¼ã€‚Sidecar æ˜¯å®¹å™¨åº”ç”¨æ¨¡å¼çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯åœ¨ Service Mesh ä¸­å‘æ‰¬å…‰å¤§çš„ä¸€ç§æ¨¡å¼ï¼Œè¯¦è§ &lt;a href=&#34;https://www.servicemesher.com/blog/service-mesh-architectures/&#34; title=&#34;Service Mesh æ¶æ„è§£æ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ¶æ„è§£æ&lt;/a&gt;
ï¼Œå…¶ä¸­è¯¦ç»†æè¿°äº†&lt;strong&gt;èŠ‚ç‚¹ä»£ç†&lt;/strong&gt;å’Œ &lt;strong&gt;Sidecar&lt;/strong&gt; æ¨¡å¼çš„æœåŠ¡ç½‘æ ¼æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Sidecar æ¨¡å¼éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶ï¼Œæ— éœ€åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œä»£ç†ï¼ˆå› æ­¤æ‚¨ä¸éœ€è¦åŸºç¡€ç»“æ„çš„åä½œï¼‰ï¼Œä½†æ˜¯é›†ç¾¤ä¸­å°†è¿è¡Œå¤šä¸ªç›¸åŒçš„ Sidecar å‰¯æœ¬ã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼šæˆ‘å¯ä»¥ä¸ºä¸€ç»„å¾®æœåŠ¡éƒ¨ç½²åˆ°ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥éƒ¨ç½²ä¸€ä¸ªæœ‰ç‰¹å®šå®ç°çš„æœåŠ¡ç½‘æ ¼ã€‚åœ¨ Sidecar éƒ¨ç½²æ–¹å¼ä¸­ï¼Œä½ ä¼šä¸ºæ¯ä¸ªåº”ç”¨çš„å®¹å™¨éƒ¨ç½²ä¸€ä¸ªä¼´ç”Ÿå®¹å™¨ã€‚Sidecar æ¥ç®¡è¿›å‡ºåº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡ã€‚åœ¨ Kubernetes çš„ Pod ä¸­ï¼Œåœ¨åŸæœ‰çš„åº”ç”¨å®¹å™¨æ—è¾¹è¿è¡Œä¸€ä¸ª Sidecar å®¹å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªå®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºï¼Œå¯ä»¥å¹¿ä¹‰çš„å°†è¿™ä¸ªæ³¨å…¥äº† Sidecar å®¹å™¨çš„ Pod ç†è§£ä¸ºä¸€å°ä¸»æœºï¼Œä¸¤ä¸ªå®¹å™¨å…±äº«ä¸»æœºèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Service Mesh çš„æ¶æ„å›¾ï¼Œå…¶ä¸­çš„ä½äºæ¯ä¸ª Pod ä¸­çš„ proxy  ç»„æˆäº†æ•°æ®å¹³é¢ï¼Œè€Œè¿™äº› proxy æ­£æ˜¯ä»¥ sidecar æ¨¡å¼è¿è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/istio-sidecar.jpg&#34; data-img=&#34;/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/istio-sidecar.jpg&#34; data-width=&#34;1302&#34; data-height=&#34;782&#34; alt=&#34;image&#34; data-caption=&#34;Istio æ¶æ„&#34;&gt;
    
  
  &lt;figcaption&gt;Istio æ¶æ„&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸‹æ–‡ä¸­æ‰€æŒ‡çš„ Sidecar éƒ½æ˜¯æŒ‡çš„ Envoy ä»£ç†å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;init-å®¹å™¨&#34;&gt;Init å®¹å™¨&lt;/h2&gt;
&lt;p&gt;Init å®¹å™¨æ˜¯ä¸€ç§ä¸“ç”¨å®¹å™¨ï¼Œå®ƒåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª Pod ä¸­å¯ä»¥æŒ‡å®šå¤šä¸ª Init å®¹å™¨ï¼Œå¦‚æœæŒ‡å®šäº†å¤šä¸ªï¼Œé‚£ä¹ˆ Init å®¹å™¨å°†ä¼šæŒ‰é¡ºåºä¾æ¬¡è¿è¡Œã€‚åªæœ‰å½“å‰é¢çš„ Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸåï¼Œæ‰å¯ä»¥è¿è¡Œä¸‹ä¸€ä¸ª Init å®¹å™¨ã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆåï¼ŒKubernetes æ‰åˆå§‹åŒ– Pod å’Œè¿è¡Œåº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨ä½¿ç”¨ Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œå®ƒä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—® Secret çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºå®¹å™¨åˆ™ä¸èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Pod å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒInit å®¹å™¨ä¼šæŒ‰é¡ºåºåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åå¯åŠ¨ã€‚æ¯ä¸ªå®¹å™¨å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸé€€å‡ºã€‚å¦‚æœç”±äºè¿è¡Œæ—¶æˆ–å¤±è´¥é€€å‡ºï¼Œå°†å¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå®ƒä¼šæ ¹æ® Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; æŒ‡å®šçš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; è®¾ç½®ä¸º Alwaysï¼ŒInit å®¹å™¨å¤±è´¥æ—¶ä¼šä½¿ç”¨ &lt;code&gt;RestartPolicy&lt;/code&gt; ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ‰€æœ‰çš„ Init å®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼ŒPod å°†ä¸ä¼šå˜æˆ &lt;code&gt;Ready&lt;/code&gt; çŠ¶æ€ã€‚Init å®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨ Service ä¸­è¿›è¡Œèšé›†ã€‚æ­£åœ¨åˆå§‹åŒ–ä¸­çš„ Pod å¤„äº &lt;code&gt;Pending&lt;/code&gt; çŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°† &lt;code&gt;Initializing&lt;/code&gt; çŠ¶æ€è®¾ç½®ä¸º trueã€‚Init å®¹å™¨è¿è¡Œå®Œæˆä»¥åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Init å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34; title=&#34;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥ç¤ºä¾‹åˆ†æ&#34;&gt;Sidecar æ³¨å…¥ç¤ºä¾‹åˆ†æ&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æˆ‘ä»¬å°†ä»¥ Istio å®˜æ–¹ç¤ºä¾‹ &lt;code&gt;bookinfo&lt;/code&gt; ä¸­ &lt;code&gt;reivews&lt;/code&gt; æœåŠ¡ä¸ºä¾‹ï¼Œæ¥æ¥è®²è§£ Sidecar å®¹å™¨æ³¨å…¥çš„é¢æµç¨‹ï¼Œæ¯ä¸ªæ³¨å…¥äº† Sidecar çš„ Pod ä¸­é™¤äº†åŸå…ˆåº”ç”¨çš„åº”ç”¨æœ¬èº«çš„å®¹å™¨å¤–ï¼Œéƒ½ä¼šå¤šå‡ºæ¥è¿™æ ·ä¸¤ä¸ªå®¹å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;istio-init&lt;/code&gt;ï¼šç”¨äºç»™ Sidecar å®¹å™¨å³ Envoy ä»£ç†åšåˆå§‹åŒ–ï¼Œè®¾ç½® iptables ç«¯å£è½¬å‘&lt;/li&gt;
&lt;li&gt;&lt;code&gt;istio-proxy&lt;/code&gt;ï¼šEnvoy ä»£ç†å®¹å™¨ï¼Œè¿è¡Œ Envoy ä»£ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°†åˆ†åˆ«è§£æä¸‹è¿™ä¸¤ä¸ªå®¹å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨è§£æ&#34;&gt;Init å®¹å™¨è§£æ&lt;/h3&gt;
&lt;p&gt;Istio åœ¨ Pod ä¸­æ³¨å…¥çš„ Init å®¹å™¨åä¸º &lt;code&gt;istio-init&lt;/code&gt;ï¼Œå¦‚æœä½ æŸ¥çœ‹ &lt;code&gt;reviews&lt;/code&gt; Deployment é…ç½®ï¼Œä½ å°†çœ‹åˆ°å…¶ä¸­ &lt;code&gt;initContaienrs&lt;/code&gt; çš„å¯åŠ¨å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      initContainers:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - name: istio-init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          image: docker.io/istio/proxyv2:1.13.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          args:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - istio-iptables
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-p&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;15001&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-z&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;15006&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-u&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;1337&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-m&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - REDIRECT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-i&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-x&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-b&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - &lt;span class=&#34;s1&#34;&gt;&amp;#39;-d&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - 15090,15021,15020
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å…¥å£æ˜¯ &lt;code&gt;istio-iptables&lt;/code&gt; å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ˜¯ç”¨äºåˆå§‹åŒ–è·¯ç”±è¡¨çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨å¯åŠ¨å…¥å£&#34;&gt;Init å®¹å™¨å¯åŠ¨å…¥å£&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨çš„å¯åŠ¨å…¥å£æ˜¯ &lt;code&gt;/usr/local/bin/istio-iptable&lt;/code&gt; å‘½ä»¤ï¼Œè¯¥å‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istio-iptables -p PORT -u UID -g GID &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-m mode&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-b ports&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-d ports&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-i CIDR&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-x CIDR&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-h&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p: æŒ‡å®šé‡å®šå‘æ‰€æœ‰ TCP æµé‡çš„ Envoy ç«¯å£ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 15001ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -u: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ UIDã€‚é€šå¸¸ï¼Œè¿™æ˜¯ä»£ç†å®¹å™¨çš„ UIDï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_USER&lt;/span&gt; çš„ uidï¼Œistio_proxy çš„ uid æˆ– 1337ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -g: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ GIDã€‚ï¼ˆä¸ -u param ç›¸åŒçš„é»˜è®¤å€¼ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -m: æŒ‡å®šå…¥ç«™è¿æ¥é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ï¼Œâ€œREDIRECTâ€ æˆ– â€œTPROXYâ€ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_INTERCEPTION_MODE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -b: é€—å·åˆ†éš”çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œå…¶æµé‡å°†é‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰ç«¯å£ã€‚ä¸ºç©ºæ—¶è¡¨ç¤ºç¦ç”¨æ‰€æœ‰å…¥ç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -d: æŒ‡å®šè¦ä»é‡å®šå‘åˆ° Envoy ä¸­æ’é™¤ï¼ˆå¯é€‰ï¼‰çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œä»¥é€—å·æ ¼å¼åˆ†éš”ã€‚ä½¿ç”¨é€šé…ç¬¦â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å…¥ç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_LOCAL_EXCLUDE_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -i: æŒ‡å®šé‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ã€‚ç©ºåˆ—è¡¨å°†ç¦ç”¨æ‰€æœ‰å‡ºç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_CIDR&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -x: æŒ‡å®šå°†ä»é‡å®šå‘ä¸­æ’é™¤çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_EXCLUDE_CIDR&lt;/span&gt;ï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -z: æ‰€æœ‰å…¥ç«™ TCP æµé‡é‡å®šå‘ç«¯å£ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$INBOUND_CAPTURE_PORT&lt;/span&gt; 15006ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äºè¯¥å‘½ä»¤çš„è¯¦ç»†ä»£ç è¯·&lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/istio-iptables/pkg/cmd/root.go&#34; title=&#34;æŸ¥çœ‹ GitHubï¼š&amp;lt;code&amp;gt;tools/istio-iptables/pkg/cmd/root.go&amp;lt;/code&amp;gt;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹ GitHubï¼š&lt;code&gt;tools/istio-iptables/pkg/cmd/root.go&lt;/code&gt;&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;å†å‚è€ƒ &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼Œå®Œæ•´çš„å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ /usr/local/bin/istio-iptables -p &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; -z &lt;span class=&#34;m&#34;&gt;15006&lt;/span&gt; -u &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b * -d &lt;span class=&#34;s2&#34;&gt;&amp;#34;15090,15201,15020&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å®¹å™¨å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®© Envoy ä»£ç†å¯ä»¥æ‹¦æˆªæ‰€æœ‰çš„è¿›å‡º Pod çš„æµé‡ï¼Œå³å°†å…¥ç«™æµé‡é‡å®šå‘åˆ° Sidecarï¼Œå†æ‹¦æˆªåº”ç”¨å®¹å™¨çš„å‡ºç«™æµé‡ç»è¿‡ Sidecar å¤„ç†åå†å‡ºç«™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‘½ä»¤è§£æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¡å¯åŠ¨å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†åº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡éƒ½è½¬å‘åˆ° Envoy çš„ 15006 ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istio-proxy&lt;/code&gt; ç”¨æˆ·èº«ä»½è¿è¡Œï¼ŒUID ä¸º 1337ï¼Œå³ Envoy æ‰€å¤„çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç”¨æˆ·ï¼Œè§ YAML é…ç½®ä¸­çš„ &lt;code&gt;runAsUser&lt;/code&gt; å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼æ¥é‡å®šå‘æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½é‡å®šå‘åˆ° Envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;å°†é™¤äº† 15090ã€15201ã€15020 ç«¯å£ä»¥å¤–çš„æ‰€æœ‰ç«¯å£çš„æµé‡é‡å®šå‘åˆ° Envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸º Init å®¹å™¨åˆå§‹åŒ–å®Œæ¯•åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç™»é™†åˆ°å®¹å™¨ä¸­æŸ¥çœ‹ iptables ä¿¡æ¯ï¼Œä½†æ˜¯ Init å®¹å™¨åˆå§‹åŒ–ç»“æœä¼šä¿ç•™åˆ°åº”ç”¨å®¹å™¨å’Œ Sidecar å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-proxy-å®¹å™¨è§£æ&#34;&gt;istio-proxy å®¹å™¨è§£æ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æŸ¥çœ‹ iptables é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦ç™»é™†åˆ° Sidecar å®¹å™¨ä¸­ä½¿ç”¨ root ç”¨æˆ·æ¥æŸ¥çœ‹ï¼Œå› ä¸º &lt;code&gt;kubectl&lt;/code&gt; æ— æ³•ä½¿ç”¨ç‰¹æƒæ¨¡å¼æ¥è¿œç¨‹æ“ä½œ docker å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç™»é™†åˆ° &lt;code&gt;reviews&lt;/code&gt; Pod æ‰€åœ¨çš„ä¸»æœºä¸Šä½¿ç”¨ &lt;code&gt;docker&lt;/code&gt; å‘½ä»¤ç™»é™†å®¹å™¨ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;reviews&lt;/code&gt; Pod æ‰€åœ¨çš„ä¸»æœºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n default get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;reviews -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                              READY     STATUS    RESTARTS   AGE       IP             NODE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v1-745ffc55b7-2l2lw   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          1d        172.33.78.10   node3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°è¯¥ Pod è¿è¡Œåœ¨ &lt;code&gt;node3&lt;/code&gt; ä¸Šï¼Œä½¿ç”¨ &lt;code&gt;vagrant&lt;/code&gt; å‘½ä»¤ç™»é™†åˆ° &lt;code&gt;node3&lt;/code&gt; ä¸»æœºä¸­å¹¶åˆ‡æ¢ä¸º root ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ vagrant ssh node3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo -i
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ iptables é…ç½®ï¼Œåˆ—å‡º NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå› ä¸ºåœ¨ Init å®¹å™¨å¯åŠ¨çš„æ—¶å€™é€‰æ‹©ç»™  &lt;code&gt;istio-iptables.sh&lt;/code&gt; ä¼ é€’çš„å‚æ•°ä¸­æŒ‡å®šå°†å…¥ç«™æµé‡é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ä¸ºâ€œREDIRECTâ€ï¼Œå› æ­¤åœ¨ iptables ä¸­å°†åªæœ‰ NAT è¡¨çš„è§„æ ¼é…ç½®ï¼Œå¦‚æœé€‰æ‹© &lt;code&gt;TPROXY&lt;/code&gt; è¿˜ä¼šæœ‰ &lt;code&gt;mangle&lt;/code&gt; è¡¨é…ç½®ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; title=&#34;iptables&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables&lt;/a&gt;
ï¼Œè§„åˆ™é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://www.zsythink.net/archives/1517&#34; title=&#34;iptables è§„åˆ™é…ç½®&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables è§„åˆ™é…ç½®&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-iptables&#34;&gt;ç†è§£ iptables&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; æ˜¯ Linux å†…æ ¸ä¸­çš„é˜²ç«å¢™è½¯ä»¶ netfilter çš„ç®¡ç†å·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ netfilter çš„ä¸€éƒ¨åˆ†ã€‚Netfilter ä½äºå†…æ ¸ç©ºé—´ï¼Œä¸ä»…æœ‰ç½‘ç»œåœ°å€è½¬æ¢çš„åŠŸèƒ½ï¼Œä¹Ÿå…·å¤‡æ•°æ®åŒ…å†…å®¹ä¿®æ”¹ã€ä»¥åŠæ•°æ®åŒ…è¿‡æ»¤ç­‰é˜²ç«å¢™åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº†è§£ Init å®¹å™¨åˆå§‹åŒ–çš„ iptables ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ iptables å’Œè§„åˆ™é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† iptables è°ƒç”¨é“¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/iptables_packetflow.png&#34; data-img=&#34;/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/iptables_packetflow.png&#34; data-width=&#34;726&#34; data-height=&#34;1443&#34; alt=&#34;image&#34; data-caption=&#34;iptables è°ƒç”¨é“¾&#34;&gt;
    
  
  &lt;figcaption&gt;iptables è°ƒç”¨é“¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;iptables-ä¸­çš„è¡¨&#34;&gt;iptables ä¸­çš„è¡¨&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨ä¸­ä½¿ç”¨çš„çš„ iptables ç‰ˆæœ¬æ˜¯ &lt;code&gt;v1.6.0&lt;/code&gt;ï¼Œå…±åŒ…å« 5 å¼ è¡¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;raw&lt;/code&gt; ç”¨äºé…ç½®æ•°æ®åŒ…ï¼Œ&lt;code&gt;raw&lt;/code&gt; ä¸­çš„æ•°æ®åŒ…ä¸ä¼šè¢«ç³»ç»Ÿè·Ÿè¸ªã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;filter&lt;/code&gt; æ˜¯ç”¨äºå­˜æ”¾æ‰€æœ‰ä¸é˜²ç«å¢™ç›¸å…³æ“ä½œçš„é»˜è®¤è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nat&lt;/code&gt; ç”¨äº &lt;a href=&#34;https://en.wikipedia.org/wiki/Network_address_translation&#34; title=&#34;ç½‘ç»œåœ°å€è½¬æ¢&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œåœ°å€è½¬æ¢&lt;/a&gt;
ï¼ˆä¾‹å¦‚ï¼šç«¯å£è½¬å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mangle&lt;/code&gt; ç”¨äºå¯¹ç‰¹å®šæ•°æ®åŒ…çš„ä¿®æ”¹ï¼ˆå‚è€ƒ&lt;a href=&#34;https://en.wikipedia.org/wiki/Mangled_packet&#34; title=&#34;æŸåæ•°æ®åŒ…&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸåæ•°æ®åŒ…&lt;/a&gt;
ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;security&lt;/code&gt; ç”¨äº&lt;a href=&#34;https://wiki.archlinux.org/index.php/Security#Mandatory_access_control&#34; title=&#34;å¼ºåˆ¶è®¿é—®æ§åˆ¶&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼ºåˆ¶è®¿é—®æ§åˆ¶&lt;/a&gt;
 ç½‘ç»œè§„åˆ™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šåœ¨æœ¬ç¤ºä¾‹ä¸­åªç”¨åˆ°äº† &lt;code&gt;nat&lt;/code&gt; è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒçš„è¡¨ä¸­çš„å…·æœ‰çš„é“¾ç±»å‹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è§„åˆ™åç§°&lt;/th&gt;
&lt;th&gt;raw&lt;/th&gt;
&lt;th&gt;filter&lt;/th&gt;
&lt;th&gt;nat&lt;/th&gt;
&lt;th&gt;mangle&lt;/th&gt;
&lt;th&gt;security&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;PREROUTING&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;INPUT&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OUTPUT&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;POSTROUTING&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FORWARD&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ iptables çš„è°ƒç”¨é“¾é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/iptables-chains.jpg&#34; data-img=&#34;/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/iptables-chains.jpg&#34; data-width=&#34;1333&#34; data-height=&#34;410&#34; alt=&#34;image&#34; data-caption=&#34;iptables è°ƒç”¨é“¾é¡ºåº&#34;&gt;
    
  
  &lt;figcaption&gt;iptables è°ƒç”¨é“¾é¡ºåº&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;iptables-å‘½ä»¤&#34;&gt;iptables å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„ä¸»è¦ç”¨é€”æ˜¯ä¿®æ”¹è¿™äº›è¡¨ä¸­çš„è§„åˆ™ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-t è¡¨å&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; å‘½ä»¤é€‰é¡¹ï¼»é“¾å&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;ï¼»æ¡ä»¶åŒ¹é…ï¼½&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-j ç›®æ ‡åŠ¨ä½œæˆ–è·³è½¬ï¼½
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Init å®¹å™¨ä¸­çš„ &lt;code&gt;/istio-iptables.sh&lt;/code&gt; å¯åŠ¨å…¥å£è„šæœ¬å°±æ˜¯æ‰§è¡Œ iptables åˆå§‹åŒ–çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç†è§£-iptables-è§„åˆ™&#34;&gt;ç†è§£ iptables è§„åˆ™&lt;/h3&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨ä¸­çš„é»˜è®¤çš„ iptables è§„åˆ™ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯ filter è¡¨ä¸­çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -L -v
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT 350K packets, 63M bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT 18M packets, 1916M bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªé»˜è®¤çš„é“¾ï¼Œåˆ†åˆ«æ˜¯ INPUTã€FORWARD å’Œ OUTPUTï¼Œæ¯ä¸ªé“¾ä¸­çš„ç¬¬ä¸€è¡Œè¾“å‡ºè¡¨ç¤ºé“¾åç§°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º INPUT/FORWARD/OUTPUTï¼‰ï¼Œåè·Ÿé»˜è®¤ç­–ç•¥ï¼ˆACCEPTï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯æ¡é“¾ä¸­éƒ½å¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ï¼Œè§„åˆ™æ˜¯æŒ‰ç…§é¡ºåºä»å‰åˆ°åæ‰§è¡Œçš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è§„åˆ™çš„è¡¨å¤´å®šä¹‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pkts&lt;/strong&gt;ï¼šå¤„ç†è¿‡çš„åŒ¹é…çš„æŠ¥æ–‡æ•°é‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bytes&lt;/strong&gt;ï¼šç´¯è®¡å¤„ç†çš„æŠ¥æ–‡å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;target&lt;/strong&gt;ï¼šå¦‚æœæŠ¥æ–‡ä¸è§„åˆ™åŒ¹é…ï¼ŒæŒ‡å®šç›®æ ‡å°±ä¼šè¢«æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prot&lt;/strong&gt;ï¼šåè®®ï¼Œä¾‹å¦‚ &lt;code&gt;tdp&lt;/code&gt;ã€&lt;code&gt;udp&lt;/code&gt;ã€&lt;code&gt;icmp&lt;/code&gt; å’Œ &lt;code&gt;all&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;opt&lt;/strong&gt;ï¼šå¾ˆå°‘ä½¿ç”¨ï¼Œè¿™ä¸€åˆ—ç”¨äºæ˜¾ç¤º IP é€‰é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;in&lt;/strong&gt;ï¼šå…¥ç«™ç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;out&lt;/strong&gt;ï¼šå‡ºç«™ç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;source&lt;/strong&gt;ï¼šæµé‡çš„æº IP åœ°å€æˆ–å­ç½‘ï¼Œåè€…æ˜¯ &lt;code&gt;anywhere&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;destination&lt;/strong&gt;ï¼šæµé‡çš„ç›®çš„åœ° IP åœ°å€æˆ–å­ç½‘ï¼Œæˆ–è€…æ˜¯ &lt;code&gt;anywhere&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜æœ‰ä¸€åˆ—æ²¡æœ‰è¡¨å¤´ï¼Œæ˜¾ç¤ºåœ¨æœ€åï¼Œè¡¨ç¤ºè§„åˆ™çš„é€‰é¡¹ï¼Œä½œä¸ºè§„åˆ™çš„æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œç”¨æ¥è¡¥å……å‰é¢çš„å‡ åˆ—ä¸­çš„é…ç½®ã€‚&lt;code&gt;prot&lt;/code&gt;ã€&lt;code&gt;opt&lt;/code&gt;ã€&lt;code&gt;in&lt;/code&gt;ã€&lt;code&gt;out&lt;/code&gt;ã€&lt;code&gt;source&lt;/code&gt; å’Œ &lt;code&gt;destination&lt;/code&gt; å’Œæ˜¾ç¤ºåœ¨ &lt;code&gt;destination&lt;/code&gt; åé¢çš„æ²¡æœ‰è¡¨å¤´çš„ä¸€åˆ—æ‰©å±•æ¡ä»¶å…±åŒç»„æˆåŒ¹é…è§„åˆ™ã€‚å½“æµé‡åŒ¹é…è¿™äº›è§„åˆ™åå°±ä¼šæ‰§è¡Œ &lt;code&gt;target&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;target æ”¯æŒçš„ç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;target&lt;/code&gt; ç±»å‹åŒ…æ‹¬ ACCEPT&lt;code&gt;ã€REJECT&lt;/code&gt;ã€&lt;code&gt;DROP&lt;/code&gt;ã€&lt;code&gt;LOG&lt;/code&gt; ã€&lt;code&gt;SNAT&lt;/code&gt;ã€&lt;code&gt;MASQUERADE&lt;/code&gt;ã€&lt;code&gt;DNAT&lt;/code&gt;ã€&lt;code&gt;REDIRECT&lt;/code&gt;ã€&lt;code&gt;RETURN&lt;/code&gt; æˆ–è€…è·³è½¬åˆ°å…¶ä»–è§„åˆ™ç­‰ã€‚åªè¦æ‰§è¡Œåˆ°æŸä¸€æ¡é“¾ä¸­åªæœ‰æŒ‰ç…§é¡ºåºæœ‰ä¸€æ¡è§„åˆ™åŒ¹é…åå°±å¯ä»¥ç¡®å®šæŠ¥æ–‡çš„å»å‘äº†ï¼Œé™¤äº† &lt;code&gt;RETURN&lt;/code&gt; ç±»å‹ï¼Œç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ &lt;code&gt;return&lt;/code&gt; è¯­å¥ï¼Œè¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ã€‚&lt;code&gt;target&lt;/code&gt; æ”¯æŒçš„é…ç½®è¯¦è§£è¯·å‚è€ƒ &lt;a href=&#34;http://www.zsythink.net/archives/1199&#34; title=&#34;iptables è¯¦è§£ï¼ˆ1ï¼‰ï¼šiptables æ¦‚å¿µ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables è¯¦è§£ï¼ˆ1ï¼‰ï¼šiptables æ¦‚å¿µ&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ° Init å®¹å™¨æ²¡æœ‰åœ¨ iptables çš„é»˜è®¤é“¾è·¯ä¸­åˆ›å»ºä»»ä½•è§„åˆ™ï¼Œè€Œæ˜¯åˆ›å»ºäº†æ–°çš„é“¾è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŸ¥çœ‹-iptables-nat-è¡¨ä¸­æ³¨å…¥çš„è§„åˆ™&#34;&gt;æŸ¥çœ‹ iptables nat è¡¨ä¸­æ³¨å…¥çš„è§„åˆ™&lt;/h2&gt;
&lt;p&gt;Init å®¹å™¨é€šè¿‡å‘ iptables nat è¡¨ä¸­æ³¨å…¥è½¬å‘è§„åˆ™æ¥åŠ«æŒæµé‡çš„ï¼Œä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ä¸‰ä¸ª reviews æœåŠ¡ç¤ºä¾‹ä¸­çš„æŸä¸€ä¸ª Podï¼Œå…¶ä¸­æœ‰ init å®¹å™¨ã€åº”ç”¨å®¹å™¨å’Œ sidecar å®¹å™¨ï¼Œå›¾ä¸­å±•ç¤ºäº† iptables æµé‡åŠ«æŒçš„è¯¦ç»†è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/istio-iptables.svg&#34; data-img=&#34;/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/istio-iptables.svg&#34; alt=&#34;image&#34; data-caption=&#34;Envoy sidecar æµé‡åŠ«æŒä¸è·¯ç”±è½¬å‘ç¤ºæ„å›¾&#34;&gt;
    
  
  &lt;figcaption&gt;Envoy sidecar æµé‡åŠ«æŒä¸è·¯ç”±è½¬å‘ç¤ºæ„å›¾&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨å¯åŠ¨æ—¶å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šäº† &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼ï¼Œå› æ­¤åªåˆ›å»ºäº† NAT è¡¨è§„åˆ™ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥çœ‹ä¸‹ NAT è¡¨ä¸­åˆ›å»ºçš„è§„åˆ™ï¼Œè¿™æ˜¯å…¨æ–‡ä¸­çš„&lt;strong&gt;é‡ç‚¹éƒ¨åˆ†&lt;/strong&gt;ï¼Œå‰é¢è®²äº†é‚£ä¹ˆå¤šéƒ½æ˜¯ä¸ºå®ƒåšé“ºå«çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿›å…¥åˆ°-reviews-pod&#34;&gt;è¿›å…¥åˆ° reviews pod&lt;/h3&gt;
&lt;p&gt;Reviews æœåŠ¡æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°å…¶ä¸­ä»»æ„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¾‹å¦‚ reviews-1ï¼Œé¦–å…ˆä½ éœ€è¦ææ¸…æ¥šè¿™ä¸ª pod è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼ŒçŸ¥é“é‚£ä¸ªå®¹å™¨çš„å…·ä½“ IDï¼Œç„¶åä½¿ç”¨ SSH ç™»å½•é‚£ä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨ &lt;code&gt;ps&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹åˆ°é‚£ä¸ªå®¹å™¨çš„å…·ä½“ IPï¼Œä½¿ç”¨ &lt;code&gt;nsenter&lt;/code&gt; å‘½ä»¤è¿›å…¥è¯¥å®¹å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nsenter -t&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;PID&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; -n
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ kubectl è¿›å…¥å®¹å™¨ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio å‘ pod ä¸­è‡ªåŠ¨æ³¨å…¥çš„ sidecar å®¹å™¨ï¼ˆåä¸º &lt;code&gt;istio-proxy&lt;/code&gt;ï¼‰å…¶ä¸­é»˜è®¤çš„ç”¨æˆ·æ˜¯ &lt;code&gt;istio-proxy&lt;/code&gt;ï¼Œè¯¥ç”¨æˆ·æ²¡æœ‰æƒé™æŸ¥çœ‹è·¯ç”±è¡¨è§„åˆ™ï¼Œå³å½“ä½ åœ¨è¯¥å®¹å™¨ä¸­è¿è¡Œ &lt;code&gt;iptabes&lt;/code&gt; å‘½ä»¤æ—¶ä¼šå¾—åˆ° &lt;code&gt;iptables -t nat -L -v&lt;/code&gt; è¿™æ ·çš„ç»“æœï¼Œè€Œä¸”ä½ åˆæ²¡æœ‰ root æƒé™ã€‚å¯¹äº reviews å®¹å™¨ä¹Ÿæ˜¯ä¸€æ ·ï¼Œé»˜è®¤ç”¨æˆ·çš„ UID æ˜¯ &lt;code&gt;1000&lt;/code&gt;ï¼Œè€Œä¸”è¿™ä¸ªç”¨æˆ·åˆæ²¡æœ‰åå­—ï¼Œä¸€æ ·ä¹Ÿæ— æ³•åˆ‡æ¢ä¸º root ç”¨æˆ·ï¼Œç³»ç»Ÿä¸­é»˜è®¤æ²¡æœ‰å®‰è£… iptabels å‘½ä»¤ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½ç™»å½•åˆ° Pod çš„å®¿ä¸»èŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨ &lt;code&gt;nsenter&lt;/code&gt; å‘½ä»¤è¿›å…¥å®¹å™¨å†…éƒ¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æŸ¥çœ‹è·¯ç”±è¡¨&#34;&gt;æŸ¥çœ‹è·¯ç”±è¡¨&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æŸ¥çœ‹ nat è¡¨ä¸­çš„è§„åˆ™ï¼Œå…¶ä¸­é“¾çš„åå­—ä¸­åŒ…å« &lt;code&gt;ISTIO&lt;/code&gt; å‰ç¼€çš„æ˜¯ç”± Init å®¹å™¨æ³¨å…¥çš„ï¼Œè§„åˆ™åŒ¹é…æ˜¯æ ¹æ®ä¸‹é¢æ˜¾ç¤ºçš„é¡ºåºæ¥æ‰§è¡Œçš„ï¼Œå…¶ä¸­ä¼šæœ‰å¤šæ¬¡è·³è½¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹ NAT è¡¨ä¸­è§„åˆ™é…ç½®çš„è¯¦ç»†ä¿¡æ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -v
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# PREROUTING é“¾ï¼šç”¨äºç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ï¼Œå°†æ‰€æœ‰å…¥ç«™ TCP æµé‡è·³è½¬åˆ° ISTIO_INBOUND é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain PREROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# INPUT é“¾ï¼šå¤„ç†è¾“å…¥æ•°æ®åŒ…ï¼Œé TCP æµé‡å°†ç»§ç»­ OUTPUT é“¾&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# OUTPUT é“¾ï¼šå°†æ‰€æœ‰å‡ºç«™æ•°æ®åŒ…è·³è½¬åˆ° ISTIO_OUTPUT é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;41146&lt;/span&gt; packets, 3845K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;93&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;5580&lt;/span&gt; ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# POSTROUTING é“¾ï¼šæ‰€æœ‰æ•°æ®åŒ…æµå‡ºç½‘å¡æ—¶éƒ½è¦å…ˆè¿›å…¥POSTROUTING é“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬å‘å‡ºå»ï¼Œæˆ‘ä»¬çœ‹åˆ°æ­¤å¤„æœªåšä»»ä½•å¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain POSTROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;41199&lt;/span&gt; packets, 3848K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_INBOUND é“¾ï¼šå°†æ‰€æœ‰ç›®çš„åœ°ä¸º 9080 ç«¯å£çš„å…¥ç«™æµé‡é‡å®šå‘åˆ° ISTIO_IN_REDIRECT é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_INBOUND &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere             tcp dpt:9080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_IN_REDIRECT é“¾ï¼šå°†æ‰€æœ‰çš„å…¥ç«™æµé‡è·³è½¬åˆ°æœ¬åœ°çš„ 15006 ç«¯å£ï¼Œè‡³æ­¤æˆåŠŸçš„æ‹¦æˆªäº†æµé‡åˆ° Envoy &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_IN_REDIRECT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span class=&#34;m&#34;&gt;15006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_OUTPUT é“¾ï¼šé€‰æ‹©éœ€è¦é‡å®šå‘åˆ° Envoyï¼ˆå³æœ¬åœ°ï¼‰ çš„å‡ºç«™æµé‡ï¼Œæ‰€æœ‰é localhost çš„æµé‡å…¨éƒ¨è½¬å‘åˆ° ISTIO_REDIRECTã€‚ä¸ºäº†é¿å…æµé‡åœ¨è¯¥ Pod ä¸­æ— é™å¾ªç¯ï¼Œæ‰€æœ‰åˆ° istio-proxy ç”¨æˆ·ç©ºé—´çš„æµé‡éƒ½è¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ä¸­çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæœ¬ä¾‹ä¸­å³ OUTPUT é“¾ï¼Œå› ä¸ºè·³å‡º ISTIO_OUTPUT è§„åˆ™ä¹‹åå°±è¿›å…¥ä¸‹ä¸€æ¡é“¾ POSTROUTINGã€‚å¦‚æœç›®çš„åœ°é localhost å°±è·³è½¬åˆ° ISTIO_REDIRECTï¼›å¦‚æœæµé‡æ˜¯æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´çš„ï¼Œé‚£ä¹ˆå°±è·³å‡ºè¯¥é“¾ï¼Œè¿”å›å®ƒçš„è°ƒç”¨é“¾ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ï¼ˆOUPT çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæ— éœ€å¯¹æµé‡è¿›è¡Œå¤„ç†ï¼‰ï¼›æ‰€æœ‰çš„é istio-proxy ç”¨æˆ·ç©ºé—´çš„ç›®çš„åœ°æ˜¯ localhost çš„æµé‡å°±è·³è½¬åˆ° ISTIO_REDIRECT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ISTIO_REDIRECT  all  --  any    lo      anywhere            !localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2400&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner UID match istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner GID match istio-proxy	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3180&lt;/span&gt; ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_REDIRECT é“¾ï¼šå°†æ‰€æœ‰æµé‡é‡å®šå‘åˆ° Envoyï¼ˆå³æœ¬åœ°ï¼‰ çš„ 15001 ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_REDIRECT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3180&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; æ˜¾ç¤ºçš„é“¾çš„é¡ºåºï¼Œå³æµé‡è§„åˆ™åŒ¹é…çš„é¡ºåºã€‚å…¶ä¸­è¦ç‰¹åˆ«æ³¨æ„ &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾ä¸­çš„è§„åˆ™é…ç½®ã€‚ä¸ºäº†é¿å…æµé‡ä¸€ç›´åœ¨ Pod ä¸­æ— é™å¾ªç¯ï¼Œæ‰€æœ‰åˆ° istio-proxy ç”¨æˆ·ç©ºé—´çš„æµé‡éƒ½è¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ä¸­çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæœ¬ä¾‹ä¸­å³ OUTPUT é“¾ï¼Œå› ä¸ºè·³å‡º &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; è§„åˆ™ä¹‹åå°±è¿›å…¥ä¸‹ä¸€æ¡é“¾ &lt;code&gt;POSTROUTING&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾è§„åˆ™åŒ¹é…çš„è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç›®çš„åœ°é localhost å°±è·³è½¬åˆ° ISTIO_REDIRECT é“¾&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´çš„é localhost æµé‡è·³è½¬åˆ°å®ƒçš„è°ƒç”¨ç‚¹ &lt;code&gt;OUTPUT&lt;/code&gt; ç»§ç»­æ‰§è¡Œ &lt;code&gt;OUTPUT&lt;/code&gt; é“¾çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œå› ä¸º &lt;code&gt;OUTPUT&lt;/code&gt; é“¾ä¸­æ²¡æœ‰ä¸‹ä¸€æ¡è§„åˆ™äº†ï¼Œæ‰€ä»¥ä¼šç»§ç»­æ‰§è¡Œ &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾ç„¶åè·³å‡º iptablesï¼Œç›´æ¥è®¿é—®ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;å¦‚æœæµé‡ä¸æ˜¯æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´ï¼Œåˆæ˜¯å¯¹ localhost çš„è®¿é—®ï¼Œé‚£ä¹ˆå°±è·³å‡º iptablesï¼Œç›´æ¥è®¿é—®ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;å…¶å®ƒæ‰€æœ‰æƒ…å†µéƒ½è·³è½¬åˆ° &lt;code&gt;ISTIO_REDIRECT&lt;/code&gt; é“¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶å®åœ¨æœ€åè¿™æ¡è§„åˆ™å‰è¿˜å¯ä»¥å¢åŠ  IP åœ°å€è¿‡æ»¤ï¼Œè®©æŸäº› IP åœ°å€æ®µä¸é€šè¿‡ Envoy ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Š iptables è§„åˆ™éƒ½æ˜¯ Init å®¹å™¨å¯åŠ¨çš„æ—¶ä½¿ç”¨ &lt;a href=&#34;https://github.com/istio/istio/tree/master/tools/istio-iptables&#34; title=&#34;istio-iptables&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio-iptables&lt;/a&gt;
 å‘½ä»¤ç”Ÿæˆçš„ï¼Œè¯¦ç»†è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹è¯¥å‘½ä»¤è¡Œç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34; title=&#34;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ - jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ - jimmysong.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/kubectl/jsonpath/&#34; title=&#34;JSONPath Support - kubernetes.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSONPath Support - kubernetes.io&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; title=&#34;iptables å‘½ä»¤ä½¿ç”¨è¯´æ˜ - wangchujiang.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables å‘½ä»¤ä½¿ç”¨è¯´æ˜ - wangchujiang.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules&#34; title=&#34;How To List and Delete Iptables Firewall Rules - digitalocean.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How To List and Delete Iptables Firewall Rules - digitalocean.com&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/fhefh/archive/2011/04/04/2005249.html&#34; title=&#34;ä¸€å¥ä¸€å¥è§£è¯´ iptables çš„è¯¦ç»†ä¸­æ–‡æ‰‹å†Œ - cnblog.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€å¥ä¸€å¥è§£è¯´ iptables çš„è¯¦ç»†ä¸­æ–‡æ‰‹å†Œ - cnblog.com&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio Service Mesh æ•™ç¨‹</title>
      <link>https://jimmysong.io/blog/istio-tutorial/</link>
      <pubDate>Wed, 18 Apr 2018 23:20:47 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-tutorial/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡æ˜¯ Istio ç®¡ç† Java å¾®æœåŠ¡çš„æ¡ˆä¾‹æ•™ç¨‹ï¼Œä½¿ç”¨çš„æ‰€æœ‰å·¥å…·å’Œè½¯ä»¶å…¨éƒ¨åŸºäºå¼€æºæ–¹æ¡ˆï¼Œæ›¿æ¢äº† &lt;a href=&#34;https://github.com/redhat-developer-demos/istio-tutorial&#34; title=&#34;redhat-developer-demos/istio-tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redhat-developer-demos/istio-tutorial&lt;/a&gt;
 ä¸­çš„ minishift ç¯å¢ƒï¼Œä½¿ç”¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34; title=&#34;kubernetes-vagrant-centos-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt;
 æ›¿ä»£ï¼Œæ²¿ç”¨äº†åŸæœ‰çš„å¾®æœåŠ¡ç¤ºä¾‹ï¼Œä½¿ç”¨ Zipkin åšåˆ†å¸ƒå¼è¿½è¸ªè€Œä¸æ˜¯ Jaegerã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸­çš„ä»£ç å’Œ YAML æ–‡ä»¶è§ &lt;a href=&#34;https://github.com/rootsongjc/istio-tutorial&#34; title=&#34;https://github.com/rootsongjc/istio-tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/rootsongjc/istio-tutorial&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‡†å¤‡ç¯å¢ƒ&#34;&gt;å‡†å¤‡ç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿›è¡Œæœ¬æ•™ç¨‹å‰éœ€è¦å…ˆå‡†å¤‡ä»¥ä¸‹å·¥å…·å’Œç¯å¢ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;8G ä»¥ä¸Šå†…å­˜&lt;/li&gt;
&lt;li&gt;Vagrant 2.0+&lt;/li&gt;
&lt;li&gt;Virtualbox 5.0 +&lt;/li&gt;
&lt;li&gt;æå‰ä¸‹è½½ kubernetes1.9.1 çš„ release å‹ç¼©åŒ…&lt;/li&gt;
&lt;li&gt;docker 1.12+&lt;/li&gt;
&lt;li&gt;kubectl 1.9.1+&lt;/li&gt;
&lt;li&gt;maven 3.5.2+&lt;/li&gt;
&lt;li&gt;istioctl 0.7.1&lt;/li&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;curlã€gzipã€tar&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/johanhaleby/kubetail&#34; title=&#34;kubetail&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubetail&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/JoeDog/siege&#34; title=&#34;siege&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;siege&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®‰è£…-kubernetes&#34;&gt;å®‰è£… Kubernetes&lt;/h2&gt;
&lt;p&gt;è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34; title=&#34;kubernetes-vagrant-centos-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt;
 åœ¨æœ¬åœ°å¯åŠ¨æ‹¥æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; kubernetes-vagrant-centos-cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vagrant up
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34; title=&#34;kubernetes-vagrant-centos-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt;
 ä¸­çš„åŒ…å« Istio 0.7.1 çš„å®‰è£… YAML æ–‡ä»¶ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… Istioã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f addon/istio/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è¿è¡Œç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n default -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f yaml/istio-bookinfo/bookinfo.yaml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ‚¨è‡ªå·±çš„æœ¬åœ°ä¸»æœºçš„&lt;code&gt;/etc/hosts&lt;/code&gt;æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;172.17.8.102 grafana.istio.jimmysong.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;172.17.8.102 servicegraph.istio.jimmysong.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;172.17.8.102 zipkin.istio.jimmysong.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ URL åœ°å€è®¿é—®ä»¥ä¸Šçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Service&lt;/th&gt;
&lt;th&gt;URL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;grafana&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http://grafana.istio.jimmysong.io&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;servicegraph&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/code&gt;ï¼Œ&lt;code&gt;http://servicegraph.istio.jimmysong.io/graph&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zipkin&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http://zipkin.istio.jimmysong.io&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¯¦ç»†ä¿¡æ¯è¯·å‚é˜… &lt;a href=&#34;https://istio.io/latest/docs/examples/bookinfo/&#34; title=&#34;Istio æ–‡æ¡£&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨&#34;&gt;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨&lt;/h2&gt;
&lt;p&gt;åœ¨æ‰“åŒ…æˆé•œåƒéƒ¨ç½²åˆ° kubernetes é›†ç¾¤ä¸Šè¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨æœ¬åœ°è¿è¡Œæ‰€æœ‰ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ•™ç¨‹ä¸­ä¸‰ä¸ªæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;customer â†’ preference â†’ recommendation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;customer&lt;/code&gt; å’Œ &lt;code&gt;preference&lt;/code&gt; å¾®æœåŠ¡æ˜¯åŸºäº Spring Boot æ„å»ºçš„ï¼Œ&lt;code&gt;recommendation&lt;/code&gt; å¾®æœåŠ¡æ˜¯åŸºäº &lt;a href=&#34;https://vertx.io&#34; title=&#34;vert.x&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vert.x&lt;/a&gt;
 æ„å»ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;customer&lt;/code&gt; å’Œ &lt;code&gt;preference&lt;/code&gt; å¾®æœåŠ¡çš„ &lt;code&gt;pom.xml&lt;/code&gt; æ–‡ä»¶ä¸­éƒ½å¼•å…¥äº† OpenTracing å’Œ Jeager çš„ä¾èµ–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;io.opentracing.contrib&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;opentracing-spring-cloud-starter&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;0.1.7&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.uber.jaeger&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jaeger-tracerresolver&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;0.25.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æœ¬åœ°è¿è¡Œ&#34;&gt;æœ¬åœ°è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆåœ¨æœ¬åœ°ç¡®å®šæ‰€æœ‰çš„å¾®æœåŠ¡éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œç„¶åå†æ‰“åŒ…é•œåƒåœ¨ kubernetes é›†ç¾¤ä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨ Jaeger&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ docker æ¥è¿è¡Œ jaggerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker run -d &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --rm &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -p5775:5775/udp &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -p6831:6831/udp &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -p6832:6832/udp &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -p16686:16686 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -p14268:14268 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  jaegertracing/all-in-one:1.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Jaeger UI åœ°å€ &lt;code&gt;http://localhost:16686&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Customer&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; customer/java/springboot
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;JAEGER_SERVICE_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;customer mvn &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  spring-boot:run &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -Drun.arguments&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--spring.config.location=src/main/resources/application-local.properties&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡è®¿é—®åœ°å€ï¼š &lt;code&gt;http://localhost:8280&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Preference&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; preference/java/springboot
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;JAEGER_SERVICE_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;preference mvn &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  spring-boot:run &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -Drun.arguments&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--spring.config.location=src/main/resources/application-local.properties&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡è®¿é—®åœ°å€ï¼š&lt;code&gt;http://localhost:8180&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Recommendation&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; recommendation/java/vertx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn vertx:run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡è®¿é—®åœ°å€ï¼š&lt;code&gt;http://localhost:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰æœåŠ¡éƒ½å¯åŠ¨ä¹‹åï¼Œæ­¤æ—¶è®¿é—® &lt;code&gt;http://localhost:8280&lt;/code&gt; å°†ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;unknown&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯è®¿é—®ä¸€æ¬¡æœ€åçš„æ•°å­—å°±ä¼šåŠ  1ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Jaeger&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶è®¿é—® &lt;code&gt;http://localhost:16686&lt;/code&gt; å°†çœ‹åˆ° Jaeger query UIï¼Œæ‰€æœ‰åº”ç”¨å°† metrics å‘é€åˆ° Jeager ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨ Jaeger UI ä¸­æœç´¢ &lt;code&gt;customer&lt;/code&gt; å’Œ &lt;code&gt;preference&lt;/code&gt; service çš„ trace å¹¶æŸ¥çœ‹æ¯æ¬¡è¯·æ±‚çš„ tracingã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-tutorial/jaeger-query-ui.webp&#34; data-img=&#34;/blog/istio-tutorial/jaeger-query-ui.webp&#34; data-width=&#34;3242&#34; data-height=&#34;1896&#34; alt=&#34;image&#34; data-caption=&#34;Jaeger query UI&#34;&gt;
    
  
  &lt;figcaption&gt;Jaeger query UI&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æ„å»ºé•œåƒ&#34;&gt;æ„å»ºé•œåƒ&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬åœ°è¿è¡Œæµ‹è¯•æ— è¯¯ä¹‹åå°±å¯ä»¥æ„å»ºé•œåƒäº†ã€‚æœ¬æ•™ç¨‹ä¸­çš„å®¹å™¨é•œåƒéƒ½æ˜¯åœ¨ &lt;a href=&#34;https://hub.docker.com/r/fabric8/java-jboss-openjdk8-jdk/~/dockerfile/&#34; title=&#34;fabric8/java-jboss-openjdk8-jdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;fabric8/java-jboss-openjdk8-jdk&lt;/a&gt;
 çš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚åªè¦å°† Java åº”ç”¨æ„å»ºå‡º Jar åŒ…ç„¶åæ”¾åˆ° &lt;code&gt;/deployments&lt;/code&gt; ç›®å½•ä¸‹åŸºç¡€é•œåƒå°±å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ç€å‡ ä¸ªåº”ç”¨çš„ &lt;code&gt;Dockerfile&lt;/code&gt; æ–‡ä»¶ä¸­éƒ½æ²¡æœ‰æ‰§è¡Œå…¥å£ï¼ŒçœŸæ­£çš„æ‰§è¡Œå…¥å£æ˜¯ &lt;a href=&#34;https://github.com/fabric8io-images/java/blob/master/images/jboss/openjdk8/jdk/run-java.sh&#34; title=&#34;run-java.sh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;run-java.sh&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Customer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»º Customer é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; customer/java/springboot
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-customer:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-customer:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ä¸€æ¬¡æ„å»ºå’Œä¸Šä¼ éœ€è¦èŠ±è´¹ä¸€ç‚¹æ—¶é—´ï¼Œä¸‹ä¸€æ¬¡æ„å»ºå°±ä¼šå¾ˆå¿«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Preference&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»º Preference é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; preference/java/springboot
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-preference:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-preference:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Recommendation&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»º Recommendation é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; recommendation/java/vertx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-recommendation:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-recommendation:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ä¸‰ä¸ª docker é•œåƒéƒ½æ„å»ºå®Œæˆäº†ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker images &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jimmysong/istio-tutorial-recommendation   v1                  d31dd858c300        &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; seconds ago      443MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jimmysong/istio-tutorial-preference       v1                  e5f0be361477        &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; minutes ago       459MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jimmysong/istio-tutorial-customer         v1                  d9601692673e        &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; minutes ago      459MB
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²åˆ°-kubernetes&#34;&gt;éƒ¨ç½²åˆ° Kubernetes&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†ä»¥ä¸ŠæœåŠ¡éƒ¨ç½²åˆ° kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# create new namespace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create ns istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy recommendation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f recommendation/kubernetes/Deployment.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f recommendation/kubernetes/Service.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy preferrence&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f preference/kubernetes/Deployment.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f preference/kubernetes/Service.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy customer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f customer/kubernetes/Deployment.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f customer/kubernetes/Service.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt;&lt;code&gt;preference&lt;/code&gt; å’Œ &lt;code&gt;customer&lt;/code&gt; åº”ç”¨å¯åŠ¨é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæˆ‘ä»¬å°† livenessProb é…ç½®ä¸­çš„ &lt;code&gt;initialDelaySeconds&lt;/code&gt; è®¾ç½®ä¸º &lt;strong&gt;20&lt;/strong&gt; ç§’ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ Pod å¯åŠ¨çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pod -w -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¢åŠ -ingress-é…ç½®&#34;&gt;å¢åŠ  Ingress é…ç½®&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†åœ¨ kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—® customer æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ  ingress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f ingress/ingress.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹æœ¬åœ°çš„ &lt;code&gt;/etc/hosts&lt;/code&gt; æ–‡ä»¶ï¼Œå¢åŠ ä¸€æ¡é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;172.17.8.102 customer.istio-tutorial.jimmysong.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨è®¿é—® &lt;code&gt;http://customer.istio-tutorial.jimmysong.io&lt;/code&gt; å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;gt; preference =&amp;gt; recommendation v1 from &amp;#39;6fc97476f8-m2ntp&amp;#39;: 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰¹é‡è®¿é—®è¯¥åœ°å€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—® &lt;code&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/code&gt; æŸ¥çœ‹æœåŠ¡çš„åˆ†å¸ƒå¼è¿½è¸ªå’Œä¾èµ–å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-tutorial/istio-tutorial-zipkin-trace.webp&#34; data-img=&#34;/blog/istio-tutorial/istio-tutorial-zipkin-trace.webp&#34; data-width=&#34;1990&#34; data-height=&#34;1300&#34; alt=&#34;image&#34; data-caption=&#34;åˆ†å¸ƒå¼è¿½è¸ª&#34;&gt;
    
  
  &lt;figcaption&gt;åˆ†å¸ƒå¼è¿½è¸ª&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-tutorial/istio-tutorial-zipkin-dependency.webp&#34; data-img=&#34;/blog/istio-tutorial/istio-tutorial-zipkin-dependency.webp&#34; data-width=&#34;2056&#34; data-height=&#34;724&#34; alt=&#34;image&#34; data-caption=&#34;ä¾èµ–å…³ç³»&#34;&gt;
    
  
  &lt;figcaption&gt;ä¾èµ–å…³ç³»&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®¿é—® &lt;code&gt;http://servicegraph.istio.jimmysong.io/dotviz&lt;/code&gt; æŸ¥çœ‹æœåŠ¡é—´çš„å…³ç³»å›¾å’Œ QPSã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-tutorial/istio-tutorial-serivcegraph-dotviz.webp&#34; data-img=&#34;/blog/istio-tutorial/istio-tutorial-serivcegraph-dotviz.webp&#34; data-width=&#34;2876&#34; data-height=&#34;1140&#34; alt=&#34;image&#34; data-caption=&#34;æœåŠ¡å…³ç³»å›¾å’Œ QPS&#34;&gt;
    
  
  &lt;figcaption&gt;æœåŠ¡å…³ç³»å›¾å’Œ QPS&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®¿é—® &lt;code&gt;http://grafana.istio.jimmysong.io&lt;/code&gt; æŸ¥çœ‹ Service Mesh çš„ç›‘æ§ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
  
    
    &lt;img src=&#34;https://jimmysong.io/blog/istio-tutorial/istio-tutorial-grafana.webp&#34; data-img=&#34;/blog/istio-tutorial/istio-tutorial-grafana.webp&#34; data-width=&#34;3206&#34; data-height=&#34;1884&#34; alt=&#34;image&#34; data-caption=&#34;Grafana ç›‘æ§&#34;&gt;
    
  
  &lt;figcaption&gt;Grafana ç›‘æ§&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;istio-ä½¿ç”¨ç¤ºä¾‹&#34;&gt;Istio ä½¿ç”¨ç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è¯•ç”¨ Istio ä¸­çš„å„ç§åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºåº”ç”¨æ„å»ºå¤šä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸º recommendation æ„å»º v2 ç‰ˆæœ¬çš„é•œåƒï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Istio æ§åˆ¶å¾®æœåŠ¡çš„æµé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ„å»º-recommendationv2&#34;&gt;æ„å»º recommendation:v2&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†æ„å»ºæ–°ç‰ˆçš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡çš„é•œåƒï¼Œå¹¶è§‚å¯Ÿ &lt;code&gt;customer&lt;/code&gt; å¯¹ä¸åŒç‰ˆæœ¬çš„ &lt;code&gt;recommendataion&lt;/code&gt; æœåŠ¡çš„è®¿é—®é¢‘ç‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹ &lt;code&gt;recommendation/java/vertx/src/main/java/com/redhat/developer/demos/recommendation/RecommendationVerticle.java&lt;/code&gt; ç¨‹åºä¸­ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å°† &lt;code&gt;private static final String RESPONSE_STRING_FORMAT = &amp;quot;recommendation v1 from &#39;%s&#39;: %d\n&amp;quot;;&lt;/code&gt; ä¿®æ”¹ä¸º &lt;code&gt;private static final String RESPONSE_STRING_FORMAT = &amp;quot;recommendation v2 from &#39;%s&#39;: %d\n&amp;quot;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¹¶æ„å»º &lt;code&gt;recommendation:v2&lt;/code&gt; é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; recommendation/java/vertx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-recommendation:v2 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-recommendation:v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†åº”ç”¨éƒ¨ç½²åˆ° kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy recommendation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f recommendation/kubernetes/Deployment-v2.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ï¼Œå°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3581&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3582&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3583&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ° v1 å’Œ v2 ç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡ä¼šè¢«é—´éš”è®¿é—®åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†å°† v2 ç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; å®ä¾‹æ•°è®¾ç½®æˆ 2 ä¸ªã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; deployment/recommendation-v2 -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pod -w -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿ &lt;code&gt;recommendation-v2&lt;/code&gt; Pod è¾¾åˆ°ä¸¤ä¸ªä¹‹åå†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-j9fgj&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;71&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3651&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-j9fgj&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;72&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3652&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-j9fgj&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;73&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3653&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿè¾“å‡ºä¸­ v1 å’Œ v2 ç‰ˆæœ¬ &lt;code&gt;recommendation&lt;/code&gt; çš„è®¿é—®é¢‘ç‡ã€‚&lt;/p&gt;
&lt;p&gt;å°† &lt;code&gt;recommendataion&lt;/code&gt; æœåŠ¡çš„å®ä¾‹æ•°æ¢å¤ä¸º 1ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; deployment/recommendation-v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¿®æ”¹-istio-routerules&#34;&gt;ä¿®æ”¹ Istio RouteRules&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ‰€æœ‰è·¯æœ‰è§„åˆ™éƒ½æ˜¯é’ˆå¯¹ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡ï¼Œå¹¶åœ¨ repo çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°†æ‰€æœ‰æµé‡æ‰“ç»™ v2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°†æ¼”ç¤ºå¦‚ä½•åŠ¨æ€çš„åˆ’åˆ†ä¸åŒç‰ˆæœ¬æœåŠ¡é—´çš„æµé‡ï¼Œå°†æ‰€æœ‰çš„æµé‡éƒ½æ‰“åˆ° &lt;code&gt;recommendation:v2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°†çœ‹åˆ°æ‰€æœ‰çš„æµé‡éƒ½ä¼šæ‰“åˆ° &lt;code&gt;recommendation:v2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤ RouteRules åå†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°†çœ‹åˆ°åˆæ¢å¤äº† v1 å’Œ v2 ç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡çš„é—´éš”è®¿é—®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åˆ‡åˆ†æµé‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å°† 90% çš„æµé‡ç»™ v1ï¼Œ10% çš„æµé‡ç»™ v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1_and_v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ&lt;code&gt;bin/poll_customer.sh&lt;/code&gt; è§‚å¯Ÿè®¿é—®æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³åŠ¨æ€åˆ‡åˆ†æµé‡åªè¦ä¿®æ”¹ RouteRules ä¸­çš„ &lt;code&gt;weight&lt;/code&gt; é…ç½®å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;config.istio.io/v1alpha2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RouteRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation-v1-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;precedence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;90&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸º RouteRule æœ‰ä¼˜å…ˆçº§ï¼Œä¸ºäº†ç»§ç»­åé¢çš„å®éªŒï¼Œåœ¨éªŒè¯å®Œæˆååˆ é™¤è¯¥ RouteRuleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-v1-v2 -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ•…éšœæ³¨å…¥&#34;&gt;æ•…éšœæ³¨å…¥&lt;/h3&gt;
&lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†å¢å¼ºç³»ç»Ÿçš„å¥å£®æ€§ï¼Œéœ€è¦å¯¹ç³»ç»Ÿåšæ··æ²Œå·¥ç¨‹ï¼Œæ•…æ„æ³¨å…¥æ•…éšœï¼Œå¹¶ä¿éšœæœåŠ¡å¯ä»¥è‡ªåŠ¨å¤„ç†è¿™äº›æ•…éšœã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å…¥ HTTP 503 é”™è¯¯&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-503.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ 50% çš„å‡ ç‡æŠ¥ 503 é”™è¯¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;135&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3860&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;136&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;3861&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;77b9f6cc68-5xs27&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;137&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; fault filter abort
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…ç† RouteRuleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-503 -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¢åŠ å»¶è¿Ÿ&#34;&gt;å¢åŠ å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;å¢åŠ æœåŠ¡çš„è®¿é—®å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-delay.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼šæœ‰ 50% çš„å‡ ç‡è®¿é—® &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡æœ‰ 7 ç§’çš„å»¶è¿Ÿã€‚ç™¾åˆ†æ¯”å’Œå»¶è¿Ÿæ—¶é—´å¯ä»¥åœ¨ RouteRule ä¸­é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç† RouteRuleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-delay -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é‡è¯•&#34;&gt;é‡è¯•&lt;/h3&gt;
&lt;p&gt;è®©æœåŠ¡ä¸æ˜¯ç›´æ¥å¤±è´¥ï¼Œè€Œæ˜¯å¢åŠ é‡è¯•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸‹é¢å°†åŒæ—¶åº”ç”¨ä¸¤æ¡ RouteRuleï¼Œè®©è®¿é—® &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡æ—¶æœ‰ 50% çš„å‡ ç‡å‡ºç° 503 é”™è¯¯ï¼Œå¹¶åœ¨å‡ºç°é”™è¯¯çš„æ—¶å€™å°è¯•è®¿é—® v2 ç‰ˆæœ¬ï¼Œè¶…æ—¶æ—¶é—´ä¸º 2 ç§’ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v2_503.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v2_retry.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ &lt;code&gt;bin/poll_customer.sh&lt;/code&gt; æˆ‘ä»¬çœ‹åˆ°ä¸€å¼€å§‹æœ‰äº› 503 é”™è¯¯ï¼Œç„¶åæ‰€æœ‰çš„æµé‡éƒ½æµå‘äº† v2ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç† RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-v2-retry -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-v2-503 -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è¶…æ—¶&#34;&gt;è¶…æ—¶&lt;/h3&gt;
&lt;p&gt;è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåªæœ‰æœåŠ¡è®¿é—®è¶…æ—¶æ‰è®¤å®šæœåŠ¡è®¿é—®å¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;å–æ¶ˆæ³¨é‡Š &lt;code&gt;recommendation/java/vertx/src/main/java/com/redhat/developer/demos/recommendation/RecommendationVerticle.java&lt;/code&gt; ä¸­çš„ä¸‹é¢ä¸€è¡Œï¼Œå¢åŠ è¶…æ—¶æ—¶é—´ä¸º 3 ç§’ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;router&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°ç”Ÿæˆé•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; recommendation/java/vertx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-recommendation:v2 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-recommendation:v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°éƒ¨ç½²åˆ° kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f recommendation/kubernetes/Deployment-v2.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬é‡æ–°æ„å»ºçš„é•œåƒä½¿ç”¨äº†åŒæ ·çš„åå­—å’Œ tagï¼Œè€Œä¹‹å‰åœ¨ &lt;code&gt;Deployment-v2.yml&lt;/code&gt; ä¸­é…ç½®çš„é•œåƒæ‹‰å–ç­–ç•¥æ˜¯ &lt;code&gt;IfNotPresent&lt;/code&gt;ï¼Œè¿™æ ·çš„è¯å³ä½¿æˆ‘ä»¬æ„å»ºäº†æ–°çš„é•œåƒä¹Ÿæ— æ³•åº”ç”¨åˆ°é›†ç¾¤ä¸Šï¼Œå› æ­¤å°†é•œåƒæ‹‰å–ç­–ç•¥æ”¹æˆ &lt;code&gt;Always&lt;/code&gt; ç¡®ä¿æ¯æ¬¡å¯åŠ¨ Pod çš„æ—¶å€™éƒ½ä¼šæ‹‰å–é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f recommendation/kubernetes/Deployment-v2.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ç”¨è¶…æ—¶ RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-timeout.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;504&lt;/span&gt; upstream request timeout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;4002&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;504&lt;/span&gt; upstream request timeout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;4003&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;504&lt;/span&gt; upstream request timeout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;4004&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…ç† RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-timeout -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åŸºäº-user-agent-çš„æ™ºèƒ½è·¯ç”±é‡‘ä¸é›€å‘å¸ƒ&#34;&gt;åŸºäº user-agent çš„æ™ºèƒ½è·¯ç”±ï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰&lt;/h3&gt;
&lt;p&gt;User-agent æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«äº†æµè§ˆå™¨çš„ä¿¡æ¯ï¼Œè®¿é—® &lt;a href=&#34;https://www.whoishostingthis.com/tools/user-agent&#34; title=&#34;https://www.whoishostingthis.com/tools/user-agent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.whoishostingthis.com/tools/user-agent&lt;/a&gt;
 è·å–ä½ çš„ user-agentã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„ user-agent æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†æ‰€æœ‰çš„æµé‡æ‰“åˆ° v1ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ä½¿ç”¨ Safari æµè§ˆå™¨è®¿é—®çš„æµé‡æ‰“åˆ° v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-safari-recommendation-v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ç”¨ Safari æˆ–è€… Chromeï¼ˆChrome æµè§ˆå™¨çš„ user-agent ä¸­ä¹ŸåŒ…å« Safari å­—æ®µï¼‰è®¿é—® &lt;code&gt;http://customer.istio-tutorial.jimmysong.io/&lt;/code&gt; åœ¨ç»è¿‡ 3 ç§’é’Ÿï¼ˆæˆ‘ä»¬åœ¨å‰é¢é‡æ–°ç¼–è¯‘ v2 é•œåƒï¼Œè®¾ç½®äº† 3 ç§’è¶…æ—¶æ—¶é—´ï¼‰åå°†çœ‹åˆ°è®¿é—® v2 çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è€…ä½¿ç”¨ curl è®¿é—®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -A Safari http://customer.istio-tutorial.jimmysong.io/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -A Firefox http://customer.istio-tutorial.jimmysong.io/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿè¿”å›çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;å°†ç§»åŠ¨ç«¯ç”¨æˆ·çš„æµé‡å¯¼åˆ° v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-mobile-recommendation-v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -A &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4(KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5&amp;#34;&lt;/span&gt; http://customer.istio-tutorial.jimmysong.io/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿè¾“å‡ºçš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç† RouteRulesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-mobile -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-safari -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-default -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é•œåƒæµé‡&#34;&gt;é•œåƒæµé‡&lt;/h3&gt;
&lt;p&gt;ç¡®ä¿å½“å‰è‡³å°‘è¿è¡Œäº†ä¸¤ä¸ªç‰ˆæœ¬çš„ &lt;code&gt;recommendation&lt;/code&gt; æœåŠ¡ï¼Œå¹¶ä¸”æ²¡æœ‰ RouteRuleã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šå¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl get routerule&lt;/code&gt; è·å– RouteRuleã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®æµé‡é•œåƒï¼Œå°†æ‰€æœ‰ v1 çš„æµé‡éƒ½è¢«é•œåƒåˆ° v2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1-mirror-v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ recommendation-v2 çš„æ—¥å¿—ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -f &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;oc get pods&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep recommendation-v2&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;{ print $1 }&amp;#39;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; -c recommendation
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è®¿é—®æ§åˆ¶&#34;&gt;è®¿é—®æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;Istio å¯ä»¥è®¾ç½®æœåŠ¡è®¿é—®çš„é»‘ç™½åå•ï¼Œå¦‚æœæ²¡æœ‰æƒé™çš„è¯ä¼šè¿”å› HTTP 404 Not Foundã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç™½åå•&#34;&gt;ç™½åå•&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/acl-whitelist.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;404&lt;/span&gt; NOT_FOUND:preferencewhitelist.listchecker.istio-tutorial:customer is not whitelisted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡ç½®ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete -f istiofiles/acl-whitelist.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;é»‘åå•&#34;&gt;é»‘åå•&lt;/h4&gt;
&lt;p&gt;è®¾ç½®é»‘åå•ï¼Œæ‰€æœ‰ä½äºé»‘åå•ä¸­çš„æµé‡å°†è·å¾— 403 Forbidden è¿”å›ç ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/acl-blacklist.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; PERMISSION_DENIED:denycustomerhandler.denier.istio-tutorial:Not allowed
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡ç½®ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete -f istiofiles/acl-blacklist.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è´Ÿè½½å‡è¡¡&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯ round-robinï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Istio æŠŠå®ƒä¿®æ”¹æˆ randomã€‚&lt;/p&gt;
&lt;p&gt;å¢åŠ  v1 çš„å®ä¾‹æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale deployment recommendation-v1 --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŒç»­è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿æŒå‰å°è¾“å‡ºï¼Œè§‚å¯Ÿæµé‡çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/recommendation_lb_policy_app.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿä¸€æ®µæ—¶é—´æµé‡çš„è¡Œä¸ºåï¼Œé‡ç½®ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete -f istiofiles/recommendation_lb_policy_app.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale deployment recommendation-v1 --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€Ÿç‡é™åˆ¶&#34;&gt;é€Ÿç‡é™åˆ¶&lt;/h3&gt;
&lt;p&gt;æš‚æ—¶ä¸å¯ç”¨&lt;/p&gt;
&lt;h3 id=&#34;æ–­è·¯å™¨&#34;&gt;æ–­è·¯å™¨&lt;/h3&gt;
&lt;p&gt;å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•°å’Œæœ€å¤§æŒ‚èµ·è¯·æ±‚æ•°æ—¶å¿«é€Ÿå¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;å°†æµé‡åœ¨ v1 å’Œ v2 ä¹‹é—´å‡åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1_and_v2_50_50.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœªå¼€å¯æ–­è·¯å™¨çš„æ—¶å€™å¯åŠ¨è´Ÿè½½æµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ siege -r &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -c &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; -v customer.istio-tutorial.jimmysong.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;New configuration template added to /Users/jimmysong/.siege
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Run siege -C to view the current settings in that file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;** SIEGE 4.0.4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;** Preparing &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; concurrent users &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; battle.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The server is now under siege...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.10 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.12 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.13 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.13 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.13 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.17 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.12 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.14 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.15 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.15 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.17 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.17 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.20 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.20 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.05 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.12 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.15 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.25 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.26 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.14 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.58 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     6.15 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     6.16 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.03 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     6.06 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     6.04 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.11 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.09 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     6.15 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     6.71 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     3.52 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;^C
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Lifting the server siege...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Transactions:		          &lt;span class=&#34;m&#34;&gt;31&lt;/span&gt; hits
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Availability:		      100.00 %
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Elapsed time:		        7.99 secs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Data transferred:	        0.00 MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Response time:		        2.99 secs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Transaction rate:	        3.88 trans/sec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Throughput:		        0.00 MB/sec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Concurrency:		       11.60
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successful transactions:          &lt;span class=&#34;m&#34;&gt;31&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Failed transactions:	           &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Longest transaction:	        6.71
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Shortest transaction:	        0.05
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰çš„è¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ï¼Œå› ä¸º v2 ç‰ˆæœ¬è®¾ç½®äº† 3 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ç”¨ä¸‹æ–­è·¯å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/recommendation_cb_policy_version_v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°æµ‹è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ siege -r &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -c &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; -v customer.istio-tutorial.jimmysong.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;** SIEGE 4.0.4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;** Preparing &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; concurrent users &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; battle.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The server is now under siege...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.07 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.07 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.07 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.12 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.12 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.16 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.16 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.21 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.21 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.24 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.24 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.14 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.29 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.13 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.18 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.13 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.11 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.39 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.24 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.44 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.43 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.44 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.40 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.47 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.42 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.42 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.06 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.07 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.15 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.12 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.57 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.18 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.52 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.65 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.42 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.09 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.43 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;     0.04 secs:      &lt;span class=&#34;m&#34;&gt;92&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     4.15 secs:      &lt;span class=&#34;m&#34;&gt;74&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     0.01 secs:      &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; GET  /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Transactions:		          &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; hits
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Availability:		       47.50 %
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Elapsed time:		        4.16 secs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Data transferred:	        0.00 MB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Response time:		        0.72 secs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Transaction rate:	        4.57 trans/sec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Throughput:		        0.00 MB/sec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Concurrency:		        3.31
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successful transactions:          &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Failed transactions:	          &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Longest transaction:	        4.15
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Shortest transaction:	        0.01
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å¯ç”¨äº†æ–­è·¯å™¨åå„é¡¹æ€§èƒ½éƒ½æœ‰æé«˜ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-v1-v2 -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete -f istiofiles/recommendation_cb_policy_version_v2.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;pool-ejection&#34;&gt;Pool Ejection&lt;/h3&gt;
&lt;p&gt;æ‰€è°“çš„ Pool Ejection å°±æ˜¯å½“æŸäº›å®ä¾‹å‡ºç°é”™è¯¯ï¼ˆå¦‚è¿”å› 5xx é”™è¯¯ç ï¼‰ä¸´æ—¶å°†è¯¥å®ä¾‹å¼¹å‡ºä¸€æ®µæ—¶é—´åï¼ˆçª—å£æœŸï¼Œå¯é…ç½®ï¼‰ï¼Œç„¶åå†å°†å…¶åŠ å…¥åˆ°è´Ÿè½½å‡è¡¡æ± ä¸­ã€‚æˆ‘ä»¬çš„ä¾‹å­ä¸­é…ç½®çš„çª—å£æœŸæ˜¯ 15 ç§’ã€‚&lt;/p&gt;
&lt;p&gt;å°† v1 å’Œ v2 çš„æµé‡å‡åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/route-rule-recommendation-v1_and_v2_50_50.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  v2 çš„å®ä¾‹ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale deployment recommendation-v2 --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods -w
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç­‰å¾…æ‰€æœ‰çš„ Pod çš„çŠ¶æ€éƒ½å¯åŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨åˆ° v2 çš„å®¹å™¨ä¸­æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; recommendation-v2-785465d9cd-225ms -c recommendation /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl localhost:8080/misbehave
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Following requests to &lt;span class=&#34;s1&#34;&gt;&amp;#39;/&amp;#39;&lt;/span&gt; will &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; a &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  Pool Ejection é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/recommendation_cb_policy_pool_ejection.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bin/poll_customer.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;10505&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2407&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;10506&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2408&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;10507&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;10508&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v1 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;6fc97476f8-m2ntp&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;10509&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; recommendation misbehavior from &lt;span class=&#34;s1&#34;&gt;&amp;#39;785465d9cd-ldc6j&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2409&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;customer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;preference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; recommendation v2 from &lt;span class=&#34;s1&#34;&gt;&amp;#39;785465d9cd-225ms&amp;#39;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2410&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°çª—å£æœŸç”Ÿæ•ˆäº†ï¼Œå½“å‡ºç° 503 é”™è¯¯åè‡³å°‘ 15 ç§’åæ‰ä¼šå‡ºç°ç¬¬äºŒæ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;å³ä½¿æœ‰äº†è´Ÿè½½å‡è¡¡æ± å¼¹å‡ºç­–ç•¥å¯¹äºç³»ç»Ÿçš„å¼¹æ€§æ¥è¯´ä¾ç„¶è¿˜ä¸å¤Ÿï¼Œå¦‚æœä½ çš„æœåŠ¡æœ‰å¤šä¸ªå¯ç”¨å®ä¾‹ï¼Œå¯ä»¥å°†&lt;strong&gt;æ–­è·¯å™¨&lt;/strong&gt;ã€&lt;strong&gt;é‡è¯•&lt;/strong&gt;ã€&lt;strong&gt;Pool Ejection&lt;/strong&gt; ç­‰ç­–ç•¥ç»„åˆèµ·æ¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚åœ¨ä»¥ä¸Šçš„ Pool Ejection çš„åŸºç¡€ä¸Šå¢åŠ é‡è¯•ç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl replace -f istiofiles/route-rule-recommendation-v1_and_v2_retry.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å†è®¿é—® &lt;code&gt;customer&lt;/code&gt; æœåŠ¡å°±çœ‹ä¸åˆ° 503 é”™è¯¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¸…ç†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale deployment recommendation-v2 --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete routerule recommendation-v1-v2 -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete -f istiofiles/recommendation_cb_policy_pool_ejection.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;egress&#34;&gt;Egress&lt;/h3&gt;
&lt;p&gt;Egress æ˜¯ç”¨æ¥é…ç½® Istio serivce mesh ä¸­çš„æœåŠ¡å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://istio.doczh.cn/docs/tasks/traffic-management/egress.html&#34; title=&#34;æ§åˆ¶ Egress æµé‡&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ§åˆ¶ Egress æµé‡&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ç¤ºä¾‹è¿˜æœ‰é—®é¢˜ï¼Œæ— æ³•æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºç¤ºä¾‹é•œåƒ egresshttpbinã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; egress/egresshttpbin/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-egresshttpbin:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-egresshttpbin:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²åˆ° Kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f egress/egresshttpbin/src/main/kubernetes/Deployment.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-toturial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create -f egress/egresshttpbin/src/main/kubernetes/Service.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†åœ¨ kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—®åˆ°è¯¥æœåŠ¡ï¼Œä¿®æ”¹å¢åŠ  ingress é…ç½®å¹¶ä¿®æ”¹æœ¬åœ°çš„&lt;code&gt;/etc/hosts&lt;/code&gt; æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å‰é¢å·²ç»å®Œæˆäº†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºç¤ºä¾‹é•œåƒ egressgithubã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; egress/egressgithub
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn clean package
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t jimmysong/istio-tutorial-egressgithub:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push jimmysong/istio-tutorial-egressgithub:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²åˆ° Kubernetesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f egress/egressgithub/src/main/kubernetes/Deployment.yml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create -f egress/egressgithub/src/main/kubernetes/Service.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  Egress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/egress_httpbin.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ° egresshttpbin å®¹å™¨ä¸­æµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;oc get pods -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[*].metadata.name}&amp;#34;&lt;/span&gt; -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;egresshttpbin,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -c egresshttpbin /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl localhost:8080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl httpbin.org/user-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl httpbin.org/headers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ å¯¹ &lt;a href=&#34;https://jimmysong.io&#34; title=&#34;jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;jimmysong.io&lt;/a&gt;
 çš„ egress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | istioctl create -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: config.istio.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: EgressRule
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: jimmysong-egress-rule
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  destination:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    service: jimmysong.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  ports:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - port: 443
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      protocol: https
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ  Egress é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl create -f istiofiles/egress_github.yml -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ° egressgithub å®¹å™¨ä¸­æµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;oc get pods -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[*].metadata.name}&amp;#34;&lt;/span&gt; -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;egressgithub,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -c egressgithub /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://jimmysong:443
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…ç†ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl delete egressrule httpbin-egress-rule jimmysong-egress-rule github-egress-rule -n istio-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/redhat-developer-demos/istio-tutorial&#34; title=&#34;https://github.com/redhat-developer-demos/istio-tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/redhat-developer-demos/istio-tutorial&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developers.redhat.com/books/introducing-istio-service-mesh-microservices/&#34; title=&#34;Book - Introducing Istio Service Mesh for Microservices&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Book - Introducing Istio Service Mesh for Microservices&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Istio ç¤¾åŒºä»‹ç»ä¸ç¤¾åŒºå‚ä¸æ³¨æ„äº‹é¡¹</title>
      <link>https://jimmysong.io/blog/istio-community-tips/</link>
      <pubDate>Sat, 14 Apr 2018 18:34:40 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/istio-community-tips/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡è®²è¿°äº†å‚ä¸ Istio ç¤¾åŒºå’Œè¿›è¡Œ Istio å¼€å‘æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œç»„&#34;&gt;å·¥ä½œç»„&lt;/h3&gt;
&lt;p&gt;ç»å¤§å¤šæ•°å¤æ‚çš„å¼€æºé¡¹ç›®éƒ½æ˜¯ä»¥å·¥ä½œç»„çš„æ–¹å¼ç»„ç»‡çš„ï¼Œè¦æƒ³ä¸º Istio ç¤¾åŒºåšè´¡çŒ®å¯ä»¥åŠ å…¥åˆ°ä»¥ä¸‹çš„å·¥ä½œç»„ï¼ˆWorking Groupï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#api-management&#34; title=&#34;API Management&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;API Management&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#config&#34; title=&#34;Config&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Config&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#environments&#34; title=&#34;Environments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Environments&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#networking&#34; title=&#34;Networking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Networking&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#performance-and-scalability&#34; title=&#34;Performance &amp;amp;amp; Scalability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Performance &amp;amp; Scalability&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#policies-and-telemetry&#34; title=&#34;Policies &amp;amp;amp; Telemetry&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Policies &amp;amp; Telemetry&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#security&#34; title=&#34;Security&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Security&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md#test-and-release&#34; title=&#34;Test &amp;amp;amp; Release&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Test &amp;amp; Release&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä»£ç è§„èŒƒ&#34;&gt;ä»£ç è§„èŒƒ&lt;/h3&gt;
&lt;p&gt;Istio çš„ä»£ç è§„èŒƒæ²¿ç”¨ &lt;a href=&#34;https://github.com/cncf/foundation/blob/master/code-of-conduct.md&#34; title=&#34;CNCF ç¤¾åŒºçš„ä»£ç è§„èŒƒ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF ç¤¾åŒºçš„ä»£ç è§„èŒƒ&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€å‘æŒ‡å—&#34;&gt;å¼€å‘æŒ‡å—&lt;/h3&gt;
&lt;p&gt;è¿›è¡Œ Istio å¼€å‘ä¹‹å‰éœ€è¦åšä¸‹é¢å‡ ä»¶äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®åŸºç¡€ç¯å¢ƒï¼Œå¦‚ Kubernetes&lt;/li&gt;
&lt;li&gt;é…ç½®ä»£ç åº“ã€ä¸‹è½½ä¾èµ–å’Œæµ‹è¯•&lt;/li&gt;
&lt;li&gt;é…ç½® CircleCI é›†æˆç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;ç¼–å†™å‚è€ƒæ–‡æ¡£&lt;/li&gt;
&lt;li&gt;Git workflow é…ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦è§ &lt;a href=&#34;https://github.com/istio/istio/wiki/Dev-Guide&#34; title=&#34;Dev Guide wiki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dev Guide wiki&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¾è®¡æ–‡æ¡£&#34;&gt;è®¾è®¡æ–‡æ¡£&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰çš„è®¾è®¡æ–‡æ¡£éƒ½ä¿å­˜åœ¨ &lt;a href=&#34;https://drive.google.com/drive/u/0/folders/0AIS5p3eW9BCtUk9PVA&#34; title=&#34;Google Drive&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Drive&lt;/a&gt;
 ä¸­ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Technical Oversight Committeeï¼šToC ç®¡ç†çš„æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;Miscï¼šä¸€äº›æ‚é¡¹&lt;/li&gt;
&lt;li&gt;Working Groupsï¼šæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå„ä¸ªå·¥ä½œç»„ç›¸å…³çš„è®¾è®¡æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;Presentationsï¼šIstio ç›¸å…³çš„æ¼”è®²å¹»ç¯ç‰‡ï¼Œä»è¿™äº›æ–‡ç¨¿ä¸­å¯ä»¥å¿«é€Ÿäº†è§£ Istio&lt;/li&gt;
&lt;li&gt;Logoï¼šIstio logo&lt;/li&gt;
&lt;li&gt;Engï¼šç¤¾åŒºç›¸å…³çš„ç»´æŠ¤æ–‡æ¡£&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤¾åŒºè§’è‰²åˆ’åˆ†&#34;&gt;ç¤¾åŒºè§’è‰²åˆ’åˆ†&lt;/h3&gt;
&lt;p&gt;æ ¹æ®å¯¹å¼€å‘è€…å’Œè¦æ±‚å’Œè´¡çŒ®ç¨‹åº¦çš„ä¸åŒï¼ŒIstio ç¤¾åŒºä¸­åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#collaborator&#34; title=&#34;Collaborator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Collaborator&lt;/a&gt;
ï¼šéæ­£å¼è´¡çŒ®è€…ï¼Œå¶å°”è´¡çŒ®ï¼Œä»»ä½•äººéƒ½å¯ä»¥æˆä¸ºè¯¥è§’è‰²&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#member&#34; title=&#34;Member&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Member&lt;/a&gt;
ï¼šæ­£å¼è´¡çŒ®è€…ï¼Œç»å¸¸è´¡çŒ®ï¼Œå¿…é¡»æœ‰ 2 ä¸ªå·²æœ‰çš„ member æå&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#approver&#34; title=&#34;Approver&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Approver&lt;/a&gt;
ï¼šè€æ‰‹ï¼Œå¯ä»¥æ‰¹å‡† member çš„è´¡çŒ®&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#lead&#34; title=&#34;Lead&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Lead&lt;/a&gt;
ï¼šç®¡ç†åŠŸèƒ½ã€é¡¹ç›®å’Œæè®®ï¼Œå¿…é¡»ç”± &lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUP-PROCESSES.md&#34; title=&#34;ToC&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ToC&lt;/a&gt;
 æå&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#administrator&#34; title=&#34;Administrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Administrator&lt;/a&gt;
ï¼šç®¡ç†å‘˜ï¼Œç®¡ç†å’Œæ§åˆ¶æƒé™ï¼Œå¿…é¡»ç”± ToC æå&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md#vendor&#34; title=&#34;Vendor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vendor&lt;/a&gt;
ï¼šè´¡çŒ® Istio é¡¹ç›®çš„æ‰©å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦è§ &lt;a href=&#34;https://github.com/istio/community/blob/master/ROLES.md&#34; title=&#34;Istio Community Roles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Community Roles&lt;/a&gt;
ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å„ç§åŠŸèƒ½çš„çŠ¶æ€&#34;&gt;å„ç§åŠŸèƒ½çš„çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;Istio ä¸­çš„æ‰€æœ‰ feature æ ¹æ®&lt;strong&gt;æ˜¯å¦ç”Ÿäº§å¯ç”¨&lt;/strong&gt;ã€&lt;strong&gt;API å…¼å®¹æ€§&lt;/strong&gt;ã€&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;ã€&lt;strong&gt;ç»´æŠ¤ç­–ç•¥&lt;/strong&gt;åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Alphaï¼šä»…ä»…å¯ä»¥ä½œä¸º demoï¼Œæ— æ³•ç”Ÿäº§ä¸Šä½¿ç”¨ï¼Œä¹Ÿæ²¡æœ‰æ€§èƒ½ä¿è¯ï¼Œéšæ—¶éƒ½å¯èƒ½ä¸ç»´æŠ¤&lt;/li&gt;
&lt;li&gt;Betaï¼šå¯ä»¥åœ¨ç”Ÿäº§ä¸Šä½¿ç”¨äº†ï¼Œä¹Ÿæœ‰ç‰ˆæœ¬åŒ–çš„ API ä½†æ˜¯æ— æ³•ä¿è¯æ€§èƒ½ï¼Œä¿è¯ä¸‰ä¸ªæœˆçš„ç»´æŠ¤&lt;/li&gt;
&lt;li&gt;Stableï¼šå¯ä»¥ä¸Šç”Ÿäº§è€Œä¸”è¿˜èƒ½ä¿è¯æ€§èƒ½ï¼ŒAPI å‘åå…¼å®¹ï¼Œä¿è¯ä¸€å¹´çš„ç»´æŠ¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio çš„ feature åˆ†ä¸ºå››å¤§ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼šå„ç§åè®®çš„æ”¯æŒã€è·¯ç”±è§„åˆ™é…ç½®ã€Ingress TLS ç­‰&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§ï¼šç›‘æ§ã€æ—¥å¿—ã€åˆ†å¸ƒå¼è¿½è¸ªã€æœåŠ¡ä¾èµ–æ‹“æ‰‘&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§ï¼šå„ç§ checker å’Œå®‰å…¨æ€§é…ç½®&lt;/li&gt;
&lt;li&gt;Coreï¼šæ ¸å¿ƒåŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŠŸèƒ½åˆ’åˆ†ä¸å„ç§åŠŸèƒ½çš„çŠ¶æ€è¯¦æƒ…è¯·è§ï¼š&lt;a href=&#34;https://istio.io/latest/about/feature-stages/&#34; title=&#34;https://istio.io/latest/about/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/latest/about/feature-stages/&lt;/a&gt;
&lt;/p&gt;
&lt;h3 id=&#34;äº‘åŸç”Ÿç¤¾åŒº-istio-è®¨è®ºç»„&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº Istio è®¨è®ºç»„&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://cloudnative.to&#34; title=&#34;äº‘åŸç”Ÿç¤¾åŒº&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº&lt;/a&gt;
ä¸“é—¨æˆç«‹é‡Œ Istio SIGï¼ˆå¾®ä¿¡è®¨è®ºç¾¤ï¼‰ï¼Œå°†åŸæ¥ ServiceMesher ä¸­å…³æ³¨ Istio çš„äººç¾¤ä¸“é—¨é›†ä¸­åˆ°ä¸€ä¸ªè®¨è®ºç»„ä¸­ï¼Œå…¶ä¸­åŒ…å«äº†ç™¾åº¦ã€é˜¿é‡Œå·´å·´ã€è…¾è®¯ã€ç½‘æ˜“ã€Tetrateã€Intelã€å­—èŠ‚è·³åŠ¨ç­‰å…¬å¸çš„æœåŠ¡ç½‘æ ¼ä¸“å®¶åŠä¼—å¤šçš„ç»ˆç«¯ç”¨æˆ·ï¼Œæ¬¢è¿å¤§å®¶&lt;a href=&#34;https://i.cloudnative.to/istio&#34; title=&#34;ç”³è¯·åŠ å…¥ç¾¤èŠ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”³è¯·åŠ å…¥ç¾¤èŠ&lt;/a&gt;
ã€‚&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
