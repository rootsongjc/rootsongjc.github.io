<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ingress on Jimmy Song&#39;s Blog</title>
    <link>http://rootsongjc.github.io/tags/ingress/index.xml</link>
    <description>Recent content in Ingress on Jimmy Song&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://rootsongjc.github.io/tags/ingress/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Kubernetes traefik ingresså®‰è£…è¯•ç”¨</title>
      <link>http://rootsongjc.github.io/blogs/traefik-ingress-installation/</link>
      <pubDate>Thu, 20 Apr 2017 22:38:40 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/traefik-ingress-installation/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160915046.jpg&#34; alt=&#34;fish&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šğŸŸ@é±¼ç¼¸ Sep 15,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æ˜¨å¤©ç¿»äº†ä¸‹&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/&#34;&gt;Ingressè§£æ&lt;/a&gt;ï¼Œç„¶åå®‰è£…è¯•ç”¨äº†ä¸‹&lt;a href=&#34;https://traefik.io&#34;&gt;traefik&lt;/a&gt;ï¼Œè¿‡ç¨‹å·²åŒæ­¥åˆ°&lt;a href=&#34;https://www.gitbook.com/book/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸Šï¼ŒGithubåœ°å€&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;https://github.com/rootsongjc/kubernetes-handbook&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ingressç®€ä»‹&#34;&gt;Ingressç®€ä»‹&lt;/h2&gt;

&lt;p&gt;å¦‚æœä½ è¿˜ä¸äº†è§£ï¼Œingressæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆçœ‹ä¸‹æˆ‘ç¿»è¯‘çš„Kuberneteså®˜ç½‘ä¸Šingressçš„ä»‹ç»&lt;a href=&#34;http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/&#34;&gt;Kubernetes Ingressè§£æ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç†è§£Ingress&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç®€å•çš„è¯´ï¼Œingresså°±æ˜¯ä»kubernetesé›†ç¾¤å¤–è®¿é—®é›†ç¾¤çš„å…¥å£ï¼Œå°†ç”¨æˆ·çš„URLè¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„serviceä¸Šã€‚Ingressç›¸å½“äºnginxã€apacheç­‰è´Ÿè½½å‡è¡¡æ–¹å‘ä»£ç†æœåŠ¡å™¨ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬è§„åˆ™å®šä¹‰ï¼Œå³URLçš„è·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±ä¿¡æ¯å¾—çš„åˆ·æ–°ç”±&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers&#34;&gt;Ingress controller&lt;/a&gt;æ¥æä¾›ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç†è§£Ingress Controller&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Ingress Controller å®è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸ªç›‘è§†å™¨ï¼ŒIngress Controller é€šè¿‡ä¸æ–­åœ°è·Ÿ kubernetes API æ‰“äº¤é“ï¼Œå®æ—¶çš„æ„ŸçŸ¥åç«¯ serviceã€pod ç­‰å˜åŒ–ï¼Œæ¯”å¦‚æ–°å¢å’Œå‡å°‘ podï¼Œservice å¢åŠ ä¸å‡å°‘ç­‰ï¼›å½“å¾—åˆ°è¿™äº›å˜åŒ–ä¿¡æ¯åï¼ŒIngress Controller å†ç»“åˆä¸‹æ–‡çš„ Ingress ç”Ÿæˆé…ç½®ï¼Œç„¶åæ›´æ–°åå‘ä»£ç†è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶åˆ·æ–°å…¶é…ç½®ï¼Œè¾¾åˆ°æœåŠ¡å‘ç°çš„ä½œç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;éƒ¨ç½²traefik&#34;&gt;éƒ¨ç½²Traefik&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä»‹ç»traefik&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://traefik.io/&#34;&gt;Traefik&lt;/a&gt;æ˜¯ä¸€æ¬¾å¼€æºçš„åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿä¸å¸¸è§çš„å¾®æœåŠ¡ç³»ç»Ÿç›´æ¥æ•´åˆï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠ¨æ€é…ç½®ã€‚ç›®å‰æ”¯æŒDocker, Swarm, Mesos/Marathon, Mesos, Kubernetes, Consul, Etcd, Zookeeper, BoltDB, Rest APIç­‰ç­‰åç«¯æ¨¡å‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹é…ç½®æ–‡ä»¶å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;GitHubä»“åº“ä¸­çš„&lt;a href=&#34;manifests/traefik-ingress/&#34;&gt;manifests/traefik-ingress/&lt;/a&gt;ç›®å½•ä¸‹æ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºingress-rbac.yaml&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å°†ç”¨äºservice accountéªŒè¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
kind: ServiceAccount
metadata:
  name: ingress
  namespace: kube-system

---

kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: ingress
subjects:
  - kind: ServiceAccount
    name: ingress
    namespace: kube-system
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºåä¸º&lt;code&gt;traefik-ingress&lt;/code&gt;çš„ingress&lt;/strong&gt;ï¼Œæ–‡ä»¶åtraefik.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: traefik-ingress
spec:
  rules:
  - host: traefik.nginx.io
    http:
      paths:
      - path: /
        backend:
          serviceName: my-nginx
          servicePort: 80
  - host: traefik.frontend.io
    http:
      paths:
      - path: /
        backend:
          serviceName: frontend
          servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™å…¶ä¸­çš„&lt;code&gt;backend&lt;/code&gt;ä¸­è¦é…ç½®default namespaceä¸­å¯åŠ¨çš„serviceåå­—ã€‚&lt;code&gt;path&lt;/code&gt;å°±æ˜¯URLåœ°å€åçš„è·¯å¾„ï¼Œå¦‚traefik.frontend.io/pathï¼Œserviceå°†ä¼šæ¥å—pathè¿™ä¸ªè·¯å¾„ï¼Œhostæœ€å¥½ä½¿ç”¨service-name.filed1.filed2.domain-nameè¿™ç§ç±»ä¼¼ä¸»æœºåç§°çš„å‘½åæ–¹å¼ï¼Œæ–¹ä¾¿åŒºåˆ†æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ®ä½ è‡ªå·±ç¯å¢ƒä¸­éƒ¨ç½²çš„serviceçš„åå­—å’Œç«¯å£è‡ªè¡Œä¿®æ”¹ï¼Œæœ‰æ–°serviceå¢åŠ æ—¶ï¼Œä¿®æ”¹è¯¥æ–‡ä»¶åå¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl replace -f traefik.yaml&lt;/code&gt;æ¥æ›´æ–°ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ç°åœ¨é›†ç¾¤ä¸­å·²ç»æœ‰ä¸¤ä¸ªserviceäº†ï¼Œä¸€ä¸ªæ˜¯nginxï¼Œå¦ä¸€ä¸ªæ˜¯å®˜æ–¹çš„&lt;code&gt;guestbook&lt;/code&gt;ä¾‹å­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºDepeloyment&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: traefik-ingress-lb
  namespace: kube-system
  labels:
    k8s-app: traefik-ingress-lb
spec:
  template:
    metadata:
      labels:
        k8s-app: traefik-ingress-lb
        name: traefik-ingress-lb
    spec:
      terminationGracePeriodSeconds: 60
      hostNetwork: true
      restartPolicy: Always
      serviceAccountName: ingress
      containers:
      - image: traefik
        name: traefik-ingress-lb
        resources:
          limits:
            cpu: 200m
            memory: 30Mi
          requests:
            cpu: 100m
            memory: 20Mi
        ports:
        - name: http
          containerPort: 80
          hostPort: 80
        - name: admin
          containerPort: 8580
          hostPort: 8580
        args:
        - --web
        - --web.address=:8580
        - --kubernetes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„æˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯Deployç±»å‹ï¼Œæ²¡æœ‰é™å®šè¯¥podè¿è¡Œåœ¨å“ªä¸ªä¸»æœºä¸Šã€‚Traefikçš„ç«¯å£æ˜¯8580ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Traefik UI&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
kind: Service
metadata:
  name: traefik-web-ui
  namespace: kube-system
spec:
  selector:
    k8s-app: traefik-ingress-lb
  ports:
  - name: web
    port: 80
    targetPort: 8580
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: traefik-web-ui
  namespace: kube-system
spec:
  rules:
  - host: traefik-ui.local
    http:
      paths:
      - path: /
        backend:
          serviceName: traefik-web-ui
          servicePort: web
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é…ç½®å®Œæˆåå°±å¯ä»¥å¯åŠ¨treafik ingressäº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl create -f .
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘æŸ¥çœ‹åˆ°traefikçš„podåœ¨&lt;code&gt;172.20.0.115&lt;/code&gt;è¿™å°èŠ‚ç‚¹ä¸Šå¯åŠ¨äº†ã€‚&lt;/p&gt;

&lt;p&gt;è®¿é—®è¯¥åœ°å€&lt;code&gt;http://172.20.0.115:8580/&lt;/code&gt;å°†å¯ä»¥çœ‹åˆ°dashboardã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-dashboard.jpg&#34; alt=&#34;kubernetes-dashboard&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å·¦ä¾§é»„è‰²éƒ¨åˆ†éƒ¨åˆ†åˆ—å‡ºçš„æ˜¯æ‰€æœ‰çš„ruleï¼Œå³ä¾§ç»¿è‰²éƒ¨åˆ†æ˜¯æ‰€æœ‰çš„backendã€‚&lt;/p&gt;

&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h2&gt;

&lt;p&gt;åœ¨é›†ç¾¤çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚å‡å¦‚ç°åœ¨æˆ‘è¦è®¿é—®nginxçš„&amp;rdquo;/&amp;ldquo;è·¯å¾„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ curl -H Host:traefik.nginx.io http://172.20.0.115/
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;Welcome to nginx!&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Welcome to nginx!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;For online documentation and support please refer to
&amp;lt;a href=&amp;quot;http://nginx.org/&amp;quot;&amp;gt;nginx.org&amp;lt;/a&amp;gt;.&amp;lt;br/&amp;gt;
Commercial support is available at
&amp;lt;a href=&amp;quot;http://nginx.com/&amp;quot;&amp;gt;nginx.com&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;em&amp;gt;Thank you for using nginx.&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä½ éœ€è¦åœ¨kubernetesé›†ç¾¤ä»¥å¤–è®¿é—®å°±éœ€è¦è®¾ç½®DNSï¼Œæˆ–è€…ä¿®æ”¹æœ¬æœºçš„hostsæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å…¶ä¸­åŠ å…¥ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;172.20.0.115 traefik.nginx.io
172.20.0.115 traefik.frontend.io
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰€æœ‰è®¿é—®è¿™äº›åœ°å€çš„æµé‡éƒ½ä¼šå‘é€ç»™172.20.0.115è¿™å°ä¸»æœºï¼Œå°±æ˜¯æˆ‘ä»¬å¯åŠ¨traefikçš„ä¸»æœºã€‚&lt;/p&gt;

&lt;p&gt;Traefikä¼šè§£æhttpè¯·æ±‚headeré‡Œçš„Hostå‚æ•°å°†æµé‡è½¬å‘ç»™Ingressé…ç½®é‡Œçš„ç›¸åº”serviceã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹hostsåå°±å°±å¯ä»¥åœ¨kubernetesé›†ç¾¤å¤–è®¿é—®ä»¥ä¸Šä¸¤ä¸ªserviceï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-nginx.jpg&#34; alt=&#34;traefik-nginx&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/traefik-guestbook.jpg&#34; alt=&#34;traefik-guestbook&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.colabug.com/thread-1703745-1-1.html&#34;&gt;Traefik-kubernetes åˆè¯•&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.tuicool.com/articles/ZnuEfay&#34;&gt;Traefikç®€ä»‹&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook&#34;&gt;Guestbook example&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes ingressè§£æ</title>
      <link>http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/</link>
      <pubDate>Wed, 19 Apr 2017 21:05:47 +0800</pubDate>
      
      <guid>http://rootsongjc.github.io/blogs/kubernetes-ingress-resource/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;http://olz1di9xf.bkt.clouddn.com/20160131054.jpg&#34; alt=&#34;é“¶æ²³soho&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ï¼ˆé¢˜å›¾ï¼šæœé˜³é—¨é“¶æ²³SOHO Jan 31,2016ï¼‰&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯kuberneteå®˜æ–¹æ–‡æ¡£ä¸­&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34;&gt;Ingress Resource&lt;/a&gt;çš„ç¿»è¯‘ï¼Œå› ä¸ºæœ€è¿‘å·¥ä½œä¸­ç”¨åˆ°ï¼Œæ–‡ç« ä¹Ÿä¸é•¿ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œç´¢æ€§ç¿»è¯‘ä¸€ä¸‹ï¼Œä¹Ÿä¾¿äºè‡ªå·±åŠ æ·±ç†è§£ï¼ŒåŒæ—¶é€ ç¦&lt;a href=&#34;https://www.kubernetes.org.cn/&#34;&gt;kubernetesä¸­æ–‡ç¤¾åŒº&lt;/a&gt;ã€‚åç»­å‡†å¤‡ä½¿ç”¨&lt;a href=&#34;https://github.com/containous/traefik&#34;&gt;Traefik&lt;/a&gt;æ¥åšIngress controllerï¼Œæ–‡ç« æœ«å°¾ç»™å‡ºäº†å‡ ä¸ªç›¸å…³é“¾æ¥ï¼Œå®é™…ä½¿ç”¨æ¡ˆä¾‹æ­£åœ¨æ‘¸ç´¢ä¸­ï¼Œå±Šæ—¶ç›¸å…³å®‰è£…æ–‡æ¡£å’Œé…ç½®è¯´æ˜å°†åŒæ­¥æ›´æ–°åˆ°&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœ¯è¯­&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šçœ‹åˆ°ä¸€äº›åœ¨å…¶ä»–åœ°æ–¹è¢«äº¤å‰ä½¿ç”¨çš„æœ¯è¯­ï¼Œä¸ºäº†é˜²æ­¢äº§ç”Ÿæ­§ä¹‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥æ¾„æ¸…ä¸‹ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹ï¼šKubernetesé›†ç¾¤ä¸­çš„ä¸€å°ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é›†ç¾¤ï¼šä½äºInterneté˜²ç«å¢™åçš„èŠ‚ç‚¹ï¼Œè¿™æ˜¯kubernetesç®¡ç†çš„ä¸»è¦è®¡ç®—èµ„æºã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è¾¹ç•Œè·¯ç”±å™¨ï¼šä¸ºé›†ç¾¤å¼ºåˆ¶æ‰§è¡Œé˜²ç«å¢™ç­–ç•¥çš„è·¯ç”±å™¨ã€‚ è¿™å¯èƒ½æ˜¯ç”±äº‘æä¾›å•†æˆ–ç‰©ç†ç¡¬ä»¶ç®¡ç†çš„ç½‘å…³ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é›†ç¾¤ç½‘ç»œï¼šä¸€ç»„é€»è¾‘æˆ–ç‰©ç†é“¾æ¥ï¼Œå¯æ ¹æ®Kubernetes&lt;a href=&#34;https://kubernetes.io/docs/admin/networking/&#34;&gt;ç½‘ç»œæ¨¡å‹&lt;/a&gt;å®ç°ç¾¤é›†å†…çš„é€šä¿¡ã€‚ é›†ç¾¤ç½‘ç»œçš„å®ç°åŒ…æ‹¬Overlayæ¨¡å‹çš„ &lt;a href=&#34;https://github.com/coreos/flannel#flannel&#34;&gt;flannel&lt;/a&gt; å’ŒåŸºäºSDNçš„&lt;a href=&#34;https://kubernetes.io/docs/admin/ovs-networking/&#34;&gt;OVS&lt;/a&gt;ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æœåŠ¡ï¼šä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨æ ‡è¯†ä¸€ç»„podæˆä¸ºçš„Kubernetes&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/&#34;&gt;æœåŠ¡&lt;/a&gt;ã€‚ é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æœåŠ¡å‡å®šåœ¨é›†ç¾¤ç½‘ç»œå†…ä»…å¯é€šè¿‡è™šæ‹ŸIPè®¿é—®ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯ingress&#34;&gt;ä»€ä¹ˆæ˜¯Ingressï¼Ÿ&lt;/h2&gt;

&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œserviceå’Œpodä»…å¯åœ¨é›†ç¾¤å†…éƒ¨ç½‘ç»œä¸­é€šè¿‡IPåœ°å€è®¿é—®ã€‚æ‰€æœ‰åˆ°è¾¾è¾¹ç•Œè·¯ç”±å™¨çš„æµé‡æˆ–è¢«ä¸¢å¼ƒæˆ–è¢«è½¬å‘åˆ°å…¶ä»–åœ°æ–¹ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå¯èƒ½åƒä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    internet
        |
  ------------
  [ Services ]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ingressæ˜¯æˆæƒå…¥ç«™è¿æ¥åˆ°è¾¾é›†ç¾¤æœåŠ¡çš„è§„åˆ™é›†åˆã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    internet
        |
   [ Ingress ]
   --|-----|--
   [ Services ]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯ä»¥ç»™Ingressé…ç½®æä¾›å¤–éƒ¨å¯è®¿é—®çš„URLã€è´Ÿè½½å‡è¡¡ã€SSLã€åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºç­‰ã€‚ç”¨æˆ·é€šè¿‡POST Ingressèµ„æºåˆ°API serverçš„æ–¹å¼æ¥è¯·æ±‚ingressã€‚ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers&#34;&gt;Ingress controller&lt;/a&gt;è´Ÿè´£å®ç°Ingressï¼Œé€šå¸¸ä½¿ç”¨è´Ÿè½½å¹³è¡¡å™¨ï¼Œå®ƒè¿˜å¯ä»¥é…ç½®è¾¹ç•Œè·¯ç”±å’Œå…¶ä»–å‰ç«¯ï¼Œè¿™æœ‰åŠ©äºä»¥HAæ–¹å¼å¤„ç†æµé‡ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h2&gt;

&lt;p&gt;åœ¨ä½¿ç”¨Ingress resourceä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸‹é¢å‡ ä»¶äº‹æƒ…ã€‚Ingressæ˜¯betaç‰ˆæœ¬çš„resourceï¼Œåœ¨kubernetes1.1ä¹‹å‰è¿˜æ²¡æœ‰ã€‚ä½ éœ€è¦ä¸€ä¸ª&lt;code&gt;Ingress Controller&lt;/code&gt;æ¥å®ç°&lt;code&gt;Ingress&lt;/code&gt;ï¼Œå•çº¯çš„åˆ›å»ºä¸€ä¸ª&lt;code&gt;Ingress&lt;/code&gt;æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚&lt;/p&gt;

&lt;p&gt;GCE/GKEä¼šåœ¨masterèŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªingress controllerã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªpodä¸­éƒ¨ç½²ä»»æ„ä¸ªè‡ªå®šä¹‰çš„ingress controllerã€‚ä½ å¿…é¡»æ­£ç¡®åœ°annotateæ¯ä¸ªingressï¼Œæ¯”å¦‚ &lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers/nginx#running-multiple-ingress-controllers&#34;&gt;è¿è¡Œå¤šä¸ªingress controller&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/BETA_LIMITATIONS.md#disabling-glbc&#34;&gt;å…³é—­glbc&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;ç¡®å®šä½ å·²ç»é˜…è¯»äº†Ingress controllerçš„&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/BETA_LIMITATIONS.md&#34;&gt;betaç‰ˆæœ¬é™åˆ¶&lt;/a&gt;ã€‚åœ¨éGCE/GKEçš„ç¯å¢ƒä¸­ï¼Œä½ éœ€è¦åœ¨podä¸­&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers&#34;&gt;éƒ¨ç½²ä¸€ä¸ªcontroller&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ingress-resource&#34;&gt;Ingress Resource&lt;/h2&gt;

&lt;p&gt;æœ€ç®€åŒ–çš„Ingressé…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;1: apiVersion: extensions/v1beta1
2: kind: Ingress
3: metadata:
4:   name: test-ingress
5: spec:
6:   rules:
7:   - http:
8:       paths:
9:       - path: /testpath
10:        backend:
11:           serviceName: test
12:           servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;å¦‚æœä½ æ²¡æœ‰é…ç½®Ingress controllerå°±å°†å…¶POSTåˆ°API serverä¸ä¼šæœ‰ä»»ä½•ç”¨å¤„&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®è¯´æ˜&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1-4è¡Œ&lt;/strong&gt;ï¼šè·ŸKubernetesçš„å…¶ä»–é…ç½®ä¸€æ ·ï¼Œingressçš„é…ç½®ä¹Ÿéœ€è¦&lt;code&gt;apiVersion&lt;/code&gt;ï¼Œ&lt;code&gt;kind&lt;/code&gt;å’Œ&lt;code&gt;metadata&lt;/code&gt;å­—æ®µã€‚é…ç½®æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/user-guide/deploying-applications&#34;&gt;éƒ¨ç½²åº”ç”¨&lt;/a&gt;, &lt;a href=&#34;https://kubernetes.io/docs/user-guide/configuring-containers&#34;&gt;é…ç½®å®¹å™¨&lt;/a&gt;å’Œ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/working-with-resources&#34;&gt;ä½¿ç”¨resources&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;5-7è¡Œ&lt;/strong&gt;: Ingress &lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md#spec-and-status&#34;&gt;spec&lt;/a&gt; ä¸­åŒ…å«é…ç½®ä¸€ä¸ªloadbalanceræˆ–proxy serverçš„æ‰€æœ‰ä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªåŒ¹é…æ‰€æœ‰å…¥ç«™è¯·æ±‚çš„è§„åˆ™åˆ—è¡¨ã€‚ç›®å‰ingressåªæ”¯æŒhttpè§„åˆ™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;8-9è¡Œ&lt;/strong&gt;ï¼šæ¯æ¡httpè§„åˆ™åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šä¸€ä¸ª&lt;code&gt;host&lt;/code&gt;é…ç½®é¡¹ï¼ˆæ¯”å¦‚for.bar.comï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­é»˜è®¤æ˜¯*ï¼‰ï¼Œ&lt;code&gt;path&lt;/code&gt;åˆ—è¡¨ï¼ˆæ¯”å¦‚ï¼š/testpathï¼‰ï¼Œæ¯ä¸ªpathéƒ½å…³è”ä¸€ä¸ª&lt;code&gt;backend&lt;/code&gt;(æ¯”å¦‚test:80)ã€‚åœ¨loadbalancerå°†æµé‡è½¬å‘åˆ°backendä¹‹å‰ï¼Œæ‰€æœ‰çš„å…¥ç«™è¯·æ±‚éƒ½è¦å…ˆåŒ¹é…hostå’Œpathã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;10-12è¡Œ&lt;/strong&gt;ï¼šæ­£å¦‚ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/services&#34;&gt;services doc&lt;/a&gt;ä¸­æè¿°çš„é‚£æ ·ï¼Œbackendæ˜¯ä¸€ä¸ª&lt;code&gt;service:port&lt;/code&gt;çš„ç»„åˆã€‚Ingressçš„æµé‡è¢«è½¬å‘åˆ°å®ƒæ‰€åŒ¹é…çš„backendã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å…¨å±€å‚æ•°&lt;/strong&gt;ï¼šä¸ºäº†ç®€å•èµ·è§ï¼ŒIngressç¤ºä¾‹ä¸­æ²¡æœ‰å…¨å±€å‚æ•°ï¼Œè¯·å‚é˜…èµ„æºå®Œæ•´å®šä¹‰çš„&lt;a href=&#34;https://releases.k8s.io/master/pkg/apis/extensions/v1beta1/types.go&#34;&gt;apiå‚è€ƒ&lt;/a&gt;ã€‚ åœ¨æ‰€æœ‰è¯·æ±‚éƒ½ä¸èƒ½è·Ÿspecä¸­çš„pathåŒ¹é…çš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚è¢«å‘é€åˆ°Ingress controllerçš„é»˜è®¤åç«¯ï¼Œå¯ä»¥æŒ‡å®šå…¨å±€ç¼ºçœbackendã€‚&lt;/p&gt;

&lt;h2 id=&#34;ingress-controllers&#34;&gt;Ingress controllers&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†ä½¿Ingressæ­£å¸¸å·¥ä½œï¼Œé›†ç¾¤ä¸­å¿…é¡»è¿è¡ŒIngress controllerã€‚ è¿™ä¸å…¶ä»–ç±»å‹çš„æ§åˆ¶å™¨ä¸åŒï¼Œå…¶ä»–ç±»å‹çš„æ§åˆ¶å™¨é€šå¸¸ä½œä¸º&lt;code&gt;kube-controller-manager&lt;/code&gt;äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œåœ¨é›†ç¾¤å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ã€‚ ä½ éœ€è¦é€‰æ‹©æœ€é€‚åˆè‡ªå·±é›†ç¾¤çš„Ingress controlleræˆ–è€…è‡ªå·±å®ç°ä¸€ä¸ªã€‚ ç¤ºä¾‹å’Œè¯´æ˜å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master/controllers&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åœ¨ä½ å¼€å§‹å‰&#34;&gt;åœ¨ä½ å¼€å§‹å‰&lt;/h2&gt;

&lt;p&gt;ä»¥ä¸‹æ–‡æ¡£æè¿°äº†Ingressèµ„æºä¸­å…¬å¼€çš„ä¸€ç»„è·¨å¹³å°åŠŸèƒ½ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„Ingress controlleréƒ½åº”è¯¥ç¬¦åˆè¿™ä¸ªè§„èŒƒï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°ã€‚ GCEå’Œnginxæ§åˆ¶å™¨çš„æ–‡æ¡£åˆ†åˆ«åœ¨&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/README.md&#34;&gt;è¿™é‡Œ&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/nginx/README.md&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;strong&gt;ç¡®ä¿æ‚¨æŸ¥çœ‹æ§åˆ¶å™¨ç‰¹å®šçš„æ–‡æ¡£ï¼Œä»¥ä¾¿æ‚¨äº†è§£æ¯ä¸ªæ–‡æ¡£çš„æ³¨æ„äº‹é¡¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;ingressç±»å‹&#34;&gt;Ingressç±»å‹&lt;/h2&gt;

&lt;h3 id=&#34;å•service-ingress&#34;&gt;å•Service Ingress&lt;/h3&gt;

&lt;p&gt;Kubernetesä¸­å·²ç»å­˜åœ¨ä¸€äº›æ¦‚å¿µå¯ä»¥æš´éœ²å•ä¸ªserviceï¼ˆæŸ¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/#alternatives&#34;&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/a&gt;ï¼‰ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥é€šè¿‡Ingressæ¥å®ç°ï¼Œé€šè¿‡æŒ‡å®šä¸€ä¸ªæ²¡æœ‰ruleçš„é»˜è®¤backendçš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;ingress.yamlå®šä¹‰æ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test-ingress
spec:
  backend:
    serviceName: testsvc
    servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;kubectl create -f&lt;/code&gt;å‘½ä»¤åˆ›å»ºï¼Œç„¶åæŸ¥çœ‹ingressï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get ing
NAME                RULE          BACKEND        ADDRESS
test-ingress        -             testsvc:80     107.178.254.228
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;107.178.254.228&lt;/code&gt;å°±æ˜¯Ingress controllerä¸ºäº†å®ç°Ingressè€Œåˆ†é…çš„IPåœ°å€ã€‚&lt;code&gt;RULE&lt;/code&gt;åˆ—è¡¨ç¤ºæ‰€æœ‰å‘é€ç»™è¯¥IPçš„æµé‡éƒ½è¢«è½¬å‘åˆ°äº†&lt;code&gt;BACKEND&lt;/code&gt;æ‰€åˆ—çš„Kubernetes serviceä¸Šã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç®€å•å±•å¼€&#34;&gt;ç®€å•å±•å¼€&lt;/h3&gt;

&lt;p&gt;å¦‚å‰é¢æè¿°çš„é‚£æ ·ï¼Œkubernete podä¸­çš„IPåªåœ¨é›†ç¾¤ç½‘ç»œå†…éƒ¨å¯è§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¾¹ç•Œè®¾ç½®ä¸€ä¸ªä¸œè¥¿ï¼Œè®©å®ƒèƒ½å¤Ÿæ¥æ”¶ingressçš„æµé‡å¹¶å°†å®ƒä»¬è½¬å‘åˆ°æ­£ç¡®çš„ç«¯ç‚¹ä¸Šã€‚è¿™ä¸ªä¸œè¥¿ä¸€èˆ¬æ˜¯é«˜å¯ç”¨çš„loadbalancerã€‚ä½¿ç”¨Ingressèƒ½å¤Ÿå…è®¸ä½ å°†loadbalancerçš„ä¸ªæ•°é™ä½åˆ°æœ€å°‘ï¼Œä¾‹å¦‚ï¼Œå‡å¦‚ä½ æƒ³è¦åˆ›å»ºè¿™æ ·çš„ä¸€ä¸ªè®¾ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;foo.bar.com -&amp;gt; 178.91.123.132 -&amp;gt; / foo    s1:80
                                 / bar    s2:80

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ éœ€è¦ä¸€ä¸ªè¿™æ ·çš„ingressï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test
spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - path: /foo
        backend:
          serviceName: s1
          servicePort: 80
      - path: /bar
        backend:
          serviceName: s2
          servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;kubectl create -f&lt;/code&gt;åˆ›å»ºå®Œingressåï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get ing
NAME      RULE          BACKEND   ADDRESS
test      -
          foo.bar.com
          /foo          s1:80
          /bar          s2:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åªè¦æœåŠ¡ï¼ˆs1ï¼Œs2ï¼‰å­˜åœ¨ï¼ŒIngress controllerå°±ä¼šå°†æä¾›ä¸€ä¸ªæ»¡è¶³è¯¥Ingressçš„ç‰¹å®šloadbalancerå®ç°ã€‚ è¿™ä¸€æ­¥å®Œæˆåï¼Œæ‚¨å°†åœ¨Ingressçš„æœ€åä¸€åˆ—çœ‹åˆ°loadbalancerçš„åœ°å€ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº&#34;&gt;åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº&lt;/h3&gt;

&lt;p&gt;Name-basedçš„è™šæ‹Ÿä¸»æœºåœ¨åŒä¸€ä¸ªIPåœ°å€ä¸‹æ‹¥æœ‰å¤šä¸ªä¸»æœºåã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;foo.bar.com --|                 |-&amp;gt; foo.bar.com s1:80
              | 178.91.123.132  |
bar.foo.com --|                 |-&amp;gt; bar.foo.com s2:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸‹é¢è¿™ä¸ªingressè¯´æ˜åŸºäº&lt;a href=&#34;https://tools.ietf.org/html/rfc7230#section-5.4&#34;&gt;Host header&lt;/a&gt;çš„åç«¯loadbalancerçš„è·¯ç”±è¯·æ±‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test
spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - backend:
          serviceName: s1
          servicePort: 80
  - host: bar.foo.com
    http:
      paths:
      - backend:
          serviceName: s2
          servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é»˜è®¤backend&lt;/strong&gt;ï¼šä¸€ä¸ªæ²¡æœ‰ruleçš„ingressï¼Œå¦‚å‰é¢ç« èŠ‚ä¸­æ‰€ç¤ºï¼Œæ‰€æœ‰æµé‡éƒ½å°†å‘é€åˆ°ä¸€ä¸ªé»˜è®¤backendã€‚ä½ å¯ä»¥ç”¨è¯¥æŠ€å·§é€šçŸ¥loadbalancerå¦‚ä½•æ‰¾åˆ°ä½ ç½‘ç«™çš„404é¡µé¢ï¼Œé€šè¿‡åˆ¶å®šä¸€äº›åˆ—ruleå’Œä¸€ä¸ªé»˜è®¤backendçš„æ–¹å¼ã€‚å¦‚æœè¯·æ±‚headerä¸­çš„hostä¸èƒ½è·Ÿingressä¸­çš„hoståŒ¹é…ï¼Œå¹¶ä¸”/æˆ–è¯·æ±‚çš„URLä¸èƒ½ä¸ä»»ä½•ä¸€ä¸ªpathåŒ¹é…ï¼Œåˆ™æµé‡å°†è·¯ç”±åˆ°ä½ çš„é»˜è®¤backendã€‚&lt;/p&gt;

&lt;h3 id=&#34;tls&#34;&gt;TLS&lt;/h3&gt;

&lt;p&gt;ä½ å¯ä»¥é€šè¿‡æŒ‡å®šåŒ…å«TLSç§é’¥å’Œè¯ä¹¦çš„&lt;a href=&#34;https://kubernetes.io/docs/user-guide/secrets&#34;&gt;secret&lt;/a&gt;æ¥åŠ å¯†Ingressã€‚ ç›®å‰ï¼ŒIngressä»…æ”¯æŒå•ä¸ªTLSç«¯å£443ï¼Œå¹¶å‡å®šTLS terminationã€‚ å¦‚æœIngressä¸­çš„TLSé…ç½®éƒ¨åˆ†æŒ‡å®šäº†ä¸åŒçš„ä¸»æœºï¼Œåˆ™å®ƒä»¬å°†æ ¹æ®é€šè¿‡SNI TLSæ‰©å±•æŒ‡å®šçš„ä¸»æœºåï¼ˆå‡å¦‚Ingress controlleræ”¯æŒSNIï¼‰åœ¨å¤šä¸ªç›¸åŒç«¯å£ä¸Šè¿›è¡Œå¤ç”¨ã€‚ TLS secretä¸­å¿…é¡»åŒ…å«åä¸º&lt;code&gt;tls.crt&lt;/code&gt;å’Œ&lt;code&gt;tls.key&lt;/code&gt;çš„å¯†é’¥ï¼Œè¿™é‡Œé¢åŒ…å«äº†ç”¨äºTLSçš„è¯ä¹¦å’Œç§é’¥ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Yaml&#34;&gt;apiVersion: v1
data:
  tls.crt: base64 encoded cert
  tls.key: base64 encoded key
kind: Secret
metadata:
  name: testsecret
  namespace: default
type: Opaque
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨Ingressä¸­å¼•ç”¨è¿™ä¸ªsecretå°†é€šçŸ¥Ingress controllerä½¿ç”¨TLSåŠ å¯†ä»å°†å®¢æˆ·ç«¯åˆ°loadbalancerçš„channelï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: no-rules-map
spec:
  tls:
    - secretName: testsecret
  backend:
    serviceName: s1
    servicePort: 80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼Œå„ç§Ingress controlleræ”¯æŒçš„TLSåŠŸèƒ½ä¹‹é—´å­˜åœ¨å·®è·ã€‚ è¯·å‚é˜…æœ‰å…³&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/nginx/README.md#https&#34;&gt;nginx&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/README.md#tls&#34;&gt;GCE&lt;/a&gt;æˆ–ä»»ä½•å…¶ä»–å¹³å°ç‰¹å®šIngress controllerçš„æ–‡æ¡£ï¼Œä»¥äº†è§£TLSåœ¨ä½ çš„ç¯å¢ƒä¸­çš„å·¥ä½œåŸç†ã€‚&lt;/p&gt;

&lt;p&gt;Ingress controllerå¯åŠ¨æ—¶é™„å¸¦ä¸€äº›é€‚ç”¨äºæ‰€æœ‰Ingressçš„è´Ÿè½½å¹³è¡¡ç­–ç•¥è®¾ç½®ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåç«¯æƒé‡æ–¹æ¡ˆç­‰ã€‚æ›´é«˜çº§çš„è´Ÿè½½å¹³è¡¡æ¦‚å¿µï¼ˆä¾‹å¦‚æŒä¹…ä¼šè¯ï¼ŒåŠ¨æ€æƒé‡ï¼‰å°šæœªåœ¨Ingressä¸­å…¬å¼€ã€‚ ä½ ä»ç„¶å¯ä»¥é€šè¿‡&lt;a href=&#34;https://github.com/kubernetes/contrib/tree/master/service-loadbalancer&#34;&gt;service loadbalancer&lt;/a&gt;è·å–è¿™äº›åŠŸèƒ½ã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬è®¡åˆ’å°†é€‚ç”¨äºè·¨å¹³å°çš„è´Ÿè½½å¹³è¡¡æ¨¡å¼åŠ å…¥åˆ°Ingressèµ„æºä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡å¥åº·æ£€æŸ¥ä¸ç›´æ¥é€šè¿‡Ingresså…¬å¼€ï¼Œä½†Kubernetesä¸­å­˜åœ¨å¹¶è¡Œæ¦‚å¿µï¼Œä¾‹å¦‚&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/&#34;&gt;å‡†å¤‡æ¢æŸ¥&lt;/a&gt;ï¼Œå¯ä»¥ä½¿ä½ è¾¾æˆç›¸åŒçš„æœ€ç»ˆç»“æœã€‚ è¯·æŸ¥çœ‹ç‰¹å®šæ§åˆ¶å™¨çš„æ–‡æ¡£ï¼Œä»¥äº†è§£ä»–ä»¬å¦‚ä½•å¤„ç†å¥åº·æ£€æŸ¥ï¼ˆ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/nginx/README.md&#34;&gt;nginx&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/ingress/blob/master/controllers/gce/README.md#health-checks&#34;&gt;GCE&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ›´æ–°ingress&#34;&gt;æ›´æ–°Ingress&lt;/h2&gt;

&lt;p&gt;å‡å¦‚ä½ æƒ³è¦å‘å·²æœ‰çš„ingressä¸­å¢åŠ ä¸€ä¸ªæ–°çš„Hostï¼Œä½ å¯ä»¥ç¼–è¾‘å’Œæ›´æ–°è¯¥ingressï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Bash&#34;&gt;$ kubectl get ing
NAME      RULE          BACKEND   ADDRESS
test      -                       178.91.123.132
          foo.bar.com
          /foo          s1:80
$ kubectl edit ing test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¼šå¼¹å‡ºä¸€ä¸ªåŒ…å«å·²æœ‰çš„yamlæ–‡ä»¶çš„ç¼–è¾‘å™¨ï¼Œä¿®æ”¹å®ƒï¼Œå¢åŠ æ–°çš„Hosté…ç½®ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - backend:
          serviceName: s1
          servicePort: 80
        path: /foo
  - host: bar.baz.com
    http:
      paths:
      - backend:
          serviceName: s2
          servicePort: 80
        path: /foo
..
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿å­˜å®ƒä¼šæ›´æ–°API serverä¸­çš„èµ„æºï¼Œè¿™ä¼šè§¦å‘ingress controlleré‡æ–°é…ç½®loadbalancerã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get ing
NAME      RULE          BACKEND   ADDRESS
test      -                       178.91.123.132
          foo.bar.com
          /foo          s1:80
          bar.baz.com
          /foo          s2:80
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ä¸€ä¸ªä¿®æ”¹è¿‡çš„ingress yamlæ–‡ä»¶ä¸Šè°ƒç”¨&lt;code&gt;kubectl replace -f&lt;/code&gt;å‘½ä»¤ä¸€æ ·å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚&lt;/p&gt;

&lt;h2 id=&#34;è·¨å¯ç”¨åŸŸæ•…éšœ&#34;&gt;è·¨å¯ç”¨åŸŸæ•…éšœ&lt;/h2&gt;

&lt;p&gt;åœ¨ä¸é€šäº‘ä¾›åº”å•†ä¹‹é—´ï¼Œè·¨æ•…éšœåŸŸçš„æµé‡ä¼ æ’­æŠ€æœ¯æœ‰æ‰€ä¸åŒã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ç›¸å…³Ingress controllerçš„æ–‡æ¡£ã€‚ æœ‰å…³åœ¨federationé›†ç¾¤ä¸­éƒ¨ç½²Ingressçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/federation/&#34;&gt;federationæ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æœªæ¥è®¡åˆ’&#34;&gt;æœªæ¥è®¡åˆ’&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å¤šæ ·åŒ–çš„HTTPS/TLSæ¨¡å‹æ”¯æŒï¼ˆå¦‚SNIï¼Œre-encryptionï¼‰&lt;/li&gt;
&lt;li&gt;é€šè¿‡å£°æ˜æ¥è¯·æ±‚IPæˆ–è€…ä¸»æœºå&lt;/li&gt;
&lt;li&gt;ç»“åˆL4å’ŒL7 Ingress&lt;/li&gt;
&lt;li&gt;æ›´å¤šçš„Ingress controller&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¯·è·Ÿè¸ª&lt;a href=&#34;https://github.com/kubernetes/kubernetes/pull/12827&#34;&gt;L7å’ŒIngressçš„proposal&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³èµ„æºæ¼”è¿›çš„æ›´å¤šç»†èŠ‚ï¼Œä»¥åŠ&lt;a href=&#34;https://github.com/kubernetes/ingress/tree/master&#34;&gt;Ingress repository&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³å„ç§Ingress controlleræ¼”è¿›çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ›¿ä»£æ–¹æ¡ˆ&#34;&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/h2&gt;

&lt;p&gt;ä½ å¯ä»¥é€šè¿‡å¾ˆå¤šç§æ–¹å¼æš´éœ²serviceè€Œä¸å¿…ç›´æ¥ä½¿ç”¨ingressï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/#type-loadbalancer&#34;&gt;Service.Type=LoadBalancer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://kubernetes.io/docs/user-guide/services/#type-nodeport&#34;&gt;Service.Type=NodePort&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://github.com/kubernetes/contrib/tree/master/for-demos/proxy-to-service&#34;&gt;Port Proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²ä¸€ä¸ª&lt;a href=&#34;https://github.com/kubernetes/contrib/tree/master/service-loadbalancer&#34;&gt;Service loadbalancer&lt;/a&gt; è¿™å…è®¸ä½ åœ¨å¤šä¸ªserviceä¹‹é—´å…±äº«å•ä¸ªIPï¼Œå¹¶é€šè¿‡Service Annotationså®ç°æ›´é«˜çº§çš„è´Ÿè½½å¹³è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34;&gt;Kubernetes Ingress Resource&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://dockone.io/article/957&#34;&gt;ä½¿ç”¨NGINX Plusè´Ÿè½½å‡è¡¡KubernetesæœåŠ¡&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.cnblogs.com/276815076/p/6407101.html&#34;&gt;ä½¿ç”¨ NGINX å’Œ NGINX Plus çš„ Ingress Controller è¿›è¡Œ Kubernetes çš„è´Ÿè½½å‡è¡¡&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.osones.com/en/kubernetes-ingress-controller-with-traefik-and-lets-encrypt.html&#34;&gt;Kubernetes : Ingress Controller with TrÃ¦fÉªk and Let&amp;rsquo;s Encrypt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.osones.com/en/kubernetes-traefik-and-lets-encrypt-at-scale.html&#34;&gt;Kubernetes : TrÃ¦fÉªk and Let&amp;rsquo;s Encrypt at scale&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.traefik.io/user-guide/kubernetes/&#34;&gt;Kubernetes Ingress Controller-TrÃ¦fÉªk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.kubernetes.io/2016/03/Kubernetes-1.2-and-simplifying-advanced-networking-with-Ingress.html&#34;&gt;Kubernetes 1.2 and simplifying advanced networking with Ingress&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>