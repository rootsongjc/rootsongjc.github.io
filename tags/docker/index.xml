<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song - Cloud Native | Open Source | Community â€“ docker</title>
    <link>https://jimmysong.io/tags/docker/</link>
    <description>Recent content in docker on Jimmy Song - Cloud Native | Open Source | Community</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <copyright>Copyright &amp;copy; 2020 Jimmy Song ä¿ç•™æ‰€æœ‰æƒåˆ©ï¼›åŸºäº Hugo [educenter](https://github.com/themefisher/educenter-hugo)  ä¸»é¢˜æ„å»º</copyright>
    <lastBuildDate>Thu, 06 Dec 2018 21:08:02 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/tags/docker/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>CentOS7å®˜æ–¹Dockerå‘è¡Œç‰ˆç°é‡å¤§Bugå¯è‡´Kubernetesä¸­çš„å¥åº·æ£€æµ‹æ¢é’ˆå¤±è´¥å¹¶å½±å“å®¹å™¨äº¤äº’</title>
      <link>https://jimmysong.io/blog/docker-exec-bug-on-centos7/</link>
      <pubDate>Thu, 06 Dec 2018 21:08:02 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-exec-bug-on-centos7/</guid>
      <description>
        
        
        

&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/openshift/origin/issues/21590&#34;&gt;Cannot ssh into a running pod/container &amp;ndash; rpc error: code = 2 desc = oci runtime error: exec failed: container_linux.go:247: starting container process caused &amp;ldquo;process_linux.go:110: decoding init error from pipe caused \&amp;ldquo;read parent: connection reset by peer\&amp;ldquo;&amp;rdquo; command terminated with exit code 126 #21590&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;bug-å½±å“&#34;&gt;Bug å½±å“&lt;/h2&gt;

&lt;p&gt;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ CentOS7ï¼Œéœ€è¦ç”¨åˆ° &lt;code&gt;kubectl exec&lt;/code&gt; æˆ–è€…ä¸º Pod é…ç½®äº†&lt;strong&gt;åŸºäºå‘½ä»¤è¿”å›å€¼&lt;/strong&gt;çš„å¥åº·æ£€æŸ¥ï¼ˆéå¸¸ç”¨çš„ HTTP Get æ–¹å¼ï¼‰çš„è¯ï¼Œè¯¥ Bug å°†å¯¼è‡´å‘½ä»¤è¿”å›é”™è¯¯ï¼ŒPod æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œå¼•èµ·å¤§è§„æ¨¡æ•…éšœï¼Œè€Œä¸”ä¹Ÿæ— æ³•ä½¿ç”¨ &lt;code&gt;kubectl exec&lt;/code&gt; æˆ–è€… &lt;code&gt;docker exec&lt;/code&gt; ä¸å®¹å™¨äº¤äº’ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ä¸‹é¢çš„å¥åº·æ£€æŸ¥é…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;   livenessProbe:
     exec:
       command:
       - /usr/local/bin/sidecar-injector
       - probe
       - --probe-path=/health
       - --interval=4s
     failureThreshold: 3
     initialDelaySeconds: 10
     periodSeconds: 4
     successThreshold: 1
     timeoutSeconds: 1
   readinessProbe:
     exec:
       command:
       - /usr/local/bin/sidecar-injector
       - probe
       - --probe-path=/health
       - --interval=4s
     failureThreshold: 3
     initialDelaySeconds: 10
     periodSeconds: 4
     successThreshold: 1
     timeoutSeconds: 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»¥ä¸Š YAML é…ç½®æ‘˜è‡ª &lt;a href=&#34;https://istio.io/zh&#34;&gt;Istio&lt;/a&gt; å‘è¡Œç‰ˆä¸­çš„ &lt;code&gt;istio-demo.yaml&lt;/code&gt; æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h2 id=&#34;bug-æˆå› &#34;&gt;Bug æˆå› &lt;/h2&gt;

&lt;p&gt;æ ¹æ® &lt;a href=&#34;https://bugzilla.redhat.com/show_bug.cgi?id=1655214&#34;&gt;RedHat çš„ Bug æŠ¥å‘Š&lt;/a&gt;ï¼Œå¯¼è‡´è¯¥ Bug çš„åŸå› æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;CentOS7 å‘è¡Œç‰ˆä¸­çš„ Docker ä½¿ç”¨çš„ docker-runc äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨æ—§ç‰ˆæœ¬çš„ golang æ„å»ºçš„ï¼Œè¿™é‡Œé¢ä¸€äº›å¯èƒ½å¯¼è‡´  &lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/FIPS_Mode_-_an_explanation&#34;&gt;FIPS æ¨¡å¼&lt;/a&gt;å´©æºƒçš„é”™è¯¯ã€‚&lt;/p&gt;

&lt;p&gt;è‡³äºè¯¥ Bug æ˜¯å¦‚ä½•è§¦å‘çš„å®˜æ–¹åªæ˜¯è¯´å› ä¸ºæŸäº›é•œåƒå¯¼è‡´çš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‘ç°è¿‡ç¨‹&#34;&gt;å‘ç°è¿‡ç¨‹&lt;/h2&gt;

&lt;p&gt;æœ¬å‘¨ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/appendix/kubernetes-1.13-changelog.html&#34;&gt;Kubernetes 1.13&lt;/a&gt; å‘å¸ƒï¼Œæƒ³ç€æ›´æ–°ä¸‹æˆ‘çš„ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; ä½¿ç”¨ Vagrant å’Œ VirtualBox åœ¨æœ¬åœ°æ­å»ºåˆ†å¸ƒå¼ Kubernetes 1.13 é›†ç¾¤å’Œ &lt;a href=&#34;https://istio.io/zh&#34;&gt;Istio&lt;/a&gt; Service Mesh çš„æœ€æ–°ç‰ˆæœ¬ 1.0.4ï¼Œ å¯æ˜¯åœ¨å®‰è£… Istio çš„æ—¶å€™å‘ç° Istio æœ‰ä¸¤ä¸ª Pod å¯åŠ¨ä¸èµ·æ¥ï¼Œ&lt;code&gt;istio-sidecar-injector&lt;/code&gt; å’Œ &lt;code&gt;istio-galley&lt;/code&gt; è¿™ä¸¤ä¸ª Podï¼Œæ£€æŸ¥å…¶å¯åŠ¨è¿‡ç¨‹ï¼Œå‘ç°å®ƒä»¬éƒ½æ˜¯å› ä¸º Readiness Probe å’Œ Liveness Probe å¤±è´¥å¯¼è‡´çš„ã€‚å†è”æƒ³åˆ°ä¹‹å‰å®‰è£…è¾ƒè€ç‰ˆæœ¬çš„ Istio çš„æ—¶å€™ä¹Ÿé‡åˆ°è¯¥é—®é¢˜ï¼Œè§ &lt;a href=&#34;https://github.com/istio/istio/pull/6610&#34;&gt;Increase health probe interval #6610&lt;/a&gt; é€šè¿‡å¢åŠ å¥åº·æ£€æŸ¥çš„æ—¶é—´é—´éš”å¯ä»¥è§£å†³è¯¥é—®é¢˜ï¼Œå¯æ˜¯ç»è¿‡åå¤çš„æµ‹è¯•åå‘ç°è¿˜æ˜¯ä¸è¡Œã€‚ç„¶åæˆ‘æƒ³åˆ°å…ˆå»æ‰å¥åº·æ£€æŸ¥ï¼Œç„¶åæˆ‘æ‰‹åŠ¨ä½¿ç”¨ &lt;code&gt;kubectl exec&lt;/code&gt; æ¥æ‰§è¡Œå¥åº·æ£€æŸ¥çš„å‘½ä»¤ï¼Œè§£å†³å´é‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl exec -it istio-sidecar-injector-6fc974b6c8-pts4t -- istio-sidecar-injector-b484dfcbb-9x9l9 probe --probe-path=/health --interval=4s
Cannot ssh into a running pod/container -- rpc error: code = 2 desc = oci runtime error: exec failed: container_linux.go:247: starting container process caused &amp;quot;process_linux.go:110: decoding init error from pipe caused &amp;quot;read parent: connection reset by peer&amp;quot;&amp;quot; command terminated with exit code 126
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åç›´æ¥åˆ° Pod æ‰€åœ¨çš„ä¸»æœºä½¿ç”¨ &lt;code&gt;docker exec&lt;/code&gt; å‘½ä»¤æ‰§è¡Œï¼Œä¾ç„¶æŠ¥ä¸Šé¢çš„é”™è¯¯ï¼Œæˆ‘å°±ç¡®å®šè¿™ä¸æ˜¯ Kubernetes çš„é—®é¢˜äº†ã€‚æ›´ä½•å†µå‰ä¹‹å‰ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; å±¡è¯•ä¸çˆ½ï¼Œçªç„¶å‡ºç°é—®é¢˜ï¼Œæœ‰ç‚¹è®©äººæ‘¸ä¸ç€å¤´è„‘ã€‚çŸ¥é“æˆ‘æœåˆ°äº†è¿™ä¸ªå››å¤©å‰æ‰æœ‰äººæå‡ºçš„ &lt;a href=&#34;https://github.com/openshift/origin/issues/21590&#34;&gt;issue&lt;/a&gt;ã€‚æ ¹æ®ç½‘å‹åé¦ˆï¼Œç°åœ¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; ä¸­å·²ç»é€šè¿‡é™çº§ Docker çš„æ–¹å¼ä¸´æ—¶ä¿®å¤äº†è¯¥é—®é¢˜ï¼Œå¹¶æ”¯æŒ Kubernetes 1.13 å’Œ  Istio 1.0.4ï¼Œæ¬¢è¿è¯•ç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;è§£å†³æ–¹æ³•&#34;&gt;è§£å†³æ–¹æ³•&lt;/h2&gt;

&lt;p&gt;æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼Œéƒ½éœ€è¦æ›¿æ¢ Docker ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸€ã€é™çº§åˆ°æ—§çš„ RedHat CentOS å®˜æ–¹æºä¸­çš„ Docker ç‰ˆæœ¬&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å°† RedHat å®˜æ–¹æºä¸­çš„ Docker ç‰ˆæœ¬é™çº§ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ‰€æœ‰çš„é…ç½®æ— éœ€æ”¹åŠ¨ï¼Œå‚è€ƒ &lt;a href=&#34;https://github.com/openshift/origin/issues/21590&#34;&gt;https://github.com/openshift/origin/issues/21590&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æŸ¥çœ‹ Docker ç‰ˆæœ¬ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ rpm -qa | grep -i docker
docker-common-1.13.1-84.git07f3374.el7.centos.x86_64
docker-client-1.13.1-84.git07f3374.el7.centos.x86_64
docker-1.13.1-84.git07f3374.el7.centos.x86_64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é™çº§ Docker ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;yum downgrade docker-1.13.1-75.git8633870.el7.centos.x86_64 docker-client-1.13.1-75.git8633870.el7.centos.x86_64 docker-common-1.13.1-75.git8633870.el7.centos.x86_64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é™çº§ä¹‹åå†æŸ¥çœ‹ Docker ç‰ˆæœ¬ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ rpm -qa | grep -i docker
docker-common-1.13.1-75.git8633870.el7.centos.x86_64
docker-1.13.1-75.git8633870.el7.centos.x86_64
docker-client-1.13.1-75.git8633870.el7.centos.x86_64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ­¤ä¸ºä¸´æ—¶è§£å†³æ–¹æ³•ï¼ŒRedHat ä¹Ÿåœ¨ç€æ‰‹è§£å†³è¯¥é—®é¢˜ï¼Œä¸ºäº†å¯èƒ½ä¼šæä¾›è¡¥ä¸ï¼Œè§ &lt;a href=&#34;https://bugzilla.redhat.com/show_bug.cgi?id=1655214&#34;&gt;&lt;strong&gt;Bug 1655214&lt;/strong&gt;&lt;/a&gt; - docker exec does not work with registry.access.redhat.com/rhel7:7.3ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;äºŒã€æ›´æ–°åˆ° Docker-CE&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼ŒDocker è‡ª1.13ç‰ˆæœ¬ä¹‹åæ›´æ”¹äº†ç‰ˆæœ¬çš„å‘½åæ–¹å¼ï¼Œä¹Ÿæä¾›äº†å®˜æ–¹çš„ CentOS æºï¼Œæ›¿æ¢ä¸º Docker-CE äº¦å¯è§£å†³è¯¥é—®é¢˜ï¼Œä¸è¿‡ Docker-CE çš„é…ç½®å¯èƒ½ä¼šä¸ Docker 1.13 æœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34;&gt;é…ç½®Podçš„livenesså’Œreadinessæ¢é’ˆ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bugzilla.redhat.com/show_bug.cgi?id=1655214&#34;&gt;Bug 1655214 - docker exec does not work with registry.access.redhat.com/rhel7:7.3 - redhat.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34;&gt;kubernetes-vagrant-centos-cluster - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/FIPS_Mode_-_an_explanation&#34;&gt;FIPS Mode - an explanation - mozilla.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>dockerç”¨æˆ·è¿‡æ¸¡åˆ°kubectlå‘½ä»¤è¡ŒæŒ‡å—</title>
      <link>https://jimmysong.io/blog/docker-cli-to-kubectl/</link>
      <pubDate>Sat, 16 Sep 2017 20:54:06 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-cli-to-kubectl/</guid>
      <description>
        
        
        

&lt;p&gt;å¯¹äºæ²¡æœ‰ä½¿ç”¨è¿‡ kubernetes çš„ docker ç”¨æˆ·ï¼Œå¦‚ä½•å¿«é€ŸæŒæ¡ kubectl å‘½ä»¤ï¼Ÿkubectl è·Ÿ docker å‘½ä»¤ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘ docker-cli ç”¨æˆ·ä»‹ç» Kubernetes å‘½ä»¤è¡Œå¦‚ä½•ä¸ api è¿›è¡Œäº¤äº’ã€‚è¯¥å‘½ä»¤è¡Œå·¥å…·â€”â€”kubectlï¼Œè¢«è®¾è®¡æˆ docker-cli ç”¨æˆ·æ‰€ç†Ÿæ‚‰çš„æ ·å­ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´åˆå­˜åœ¨ä¸€äº›å¿…è¦çš„å·®å¼‚ã€‚è¯¥æ–‡æ¡£å°†å‘æ‚¨å±•ç¤ºæ¯ä¸ª docker å­å‘½ä»¤å’Œ kubectl ä¸å…¶ç­‰æ•ˆçš„å‘½ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä½¿ç”¨ kubernetes é›†ç¾¤çš„æ—¶å€™ï¼Œdocker å‘½ä»¤é€šå¸¸æƒ…å†µæ˜¯ä¸éœ€è¦ç”¨åˆ°çš„ï¼Œåªæœ‰åœ¨è°ƒè¯•ç¨‹åºæˆ–è€…å®¹å™¨çš„æ—¶å€™ç”¨åˆ°ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä½¿ç”¨ kubectl å‘½ä»¤å³å¯ï¼Œæ‰€ä»¥åœ¨æ“ä½œ kubernetes çš„æ—¶å€™æˆ‘ä»¬æŠ›å¼ƒåŸå…ˆä½¿ç”¨ docker æ—¶çš„ä¸€äº›è§‚å¿µã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-run&#34;&gt;docker run&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è¿è¡Œä¸€ä¸ª nginx Deployment å¹¶å°†å…¶æš´éœ²å‡ºæ¥ï¼Ÿ æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl&#34;&gt;kubectl run&lt;/a&gt; ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker run -d --restart=always -e DOMAIN=cluster --name nginx-app -p 80:80 nginx
a9ec34d9878748d2f33dc20cb25c714ff21da8d40558b45bfaec9955859075d0
$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   2 seconds ago       Up 2 seconds        0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# start the pod running nginx
$ kubectl run --image=nginx nginx-app --port=80 --env=&amp;quot;DOMAIN=cluster&amp;quot;
deployment &amp;quot;nginx-app&amp;quot; created
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨å¤§äºç­‰äº 1.2 ç‰ˆæœ¬ Kubernetes é›†ç¾¤ä¸­ï¼Œä½¿ç”¨&lt;code&gt;kubectl run&lt;/code&gt; å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º &amp;ldquo;nginx-app&amp;rdquo; çš„ Deploymentã€‚å¦‚æœæ‚¨è¿è¡Œçš„æ˜¯è€ç‰ˆæœ¬ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ª replication controllerã€‚ å¦‚æœæ‚¨æƒ³æ²¿ç”¨æ—§çš„è¡Œä¸ºï¼Œä½¿ç”¨ &lt;code&gt;--generation=run/v1&lt;/code&gt; å‚æ•°ï¼Œè¿™æ ·å°±ä¼šåˆ›å»º replication controllerã€‚æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;&lt;code&gt;kubectl run&lt;/code&gt;&lt;/a&gt; è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# expose a port through with a service
$ kubectl expose deployment nginx-app --port=80 --name=nginx-http
service &amp;quot;nginx-http&amp;quot; exposed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ kubectl å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/deployment&#34;&gt;Deployment&lt;/a&gt;ï¼Œè¿™å°†ä¿è¯æœ‰ N ä¸ªè¿è¡Œ nginx çš„ podï¼ˆN ä»£è¡¨ spec ä¸­å£°æ˜çš„ replica æ•°ï¼Œé»˜è®¤ä¸º 1ï¼‰ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/user-guide/services&#34;&gt;service&lt;/a&gt;ï¼Œä½¿ç”¨ selector åŒ¹é…å…·æœ‰ç›¸åº”çš„ selector çš„ Deploymentã€‚æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/quick-start&#34;&gt;å¿«é€Ÿå¼€å§‹&lt;/a&gt; è·å–æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹é•œåƒä¼šåœ¨åå°è¿è¡Œï¼Œä¸&lt;code&gt;docker run -d ...&lt;/code&gt; ç±»ä¼¼ï¼Œå¦‚æœæ‚¨æƒ³åœ¨å‰å°è¿è¡Œï¼Œä½¿ç”¨ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl run [-i] [--tty] --attach &amp;lt;name&amp;gt; --image=&amp;lt;image&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸ &lt;code&gt;docker run ...&lt;/code&gt; ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæŒ‡å®šäº† &lt;code&gt;--attach&lt;/code&gt; ï¼Œæˆ‘ä»¬å°†è¿æ¥åˆ° &lt;code&gt;stdin&lt;/code&gt;ï¼Œ&lt;code&gt;stdout&lt;/code&gt; å’Œ &lt;code&gt;stderr&lt;/code&gt;ï¼Œè€Œä¸èƒ½æ§åˆ¶å…·ä½“è¿æ¥åˆ°å“ªä¸ªè¾“å‡ºæµï¼ˆ&lt;code&gt;docker -a ...&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ Deployment å¯åŠ¨äº†å®¹å™¨ï¼Œå¦‚æœæ‚¨ç»ˆæ­¢äº†è¿æ¥åˆ°çš„è¿›ç¨‹ï¼ˆä¾‹å¦‚ &lt;code&gt;ctrl-c&lt;/code&gt;ï¼‰ï¼Œå®¹å™¨å°†ä¼šé‡å¯ï¼Œè¿™è·Ÿ &lt;code&gt;docker run -it&lt;/code&gt;ä¸åŒã€‚ å¦‚æœæƒ³é”€æ¯è¯¥ Deploymentï¼ˆå’Œå®ƒçš„ podï¼‰ï¼Œæ‚¨éœ€è¦è¿è¡Œ &lt;code&gt;kubeclt delete deployment &amp;lt;name&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-ps&#34;&gt;docker ps&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•åˆ—å‡ºå“ªäº›æ­£åœ¨è¿è¡Œï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl&#34;&gt;kubectl get&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   About an hour ago   Up About an hour    0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get po
NAME              READY     STATUS    RESTARTS   AGE
nginx-app-5jyvm   1/1       Running   0          1h
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;docker-attach&#34;&gt;docker attach&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è¿æ¥åˆ°å·²ç»è¿è¡Œåœ¨å®¹å™¨ä¸­çš„è¿›ç¨‹ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl&#34;&gt;kubectl attach&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   8 minutes ago       Up 8 minutes        0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
$ docker attach a9ec34d98787
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get pods
NAME              READY     STATUS    RESTARTS   AGE
nginx-app-5jyvm   1/1       Running   0          10m
$ kubectl attach -it nginx-app-5jyvm
...
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;docker-exec&#34;&gt;docker exec&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl exec&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   8 minutes ago       Up 8 minutes        0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
$ docker exec a9ec34d98787 cat /etc/hostname
a9ec34d98787
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get po
NAME              READY     STATUS    RESTARTS   AGE
nginx-app-5jyvm   1/1       Running   0          10m
$ kubectl exec nginx-app-5jyvm -- cat /etc/hostname
nginx-app-5jyvm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œäº¤äº’å¼å‘½ä»¤æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker exec -ti a9ec34d98787 /bin/sh
# exit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl exec -ti nginx-app-5jyvm -- /bin/sh      
# exit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/tasks/kubectl/get-shell-running-container&#34;&gt;è·å–è¿è¡Œä¸­å®¹å™¨çš„ Shell ç¯å¢ƒ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-logs&#34;&gt;docker logs&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•æŸ¥çœ‹è¿è¡Œä¸­è¿›ç¨‹çš„ stdout/stderrï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl logs&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker logs -f a9e
192.168.9.1 - - [14/Jul/2015:01:04:02 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.35.0&amp;quot; &amp;quot;-&amp;quot;
192.168.9.1 - - [14/Jul/2015:01:04:03 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.35.0&amp;quot; &amp;quot;-&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl logs -f nginx-app-zibvs
10.240.63.110 - - [14/Jul/2015:01:09:01 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
10.240.63.110 - - [14/Jul/2015:01:09:02 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨æ˜¯æ—¶å€™æä¸€ä¸‹ pod å’Œå®¹å™¨ä¹‹é—´çš„ç»†å¾®å·®åˆ«äº†ï¼›é»˜è®¤æƒ…å†µä¸‹å¦‚æœ pod ä¸­çš„è¿›ç¨‹é€€å‡º pod ä¹Ÿä¸ä¼šç»ˆæ­¢ï¼Œç›¸åå®ƒå°†ä¼šé‡å¯è¯¥è¿›ç¨‹ã€‚è¿™ç±»ä¼¼äº docker run æ—¶çš„ &lt;code&gt;--restart=always&lt;/code&gt; é€‰é¡¹ï¼Œ è¿™æ˜¯ä¸»è¦å·®åˆ«ã€‚åœ¨ docker ä¸­ï¼Œè¿›ç¨‹çš„æ¯ä¸ªè°ƒç”¨çš„è¾“å‡ºéƒ½æ˜¯è¢«è¿æ¥èµ·æ¥çš„ï¼Œä½†æ˜¯å¯¹äº kubernetesï¼Œæ¯ä¸ªè°ƒç”¨éƒ½æ˜¯åˆ†å¼€çš„ã€‚è¦æŸ¥çœ‹ä»¥å‰åœ¨ kubernetes ä¸­æ‰§è¡Œçš„è¾“å‡ºï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl logs --previous nginx-app-zibvs
10.240.63.110 - - [14/Jul/2015:01:09:01 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
10.240.63.110 - - [14/Jul/2015:01:09:02 +0000] &amp;quot;GET / HTTP/1.1&amp;quot; 200 612 &amp;quot;-&amp;quot; &amp;quot;curl/7.26.0&amp;quot; &amp;quot;-&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/logging&#34;&gt;è®°å½•å’Œç›‘æ§é›†ç¾¤æ´»åŠ¨&lt;/a&gt; è·å–æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-stop-å’Œ-docker-rm&#34;&gt;docker stop å’Œ docker rm&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•åœæ­¢å’Œåˆ é™¤è¿è¡Œä¸­çš„è¿›ç¨‹ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl delete&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
a9ec34d98787        nginx               &amp;quot;nginx -g &#39;daemon of   22 hours ago        Up 22 hours         0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   nginx-app
$ docker stop a9ec34d98787
a9ec34d98787
$ docker rm a9ec34d98787
a9ec34d98787
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl get deployment nginx-app
NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-app   1         1         1            1           2m
$ kubectl get po -l run=nginx-app
NAME                         READY     STATUS    RESTARTS   AGE
nginx-app-2883164633-aklf7   1/1       Running   0          2m
$ kubectl delete deployment nginx-app
deployment &amp;quot;nginx-app&amp;quot; deleted
$ kubectl get po -l run=nginx-app
# Return nothing
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ç›´æ¥åˆ é™¤ podã€‚ä½¿ç”¨ kubectl å‘½ä»¤ï¼Œæˆ‘ä»¬è¦åˆ é™¤æ‹¥æœ‰è¯¥ pod çš„ Deploymentã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥åˆ é™¤podï¼ŒDeployment å°†ä¼šé‡æ–°åˆ›å»ºè¯¥ podã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-login&#34;&gt;docker login&lt;/h4&gt;

&lt;p&gt;åœ¨ kubectl ä¸­æ²¡æœ‰å¯¹ &lt;code&gt;docker login&lt;/code&gt; çš„ç›´æ¥æ¨¡æ‹Ÿã€‚å¦‚æœæ‚¨æœ‰å…´è¶£åœ¨ç§æœ‰é•œåƒä»“åº“ä¸­ä½¿ç”¨ Kubernetesï¼Œè¯·å‚é˜… &lt;a href=&#34;https://kubernetes.io/docs/concepts/containers/images/#using-a-private-registry&#34;&gt;ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;docker-version&#34;&gt;docker version&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç‰ˆæœ¬ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl version&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker version
Client version: 1.7.0
Client API version: 1.19
Go version (client): go1.4.2
Git commit (client): 0baf609
OS/Arch (client): linux/amd64
Server version: 1.7.0
Server API version: 1.19
Go version (server): go1.4.2
Git commit (server): 0baf609
OS/Arch (server): linux/amd64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl version
Client Version: version.Info{Major:&amp;quot;1&amp;quot;, Minor:&amp;quot;6&amp;quot;, GitVersion:&amp;quot;v1.6.9+a3d1dfa6f4335&amp;quot;, GitCommit:&amp;quot;9b77fed11a9843ce3780f70dd251e92901c43072&amp;quot;, GitTreeState:&amp;quot;dirty&amp;quot;, BuildDate:&amp;quot;2017-08-29T20:32:58Z&amp;quot;, OpenPaasKubernetesVersion:&amp;quot;v1.03.02&amp;quot;, GoVersion:&amp;quot;go1.7.5&amp;quot;, Compiler:&amp;quot;gc&amp;quot;, Platform:&amp;quot;linux/amd64&amp;quot;}
Server Version: version.Info{Major:&amp;quot;1&amp;quot;, Minor:&amp;quot;6&amp;quot;, GitVersion:&amp;quot;v1.6.9+a3d1dfa6f4335&amp;quot;, GitCommit:&amp;quot;9b77fed11a9843ce3780f70dd251e92901c43072&amp;quot;, GitTreeState:&amp;quot;dirty&amp;quot;, BuildDate:&amp;quot;2017-08-29T20:32:58Z&amp;quot;, OpenPaasKubernetesVersion:&amp;quot;v1.03.02&amp;quot;, GoVersion:&amp;quot;go1.7.5&amp;quot;, Compiler:&amp;quot;gc&amp;quot;, Platform:&amp;quot;linux/amd64&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;docker-info&#34;&gt;docker info&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è·å–æœ‰å…³ç¯å¢ƒå’Œé…ç½®çš„å„ç§ä¿¡æ¯ï¼ŸæŸ¥çœ‹ &lt;a href=&#34;https://kubernetes.io/docs/user-guide/kubectl/&#34;&gt;kubectl cluster-info&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ docker å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker info
Containers: 40
Images: 168
Storage Driver: aufs
 Root Dir: /usr/local/google/docker/aufs
 Backing Filesystem: extfs
 Dirs: 248
 Dirperm1 Supported: false
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 3.13.0-53-generic
Operating System: Ubuntu 14.04.2 LTS
CPUs: 12
Total Memory: 31.32 GiB
Name: k8s-is-fun.mtv.corp.google.com
ID: ADUV:GCYR:B3VJ:HMPO:LNPQ:KD5S:YKFQ:76VN:IANZ:7TFV:ZBF4:BYJO
WARNING: No swap limit support
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ kubectl å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ kubectl cluster-info
Kubernetes master is running at https://108.59.85.141
KubeDNS is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/kube-dns/proxy
KubeUI is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/kube-ui/proxy
Grafana is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy
Heapster is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/monitoring-heapster/proxy
InfluxDB is running at https://108.59.85.141/api/v1/namespaces/kube-system/services/monitoring-influxdb/proxy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ¬æ–‡åŒæ—¶å½’æ¡£åˆ° &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook&#34;&gt;kubernetes-handbook&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/rootsongjc/kubernetes.github.io/blob/master/docs/user-guide/docker-cli-to-kubectl.md&#34;&gt;é˜…è¯»åŸæ–‡&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Dockeræºç åˆ†æç¬¬ä¸€ç¯‡â€”â€”ä»£ç ç»“æ„</title>
      <link>https://jimmysong.io/blog/docker-source-code-analysis-code-structure/</link>
      <pubDate>Sun, 19 Mar 2017 23:00:29 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-source-code-analysis-code-structure/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ä¹‹å‰é™†é™†ç»­ç»­çœ‹è¿‡ä¸€ç‚¹&lt;strong&gt;docker&lt;/strong&gt;çš„æºç ï¼Œéƒ½æœªæˆä½“ç³»ï¼Œæœ€è¿‘åœ¨ç ”ç©¶&lt;strong&gt;Docker-17.03-CE&lt;/strong&gt;ï¼Œè¶æ­¤æœºä¼šç ”ç©¶ä¸‹dockerçš„æºç ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€äº›ç›¸å…³èµ„æ–™ï¼Œéƒ½æ¯”è¾ƒè¿‡æ—¶äº†ï¼Œå‘ç°&lt;strong&gt;å­™å®äº®&lt;/strong&gt;å†™è¿‡ä¸€æœ¬ä¹¦å«ã€ŠDockeræºç åˆ†æã€‹ï¼Œè€Œä¸”ä¹‹å‰ä¹Ÿåœ¨&lt;strong&gt;InfoQ&lt;/strong&gt;ä¸Šé™†ç»­å‘è¿‡ä¸€äº›æ–‡ç« ï¼Œè™½ç„¶æ–‡ç« éƒ½æ¯”è¾ƒè€äº†ï¼ŒåŸºäºè€çš„dockerç‰ˆæœ¬ï¼Œä½†æˆ‘è®¤ä¸ºä¾ç„¶æœ‰é˜…è¯»çš„ä»·å€¼ã€‚èµ·ç èƒ½æœ‰è¿™ä¸‰æ–¹é¢æ”¶è·ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä¸€æ˜¯åŸ¹å…»é˜…è¯»æºç çš„æ€ç»´æ–¹å¼ï¼Œä¸ºè‡ªå·±é˜…è¯»dockeræºç æä¾›å€Ÿé‰´ã€‚&lt;/li&gt;
&lt;li&gt;äºŒæ˜¯å¯ä»¥äº†è§£dockerç‰ˆæœ¬çš„æ¥é¾™å»è„‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸‰è¿˜å¯ä»¥ä½œä¸ºGoè¯­è¨€é¡¹ç›®å¼€å‘ä½œä¸ºå€Ÿé‰´ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ä¸‹è½½åœ°å€&#34;&gt;ä¸‹è½½åœ°å€&lt;/h3&gt;

&lt;p&gt;é‰´äºæˆªæ­¢æœ¬æ–‡å‘ç¨¿æ—¶è¿™æœ¬ä¹¦å·²ç»å‘è¡Œä¸€å¹´åŠäº†äº†ï¼ŒåŸºäºçš„dockerç‰ˆæœ¬è¿˜æ˜¯&lt;strong&gt;1.2.0&lt;/strong&gt;ï¼Œè€Œå¦‚ä»Šéƒ½åˆ°äº†&lt;strong&gt;1.13.0&lt;/strong&gt;ï¼ˆdocker17.03çš„è€ç‰ˆæœ¬å·ï¼‰ï¼Œåº”è¯¥å¾ˆå°‘æœ‰äººä¹°äº†å§ï¼Œå¯ä»¥è¯´è¿™æœ¬ä¹¦çš„çº¸è´¨ç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå·®ä¸å¤šäº†å§ã€‚å¦‚æœæœ‰äººæ„Ÿå…´è¶£å¯ä»¥åˆ°ç½‘ä¸Šæ‰¾æ‰¾çœ‹çœ‹ï¼ŒDockeræºç è§£æ-æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾-å­™å®äº®è‘—-2015å¹´8æœˆï¼ˆå®Œæ•´æ–‡å­—ç‰ˆï¼Œå¤§å°25.86Mï¼‰ï¼ŒDockeræºç è§£æ-çœ‹äº‘æ•´ç†ç‰ˆï¼ˆæ–‡å­—ç‰ˆï¼Œæœ‰ç¼©ç•¥ï¼Œå¤§å°7.62Mï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;out-of-date&#34;&gt;Out-of-date&lt;/h2&gt;

&lt;p&gt;æœ‰ä¸€ç‚¹å¿…é¡»å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œè¿™æœ¬ä¹¦ä¸­çš„dockeræºç åˆ†ææ˜¯åŸºäº&lt;strong&gt;docker1.2.0&lt;/strong&gt;ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬çš„dockeræºç åœ¨githubä¸Šå·²ç»æ— æ³•ä¸‹è½½åˆ°äº†ï¼Œgithubä¸Šavailableçš„æœ€ä½ç‰ˆæœ¬çš„dockeræºç æ˜¯&lt;strong&gt;1.4.1&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;é¡ºä¾¿æ„Ÿå¹ä¸€å¥ï¼Œç§‘æŠ€è¡Œä¸šå‘å±•å®åœ¨å¤ªå¿«äº†ï¼Œå°¤å…¶æ˜¯äº’è”ç½‘ï¼Œä¸€æœ¬ä¹¦èƒ½è¿ç»­ç”¨ä¸Šä¸‰å¹´éƒ½ä¸è¿‡æ—¶ï¼Œå¦‚æœè¿™æ ·çš„è¯é‚£ä¹ˆè¿™é—¨æŠ€æœ¯ææ€•éƒ½å°±è¦è¢«æ·˜æ±°äº†å§ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;æ€»ä½“æ¶æ„&#34;&gt;æ€»ä½“æ¶æ„&lt;/h2&gt;

&lt;p&gt;Dockeræ€»ä½“ä¸Šæ˜¯ç”¨çš„æ˜¯&lt;strong&gt;Client/Server&lt;/strong&gt;æ¨¡å¼ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½å¯ä»¥é€šè¿‡RESTfulæ¥å£ä¼ é€’ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªDockerè½¯ä»¶çš„æ¶æ„ä¸­å¯ä»¥åˆ†æˆä¸‰ä¸ªè§’è‰²ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Daemon&lt;/strong&gt;ï¼šå¸¸é©»åå°è¿è¡Œçš„è¿›ç¨‹ï¼Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç®¡ç†dockerå®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Clien&lt;/strong&gt;tï¼šå‘½ä»¤è¡Œç»ˆç«¯ï¼ŒåŒ…è£…å‘½ä»¤å‘é€APIè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Engine&lt;/strong&gt;ï¼šçœŸæ­£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„åç«¯ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ä»£ç ç»“æ„&#34;&gt;ä»£ç ç»“æ„&lt;/h2&gt;

&lt;p&gt;Dockerçš„ä»£ç ç»“æ„æ¯”è¾ƒæ¸…æ™°ï¼Œåˆ†æˆçš„ç›®å½•æ¯”è¾ƒå¤šï¼Œæœ‰ä»¥ä¸‹è¿™äº›ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;api&lt;/strong&gt;ï¼šå®šä¹‰APIï¼Œä½¿ç”¨äº†&lt;strong&gt;Swagger2.0&lt;/strong&gt;è¿™ä¸ªå·¥å…·æ¥ç”ŸæˆAPIï¼Œé…ç½®æ–‡ä»¶åœ¨&lt;code&gt;api/swagger.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;builder&lt;/strong&gt;ï¼šç”¨æ¥build dockeré•œåƒçš„åŒ…ï¼Œçœ‹æ¥å†å²æ¯”è¾ƒæ‚ ä¹…äº†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bundles&lt;/strong&gt;ï¼šè¿™ä¸ªåŒ…æ˜¯åœ¨è¿›è¡Œ&lt;a href=&#34;https://jimmysong.io/posts/docker-dev-env/&#34;&gt;dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒæ­å»º&lt;/a&gt;çš„æ—¶å€™ç”¨åˆ°çš„ï¼Œç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶éƒ½åœ¨è¿™é‡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cli&lt;/strong&gt;ï¼šä½¿ç”¨&lt;a href=&#34;http://www.github.com/spf13/cobra&#34;&gt;cobra&lt;/a&gt;å·¥å…·ç”Ÿæˆçš„dockerå®¢æˆ·ç«¯å‘½ä»¤è¡Œè§£æå™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;ï¼šæ¥æ”¶&lt;code&gt;cli&lt;/code&gt;çš„è¯·æ±‚ï¼Œè°ƒç”¨RESTful APIä¸­çš„æ¥å£ï¼Œå‘serverç«¯å‘é€httpè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cmd&lt;/strong&gt;ï¼šå…¶ä¸­åŒ…æ‹¬&lt;code&gt;docker&lt;/code&gt;å’Œ&lt;code&gt;dockerd&lt;/code&gt;ä¸¤ä¸ªåŒ…ï¼Œä»–ä»¬åˆ†åˆ«åŒ…å«äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„mainå‡½æ•°å…¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;container&lt;/strong&gt;ï¼šå®¹å™¨çš„é…ç½®ç®¡ç†ï¼Œå¯¹ä¸åŒçš„platformé€‚é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;contrib&lt;/strong&gt;ï¼šè¿™ä¸ªç›®å½•åŒ…æ‹¬ä¸€äº›æœ‰ç”¨çš„è„šæœ¬ã€é•œåƒå’Œå…¶ä»–édocker coreä¸­çš„éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;daemon&lt;/strong&gt;ï¼šè¿™ä¸ªåŒ…ä¸­å°†docker deamonè¿è¡Œæ—¶çŠ¶æ€exposeå‡ºæ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;distribution&lt;/strong&gt;ï¼šè´Ÿè´£dockeré•œåƒçš„pullã€pushå’Œé•œåƒä»“åº“çš„ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dockerversion&lt;/strong&gt;ï¼šç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;docs&lt;/strong&gt;ï¼šæ–‡æ¡£ã€‚è¿™ä¸ªç›®å½•å·²ç»ä¸å†ç»´æŠ¤ï¼Œæ–‡æ¡£åœ¨&lt;a href=&#34;https://github.com/docker/docker.github.io/&#34;&gt;å¦ä¸€ä¸ªä»“åº“é‡Œ&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;experimental&lt;/strong&gt;ï¼šä»docker1.13.0ç‰ˆæœ¬èµ·å¼€å§‹å¢åŠ äº†å®éªŒç‰¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;hack&lt;/strong&gt;ï¼šåˆ›å»ºdockerå¼€å‘ç¯å¢ƒå’Œç¼–è¯‘æ‰“åŒ…æ—¶ç”¨åˆ°çš„è„šæœ¬å’Œé…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;image&lt;/strong&gt;ï¼šç”¨äºæ„å»ºdockeré•œåƒçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;integration-cli&lt;/strong&gt;ï¼šé›†æˆæµ‹è¯•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;layer&lt;/strong&gt;ï¼šç®¡ç† union file system driverä¸Šçš„read-onlyå’Œread-write mountsã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;libcontainerd&lt;/strong&gt;ï¼šè®¿é—®å†…æ ¸ä¸­çš„å®¹å™¨ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;man&lt;/strong&gt;ï¼šç”Ÿæˆman pagesã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;migrate&lt;/strong&gt;ï¼šå°†è€ç‰ˆæœ¬çš„graphç›®å½•è½¬æ¢æˆæ–°çš„metadataã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;oci&lt;/strong&gt;ï¼šOpen Container Interfaceåº“&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;opts&lt;/strong&gt;ï¼šå‘½ä»¤è¡Œçš„é€‰é¡¹åº“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pkg&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;plugin&lt;/strong&gt;ï¼šdockeræ’ä»¶åç«¯å®ç°åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;profiles&lt;/strong&gt;ï¼šé‡Œé¢æœ‰apparmorå’Œseccompä¸¤ä¸ªç›®å½•ã€‚ç”¨äºå†…æ ¸è®¿é—®æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;project&lt;/strong&gt;ï¼šé¡¹ç›®ç®¡ç†çš„ä¸€äº›è¯´æ˜æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;reference&lt;/strong&gt;ï¼šå¤„ç†docker storeä¸­é•œåƒçš„referenceã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;registry&lt;/strong&gt;ï¼šdocker registryçš„å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;restartmanager&lt;/strong&gt;ï¼šå¤„ç†é‡å¯åçš„åŠ¨ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;runconfig&lt;/strong&gt;ï¼šé…ç½®æ ¼å¼è§£ç å’Œæ ¡éªŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;vendor&lt;/strong&gt;ï¼šå„ç§ä¾èµ–åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;volume&lt;/strong&gt;ï¼šdocker volumeçš„å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹ä¸€ç¯‡å°†è®²è§£dockerçš„å„ä¸ªåŠŸèƒ½æ¨¡å—å’ŒåŸç†ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Docker17.03CEä¸‹æ€ç§‘dockerç½‘ç»œæ’ä»¶contivè¶Ÿå‘ç»ˆæç‰ˆ</title>
      <link>https://jimmysong.io/blog/contiv-ultimate/</link>
      <pubDate>Fri, 17 Mar 2017 17:52:37 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/contiv-ultimate/</guid>
      <description>
        
        
        

&lt;p&gt;å‰å‡ å¤©å†™çš„å‡ ç¯‡&lt;a href=&#34;https://jimmysong.io/tags/contiv/&#34;&gt;å…³äºContivçš„æ–‡ç« &lt;/a&gt;å·²ç»æŠŠå¼•å…¥å‘äº†ğŸ˜‚&lt;/p&gt;

&lt;p&gt;ä»Šå¤©è¿™ç¯‡æ–‡ç« å°†å¸¦é¢†å¤§å®¶ç”¨æ­£ç¡®çš„å§¿åŠ¿ç¼–è¯‘å’Œæ‰“åŒ…ä¸€ä¸ª&lt;strong&gt;contiv netplugin&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¯·ä¸€å®šè¦åœ¨&lt;strong&gt;Linux&lt;/strong&gt;ç¯å¢ƒä¸­ç¼–è¯‘ã€‚dockerä¸­ç¼–è¯‘ä¹Ÿä¼šæŠ¥é”™ï¼Œæœ€å¥½è¿˜æ˜¯æä¸ªè™šæ‹ŸğŸ”å§ï¼Œæœ€å¥½è¿˜æœ‰VPNèƒ½ç¿»å¢™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç¯å¢ƒå‡†å¤‡&#34;&gt;ç¯å¢ƒå‡†å¤‡&lt;/h2&gt;

&lt;p&gt;æˆ‘ä½¿ç”¨çš„æ˜¯docker17.03-CEã€å®‰è£…äº†open vSwitch(è¿™ä¸ªåŒ…redhatçš„æºé‡Œæ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±çš„ç¼–è¯‘å®‰è£…)ï¼Œå¦‚æœä½ æ‡’å¾—ç¼–è¯‘å¯ä»¥ç”¨æˆ‘ç¼–è¯‘çš„rpmåŒ…ï¼Œ&lt;a href=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/openvswitch-2.5.0-2.el7.x86_64.rpm&#34;&gt;ç‚¹è¿™é‡Œä¸‹è½½&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç¼–è¯‘&#34;&gt;ç¼–è¯‘&lt;/h2&gt;

&lt;p&gt;è¿™ä¸€æ­¥æ˜¯å¾ˆå®¹æ˜“å¤±è´¥çš„ï¼Œæœ‰äººæè¿‡&lt;a href=&#34;https://github.com/contiv/netplugin/issues/779&#34;&gt;issue-779&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å…·ä½“æ­¥éª¤&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªlink &lt;strong&gt;/go&lt;/strong&gt;é“¾æ¥åˆ°ä½ çš„GOPATHç›®å½•ï¼Œä¸‹é¢ç¼–è¯‘çš„æ—¶å€™è¦ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;å°†æºç çš„&lt;strong&gt;vender&lt;/strong&gt;ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°$GOPATH/srcç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œç¼–è¯‘&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨netpluginç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤èƒ½å¤Ÿç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;NET_CONTAINER_BUILD=1 make build
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ä½ çš„&lt;strong&gt;/$GOPATH/bin&lt;/strong&gt;ç›®å½•ä¸‹åº”è¯¥ä¼šæœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;contivk8s  github-release  godep  golint  misspell  modelgen  netcontiv  netctl  netmaster  netplugin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;âš ï¸ç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ° æœ‰äº›åŒ…ä¸å­˜åœ¨æˆ–è€…éœ€è¦ç¿»å¢™ä¸‹è½½ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ‰“åŒ…&#34;&gt;æ‰“åŒ…&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬å°†å…¶æ‰“åŒ…ä¸ºdocker pluginã€‚&lt;/p&gt;

&lt;p&gt;Makefileé‡Œç”¨äºåˆ›å»ºplugin rootfsçš„å‘½ä»¤æ˜¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Makefile&#34;&gt;host-pluginfs-create:
        @echo dev: creating a docker v2plugin rootfs ...
        sh scripts/v2plugin_rootfs.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;v2plugin_rootfs.sh&lt;/strong&gt;è¿™ä¸ªè„šæœ¬çš„å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;#!/bin/bash
# Script to create the docker v2 plugin
# run this script from contiv/netplugin directory

echo &amp;quot;Creating rootfs for v2plugin &amp;quot;, ${CONTIV_V2PLUGIN_NAME}
cat install/v2plugin/config.template | grep -v &amp;quot;##&amp;quot; &amp;gt; install/v2plugin/config.json
sed -i &amp;quot;s%PluginName%${CONTIV_V2PLUGIN_NAME}%&amp;quot; install/v2plugin/config.json
cp bin/netplugin bin/netmaster bin/netctl install/v2plugin
docker build -t contivrootfs install/v2plugin
id=$(docker create contivrootfs true)
mkdir -p install/v2plugin/rootfs
sudo docker export &amp;quot;${id}&amp;quot; | sudo tar -x -C install/v2plugin/rootfs
docker rm -vf &amp;quot;${id}&amp;quot;
docker rmi contivrootfs
rm install/v2plugin/netplugin install/v2plugin/netmaster install/v2plugin/netctl
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…ˆæŠŠ&lt;code&gt;$GOPATH/bin&lt;/code&gt;ä¸‹ç”Ÿæˆçš„&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;netplugin&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;netmaster&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;netctl&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;netplugin&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°netpluginæºç çš„binç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œé¢ç”¨è¯­åˆ›å»ºcontivrootfsé•œåƒçš„Dockerfileå†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Dockerfile&#34;&gt;# Docker v2plugin container with OVS / netplugin / netmaster 

FROM alpine:3.5
MAINTAINER Cisco Contiv (http://contiv.github.io/)

RUN mkdir -p /run/docker/plugins /etc/openvswitch /var/run/contiv/log \
    &amp;amp;&amp;amp; echo &#39;http://dl-cdn.alpinelinux.org/alpine/v3.4/main&#39; &amp;gt;&amp;gt; /etc/apk/repositories \
    &amp;amp;&amp;amp; apk update &amp;amp;&amp;amp; apk add openvswitch=2.5.0-r0 iptables

COPY netplugin netmaster netctl startcontiv.sh /

ENTRYPOINT [&amp;quot;/startcontiv.sh&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;make host-pluginfs-create&lt;/code&gt;åˆ›å»ºrootfsã€‚&lt;/p&gt;

&lt;p&gt;åˆ›å»ºå‡ºäº†rootfsåï¼Œç„¶åæ‰§è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker plugin create localhost:5000/contiv/netplugin .
docker push localhost:5000/contiv/netplugin
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šæˆ‘ä»¬å°†æ’ä»¶pushåˆ°docker registryçš„é•œåƒä»“åº“ä¸­ï¼Œå½“å‰&lt;a href=&#34;www.github.com/vmware/harbor&#34;&gt;Harbor&lt;/a&gt;è¿˜ä¸æ”¯æŒdockeræ’ä»¶çš„pushã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;Install plugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ç¼–è¯‘å’Œå®‰è£…æˆ‘è‡ªå·±ç”Ÿæˆv2pluginçš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹&lt;strong&gt;config.json&lt;/strong&gt;æ–‡ä»¶ä¸­çš„&lt;code&gt;plugin_name&lt;/code&gt;å­—æ®µçš„å€¼ä¸ºæ’ä»¶çš„åç§°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$docker plugin install localhost:5000/contiv/v2plugin 
Plugin &amp;quot;localhost:5000/contiv/v2plugin&amp;quot; is requesting the following privileges:
 - network: [host]
 - mount: [/etc/openvswitch]
 - mount: [/var/log/openvswitch]
 - mount: [/var/run]
 - mount: [/lib/modules]
 - capabilities: [CAP_SYS_ADMIN CAP_NET_ADMIN CAP_SYS_MODULE]
Do you grant the above permissions? [y/N] y
latest: Pulling from contiv/v2plugin
fd87a71d9090: Download complete 
Digest: sha256:b13ad7930f771c9602acf562c2ae147482466f4d94e708692a215935663215a6
Status: Downloaded newer image for localhost:5000/contiv/v2plugin:latest
Installed plugin localhost:5000/contiv/v2plugin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡ªå·±createçš„æ’ä»¶enableçš„æ—¶å€™ä»docker daemonçš„æ—¥å¿—ä¸­ä¾ç„¶å¯ä»¥çœ‹åˆ°ä¹‹å‰çœ‹åˆ°æ‰¾ä¸åˆ°socketçš„é”™è¯¯ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®æ˜¯æ²¡æœ‰ç”Ÿæˆã€‚å¦‚æœç›´æ¥ä½¿ç”¨&lt;code&gt;docker plugin install store/contiv/v2plugin:1.0.0-beta.3&lt;/code&gt;çš„æ–¹å¼å®‰è£…æ’ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;docker17-03-ceä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜&#34;&gt;Docker17.03-CEä¸­æ’ä»¶æœºåˆ¶å­˜åœ¨çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;Docker17.03çš„æ’ä»¶æœºåˆ¶æ˜¯ä¸ºäº†dockerå…¬å¸çš„å•†ä¸šåŒ–ç­–ç•¥è€Œå®è¡Œçš„ï¼Œæ‰€æœ‰çš„dockeræ’ä»¶éƒ½è¿è¡Œåœ¨è‡ªå·±çš„namespaceå’Œrootfsä¸­ï¼Œæ’ä»¶æ¥å£&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Plugin backendæ¥å£&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// Backend for Plugin
type Backend interface {
	Disable(name string, config *enginetypes.PluginDisableConfig) error
	Enable(name string, config *enginetypes.PluginEnableConfig) error
	List(filters.Args) ([]enginetypes.Plugin, error)
	Inspect(name string) (*enginetypes.Plugin, error)
	Remove(name string, config *enginetypes.PluginRmConfig) error
	Set(name string, args []string) error
	Privileges(ctx context.Context, ref reference.Named, metaHeaders http.Header, authConfig *enginetypes.AuthConfig) (enginetypes.PluginPrivileges, error)
	Pull(ctx context.Context, ref reference.Named, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, privileges enginetypes.PluginPrivileges, outStream io.Writer) error
	Push(ctx context.Context, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, outStream io.Writer) error
	Upgrade(ctx context.Context, ref reference.Named, name string, metaHeaders http.Header, authConfig *enginetypes.AuthConfig, privileges enginetypes.PluginPrivileges, outStream io.Writer) error
	CreateFromContext(ctx context.Context, tarCtx io.ReadCloser, options *enginetypes.PluginCreateOptions) error
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»Pluginçš„åç«¯æ¥å£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰åƒé•œåƒä¸€æ ·çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰ä¿®æ”¹pluginåå­—çš„æ–¹æ³•ï¼Œå› ä¸ºæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ— æ³•push pluginåˆ°è‡ªå·±çš„é•œåƒä»“åº“ï¼Œå¦å¤–&lt;strong&gt;Harbor&lt;/strong&gt;è¿˜æ˜¯ä¸æ”¯æŒ&lt;code&gt;docker plugin push&lt;/code&gt; &lt;a href=&#34;https://github.com/vmware/harbor/issues/1532&#34;&gt;Issue-1532&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰å¯¼å‡ºpluginçš„æ–¹æ³•ï¼Œè¿™æ ·å°±åªèƒ½åœ¨è”ç½‘çš„ä¸»æœºä¸Šå®‰è£…docker pluginäº†ï¼Œå¯¹äºæ— æ³•è”ç½‘çš„ä¸»æœºåªå¥½æŸæ‰‹æ— ç­–äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¼°è®¡dockerå®˜æ–¹ä¹Ÿä¸ä¼šå¼€æ”¾è¿™ä¸¤ä¸ªæ¥å£å§ã€‚æ¯•ç«Ÿè¿™æ˜¯&lt;strong&gt;Docker EE&lt;/strong&gt; çš„ä¸€ä¸ªé‡è¦å–ç‚¹ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Docker EE&amp;rsquo;s Certified Plugins&lt;/strong&gt; provide networking and volume plugins and easy to download and install containers to the Docker EE environment.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç–‘é—®&#34;&gt;ç–‘é—®&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸€å®šè¦ä½¿ç”¨docker plugin install&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å› ä¸º&lt;code&gt;docker plugin install&lt;/code&gt;çš„æ—¶å€™ä¼šç”³è¯·ä¸€äº›è®¿é—®æƒé™ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸€å—åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­å¯ä»¥çœ‹åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆdocker pluginä¸èƒ½æ”¹åå­—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹Pluginçš„ç»“æ„ä½“ï¼ˆåœ¨api/types/plugin.goä¸­å®šä¹‰ï¼‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// Plugin A plugin for the Engine API
// swagger:model Plugin
type Plugin struct {

	// config
	// Required: true
	Config PluginConfig `json:&amp;quot;Config&amp;quot;`

	// True when the plugin is running. False when the plugin is not running, only installed.
	// Required: true
	Enabled bool `json:&amp;quot;Enabled&amp;quot;`

	// Id
	ID string `json:&amp;quot;Id,omitempty&amp;quot;`

	// name
	// Required: true
	Name string `json:&amp;quot;Name&amp;quot;`

	// plugin remote reference used to push/pull the plugin
	PluginReference string `json:&amp;quot;PluginReference,omitempty&amp;quot;`

	// settings
	// Required: true
	Settings PluginSettings `json:&amp;quot;Settings&amp;quot;`
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª&lt;code&gt;PluginReference&lt;/code&gt;ç»“æ„ä½“ï¼Œå®ƒçš„æ–¹æ³•æœ‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;type pluginReference struct {
	name     reference.Named
	pluginID digest.Digest
}

func (r *pluginReference) References(id digest.Digest) []reference.Named {
	if r.pluginID != id {
		return nil
	}
	return []reference.Named{r.name}
}

func (r *pluginReference) ReferencesByName(ref reference.Named) []refstore.Association {
	return []refstore.Association{
		{
			Ref: r.name,
			ID:  r.pluginID,
		},
	}
}

func (r *pluginReference) Get(ref reference.Named) (digest.Digest, error) {
	if r.name.String() != ref.String() {
		return digest.Digest(&amp;quot;&amp;quot;), refstore.ErrDoesNotExist
	}
	return r.pluginID, nil
}

func (r *pluginReference) AddTag(ref reference.Named, id digest.Digest, force bool) error {
	// Read only, ignore
	return nil
}
func (r *pluginReference) AddDigest(ref reference.Canonical, id digest.Digest, force bool) error {
	// Read only, ignore
	return nil
}
func (r *pluginReference) Delete(ref reference.Named) (bool, error) {
	// Read only, ignore
	return false, nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„å…¶ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•&lt;code&gt;AddTag&lt;/code&gt;ã€&lt;code&gt;AddDigest&lt;/code&gt;ã€&lt;code&gt;Delete&lt;/code&gt;æ–¹æ³•éƒ½æ˜¯åªè¯»çš„ã€‚åœ¨&lt;code&gt;migrate/v1/migratev1.go&lt;/code&gt;ä¸­æœ‰å¼•ç”¨åˆ°äº†è¿™ä¸ªã€‚&lt;/p&gt;

&lt;p&gt;å†çœ‹ä¸‹&lt;strong&gt;Reference&lt;/strong&gt;çš„çš„å®šä¹‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;vendor/github.com/docker/distribution/reference/reference.go
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// Package reference provides a general type to represent any way of referencing images within the registry.
// Its main purpose is to abstract tags and digests (content-addressable hash).
//
// Grammar
//
// 	reference                       := name [ &amp;quot;:&amp;quot; tag ] [ &amp;quot;@&amp;quot; digest ]
//	name                            := [domain &#39;/&#39;] path-component [&#39;/&#39; path-component]*
//	domain                          := domain-component [&#39;.&#39; domain-component]* [&#39;:&#39; port-number]
//	domain-component                := /([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])/
//	port-number                     := /[0-9]+/
//	path-component                  := alpha-numeric [separator alpha-numeric]*
// 	alpha-numeric                   := /[a-z0-9]+/
//	separator                       := /[_.]|__|[-]*/
//
//	tag                             := /[\w][\w.-]{0,127}/
//
//	digest                          := digest-algorithm &amp;quot;:&amp;quot; digest-hex
//	digest-algorithm                := digest-algorithm-component [ digest-algorithm-separator digest-algorithm-component ]
//	digest-algorithm-separator      := /[+.-_]/
//	digest-algorithm-component      := /[A-Za-z][A-Za-z0-9]*/
//	digest-hex                      := /[0-9a-fA-F]{32,}/ ; At least 128 bit digest value
//
//	identifier                      := /[a-f0-9]{64}/
//	short-identifier                := /[a-f0-9]{6,64}/
// Reference is an opaque object reference identifier that may include
// modifiers such as a hostname, name, tag, and digest.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¿®æ”¹pluginçš„åå­—çš„æ–¹æ³•æ˜¯ä¸æ˜¯è¿˜æ²¡å®ç°ï¼Ÿ&lt;/p&gt;

&lt;h2 id=&#34;è§£å†³æ–¹æ³•&#34;&gt;è§£å†³æ–¹æ³•&lt;/h2&gt;

&lt;p&gt;åœ¨ä»£ç å­˜åœ¨bugçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆç”¨ä¸‹é¢çš„æ–¹æ³•æš‚æ—¶åˆ›å»ºpluginã€‚&lt;/p&gt;

&lt;p&gt;è™½ç„¶dockerä»£ç é‡Œæ²¡æœ‰æä¾›&lt;strong&gt;rename plugin&lt;/strong&gt;çš„æ¥å£ï¼Œä½†æ˜¯ä½¿ç”¨&lt;strong&gt;docker install&lt;/strong&gt;å‘½ä»¤å®‰è£…çš„pluginä¼šå­˜å‚¨åœ¨&lt;code&gt;/var/lib/docker/plugins/${PLUGIN_ID}&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹ä½¿ç”¨&lt;strong&gt;docker plugin create&lt;/strong&gt;å‘½ä»¤åˆ›å»ºä½ è‡ªå·±æƒ³è¦çš„åç§°çš„docker pluginã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;docker plugin set&lt;/code&gt;å‘½ä»¤ä¿®æ”¹pluginä¸­çš„å±æ€§:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;cluster_store&lt;/li&gt;
&lt;li&gt;plugin_role&lt;/li&gt;
&lt;li&gt;plugin_name&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;æ’ä»¶è°ƒè¯•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ—¥å¿—åœ°å€&lt;code&gt;/run/contiv/log/&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä»émasterèŠ‚ç‚¹çš„netpluginå¯åŠ¨æ—¥å¿—&lt;code&gt;netplugin_bootup.log&lt;/code&gt;ä¸­å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;V2 Plugin logs
Loading OVS
Starting OVS
Starting Netplugin 
/netplugin -debug -plugin-mode docker -vlan-if  -cluster-store etcd://172.20.0.113:2379  
Not starting netmaster as plugin role is none
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Netpluginå¯åŠ¨çš„æ—¶å€™æ˜¯æ­£ç¡®çš„è§£æäº†&lt;strong&gt;etcd&lt;/strong&gt;çš„é…ç½®äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬å†çœ‹ä¸€ä¸‹&lt;code&gt;netplugin.log&lt;/code&gt;çš„æ—¥å¿—åå°±ä¼šå‘ç°ï¼Œå¯åŠ¨è¿˜æ˜¯å¤±è´¥äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;time=&amp;quot;Mar 21 03:20:37.537954358&amp;quot; level=debug msg=&amp;quot;Got link list(16): [0xc4203fe200 0xc4203fe300 0xc4203fe400 0xc4203fe500 0xc420420000 0xc420420090 0xc420420120 0xc4204201b0 0xc420420240 0xc4204202d0 0xc420420360 0xc4204203f0 0xc420420480 0xc420420510 0xc4203feb80 0xc4203fec80]&amp;quot;
time=&amp;quot;Mar 21 03:20:37.538576647&amp;quot; level=error msg=&amp;quot;Failed to connect to etcd. Err: client: etcd cluster is unavailable or misconfigured&amp;quot;
time=&amp;quot;Mar 21 03:20:37.538599827&amp;quot; level=error msg=&amp;quot;Error creating client etcd to url 127.0.0.1:2379. Err: client: etcd cluster is unavailable or misconfigured&amp;quot;
time=&amp;quot;Mar 21 03:20:37.538612813&amp;quot; level=fatal msg=&amp;quot;Error initializing cluster. Err: client: etcd cluster is unavailable or misconfigured&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;netplugin&lt;/code&gt;æ²¡æœ‰æ­£ç¡®çš„è§£æetcdçš„åœ°å€ã€‚è¿™åˆ°åº•æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿbootupçš„æ—¥å¿—é‡Œä¸æ˜¯å†™çš„è§£æåˆ°äº†å—ï¼Ÿè¿™ä¸ªé—®é¢˜è¿˜å¾—ç ”ç©¶ä¸‹æºç ï¼Œä¹Ÿè®¸æ˜¯ä¸€ä¸ªbugã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Docker17.03-CEæ’ä»¶å¼€å‘æ¡ˆä¾‹</title>
      <link>https://jimmysong.io/blog/docker-plugin-develop/</link>
      <pubDate>Wed, 15 Mar 2017 13:57:26 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-plugin-develop/</guid>
      <description>
        
        
        

&lt;blockquote&gt;
&lt;p&gt;å½“ä½ çœ‹åˆ°è¿™ç¯‡æ–‡ç« æ—¶ï¼Œå¦‚æœä½ ä¹Ÿæ­£åœ¨è¿›è¡Œdocker1.13+ç‰ˆæœ¬ä¸‹çš„pluginå¼€å‘ï¼Œæ­å–œä½ ä¹Ÿå…¥å‘äº†ï¼Œå¦‚æœä½ è¶Ÿå‡ºå‘ï¼Œéº»çƒ¦å‘Šè¯‰ä½ çš„æ–¹æ³•ï¼Œæ„Ÿæ©ä¸å°½ğŸ™&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;çœ‹äº†æ–‡ç« åä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œå®˜ç½‘ä¸Šçš„å¯èƒ½æ˜¯ä¸ªå‡ğŸŒ°ã€‚&lt;strong&gt;è™½ç„¶å®˜ç½‘ä¸Šçš„æ–‡æ¡£å†™çš„æœ‰ç‚¹ä¸å¯¹ï¼Œä¸è¿‡ä½ ä½¿ç”¨docker-ssh-volumeçš„å¼€æºä»£ç è‡ªå·±å»æ„å»ºpluginçš„è¿˜æ˜¯å¯ä»¥æˆåŠŸçš„ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;docker-pluginå¼€å‘æ–‡æ¡£&#34;&gt;Docker pluginå¼€å‘æ–‡æ¡£&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆdockerå®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ª&lt;a href=&#34;https://docs.docker.com/engine/extend/legacy_plugins/&#34;&gt;docker legacy pluginæ–‡æ¡£&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« åŸºæœ¬å°±æ˜¯å‘Šè¯‰ä½ dockerç›®å‰æ”¯æŒå“ªäº›æ’ä»¶ï¼Œç½—åˆ—äº†ä¸€ç³»åˆ—è¿æ¥ï¼Œä¸è¿‡å¯¹ä¸èµ·ï¼Œè¿™äº›ä¸æ˜¯dockerå®˜æ–¹æ’ä»¶ï¼Œæœ‰é—®é¢˜å»æ‰¾å®ƒä»¬çš„å¼€å‘è€…å»å§ğŸ˜‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Docker pluginè²Œä¼¼å¼€å§‹ä½¿ç”¨äº†æ–°çš„v2 pluginäº†ï¼Œlegacyç‰ˆæœ¬çš„pluginå¯ä»¥èƒ½åœ¨åæœŸè¢«åºŸå¼ƒã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä»dockerçš„æºç &lt;strong&gt;plugin/store.go&lt;/strong&gt;ä¸­å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;/* allowV1PluginsFallback determines daemon&#39;s support for V1 plugins.
 * When the time comes to remove support for V1 plugins, flipping
 * this bool is all that will be needed.
 */
const allowV1PluginsFallback bool = true

/* defaultAPIVersion is the version of the plugin API for volume, network,
   IPAM and authz. This is a very stable API. When we update this API, then
   pluginType should include a version. e.g. &amp;quot;networkdriver/2.0&amp;quot;.
*/
const defaultAPIVersion string = &amp;quot;1.0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;éšç€dockerå…¬å¸æ˜¯çš„æˆ˜ç•¥è°ƒæ•´ï¼Œæ¨å‡ºäº†docker-CEå’Œdocker-EEä¹‹åï¼Œæœªæ¥æœ‰äº›æ’ä»¶å°±å¯èƒ½è¦æ”¶è´¹äº†ï¼Œv2ç‰ˆæœ¬çš„æ’ä»¶éƒ½æ˜¯åœ¨docker storeä¸­ä¸‹è½½äº†ï¼Œè€Œè¿™ç§æ’ä»¶åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½æ˜¯æ‰“åŒ…æˆdocker imageï¼Œå¦‚æœä¸å¼€æ”¾æºç çš„è¯ï¼Œä½ å³ä½¿pullä¸‹æ¥æ’ä»¶ä¹Ÿæ— æ³•ä¿®æ”¹å’Œå¯¼å‡ºçš„ï¼Œ&lt;strong&gt;docker pluginç›®å‰æ²¡æœ‰å¯¼å‡ºæ¥å£&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;çœŸæ­£è¦å¼€å‘ä¸€ä¸ªdocker pluginè¿˜æ˜¯å¾—çœ‹&lt;a href=&#34;https://docs.docker.com/engine/extend/plugin_api/&#34;&gt;docker plugin API&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ï¼š&lt;/p&gt;

&lt;h4 id=&#34;æ’ä»¶å‘ç°&#34;&gt;æ’ä»¶å‘ç°&lt;/h4&gt;

&lt;p&gt;å½“ä½ å¼€å‘å¥½ä¸€ä¸ªæ’ä»¶&lt;strong&gt;docker engine&lt;/strong&gt;æ€ä¹ˆæ‰èƒ½å‘ç°å®ƒä»¬å‘¢ï¼Ÿæœ‰ä¸‰ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-markdown&#34;&gt;- **.sock**ï¼Œlinuxä¸‹æ”¾åœ¨/run/docker/pluginsç›®å½•ä¸‹ï¼Œæˆ–è¯¥ç›®å½•ä¸‹çš„å­ç›®å½•æ¯”å¦‚[flocker](https://github.com/ClusterHQ/flocker)æ’ä»¶çš„`.sock`æ–‡ä»¶æ”¾åœ¨`/run/docker/plugins/flocker/flocker.sock`ä¸‹
- **.spec**ï¼Œæ¯”å¦‚**convoy**æ’ä»¶åœ¨`/etc/docker/plugins/convoy.spec `å®šä¹‰ï¼Œå†…å®¹ä¸º`unix:///var/run/convoy/convoy.sock`
- **.json**ï¼Œæ¯”å¦‚**infinit**æ’ä»¶åœ¨`/usr/lib/docker/plugins/infinit.json `å®šä¹‰ï¼Œå†…å®¹ä¸º`{&amp;quot;Addr&amp;quot;:&amp;quot;https://infinit.sh&amp;quot;,&amp;quot;Name&amp;quot;:&amp;quot;infinit&amp;quot;}`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–‡ç« ä¸­çš„å…¶å®ƒéƒ¨åˆ†&lt;strong&gt;è²Œä¼¼éƒ½è¿‡æ—¶&lt;/strong&gt;äº†ï¼Œæ–°çš„æ’ä»¶ä¸æ˜¯ä½œä¸º&lt;strong&gt;systemd&lt;/strong&gt;è¿›ç¨‹è¿è¡Œçš„ï¼Œè€Œæ˜¯å®Œå…¨é€šè¿‡&lt;strong&gt;docker plugin&lt;/strong&gt;å‘½ä»¤æ¥ç®¡ç†çš„ã€‚&lt;/p&gt;

&lt;p&gt;å½“ä½ ä½¿ç”¨&lt;strong&gt;docker plugin enable &lt;plugin_name&gt;&lt;/strong&gt;æ¥æ¿€æ´»äº†æ’ä»¶åï¼Œç†åº”åœ¨&lt;code&gt;/run/docker/plugins&lt;/code&gt;ç›®å½•ä¸‹ç”Ÿæˆæ’ä»¶çš„&lt;code&gt;.sock&lt;/code&gt;æ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨åªæœ‰ä¸€ä¸ªä»¥runc IDå‘½åçš„ç›®å½•ï¼Œè¿™ä¸ªé—®é¢˜ä¸‹é¢æœ‰è¯¦ç»†çš„å™è¿°è¿‡ç¨‹ï¼Œä½ ä¹Ÿå¯ä»¥è·³è¿‡ï¼Œç›´æ¥çœ‹&lt;a href=&#34;https://github.com/docker/docker/issues/31723&#34;&gt;issue-31723&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/engine/extend/&#34;&gt;docker pluginç®¡ç†&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºsshfs-volume-plugin&#34;&gt;åˆ›å»ºsshfs volume plugin&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/docker/docker/blob/17.03.x/docs/extend/index.md#developing-a-plugin&#34;&gt;å®˜æ–¹ç¤ºä¾‹æ–‡æ¡£&lt;/a&gt;ï¼ˆè¿™ä¸ªæ–‡æ¡£æœ‰é—®é¢˜ï¼‰&lt;a href=&#34;https://github.com/docker/docker/issues/29886&#34;&gt;docker-issue29886&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å®˜æ–¹ä»¥å¼€å‘ä¸€ä¸ª&lt;strong&gt;sshfs&lt;/strong&gt;çš„volume pluginä¸ºä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œ&lt;code&gt;docker plugin create&lt;/code&gt;å‘½ä»¤çš„ç›®å½•ä¸‹å¿…é¡»åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;config.json&lt;/strong&gt;æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æ’ä»¶çš„é…ç½®ä¿¡æ¯ï¼Œ&lt;a href=&#34;https://github.com/docker/docker/blob/17.03.x/docs/extend/config.md&#34;&gt;plugin configå‚è€ƒæ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rootfs&lt;/strong&gt;ç›®å½•ï¼Œæ’ä»¶é•œåƒè§£å‹åçš„ç›®å½•ã€‚v2ç‰ˆæœ¬çš„docker pluginéƒ½æ˜¯ä»¥dockeré•œåƒçš„æ–¹å¼åŒ…è£…çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ git clone https://github.com/vieux/docker-volume-sshfs
$ cd docker-volume-sshfs
$ go get github.com/docker/go-plugins-helpers/volume
$ go build -o docker-volume-sshfs main.go  
$ docker build -t rootfsimage .
$ id=$(docker create rootfsimage true) # id was cd851ce43a403 when the image was created
$ sudo mkdir -p myplugin/rootfs
$ sudo docker export &amp;quot;$id&amp;quot; | sudo tar -x -C myplugin/rootfs
$ docker rm -vf &amp;quot;$id&amp;quot;
$ docker rmi rootfsimage
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;strong&gt;sshfs&lt;/strong&gt;çš„Dockerfileæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Dockerfile&#34;&gt;FROM alpine

RUN apk update &amp;amp;&amp;amp; apk add sshfs

RUN mkdir -p /run/docker/plugins /mnt/state /mnt/volumes

COPY docker-volume-sshfs docker-volume-sshfs

CMD [&amp;quot;docker-volume-sshfs&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®é™…ä¸Šæ˜¯ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°alpine linuxå®¹å™¨ä¸­è¿è¡Œã€‚&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘rootfsimageé•œåƒçš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker build -t rootfsimage .
Sending build context to Docker daemon 11.71 MB
Step 1/5 : FROM alpine
 ---&amp;gt; 4a415e366388
Step 2/5 : RUN apk update &amp;amp;&amp;amp; apk add sshfs
 ---&amp;gt; Running in 1551ecc1c847
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz
v3.5.2-2-ge626ce8c3c [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]
v3.5.1-71-gc7bb9a04f0 [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]
OK: 7959 distinct packages available
(1/10) Installing openssh-client (7.4_p1-r0)
(2/10) Installing fuse (2.9.7-r0)
(3/10) Installing libffi (3.2.1-r2)
(4/10) Installing libintl (0.19.8.1-r0)
(5/10) Installing libuuid (2.28.2-r1)
(6/10) Installing libblkid (2.28.2-r1)
(7/10) Installing libmount (2.28.2-r1)
(8/10) Installing pcre (8.39-r0)
(9/10) Installing glib (2.50.2-r0)
(10/10) Installing sshfs (2.8-r0)
Executing busybox-1.25.1-r0.trigger
Executing glib-2.50.2-r0.trigger
OK: 11 MiB in 21 packages
 ---&amp;gt; 1a73c501f431
Removing intermediate container 1551ecc1c847
Step 3/5 : RUN mkdir -p /run/docker/plugins /mnt/state /mnt/volumes
 ---&amp;gt; Running in 032af3b2595a
 ---&amp;gt; 30c7e8463e96
Removing intermediate container 032af3b2595a
Step 4/5 : COPY docker-volume-sshfs docker-volume-sshfs
 ---&amp;gt; a924c6fcc1e4
Removing intermediate container ffc5e3c97707
Step 5/5 : CMD docker-volume-sshfs
 ---&amp;gt; Running in 0dc938fe4f4e
 ---&amp;gt; 0fd2e3d94860
Removing intermediate container 0dc938fe4f4e
Successfully built 0fd2e3d94860
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¼–å†™&lt;code&gt;config.json&lt;/code&gt;æ–‡æ¡£&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Json&#34;&gt;{
    &amp;quot;description&amp;quot;: &amp;quot;sshFS plugin for Docker&amp;quot;,
    &amp;quot;documentation&amp;quot;: &amp;quot;https://docs.docker.com/engine/extend/plugins/&amp;quot;,
    &amp;quot;entrypoint&amp;quot;: [
        &amp;quot;/docker-volume-sshfs&amp;quot;
    ],
    &amp;quot;env&amp;quot;: [
        {
            &amp;quot;name&amp;quot;: &amp;quot;DEBUG&amp;quot;,
            &amp;quot;settable&amp;quot;: [
                &amp;quot;value&amp;quot;
            ],
            &amp;quot;value&amp;quot;: &amp;quot;0&amp;quot;
        }
    ],
    &amp;quot;interface&amp;quot;: {
        &amp;quot;socket&amp;quot;: &amp;quot;sshfs.sock&amp;quot;,
        &amp;quot;types&amp;quot;: [
            &amp;quot;docker.volumedriver/1.0&amp;quot;
        ]
    },
    &amp;quot;linux&amp;quot;: {
        &amp;quot;capabilities&amp;quot;: [
            &amp;quot;CAP_SYS_ADMIN&amp;quot;
        ],
        &amp;quot;devices&amp;quot;: [
            {
                &amp;quot;path&amp;quot;: &amp;quot;/dev/fuse&amp;quot;
            }
        ]
    },
    &amp;quot;mounts&amp;quot;: [
        {
            &amp;quot;destination&amp;quot;: &amp;quot;/mnt/state&amp;quot;,
            &amp;quot;options&amp;quot;: [
                &amp;quot;rbind&amp;quot;
            ],
            &amp;quot;source&amp;quot;: &amp;quot;/var/lib/docker/plugins/&amp;quot;,
            &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;
        }
    ],
    &amp;quot;network&amp;quot;: {
        &amp;quot;type&amp;quot;: &amp;quot;host&amp;quot;
    },
    &amp;quot;propagatedmount&amp;quot;: &amp;quot;/mnt/volumes&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥æ’ä»¶ä½¿ç”¨hostç½‘ç»œç±»å‹ï¼Œä½¿ç”¨/run/docker/plugins/sshfs.sockæ¥å£ä¸docker engineé€šä¿¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„å®˜ç½‘ä¸Šçš„è¿™ä¸ªæ–‡æ¡£æœ‰é—®é¢˜ï¼Œconfig.jsonä¸ä»£ç é‡Œçš„ä¸ç¬¦ï¼Œå°¤å…¶æ˜¯Entrypointçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ä¸å¯¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„&lt;strong&gt;socket&lt;/strong&gt;é…ç½®çš„åœ°å€ä¸è¦å†™è¯¦ç»†åœ°å€ï¼Œé»˜è®¤ä¼šåœ¨/run/docker/pluginsç›®å½•ä¸‹ç”Ÿæˆsocketæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºplugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;docker plugin create &amp;lt;plugin_name&amp;gt; /path/to/plugin/data/&lt;/code&gt;å‘½ä»¤åˆ›å»ºæ’ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å…·ä½“åˆ°sshfsæ’ä»¶ï¼Œåœ¨mypluginç›®å½•ä¸‹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºæ’ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker plugin create jimmmysong/sshfs:latest .
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å°±å¯ä»¥çœ‹åˆ°åˆšåˆ›å»ºçš„æ’ä»¶äº†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker plugin ls
ID                  NAME                 DESCRIPTION               ENABLED
8aa1f6098fca        jimmysong/sshfs:latest   sshFS plugin for Docker   true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;push plugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…ˆç™»å½•ä½ çš„docker hubè´¦æˆ·ï¼Œç„¶åä½¿ç”¨&lt;code&gt;docker plugin push jimmysong/sshfs:latest&lt;/code&gt;å³å¯ä»¥æ¨é€docker pluginåˆ°docker hubä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰æ¨é€åˆ°&lt;strong&gt;harbor&lt;/strong&gt;é•œåƒä»“åº“æœ‰é—®é¢˜ï¼ŒæŠ¥é”™ä¿¡æ¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;c08c951b53b7: Preparing 
denied: requested access to the resource is denied
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å·²ç»™harboræ&lt;a href=&#34;https://github.com/vmware/harbor/issues/1532&#34;&gt;issue-1532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;pluginçš„ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœ‰å‘ç°äº†ä¸ªé—®é¢˜&lt;a href=&#34;https://github.com/docker/docker/issues/31723&#34;&gt;docker issue-31723&lt;/a&gt;ï¼Œä½¿ç”¨pluginåˆ›å»ºvolumeçš„æ—¶å€™å±…ç„¶æ‰¾ä¸åˆ°&lt;code&gt;sshfs.sock&lt;/code&gt;æ–‡ä»¶ï¼ğŸ˜¢åˆšå¼€å§‹æ‰‹åŠ¨åˆ›å»ºpluginçš„æ—¶å€™æµ‹è¯•äº†ä¸‹æ˜¯æ­£å¸¸çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥å¼„åˆ°è¿™å°æµ‹è¯•æœºå™¨ä¸Šå‡ºé—®é¢˜äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³äºdocker-plugin-enableå¤±è´¥çš„é—®é¢˜&#34;&gt;å…³äºdocker plugin enableå¤±è´¥çš„é—®é¢˜&lt;/h3&gt;

&lt;p&gt;å½“docker  pluginåˆ›å»ºæˆåŠŸå¹¶enableçš„æ—¶å€™dockerå¹¶æ²¡æœ‰æŠ¥é”™ï¼Œè¿™ä¸docker pluginçš„&lt;strong&gt;activate&lt;/strong&gt;æœºåˆ¶æœ‰å…³ï¼Œåªæœ‰å½“ä½ æœ€ç»ˆä½¿ç”¨è¯¥pluginçš„æ—¶å€™æ‰ä¼šæ¿€æ´»å®ƒã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;strong&gt;sshfs&lt;/strong&gt;æ’ä»¶åˆ›å»ºvolumeã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker volume create -d jimmysong/sshfs --name sshvolume -o sshcmd=1.2.3.4:/remote -o password=password
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŠ¥é”™å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;Error response from daemon: create sshvolume: Post http://%2Frun%2Fdocker%2Fplugins%2F8f7b8f931b38a4ef53d0e4f8d738e26e8f10ef8bd26c8244f4b8dcc7276b685f%2Fsshfs.sock/VolumeDriver.Create: dial unix /run/docker/plugins/8f7b8f931b38a4ef53d0e4f8d738e26e8f10ef8bd26c8244f4b8dcc7276b685f/sshfs.sock: connect: no such file or directory
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Docker daemonåœ¨enableè¿™ä¸ªæ’ä»¶çš„æ—¶å€™ä¼šå¯»æ‰¾è¿™ä¸ª&lt;strong&gt;.sock&lt;/strong&gt;æ–‡ä»¶ï¼Œç„¶ååœ¨è‡ªå·±çš„plugindbä¸­æ³¨å†Œå®ƒï¼Œç›¸å…³ä»£ç åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-http&#34;&gt;https://github.com/docker/docker/blob/17.03.x/plugin/manager_linux.go
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç›¸å…³ä»£ç ç‰‡æ®µï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;func (pm *Manager) enable(p *v2.Plugin, c *controller, force bool) error {
	...
	return pm.pluginPostStart(p, c)
}

func (pm *Manager) pluginPostStart(p *v2.Plugin, c *controller) error {
    //è¿™é‡Œéœ€è¦è·å–.sockæ–‡ä»¶çš„åœ°å€ 
    //pm.conifg.ExecRootå°±æ˜¯/run/docker/plugins
    //p.GetID()è¿”å›çš„å°±æ˜¯å¾ˆé•¿çš„é‚£ä¸²plugin ID
	sockAddr := filepath.Join(pm.config.ExecRoot, p.GetID(), p.GetSocket())
	client, err := plugins.NewClientWithTimeout(&amp;quot;unix://&amp;quot;+sockAddr, nil, c.timeoutInSecs)
	if err != nil {
		c.restart = false
		shutdownPlugin(p, c, pm.containerdClient)
		return errors.WithStack(err)
	}

	p.SetPClient(client)

	maxRetries := 3
	var retries int
	for {
		time.Sleep(3 * time.Second)
		retries++

		if retries &amp;gt; maxRetries {
			logrus.Debugf(&amp;quot;error net dialing plugin: %v&amp;quot;, err)
			c.restart = false
			shutdownPlugin(p, c, pm.containerdClient)
			return err
		}

		// net dial into the unix socket to see if someone&#39;s listening.
		conn, err := net.Dial(&amp;quot;unix&amp;quot;, sockAddr)
		if err == nil {
			conn.Close()
			break
		}
	}
	pm.config.Store.SetState(p, true)
	pm.config.Store.CallHandler(p)

	return pm.save(p)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„è¿™æ®µä»£ç é‡Œçš„&lt;strong&gt;sockAddr := filepath.Join(pm.config.ExecRoot, p.GetID(), p.GetSocket())&lt;/strong&gt;ï¼Œæˆ‘åœ¨ä¸Šé¢æ·»åŠ äº†æ³¨é‡Šã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ª&lt;strong&gt;.sock&lt;/strong&gt;æ–‡ä»¶åº”è¯¥æœ‰docker pluginæ¥ç”Ÿæˆï¼Œå…·ä½“æ€æ ·ç”Ÿæˆçš„å‘¢ï¼Ÿè¿˜ä»¥&lt;strong&gt;docker-volume-ssh&lt;/strong&gt;è¿™ä¸ªæ’ä»¶ä¸ºä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªé¡¹ç›®å°±ä¸€ä¸ª&lt;strong&gt;main.go&lt;/strong&gt;æ–‡ä»¶ï¼Œé‡Œé¢æœ€åä¸€è¡Œç”Ÿæˆäº†&lt;strong&gt;/run/docker/plugins/sshfs.sock&lt;/strong&gt;è¿™ä¸ªsockã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;logrus.Error(h.ServeUnix(socketAddress, 0))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™è¡Œä»£ç è°ƒç”¨&lt;strong&gt;docker/go-plugin-helpers/sdk/handler.go&lt;/strong&gt;ä¸­çš„:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// ServeUnix makes the handler to listen for requests in a unix socket.
// It also creates the socket file on the right directory for docker to read.
func (h Handler) ServeUnix(addr string, gid int) error {
	l, spec, err := newUnixListener(addr, gid)
	if err != nil {
		return err
	}
	if spec != &amp;quot;&amp;quot; {
		defer os.Remove(spec)
	}
	return h.Serve(l)
}

// Serve sets up the handler to serve requests on the passed in listener
func (h Handler) Serve(l net.Listener) error {
	server := http.Server{
		Addr:    l.Addr().String(),
		Handler: h.mux,
	}
	return server.Serve(l)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;//unix_listener_unsupoorted.go
func newUnixListener(pluginName string, gid int) (net.Listener, string, error) {
	return nil, &amp;quot;&amp;quot;, errOnlySupportedOnLinuxAndFreeBSD
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;çœ‹äº†ä¸Šé¢è¿™è¿™äº›ï¼Œä½ çœ‹å‡ºsocketæ–‡ä»¶æ˜¯æ€ä¹ˆåˆ›å»ºçš„å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;è¿™åˆæ˜¯ä¸€ä¸ª&lt;a href=&#34;https://github.com/vieux/docker-volume-sshfs/issues/19&#34;&gt;issue-19&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä¿®æ”¹&lt;strong&gt;config.json&lt;/strong&gt;æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„&lt;strong&gt;interfaces - socket&lt;/strong&gt;æŒ‡å®šä¸º&lt;code&gt;/run/docker/plugins/sshfs.sock&lt;/code&gt;ç„¶ååˆ›å»ºpluginï¼Œåˆ™èƒ½æˆåŠŸç”Ÿæˆsocketæ–‡ä»¶ï¼Œä½†æ˜¯å½“ä½ enableå®ƒçš„æ—¶å€™åˆä¼šæŠ¥é”™&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Error response from daemon: Unix socket path &amp;quot;/run/docker/plugins/ac34f7b246ac6c029023b1ebd48e166eadcdd2c9d0cc682cadca0336951d72f7/run/docker/plugins/sshfs.sock&amp;quot; is too long
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»docker daemonçš„æ—¥å¿—é‡Œå¯ä»¥çœ‹åˆ°è¯¦ç»†æŠ¥é”™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;Mar 13 17:15:20 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:15:20+08:00&amp;quot; level=info msg=&amp;quot;standard_init_linux.go:178: exec user process caused \&amp;quot;no such file or directory\&amp;quot;&amp;quot; plugin=ac34f7b246ac6c029023b1ebd48e166eadcdd2c9d0cc682cadca0336951d72f7
Mar 13 17:15:20 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:15:20.321277088+08:00&amp;quot; level=error msg=&amp;quot;Sending SIGTERM to plugin failed with error: rpc error: code = 2 desc = no such process&amp;quot;
Mar 13 17:15:20 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:15:20.321488680+08:00&amp;quot; level=error msg=&amp;quot;Handler for POST /v1.26/plugins/sshfs/enable returned error: Unix socket path \&amp;quot;/run/docker/plugins/ac34f7b246ac6c029023b1ebd48e166eadcdd2c9d0cc682cadca0336951d72f7/run/docker/plugins/sshfs.sock\&amp;quot; is too long\ngithub.com/docker/docker/plugin.(*Manager).pluginPostStart\n\t/root/rpmbuild/BUILD/docker-engine/.gopath/src/github.com/docker/docker/plugin/manager_linux.go:84\ngithub.com/docker/docker/plugin.(*Manager).enable\n\t/root/rpmbuild/BUILD/docker-
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ­£å¥½éªŒè¯äº†ä¸Šé¢çš„&lt;strong&gt;enable&lt;/strong&gt;ä»£ç ï¼Œdockeré»˜è®¤æ˜¯åˆ°&lt;code&gt;/run/docker/plugins&lt;/code&gt;ç›®å½•ä¸‹æ‰¾&lt;strong&gt;sshfs.sock&lt;/strong&gt;è¿™ä¸ªæ–‡ä»¶çš„ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘åœ¨docker daemonä¸­å‘ç°ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„é”™è¯¯ï¼Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;Mar 13 17:29:41 sz-pg-oam-docker-test-001.tendcloud.com dockerd[51757]: time=&amp;quot;2017-03-13T17:29:41+08:00&amp;quot; level=info msg=&amp;quot;standard_init_linux.go:178: exec user process caused \&amp;quot;no such file or directory\&amp;quot;&amp;quot; plugin=85760810b4850009fc965f5c20d8534dc9aba085340a2ac0b4b9167a6fef7d53
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘æŸ¥çœ‹äº†ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-http&#34;&gt;github.com/libnetwork/vendor/github.com/opencontainers/run/libcontainer/standard_init_linux.go
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–‡ä»¶ï¼Œè¿™ä¸ªé‚£ä¸ªæ–‡ä»¶åªæœ‰114è¡Œï¼Œè§&lt;a href=&#34;https://github.com/docker/libnetwork/blob/master/vendor/github.com/opencontainers/runc/libcontainer/standard_init_linux.go&#34;&gt; standard_init_linux.go&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯åœ¨&lt;strong&gt;opencontainers&lt;/strong&gt;çš„githubé¡¹ç›®é‡Œæ‰æœ‰é‚£ä¹ˆå¤šè¡Œï¼Œè§ &lt;a href=&#34;https://github.com/opencontainers/runc/blob/master/libcontainer/standard_init_linux.go&#34;&gt;standard_init_linux.go&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæŠ¥é”™å‰åçš„å‡½æ•°æ˜¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// PR_SET_NO_NEW_PRIVS isn&#39;t exposed in Golang so we define it ourselves copying the value
// the kernel
const PR_SET_NO_NEW_PRIVS = 0x26

func (l *linuxStandardInit) Init() error {
	if !l.config.Config.NoNewKeyring {
		ringname, keepperms, newperms := l.getSessionRingParams()

		// do not inherit the parent&#39;s session keyring
		sessKeyId, err := keys.JoinSessionKeyring(ringname)
		if err != nil {
			return err
		}
		// make session keyring searcheable
		if err := keys.ModKeyringPerm(sessKeyId, keepperms, newperms); err != nil {
			return err
		}
	}

...
	}
	if l.config.Config.Seccomp != nil &amp;amp;&amp;amp; l.config.NoNewPrivileges {
         //ä¸‹é¢è¿™è¡Œæ˜¯ç¬¬178è¡Œ
		if err := seccomp.InitSeccomp(l.config.Config.Seccomp); err != nil {
			return newSystemErrorWithCause(err, &amp;quot;init seccomp&amp;quot;)
		}
	}
	// close the statedir fd before exec because the kernel resets dumpable in the wrong order
	// https://github.com/torvalds/linux/blob/v4.9/fs/exec.c#L1290-L1318
	syscall.Close(l.stateDirFD)
	if err := syscall.Exec(name, l.config.Args[0:], os.Environ()); err != nil {
		return newSystemErrorWithCause(err, &amp;quot;exec user process&amp;quot;)
	}
	return nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç»“è®º&#34;&gt;&lt;del&gt;ç»“è®º&lt;/del&gt;&lt;/h2&gt;

&lt;p&gt;&lt;del&gt;åˆ°æ­¤äº†é—®é¢˜è¿˜æ²¡è§£å†³ã€‚&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;é—®é¢˜çš„å…³é”®æ˜¯æ‰§è¡Œ&lt;strong&gt;docker create plugin&lt;/strong&gt;ä¹‹å&lt;strong&gt;.sock&lt;/strong&gt;æ–‡ä»¶åˆ›å»ºåˆ°å“ªé‡Œå»äº†ï¼Ÿä¸ºä»€ä¹ˆåœ¨&lt;strong&gt;config.json&lt;/strong&gt;æŒ‡å®šæˆ&lt;code&gt;/run/docker/plugins/sshfs.sock&lt;/code&gt;å°±å¯ä»¥åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºå‡º.sockæ–‡ä»¶ï¼Œè¯´æ˜&lt;strong&gt;åˆ›å»ºsocketçš„å®šä¹‰å’Œget socketæ—¶å¯»æ‰¾çš„è·¯å¾„ä¸ä¸€æ ·&lt;/strong&gt;ï¼Œåˆ›å»ºsocketæ—¶å°±æ˜¯å›ºå®šåœ¨/run/docker/pluginsç›®å½•ä¸‹åˆ›å»ºï¼Œè€Œenable pluginçš„æ—¶å€™ï¼ŒGet socketçš„æ—¶å€™è¿˜è¦åŠ ä¸Šdocker pluginçš„IDï¼Œå¯æ˜¯æŒ‰ç…§å®˜ç½‘çš„é…ç½®åœ¨æœ¬åœ°create pluginåå¹¶æ²¡æœ‰åœ¨/run/docker/pluginsç›®å½•ä¸‹ç”Ÿæˆæ’ä»¶çš„socketæ–‡ä»¶ï¼Œç›´åˆ°enableæ’ä»¶çš„æ—¶å€™æ‰ä¼šç”Ÿæˆä»¥plugin IDå‘½åçš„ç›®å½•ï¼Œä½†æ˜¯socketæ–‡ä»¶æ²¡æœ‰ï¼â˜¹ï¸&lt;/del&gt;&lt;/p&gt;

&lt;h2 id=&#34;é—®é¢˜è§£å†³&#34;&gt;é—®é¢˜è§£å†³&lt;/h2&gt;

&lt;p&gt;ä¹‹æ‰€ä»¥å‡ºç°ä¸Šé¢çš„é‚£äº›é—®é¢˜ï¼Œæ˜¯å› ä¸ºcreate docker pluginçš„æ—¶å€™æœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æœ‰é—®é¢˜ï¼Œæˆ‘åœ¨&lt;strong&gt;Mac&lt;/strong&gt;ä¸Šbuildçš„imageï¼Œè€Œä¸”è¿˜æ²¡æœ‰ç”¨&lt;strong&gt;Dockerfile.dev&lt;/strong&gt;è¿™ä¸ªä¸“é—¨ç”¨æ¥æ­å»ºäºŒè¿›åˆ¶æ–‡ä»¶ç¼–è¯‘ç¯å¢ƒçš„Dockerfileæ¥åˆ›å»ºgolangçš„ç¼–è¯‘ç¯å¢ƒï¼Œè™½ç„¶docker pluginæ˜¯åˆ›å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯å½“docker plugin enableçš„æ—¶å€™ï¼Œè¿™ä¸ªçƒ­ç´§å¼ æ–‡ä»¶ä¸èƒ½æ­£ç¡®çš„è¿è¡Œï¼Œæ‰€ä»¥å°±æ²¡èƒ½ç”Ÿæˆ&lt;strong&gt;sshfs.sock&lt;/strong&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¯·åœ¨Linuxç¯å¢ƒä¸‹ä½¿ç”¨&lt;strong&gt;make all&lt;/strong&gt;å‘½ä»¤æ¥åˆ›å»ºpluginã€‚&lt;/p&gt;
&lt;/blockquote&gt;

      </description>
    </item>
    
    <item>
      <title>Docker 17.03-CE create pluginæºç è§£æ</title>
      <link>https://jimmysong.io/blog/docker-create-plugin/</link>
      <pubDate>Wed, 15 Mar 2017 12:09:26 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-create-plugin/</guid>
      <description>
        
        
        &lt;p&gt;ç»§ç»­ä¸Šä¸€ç¯‡&lt;a href=&#34;https://jimmysong.io/posts/docker-plugin-develop/&#34;&gt;Docker17.03-CEæ’ä»¶å¼€å‘çš„ğŸŒ°&lt;/a&gt;ï¼Œä»Šå¤©æ¥çœ‹ä¸‹&lt;strong&gt;docker create plugin&lt;/strong&gt;çš„æºç ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;cli/command/plugin/create.go&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Dockerå‘½ä»¤è¡Œ&lt;code&gt;docker plugin create&lt;/code&gt;è°ƒç”¨çš„ï¼Œä½¿ç”¨çš„æ˜¯&lt;a href=&#34;http://github.com/spf13/cobra&#34;&gt;cobra&lt;/a&gt;ï¼Œè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å¼€å‘åŒ…å¾ˆå¥½ç”¨ï¼Œæ¨èä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œè¿™ä¸¤ä¸ªå‡½æ•°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func newCreateCommand(dockerCli *command.DockerCli) *cobra.Command 
//è°ƒç”¨ä¸‹é¢çš„å‡½æ•°ï¼Œæ‹¼è£…æˆURLè°ƒç”¨RESTful APIæ¥å£
func runCreate(dockerCli *command.DockerCli, options pluginCreateOptions) error {
  ...
  if err = dockerCli.Client().PluginCreate(ctx, createCtx, createOptions); err != nil {
		return err
	}
  ...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å†çœ‹ä¸‹ä¸‹é¢çš„è¿™ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-http&#34;&gt;api/server/router/plugin/plugin_routes.go
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (pr *pluginRouter) createPlugin(ctx context.Context, w http.ResponseWriter, r *http.Request, vars map[string]string) error {
  ...
  if err := pr.backend.CreateFromContext(ctx, r.Body, options); err != nil {
		return err
	}
  ...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;createPlugin&lt;/strong&gt;è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨api/server/route/plugin/backen.goçš„&lt;strong&gt;Backend&lt;/strong&gt;æ¥å£ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PluginCreate&lt;/strong&gt;è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨docker/docker/client/Interface.goçš„&lt;strong&gt;PluginAPIClient&lt;/strong&gt;æ¥å£ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;docker/client/plugin_create.go&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// PluginCreate creates a plugin
func (cli *Client) PluginCreate(ctx context.Context, createContext io.Reader, createOptions types.PluginCreateOptions) error {
	headers := http.Header(make(map[string][]string))
	headers.Set(&amp;quot;Content-Type&amp;quot;, &amp;quot;application/x-tar&amp;quot;)

	query := url.Values{}
	query.Set(&amp;quot;name&amp;quot;, createOptions.RepoName)

	resp, err := cli.postRaw(ctx, &amp;quot;/plugins/create&amp;quot;, query, createContext, headers)
	if err != nil {
		return err
	}
	ensureReaderClosed(resp)
	return err
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;pluginåœ¨åç«¯æ¥æ”¶åˆ°è¯·æ±‚åä¼šæ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ã€‚æœ€ç»ˆ&lt;strong&gt;create plugin&lt;/strong&gt;çš„å®ç°åœ¨plugin/backend_linux.goä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// CreateFromContext creates a plugin from the given pluginDir which contains
// both the rootfs and the config.json and a repoName with optional tag.
func (pm *Manager) CreateFromContext(ctx context.Context, tarCtx io.ReadCloser, options *types.PluginCreateOptions) (err error) {}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡³äºdocker create pluginæ—¶dockeråå°ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Œå°±çœ‹ğŸ‘†é‚£ä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Dockerå¯¹æ¯”Kubernetesç¬¬äºŒéƒ¨åˆ†</title>
      <link>https://jimmysong.io/blog/docker-vs-kubernetes-part2/</link>
      <pubDate>Fri, 10 Mar 2017 22:06:32 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-vs-kubernetes-part2/</guid>
      <description>
        
        
        

&lt;p&gt;æœ¬æ–‡æ˜¯&lt;code&gt;Docker v.s Kubernetes&lt;/code&gt;ç³»åˆ—ç¬¬äºŒç¯‡ï¼Œç»­æ¥ä¸Šæ–‡&lt;a href=&#34;https://jimmysong.io/blog/docker-vs-kubernetes-part1/&#34;&gt;Dockerå¯¹æ¯”Kuberntesç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetesæ˜¯å…¸å‹çš„&lt;strong&gt;Master/Slave&lt;/strong&gt;æ¶æ„æ¨¡å¼ï¼Œæœ¬æ–‡ç®€è¦çš„ä»‹ç»kubenetesçš„æ¶æ„å’Œç»„ä»¶æ„æˆã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetesæ ¸å¿ƒæ¶æ„&#34;&gt;Kubernetesæ ¸å¿ƒæ¶æ„&lt;/h2&gt;

&lt;h3 id=&#34;masterèŠ‚ç‚¹&#34;&gt;masterèŠ‚ç‚¹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;apiserverï¼šä½œä¸ºkubernetesç³»ç»Ÿçš„å…¥å£ï¼Œå°è£…äº†æ ¸å¿ƒå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»¥RESTFulæ¥å£æ–¹å¼æä¾›ç»™å¤–éƒ¨å®¢æˆ·å’Œå†…éƒ¨ç»„ä»¶è°ƒç”¨ã€‚å®ƒç»´æŠ¤çš„RESTå¯¹è±¡å°†æŒä¹…åŒ–åˆ°etcdï¼ˆä¸€ä¸ªåˆ†å¸ƒå¼å¼ºä¸€è‡´æ€§çš„key/valueå­˜å‚¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;schedulerï¼šè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ï¼Œä¸ºæ–°å»ºçš„Podåˆ†é…æœºå™¨ã€‚è¿™éƒ¨åˆ†å·¥ä½œåˆ†å‡ºæ¥å˜æˆä¸€ä¸ªç»„ä»¶ï¼Œæ„å‘³ç€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢æˆå…¶ä»–çš„è°ƒåº¦å™¨ã€‚&lt;/li&gt;
&lt;li&gt;controller-managerï¼šè´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰æœ‰ä¸¤ç±»ï¼š

&lt;ol&gt;
&lt;li&gt;endpoint-controllerï¼šå®šæœŸå…³è”serviceå’ŒPod(å…³è”ä¿¡æ¯ç”±endpointå¯¹è±¡ç»´æŠ¤)ï¼Œä¿è¯serviceåˆ°Podçš„æ˜ å°„æ€»æ˜¯æœ€æ–°çš„ã€‚&lt;/li&gt;
&lt;li&gt;replication-controllerï¼šå®šæœŸå…³è”replicationControllerå’ŒPodï¼Œä¿è¯replicationControllerå®šä¹‰çš„å¤åˆ¶æ•°é‡ä¸å®é™…è¿è¡ŒPodçš„æ•°é‡æ€»æ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;nodeèŠ‚ç‚¹&#34;&gt;nodeèŠ‚ç‚¹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;kubeletï¼šè´Ÿè´£ç®¡æ§dockerå®¹å™¨ï¼Œå¦‚å¯åŠ¨/åœæ­¢ã€ç›‘æ§è¿è¡ŒçŠ¶æ€ç­‰ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–åˆ†é…åˆ°æœ¬æœºçš„Podï¼Œå¹¶æ ¹æ®Podä¿¡æ¯å¯åŠ¨æˆ–åœæ­¢ç›¸åº”çš„å®¹å™¨ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¼šæ¥æ”¶apiserverçš„HTTPè¯·æ±‚ï¼Œæ±‡æŠ¥Podçš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;proxyï¼šè´Ÿè´£ä¸ºPodæä¾›ä»£ç†ã€‚å®ƒä¼šå®šæœŸä»etcdè·å–æ‰€æœ‰çš„serviceï¼Œå¹¶æ ¹æ®serviceä¿¡æ¯åˆ›å»ºä»£ç†ã€‚å½“æŸä¸ªå®¢æˆ·Podè¦è®¿é—®å…¶ä»–Podæ—¶ï¼Œè®¿é—®è¯·æ±‚ä¼šç»è¿‡æœ¬æœºproxyåšè½¬å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/kubernetes-masterslave.png&#34; alt=&#34;master slaveæ¶æ„&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;kubernetesç»„ä»¶è¯¦ç»†ä»‹ç»&#34;&gt;Kubernetesç»„ä»¶è¯¦ç»†ä»‹ç»&lt;/h2&gt;

&lt;h3 id=&#34;etcd&#34;&gt;etcd&lt;/h3&gt;

&lt;p&gt;è™½ç„¶ä¸æ˜¯Kubernetesçš„ç»„ä»¶ä½†æ˜¯æœ‰å¿…è¦æä¸€ä¸‹ï¼Œetcdæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ååŒæ•°æ®åº“ï¼ŒåŸºäºGoè¯­è¨€å¼€å‘ï¼Œ&lt;code&gt;CoreOS&lt;/code&gt;å…¬å¸å‡ºå“ï¼Œä½¿ç”¨raftä¸€è‡´æ€§ç®—æ³•ååŒã€‚Kubernetesçš„ä¸»æ•°æ®åº“ï¼Œåœ¨å®‰è£…kubernetesä¹‹å‰å°±è¦å…ˆå®‰è£…å®ƒï¼Œå¾ˆå¤šå¼€æºä¸‹é¡¹ç›®éƒ½ç”¨åˆ°ï¼Œè€ç‰ˆæœ¬çš„&lt;code&gt;docker swarm&lt;/code&gt;ä¹Ÿç”¨åˆ°äº†å®ƒã€‚ç›®å‰ä¸»è¦ä½¿ç”¨çš„æ˜¯&lt;code&gt;2.7.x&lt;/code&gt;ç‰ˆæœ¬ï¼Œ&lt;code&gt;3.0+&lt;/code&gt;ç‰ˆæœ¬çš„APIå˜åŒ–å¤ªå¤§ã€‚&lt;/p&gt;

&lt;h3 id=&#34;apiserver&#34;&gt;APIServer&lt;/h3&gt;

&lt;p&gt;APIServerè´Ÿè´£å¯¹å¤–æä¾›kubernetes APIæœåŠ¡ï¼Œå®ƒè¿è¡Œåœ¨masterèŠ‚ç‚¹ä¸Šã€‚ä»»ä½•å¯¹èµ„æºçš„å¢åˆ æ”¹æŸ¥éƒ½è¦äº¤ç»™APIServerå¤„ç†åæ‰èƒ½æäº¤ç»™etcdã€‚APIServeræ€»ä½“ä¸Šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šHTTP/HTTPSæœåŠ¡å’Œä¸€äº›åŠŸèƒ½æ€§æ’ä»¶ã€‚è¿™äº›åŠŸèƒ½æ€§æ’ä»¶åˆåˆ†ä¸ºä¸¤ç§ï¼šä¸€éƒ¨åˆ†ä¸åº•å±‚IaaSå¹³å°ï¼ˆCloud Provideï¼‰ç›¸å…³ï¼›å¦ä¸€éƒ¨åˆ†ä¸èµ„æºç®¡ç†æ§åˆ¶ï¼ˆAdmission Controlï¼‰ç›¸å…³ã€‚&lt;/p&gt;

&lt;h3 id=&#34;scheduler&#34;&gt;Scheduler&lt;/h3&gt;

&lt;p&gt;Schedulerçš„ä½œç”¨æ˜¯&lt;strong&gt;æ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å°†podè°ƒåº¦åˆ°nodeèŠ‚ç‚¹ä¸Š&lt;/strong&gt;ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºç»‘å®šã€‚Schedulerè°ƒåº¦å™¨çš„è¾“å…¥æ˜¯å¾…è°ƒåº¦çš„podå’Œå¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ï¼Œè¾“å‡ºåˆ™æ˜¯ä¸€ä¸ªå·²ç»ç»‘å®šäº†podçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯é€šè¿‡è°ƒåº¦ç®—æ³•åœ¨å·¥ä½œèŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©çš„æœ€ä¼˜èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹ä»å“ªé‡Œæ¥ï¼Ÿå·¥ä½œèŠ‚ç‚¹å¹¶ä¸æ˜¯ç”±Kubernetesåˆ›å»ºï¼Œå®ƒæ˜¯ç”±IaaSå¹³å°åˆ›å»ºï¼Œæˆ–è€…å°±æ˜¯ç”±ç”¨æˆ·ç®¡ç†çš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚ä½†æ˜¯Kubernetesä¼šåˆ›å»ºä¸€ä¸ªNodeå¯¹è±¡ï¼Œç”¨æ¥æè¿°è¿™ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚æè¿°çš„å…·ä½“ä¿¡æ¯ç”±åˆ›å»ºNodeå¯¹è±¡çš„é…ç½®æ–‡ä»¶ç»™å‡ºã€‚ä¸€æ—¦ç”¨æˆ·åˆ›å»ºèŠ‚ç‚¹çš„è¯·æ±‚è¢«æˆåŠŸå¤„ç†ï¼ŒKubernetesåˆä¼šç«‹å³åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªnodeå¯¹è±¡ï¼Œå†å»æ£€æŸ¥è¯¥èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µã€‚åªæœ‰é‚£äº›å½“å‰å¯ç”¨çš„nodeæ‰ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èŠ‚ç‚¹å¹¶å…è®¸podè°ƒåº¦åˆ°ä¸Šé¢è¿è¡Œã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹å¯ä»¥é€šè¿‡èµ„æºé…ç½®æ–‡ä»¶æˆ–è€…kubectlå‘½ä»¤è¡Œå·¥å…·æ¥åˆ›å»ºã€‚Kubernetesä¸»è¦ç»´æŠ¤å·¥ä½œèŠ‚ç‚¹çš„ä¸¤ä¸ªå±æ€§ï¼šspecå’Œstatusæ¥æè¿°ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„æœŸæœ›çŠ¶æ€å’Œå½“å‰çŠ¶æ€ã€‚å…¶ä¸­ï¼Œæ‰€è°“çš„å½“å‰çŠ¶æ€ä¿¡æ¯ç”±3ä¸ªä¿¡æ¯ç»„æˆï¼š&lt;code&gt;HostIp&lt;/code&gt;ã€&lt;code&gt;NodePhase&lt;/code&gt;å’Œ&lt;code&gt;Node Condition&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å·¥ä½œèŠ‚ç‚¹çš„åŠ¨æ€ç»´æŠ¤è¿‡ç¨‹ä¾é &lt;strong&gt;Node Controller&lt;/strong&gt;æ¥å®Œæˆï¼Œå®ƒæ˜¯&lt;code&gt;Kubernetes Controller Manager&lt;/code&gt;ä¸‹å±çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚å®ƒä¼šä¸€ç›´ä¸æ–­çš„æ£€æŸ¥Kuberneteså·²çŸ¥çš„æ¯å°nodeèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœä¸€ä¸ªä¹‹å‰å·²ç»å¤±è´¥çš„èŠ‚ç‚¹åœ¨è¿™ä¸ªæ£€æŸ¥å¾ªç¯ä¸­è¢«æ£€æŸ¥ä¸ºå¯ä»¥å·¥ä½œçš„ï¼Œé‚£ä¹ˆNode Controllerä¼šæŠŠè¿™ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°å·¥ä½œèŠ‚ç‚¹ä¸­ï¼ŒNode Controllerä¼šä»å·¥ä½œèŠ‚ç‚¹ä¸­åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;controller-manager&#34;&gt;Controller Manager&lt;/h3&gt;

&lt;p&gt;Controller Managerè¿è¡Œåœ¨é›†ç¾¤çš„MasterèŠ‚ç‚¹ä¸Šï¼Œæ˜¯åŸºäºpod APIçš„ä¸€ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œå®ƒ&lt;strong&gt;é‡ç‚¹å®ç°service Endpointï¼ˆæœåŠ¡ç«¯ç‚¹ï¼‰çš„åŠ¨æ€æ›´æ–°&lt;/strong&gt;ã€‚ç®¡ç†ç€Kubernetesé›†ç¾¤ä¸­å„ç§æ§åˆ¶èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬&lt;strong&gt;replication Controller&lt;/strong&gt;å’Œ&lt;strong&gt;node Controller&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸APIServerç›¸æ¯”ï¼ŒAPIServerè´Ÿè´£æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶åˆ›å»ºå¯¹åº”çš„èµ„æºï¼Œè€ŒController Manageråœ¨ç³»ç»Ÿä¸­æ‰®æ¼”çš„è§’è‰²æ˜¯åœ¨ä¸€æ—æ—é»˜é»˜çš„ç®¡æ§è¿™äº›èµ„æºï¼Œç¡®ä¿ä»–ä»¬æ°¸è¿œä¿æŒåœ¨é¢„æœŸçš„çŠ¶æ€&lt;/strong&gt;ã€‚å®ƒé‡‡ç”¨å„ç§ç®¡ç†å™¨å®šæ—¶çš„å¯¹podã€èŠ‚ç‚¹ç­‰èµ„æºè¿›è¡Œé¢„è®¾çš„æ£€æŸ¥ï¼Œç„¶ååˆ¤æ–­å‡ºäºé¢„æœŸçš„æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´ï¼Œåˆ™é€šçŸ¥APIServeré‡‡å–è¡ŒåŠ¨ï¼Œæ¯”å¦‚é‡å¯ã€è¿ç§»ã€åˆ é™¤ç­‰ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kubelet&#34;&gt;kubelet&lt;/h3&gt;

&lt;p&gt;kubeletç»„ä»¶å·¥ä½œåœ¨Kubernetesçš„nodeä¸Šï¼Œ&lt;strong&gt;è´Ÿè´£ç®¡ç†å’Œç»´æŠ¤åœ¨è¿™å°ä¸»æœºä¸Šè¿è¡Œç€çš„æ‰€æœ‰å®¹å™¨&lt;/strong&gt;ã€‚ kubeletä¸cAdvisoräº¤äº’æ¥æŠ“å–dockerå®¹å™¨å’Œä¸»æœºçš„èµ„æºä¿¡æ¯ã€‚ kubeletåƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒåŒ…æ‹¬å®¹å™¨åƒåœ¾å›æ”¶å’Œé•œåƒåƒåœ¾å›æ”¶ã€‚ kubeletå·¥ä½œèŠ‚ç‚¹çŠ¶æ€åŒæ­¥ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kube-proxy&#34;&gt;kube-proxy&lt;/h3&gt;

&lt;p&gt;kube-proxyæä¾›ä¸¤ç§åŠŸèƒ½:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æä¾›ç®—æ³•å°†å®¢æœç«¯æµé‡è´Ÿè½½å‡è¡¡åˆ°serviceå¯¹åº”çš„ä¸€ç»„åç«¯podã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨etcdçš„watchæœºåˆ¶ï¼Œå®ç°æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œç»´æŠ¤ä¸€å¼ ä»serviceåˆ°endpointçš„æ˜ å°„å…³ç³»ï¼Œä»è€Œä¿è¯åç«¯podçš„IPå˜åŒ–ä¸ä¼šå¯¹è®¿é—®è€…çš„è®¿é—®é€ æˆå½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Dockerå¯¹æ¯”Kubernetesç¬¬ä¸€éƒ¨åˆ†</title>
      <link>https://jimmysong.io/blog/docker-vs-kubernetes-part1/</link>
      <pubDate>Fri, 10 Mar 2017 21:09:47 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-vs-kubernetes-part1/</guid>
      <description>
        
        
        

&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;è¿™ä¸€ç³»åˆ—æ–‡ç« æ˜¯å¯¹æ¯”kubernetes å’Œdockerä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼Œé‰´äºæˆ‘ä¹‹å‰ä»docker1.10.3èµ·å¼€å§‹ä½¿ç”¨dockerï¼Œå¯¹åŸç”Ÿdockerçš„äº†è§£æ¯”è¾ƒå¤šï¼Œæœ€è¿‘åˆæ­£åœ¨çœ‹&lt;strong&gt;Kunernetesæƒå¨æŒ‡å—ï¼ˆç¬¬äºŒç‰ˆï¼‰&lt;/strong&gt;è¿™æœ¬ä¹¦ï¼ˆP.Sæ„Ÿè°¢&lt;u&gt;ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/u&gt;çš„ç¼–è¾‘æœ‹å‹èµ é€æ­¤ä¹¦ï¼‰ã€‚è¿™ç³»åˆ—æ–‡ç« ä¸æ˜¯ä¸ºäº†æ¯”è¾ƒå­°ä¼˜å­°åŠ£ï¼Œ&lt;strong&gt;é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤ç³»åˆ—æ–‡ç« ä¸­æ‰€è¯´çš„&lt;strong&gt;docker&lt;/strong&gt;æŒ‡çš„æ˜¯*17.03-ce*ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ¦‚å¿µæ€§çš„å·®åˆ«&#34;&gt;æ¦‚å¿µæ€§çš„å·®åˆ«&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;äº†è§£ä¸€æ ·ä¸œè¥¿é¦–å…ˆè¦é«˜å±‹å»ºç“´çš„äº†è§£å®ƒçš„æ¦‚å¿µï¼ŒkubernetesåŒ…æ‹¬ä»¥ä¸‹å‡ ç§èµ„æºå¯¹è±¡ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/abstractions/pod/&#34;&gt;Pod&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;li&gt;Volume&lt;/li&gt;
&lt;li&gt;Namespace&lt;/li&gt;
&lt;li&gt;ReplicaSet&lt;/li&gt;
&lt;li&gt;Deployment&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/abstractions/controllers/statefulsets/&#34;&gt;StatefulSet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;DaemonSet&lt;/li&gt;
&lt;li&gt;Job&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Docker&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Dockerçš„èµ„æºå¯¹è±¡ç›¸å¯¹äºkubernetesæ¥è¯´å°±ç®€å•å¤šäº†ï¼Œåªæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;li&gt;Node&lt;/li&gt;
&lt;li&gt;Stack&lt;/li&gt;
&lt;li&gt;Docker&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°±è¿™ä¹ˆç®€å•ï¼Œä½¿ç”¨ä¸€ä¸ª*docker-compose.yml*å³å¯ä»¥å¯åŠ¨ä¸€ç³»åˆ—æœåŠ¡ã€‚å½“ç„¶ç®€å•çš„å¥½å¤„æ˜¯ä¾¿äºç†è§£å’Œç®¡ç†ï¼Œä½†æ˜¯åœ¨åŠŸèƒ½æ–¹é¢å°±æ²¡æœ‰kubernetesé‚£ä¹ˆå¼ºå¤§äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŠŸèƒ½æ€§å·®åˆ«&#34;&gt;åŠŸèƒ½æ€§å·®åˆ«&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetes èµ„æºé™åˆ¶ CPU 100måƒåˆ†ä¹‹ä¸€æ ¸ä¸ºå•ä½ï¼Œç»å¯¹å€¼ï¼Œrequests å’Œlimitsï¼Œè¶…è¿‡è¿™ä¸ªå€¼å¯èƒ½è¢«æ€æ‰ï¼Œèµ„æºé™åˆ¶åŠ›åº¦æ¯”dockeræ›´ç»†ã€‚&lt;/li&gt;
&lt;li&gt;Podä¸­æœ‰ä¸ªæœ€åº•å±‚çš„pause å®¹å™¨ï¼Œå…¶ä»–ä¸šåŠ¡å®¹å™¨å…±ç”¨ä»–çš„IPï¼Œdockerå› ä¸ºæ²¡æœ‰è¿™å±‚æ¦‚å¿µï¼Œæ‰€ä»¥æ²¡æ³•å…±ç”¨IPï¼Œè€Œæ˜¯ä½¿ç”¨overlayç½‘ç»œåŒå¤„äºä¸€ä¸ªç½‘ç»œé‡Œæ¥é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesåœ¨rcä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ä¼ é€’é…ç½®ï¼ˆ1.3ç‰ˆæœ¬æ˜¯è¿™æ ·çš„ï¼Œåç»­ç‰ˆæœ¬è¿˜æ²¡æœ‰ç ”ç©¶è¿‡ï¼‰&lt;/li&gt;
&lt;li&gt;Kuberentes Label å¯ä»¥åœ¨å¼€å§‹å’ŒåŠ¨æ€çš„æ·»åŠ ä¿®æ”¹ï¼Œæ‰€æœ‰çš„èµ„æºå¯¹è±¡éƒ½æœ‰ï¼Œè¿™ä¸€ç‚¹dockerä¹Ÿæœ‰ï¼Œä½†æ˜¯èµ„æºè°ƒåº¦å› ä¸ºæ²¡æœ‰kubernetesé‚£ä¹ˆå±‚çº§ï¼Œæ‰€æœ‰è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ã€‚&lt;/li&gt;
&lt;li&gt;Kuberneteså¯¹è±¡é€‰æ‹©æœºåˆ¶ç»§ç»­é€šè¿‡label selectorï¼Œç”¨äºå¯¹è±¡è°ƒåº¦ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„é•œåƒï¼Œå«åš&lt;code&gt;google_containers/pause&lt;/code&gt;ï¼Œè¿™ä¸ªé•œåƒæ˜¯ç”¨æ¥å®ç°Podæ¦‚å¿µçš„ã€‚&lt;/li&gt;
&lt;li&gt;HPA horizontal pod autoscaling æ¨ªå‘ç§»åŠ¨æ‰©å®¹ï¼Œä¹Ÿæ˜¯ä¸€ç§èµ„æºå¯¹è±¡ï¼Œæ ¹æ®è´Ÿè½½å˜åŒ–æƒ…å†µé’ˆå¯¹æ€§çš„è°ƒæ•´podç›®æ ‡å‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetesä¸­æœ‰ä¸‰ä¸ªIPï¼ŒNode,Pod,Cluster IPçš„å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œdockerä¸­æ²¡æœ‰Cluster IPçš„æ¦‚å¿µã€‚&lt;/li&gt;
&lt;li&gt;æŒä¹…åŒ–å­˜å‚¨ï¼Œåœ¨Kubernetesä¸­æœ‰Persistent volume åªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨ï¼Œä¸å±äºä»»ä½•nodeï¼Œç‹¬ç«‹äºpodä¹‹å¤–ï¼Œè€Œdockeråªèƒ½ä½¿ç”¨&lt;code&gt;volume plugin&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·ç®¡ç†ï¼Œkubernetesä¸­æœ‰`Namespaceï¼Œdockeræš‚æ—¶æ²¡æœ‰å¤šç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»ä½“æ¥è¯´Dockeræ¶æ„æ›´åŠ ç®€å•ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„é…ç½®ï¼Œåªéœ€è¦æ¯ä¸ªç»“ç‚¹éƒ½å®‰è£…dockerå³å¯ï¼Œè°ƒåº¦å’Œç®¡ç†åŠŸèƒ½æ²¡kubernetesé‚£ä¹ˆå¤æ‚ã€‚ä½†æ˜¯kubernetesæœ¬èº«å°±æ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®ä¸­å¿ƒç®¡ç†å·¥å…·ï¼Œä¸ä»…å¯ä»¥ç”¨æ¥ç®¡ç†dockerï¼Œ*pod*è¿™ä¸ªæ¦‚å¿µé‡Œå°±å¯ä»¥è¿è¡Œä¸ä»…æ˜¯dockeräº†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä»¥åçš„æ–‡ç« ä¸­å°†ç»“åˆdockerç€é‡è®²Kubernetesï¼ŒåŸºäº1.3ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

      </description>
    </item>
    
    <item>
      <title>Contivå…¥å‘æŒ‡å—-v2plugin</title>
      <link>https://jimmysong.io/blog/contiv-v2plugin/</link>
      <pubDate>Fri, 10 Mar 2017 11:51:09 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/contiv-v2plugin/</guid>
      <description>
        
        
        

&lt;p&gt;ç»§ç»­è¶Ÿæ˜¨å¤©æŒ–çš„å‘ã€‚&lt;/p&gt;

&lt;p&gt;æ˜¨å¤©çš„&lt;a href=&#34;https://github.com/contiv/netplugin/issues/776&#34;&gt;issue-776&lt;/a&gt;å·²ç»å¾—åˆ°@gkvijayçš„å›å¤ï¼ŒåŸæ¥æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…contiv/v2pluginçš„ç¼˜æ•…ï¼Œæ‰€ä»¥create contiv networkå¤±è´¥ï¼Œæˆ‘éœ€è¦è‡ªå·±buildä¸€ä¸ª&lt;strong&gt;docker plugin&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æŸ¥çœ‹ä¸‹è¿™ä¸ª&lt;a href=&#34;https://github.com/contiv/netplugin/commit/8afd1b7718c8424a876760d18484124e0aad3557&#34;&gt;commit&lt;/a&gt;é‡Œé¢æœ‰build &lt;strong&gt;v2plugin&lt;/strong&gt;çš„è„šæœ¬æ›´æ”¹ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥buildè‡ªå·±çš„v2pluginã€‚&lt;/p&gt;

&lt;p&gt;å‰æä½ éœ€è¦å…ˆbuildå‡º&lt;code&gt;netctl&lt;/code&gt;ã€&lt;code&gt;netmaster&lt;/code&gt;ã€&lt;code&gt;netplugin&lt;/code&gt;ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¹¶ä¿å­˜åˆ°&lt;strong&gt;bin&lt;/strong&gt;ç›®å½•ä¸‹ï¼Œå¦‚æœä½ æ²¡è‡ªå·±buildç›´æ¥ä¸‹è½½&lt;strong&gt;release&lt;/strong&gt;é‡Œé¢çš„æ–‡ä»¶ä¿å­˜è¿›å»ä¹Ÿè¡Œã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç¼–è¯‘v2pluginæ’ä»¶&#34;&gt;ç¼–è¯‘v2pluginæ’ä»¶&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¿®æ”¹config.jsonæ’ä»¶é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Json&#34;&gt;{
    &amp;quot;manifestVersion&amp;quot;: &amp;quot;v0&amp;quot;,
    &amp;quot;description&amp;quot;: &amp;quot;Contiv network plugin for Docker&amp;quot;,
    &amp;quot;documentation&amp;quot;: &amp;quot;https://contiv.github.io&amp;quot;,
    &amp;quot;entrypoint&amp;quot;: [&amp;quot;/startcontiv.sh&amp;quot;],
    &amp;quot;network&amp;quot;: {
           &amp;quot;type&amp;quot;: &amp;quot;host&amp;quot;
    },
    &amp;quot;env&amp;quot;: [
       {
          &amp;quot;Description&amp;quot;: &amp;quot;To enable debug mode, set to &#39;-debug&#39;&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;dbg_flag&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;-debug&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;VLAN uplink interface used by OVS&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;iflist&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Etcd or Consul cluster store url&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;cluster_store&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;etcd://172.20.0.113:2379&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Local IP address to be used by netplugin for control communication&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;ctrl_ip&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;none&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Local VTEP IP address to be used by netplugin&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;vtep_ip&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;none&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;In &#39;master&#39; role, plugin runs netmaster and netplugin&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;plugin_role&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;master&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Netmaster url to listen http requests on&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;listen_url&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;172.20.0.113:9999&amp;quot;
       },
       {
          &amp;quot;Description&amp;quot;: &amp;quot;Network Driver name for requests to dockerd. Should be same as name:tag of the plugin&amp;quot;,
          &amp;quot;Name&amp;quot;: &amp;quot;plugin_name&amp;quot;,
          &amp;quot;Settable&amp;quot;: [
             &amp;quot;value&amp;quot;
          ],
          &amp;quot;Value&amp;quot;: &amp;quot;contiv/v2plugin:latest&amp;quot;
       }
    ],
    &amp;quot;mounts&amp;quot;: [
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/etc/openvswitch&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/etc/openvswitch&amp;quot;
       },
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/var/log/openvswitch&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/var/log/openvswitch&amp;quot;
       },
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/var/run&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/var/run&amp;quot;
       },
       {
          &amp;quot;type&amp;quot;: &amp;quot;bind&amp;quot;,
          &amp;quot;options&amp;quot;: [&amp;quot;rbind&amp;quot;],
          &amp;quot;source&amp;quot;: &amp;quot;/lib/modules&amp;quot;,
          &amp;quot;destination&amp;quot;: &amp;quot;/lib/modules&amp;quot;
       }
    ],
    &amp;quot;interface&amp;quot; : {
          &amp;quot;types&amp;quot;: [&amp;quot;docker.networkdriver/1.0&amp;quot;, &amp;quot;docker.ipamdriver/1.0&amp;quot;],
          &amp;quot;socket&amp;quot;: &amp;quot;netplugin.sock&amp;quot;
    },
    &amp;quot;Linux&amp;quot;: {
          &amp;quot;Capabilities&amp;quot;: [&amp;quot;CAP_SYS_ADMIN&amp;quot;, &amp;quot;CAP_NET_ADMIN&amp;quot;, &amp;quot;CAP_SYS_MODULE&amp;quot;]
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/docker/docker/blob/master/docs/extend/config.md&#34;&gt;å…³äº&lt;strong&gt;docker plugin v2&lt;/strong&gt;é…ç½®æ–‡ä»¶çš„è¯´æ˜&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–¹æ³•ä¸€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è‡ªåŠ¨åŒ–make&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$make host-pluginfs-create
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ–¹æ³•äºŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›´æ¥è°ƒç”¨Makefileé‡ŒæŒ‡å®šçš„é‚£ä¸ªshellè„šæœ¬&lt;code&gt;scripts/v2plugin_rootfs.sh&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;$bash scripts/v2plugin_rootfs
Creating rootfs for v2plugin ,
sed: 1: &amp;quot;install/v2plugin/config ...&amp;quot;: command i expects \ followed by text
Sending build context to Docker daemon 73.94 MB
Step 1/5 : FROM alpine:3.5
 ---&amp;gt; 4a415e366388
Step 2/5 : MAINTAINER Cisco Contiv (http://contiv.github.io/)
 ---&amp;gt; Running in fada1677341b
 ---&amp;gt; f0440792dff6
Removing intermediate container fada1677341b
Step 3/5 : RUN mkdir -p /run/docker/plugins /etc/openvswitch /var/run/contiv/log     &amp;amp;&amp;amp; echo &#39;http://dl-cdn.alpinelinux.org/alpine/v3.4/main&#39; &amp;gt;&amp;gt; /etc/apk/repositories     &amp;amp;&amp;amp; apk update &amp;amp;&amp;amp; apk add openvswitch=2.5.0-r0 iptables
 ---&amp;gt; Running in 2ae2fbee6834
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz
v3.5.2-3-g3649125268 [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]
v3.5.1-71-gc7bb9a04f0 [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]
v3.4.6-81-g1f1f409 [http://dl-cdn.alpinelinux.org/alpine/v3.4/main]
OK: 13194 distinct packages available
(1/6) Installing libmnl (1.0.4-r0)
(2/6) Installing libnftnl-libs (1.0.7-r0)
(3/6) Installing iptables (1.6.0-r0)
(4/6) Installing libcrypto1.0 (1.0.2k-r0)
(5/6) Installing libssl1.0 (1.0.2k-r0)
(6/6) Installing openvswitch (2.5.0-r0)
Executing busybox-1.25.1-r0.trigger
OK: 19 MiB in 17 packages
 ---&amp;gt; b130141ad660
Removing intermediate container 2ae2fbee6834
Step 4/5 : COPY netplugin netmaster netctl startcontiv.sh /
 ---&amp;gt; 2b88b2f8e5e7
Removing intermediate container d7580a394c64
Step 5/5 : ENTRYPOINT /startcontiv.sh
 ---&amp;gt; Running in e6fc5c887cb3
 ---&amp;gt; 1c569e4c633d
Removing intermediate container e6fc5c887cb3
Successfully built 1c569e4c633d
Password:
03d60dc01488362156f98a062d17af7a34e4b17569c2fe4f5d2048d619860314
Untagged: contivrootfs:latest
Deleted: sha256:1c569e4c633d27bd3e79d9d30b2825ce57452d30f90a3452304b932835331b13
Deleted: sha256:2b88b2f8e5e7bae348bf296f6254662c1d444760db5acd1764b9c955b106adad
Deleted: sha256:b60594671dc9312bf7ba73bf17abb9704d2b0d0e802c0d990315c5b4a5ca11fe
Deleted: sha256:b130141ad660d4ee291d9eb9a1e0704c4bc009fc91a73de28e8fd110aa45c481
Deleted: sha256:ab3c02d5a171681ba00d27f2c456cf8b63eeeaf408161dc84d9d89526d0399de
Deleted: sha256:f0440792dff6a89e321cc5d34ecaa21b4cb993f0c4e4df6c2b04eef8878bb471
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;åˆ›å»ºé•œåƒè¿™ä¸€æ­¥éœ€è¦è¾“å…¥ä½ çš„docker hubå¯†ç ã€‚è€Œä¸”alpineä¸‹è½½è½¯ä»¶éœ€è¦ç¿»å¢™çš„ã€‚æ‰“åŒ…v2pluginç›®å½•éœ€è¦ä½¿ç”¨sudoï¼Œä¸ç„¶ä¼šæŠ¥ä¸€ä¸ªé”™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ•´ä¸ªæ’ä»¶æ‰“åŒ…å‹ç¼©åçš„å¤§å°æ˜¯91Mã€‚ç°åœ¨&lt;code&gt;rootfs&lt;/code&gt;å’Œ&lt;code&gt;config.json&lt;/code&gt;éƒ½å·²ç»æœ‰äº†ï¼Œå°±å¯ä»¥åœ¨ä½ è‡ªå·±çš„ç³»ç»Ÿä¸Šcreate docker pluginäº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å¯åŠ¨contiv-plugin&#34;&gt;å¯åŠ¨contiv plugin&lt;/h2&gt;

&lt;p&gt;åˆ›å»ºdocker network pluginå¹¶enableã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;$docker plugin create contiv/v2plugin .
contiv/v2plugin
$docker plugin enable contiv/v2plugin
$docker plugin ls
ID                  NAME                     DESCRIPTION                        ENABLED
574d4a4d82a3        contiv/v2plugin:latest   Contiv network plugin for Docker   true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‡³æ­¤*contiv plugin*å·²ç»åˆ›å»ºå¥½äº†ï¼Œenableåæ‰§è¡Œ&lt;code&gt;ip addr&lt;/code&gt;å‘½ä»¤å¯ä»¥çœ‹åˆ°å¤šå‡ºä¸€ä¸ªç½‘ç»œ*contivh0*ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;contivh0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state UNKNOWN qlen 1000
link/ether 02:02:ac:13:ff:fe brd ff:ff:ff:ff:ff:ff
inet 172.19.255.254/16 scope global contivh0
	valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸”ä¸»æœºå¤šäº†ä¸€ä¸ªIPåœ°å€*172.19.255.254*ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸éœ€è¦å†ä¸»æœºä¸Šå®‰è£…&lt;code&gt;netctl&lt;/code&gt;ã€&lt;code&gt;netmaster&lt;/code&gt;ã€&lt;code&gt;netplugin&lt;/code&gt;è¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶äº†ï¼Œåªéœ€è¦å®‰è£…&lt;code&gt;docker plugin&lt;/code&gt;å³å¯ï¼Œè¿™äº›éƒ½å·²ç»å°è£…åˆ°pluginä¸­äº†ï¼Œå¦‚æœä½ çœ‹ä¸‹æ’ä»¶çš„ç›®å½•ç»“æ„å°±çŸ¥é“äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å› ä¸ºæ’ä»¶å®‰è£…çš„é—®é¢˜ï¼Œç›®å‰æˆ‘æµ‹è¯•æœºä¸Šçš„è‡ªå®šä¹‰æ’ä»¶éƒ½æ— æ³•ä½¿ç”¨ï¼Œæ­£åœ¨troubleshootingä¸­ï¼Œä¸€æ—¦æœ‰è¿›å±•ä¼šåŠæ—¶æ›´æ–°è¯¥æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–æ­£åœ¨åŒæ­¥è·Ÿå¼€å‘è€…æ²Ÿé€šä¸­ï¼Œå› ä¸ºæ—¶å·®é—®é¢˜ï¼Œä¸‹å‘¨ä¸€æ‰èƒ½æœ‰ç»“æœã€‚ğŸ˜ª&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>æ€ç§‘å¼€æºdockerç½‘ç»œæ’ä»¶Contivç®€ä»‹</title>
      <link>https://jimmysong.io/blog/contiv-guide/</link>
      <pubDate>Thu, 09 Mar 2017 11:28:34 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/contiv-guide/</guid>
      <description>
        
        
        

&lt;p&gt;&lt;strong&gt;Contiv&lt;/strong&gt;æ˜¯æ€ç§‘å¼€å‘çš„dockerç½‘ç»œæ’ä»¶ï¼Œä»2015å¹´å°±å¼€æºäº†ï¼Œä¸šç•Œé€šå¸¸æ‹¿å®ƒå’ŒCalicoæ¯”è¾ƒã€‚è²Œä¼¼Contivä»¥å‰è¿˜å¼€å‘è¿‡volume pluginï¼Œç°åœ¨é”€å£°åŒ¿è¿¹äº†ï¼Œåªæœ‰netpluginä»åœ¨æ´»è·ƒå¼€å‘ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://dockone.io/article/1935&#34;&gt;å®¹å™¨ç½‘ç»œæ’ä»¶ Calico ä¸ Contiv Netpluginæ·±å…¥æ¯”è¾ƒ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰ç¯‡æ–‡ç« è®²è§£äº†&lt;a href=&#34;http://blog.dataman-inc.com/shurenyun-docker-133/&#34;&gt;dockerç½‘ç»œæ–¹æ¡ˆçš„æ”¹è¿›&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;contiv-netplugin-ç®€ä»‹&#34;&gt;Contiv Netplugin ç®€ä»‹&lt;/h3&gt;

&lt;p&gt;Contiv Netplugin æ˜¯æ¥è‡ªæ€ç§‘çš„è§£å†³æ–¹æ¡ˆã€‚ç¼–ç¨‹è¯­è¨€ä¸º Goã€‚å®ƒåŸºäº OpenvSwitchï¼Œä»¥æ’ä»¶åŒ–çš„å½¢å¼æ”¯æŒå®¹å™¨è®¿é—®ç½‘ç»œï¼Œæ”¯æŒ VLANï¼ŒVxlanï¼Œå¤šç§Ÿæˆ·ï¼Œä¸»æœºè®¿é—®æ§åˆ¶ç­–ç•¥ç­‰ã€‚ä½œä¸ºæ€ç§‘æ•´ä½“æ”¯æŒå®¹å™¨åŸºç¡€è®¾æ–½contivé¡¹ç›®çš„ç½‘ç»œéƒ¨åˆ†ï¼Œæœ€å¤§çš„äº®ç‚¹åœ¨äºå®¹å™¨è¢«èµ‹äºˆäº† SDN èƒ½åŠ›ï¼Œå®ç°å¯¹å®¹å™¨æ›´ç»†ç²’åº¦ï¼Œæ›´ä¸°å¯Œçš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚å¦å¤–ï¼Œå¯¹ Docker CNM ç½‘ç»œæ¨¡å‹çš„æ”¯æŒï¼Œå¹¶å†…ç½®äº† IPAM æ¥å£ï¼Œä¸ä»…ä»…æä¾›äº†ä¸€å®¹å™¨ä¸€ IPï¼Œè€Œä¸”å®¹å™¨çš„ç½‘ç»œä¿¡æ¯è¢«è®°å½•çš„å®¹å™¨é…ç½®ä¸­ï¼Œä¼´éšç€å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå‡ä½å› ä¸ºçŠ¶æ€ä¸åŒæ­¥é€ æˆç½‘ç»œä¿¡æ¯ä¸¢å¤±çš„é£é™©ã€‚æœ‰åˆ«äº CNIï¼Œè¿™ç§å†…èšåŒ–çš„è®¾è®¡æœ‰åˆ©äºå‡å°‘å¯¹ç¬¬ä¸‰æ–¹æ¨¡å—çš„ä¾èµ–ã€‚éšç€é¡¹ç›®çš„å‘å±•ï¼Œé™¤äº† Dockerï¼Œè¿˜æä¾›äº†å¯¹ Kubernetes ä»¥åŠ Mesos çš„æ”¯æŒï¼Œå³ CNI æ¥å£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/netplugin-arch.png&#34; alt=&#34;netplugin æ¶æ„&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Netmaster åå°è¿›ç¨‹è´Ÿè´£è®°å½•æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ï¼Œä¿å­˜ç½‘ç»œä¿¡æ¯ï¼Œåˆ†é… IP åœ°å€&lt;/li&gt;
&lt;li&gt;Netplugin åå°è¿›ç¨‹ä½œä¸ºæ¯ä¸ªå®¿ä¸»æœºä¸Šçš„ Agent ä¸ Docker åŠ OVS é€šä¿¡ï¼Œå¤„ç†æ¥è‡ª Docker çš„è¯·æ±‚ï¼Œç®¡ç† OVSã€‚Docker æ–¹é¢æ¥å£ä¸º remote driverï¼ŒåŒ…æ‹¬ä¸€ç³»åˆ— Docker å®šä¹‰çš„ JSON-RPC(POST) æ¶ˆæ¯ã€‚OVS æ–¹é¢æ¥å£ä¸º remote ovsdbï¼Œä¹Ÿæ˜¯ JSON-RPC æ¶ˆæ¯ã€‚ä»¥ä¸Šæ¶ˆæ¯éƒ½åœ¨ localhost ä¸Šå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç®¡ç†ä¾èµ– etcd/serf&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/jimmysong/image/upload/images/netplugin-code-structure.png&#34; alt=&#34;netplugin ä»£ç ç»“æ„&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;netpluginçš„ä¼˜åŠ¿&#34;&gt;Netpluginçš„ä¼˜åŠ¿&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;è¾ƒæ—©æ”¯æŒCNMæ¨¡å‹ã€‚ä¸å·²æœ‰çš„ç½‘ç»œåŸºç¡€è®¾æ–½å…¼å®¹æ€§è¾ƒé«˜ï¼Œæ”¹é€ å½±å“å°ã€‚åŸºäºVLANçš„å¹³è¡Œæ‰©å±•ä¸ç°æœ‰ç½‘ç»œç»“æ„åœ°ä½å¯¹ç­‰&lt;/li&gt;
&lt;li&gt;SDNèƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹å®¹å™¨çš„ç½‘ç»œè®¿é—®åšæ›´ç²¾ç»†çš„æ§åˆ¶&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·æ”¯æŒï¼Œå…·å¤‡æœªæ¥å‘æ··åˆäº‘/å…¬æœ‰äº‘è¿ç§»çš„æ½œåŠ›&lt;/li&gt;
&lt;li&gt;ä»£ç è§„æ¨¡ä¸å¤§ï¼Œé€»è¾‘ç»“æ„æ¸…æ™°ï¼Œå¹¶å‘å¥½ï¼ŒVLANåœ¨å…¬å¸å†…éƒ¨æœ‰å¼€å‘éƒ¨ç½²è¿ç»´å®è·µç»éªŒï¼Œç¨³å®šæ€§ç»è¿‡ç”Ÿäº§ç¯å¢ƒéªŒè¯&lt;/li&gt;
&lt;li&gt;&lt;u&gt;&lt;strong&gt;äº¬ä¸œ&lt;/strong&gt;åŸºäºç›¸åŒçš„æŠ€æœ¯æ ˆï¼ˆOVS + VLANï¼‰å·²æ”¯æŒ10w+ å®¹å™¨çš„è¿è¡Œã€‚&lt;/u&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;next&#34;&gt;Next&lt;/h3&gt;

&lt;p&gt;åç»­æ–‡ç« ä¼šè®²è§£contiv netpluginçš„ç¯å¢ƒé…ç½®å’Œå¼€å‘ã€‚ç›®å‰è¿˜åœ¨1.0-betaç‰ˆæœ¬ã€‚&lt;strong&gt;Docker store&lt;/strong&gt;ä¸Šæä¾›äº†contivæ’ä»¶çš„&lt;a href=&#34;https://store.docker.com/plugins/803eecee-0780-401a-a454-e9523ccf86b3&#34;&gt;ä¸‹è½½åœ°å€&lt;/a&gt;ã€‚&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>DockeræŠ€æœ¯é€‰å‹</title>
      <link>https://jimmysong.io/blog/docker-tech-selection/</link>
      <pubDate>Wed, 08 Mar 2017 10:37:01 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-tech-selection/</guid>
      <description>
        
        
        

&lt;h2 id=&#34;å›é¡¾å†å²&#34;&gt;å›é¡¾å†å²&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;å¤šå°‘æ¬¡æˆ‘å›è¿‡å¤´çœ‹çœ‹èµ°è¿‡çš„è·¯ï¼Œä½ è¿˜åœ¨å°æ‘æ—ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å»å¹´åŸºäºdocker1.11å¯¹Hadoop yarnè¿›è¡Œäº†dockeråŒ–æ”¹é€ ï¼Œè¯¦æƒ…è¯·çœ‹&lt;a href=&#34;https://rootsongjc.github.io/docker-practice/docs/td_yarn_on_docker.html&#34;&gt;å¤§æ•°æ®é›†ç¾¤è™šæ‹ŸåŒ–-Yarn on dockerå§‹æœ«&lt;/a&gt;ï¼Œæˆ‘å°†è¿™ä¸ªäº‹ä»¶å‘½åä¸º&lt;a href=&#34;https://github.com/rootsongjc/magpie&#34;&gt;magpie&lt;/a&gt;ï¼Œå› ä¸ºå®ƒå°±åƒæ˜¯å–œé¹Šä¸€æ ·æ”¶é›†ç€å„ç§å„æ ·çš„èµ„æºæ­å»ºè‡ªå·±çš„å°çªã€‚&lt;strong&gt;magpie&lt;/strong&gt;è¿˜æ˜¯æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšçš„ï¼Œå¤§æ•°æ®é›†ç¾¤çš„è™šæ‹ŸåŒ–ä¹Ÿä¸ä¼šæ­¢æ­¥ï¼Œå®ƒä»…ä»…æ˜¯å¯¹å…¶åšäº†åˆæ­¥çš„æ¢ç´¢ï¼Œå¯¹äºèµ„æºåˆ©ç”¨ç‡å’Œç®¡ç†æ–¹é¢çš„ä¼˜åŒ–è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œ&lt;strong&gt;Yarn&lt;/strong&gt;æœ¬èº«å°±æ˜¯åšä¸ºå¤§æ•°æ®é›†ç¾¤çš„èµ„æºç®¡ç†è°ƒåº¦è§’è‰²å‡ºç°çš„ï¼Œä¸€å¼€å§‹æ˜¯ä¸ºè°ƒåº¦&lt;strong&gt;MapReduce&lt;/strong&gt;ï¼Œåæ¥çš„sparkã€hiveã€tensrflowã€slideç­‰ç­‰ä¸ä¸€è€Œè¶³é™†ç»­å‡ºç°ã€‚ä½†æ˜¯ç”¨å®ƒæ¥ç®¡ç†dockerä¼¼ä¹è¿˜æ˜¯æœ‰ç‚¹è¿‡é‡ï¼Œè¿˜ä¸å¦‚ç”¨kubernetesã€marathonã€nomadã€swarmç­‰ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯åœ¨å¾®æœåŠ¡æ–¹é¢docker1.11çš„å¾ˆå¤šå¼Šç«¯æˆ–è€…è¯´ç¼ºç‚¹å°±æš´éœ²äº†å‡ºæ¥ï¼Œé¦–å…ˆdocker1.11åŸç”Ÿå¹¶ä¸å¸¦clusterç®¡ç†ï¼Œéœ€è¦é…åˆdocker swarmã€kubernetesã€marathonç­‰æ‰èƒ½ç®¡ç†dockeré›†ç¾¤ã€‚&lt;u&gt;ä¹‹å‰çš„å¯¹äºdockerçš„ä½¿ç”¨æ–¹å¼åŸºæœ¬å°±æ˜¯æŒ‰ç…§è™šæ‹Ÿæœºçš„æ–¹å¼ä½¿ç”¨çš„ï¼Œå›ºå®šIPæœ‰æ‚–äºå¾®æœåŠ¡çš„åŸåˆ™ã€‚&lt;/u&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬åŸºäºdocker1.11å’Œ&lt;a href=&#34;github.com/talkingdata/shrike&#34;&gt;shrike&lt;/a&gt;äºŒå±‚ç½‘ç»œæ¨¡å¼ï¼Œè¿˜æœ‰&lt;a href=&#34;https://github.com/shipyard/shipyard&#34;&gt;shipyard&lt;/a&gt;æ¥åšé›†ç¾¤ç®¡ç†ï¼Œshipyardåªæ˜¯ä¸€ä¸ªç®€å•çš„dockeré›†ç¾¤ç®¡ç†çš„WebUIï¼ŒåŸºæœ¬éƒ½æ˜¯è°ƒç”¨docker APIï¼Œå”¯ä¸€åšäº†ä¸€ç‚¹dockeråŸç”Ÿæ²¡æœ‰çš„åŠŸèƒ½å°±æ˜¯&lt;strong&gt;scale&lt;/strong&gt;å®¹å™¨ï¼Œè€Œä¸”åªæ”¯æŒåˆ°docker1.11ï¼Œæ—©å·²åœæ­¢å¼€å‘ã€‚æˆ‘æŠ›å¼ƒäº†&lt;strong&gt;shipyard&lt;/strong&gt;ï¼Œå®ƒçš„é¡µé¢åŠŸèƒ½åŸºæœ¬å¯æœ‰å¯æ— ï¼Œæˆ‘è‡ªå·±å¼€å‘çš„&lt;a href=&#34;https://github.com/rootsongjc/magpie&#34;&gt;magpie&lt;/a&gt;ä¸€æ ·å¯ä»¥ç®¡ç†&lt;code&gt;yarn on docker&lt;/code&gt;é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Docker Swarmæœ‰å¦‚ä¸‹å‡ ä¸ªç¼ºç‚¹&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å¯¹äºå¤§è§„æ¨¡é›†ç¾¤çš„ç®¡ç†æ•ˆç‡å¤ªä½ï¼Œå½“ç®¡ç†ä¸Šç™¾ä¸ªnodeçš„æ—¶å€™ç»å¸¸å‡ºç°æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸åŒæ­¥çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸»æœºé‡å¯åå®¹å™¨å·²ç»&lt;strong&gt;Exited&lt;/strong&gt;äº†ï¼Œä½†æ˜¯masterè®©ç„¶è®¤ä¸ºæ˜¯&lt;strong&gt;Running&lt;/strong&gt;çŠ¶æ€ï¼Œå¿…é¡»é‡å¯æ‰€æœ‰masterèŠ‚ç‚¹æ‰è¡Œã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰ä¸­å¿ƒåŒ–Nodeç®¡ç†åŠŸèƒ½ï¼Œå¿…é¡»ç™»å½•åˆ°æ¯å°nodeä¸Šæ‰‹åŠ¨å¯åœ&lt;code&gt;swarm-agent&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç®¡ç†åŠŸèƒ½å®åœ¨&lt;strong&gt;å¤ªå¤ªå¤ª&lt;/strong&gt;ç®€é™‹ï¼ŒæŸ¥çœ‹æ‰€æœ‰nodeçŠ¶æ€åªèƒ½ç”¨&lt;code&gt;docker info&lt;/code&gt;è€Œä¸”é‚£ä¸ªæ ¼å¼å°±ä¸æäº†ï¼Œshipyardé‡Œæœ‰å¤„ç†è¿™ä¸ªæ ¼å¼çš„ä»£ç ï¼Œæˆ‘copyåˆ°äº†magpieé‡Œï¼Œå½»åº•æŠ›å¼ƒshipyardäº†ã€‚&lt;/li&gt;
&lt;li&gt;Docker swarmçš„é›†ç¾¤ç®¡ç†æ¦‚å¿µç¼ºå¤±ï¼Œå› ä¸ºdockerä¸€å¼€å§‹è®¾è®¡çš„æ—¶å€™å°±ä¸æ˜¯ç”¨æ¥ç®¡ç†é›†ç¾¤çš„ï¼Œæ‰€ä»¥å‡ºç°äº†swarmï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨&lt;strong&gt;docker-compose&lt;/strong&gt;æ¥ç¼–æ’æœåŠ¡ï¼Œä½†æ˜¯æ— æ³•åœ¨swarmé›†ç¾¤ä¸­ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„&lt;strong&gt;mynet&lt;/strong&gt;ç½‘ç»œï¼Œ&lt;a href=&#34;https://github.com/docker/compose/issues/4233&#34;&gt;compose issue-4233&lt;/a&gt;ï¼Œ&lt;strong&gt;compose&lt;/strong&gt;ä¹Ÿå·²ç»è¢«dockerå®˜æ–¹åºŸå¼ƒï¼ˆæœ€è¿‘ä¸€å¹´dockerå‘å±•çš„å¤ªå¿«äº†ï¼ŒåŸæ¥ç”¨pythonå†™çš„composeå·²ç»è¢«ç”¨goé‡æ„ä¸º&lt;strong&gt;libcompose&lt;/strong&gt;ç›´æ¥é›†æˆåˆ°swarm modeé‡Œäº†ï¼‰ï¼Œè€Œä¸”docker1.11é‡Œä¹Ÿæ²¡æœ‰åƒkubernetesé‚£æ ·&lt;code&gt;service&lt;/code&gt;çš„å•ä½ï¼Œåœ¨docker1.11æ‰€æœ‰çš„ç®¡ç†éƒ½æ˜¯åŸºäºdockerå®¹å™¨çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Docker Swarmçš„é—®é¢˜ä¹Ÿæ˜¯shipyardçš„é—®é¢˜ï¼Œè°è®©shipyardç›´æ¥è°ƒç”¨dockerçš„APIå‘¢ã€‚å½“ç„¶ï¼Œåœ¨åç»­ç‰ˆæœ¬çš„dockeré‡Œä»¥ä¸Šé—®é¢˜éƒ½å·²ç»ä¸æ˜¯é—®é¢˜ï¼Œdockerå·²ç»è¶Šæ¥è¶Šåƒkubernetesï¼Œä¸è®ºæ˜¯åœ¨è®¾è®¡ç†å¿µä¸Šè¿˜æ˜¯åœ¨åŠŸèƒ½ä¸Šï¼Œç”šè‡³è¿˜å‘è¡Œäº†ä¼ä¸šç‰ˆï¼Œä»¥åæ¯ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æŠ€æœ¯é€‰å‹&#34;&gt;æŠ€æœ¯é€‰å‹&lt;/h2&gt;

&lt;p&gt;ä¸»è¦å¯¹æ¯”&lt;code&gt;Docker1.11&lt;/code&gt;å’Œ&lt;code&gt;Docker17.03-ce&lt;/code&gt;ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæœ‰ä¸€ç‚¹éœ€è¦äº†è§£çš„æ˜¯ï¼Œdocker1.12+å¸¦æ¥çš„&lt;a href=&#34;https://rootsongjc.github.io/docker-practice/docs/swarm_mode.html&#34;&gt;swarm mode&lt;/a&gt;ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ç›´æ¥å¯åŠ¨ä¸€ä¸ªå¤æ‚çš„&lt;strong&gt;stack&lt;/strong&gt;ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æœåŠ¡ç¼–æ’å’Œæ‰€æœ‰çš„æœåŠ¡é…ç½®ï¼Œè¿™æ˜¯ä¸€ä¸ª&lt;a href=&#34;https://rootsongjc.github.io/docker-practice/docs/create_swarm_app.html&#34;&gt;æŠ•ç¥¨åº”ç”¨çš„ä¾‹å­&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹è¡¨å¯¹æ¯”äº†docker1.11å’Œdocker17.03-ce&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰ˆæœ¬&lt;/th&gt;
&lt;th&gt;docker1.11&lt;/th&gt;
&lt;th&gt;docker17.03-ce&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŸºæœ¬å•ä½&lt;/td&gt;
&lt;td&gt;dockerå®¹å™¨&lt;/td&gt;
&lt;td&gt;dockerå®¹å™¨ã€serviceã€stack&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;æœåŠ¡ç¼–æ’&lt;/td&gt;
&lt;td&gt;composeï¼Œä¸æ”¯æŒdocker swarmçš„mynetç½‘ç»œ&lt;/td&gt;
&lt;td&gt;æ”¹é€ åçš„composeï¼Œæ”¯æŒstackä¸­å®Œæ•´çš„æœåŠ¡ç¼–æ’&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;ç½‘ç»œæ¨¡å‹&lt;/td&gt;
&lt;td&gt;Hostã€bridgeã€overlayã€mynet&lt;/td&gt;
&lt;td&gt;é»˜è®¤æ”¯æŒè·¨ä¸»æœºçš„overlayç½‘ç»œï¼Œåˆ›å»ºå•ä¸ªå®¹å™¨æ—¶ä¹Ÿå¯ä»¥attachåˆ°å·²æœ‰çš„overlaç½‘ç»œä¸­&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;æ’ä»¶&lt;/td&gt;
&lt;td&gt;æ²¡æœ‰æ’ä»¶ç®¡ç†å‘½ä»¤ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨åˆ›å»ºå’Œç®¡ç†&lt;/td&gt;
&lt;td&gt;æœ‰æ’ä»¶ç®¡ç†å‘½ä»¤ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºå’Œä»docker hubä¸­ä¸‹è½½ï¼Œä¸Šä¼ æ’ä»¶åˆ°è‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;å‡çº§&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒå¹³æ»‘å‡çº§ï¼Œé‡å¯dockeråŸæ¥çš„å®¹å™¨ä¹Ÿä¼šåœæ‰&lt;/td&gt;
&lt;td&gt;å¯ä»¥åœæ­¢docker engineä½†ä¸å½±å“å·²å¯åŠ¨çš„å®¹å™¨&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;å¼¹æ€§ä¼¸ç¼©&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;serviceå†…ç½®åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;æœåŠ¡å‘ç°&lt;/td&gt;
&lt;td&gt;ç›‘å¬docker eventå¢åˆ DNS&lt;/td&gt;
&lt;td&gt;å†…ç½®æœåŠ¡å‘ç°ï¼Œæ ¹æ®DNSè´Ÿè½½å‡è¡¡&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;èŠ‚ç‚¹ç®¡ç†&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨å¯åœ&lt;/td&gt;
&lt;td&gt;ä¸­å¿ƒåŒ–ç®¡ç†nodeèŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;æœåŠ¡å‡çº§&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨å‡çº§&lt;/td&gt;
&lt;td&gt;serviceå†…ç½®åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡&lt;/td&gt;
&lt;td&gt;æœ¬èº«ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;Swarm modeå†…éƒ¨DNSè½®å¯»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;åŸºäºä»¥ä¸Šå¯¹æ¯”ï¼Œä½¿ç”¨docker17.03-ceä¸ä»…å¯ä»¥å…¼å®¹ä»¥å‰çš„mynetç½‘ç»œæ¨¡å¼ï¼Œåªéœ€è¦é‡æ„ä»¥å‰çš„shrikeä¸º&lt;strong&gt;docker plugin&lt;/strong&gt;ï¼Œåœ¨åˆ›å»ºserviceçš„æ—¶å€™æŒ‡å®šä¸ºmynetå³å¯ã€‚ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨docker modeçš„overlayç½‘ç»œï¼Œè€Œä¸”è¿˜å¯ä»¥å®‰è£…å…¶å®ƒdocker pluginé¦–å…ˆæ›´é«˜çº§ç½‘ç»œå’ŒvolumeåŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;Docker17.03-ceå€Ÿé‰´äº†å¾ˆå¤škubernetesçš„è®¾è®¡ç†å¿µï¼Œdockerå‘åŠ›ä¼ä¸šçº§å¸‚åœºï¼Œç›¸ä¿¡æ–°ç‰ˆçš„æ‰ç¬¦åˆå¾®æœåŠ¡çš„æ–¹å‘ï¼Œæ—¢èƒ½å…¼å®¹ä»¥å‰çš„&lt;strong&gt;è™šæ‹Ÿæœºå¼&lt;/strong&gt;çš„ä½¿ç”¨æ¨¡å¼ï¼Œä¹Ÿèƒ½å…¼å®¹&lt;strong&gt;å¾®æœåŠ¡&lt;/strong&gt;æ¶æ„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;

&lt;p&gt;ä¹‹å‰è€ƒè™‘è¿‡ä½¿ç”¨docker1.11 + compose + shipyard + eureka + nginxç­‰åšå¾®æœåŠ¡æ¶æ„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æœ€æ–°ç‰ˆdockerçš„é‡å¤§å‡çº§ï¼Œä»é•¿è¿œçš„çœ¼å…‰æ¥çœ‹ï¼Œä¸èƒ½ä¸€ç›´é™å®šäºä¹‹å‰çš„é‚£ä¸€å¥—ï¼Œæˆ‘æ›´å€¾å‘äºæ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è°ƒç ”Docker17.03-ceçš„æ–°ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯æœåŠ¡æ²»ç†æ–¹é¢&lt;/li&gt;
&lt;li&gt;ç»“åˆå…·ä½“ä¸šåŠ¡è¯•ç”¨&lt;/li&gt;
&lt;li&gt;é‡æ„shrikeä¸ºdocker plugin&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Don&amp;rsquo;t speak, I&amp;rsquo;ll try to save us from ourselves&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;If were going down, we&amp;rsquo;re going down in flames&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

      </description>
    </item>
    
    <item>
      <title>Dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒæ­å»º</title>
      <link>https://jimmysong.io/blog/docker-dev-env/</link>
      <pubDate>Mon, 06 Mar 2017 17:03:19 +0800</pubDate>
      
      <guid>https://jimmysong.io/blog/docker-dev-env/</guid>
      <description>
        
        
        

&lt;p&gt;çœ‹äº†ä¸‹ç½‘ä¸Šå…¶ä»–äººå†™çš„dockerå¼€å‘ç¯å¢ƒæ­å»ºï¼Œè¦ä¹ˆæ˜¯åœ¨ubuntuä¸‹æ­å»ºï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨å®˜æ–¹è¯´æ˜çš„build docker-devé•œåƒçš„æ–¹å¼ä¸€æ­¥æ­¥æ­å»ºçš„ï¼Œç”šæ˜¯ç¹çï¼Œdocker hubä¸Šæœ‰ä¸€ä¸ªdockerå®˜æ–¹æ¨å‡ºçš„&lt;strong&gt;dockercore/docker&lt;/strong&gt;é•œåƒï¼Œå…¶å®è¿™å°±æ˜¯å®˜ç½‘ä¸Šæ‰€è¯´çš„docker-devé•œåƒï¼Œä¸è¿‡ä»¥å‰çš„é‚£ä¸ªdeprecatedäº†ï¼Œä½¿ç”¨ç›®å‰è¿™ä¸ªé•œåƒæ­å»ºdockerå¼€å‘ç¯å¢ƒæ˜¯æœ€å¿«æ·çš„äº†ã€‚&lt;/p&gt;

&lt;p&gt;æƒ³è¦ä¿®æ”¹dockeræºç å’Œåšdockerå®šåˆ¶å¼€å‘çš„åŒå­¦å¯ä»¥å‚è€ƒä¸‹ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/opensource/code/&#34;&gt;å®˜æ–¹æŒ‡å¯¼æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/opensource/project/set-up-dev-env/&#34;&gt;è®¾ç½®dockerå¼€å‘ç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;dockerçš„ç¼–è¯‘å®è´¨ä¸Šæ˜¯åœ¨dockerå®¹å™¨ä¸­è¿è¡Œdockerã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤åœ¨æœ¬åœ°ç¼–è¯‘dockerçš„å‰ææ˜¯éœ€è¦å®‰è£…äº†dockerï¼Œè¿˜éœ€è¦ç”¨gitæŠŠä»£ç pullä¸‹æ¥ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºåˆ†æ”¯&#34;&gt;åˆ›å»ºåˆ†æ”¯&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ä»¥åç»™dockeræäº¤æ›´æ”¹ï¼Œæˆ‘ä»¬ä»dockerå®˜æ–¹forkä¸€ä¸ªåˆ†æ”¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;git clone https://github.com/rootsongjc/docker.git
git config --local user.name &amp;quot;Jimmy Song&amp;quot;
git config --local user.email &amp;quot;rootsongjc@gmail.com&amp;quot;
git remote add upstream https://github.com/docker/docker.git
git config --local -l
git remote -v
git checkout -b dry-run-test
touch TEST.md
vim TEST.md
git status
git add TEST.md
git commit -am &amp;quot;Making a dry run test.&amp;quot;
git push --set-upstream origin dry-run-test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åå°±å¯ä»¥åœ¨&lt;code&gt;dry-run-test&lt;/code&gt;è¿™ä¸ªåˆ†æ”¯ä¸‹å·¥ä½œäº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é…ç½®dockerå¼€å‘ç¯å¢ƒ&#34;&gt;é…ç½®dockerå¼€å‘ç¯å¢ƒ&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/opensource/project/set-up-dev-env/&#34;&gt;å®˜ç½‘&lt;/a&gt;ä¸Šè¯´éœ€è¦å…ˆæ¸…ç©ºè‡ªå·±ç”µè„‘ä¸Šå·²æœ‰çš„å®¹å™¨å’Œé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;dockerå¼€å‘ç¯å¢ƒæœ¬è´¨ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªdockeré•œåƒï¼Œé•œåƒé‡ŒåŒ…å«äº†dockerçš„æ‰€æœ‰å¼€å‘è¿è¡Œç¯å¢ƒï¼Œæœ¬åœ°ä»£ç é€šè¿‡æŒ‚è½½çš„æ–¹å¼æ”¾åˆ°å®¹å™¨ä¸­è¿è¡Œï¼Œä¸‹é¢è¿™æ¡å‘½ä»¤ä¼šè‡ªåŠ¨åˆ›å»ºè¿™æ ·ä¸€ä¸ªé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;åœ¨&lt;code&gt;dry-run-test&lt;/code&gt;åˆ†æ”¯ä¸‹æ‰§è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;make BIND_DIR=. shell
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨ç¼–è¯‘ä¸€ä¸ªdockeré•œåƒï¼ŒFrom debian:jessieã€‚è¿™ä¸€æ­¥ä¼šä¸Šç½‘ä¸‹è½½å¾ˆå¤šä¾èµ–åŒ…ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚å¦‚æœç¿»ä¸äº†å¢™çš„è¯è‚¯å®šéƒ½ä¼šå¤±è´¥ã€‚å› ä¸ºéœ€è¦ä¸‹è½½çš„è½¯ä»¶å’Œå®‰è£…åŒ…éƒ½æ˜¯åœ¨å›½å¤–æœåŠ¡å™¨ä¸Šï¼Œä¸ç¿»å¢™æ ¹æœ¬å°±ä¸‹è½½ä¸ä¸‹æ¥ï¼Œä¸ºäº†ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œæ¨èç›´æ¥ä½¿ç”¨dockerå®˜æ–¹çš„dockercore/dockeré•œåƒï¼Œä¹Ÿä¸ç”¨ä»¥å‰çš„docker-devé•œåƒï¼Œé‚£ä¸ªé€ å°±åºŸå¼ƒäº†ã€‚è¿™ä¸ªé•œåƒå¤§å°æœ‰2.31Gã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker pull dockercore/docker
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨æ–¹æ³•è§ &lt;a href=&#34;https://hub.docker.com/r/dockercore/docker/&#34;&gt;docker hub&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç„¶åå°±å¯ä»¥è¿›å…¥åˆ°å®¹å™¨é‡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Shell&#34;&gt;docker run --rm -i --privileged -e BUILDFLAGS -e KEEPBUNDLE -e DOCKER_BUILD_GOGC -e DOCKER_BUILD_PKGS -e DOCKER_CLIENTONLY -e DOCKER_DEBUG -e DOCKER_EXPERIMENTAL -e DOCKER_GITCOMMIT -e DOCKER_GRAPHDRIVER=devicemapper -e DOCKER_INCREMENTAL_BINARY -e DOCKER_REMAP_ROOT -e DOCKER_STORAGE_OPTS -e DOCKER_USERLANDPROXY -e TESTDIRS -e TESTFLAGS -e TIMEOUT -v &amp;quot;/Users/jimmy/Workspace/github/rootsongjc/docker/bundles:/go/src/github.com/docker/docker/bundles&amp;quot; -t &amp;quot;dockercore/docker:latest&amp;quot; bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŒ‰ç…§å®˜ç½‘çš„è¯´æ˜makeä¼šæŠ¥é”™&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;root@f2753f78bb6d:/go/src/github.com/docker/docker# ./hack/make.sh binary                          

error: .git directory missing and DOCKER_GITCOMMIT not specified
  Please either build with the .git directory accessible, or specify the
  exact (--short) commit hash you are building using DOCKER_GITCOMMIT for
  future accountability in diagnosing build issues.  Thanks!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ä¸ª&lt;a href=&#34;https://github.com/docker/docker/issues/27581&#34;&gt;issue-27581&lt;/a&gt;ï¼Œè§£å†³æ–¹å¼å°±æ˜¯åœ¨makeçš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®š&lt;code&gt;DOCKER_GITCOMMIT&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;root@f2753f78bb6d:/go/src/github.com/docker/docker# DOCKER_GITCOMMIT=3385658 ./hack/make.sh binary

---&amp;gt; Making bundle: binary (in bundles/17.04.0-dev/binary)
Building: bundles/17.04.0-dev/binary-client/docker-17.04.0-dev
Created binary: bundles/17.04.0-dev/binary-client/docker-17.04.0-dev
Building: bundles/17.04.0-dev/binary-daemon/dockerd-17.04.0-dev
Created binary: bundles/17.04.0-dev/binary-daemon/dockerd-17.04.0-dev
Copying nested executables into bundles/17.04.0-dev/binary-daemon
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;bundlesç›®å½•ä¸‹ä¼šç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ç»“æ„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;.
â”œâ”€â”€ 17.04.0-dev
â”‚Â Â  â”œâ”€â”€ binary-client
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker -&amp;gt; docker-17.04.0-dev
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker-17.04.0-dev
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker-17.04.0-dev.md5
â”‚Â Â  â”‚Â Â  â””â”€â”€ docker-17.04.0-dev.sha256
â”‚Â Â  â””â”€â”€ binary-daemon
â”‚Â Â      â”œâ”€â”€ docker-containerd
â”‚Â Â      â”œâ”€â”€ docker-containerd-ctr
â”‚Â Â      â”œâ”€â”€ docker-containerd-ctr.md5
â”‚Â Â      â”œâ”€â”€ docker-containerd-ctr.sha256
â”‚Â Â      â”œâ”€â”€ docker-containerd-shim
â”‚Â Â      â”œâ”€â”€ docker-containerd-shim.md5
â”‚Â Â      â”œâ”€â”€ docker-containerd-shim.sha256
â”‚Â Â      â”œâ”€â”€ docker-containerd.md5
â”‚Â Â      â”œâ”€â”€ docker-containerd.sha256
â”‚Â Â      â”œâ”€â”€ docker-init
â”‚Â Â      â”œâ”€â”€ docker-init.md5
â”‚Â Â      â”œâ”€â”€ docker-init.sha256
â”‚Â Â      â”œâ”€â”€ docker-proxy
â”‚Â Â      â”œâ”€â”€ docker-proxy.md5
â”‚Â Â      â”œâ”€â”€ docker-proxy.sha256
â”‚Â Â      â”œâ”€â”€ docker-runc
â”‚Â Â      â”œâ”€â”€ docker-runc.md5
â”‚Â Â      â”œâ”€â”€ docker-runc.sha256
â”‚Â Â      â”œâ”€â”€ dockerd -&amp;gt; dockerd-17.04.0-dev
â”‚Â Â      â”œâ”€â”€ dockerd-17.04.0-dev
â”‚Â Â      â”œâ”€â”€ dockerd-17.04.0-dev.md5
â”‚Â Â      â””â”€â”€ dockerd-17.04.0-dev.sha256
â””â”€â”€ latest -&amp;gt; 17.04.0-dev

4 directories, 26 files
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å¯ä»¥å°†docker-daemonå’Œdocker-clientç›®å½•ä¸‹çš„dockerå¯ä»¥æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨çš„/usr/bin/ç›®å½•ä¸‹äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¯åŠ¨docker deamon&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker daemon -D&amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ£€æŸ¥ä¸‹dockeræ˜¯å¦å¯ç”¨&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;root@f2753f78bb6d:/go/src/github.com/docker/docker/bundles/17.04.0-dev# docker version
DEBU[0048] Calling GET /_ping                           
DEBU[0048] Calling GET /v1.27/version                   
Client:
 Version:      17.04.0-dev
 API version:  1.27
 Go version:   go1.7.5
 Git commit:   3385658
 Built:        Mon Mar  6 08:39:06 2017
 OS/Arch:      linux/amd64

Server:
 Version:      17.04.0-dev
 API version:  1.27 (minimum version 1.12)
 Go version:   go1.7.5
 Git commit:   3385658
 Built:        Mon Mar  6 08:39:06 2017
 OS/Arch:      linux/amd64
 Experimental: false
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ°æ­¤dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒéƒ½å·²ç»æ­å»ºå¥½äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæƒ³è¦ä¿®æ”¹dockeræºç ï¼Œåªè¦åœ¨ä½ çš„IDEã€å®¹å™¨é‡Œæˆ–è€…ä½ æœ¬æœºä¸Šä¿®æ”¹dockerä»£ç åï¼Œå†æ‰§è¡Œä¸Šé¢çš„hack/make.sh binaryå‘½ä»¤å°±å¯ä»¥ç”Ÿæˆæ–°çš„dockeräºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†æ›¿æ¢åŸæ¥çš„/usr/bin/ç›®å½•ä¸‹çš„dockeräºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
