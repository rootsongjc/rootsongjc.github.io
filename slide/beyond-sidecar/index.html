<p>Try readFile: /home/runner/work/website/website/content/zh/slide/beyond-sidecar/index.html</p><!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{appearance:none;background-color:initial;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTAgMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJtMzIgOTAgNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIwIiBjbGFzcz0iYSIgcng9IjUuNjciLz48cGF0aCBkPSJNNDAgNzBIMjBWNTBtMjAgMEwyMCA3MG00MC00MGgyMHYyMG0tMjAgMCAyMC0yMCIgY2xhc3M9ImEiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIwIiBjbGFzcz0iYSIgcng9IjUuNjciLz48cGF0aCBkPSJNMjAgNTBoMjB2MjBtLTIwIDAgMjAtMjBtNDAgMEg2MFYzMG0yMCAwTDYwIDUwIiBjbGFzcz0iYSIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNODcuOCA0Ny41Qzg5IDUwIDg3LjcgNTIgODUgNTJIMzVhOC43IDguNyAwIDAgMS03LjItNC41bC0xNS42LTMxQzExIDE0IDEyLjIgMTIgMTUgMTJoNTBhOC44IDguOCAwIDAgMSA3LjIgNC41ek02MCA1MnYzNm0tMTAgMGgyME00NSA0MmgyMCIvPjwvc3ZnPg==") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-bigger{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMTIgNTBoODBNNTIgOTBWMTAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-smaller{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMTIgNTBoODAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}}@keyframes __bespoke_marp_transition_reduced_outgoing__{0%{opacity:1}to{opacity:0}}@keyframes __bespoke_marp_transition_reduced_incoming__{0%{mix-blend-mode:plus-lighter;opacity:0}to{mix-blend-mode:plus-lighter;opacity:1}}.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{::view-transition-group(*){animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-timing-function:ease}::view-transition-new(*),::view-transition-old(*){animation-delay:0s;animation-direction:var(--marp-bespoke-transition-animation-direction,normal);animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-fill-mode:both;animation-name:var(--marp-bespoke-transition-animation-name,var(--marp-bespoke-transition-animation-name-fallback,__bespoke_marp_transition_no_animation__));mix-blend-mode:normal}::view-transition-old(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_outgoing__;animation-timing-function:ease}::view-transition-new(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_incoming__;animation-timing-function:ease}::view-transition-new(root),::view-transition-old(root){animation-timing-function:linear}::view-transition-new(__bespoke_marp_transition_osc__),::view-transition-old(__bespoke_marp_transition_osc__){animation-duration:0s!important;animation-name:__bespoke_marp_transition_osc__!important}::view-transition-new(__bespoke_marp_transition_osc__){opacity:0!important}.bespoke-marp-transition-warming-up::view-transition-group(*),.bespoke-marp-transition-warming-up::view-transition-new(*),.bespoke-marp-transition-warming-up::view-transition-old(*){animation-play-state:paused!important}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;opacity:0;pointer-events:none;z-index:-1}svg.bespoke-marp-slide:not(.bespoke-marp-active) *{view-transition-name:none!important}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;opacity:1;pointer-events:auto;z-index:0}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}}@media screen and (prefers-reduced-motion:reduce){svg.bespoke-marp-slide *{view-transition-name:none!important}}@media screen{[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{inset:0;position:absolute}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:#000000a6;border-radius:7px;bottom:50px;color:#fff;contain:paint;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;user-select:none;white-space:nowrap;will-change:transform;z-index:1;view-transition-name:__bespoke_marp_transition_osc__}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{background:#0288d1;flex:0 0 0;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:#0000}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{display:grid;font-family:Helvetica,Arial,sans-serif;grid-template:"current dragbar next" minmax(140px,1fr) "current dragbar note" 2fr "info    dragbar note" 3em;grid-template-columns:minmax(3px,var(--bespoke-marp-presenter-split-ratio,66%)) 0 minmax(3px,1fr);height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container{background:#0288d1;cursor:col-resize;grid-area:dragbar;margin-left:-3px;opacity:0;position:relative;transition:opacity .4s linear .1s;width:6px;z-index:10}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container:hover{opacity:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container.active{opacity:1;transition-delay:0s}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:#0000;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note;position:relative;z-index:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper{display:block;inset:0;position:absolute}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons{background:#000000a6;border-radius:4px;bottom:0;display:flex;gap:4px;margin:12px;opacity:0;padding:6px;pointer-events:none;position:absolute;right:0;transition:opacity .2s linear}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons:focus-within,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper:focus-within+.bespoke-marp-presenter-note-buttons,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container:hover .bespoke-marp-presenter-note-buttons{opacity:1;pointer-events:auto}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{box-sizing:border-box;font-size:calc(1.1em*var(--bespoke-marp-note-font-scale, 1));height:calc(100% - 40px);margin:20px;overflow:auto;padding-right:3px;white-space:pre-wrap;width:calc(100% - 40px);word-wrap:break-word;scrollbar-color:#eeeeee80 #0000;scrollbar-width:thin}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:#0000}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:#eeeeee80;border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;overflow:hidden;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{box-sizing:border-box;display:block;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer:hover{cursor:pointer}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@charset "UTF-8";@import "https://fonts.bunny.net/css?family=Lato:400,900|Roboto+Mono:400,700&display=swap";div#\:\$p > svg > foreignObject > section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center;-webkit-text-size-adjust:100%;text-size-adjust:100%}div#\:\$p > svg > foreignObject > section::after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#\:\$p > svg > foreignObject > section:not([data-marpit-pagination])::after{display:none}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){font-size:2em;margin:0.67em 0}div#\:\$p > svg > foreignObject > section video::-webkit-media-controls{will-change:transform}@page {size:1280px 720px;margin:0}@media print{html, body{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#\:\$p > svg > foreignObject > section{page-break-before:always;break-before:page}div#\:\$p > svg > foreignObject > section, div#\:\$p > svg > foreignObject > section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;transition:none!important}div#\:\$p > svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#\:\$p > svg > foreignObject > :where(section){container-type:size}div#\:\$p > svg > foreignObject > section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}/*!
 * Marp / Marpit Gaia theme.
 *
 * @theme gaia
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 16:9 1280px 720px
 * @size 4:3 960px 720px
 */div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) code.hljs{display:block;overflow-x:auto;padding:1em}div#\:\$p > svg > foreignObject > section code.hljs{padding:3px 5px}div#\:\$p > svg > foreignObject > section .hljs{background:#000;color:#f8f8f8}div#\:\$p > svg > foreignObject > section .hljs-comment,div#\:\$p > svg > foreignObject > section .hljs-quote{color:#aeaeae;font-style:italic}div#\:\$p > svg > foreignObject > section .hljs-keyword,div#\:\$p > svg > foreignObject > section .hljs-selector-tag,div#\:\$p > svg > foreignObject > section .hljs-type{color:#e28964}div#\:\$p > svg > foreignObject > section .hljs-string{color:#65b042}div#\:\$p > svg > foreignObject > section .hljs-subst{color:#daefa3}div#\:\$p > svg > foreignObject > section .hljs-link,div#\:\$p > svg > foreignObject > section .hljs-regexp{color:#e9c062}div#\:\$p > svg > foreignObject > section .hljs-name,div#\:\$p > svg > foreignObject > section .hljs-section,div#\:\$p > svg > foreignObject > section .hljs-tag,div#\:\$p > svg > foreignObject > section .hljs-title{color:#89bdff}div#\:\$p > svg > foreignObject > section .hljs-class .hljs-title,div#\:\$p > svg > foreignObject > section .hljs-doctag,div#\:\$p > svg > foreignObject > section .hljs-title.class_{text-decoration:underline}div#\:\$p > svg > foreignObject > section .hljs-bullet,div#\:\$p > svg > foreignObject > section .hljs-number,div#\:\$p > svg > foreignObject > section .hljs-symbol{color:#3387cc}div#\:\$p > svg > foreignObject > section .hljs-params,div#\:\$p > svg > foreignObject > section .hljs-template-variable,div#\:\$p > svg > foreignObject > section .hljs-variable{color:#3e87e3}div#\:\$p > svg > foreignObject > section .hljs-attribute{color:#cda869}div#\:\$p > svg > foreignObject > section .hljs-meta{color:#8996a8}div#\:\$p > svg > foreignObject > section .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}div#\:\$p > svg > foreignObject > section .hljs-addition{background-color:#253b22;color:#f8f8f8}div#\:\$p > svg > foreignObject > section .hljs-deletion{background-color:#420e09;color:#f8f8f8}div#\:\$p > svg > foreignObject > section .hljs-selector-class{color:#9b703f}div#\:\$p > svg > foreignObject > section .hljs-selector-id{color:#8b98ab}div#\:\$p > svg > foreignObject > section .hljs-emphasis{font-style:italic}div#\:\$p > svg > foreignObject > section .hljs-strong{font-weight:700}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){margin:.5em 0 0}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) strong,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) strong,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) strong,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) strong,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) strong,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) strong{font-weight:inherit}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h4, marp-h4)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h6, marp-h6)::part(auto-scaling){max-height:580px}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){font-size:1.8em}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){font-size:1.5em}div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-size:1.3em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4){font-size:1.1em}div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-size:1em}div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){font-size:.9em}div#\:\$p > svg > foreignObject > section blockquote,div#\:\$p > svg > foreignObject > section p{margin:1em 0 0}div#\:\$p > svg > foreignObject > section ol>li,div#\:\$p > svg > foreignObject > section ul>li{margin:.3em 0 0}div#\:\$p > svg > foreignObject > section ol>li>p,div#\:\$p > svg > foreignObject > section ul>li>p{margin:.6em 0 0}div#\:\$p > svg > foreignObject > section code{display:inline-block;font-family:Roboto Mono,monospace;font-size:.8em;letter-spacing:0;margin:-.1em .15em;padding:.1em .2em;vertical-align:baseline}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){display:block;margin:1em 0 0;overflow:visible}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) code{box-sizing:border-box;font-size:.7em;margin:0;min-width:100%;padding:.5em}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre)::part(auto-scaling){max-height:calc(580px - 1em)}div#\:\$p > svg > foreignObject > section blockquote{margin:1em 0 0;padding:0 1em;position:relative}div#\:\$p > svg > foreignObject > section blockquote:after,div#\:\$p > svg > foreignObject > section blockquote:before{content:"“";display:block;font-family:Times New Roman,serif;font-weight:700;position:absolute}div#\:\$p > svg > foreignObject > section blockquote:before{left:0;top:0}div#\:\$p > svg > foreignObject > section blockquote:after{bottom:0;right:0;transform:rotate(180deg)}div#\:\$p > svg > foreignObject > section blockquote>:first-child{margin-top:0}div#\:\$p > svg > foreignObject > section mark{background:transparent}div#\:\$p > svg > foreignObject > section table{border-collapse:collapse;border-spacing:0;margin:1em 0 0}div#\:\$p > svg > foreignObject > section table td,div#\:\$p > svg > foreignObject > section table th{border-style:solid;border-width:1px;padding:.2em .4em}div#\:\$p > svg > foreignObject > section footer,div#\:\$p > svg > foreignObject > section header,div#\:\$p > svg > foreignObject > section:after{box-sizing:border-box;font-size:66%;height:70px;line-height:50px;overflow:hidden;padding:10px 25px;position:absolute}div#\:\$p > svg > foreignObject > section:after{--marpit-root-font-size:66%;}div#\:\$p > svg > foreignObject > section header{top:0}div#\:\$p > svg > foreignObject > section footer,div#\:\$p > svg > foreignObject > section header{left:0;right:0}div#\:\$p > svg > foreignObject > section footer{bottom:0}div#\:\$p > svg > foreignObject > section{background-color:var(--color-background);background-image:linear-gradient(135deg, hsla(0,0%,53%,0), hsla(0,0%,53%,.02) 50%, hsla(0,0%,100%,0) 0, hsla(0,0%,100%,.05));color:var(--color-foreground);font-family:Lato,Avenir Next,Avenir,Trebuchet MS,Segoe UI,sans-serif;font-size:35px;height:720px;letter-spacing:1.25px;line-height:1.35;padding:70px;width:1280px;word-wrap:break-word;--color-background:#fff8e1;--color-background-stripe:rgba(69,90,100,.1);--color-foreground:#455a64;--color-dimmed:#6a7a7d;--color-highlight:#0288d1;}div#\:\$p > svg > foreignObject > section{--marpit-root-font-size:35px;}div#\:\$p > svg > foreignObject > section:after{bottom:0;font-size:80%;right:0}div#\:\$p > svg > foreignObject > section:after{--marpit-root-font-size:80%;}div#\:\$p > svg > foreignObject > section a,div#\:\$p > svg > foreignObject > section mark{color:var(--color-highlight)}div#\:\$p > svg > foreignObject > section code{background:var(--color-dimmed);color:var(--color-background)}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) strong,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) strong,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) strong,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) strong,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) strong,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) strong{color:var(--color-highlight)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){background:var(--color-foreground)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre)>code{background:transparent}div#\:\$p > svg > foreignObject > section blockquote:after,div#\:\$p > svg > foreignObject > section blockquote:before,div#\:\$p > svg > foreignObject > section footer,div#\:\$p > svg > foreignObject > section header,div#\:\$p > svg > foreignObject > section section:after{color:var(--color-dimmed)}div#\:\$p > svg > foreignObject > section table td,div#\:\$p > svg > foreignObject > section table th{border-color:var(--color-foreground)}div#\:\$p > svg > foreignObject > section table thead th{background:var(--color-foreground);color:var(--color-background)}div#\:\$p > svg > foreignObject > section table tbody>tr:nth-child(odd) td,div#\:\$p > svg > foreignObject > section table tbody>tr:nth-child(odd) th{background:var(--color-background-stripe, transparent)}div#\:\$p > svg > foreignObject > section>:first-child,div#\:\$p > svg > foreignObject > section>header:first-child+*{margin-top:0}div#\:\$p > svg > foreignObject > section:where(.invert){--color-background:#455a64;--color-background-stripe:rgba(255,248,225,.1);--color-foreground:#fff8e1;--color-dimmed:#dad8c8;--color-highlight:#81d4fa;}div#\:\$p > svg > foreignObject > section:where(.gaia){--color-background:#0288d1;--color-background-stripe:rgba(255,248,225,.1);--color-foreground:#fff8e1;--color-dimmed:#cce2de;--color-highlight:#81d4fa;}div#\:\$p > svg > foreignObject > section:where(.lead){align-items:stretch;flex-flow:column nowrap;place-content:safe center center}div#\:\$p > svg > foreignObject > section:where(.lead) :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section:where(.lead) :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section:where(.lead) :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section:where(.lead) :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section:where(.lead) :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section:where(.lead) :is(h6, marp-h6){text-align:center}div#\:\$p > svg > foreignObject > section:where(.lead) p{text-align:center}div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>:is(h1, marp-h1),div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>:is(h2, marp-h2),div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>:is(h3, marp-h3),div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>:is(h4, marp-h4),div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>:is(h5, marp-h5),div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>:is(h6, marp-h6),div#\:\$p > svg > foreignObject > section:where(.lead) blockquote>p{text-align:left}div#\:\$p > svg > foreignObject > section:where(.lead) ol>li>p,div#\:\$p > svg > foreignObject > section:where(.lead) ul>li>p{text-align:left}div#\:\$p > svg > foreignObject > section:where(.lead) table{margin-left:auto;margin-right:auto}div#\:\$p > svg > foreignObject > section{width:1280px;height:720px}div#\:\$p > svg > foreignObject > section img, div#\:\$p > svg > foreignObject > section svg{max-width:100%;max-height:40vh;height:auto;display:block;margin:auto}div#\:\$p > svg > foreignObject > section .flex-container{display:flex;justify-content:space-between}div#\:\$p > svg > foreignObject > section .column{width:48%}div#\:\$p > svg > foreignObject > section table{text-align:left}div#\:\$p > svg > foreignObject > section.small-font-table table{font-size:0.75em}div#\:\$p > svg > foreignObject > section.x-small-font-table table{font-size:0.6em}div#\:\$p > svg > foreignObject > section.small-font-ul ul{font-size:0.75em}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]{columns:initial!important;display:block!important;padding:0!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]::before, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]::after, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"]::before, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"]::after{display:none!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction="vertical"]{flex-direction:column}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"][data-marpit-advanced-background-split] > div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split, 50%)}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"][data-marpit-advanced-background-split="right"] > div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container] > figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container] > figure > figcaption{position:absolute;border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;white-space:nowrap;width:1px}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"], div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="pseudo"]{background:transparent!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="pseudo"], div#\:\$p > svg[data-marpit-svg] > foreignObject[data-marpit-advanced-background="pseudo"]{pointer-events:none!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background-split]{width:100%;height:100%}
</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id=":$p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-background-image="url(&quot;background/slide1.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="1" style="--background-image:url(&quot;background/slide1.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide1.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="%E8%B6%85%E8%B6%8A-sidecar">超越 Sidecar：</h1>
<h2 id="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-istio-ambient-mode-%E7%9A%84%E6%B5%81%E9%87%8F%E6%9C%BA%E5%88%B6%E4%B8%8E%E6%88%90%E6%9C%AC%E6%95%88%E7%9B%8A">深入解析 Istio Ambient Mode 的流量机制与成本效益</h2>
<p><strong>Jimmy Song (宋净超)</strong><br />
<em>Developer Advocate at Tetrate</em></p>
<p><em>March 15, 2025</em></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="2" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="%E5%86%85%E5%AE%B9%E5%A4%A7%E7%BA%B2">内容大纲</h1>
<ol>
<li>为什么关注 Ambient Mode？</li>
<li>Istio Ambient Mode 核心概念</li>
<li>流量路径与关键机制</li>
<li>Ambient Mode vs. Sidecar Mode</li>
<li>总结 &amp; Q&amp;A</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="lead" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="lead" data-marpit-pagination="3" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:lead;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="1-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%85%B3%E6%B3%A8-ambient-mode">1. 为什么关注 Ambient Mode？</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="4" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E7%9A%84%E6%8C%91%E6%88%98">服务网格的挑战</h2>
<ul>
<li>Sidecar 代理带来的 <strong>资源开销</strong> 和 <strong>运维复杂度</strong></li>
<li><strong>升级</strong> 或 <strong>重启</strong> 常常要连带重启所有 Pod</li>
<li>越来越多对 <strong>高性能、低成本</strong> 的需求</li>
</ul>
<p><strong>思考</strong>：有没有一种方式在保留服务网格核心能力（安全、可观测、流量控制）的同时，减少对每个 Pod 的侵入和额外资源消耗？</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="5" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E7%9A%84%E5%9B%9B%E7%A7%8D%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F">服务网格的四种部署模式</h2>
<p><img src="proxy-location.svg" alt="代理的位置" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="6" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="ambient-mode-%E7%9A%84%E8%AF%9E%E7%94%9F">Ambient Mode 的诞生</h2>
<ul>
<li>Istio 新一代架构，<strong>移除 Sidecar</strong>，通过 <strong>ztunnel + Waypoint Proxy</strong> 实现数据面的轻量化</li>
<li>节省资源、降低复杂度</li>
<li>依然支持 <strong>mTLS、策略管控</strong>，并提供 L7 级别代理的可选能力</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-table" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-table" data-marpit-pagination="7" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-table;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94">部署模式对比</h2>
<table>
<thead>
<tr>
<th><strong>模式</strong></th>
<th><strong>安全性</strong></th>
<th><strong>效率</strong></th>
<th><strong>可管理性</strong></th>
<th><strong>性能</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sidecar 模式</strong></td>
<td>高安全性，隔离的代理</td>
<td>资源使用率高</td>
<td>集中化管理，但较为复杂</td>
<td>增加延迟</td>
</tr>
<tr>
<td><strong>Ambient 模式</strong></td>
<td>通过 ztunnel 提供安全性，仍在发展中</td>
<td>更高效，共享代理</td>
<td>管理更简单，但存在一定风险</td>
<td>良好，但可能有跨可用区（AZ）成本</td>
</tr>
<tr>
<td><strong>Cilium mesh</strong></td>
<td>中等安全性，基于 eBPF</td>
<td>内核级效率</td>
<td>配置复杂</td>
<td>视情况而定，可能增加延迟</td>
</tr>
<tr>
<td><strong>gRPC</strong></td>
<td>集成安全性，依赖应用自身</td>
<td>高效</td>
<td>需要复杂的更新管理</td>
<td>低延迟，适用于实时场景</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="8" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<p><img src="istio-data-plane-deployment-modes.svg" alt="部署模式象限" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="lead" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="lead" data-marpit-pagination="9" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:lead;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="2-istio-ambient-mode-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">2. Istio Ambient Mode 核心概念</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-ul" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-ul" data-marpit-pagination="10" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-ul;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="ambient-mode-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">Ambient Mode 的核心组件</h2>
<ul>
<li>ztunnel (L4)：
<ul>
<li>Node 级代理</li>
<li>负责 <strong>透明流量拦截</strong>、<strong>mTLS</strong> 加密</li>
<li>大部分流量只需 L4 转发</li>
</ul>
</li>
<li>Waypoint Proxy (L7)：
<ul>
<li>按需部署（Namespace / Service / Pod 级）</li>
<li>处理 <strong>HTTP/gRPC</strong> 等高级功能（鉴权、路由、可观测）</li>
</ul>
</li>
<li>Istio CNI
<ul>
<li>取代 <code>istio-init</code> 容器，对 Pod 发出的流量发起拦截</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="11" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="ambient-%E6%A8%A1%E5%BC%8F%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84">Ambient 模式整体架构</h2>
<p><img src="istio-ambient-layers.svg" alt="Istio Ambient Architecture" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="12" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="waypoint-proxy-%E9%83%A8%E7%BD%B2%E7%AD%96%E7%95%A5">Waypoint Proxy 部署策略</h2>
<ul>
<li><strong>Namespace 级</strong>（默认）：适用于该命名空间下所有 Workload</li>
<li><strong>Service 级</strong>：仅特定关键服务需要 L7</li>
<li><strong>Pod 级</strong>：更精细化控制</li>
<li><strong>跨 Namespace</strong>：可以使用 Gateway 资源共享</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-ul" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-ul" data-marpit-pagination="13" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-ul;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="istio-cni">Istio CNI</h2>
<ul>
<li><strong>流量拦截</strong>：取代 <code>istio-init</code> 容器，使安装更加清晰简洁。</li>
<li><strong>支持两种模式</strong>：兼容 <strong>Sidecar 模式</strong> 和 <strong>Ambient 模式</strong>。</li>
<li><strong>非特权模式兼容性</strong>：允许 Pod 运行在无特权模式下，增强安全性。</li>
<li><strong>CNI 链接（Chaining）</strong>：通过添加 Istio CNI 扩展节点的 CNI 配置。</li>
<li><strong>Pod 内部流量重定向（Ambient 模式）</strong>：
<ul>
<li>在 Pod 的网络命名空间内使用 <code>iptables REDIRECT</code> 规则。</li>
<li>创建 Pod 内部的 socket 以拦截和代理流量。</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="14" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E8%A7%A3%E5%86%B3%E4%B8%8E-kubernetes-cni-%E7%9A%84%E5%86%B2%E7%AA%81">解决与 Kubernetes CNI 的冲突</h2>
<p><img src="istio-cni.svg" alt="Istio CNI 插件的运行步骤" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="15" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="istio-cni-%E6%8F%92%E4%BB%B6%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">Istio CNI 插件工作原理</h2>
<p><img src="istio-cni-diagram.svg" alt="Istio CNI 插件工作原理" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="lead" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="lead" data-marpit-pagination="16" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:lead;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="3-%E6%B5%81%E9%87%8F%E8%B7%AF%E5%BE%84%E4%B8%8E%E5%85%B3%E9%94%AE%E6%9C%BA%E5%88%B6">3. 流量路径与关键机制</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-ul" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-ul" data-marpit-pagination="17" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-ul;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E9%80%8F%E6%98%8E%E6%B5%81%E9%87%8F%E6%8B%A6%E6%88%AA">透明流量拦截</h2>
<ul>
<li><strong>Istio CNI</strong> 负责在 Pod 网络命名空间中注入 iptables 规则</li>
<li>Pod 发出的流量被重定向到 <strong>ztunnel</strong></li>
<li>ztunnel 再决定是否需要发送给 <strong>Waypoint Proxy</strong> 进行 L7 处理</li>
</ul>
<p><img src="transparent-traffic-interception.svg" alt="Transparent Traffic Interception" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-ul" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-ul" data-marpit-pagination="18" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-ul;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E6%95%B0%E6%8D%AE%E5%8C%85%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%A6%82%E8%A7%88">数据包生命周期概览</h2>
<ol>
<li><strong>Pod → ztunnel</strong></li>
<li><strong>ztunnel</strong> 解析目标 &amp; mTLS 加密</li>
<li>（如需要 L7 策略）流量转发到 <strong>Waypoint Proxy</strong></li>
<li><strong>Waypoint Proxy</strong> 进行鉴权、路由、可观测等</li>
<li><strong>ztunnel →  Pod</strong></li>
<li>流量最终到达目标 Pod</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="19" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="hbone-%E5%8D%8F%E8%AE%AE">HBONE 协议</h2>
<ul>
<li>基于 <strong>HTTP/2 + CONNECT</strong> 搭建安全隧道</li>
<li>实现 <strong>mTLS 加密</strong> 和多路复用</li>
<li>减少额外连接开销，简化代理处理过程</li>
</ul>
<p><img src="hbone-packet.svg" alt="HBONE" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-ul" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-ul" data-marpit-pagination="20" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-ul;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="hbone-%E5%8D%8F%E8%AE%AE%E7%A4%BA%E4%BE%8B">HBONE 协议示例</h2>
<p><strong>ztunnel A →  ztunnel B：</strong></p>
<ul>
<li><strong>Source</strong>: ztunnel_A_IP:52368</li>
<li><strong>Destination</strong>: Node_B_IP:15008</li>
</ul>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-ini">:method: CONNECT
:scheme: https
:authority: Pod_B_IP:9080
:path: /api/v1/users?<span class="hljs-attr">id</span>=<span class="hljs-number">123</span>
x-envoy-original-dst-host: Pod_B_IP:9080
x-forwarded-proto: hbone
x-istio-attributes: ...
x-istio-auth-userinfo: ...
...
</code></pre>

<h2 id="%E5%90%8C%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F">同节点上的加密流量</h2>
<p><img src="ambient-traffic-on-the-same-node.svg" alt="同节点上的加密流量" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="21" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E8%B7%A8%E8%8A%82%E7%82%B9%E7%9A%84%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8Fl4">跨节点的加密流量（L4）</h2>
<p><img src="ambient-traffic-on-the-same-node-l4.svg" alt="跨节点的加密流量（L4）" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="22" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E8%B7%A8%E8%8A%82%E7%82%B9%E7%9A%84%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8Fl7">跨节点的加密流量（L7）</h2>
<p><img src="ambient-traffic-on-the-same-node-l7.svg" alt="跨节点的加密流量（L7）" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="23" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E5%85%9C%E5%BA%95%E6%B5%81%E9%87%8F%E9%98%B2%E6%AD%A2%E6%B5%81%E9%87%8F%E9%80%83%E9%80%B8">兜底流量（防止流量逃逸）</h2>
<p><img src="non-istio-mesh-pod-taffic-go-into-the-mesh.svg" alt="来自非mesh内部的流量" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="24" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="l4-%E4%B8%8E-l7-%E6%B5%81%E9%87%8F%E5%B7%AE%E5%BC%82">L4 与 L7 流量差异</h2>
<table>
<thead>
<tr>
<th>流量类型</th>
<th>处理位置</th>
<th>示例场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>L4</strong></td>
<td>ztunnel（透明转发）</td>
<td>TCP 级别流量，不需应用层策略</td>
</tr>
<tr>
<td><strong>L7</strong></td>
<td>ztunnel → Waypoint Proxy</td>
<td>HTTP/gRPC 需要鉴权、熔断、路由等</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="lead" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="lead" data-marpit-pagination="25" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:lead;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="4-ambient-mode-vs-sidecar-mode">4. Ambient Mode vs. Sidecar Mode</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="26" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="ambient-%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%99%90%E5%88%B6">Ambient 模式的限制</h2>
<p>以下功能在 Sidecar 模式下支持，但 Ambient 模式尚未支持：</p>
<ul>
<li>当共用 Sidecar 模式和 Ambient 模式时：失去对单个 Pod 的精准定制</li>
<li>多集群安装</li>
<li>多网络支持</li>
<li>虚拟机支持</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="small-font-table" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="small-font-table" data-marpit-pagination="27" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:small-font-table;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E5%8A%9F%E8%83%BD%E4%B8%8E%E5%B7%AE%E5%BC%82%E5%AF%B9%E6%AF%94">功能与差异对比</h2>
<table>
<thead>
<tr>
<th>指标</th>
<th><strong>Sidecar 模式</strong></th>
<th><strong>Ambient 模式</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>代理位置</strong></td>
<td>每个 Pod 都有 Envoy Sidecar</td>
<td>Node 级 ztunnel + 可选 Waypoint Proxy</td>
</tr>
<tr>
<td><strong>资源开销</strong></td>
<td>占用每个 Pod 的 CPU/内存</td>
<td>较低，代理共享在节点或命名空间级</td>
</tr>
<tr>
<td><strong>运维复杂度</strong></td>
<td>注入/升级 Sidecar 需重启或滚动更新所有 Pod</td>
<td>部署/升级更简单，可只升级 ztunnel / Waypoint</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>单 Pod 隔离性好，但整体有额外开销</td>
<td>L4 性能更好，L7 需要额外一次转发</td>
</tr>
<tr>
<td><strong>功能完整度</strong></td>
<td>已较成熟，支持多集群、VM、混合网络环境</td>
<td>尚在演进，部分高级功能（多网络、VM）未完全支持</td>
</tr>
<tr>
<td><strong>典型使用场景</strong></td>
<td>注重严格隔离、可灵活控制任意流量</td>
<td>大规模集群、需要<strong>轻量化</strong>管理的环境</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="28" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE">选择建议</h2>
<ul>
<li>若已有 <strong>Sidecar</strong> 架构且依赖大量成熟特性：可先继续使用 Sidecar</li>
<li>追求 <strong>资源节省</strong>、<strong>运维简化</strong>，且大部分流量在 L4：可尝试 <strong>Ambient Mode</strong></li>
<li>如果需 <strong>部分应用</strong> 仍保留 Sidecar，也可做 <strong>混合部署</strong> (但需要额外规划)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-class="lead" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" class="lead" data-marpit-pagination="29" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--class:lead;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h1 id="5-%E6%80%BB%E7%BB%93--qa">5. 总结 &amp; Q&amp;A</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="30" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9%E5%9B%9E%E9%A1%BE">核心要点回顾</h2>
<ol>
<li><strong>Ambient Mode</strong>：减少每个 Pod 的代理负担，降低运维成本</li>
<li><strong>ztunnel + Waypoint</strong> 架构：只在需要 L7 功能时才使用 Waypoint</li>
<li>虽已 GA，但仍需注意 <strong>多集群 / VM / 多网络</strong> 等限制，尚缺乏最佳实践</li>
<li>使用场景：<strong>大量 L4 流量 + 大规模集群</strong> + 对资源与管理要求高的团队</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-background-image="url(&quot;background/slide2.png&quot;)" data-paginate="true" data-theme="gaia" data-style="img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
" lang="en-US" data-marpit-pagination="31" style="--background-image:url(&quot;background/slide2.png&quot;);--paginate:true;--theme:gaia;--style:img, svg {
  max-width: 100%;
  max-height: 40vh;
  height: auto;
  display: block;
  margin: auto;
}
.flex-container {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 48%;
}
table {
  text-align: left;
}
section.small-font-table table {
  font-size: 0.75em;
}
section.x-small-font-table table {
  font-size: 0.6em;
}
section.small-font-ul ul {
  font-size: 0.75em;
}
;background-image:url(&quot;background/slide2.png&quot;);background-position:center;background-repeat:no-repeat;background-size:cover;" data-marpit-pagination-total="31" data-size="16:9">
<h2 id="q--a">Q &amp; A</h2>
<p>感谢聆听<br />
如想了解更多，可访问<br />
<a href="https://jimmysong.io">jimmysong.io</a></p>
</section>
<script>!function(){"use strict";const t={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},e="data-marp-auto-scaling-wrapper",i="data-marp-auto-scaling-svg",n="data-marp-auto-scaling-container";class s extends HTMLElement{container;containerSize;containerObserver;svg;svgComputedStyle;svgPreserveAspectRatio="xMinYMid meet";wrapper;wrapperSize;wrapperObserver;constructor(){super();const t=t=>([e])=>{const{width:i,height:n}=e.contentRect;this[t]={width:i,height:n},this.updateSVGRect()};this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(t("containerSize")),this.wrapperObserver=new ResizeObserver(((...e)=>{t("wrapperSize")(...e),this.flushSvgDisplay()}))}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){this.shadowRoot.innerHTML=`\n<style>\n  svg[${i}] { display: block; width: 100%; height: auto; vertical-align: top; }\n  span[${n}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }\n</style>\n<div ${e}>\n  <svg part="svg" ${i}>\n    <foreignObject><span ${n}><slot></slot></span></foreignObject>\n  </svg>\n</div>\n    `.split(/\n\s*/).join(""),this.wrapper=this.shadowRoot.querySelector(`div[${e}]`)??void 0;const t=this.svg;this.svg=this.wrapper?.querySelector(`svg[${i}]`)??void 0,this.svg!==t&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=this.svg?.querySelector(`span[${n}]`)??void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:t}=this;t&&(t.style.display="inline",requestAnimationFrame((()=>{t.style.display=""})))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(t){const e=()=>{const i=(()=>{const e=t.getPropertyValue("--preserve-aspect-ratio");if(e)return e.trim();return`x${(({textAlign:t,direction:e})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if("start"===t||"end"===t){let i="rtl"===e;return"end"===t&&(i=!i),i?"Max":"Min"}return"Mid"})(t)}YMid meet`})();i!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=i,this.updateSVGRect()),t===this.svgComputedStyle&&requestAnimationFrame(e)};e()}updateSVGRect(){let t=Math.ceil(this.containerSize?.width??0);const e=Math.ceil(this.containerSize?.height??0);void 0!==this.dataset.downscaleOnly&&(t=Math.max(t,this.wrapperSize?.width??0));const i=this.svg?.querySelector(":scope > foreignObject");if(i?.setAttribute("width",`${t}`),i?.setAttribute("height",`${e}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${t} ${e}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=t<=0||e<=0?"0":""),this.container){const t=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=t.startsWith("xmid")||t.startsWith("xmax")?"auto":"0",this.container.style.marginRight=t.startsWith("xmi")?"auto":"0"}}}const r=(t,{attrs:e={},style:i})=>class extends t{constructor(...t){super(...t);for(const[t,i]of Object.entries(e))this.hasAttribute(t)||this.setAttribute(t,i);this._shadow()}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_shadow(){if(!this.shadowRoot)try{this.attachShadow({mode:"open"})}catch(t){if(!(t instanceof Error&&"NotSupportedError"===t.name))throw t}return this.shadowRoot}_update(){const t=this._shadow();if(t){const e=i?`<style>:host { ${i} }</style>`:"";let n="<slot></slot>";const{autoScaling:s}=this.dataset;if(void 0!==s){n=`<marp-auto-scaling exportparts="svg:auto-scaling" ${"downscale-only"===s?"data-downscale-only":""}>${n}</marp-auto-scaling>`}t.innerHTML=e+n}}};let o;const a=Symbol();let l;const c="marpitSVGPolyfill:setZoomFactor,",d=Symbol(),h=Symbol();const g=()=>{const t="Apple Computer, Inc."===navigator.vendor,e=t?[u]:[],i={then:e=>(t?(async()=>{if(void 0===l){const t=document.createElement("canvas");t.width=10,t.height=10;const e=t.getContext("2d"),i=new Image(10,10),n=new Promise((t=>{i.addEventListener("load",(()=>t()))}));i.crossOrigin="anonymous",i.src="data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%2210%22%20viewBox%3D%220%200%201%201%22%3E%3CforeignObject%20width%3D%221%22%20height%3D%221%22%20requiredExtensions%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22width%3A%201px%3B%20height%3A%201px%3B%20background%3A%20red%3B%20position%3A%20relative%22%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3C%2Fsvg%3E",await n,e.drawImage(i,0,0),l=e.getImageData(5,5,1,1).data[3]<128}return l})().then((t=>{null==e||e(t?[u]:[])})):null==e||e([]),i)};return Object.assign(e,i)};let p,m;function u(t){const e="object"==typeof t&&t.target||document,i="object"==typeof t?t.zoom:t;window[h]||(Object.defineProperty(window,h,{configurable:!0,value:!0}),document.body.style.zoom=1.0001,document.body.offsetHeight,document.body.style.zoom=1,window.addEventListener("message",(({data:t,origin:e})=>{if(e===window.origin)try{if(t&&"string"==typeof t&&t.startsWith(c)){const[,e]=t.split(","),i=Number.parseFloat(e);Number.isNaN(i)||(m=i)}}catch(t){console.error(t)}})));let n=!1;Array.from(e.querySelectorAll("svg[data-marpit-svg]"),(t=>{var e,s,r,o;t.style.transform||(t.style.transform="translateZ(0)");const a=i||m||t.currentScale||1;p!==a&&(p=a,n=a);const l=t.getBoundingClientRect(),{length:c}=t.children;for(let i=0;i<c;i+=1){const n=t.children[i];if(n.getScreenCTM){const t=n.getScreenCTM();if(t){const i=null!==(s=null===(e=n.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==s?s:0,c=null!==(o=null===(r=n.y)||void 0===r?void 0:r.baseVal.value)&&void 0!==o?o:0,d=n.children.length;for(let e=0;e<d;e+=1){const s=n.children[e];if("SECTION"===s.tagName){const{style:e}=s;e.transformOrigin||(e.transformOrigin=`${-i}px ${-c}px`),e.transform=`scale(${a}) matrix(${t.a}, ${t.b}, ${t.c}, ${t.d}, ${t.e-l.left}, ${t.f-l.top}) translateZ(0.0001px)`;break}}}}}})),!1!==n&&Array.from(e.querySelectorAll("iframe"),(({contentWindow:t})=>{null==t||t.postMessage(`${c}${n}`,"null"===window.origin?"*":window.origin)}))}function v({once:t=!1,target:e=document}={}){const i=function(t=document){if(t[d])return t[d];let e=!0;const i=()=>{e=!1,delete t[d]};Object.defineProperty(t,d,{configurable:!0,value:i});let n=[],s=!1;(async()=>{try{n=await g()}finally{s=!0}})();const r=()=>{for(const e of n)e({target:t});s&&0===n.length||e&&window.requestAnimationFrame(r)};return r(),i}(e);return t?(i(),()=>{}):i}p=1,m=void 0;const w=Symbol(),b=(e=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const i=window[a];i||customElements.define("marp-auto-scaling",s);for(const n of Object.keys(t)){const s=`marp-${n}`,a=t[n].proto();(o??(o=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is"),o))&&a!==HTMLElement?i||customElements.define(s,r(a,{style:t[n].style}),{extends:n}):(i||customElements.define(s,r(HTMLElement,t[n])),e.querySelectorAll(`${n}[is="${s}"]`).forEach((t=>{t.outerHTML=t.outerHTML.replace(new RegExp(`^<${n}`,"i"),`<${s}`).replace(new RegExp(`</${n}>$`,"i"),`</${s}>`)})))}window[a]=!0})(e),e[w])return e[w];const i=v({target:e}),n=()=>{i(),delete e[w]},l=Object.assign(n,{cleanup:n,update:()=>b(e)});return Object.defineProperty(e,w,{configurable:!0,value:l}),l},y=document.currentScript;b(y?y.getRootNode():document)}();
</script></foreignObject></svg></div><div class="bespoke-marp-note" data-index="0" tabindex="0"><p>大家好，我是 Jimmy Song，现任 Tetrate 的 Developer Advocate，欢迎来到我的演讲——“超越 Sidecar：深入解析 Istio Ambient Mode 的流量机制与成本效益”。
我们今天会聚焦 Istio 今年非常火的新特性——Ambient Mode，这种新模式号称能去掉 Sidecar，带来更低的资源开销与更简单的运维。
在接下来的时间里，我会带大家一步步了解 Istio Ambient Mode 的架构、流量路径，以及它在生产实践中可能带来的价值与限制。希望能帮助大家快速评估并上手这项技术。</p></div><div class="bespoke-marp-note" data-index="1" tabindex="0"><p>这是我今天的分享大纲，主要分为五个部分：
1）先和大家聊聊为什么需要一个新的数据面模式。
2）然后介绍 Ambient Mode 的核心概念和组件。
3）我们会深入看看它的流量拦截和转发机制，也就是它最核心的部分。
4）会跟现有的 Sidecar 模式做一个对比，看看两者在功能、性能和运维上的差异。
5）最后做一个总结，然后留点时间给大家 Q&amp;A。

我们先看第一部分，“为什么要关注 Ambient Mode”？</p></div><div class="bespoke-marp-note" data-index="2" tabindex="0"><p>首先，我们来思考一个问题：为什么要关注、甚至尝试这种新模式？Sidecar 在服务网格里一直都用得好好的，为什么要“去 Sidecar”呢？
让我们看看当前服务网格面临的一些问题和挑战。</p></div><div class="bespoke-marp-note" data-index="3" tabindex="0"><p>这里列出了服务网格在生产上常见的一些问题：

以前在每个 Pod 里都注入一个 Sidecar Envoy，让我们可以做流量观测、mTLS 加密等高级功能。但随着微服务规模越来越大，Sidecar 带来的 CPU、内存消耗 也变得很显著。
在升级 Istio 或者 Envoy 时，需要对所有 Pod 做滚动更新；这不仅花费大量运维精力，还会对业务可用性造成影响。
业务对 高性能、低成本 的追求越来越强烈，Sidecar 模式下的资源浪费和管理麻烦已经成为一大痛点。
我们就要思考：能不能在 保持核心的安全、可观测、流量控制能力 的同时，减少 Sidecar 带来的这些额外负担？</p></div><div class="bespoke-marp-note" data-index="4" tabindex="0"><p>其实服务网格的发展也一直在探索各种代理部署位置，比如：

Sidecar：在每个 Pod 内跑一个 Envoy；
Ambient：将代理从 Pod 中剥离到节点级；
Cilium Mesh：利用 eBPF 在内核空间做 L4，然后再结合 Envoy 做 L7；
gRPC：直接将网格能力集成到 SDK 里。
不同的模式在功能、安全、性能、管理复杂度上也不尽相同。Ambient 是 Istio 官方推出的新尝试，我们接下来会详细探讨它。</p></div><div class="bespoke-marp-note" data-index="5" tabindex="0"><p>Ambient Mode 是 Istio 项目为了应对 Sidecar 的资源和管理成本而提出的新架构。

不再在每个 Pod 里放 Envoy，而是改用节点级的 ztunnel 提供 L4 流量转发与加密。
需要 HTTP / gRPC 等 L7 能力时，部署一个 “Waypoint Proxy” 作为可选的代理，不再强制所有 Pod 都注入代理。
这样做在大规模集群中可以节省很多资源和运维精力，而仍然保留了 mTLS 和基本流量管理能力。</p></div><div class="bespoke-marp-note" data-index="6" tabindex="0"><p>这是一个简单的对比表，我们可以看到：

Sidecar 模式：安全性高，但资源消耗大，运维相对繁琐。
Ambient 模式：依靠 ztunnel 提供加密，Waypoint 提供 L7，整体更高效，管理也更简单，但目前还在不断完善。
Cilium mesh：利用 eBPF 在内核态处理流量，效率高但配置也复杂；
gRPC：如果你是 gRPC 重度用户，可以将它集成到客户端中。
每种模式都有自己的优劣，这就看项目需求了。</p></div><div class="bespoke-marp-note" data-index="7" tabindex="0"><p>这里是另一张对照图，我们用“效率”和“安全性”两个维度把几种模式分布在象限里。可以看到 Sidecar 与 Ambient 各有侧重。
Ambient 更偏向资源效率与可管理性，Sidecar 则是对隔离与安全要求特别严格时更合适。
当然，Cilium Mesh、gRPC 也是各有应用场景。</p></div><div class="bespoke-marp-note" data-index="8" tabindex="0"><p>接下来我们正式进入第二部分，深入看看 Ambient Mode 的具体组件，包括 ztunnel、Waypoint Proxy 以及 Istio CNI 在其中扮演的角色。</p></div><div class="bespoke-marp-note" data-index="9" tabindex="0"><p>在 Ambient 模式中，有三个核心角色：
ztunnel：每个节点部署一个轻量级 L4 代理，用来拦截和加密流量。
Waypoint Proxy：可选的 L7 代理，当我们需要鉴权、路由、可观测等 HTTP 层功能时才会部署，按命名空间、服务或 Pod 级别灵活配置。
Istio CNI：现在用 CNI 来完成流量劫持，不再需要在每个 Pod 注入一个 init 容器。
这样一来，就把大部分负担从每个 Pod 中移除，提高了资源效率，也更容易运维。</p></div><div class="bespoke-marp-note" data-index="10" tabindex="0"><p>这张图展示了 Ambient 模式的整体架构，我们可以看到两个覆盖层，一个是 ztunnel 安全层，一个是 Waypoint 代理层。
每个节点上跑一个 ztunnel，对所有在这个节点上的 Pod 进行流量拦截与加密。
如果某些服务需要 L7 能力，则在对应的命名空间或者服务上部署一个 Waypoint Proxy，流量只在需要时才经过它。
Control Plane 依然是 Istiod，负责给 ztunnel 和 Waypoint 下发证书和配置。
这样就减少了在每个 Pod 中都要运行 Envoy Sidecar 的需求。</p></div><div class="bespoke-marp-note" data-index="11" tabindex="0"><p>Waypoint Proxy 的部署是非常灵活的：
如果你有一个命名空间下大多数服务都需要 HTTP 层策略，可以部署一个共享的 Waypoint。
如果只有特定关键服务需要 L7 代理，可以给它们单独布一个 Waypoint。
也可以针对某个 Pod 定制，或者在多个 Namespace 间做共享。
这就比 Sidecar 模式更弹性，也不会强制所有服务都进行 L7 代理。</p></div><div class="bespoke-marp-note" data-index="12" tabindex="0"><p>接下来再看 Istio CNI：

过去我们在 Sidecar 模式里常常用一个 init 容器来注入 iptables 规则；Ambient 改为用 CNI 来做这件事情。
无论是 Sidecar 还是 Ambient，都可以用这个 CNI；而且它支持 非特权模式，让我们的 Kubernetes 集群更加安全。
在 Ambient 下，CNI 会在 Pod 内部配置 iptables，把对外流量转到 ztunnel 的端口。</p></div><div class="bespoke-marp-note" data-index="13" tabindex="0"><p>这张图简单示意了 Istio CNI 如何与 Kubernetes 本身的网络插件（如 Calico、Cilium 等）组合在一起。它修改了本机的 CNI 配置，增加了 CNI 链，在 Kubernetes 分配完 Pod IP 后，紧接着就会执行 Istio CNI 的拦截逻辑，把网络流量规则注入到 Pod netns。并且为不同模式中 Pod 配置不同的 iptables 规则。
这样就与原本的 CNI 配置（包括网络策略）形成一个链式流程，不会相互冲突。</p></div><div class="bespoke-marp-note" data-index="14" tabindex="0"><p>这张图详细描绘了当 Pod 启动时，Istio CNI 会怎么做：
它会进入 Pod 的网络命名空间，创建一套 iptables 规则，把流量劫持到 ztunnel 监听的 socket 上。
不再需要在每个 Pod 里注入 init 容器，也不需要特权权限，这就让整体部署更干净、也更安全。
ztunnel会在pod的网络命名空间中建立一个socket，并且为节点上的每个pod都会建立一个。</p></div><div class="bespoke-marp-note" data-index="15" tabindex="0"><p>介绍完组件之后，我们来看看最核心的“流量路径”。zTunnel 和 Waypoint 究竟是怎么拦截并转发流量的？我们会从透明流量拦截、HBONE 协议等角度进行解析。</p></div><div class="bespoke-marp-note" data-index="16" tabindex="0"><p>如图所示，Kubelet 在节点上启动了一个 Pod，这个事件被 Istio CNI Agent 监听到，Istio CNI Agent 进入 Pod 的网络空间，设置 iptables 规则将流量重定向到本地 socket，并将 Pod 的文件描述符（FD）发送为 ztunnel。ztunnel 获取到 FD 之后就可以在 Pod 的网络空间中创建 socket。
Pod 在发送流量时，本该直连目标地址，但是 iptables 规则会把它拦截到本节点的 ztunnel 进程里，然后 ztunnel 决定这条流量需不需要交给 Waypoint 做 L7 代理。
如果不需要，就直接在 L4 层把它加密转发到目标 Pod；如果要 L7，例如鉴权，就再把流量隧道给 Waypoint。</p></div><div class="bespoke-marp-note" data-index="17" tabindex="0"><p>这是一个简化的 6 个步骤的生命周期：
1）数据从 Pod 发出，被 CNI 重定向到 ztunnel；
2）ztunnel 做加密，如果需要 L7 再：
3）把流量交给 Waypoint；
4）Waypoint 做高级策略；
5）再回到目标节点或本节点的 ztunnel；
6）最终到 Pod。
对于大多数只需 L4 代理的场景，这样就非常高效。</p></div><div class="bespoke-marp-note" data-index="18" tabindex="0"><p>HBONE 是 Ambient 中非常重要的协议，它利用 HTTP/2 CONNECT 来建立隧道，结合 mTLS 做加密。
这样做有几个好处：
多路复用，减少了额外的连接；
通过 CONNECT 隧道传输任意 L4 流量；
让 ztunnel、Waypoint 能更灵活地处理分层策略。
这也跟 Sidecar 模式里 Envoy-to-Envoy 的通信方式不太一样。
ztunnel之间、ztunnel和Waypoint代理之间都可以建立 HBONE 隧道。</p></div><div class="bespoke-marp-note" data-index="19" tabindex="0"><p>这一页我们来看一个更具体的 HBONE 协议示例。我们都知道，HBONE 使用的是 HTTP/2 CONNECT 隧道 + mTLS 加密的方式，把原本 TCP 流量封装进来。
在这个示例里，假设 ztunnel A 需要把流量发送给 目标节点 B，我们可以看到外层的 TCP 连接其实是从 ztunnel_A_IP:52368 连到 Node_B_IP:15008。这是 ztunnel A 和 ztunnel B 之间的隧道端口，15008 就是 HBONE 监听端口。

进入到 HTTP/2 层后，就会有一个 CONNECT 请求，里面的 :authority 显示的是 Pod_B_IP:9080，表示实际上要连到 Pod B 的 9080 端口。x-envoy-original-dst-host 里也能看出相同信息。

同时我们看到了一些自定义头，比如 x-forwarded-proto、x-istio-attributes 等，用来给目标 ztunnel 或后续代理带去更多上下文和安全验证信息。

可以把这个理解为：在 HTTP/2 CONNECT 之上，流量就像加了一个“内层”隧道，把应用层的请求（例如 /api/v1/users?id=123）封装在这里面，然后在 ztunnel B 端解封装并转发到真实的 Pod B。

整个过程对应用来说是透明的，但对我们来说，通过查看这种 CONNECT 请求头，可以了解 Ambient 模式如何在 HTTP/2 层做流量路由和身份认证。这就是为什么说 HBONE 比传统的 Sidecar-to-Sidecar通信更加灵活，也更便于做 mTLS 以及 L7 扩展。</p><p>如果源 Pod 和目标 Pod 恰好在同一个节点上，流量会走 ztunnel 的 L4 加密流程。
这里显示，ztunnel 是使用 DaemonSet 部署在每个节点上的，并且使用了host Network，共享主机的网络。Istio CNI 将 Pod 的出站流量拦截到 ztunnel的15001端口，如果源和目的 pod 在同一个节点上，ztunnel 直接在内部完成加解密后将流量发送到目的地 pod。
如果需要 L7 的流量处理，比如鉴权，ztunnel 就会与 Waypoint 代理建立 HBONE 隧道，经过 Waypoint 代理的转发到目的 Pod。</p></div><div class="bespoke-marp-note" data-index="20" tabindex="0"><p>这是跨节点的情况，也就是最常见的场景：
源节点的 ztunnel 把流量通过 HBONE 隧道加密后发给目标节点的 ztunnel；
目标节点 ztunnel 解封装，再把明文流量递给目标 Pod。
只要是纯 L4 无需 L7，就不必加一层 Waypoint，减少了代理链路。</p></div><div class="bespoke-marp-note" data-index="21" tabindex="0"><p>当我们需要 L7 处理时，流量就会多经过一下 Waypoint。也就是：
源 ztunnel 先把流量隧道给 Waypoint；
Waypoint 在 HTTP 层做鉴权、路由等；
Waypoint 再用 HBONE 把流量发给目标 ztunnel；
目标 ztunnel 解封装后给目标 Pod。
这个流程比 L4 多了一次代理，但好处是只有特定流量才会被 L7 代理解析，减少不必要的开销。</p></div><div class="bespoke-marp-note" data-index="22" tabindex="0"><p>对于非 Istio网格内部的流量，通过 Pod IP和端口直接访问 Pod时，为了防止这些流量逃出 ztunnel的掌控，也需要拦截这些流量。如果流量是访问的应用端口，通过判断数据包上是否带有 0x539 标记，如果没有，则将其转发到 ztunnel 监听的 15006 明文端口，经 ztunnel 处理后会带上 0x539 标记，然后就可以访问应用的目标端口了；如果流量的目的端口是 15008，那么实际上就会被 ztunnel 监听和处理，判断 HBONE 协议。</p></div><div class="bespoke-marp-note" data-index="23" tabindex="0"><p>小结一下：
L4 场景：只走 ztunnel，性能好，资源消耗更低；
L7 场景：ztunnel + Waypoint，多一层处理，但能实现完整的 HTTP/gRPC 策略。
这样比原先在所有 Pod 都注入 Sidecar 做 L7，更具弹性和可控性。</p></div><div class="bespoke-marp-note" data-index="24" tabindex="0"><p>有了对 Ambient 的了解后，我们还是得和原有的 Sidecar 模式做对比，来看看哪些功能还不完善，哪些场景更适合 Ambient。</p></div><div class="bespoke-marp-note" data-index="25" tabindex="0"><p>这里列出了一些 Ambient 模式的限制点：
Sidecar 模式可以对每个 Pod 做 EnvoyFilter、WASM 插件等精准定制，但 Ambient 模式下，如果已经把代理抽到节点层或 Waypoint，就无法对单个 Pod 的代理做深度改造。
多集群、多网络、以及 VM 工作负载支持，目前还在逐步完善中。
这意味着如果你的生产环境依赖这些功能，短期内可能还需要保留 Sidecar。</p></div><div class="bespoke-marp-note" data-index="26" tabindex="0"><p>我们把 Sidecar 与 Ambient 的差别列在一个表里：
代理位置：Sidecar 在每 Pod，Ambient 是节点或命名空间一级；
资源消耗：Sidecar 总体更高，Ambient 可以共享；
功能完整度：Sidecar 更成熟，Ambient 还有一些高级功能不完备；
性能：L4 场景 Ambient 更快，L7 需要经过 Waypoint，但依然比每个 Pod Sidecar 占用更少的资源。
大家可以根据自己团队需求做取舍。</p></div><div class="bespoke-marp-note" data-index="27" tabindex="0"><p>如果你已经在生产上跑 Sidecar 并且依赖很多 EnvoyFilter、自定义插件，短期内没必要着急迁移；
如果你手上有规模很大的集群、对运维和资源成本很敏感，并且大部分流量只需要 L4 安全，那么不妨去试一下 Ambient 模式；
也可以做个混合部署，比如关键服务还用 Sidecar，其他业务服务切到 Ambient，这就要求你在一个网格里同时管理两套模式，会更复杂，但也更灵活。</p></div><div class="bespoke-marp-note" data-index="28" tabindex="0"><p>好的，最后我们来总结一下 Ambient Mode 的优缺点，以及当前适合哪些场景。然后再进入 Q&amp;A 环节。</p></div><div class="bespoke-marp-note" data-index="29" tabindex="0"><p>这四点就是我们今天讨论的核心：
1）Ambient Mode 带来的最大好处就是“去 Sidecar”，节省资源并简化运维；
2）采用 ztunnel + Waypoint 的分层设计，L7 流量才用 Waypoint。
3）目前 Istio 已宣称 Ambient Mode GA，但多集群、VM 等还不够完善，你得考虑风险；
4）最典型适合大规模、主要跑 TCP 流量的集群，可以先行试点。
如果你对安全隔离、可观测可控性有更高要求，再考虑合适的模式或混合部署。</p></div><div class="bespoke-marp-note" data-index="30" tabindex="0"><p>今天的内容就到这里，非常感谢大家的聆听！
你们可以在我的个人网站 jimmysong.io 获取更多分享和资料。
如果大家有什么问题，欢迎现在提问，或者会后与我交流。谢谢！</p></div><script>/*!! License: https://unpkg.com/@marp-team/marp-cli@4.1.2/lib/bespoke.js.LICENSE.txt */
!function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n,r=(n||(n=1,t={from:function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),o=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,(function(e){return"SCRIPT"!==e.nodeName})),a={},i=function(e,t){return(t=t||{}).index=o.indexOf(e),t.slide=e,t},s=function(e,t){a[e]=(a[e]||[]).filter((function(e){return e!==t}))},c=function(e,t){return(a[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},l=function(e,t){o[e]&&(n&&c("deactivate",i(n,t)),n=o[e],c("activate",i(n,t)))},d=function(e,t){var r=o.indexOf(n)+e;c(e>0?"next":"prev",i(n,t))&&l(r,t)},u={off:s,on:function(e,t){return(a[e]||(a[e]=[])).push(t),s.bind(null,e,t)},fire:c,slide:function(e,t){if(!arguments.length)return o.indexOf(n);c("slide",i(o[e],t))&&l(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:o,destroy:function(e){c("destroy",i(n,e)),a={}}};return(t||[]).forEach((function(e){e(u)})),n||l(0),u}}),t),o=e(r);const a=document.body,i=(...e)=>history.replaceState(...e),s="",c="presenter",l="next",d=["",c,l],u="bespoke-marp-",f=`data-${u}`,m=(e,{protocol:t,host:n,pathname:r,hash:o}=location)=>{const a=e.toString();return`${t}//${n}${r}${a?"?":""}${a}${o}`},g=()=>a.dataset.bespokeView,p=e=>new URLSearchParams(location.search).get(e),v=(e,t={})=>{const n={location,setter:i,...t},r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter({...window.history.state??{}},"",m(r,n.location))}catch(e){console.error(e)}},h=(()=>{const e="bespoke-marp";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}})(),y=e=>{try{return localStorage.getItem(e)}catch{return null}},b=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch{return!1}},w=e=>{try{return localStorage.removeItem(e),!0}catch{return!1}},x=(e,t)=>{const n="aria-hidden";t?e.setAttribute(n,"true"):e.removeAttribute(n)},k=e=>{e.parent.classList.add(`${u}parent`),e.slides.forEach((e=>e.classList.add(`${u}slide`))),e.on("activate",(t=>{const n=`${u}active`,r=t.slide,o=r.classList,a=!o.contains(n);if(e.slides.forEach((e=>{e.classList.remove(n),x(e,!0)})),o.add(n),x(r,!1),a){const e=`${n}-ready`;o.add(e),document.body.clientHeight,o.remove(e)}}))},$=e=>{let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map((e=>[null,...e.querySelectorAll("[data-marpit-fragment]")]))});const r=r=>void 0!==e.fragments[t][n+r],o=(r,o)=>{t=r,n=o,e.fragments.forEach(((e,t)=>{e.forEach(((e,n)=>{if(null==e)return;const a=t<r||t===r&&n<=o;e.setAttribute(`${f}fragment`,(a?"":"in")+"active");const i=`${f}current-fragment`;t===r&&n===o?e.setAttribute(i,"current"):e.removeAttribute(i)}))})),e.fragmentIndex=o;const a={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:o};e.fire("fragment",a)};e.on("next",(({fragment:a=!0})=>{if(a){if(r(1))return o(t,n+1),!1;const a=t+1;e.fragments[a]&&o(a,0)}else{const r=e.fragments[t].length;if(n+1<r)return o(t,r-1),!1;const a=e.fragments[t+1];a&&o(t+1,a.length-1)}})),e.on("prev",(({fragment:a=!0})=>{if(r(-1)&&a)return o(t,n-1),!1;const i=t-1;e.fragments[i]&&o(i,e.fragments[i].length-1)})),e.on("slide",(({index:t,fragment:n})=>{let r=0;if(void 0!==n){const o=e.fragments[t];if(o){const{length:e}=o;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}o(t,r)})),o(0,0)},E=document,L=()=>!(!E.fullscreenEnabled&&!E.webkitFullscreenEnabled),S=()=>!(!E.fullscreenElement&&!E.webkitFullscreenElement),P=e=>{e.fullscreen=()=>{L()&&(async()=>{S()?(E.exitFullscreen||E.webkitExitFullscreen)?.call(E):((e=E.body)=>{(e.requestFullscreen||e.webkitRequestFullscreen)?.call(e)})()})()},document.addEventListener("keydown",(t=>{"f"!==t.key&&"F11"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!L()||(e.fullscreen(),t.preventDefault())}))},_=`${u}inactive`,T=(e=2e3)=>({parent:t,fire:n})=>{const r=t.classList,o=e=>n(`marp-${e?"":"in"}active`);let a;const i=()=>{a&&clearTimeout(a),a=setTimeout((()=>{r.add(_),o()}),e),r.contains(_)&&(r.remove(_),o(!0))};for(const e of["mousedown","mousemove","touchend"])document.addEventListener(e,i);setTimeout(i,0)},I=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"],M=e=>{e.parent.addEventListener("keydown",(e=>{if(!e.target)return;const t=e.target;(I.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()}))},O=e=>{window.addEventListener("load",(()=>{for(const t of e.slides){const e=t.querySelector("marp-auto-scaling, [data-auto-scaling], [data-marp-fitting]");t.setAttribute(`${f}load`,e?"":"hideable")}}))},A=({interval:e=250}={})=>t=>{document.addEventListener("keydown",(e=>{if(" "===e.key&&e.shiftKey)t.prev();else if("ArrowLeft"===e.key||"ArrowUp"===e.key||"PageUp"===e.key)t.prev({fragment:!e.shiftKey});else if(" "!==e.key||e.shiftKey)if("ArrowRight"===e.key||"ArrowDown"===e.key||"PageDown"===e.key)t.next({fragment:!e.shiftKey});else if("End"===e.key)t.slide(t.slides.length-1,{fragment:-1});else{if("Home"!==e.key)return;t.slide(0)}else t.next();e.preventDefault()}));let n,r,o=0;t.parent.addEventListener("wheel",(a=>{let i=!1;const s=(e,t)=>{e&&(i=i||((e,t)=>((e,t)=>{const n="X"===t?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]})(e,t)&&((e,t)=>{const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r})(getComputedStyle(e),t))(e,t)),e?.parentElement&&s(e.parentElement,t)};if(0!==a.deltaX&&s(a.target,"X"),0!==a.deltaY&&s(a.target,"Y"),i)return;a.preventDefault();const c=Math.sqrt(a.deltaX**2+a.deltaY**2);if(void 0!==a.wheelDelta){if(void 0===a.webkitForce&&Math.abs(a.wheelDelta)<40)return;if(a.deltaMode===a.DOM_DELTA_PIXEL&&c<4)return}else if(a.deltaMode===a.DOM_DELTA_PIXEL&&c<12)return;r&&clearTimeout(r),r=setTimeout((()=>{n=0}),e);const l=Date.now()-o<e,d=c<=n;if(n=c,l||d)return;let u;(a.deltaX>0||a.deltaY>0)&&(u="next"),(a.deltaX<0||a.deltaY<0)&&(u="prev"),u&&(t[u](),o=Date.now())}))},C=(e=`.${u}osc`)=>{const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[${f}osc=${JSON.stringify(e)}]`).forEach(n)};return L()||n("fullscreen",(e=>e.style.display="none")),h||n("presenter",(e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."})),e=>{t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;n&&t.target.blur();const r={fragment:!t.shiftKey};"next"===n?e.next(r):"prev"===n?e.prev(r):"fullscreen"===n?e?.fullscreen():"presenter"===n&&e.openPresenterView()}})),e.parent.appendChild(t),e.on("activate",(({index:t})=>{n("page",(n=>n.textContent=`Page ${t+1} of ${e.slides.length}`))})),e.on("fragment",(({index:t,fragments:r,fragmentIndex:o})=>{n("prev",(e=>e.disabled=0===t&&0===o)),n("next",(n=>n.disabled=t===e.slides.length-1&&o===r.length-1))})),e.on("marp-active",(()=>x(t,!1))),e.on("marp-inactive",(()=>x(t,!0))),L()&&(e=>{for(const t of["","webkit"])E.addEventListener(t+"fullscreenchange",e)})((()=>n("fullscreen",(e=>e.classList.toggle("exit",L()&&S())))))}},D=e=>{window.addEventListener("message",(t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let o=Number.parseInt(t,10),a=Number.parseInt(n,10)+1;a>=e.fragments[o].length&&(o+=1,a=0),e.slide(o,{fragment:a})}}))};var N,B,q,K,j,F,V,U={exports:{}},X=(N||(N=1,U.exports=(B=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],q=function(e){return String(e).replace(/[&<>"']/g,(function(e){return"&"+K[e]+";"}))},K={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},j="dangerouslySetInnerHTML",F={className:"class",htmlFor:"for"},V={},function(e,t){var n=[],r="";t=t||{};for(var o=arguments.length;o-- >2;)n.push(arguments[o]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(var a in t)!1!==t[a]&&null!=t[a]&&a!==j&&(r+=" "+(F[a]?F[a]:q(a))+'="'+q(t[a])+'"');r+=">"}if(-1===B.indexOf(e)){if(t[j])r+=t[j].__html;else for(;n.length;){var i=n.pop();if(i)if(i.pop)for(var s=i.length;s--;)n.push(i[s]);else r+=!0===V[i]?i:q(i)}r+=e?"</"+e+">":""}return V[r]=!0,r})),U.exports),H=e(X);const R=({children:e})=>H(null,null,...e),W=`${u}presenter-`,J={container:`${W}container`,dragbar:`${W}dragbar-container`,next:`${W}next`,nextContainer:`${W}next-container`,noteContainer:`${W}note-container`,noteWrapper:`${W}note-wrapper`,noteButtons:`${W}note-buttons`,infoContainer:`${W}info-container`,infoPage:`${W}info-page`,infoPageText:`${W}info-page-text`,infoPagePrev:`${W}info-page-prev`,infoPageNext:`${W}info-page-next`,noteButtonsBigger:`${W}note-bigger`,noteButtonsSmaller:`${W}note-smaller`,infoTime:`${W}info-time`,infoTimer:`${W}info-timer`},Y=e=>{const{title:t}=document;document.title="[Presenter view]"+(t?` - ${t}`:"");const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=J.container,t.appendChild(e),t.insertAdjacentHTML("beforeend",H(R,null,H("div",{class:J.nextContainer},H("iframe",{class:J.next,src:"?view=next"})),H("div",{class:J.dragbar}),H("div",{class:J.noteContainer},H("div",{class:J.noteWrapper}),H("div",{class:J.noteButtons},H("button",{class:J.noteButtonsSmaller,tabindex:"-1",title:"Smaller notes font size"},"Smaller notes font size"),H("button",{class:J.noteButtonsBigger,tabindex:"-1",title:"Bigger notes font size"},"Bigger notes font size"))),H("div",{class:J.infoContainer},H("div",{class:J.infoPage},H("button",{class:J.infoPagePrev,tabindex:"-1",title:"Previous"},"Previous"),H("span",{class:J.infoPageText}),H("button",{class:J.infoPageNext,tabindex:"-1",title:"Next"},"Next")),H("time",{class:J.infoTime,title:"Current time"}),H("time",{class:J.infoTimer,title:"Timer"})))),t})(e.parent)),(e=>{let t=!1;r(J.dragbar).addEventListener("mousedown",(()=>{t=!0,r(J.dragbar).classList.add("active")})),window.addEventListener("mouseup",(()=>{t=!1,r(J.dragbar).classList.remove("active")})),window.addEventListener("mousemove",(e=>{if(!t)return;const n=e.clientX/document.documentElement.clientWidth*100;r(J.container).style.setProperty("--bespoke-marp-presenter-split-ratio",`${Math.max(0,Math.min(100,n))}%`)})),r(J.nextContainer).addEventListener("click",(()=>e.next()));const n=r(J.next),o=(a=n,(e,t)=>a.contentWindow?.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin));var a;n.addEventListener("load",(()=>{r(J.nextContainer).classList.add("active"),o(e.slide(),e.fragmentIndex),e.on("fragment",(({index:e,fragmentIndex:t})=>o(e,t)))}));const i=document.querySelectorAll(".bespoke-marp-note");i.forEach((e=>{e.addEventListener("keydown",(e=>e.stopPropagation())),r(J.noteWrapper).appendChild(e)})),e.on("activate",(()=>i.forEach((t=>t.classList.toggle("active",t.dataset.index==e.slide())))));let s=0;const c=e=>{s=Math.max(-5,s+e),r(J.noteContainer).style.setProperty("--bespoke-marp-note-font-scale",(1.2**s).toFixed(4))},l=()=>c(1),d=()=>c(-1),u=r(J.noteButtonsBigger),f=r(J.noteButtonsSmaller);u.addEventListener("click",(()=>{u.blur(),l()})),f.addEventListener("click",(()=>{f.blur(),d()})),document.addEventListener("keydown",(e=>{"+"===e.key&&l(),"-"===e.key&&d()}),!0),e.on("activate",(({index:t})=>{r(J.infoPageText).textContent=`${t+1} / ${e.slides.length}`}));const m=r(J.infoPagePrev),g=r(J.infoPageNext);m.addEventListener("click",(t=>{m.blur(),e.prev({fragment:!t.shiftKey})})),g.addEventListener("click",(t=>{g.blur(),e.next({fragment:!t.shiftKey})})),e.on("fragment",(({index:t,fragments:n,fragmentIndex:r})=>{m.disabled=0===t&&0===r,g.disabled=t===e.slides.length-1&&r===n.length-1}));let p=new Date;const v=()=>{const e=new Date,t=e=>`${Math.floor(e)}`.padStart(2,"0"),n=e.getTime()-p.getTime(),o=t(n/1e3%60),a=t(n/1e3/60%60),i=t(n/36e5%24);r(J.infoTime).textContent=e.toLocaleTimeString(),r(J.infoTimer).textContent=`${i}:${a}:${o}`};v(),setInterval(v,250),r(J.infoTimer).addEventListener("click",(()=>{p=new Date}))})(e)},z=e=>{if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:G},presenterUrl:{enumerable:!0,get:Q}}),h&&document.addEventListener("keydown",(t=>{"p"!==t.key||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())}))};function G(){const{max:e,floor:t}=Math,n=e(t(.85*window.innerWidth),640),r=e(t(.85*window.innerHeight),360);return window.open(this.presenterUrl,W+this.syncKey,`width=${n},height=${r},menubar=no,toolbar=no`)}function Q(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),m(e)}const Z=e=>{const t=g();return t===l&&e.appendChild(document.createElement("span")),{[s]:z,[c]:Y,[l]:D}[t]},ee=e=>{e.on("activate",(t=>{document.querySelectorAll(".bespoke-progress-parent > .bespoke-progress-bar").forEach((n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"}))}))},te=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t},ne=(e={})=>{const t={history:!0,...e};return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},o=(t={fragment:!0})=>{let n=t.fragment?te(p("f")||""):null;((t,n)=>{const{min:r,max:o}=Math,{fragments:a,slides:i}=e,s=o(0,r(t,i.length-1)),c=o(0,r(n||0,a[s].length-1));s===e.slide()&&c===e.fragmentIndex||e.slide(s,{fragment:c})})((()=>{if(location.hash){const[t]=location.hash.slice(1).split(":~:");if(/^\d+$/.test(t))return(te(t)??1)-1;const r=document.getElementById(t)||document.querySelector(`a[name="${CSS.escape(t)}"]`);if(r){const{length:t}=e.slides;for(let o=0;o<t;o+=1)if(e.slides[o].contains(r)){const t=e.fragments?.[o],a=r.closest("[data-marpit-fragment]");if(t&&a){const e=t.indexOf(a);e>=0&&(n=e)}return o}}}return 0})(),n)};e.on("fragment",(({index:e,fragmentIndex:r})=>{n||v({f:0===r||r.toString()},{location:{...location,hash:`#${e+1}`},setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})})),setTimeout((()=>{o(),window.addEventListener("hashchange",(()=>r((()=>{o({fragment:!1}),v({f:void 0})})))),window.addEventListener("popstate",(()=>{n||r((()=>o()))})),n=!1}),0)}},re=(e={})=>{const t=e.key||window.history.state?.marpBespokeSyncKey||Math.random().toString(36).slice(2),n=`bespoke-marp-sync-${t}`;var r;r={marpBespokeSyncKey:t},v({},{setter:(e,...t)=>i({...e,...r},...t)});const o=()=>{const e=y(n);return e?JSON.parse(e):Object.create(null)},a=e=>{const t=o(),r={...t,...e(t)};return b(n,JSON.stringify(r)),r},s=()=>{window.removeEventListener("pageshow",s),a((e=>({reference:(e.reference||0)+1})))};return e=>{s(),Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let r=!0;setTimeout((()=>{e.on("fragment",(e=>{r&&a((()=>({index:e.index,fragmentIndex:e.fragmentIndex})))}))}),0),window.addEventListener("storage",(t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),o=JSON.parse(t.newValue);if(n.index!==o.index||n.fragmentIndex!==o.fragmentIndex)try{r=!1,e.slide(o.index,{fragment:o.fragmentIndex,forSync:!0})}finally{r=!0}}}));const i=()=>{const{reference:e}=o();void 0===e||e<=1?w(n):a((()=>({reference:e-1})))};window.addEventListener("pagehide",(e=>{e.persisted&&window.addEventListener("pageshow",s),i()})),e.on("destroy",i)}},{PI:oe,abs:ae,sqrt:ie,atan2:se}=Math,ce={passive:!0},le=({slope:e=-.7,swipeThreshold:t=30}={})=>n=>{let r;const o=n.parent,a=e=>{const t=o.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};o.addEventListener("touchstart",(({touches:e})=>{r=1===e.length?a(e[0]):void 0}),ce),o.addEventListener("touchmove",(e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=a(e.touches[0]),n=t.x-r.x,o=t.y-r.y;r.delta=ie(ae(n)**2+ae(o)**2),r.radian=se(n,o)}else r=void 0})),o.addEventListener("touchend",(o=>{if(r){if(r.delta&&r.delta>=t&&r.radian){const t=(r.radian-e+oe)%(2*oe)-oe;n[t<0?"next":"prev"](),o.stopPropagation()}r=void 0}}),ce)},de=new Map;de.clear(),de.set("none",{backward:{both:void 0,incoming:void 0,outgoing:void 0},forward:{both:void 0,incoming:void 0,outgoing:void 0}});const ue={both:"",outgoing:"outgoing-",incoming:"incoming-"},fe={forward:"",backward:"-backward"},me=e=>`--marp-bespoke-transition-animation-${e}`,ge=e=>`--marp-transition-${e}`,pe=me("name"),ve=me("duration"),he=e=>new Promise((t=>{const n={},r=document.createElement("div"),o=e=>{r.remove(),t(e)};r.addEventListener("animationstart",(()=>o(n))),Object.assign(r.style,{animationName:e,animationDuration:"1s",animationFillMode:"both",animationPlayState:"paused",position:"absolute",pointerEvents:"none"}),document.body.appendChild(r);const a=getComputedStyle(r).getPropertyValue(ge("duration"));a&&(n.defaultDuration=a),((e,t)=>{requestAnimationFrame((()=>{e.style.animationPlayState="running",requestAnimationFrame((()=>t(void 0)))}))})(r,o)})),ye=async e=>de.has(e)?de.get(e):(e=>{const t={},n=[];for(const[r,o]of Object.entries(ue))for(const[a,i]of Object.entries(fe)){const s=`marp-${o}transition${i}-${e}`;n.push(he(s).then((e=>{t[a]=t[a]||{},t[a][r]=e?{...e,name:s}:void 0})))}return Promise.all(n).then((()=>t))})(e).then((t=>(de.set(e,t),t))),be=e=>Object.values(e).flatMap(Object.values).every((e=>!e)),we=(e,{type:t,backward:n})=>{const r=e[n?"backward":"forward"],o=(()=>{const e=r[t],n=e=>({[pe]:e.name});if(e)return n(e);if(r.both){const e=n(r.both);return"incoming"===t&&(e[me("direction")]="reverse"),e}})();return!o&&n?we(e,{type:t,backward:!1}):o||{[pe]:"__bespoke_marp_transition_no_animation__"}},xe=e=>{if(e)try{const t=JSON.parse(e);if((e=>{if("object"!=typeof e)return!1;const t=e;return"string"==typeof t.name&&(void 0===t.duration||"string"==typeof t.duration)})(t))return t}catch{}},ke="_tSId",$e="_tA",Ee="bespoke-marp-transition-warming-up",Le=window.matchMedia("(prefers-reduced-motion: reduce)"),Se="__bespoke_marp_transition_reduced_outgoing__",Pe="__bespoke_marp_transition_reduced_incoming__",_e={forward:{both:void 0,incoming:{name:Pe},outgoing:{name:Se}},backward:{both:void 0,incoming:{name:Pe},outgoing:{name:Se}}},Te=e=>{if(!document.startViewTransition)return;const t=t=>(void 0!==t&&(e._tD=t),e._tD);let n;t(!1),((...e)=>{const t=[...new Set(e).values()];return Promise.all(t.map((e=>ye(e)))).then()})(...Array.from(document.querySelectorAll("section[data-transition], section[data-transition-back]")).flatMap((e=>[e.dataset.transition,e.dataset.transitionBack].flatMap((e=>{const t=xe(e);return[t?.name,t?.builtinFallback?`__builtin__${t.name}`:void 0]})).filter((e=>!!e))))).then((()=>{document.querySelectorAll("style").forEach((e=>{e.innerHTML=e.innerHTML.replace(/--marp-transition-duration:[^;}]*[;}]/g,(e=>e.slice(0,-1)+"!important"+e.slice(-1)))}))}));const r=(n,{back:r,cond:o})=>a=>{const i=t();if(i)return!!a[$e]||!("object"!=typeof i||(i.skipTransition(),!a.forSync));if(!o(a))return!0;const s=e.slides[e.slide()],c=()=>a.back??r,l="data-transition"+(c()?"-back":""),d=s.querySelector(`section[${l}]`);if(!d)return!0;const u=xe(d.getAttribute(l)??void 0);return!u||((async(e,{builtinFallback:t=!0}={})=>{let n=await ye(e);if(be(n)){if(!t)return;return n=await ye(`__builtin__${e}`),be(n)?void 0:n}return n})(u.name,{builtinFallback:u.builtinFallback}).then((e=>{if(!e){t(!0);try{n(a)}finally{t(!1)}return}let r=e;Le.matches&&(console.warn("Use a constant animation to transition because preferring reduced motion by viewer has detected."),r=_e);const o=document.getElementById(ke);o&&o.remove();const i=document.createElement("style");i.id=ke,document.head.appendChild(i),((e,t)=>{const n=[`:root{${ge("direction")}:${t.backward?-1:1};}`,":root:has(.bespoke-marp-inactive){cursor:none;}"],r=t=>{const n=e[t].both?.defaultDuration||e[t].outgoing?.defaultDuration||e[t].incoming?.defaultDuration;return"forward"===t?n:n||r("forward")},o=t.duration||r(t.backward?"backward":"forward");void 0!==o&&n.push(`::view-transition-group(*){${ve}:${o};}`);const a=e=>Object.entries(e).map((([e,t])=>`${e}:${t};`)).join("");return n.push(`::view-transition-old(root){${a(we(e,{...t,type:"outgoing"}))}}`,`::view-transition-new(root){${a(we(e,{...t,type:"incoming"}))}}`),n})(r,{backward:c(),duration:u.duration}).forEach((e=>i.sheet?.insertRule(e)));const s=document.documentElement.classList;s.add(Ee);let l=!1;const d=()=>{l||(n(a),l=!0,s.remove(Ee))},f=()=>{t(!1),i.remove(),s.remove(Ee)};try{t(!0);const e=document.startViewTransition(d);t(e),e.finished.finally(f)}catch(e){console.error(e),d(),f()}})),!1)};e.on("prev",r((t=>e.prev({...t,[$e]:!0})),{back:!0,cond:e=>e.index>0&&!((e.fragment??1)&&n.fragmentIndex>0)})),e.on("next",r((t=>e.next({...t,[$e]:!0})),{cond:t=>t.index+1<e.slides.length&&!(n.fragmentIndex+1<n.fragments.length)})),setTimeout((()=>{e.on("slide",r((t=>e.slide(t.index,{...t,[$e]:!0})),{cond:t=>{const n=e.slide();return t.index!==n&&(t.back=t.index<n,!0)}}))}),0),e.on("fragment",(e=>{n=e}))};let Ie;const Me=()=>(void 0===Ie&&(Ie="wakeLock"in navigator&&navigator.wakeLock),Ie),Oe=async()=>{const e=Me();if(e)try{return await e.request("screen")}catch(e){console.warn(e)}return null},Ae=async()=>{if(!Me())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Oe()};for(const e of["visibilitychange","fullscreenchange"])document.addEventListener(e,t);return e=await Oe(),e};((e=document.getElementById(":$p"))=>{(()=>{const e=p("view");a.dataset.bespokeView=e===l||e===c?e:""})();const t=(e=>{const t=p(e);return v({[e]:void 0}),t})("sync")||void 0;o.from(e,((...e)=>{const t=d.findIndex((e=>g()===e));return e.map((([e,n])=>e[t]&&n)).filter((e=>e))})([[1,1,0],re({key:t})],[[1,1,1],Z(e)],[[1,1,0],M],[[1,1,1],k],[[1,0,0],T()],[[1,1,1],O],[[1,1,1],ne({history:!1})],[[1,1,0],A()],[[1,1,0],P],[[1,0,0],ee],[[1,1,0],le()],[[1,0,0],C()],[[1,0,0],Te],[[1,1,1],$],[[1,1,0],Ae]))})()}();</script></body></html>