<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>Introducing Kmesh: Revolutionizing Service Mesh Data Planes with Kernel-Native Technology - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="Kmesh utilizes eBPF and kernel enhancements to achieve a high-performance, low-latency service mesh data plane. It revolutionizes the traditional Sidecar architecture, reduces resource consumption, and is suitable for modern cloud-native applications.">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.f6911c0ac7d2b5b69c3f2d9f2a2b3b496b5da0608580347fdb4dc11ef74f3ec5.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.f6911c0ac7d2b5b69c3f2d9f2a2b3b496b5da0608580347fdb4dc11ef74f3ec5.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/introducing-kmesh-kernel-native-service-mesh/" />
  <meta property="og:title" content="Introducing Kmesh: Revolutionizing Service Mesh Data Planes with Kernel-Native Technology | Jimmy Song" />
  <meta property="twitter:title" content="Introducing Kmesh: Revolutionizing Service Mesh Data Planes with Kernel-Native Technology | Jimmy Song" />

  
  <meta property="og:description" content="Kmesh utilizes eBPF and kernel enhancements to achieve a high-performance, low-latency service mesh data plane. It revolutionizes the traditional Sidecar architecture, reduces resource consumption, and is suitable for modern cloud-native applications." />
  <meta property="twitter:description" content="Kmesh utilizes eBPF and kernel enhancements to achieve a high-performance, low-latency service mesh data plane. It revolutionizes the traditional Sidecar architecture, reduces resource consumption, and is suitable for modern cloud-native applications." />

  
  <meta property="og:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />
  <meta property="twitter:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    
                  
                
              
              
              
                
                  
                    
                    <a class="nav-link" href="/blog/introducing-kmesh-kernel-native-service-mesh/">中文</a>
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>Search</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>Search</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="Close"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="Input the keyword">
        
        <div class="mt-4">
          <span>Search type: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">All</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">Blog</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">Book</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">Notice</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    Introducing Kmesh: Revolutionizing Service Mesh Data Planes With Kernel-Native Technology
                </p>
                <p class="page-description">
                    Kmesh utilizes eBPF and kernel enhancements to achieve a high-performance, low-latency service mesh data plane. It revolutionizes the traditional Sidecar architecture, reduces resource consumption, and is suitable for modern cloud-native applications.
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>Sep 19, 2024</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/en/categories/service-mesh"> 
                        Service Mesh</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>8 Minute</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>1665 words</li>
                    
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">

            
            
            
              <div class="alert alert-note-container mt-2">
    <div class="alert-note-title px-2 py-2">
      Copyright
    </div>
    <div class="alert-tip px-2">
      This is an original article by Jimmy Song. You may repost it, but please credit this source: <a title=https://jimmysong.io/en/blog/introducing-kmesh-kernel-native-service-mesh/>https://jimmysong.io/en/blog/introducing-kmesh-kernel-native-service-mesh/</a>
     </div>
  </div>
            

            
              <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#limitations-of-traditional-sidecar-architectures">Limitations of Traditional Sidecar Architectures</a></li>
    <li><a href="#industry-attempts-to-address-the-challenges">Industry Attempts to Address the Challenges</a>
      <ul>
        <li><a href="#cilium-service-mesh">Cilium Service Mesh</a></li>
        <li><a href="#istio-ambient-mesh">Istio Ambient Mesh</a></li>
      </ul>
    </li>
    <li><a href="#introducing-kmesh-a-kernel-native-approach">Introducing Kmesh: A Kernel-Native Approach</a>
      <ul>
        <li><a href="#technical-architecture">Technical Architecture</a></li>
        <li><a href="#key-advantages">Key Advantages</a></li>
      </ul>
    </li>
    <li><a href="#two-operational-modes-of-kmesh">Two Operational Modes of Kmesh</a>
      <ul>
        <li><a href="#kernel-native-mode">Kernel-Native Mode</a></li>
        <li><a href="#dual-engine-mode">Dual Engine Mode</a></li>
      </ul>
    </li>
    <li><a href="#deep-dive-into-kmeshs-technology">Deep Dive into Kmesh&rsquo;s Technology</a>
      <ul>
        <li><a href="#ebpf-and-kernel-enhancements">eBPF and Kernel Enhancements</a></li>
        <li><a href="#traffic-interception-and-management">Traffic Interception and Management</a></li>
        <li><a href="#security-and-isolation">Security and Isolation</a></li>
      </ul>
    </li>
    <li><a href="#performance-analysis">Performance Analysis</a></li>
    <li><a href="#cloud-native-integration-and-compatibility">Cloud-Native Integration and Compatibility</a></li>
    <li><a href="#future-roadmap">Future Roadmap</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</details>

            
            <p>In the world of microservices and cloud-native applications, service meshes have become essential for managing service-to-service communication. However, traditional sidecar-based architectures introduce significant latency and resource overhead, posing challenges for latency-sensitive and large-scale applications. <strong>Kmesh</strong> emerges as a groundbreaking solution—a high-performance, kernel-native service mesh data plane that leverages eBPF and kernel enhancements to deliver unparalleled efficiency and performance.</p>
<h2 id="background">Background</h2>
<p>Service meshes like Istio have become integral in managing complex microservices architectures, providing features like traffic management, security, and observability. The sidecar model, where a proxy runs alongside each service instance, has been the predominant approach. While effective in functionality, this architecture introduces significant latency and resource overhead.</p>



<div class="alert alert-note-container">
  
  <div class="alert-note-title px-2 py-2">
    Note
  </div>
  
  <div class="alert-note px-2">
    All data presented in this article is quoted from <a href="https://kccncossaidevchn2024.sched.com/event/1eYWy/a-new-choice-for-istio-data-plane-architectural-innovation-for-a-brand-new-performance-experience-istioxiao-zha-sao-daepxia-mo-zha-zhonghu-xu-huawei?iframe=no" title="A New Choice for Istio Data Plane: Architectural Innovation for a Brand-New Performance Experience" target="_blank" rel="noopener">A New Choice for Istio Data Plane: Architectural Innovation for a Brand-New Performance Experience</a>. I have not verified the accuracy of these data. You are requested to judge and verify the reliability of these data on your own.
  </div>
</div>

<h2 id="limitations-of-traditional-sidecar-architectures">Limitations of Traditional Sidecar Architectures</h2>
<ol>
<li>
<p><strong>Latency Overhead</strong>: The addition of sidecar proxies results in increased network hops and context switches, introducing an extra <strong>2 to 3 milliseconds</strong> of latency per service call. For latency-sensitive applications, this delay is unacceptable.</p>
</li>
<li>
<p><strong>Resource Consumption</strong>: Each sidecar consumes CPU and memory resources. In large-scale deployments with thousands of services, the accumulated resource overhead is huge. Although it can be optimized through certain technical means, it still reduces deployment density and increases operating costs.</p>
</li>
</ol>
<p>Performance measurements of Istio reveal that even without traffic distribution, there&rsquo;s an inherent latency overhead of approximately 3 milliseconds. As the number of connections grows, latency increases correspondingly, highlighting the inefficiency of the sidecar model for high-performance applications.</p>
<h2 id="industry-attempts-to-address-the-challenges">Industry Attempts to Address the Challenges</h2>
<p>Several solutions have been proposed to mitigate the drawbacks of sidecar architectures:</p>
<h3 id="cilium-service-mesh">Cilium Service Mesh</h3>
<ul>
<li><strong>Approach</strong>: Combines eBPF with Envoy to create a sidecar-less service mesh.</li>
<li><strong>Mechanism</strong>:
<ul>
<li><strong>L4 Traffic</strong>: Uses eBPF for efficient kernel-level data routing.</li>
<li><strong>L7 Traffic</strong>: Relies on Envoy for application-layer parsing.</li>
</ul>
</li>
<li><strong>Limitations</strong>:
<ul>
<li><strong>Extra Hops for L7</strong>: L7 governance through Envoy introduces additional network hops.</li>
<li><strong>Fault Isolation</strong>: Challenges in ensuring governance fault isolation.</li>
</ul>
</li>
</ul>
<h3 id="istio-ambient-mesh">Istio Ambient Mesh</h3>
<ul>
<li><strong>Approach</strong>: Introduces sidecar-less architecture using <strong>ztunnel</strong> and <strong>waypoint</strong> proxies.</li>
<li><strong>Mechanism</strong>:
<ul>
<li><strong>User-Space Processing</strong>: All traffic interception and management occur in user space.</li>
</ul>
</li>
<li><strong>Limitations</strong>:
<ul>
<li><strong>Complex Traffic Interception</strong>: User-space interception increases complexity.</li>
<li><strong>Increased Hops</strong>: L7 connections involve multiple network hops, adding latency.</li>
</ul>
</li>
</ul>
<p>These solutions, while innovative, do not fully resolve the latency and resource overhead issues inherent in sidecar architectures.</p>
<h2 id="introducing-kmesh-a-kernel-native-approach">Introducing Kmesh: A Kernel-Native Approach</h2>
<p>Kmesh defines a new service mesh data plane by directly integrating traffic governance into the operating system kernel. Utilizing eBPF (Extended Berkeley Packet Filter) and kernel enhancements, Kmesh provides high-performance, low-latency, and resource-efficient service mesh capabilities.</p>
<h3 id="technical-architecture">Technical Architecture</h3>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/introducing-kmesh-kernel-native-service-mesh/kmesh-arch.svg" data-img="/en/blog/introducing-kmesh-kernel-native-service-mesh/kmesh-arch.svg" alt="image" data-caption="Kmesh Architecture">
        
      
    
  
  
  <figcaption>Kmesh Architecture</figcaption>
  
</figure>
<p><strong>Core Components</strong>:</p>
<ul>
<li>
<p><strong>Kmesh-Daemon</strong>: A per-node management component responsible for:</p>
<ul>
<li>Managing eBPF programs.</li>
<li>Subscribing to xDS configurations from the control plane (e.g., Istiod).</li>
<li>Handling observability and metrics collection.</li>
</ul>
</li>
<li>
<p><strong>eBPF Orchestration</strong>: Implements traffic interception and management at the kernel level, supporting:</p>
<ul>
<li>L4 load balancing.</li>
<li>Traffic encryption and decryption.</li>
<li>Monitoring and simple L7 dynamic routing.</li>
</ul>
</li>
<li>
<p><strong>Waypoint Proxy (Optional in Dual Engine Mode)</strong>: Handles advanced L7 traffic governance, deployed per namespace or per service as needed.</p>
</li>
</ul>
<h3 id="key-advantages">Key Advantages</h3>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/introducing-kmesh-kernel-native-service-mesh/performance.webp" data-img="/en/blog/introducing-kmesh-kernel-native-service-mesh/performance.webp" data-width="2208" data-height="746" alt="image" data-caption="Kmesh vs Sidecar vs Ambient (&lt;a href=&#34;https://kccncossaidevchn2024.sched.com/event/1eYWy/a-new-choice-for-istio-data-plane-architectural-innovation-for-a-brand-new-performance-experience-istioxiao-zha-sao-daepxia-mo-zha-zhonghu-xu-huawei?iframe=no&#34; title=&#34;Source&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Source&lt;/a&gt;)">
        
      
    
  
  
  <figcaption>Kmesh vs Sidecar vs Ambient (<a href="https://kccncossaidevchn2024.sched.com/event/1eYWy/a-new-choice-for-istio-data-plane-architectural-innovation-for-a-brand-new-performance-experience-istioxiao-zha-sao-daepxia-mo-zha-zhonghu-xu-huawei?iframe=no" title="Source" target="_blank" rel="noopener">Source</a>)</figcaption>
  
</figure>
<ol>
<li>
<p><strong>High Performance</strong>:</p>
<ul>
<li><strong>Latency Reduction</strong>: Kernel-native L7 management reduces forwarding latency by over <strong>60%</strong> compared to traditional sidecar architectures.</li>
<li><strong>Improved Application Startup</strong>: Application bootstrap times improve by <strong>40%</strong> due to the elimination of sidecar initialization.</li>
</ul>
</li>
<li>
<p><strong>Low Resource Overhead</strong>:</p>
<ul>
<li><strong>Resource Efficiency</strong>: Eliminates the need for sidecar proxies, reducing resource consumption by over <strong>70%</strong>.</li>
</ul>
</li>
<li>
<p><strong>High Availability</strong>:</p>
<ul>
<li><strong>Seamless Upgrades</strong>: Kernel-level traffic management ensures that upgrading or restarting Kmesh components does not disrupt existing service connections.</li>
</ul>
</li>
<li>
<p><strong>Security Isolation</strong>:</p>
<ul>
<li><strong>Enhanced Security</strong>: Utilizes BPF-based virtual machine security and cgroup-level governance isolation to ensure secure multi-tenancy.</li>
</ul>
</li>
<li>
<p><strong>Flexible Governance Model</strong>:</p>
<ul>
<li><strong>Deployment Modes</strong>: Offers both Kernel-Native Mode for maximum performance and Dual Engine Mode for deployment flexibility.</li>
</ul>
</li>
<li>
<p><strong>Seamless Compatibility</strong>:</p>
<ul>
<li><strong>Control Plane Integration</strong>: Fully compatible with the xDS protocol, allowing integration with Istio&rsquo;s control plane and supporting Istio APIs and Gateway APIs.</li>
</ul>
</li>
</ol>
<h2 id="two-operational-modes-of-kmesh">Two Operational Modes of Kmesh</h2>
<p>Kmesh provides two operational modes to cater to different deployment needs:</p>
<h3 id="kernel-native-mode">Kernel-Native Mode</h3>
<p><strong>Overview</strong>:</p>
<ul>
<li><strong>Ultimate Performance</strong>: Achieves the lowest possible latency with no additional network hops for both L4 and L7 traffic.</li>
<li><strong>Mechanism</strong>:
<ul>
<li><strong>Kernel Enhancements</strong>: Enhances the kernel using eBPF and kernel modules (ko).</li>
<li><strong>Fake TCP Connections</strong>: Utilizes forged connections to manage complex application-layer traffic within the kernel.</li>
<li><strong>Traffic Management</strong>: Directly manages traffic as soon as the client initiates communication, eliminating unnecessary context switches and data copies.</li>
</ul>
</li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul>
<li><strong>Latency Reduction</strong>: Reduces forwarding latency by over 60%.</li>
<li><strong>No Dependency on User-Space Proxies</strong>: Entire traffic management is handled within the kernel.</li>
</ul>
<p><strong>Considerations</strong>:</p>
<ul>
<li><strong>Kernel Version Requirements</strong>: May require specific kernel versions or enhancements, which could impact deployment flexibility.</li>
</ul>
<h3 id="dual-engine-mode">Dual Engine Mode</h3>
<p><strong>Overview</strong>:</p>
<ul>
<li><strong>Flexible Governance</strong>: Balances performance with broader compatibility and flexibility.</li>
<li><strong>Mechanism</strong>:
<ul>
<li><strong>Kernel-Level Interception</strong>: Uses eBPF to intercept traffic in the kernel space.</li>
<li><strong>Waypoint Proxy</strong>: Deploys a remote waypoint proxy to handle complex L7 traffic management.</li>
<li><strong>Layer Separation</strong>: Splits L4 and L7 governance between kernel space (eBPF) and user space (waypoint).</li>
</ul>
</li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul>
<li><strong>Latency Reduction</strong>: Reduces latency by <strong>30%</strong> compared to Istio&rsquo;s Ambient Mesh.</li>
<li><strong>Simplified Traffic Interception</strong>: Kernel-space interception is more secure and simpler than user-space interception.</li>
<li><strong>Lower Adoption Threshold</strong>: Reduced dependency on specific kernel versions, making it easier for users to adopt.</li>
</ul>
<p><strong>Comparison with Ambient Mesh</strong>:</p>
<ul>
<li><strong>Fewer Network Hops</strong>: Kmesh adds only one extra hop for L7 connections, whereas Ambient Mesh may add up to three.</li>
<li><strong>Simpler Architecture</strong>: Kernel-level interception avoids the complexity of user-space interception mechanisms.</li>
</ul>
<h2 id="deep-dive-into-kmeshs-technology">Deep Dive into Kmesh&rsquo;s Technology</h2>
<h3 id="ebpf-and-kernel-enhancements">eBPF and Kernel Enhancements</h3>
<p><strong>eBPF (Extended Berkeley Packet Filter)</strong> is a powerful technology that allows the injection of custom code into the Linux kernel safely and efficiently. Kmesh leverages eBPF to:</p>
<ul>
<li><strong>Intercept Network Traffic</strong>: Attach eBPF programs to network events, enabling real-time interception and manipulation of packets.</li>
<li><strong>Implement Load Balancing</strong>: Direct traffic to appropriate service instances based on policies.</li>
<li><strong>Perform Traffic Encryption</strong>: Handle mTLS encryption and decryption within the kernel, reducing overhead.</li>
<li><strong>Collect Observability Data</strong>: Gather metrics and telemetry data without impacting application performance.</li>
</ul>
<h3 id="traffic-interception-and-management">Traffic Interception and Management</h3>
<p>In the Kernel-Native Mode:</p>
<ul>
<li><strong>Forged Connections</strong>: Kmesh creates fake TCP connections within the kernel to manage traffic without involving user-space proxies.</li>
<li><strong>Direct Packet Manipulation</strong>: Packets are intercepted and redirected at the kernel level, eliminating context switches and data copies that occur when moving packets between user space and kernel space.</li>
</ul>
<p>In the Dual Engine Mode:</p>
<ul>
<li><strong>eBPF Interception</strong>: eBPF programs handle initial traffic interception and basic L4 management.</li>
<li><strong>Waypoint Proxy</strong>: For advanced L7 features like routing, retries, and header manipulation, traffic is forwarded to a waypoint proxy deployed per service or namespace.</li>
</ul>
<h3 id="security-and-isolation">Security and Isolation</h3>
<ul>
<li><strong>BPF Virtual Machine Security</strong>: eBPF runs in a restricted virtual machine within the kernel, ensuring that injected code cannot compromise kernel stability.</li>
<li><strong>Cgroup-Level Isolation</strong>: Governance policies are applied at the cgroup level, providing isolation between different services and workloads.</li>
<li><strong>mTLS Support</strong>: Mutual TLS is implemented within the kernel (Under development. Planned to be supported by the end of 2024), providing zero-trust security without the overhead of user-space encryption.</li>
</ul>
<h2 id="performance-analysis">Performance Analysis</h2>
<p><strong>Test Setup</strong>:</p>
<ul>
<li><strong>Benchmark Tool</strong>: Used <a href="https://github.com/fortio/fortio" title="Fortio" target="_blank" rel="noopener">Fortio</a> to generate load and measure latency.</li>
<li><strong>Comparisons</strong>: Measured performance across four configurations:
<ol>
<li><strong>Baseline</strong>: Direct communication without any service mesh.</li>
<li><strong>Istio Sidecar</strong>: Traditional sidecar-based deployment.</li>
<li><strong>Istio Ambient Mesh</strong>: Sidecar-less deployment with ztunnel and waypoint.</li>
<li><strong>Kmesh</strong>: Both Kernel-Native and Dual Engine modes.</li>
</ol>
</li>
</ul>
<p><strong>Results</strong>:</p>
<ul>
<li><strong>Latency</strong>:
<ul>
<li><strong>Kmesh Kernel-Native Mode</strong>: Achieved over <strong>60%</strong> reduction in forwarding latency compared to Istio Sidecar.</li>
<li><strong>Kmesh Dual Engine Mode</strong>: Reduced latency by <strong>30%</strong> compared to Istio Ambient Mesh.</li>
</ul>
</li>
<li><strong>Resource Consumption</strong>:
<ul>
<li><strong>CPU and Memory</strong>: Kmesh reduced resource overhead by over <strong>70%</strong>, as it eliminates the need for sidecar proxies.</li>
</ul>
</li>
<li><strong>Application Startup Time</strong>:
<ul>
<li>Improved by <strong>40%</strong>, as applications no longer wait for sidecar initialization.</li>
</ul>
</li>
</ul>
<p><strong>Interpretation</strong>:</p>
<ul>
<li>Kmesh approaches baseline performance, making the overhead of the service mesh negligible.</li>
<li>The elimination of context switches and data copies contributes significantly to performance gains.</li>
<li>The kernel-native approach ensures consistent performance even as the number of services scales.</li>
</ul>
<h2 id="cloud-native-integration-and-compatibility">Cloud-Native Integration and Compatibility</h2>
<ul>
<li><strong>Kubernetes Native</strong>: Kmesh runs seamlessly on Kubernetes, managing traffic to and from pods without requiring changes to application code.</li>
<li><strong>Control Plane Integration</strong>:
<ul>
<li><strong>xDS Protocol Support</strong>: Subscribes to xDS configurations from Istiod, ensuring compatibility with Istio&rsquo;s control plane.</li>
<li><strong>Istio API Compatibility</strong>: Supports existing Istio APIs, allowing users to leverage familiar configurations and policies.</li>
</ul>
</li>
<li><strong>Gateway API Support</strong>: Compatible with Gateway APIs, enabling more flexible and expressive traffic management.</li>
<li><strong>Observability</strong>:
<ul>
<li>Integrates with Prometheus for metrics collection.</li>
<li>Utilizes eBPF for efficient data gathering without impacting performance.</li>
</ul>
</li>
<li><strong>Security Policies</strong>:
<ul>
<li>Supports existing Istio security policies, including authentication and authorization.</li>
</ul>
</li>
</ul>
<h2 id="future-roadmap">Future Roadmap</h2>
<p><strong>Short-Term Goals (2024)</strong>:</p>
<ul>
<li><strong>September 2024</strong>:
<ul>
<li>Implement circuit breaking and rate limiting.</li>
<li>Enhance support for mTLS and upstream extensions.</li>
<li>Ensure seamless restarts without affecting traffic.</li>
</ul>
</li>
<li><strong>December 2024 (Release 1.0)</strong>:
<ul>
<li>Introduce locality-aware load balancing.</li>
<li>Add multi-cluster support for federated deployments.</li>
<li>Enhance DNS and headless service handling.</li>
<li>Integrate with gateway components for edge traffic management.</li>
</ul>
</li>
</ul>
<p><strong>Long-Term Vision (2025 and Beyond)</strong>:</p>
<ul>
<li><strong>AI Integration</strong>:
<ul>
<li>Incorporate AI capabilities to improve traffic governance decisions.</li>
<li>Enhance problem diagnostics and anomaly detection.</li>
</ul>
</li>
<li><strong>Multi-VPC Support</strong>:
<ul>
<li>Extend support to multi-Virtual Private Cloud environments.</li>
</ul>
</li>
<li><strong>Advanced Observability</strong>:
<ul>
<li>Leverage eBPF and Application Performance Management tools for deeper insights.</li>
<li>Provide end-to-end tracing and metrics.</li>
</ul>
</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Kmesh represents a paradigm shift in service mesh technology by moving traffic management into the kernel. By leveraging eBPF and kernel enhancements, it addresses the critical challenges of latency and resource overhead inherent in traditional sidecar architectures. Kmesh offers a flexible, high-performance solution suitable for modern cloud-native applications, particularly those requiring low latency and high throughput.</p>
<p><strong>Key Takeaways</strong>:</p>
<ul>
<li><strong>Performance</strong>: Achieves near-baseline performance by eliminating unnecessary overhead.</li>
<li><strong>Resource Efficiency</strong>: Reduces CPU and memory consumption, enabling higher deployment densities.</li>
<li><strong>Flexibility</strong>: Provides multiple operational modes to suit different deployment scenarios.</li>
<li><strong>Security</strong>: Enhances security through kernel-level enforcement and isolation mechanisms.</li>
<li><strong>Compatibility</strong>: Integrates seamlessly with existing cloud-native ecosystems, including Kubernetes and Istio.</li>
</ul>
<p>As microservices architectures continue to evolve, solutions like Kmesh will play a crucial role in enabling efficient, scalable, and secure service communication. By addressing the limitations of traditional service mesh designs, Kmesh sets a new standard for performance and resource efficiency in the service mesh landscape.</p>

            <div class="border-bottom mb-2"></div>
          </div>
          <div class="col-12">
            <p>Last updated on Nov 19, 2024</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/en/tags/kmesh" class="badge"> 
                  Kmesh</a> 
              <a href="/en/tags/service-mesh" class="badge">  
                  Service Mesh</a> </div>
          </div>
          
          <div class="col-12">
            









    

    

    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    


<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/en/blog/envoy-tracing/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; Previous Post</span>
            <span class="text-align-left">How the Envoy Proxy Handles User Requests for Tracing</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/en/blog/service-mesh-data-plane-deployment-modes/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">Next Post &rarr;</span>
            <span class="text-align-right">Service Mesh Data Plane Deployment Modes Explanation</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="en"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  Related article
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/en/blog/understanding-the-tls-encryption-in-istio/">
            How Istio’s mTLS Traffic Encryption Works as Part of a Zero Trust Security Posture
          </a>
      </li>
    
      <li>
          <a href="/en/blog/what-is-new-in-istio-1-13/">
            What&#39;s New in Istio 1.13?
          </a>
      </li>
    
      <li>
          <a href="/en/blog/service-mesh-in-2021/">
            Service Mesh in 2021: The Ecosystem Is Emerging
          </a>
      </li>
    
      <li>
          <a href="/en/blog/istio-extensions-slime-and-aeraki/">
            Introducing Slime and Aeraki in the Evolution of Istio Open-Source Ecosystem
          </a>
      </li>
    
      <li>
          <a href="/en/blog/the-debate-in-the-community-about-istio-and-service-mesh/">
            The Debate in the Community About Istio and Service Mesh
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      Table of content
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#limitations-of-traditional-sidecar-architectures">Limitations of Traditional Sidecar Architectures</a></li>
    <li><a href="#industry-attempts-to-address-the-challenges">Industry Attempts to Address the Challenges</a>
      <ul>
        <li><a href="#cilium-service-mesh">Cilium Service Mesh</a></li>
        <li><a href="#istio-ambient-mesh">Istio Ambient Mesh</a></li>
      </ul>
    </li>
    <li><a href="#introducing-kmesh-a-kernel-native-approach">Introducing Kmesh: A Kernel-Native Approach</a>
      <ul>
        <li><a href="#technical-architecture">Technical Architecture</a></li>
        <li><a href="#key-advantages">Key Advantages</a></li>
      </ul>
    </li>
    <li><a href="#two-operational-modes-of-kmesh">Two Operational Modes of Kmesh</a>
      <ul>
        <li><a href="#kernel-native-mode">Kernel-Native Mode</a></li>
        <li><a href="#dual-engine-mode">Dual Engine Mode</a></li>
      </ul>
    </li>
    <li><a href="#deep-dive-into-kmeshs-technology">Deep Dive into Kmesh&rsquo;s Technology</a>
      <ul>
        <li><a href="#ebpf-and-kernel-enhancements">eBPF and Kernel Enhancements</a></li>
        <li><a href="#traffic-interception-and-management">Traffic Interception and Management</a></li>
        <li><a href="#security-and-isolation">Security and Isolation</a></li>
      </ul>
    </li>
    <li><a href="#performance-analysis">Performance Analysis</a></li>
    <li><a href="#cloud-native-integration-and-compatibility">Cloud-Native Integration and Compatibility</a></li>
    <li><a href="#future-roadmap">Future Roadmap</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">Contact</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s LinkedIn</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-linkedin.png" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Blog</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/migrating-from-aws-app-mesh-to-istio-a-comprehensive-guide/">Migrating from AWS App Mesh to Istio: A Comprehensive Guide</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/multi-cluster-pki-istio-recipe/">Multi-Cluster PKI &#43; Istio Recipe: Practical Example for a Trusted and Scalable PKI for Your Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/envoy-tracing/">How the Envoy Proxy Handles User Requests for Tracing</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">links</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" >
                  Awesome Cloud Native
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://gateway.envoyproxy.io" target="_blank" rel="noopener noreferrer">
                  Envoy Gateway
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io" target="_blank" rel="noopener noreferrer">
                  Istio
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate - Service Mesh Company
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://docs.tetrate.io/istio-subscription/" target="_blank" rel="noopener noreferrer">
                  Tetrate Istio Subscription
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Courses</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener noreferrer">
                  Envoy Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener noreferrer">
                  Istio Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">new notice</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-china-2024-panel/">KubeCon China 2024 panel Preview: Istio and Modern API Gateways – Leading the Future of Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/website-revamp-notice/">Website Revamp Notice</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/en/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/en/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>






  





<script src="/js/wowchemy-search.min.ce03c611044441cf6e84f9e4bef20818.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
