<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>Service Mesh - The Microservices in Post Kubernetes Era · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This article is a rework of previously written content and is included in the Istio Handbook of the ServiceMesher community . Other chapters are still being compiled.">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.123.7">

  <!-- plugins -->
  
  <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/plugins/slick/slick.css">
  
  <link rel="stylesheet" href="/plugins/animate/animate.css">
  
  <link rel="stylesheet" href="/plugins/venobox/venobox.css">
  
  <link rel="stylesheet" href="/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/plugins/hightlight/syntax.css">
  
  <link rel="stylesheet" href="/plugins/fontawesome/font-awesome.min.css">
  
  <link rel="stylesheet" href="/plugins/tocbot/tocbot.css">
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/scss/style.css" media="screen">

  <!--Favicon-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="images/favicon.png" />

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  
  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/" />
  <meta property="og:title" content="Service Mesh - The Microservices in Post Kubernetes Era" />
  <meta property="twitter:title" content="Service Mesh - The Microservices in Post Kubernetes Era" />
  
  <meta property="og:description" content="This article is a rework of previously written content and is included in the Istio Handbook of the ServiceMesher community . Other chapters are still being compiled." />
  <meta property="twitter:description" content="This article is a rework of previously written content and is included in the Istio Handbook of the ServiceMesher community . Other chapters are still being compiled." />
  
  
  <meta property="og:image" content="https://jimmysong.io/images/banner/era.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/era.jpg" />
  
  
  
</head>
<body>
    <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>

<header class="fixed-top header">
  
  
  
  <div class="navigation w-100 ">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>CLOUD NATIVE BLOG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://lib.jimmysong.io" target="_blank" rel="noopener">Book</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="nav-link" href="/blog/service-mesh-the-microservices-in-post-kubernetes-era/">中文</a>
            
            
            
            
            
            
          </li>
          
          
          <!-- search -->
          <button id="searchOpen" class="search-btn js-search"><i class="fa fa-search text-dark"></i></button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


    <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>Search</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fa fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        <i class="fa fa-search" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Input the keyword">
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

    
	
	
<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/page-title.webp'),url('/images/backgrounds/page-title.webp');">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul class="list-inline custom-breadcrumb">
                    
                          
                      
                        
                      
                        
                      
                    
                        <li class="list-inline-item h2">
                          <a class="text-white font-secondary" href="/en/">
                            
                              Home
                            
                          </a>
                        </li>
                        <li class="list-inline-item"><i class="ti-angle-right text-white"></i></li>
                      
                    
                        <li class="list-inline-item h2">
                          <a class="text-white font-secondary" href="/en/blog/">
                            
                              Blogs
                            
                          </a>
                        </li>
                        <li class="list-inline-item"><i class="ti-angle-right text-white"></i></li>
                      
                    
                          <li class="list-inline-item h3 active" aria-current="page">
                            Service Mesh - The Microservices in Post Kubernetes Era
                          </li>
                    
                    
                    
                </ul>
                <p class="text-white">This article is a rework of previously written content and is included in the Istio Handbook of the ServiceMesher community . Other chapters are still being compiled.</p>
            </div>
        </div>
    </div>
</section>

	


<section class="section-sm">
  <div class="container blog">
    <div class="row">
      <div class="col-lg-8 article-content">
        <div class="row">
          <div class="col-12">
            <ul class="list-inline">
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Date
                  :</span>April 1, 2020</li>

              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Category
                  :</span><a
                  href="/en/categories/service-mesh"> 
                  Service Mesh</a> </li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Word Count
                  :</span>2753 words</li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Reading Time
                  :</span>13 Minute</li>
            </ul>
          </div>
          
          <div class="col-12 my-4">
            <div class="border-bottom"></div>
          </div>
          
          <div class="col-12 content">
            
            <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#key-takeaways">Key takeaways</a></li>
    <li><a href="#kubernetes-vs-service-mesh">Kubernetes vs Service Mesh</a></li>
    <li><a href="#kube-proxy-component">kube-proxy component</a>
      <ul>
        <li><a href="#kube-proxy-flaws">kube-proxy flaws</a></li>
      </ul>
    </li>
    <li><a href="#kubernetes-ingress-vs-istio-gateway">Kubernetes Ingress vs. Istio Gateway</a></li>
    <li><a href="#xds-protocol">xDS protocol</a>
      <ul>
        <li><a href="#xds-protocol-highlights">xDS protocol highlights</a></li>
      </ul>
    </li>
    <li><a href="#envoy">Envoy</a>
      <ul>
        <li><a href="#basic-terminology">Basic terminology</a></li>
      </ul>
    </li>
    <li><a href="#istio-service-mesh">Istio Service Mesh</a>
      <ul>
        <li><a href="#traffic-management-in-istio">Traffic Management in Istio</a></li>
      </ul>
    </li>
    <li><a href="#kubernetes-vs-xds-vs-istio">Kubernetes vs xDS vs Istio</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
</details>

            
            <p>This article is a rework of previously written content and is included in the <a href="https://www.servicemesher.com/istio-handbook" title="Istio Handbook" target="_blank" rel="noopener">Istio Handbook</a>
 of the ServiceMesher community . Other chapters are still being compiled.</p>
<p>People who have just heard of Service Mesh and tried <a href="https://istio.io/" title="Istio" target="_blank" rel="noopener">Istio</a>
 may have the following questions:</p>
<ol>
<li>Why does Istio bind Kubernetes?</li>
<li>What roles do Kubernetes and Service Mesh play in cloud native?</li>
<li>What aspects of Kubernetes has Istio extended? What problems have been solved?</li>
<li>What is the relationship between Kubernetes, xDS protocols (<a href="https://github.com/envoyproxy/envoy" title="Envoy" target="_blank" rel="noopener">Envoy</a>
 , <a href="https://github.com/mosn/mosn" title="MOSN," target="_blank" rel="noopener">MOSN,</a>
 etc) and Istio?</li>
<li>Should I use Service Mesh?</li>
</ol>
<p>In this section, we will try to guide you through the internal connections between Kubernetes, the xDS protocol, and Istio Service Mesh. In addition, this section will also introduce the load balancing methods in Kubernetes, the significance of the xDS protocol for Service Mesh, and why Istio is needed in time for Kubernetes.</p>
<p>Using Service Mesh is not to say that it will break with Kubernetes, but that it will happen naturally. The essence of Kubernetes is to perform application lifecycle management through declarative configuration, while the essence of Service Mesh is to provide traffic and security management and observability between applications. If you have built a stable microservice platform using Kubernetes, how do you set up load balancing and flow control for calls between services?</p>
<p>The xDS protocol created by Envoy is supported by many open source software, such as <a href="https://github.com/istio/istio" title="Istio" target="_blank" rel="noopener">Istio</a>
 , <a href="https://linkerd.io/" title="Linkerd" target="_blank" rel="noopener">Linkerd</a>
 , <a href="https://github.com/mosn/mosn" title="MOSN," target="_blank" rel="noopener">MOSN,</a>
 etc. Envoy&rsquo;s biggest contribution to Service Mesh or cloud native is the definition of xDS. Envoy is essentially a proxy. It is a modern version of proxy that can be configured through APIs. Based on it, many different usage scenarios are derived, such as API Gateway, Service Mesh. Sidecar proxy and Edge proxy in.</p>
<p><strong>This section contains the following</strong></p>
<ul>
<li>Explain the role of kube-proxy.</li>
<li>Kubernetes&rsquo; limitations in microservice management.</li>
<li>Describe the features of Istio Service Mesh.</li>
<li>Describe what xDS includes.</li>
<li>Compare some concepts in Kubernetes, Envoy and Istio Service Mesh.</li>
</ul>
<h2 id="key-takeaways">Key takeaways</h2>
<p>If you want to know everything in advance, here are some of the key points from this article:</p>
<ul>
<li>The essence of Kubernetes is application lifecycle management, specifically deployment and management (scaling, scaling, automatic recovery, release).</li>
<li>Kubernetes provides a scalable and highly resilient deployment and management platform for microservices.</li>
<li>The foundation of Service Mesh is a transparent proxy. After the traffic between microservices is intercepted through sidecar proxy, the behavior of microservices is managed through the control plane configuration.</li>
<li>Service Mesh decoupled from Kubernetes traffic management, the internal flow without the need of Service Mesh <code>kube-proxy </code>supporting components, micro-services closer to abstract the application layer by, for traffic between management services, security and observability.</li>
<li>xDS defines the protocol standards for Service Mesh configuration.</li>
<li>Service Mesh is a higher-level abstraction of services in Kubernetes. Its next step is serverless.</li>
</ul>
<h2 id="kubernetes-vs-service-mesh">Kubernetes vs Service Mesh</h2>
<p>The following figure shows the service access relationship between Kubernetes and Service Mesh (one sidecar per pod mode).</p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/kubernetes-vs-service-mesh.png" data-img="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/kubernetes-vs-service-mesh.png" data-width="1928" data-height="986" alt="image" data-caption="kubernetes vs service mesh">
    
  
  <figcaption>kubernetes vs service mesh</figcaption>
</figure>
</p>
<p><strong>Traffic forwarding</strong></p>
<p>Each node of the cluster Kubernetes a deployed <code>kube-proxy</code> assembly Kubernetes API Server may communicate with the cluster acquired <a href="https://jimmysong.io/kubernetes-handbook/concepts/service.html" title="service" target="_blank" rel="noopener">service</a>
 information, and then set iptables rules, sends a request for a service directly to the corresponding Endpoint (belonging to the same group service pod).</p>
<p><strong>Service discovery</strong></p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-service-registry.png" data-img="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-service-registry.png" data-width="761" data-height="552" alt="image" data-caption="Service registration in Service Mesh">
    
  
  <figcaption>Service registration in Service Mesh</figcaption>
</figure>
</p>
<p>Istio Service Mesh can use the service in Kubernetes for service registration. It can also connect to other service discovery systems through the platform adapter of the control plane, and then generate the configuration of the data plane (using CRD statements, stored in etcd), a <strong>transparent proxy</strong> for the data plane. (Transparent proxy) is deployed in the sidecar container in each application service pod. These proxy need to request the control plane to synchronize the proxy configuration. The reason why is a transparent proxy, because there is no application container fully aware agent, the process kube-proxy components like the need to block traffic, but <code>kube-proxy</code>that blocks traffic to Kubernetes node and sidecar proxy that blocks out of the Pod For more information, see <a href="/en/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/" title="Understanding Route Forwarding by the Envoy Sidecar Proxy in Istio Service Mesh">Understanding Route Forwarding by the Envoy Sidecar Proxy in Istio Service Mesh</a>
 .</p>
<p><strong>Disadvantages of Service Mesh</strong></p>
<p>Because each node on Kubernetes many runs Pod, the original <code>kube-proxy</code>routing forwarding placed in each pod, the distribution will lead to a lot of configuration, synchronization, and eventual consistency problems. In order to perform fine-grained traffic management, a series of new abstractions will be added, which will further increase the user&rsquo;s learning costs. However, with the popularization of technology, this situation will gradually ease.</p>
<p><strong>Advantages of Service Mesh</strong></p>
<p><code>kube-proxy</code> The settings are globally effective, and fine-grained control of each service cannot be performed. Service Mesh uses sidecar proxy to extract the control of traffic in Kubernetes from the service layer, which can be further expanded.</p>
<h2 id="kube-proxy-component">kube-proxy component</h2>
<p>In Kubernetes cluster, each Node to run a <code>kube-proxy </code> process. <code>kube-proxy</code> Responsible for the <code>Service</code> realization of a VIP (virtual IP) form. In Kubernetes v1.0, the proxy is implemented entirely in userspace. Kubernetes v1.1 adds the <a href="https://jimmysong.io/kubernetes-handbook/concepts/service.html#iptables-%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f" title="iptables proxy mode" target="_blank" rel="noopener">iptables proxy mode</a>
 , but it is not the default operating mode. As of Kubernetes v1.2, the iptables proxy is used by default. In Kubernetes v1.8.0-beta.0, the <a href="https://jimmysong.io/kubernetes-handbook/concepts/service.html#ipvs-%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f" title="ipvs proxy mode was added" target="_blank" rel="noopener">ipvs proxy mode was added</a>
 . More about kube-proxy component description please refer <a href="https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/" title="kubernetes Description: service and kube-proxy principle" target="_blank" rel="noopener">kubernetes Description: service and kube-proxy principle</a>
 and <a href="https://jishu.io/kubernetes/ipvs-loadbalancer-for-kubernetes/" title="use IPVS achieve Kubernetes inlet flow load balancing" target="_blank" rel="noopener">use IPVS achieve Kubernetes inlet flow load balancing</a>
 .</p>
<h3 id="kube-proxy-flaws">kube-proxy flaws</h3>
<p><a href="https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/" title="The disadvantages of kube-proxy" target="_blank" rel="noopener">The disadvantages of kube-proxy</a>
 :</p>
<blockquote>
<p>First, if forwarded pod can not provide normal service, it does not automatically try another pod, of course, this can <a href="https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html" title="&lt;code&gt;liveness probes&lt;/code&gt;" target="_blank" rel="noopener"><code>liveness probes</code></a>
 be solved. Each pod has a health check mechanism. When there is a problem with the health of the pod, kube-proxy will delete the corresponding forwarding rule. In addition, <code>nodePort</code>types of services cannot add TLS or more sophisticated message routing mechanisms.</p>
</blockquote>
<p>Kube-proxy implements load balancing of traffic among multiple pod instances of the Kubernetes service, but how to fine-grained control the traffic between these services, such as dividing the traffic into different application versions by percentage (these applications belong to the same service , But on a different deployment), do canary release and blue-green release? Kubernetes community gives the <a href="https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments" title="method using the Deployment do canary release" target="_blank" rel="noopener">method using the Deployment do canary release</a>
 , essentially by modifying the pod of the method <a href="https://jimmysong.io/kubernetes-handbook/concepts/label.html" title="label" target="_blank" rel="noopener">label</a>
 different pod to be classified into the Deployment of Service.</p>
<h2 id="kubernetes-ingress-vs-istio-gateway">Kubernetes Ingress vs. Istio Gateway</h2>
<p>Speaking above <code>kube-proxy</code>the flow inside the only route Kubernetes clusters, and we know that Pod Kubernetes cluster located <a href="https://jimmysong.io/kubernetes-handbook/concepts/cni.html" title="CNI" target="_blank" rel="noopener">CNI</a>
 outside the network created, external cluster is unable to communicate directly with, so Kubernetes created in the <a href="https://jimmysong.io/kubernetes-handbook/concepts/ingress.html" title="ingress" target="_blank" rel="noopener">ingress</a>
 of this resource object, which is located by the Kubernetes <a href="https://jimmysong.io/kubernetes-handbook/practice/edge-node-configuration.html" title="edge nodes" target="_blank" rel="noopener">edge nodes</a>
 (such nodes can be many or a group) are driven by the Ingress controller, which is responsible for managing <strong>north-south traffic</strong> . Ingress must be <a href="https://traefik.io/" title="connected to" target="_blank" rel="noopener">connected to</a>
 various ingress controllers, such as <a href="https://github.com/kubernetes/ingress-nginx" title="nginx ingress controller" target="_blank" rel="noopener">nginx ingress controller</a>
 and <a href="https://traefik.io/" title="traefik" target="_blank" rel="noopener">traefik</a>
 . Ingress is only applicable to HTTP traffic, and its usage is also very simple. It can only route traffic by matching limited fields such as service, port, and HTTP path, which makes it unable to route TCP traffic such as MySQL, Redis, and various private RPCs. To directly route north-south traffic, you can only use Service&rsquo;s LoadBalancer or NodePort. The former requires cloud vendor support, while the latter requires additional port management. Some Ingress controllers support exposing TCP and UDP services, but they can only be exposed using Services. Ingress itself does not support it, such as the <a href="https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/" title="nginx ingress controller" target="_blank" rel="noopener">nginx ingress controller</a>
 . The exposed port of the service is configured by creating a ConfigMap.</p>
<p>Istio Gateway is similar to Kubernetes Ingress in that it is responsible for north-south traffic to the cluster. <code>Gateway</code>The load balancer described by Istio is used to carry connections in and out of the edge of the mesh. The specification describes a series of open ports and the protocols used by these ports, SNI configuration for load balancing, and so on. Gateway is a <a href="https://jimmysong.io/kubernetes-handbook/concepts/crd.html" title="CRD extension" target="_blank" rel="noopener">CRD extension</a>
 . It also <a href="https://istio.io/docs/reference/config/networking/gateway/" title="reuses" target="_blank" rel="noopener">reuses</a>
 the capability of sidecar proxy. For detailed configuration, please refer to <a href="https://istio.io/docs/reference/config/networking/gateway/" title="Istio official website" target="_blank" rel="noopener">Istio official website</a>
 .</p>
<h2 id="xds-protocol">xDS protocol</h2>
<p>You may have seen the following picture when you understand Service Mesh. Each block represents an instance of a service, such as a Pod in Kubernetes (which contains a sidecar proxy). The xDS protocol controls all traffic in Istio Service Mesh. The specific behavior is to link the squares in the figure below.</p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/service-mesh-schematic-diagram.png" data-img="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/service-mesh-schematic-diagram.png" data-width="736" data-height="626" alt="image" data-caption="Service Mesh diagram">
    
  
  <figcaption>Service Mesh diagram</figcaption>
</figure>
</p>
<p>The xDS protocol was proposed by <a href="https://envoyproxy.io/" title="Envoy" target="_blank" rel="noopener">Envoy</a>
 . The original xDS protocols in the Envoy v2 API refer to CDS (Cluster Discovery Service), EDS (Endpoint Discovery Service), LDS (Listener Discovery Service), and RDS (Route Discovery Service). Later, in the v3 version, Scoped Route Discovery Service (SRDS), Virtual Host Discovery Service (VHDS), Secret Discovery Service (SDS), and Runtime Discovery Service (RTDS) were developed. See the <a href="https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol" title="xDS REST and gRPC protocol for" target="_blank" rel="noopener">xDS REST and gRPC protocol for</a>
 details .</p>
<p>Let&rsquo;s take a look at the xDS protocol with a service with two instances each.</p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/00831rSTly1gde7ydng3ij30s80j4aba.jpg" data-img="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/00831rSTly1gde7ydng3ij30s80j4aba.jpg" data-width="1016" data-height="688" alt="image" data-caption="xDS protocol">
    
  
  <figcaption>xDS protocol</figcaption>
</figure>
</p>
<p>The arrow in the figure above is not the path or route after the traffic enters the proxy, nor is it the actual sequence. It is an imagined xDS interface processing sequence. In fact, there are cross references between xDS.</p>
<p>Agents that support the xDS protocol dynamically discover resources by querying files or managing servers. In summary, the corresponding discovery service and its corresponding API are called  xDS. Envoy by <strong>subscription (subscription)</strong> to get the resources the way, there are three ways to subscribe:</p>
<ul>
<li><strong>File subscription</strong> : Monitor files in the specified path, the easiest way to find dynamic resource is to save it in a file and path configuration in <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-configsource" title="ConfigSource" target="_blank" rel="noopener">ConfigSource</a>
 the <code>path</code>parameter.</li>
<li><strong>gRPC streaming subscription</strong> : Each xDS API can be individually configured <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-apiconfigsource" title="&lt;code&gt;ApiConfigSource&lt;/code&gt;" target="_blank" rel="noopener"><code>ApiConfigSource</code></a>
to point to the cluster address of the corresponding upstream management server.</li>
<li><strong>Polling REST-JSON polling subscription</strong> : A single xDS API can perform synchronous (long) polling of REST endpoints.</li>
</ul>
<p>For details of the above xDS subscription methods, please refer to the <a href="https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html" title="xDS protocol analysis" target="_blank" rel="noopener">xDS protocol analysis</a>
 . Istio uses gRPC streaming subscriptions to configure sidecar proxy for all data planes.</p>
<p>The article introduces the overall architecture of the Istio pilot, the generation of proxy configuration, the function of the pilot-discovery module, and the CDS, EDS, and ADS in the xDS protocol. For details on ADS, please refer to the <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/service/discovery/v2/ads.proto" title="official Envoy documentation" target="_blank" rel="noopener">official Envoy documentation</a>
 .</p>
<h3 id="xds-protocol-highlights">xDS protocol highlights</h3>
<p>Finally, summarize the main points about the xDS protocol:</p>
<ul>
<li>CDS, EDS, LDS, and RDS are the most basic xDS protocols, and they can be updated independently.</li>
<li>All Discovery Services can connect to different Management Servers, which means that there can be multiple servers managing xDS.</li>
<li>Envoy has made a series of extensions based on the original xDS protocol, adding SDS (Key Discovery Service), ADS (Aggregated Discovery Service), HDS (Health Discovery Service), MS (Metric Service), RLS (Rate Limiting Service) Wait for the API.</li>
<li>To ensure data consistency, if used directly xDS original API, it needs to ensure that such sequential update: CDS -&gt; EDS -&gt; LDS -&gt; RDS, which is to follow the electronic engineering <strong>before-break</strong> (Make-Before-Break) The principle is to establish a new connection before disconnecting the original connection. The application in routing is to prevent the situation where the upstream cluster cannot be found and the traffic is dropped when a new routing rule is set, similar to the circuit Open circuit.</li>
<li>CDS sets which services are in the service mesh.</li>
<li>EDS sets which instances (Endpoints) belong to these services (Cluster).</li>
<li>LDS sets the listening port on the instance to configure routing.</li>
<li>The routing relationship between RDS final services should ensure that RDS is updated last.</li>
</ul>
<h2 id="envoy">Envoy</h2>
<p>Envoy is the default sidecar in Istio Service Mesh. Based on Enovy, Istio has extended its control plane in accordance with Envoy&rsquo;s xDS protocol. Before talking about the Envoy xDS protocol, we need to be familiar with the basic terms of Envoy. The following lists the basic terms and data structure analysis in Envoy. For a detailed introduction to <a href="http://www.servicemesher.com/envoy/" title="Envoy" target="_blank" rel="noopener">Envoy</a>
 , please refer to the <a href="http://www.servicemesher.com/envoy/" title="official Envoy document" target="_blank" rel="noopener">official Envoy document</a>
 . As for how Envoy works as a forwarding proxy in Service Mesh (not limited to Istio), please refer to NetEase Cloud Liu Chao this <a href="https://www.cnblogs.com/163yun/p/8962278.html" title="in-depth interpretation of the technical details behind the Service Mesh" target="_blank" rel="noopener">in-depth interpretation of the technical details behind the Service Mesh</a>
 and <a href="https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/" title="understanding Istio Service Mesh Envoy agent in Sidecar injection and traffic hijacking" target="_blank" rel="noopener">understanding Istio Service Mesh Envoy agent in Sidecar injection and traffic hijacking</a>
 , in which the article refers to some of the points, the details will not be repeated.</p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/envoy-arch.png" data-img="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/envoy-arch.png" data-width="1456" data-height="1070" alt="image" data-caption="Envoy proxy architecture diagram">
    
  
  <figcaption>Envoy proxy architecture diagram</figcaption>
</figure>
</p>
<h3 id="basic-terminology">Basic terminology</h3>
<p>Here are the basic terms in Enovy you should know:</p>
<ul>
<li><strong>Downstream</strong> : The downstream host connects to Envoy, sends a request and receives a response, that is, the host sending the request.</li>
<li><strong>Upstream</strong> : The upstream host receives the connection and request from Envoy and returns a response, that is, the host that accepted the request.</li>
<li><strong>Listener</strong> : The listener is a named network address (for example, port, unix domain socket, etc.), and downstream clients can connect to these listeners. Envoy exposes one or more listeners to connect to downstream hosts.</li>
<li><strong>Cluster</strong> : A cluster is a group of logically identical upstream hosts connected to Envoy. Envoy <a href="http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery" title="discovers" target="_blank" rel="noopener">discovers</a>
 members of the cluster through <a href="http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery" title="service discovery" target="_blank" rel="noopener">service discovery</a>
 . You can choose to determine the health status of cluster members through <a href="http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking" title="active health checks" target="_blank" rel="noopener">active health checks</a>
 . Envoy uses <a href="http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing" title="load balancing policies" target="_blank" rel="noopener">load balancing policies</a>
 to decide which member of the cluster to route requests to.</li>
</ul>
<p>Envoy can set multiple Listeners, and each Listener can also set a filter chain, and the filters are extensible, which can make it easier for us to manipulate traffic behavior, such as setting encryption, private RPC, and so on.</p>
<p>The xDS protocol was proposed by Envoy and is now the default sidecar proxy in Istio. However, as long as the xDS protocol is implemented, it can theoretically be used as a sidecar proxy in Istio, such as the open source proxy <a href="https://github.com/mosn/mosn" title="MOSN" target="_blank" rel="noopener">MOSN</a>
 by <a href="https://www.antfin.com" title="Ant Group" target="_blank" rel="noopener">Ant Group</a>
 .</p>
<h2 id="istio-service-mesh">Istio Service Mesh</h2>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-mesh-arch.png" data-img="/en/blog/service-mesh-the-microservices-in-post-kubernetes-era/istio-mesh-arch.png" data-width="1424" data-height="784" alt="image" data-caption="Istio service mesh architecture diagram">
    
  
  <figcaption>Istio service mesh architecture diagram</figcaption>
</figure>
</p>
<p>Istio is a very feature-rich Service Mesh, which includes the following functions:</p>
<ul>
<li>Traffic Management: This is the most basic feature of Istio.</li>
<li>Policy control: Implemented through Mixer components and various adapters to implement access control systems, telemetry capture, quota management, and billing.</li>
<li>Observability: Achieved through Mixer.</li>
<li>Security certification: Citadel components do key and certificate management.</li>
</ul>
<h3 id="traffic-management-in-istio">Traffic Management in Istio</h3>
<p>Istio defined as the <a href="https://jimmysong.io/kubernetes-handbook/concepts/custom-resource.html" title="CRD" target="_blank" rel="noopener">CRD</a>
 to help users perform traffic management:</p>
<ul>
<li><strong>Gateway</strong> : <a href="https://istio.io/docs/reference/config/networking/gateway/" title="Gateway" target="_blank" rel="noopener">Gateway</a>
 describes a load balancer running at the edge of the network for receiving incoming or outgoing HTTP / TCP connections.</li>
<li><strong>VirtualService</strong> : <a href="https://istio.io/docs/reference/config/networking/virtual-service/" title="VirtualService" target="_blank" rel="noopener">VirtualService</a>
 actually connects Kubernetes services to Istio Gateway. It can also do more, such as defining a set of traffic routing rules to apply when a host is addressed.</li>
<li><strong>DestinationRule</strong> : <a href="https://istio.io/zh/docs/reference/config/networking/destination-rule/" title="&lt;code&gt;DestinationRule&lt;/code&gt;" target="_blank" rel="noopener"><code>DestinationRule</code></a>
The defined policy determines the access policy of the traffic after routing processing. Simply put, it defines how the traffic is routed. These policies can define load balancing configurations, connection pool sizes, and external detection (used to identify and evict unhealthy hosts in a load balancing pool) configuration.</li>
<li><strong>EnvoyFilter</strong> : The <a href="https://istio.io/docs/reference/config/networking/envoy-filter/" title="&lt;code&gt;EnvoyFilter&lt;/code&gt;" target="_blank" rel="noopener"><code>EnvoyFilter</code></a>
object describes filters for proxy services that can customize the proxy configuration generated by Istio Pilot. This configuration is rarely used by beginning users.</li>
<li><strong>ServiceEntry</strong> : By default, services in Istio Service Mesh cannot discover services outside Mesh. It <a href="https://istio.io/docs/reference/config/networking/service-entry/" title="&lt;code&gt;ServiceEntry&lt;/code&gt;" target="_blank" rel="noopener"><code>ServiceEntry</code></a>
can add additional entries to the service registry inside Istio, so that services automatically discovered in the mesh can access and route to these manual Joined services.</li>
</ul>
<h2 id="kubernetes-vs-xds-vs-istio">Kubernetes vs xDS vs Istio</h2>
<p>After the reading of the above Kubernetes <code>kube-proxy</code>after abstraction component, and XDS Istio in traffic management, we will take you far as the traffic management aspect of comparison components corresponding to the three / protocol (note, not completely three equivalents).</p>
<table>
<thead>
<tr>
<th>Governors</th>
<th>xDS</th>
<th>Istio Service Mesh</th>
</tr>
</thead>
<tbody>
<tr>
<td>Endpoint</td>
<td>Endpoint</td>
<td>-</td>
</tr>
<tr>
<td>Service</td>
<td>Route</td>
<td>VirtualService</td>
</tr>
<tr>
<td>kube-proxy</td>
<td>Route</td>
<td>DestinationRule</td>
</tr>
<tr>
<td>kube-proxy</td>
<td>Listener</td>
<td>EnvoyFilter</td>
</tr>
<tr>
<td>Ingress</td>
<td>Listener</td>
<td>Gateway</td>
</tr>
<tr>
<td>Service</td>
<td>Cluster</td>
<td>ServiceEntry</td>
</tr>
</tbody>
</table>
<h2 id="conclusion">Conclusion</h2>
<p>If you say that the objects managed by Kubernetes are Pods, then the objects managed by Service Mesh are Service. Therefore, it is a natural thing to apply Service Mesh after using Kubernetes to manage microservices. If you do n’t want to manage even the Service, use <a href="https://github.com/knative/" title="serverless" target="_blank" rel="noopener">serverless</a>
 platforms like knative, but that&rsquo;s what comes next.</p>
<p>The function of Envoy/MOSN is not just for traffic forwarding. The above concepts are just the tip of the iceberg in Istio&rsquo;s new layer of abstraction over Kubernetes. This will be the beginning of the book.</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.cnblogs.com/163yun/p/8962278.html" title="In-depth interpretation of the technical details behind Service Mesh-cnblogs.com" target="_blank" rel="noopener">In-depth interpretation of the technical details behind Service Mesh-cnblogs.com</a>
</li>
<li><a href="https://jimmysong.io/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/" title="Understanding Envoy Proxy Sidecar Injection and Traffic Hijacking in Istio Service Mesh - jimmysong.io" target="_blank" rel="noopener">Understanding Envoy Proxy Sidecar Injection and Traffic Hijacking in Istio Service Mesh - jimmysong.io</a>
</li>
<li><a href="https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/" title="Introduction to kubernetes: service and kube-proxy principles - cizixs.com" target="_blank" rel="noopener">Introduction to kubernetes: service and kube-proxy principles - cizixs.com</a>
</li>
<li><a href="https://jishu.io/kubernetes/ipvs-loadbalancer-for-kubernetes/" title="Kubernetes Ingress Traffic Load Balancing Using IPVS - jishu.io" target="_blank" rel="noopener">Kubernetes Ingress Traffic Load Balancing Using IPVS - jishu.io</a>
</li>
<li><a href="https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol" title="xDS REST and gRPC protocol - envoyproxy.io" target="_blank" rel="noopener">xDS REST and gRPC protocol - envoyproxy.io</a>
</li>
</ul>

          </div>

          
          

          <div class="col-12 mb-4">
            <div class="border-bottom">
            


<p class="edit-page">
<a href="https://github.com/rootsongjc/website/edit/master//blog/service-mesh-the-microservices-in-post-kubernetes-era/index.md">
  <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page
  </a>
</p>


            </div>
          </div>
          
          <div class="col-12">
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light">
              
              <a href="/en/tags/cloud-native" class="badge"> 
                  Cloud Native</a> </li>
          </div>

          
          
<div class="col-12">
<ul class="pager blog-pager">

<li class="previous">
<a href="https://jimmysong.io/en/blog/cloud-native-sandbox/" data-toggle="tooltip" data-placement="top" title="Cloud Native Sandbox">&larr; Previous Post</a>
</li>
 
<li class="next">
<a href="https://jimmysong.io/en/blog/moving-on-from-ant-group/" data-toggle="tooltip" data-placement="top" title="New Beginning - Goodbye Ant, Hello Tetrate">Next Post &rarr;</a>
</li>

</ul>
</div>


          
          
          <div class="col-12">
          
           <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="en"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

          
          </div>
        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 sidebar">
      <!-- recommend -->
      

<div class="bg-white md-4">
  <p class="sidebar-title">
  Related article
  </p>
  <!-- post-item -->
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <div class="media-body">
      <a href="/en/blog/high-level-cloud-native-from-kevin-hoffman/">
        <p class="mt-0">High Level Cloud Native From Kevin Hoffman</p>
      </a>
      September 15, 2017
    </div>
  </div>
  
</div>


      <!-- /recommend -->
      <!-- toc -->
      
<div class="bg-white py-4 box-shadow mb-4 sticky-top aside-toc d-none d-sm-block">
    <p class="sidebar-title">
    Table of content
    </p>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#key-takeaways">Key takeaways</a></li>
    <li><a href="#kubernetes-vs-service-mesh">Kubernetes vs Service Mesh</a></li>
    <li><a href="#kube-proxy-component">kube-proxy component</a>
      <ul>
        <li><a href="#kube-proxy-flaws">kube-proxy flaws</a></li>
      </ul>
    </li>
    <li><a href="#kubernetes-ingress-vs-istio-gateway">Kubernetes Ingress vs. Istio Gateway</a></li>
    <li><a href="#xds-protocol">xDS protocol</a>
      <ul>
        <li><a href="#xds-protocol-highlights">xDS protocol highlights</a></li>
      </ul>
    </li>
    <li><a href="#envoy">Envoy</a>
      <ul>
        <li><a href="#basic-terminology">Basic terminology</a></li>
      </ul>
    </li>
    <li><a href="#istio-service-mesh">Istio Service Mesh</a>
      <ul>
        <li><a href="#traffic-management-in-istio">Traffic Management in Istio</a></li>
      </ul>
    </li>
    <li><a href="#kubernetes-vs-xds-vs-istio">Kubernetes vs xDS vs Istio</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
</div>

      <!-- /toc -->
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>



      
    

<footer>
  
  <div class="footer bg-footer section-sm border-bottom">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-sm-8 mb-5 mb-lg-0">
          
          <h4 class="text-white mb-5 text-uppercase">Contact</h4>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s Twitter</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-twitter-qr-code.webp" width="128px" alt="footer image"></li>
            
            
            
          
        </div>
        
        

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">Blog</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/kubecon-eu-paris-recap/">KubeCon EU 2024: Impressions and Recap from Paris</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/ica-certificate/">ICA Certification: Latest Changes and Exam Preparation Guide for Istio Skills</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/preserve-source-ip-in-istio/">Maintaining Traffic Transparency: Preserving Client Source IP in Istio</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">links</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener">Awesome Cloud Native</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener">Cloud Native Community(China)</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener">Tetrate - Service Mesh Company</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://docs.tetrate.io/istio-distro/" target="_blank" rel="noopener">Tetrate Istio Distro</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">Courses</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener">Envoy Fundamentals</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener">Istio Fundamentals</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">new notice</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/cloud-native-public-library/">Announcement of Cloud Native Library</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/tetrate-recruit/">The Enterprise Service Mesh company Tetrate is hiring</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-3 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" rel="noopener"><i class="fa fa-twitter "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" rel="noopener"><i class="fa fa-github "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" rel="noopener"><i class="fa fa-linkedin "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="mailto:jimmysong@jimmysong.io" target="_blank" rel="noopener"><i class="fa fa-envelope "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="/blog/index.xml" target="_blank" rel="noopener"><i class="fa fa-rss "></i></a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>




<!-- JS Plugins -->

<script src="/plugins/jQuery/jquery.min.js"></script>

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/venobox/venobox.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script>
    anchors.add()
</script>




<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, 'Copied')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>















<script src="/js/wowchemy-search.min.0b3293fc75f976f49fb5a3d247c91f2e.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content">
      <div class="search-hit-name">
        <div class="article-metadata search-hit-type">{{relpermalink}}</div>
        <a href="{{relpermalink}}">{{title}}</a>
        <p class="search-hit-description">{{snippet}}</p>
      </div>
    </div>
  </div>
</script>


</body>

</html>
