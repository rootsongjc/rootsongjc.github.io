<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>CNI Essentials: Powering Kubernetes&#39; Network · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="This article provides an in-depth explanation of the basic concepts of Container Network Interface (CNI), its core components, and its relationship with Container Runtime Interface (CRI).">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.129.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.f25e1ff9bcb6a5d029ef3c0c4c5c51aec8832388d6321236cc72e9dc323217d6.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.f25e1ff9bcb6a5d029ef3c0c4c5c51aec8832388d6321236cc72e9dc323217d6.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/cni-deep-dive/" />
  <meta property="og:title" content="CNI Essentials: Powering Kubernetes&#39; Network | Jimmy Song" />
  <meta property="twitter:title" content="CNI Essentials: Powering Kubernetes&#39; Network | Jimmy Song" />

  
  <meta property="og:description" content="This article provides an in-depth explanation of the basic concepts of Container Network Interface (CNI), its core components, and its relationship with Container Runtime Interface (CRI)." />
  <meta property="twitter:description" content="This article provides an in-depth explanation of the basic concepts of Container Network Interface (CNI), its core components, and its relationship with Container Runtime Interface (CRI)." />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/cni.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/cni.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/book">Book</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    
                  
                
              
              
              
                
                  
                    
                    <a class="nav-link" href="/blog/cni-deep-dive/">中文</a>
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>Search</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>Search</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="Close"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="Input the keyword">
        
        <div class="mt-4">
          <span>Search type: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">All</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">Blog</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">Book</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">Notice</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    CNI Essentials: Powering Kubernetes' Network
                </p>
                <p class="page-description">
                    This article provides an in-depth explanation of the basic concepts of Container Network Interface (CNI), its core components, and its relationship with Container Runtime Interface (CRI).
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>May 18, 2024</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/en/categories/kubernetes"> 
                        Kubernetes</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>9 Minute</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>1990 words</li>
                    
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">
            
            <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-cni">What is CNI?</a></li>
    <li><a href="#relationship-between-cni-and-cri">Relationship Between CNI and CRI</a></li>
    <li><a href="#cni-workflow">CNI Workflow</a>
      <ul>
        <li><a href="#add-operation-example">ADD Operation Example</a></li>
        <li><a href="#check-operation-example">CHECK Operation Example</a></li>
        <li><a href="#delete-operation-example">DELETE Operation Example</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
</details>

            
            <p>Effective management of networking is crucial in containerized environments. The Container Network Interface (CNI) is a standard that defines how containers should be networked. This article delves into the fundamentals of CNI and explores its relationship with CRI.</p>
<h2 id="what-is-cni">What is CNI?</h2>
<p>The CNI (Container Network Interface) specification provides a common interface between container runtimes and network plugins, aiming to standardize container network configuration.</p>
<p>The CNI specification comprises several core components:</p>
<ul>
<li><strong>Network configuration format</strong>: Defines how administrators define network configurations.</li>
<li><strong>Request protocol</strong>: Describes how container runtimes send network configuration or cleanup requests to network plugins.</li>
<li><strong>Plugin execution process</strong>: Details how plugins execute network setup or cleanup based on the provided configuration.</li>
<li><strong>Plugin delegation</strong>: Allows plugins to delegate specific functionalities to other plugins.</li>
<li><strong>Result return</strong>: Defines the data format for returning results to the runtime after plugin execution.</li>
</ul>
<p>By defining these core components, the CNI specification ensures that different container runtimes and network plugins can interact in a consistent manner, enabling automation and standardization of network configuration.</p>



<div class="alert alert-note-container">
  
  <div class="alert-note-title px-2 py-2">
    Key points of the CNI specification
  </div>
  
  <div class="alert-note px-2">
    <ul>
<li>CNI is a plugin-based containerized networking solution.</li>
<li>CNI plugins are executable files.</li>
<li>The responsibility of a single CNI plugin is singular.</li>
<li>CNI plugins are invoked in a chained manner.</li>
<li>The CNI specification defines a Linux network namespace for a container.</li>
<li>Network definitions in CNI are stored in JSON format.</li>
<li>Network definitions are transmitted to plugins via STDIN input streams, meaning network configuration files are not stored on the host, and other configuration parameters are passed to plugins via environment variables.</li>
</ul>

  </div>
</div>

<p>CNI plugins receive network configuration parameters according to the operation type, perform network setup or cleanup tasks accordingly, and return the execution results. This process ensures dynamic configuration of container networks synchronized with container lifecycles.</p>
<p>The following diagram illustrates the multitude of network plugins encompassed by CNI.</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/cdc38d55a4fc4468ab20df85ab63c2c7.svg" data-img="/en/blog/cni-deep-dive/cdc38d55a4fc4468ab20df85ab63c2c7.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<p>According to the <a href="https://github.com/containernetworking/cni/blob/main/SPEC.md#section-2-execution-protocol" title="CNI specification" target="_blank" rel="noopener">CNI specification</a>, a CNI plugin is responsible for configuring a container&rsquo;s network interface in some way. Plugins can be classified into two major categories:</p>
<ul>
<li>&ldquo;Interface&rdquo; plugins, responsible for creating network interfaces inside containers and ensuring their connectivity.</li>
<li>&ldquo;Chained&rdquo; plugins, adjusting the configuration of already created interfaces (but may need to create more interfaces to accomplish this).</li>
</ul>
<h2 id="relationship-between-cni-and-cri">Relationship Between CNI and CRI</h2>
<p>CNI and CRI (Container Runtime Interface) are two critical interfaces in Kubernetes, responsible for container network configuration and runtime management, respectively. In Kubernetes clusters, CRI invokes CNI plugins to configure or clean up container networks, ensuring tight coordination between the network configuration process and container creation and destruction processes.</p>
<p>The following diagram intuitively illustrates how CNI collaborates with CRI:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/9efc34ed8d34997a651adff337bb1630.svg" data-img="/en/blog/cni-deep-dive/9efc34ed8d34997a651adff337bb1630.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<ol>
<li><strong>Kubelet to CRI</strong>: The Kubelet instructs the CRI to create the containers for a scheduled pod.</li>
<li><strong>CRI to Pod</strong>: The container runtime starts the container within the pod.</li>
<li><strong>Pod to CRI</strong>: Once the container is running, it signals back to the container runtime.</li>
<li><strong>CRI to Kubelet</strong>: The container runtime notifies the Kubelet that the containers are ready.</li>
<li><strong>Kubelet to CNI</strong>: With the containers up, the Kubelet calls the CNI to set up the network for the pod.</li>
<li><strong>CNI to Pod</strong>: The CNI configures the network for the pod, attaching it to the necessary network interface.</li>
<li><strong>Pod to CNI</strong>: After the network is configured, the pod confirms network setup to the CNI.</li>
<li><strong>CNI to Kubelet</strong>: The CNI informs the Kubelet that the pod&rsquo;s network is ready.</li>
<li><strong>Kubelet to Pod</strong>: The pod is now fully operational, with both containers running and network configured.</li>
</ol>
<p>The following diagram shows the detailed steps involved in setting up networking for a pod in Kubernetes:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/640af94970463b3c8707011903bfe19a.svg" data-img="/en/blog/cni-deep-dive/640af94970463b3c8707011903bfe19a.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<ol>
<li><strong>Pod scheduling</strong>: The Kubelet schedules a pod to run on a node.</li>
<li><strong>Request network setup</strong>: The scheduled pod requests network setup from the Kubelet.</li>
<li><strong>Invoke CNI</strong>: The Kubelet invokes the CNI to handle the network setup for the pod.</li>
<li><strong>Create network namespace</strong>: The CNI creates a network namespace for the pod, isolating its network environment.</li>
<li><strong>Allocate IP address</strong>: The CNI, through its IP Address Management (IPAM) plugin, allocates an IP address for the pod.</li>
<li><strong>Setup network interfaces</strong>: The CNI sets up the necessary network interfaces within the pod&rsquo;s network namespace, attaching it to the network.</li>
<li><strong>Network setup complete</strong>: The pod notifies the Kubelet that its network setup is complete.</li>
<li><strong>Pod running with network</strong>: The pod is now running with its network configured and can communicate with other pods and services within the Kubernetes cluster.</li>
</ol>
<h2 id="cni-workflow">CNI Workflow</h2>
<p>The Container Network Interface (CNI) specification defines how containers should configure networks, including five operations: <code>ADD</code>, <code>CHECK</code>, <code>DELETE</code>, <code>GC</code>, and <code>VERSION</code>. Container runtimes execute these operations by calling various CNI plugins, enabling dynamic management and updates of container networks.</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/7b22cf25a480085d500bf3031dbaf6ec.svg" data-img="/en/blog/cni-deep-dive/7b22cf25a480085d500bf3031dbaf6ec.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<p>To elaborate on each step described in the sequence diagram, involving interactions between Kubelet, Pod, CNI plugins (both interface and chained), network setup, and IP address management (IPAM), let&rsquo;s delve deeper into the process:</p>
<ol>
<li><strong>Schedule Pod</strong>: Kubelet schedules a Pod to run on a node. This step initiates the lifecycle of Pods within the Kubernetes cluster.</li>
<li><strong>Request Network Setup</strong>: The Pod requests Kubelet for network setup. This request triggers the process of configuring the network for the Pod, ensuring its ability to communicate within the Kubernetes cluster.</li>
<li><strong>Call CNI Plugins</strong>: Kubelet invokes configured Container Network Interface (CNI) plugins. CNI defines a standardized way for container management systems to set up network interfaces within Linux containers. Kubelet passes necessary information to CNI plugins to initiate network setup.</li>
<li><strong>Call Interface Plugin</strong>: The CNI framework calls an interface CNI plugin responsible for setting up primary network interfaces for the Pod. This plugin may create a new network namespace, connect a pair of veth, or perform other actions to ensure the Pod has the required network interfaces.</li>
<li><strong>Set Network Interfaces</strong>: The interface CNI plugin configures network interfaces for the Pod. This setup includes assigning IP addresses, setting up routes, and ensuring interfaces are ready for communication.</li>
<li><strong>Call Chained Plugin</strong>: After setting up network interfaces, the interface CNI plugin or the CNI framework calls chained CNI plugins. These plugins perform additional network configuration tasks, such as setting up IP masquerading, configuring ingress/egress rules, or applying network policies.</li>
<li><strong>Allocate IP Address</strong>: As part of the chained process, one of the chained CNI plugins may involve IP Address Management (IPAM). The IPAM plugin is responsible for assigning an IP address to the Pod, ensuring each Pod has a unique IP within the cluster or namespace.</li>
<li><strong>IP Address Allocated</strong>: The IPAM plugin allocates an IP address and returns the allocation information to the calling plugin. This information typically includes the IP address itself, subnet mask, and possible gateway.</li>
<li><strong>Apply Network Policies</strong>: Chained CNI plugins apply any specified network policies to the Pod&rsquo;s network interfaces. These policies may dictate allowed ingress and egress traffic, ensuring network security and isolation per cluster configuration requirements.</li>
<li><strong>Chained Configuration Complete</strong>: Once all chained plugins have completed their tasks, the overall network configuration for the Pod is considered complete. The CNI framework or the last plugin in the chain signals to Kubelet that network setup is complete.</li>
<li><strong>Network Setup Complete</strong>: Kubelet receives confirmation of network setup completion from the Pod. At this point, the Pod has fully configured network interfaces with IP addresses, route rules, and applied network policies.</li>
<li><strong>Pod Running with Network</strong>: The Pod is now running and has its network configured. It can communicate with other Pods within the Kubernetes cluster, access external resources per network policies, and perform its designated functions.</li>
</ol>
<p>The following are example sequence diagrams and detailed explanations for the <code>ADD</code>, <code>CHECK</code>, and <code>DELETE</code> operations based on the <a href="https://github.com/containernetworking/cni/blob/main/SPEC.md#appendix-examples" title="official CNI examples" target="_blank" rel="noopener">official CNI examples</a>. Through these operations, interactions between the container runtime and CNI plugins facilitate dynamic management and updates of container network configurations.</p>
<h3 id="add-operation-example">ADD Operation Example</h3>
<p>Below is the example sequence diagram and detailed explanation for the ADD operation:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/4f28f5eda4192e0eb4cd9c65f2c6f61f.svg" data-img="/en/blog/cni-deep-dive/4f28f5eda4192e0eb4cd9c65f2c6f61f.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<ol>
<li><strong>Container Runtime Calls Portmap Plugin</strong>: The container runtime executes the ADD operation by calling the Portmap plugin to configure port mapping for the container.</li>
<li><strong>Portmap Configuration Complete</strong>: The Portmap plugin completes the port mapping configuration and returns the result to the container runtime.</li>
<li><strong>Container Runtime Calls Tuning Plugin</strong>: The container runtime invokes the Tuning plugin to execute the ADD operation and configure network tuning parameters for the container.</li>
<li><strong>Tuning Configuration Complete</strong>: The Tuning plugin finishes configuring network tuning parameters and returns the result to the container runtime.</li>
<li><strong>Container Runtime Calls Bridge Plugin</strong>: The container runtime calls the Bridge plugin to execute the ADD operation and configure network interfaces and IP addresses for the container.</li>
<li><strong>Bridge Plugin Calls Host-local Plugin</strong>: Before completing its own configuration, the Bridge plugin calls the Host-local plugin to execute the ADD operation and configure IP addresses for the container.</li>
<li><strong>IPAM Configuration Complete</strong>: The Host-local plugin, acting as the authority for IP Address Management (IPAM), completes IP address allocation and returns the result to the Bridge plugin.</li>
<li><strong>Bridge Configuration Complete</strong>: The Bridge plugin finishes configuring network interfaces and IP addresses and returns the result to the container runtime.</li>
</ol>
<p>These operations ensure that the required network configuration is set up as expected when the container starts, including port mapping, network tuning, and IP address allocation.</p>
<h3 id="check-operation-example">CHECK Operation Example</h3>
<p>Below is the example sequence diagram and detailed explanation for the CHECK operation:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/c20cc6391b4f6cf89ffac159410ca851.svg" data-img="/en/blog/cni-deep-dive/c20cc6391b4f6cf89ffac159410ca851.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<ol>
<li><strong>Container Runtime Calls Bridge Plugin for Check</strong>: The container runtime performs the CHECK operation by calling the Bridge plugin to inspect the container&rsquo;s network configuration.</li>
<li><strong>Bridge Plugin Calls Host-local Plugin for Check</strong>: The Bridge plugin calls the Host-local plugin to inspect IP address allocation.</li>
<li><strong>No Errors Detected</strong>: The Host-local plugin detects no errors in IP address allocation and reports no errors to the Bridge plugin.</li>
<li><strong>Return with 0 Exit Code</strong>: The Bridge plugin confirms no network configuration errors and returns with a 0 exit code to the container runtime.</li>
<li><strong>Container Runtime Calls Tuning Plugin for Check</strong>: The container runtime invokes the Tuning plugin to inspect network tuning parameters.</li>
<li><strong>Operation Successful</strong>: The Tuning plugin confirms no errors in network tuning parameters, indicating a successful operation to the container runtime.</li>
</ol>
<p>These operations ensure that during container runtime, network configuration and tuning parameters are checked and verified as expected to ensure consistency and correctness in network configuration.</p>
<h3 id="delete-operation-example">DELETE Operation Example</h3>
<p>Below is the example sequence diagram and detailed explanation for the DELETE operation:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/cni-deep-dive/40d9a191cc29a56b101c764a520d521e.svg" data-img="/en/blog/cni-deep-dive/40d9a191cc29a56b101c764a520d521e.svg" alt="image" data-caption="Mermaid Diagram">
        
      
    
  
  
  <figcaption>Mermaid Diagram</figcaption>
  
</figure>
<ol>
<li><strong>Container Runtime Calls Portmap Plugin for Delete</strong>: The container runtime initiates the DELETE operation by calling the Portmap plugin to remove port mapping configuration for the container.</li>
<li><strong>Portmap Deletion Complete</strong>: The Portmap plugin finishes deleting port mapping and reports completion to the container runtime.</li>
<li><strong>Container Runtime Calls Tuning Plugin for Delete</strong>: The container runtime calls the Tuning plugin to execute the DELETE operation and remove network tuning parameters for the container.</li>
<li><strong>Tuning Deletion Complete</strong>: The Tuning plugin completes deletion of network tuning parameters and notifies the container runtime.</li>
<li><strong>Container Runtime Calls Bridge Plugin for Delete</strong>: The container runtime invokes the Bridge plugin to execute the DELETE operation and remove network interfaces and IP address configuration for the container.</li>
<li><strong>Bridge Plugin Calls Host-local Plugin for Delete</strong>: Before completing its own deletion, the Bridge plugin calls the Host-local plugin to execute the DELETE operation and remove IP address allocation for the container.</li>
<li><strong>IPAM Deletion Complete</strong>: The Host-local plugin completes IP address deletion and informs the Bridge plugin.</li>
<li><strong>Bridge Deletion Complete</strong>: The Bridge plugin finishes removing network interfaces and IP addresses and notifies the container runtime.</li>
</ol>
<p>These operations ensure that when the container stops running, its required network configuration is properly cleaned up and removed to ensure effective release and management of network resources.</p>
<p>Through the example sequence diagrams and detailed explanations for ADD, CHECK, and DELETE operations, it&rsquo;s clear how interactions between the container runtime and CNI plugins facilitate dynamic management and updates of container network configurations.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The Container Network Interface (CNI) specification standardizes container network configuration in Kubernetes clusters, allowing container runtimes to interface with various network plugins seamlessly. Understanding CNI&rsquo;s core components and its collaboration with the Container Runtime Interface (CRI) is essential for effective network management in containerized environments.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/containernetworking/cni/blob/main/SPEC.md" title="CNI Spec" target="_blank" rel="noopener">CNI Spec</a></li>
</ul>
<hr>
<p><em>This blog was initially published at <a href="https://tetrate.io/blog/envoy-microservices-overview/" title="tetrate.io" target="_blank" rel="noopener">tetrate.io</a></em>.</p>

            <div class="border-bottom mb-2"></div>
          </div>

          <div class="col-12">
            <p>Last updated on Aug 2, 2024</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/en/tags/kubernetes" class="badge"> 
                  Kubernetes</a> 
              <a href="/en/tags/cni" class="badge">  
                  CNI</a> 
              <a href="/en/tags/cri" class="badge">  
                  CRI</a> 
              <a href="/en/tags/network" class="badge">  
                  Network</a> </div>
          </div>

          
          <div class="col-12">
            




    

    

    

    

    

    

    

    

    

    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    



<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/en/blog/istio-cni-deep-dive/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; Previous Post</span>
            <span class="text-align-left">Istio CNI Unveiled: Streamlining Service Mesh Connectivity</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/en/blog/envoy-gateway-introduction/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">Next Post &rarr;</span>
            <span class="text-align-right">Envoy Gateway Overview: Modern Kubernetes Ingress with Envoy Gateway and the Gateway API</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="en"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  Related article
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/en/blog/why-gateway-api-is-the-future-of-ingress-and-mesh/">
            Why the Gateway API Is the Unified Future of Ingress for Kubernetes and Service Mesh
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      Table of content
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-cni">What is CNI?</a></li>
    <li><a href="#relationship-between-cni-and-cri">Relationship Between CNI and CRI</a></li>
    <li><a href="#cni-workflow">CNI Workflow</a>
      <ul>
        <li><a href="#add-operation-example">ADD Operation Example</a></li>
        <li><a href="#check-operation-example">CHECK Operation Example</a></li>
        <li><a href="#delete-operation-example">DELETE Operation Example</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">Contact</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s LinkedIn</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-linkedin.png" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Blog</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/seamless-cross-cluster-access-istio/">A Definitive Guide to Cross-Cluster Seamless Access in Multicluster Istio Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/how-to-integrate-third-party-registry-with-istio/">How to Integrating Third-Party Service Registries with Istio?</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/envoy-gateway-oidc/">How to Implement Single Sign-On (SSO) with OIDC in API Gateway using Envoy Gateway?</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">links</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" >
                  Awesome Cloud Native
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://gateway.envoyproxy.io" target="_blank" rel="noopener noreferrer">
                  Envoy Gateway
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io" target="_blank" rel="noopener noreferrer">
                  Istio
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate - Service Mesh Company
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://docs.tetrate.io/istio-subscription/" target="_blank" rel="noopener noreferrer">
                  Tetrate Istio Subscription
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Courses</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener noreferrer">
                  Envoy Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener noreferrer">
                  Istio Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">new notice</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-china-2024-panel/">KubeCon China 2024 panel Preview: Istio and Modern API Gateways – Leading the Future of Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/website-revamp-notice/">Website Revamp Notice</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>






  





<script src="/js/wowchemy-search.min.ce03c611044441cf6e84f9e4bef20818.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
