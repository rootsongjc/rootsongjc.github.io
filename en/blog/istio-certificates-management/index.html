<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>How Are Certificates Managed in Istio? - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="This blog post will explain how Istio handles certificate management.">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/istio-certificates-management/" />
  <meta property="og:title" content="How Are Certificates Managed in Istio? | Jimmy Song" />
  <meta property="twitter:title" content="How Are Certificates Managed in Istio? | Jimmy Song" />

  
  <meta property="og:description" content="This blog post will explain how Istio handles certificate management." />
  <meta property="twitter:description" content="This blog post will explain how Istio handles certificate management." />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/cert.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/cert.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    
                  
                
              
              
              
                
                  
                    
                    <a class="nav-link" href="/blog/istio-certificates-management/">中文</a>
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>Search</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>Search</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="Close"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="Input the keyword">
        
        <div class="mt-4">
          <span>Search type: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">All</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">Blog</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">Book</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">Notice</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    How Are Certificates Managed in Istio?
                </p>
                <p class="page-description">
                    This blog post will explain how Istio handles certificate management.
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>Jan 30, 2023</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/en/categories/istio"> 
                        Istio</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>10 Minute</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>2224 words</li>
                    
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">

            
            
            
              <div class="alert alert-note-container mt-2">
    <div class="alert-note-title px-2 py-2">
      Copyright
    </div>
    <div class="alert-tip px-2">
      This is an original article by Jimmy Song. You may repost it, but please credit this source: <a title=https://jimmysong.io/en/blog/istio-certificates-management/>https://jimmysong.io/en/blog/istio-certificates-management/</a>
     </div>
  </div>
            

            
              <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-a-certificate">What Is a Certificate?</a></li>
    <li><a href="#how-to-generate-certificates">How to Generate Certificates</a></li>
    <li><a href="#certificate-trust-chain">Certificate Trust Chain</a></li>
    <li><a href="#how-to-incorporate-istio-into-the-pki-certificate-trust-chain">How to Incorporate Istio into the PKI Certificate Trust Chain</a></li>
    <li><a href="#steps-for-using-a-custom-ca-in-istio">Steps for Using a Custom CA in Istio</a></li>
    <li><a href="#process-for-istios-built-in-ca-to-issue-a-certificate">Process for Istio’s Built-in CA to Issue a Certificate</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
</details>

            
            <p>I mentioned in <a href="/blog/understanding-the-tls-encryption-in-istio/" title="my last article">my last article</a> on understanding mTLS traffic encryption in Istio that the key to traffic encryption is certificate management. We can use the built-in certificate authority (CA) in Istio or a custom CA to manage certificates within the mesh. This blog post will explain how Istio handles certificate management.</p>
<h2 id="what-is-a-certificate">What Is a Certificate?</h2>
<p>There are many types of certificates, but in this article, I am explicitly referring to <a href="https://www.rfc-editor.org/rfc/rfc5280" title="X.509 V3" target="_blank" rel="noopener">X.509 V3</a> certificates. X.509 certificates are a standard digital format used to identify entities in computer networks. X.509 is the international standard for public key infrastructure (PKI) and is primarily used for identity authentication and information encryption, such as TLS.</p>
<p>The contents of a certificate are hashed using a hash function and then signed with the issuer’s private key. This way, when a certificate is received, the recipient can use the issuer’s public key to verify the certificate’s validity.</p>
<p>A hash function is a function that maps an input of any length (also called a message) to a fixed-length output, also called a <em>hash value</em> or <em>message digest</em>. There are many hash functions, such as MD5, SHA-1, etc.</p>
<p>A certificate is like a business card issued by an authoritative agency for the user to prove their identity, and it can also be used to encrypt information to ensure the security and integrity of communication. The following diagram shows the general steps of TLS communication, where the certificate proves the server’s identity and encrypts the communication.</p>
<p>Figure 1 shows an example of an HTTP call to a website, issuing a digital certificate, authenticating, and encrypting the communication.</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/istio-certificates-management/tls.svg" data-img="/en/blog/istio-certificates-management/tls.svg" alt="image" data-caption="Figure 1. TLS certificate issuance and validation process">
        
      
    
  
  
  <figcaption>Figure 1. TLS certificate issuance and validation process</figcaption>
  
</figure>
<p>Here are the detailed steps:</p>
<ol>
<li>The server (website owner) submits a certificate signing request to the CA;</li>
<li>The CA verifies the server’s identity and the authenticity of the website and issues a digital certificate to the server, which the server installs so that visitors can verify the website’s security;</li>
<li>The user sends a request to the website through a browser (client);</li>
<li>The server returns the TLS certificate to the client;</li>
<li>The client verifies the certificate’s validity with the CA and establishes the connection if the certificate is valid, or prompts the user to reject the connection if it is invalid;</li>
<li>The client generates a pair of random public and private keys;</li>
<li>The client sends its public key to the server;</li>
<li>The server encrypts the message using the client’s public key;</li>
<li>The server sends the encrypted data to the client;</li>
<li>The client decrypts the data sent by the server using its private key.</li>
</ol>
<p>At this point, both parties have established a secure channel and can transmit encrypted data in both directions.</p>
<h2 id="how-to-generate-certificates">How to Generate Certificates</h2>
<p>You can generate X.509 certificates with the following open-source tools:</p>
<ul>
<li><a href="https://github.com/OpenVPN/easy-rsa" title="Easy-RSA" target="_blank" rel="noopener">Easy-RSA</a>: A simple command-line tool maintained by the OpenVPN project, EasyRSA can easily generate secure certificates and keys for the OpenVPN network.</li>
<li><a href="https://github.com/openssl/openssl" title="OpenSSL" target="_blank" rel="noopener">OpenSSL</a>: Originated by an individual in 1995 and now maintained by an independent organization, OpenSSL provides only a command-line tool.</li>
<li><a href="https://github.com/cloudflare/cfssl" title="CFSSL" target="_blank" rel="noopener">CFSSL</a>: Developed and maintained by CloudFlare, CFSSL is not just a command-line tool for generating certificates but also can serve as a PKI server.</li>
<li><a href="https://github.com/google/boringssl" title="BoringSSL" target="_blank" rel="noopener">BoringSSL</a>: A branch of OpenSSL developed and maintained by Google, BoringSSL is used in the Chrome browser and Android operating system.</li>
</ul>
<p>Since most people are probably familiar with OpenSSL, we will use OpenSSL to create certificates in the following text.</p>
<h2 id="certificate-trust-chain">Certificate Trust Chain</h2>
<p>The validation of a certificate requires using a certificate trust chain (Certificate Trust Chain). A certificate trust chain refers to a series of certificates used for identity verification, which form a chain starting from a trusted root certificate issuing agency, connecting downward step by step, until a specific intermediate or terminal certificate is used for verifying a particular certificate. The trustworthiness of a digital certificate increases as the certificate level increases in the certificate trust chain.</p>
<p>In Figure 2, you can see four trust chains.</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/istio-certificates-management/certificate-trust-chain.svg" data-img="/en/blog/istio-certificates-management/certificate-trust-chain.svg" alt="image" data-caption="Figure 2. Certificate trust chains">
        
      
    
  
  
  <figcaption>Figure 2. Certificate trust chains</figcaption>
  
</figure>
<p>Certificate trust chains are tree-like structures, where each CA can have one or more child CAs. There are three roles:</p>
<ul>
<li><strong>Root CA:</strong> The top-level CA can issue certificates to intermediate CAs.</li>
<li><strong>Intermediate CA:</strong> They can issue end-entity certificates.</li>
<li><strong>End entity:</strong> A device or service that holds an end-entity certificate.</li>
</ul>
<p>Root CAs are the top-level issuing authorities for digital certificates, so the certificates they issue are the most trustworthy. Root certificate authorities are usually operated and regulated by government agencies or other authoritative organizations such as the International Infrastructure Security Organization. Common root CAs include:</p>
<ul>
<li>Symantec/VeriSign</li>
<li>Comodo</li>
<li>DigiCert</li>
<li>GlobalSign</li>
<li>GoDaddy</li>
<li>Entrust</li>
<li>GeoTrust</li>
<li>RapidSSL</li>
<li>Baltimore CyberTrust Root</li>
</ul>
<p>Please note that the above list is just a sample. There are many other root CAs.</p>
<p>When you open an HTTPS webpage in a Chrome browser, you can view the certificate information by clicking on the lock icon on the left side of the address bar, which includes the certificate trust chain, such as the certificate trust chain of <a href="https://tetrate.io/" title="https://tetrate.io" target="_blank" rel="noopener">https://tetrate.io</a> shown in Figure 3.</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          
          <picture>
           <source srcset="/en/blog/istio-certificates-management/tetrate-cert_hu10139358431924279620.webp" type="image/webp">
           <img src="/en/blog/istio-certificates-management/tetrate-cert.jpg" data-img="/en/blog/istio-certificates-management/tetrate-cert.jpg" data-width="800" data-height="979" alt="image" data-caption="Figure 3. Certificate hierarchy of tetrate.io">
          </picture>
        
      
    
  
  
  <figcaption>Figure 3. Certificate hierarchy of tetrate.io</figcaption>
  
</figure>
<p>The certificate trust chain allows the client (such as a web browser) to verify each certificate step by step when verifying the terminal certificate to determine whether it is trustworthy. The principle of digital certificate issuance is that the CA binds the certificate owner’s public key and identity information together. Then the CA uses its proprietary private key to generate a formal digital signature to indicate that the CA issued this certificate. The digital signature on the certificate can be verified using the CA’s public key during certificate verification.</p>
<h2 id="how-to-incorporate-istio-into-the-pki-certificate-trust-chain">How to Incorporate Istio into the PKI Certificate Trust Chain</h2>
<p>Before using Istio, enterprises usually have their own internal public key infrastructure . How can Istio be incorporated into the PKI certificate trust chain?</p>
<p>Istio has built-in certificate management functions that can be used out of the box. When Istio is started, it will create a self-signed certificate for <em>istiod</em> as the root certificate for all workloads in the mesh. The problem with this is that the built-in root certificate cannot achieve mutual trust between meshes if you have multiple meshes. The correct approach is not to use Istio’s self-signed certificate, but to incorporate Istio into your certificate trust chain and integrate Istio into your PKI, creating an intermediate certificate for each PKI mesh. In this way, two meshes have a shared trust root and can achieve mutual trust between meshes.</p>
<p>Integrate the Istio mesh into your internal PKI certificate trust chain by creating an intermediate CA, as shown in Figure 4.</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/istio-certificates-management/cluster-ca.svg" data-img="/en/blog/istio-certificates-management/cluster-ca.svg" alt="image" data-caption="Figure 4: Create intermediate CAs for the multi-cluster mesh to enable Istio to be included in the on-premises PKI certificate trust chain">
        
      
    
  
  
  <figcaption>Figure 4: Create intermediate CAs for the multi-cluster mesh to enable Istio to be included in the on-premises PKI certificate trust chain</figcaption>
  
</figure>
<p>There are many benefits to incorporating Istio into your company’s internal PKI certificate trust chain:</p>
<ul>
<li><strong>Secure communication across grids/clusters</strong>: with a common trust root, clusters can verify each other’s identities and communicate with each other;</li>
<li><strong>More granular certificate revocation:</strong> you can revoke the certificate of an individual entity or intermediate CA to revoke the certificate for service or cluster;</li>
<li><strong>Easy implementation of certificate rotation:</strong> you can rotate certificates by cluster/mesh rather than rotating the root node certificate, which reduces downtime. It is recommended to use <a href="https://github.com/cert-manager/cert-manager" title="cert-manager" target="_blank" rel="noopener">cert-manager</a> to achieve automated large-scale CA certificate rotation in production. For more information, see <a href="https://tetrate.io/blog/automate-istio-ca-rotation-in-production-at-scale/" title="Automate Istio CA Rotation in Production at Scale" target="_blank" rel="noopener">Automate Istio CA Rotation in Production at Scale</a>;</li>
</ul>
<p>For detailed instructions on incorporating Istio into your company’s internal PKI certificate trust chain, see <a href="https://tetrate.io/blog/istio-trust/" title="this blog post" target="_blank" rel="noopener">this blog post</a>.</p>
<h2 id="steps-for-using-a-custom-ca-in-istio">Steps for Using a Custom CA in Istio</h2>
<p>By default, the Istio CA generates a self-signed root certificate and key and uses them to sign workload certificates. To protect the root CA key, you should use a root CA that runs offline on a secure machine and the root CA to issue intermediate certificates to the Istio CA running on each cluster. The Istio CA can then use the administrator-specified certificate and key to sign workload certificates and distribute the administrator-specified root certificate as the trusted root to workloads.</p>
<p>Figure 5 shows the certificate issuance and mounting process in Istio.</p>
<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/istio-certificates-management/cert-process.svg" data-img="/en/blog/istio-certificates-management/cert-process.svg" alt="image" data-caption="Figure 5. Certificate issuance and mounting process in Istio">
        
      
    
  
  
  <figcaption>Figure 5. Certificate issuance and mounting process in Istio</figcaption>
  
</figure>
<ol>
<li>In Istio, the Envoy proxy injects two processes into the Pod: <em>envoy</em> and <em>pilot-agent</em>. The <em>pilot-agent</em> generates a private key and uses the Secret Discovery Service (SDS) via a Unix Domain Socket (UDS) to request a certificate signing request (CSR) from the Certificate Authority (CA) through the <em>istiod</em>, if you have not configured the CA plugin.</li>
<li><em>istiod</em>, which has a built-in CA, returns the certificate to the <em>pilot-agent</em>.</li>
<li>The <em>pilot-agent</em> then sends the generated private key and the CA-returned certificate to the Envoy instance to mount.</li>
</ol>
<p>Istio defaults to using the CA built into <em>istiod</em>, but also supports injecting other CAs, see the <a href="https://istio.io/latest/docs/tasks/security/cert-management/plugin-ca-cert/" title="Istio documentation" target="_blank" rel="noopener">Istio documentation</a>. Suppose you want to create identities for your services using custom CA certificates and keys. In that case, you will need to:</p>
<ul>
<li>Create a CA configuration file and use it to create self-signed CA root certificates and keys.</li>
<li>Create a private key and signing request configuration files for the service.</li>
<li>Create a certificate signing request (CSR) for the service.</li>
<li>Use the root certificate and key, along with the service’s signing request file, to create a certificate for the service.</li>
</ul>
<p>Next, we will detail the process of creating and mounting a certificate for the Bookinfo <em>productpage</em> service using Istio’s built-in CA as an example.</p>
<h2 id="process-for-istios-built-in-ca-to-issue-a-certificate">Process for Istio’s Built-in CA to Issue a Certificate</h2>
<p>When Istio starts, it creates a self-signed CA certificate, which it then uses to issue certificates to services within the mesh. Below, we will manually simulate the steps for Istio’s built-in CA to issue a certificate:</p>
<p><strong>Step 1:</strong> Create a CA private key <strong>ca.key</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl genrsa -out ca.key
</span></span></code></pre></div><p><strong>Step 2:</strong> Create a CA configuration file <strong>ca.conf</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[ req ]</span>
</span></span><span class="line"><span class="cl"><span class="na">default_bits</span> <span class="o">=</span> <span class="s">2048</span>
</span></span><span class="line"><span class="cl"><span class="na">prompt</span> <span class="o">=</span> <span class="s">no</span>
</span></span><span class="line"><span class="cl"><span class="na">utf8</span> <span class="o">=</span> <span class="s">yes</span>
</span></span><span class="line"><span class="cl"><span class="na">encrypt_key</span> <span class="o">=</span> <span class="s">no</span>
</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span>  <span class="o">=</span> <span class="s">req_dn</span>
</span></span><span class="line"><span class="cl"><span class="na">req_extensions</span> <span class="o">=</span> <span class="s">req_ext</span>
</span></span><span class="line"><span class="cl"><span class="na">x509_extensions</span> <span class="o">=</span> <span class="s">req_ext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ req_dn ]</span>
</span></span><span class="line"><span class="cl"><span class="na">O</span> <span class="o">=</span> <span class="s">Istio</span>
</span></span><span class="line"><span class="cl"><span class="na">CN</span> <span class="o">=</span> <span class="s">Root CA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ req_ext ]</span>
</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>
</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">critical, CA:true</span>
</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, nonRepudiation, keyEncipherment, keyCertSign</span>
</span></span></code></pre></div><p><strong>Step 3:</strong> Use the CA private key <strong>ca.key</strong> to generate a self-signed certificate <strong>ca.pem</strong>, which contains the CA’s information in the subject:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl req -x509 -new -nodes -key ca.key -days <span class="m">365</span> -out ca.pem -config ca.conf
</span></span></code></pre></div><p><strong>Step 4:</strong> Create the workload’s private key <strong>workload.key</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl genrsa -out workload.key
</span></span></code></pre></div><p><strong>Step 5:</strong> Create a certificate signing request configuration file <strong>csr.conf</strong>, which contains the address of the CA and additional information:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[ req ]</span>
</span></span><span class="line"><span class="cl"><span class="na">default_bits</span> <span class="o">=</span> <span class="s">2048</span>
</span></span><span class="line"><span class="cl"><span class="na">prompt</span> <span class="o">=</span> <span class="s">no</span>
</span></span><span class="line"><span class="cl"><span class="na">utf8</span> <span class="o">=</span> <span class="s">yes</span>
</span></span><span class="line"><span class="cl"><span class="na">encrypt_key</span> <span class="o">=</span> <span class="s">no</span>
</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span>  <span class="o">=</span> <span class="s">dn</span>
</span></span><span class="line"><span class="cl"><span class="na">req_extensions</span> <span class="o">=</span> <span class="s">req_ext</span>
</span></span><span class="line"><span class="cl"><span class="na">x509_extensions</span> <span class="o">=</span> <span class="s">req_ext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ req_dn ]</span>
</span></span><span class="line"><span class="cl"><span class="na">O</span> <span class="o">=</span> <span class="s">Istio</span>
</span></span><span class="line"><span class="cl"><span class="na">CN</span> <span class="o">=</span> <span class="s">productpage</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ req_ext ]</span>
</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>
</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">critical, CA:true</span>
</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, nonRepudiation, keyEncipherment, keyCertSign</span>
</span></span></code></pre></div><p><strong>Step 6:</strong> Create a certificate signing request <strong>workload.csr</strong> based on the workload’s CSR configuration file <strong>csr.conf</strong> and the workload’s private key file <strong>workload.key</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl req -new -key workload.key -out workload.csr -config csr.conf
</span></span></code></pre></div><p><strong>Step 7:</strong> Create certificate <strong>workload.pem</strong> based on CA’s private key <strong>ca.key</strong>, CA’s certificate <strong>ca.pem</strong> and workload’s certificate signing request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl x509 -req -in workload.csr -CA ca.pem -CAkey ca.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -CAcreateserial -out workload.pem -days <span class="m">365</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -extensions req_ext -extfile csr.conf -sha256
</span></span></code></pre></div><p><strong>Step 8:</strong> View the certificate chain mounted by the Envoy proxy in the workload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">istioctl proxy-config secret deployment/productpage-v1 -o json <span class="p">|</span> jq -r <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">&#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&#39;</span> <span class="p">|</span> base64 --decode &gt; chain.pem
</span></span></code></pre></div><p>The <strong>chain.pem</strong> file holds the certificate chain for the <em>productpage</em> service. Because we use the Istio built-in CA as the root CA, only one certificate is stored in this file, which can be viewed by running the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl x509 -noout -text -in chain.pem
</span></span></code></pre></div><p><strong>Step 9:</strong> View the root certificate mounted by the Envoy proxy:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">istioctl proxy-config secret deployment/productpage-v1 -o json <span class="p">|</span> jq -r <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">&#39;.dynamicActiveSecrets[1].secret.validationContext.trustedCa.inlineBytes&#39;</span> <span class="p">|</span> base64 --decode &gt; root.pem
</span></span></code></pre></div><p><strong>root.pem</strong> is the root certificate, run the following command to view:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl x509 -noout -text -in root.pem
</span></span></code></pre></div><p>After the certificate is mounted to the Envoy proxy, <em>istiod</em> will take care of periodically replacing the key certificate and revoking the key certificate as needed.</p>
<h2 id="summary">Summary</h2>
<p>This article introduces you to the function of digital certificates and the trust chain, and how the built-in, out-of-the-box certificate manager operates in Istio. However, the built-in CA in Istio still has certain limitations. In the next blog, I will introduce how to use the SPIRE and cert-manager plugins to achieve fine-grained certificate management and automatic certificate rotation.</p>
<hr>
<p>If you’re new to service mesh and Kubernetes security, we have a bunch of free online courses <a href="https://tetr8.io/academy" title="available at Tetrate Academy" target="_blank" rel="noopener">available at Tetrate Academy</a> that will quickly get you up to speed with Istio and Envoy.</p>
<p>If you’re looking for a fast way to get to production with Istio, check out <a href="https://tetr8.io/tid" title="Tetrate Istio Distribution (TID)" target="_blank" rel="noopener">Tetrate Istio Distribution (TID)</a>. TID is Tetrate’s hardened, fully upstream Istio distribution, with FIPS-verified builds and support available. It’s a great way to get started with Istio knowing you have a trusted distribution to begin with, have an expert team supporting you, and also have the option to get to FIPS compliance quickly if you need to.Once you have Istio up and running, you will probably need simpler ways to manage and secure your services beyond what’s available in Istio, that’s where Tetrate Service Bridge comes in. You can learn more about how Tetrate Service Bridge makes service mesh more secure, manageable, and resilient <a href="https://tetr8.io/tsb" title="here" target="_blank" rel="noopener">here</a>, or <a href="https://tetr8.io/contact" title="contact us for a quick demo" target="_blank" rel="noopener">contact us for a quick demo</a>.</p>
<p><em>This blog was originally published at <a href="https://tetrate.io/blog/how-are-certificates-managed-in-istio/" title="tetrate.io" target="_blank" rel="noopener">tetrate.io</a>.</em></p>

            <div class="border-bottom mb-2"></div>
          </div>
          <div class="col-12">
            <p>Last updated on Mar 12, 2025</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/en/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/en/tags/security" class="badge">  
                  Security</a> 
              <a href="/en/tags/certificate" class="badge">  
                  Certificate</a> </div>
          </div>
          
          <div class="col-12">
            









    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    


<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/en/blog/ai-tools-collection/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; Previous Post</span>
            <span class="text-align-left">Useful AI Tools to Optimize Your Workflow</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/en/blog/ambient-mesh-l7-traffic-path/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">Next Post &rarr;</span>
            <span class="text-align-right">L7 Traffic Path in Ambient Mesh</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="en"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  Related article
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/en/blog/understanding-the-tls-encryption-in-istio/">
            How Istio’s mTLS Traffic Encryption Works as Part of a Zero Trust Security Posture
          </a>
      </li>
    
      <li>
          <a href="/en/blog/cert-manager-spire-istio/">
            Managing Certificates in Istio with cert-manager and SPIRE
          </a>
      </li>
    
      <li>
          <a href="/en/blog/ambient-mesh-l7-traffic-path/">
            L7 Traffic Path in Ambient Mesh
          </a>
      </li>
    
      <li>
          <a href="/en/blog/what-is-tproxy/">
            How Istio&#39;s Ambient Mode Transparent Proxy - tproxy Works Under the Hood
          </a>
      </li>
    
      <li>
          <a href="/en/blog/distributed-tracing-with-skywalking-in-istio/">
            How to Use SkyWalking for Distributed Tracing in Istio?
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      Table of content
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-a-certificate">What Is a Certificate?</a></li>
    <li><a href="#how-to-generate-certificates">How to Generate Certificates</a></li>
    <li><a href="#certificate-trust-chain">Certificate Trust Chain</a></li>
    <li><a href="#how-to-incorporate-istio-into-the-pki-certificate-trust-chain">How to Incorporate Istio into the PKI Certificate Trust Chain</a></li>
    <li><a href="#steps-for-using-a-custom-ca-in-istio">Steps for Using a Custom CA in Istio</a></li>
    <li><a href="#process-for-istios-built-in-ca-to-issue-a-certificate">Process for Istio’s Built-in CA to Issue a Certificate</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">Contact</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s LinkedIn</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-linkedin.png" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Blog</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/istio-ambient-l7-flow-analysis/">Understanding L7 Traffic Management in Istio Ambient Mode: From ztunnel to Waypoint Proxy</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/envoy-ext-proc-guide/">Advanced Request and Response Processing in Microservice Architecture with Envoy&#39;s External Processing Filter</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/http2-envoy-tunnel-demo/">Implementing HTTP/2 CONNECT Tunnels with Envoy: Concepts and Practical Guide</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">links</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" >
                  Awesome Cloud Native
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://gateway.envoyproxy.io" target="_blank" rel="noopener noreferrer">
                  Envoy Gateway
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io" target="_blank" rel="noopener noreferrer">
                  Istio
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate - Service Mesh Company
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://docs.tetrate.io/istio-subscription/" target="_blank" rel="noopener noreferrer">
                  Tetrate Istio Subscription
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Courses</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener noreferrer">
                  Envoy Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener noreferrer">
                  Istio Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">new notice</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-china-2024-panel/">KubeCon China 2024 panel Preview: Istio and Modern API Gateways – Leading the Future of Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/website-revamp-notice/">Website Revamp Notice</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2025 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/en/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/en/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>






  





<script src="/js/wowchemy-search.min.ce03c611044441cf6e84f9e4bef20818.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
