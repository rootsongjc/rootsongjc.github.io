<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>Using Geneve Tunnels to Implement Istio Ambient Mesh Traffic Interception · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="This article introduces Geneve tunnels, a network virtualization protocol that can intercept Istio ambient mesh traffic more flexibly and securely than VXLAN. It also explains how Istio Ambient Mesh uses Geneve tunnels and the new eBPF mode in Istio 1.18.">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.123.7">

  <!-- CSS plugins -->
  
    
    <link rel="preload" href="/plugins/bootstrap/bootstrap.min.css" as="style">
    <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css" media="screen">
  
    
    <link rel="preload" href="/plugins/fontawesome/v6/css/fontawesome.min.css" as="style">
    <link rel="stylesheet" href="/plugins/fontawesome/v6/css/fontawesome.min.css" media="screen">
  
    
    <link rel="preload" href="/plugins/fontawesome/v6/css/all.min.css" as="style">
    <link rel="stylesheet" href="/plugins/fontawesome/v6/css/all.min.css" media="screen">
  
    
    <link rel="preload" href="/plugins/tocbot/tocbot.css" as="style">
    <link rel="stylesheet" href="/plugins/tocbot/tocbot.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.d278535039ce8ae56bc1d8c93393ad7717b945dd43b9340582c0aa680318711b.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.d278535039ce8ae56bc1d8c93393ad7717b945dd43b9340582c0aa680318711b.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/" />
  <meta property="og:title" content="Using Geneve Tunnels to Implement Istio Ambient Mesh Traffic Interception" />
  <meta property="twitter:title" content="Using Geneve Tunnels to Implement Istio Ambient Mesh Traffic Interception" />

  
  <meta property="og:description" content="This article introduces Geneve tunnels, a network virtualization protocol that can intercept Istio ambient mesh traffic more flexibly and securely than VXLAN. It also explains how Istio Ambient Mesh uses Geneve tunnels and the new eBPF mode in Istio 1.18." />
  <meta property="twitter:description" content="This article introduces Geneve tunnels, a network virtualization protocol that can intercept Istio ambient mesh traffic more flexibly and securely than VXLAN. It also explains how Istio Ambient Mesh uses Geneve tunnels and the new eBPF mode in Istio 1.18." />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/tunnel.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/tunnel.jpg" />

  
  
</head>
<body>
        <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>

<header class="fixed-top header">
  
  
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/book">Library</a>
              
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                Navigation
              </a>
              <div class="dropdown-menu">
                
                <a class="dropdown-item" href="/en/categories">Categories</a>
                
                <a class="dropdown-item" href="/en/tags">Tags</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="nav-link" href="/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/">中文</a>
            
            
            
            
            
            
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>Search</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>Search</p>
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="Close"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Input the keyword">
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    Using Geneve Tunnels to Implement Istio Ambient Mesh Traffic Interception
                </p>
                <p class="page-description">
                    This article introduces Geneve tunnels, a network virtualization protocol that can intercept Istio ambient mesh traffic more flexibly and securely than VXLAN. It also explains how Istio Ambient Mesh uses Geneve tunnels and the new eBPF mode in Istio 1.18.
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>May 29, 2023</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/en/categories/istio"> 
                        Istio</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>8 Minute</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>1749 words</li>
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content pt-4">
            
            <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-to-geneve-tunnels">Introduction to Geneve Tunnels</a>
      <ul>
        <li><a href="#geneve-vs-vxlan">Geneve vs. VXLAN</a></li>
        <li><a href="#how-it-works">How it Works</a></li>
        <li><a href="#security">Security</a></li>
      </ul>
    </li>
    <li><a href="#why-choose-geneve">Why Choose Geneve?</a></li>
    <li><a href="#how-istio-ambient-mesh-applies-geneve-tunnels">How Istio Ambient Mesh Applies Geneve Tunnels</a></li>
    <li><a href="#using-ebpf-for-transparent-traffic-interception">Using eBPF for Transparent Traffic Interception</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
</details>

            
            <p>In a previous<a href="/en/blog/ambient-mesh-l7-traffic-path/" title=" blog post"> blog post</a>
, I discussed how Istio Ambient Mesh uses iptables and Geneve tunnels to intercept traffic from application pods into Ztunnel. Many readers may not be familiar with this tunneling protocol, so this article will introduce the definition, packet structure and advantages of Geneve tunnels compared with the VXLAN protocol. Finally, this article will introduce how Istio Ambient Mesh applies Geneve tunnels to implement traffic interception and the new eBPF mode introduced in Istio 1.18.</p>
<h2 id="introduction-to-geneve-tunnels">Introduction to Geneve Tunnels</h2>
<p>In order to address the lack of flexibility and security in current data transmissions, the Geneve (Generic Network Virtualization Encapsulation) network virtualization encapsulation (tunneling) protocol was created. Geneve only defines a data encapsulation format, excluding control plane information. The key advantage of Geneve over VXLAN encapsulation is that it extends the types of encapsulated protocols by adding TLV format options.</p>
<h3 id="geneve-vs-vxlan">Geneve vs. VXLAN</h3>
<p>VXLAN and Geneve are both network virtualization protocols and they have many similarities. Virtualization protocols are technologies that separate virtual networks from physical networks. They allow network administrators to create multiple virtual networks in a virtual environment, each of which can have its own VLAN identifiers, IP addresses and routing. In addition, VXLAN and Geneve use UDP encapsulation, which enables them to be extended through existing network infrastructure. VXLAN and Geneve protocols are also flexible, can be used in different network topologies and are compatible with different virtualization platforms.</p>
<p>Figure 1 shows the message structure of VXLAN and Geneve tunnels and the differences in their respective headers.</p>
<figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/vxlan-vs-geneve.svg" data-img="/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/vxlan-vs-geneve.svg" alt="image" data-caption="Figure 1: VXLAN and Geneve packet format schematic diagram.">
    
  
  <figcaption>Figure 1: VXLAN and Geneve packet format schematic diagram.</figcaption>
</figure><p>From the figure, we can see that the message structure of VXLAN and Geneve tunneling protocols is similar, with the main difference being the use of different UDP port numbers and protocol headers. VXLAN uses port 4789, while Geneve uses port 6081. The Geneve protocol header is more extendable than VXLAN.</p>
<p>The Geneve tunneling protocol adds variable-length options that can contain zero or more option data in TLV format, making it more scalable than VXLAN. TLV stands for Type-Length-Value, which is a format for parsing and transmitting metadata in network packets. Each metadata information in the Geneve protocol is composed of a TLV format field, making it simple to flexibly add, delete and modify these metadata.</p>
<p>The TLV format field contains the following data:</p>
<ul>
<li>Type: 8-bit type field.</li>
<li>Length: 5-bit option length field, represented in multiples of 4 bytes, excluding the option header.</li>
<li>Data: Variable-length option data field, which may not exist or may be between 4 and 128 bytes.</li>
</ul>
<p>The Geneve protocol can easily modify and extend metadata information while maintaining compatibility and flexibility by using the TLV format.</p>
<p>Please refer to<a href="https://tools.ietf.org/html/rfc7348" title=" RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks" target="_blank" rel="noopener"> RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks</a>
 for more information about VXLAN. For more information about the Geneve tunnel packet format, please refer to<a href="https://www.rfc-editor.org/rfc/rfc8926#name-geneve-packet-format-over-i" title=" RFC 8926 Geneve: Generic Network Virtualization Encapsulation" target="_blank" rel="noopener"> RFC 8926 Geneve: Generic Network Virtualization Encapsulation</a>
.</p>
<h3 id="how-it-works">How it Works</h3>
<p>The Geneve tunnel is mainly used in cloud computing and virtualization scenarios, and it can encapsulate packets in a new packet for transmission in a virtual network. The Geneve tunnel uses a 24-bit VNI (Virtual Network Identifier) to transmit packets from one physical network to another. The Geneve tunnel can also use security protocols such as IPsec and TLS to protect the transmission of packets.</p>
<p>When a packet reaches the destination host, the Geneve tunnel protocol will de-encapsulate the packet from the Geneve protocol header and deliver it to the destination in the virtual network. During the de-encapsulation process, the VNI information in the Geneve protocol header is used to determine the destination of the packet, ensuring that the packet is correctly routed to the destination in the virtual network.</p>
<p>Assuming there is a virtual network with a VNI of 1001. When a packet is transmitted from one physical network to another, a tunnel can be used to track the packet during transmission by setting the VNI between the source and target physical networks to 1001. When the packet reaches the target physical network, the VNI is removed from the packet and the packet is delivered to the target physical network.</p>
<h3 id="security">Security</h3>
<p>The Geneve tunnel protocol itself does not provide any security mechanisms, so packets transmitted in the Geneve tunnel can be subject to threats such as packet tampering, interception and replay.</p>
<p>To ensure the security of packets transmitted in the Geneve tunnel, some security protocols can be used. The following are some common security protocols:</p>
<ol>
<li>IPsec (Internet Protocol Security): IPsec is a network layer security protocol that can encrypt, authenticate and provide integrity protection to packets in the Geneve tunnel. IPsec can provide end-to-end security.</li>
<li>TLS (Transport Layer Security): TLS is an encryption protocol based on the transport layer that can encrypt and authenticate packets in the Geneve tunnel. TLS can provide end-to-end security.</li>
<li>MACSec (Media Access Control Security): MACSec is a data link layer security protocol that can encrypt and authenticate packets in the Geneve tunnel. MACSec can provide link-layer security.</li>
</ol>
<p>It should be noted that the above security protocols require corresponding configuration and deployment and may have a certain impact on performance. When choosing the appropriate security protocol, factors such as security, performance, manageability and other aspects need to be considered.</p>
<h2 id="why-choose-geneve">Why Choose Geneve?</h2>
<p>The following table compares the characteristics of VXLAN and Geneve in multiple aspects.</p>
<table>
<thead>
<tr>
<th><strong>Feature</strong></th>
<th><strong>VXLAN</strong></th>
<th><strong>Geneve</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Header format</td>
<td>Fixed format</td>
<td>Extensible format</td>
</tr>
<tr>
<td>Scalability</td>
<td>More focused on L2 extension</td>
<td>Better support for emerging network services</td>
</tr>
<tr>
<td>Operability</td>
<td>Difficult to manage and extend</td>
<td>Easier to manage and extend</td>
</tr>
<tr>
<td>Performance</td>
<td>Shorter header, higher performance</td>
<td>Longer header, slightly lower performance</td>
</tr>
</tbody>
</table>
<p><strong>Table 1:</strong> <em>VXLAN vs Geneve characteristics</em>.</p>
<p>The main reason for using the Geneve protocol is to combine the advantages of current network virtualization encapsulation technologies (such as VXLAN, NVGRE and STT) into one protocol. Through years of network virtualization development experience, we know that one of the most important requirements is scalability. The Geneve protocol encodes metadata using an extensible TLV structure, so it can independently develop the functionality of software and hardware endpoints to meet growing needs.</p>
<h2 id="how-istio-ambient-mesh-applies-geneve-tunnels">How Istio Ambient Mesh Applies Geneve Tunnels</h2>
<p>In the<a href="https://tetrate.io/blog/transparent-traffic-intercepting-and-routing-in-the-l4-network-of-istio-ambient-mesh/" title=" previous blog" target="_blank" rel="noopener"> previous blog</a>
, I explained how Istio Ambient Mesh uses Ztunnel to implement L4 proxies and Figure 2 shows the L4 transparent traffic interception path using iptables and Geneve tunnels.</p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/geneve-tunnel.svg" data-img="/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/geneve-tunnel.svg" alt="image" data-caption="Figure 2: L4 Transparent Traffic Interception Path Using Iptables and Geneve Tunnels.">
    
  
  <figcaption>Figure 2: L4 Transparent Traffic Interception Path Using Iptables and Geneve Tunnels.</figcaption>
</figure>
From the figure, we can see that:</p>
<ul>
<li>The Istio CNI creates an <code>istioout</code> network card and iptables rules on the node, transparently intercepting the outbound traffic in the node to the <code>pistioout</code> virtual network card.</li>
<li>The Istio CNI creates an <code>istioin</code> network card and iptables rules on the node, transparently intercepting the inbound traffic in the node to the <code>pistioin</code> virtual network card.</li>
<li>The Istio CNI creates <code>pistioin</code> and <code>pistioout</code> network cards in ztunnel to receive data packets in the Geneve tunnel.</li>
</ul>
<p>The two network cards <code>pistioin</code> and <code>pistioout</code> are created by the init container or Istio CNI (see the <code>CreateRulesWithinNodeProxyNS</code> function in <a href="https://github.com/istio/istio/blob/master/cni/pkg/ambient/net_linux.go#L910" title="net_linux.go" target="_blank" rel="noopener">net_linux.go</a>
), and their IP addresses and ports are fixed. The data packets sent by the application container need to pass through the <code>istioout</code> network card and be forwarded to the ztunnel container after being encapsulated in the Geneve tunnel. When the data packets are received by the ztunnel container, they are de-encapsulated and forwarded to the corresponding application containers through the <code>pistioin</code> network card.</p>
<h2 id="using-ebpf-for-transparent-traffic-interception">Using eBPF for Transparent Traffic Interception</h2>
<p>eBPF (extended Berkeley Packet Filter) is a powerful technology that allows secure user-space programs to run within the Linux kernel. Initially developed as a technique for filtering network packets, eBPF has now been extended to other areas such as tracking system calls, performance analysis and security monitoring. The advantages of eBPF are its lightweight nature, efficiency, security and programmability. It can be used in real-time monitoring, network security, application debugging and optimization, container networking and various other fields.</p>
<p>Istio Ambient Mesh also supports using the eBPF (extended Berkeley Packet Filter) mode for transparent traffic interception since 1.18. As shown in Figure 3, the eBPF program runs directly in the host kernel and forwards application traffic to ztunnel. Compared to the iptables-based approach, the eBPF mode can provide better network efficiency and scalability. However, it requires a higher version of the Linux kernel and is more difficult to implement.</p>
<figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/ebpf.svg" data-img="/en/blog/traffic-interception-with-geneve-tunnel-with-istio-ambient-mesh/ebpf.svg" alt="image" data-caption="Figure 3: Intercepting the Traffic of Application Using eBPF.">
    
  
  <figcaption>Figure 3: Intercepting the Traffic of Application Using eBPF.</figcaption>
</figure><p>To use the eBPF mode to run Ambient Mesh, simply set the <code>values.cni.ambient.redirectMode</code> parameter to “ebpf” when installing Istio, as shown below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">istioctl install --set <span class="nv">profile</span><span class="o">=</span>ambient --set values.cni.ambient.redirectMode<span class="o">=</span><span class="s2">&#34;ebpf&#34;</span>
</span></span></code></pre></div><h2 id="summary">Summary</h2>
<p>This article introduced the working principle, security and comparison with VXLAN of the Geneve tunnel protocol. In addition, it also introduced how Istio Ambient Mesh uses Geneve tunnels to implement traffic interception and discussed the advantages and disadvantages of using eBPF for transparent traffic interception. The Geneve tunnel protocol is a universal tunneling protocol that can transmit packets in virtual networks, and it has more advantages than other tunneling protocols. Therefore, when choosing a tunneling protocol, users can consider using the Geneve tunnel. In Istio 1.18, the eBPF mode of Ambient Mesh is newly introduced, which can provide better network efficiency, but has higher requirements for the Linux kernel version. Users can choose according to their actual situation.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7348" title="RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks" target="_blank" rel="noopener">RFC 7348 Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks</a>
</li>
<li><a href="https://www.rfc-editor.org/rfc/rfc8926#name-geneve-packet-format-over-i" title="RFC 8926 Geneve: Generic Network Virtualization Encapsulation" target="_blank" rel="noopener">RFC 8926 Geneve: Generic Network Virtualization Encapsulation</a>
</li>
<li><a href="https://istio.io/latest/docs/ops/deployment/architecture/#istio-ambient-mesh" title="Istio Ambient Mesh" target="_blank" rel="noopener">Istio Ambient Mesh</a>
</li>
<li><a href="https://www.mankier.com/8/ovs-vswitchd.conf.db%285%29" title="Open vSwitch Geneve(8) man page" target="_blank" rel="noopener">Open vSwitch Geneve(8) man page</a>
</li>
</ul>
<hr>
<p>If you’re new to service mesh and Kubernetes security, we have a bunch of free online courses <a href="https://tetr8.io/academy" title="available at Tetrate Academy" target="_blank" rel="noopener">available at Tetrate Academy</a>
 that will quickly get you up to speed with Istio and Envoy.</p>
<p>If you’re looking for a fast way to get to production with Istio, check out <a href="https://tetr8.io/tid" title="Tetrate Istio Distribution (TID)" target="_blank" rel="noopener">Tetrate Istio Distribution (TID)</a>
 . TID is Tetrate’s hardened, fully upstream Istio distribution, with FIPS-verified builds and support available. It’s a great way to get started with Istio knowing you have a trusted distribution to begin with, have an expert team supporting you, and also have the option to get to FIPS compliance quickly if you need to.Once you have Istio up and running, you will probably need simpler ways to manage and secure your services beyond what’s available in Istio, that’s where Tetrate Service Bridge comes in. You can learn more about how Tetrate Service Bridge makes service mesh more secure, manageable, and resilient <a href="https://tetr8.io/tsb" title="here" target="_blank" rel="noopener">here</a>
 , or <a href="https://tetr8.io/contact" title="contact us for a quick demo" target="_blank" rel="noopener">contact us for a quick demo</a>
 .</p>
<p><em>This blog was originally published at <a href="https://tetrate.io/blog/using-geneve-tunnels-to-implement-istio-ambient-mesh-traffic-interception/" title="tetrate.io" target="_blank" rel="noopener">tetrate.io</a>
.</em></p>

            <div class="border-bottom mb-2"></div>
          </div>

          <div class="col-12">
            <p>Last updated on May 24, 2024</p>
            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/en/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/en/tags/tproxy" class="badge">  
                  Tproxy</a> 
              <a href="/en/tags/ambient" class="badge">  
                  Ambient</a> 
              <a href="/en/tags/proxy" class="badge">  
                  Proxy</a> 
              <a href="/en/tags/geneve" class="badge">  
                  Geneve</a> </div>
          </div>

          
          <div class="col-12">
            
<ul class="pager blog-pager d-flex justify-content-between">
    
    <li class="previous">
        <a href="https://jimmysong.io/en/blog/envoy-gateway-customization/" data-toggle="tooltip" data-placement="top" title="Envoy Gateway 0.4.0: Extending the API for Customization">&larr; Previous Post</a>
    </li>
    
    
    <li class="next">
        <a href="https://jimmysong.io/en/blog/istio-1-18-released-now-with-ambient-mode-available/" data-toggle="tooltip" data-placement="top" title="Istio 1.18 Released, Now with Ambient Mode Available">Next Post &rarr;</a>
    </li>
    
</ul>
          </div>

          
          
          <div class="col-12">
          
          </div>
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 mb-4 pt-4 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          





<div>
  <p class="related-sidebar-title">
  Related article
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/en/blog/what-is-tproxy/">
            How Istio&#39;s Ambient Mode Transparent Proxy - tproxy Works Under the Hood
          </a>
      </li>
    
      <li>
          <a href="/en/blog/ambient-mesh-l7-traffic-path/">
            L7 Traffic Path in Ambient Mesh
          </a>
      </li>
    
      <li>
          <a href="/en/blog/understanding-the-tls-encryption-in-istio/">
            How Istio’s mTLS Traffic Encryption Works as Part of a Zero Trust Security Posture
          </a>
      </li>
    
      <li>
          <a href="/en/blog/ambient-mesh-l4-traffic-path/">
            Transparent Traffic Intercepting and Routing in the L4 Network of Istio Ambient Mesh
          </a>
      </li>
    
      <li>
          <a href="/en/blog/cert-manager-spire-istio/">
            Managing Certificates in Istio with cert-manager and SPIRE
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white mb-4 sticky-top aside-toc">
    <p class="toc-sidebar-title">
      Table of content
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-to-geneve-tunnels">Introduction to Geneve Tunnels</a>
      <ul>
        <li><a href="#geneve-vs-vxlan">Geneve vs. VXLAN</a></li>
        <li><a href="#how-it-works">How it Works</a></li>
        <li><a href="#security">Security</a></li>
      </ul>
    </li>
    <li><a href="#why-choose-geneve">Why Choose Geneve?</a></li>
    <li><a href="#how-istio-ambient-mesh-applies-geneve-tunnels">How Istio Ambient Mesh Applies Geneve Tunnels</a></li>
    <li><a href="#using-ebpf-for-transparent-traffic-interception">Using eBPF for Transparent Traffic Interception</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>



        
        

<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h4 text-white mb-4 text-uppercase">Contact</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s LinkedIn</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-linkedin.png" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">Blog</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/istio-cni-deep-dive/">Istio CNI Unveiled: Streamlining Service Mesh Connectivity</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/cni-deep-dive/">CNI Essentials: Powering Kubernetes&#39; Network</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/envoy-gateway-introduction/">Envoy Gateway Overview: Modern Kubernetes Ingress with Envoy Gateway and the Gateway API</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">links</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" >
                  Awesome Cloud Native
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://gateway.envoyproxy.io" target="_blank" rel="noopener noreferrer">
                  Envoy Gateway
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io" target="_blank" rel="noopener noreferrer">
                  Istio
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate - Service Mesh Company
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://docs.tetrate.io/istio-subscription/" target="_blank" rel="noopener noreferrer">
                  Tetrate Istio Subscription
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">Courses</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener noreferrer">
                  Envoy Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener noreferrer">
                  Istio Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h4 text-white mb-4 text-uppercase">new notice</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/website-revamp-notice/">Website Revamp Notice</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/cloud-native-public-library/">Announcement of Cloud Native Library</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
                <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" rel="noopener">
                    <i class="fa-brands fa-x-twitter text-white"></i>
                </a>
            </li>
            
            <li class="list-inline-item">
                <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" rel="noopener">
                    <i class="fa-brands fa-github text-white"></i>
                </a>
            </li>
            
            <li class="list-inline-item">
                <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" rel="noopener">
                    <i class="fa-brands fa-linkedin text-white"></i>
                </a>
            </li>
            
            <li class="list-inline-item">
                <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" target="_blank" rel="noopener">
                    <i class="fa-solid fa-envelope text-white"></i>
                </a>
            </li>
            
            <li class="list-inline-item">
                <a class="d-inline-block p-2" href="/blog/index.xml" target="_blank" rel="noopener">
                    <i class="fa-solid fa-rss text-white"></i>
                </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.7431d6492f52b1e2a316a5581a7f0c113dfac948432c740f68d54e57f57a6b51.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>






  





<script src="/js/wowchemy-search.min.2321042540b0e0bb5f51ad693f2dbdbe.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var notificationEnabled =  true ;
        var showOnMobile =  true ;
        
        function isMobile() {
            return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        }

        if (notificationEnabled && (!isMobile() || showOnMobile)) {
            var notificationKey = 'hasSeenNotification';
            var notificationExpiryKey = 'notificationExpiry';
            var notificationExpiryDuration =  24  * 60 * 60 * 1000;  

            var hasSeenNotification = localStorage.getItem(notificationKey);
            var notificationExpiry = localStorage.getItem(notificationExpiryKey);
            var currentTime = new Date().getTime();

            if (!hasSeenNotification || currentTime > notificationExpiry) {
                var notificationMessage = 'Click for details.';
                var notificationTitle = 'Website Revamp Notice';
                var notificationType = 'info';
                var notificationPositionClass = 'toast-bottom-left';
                var notificationShowDuration =  300 ;
                var notificationHideDuration =  1000 ;
                var notificationTimeOut =  5000 ;
                var notificationExtendedTimeOut =  1000 ;
                var enableClickRedirect =  true ;
                var redirectUrl = "\/en\/notice\/website-revamp-notice\/";

                toastr.options = {
                    "closeButton": true,
                    "progressBar": true,
                    "positionClass": notificationPositionClass,
                    "showDuration": notificationShowDuration,
                    "hideDuration": notificationHideDuration,
                    "timeOut": notificationTimeOut,
                    "extendedTimeOut": notificationExtendedTimeOut,
                    "preventDuplicates": true,  
                    "onclick": enableClickRedirect ? function() { window.location.href = redirectUrl; } : null
                };

                if (notificationMessage) {
                    toastr[notificationType](notificationMessage, notificationTitle);
                }

                
                localStorage.setItem(notificationKey, 'true');
                localStorage.setItem(notificationExpiryKey, currentTime + notificationExpiryDuration);
            }
        }
    });
</script>

    </body>
</html>
