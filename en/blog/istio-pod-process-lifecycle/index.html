<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>Istio Data Plane Pod Startup Process Explained · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This article will explain Istio&#39;s Init container, Pod internal processes and the startup process.">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.105.0">

  <!-- plugins -->
  
  <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/plugins/slick/slick.css">
  
  <link rel="stylesheet" href="/plugins/animate/animate.css">
  
  <link rel="stylesheet" href="/plugins/venobox/venobox.css">
  
  <link rel="stylesheet" href="/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/plugins/hightlight/syntax.css">
  
  <link rel="stylesheet" href="/plugins/fontawesome/font-awesome.min.css">
  
  <link rel="stylesheet" href="/plugins/tocbot/tocbot.css">
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/scss/style.css" media="screen">

  <!--Favicon-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="57x57" href="images/favicon-57.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="images/favicon-72.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="images/favicon-114.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="images/favicon-144.png" />

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  
  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/istio-pod-process-lifecycle/" />
  <meta property="og:title" content="Istio Data Plane Pod Startup Process Explained" />
  <meta property="twitter:title" content="Istio Data Plane Pod Startup Process Explained" />
  
  <meta property="og:description" content="This article will explain Istio&#39;s Init container, Pod internal processes and the startup process." />
  <meta property="twitter:description" content="This article will explain Istio&#39;s Init container, Pod internal processes and the startup process." />
  
  
  <meta property="og:image" content="https://jimmysong.io/images/banner/istio-pod-process-lifecycle.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/istio-pod-process-lifecycle.jpg" />
  
  
  
</head>
<body>
    <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>

<header class="fixed-top header">
  
  
  <div class="top-header py-2 bg-white">
    <div class="container">
      <div class="row no-gutters align-items-center">
        <div class="col-12 text-center">
          <ul class="list-inline">
            <li class="list-inline-item">
                <a href="https://bit.ly/3Vqrlfw" title="Download the eBook: The Current State and Future of the Istio Service Mesh" target="_blank" rel="noopener">Download the eBook: The Current State and Future of the Istio Service Mesh</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  
  <div class="navigation w-100  top-hider ">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en"><img class="img-fluid" width="200px"
            src="/images/logo.svg" alt="Jimmy Song&#39;s blog"></a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="https://lib.jimmysong.io" target="_blank" rel="noopener">Book</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="nav-link" href="/blog/istio-pod-process-lifecycle/">中文</a>
            
            
            
            
            
            
          </li>
          
          
          <!-- search -->
          <button id="searchOpen" class="search-btn js-search"><i class="fa fa-search text-dark"></i></button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


    <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>Search</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fa fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        <i class="fa fa-search" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Input the keyword">
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>

    
	
	
<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/page-title.webp'),url('/images/backgrounds/page-title.webp');">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <ul class="list-inline custom-breadcrumb">
                    <li class="list-inline-item h2"><a class="text-white font-secondary" href="/en/blog">
            
            
              
              Blogs
              
            
          </a></li>
                    <li class="list-inline-item"><i class="ti-angle-right text-white"></i></li>
                    <li class="list-inline-item text-white h3 font-secondary">Istio Data Plane Pod Startup Process Explained</li>
                </ul>
                <p class="text-white">This article will explain Istio&rsquo;s Init container, Pod internal processes and the startup process.</p>
            </div>
        </div>
    </div>
</section>

	


<section class="section-sm">
  <div class="container blog">
    <div class="row">
      <div class="col-lg-8 article-content">
        <div class="row">
          <div class="col-12">
            <ul class="list-inline">
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Date
                  :</span>May 12, 2022</li>

              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Category
                  :</span><a
                  href="/en/categories/istio"> 
                  Istio</a> </li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Word Count
                  :</span>1920 words</li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Reading Time
                  :</span>9 Minute</li>
            </ul>
          </div>
          
          <div class="col-12 my-4">
            <div class="border-bottom"></div>
          </div>
          
          <div class="col-12 content">
            
            <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#sidecar-injection-in-istio">Sidecar injection in Istio</a>
      <ul>
        <li><a href="#init-container">Init container</a></li>
      </ul>
    </li>
    <li><a href="#sidecar-injection-example-analysis">Sidecar injection example analysis</a></li>
    <li><a href="#init-container-analysis">Init container analysis</a>
      <ul>
        <li><a href="#init-container-initiation">Init container initiation</a></li>
      </ul>
    </li>
    <li><a href="#pod-startup-sequence">Pod Startup Sequence</a></li>
    <li><a href="#pod-container-startup-order-problem">Pod container startup order problem</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
</details>

            
            <p>This article will explain:</p>
<ul>
<li>The sidecar auto-injection process in Istio</li>
<li>The init container startup process in Istio</li>
<li>The startup process of a Pod with Sidecar auto-injection enabled</li>
</ul>
<p>The following figure shows the components of a Pod in the Istio data plane after it has been started.</p>
<p><figure class="mx-auto text-center">
  
  
  
  
    
    <img src="/en/blog/istio-pod-process-lifecycle/istio-pod-lifecycle.jpg" data-img="/en/blog/istio-pod-process-lifecycle/istio-pod-lifecycle.jpg" data-width="1200" data-height="813" alt="image" data-caption="Istio data plane pod">
    
  
  <figcaption>Istio data plane pod</figcaption>
</figure>
</p>
<h2 id="sidecar-injection-in-istio">Sidecar injection in Istio</h2>
<p>The following two sidecar injection methods are available in Istio.</p>
<ul>
<li>Manual injection using <code>istioctl</code>.</li>
<li>Kubernetes-based <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" title="mutating webhook admission controller" target="_blank" rel="noopener">mutating webhook admission controller</a>
 automatic sidecar injection method.</li>
</ul>
<p>Whether injected manually or automatically, SIDECAR&rsquo;s injection process follows the following steps.</p>
<ol>
<li>Kubernetes needs to know the Istio cluster to which the sidecar to be injected is connected and its configuration.</li>
<li>Kubernetes needs to know the configuration of the sidecar container itself to be injected, such as the image address, boot parameters, etc.</li>
<li>Kubernetes injects the above configuration into the side of the application container by the sidecar injection template and the configuration parameters of the above configuration-filled sidecar.</li>
</ol>
<p>The sidecar can be injected manually using the following command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">istioctl kube-inject -f <span class="si">${</span><span class="nv">YAML_FILE</span><span class="si">}</span> <span class="p">|</span> kuebectl apply -f -
</span></span></code></pre></div><p>This command is injected using Istio&rsquo;s built-in sidecar configuration, see the <a href="https://istio.io" title="Istio official website" target="_blank" rel="noopener">Istio official website</a>
 for details on how to use Istio below.</p>
<p>When the injection is complete you will see that Istio has injected initContainer and sidecar proxy-related configurations into the original pod template.</p>
<h3 id="init-container">Init container</h3>
<p>The Init container is a dedicated container that runs before the application container is launched and is used to contain some utilities or installation scripts that do not exist in the application image.</p>
<p>Multiple Init containers can be specified in a Pod, and if more than one is specified, the Init containers will run sequentially. The next Init container can only be run if the previous Init container must run successfully. Kubernetes only initializes the Pod and runs the application container when all the Init containers have been run.</p>
<p>The Init container uses Linux Namespace, so it has a different view of the file system than the application container. As a result, they can have access to Secret in a way that application containers cannot.</p>
<p>During Pod startup, the Init container starts sequentially after the network and data volumes are initialized. Each container must be successfully exited before the next container can be started. If exiting due to an error will result in a container startup failure, it will retry according to the policy specified in the Pod&rsquo;s restartPolicy. However, if the Pod&rsquo;s restartPolicy is set to Always, the restartPolicy is used when the Init container failed.</p>
<p>The Pod will not become Ready until all Init containers are successful. The ports of the Init containers will not be aggregated in the Service. The Pod that is being initialized is in the Pending state but should set the Initializing state to true. The Init container will automatically terminate once it is run.</p>
<h2 id="sidecar-injection-example-analysis">Sidecar injection example analysis</h2>
<p>For a detailed YAML configuration for the bookinfo applications, see <code>bookinfo.yaml</code> for the official Istio YAML of productpage in the bookinfo sample.</p>
<p>The following will be explained in the following terms.</p>
<ul>
<li>Injection of Sidecar containers</li>
<li>Creation of iptables rules</li>
<li>The detailed process of routing</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">productpage-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">productpage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">productpage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">productpage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">bookinfo-productpage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">productpage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/istio/examples-bookinfo-productpage-v1:1.15.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">9080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span></code></pre></div><p>Let&rsquo;s see the <code>productpage</code> container’s <a href="https://github.com/istio/istio/blob/master/samples/bookinfo/src/productpage/Dockerfile" title="Dockerfile" target="_blank" rel="noopener">Dockerfile</a>
.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> python:3.7.4-slim</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> requirements.txt ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> pip install --no-cache-dir -r requirements.txt<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> test-requirements.txt ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> pip install --no-cache-dir -r test-requirements.txt<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> productpage.py /opt/microservices/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> tests/unit/* /opt/microservices/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> templates /opt/microservices/templates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> static /opt/microservices/static<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> requirements.txt /opt/microservices/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> flood_factor<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> FLOOD_FACTOR <span class="si">${</span><span class="nv">flood_factor</span><span class="k">:-</span><span class="nv">0</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 9080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /opt/microservices</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m unittest discover<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> 1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;productpage.py&#34;</span><span class="p">,</span> <span class="s2">&#34;9080&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>We see that <code>ENTRYPOINT</code> is not configured in Dockerfile, so <code>CMD</code>’s configuration <code>python productpage.py 9080</code> will be the default <code>ENTRYPOINT</code>, keep that in mind and look at the configuration after the sidecar injection.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml
</span></span></code></pre></div><p>We intercept only a portion of the YAML configuration that is part of the Deployment configuration associated with productpage.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/istio/examples-bookinfo-productpage-v1:1.15.0</span><span class="w"> </span><span class="c"># application image</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">productpage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">9080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">sidecar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">$(POD_NAMESPACE).svc.cluster.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">configPath</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">/etc/istio/proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">binaryPath</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">/usr/local/bin/envoy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">serviceCluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">productpage.$(POD_NAMESPACE)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">drainDuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">45s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">parentShutdownDuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">1m0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">discoveryAddress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">istiod.istio-system.svc:15012</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">zipkinAddress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">zipkin.istio-system:9411</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">proxyLogLevel=warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">proxyComponentLogLevel=misc:error</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">connectTimeout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">10s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">proxyAdminPort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;15000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">concurrency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">controlPlaneAuthPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">NONE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">dnsRefreshRate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">300s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">statusPort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;15020&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">trust-domain=cluster.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">controlPlaneBootstrap=false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/istio/proxyv2:1.5.1</span><span class="w"> </span><span class="c"># sidecar proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">istio-proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">15090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http-envoy-prom</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initContainers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">istio-iptables</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;15001&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;15006&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;1337&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">REDIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">i</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;*&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">x</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;*&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">15090</span><span class="p">,</span><span class="m">15020</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/istio/proxyv2:1.5.1</span><span class="w"> </span><span class="c"># init container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">istio-init</span><span class="w">
</span></span></span></code></pre></div><p>Istio&rsquo;s configuration for application Pod injection mainly includes:</p>
<ul>
<li>Init container <code>istio-init</code>: for setting iptables port forwarding in the pod</li>
<li>Sidecar container <code>istio-proxy</code>: running a sidecar proxy, such as Envoy or MOSN</li>
</ul>
<p>The two containers will be parsed separately.</p>
<h2 id="init-container-analysis">Init container analysis</h2>
<p>The Init container that Istio injects into the pod is named <code>istio-init</code>, and we see in the YAML file above after Istio&rsquo;s injection is complete that the init command for this container is.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">istio-iptables -p <span class="m">15001</span> -z <span class="m">15006</span> -u <span class="m">1337</span> -m REDIRECT -i <span class="s1">&#39;*&#39;</span> -x <span class="s2">&#34;&#34;</span> -b <span class="s1">&#39;*&#39;</span> -d 15090,15020
</span></span></code></pre></div><p>Let&rsquo;s check the container&rsquo;s Dockerfile again to see how <code>ENTRYPOINT</code> determines what commands are executed at startup.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="line"><span class="cl"><span class="c"># ommit</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># The pilot-agent will bootstrap Envoy.</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;/usr/local/bin/pilot-agent&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>We see that the entrypoint of the <code>istio-init</code> container is the <code>/usr/local/bin/istio-iptables</code> command line, and the location of the code for this command-line tool is in the <code>tools/istio-iptables</code> directory of the Istio source code repository.</p>
<h3 id="init-container-initiation">Init container initiation</h3>
<p>The Init container&rsquo;s entrypoint is the <code>istio-iptables</code> command line, which is used as follows.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Usage:
</span></span><span class="line"><span class="cl">  istio-iptables <span class="o">[</span>flags<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flags:
</span></span><span class="line"><span class="cl">  -n, --dry-run                                     Do not call any external dependencies like iptables
</span></span><span class="line"><span class="cl">  -p, --envoy-port string                           Specify the envoy port to which redirect all TCP traffic <span class="o">(</span>default <span class="nv">$ENVOY_PORT</span> <span class="o">=</span> 15001<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -h, --help                                        <span class="nb">help</span> <span class="k">for</span> istio-iptables
</span></span><span class="line"><span class="cl">  -z, --inbound-capture-port string                 Port to which all inbound TCP traffic to the pod/VM should be redirected to <span class="o">(</span>default <span class="nv">$INBOUND_CAPTURE_PORT</span> <span class="o">=</span> 15006<span class="o">)</span>
</span></span><span class="line"><span class="cl">      --iptables-probe-port string                  <span class="nb">set</span> listen port <span class="k">for</span> failure detection <span class="o">(</span>default <span class="s2">&#34;15002&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  -m, --istio-inbound-interception-mode string      The mode used to redirect inbound connections to Envoy, either <span class="s2">&#34;REDIRECT&#34;</span> or <span class="s2">&#34;TPROXY&#34;</span>
</span></span><span class="line"><span class="cl">  -b, --istio-inbound-ports string                  Comma separated list of inbound ports <span class="k">for</span> which traffic is to be redirected to Envoy <span class="o">(</span>optional<span class="o">)</span>. The wildcard character <span class="s2">&#34;*&#34;</span> can be used to configure redirection <span class="k">for</span> all ports. An empty list will disable
</span></span><span class="line"><span class="cl">  -t, --istio-inbound-tproxy-mark string
</span></span><span class="line"><span class="cl">  -r, --istio-inbound-tproxy-route-table string
</span></span><span class="line"><span class="cl">  -d, --istio-local-exclude-ports string            Comma separated list of inbound ports to be excluded from redirection to Envoy <span class="o">(</span>optional<span class="o">)</span>. Only applies  when all inbound traffic <span class="o">(</span>i.e. <span class="s2">&#34;*&#34;</span><span class="o">)</span> is being redirected <span class="o">(</span>default to <span class="nv">$ISTIO_LOCAL_EXCLUDE_PORTS</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  -o, --istio-local-outbound-ports-exclude string   Comma separated list of outbound ports to be excluded from redirection to Envoy
</span></span><span class="line"><span class="cl">  -i, --istio-service-cidr string                   Comma separated list of IP ranges in CIDR form to redirect to envoy <span class="o">(</span>optional<span class="o">)</span>. The wildcard character <span class="s2">&#34;*&#34;</span> can be used to redirect all outbound traffic. An empty list will disable all outbound
</span></span><span class="line"><span class="cl">  -x, --istio-service-exclude-cidr string           Comma separated list of IP ranges in CIDR form to be excluded from redirection. Only applies when all  outbound traffic <span class="o">(</span>i.e. <span class="s2">&#34;*&#34;</span><span class="o">)</span> is being redirected <span class="o">(</span>default to <span class="nv">$ISTIO_SERVICE_EXCLUDE_CIDR</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  -k, --kube-virt-interfaces string                 Comma separated list of virtual interfaces whose inbound traffic <span class="o">(</span>from VM<span class="o">)</span> will be treated as outbound
</span></span><span class="line"><span class="cl">      --probe-timeout duration                      failure detection timeout <span class="o">(</span>default 5s<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -g, --proxy-gid string                            Specify the GID of the user <span class="k">for</span> which the redirection is not applied. <span class="o">(</span>same default value as -u param<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -u, --proxy-uid string                            Specify the UID of the user <span class="k">for</span> which the redirection is not applied. Typically, this is the UID of the proxy container
</span></span><span class="line"><span class="cl">  -f, --restore-format                              Print iptables rules in iptables-restore interpretable format <span class="o">(</span>default <span class="nb">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      --run-validation                              Validate iptables
</span></span><span class="line"><span class="cl">      --skip-rule-apply                             Skip iptables apply
</span></span></code></pre></div><p>The above incoming parameters are reassembled into iptables rules. For more information on how to use this command, visit <code>tools/istio-iptables/pkg/cmd/root.go</code>.</p>
<p>The significance of the container&rsquo;s existence is that it allows the sidecar agent to intercept all inbound and outbound traffic to the pod, redirect all inbound traffic to port 15006 (sidecar) except port 15090 (used by Prometheus) and port 15092 (Ingress Gateway), and then intercept outbound traffic from the application container which is processed by sidecar (listening through port 15001) and then outbound. See the <a href="https://istio.io/docs/ops/deployment/requirements/" title="official Istio documentation" target="_blank" rel="noopener">official Istio documentation</a>
 for port usage in Istio.</p>
<p><strong>Command analysis</strong></p>
<p>Here is the purpose of this start-up command.</p>
<ul>
<li>Forward all traffic from the application container to port 15006 of the sidecar.</li>
<li>Run with the <code>istio-proxy</code> user identity, with a UID of 1337, the userspace where the sidecar is located, which is the default user used by the <code>istio-proxy</code> container, see the runAsUser field of the YAML configuration.</li>
<li>Use the default REDIRECT mode to redirect traffic.</li>
<li>Redirect all outbound traffic to the sidecar proxy (via port 15001).</li>
</ul>
<p>Because the Init container is automatically terminated after initialization, since we cannot log into the container to view the iptables information, the Init container initialization results are retained in the application container and sidecar container.</p>
<h2 id="pod-startup-sequence">Pod Startup Sequence</h2>
<p>The startup process of a Pod with Sidecar auto-injection enabled is as follows.</p>
<ol>
<li>The Init container starts first, injecting iptables rules into the Pod for transparent traffic interception.</li>
<li>Subsequently, Kubernetes starts the containers in the order in which they are declared in the Pod Spec, but this is non-blocking and there is no guarantee that the first container will be started before the next one is started. <code>istio-proxy</code> container starts, <code>pilot-agent</code> will be the PID 1 process, which is the first process in the Linux user space and is responsible for pulling up other processes and handling zombie processes. The <code>pilot-agent</code> generates the Envoy bootstrap configuration and fork the envoy process; the application container is started almost simultaneously with the <code>istio-proxy</code> container, and the readiness probe comes in handy to prevent the container inside the Pod from receiving outside traffic before it is ready to start. Kubernetes will perform a readiness check on port 15021 of the <code>istio-proxy</code> container, and the <code>kubelet</code> will not route traffic to the Pod until the <code>isito-proxy</code> has finished booting.</li>
<li>After the Pod is started, the <code>pilot-agent</code> becomes a daemon that monitors the rest of the system and provides Envoy with Bootstrap configuration, certificates, health checks, configuration hot reloading, identity support, and process lifecycle management, among other things.</li>
</ol>
<h2 id="pod-container-startup-order-problem">Pod container startup order problem</h2>
<p>In the process of Pod startup there is a container startup order problem. Suppose the following situation, the application container starts first and requests other services, when the <code>istio-proxy</code> container has not finished starting, then the request will fail, and if your application is not robust enough, it may even cause the application container to crash and the Pod to restart. The solution for this situation is to</p>
<ul>
<li>Modify the application to add timeout retries.</li>
<li>Increase the start delay of the process in the application container, for example by increasing the sleep time.</li>
<li>Add a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/" title="postStart" target="_blank" rel="noopener">postStart</a>
 configuration to the application container to detect if the application process has finished starting, and Kubernetes will only mark the Pod&rsquo;s state as <code>Running</code> if the detection is successful.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>This article walks you through the process of starting Pods in the Istio data plane, and the issues that arise because of the order in which Pod contenters are started.</p>

          </div>

          <div class="col-12 mb-4">
            <div class="border-bottom">
            


<p class="edit-page">
<a href="https://github.com/rootsongjc/website/edit/master/content/en/blog/istio-pod-process-lifecycle/index.md">
  <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page
  </a>
</p>


            </div>
          </div>
          
          <div class="col-12">
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light">
              
              <a href="/en/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/en/tags/sidecar" class="badge">  
                  Sidecar</a> </li>
          </div>

          
          
<div class="col-12">
<ul class="pager blog-pager">

<li class="previous">
<a href="https://jimmysong.io/en/blog/understanding-iptables/" data-toggle="tooltip" data-placement="top" title="Understanding IPTables">&larr; Previous Post</a>
</li>
 
<li class="next">
<a href="https://jimmysong.io/en/blog/sidecar-injection-iptables-and-traffic-routing/" data-toggle="tooltip" data-placement="top" title="Understanding the Sidecar Injection, Traffic Intercepting &amp; Routing Process in Istio">Next Post &rarr;</a>
</li>

</ul>
</div>


          
          
          <div class="col-12">
          
           <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="en"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

          
          </div>
        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 sidebar">
      <!-- recommend -->
      

<div class="bg-white md-4">
  <p class="sidebar-title">
  Related article
  </p>
  <!-- post-item -->
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <a href="/en/blog/istio-components-and-ports/"><img class="mr-3 post-thumb-sm" src="/images/banner/istio-ports.jpg" alt="blog banner"></a>
    <div class="media-body">
      <a href="/en/blog/istio-components-and-ports/">
        <p class="mt-0">Istio Component Ports and Functions in Details</p>
      </a>
      May 8, 2022
    </div>
  </div>
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <a href="/en/blog/istio-sidecar-traffic-types/"><img class="mr-3 post-thumb-sm" src="/images/banner/mirror.jpg" alt="blog banner"></a>
    <div class="media-body">
      <a href="/en/blog/istio-sidecar-traffic-types/">
        <p class="mt-0">Traffic Types and Iptables Rules in Istio Sidecar Explained</p>
      </a>
      May 7, 2022
    </div>
  </div>
  
  <div class="media border-bottom border-color pb-3 mb-3">
    <a href="/en/blog/what-is-new-in-istio-1-13/"><img class="mr-3 post-thumb-sm" src="/images/banner/istio-113.jpg" alt="blog banner"></a>
    <div class="media-body">
      <a href="/en/blog/what-is-new-in-istio-1-13/">
        <p class="mt-0">What&#39;s New in Istio 1.13?</p>
      </a>
      March 28, 2022
    </div>
  </div>
  
</div>


      <!-- /recommend -->
      <!-- toc -->
      
<div class="bg-white py-4 box-shadow mb-4 sticky-top aside-toc d-none d-sm-block">
    <p class="sidebar-title">
    Table of content
    </p>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#sidecar-injection-in-istio">Sidecar injection in Istio</a>
      <ul>
        <li><a href="#init-container">Init container</a></li>
      </ul>
    </li>
    <li><a href="#sidecar-injection-example-analysis">Sidecar injection example analysis</a></li>
    <li><a href="#init-container-analysis">Init container analysis</a>
      <ul>
        <li><a href="#init-container-initiation">Init container initiation</a></li>
      </ul>
    </li>
    <li><a href="#pod-startup-sequence">Pod Startup Sequence</a></li>
    <li><a href="#pod-container-startup-order-problem">Pod container startup order problem</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
</div>

      <!-- /toc -->
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>



      
    

<footer>
  
  <div class="footer bg-footer section-sm border-bottom">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-sm-8 mb-5 mb-lg-0">
          
          <h4 class="text-white mb-5 text-uppercase">Follow Me</h4>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Fellow me on twitter</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-twitter-qr-code.webp" width="128px" alt="footer image"></li>
            
            
            
          
        </div>
        
        

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">Blog</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/ambient-mesh-l4-traffic-path/">Transparent Traffic Intercepting and Routing in the L4 Network of Istio Ambient Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/the-future-of-istio/">The Future of Istio: the Path to Zero Trust Security</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/why-gateway-api-is-the-future-of-ingress-and-mesh/">Why the Gateway API Is the Unified Future of Ingress for Kubernetes and Service Mesh</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">links</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/awesome-cloud-native/" target="_blank" rel="noopener">Awesome Cloud Native</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://cloudnative.to" target="_blank" rel="noopener">Cloud Native Community(China)</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener">Tetrate - Service Mesh Company</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://istio.tetratelabs.io/" target="_blank" rel="noopener">Tetrate Istio Distro</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">Courses</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener">Envoy Fundamentals</a></li>
            
            <li class="mb-3"><a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener">Istio Fundamentals</a></li>
            
          </ul>
        </div>

        
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0">
          <h4 class="text-white mb-5 text-uppercase">new notice</h4>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/cloud-native-public-library/">Cloud Native library launch</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/tetrate-recruit/">The Enterprise Service Mesh company Tetrate is hiring</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/tetrate-istio-fundamental-courses/">Tetrate Academy Releases Free Istio Fundamentals Course</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2022 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-3 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" rel="noopener"><i class="fa fa-twitter "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" rel="noopener"><i class="fa fa-github "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" rel="noopener"><i class="fa fa-linkedin "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="mailto:jimmysong@jimmysong.io" target="_blank" rel="noopener"><i class="fa fa-envelope "></i></a></li>
            
            <li class="list-inline-item"><a class="d-inline-block p-2" href="/blog/index.xml" target="_blank" rel="noopener"><i class="fa fa-rss "></i></a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>




<!-- JS Plugins -->

<script src="/plugins/jQuery/jquery.min.js"></script>

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/venobox/venobox.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script>
    anchors.add()
</script>




<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, 'Copied')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>




<script>
tocbot.init({
  
  tocSelector: '.aside-toc #TableOfContents',
  
  contentSelector: '.content',
  
  headingSelector: 'h1, h2, h3, h4',
  
  hasInnerContainers: false,
  collapseDepth: 3
});
</script>












<script src="/js/wowchemy-search.min.0b3293fc75f976f49fb5a3d247c91f2e.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content">
      <div class="search-hit-name">
        <div class="article-metadata search-hit-type">{{relpermalink}}</div>
        <a href="{{relpermalink}}">{{title}}</a>
        <p class="search-hit-description">{{snippet}}</p>
      </div>
    </div>
  </div>
</script>


</body>

</html>
