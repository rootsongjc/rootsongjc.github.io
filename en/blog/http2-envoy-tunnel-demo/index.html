<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>Implementing HTTP/2 CONNECT Tunnels with Envoy: Concepts and Practical Guide - Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="A deep dive into creating transparent tunnels using HTTP/2 CONNECT, including technical principles, practical workflows, and example code.">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.136.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.784204edcd29c092198e88494fa2ae755eba9ae231d6fa7faf8e7da3207b4623.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/blog/http2-envoy-tunnel-demo/" />
  <meta property="og:title" content="Implementing HTTP/2 CONNECT Tunnels with Envoy: Concepts and Practical Guide | Jimmy Song" />
  <meta property="twitter:title" content="Implementing HTTP/2 CONNECT Tunnels with Envoy: Concepts and Practical Guide | Jimmy Song" />

  
  <meta property="og:description" content="A deep dive into creating transparent tunnels using HTTP/2 CONNECT, including technical principles, practical workflows, and example code." />
  <meta property="twitter:description" content="A deep dive into creating transparent tunnels using HTTP/2 CONNECT, including technical principles, practical workflows, and example code." />

  
  <meta property="og:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />
  <meta property="twitter:image" content="https://jimmysong.io/images/backgrounds/favicon.png" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    
                  
                
              
              
              
                
                  
                    
                    <a class="nav-link" href="/blog/http2-envoy-tunnel-demo/">中文</a>
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>Search</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>Search</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="Close"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="Input the keyword">
        
        <div class="mt-4">
          <span>Search type: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">All</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">Blog</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">Book</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">Notice</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    Implementing HTTP/2 CONNECT Tunnels With Envoy: Concepts and Practical Guide
                </p>
                <p class="page-description">
                    A deep dive into creating transparent tunnels using HTTP/2 CONNECT, including technical principles, practical workflows, and example code.
                </p>
                
                <div class="page-metadata">
                  <ul class="list-inline d-flex">
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-calendar"></i>
                        </span>Feb 4, 2025</li>
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-folder-open"></i>
                        </span><a
                        href="/en/categories/istio"> 
                        Istio</a> </li>
                    
                    
                    <li class="list-inline-item mr-2 mb-md-0"><span><i class="fa-regular fa-clock"></i>
                        </span>10 Minute</li>
                    <li class="list-inline-item mr-2 mb-md-0 d-sm-block d-none"><span><i class="fa-regular fa-file-word"></i>
                        </span>2121 words</li>
                    
                    
                  </ul>
                </div>
                
            </div>
        </div>
    </div>
</section>

        


  <div class="container-xl blog mb-4">
    <div class="row">
      <div class="col-xl-8">
        <div class="row">
          
          <div class="col-12 content py-md-3">

            
            
            
              <div class="alert alert-note-container mt-2">
    <div class="alert-note-title px-2 py-2">
      Copyright
    </div>
    <div class="alert-tip px-2">
      This is an original article by Jimmy Song. You may repost it, but please credit this source: <a title=https://jimmysong.io/en/blog/http2-envoy-tunnel-demo/>https://jimmysong.io/en/blog/http2-envoy-tunnel-demo/</a>
     </div>
  </div>
            

            
              <details class="mobile-toc d-sm-none d-block mb-0">
  <summary>Click to show the outline</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-http2-connect-and-hbone-tunnel">What Is HTTP/2 CONNECT and HBONE Tunnel?</a></li>
    <li><a href="#basic-principles-of-http2-connect-tunnel-creation">Basic Principles of HTTP/2 CONNECT Tunnel Creation</a></li>
    <li><a href="#demo-establishing-an-http2-connect-tunnel-with-envoy">Demo: Establishing an HTTP/2 CONNECT Tunnel with Envoy</a>
      <ul>
        <li><a href="#directory-structure">Directory Structure</a></li>
        <li><a href="#key-steps-in-the-demo-setup">Key Steps in the Demo Setup</a></li>
        <li><a href="#environment-preparation">Environment Preparation</a></li>
        <li><a href="#generating-a-self-signed-certificate">Generating a Self-Signed Certificate</a></li>
        <li><a href="#configuring-the-envoy-proxy">Configuring the Envoy Proxy</a></li>
        <li><a href="#implementing-the-server">Implementing the Server</a></li>
        <li><a href="#implementing-the-client">Implementing the Client</a></li>
        <li><a href="#creating-the-docker-compose-file">Creating the Docker Compose File</a></li>
        <li><a href="#running-the-example">Running the Example</a></li>
        <li><a href="#testing-the-communication">Testing the Communication</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#tunnel-establishment-process">Tunnel Establishment Process</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
</details>

            
            <p>As part of my recent exploration into Istio Ambient mode, I discovered that the HTTP/2 CONNECT method is a core technology for creating tunnels that enable transparent traffic interception and forwarding. HTTP/2 CONNECT tunnel is a powerful tool that can create an efficient tunnel in an existing HTTP/2 connection for transmitting raw TCP data. This article shows how to implement the basic functions of the HTTP/2 CONNECT tunnel using Envoy through a simple Demo.</p>
<h2 id="what-is-http2-connect-and-hbone-tunnel">What Is HTTP/2 CONNECT and HBONE Tunnel?</h2>
<p>The HTTP/2 CONNECT method provides a standardized approach for creating tunnels to transparently transmit data. In Istio Ambient mode, it offers an efficient way for proxy data planes to communicate. HBONE (HTTP-Based Overlay Network Environment) tunnel, built on HTTP/2 CONNECT, is Istio’s implementation for transparent traffic interception and forwarding. Using HBONE, data can securely traverse the tunnel via HTTP/2, offering a sidecar-less alternative. This innovative design simplifies the management and deployment of service meshes.</p>
<p>HBONE, specific to Istio, is a secure tunneling protocol for communication between Istio components. Its current implementation incorporates three open standards:</p>
<ul>
<li><strong>HTTP/2</strong></li>
<li><strong>HTTP CONNECT</strong></li>
<li><strong>Mutual TLS (mTLS)</strong></li>
</ul>
<p>HTTP CONNECT establishes the tunnel, mTLS encrypts the connection, and HTTP/2 multiplexes streams within the secure tunnel while transmitting stream-level metadata. For more details, see the <a href="https://istio.io/latest/docs/ambient/architecture/hbone/" title="HBONE documentation" target="_blank" rel="noopener">HBONE documentation</a>.</p>
<h2 id="basic-principles-of-http2-connect-tunnel-creation">Basic Principles of HTTP/2 CONNECT Tunnel Creation</h2>
<p>The HTTP/2 CONNECT method creates a VPN-like tunnel for secure data transmission. The basic steps are as follows:</p>
<ol>
<li>The client sends a standard TCP or HTTP request to the proxy.</li>
<li>The proxy sends an HTTP/2 CONNECT request to the target server on behalf of the client.</li>
<li>If the server allows tunnel creation, it responds with an HTTP/2 200 OK.</li>
<li>Data flows bidirectionally between the client, proxy, and server through the tunnel.</li>
</ol>
<p>This method ensures secure and transparent data transmission, particularly suited for scenarios requiring efficient communication and end-to-end encryption.</p>
<p>Below is a diagram showing the basic process of creating a tunnel using the HTTP/2 CONNECT method:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/http2-envoy-tunnel-demo/6c8637147d93c860174fe0df8b21a0b3.svg" data-img="/en/blog/http2-envoy-tunnel-demo/6c8637147d93c860174fe0df8b21a0b3.svg" alt="image" data-caption="The basic process of establishing a tunnel using the HTTP2 Connect method">
        
      
    
  
  
  <figcaption>The basic process of establishing a tunnel using the HTTP2 Connect method</figcaption>
  
</figure>
<h2 id="demo-establishing-an-http2-connect-tunnel-with-envoy">Demo: Establishing an HTTP/2 CONNECT Tunnel with Envoy</h2>
<p>In this demo:</p>
<ul>
<li>The <strong>client</strong> sends a text message to the <strong>Envoy proxy</strong>, which forwards it to the <strong>server</strong> through an <strong>HTTP/2 CONNECT tunnel</strong>.</li>
<li>The <strong>server</strong> processes and replies to the message, with <strong>Envoy</strong> facilitating secure communication.</li>
<li>The <strong>client</strong> remains unaware of the tunnel&rsquo;s existence, experiencing a seamless connection.</li>
</ul>
<p>Below is the architecture for this demo. To simplify the setup, we will configure TLS only for the server:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/http2-envoy-tunnel-demo/b25a0e3bb0f015f7a0c8b280d1025f88.svg" data-img="/en/blog/http2-envoy-tunnel-demo/b25a0e3bb0f015f7a0c8b280d1025f88.svg" alt="image" data-caption="Architecture Diagram">
        
      
    
  
  
  <figcaption>Architecture Diagram</figcaption>
  
</figure>
<h3 id="directory-structure">Directory Structure</h3>
<p>The complete directory structure of this example is as follows:</p>
<pre tabindex="0"><code>envoy-http2-tunnel/
├── certs/
│   ├── openssl.cnf
│   ├── server.crt
│   ├── server.key
├── client/
│   └── client.js
├── docker-compose.yml
├── envoy.yaml
└── server/
    ├── Dockerfile
    └── server.js
</code></pre><h3 id="key-steps-in-the-demo-setup">Key Steps in the Demo Setup</h3>
<ol>
<li><strong>Generate Certificates:</strong> Create self-signed certificates using OpenSSL.</li>
<li><strong>Configure Envoy:</strong> Define Envoy settings to accept client TCP connections and establish tunnels with the server.</li>
<li><strong>Implement the Server:</strong> Use Node.js to build an HTTP/2 server that processes client messages.</li>
<li><strong>Implement the Client:</strong> Use Node.js to build a client that sends messages to the Envoy proxy.</li>
<li><strong>Deploy Services:</strong> Use Docker Compose to orchestrate Envoy and the server.</li>
<li><strong>Test Communication:</strong> Verify message flow from client to server and back through the HTTP/2 CONNECT tunnel.</li>
</ol>
<p>By following this guide, you can establish efficient, transparent, and secure traffic tunnels using HTTP/2 CONNECT, a cornerstone of Istio&rsquo;s Ambient mode and HBONE technology.</p>
<h3 id="environment-preparation">Environment Preparation</h3>
<h4 id="1-install-nodejs">1. Install Node.js</h4>
<p>Ensure that <strong>Node.js</strong> (version &gt;= <strong>10.10.0</strong>) is installed on your system, as the <code>http2</code> module became stable starting with this version.</p>
<ul>
<li><strong>Download Link:</strong> <a href="https://nodejs.org/" title="Node.js Official Website" target="_blank" rel="noopener">Node.js Official Website</a></li>
</ul>
<h4 id="2-install-docker-and-docker-compose">2. Install Docker and Docker Compose</h4>
<ul>
<li><strong>Docker Download Link:</strong> <a href="https://www.docker.com/get-started" title="Docker Official Website" target="_blank" rel="noopener">Docker Official Website</a></li>
<li><strong>Docker Compose Download Link:</strong> <a href="https://docs.docker.com/compose/install/" title="Docker Compose Official Documentation" target="_blank" rel="noopener">Docker Compose Official Documentation</a></li>
</ul>
<h4 id="3-create-a-project-directory">3. Create a Project Directory</h4>
<p>Create a new directory in your workspace and navigate to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir envoy-http2-tunnel
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> envoy-http2-tunnel
</span></span></code></pre></div><h3 id="generating-a-self-signed-certificate">Generating a Self-Signed Certificate</h3>
<p>To enable encrypted communication between Envoy and the server, we need to generate a self-signed certificate with the correct configuration.</p>
<h4 id="1-create-the-certificates-directory-and-openssl-configuration-file">1. Create the Certificates Directory and OpenSSL Configuration File</h4>
<p>Create the <code>certs</code> directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir certs
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> certs
</span></span></code></pre></div><p>Create an <code>openssl.cnf</code> file with the following content:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[ req ]</span>
</span></span><span class="line"><span class="cl"><span class="na">default_bits</span>       <span class="o">=</span> <span class="s">2048</span>
</span></span><span class="line"><span class="cl"><span class="na">default_md</span>         <span class="o">=</span> <span class="s">sha256</span>
</span></span><span class="line"><span class="cl"><span class="na">prompt</span>             <span class="o">=</span> <span class="s">no</span>
</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span> <span class="o">=</span> <span class="s">dn</span>
</span></span><span class="line"><span class="cl"><span class="na">req_extensions</span>     <span class="o">=</span> <span class="s">req_ext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ dn ]</span>
</span></span><span class="line"><span class="cl"><span class="na">C</span>            <span class="o">=</span> <span class="s">US</span>
</span></span><span class="line"><span class="cl"><span class="na">ST</span>           <span class="o">=</span> <span class="s">California</span>
</span></span><span class="line"><span class="cl"><span class="na">L</span>            <span class="o">=</span> <span class="s">San Francisco</span>
</span></span><span class="line"><span class="cl"><span class="na">O</span>            <span class="o">=</span> <span class="s">My Company</span>
</span></span><span class="line"><span class="cl"><span class="na">OU</span>           <span class="o">=</span> <span class="s">My Division</span>
</span></span><span class="line"><span class="cl"><span class="na">CN</span>           <span class="o">=</span> <span class="s">server</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ req_ext ]</span>
</span></span><span class="line"><span class="cl"><span class="na">subjectAltName</span> <span class="o">=</span> <span class="s">@alt_names</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[ alt_names ]</span>
</span></span><span class="line"><span class="cl"><span class="na">DNS.1</span>   <span class="o">=</span> <span class="s">server</span>
</span></span><span class="line"><span class="cl"><span class="na">DNS.2</span>   <span class="o">=</span> <span class="s">localhost</span>
</span></span></code></pre></div><h4 id="2-generate-the-key-and-certificate">2. Generate the Key and Certificate</h4>
<p>Run the following command to generate the key and certificate:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl req -x509 -nodes -days <span class="m">365</span> -newkey rsa:2048 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -keyout server.key -out server.crt -config openssl.cnf
</span></span></code></pre></div><p>This will generate the <code>server.key</code> and <code>server.crt</code> files in the <code>certs</code> directory.</p>
<h3 id="configuring-the-envoy-proxy">Configuring the Envoy Proxy</h3>
<p>We need to configure Envoy to accept plain TCP connections from the client and forward the data to the server through an HTTP/2 CONNECT tunnel.</p>
<h4 id="1-create-the-envoy-configuration-file">1. Create the Envoy Configuration File</h4>
<p>In the project root directory, create a file named <code>envoy.yaml</code> with the following content:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">static_resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">listener_0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">socket_address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">filter_chains</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envoy.filters.network.tcp_proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">typed_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">&#34;@type&#34;: </span><span class="l">type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">stat_prefix</span><span class="p">:</span><span class="w"> </span><span class="l">tcp_stats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel_cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">tunneling_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">server:8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">access_log</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envoy.access_loggers.stdout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">&#34;@type&#34;: </span><span class="l">type.googleapis.com/envoy.extensions.access_loggers.stream.v3.StdoutAccessLog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">log_format</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">json_format</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">start_time</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%START_TIME%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(:METHOD)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%PROTOCOL%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">response_code</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%RESPONSE_CODE%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">response_flags</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%RESPONSE_FLAGS%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">bytes_received</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%BYTES_RECEIVED%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">bytes_sent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%BYTES_SENT%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%DURATION%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">upstream_service_time</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">x_forwarded_for</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(X-FORWARDED-FOR)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">user_agent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(USER-AGENT)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">request_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%REQ(X-REQUEST-ID)%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">upstream_host</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%UPSTREAM_HOST%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">upstream_cluster</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%UPSTREAM_CLUSTER%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">downstream_local_address</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%DOWNSTREAM_LOCAL_ADDRESS%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">downstream_remote_address</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%DOWNSTREAM_REMOTE_ADDRESS%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel_cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">connect_timeout</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LOGICAL_DNS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">lb_policy</span><span class="p">:</span><span class="w"> </span><span class="l">ROUND_ROBIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">transport_socket</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envoy.transport_sockets.tls</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">typed_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;@type&#34;: </span><span class="l">type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sni</span><span class="p">:</span><span class="w"> </span><span class="l">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">common_tls_context</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">validation_context</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">trusted_ca</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/certs/server.crt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">alpn_protocols</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&#34;h2&#34;</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http2_protocol_options</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">load_assignment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel_cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">lb_endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">endpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">socket_address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></div><h4 id="2-key-highlights-of-the-configuration">2. Key Highlights of the Configuration</h4>
<ul>
<li><strong>TCP Proxy Listener:</strong> Listens for incoming TCP connections on port <code>10000</code> and forwards traffic to the upstream server.</li>
<li><strong>HTTP/2 Tunnel:</strong> Configures Envoy to use HTTP/2 CONNECT for tunneling traffic to the server.</li>
<li><strong>TLS Encryption:</strong> Enables secure communication between Envoy and the upstream server using the generated <code>server.crt</code> and <code>server.key</code>.</li>
<li><strong>Access Logs:</strong> Configures detailed logs for request and response metrics.</li>
</ul>
<p>Next, proceed to set up the server and client components to test the tunnel functionality.</p>
<h3 id="implementing-the-server">Implementing the Server</h3>
<h4 id="1-create-the-server-directory-and-files">1. Create the Server Directory and Files</h4>
<p>Create the <code>server</code> directory in the project root:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir server
</span></span></code></pre></div><p>Inside the <code>server</code> directory, create <code>server.js</code> and <code>Dockerfile</code>.</p>
<h4 id="2-write-serverjs">2. Write <code>server.js</code></h4>
<p>Add the following code to <code>server/server.js</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">http2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http2&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http2</span><span class="p">.</span><span class="nx">createSecureServer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">key</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/certs/server.key&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cert</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/certs/server.crt&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;:method&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;:path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">&#39;CONNECT&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received CONNECT request for </span><span class="si">${</span><span class="nx">path</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Respond with 200 to establish the tunnel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">stream</span><span class="p">.</span><span class="nx">respond</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;:status&#39;</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Handle data within the tunnel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received from client: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Respond to the client
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="sb">`Echo from server: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">stream</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Stream ended by client.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">stream</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Return 404 for non-CONNECT requests
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">stream</span><span class="p">.</span><span class="nx">respond</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;:status&#39;</span><span class="o">:</span> <span class="mi">404</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">stream</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Start the server and listen on port 8080
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Secure HTTP/2 server is listening on port 8080&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p><strong>Notes:</strong></p>
<ul>
<li>It listens for the <code>secureConnection</code> event to process TLS-secured sockets.</li>
<li>The server reads incoming data from the socket, processes client messages, and sends responses.</li>
</ul>
<h4 id="3-create-the-dockerfile">3. Create the <code>Dockerfile</code></h4>
<p>Add the following content to <code>server/Dockerfile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> node:14</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> server.js .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;node&#34;</span><span class="p">,</span> <span class="s2">&#34;server.js&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><h3 id="implementing-the-client">Implementing the Client</h3>
<h4 id="1-create-the-client-directory-and-files">1. Create the Client Directory and Files</h4>
<p>Create the <code>client</code> directory in the project root:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir client
</span></span></code></pre></div><p>Inside the <code>client</code> directory, create <code>client.js</code>.</p>
<h4 id="2-write-clientjs">2. Write <code>client.js</code></h4>
<p>Add the following code to <code>client/client.js</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">net</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Create a TCP connection to Envoy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span> <span class="nx">port</span><span class="o">:</span> <span class="mi">10000</span> <span class="p">},</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected to Envoy.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Send messages to the server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="sb">`Message </span><span class="si">${</span><span class="nx">counter</span><span class="si">}</span><span class="sb"> from client!`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">counter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Close the connection
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received from server: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Disconnected from server.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Client error:&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>The <strong>client</strong> establishes a standard TCP connection with <strong>Envoy</strong> and sends text messages.</li>
<li>This client&rsquo;s existence only triggers Envoy to establish a tunnel with the server.</li>
</ul>
<h3 id="creating-the-docker-compose-file">Creating the Docker Compose File</h3>
<p>Create <code>docker-compose.yml</code> in the project root:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">envoy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">envoyproxy/envoy:v1.32.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./envoy.yaml:/etc/envoy/envoy.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./certs:/certs </span><span class="w"> </span><span class="c"># Mount the certificates directory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;10000:10000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">envoy_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/local/bin/envoy -c /etc/envoy/envoy.yaml --service-cluster envoy --log-level debug</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l">./server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">envoy_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8080&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./certs:/certs </span><span class="w"> </span><span class="c"># Mount the certificates directory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">envoy_network</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>This configuration sets up both the Envoy proxy and the server to operate within the same Docker network, facilitating seamless communication.</p>
<h3 id="running-the-example">Running the Example</h3>
<h4 id="1-start-docker-compose">1. Start Docker Compose</h4>
<p>In the project root directory, run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose up --build
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<ul>
<li><strong>Envoy Container:</strong> Displays startup information and debug logs.</li>
<li><strong>Server Container:</strong> Displays <code>Secure HTTP/2 server is listening on port 8080</code>.</li>
</ul>
<h4 id="2-run-the-client">2. Run the Client</h4>
<p>Open a new terminal, navigate to the <code>client</code> directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> client
</span></span></code></pre></div><p>Run the client:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">node client.js
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>Connected to Envoy.
Received from server: Echo from server: Message 1 from client!
Received from server: Echo from server: Message 2 from client!
Received from server: Echo from server: Message 3 from client!
Received from server: Echo from server: Message 4 from client!
Received from server: Echo from server: Message 5 from client!
Disconnected from server.
</code></pre><h4 id="3-check-server-logs">3. Check Server Logs</h4>
<p>In the Docker Compose output, you should see logs from the server:</p>
<pre tabindex="0"><code>envoy_1   | {&#34;downstream_remote_address&#34;:&#34;192.168.65.1:46306&#34;,&#34;path&#34;:null,&#34;request_id&#34;:null,&#34;bytes_sent&#34;:160,&#34;protocol&#34;:null,&#34;upstream_service_time&#34;:null,&#34;bytes_received&#34;:88,&#34;response_code&#34;:0,&#34;user_agent&#34;:null,&#34;downstream_local_address&#34;:&#34;172.21.0.3:10000&#34;,&#34;upstream_host&#34;:&#34;172.21.0.2:8080&#34;,&#34;start_time&#34;:&#34;2024-12-03T11:37:59.542Z&#34;,&#34;upstream_cluster&#34;:&#34;tunnel_cluster&#34;,&#34;duration&#34;:5012,&#34;response_flags&#34;:&#34;-&#34;,&#34;method&#34;:null,&#34;x_forwarded_for&#34;:null}
server_1  | Secure HTTP/2 server is listening on port 8080
server_1  | New secure connection established.
server_1  | Received from client: Message 1 from client!
server_1  | Received from client: Message 2 from client!
server_1  | Received from client: Message 3 from client!
server_1  | Received from client: Message 4 from client!
server_1  | Received from client: Message 5 from client!
server_1  | Connection ended by client.
</code></pre><h4 id="4-check-envoy-logs">4. Check Envoy Logs</h4>
<p>In Envoy’s logs, you can see records of the connection established with the server using the <strong>HTTP/2 CONNECT tunnel</strong>.</p>
<h3 id="testing-the-communication">Testing the Communication</h3>
<ul>
<li><strong>The client</strong> sends text messages to <strong>Envoy</strong> over a TCP connection.</li>
<li><strong>Envoy</strong> forwards the client’s TCP traffic to the <strong>server</strong> via an <strong>HTTP/2 CONNECT tunnel</strong>.</li>
<li><strong>The server</strong> receives the messages, processes them, and replies to the client.</li>
<li><strong>Envoy</strong> relays the server’s responses back to the <strong>client</strong> through the tunnel.</li>
<li><strong>The client</strong> receives the responses from server.</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li><strong>Certificate Management:</strong> Ensure the certificates are properly configured and used in both Envoy and the server.</li>
<li><strong>Docker Networking:</strong> Use Docker Compose-defined networks to allow containers to communicate using service names.</li>
<li><strong>Port Conflicts:</strong> Ensure ports <code>10000</code> (Envoy) and <code>8080</code> (server) are not occupied.</li>
<li><strong>TLS Configuration:</strong> In this example, communication between Envoy and the server is secured with TLS and HTTP/2.</li>
</ul>
<h2 id="tunnel-establishment-process">Tunnel Establishment Process</h2>
<p>The following diagram illustrates the interaction between the client, Envoy proxy, and server, showing how data is transmitted and the tunnel connection is established:</p>

<figure class="mx-auto text-center">
  
  
  
    
      
        
          <img src="/en/blog/http2-envoy-tunnel-demo/e2f47e2631af2b2e8f72dadc4f82fe94.svg" data-img="/en/blog/http2-envoy-tunnel-demo/e2f47e2631af2b2e8f72dadc4f82fe94.svg" alt="image" data-caption="Tunnel Establishment Process">
        
      
    
  
  
  <figcaption>Tunnel Establishment Process</figcaption>
  
</figure>
<p>Explanation:</p>
<ol>
<li>
<p><strong>Client connects to Envoy via TCP:</strong></p>
<ul>
<li>The client sends a TCP connection request to Envoy.</li>
<li>Envoy accepts the connection and creates a new TCP proxy session (ConnectionId: 0).</li>
</ul>
</li>
<li>
<p><strong>Envoy establishes a connection with the server:</strong></p>
<ul>
<li>Envoy connects to the upstream cluster <code>tunnel_cluster</code>, creating a new connection (ConnectionId: 1).</li>
</ul>
</li>
<li>
<p><strong>Establishing the HTTP/2 CONNECT tunnel:</strong></p>
<ul>
<li>Envoy establishes an HTTP/2 connection with the server.</li>
<li>Envoy sends an HTTP/2 CONNECT request with the target hostname <code>server:8080</code>.</li>
<li>The server responds with <code>200 OK</code>, successfully establishing the tunnel.</li>
</ul>
</li>
<li>
<p><strong>Data transmission:</strong></p>
<ul>
<li><strong>Message exchange loop:</strong>
<ul>
<li>The client sends data (<code>Message N</code>) to Envoy.</li>
<li>Envoy forwards the data through the tunnel to the server.</li>
<li>The server processes the data and responds (<code>Echo Message N</code>).</li>
<li>Envoy forwards the response back to the client.</li>
</ul>
</li>
<li><strong>Logging:</strong>
<ul>
<li>The server logs each received message, e.g., <code>Received from client: Message N from client!</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Closing the connection:</strong></p>
<ul>
<li>The client sends a FIN request to close the connection.</li>
<li>Envoy forwards the FIN request to the server, closing the tunnel.</li>
<li>The server acknowledges the FIN with an ACK.</li>
<li>Envoy sends the ACK to the client, completing the connection closure.</li>
</ul>
</li>
<li>
<p><strong>Logging:</strong></p>
<ul>
<li>Envoy logs the closure of connections, including ConnectionId and stats.</li>
<li>The server logs the closure, e.g., <code>Stream ended by client.</code>.</li>
</ul>
</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>Although this is an introductory example, it provides a solid foundation for understanding and further exploring the HTTP/2 CONNECT tunnel function. In the next blog, I will explain the tunnel implemented by two Envoy proxies and take you to further understand the HBONE transparent tunnel in the Istio ambient mode.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/upgrades" title="HTTP upgrades — envoy 1.33.0-dev-6d8d0b documentation" target="_blank" rel="noopener">HTTP upgrades — envoy 1.33.0-dev-6d8d0b documentation</a></li>
<li><a href="https://github.com/envoyproxy/envoy/blob/6d8d0b0ee2cc267b2cd9f57eb952863ddc8e49c3/configs/proxy_connect.yaml" title="envoy/configs/proxy_connect.yaml at 6d8d0b0ee2cc267b2cd9f57eb952863ddc8e49c3 · envoyproxy/envoy · GitHub" target="_blank" rel="noopener">envoy/configs/proxy_connect.yaml at 6d8d0b0ee2cc267b2cd9f57eb952863ddc8e49c3 · envoyproxy/envoy · GitHub</a></li>
</ul>

            <div class="border-bottom mb-2"></div>
          </div>
          <div class="col-12">
            <p>Last updated on Feb 25, 2025</p>
            


            


          </div>
          
          <div class="col-12">
              <div class="list-inline-item text-light">
              
              <a href="/en/tags/istio" class="badge"> 
                  Istio</a> 
              <a href="/en/tags/ambient" class="badge">  
                  Ambient</a> 
              <a href="/en/tags/hbone" class="badge">  
                  HBONE</a> 
              <a href="/en/tags/http2" class="badge">  
                  HTTP2</a> 
              <a href="/en/tags/http-connect" class="badge">  
                  HTTP Connect</a> 
              <a href="/en/tags/tunnel" class="badge">  
                  Tunnel</a> 
              <a href="/en/tags/envoy" class="badge">  
                  Envoy</a> </div>
          </div>
          
          <div class="col-12">
            









    

    
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    






    



    


<div class="pager blog-pager d-flex justify-content-between">
    
    <div class="previous mr-4">
        <a href="https://jimmysong.io/en/blog/envoy-ext-proc-guide/" class="d-flex flex-column align-items-start">
            <span class="nav mb-2 text-color-dark">&larr; Previous Post</span>
            <span class="text-align-left">Advanced Request and Response Processing in Microservice Architecture with Envoy&#39;s External Processing Filter</span>
        </a>
    </div>
    

    
    <div class="next">
        <a href="https://jimmysong.io/en/blog/istio-ambient-packet-lifecycle-optimization/" class="d-flex flex-column align-items-end">
            <span class="nav mb-2 text-color-dark">Next Post &rarr;</span>
            <span class="text-align-right">Packet Lifecycle and Traffic Optimization in Istio Ambient Mode</span>
        </a>
    </div>
     
</div>

          </div>

          
          
          <div class="col-12">
            <script src="https://giscus.app/client.js"
        data-repo="rootsongjc/rootsongjc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTQ1MzczNA=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAd_yJs4CPNtR"
        data-mapping="pathname"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        
        data-lang="en"
        
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
          </div>
          
        </div>
      </div>
      <!-- sidebar -->
      <aside class="px-2 col-xl-4 py-md-3 d-none d-xl-block">
          <div class="sidebar">
          <!-- recommend -->
          











<div>
  <p class="related-sidebar-title">
  Related article
  </p>
  <!-- related-blog-item -->
    <ul class="related-list">
    
      <li>
          <a href="/en/blog/ambient-mesh-l7-traffic-path/">
            L7 Traffic Path in Ambient Mesh
          </a>
      </li>
    
      <li>
          <a href="/en/blog/ambient-mesh-l4-traffic-path/">
            Transparent Traffic Intercepting and Routing in the L4 Network of Istio Ambient Mesh
          </a>
      </li>
    
      <li>
          <a href="/en/blog/istio-ambient-inpod-iptables/">
            In-Pod IPtables Rule Injection in Istio Ambient Mode Explained
          </a>
      </li>
    
      <li>
          <a href="/en/blog/istio-ambient-traffic-interception/">
            Detailed Explanation of Transparent Traffic Interception in Istio ambient mode
          </a>
      </li>
    
      <li>
          <a href="/en/blog/istio-sidecar-vs-ambient-network-cost-performance/">
            Network Cost Comparison Between Istio Sidecar and Ambient Modes
          </a>
      </li>
    
    </ul>
</div>


          <!-- /recommend -->
          <!-- toc -->
          
  <div class="bg-white sticky-top aside-toc">
    <p class="toc-sidebar-title">
      Table of content
    </p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-http2-connect-and-hbone-tunnel">What Is HTTP/2 CONNECT and HBONE Tunnel?</a></li>
    <li><a href="#basic-principles-of-http2-connect-tunnel-creation">Basic Principles of HTTP/2 CONNECT Tunnel Creation</a></li>
    <li><a href="#demo-establishing-an-http2-connect-tunnel-with-envoy">Demo: Establishing an HTTP/2 CONNECT Tunnel with Envoy</a>
      <ul>
        <li><a href="#directory-structure">Directory Structure</a></li>
        <li><a href="#key-steps-in-the-demo-setup">Key Steps in the Demo Setup</a></li>
        <li><a href="#environment-preparation">Environment Preparation</a></li>
        <li><a href="#generating-a-self-signed-certificate">Generating a Self-Signed Certificate</a></li>
        <li><a href="#configuring-the-envoy-proxy">Configuring the Envoy Proxy</a></li>
        <li><a href="#implementing-the-server">Implementing the Server</a></li>
        <li><a href="#implementing-the-client">Implementing the Client</a></li>
        <li><a href="#creating-the-docker-compose-file">Creating the Docker Compose File</a></li>
        <li><a href="#running-the-example">Running the Example</a></li>
        <li><a href="#testing-the-communication">Testing the Communication</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#tunnel-establishment-process">Tunnel Establishment Process</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
  </div>



          <!-- /toc -->
          <!-- ad-->
          

          <!-- /ad -->
          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">Contact</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s LinkedIn</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-linkedin.png" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Blog</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/envoy-ext-proc-guide/">Advanced Request and Response Processing in Microservice Architecture with Envoy&#39;s External Processing Filter</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/http2-envoy-tunnel-demo/">Implementing HTTP/2 CONNECT Tunnels with Envoy: Concepts and Practical Guide</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/istio-ambient-packet-lifecycle-optimization/">Packet Lifecycle and Traffic Optimization in Istio Ambient Mode</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">links</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" >
                  Awesome Cloud Native
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://gateway.envoyproxy.io" target="_blank" rel="noopener noreferrer">
                  Envoy Gateway
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io" target="_blank" rel="noopener noreferrer">
                  Istio
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate - Service Mesh Company
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://docs.tetrate.io/istio-subscription/" target="_blank" rel="noopener noreferrer">
                  Tetrate Istio Subscription
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Courses</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener noreferrer">
                  Envoy Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener noreferrer">
                  Istio Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">new notice</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-china-2024-panel/">KubeCon China 2024 panel Preview: Istio and Modern API Gateways – Leading the Future of Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/website-revamp-notice/">Website Revamp Notice</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2025 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/en/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/en/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />





<script>
    anchors.add();
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>






  





<script src="/js/wowchemy-search.min.ce03c611044441cf6e84f9e4bef20818.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
