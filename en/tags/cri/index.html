<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <title>CRI · Jimmy Song</title>
  

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="Jimmy Song&#39;s Blog">
  <meta name="author" content="Jimmy Song">
  <meta name="generator" content="Hugo 0.129.0">

  <!-- CSS plugins -->
  
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
    
    
      
    
  
  
  <link rel="preload" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" as="style">
  <link rel="stylesheet" href="/css/combined.7ac6b2864cb09c5595ac8ca79f8ca0db6c69a657edac885ba2c2412080d68da0.css" media="screen">
  

  <!-- Main Stylesheet -->
  
  <link rel="preload" href="/scss/style.min.f25e1ff9bcb6a5d029ef3c0c4c5c51aec8832388d6321236cc72e9dc323217d6.css" as="style">
  <link rel="stylesheet" href="/scss/style.min.f25e1ff9bcb6a5d029ef3c0c4c5c51aec8832388d6321236cc72e9dc323217d6.css" media="screen">

  <!-- Bigger picture css -->
  
  <link rel="stylesheet" href="/plugins/bigger-picture/bigger-picture.min.css" media="print" onload="this.media='all'">
  <!--Favicon generate by https://realfavicongenerator.net-->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">

  <link href='/opensearchdescription.xml' rel='search' title='Content search' type='application/opensearchdescription+xml'/>

  <!--Twitter card-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="jimmysong.io" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/en/tags/cri/" />
  <meta property="og:title" content="CRI | Jimmy Song" />
  <meta property="twitter:title" content="CRI | Jimmy Song" />

  
  <meta property="og:description" content="Jimmy Song&#39;s Blog" />
  <meta property="twitter:description" content="Jimmy Song&#39;s Blog" />

  
  <meta property="og:image" content="https://jimmysong.io/images/banner/default.jpg" />
  <meta property="twitter:image" content="https://jimmysong.io/images/banner/default.jpg" />

  
  
</head>
<body>
<header class="fixed-top header">
  
  
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></button>
  
  <div class="navigation w-100 ">
    <div class="container-xl">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="/en">
            
            <b>JIMMY SONG</b>
            
        </a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/blog">Blog</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/book">Book</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/tags">Tags</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/notice">Notice</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/contact">Contact</a>
              
            </li>
            
            
            
            <li class="nav-item">
              
              <a class="nav-link" href="/en/about">About</a>
              
            </li>
            
            

          
          
          <li class="nav-item">
            
            
            
              
              
                
                
                
                  
                    
                    
                  
                
              
              
              
                
                  
                    
                    <a class="nav-link" href="/tags/cri/">中文</a>
                    
                  
                
                
                
              
          </li>
          
          
          <!-- search -->
           <button type="button" class="search-btn js-search" id="searchOpen" aria-label="Search">
              <div class="search-container d-flex justify-content-center">
              <span class="search-content">
                  <i class="fa fa-search"></i>
                  <span>Search</span>
              </span>
              <span class="search-shortcuts d-none d-sm-block">
                  <kbd class="cmd-key">⌘</kbd>
                  <kbd class="k-key">K</kbd>
              </span>
              </div>
          </button>
          
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>


            <aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between">
        <div class="col-6 search-title">
          <p>Search</p> 
        </div>
        <div class="col-6 col-search-close">
          <div class="js-search" aria-label="Close"><i class="fa-solid fa-circle-xmark text-muted" aria-hidden="true"></i></div>
        </div>
      </div>

      <div id="search-box">
        <i class="fa-solid fa-magnifying-glass" id="search-icon" aria-hidden="true"></i>
        <input name="q" id="search-query" placeholder="Input the keyword" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="Input the keyword">
        
        <div class="mt-4">
          <span>Search type: </span>
          <span>
            <input type="radio" id="all" name="search_type" value="all" checked>
            <label for="all">All</label>
            
              <input type="radio" id="blog" name="search_type" value="blog">
              <label for="blog">Blog</label>
            
            <input type="radio" id="book" name="search_type" value="book">
            <label for="book">Book</label>
            <input type="radio" id="notice" name="search_type" value="notice">
            <label for="notice">Notice</label>
          </span>
        </div>
      </div>
      
    </section>
    <section class="section-search-results">
      <div id="search-results-count" class="search-results-count"></div>
      <div id="search-hits">
        
      </div>
    </section>
  </div>
</aside>

        
        
            

<section class="bg-cover page-title-section overlay" style="background-image: url('/images/backgrounds/circle.svg'),url('/images/backgrounds/page-title.webp');background-size: cover;">
    <div class="container-xl">
        <div class="row">
            <div class="col-12">
                <p class="h1">
                    CRI
                </p>
                <p class="page-description">
                    
                </p>
                
            </div>
        </div>
    </div>
</section>

        


<section class="section-sm book-list-section bg-gray">
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          
          
          
          
              <div class="col-sm-6 mb-3">
  <article class="card rounded-0 border-bottom border-primary border-top-0 border-left-0 border-right-0 hover-shadow">
    
    
    <div class="card-body blog-list-card-body">
      <p class="card-title"><a href="/en/blog/cni-deep-dive/">CNI Essentials: Powering Kubernetes&#39; Network</a></p>
      
      <div class="blog-list-metadata">
          <ul class="list-inline">
             
             <li class="list-inline-item mr-2 mb-md-0"><i class="fa-regular fa-calendar"></i>
               May 18, 2024</li>
             <li class="list-inline-item mr-2 md-md-0"><i class="fa-regular fa-folder-open"></i>
             
             <a href="/en/categories/kubernetes"> 
             Kubernetes
             </a>
             
             </li>
             
             <li class="list-inline-item mr-2 mb-md-0">
              

             </li>
             
             <li class="list-inline-item mr-2 mb-md-0 export-button" style="display: none;">
              <a href="#" onclick="exportToMarkdown('CNI Essentials: Powering Kubernetes\u0027 Network', 'This article provides an in-depth explanation of the basic concepts of Container Network Interface (CNI), its core components, and its relationship with Container Runtime Interface (CRI).', '\nEffective management of networking is crucial in containerized environments. The Container Network Interface (CNI) is a standard that defines how containers should be networked. This article delves into the fundamentals of CNI and explores its relationship with CRI.\n\n## What is CNI?\n\nThe CNI (Container Network Interface) specification provides a common interface between container runtimes and network plugins, aiming to standardize container network configuration.\n\nThe CNI specification comprises several core components:\n\n- **Network configuration format**: Defines how administrators define network configurations.\n- **Request protocol**: Describes how container runtimes send network configuration or cleanup requests to network plugins.\n- **Plugin execution process**: Details how plugins execute network setup or cleanup based on the provided configuration.\n- **Plugin delegation**: Allows plugins to delegate specific functionalities to other plugins.\n- **Result return**: Defines the data format for returning results to the runtime after plugin execution.\n\nBy defining these core components, the CNI specification ensures that different container runtimes and network plugins can interact in a consistent manner, enabling automation and standardization of network configuration.\n\n{{\u003ccallout note \u0022Key points of the CNI specification\u0022\u003e}}\n\n- CNI is a plugin-based containerized networking solution.\n- CNI plugins are executable files.\n- The responsibility of a single CNI plugin is singular.\n- CNI plugins are invoked in a chained manner.\n- The CNI specification defines a Linux network namespace for a container.\n- Network definitions in CNI are stored in JSON format.\n- Network definitions are transmitted to plugins via STDIN input streams, meaning network configuration files are not stored on the host, and other configuration parameters are passed to plugins via environment variables.\n\n{{\u003c\/callout\u003e}}\n\nCNI plugins receive network configuration parameters according to the operation type, perform network setup or cleanup tasks accordingly, and return the execution results. This process ensures dynamic configuration of container networks synchronized with container lifecycles.\n\nThe following diagram illustrates the multitude of network plugins encompassed by CNI.\n\n\u0060\u0060\u0060mermaid\ngraph TB\n    CR[Container Runtime] --\u003e CNI[\u0022Container Network Interface (CNI)\u0022]\n    CNI --\u003e LP[Loopback Plugin]\n    CNI --\u003e BP[Bridge Plugin]\n    CNI --\u003e PTP[PTP Plugin]\n    CNI --\u003e MACV[MACvlan Plugin]\n    CNI --\u003e IPV[IPvlan Plugin]\n    CNI --\u003e TPP[3rd-Party Plugin]\n\u0060\u0060\u0060\n\n![Mermaid Diagram](cdc38d55a4fc4468ab20df85ab63c2c7.svg)\n\nAccording to the [CNI specification](https:\/\/github.com\/containernetworking\/cni\/blob\/main\/SPEC.md#section-2-execution-protocol), a CNI plugin is responsible for configuring a container\u0027s network interface in some way. Plugins can be classified into two major categories:\n\n- \u0022Interface\u0022 plugins, responsible for creating network interfaces inside containers and ensuring their connectivity.\n- \u0022Chained\u0022 plugins, adjusting the configuration of already created interfaces (but may need to create more interfaces to accomplish this).\n\n## Relationship Between CNI and CRI\n\nCNI and CRI (Container Runtime Interface) are two critical interfaces in Kubernetes, responsible for container network configuration and runtime management, respectively. In Kubernetes clusters, CRI invokes CNI plugins to configure or clean up container networks, ensuring tight coordination between the network configuration process and container creation and destruction processes.\n\nThe following diagram intuitively illustrates how CNI collaborates with CRI:\n\n\u0060\u0060\u0060mermaid\nsequenceDiagram\n    participant K as Kubelet\n    participant CRI as Container Runtime Interface\n    participant CNI as Container Network Interface\n    participant P as Pod\n\n    K-\u003e\u003e\u002bCRI: Create Pod container\n    CRI-\u003e\u003e\u002bP: Start container\n    P--\u003e\u003e-CRI: Container running\n    CRI--\u003e\u003e-K: Container ready\n    K-\u003e\u003e\u002bCNI: Call CNI for network setup\n    CNI-\u003e\u003e\u002bP: Connect to network\n    P--\u003e\u003e-CNI: Network configured\n    CNI--\u003e\u003e-K: Pod network ready\n    K-\u003e\u003eP: Pod running with network\n\u0060\u0060\u0060\n\n![Mermaid Diagram](9efc34ed8d34997a651adff337bb1630.svg)\n\n1. **Kubelet to CRI**: The Kubelet instructs the CRI to create the containers for a scheduled pod.\n2. **CRI to Pod**: The container runtime starts the container within the pod.\n3. **Pod to CRI**: Once the container is running, it signals back to the container runtime.\n4. **CRI to Kubelet**: The container runtime notifies the Kubelet that the containers are ready.\n5. **Kubelet to CNI**: With the containers up, the Kubelet calls the CNI to set up the network for the pod.\n6. **CNI to Pod**: The CNI configures the network for the pod, attaching it to the necessary network interface.\n7. **Pod to CNI**: After the network is configured, the pod confirms network setup to the CNI.\n8. **CNI to Kubelet**: The CNI informs the Kubelet that the pod\u0027s network is ready.\n9. **Kubelet to Pod**: The pod is now fully operational, with both containers running and network configured.\n\nThe following diagram shows the detailed steps involved in setting up networking for a pod in Kubernetes:\n\n\u0060\u0060\u0060mermaid\nsequenceDiagram\n    participant P as Pod\n    participant K as Kubelet\n    participant CNI as Container Network Interface\n    participant NS as Network Setup\n    participant IPAM as IP Address Management\n\n    K-\u003e\u003e\u002bP: Schedule Pod\n    P-\u003e\u003e\u002bK: Request network setup\n    K-\u003e\u003e\u002bCNI: Call CNI\n    CNI-\u003e\u003e\u002bNS: Create network namespace\n    NS--\u003e\u003e-CNI: Namespace created\n    CNI-\u003e\u003e\u002bIPAM: Allocate IP address\n    IPAM--\u003e\u003e-CNI: IP address allocated\n    CNI-\u003e\u003eP: Set network interface\n    P--\u003e\u003e-K: Network setup complete\n    K-\u003e\u003eP: Pod running with network\n\n    Note over P,K: Pod scheduling triggers network setup\n    Note over CNI,IPAM: CNI handles network namespace creation and IP address allocation\n\u0060\u0060\u0060\n\n![Mermaid Diagram](640af94970463b3c8707011903bfe19a.svg)\n\n1. **Pod scheduling**: The Kubelet schedules a pod to run on a node.\n2. **Request network setup**: The scheduled pod requests network setup from the Kubelet.\n3. **Invoke CNI**: The Kubelet invokes the CNI to handle the network setup for the pod.\n4. **Create network namespace**: The CNI creates a network namespace for the pod, isolating its network environment.\n5. **Allocate IP address**: The CNI, through its IP Address Management (IPAM) plugin, allocates an IP address for the pod.\n6. **Setup network interfaces**: The CNI sets up the necessary network interfaces within the pod\u0027s network namespace, attaching it to the network.\n7. **Network setup complete**: The pod notifies the Kubelet that its network setup is complete.\n8. **Pod running with network**: The pod is now running with its network configured and can communicate with other pods and services within the Kubernetes cluster.\n\n## CNI Workflow\n\nThe Container Network Interface (CNI) specification defines how containers should configure networks, including five operations: \u0060ADD\u0060, \u0060CHECK\u0060, \u0060DELETE\u0060, \u0060GC\u0060, and \u0060VERSION\u0060. Container runtimes execute these operations by calling various CNI plugins, enabling dynamic management and updates of container networks.\n\n\u0060\u0060\u0060mermaid\nsequenceDiagram\n    participant K as Kubelet\n    participant P as Pod\n    participant CNI as CNI Plugins\n    participant CNII as Interface CNI Plugin\n    participant CNIC as Chained CNI Plugin\n    participant NS as Network Setup\n    participant IPAM as IP Address Management\n\n    K-\u003e\u003e\u002bP: Schedule Pod\n    P-\u003e\u003eK: Request network setup\n    K-\u003e\u003eCNI: Call CNI plugins\n    CNI-\u003e\u003eCNII: Call interface plugin\n    CNII-\u003e\u003eNS: Set network interfaces\n    CNII-\u003e\u003eCNIC: Call chained plugin\n    CNIC-\u003e\u003eIPAM: Allocate IP address\n    IPAM-\u003e\u003eCNIC: IP address allocated\n    CNIC-\u003e\u003eNS: Apply network policies\n    CNIC--\u003e\u003eCNI: Chained configuration complete\n    CNI--\u003e\u003eK: Network setup complete\n    K-\u003e\u003eP: Pod running with network\n\n    Note over CNI,CNIC: CNI plugins can be either interface type or chained type\n\u0060\u0060\u0060\n\n![Mermaid Diagram](7b22cf25a480085d500bf3031dbaf6ec.svg)\n\nTo elaborate on each step described in the sequence diagram, involving interactions between Kubelet, Pod, CNI plugins (both interface and chained), network setup, and IP address management (IPAM), let\u0027s delve deeper into the process:\n\n1. **Schedule Pod**: Kubelet schedules a Pod to run on a node. This step initiates the lifecycle of Pods within the Kubernetes cluster.\n2. **Request Network Setup**: The Pod requests Kubelet for network setup. This request triggers the process of configuring the network for the Pod, ensuring its ability to communicate within the Kubernetes cluster.\n3. **Call CNI Plugins**: Kubelet invokes configured Container Network Interface (CNI) plugins. CNI defines a standardized way for container management systems to set up network interfaces within Linux containers. Kubelet passes necessary information to CNI plugins to initiate network setup.\n4. **Call Interface Plugin**: The CNI framework calls an interface CNI plugin responsible for setting up primary network interfaces for the Pod. This plugin may create a new network namespace, connect a pair of veth, or perform other actions to ensure the Pod has the required network interfaces.\n5. **Set Network Interfaces**: The interface CNI plugin configures network interfaces for the Pod. This setup includes assigning IP addresses, setting up routes, and ensuring interfaces are ready for communication.\n6. **Call Chained Plugin**: After setting up network interfaces, the interface CNI plugin or the CNI framework calls chained CNI plugins. These plugins perform additional network configuration tasks, such as setting up IP masquerading, configuring ingress\/egress rules, or applying network policies.\n7. **Allocate IP Address**: As part of the chained process, one of the chained CNI plugins may involve IP Address Management (IPAM). The IPAM plugin is responsible for assigning an IP address to the Pod, ensuring each Pod has a unique IP within the cluster or namespace.\n8. **IP Address Allocated**: The IPAM plugin allocates an IP address and returns the allocation information to the calling plugin. This information typically includes the IP address itself, subnet mask, and possible gateway.\n9. **Apply Network Policies**: Chained CNI plugins apply any specified network policies to the Pod\u0027s network interfaces. These policies may dictate allowed ingress and egress traffic, ensuring network security and isolation per cluster configuration requirements.\n10. **Chained Configuration Complete**: Once all chained plugins have completed their tasks, the overall network configuration for the Pod is considered complete. The CNI framework or the last plugin in the chain signals to Kubelet that network setup is complete.\n11. **Network Setup Complete**: Kubelet receives confirmation of network setup completion from the Pod. At this point, the Pod has fully configured network interfaces with IP addresses, route rules, and applied network policies.\n12. **Pod Running with Network**: The Pod is now running and has its network configured. It can communicate with other Pods within the Kubernetes cluster, access external resources per network policies, and perform its designated functions.\n\nThe following are example sequence diagrams and detailed explanations for the \u0060ADD\u0060, \u0060CHECK\u0060, and \u0060DELETE\u0060 operations based on the [official CNI examples](https:\/\/github.com\/containernetworking\/cni\/blob\/main\/SPEC.md#appendix-examples). Through these operations, interactions between the container runtime and CNI plugins facilitate dynamic management and updates of container network configurations.\n\n### ADD Operation Example\n\nBelow is the example sequence diagram and detailed explanation for the ADD operation:\n\n\u0060\u0060\u0060mermaid\nsequenceDiagram\n    participant CR as Container Runtime\n    participant PP as Portmap Plugin\n    participant TP as Tuning Plugin\n    participant BP as Bridge Plugin\n    participant HLP as Host-local Plugin\n\n    CR-\u003e\u003ePP: CNI_COMMAND=ADD\n    PP--\u003e\u003eCR: Portmap configuration complete\n    CR-\u003e\u003eTP: CNI_COMMAND=ADD\n    TP--\u003e\u003eCR: Tuning configuration complete\n    CR-\u003e\u003eBP: CNI_COMMAND=ADD\n    BP-\u003e\u003eHLP: CNI_COMMAND=ADD\n    HLP--\u003e\u003eBP: IPAM configuration complete\n    BP--\u003e\u003eCR: Bridge configuration complete\n\u0060\u0060\u0060\n\n![Mermaid Diagram](4f28f5eda4192e0eb4cd9c65f2c6f61f.svg)\n\n1. **Container Runtime Calls Portmap Plugin**: The container runtime executes the ADD operation by calling the Portmap plugin to configure port mapping for the container.\n2. **Portmap Configuration Complete**: The Portmap plugin completes the port mapping configuration and returns the result to the container runtime.\n3. **Container Runtime Calls Tuning Plugin**: The container runtime invokes the Tuning plugin to execute the ADD operation and configure network tuning parameters for the container.\n4. **Tuning Configuration Complete**: The Tuning plugin finishes configuring network tuning parameters and returns the result to the container runtime.\n5. **Container Runtime Calls Bridge Plugin**: The container runtime calls the Bridge plugin to execute the ADD operation and configure network interfaces and IP addresses for the container.\n6. **Bridge Plugin Calls Host-local Plugin**: Before completing its own configuration, the Bridge plugin calls the Host-local plugin to execute the ADD operation and configure IP addresses for the container.\n7. **IPAM Configuration Complete**: The Host-local plugin, acting as the authority for IP Address Management (IPAM), completes IP address allocation and returns the result to the Bridge plugin.\n8. **Bridge Configuration Complete**: The Bridge plugin finishes configuring network interfaces and IP addresses and returns the result to the container runtime.\n\nThese operations ensure that the required network configuration is set up as expected when the container starts, including port mapping, network tuning, and IP address allocation.\n\n### CHECK Operation Example\n\nBelow is the example sequence diagram and detailed explanation for the CHECK operation:\n\n\u0060\u0060\u0060mermaid\nsequenceDiagram\n    participant CR as Container Runtime\n    participant BP as Bridge Plugin\n    participant HLP as Host-local Plugin\n    participant TP as Tuning Plugin\n\n    CR-\u003e\u003eBP: CNI_COMMAND=CHECK with prevResult\n    BP-\u003e\u003eHLP: CNI_COMMAND=CHECK\n    HLP--\u003e\u003eBP: No errors detected\n    BP--\u003e\u003eCR: Return with 0 exit code\n    CR-\u003e\u003eTP: CNI_COMMAND=CHECK with prevResult\n    TP--\u003e\u003eCR: Operation successful\n\u0060\u0060\u0060\n\n![Mermaid Diagram](c20cc6391b4f6cf89ffac159410ca851.svg)\n\n1. **Container Runtime Calls Bridge Plugin for Check**: The container runtime performs the CHECK operation by calling the Bridge plugin to inspect the container\u0027s network configuration.\n2. **Bridge Plugin Calls Host-local Plugin for Check**: The Bridge plugin calls the Host-local plugin to inspect IP address allocation.\n3. **No Errors Detected**: The Host-local plugin detects no errors in IP address allocation and reports no errors to the Bridge plugin.\n4. **Return with 0 Exit Code**: The Bridge plugin confirms no network configuration errors and returns with a 0 exit code to the container runtime.\n5. **Container Runtime Calls Tuning Plugin for Check**: The container runtime invokes the Tuning plugin to inspect network tuning parameters.\n6. **Operation Successful**: The Tuning plugin confirms no errors in network tuning parameters, indicating a successful operation to the container runtime.\n\nThese operations ensure that during container runtime, network configuration and tuning parameters are checked and verified as expected to ensure consistency and correctness in network configuration.\n\n### DELETE Operation Example\n\nBelow is the example sequence diagram and detailed explanation for the DELETE operation:\n\n\u0060\u0060\u0060mermaid\nsequenceDiagram\n    participant CR as Container Runtime\n    participant PP as Portmap Plugin\n    participant TP as Tuning Plugin\n    participant BP as Bridge Plugin\n    participant HLP as Host-local Plugin\n\n    CR-\u003e\u003ePP: CNI_COMMAND=DEL\n    PP--\u003e\u003eCR: Portmap deletion complete\n    CR-\u003e\u003eTP: CNI_COMMAND=DEL\n    TP--\u003e\u003eCR: Tuning deletion complete\n    CR-\u003e\u003eBP: CNI_COMMAND=DEL\n    BP-\u003e\u003eHLP: CNI_COMMAND=DEL\n    HLP--\u003e\u003eBP: IPAM deletion complete\n    BP--\u003e\u003eCR: Bridge deletion complete\n\u0060\u0060\u0060\n\n![Mermaid Diagram](40d9a191cc29a56b101c764a520d521e.svg)\n\n1. **Container Runtime Calls Portmap Plugin for Delete**: The container runtime initiates the DELETE operation by calling the Portmap plugin to remove port mapping configuration for the container.\n2. **Portmap Deletion Complete**: The Portmap plugin finishes deleting port mapping and reports completion to the container runtime.\n3. **Container Runtime Calls Tuning Plugin for Delete**: The container runtime calls the Tuning plugin to execute the DELETE operation and remove network tuning parameters for the container.\n4. **Tuning Deletion Complete**: The Tuning plugin completes deletion of network tuning parameters and notifies the container runtime.\n5. **Container Runtime Calls Bridge Plugin for Delete**: The container runtime invokes the Bridge plugin to execute the DELETE operation and remove network interfaces and IP address configuration for the container.\n6. **Bridge Plugin Calls Host-local Plugin for Delete**: Before completing its own deletion, the Bridge plugin calls the Host-local plugin to execute the DELETE operation and remove IP address allocation for the container.\n7. **IPAM Deletion Complete**: The Host-local plugin completes IP address deletion and informs the Bridge plugin.\n8. **Bridge Deletion Complete**: The Bridge plugin finishes removing network interfaces and IP addresses and notifies the container runtime.\n\nThese operations ensure that when the container stops running, its required network configuration is properly cleaned up and removed to ensure effective release and management of network resources.\n\nThrough the example sequence diagrams and detailed explanations for ADD, CHECK, and DELETE operations, it\u0027s clear how interactions between the container runtime and CNI plugins facilitate dynamic management and updates of container network configurations.\n\n## Conclusion\n\nThe Container Network Interface (CNI) specification standardizes container network configuration in Kubernetes clusters, allowing container runtimes to interface with various network plugins seamlessly. Understanding CNI\u0027s core components and its collaboration with the Container Runtime Interface (CRI) is essential for effective network management in containerized environments.\n\n## References\n\n- [CNI Spec](https:\/\/github.com\/containernetworking\/cni\/blob\/main\/SPEC.md)\n\n---\n\n*This blog was initially published at [tetrate.io](https:\/\/tetrate.io\/blog\/envoy-microservices-overview\/)*.\n', '\/en\/blog\/cni-deep-dive\/')">
                <i class="fas fa-file-download"></i>
              </a>
             </li>
          </ul>
      </div>
      <p class="card-text">This article provides an in-depth explanation of the basic concepts of Container Network Interface (CNI), its core components, and its relationship with Container Runtime Interface (CRI).</p>
    </div>
  </article>
</div>


<script>
  function convertImageLinks(rawContent, permalink) {
      
      const baseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const blogPath = permalink.replace(/^\/|\/$/g, ''); 
      return rawContent.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, altText, relativePath) {
          
          if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {
              return match; 
          }
          return `![${altText}](${baseUrl}${blogPath}/${relativePath})`;
      });
  }
  
  function convertRelativeLinks(rawContent) {
      
      const domain = 'https://jimmysong.io'; 
      return rawContent.replace(/\[([^\]]+)\]\((\/[^)]+)\)/g, function(match, linkText, relativePath) {
          return `[${linkText}](${domain}${relativePath})`;
      });
  }
  
  function exportToMarkdown(title, description, rawContent, permalink) {
      const githubBaseUrl = 'https://raw.githubusercontent.com/rootsongjc/rootsongjc.github.io/master/'; 
      const filename = title + '.md';
  
      
      const convertedContent = convertImageLinks(rawContent, permalink);
      
      
      const contentWithLinks = convertRelativeLinks(convertedContent);
  
      
      const contentWithHeader = `> ${description}\n>\n> 阅读原文请转到：https://jimmysong.io${permalink}\n${contentWithLinks}`;
  
      
      const contentWithFooter = `${contentWithHeader}\n\n---\n`;
  
      
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(contentWithFooter));
      element.setAttribute('download', filename);
  
      element.style.display = 'none';
      document.body.appendChild(element);
  
      element.click();
  
      document.body.removeChild(element);
  }
  
  
  if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
      document.querySelectorAll('.export-button').forEach(function(button) {
          button.style.display = 'inline';
      });
  }
</script>
          
          <div class="col-12">
 
 
 
 
 
 
 
 
 
 
 
</div>

        </div>
      </div>
      <!-- sidebar -->
      <aside class="col-lg-4 order-1 order-lg-2 d-none d-sm-block">
          <div class="sidebar">
          <!-- categories -->
<div class="blog-categories mb-4">
  <p class="sidebar-title">
      Columns
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/en/categories/istio" class="sidebar-item">
            <span>Istio</span>
            <span>(42)</span>
        </a>
      
        <a href="/en/categories/service-mesh" class="sidebar-item">
            <span>Service Mesh</span>
            <span>(9)</span>
        </a>
      
        <a href="/en/categories/essays" class="sidebar-item">
            <span>Essays</span>
            <span>(5)</span>
        </a>
      
        <a href="/en/categories/cloud-native" class="sidebar-item">
            <span>Cloud Native</span>
            <span>(4)</span>
        </a>
      
        <a href="/en/categories/envoy" class="sidebar-item">
            <span>Envoy</span>
            <span>(4)</span>
        </a>
      
        <a href="/en/categories/ai" class="sidebar-item">
            <span>AI</span>
            <span>(2)</span>
        </a>
      
        <a href="/en/categories/kubernetes" class="sidebar-item">
            <span>Kubernetes</span>
            <span>(2)</span>
        </a>
      
        <a href="/en/categories/open-source" class="sidebar-item">
            <span>Open Source</span>
            <span>(2)</span>
        </a>
  </div>
</div>

<div class="blog-categories mb-4">
  <p class="sidebar-title">
      Book
  </p>
  
  
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
        
      
      
  
  <div class="bg-gray">
      
        <a href="/en/categories/translation" class="sidebar-item">
            <span>Translation</span>
            <span>(6)</span>
        </a>
      
        <a href="/en/categories/original" class="sidebar-item">
            <span>Original</span>
            <span>(2)</span>
        </a>
  </div>
</div>





          </div>
      </aside>
      <!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
  
  <div class="footer bg-footer section-sm border-bottom overlay ">
    <div class="container-xl">
      <div class="row">
        <div class="col col-xl-4 d-sm-none mb-2 mb-lg-0 d-xl-block d-none">
          
          <p class="h3 text-white mb-4 text-uppercase">Contact</p>
          
          <ul class="list-unstyled">
            
            
            <li class="mb-4 text-color">Jimmy&rsquo;s LinkedIn</li>
            
            
            <li class="mb-4"><img src="/images/jimmysong-linkedin.png" width="118px" height="118px" alt="footer image"></li>
            
            
            
          
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Blog</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/blog/seamless-cross-cluster-access-istio/">A Definitive Guide to Cross-Cluster Seamless Access in Multicluster Istio Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/how-to-integrate-third-party-registry-with-istio/">How to Integrating Third-Party Service Registries with Istio?</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/blog/envoy-gateway-oidc/">How to Implement Single Sign-On (SSO) with OIDC in API Gateway using Envoy Gateway?</a></li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">links</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="/awesome-cloud-native/" >
                  Awesome Cloud Native
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://gateway.envoyproxy.io" target="_blank" rel="noopener noreferrer">
                  Envoy Gateway
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://istio.io" target="_blank" rel="noopener noreferrer">
                  Istio
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://tetrate.io/?jimmysong" target="_blank" rel="noopener noreferrer">
                  Tetrate - Service Mesh Company
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://docs.tetrate.io/istio-subscription/" target="_blank" rel="noopener noreferrer">
                  Tetrate Istio Subscription
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">Courses</p>
          <ul class="list-unstyled">
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/envoy-fundamentals" target="_blank" rel="noopener noreferrer">
                  Envoy Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
            <li class="mb-3">
              <a class="text-color" href="https://academy.tetrate.io/courses/istio-fundamentals" target="_blank" rel="noopener noreferrer">
                  Istio Fundamentals
                  
                  <i class="fa-solid fa-arrow-up-right-from-square icon-small"></i>
                  
              </a>
            </li>
            
          </ul>
        </div>

        
        <div class="col col-xl-2 col-6 col-sm-3 mb-2">
          <p class="h3 text-white mb-4 text-uppercase">new notice</p>
          <ul class="list-unstyled">
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-china-2024-panel/">KubeCon China 2024 panel Preview: Istio and Modern API Gateways – Leading the Future of Service Mesh</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/website-revamp-notice/">Website Revamp Notice</a></li>
            
            <li class="mb-3"><a class="text-color" href="/en/notice/kubecon-eu-2024/">See you in KubeCon Paris!</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>

  
  <div class="copyright py-4 bg-footer overlay">
    <div class="container-xl">
      <div class="row">
        <div class="col-sm-6 text-sm-left text-center">
          <p class="mb-0 text-color">© 2017-2024 Jimmy Song All Right Reserved</p>
        </div>
        <div class="col-sm-6 text-sm-right text-center">
          <ul class="list-inline">
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://twitter.com/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-x-twitter text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/contact/" >
                    <i class="fa-brands fa-weixin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://github.com/rootsongjc" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-github text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="https://linkedin.com/in/jimmysongio" target="_blank" title="Social link" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="mailto:rootsongjc@gmail.com" >
                    <i class="fa-solid fa-envelope text-white"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a class="d-inline-block p-2" href="/blog/index.xml" >
                    <i class="fa-solid fa-rss text-white"></i>
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- JS Plugins -->

<script src="/plugins/popper/popper.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>

<script src="/plugins/anchor/anchor.min.js"></script>

<script src="/plugins/tocbot/tocbot.min.js"></script>

<script src="/plugins/bigger-picture/bigger-picture.min.js"></script>


<!-- Main Script -->

<script src="/js/script.min.f94c22b1d478bfc9e2e0a7d954429e47b7e6d36edd423758482e04154ae1842e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESY906ZWZ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ESY906ZWZ0');
</script>


<!-- Baidu analysis -->
<meta name="baidu-site-verification" content="g8IYR9SNLF" />


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>









<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>






  





<script src="/js/wowchemy-search.min.ce03c611044441cf6e84f9e4bef20818.js" type="module"></script>
<script id="search-hit-fuse-template" type="text/x-template">
  <div class="search-hit" id="summary-{{key}}">
    <div class="search-hit-content border-bottom">
      <div class="search-hit-name">
        <div class='search-hit-link'><a href="{{relpermalink}}">{{title}}</a></div>
        <div class="search-hit-metadata d-flex">
            <span class="mr-1"><i class="fa-regular fa-calendar mr-1"></i>{{date}}</span>
            <span class="mr-1"><i class="fa-regular fa-folder-open mr-1"></i>{{section}}</span>
            <span class="d-sm-block d-none"><i class="fa-solid fa-link mr-1"></i>{{relpermalink}}</span>
        </div>
        <div class="search-hit-description">{{snippet}}</div>
      </div>
    </div>
  </div>
</script>



    </body>
</html>
