<svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" width="1649" height="559" version="1.1" viewBox="40 -88 1649 559"><defs><marker id="FilledArrow_Marker" stroke-linejoin="miter" stroke-miterlimit="10" color="#000" markerHeight="8" markerUnits="strokeWidth" markerWidth="10" orient="auto" overflow="visible" viewBox="-1 -4 10 8"><g><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M 8 0 L 0 -3 L 0 3 Z"/></g></marker></defs><g id="non-istio-mesh-pod-taffic-go-into-the-mesh" fill="none" fill-opacity="1" stroke="none" stroke-dasharray="none" stroke-opacity="1"><title>non-istio-mesh-pod-taffic-go-into-the-mesh</title><rect width="1649" height="559" x="40" y="-88" fill="#fff"/><g id="non-istio-mesh-pod-taffic-go-into-the-mesh_Layer_1"><title>Layer 1</title><g id="Graphic_46"><path stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 79 -12 L 825.5285 -12 C 827.7376 -12 829.5285 -10.209139 829.5285 -8 L 829.5285 376.5 C 829.5285 378.70914 827.7376 380.5 825.5285 380.5 L 79 380.5 C 76.79086 380.5 75 378.70914 75 376.5 L 75 -8 C 75 -10.209139 76.79086 -12 79 -12 Z"/><text fill="#000" transform="translate(80 -7)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Node A</tspan></text></g><g id="Graphic_91"><path stroke="#000" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 626.4646 183.83447 L 792.4616 183.83447 L 792.4616 263.25823 L 626.4646 263.25823 Z"/><text fill="#000" transform="translate(631.4646 188.83447)"><tspan x="33.974" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Out of mesh</tspan></text></g><g id="Graphic_45"><rect width="660.495" height="34.275" x="131.966" y="321.256" fill="#dadada"/><text fill="#000" transform="translate(136.9661 329.16983)"><tspan x="268.208" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Kubernetes CNI</tspan></text></g><g id="Graphic_44"><rect width="660.495" height="34.275" x="131.966" y="275.12" fill="#dadada"/><text fill="#000" transform="translate(136.9661 283.03324)"><tspan x="294.44" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Istio CNI</tspan></text></g><g id="Graphic_43"><rect width="315.175" height="38.672" x="131.966" y="218.208" fill="#666"/><text fill="#fff" transform="translate(136.9661 228.32005)"><tspan x="130.659" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod A</tspan></text></g><g id="Graphic_42"><path fill="#456bb0" d="M 404.21383 37 L 520.21383 37 C 522.423 37 524.21383 38.79086 524.21383 41 L 524.21383 85 C 524.21383 87.20914 522.423 89 520.21383 89 L 404.21383 89 C 402.0047 89 400.21383 87.20914 400.21383 85 L 400.21383 41 C 400.21383 38.79086 402.0047 37 404.21383 37 Z"/><text fill="#fff" transform="translate(405.21383 53.267944)"><tspan x="22.624" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">ztunnel A</tspan></text></g><g id="Line_39"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 407.43077 189.76006 C 396.36257 173.76586 374.4557 150 342 150 C 313.6203 150 284.91753 168.17137 265.81936 183.42886"/></g><g id="Group_36"><g id="Graphic_38"><path fill="#ff8080" d="M 384.5981 218.20806 L 384.5981 195.34652 L 415.8695 183.9329 L 447.14093 195.34652 L 447.14093 218.20806 Z"/></g><g id="Graphic_37"><text fill="#fff" transform="translate(398.0775 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">9080</tspan></text></g></g><g id="Graphic_33"><rect width="141.962" height="38.672" x="638.482" y="218.11" fill="#666"/><text fill="#fff" transform="translate(643.4823 228.22163)"><tspan x="43.757" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod B</tspan></text></g><g id="Line_29"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 680.5068 218.10963 C 668.33056 214.14915 651.03416 210.2663 626.4646 207.22222 C 573.0874 200.60898 501.4903 199.9502 457.0399 200.327"/></g><g id="Graphic_28"><rect width="133.888" height="28.448" x="485.538" y="187.434" fill="#fff"/><text fill="#000" transform="translate(490.5382 192.43404)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">To Pod A IP:9080</tspan></text></g><g id="Graphic_47"><text fill="#000" transform="translate(79.99999 -56.19617)"><tspan x="0" y="23" fill="#000" font-family="Helvetica Neue" font-size="24" font-weight="bold" xml:space="preserve">Non-Istio Mesh Pod Taffic Go into the Mesh</tspan></text></g><g id="Graphic_49"><text fill="#000" transform="translate(80 396)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Iptables redirect the packets to the ports that ztunnel listening.</tspan></text></g><g id="Group_51"><g id="Graphic_53"><path fill="#ff8080" d="M 131.9661 218.10963 L 131.9661 195.2481 L 163.23752 183.83447 L 194.50894 195.2481 L 194.50894 218.10963 Z"/></g><g id="Graphic_52"><text fill="#fff" transform="translate(140.99752 194.66164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Graphic_54"><text fill="#000" transform="translate(80 424.448)"><tspan x="0" y="17" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Istio CNI will create a cross-netns socket for each Pod that listen on port 15001 </tspan> <tspan y="17" fill="#000" font-family="PingFang SC" font-size="16" xml:space="preserve">(outbound socket), 15006 (plaintext socket) and 15008 (HBONE socket).</tspan></text></g><g id="Line_55"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 234.57324 187.0849 C 224.49455 167.08404 214.25567 129.70884 257.64706 102.35294 C 290.39474 81.70732 345.56136 71.89255 390.35854 67.2269"/></g><g id="Graphic_58"><rect width="66.304" height="28.448" x="310.52" y="135.797" fill="#fff"/><text fill="#000" transform="translate(315.52 140.7971)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">iptables</tspan></text></g><g id="Graphic_59"><rect width="146.624" height="28.448" x="183.56" y="88.622" fill="#fff"/><text fill="#000" transform="translate(188.5598 93.62242)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">cross-netns socket</tspan></text></g><g id="Group_78"><g id="Graphic_80"><path fill="#ff8080" d="M 211.93778 218.20806 L 211.93778 195.34652 L 243.2092 183.9329 L 274.4806 195.34652 L 274.4806 218.20806 Z"/></g><g id="Graphic_79"><text fill="#fff" transform="translate(220.9692 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_84"><g id="Graphic_86"><path fill="#ff8080" d="M 291.90945 218.10963 L 291.90945 195.2481 L 323.18087 183.83447 L 354.4523 195.2481 L 354.4523 218.10963 Z"/></g><g id="Graphic_85"><text fill="#fff" transform="translate(300.94086 194.66164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g><g id="Line_90"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 467.0312 89 C 467.76845 101.22926 466.80706 116.9344 461.1111 134.26204 C 454.90573 153.13942 444.46015 169.74709 435.16855 182.01376"/></g><g id="Graphic_150"><path stroke="#a5a5a5" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 900 -12 L 1646.5285 -12 C 1648.7376 -12 1650.5285 -10.209139 1650.5285 -8 L 1650.5285 376.5 C 1650.5285 378.70914 1648.7376 380.5 1646.5285 380.5 L 900 380.5 C 897.7909 380.5 896 378.70914 896 376.5 L 896 -8 C 896 -10.209139 897.7909 -12 900 -12 Z"/><text fill="#000" transform="translate(901 -7)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Node A</tspan></text></g><g id="Graphic_149"><path stroke="#000" stroke-dasharray="4 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M 1447.4646 183.83447 L 1613.4616 183.83447 L 1613.4616 263.25823 L 1447.4646 263.25823 Z"/><text fill="#000" transform="translate(1452.4646 188.83447)"><tspan x="33.974" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Out of mesh</tspan></text></g><g id="Graphic_148"><rect width="660.495" height="34.275" x="952.966" y="321.256" fill="#dadada"/><text fill="#000" transform="translate(957.9661 329.16983)"><tspan x="268.208" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Kubernetes CNI</tspan></text></g><g id="Graphic_147"><rect width="660.495" height="34.275" x="952.966" y="275.12" fill="#dadada"/><text fill="#000" transform="translate(957.9661 283.03324)"><tspan x="294.44" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Istio CNI</tspan></text></g><g id="Graphic_146"><rect width="315.175" height="38.672" x="952.966" y="218.208" fill="#666"/><text fill="#fff" transform="translate(957.9661 228.32005)"><tspan x="130.659" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod A</tspan></text></g><g id="Graphic_145"><path fill="#456bb0" d="M 1225.2138 37 L 1341.2138 37 C 1343.423 37 1345.2138 38.79086 1345.2138 41 L 1345.2138 85 C 1345.2138 87.20914 1343.423 89 1341.2138 89 L 1225.2138 89 C 1223.0047 89 1221.2138 87.20914 1221.2138 85 L 1221.2138 41 C 1221.2138 38.79086 1223.0047 37 1225.2138 37 Z"/><text fill="#fff" transform="translate(1226.2138 53.267944)"><tspan x="22.624" y="16" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">ztunnel A</tspan></text></g><g id="Graphic_140"><rect width="141.962" height="38.672" x="1459.482" y="218.11" fill="#666"/><text fill="#fff" transform="translate(1464.4823 228.22163)"><tspan x="43.757" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">Pod B</tspan></text></g><g id="Group_134"><g id="Graphic_136"><path fill="#ff8080" d="M 952.9661 218.10963 L 952.9661 195.2481 L 984.2375 183.83447 L 1015.509 195.2481 L 1015.509 218.10963 Z"/></g><g id="Graphic_135"><text fill="#fff" transform="translate(961.9975 194.66164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15001</tspan></text></g></g><g id="Line_133"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 1122.806 189.66164 C 1094.4442 169.0719 1051.002 130.3664 1078.647 102.35294 C 1100.599 80.10849 1161.6211 70.435345 1211.3463 66.23028"/></g><g id="Graphic_131"><rect width="146.624" height="28.448" x="1005.17" y="88.297" fill="#fff"/><text fill="#000" transform="translate(1010.17 93.29715)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">cross-netns socket</tspan></text></g><g id="Group_128"><g id="Graphic_130"><path fill="#ff8080" d="M 1032.9378 218.20806 L 1032.9378 195.34652 L 1064.2092 183.9329 L 1095.4806 195.34652 L 1095.4806 218.20806 Z"/></g><g id="Graphic_129"><text fill="#fff" transform="translate(1041.9692 194.76006)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15006</tspan></text></g></g><g id="Group_125"><g id="Graphic_127"><path fill="#ff8080" d="M 1112.9094 218.10963 L 1112.9094 195.2481 L 1144.1809 183.83447 L 1175.4523 195.2481 L 1175.4523 218.10963 Z"/></g><g id="Graphic_126"><text fill="#fff" transform="translate(1121.9409 194.66164)"><tspan x="0" y="15" fill="#fff" font-family="Helvetica Neue" font-size="16" xml:space="preserve">15008</tspan></text></g></g><g id="Line_151"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" marker-end="url(#FilledArrow_Marker)" d="M 1473.2705 218.10963 C 1443.3384 209.90409 1402.6271 201.1766 1353.4653 196.53465 C 1287.2319 190.28075 1224.5102 193.22233 1185.3106 196.51948"/></g><g id="Graphic_152"><rect width="142.784" height="28.448" x="1260.567" y="180.582" fill="#fff"/><text fill="#000" transform="translate(1265.5672 185.582)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">To Pod A IP:15008</tspan></text></g><g id="Graphic_153"><rect width="62.768" height="28.448" x="1032.713" y="66.492" fill="#fff"/><text fill="#000" transform="translate(1037.7126 71.49245)"><tspan x="0" y="15" fill="#000" font-family="Helvetica Neue" font-size="16" xml:space="preserve">0x539?</tspan></text></g></g></g></svg>