<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song&#39;s Cloud Native Blog – 使用 Helm 安装</title>
    <link>https://jimmysong.io/book/tsb/setup/helm/</link>
    <description>Recent content in 使用 Helm 安装 on Jimmy Song&#39;s Cloud Native Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Wed, 09 Aug 2023 12:00:00 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/book/tsb/setup/helm/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>TSB Helm Chart</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/helm/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/book/tsb/setup/helm/helm/</guid>
      <description>
        
        
        &lt;h2 id=&#34;概述&#34;&gt;概述&lt;/h2&gt;
&lt;p&gt;本文介绍如何使用 &lt;a href=&#34;https://helm.sh&#34; title=&#34;Helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt;
 Charts 来安装 Tetrate Service Bridge (TSB) 的不同组件。假设你的系统上已经安装了 &lt;a href=&#34;https://helm.sh/docs/intro/install/&#34; title=&#34;Helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt;
。&lt;/p&gt;
&lt;p&gt;TSB 为其每一个&lt;a href=&#34;../../../concepts/architecture&#34; title=&#34;平面&#34;&gt;平面&lt;/a&gt;
 都提供了 Chart：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;../managementplane&#34; title=&#34;管理平面&#34;&gt;管理平面&lt;/a&gt;
：安装 TSB 管理平面 Operator（可选择安装 MP CR 和/或密钥）。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../controlplane&#34; title=&#34;控制平面&#34;&gt;控制平面&lt;/a&gt;
：安装 TSB 控制平面 Operator（可选择安装 MP CR 和/或密钥）。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../dataplane&#34; title=&#34;数据平面&#34;&gt;数据平面&lt;/a&gt;
：安装 TSB 数据平面 Operator。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每个 Chart 都安装了相应平面的 Operator。管理平面和控制平面都允许创建触发 Operator 的相应资源（使用 &lt;code&gt;spec&lt;/code&gt; 属性）以部署所有 TSB 组件和/或必需的密钥（使用 &lt;code&gt;secrets&lt;/code&gt; 属性）以使其正常运行。&lt;/p&gt;
&lt;p&gt;这种行为让你选择完全配置 TSB 并与 CD 流水线集成的方式。你可以使用 Helm 来：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;仅安装 Operator&lt;/li&gt;
&lt;li&gt;安装/升级平面资源（管理平面或控制平面 CR）以及 Operator&lt;/li&gt;
&lt;li&gt;安装/升级Operator和密钥&lt;/li&gt;
&lt;li&gt;一次安装/升级它们（Operator、资源、密钥）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关于密钥，要牢记 &lt;code&gt;helm install/upgrade&lt;/code&gt; 命令接受可以由不同来源提供的不同文件，使用其中一个源提供规范，另一个源提供密钥。&lt;/p&gt;
&lt;p&gt;还有一个额外的配置 (&lt;code&gt;secrets.keep&lt;/code&gt;)，用于保留已安装的密钥并避免删除它们。有了这个功能，密钥只需应用一次，以后的升级不会删除它们。&lt;/p&gt;
&lt;p&gt;默认情况下，Helm Chart 还会安装 TSB CRD。如果你希望跳过 CRD 安装步骤，可以传递 &lt;code&gt;--skip-crds&lt;/code&gt; 标志。&lt;/p&gt;
&lt;h2 id=&#34;安装过程&#34;&gt;安装过程&lt;/h2&gt;
&lt;h3 id=&#34;先决条件&#34;&gt;先决条件&lt;/h3&gt;
&lt;p&gt;在开始之前，请确保你已经：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;检查了&lt;a href=&#34;../../requirements-and-download&#34; title=&#34;要求&#34;&gt;要求&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;安装了 &lt;a href=&#34;https://helm.sh/docs/intro/install/&#34; title=&#34;Helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;安装了 &lt;a href=&#34;https://kubernetes.io/docs/tasks/tools/#kubectl&#34; title=&#34;kubectl&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubectl&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../../requirements-and-download&#34; title=&#34;同步&#34;&gt;同步&lt;/a&gt;
 了 Tetrate Service Bridge 镜像&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;配置-helm-存储库&#34;&gt;配置 Helm 存储库&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;添加存储库：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add tetrate-tsb-helm &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://charts.dl.tetrate.io/public/helm/charts/&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;列出可用版本：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm search repo tetrate-tsb-helm -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;安装&#34;&gt;安装&lt;/h3&gt;
&lt;p&gt;前往 &lt;a href=&#34;../managementplane&#34; title=&#34;管理平面安装&#34;&gt;管理平面安装&lt;/a&gt;
 来安装 &lt;a href=&#34;../../components&#34; title=&#34;TSB 管理平面组件&#34;&gt;TSB 管理平面组件&lt;/a&gt;
。&lt;/p&gt;
&lt;p&gt;前往 &lt;a href=&#34;../controlplane&#34; title=&#34;控制平面安装&#34;&gt;控制平面安装&lt;/a&gt;
 以将 &lt;a href=&#34;../../components&#34; title=&#34;TSB 控制平面组件&#34;&gt;TSB 控制平面组件&lt;/a&gt;
 安装到你的应用程序集群中。这将引入你的应用程序集群到 TSB 中。&lt;/p&gt;
&lt;p&gt;前往 &lt;a href=&#34;../dataplane&#34; title=&#34;数据平面安装&#34;&gt;数据平面安装&lt;/a&gt;
 来安装将管理网关生命周期的 &lt;a href=&#34;../../components&#34; title=&#34;TSB 数据平面组件&#34;&gt;TSB 数据平面组件&lt;/a&gt;
 到你的应用程序集群中。&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  基于版本的控制平面
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  当你使用基于版本的控制平面时，不再需要 Data Plane Operator 来管理 Istio 网关，你可以跳过数据平面安装。要了解有关基于版本的控制平面的更多信息，请前往 &lt;a href=&#34;../../isolation-boundaries&#34; title=&#34;Istio 隔离边界&#34;&gt;Istio 隔离边界&lt;/a&gt;
。
&lt;/div&gt;
&lt;/div&gt;


      </description>
    </item>
    
    <item>
      <title>管理平面安装</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/managementplane/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/book/tsb/setup/helm/managementplane/</guid>
      <description>
        
        
        &lt;p&gt;此 Chart 安装 TSB 管理平面 Operator，还允许你使用 &lt;a href=&#34;../../../refs/install/managementplane/v1alpha1/spec&#34; title=&#34;TSB &amp;lt;code&amp;gt;ManagementPlane&amp;lt;/code&amp;gt; CR&#34;&gt;TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR&lt;/a&gt;
 安装 TSB 管理平面组件以及使其完全运行所需的所有秘密。&lt;/p&gt;
&lt;p&gt;在开始之前，请确保你已经查看了 &lt;a href=&#34;../helm&#34; title=&#34;Helm 安装过程&#34;&gt;Helm 安装过程&lt;/a&gt;
。&lt;/p&gt;
&lt;h2 id=&#34;安装概述&#34;&gt;安装概述&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建一个 &lt;code&gt;values.yaml&lt;/code&gt; 文件并使用所需的配置进行编辑。你可以在下面的配置部分中找到有关可用 Helm 配置的更多详细信息。有关 &lt;code&gt;spec&lt;/code&gt; 部分的完整参考，请参阅 &lt;a href=&#34;../../../refs/install/managementplane/v1alpha1/spec#tetrateio-api-install-managementplane-v1alpha1-managementplanespec&#34; title=&#34;TSB &amp;lt;code&amp;gt;ManagementPlane&amp;lt;/code&amp;gt; CR&#34;&gt;TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR&lt;/a&gt;
。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用 &lt;code&gt;helm install&lt;/code&gt; 命令安装 TSB 管理平面。确保将 &lt;code&gt;image.registry&lt;/code&gt; 和 &lt;code&gt;version&lt;/code&gt; 设置为正确的注册表位置和 TSB 版本。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;等待所有 TSB 管理平面组件成功部署。你可以尝试登录 TSB UI 或使用 &lt;a href=&#34;../../tctl-connect&#34; title=&#34;tctl&#34;&gt;tctl&lt;/a&gt;
 来验证你的安装。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;p&gt;要安装 TSB 管理平面，请创建一个 &lt;code&gt;values.yaml&lt;/code&gt; 文件，包含以下内容，并根据你的需求进行编辑。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 设置组织名称。组织名称必须小写以符合 RFC 标准。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;organization-name&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dataStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;postgres-hostname-or-ip&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;postgres-port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;database-name&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;telemetryStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;elastic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;elastic-hostname-or-ip&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;elastic-port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;elastic-version&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;is-elastic-use-self-signed-certificate&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# TSB 支持 OIDC 和 LDAP 作为身份提供者。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 根据你的环境进行设置。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;identityProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 启用自动证书管理。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 如果要使用其他方法管理证书，可以删除此字段。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 请注意，在这种情况下，你将需要提供证书作为机密。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certIssuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterIntermediateCAs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# TSB 管理平面的默认端口是 8443。你可以在此处更改它。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;frontEnvoy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 启用 oap 流式日志功能&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;oap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;streamingLogEnabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;adminPassword&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-admin-password&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;postgres-username&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;postgres-password&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 根据你的 IdP，你需要在此处设置所需的秘密。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后，使用以下 &lt;code&gt;helm install&lt;/code&gt; 命令安装 TSB 管理平面。此安装可能需要最多 10 分钟才能完成。确保用正确的值替换 &lt;code&gt;&amp;lt;tsb-version&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;registry-location&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install mp tetrate-tsb-helm/managementplane &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --version &amp;lt;tsb-version&amp;gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace tsb  --create-namespace &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --values values.yaml &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --timeout 10m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set image.registry&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;registry-location&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;非生产外部依赖&#34;&gt;非生产外部依赖&lt;/h3&gt;
&lt;p&gt;如果在 &lt;code&gt;values.yaml&lt;/code&gt; 文件中省略了 &lt;code&gt;dataStore&lt;/code&gt;、&lt;code&gt;telemetryStore&lt;/code&gt; 和 &lt;code&gt;identityProvider&lt;/code&gt; 字段，TSB 将安装非生产 Postgres、Elasticsearch 和 LDAP。请注意，你仍然需要设置正确的秘密和凭据以使用存储。&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-warning-title py-1 px-2&#34;&gt;
  注意
&lt;/div&gt;

&lt;div class=&#34;alert-warning py-1 px-2&#34;&gt;
  请勿在生产环境中使用非生产存储和身份提供者。
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;以下是演示安装的 &lt;code&gt;values.yaml&lt;/code&gt; 文件的示例完成内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;organization-name&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 启用自动证书管理。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certIssuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterIntermediateCAs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;adminPassword&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-admin-password&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb-postgres-password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ldap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;binddn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cn=admin,dc=tetrate,dc=io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;bindpassword&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;访问-tsb-管理平面&#34;&gt;访问 TSB 管理平面&lt;/h2&gt;
&lt;p&gt;完成安装后，你可以通过登录到 TSB UI 或使用 &lt;a href=&#34;../../tctl-connect&#34; title=&#34;tctl&#34;&gt;tctl&lt;/a&gt;
 来访问 TSB 管理平面。&lt;/p&gt;
&lt;h2 id=&#34;故障排除&#34;&gt;故障排除&lt;/h2&gt;
&lt;p&gt;如果在安装过程中遇到任何问题，请检查以下几点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;确保你在 &lt;code&gt;values.yaml&lt;/code&gt; 文件中输入了正确的值。&lt;/li&gt;
&lt;li&gt;验证你在 &lt;code&gt;helm install&lt;/code&gt; 命令中使用的注册表位置和 TSB 版本是否正确。&lt;/li&gt;
&lt;li&gt;如果你使用自定义身份提供者，请确保你在 &lt;code&gt;values.yaml&lt;/code&gt; 文件的 secrets 部分设置了所有所需的 &lt;code&gt;secrets&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;如果无法连接到 TSB，请确保所有 TSB 组件都已成功部署，日志中没有错误。&lt;/li&gt;
&lt;li&gt;如果你使用私有注册表来托管 TSB 控制平面 Operator 镜像，请确保已对注册表进行身份验证，并且 &lt;code&gt;image.registry&lt;/code&gt; 值正确。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;配置&#34;&gt;配置&lt;/h2&gt;
&lt;h3 id=&#34;镜像配置&#34;&gt;镜像配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;必填&lt;/strong&gt; 字段。将 &lt;code&gt;image.registry&lt;/code&gt; 设置为你的私有注册表位置，你已经同步了 TSB 镜像，将 &lt;code&gt;image.tag&lt;/code&gt; 设置为要部署的 TSB 版本。仅指定此字段将安装 TSB 控制平面 Operator，而不安装其他 TSB 组件。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;image.registry&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于下载 Operator 镜像的注册表。必填&lt;/td&gt;
&lt;td&gt;&lt;code&gt;containers.dl.tetrate.io&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;image.tag&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Operator 镜像的标签。必填&lt;/td&gt;
&lt;td&gt;&lt;em&gt;与 Chart 版本相同&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;管理平面资源配置&#34;&gt;管理平面资源配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 字段。你可以在 Helm 值文件中设置 &lt;a href=&#34;../../../refs/install/managementplane/v1alpha1/spec##tetrateio-api-install-managementplane-v1alpha1-managementplanespec&#34; title=&#34;TSB &amp;lt;code&amp;gt;ManagementPlane&amp;lt;/code&amp;gt; CR &amp;lt;code&amp;gt;spec&amp;lt;/code&amp;gt;&#34;&gt;TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR &lt;code&gt;spec&lt;/code&gt;&lt;/a&gt;
，以使 TSB 管理平面完全运行。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;spec&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;包含 &lt;code&gt;ManagementPlane&lt;/code&gt; CR 的 &lt;code&gt;spec&lt;/code&gt; 部分。可选&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;秘密配置&#34;&gt;秘密配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 字段。你可以在安装 TSB 管理平面之前将秘密应用到你的集群中，或者你可以使用 Helm 值来指定所需的秘密。请注意，如果要将秘密与管理平面规范分开，则可以使用不同的 Helm 值文件。&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  注意
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  请记住，这些选项只是帮助创建秘密的选项，它们必须遵守 TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR 中提供的配置，否则安装将配置不正确。
&lt;/div&gt;
&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.keep&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;启用此选项将使生成的秘密在卸载 Chart 后持续存在于集群中，如果它们在将来的更新中未提供，则不会删除它们。 (参见 &lt;a href=&#34;https://helm.sh/docs/howto/charts_tips_and_tricks/#tell-helm-not-to-uninstall-a-resource&#34; title=&#34;Helm 文档&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm 文档&lt;/a&gt;
)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.tsb.adminPassword&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;为 &lt;code&gt;admin&lt;/code&gt; 用户配置的密码。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.tsb.cert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;管理平面 (front envoy) 暴露的 TLS 证书。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.tsb.key&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;管理平面 (front envoy) 暴露的 TLS 证书的密钥。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.postgres.username&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Postgres 数据库的用户名。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.postgres.password&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Postgres 数据库的密码。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.postgres.cacert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于验证 Postgres 数据库提供的 TLS 证书的 CA 证书。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.postgres.clientcert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Postgres 数据库所需的客户端证书。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.postgres.clientkey&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Postgres 数据库所需的客户端证书的密钥。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.elasticsearch.username&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Elasticsearch 所需的用户名。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.elasticsearch.password&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Elasticsearch 所需的密码。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.elasticsearch.cacert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于验证 Elasticsearch 提供的 TLS 证书的 CA 证书。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.ldap.binddn&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于从 LDAP IDP 中读取的绑定 DN。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.ldap.bindpassword&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于从 LDAP IDP 中读取的绑定 DN 的提供密码。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.ldap.cacert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于验证 LDAP IDP 提供的 TLS 证书的 CA 证书。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.oidc.clientSecret&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于连接到配置的 OIDC 的客户端密钥。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.oidc.deviceClientSecret&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于连接到配置的 OIDC 的设备客户端密钥。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.azure.clientSecret&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于连接到 Azure OIDC 的客户端密钥。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;xcp-秘密配置&#34;&gt;XCP 秘密配置&lt;/h4&gt;
&lt;p&gt;XCP 使用 TLS 和 JWT 在 Edge 和 Central 之间进行身份验证。&lt;/p&gt;
&lt;p&gt;如果 &lt;code&gt;secrets.xcp.autoGenerateCerts&lt;/code&gt; 已 &lt;strong&gt;禁用&lt;/strong&gt;，则用户必须提供 XCP Central 的证书和密钥，使用 &lt;code&gt;secrets.xcp.central.cert&lt;/code&gt; 和 &lt;code&gt;secrets.xcp.central.key&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;此外，用户可以选择提供 CA，使用 &lt;code&gt;secrets.xcp.rootca&lt;/code&gt; 允许 MPC 组件使用它来验证 XCP Central 提供的证书。&lt;/p&gt;
&lt;p&gt;如果 &lt;code&gt;secrets.xcp.autoGenerateCerts&lt;/code&gt; 已 &lt;strong&gt;启用&lt;/strong&gt;，则需要 Cert Manager 来提供 XCP Central 证书。&lt;/p&gt;
&lt;p&gt;然后，&lt;code&gt;secrets.xcp.rootca&lt;/code&gt; 和 &lt;code&gt;secrets.xcp.rootcakey&lt;/code&gt; 将用于创建正确的 Issuer 并生成 XCP Central 的证书，并与 MPC 共享 CA，以允许其验证 XCP Central 生成的证书。&lt;/p&gt;
&lt;p&gt;以下属性允许用于配置 XCP 身份验证模式：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.xcp.autoGenerateCerts&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;启用此选项将自动生成 XCP Central 的 TLS 证书。需要 cert-manager&lt;/td&gt;
&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.xcp.rootca&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;XCP 组件的 CA 证书。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>控制平面安装</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/controlplane/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/book/tsb/setup/helm/controlplane/</guid>
      <description>
        
        
        &lt;p&gt;此 Chart 安装 TSB 控制平面 Operator 以将集群引入。与&lt;a href=&#34;../managementplane&#34; title=&#34;管理平面 Helm Chart&#34;&gt;管理平面 Helm Chart&lt;/a&gt;
类似，它还允许你使用&lt;a href=&#34;../../../refs/install/controlplane/v1alpha1/spec&#34; title=&#34;TSB &amp;lt;code&amp;gt;ControlPlane&amp;lt;/code&amp;gt; CR&#34;&gt;TSB &lt;code&gt;ControlPlane&lt;/code&gt; CR&lt;/a&gt;
安装 TSB 控制平面组件，以及使其正常运行所需的所有密钥。&lt;/p&gt;
&lt;p&gt;在开始之前，请确保你已完成以下操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;检查 &lt;a href=&#34;../helm&#34; title=&#34;Helm 安装过程&#34;&gt;Helm 安装过程&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../managementplane&#34; title=&#34;已安装 TSB 管理平面&#34;&gt;已安装 TSB 管理平面&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../../tctl-connect&#34; title=&#34;使用 tctl 登录到管理平面&#34;&gt;使用 tctl 登录到管理平面&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;安装 &lt;a href=&#34;https://github.com/mikefarah/yq#install&#34; title=&#34;yq&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;yq&lt;/a&gt;
。这将用于从创建集群响应中获取 Helm 值。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  隔离边界
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  &lt;p&gt;TSB 1.6 引入了隔离边界，允许你在 Kubernetes 集群内或跨多个集群中拥有多个 TSB 管理的 Istio 环境。隔离边界的好处之一是你可以执行控制平面的金丝雀升级。&lt;/p&gt;
&lt;p&gt;要启用隔离边界，你必须使用环境变量 &lt;code&gt;ISTIO_ISOLATION_BOUNDARIES=true&lt;/code&gt; 更新 Operator 部署，并在控制平面 CR 中包括 &lt;code&gt;isolationBoundaries&lt;/code&gt; 字段。
有关更多信息，请参见&lt;a href=&#34;../../isolation-boundaries&#34; title=&#34;隔离边界&#34;&gt;隔离边界&lt;/a&gt;
。&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;先决条件&#34;&gt;先决条件&lt;/h2&gt;
&lt;p&gt;在开始之前，你需要创建一个 &lt;a href=&#34;../../../refs/tsb/v2/cluster&#34; title=&#34;集群对象&#34;&gt;集群对象&lt;/a&gt;
 在 TSB 中表示你将安装 TSB 控制平面的集群。将 &lt;code&gt;&amp;lt;cluster-name-in-tsb&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;organization-name&amp;gt;&lt;/code&gt; 替换为你的环境中的正确值：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;cluster-name-in-tsb&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;organization-name&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;displayName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;App Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;要创建集群对象，请运行以下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl apply -f cluster.yaml -o yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; yq .spec.installTemplate.helm &amp;gt; cluster-cp-values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;文件 cluster-cp-values.yaml 包含了 TSB 控制平面 Operator 的默认配置，包括与 TSB 管理平面进行身份验证所需的任何必要密钥。要自定义安装，你可以通过在继续下一步之前向此文件添加所需的额外配置值来修改此文件。&lt;/p&gt;
&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;p&gt;使用以下 helm install 命令安装 TSB 控制平面。确保替换 &lt;code&gt;&amp;lt;tsb-version&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;registry-location&amp;gt;&lt;/code&gt; 为正确的值。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install cp tetrate-tsb-helm/controlplane &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --version &amp;lt;tsb-version&amp;gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace istio-system --create-namespace &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --timeout 5m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --values cluster-cp-values.yaml &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set image.registry&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;registry-location&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;等待 TSB 控制平面组件成功部署。要验证安装是否成功，你可以尝试登录到 TSB UI 或使用 &lt;a href=&#34;../../tctl-connect&#34; title=&#34;tctl&#34;&gt;tctl&lt;/a&gt;
 连接到 TSB，然后检查集群列表，看看是否已经加入了集群。&lt;/p&gt;
&lt;h2 id=&#34;故障排除&#34;&gt;故障排除&lt;/h2&gt;
&lt;p&gt;如果在安装过程中遇到任何问题，请尝试以下几种故障排除方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;确保按照正确的顺序执行了所有步骤。&lt;/li&gt;
&lt;li&gt;仔细检查 &lt;code&gt;cluster-cp-values.yaml&lt;/code&gt; 文件中的配置值，确保它们是正确的。&lt;/li&gt;
&lt;li&gt;检查 TSB 控制平面 Operator 的日志，查看是否有任何错误消息或堆栈跟踪，以帮助诊断问题。&lt;/li&gt;
&lt;li&gt;如果你正在使用私有注册表来托管 TSB 控制平面 Operator 镜像，请确保已在&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注册表进行了身份验证，并且 &lt;code&gt;image.registry&lt;/code&gt; 值是正确的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;检查集群引入故障排除 &lt;a href=&#34;../../../troubleshooting/cluster-onboarding&#34; title=&#34;指南&#34;&gt;指南&lt;/a&gt;
。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;配置&#34;&gt;配置&lt;/h2&gt;
&lt;h3 id=&#34;镜像配置&#34;&gt;镜像配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;必填&lt;/strong&gt; 字段。将 &lt;code&gt;registry&lt;/code&gt; 设置为你同步了 TSB 镜像的私有注册表，将 &lt;code&gt;tag&lt;/code&gt; 设置为要部署的 TSB 版本。仅指定此字段将安装 TSB 控制平面 Operator，而不安装其他 TSB 组件。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;image.registry&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于下载 Operator 镜像的注册表&lt;/td&gt;
&lt;td&gt;&lt;code&gt;containers.dl.tetrate.io&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;image.tag&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Operator 镜像的标签&lt;/td&gt;
&lt;td&gt;&lt;em&gt;与 Chart 版本相同&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;控制平面资源配置&#34;&gt;控制平面资源配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 字段。你可以在 Helm 值文件中设置 &lt;a href=&#34;../../../refs/install/controlplane/v1alpha1/spec&#34; title=&#34;TSB &amp;lt;code&amp;gt;ControlPlane&amp;lt;/code&amp;gt; CR&#34;&gt;TSB &lt;code&gt;ControlPlane&lt;/code&gt; CR&lt;/a&gt;
，以使 TSB 控制平面正常运行。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;spec&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;包含 &lt;code&gt;ControlPlane&lt;/code&gt; CR 的 &lt;code&gt;spec&lt;/code&gt; 部分&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;密钥配置&#34;&gt;密钥配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 字段。你可以在安装 TSB 控制平面之前将密钥应用到你的集群，或者你可以使用 Helm 值来指定所需的密钥。请注意，如果要将密钥与控制平面规范分开，可以使用不同的 Helm 值文件。&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-warning-title py-1 px-2&#34;&gt;
  注意
&lt;/div&gt;

&lt;div class=&#34;alert-warning py-1 px-2&#34;&gt;
  请牢记这些选项只有助于创建密钥，并且必须遵守 TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR 中提供的配置，否则安装将配置不正确。
&lt;/div&gt;
&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.keep&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;启用此选项会在卸载 Chart 后使生成的密钥持久存在于集群中，如果它们在未来的更新中没有提供的话。（请参阅 &lt;a href=&#34;https://helm.sh/docs/howto/charts_tips_and_tricks/#tell-helm-not-to-uninstall-a-resource&#34; title=&#34;Helm 文档&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm 文档&lt;/a&gt;
）&lt;/td&gt;
&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.tsb.cacert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于验证公开的管理平面（前端 envoy）TLS 证书的 CA 证书&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.elasticsearch.username&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Elasticsearch 的用户名&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.elasticsearch.password&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;访问 Elasticsearch 的密码&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.elasticsearch.cacert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;控制平面用于验证 TLS 连接的 Elasticsearch CA 证书&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.oapToken&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于对接口进行身份验证的 JWT 令牌，该接口与管理平面（OAP）交互&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.otelToken&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于对接口进行身份验证的 JWT 令牌，该接口与管理平面（Otel Collector）交互&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.clusterServiceAccount.clusterFQN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;集群资源的 TSB FQN。这将为所有控制平面代理生成令牌。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.clusterServiceAccount.JWK&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于生成和签名所有控制平面代理令牌的文字 JWK&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.clusterServiceAccount.encodedJWK&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于生成和签名所有控制平面代理令牌的 Base64 编码 JWK&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;xcp-密钥配置&#34;&gt;XCP 密钥配置&lt;/h4&gt;
&lt;p&gt;XCP 使用 JWT 进行 Edge 和 Central 之间的身份验证。&lt;/p&gt;
&lt;p&gt;如果提供了 XCP 根 CA (&lt;code&gt;secrets.xcp.rootca&lt;/code&gt;)，它将用于验证 XCP Central 提供的 TLS 证书。&lt;/p&gt;
&lt;p&gt;此外，需要 &lt;code&gt;secrets.xcp.edge.token&lt;/code&gt; 或 &lt;code&gt;secrets.clusterServiceAccount&lt;/code&gt; 以对接 XCP Central 进行身份验证。&lt;/p&gt;
&lt;p&gt;以下是允许用于配置 XCP 身份验证模式的配置属性：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.xcp.rootca&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;XCP 组件的 CA 证书&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.xcp.edge.token&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于对接 XCP Edge 和 XCP Central 进行身份验证的 JWT 令牌&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;secrets.clusterServiceAccount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于生成和签名所有控制平面代理令牌的 Base64 编码 JWK&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;operator-扩展配置&#34;&gt;Operator 扩展配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 字段。你可以使用以下可选属性自定义 TSB Operator 相关资源，如部署、服务或服务帐户：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.affinity&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Pod 的亲和性配置&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.annotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要添加到部署的自定义注释集&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.env&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要添加到容器的自定义环境变量集&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.podAnnotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要添加到 Pod 的自定义注释集&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.replicaCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;部署管理的副本数&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.strategy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要使用的部署策略&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.tolerations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;适用于 Pod 调度的耐受性集合&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.podSecurityContext&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;应用于 Pod 的 &lt;a href=&#34;../../../refs/install/kubernetes/k8s#tetrateio-api-install-kubernetes-podsecuritycontext&#34; title=&#34;SecurityContext&#34;&gt;SecurityContext&lt;/a&gt;
 属性&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.containerSecurityContext&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;应用于 Pod 的容器的 &lt;a href=&#34;../../../refs/install/kubernetes/k8s#tetrateio-api-install-kubernetes-securitycontext&#34; title=&#34;SecurityContext&#34;&gt;SecurityContext&lt;/a&gt;
 属性&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.service.annotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要添加到服务的自定义注释集&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.serviceAccount.annotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要添加到服务帐户的自定义注释集&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.serviceAccount.imagePullSecrets&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;从注册表拉取镜像所需的密钥名称集合&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.pullSecret&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;JSON 编码的 Docker 配置，将存储为镜像拉取密钥&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>数据平面安装</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/dataplane/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/book/tsb/setup/helm/dataplane/</guid>
      <description>
        
        
        &lt;p&gt;此 Chart 安装 TSB 数据平面 Operator，用于管理 &lt;a href=&#34;../../../refs/install/dataplane/v1alpha1/spec&#34; title=&#34;网关&#34;&gt;网关&lt;/a&gt;
，如 Ingress 网关、Tier-1 网关和 Egress 网关的生命周期。&lt;/p&gt;
&lt;div class=&#34;alert&#34;&gt;

&lt;div class=&#34;alert-note-title py-1 px-2&#34;&gt;
  注意
&lt;/div&gt;

&lt;div class=&#34;alert-note py-1 px-2&#34;&gt;
  如果你正在使用基于版本的控制平面，则不再需要数据平面 Operator 来管理 Istio 网关。要了解有关基于版本的控制平面的更多信息，请参阅 &lt;a href=&#34;../../isolation-boundaries&#34; title=&#34;Istio 隔离边界&#34;&gt;Istio 隔离边界&lt;/a&gt;
 文档。
&lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;p&gt;要安装数据平面 Operator，请运行以下 Helm 命令。确保将 &lt;code&gt;&amp;lt;tsb-version&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;registry-location&amp;gt;&lt;/code&gt; 替换为正确的值。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install dp tetrate-tsb-helm/dataplane &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --version &amp;lt;tsb-version&amp;gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace istio-gateway --create-namespace &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set image.registry&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;registry-location&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;配置&#34;&gt;配置&lt;/h2&gt;
&lt;h3 id=&#34;镜像配置&#34;&gt;镜像配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;必填&lt;/strong&gt; 字段。将 &lt;code&gt;image.registry&lt;/code&gt; 设置为你的私有注册表位置，你已经同步了 TSB 镜像，将 &lt;code&gt;image.tag&lt;/code&gt; 设置为要部署的 TSB 版本。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;image.registry&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于下载 Operator 镜像的注册表&lt;/td&gt;
&lt;td&gt;&lt;code&gt;containers.dl.tetrate.io&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;image.tag&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Operator 镜像的标签&lt;/td&gt;
&lt;td&gt;&lt;em&gt;与图表版本相同&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;operator-扩展配置&#34;&gt;Operator 扩展配置&lt;/h3&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 字段。你可以使用以下可选属性自定义与 TSB Operator 相关的资源，如部署、服务或服务帐户：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.affinity&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用于 pod 的亲和性配置&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.annotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;自定义的注释集，用于添加到部署中&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.env&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;自定义的环境变量集，用于添加到容器中&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.podAnnotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;自定义的注释集，用于添加到 pod 中&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.replicaCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;部署管理的副本数量&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.strategy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要使用的部署策略&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.tolerations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;适用于 pod 调度的容忍集合&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.podSecurityContext&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;../../../refs/install/kubernetes/k8s#tetrateio-api-install-kubernetes-podsecuritycontext&#34; title=&#34;SecurityContext&#34;&gt;SecurityContext&lt;/a&gt;
 用于应用于 pod 的属性&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.deployment.containerSecurityContext&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;../../../refs/install/kubernetes/k8s#tetrateio-api-install-kubernetes-securitycontext&#34; title=&#34;SecurityContext&#34;&gt;SecurityContext&lt;/a&gt;
 用于应用于 pod 的容器的属性&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.service.annotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;自定义的注释集，用于添加到服务中&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.serviceAccount.annotations&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;自定义的注释集，用于添加到服务帐户中&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.serviceAccount.imagePullSecrets&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;需要能够从注册表中拉取镜像的密钥名称集合&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;operator.pullSecret&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;将存储为镜像拉取密钥的 Docker JSON 配置字符串&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>TSB Helm 升级</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/upgrade/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/book/tsb/setup/helm/upgrade/</guid>
      <description>
        
        
        &lt;p&gt;本文档解释了如何利用 &lt;a href=&#34;https://helm.sh&#34; title=&#34;Helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt;
 Chart 来升级 TSB 的不同元素。本文假定 &lt;a href=&#34;https://helm.sh/docs/intro/install/&#34; title=&#34;Helm 已经安装&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm 已经安装&lt;/a&gt;
 在系统中。&lt;/p&gt;
&lt;p&gt;本文档仅适用于使用 Helm 创建的 TSB 实例，不适用于从基于 TCTL 的安装升级。&lt;/p&gt;
&lt;p&gt;在开始之前，请确保你已经：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;检查新版本的 &lt;a href=&#34;../../requirements-and-download&#34; title=&#34;要求&#34;&gt;要求&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;先决条件&#34;&gt;先决条件&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;已经 &lt;a href=&#34;https://helm.sh/docs/intro/install/&#34; title=&#34;安装&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装&lt;/a&gt;
 &lt;code&gt;Helm&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;已经 &lt;a href=&#34;../../../reference/cli/guide/index#installation&#34; title=&#34;安装&#34;&gt;安装&lt;/a&gt;
 TSB cli &lt;code&gt;tctl&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;已经 &lt;a href=&#34;https://kubernetes.io/docs/tasks/tools/#kubectl&#34; title=&#34;安装&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装&lt;/a&gt;
 &lt;code&gt;kubectl&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Tetrate 的镜像仓库的凭据&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;配置-helm-仓库&#34;&gt;配置 Helm 仓库&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;添加仓库：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add tetrate-tsb-helm &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://charts.dl.tetrate.io/public/helm/charts/&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;列出可用版本：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm search repo tetrate-tsb-helm -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;备份-postgresql-数据库&#34;&gt;备份 PostgreSQL 数据库&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;../../../operations/postgresql&#34; title=&#34;创建 PostgreSQL 数据库的备份&#34;&gt;创建 PostgreSQL 数据库的备份&lt;/a&gt;
。&lt;/p&gt;
&lt;p&gt;根据你的环境，连接到数据库的确切过程可能会有所不同，请参考你环境的文档。&lt;/p&gt;
&lt;h2 id=&#34;升级过程&#34;&gt;升级过程&lt;/h2&gt;
&lt;h3 id=&#34;管理平面&#34;&gt;管理平面&lt;/h3&gt;
&lt;p&gt;升级管理平面 Chart：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade mp tetrate-tsb-helm/managementplane --namespace tsb -f values-mp.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;控制平面&#34;&gt;控制平面&lt;/h3&gt;
&lt;p&gt;升级控制平面 Chart：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade cp tetrate-tsb-helm/controlplane --namespace istio-system -f values-cp.yaml --set-file secrets.clusterServiceAccount.JWK&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/tmp/&amp;lt;cluster&amp;gt;.jwk
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;数据平面&#34;&gt;数据平面&lt;/h3&gt;
&lt;p&gt;升级数据平面 Chart：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade dp tetrate-tsb-helm/dataplane --namespace istio-gateway -f values-dp.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;回滚&#34;&gt;回滚&lt;/h2&gt;
&lt;p&gt;如果发生问题，你希望将 TSB 回滚到以前的版本，你需要回滚管理平面、控制平面和数据平面 Chart。&lt;/p&gt;
&lt;h3 id=&#34;回滚控制平面&#34;&gt;回滚控制平面&lt;/h3&gt;
&lt;p&gt;你可以使用 &lt;code&gt;helm rollback&lt;/code&gt; 回滚到当前版本。要查看当前版本，可以运行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm &lt;span class=&#34;nb&#34;&gt;history&lt;/span&gt; cp -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后，你可以回滚到以前的版本：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm rollback cp &amp;lt;REVISION&amp;gt; -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;回滚管理平面&#34;&gt;回滚管理平面&lt;/h3&gt;
&lt;h4 id=&#34;缩减管理平面中的-pod-数量&#34;&gt;缩减管理平面中的 Pod 数量&lt;/h4&gt;
&lt;p&gt;缩减管理平面中连接到 Postgres 的所有 Pod，以使其处于非活动状态。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl scale deployment tsb iam -n tsb --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;恢复-postgresql&#34;&gt;恢复 PostgreSQL&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;../../../operations/postgresql&#34; title=&#34;从备份中恢复你的 PostgreSQL 数据库&#34;&gt;从备份中恢复你的 PostgreSQL 数据库&lt;/a&gt;
。
根据你的环境，连接到数据库的确切过程可能会有所不同，请参考你环境的文档。&lt;/p&gt;
&lt;h4 id=&#34;恢复管理平面&#34;&gt;恢复管理平面&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm rollback mp &amp;lt;REVISION&amp;gt; -n tsb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
    <item>
      <title>Helm TSB 卸载</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/uninstallation/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      
      <guid>https://jimmysong.io/book/tsb/setup/helm/uninstallation/</guid>
      <description>
        
        
        &lt;p&gt;要卸载使用 Helm 安装的 TSB，你可以使用 &lt;code&gt;helm uninstall&lt;/code&gt; 来卸载一个发布。卸载必须按照以下顺序进行：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;数据平面&lt;/li&gt;
&lt;li&gt;控制平面&lt;/li&gt;
&lt;li&gt;管理平面&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;数据平面卸载&#34;&gt;数据平面卸载&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm uninstall dp tetrate-tsb-helm/dataplane --namespace istio-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;一旦 Helm 删除了与数据平面 Chart 的最后一个发布关联的所有资源，你将需要手动删除一些在卸载过程中创建的资源，这些资源不受 Helm 跟踪。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete serviceaccount tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete clusterrole tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete clusterrolebinding tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete istiooperators.install.istio.io --all -n istio-gateway --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;控制平面卸载&#34;&gt;控制平面卸载&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm uninstall cp tetrate-tsb-helm/controlplane --namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;一旦 Helm 删除了与控制平面 Chart 的最后一个发布关联的所有资源，你将需要手动删除一些在卸载过程中创建的资源，这些资源不受 Helm 跟踪。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete serviceaccount tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete clusterrole tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete clusterrolebinding tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete apiservices.apiregistration.k8s.io v1beta1.external.metrics.k8s.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete validatingwebhookconfigurations.admissionregistration.k8s.io xcp-edge-istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete mutatingwebhookconfigurations.admissionregistration.k8s.io xcp-edge-istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;管理平面卸载&#34;&gt;管理平面卸载&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm uninstall mp tetrate-tsb-helm/managementplane --namespace tsb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;一旦 Helm 删除了与管理平面 Chart 的最后一个发布关联的所有资源，你将需要手动删除一些在卸载过程中创建的资源，这些资源不受 Helm 跟踪。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete serviceaccount tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete clusterrole tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete clusterrolebinding tsb-helm-delete-hook --ignore-not-found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete validatingwebhookconfigurations.admissionregistration.k8s.io xcp-central-tsb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete mutatingwebhookconfigurations.admissionregistration.k8s.io xcp-central-tsb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
  </channel>
</rss>
