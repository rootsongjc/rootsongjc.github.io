
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jimmy Song – 安装与升级</title>
    <link>https://jimmysong.io/book/tsb/setup/</link>
    <description>Recent content in 安装与升级 on Jimmy Song</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <managingEditor>Jimmy Song</managingEditor>
    <webMaster>Jimmy Song</webMaster>
    
      <follow_challenge>
        <feedId>51621818828612637</feedId>
        <userId>59800919738273792</userId>
      </follow_challenge>
    
    
    <lastBuildDate>Wed, 09 Aug 2023 12:00:00 +0800</lastBuildDate>
    
	  <atom:link href="https://jimmysong.io/book/tsb/setup/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
                                                         
    
                                                   
                           
    <item>
      <title>先决条件和下载</title>
      <link>https://jimmysong.io/book/tsb/setup/requirements-and-download/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/requirements-and-download/</guid>
      <description>
        
        
        &lt;p&gt;本页面提供了开始使用 Tetrate Service Bridge（TSB）安装所需的先决条件和下载说明的全面概述。&lt;/p&gt;
&lt;p&gt;要有效地管理 TSB 服务网格，需要对 Kubernetes 和 Docker 仓库操作有深入的了解。我们建议咨询它们各自的支持文档以获取额外的指导。&lt;/p&gt;
&lt;h2 id=&#34;先决条件&#34;&gt;先决条件&lt;/h2&gt;
&lt;p&gt;你可以安装用于生产的 TSB，也可以安装用于演示配置文件以快速了解 TSB。请查看以下表格中的每个要求：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;生产 TSB&lt;/th&gt;
&lt;th&gt;演示/快速入门 TSB&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Kubernetes 集群：&lt;/strong&gt;&lt;br /&gt;EKS 1.21 - 1.24&lt;br /&gt;GKE 1.21 - 1.24&lt;br /&gt;AKS 1.21 - 1.24（包括 Azure Stack HCI）&lt;br /&gt;OpenShift 4.7 - 4.11&lt;br /&gt;Docker UCP 3.2.5 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Docker UCP 3.2.5 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;私有 Docker 注册表（HTTPS）&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tetrate 存储库帐户和 API 密钥（如果你尚未拥有此内容，请联系 Tetrate）&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Docker 引擎 18.03.01 或更高版本，具有对私有 Docker 注册表的推送访问权限&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PostgreSQL 11.1 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（v14.4）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Elasticsearch 6.x 或 7.x&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（v7.8.1）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Redis 6.2 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（v7.0.5）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LDAP 服务器或 OIDC 提供程序&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（OpenLDAP v2.6）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Cert-manager：&lt;/br&gt;cert-manager v1.7.2 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（cert-manager v1.10.0）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    cert-manager 用法
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;a href=&#34;https://cert-manager.io/&#34; title=&#34;cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager&lt;/a&gt; 用于为 TSB webhook、TSB 内部通信和 Istio 控制平面与外部 CA 集成等颁发和管理证书。
  &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    cert-manager 版本
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    cert-manager 1.4.0 是使用 TSB 1.5 所需的最低版本。它具有特性标志，用于签署 K8S CSR 请求，支持 Kubernetes 1.16-1.21。前往&lt;a href=&#34;https://cert-manager.io/docs/installation/supported-releases/&#34; title=&#34;cert-manager 受支持的版本&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager 受支持的版本&lt;/a&gt;以获取有关受支持的 Kubernetes 和 OpenShift 版本的更多信息。
  &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    生产安装注意事项
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    你的 Kubernetes 集群的大小取决于平台部署要求。基本的 TSB 安装不会消耗太多额外的资源。存储的大小非常取决于应用程序集群的大小、工作负载的数量（及其请求率）以及可观测性配置（采样率、数据保留期等）。有关更多信息，请参见我们的容量规划指南。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;当运行自托管时，你的组织可能会对上述环境和应用程序施加额外的（安全）限制、可用性和灾难恢复要求。有关如何调整 TSB 安装和配置的详细信息，请参阅 Operator 参考指南以及我们的文档中的&lt;a href=&#34;../../howto/&#34; title=&#34;操作任务&#34;&gt;操作任务&lt;/a&gt;部分，在其中可以找到有关配置选项、常见部署方案和解决方案的描述。&lt;/p&gt;
&lt;h3 id=&#34;身份标识提供者&#34;&gt;身份标识提供者&lt;/h3&gt;
&lt;p&gt;TSB 需要标识提供程序（IdP）作为用户来源。此标识提供程序用于用户身份验证以及定期将现有用户和组的信息同步到平台中。TSB 可以与 LDAP 或任何符合 OIDC 的标识提供程序集成。&lt;/p&gt;
&lt;p&gt;要使用 LDAP，你必须弄清楚如何查询 LDAP，以便 TSB 可以将其用于身份验证和用户和组的同步。有关 LDAP 配置的更多详细信息，请参见 &lt;a href=&#34;../../operations/users/configuring-ldap/&#34; title=&#34;LDAP 作为标识提供程序&#34;&gt;LDAP 作为标识提供程序&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;要使用 OIDC，请在你的 IdP 中创建 OIDC 客户端。启用授权代码流以使用 UI 登录，并启用设备授权以使用设备代码使用 tctl 登录。有关更多信息和示例，请参见如何设置 Azure AD 作为 TSB 标识提供程序。&lt;/p&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    OIDC IdP 同步
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    TSB 支持 Azure AD 用于同步用户和组。如果你使用其他 IdP，则必须创建同步作业，将从你的 IdP 获取用户和团队并使用同步 API 将它们同步到 TSB 中。有关更多详细信息，请参见用户同步。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;数据和遥测存储&#34;&gt;数据和遥测存储&lt;/h3&gt;
&lt;p&gt;TSB 需要外部数据和遥测存储。TSB 使用 PostgreSQL 作为数据存储和 Elasticsearch 作为遥测存储。&lt;/p&gt;



&lt;div class=&#34;alert alert-warnning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warnning-title px-2 py-2&#34;&gt;
    Demo 存储
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warnning px-2&#34;&gt;
    演示安装将部署 PostgreSQL、Elasticsearch 和 LDAP 服务器作为标识提供程序，其中填充了模拟用户和团队。演示存储不适用于生产使用。请确保为你的生产环境提供适当的 PostgreSQL、Elasticsearch 和标识提供程序。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;证书提供者&#34;&gt;证书提供者&lt;/h3&gt;
&lt;p&gt;TSB 1.5 需要证书提供者来支持内部 TSB 组件的证书颁发，例如 Webhook 证书和其他用途。此证书提供者必须在管理平面集群和所有控制平面集群中都可用。&lt;/p&gt;
&lt;p&gt;TSB 支持&lt;code&gt;cert-manager&lt;/code&gt;作为其中一个受支持的提供者。它可以为你管理&lt;code&gt;cert-manager&lt;/code&gt;安装的生命周期。要在集群中配置&lt;code&gt;cert-manager&lt;/code&gt;的安装，请将以下部分作为&lt;code&gt;ManagementPlane&lt;/code&gt;或&lt;code&gt;ControlPlane&lt;/code&gt; CR 的一部分添加：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;   components:
     internalCertProvider:
       certManager:
         managed: INTERNAL
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;你还可以使用任何支持&lt;code&gt;kube-CSR&lt;/code&gt; API 的证书提供者。要使用自定义提供者，请参阅以下部分 Internal Cert Provider&lt;/p&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    现有的 cert-manager 安装
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    如果你已经使用 cert-manager 作为集群的一部分，则可以将&lt;code&gt;ManagementPlane&lt;/code&gt;或&lt;code&gt;ControlPlane&lt;/code&gt; CR 中的&lt;code&gt;managed&lt;/code&gt;字段设置为&lt;code&gt;EXTERNAL&lt;/code&gt;，使 TSB 利用现有的 cert-manager 安装。如果将&lt;code&gt;managed&lt;/code&gt;字段设置为&lt;code&gt;INTERNAL&lt;/code&gt;，则 TSB Operator 会在找到已安装的 cert-manager 时失败，以确保它不覆盖现有的 cert-manager 安装。
  &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    cert-manager Kube-CSR
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    TSB 使用 kubernetes CSR 资源为各种 Webhook 颁发证书。如果你的配置使用外部 cert-manager 安装，请确保 cert-manager 可以签署 Kubernetes CSR 请求。例如，在 cert-manager 1.7.2 中，通过设置此特性标志 &lt;code&gt;ExperimentalCertificateSigningRequestControllers=true&lt;/code&gt;启用此功能。对于使用内部托管的 cert-manager 的 TSB 管理安装，此配置已作为安装的一部分设置。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;下载-tctl&#34;&gt;下载 tctl&lt;/h2&gt;
&lt;p&gt;设置 TSB 的初始步骤是安装我们的 TSB CLI 工具，称为&lt;code&gt;tctl&lt;/code&gt;。使用&lt;code&gt;tctl&lt;/code&gt;，你可以执行 TSB 安装（或升级），使用 YAML 对象与 TSB API 进行交互，并将 TSB 无缝集成到 GitOps 工作流程中。&lt;/p&gt;
&lt;p&gt;请按照 CLI 参考页面中概述的说明下载和安装&lt;code&gt;tctl&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;同步-tetrate-service-bridge-镜像&#34;&gt;同步 Tetrate Service Bridge 镜像&lt;/h2&gt;
&lt;p&gt;安装了&lt;code&gt;tctl&lt;/code&gt;之后，你可以检索必要的容器镜像并将它们上传到你的私有 Docker 注册表。&lt;code&gt;tctl&lt;/code&gt;工具通过&lt;code&gt;image-sync&lt;/code&gt;命令简化了此过程，该命令下载与当前&lt;code&gt;tctl&lt;/code&gt;版本对应的 镜像版本，并将其推送到你的 Docker 注册表。使用你的 Tetrate 存储库帐户凭据和指定你的私有 Docker 注册表的&lt;code&gt;registry&lt;/code&gt;参数使用&lt;code&gt;username&lt;/code&gt;和&lt;code&gt;apikey&lt;/code&gt;参数。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl install image-sync --username &amp;lt;user-name&amp;gt; &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;   --apikey &amp;lt;api-key&amp;gt; --registry &amp;lt;registry-location&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在初始执行期间，你需要接受最终用户许可协议（EULA）。如果你在没有交互式终端访问权限的环境中运行 TSB 安装，例如 CI / CD 流程，请将&lt;code&gt;--accept-eula&lt;/code&gt;标志附加到上述命令中。&lt;/p&gt;
&lt;h3 id=&#34;在-kind-集群中加载演示镜像&#34;&gt;在 Kind 集群中加载演示镜像&lt;/h3&gt;
&lt;p&gt;对于本地&lt;a href=&#34;https://kind.sigs.k8s.io/&#34; title=&#34;kind&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kind&lt;/a&gt;集群中的&lt;code&gt;demo&lt;/code&gt;配置文件安装，请使用以下命令直接将镜像加载到 kind 节点中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#使用我们的“用户名”和“apikey”登录到Docker注册表&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker login containers.dl.tetrate.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#拉取所有docker镜像&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;tctl install image-sync --just-print --raw&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; docker pull &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#将镜像加载到kind节点中&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;tctl install image-sync --just-print --raw&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; kind load docker-image &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    集群配置文件
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    在操作多集群 TSB 环境时，与多个 Kubernetes 集群的交互变得普遍。虽然文档没有明确引用&lt;code&gt;kubectl&lt;/code&gt;配置上下文和&lt;code&gt;tctl&lt;/code&gt; config 配置文件，但这些选择是特定于环境的。确保选择了正确的&lt;code&gt;kubectl&lt;/code&gt;上下文和&lt;code&gt;tctl&lt;/code&gt;配置文件作为默认值，或在使用这些工具执行命令时使用显式参数。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;要使用 Helm Chart 继续进行安装，请参阅 Helm 安装指南。&lt;/p&gt;
&lt;p&gt;要使用&lt;code&gt;tctl&lt;/code&gt;进行安装，请继续查看 tctl 安装指南。&lt;/p&gt;
&lt;p&gt;有关演示安装过程的详细说明，请转到演示安装指南。&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>使用 tctl 安装</title>
      <link>https://jimmysong.io/book/tsb/setup/self-managed/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/self-managed/</guid>
      <description>
        
        
        &lt;p&gt;在整个安装过程中，你可能会发现参考“&lt;a href=&#34;../&#34; title=&#34;安装与升级&#34;&gt;安装与升级&lt;/a&gt;”部分中介绍的主题很有用。请务必查看&lt;a href=&#34;../requirements-and-download&#34; title=&#34;下载 tctl&#34;&gt;下载 tctl&lt;/a&gt; 和&lt;a href=&#34;../tctl-connect&#34; title=&#34;使用 tctl 连接到 TSB&#34;&gt;使用 tctl 连接到 TSB&lt;/a&gt; 等主题，以增强你的理解。&lt;/p&gt;
&lt;p&gt;如需快速概览，你还可以浏览我们的&lt;a href=&#34;../demo-installation&#34; title=&#34;演示安装&#34;&gt;演示安装&lt;/a&gt;指南。&lt;/p&gt;
&lt;p&gt;通过遵循这些指南，你将能够使用 tctl 无缝安装 TSB，无论是在本地基础设施上还是在云服务器上。&lt;/p&gt;


  &lt;ul&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/self-managed/demo-installation/&#34;&gt;演示安装&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/self-managed/management-plane-installation/&#34;&gt;管理平面安装&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/self-managed/onboarding-clusters/&#34;&gt;载入集群&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/self-managed/uninstallation/&#34;&gt;TSB 卸载&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/self-managed/upgrade/&#34;&gt;TSB 升级&lt;/a&gt;
        
      &lt;/li&gt;
    
  &lt;/ul&gt;



      </description>
    </item>
                           
    <item>
      <title>使用 Helm 安装</title>
      <link>https://jimmysong.io/book/tsb/setup/helm/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/helm/</guid>
      <description>
        
        
        &lt;p&gt;本文档解释了如何利用 Helm Charts 来安装 TSB 的不同组件。&lt;/p&gt;


  &lt;ul&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/helm/helm/&#34;&gt;TSB Helm Chart&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/helm/managementplane/&#34;&gt;管理平面安装&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/helm/controlplane/&#34;&gt;控制平面安装&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/helm/dataplane/&#34;&gt;数据平面安装&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/helm/upgrade/&#34;&gt;TSB Helm 升级&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/helm/uninstallation/&#34;&gt;Helm TSB 卸载&lt;/a&gt;
        
      &lt;/li&gt;
    
  &lt;/ul&gt;



      </description>
    </item>
                           
    <item>
      <title>载入工作负载</title>
      <link>https://jimmysong.io/book/tsb/setup/workload-onboarding/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/workload-onboarding/</guid>
      <description>
        
        
        

  &lt;ul&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/workload-onboarding/guides/&#34;&gt;工作负载载入指南&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/workload-onboarding/quickstart/&#34;&gt;快速载入&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/workload-onboarding/onboarding-vms/&#34;&gt;使用 tctl 将虚拟机（VM）接入 TSB 服务网格&lt;/a&gt;
        
      &lt;/li&gt;
    
  &lt;/ul&gt;



      </description>
    </item>
                           
    <item>
      <title>AWS</title>
      <link>https://jimmysong.io/book/tsb/setup/aws/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/aws/</guid>
      <description>
        
        
        

  &lt;ul&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/aws/vpc/&#34;&gt;在 AWS 安装 TSB&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/aws/container-marketplace/&#34;&gt;从 AWS 容器市场安装 TSB&lt;/a&gt;
        
      &lt;/li&gt;
    
  &lt;/ul&gt;



      </description>
    </item>
                           
    <item>
      <title>证书安装</title>
      <link>https://jimmysong.io/book/tsb/setup/certificate/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/certificate/</guid>
      <description>
        
        
        

  &lt;ul&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/certificate/certificate-setup/&#34;&gt;证书类型&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/certificate/certificate-requirements/&#34;&gt;内部证书要求&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/certificate/automated-certificate-management/&#34;&gt;自动证书管理&lt;/a&gt;
        
      &lt;/li&gt;
    
  &lt;/ul&gt;



      </description>
    </item>
                           
    <item>
      <title>使用 tctl 连接到 TSB</title>
      <link>https://jimmysong.io/book/tsb/setup/tctl-connect/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/tctl-connect/</guid>
      <description>
        
        
        &lt;p&gt;在这个页面中，你将学习如何使用 &lt;code&gt;tctl&lt;/code&gt; CLI 连接到 TSB 以及使用 CLI 的一些基础知识。&lt;/p&gt;
&lt;p&gt;在开始之前：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;../../setup/self-managed/management-plane-installation&#34; title=&#34;安装 TSB 管理平面&#34;&gt;安装 TSB 管理平面&lt;/a&gt; (仅自管理)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../../setup/requirements-and-download&#34; title=&#34;下载&#34;&gt;下载&lt;/a&gt; Tetrate Service Bridge CLI (&lt;code&gt;tctl&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;获取 TSB 的 &lt;code&gt;organization&lt;/code&gt; 名称 - 你可以在 TSB UI 中找到，或在 TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR 的安装时配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;TSB 提供了一个用户界面，但本站点中的大多数示例 - 以及大多数脚本和自动化 - 将使用 &lt;code&gt;tctl&lt;/code&gt; CLI。本文档将涵盖如何登录，以便你可以使用 CLI，并提供更新凭据的步骤。&lt;/p&gt;
&lt;h2 id=&#34;概述&#34;&gt;概述&lt;/h2&gt;
&lt;p&gt;有三种配置 &lt;code&gt;tctl&lt;/code&gt; 的方法：使用 &lt;code&gt;tctl login&lt;/code&gt;、从 UI 下载凭据包，或手动配置它。本文档的其余部分详细描述了每种方法。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首选的方法是使用 &lt;code&gt;tctl login&lt;/code&gt; 连接到 TSB，使用 &lt;code&gt;default&lt;/code&gt; 配置文件：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; default --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Organization: tetrate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tenant:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Username: admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password: *****
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Login Successful!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 现在可以开始使用:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;使用 &lt;code&gt;tctl&lt;/code&gt; 连接的第二种简单方法是从 TSB UI 下载 bundle 并使用 &lt;code&gt;tctl config import&lt;/code&gt; 导入：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles import ~/Downloads/tctl-&amp;lt;your username&amp;gt;.config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current &amp;lt;your username&amp;gt;-tsb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 现在可以开始使用:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;最后，你可以创建自己的 &lt;code&gt;user&lt;/code&gt;、&lt;code&gt;cluster&lt;/code&gt; 和 &lt;code&gt;profile&lt;/code&gt;（对于 LDAP 与 OIDC 使用稍有不同的标志）来登录：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-cluster --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 对于 OIDC&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; --token &lt;span class=&#34;nv&#34;&gt;$TSB_BEARER_TOKEN&lt;/span&gt; --refresh-token &lt;span class=&#34;nv&#34;&gt;$TSB_REFRESH_TOKEN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 或者对于 LDAP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# tctl config users set tsb-how-to-user --org $TCTL_LOGIN_ORG --username $TCTL_LOGIN_USERNAME --password $TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to --cluster tsb-how-to-cluster --username tsb-how-to-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current tsb-how-to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 现在可以开始使用:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果你使用用户名和密码登录，应该执行 &lt;code&gt;tctl login&lt;/code&gt; 来交换密码以获取 OIDC 令牌。之后，你可以随时使用 &lt;code&gt;tctl&lt;/code&gt;。例如，要在 TSB 中查找 &lt;code&gt;tenants&lt;/code&gt;，只需执行 &lt;code&gt;tctl get tenants&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;使用-tctl-login-登录&#34;&gt;使用 &lt;code&gt;tctl login&lt;/code&gt; 登录&lt;/h2&gt;
&lt;p&gt;连接到 TSB 的最简单方法是使用 &lt;code&gt;tctl login&lt;/code&gt; 命令，该命令将处理为你交换凭据以获取 OIDC 令牌，并确保不将明文密码持久保存到磁盘上。&lt;/p&gt;
&lt;p&gt;要实现这一点，首先我们需要配置 &lt;code&gt;tctl&lt;/code&gt; 使用 TSB 实例的地址。使用 &lt;code&gt;default&lt;/code&gt; 配置文件最容易 - 如果你不想使用 &lt;code&gt;default&lt;/code&gt; 配置文件，请跳到 &lt;a href=&#34;#%e6%89%8b%e5%8a%a8%e9%85%8d%e7%bd%ae-tctl&#34; title=&#34;手动配置 &amp;lt;code&amp;gt;tctl&amp;lt;/code&amp;gt;&#34;&gt;手动配置 &lt;code&gt;tctl&lt;/code&gt;&lt;/a&gt; 部分。&lt;/p&gt;
&lt;h3 id=&#34;获取-tsb-的地址&#34;&gt;获取 TSB 的地址&lt;/h3&gt;
&lt;p&gt;如果你的 kubeconfig 指向管理平面集群，你可以从 Kubernetes 服务中获取地址：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_ADDRESS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc -n tsb envoy --output &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;:8443
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;许多组织将通过 DNS 公开 TSB 的 UI（因此也是 API）；你应该使用它而不是原始 IP 地址。&lt;/p&gt;
&lt;h3 id=&#34;配置-default-配置文件&#34;&gt;配置 &lt;code&gt;default&lt;/code&gt; 配置文件&lt;/h3&gt;
&lt;p&gt;有了 TSB 的地址，我们将配置 &lt;code&gt;tctl&lt;/code&gt; 连接到它：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; default --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;使用-oidc-登录&#34;&gt;使用 OIDC 登录&lt;/h3&gt;
&lt;p&gt;要使用 OIDC 凭证登录 TSB，可以使用 OIDC 设备代码流，该流已集成到 &lt;code&gt;tctl&lt;/code&gt; 中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login --use-device-code
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Organization: tetrate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tenant:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: GGBD-NJPR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Open browser page https://www.google.com/device and enter the code
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Login Successful!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    在浏览器中进行
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    这将为你打开浏览器，以完成 OIDC 登录流程并生成令牌。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;使用用户名和密码登录&#34;&gt;使用用户名和密码登录&lt;/h3&gt;
&lt;p&gt;登录时提供用户名和密码：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Organization: tetrate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tenant:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Username: admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password: *****
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Login Successful!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;从-tsb-下载-tctl-配置&#34;&gt;从 TSB 下载 &lt;code&gt;tctl&lt;/code&gt; 配置&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;tctl&lt;/code&gt; 使用一个配置文件与 TSB 实例连接，类似于使用 kubeconfig 连接到 Kubernetes API 服务器。通过从 TSB UI 下载该配置文件，你可以使用 &lt;code&gt;tctl&lt;/code&gt; 轻松连接。要访问这些凭据，请在浏览器中登录到 TSB UI，然后在右上角单击用户名，选择 &lt;code&gt;操作&lt;/code&gt; &amp;gt; &lt;code&gt;显示令牌信息&lt;/code&gt; &amp;gt; &lt;code&gt;下载 tctl 配置&lt;/code&gt;。这将下载一个名为 &lt;code&gt;tctl-&amp;lt;your username&amp;gt;.config.yaml&lt;/code&gt; 的文件。然后，你可以将其导入到 &lt;code&gt;tctl&lt;/code&gt; 中，以永久保存：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles import /path/to/tctl-&amp;lt;your username&amp;gt;.config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current &amp;lt;your username&amp;gt;-tsb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    提示
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;code&gt;tctl&lt;/code&gt; 将配置存储在你文件系统默认的配置目录中（由 Golang 确定）。在 Linux 上，这将是 &lt;code&gt;$HOME/.config/tetrate/tctl/tctl_config&lt;/code&gt;，在 Darwin 上是 &lt;code&gt;$HOME/Library/Application\ Support/tetrate/tctl/tctl_config&lt;/code&gt;，在 Windows 上是 &lt;code&gt;%AppData%/tetrate/tctl/tctl_config&lt;/code&gt;。这是保存密码或令牌的位置。当导入配置文件时，&lt;code&gt;tctl&lt;/code&gt; 将将该文件中的凭据添加到其配置目录中的现有凭据中。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;手动配置-tctl&#34;&gt;手动配置 &lt;code&gt;tctl&lt;/code&gt;&lt;/h2&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    TSB 组织名称
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    在下面的示例中，假定你已将组织名称保存在环境变量 &lt;code&gt;$TCTL_LOGIN_ORG&lt;/code&gt; 中。如果你刚刚完成演示安装，演示组织名称是 &lt;code&gt;tetrate&lt;/code&gt;。你可以执行以下操作将该值保存在环境变量中：&lt;code&gt;export TCTL_LOGIN_ORG=tetrate&lt;/code&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;要使用 &lt;code&gt;tctl&lt;/code&gt; 登录，首先必须配置 &lt;em&gt;cluster&lt;/em&gt; (&lt;code&gt;tctl config clusters&lt;/code&gt;)，然后是 &lt;em&gt;user&lt;/em&gt; (&lt;code&gt;tctl config users&lt;/code&gt;)，然后将两者结合到 &lt;em&gt;profile&lt;/em&gt; 中，你将能够使用它来连接到 TSB 实例，就像使用 kubeconfig profile 一样 (&lt;code&gt;tctl config profiles set-current ...&lt;/code&gt;)。有了这个 &lt;em&gt;profile&lt;/em&gt;，你就可以使用 &lt;code&gt;tctl login&lt;/code&gt; 命令配置凭据，并将这些凭据持久保存到磁盘上，以便将来连接到 TSB。&lt;/p&gt;
&lt;h3 id=&#34;为-profile-选择一个名称&#34;&gt;为 profile 选择一个名称&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;tctl&lt;/code&gt; 有一个 &lt;em&gt;default&lt;/em&gt; profile，就像 &lt;code&gt;kubectl&lt;/code&gt; 一样，你可以在下面的命令中使用它，或者你可以选择自己的 profile 名称。在此演示中，创建一个名为 &lt;em&gt;&lt;code&gt;tsb-how-to&lt;/code&gt;&lt;/em&gt; 的 profile（但任何名称都可以，包括 &lt;em&gt;default&lt;/em&gt;）。&lt;/p&gt;
&lt;h3 id=&#34;配置-tctl-cluster&#34;&gt;配置 &lt;code&gt;tctl&lt;/code&gt; Cluster&lt;/h3&gt;
&lt;p&gt;UI 和 TSB 的 API 都在相同的地址和端口上暴露。为了配置 &lt;code&gt;tctl&lt;/code&gt;，你将需要该地址以开始。&lt;/p&gt;
&lt;h4 id=&#34;获取-tsb-的地址-1&#34;&gt;获取 TSB 的地址&lt;/h4&gt;
&lt;p&gt;如果你的 kubeconfig 指向管理平面集群，你可以从 Kubernetes 服务中获取地址：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_ADDRESS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc -n tsb envoy --output &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;:8443
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;许多组织将通过 DNS 公开 TSB 的 UI（因此也是 API）；你应该使用它而不是原始 IP 地址。&lt;/p&gt;
&lt;h4 id=&#34;创建-tctl-cluster&#34;&gt;创建 &lt;code&gt;tctl&lt;/code&gt; Cluster&lt;/h4&gt;
&lt;p&gt;一旦获得了地址（&lt;code&gt;$TSB_ADDRESS&lt;/code&gt;），你可以在 &lt;code&gt;tctl&lt;/code&gt; 的配置中创建一个 &lt;em&gt;cluster&lt;/em&gt;。将集群命名为 &lt;code&gt;tsb-how-to-cluster&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-cluster --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    tctl  对象名称
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    你可以使用与 profile 相同的名称作为 cluster 的名称（例如 &lt;code&gt;tctl config clusters set tsb-how-to --bridge-address $TSB_ADDRESS&lt;/code&gt;）。此示例使用不同的名称，以便更容易跟踪。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;设置-tctl-user&#34;&gt;设置 &lt;code&gt;tctl&lt;/code&gt; User&lt;/h3&gt;
&lt;p&gt;首先，你需要知道要使用的用户名。这将取决于 TSB 的安装方式：如果使用 OIDC，则将是你的企业电子邮件；如果使用 LDAP，则将是你通常的 LDAP 登录用户名；最后，你可以使用 TSB 的默认管理帐户登录，如果在安装中未禁用它。&lt;/p&gt;
&lt;h4 id=&#34;oidc-用户登录&#34;&gt;OIDC 用户登录&lt;/h4&gt;
&lt;p&gt;要使用 OIDC 凭证登录 TSB，请在浏览器中登录到 TSB UI，然后在右上角单击你的用户名，选择 &lt;code&gt;操作&lt;/code&gt; &amp;gt; &lt;code&gt;显示令牌信息&lt;/code&gt;。从该页面中，复制下 Bearer Token 和 Refresh Token，并将其导出为 &lt;code&gt;TSB_BEARER_TOKEN&lt;/code&gt; 和 &lt;code&gt;TSB_REFRESH_TOKEN&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_BEARER_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;HHVMW2.qhf9jBL1fMCazBe1umanDr5sNEuFcKtClAUxeWA...redacted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_REFRESH_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;AJWXL6VmGUmvYfn43601RG.Bw+xr0IVQ43swidqAt1tHf...redacted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --token &lt;span class=&#34;nv&#34;&gt;$TSB_BEARER_TOKEN&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --refresh-token &lt;span class=&#34;nv&#34;&gt;$TSB_REFRESH_TOKEN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ldap用户名--密码用户登录&#34;&gt;LDAP（用户名 + 密码）用户登录&lt;/h4&gt;
&lt;p&gt;对于 LDAP 登录，你需要用户名和密码；你可以通过环境变量配置这些变量，或通过 CLI 传递它们：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_USERNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo-user@tetrate.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;your password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --username &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_USERNAME&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --password &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-warning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warning-title px-2 py-2&#34;&gt;
    用户名 + 密码登录写密码到磁盘
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warning px-2&#34;&gt;
    当你配置一个带有用户名和密码的用户时，该密码会写入磁盘。为确保凭据不保存到磁盘，你需要在设置完集群、用户和 profile 后执行 &lt;code&gt;tctl login&lt;/code&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h4 id=&#34;作为-admin-用户登录&#34;&gt;作为 Admin 用户登录&lt;/h4&gt;
&lt;p&gt;你可以使用与 LDAP 帐户相同的用户名和密码方案登录默认的管理员用户：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_USERNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin &lt;span class=&#34;c1&#34;&gt;# 这是硬编码的&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;your password&amp;gt; &lt;span class=&#34;c1&#34;&gt;# 你在管理平面安装期间创建的&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --username &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_USERNAME&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --password &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-warning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warning-title px-2 py-2&#34;&gt;
    注意
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warning px-2&#34;&gt;
    当你为用户配置用户名和密码时，该密码将被写入磁盘。为了确保凭证没有保存到磁盘，你需要在设置集群、用户和配置文件之后执行 ctl 登录。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h4 id=&#34;oidc-用户登录-1&#34;&gt;OIDC 用户登录&lt;/h4&gt;
&lt;p&gt;要使用 OIDC 凭证登录 TSB，请在浏览器中登录 TSB UI，然后在右上角点击你的用户名，在下拉菜单中选择 &lt;code&gt;Actions&lt;/code&gt; &amp;gt; &lt;code&gt;Show token information&lt;/code&gt;。从该页面复制 Bearer Token 和 Refresh Token，并将它们导出为 &lt;code&gt;TSB_BEARER_TOKEN&lt;/code&gt; 和 &lt;code&gt;TSB_REFRESH_TOKEN&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_BEARER_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;HHVMW2.qhf9jBL1fMCazBe1umanDr5sNEuFcKtClAUxeWA...redacted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_REFRESH_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;AJWXL6VmGUmvYfn43601RG.Bw+xr0IVQ43swidqAt1tHf...redacted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --token &lt;span class=&#34;nv&#34;&gt;$TSB_BEARER_TOKEN&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --refresh-token &lt;span class=&#34;nv&#34;&gt;$TSB_REFRESH_TOKEN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ldap用户名--密码用户登录-1&#34;&gt;LDAP（用户名 + 密码）用户登录&lt;/h4&gt;
&lt;p&gt;对于 LDAP 登录，你需要一个用户名和密码；你可以在环境变量中配置这些信息，或通过 CLI 传递：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_USERNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo-user@tetrate.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;your password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --username &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_USERNAME&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --password &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-warning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warning-title px-2 py-2&#34;&gt;
    用户名 + 密码登录将密码写入磁盘
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warning px-2&#34;&gt;
    当配置用户名和密码的用户时，密码会被写入磁盘。为了确保凭据不会保存到磁盘，你需要在设置好集群、用户和配置文件后运行 &lt;code&gt;tctl login&lt;/code&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h4 id=&#34;管理员用户登录&#34;&gt;管理员用户登录&lt;/h4&gt;
&lt;p&gt;你可以使用与 LDAP 帐户相同的用户名和密码方案登录默认的管理员用户：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_USERNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin &lt;span class=&#34;c1&#34;&gt;# 这是硬编码的&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;your password&amp;gt; &lt;span class=&#34;c1&#34;&gt;# 在管理平面安装期间创建的&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --username &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_USERNAME&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --password &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-warning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warning-title px-2 py-2&#34;&gt;
    注意
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warning px-2&#34;&gt;
    &lt;p&gt;建议在所有 TSB 部署中禁用管理员用户。管理员用户的主要用途是让平台所有者登录并配置其 IdP，以便组织中的其他人员可以使用 OIDC 或 LDAP 登录。&lt;/p&gt;
&lt;p&gt;最后，由于这是用户名和密码登录，你需要运行 &lt;code&gt;tctl login&lt;/code&gt; 以交换密码以获取将来的访问令牌，并确保密码不会保存到磁盘。&lt;/p&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;创建-tctl-配置文件&#34;&gt;创建 &lt;code&gt;tctl&lt;/code&gt; 配置文件&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;配置文件&lt;/em&gt; 将 &lt;em&gt;集群&lt;/em&gt; 和 &lt;em&gt;用户&lt;/em&gt; 绑定在一起，以便它们可以用于连接到 TSB 实例。将刚刚创建的 &lt;em&gt;集群&lt;/em&gt; 和 &lt;em&gt;用户&lt;/em&gt; 连接在一起，形成一个 &lt;em&gt;配置文件&lt;/em&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to --cluster tsb-how-to-cluster --username tsb-how-to-user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;使用新配置文件&#34;&gt;使用新配置文件&lt;/h3&gt;
&lt;p&gt;配置 &lt;code&gt;tctl&lt;/code&gt; 使用你刚刚创建的配置文件连接到 TSB：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current tsb-how-to
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在这一点上，你已经准备好了：&lt;code&gt;tctl&lt;/code&gt; 已经知道 TSB 的位置和你的凭证 - 你可以使用它与 TSB 交互！&lt;/p&gt;
&lt;h3 id=&#34;验证配置&#34;&gt;验证配置&lt;/h3&gt;
&lt;p&gt;作为一个健全性检查，在完成以下步骤后，你可以列出你的 &lt;code&gt;tctl&lt;/code&gt; 配置文件，你应该看到类似以下的内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CURRENT   NAME         CLUSTER             ACCOUNT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          default      default             default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*         tsb-how-to   tsb-how-to-cluster  tsb-how-to-user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;使用-tctl-查找租户&#34;&gt;使用 &lt;code&gt;tctl&lt;/code&gt; 查找租户&lt;/h3&gt;
&lt;p&gt;你可以通过 &lt;code&gt;tctl&lt;/code&gt; 询问 TSB 哪些租户存在，以使你在 &lt;code&gt;tenant&lt;/code&gt; 中更轻松地设置。对于大多数用户，将返回一个结果 - 这是你想要使用的租户。对于具有多个租户的用户，你需要与平台团队交流，确定哪个对你来说是正确的。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         默认租户
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;有了租户，你可以将其保存到你的用户中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user --tenant &amp;lt;your tenant&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;使用-tctl-登录&#34;&gt;使用 &lt;code&gt;tctl&lt;/code&gt; 登录&lt;/h3&gt;
&lt;p&gt;当使用用户名和密码登录时，两者都会被保存到磁盘。这是不可取的，因为密码以明文形式存储。为了从 &lt;code&gt;tctl&lt;/code&gt; 的配置文件中删除密码，你可以使用 &lt;a href=&#34;../../reference/cli/reference/login&#34; title=&#34;&amp;lt;code&amp;gt;tctl login&amp;lt;/code&amp;gt;&#34;&gt;&lt;code&gt;tctl login&lt;/code&gt;&lt;/a&gt;，它将交换凭据以获取一组 OAuth 令牌，并将这些令牌写入磁盘。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
                           
    <item>
      <title>资源消耗与容量规划</title>
      <link>https://jimmysong.io/book/tsb/setup/resource-planning/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/resource-planning/</guid>
      <description>
        
        
        &lt;p&gt;本文描述了 Tetrate Service Bridge (TSB) 在管理平面和控制平面的容量规划的保守指南。&lt;/p&gt;
&lt;p&gt;这些参数适用于生产环境的安装：如果你使用类似演示的环境，TSB 将以最小的资源运行。&lt;/p&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    注意事项
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;p&gt;本文描述的资源配置指南非常保守。&lt;/p&gt;
&lt;p&gt;另请注意，本文描述的资源配置适用于 &lt;em&gt;垂直&lt;/em&gt; 资源扩展。相同 TSB 组件的多个副本不会共享负载，因此你不能期望多个组件的合并资源产生相同的效果。TSB 组件的副本应仅用于实现高可用性。&lt;/p&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;推荐的基线生产安装资源要求&#34;&gt;推荐的基线生产安装资源要求&lt;/h2&gt;
&lt;p&gt;对于一个具有 1 个注册集群和该集群内部部署的 1 个服务的 TSB 基线安装，建议如下资源。&lt;/p&gt;
&lt;p&gt;再次强调，下面描述的内存量非常保守。此外，vCPU 数量给出的实际性能会根据你的基础设施而波动。建议你在你的环境中验证结果。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;vCPU 数量&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;内存 MiB&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB 服务器 &lt;em&gt;(管理平面)&lt;/em&gt; &lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;512&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Central 组件 &lt;sup&gt;2&lt;/sup&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Edge&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Front Envoy&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IAM&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB UI&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;256&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5192&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL 收集器&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1024&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt; 包括 Kubernetes  Operator 和持久数据协调过程。&lt;/p&gt;
&lt;p&gt;&lt;sup&gt;2&lt;/sup&gt; 包括 Kubernetes  Operator。&lt;/p&gt;
&lt;h2 id=&#34;推荐的扩展资源参数&#34;&gt;推荐的扩展资源参数&lt;/h2&gt;
&lt;p&gt;TSB 栈主要受 CPU 限制。通过 XCP 注册的附加集群会使 CPU 利用率增加约 4%。&lt;/p&gt;
&lt;p&gt;对内存使用情况的附加注册集群或附加部署的工作负载服务的影响几乎可以忽略不计。同样，对于大多数 TSB 组件的资源消耗，额外集群或工作负载的影响几乎可以忽略不计，但 TSB、XCP Central 组件、TSB UI 和 IAM 则是值得注意的例外。&lt;/p&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    注意
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    作为可见度堆栈的一部分（例如 OTel/OAP 等），其资源利用取决于请求，因此资源扩展应遵循用户请求速率统计。一般而言，建议使用超过 1 个 vCPU。还要注意，可见度堆栈的性能主要受 Elasticsearch 性能限制。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;因此，我们建议为部署的工作流程垂直扩展组件 1 个 vCPU。&lt;/p&gt;
&lt;h3 id=&#34;管理平面&#34;&gt;管理平面&lt;/h3&gt;
&lt;p&gt;除了 OAP 外，所有组件都不需要进行任何资源调整。这些组件的架构和测试支持非常大的集群。&lt;/p&gt;
&lt;p&gt;在管理平面的 OAP 需要额外的 CPU 和内存，每 1000 个服务需要约 100 毫核的 CPU 和 1024 MiB 的内存。例如，从所有 TSB 集群中聚合的 4000 个服务将总共需要大约 400 毫核的 CPU 和 4096 MiB 的内存。&lt;/p&gt;
&lt;h2 id=&#34;控制平面资源要求&#34;&gt;控制平面资源要求&lt;/h2&gt;
&lt;p&gt;以下表格显示了 TSB 控制平面的典型峰值资源利用情况，假设如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;带有 Sidecar 的 50 个服务&lt;/li&gt;
&lt;li&gt;整个集群的流量为 500 个存储库&lt;/li&gt;
&lt;li&gt;OAP 的跟踪采样率为流量的 1%&lt;/li&gt;
&lt;li&gt;对于每个工作负载的每个请求都捕获度量值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;请注意，平均 CPU 利用率将是典型峰值值的一部分。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;典型峰值 CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;典型峰值内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Istiod&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;300m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;250Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2500m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2500Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Edge&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator  - 控制平面&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator  - 数据平面&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;150m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB 控制平面 Operator&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB 数据平面 Operator&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;150m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL 收集器&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;每个入口网关的-tsbistio--operator-资源使用情况&#34;&gt;每个入口网关的 TSB/Istio  Operator 资源使用情况&lt;/h2&gt;
&lt;p&gt;以下表格显示了每个入口网关使用的 TSB  Operator 和 Istio  Operator 的资源。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;入口网关&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB  Operator  CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB  Operator 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istio  Operator  CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istio  Operator 内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;10m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;45Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;50&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2600m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;125Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;120Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3500m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;200Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1300m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;175Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;150&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3800m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;250Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1400m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;200Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;200&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4000m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;325Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1400m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;250Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;250&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4700m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;325Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1750m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;300Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;300&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5000m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;475Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1750m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;400Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;组件资源利用&#34;&gt;组件资源利用&lt;/h2&gt;
&lt;p&gt;以下表格将展示 TSB 的不同组件如何随着 4000 个服务的规模增长并以 60 rpm 峰值，这是根据来自管理平面和控制平面的信息进行划分的。&lt;/p&gt;
&lt;h3 id=&#34;管理平面-1&#34;&gt;管理平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;服务&lt;/th&gt;
&lt;th&gt;入口网关&lt;/th&gt;
&lt;th&gt;流量 (rpm)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;中央 CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;中央内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;MPC CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;MPC 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB 内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;39Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;30Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;37m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;408Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;22m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;108Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;14m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;57Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;400&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;42Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;31Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;116m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;736Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;24m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;123Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;63Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;800&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;54Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;24m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;34Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;43m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;909Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;26m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;85m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;75Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1200&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;59Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;32m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;41Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;28m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1141Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;27m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;210Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;213m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;78Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1600&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;63Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;44m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;48Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;209m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1475Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;29m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;249Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;113m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;86Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2000&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;73Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;41m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;51Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;51m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1655Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;24m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;319Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;211m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;91Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2400&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;84Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;72m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;62Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;57m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1910Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;29m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;381Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;227m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;97Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2800&lt;/td&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;90Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;73m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;65Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;43m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2136Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;16m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;466Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;275m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;104Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3200&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;106Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;85m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;78Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;89m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2600Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;43m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;574Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;382m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;108Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3600&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;123Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;94m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;71Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;245m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2772Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;37m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;578Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;625m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;115Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4000&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;147Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;90m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;81Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;521m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3224Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;704Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;508m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;122Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    注意
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    IAM 将在 5m/32Mi，LDAP 在 1m/12Mi，XCP  Operator 在 3m 和 23Mi 时达到峰值。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;控制平面&#34;&gt;控制平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;服务&lt;/th&gt;
&lt;th&gt;入口网关&lt;/th&gt;
&lt;th&gt;流量 (rpm)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;边缘 CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;边缘内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istiod CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istiod 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel 内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;67Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;110Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;55m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;439Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;16m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;74Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;400&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;97Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;33m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;182Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;334m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1138Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;18m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;75Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;800&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;153Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;35m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;249Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;653m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1640Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;21m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;85Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1200&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;68m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;286Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;815m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2238Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;23m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;164Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1600&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;238Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;84m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;324Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1217m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2766Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;202Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2000&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;280Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;84m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;357Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1364m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3351Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;17m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;267Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2400&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;270Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;98m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;370Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1658m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3921Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;331Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2800&lt;/td&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;310Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;334m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;450Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2062m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4493Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;406Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3200&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;352Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;243m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;470Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2406m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4866Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;506Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3600&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;22m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;386Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;130m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;489Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2606m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5346Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;512Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4000&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;501Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;138m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;523Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2904m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6128Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;620Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    注意
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    Metric Server 将在 4m/24Mi，Onboarding Operator 在 4m/24Mi，XCP-Operator 在 3m/22Mi 时达到峰值。
  &lt;/div&gt;
&lt;/div&gt;


      </description>
    </item>
                           
    <item>
      <title>TSB 组件</title>
      <link>https://jimmysong.io/book/tsb/setup/components/</link>
      <pubDate>Tue, 19 Sep 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/components/</guid>
      <description>
        
        
        &lt;p&gt;本页面将详细解释 TSB 组件和你必须提供和连接以运行 TSB 的外部依赖项。&lt;/p&gt;
&lt;p&gt;在继续之前，请确保你已经：&lt;/p&gt;
&lt;p&gt;查看了 &lt;a href=&#34;../../concepts/architecture&#34; title=&#34;TSB 架构&#34;&gt;TSB 架构&lt;/a&gt; 并理解了 &lt;a href=&#34;../../concepts/architecture&#34; title=&#34;TSB 的四个层次&#34;&gt;TSB 的四个层次&lt;/a&gt;：数据平面（Envoy 代理）、本地控制平面（Istio）、全局控制平面（XCP）和管理平面（TSB 本身）。&lt;/p&gt;
&lt;h2 id=&#34;管理平面&#34;&gt;管理平面&lt;/h2&gt;
&lt;p&gt;下图显示了管理平面（MP）组件：&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/book/tsb/setup/components/management-plane_hua8661ed4e48ca0439938fb6b1b60742a_345077_4206x2552_resize_q75_h2_lanczos_3.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/book/tsb/setup/components/management-plane.png&#34; data-img=&#34;/book/tsb/setup/components/management-plane.png&#34; data-width=&#34;4206&#34; data-height=&#34;2552&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
&lt;/figure&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    front-envoy 端口
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    默认 Envoy 网关（或前置 Envoy）端口是 8443，可以由用户配置（例如更改为 443）。如果更改了默认端口，则通过前置 Envoy 进行通信的组件需要相应地进行调整以匹配用户定义的值。
  &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    front-envoy 作为 Elasticsearch 代理
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    TSB 的前置 Envoy 可以作为配置在 &lt;code&gt;ManagementPlane&lt;/code&gt; CR 中的 Elasticsearch 的代理。
要使用此功能，请在 &lt;code&gt;ControlPlane&lt;/code&gt; CR 中将 Elastic 主机和端口设置为 TSB 前置 Envoy 主机和端口。然后，来自控制平面 OAP 到 Elasticsearch 的流量将通过前置 Envoy 进行传递。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;在管理平面中有两个运行的 Operator，用于管理 TSB 组件的生命周期：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operator 名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB 管理平面 Operator&lt;/td&gt;
&lt;td&gt;用于管理管理平面中 TSB 组件生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Central Operator&lt;/td&gt;
&lt;td&gt;用于管理 XCP Central 的生命周期的 Operator。TSB 管理平面 Operator 部署 XCP  Operator 和该 Operator 的 CRD，将 XCP Central 的管理交给它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;以下是管理平面组件。有关更多参考，请查看 &lt;a href=&#34;../../refs/install/managementplane/v1alpha1/spec&#34; title=&#34;管理平面安装 API&#34;&gt;管理平面安装 API&lt;/a&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Envoy Gateway（front-envoy）&lt;/td&gt;
&lt;td&gt;为 TSB API 和 UI 提供单一入口点。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IAM&lt;/td&gt;
&lt;td&gt;前置 Envoy 的外部授权。IAM 决定是否允许或拒绝对 TSB API 的传入请求。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB API Server&lt;/td&gt;
&lt;td&gt;TSB 的核心。存储将被发送到控制平面的配置。使用 NGAC 进行访问决策。将 PostgreSQL 用作后端存储。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Web UI&lt;/td&gt;
&lt;td&gt;提供 UI 组件。具有帮助连接到各种 TSB 组件（API 服务器、OAP）的 BFF（前端后端）。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MPC（MP Controller）&lt;/td&gt;
&lt;td&gt;在 TSB API 和 XCP Central 之间提供双向配置和集群状态同步。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Central&lt;/td&gt;
&lt;td&gt;协调多集群发现。将配置发送到所有连接的在集群中运行的 XCP Edge。接收来自 XCP Edge 的集群状态和配置状态更新。此组件由 XCP Central  Operator 管理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP（SkyWalking）&lt;/td&gt;
&lt;td&gt;用于 UI 查询以从所有集群的 OAP 获取聚合指标和跟踪。使用 Elasticsearch 作为后端存储。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL Collector&lt;/td&gt;
&lt;td&gt;从管理平面中的不同组件中收集指标。从每个控制平面的 OpenTelemetry（OTEL）收集器接收指标。请注意，OTEL 收集器严格用于 TSB 组件监视，而不是你的应用程序。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;teamsync&lt;/td&gt;
&lt;td&gt;使用 LDAP 和 Azure AD 作为 IdP 时创建。从 IdP 检索用户和组并将其同步到 TSB 存储中。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cert-manager&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;INTERNAL&lt;/code&gt; cert-manager 时创建。&lt;code&gt;cert-manager&lt;/code&gt; 为内部 TSB 组件提供证书，例如 Webhook 证书等的目的。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;控制平面&#34;&gt;控制平面&lt;/h2&gt;
&lt;p&gt;下图显示了控制平面（CP）组件以及数据平面（DP）。&lt;/p&gt;
&lt;figure class=&#34;mx-auto text-center&#34;&gt;
  
  
  
    
      
        
          
          &lt;picture&gt;
           &lt;source srcset=&#34;https://jimmysong.io/book/tsb/setup/components/control-plane_hu3cf13755388fe52861a514034a5460d5_179002_3842x2828_resize_q75_h2_lanczos_3.webp&#34; type=&#34;image/webp&#34;&gt;
           &lt;img src=&#34;https://jimmysong.io/book/tsb/setup/components/control-plane.png&#34; data-img=&#34;/book/tsb/setup/components/control-plane.png&#34; data-width=&#34;3842&#34; data-height=&#34;2828&#34; alt=&#34;image&#34; data-caption=&#34;&#34;&gt;
          &lt;/picture&gt;
        
      
    
  
  
&lt;/figure&gt;
&lt;p&gt;有四个 Operator 运行在控制平面中，用于管理 TSB 组件的生命周期：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operator 名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB Control Plane Operator&lt;/td&gt;
&lt;td&gt;用于管理控制平面中 TSB 控制平面组件生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Edge Operator&lt;/td&gt;
&lt;td&gt;用于管理 XCP Edge 的生命周期的 Operator。TSB 控制平面 Operator 部署 XCP  Operator 和该 Operator 的 CRD，将 XCP Edge 的管理交给它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator&lt;/td&gt;
&lt;td&gt;用于管理 Istio 控制平面的生命周期的 Operator。TSB 控制平面 Operator 部署 Istio  Operator 和该 Operator 的 CRD，将 Istio 组件的管理交给它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding  Operator&lt;/td&gt;
&lt;td&gt;用于管理所需组件的生命周期，以将 VM 工作负载（也称为网格扩展）纳入网格。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    修订的控制平面
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    TSB 1.5 引入了修订的控制平面。当你使用修订的控制平面时，由 XCP Edge Operator 部署 Istio  Operator，而不是 TSB 控制平面 Operator。要了解有关修订的控制平面的更多信息，请转到 &lt;a href=&#34;../../setup/isolation-boundaries&#34; title=&#34;Istio 隔离边界&#34;&gt;Istio 隔离边界&lt;/a&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;以下是控制平面组件。有关更多参考，请查看 &lt;a href=&#34;../../refs/install/controlplane/v1alpha1/spec&#34; title=&#34;控制平面安装 API&#34;&gt;控制平面安装 API&lt;/a&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;XCP edge&lt;/td&gt;
&lt;td&gt;接收来自 XCP Central 的配置并将其转化为 Istio 配置。向 XCP Central 发送关于配置状态和集群清单的更新。由 XCP Edge Operator 管理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istiod&lt;/td&gt;
&lt;td&gt;提供服务发现、将配置分发到 Envoy 代理以及工作负载证书管理的 Istio 组件。由 Istio  Operator 管理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP（SkyWalking）&lt;/td&gt;
&lt;td&gt;接收来自集群中所有 Istio sidecar 和网关的访问日志和跟踪。处理这些访问日志并生成指标。指标和跟踪将被发送到 Elasticsearch。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL Collector&lt;/td&gt;
&lt;td&gt;从控制平面中的不同 TSB 组件中收集指标。将指标导出到同一 pod 中的 Prometheus 导出器以及通过前置 Envoy 到管理平面的 OTEL 收集器。请注意，OTEL 收集器严格用于 TSB 组件监视，而不是你的应用程序。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SkyWalking HPA&lt;/td&gt;
&lt;td&gt;提供外部指标适配器，Kubernetes 水平 Pod 自动缩放（HPA）控制器可以从中检索指标。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;速率限制服务器&lt;/td&gt;
&lt;td&gt;提供内建的速率限制功能的可选组件。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;VM Gateway&lt;/td&gt;
&lt;td&gt;在启用网格扩展时部署。VM 网关提供与在 VM 中运行的 sidecar 的 Istiod 和 OAP 的连接。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding Plane&lt;/td&gt;
&lt;td&gt;在启用网格扩展时部署。VM 中的 Onboarding 代理将连接到此组件，以便将外部网格工作负载（例如在 VM 中运行的工作负载）纳入网格。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding Repository&lt;/td&gt;
&lt;td&gt;在启用网格扩展时部署。一个 HTTP 服务器，提供登记代理和 Istio Sidecar 的 DEB 和 RPM 包。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cert-manager&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;INTERNAL&lt;/code&gt; cert-manager 时创建。&lt;code&gt;cert-manager&lt;/code&gt; 为内部 TSB 组件提供证书，例如 Webhook 证书等的目的。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;数据平面&#34;&gt;数据平面&lt;/h2&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    修订的控制平面
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    TSB 1.5 引入了修订的控制平面。当你使用修订的控制平面时，不再需要 Data Plane  Operator 来管理 Istio 网关。要了解有关修订的控制平面的更多信息，请转到 &lt;a href=&#34;../../setup/isolation-boundaries&#34; title=&#34;Istio 隔离边界&#34;&gt;Istio 隔离边界&lt;/a&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;在数据平面中有两个运行的 Operator，用于管理网关部署的生命周期：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operator 名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB Data Plane Operator&lt;/td&gt;
&lt;td&gt;用于管理 TSB 数据平面组件生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator&lt;/td&gt;
&lt;td&gt;根据 &lt;a href=&#34;../../refs/install/dataplane/v1alpha1/spec&#34; title=&#34;数据平面安装 API&#34;&gt;数据平面安装 API&lt;/a&gt; 中指定的 Gateway CR 来管理 Istio 网关的生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
                           
    <item>
      <title>防火墙信息</title>
      <link>https://jimmysong.io/book/tsb/setup/firewall-information/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/firewall-information/</guid>
      <description>
        
        
        &lt;p&gt;如果你的环境有严格的网络策略，防止两个命名空间之间进行任何未经授权的通信，你可能需要添加一个或多个例外到你的网络策略，以允许 sidecar 与本地 Istio 控制平面之间的通信，以及本地 Istio 控制平面与 TSB 管理平面之间的通信。&lt;/p&gt;
&lt;p&gt;以下信息可用于推导适当的防火墙规则集。&lt;/p&gt;
&lt;h2 id=&#34;tsb控制平面和工作负载之间的通信&#34;&gt;TSB、控制平面和工作负载之间的通信&lt;/h2&gt;
&lt;h3 id=&#34;tsb-和-istio-之间&#34;&gt;TSB 和 Istio 之间&lt;/h3&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    TSB 负载均衡器端口
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    TSB 负载均衡器（也称为 &lt;code&gt;front-envoy&lt;/code&gt;）的默认端口为 8443。此端口值是可配置的。例如，它可以更改为 443。如果更改了默认端口，则通过 &lt;code&gt;front-envoy&lt;/code&gt; 通信的所有组件都需要相应调整以匹配用户定义的 &lt;code&gt;front-envoy&lt;/code&gt; 端口的值。
  &lt;/div&gt;
&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;源&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;xcp-edge.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;TSB 负载均衡器 IP，端口 &lt;code&gt;9443&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;TSB 负载均衡器 IP，端口 &lt;code&gt;8443&lt;/code&gt; 或用户定义的 &lt;code&gt;front-envoy&lt;/code&gt; 端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;otel-collector.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;TSB 负载均衡器 IP，端口 &lt;code&gt;8443&lt;/code&gt; 或用户定义的 &lt;code&gt;front-envoy&lt;/code&gt; 端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Elasticsearch 目标 IP 和端口  &lt;em&gt;(如果使用 Elasticsearch 的演示部署或使用 &lt;code&gt;front-envoy&lt;/code&gt; 作为 Elasticsearch 代理，请更改为 TSB 负载均衡器 IP，端口 &lt;code&gt;8443&lt;/code&gt; 或用户定义的 &lt;code&gt;front-envoy&lt;/code&gt; 端口)&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;k8s-上的-sidecars-和-istio-控制平面之间&#34;&gt;k8s 上的 Sidecars 和 Istio 控制平面之间&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;源&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;任何应用程序命名空间中的 sidecar 或负载均衡器，或  任何命名空间中的共享负载均衡器以访问 Istio Pilot xDS 服务器。&lt;/td&gt;
&lt;td&gt;&lt;code&gt;istiod.istio-system&lt;/code&gt;，端口 &lt;code&gt;15012&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;任何应用程序命名空间中的 sidecar 或负载均衡器，或  任何命名空间中的共享负载均衡器以访问 SkyWalking OAP 指标服务器。&lt;/td&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;，端口 &lt;code&gt;11800&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;任何应用程序命名空间中的 sidecar 或负载均衡器，或  任何命名空间中的共享负载均衡器以访问 SkyWalking OAP 跟踪服务器。&lt;/td&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;，端口 &lt;code&gt;9411&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;vm-上的-sidecars-和-istio-控制平面之间&#34;&gt;VM 上的 Sidecars 和 Istio 控制平面之间&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;源&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;VM 上的 sidecar 以访问 Istio Pilot xDS 服务器、SkyWalking OAP 指标服务器、跟踪服务器&lt;/td&gt;
&lt;td&gt;VM 网关（&lt;code&gt;vmgateway.istio-system&lt;/code&gt;）负载均衡器 IP，&lt;br /&gt;端口 &lt;code&gt;15443&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;vm-上的-sidecars-和-k8s-中的工作负载之间&#34;&gt;VM 上的 Sidecars 和 k8s 中的工作负载之间&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;源&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;VM 上的 sidecar 以访问 k8s 中的工作负载&lt;/td&gt;
&lt;td&gt;要么 k8s pod 直接，要么 VM 网关（&lt;code&gt;vmgateway.istio-system&lt;/code&gt;）负载均衡器 IP，&lt;br /&gt;端口 &lt;code&gt;15443&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;k8s-中的工作负载和-vm-上的-sidecars-之间&#34;&gt;k8s 中的工作负载和 VM 上的 Sidecars 之间&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;源&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;k8s pod 以访问 VM 上的工作负载&lt;/td&gt;
&lt;td&gt;VM IP&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;集群-a-中的工作负载和集群-b-中的工作负载之间&#34;&gt;集群 A 中的工作负载和集群 B 中的工作负载之间&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;源&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;k8s pod 或 VM（集群 A）&lt;/td&gt;
&lt;td&gt;每个服务网关负载均衡器 IP，端口 &lt;code&gt;15443&lt;/code&gt;（集群 B）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;k8s pod 或 VM（集群 B）&lt;/td&gt;
&lt;td&gt;每个服务网关负载均衡器 IP，端口 &lt;code&gt;15443&lt;/code&gt;（集群 A）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



&lt;div class=&#34;alert alert-warning-container&#34;&gt;
  
  &lt;div class=&#34;alert-warning-title px-2 py-2&#34;&gt;
    共享负载均衡器
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-warning px-2&#34;&gt;
    如果使用共享负载均衡器，则负载均衡器 envoy 需要能够与所有附加的应用程序及其服务通信。由于这些信息事先未知，我们无法确定在防火墙中打开的端口的确切信息。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;tsb-组件端口&#34;&gt;TSB 组件端口&lt;/h2&gt;
&lt;p&gt;以下是 TSB 组件使用的端口和协议。&lt;/p&gt;
&lt;h3 id=&#34;cert-manager&#34;&gt;Cert manager&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;端口&lt;/th&gt;
&lt;th&gt;协议&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;10250&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;管理平面&#34;&gt;管理平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;端口&lt;/th&gt;
&lt;th&gt;协议&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;管理平面 Operator &lt;code&gt;tsb-operator-management-plane.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB API 服务器 &lt;code&gt;tsb.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8000&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;42422&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Open Telemetry &lt;code&gt;otel-collector.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9091&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;收集器端点&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13133&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB 前端 Envoy &lt;code&gt;envoy.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTP/GRPC&lt;/td&gt;
&lt;td&gt;TSB HTTP 和 GRPC API 端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;TCP&lt;/td&gt;
&lt;td&gt;XCP 端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IAM &lt;code&gt;iamserver.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8000&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;42422&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MPC &lt;code&gt;mpc.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;42422&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP &lt;code&gt;oap.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11800&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12800&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;REST API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1234&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9411&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;追踪查询&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9412&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;追踪收集&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB UI &lt;code&gt;web.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP 服务端口和健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Operator 中心 &lt;code&gt;xcp-operator-central.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP 中心 &lt;code&gt;central.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;调试接口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;控制平面&#34;&gt;控制平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;端口&lt;/th&gt;
&lt;th&gt;协议&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;控制平面 Operator &lt;code&gt;tsb-operator-control-plane.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Open Telemetry &lt;code&gt;otel-collector.tsb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9091&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;收集器端点&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13133&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP &lt;code&gt;oap.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11800&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12800&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;REST API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1234&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15021&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Envoy sidecar 健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15020&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Envoy sidecar 合并的 Prometheus 遥测，来自 Istio 代理、Envoy 和应用程序&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9411&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;追踪查询&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9412&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;追踪收集&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio Operator &lt;code&gt;istio-operator.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istiod &lt;code&gt;istiod.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;调试接口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15010&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS 和 CA 服务（明文，仅限安全网络）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15012&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS 和 CA 服务（TLS 和 mTLS，推荐用于生产环境）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15014&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;控制平面监控&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15017&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Operator 中心 &lt;code&gt;xcp-operator-edge.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP 中心 &lt;code&gt;edge.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;调试接口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding Operator &lt;code&gt;onboarding-operator.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding 仓库 &lt;code&gt;onboarding-repository.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding 平面 &lt;code&gt;onboarding-plane.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Onboarding API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;VM 网关 &lt;code&gt;vmgateway.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15021&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;健康检查&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15012&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Istiod&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11800&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;OAP 指标&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9411&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;追踪&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;mTLS 流量端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;HTTPS 端口&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;数据平面&#34;&gt;数据平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;端口&lt;/th&gt;
&lt;th&gt;协议&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;数据平面 Operator &lt;code&gt;tsb-operator-data-plane.istio-gateway&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio Operator &lt;code&gt;istio-operator.istio-gateway&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus 遥测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istiod &lt;code&gt;istiod.istio-gateway&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks 服务端口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;调试接口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15010&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS 和 CA 服务（明文，仅限安全网络）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15012&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS 和 CA 服务（TLS 和 mTLS，推荐用于生产环境）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15014&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;控制平面监控&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15017&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook 容器端口，从 443 转发&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;sidecars&#34;&gt;Sidecars&lt;/h3&gt;
&lt;p&gt;参考 Istio 使用的端口 查看 Istio Sidecar 代理使用的端口和协议列表。&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>Istio 隔离边界</title>
      <link>https://jimmysong.io/book/tsb/setup/isolation-boundaries/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/isolation-boundaries/</guid>
      <description>
        
        
        &lt;p&gt;Istio 隔离边界可以在 Kubernetes 集群内或跨多个集群中运行多个由 TSB（Tetrate Service Bridge）管理的 Istio 环境。这些 Istio 环境在服务发现和配置分发方面彼此隔离。隔离边界带来了以下几个好处：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;强大的网络隔离默认提供了在高度受管制的环境中严格且易于演示的安全性。&lt;/li&gt;
&lt;li&gt;在集群内运行不同的 Istio 版本允许你在同一集群中支持传统和现代应用程序。&lt;/li&gt;
&lt;li&gt;金丝雀发布提供了在测试和部署 TSB 升级时的灵活性。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    升级
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    要从非修订的控制平面升级到修订的控制平面，请按照 &lt;a href=&#34;../upgrades/non-revisioned-to-revisioned&#34; title=&#34;非修订版到修订版的升级&#34;&gt;非修订版到修订版的升级&lt;/a&gt; 中提到的步骤进行操作。
  &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    OpenShift
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    如果你使用 OpenShift，请将以下 &lt;code&gt;kubectl&lt;/code&gt; 命令替换为 &lt;code&gt;oc&lt;/code&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;对于全新安装，你可以按照使用 &lt;a href=&#34;../../setup/self-managed/onboarding-clusters&#34; title=&#34;tctl&#34;&gt;tctl&lt;/a&gt; 或 &lt;a href=&#34;../../setup/helm/controlplane&#34; title=&#34;helm&#34;&gt;helm&lt;/a&gt; 来加入控制平面集群的标准步骤，以及以下更改进行操作：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通过将 &lt;code&gt;ISTIO_ISOLATION_BOUNDARIES&lt;/code&gt; 设置为 &lt;code&gt;true&lt;/code&gt; 在 TSB 控制平面 Operator 中启用隔离边界。&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;ControlPlane&lt;/code&gt; CR 或控制平面 Helm 值中添加隔离边界定义。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在以下示例中，你将使用 Helm 启用隔离边界来加入一个集群。&lt;/p&gt;
&lt;h3 id=&#34;使用-helm-安装&#34;&gt;使用 Helm 安装&lt;/h3&gt;
&lt;p&gt;按照 &lt;a href=&#34;../../setup/helm/controlplane&#34; title=&#34;使用 Helm 安装控制平面&#34;&gt;使用 Helm 安装控制平面&lt;/a&gt; 中的说明，使用以下 Helm 值来启用 Istio 隔离边界。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_ISOLATION_BOUNDARIES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;managementPlane&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;cluster-name-in-tsb&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-address&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;telemetryStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;elastic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-address&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;elastic-version&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;is-elastic-use-self-signed-certificate&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterFQN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;organizations/jupiter/clusters/&amp;lt;cluster-name-in-tsb&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;JWK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;$JWK&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装步骤完成后，请查看 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中的 &lt;code&gt;deployments&lt;/code&gt;、&lt;code&gt;configmaps&lt;/code&gt; 和 &lt;code&gt;webhooks&lt;/code&gt;。所有属于修订的 Istio 控制平面的资源都将在名称中具有 &lt;code&gt;revisions.name&lt;/code&gt; 作为后缀。这些资源将存在于配置在 &lt;code&gt;isolationBoundaries&lt;/code&gt; 下的每个修订中。&lt;/p&gt;
&lt;p&gt;控制平面 Operator 会验证跨隔离边界的修订名称是否唯一。此修订名称值将用于配置修订的命名空间并启动修订的数据平面网关。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get deployment -n istio-system &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep stable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
istio-operator-dev-stable             1/1     1            1           2d1h
istio-operator-qa-stable              1/1     1            1           45h
istiod-dev-stable                     1/1     1            1           2d1h
istiod-qa-stable                      1/1     1            1           45h
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get configmap -n istio-system &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep stable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
istio-dev-stable                      2      2d1h
istio-qa-stable                       2      45h
istio-sidecar-injector-dev-stable     2      2d1h
istio-sidecar-injector-qa-stable      2      45h
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;使用-tctl-安装&#34;&gt;使用 tctl 安装&lt;/h3&gt;
&lt;p&gt;如果你更喜欢使用 &lt;a href=&#34;../self-managed/onboarding-clusters&#34; title=&#34;tctl 安装&#34;&gt;tctl 安装&lt;/a&gt;，你可以使用以下命令生成启用 Istio 隔离边界的集群 Operator。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl install manifest cluster-operators &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --registry &amp;lt;registry-location&amp;gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set &lt;span class=&#34;s2&#34;&gt;&amp;#34;operator.deployment.env[0].name=ISTIO_ISOLATION_BOUNDARIES&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set &lt;span class=&#34;s2&#34;&gt;&amp;#34;operator.deployment.env[0].value=true&amp;#34;&lt;/span&gt; &amp;gt; clusteroperators.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后，在你的 &lt;code&gt;ControlPlane&lt;/code&gt; CR 或 Helm 值中使用以下方式更新 &lt;code&gt;xcp&lt;/code&gt; 组件与 &lt;code&gt;isolationBoundaries&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;无论你选择哪种安装方式，使用隔离边界的示例都是相同的。&lt;/p&gt;
&lt;h3 id=&#34;在修订中指定-tsb-版本&#34;&gt;在修订中指定 TSB 版本&lt;/h3&gt;
&lt;p&gt;Istio 隔离边界还提供了一种控制用于部署控制平面组件和数据平面代理的 Istio 版本的方式。可以在隔离边界配置中指定如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.6.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.6.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用这些配置，会部署两个修订的控制平面，使用相应的 TSB 发布的 Istio 镜像。
在单个隔离边界中具有多个修订有助于从一个 &lt;code&gt;tsbVersion&lt;/code&gt; 升级到另一个 &lt;code&gt;tsbVersion&lt;/code&gt; 中的特定隔离边界的工作负载。有关更多详细信息，请参阅 &lt;a href=&#34;../upgrades/revisioned-to-revisioned&#34; title=&#34;已修订版本间的升级&#34;&gt;已修订版本间的升级&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;如果将 &lt;code&gt;tsbVersion&lt;/code&gt; 字段留空，则 &lt;code&gt;ControlPlane&lt;/code&gt; 资源将默认为当前 TSB 发布的版本。&lt;/p&gt;
&lt;h2 id=&#34;使用隔离边界和修订&#34;&gt;使用隔离边界和修订&lt;/h2&gt;
&lt;h3 id=&#34;应用部署&#34;&gt;应用部署&lt;/h3&gt;
&lt;p&gt;现在可以在具有修订标签的适当命名空间中部署工作负载。修订标签 &lt;code&gt;istio.io/rev&lt;/code&gt; 确定了代理用于连接服务发现和 xDS 更新的修订控制平面。确保如下配置工作负载命名空间：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些命名空间中的应用程序 Pod 将被注入 Istio 代理配置，使它们能够连接到相应的修订 Istio 控制平面。&lt;/p&gt;
&lt;h3 id=&#34;vm-工作负载载入&#34;&gt;VM 工作负载载入&lt;/h3&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    单一隔离边界
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;a href=&#34;../workload-onboarding/guides&#34; title=&#34;工作负载载入&#34;&gt;工作负载载入&lt;/a&gt; 仅支持单一隔离边界。多个隔离边界的支持将在后续版本中提供。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;默认情况下，工作负载载入将使用非修订的 Istio 控制平面。要使用修订的控制平面，你需要使用 &lt;a href=&#34;../workload-onboarding/guides/setup&#34; title=&#34;修订链接&#34;&gt;修订链接&lt;/a&gt; 从 TSB 工作负载载入存储库下载 Istio Sidecar。&lt;/p&gt;
&lt;p&gt;你还需要在 VM 的 &lt;code&gt;/etc/onboarding-agent/agent.config.yaml&lt;/code&gt; 中更新 &lt;a href=&#34;../../refs/onboarding/config/agent/v1alpha1/agent-configuration&#34; title=&#34;代理配置&#34;&gt;代理配置&lt;/a&gt; 以添加修订值。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;config.agent.onboarding.tetrate.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AgentConfiguration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后重新启动载入代理。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl restart onboarding-agent
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果你使用 cloud-init 来配置 VM，请在 cloud-init 文件中添加上述 &lt;code&gt;AgentConfiguration&lt;/code&gt;。由于文件 &lt;code&gt;/etc/onboarding-agent/agent.config.yaml&lt;/code&gt; 可能提前创建，因此对于基于 Debian 的操作系统，需要在非交互式安装时安装载入代理时传递 &lt;code&gt;-o Dpkg::Options::=&amp;quot;--force-confold&amp;quot;&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install -y -o Dpkg::Options::&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--force-confold&amp;#34;&lt;/span&gt; ./onboarding-agent.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;工作区配置&#34;&gt;工作区配置&lt;/h3&gt;
&lt;p&gt;可以通过指定隔离边界名称来配置每个工作区，如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Workspace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/qa-bookinfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Workspace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/dev-bookinfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    设置
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    &lt;p&gt;在 Brownfiled 设置中，现有的工作区将不会配置为任何特定的隔离边界。在这种情况下，如果启用并配置了 Istio 隔离边界，则工作区将视为属于一个名为 &amp;ldquo;global&amp;rdquo; 的隔离边界。如果未在 &lt;code&gt;ControlPlane&lt;/code&gt; CR 中配置此 &amp;ldquo;global&amp;rdquo; 隔离边界，则工作区将不属于任何隔离边界。因此，建议为未在其规范中指定任何隔离边界的工作区创建一个名为 &amp;ldquo;global&amp;rdquo; 的备用隔离边界。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;网关部署&#34;&gt;网关部署&lt;/h3&gt;
&lt;p&gt;对于每个网关（入口/出口/Tier1）资源，必须设置属于所需隔离边界的 &lt;code&gt;revision&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;例如，在你的入口网关部署中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.tetrate.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IngressGateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb-gateway-dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable        &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 修订值&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;应用后，这将导致 &lt;strong&gt;修订的&lt;/strong&gt; 网关部署。&lt;/p&gt;
&lt;h3 id=&#34;istio-隔离&#34;&gt;Istio 隔离&lt;/h3&gt;
&lt;p&gt;在单个/多个集群中设置多个隔离边界允许用户运行在服务发现方面分隔的多个网格环境。这意味着一个隔离边界中的服务仅对相同隔离边界中的客户端可发现，从而允许流量流向相同隔离边界中的服务。通过隔离边界分离的服务将无法发现彼此，从而导致不跨边界流量。&lt;/p&gt;
&lt;p&gt;作为一个简单的示例，考虑以下隔离边界配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-testing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这对应于三个单独的命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt;、&lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 和 &lt;code&gt;qa-bookinfo&lt;/code&gt;，适当附加修订标签。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-testing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo-testing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;请注意，命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 属于同一个隔离边界 &lt;code&gt;dev&lt;/code&gt;，而命名空间 &lt;code&gt;qa-bookinfo&lt;/code&gt; 属于隔离边界 &lt;code&gt;qa&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;该配置将对集群产生以下影响：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 中的服务将被命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 中运行的代理发现。这是因为命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 都属于同一个隔离边界。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 中的服务将不会被命名空间 &lt;code&gt;qa-bookinfo&lt;/code&gt; 中运行的代理发现。这是因为命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;qa-bookinfo&lt;/code&gt; 属于不同的隔离边界。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;以及其他命名空间的情况类似。&lt;/p&gt;
&lt;h3 id=&#34;严格隔离&#34;&gt;严格隔离&lt;/h3&gt;
&lt;p&gt;如果一个来自一个隔离边界的服务尝试与另一个隔离边界的服务通信，则 &amp;ldquo;客户端&amp;rdquo; 端代理将处理出站流量以确定是否流向网格外部。默认情况下，允许此流量，但可以通过在 &lt;code&gt;IstioOperator&lt;/code&gt; 资源 mesh 配置中使用 &lt;code&gt;outboundTrafficPolicy&lt;/code&gt; 来限制它。
默认情况下，这个 &lt;code&gt;outboundTrafficPolicy&lt;/code&gt; 的值设置为&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;outboundTrafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALLOW_ANY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;为了限制跨隔离边界流量，你可以将 &lt;code&gt;.outboundTrafficPolicy.mode&lt;/code&gt; 设置为 &lt;code&gt;REGISTRY_ONLY&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先列出 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中的 &lt;code&gt;IstioOperator&lt;/code&gt; 资源。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get iop -n istio-system | grep xcp-iop
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
xcp-iop-dev-stable               stable   HEALTHY     25h
xcp-iop-dev-testing              stable   HEALTHY     25h
xcp-iop-qa-stable                stable   HEALTHY     25h
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;选择要设置策略配置的 &lt;code&gt;IstioOperator&lt;/code&gt; 资源名称。我们将使用上面的 TSB 控制平面 Helm 值进行修订，以及以下用于 &lt;code&gt;istio&lt;/code&gt; 组件的覆盖：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubeSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;overlays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-iop-dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.meshConfig.outboundTrafficPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;REGISTRY_ONLY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;可以通过附加的方式以类似的方式为其他 &lt;code&gt;IstioOperator&lt;/code&gt; 执行此操作。&lt;/p&gt;
&lt;h2 id=&#34;故障排除&#34;&gt;故障排除&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;查找位于 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中与 TSB &lt;code&gt;IngressGateway&lt;/code&gt;、&lt;code&gt;EgressGateway&lt;/code&gt;、&lt;code&gt;Tier1Gateway&lt;/code&gt; 资源相对应的 &lt;code&gt;ingressdeployment&lt;/code&gt;、&lt;code&gt;egressdeployment&lt;/code&gt;、&lt;code&gt;tier1deployment&lt;/code&gt; 资源。&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get ingressdeployment -n istio-system
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
NAME                       AGE
tsb-gateway-dev-bookinfo   3h10min
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果缺少这些资源，则 TSB 控制平面运算符未协调 TSB 网关资源到相应的 XCP 资源。首先，重新验证 TSB 控制平面运算符和网关资源之间的修订匹配。接下来，Operator 日志应该提供一些线索。&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;查找位于 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中的相应 &lt;code&gt;IstioOperator&lt;/code&gt; 资源。例如：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get iop -n istio-system | grep dev-stable
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
xcp-iop-dev-stable               dev-stable   HEALTHY     25h
xcpgw-tsb-dev-gateway-bookinfo   dev-stable   HEALTHY     3h14min
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果缺少这些资源，则 &lt;code&gt;xcp-operator-edge&lt;/code&gt; 日志应该提供一些线索。&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;p&gt;如果上述两点都没问题，网关部署/服务仍然没有部署或部署配置与 &lt;code&gt;IstioOperator&lt;/code&gt; 资源中配置的不符，则 Istio 运算符部署日志应该提供一些线索。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;要调试 Istio 代理的服务发现以及服务之间的流量，以下 &lt;code&gt;istioctl&lt;/code&gt; 命令非常有用：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istioctl pc endpoints -n &amp;lt;namespace&amp;gt; deploy/&amp;lt;deployment-name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
ENDPOINT                                                STATUS      OUTLIER CHECK     CLUSTER
10.20.0.36:8090                                         HEALTHY     OK                outbound|80||echo.echo.svc.cluster.local
10.255.20.128:15443                                     HEALTHY     OK                outbound|80||echo.tetrate.io
...
127.0.0.1:15000                                         HEALTHY     OK                prometheus_stats
127.0.0.1:15020                                         HEALTHY     OK                agent
unix://./etc/istio/proxy/XDS                            HEALTHY     OK                xds-grpc
unix://./var/run/secrets/workload-spiffe-uds/socket     HEALTHY     OK                sds-grpc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;和&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istioctl pc routes -n &amp;lt;namespace&amp;gt; deploy/&amp;lt;deployment-name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
NAME                                                        DOMAINS                                                         MATCH                  VIRTUAL SERVICE
80                                                          echo, echo.echo + 1 more...

                                   *                       dev/echo.echo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;你可以根据特定的部署和命名空间替换 &lt;code&gt;&amp;lt;namespace&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;deployment-name&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;这将显示特定部署的终结点和路由，以及它们的状态。你可以查看与特定服务和端点之间的流量匹配的路由规则。这些命令可帮助你排除服务发现问题或配置问题。&lt;/p&gt;
&lt;h3 id=&#34;注意事项&#34;&gt;注意事项&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;隔离边界的最大数量由 TSB 控制平面配置决定。有关详细信息，请参阅控制平面配置。&lt;/li&gt;
&lt;li&gt;修订的控制平面的可用性与非修订的控制平面一样，通过删除对应的 TSB 控制平面资源来禁用。&lt;/li&gt;
&lt;li&gt;默认情况下，每个 Istio 控制平面版本都使用相同的内部 CA。将 Istio 控制平面升级到新版本时，可能会创建新的 CA。如果你有运行中的 mTLS 流量，请确保进行测试以验证在 CA 更改后是否仍然能够正常工作。有关详细信息，请参阅修订到修订的升级。&lt;/li&gt;
&lt;li&gt;如果你想跨隔离边界运行 mTLS 流量，则需要确保 TSB 控制平面支持跨隔离边界的 mTLS 流量。这需要将跨边界服务的根证书添加到 TSB 控制平面的根证书存储库中。&lt;/li&gt;
&lt;li&gt;如果你要在生产环境中使用 Istio 隔离边界，请在生产环境之前仔细测试你的配置。Istio 隔离边界是一个强大的功能，但也复杂，需要精心设计和配置以满足你的需求。&lt;/li&gt;
&lt;li&gt;如果你使用的是 Istio 1.9.0 版本或更高版本，请注意 Istio 资源中的一些字段名称可能发生了变化。请查看 Istio 的官方文档，以了解与你使用的 Istio 版本相关的详细信息。&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
                           
    <item>
      <title>仓库机密</title>
      <link>https://jimmysong.io/book/tsb/setup/remote-registry/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/remote-registry/</guid>
      <description>
        
        
        &lt;p&gt;从版本 1.5 开始，TSB 提供了一种自动获取来自远程私有 Docker 容器仓库的镜像的方式，方法是在 &lt;a href=&#34;../../refs/install/managementplane/v1alpha1/spec#tetrateio-api-install-managementplane-v1alpha1-managementplanespec&#34; title=&#34;ManagementPlane&#34;&gt;ManagementPlane&lt;/a&gt; 和 &lt;a href=&#34;../../refs/install/controlplane/v1alpha1/spec#tetrateio-api-install-controlplane-v1alpha1-controlplanespec&#34; title=&#34;ControlPlane&#34;&gt;ControlPlane&lt;/a&gt; CRs 中定义 &lt;code&gt;imagePullSecrets&lt;/code&gt;。
如果定义了 &lt;code&gt;imagePullSecrets&lt;/code&gt;，则将使用秘密中的凭据对必需的 ServiceAccounts 进行补丁，从而允许安全地访问存储在远程私有仓库中的容器。以下步骤概述了配置过程：&lt;/p&gt;
&lt;h2 id=&#34;同步镜像&#34;&gt;同步镜像&lt;/h2&gt;
&lt;p&gt;TSB 镜像位于 Tetrate 的仓库中，只能复制到你的仓库（不允许直接在任何环境中下载）。第一步是将镜像传输到你的仓库。要同步镜像，你需要按照 &lt;a href=&#34;../../setup/requirements-and-download&#34; title=&#34;文档&#34;&gt;文档&lt;/a&gt; 使用 &lt;code&gt;tctl install image-sync&lt;/code&gt;（需要 Tetrate 提供的许可密钥）。&lt;/p&gt;
&lt;h2 id=&#34;获取私有仓库的-json-密钥&#34;&gt;获取私有仓库的 JSON 密钥&lt;/h2&gt;
&lt;p&gt;指定为 &lt;code&gt;imagePullSecrets&lt;/code&gt; 的秘密将存储凭据，允许 Kubernetes 从私有仓库中拉取所需的容器。获取凭据的方式取决于仓库。请参考以下链接以获得主要云提供商的指导 - &lt;a href=&#34;https://medium.com/clarusway/how-to-use-images-from-a-private-container-registry-for-kubernetes-aws-ecr-hosted-private-13a759e2c4ea&#34; title=&#34;AWS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS&lt;/a&gt;、&lt;a href=&#34;https://blog.container-solutions.com/using-google-container-registry-with-kubernetes&#34; title=&#34;GCP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP&lt;/a&gt; 和 &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/container-registry/container-registry-auth-kubernetes&#34; title=&#34;Azure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;在-tsb-使用的每个命名空间中创建机密&#34;&gt;在 TSB 使用的每个命名空间中创建机密&lt;/h2&gt;
&lt;p&gt;如 &lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/secret/#details&#34; title=&#34;Kubernetes 文档&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes 文档&lt;/a&gt; 中所述，机密只能被在其创建的相同命名空间中的 pod 访问。因此，必须为 TSB 使用的每个命名空间创建一个单独的机密。请注意，可用的命名空间可能会根据 Kubernetes 平台而变化。&lt;/p&gt;
&lt;p&gt;目前，以下命名空间需要一个单独的机密：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对于 TSB 管理平面集群 &lt;code&gt;tsb&lt;/code&gt; 和 &lt;code&gt;cert-manager&lt;/code&gt;（如果使用内部 TSB 打包的 cert-manager）&lt;/li&gt;
&lt;li&gt;对于 TSB 控制平面集群 &lt;code&gt;istio-system&lt;/code&gt;、&lt;code&gt;istio-gateway&lt;/code&gt;、&lt;code&gt;cert-manager&lt;/code&gt;（如果使用内部 TSB 打包的 cert-manager）和 &lt;code&gt;kube-system&lt;/code&gt;（如果使用 Istio CNI）&lt;/li&gt;
&lt;/ul&gt;



&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    附加的命名空间
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    上述提供的列表不是详尽无遗的。不同平台上可能会使用额外的命名空间来运行 TSB 组件，因此需要创建单独的机密。要检查是否有任何 pod 无法获取容器镜像的问题，可以使用命令 &lt;code&gt;kubectl get pods -A | grep ImagePullBackOff&lt;/code&gt;。
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;应用程序命名空间&#34;&gt;应用程序命名空间&lt;/h2&gt;
&lt;p&gt;为了确保启用 Istio 的应用程序能够下载镜像，需要在每个启用了 Istio Sidecar 的 pod 和 Ingress Gateway 的应用程序命名空间中存在仓库凭据机密。&lt;/p&gt;
&lt;h2 id=&#34;安装-tsb&#34;&gt;安装 TSB&lt;/h2&gt;
&lt;p&gt;要安装 TSB，请使用你喜欢的方法，但确保 ManagementPlane 和 ControlPlane CRs 配置为如下所示的 &lt;code&gt;imagePullSecrets&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;在上一步中创建的机密名称&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;补丁-operator-serviceaccounts&#34;&gt;补丁 Operator ServiceAccounts&lt;/h2&gt;
&lt;p&gt;在 Operator 能够将 &lt;code&gt;imagePullSecrets&lt;/code&gt; 传播到其余组件之前，TSB Operator 的镜像需要凭据。&lt;/p&gt;
&lt;p&gt;步骤如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;补丁 &lt;code&gt;istio-system&lt;/code&gt; 和 &lt;code&gt;istio-gateway&lt;/code&gt; 命名空间中 TSB 运算符的 ServiceAccounts：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl patch serviceaccount tsb-operator-control-plane -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;imagePullSecrets&amp;#34;: [{&amp;#34;name&amp;#34;: &amp;#34;&amp;lt;在上述步骤中创建的机密名称&amp;gt;&amp;#34;}]}&amp;#39;&lt;/span&gt; -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl patch serviceaccount tsb-operator-data-plane -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;imagePullSecrets&amp;#34;: [{&amp;#34;name&amp;#34;: &amp;#34;&amp;lt;在上述步骤中创建的机密名称&amp;gt;&amp;#34;}]}&amp;#39;&lt;/span&gt; -n istio-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在这些命名空间中重新启动运算符：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete pod -n istio-system -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tsb-operator 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete pod -n istio-gateway -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tsb-operator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete pod -n istio-gateway -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-operator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    Helm chart 安装
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    可以使用 &lt;a href=&#34;../helm&#34; title=&#34;Helm 安装&#34;&gt;Helm 安装&lt;/a&gt; 自动执行创建机密和定义 &lt;code&gt;imagePullSecrets&lt;/code&gt; 的步骤。
  &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    步骤的顺序
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    非常重要的是，在安装 TSB 之前创建私有仓库的 Kubernetes 机密。遵循这个正确的顺序将允许有效的部署并将任何停机时间降到最低。
  &lt;/div&gt;
&lt;/div&gt;
&lt;/p&gt;

      </description>
    </item>
                           
    <item>
      <title>控制平面升级</title>
      <link>https://jimmysong.io/book/tsb/setup/upgrades/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/upgrades/</guid>
      <description>
        
        
        

  &lt;ul&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/upgrades/non-revisioned-to-revisioned/&#34;&gt;非修订版到修订版的升级&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/upgrades/revisioned-to-revisioned/&#34;&gt;已修订版本间的升级&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/upgrades/gateway-upgrade/&#34;&gt;网关升级&lt;/a&gt;
        
      &lt;/li&gt;
    
      &lt;li&gt;
        &lt;a href=&#34;https://jimmysong.io/book/tsb/setup/upgrades/cni-upgrade/&#34;&gt;修订的 Istio CNI 和升级&lt;/a&gt;
        
      &lt;/li&gt;
    
  &lt;/ul&gt;



      </description>
    </item>
                           
    <item>
      <title>从 tctl 迁移到 Helm</title>
      <link>https://jimmysong.io/book/tsb/setup/migrate-tctl-to-helm/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <author>Jimmy Song</author>
      <guid>https://jimmysong.io/book/tsb/setup/migrate-tctl-to-helm/</guid>
      <description>
        
        
        &lt;p&gt;这份文档将覆盖如何迁移使用 tctl 的 TSB 的实时安装，并迁移到 Helm。文档假设 &lt;a href=&#34;https://helm.sh/docs/intro/install/&#34; title=&#34;Helm 已经安装&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm 已经安装&lt;/a&gt; 在系统中。&lt;/p&gt;
&lt;p&gt;在开始之前，请确保你：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;熟悉 &lt;a href=&#34;../../concepts/&#34; title=&#34;TSB 概念&#34;&gt;TSB 概念&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;安装了 TSB 环境。你可以使用 &lt;a href=&#34;../self-managed/demo-installation&#34; title=&#34;TSB 演示&#34;&gt;TSB 演示&lt;/a&gt; 进行快速安装。&lt;/li&gt;
&lt;li&gt;完成了 &lt;a href=&#34;../../quickstart&#34; title=&#34;TSB 使用快速入门&#34;&gt;TSB 使用快速入门&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;准备-helm-chart&#34;&gt;准备 Helm Chart&lt;/h2&gt;
&lt;p&gt;在进行之前，你必须熟悉 Helm。请按照我们的指南中的 &lt;a href=&#34;../helm/helm&#34; title=&#34;先决条件&#34;&gt;先决条件&lt;/a&gt; 安装 TSB 与 Helm。&lt;/p&gt;
&lt;h2 id=&#34;迁移管理平面&#34;&gt;迁移管理平面&lt;/h2&gt;
&lt;p&gt;迁移当前的安装只需要标记和注释平面安装的资源。所有其他组件将由 tsb-operator 升级和管理。以下是标记每个将由 Helm 管理的资源的命令列表。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label deployment tsb-operator-management-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate deployment tsb-operator-management-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate service tsb-operator-management-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate sa tsb-operator-management-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label secret elastic-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate secret elastic-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label secret es-certs &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate secret es-certs &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label secret ldap-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate secret ldap-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label secret postgres-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate secret postgres-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label secret admin-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate secret admin-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl annotate clusterrole tsb-operator-management-plane-tsb &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl annotate clusterrolebinding tsb-operator-management-plane-tsb &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb label managementplane managementplane &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n tsb annotate managementplane managementplane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=mp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;div class=&#34;alert alert-note-container&#34;&gt;
  
  &lt;div class=&#34;alert-note-title px-2 py-2&#34;&gt;
    注意
  &lt;/div&gt;
  
  &lt;div class=&#34;alert-note px-2&#34;&gt;
    release-name 和 release-namespace 应该与 Helm 安装命令中使用的发行名称和命名空间匹配。
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;在所有资源都正确标记后，然后继续安装发布：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### 示例&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade mp tetrate-tsb-helm/managementplane --install --namespace tsb -f upgrade-mpt1/helm/values-mp.yaml --set image.registry&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set image.tag&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TSB_VERSION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set spec.hub&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### 输出：&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Release &lt;span class=&#34;s2&#34;&gt;&amp;#34;mp&amp;#34;&lt;/span&gt; does not exist. Installing it now.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME: mp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;LAST DEPLOYED: Thu May &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:03:18 &lt;span class=&#34;m&#34;&gt;2023&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAMESPACE: tsb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STATUS: deployed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REVISION: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TEST SUITE: None
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NOTES:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Thank you &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; installing the TSB Management plane 1.5.11.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chart: managementplane
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version: 1.5.11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Your Management Plane is ready to be used.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Next step might be to onboard the cluster from the control plane.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You could choose between:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; - install &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;controlplane&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; chart
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; - manually following
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Discover the TSB entrypoint&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Check the IP &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the envoy loadbalancer service.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;This is one example. Consider a &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the service to be ready:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get svc -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;tsb&amp;#34;&lt;/span&gt; envoy --output &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Configure the TCTL admin profile, using the IP in the previous step.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Setup the TSB address as follows. If specific settings are needed to trust the certificate configured in TSB,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# refer to the `tctl config clusters set --help` command to see all the available options.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; helm --bridge-address &amp;lt;IP&amp;gt;:8443
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; helm --username admin --password &lt;span class=&#34;s2&#34;&gt;&amp;#34;NotAPassword&amp;#34;&lt;/span&gt; --org &lt;span class=&#34;s2&#34;&gt;&amp;#34;tetrate&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; helm --cluster helm --username helm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current helm 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;迁移控制平面&#34;&gt;迁移控制平面&lt;/h2&gt;
&lt;p&gt;该过程相同，只有一些资源和机密发生了变化。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system label deployment tsb-operator-control-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate deployment tsb-operator-control-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate service tsb-operator-control-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate sa tsb-operator-control-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate secret elastic-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate secret elastic-credentials &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system label secret cluster-service-account &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate secret cluster-service-account &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; label secret mp-certs &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate secret mp-certs &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system label secret xcp-central-ca-bundle &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate secret xcp-central-ca-bundle &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl annotate clusterrole tsb-operator-control-plane-istio-system &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl annotate clusterrolebinding tsb-operator-control-plane-istio-system &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system label controlplane  controlplane &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system annotate controlplane controlplane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=cp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;验证并检查 release-name 和 release-namespace 是否指向发布安装中使用的值：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### 示例&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade cp tetrate-tsb-helm/controlplane --install --namespace istio-system -f upgrade-mpt1/helm/values-cp.yaml  --set image.registry&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set image.tag&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TSB_VERSION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set spec.hub&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set spec.managementPlane.host&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TSB_HOST&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set-file secrets.clusterServiceAccount.JWK&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/tmp/upgrade-mpt1.jwk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### 输出&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Release &lt;span class=&#34;s2&#34;&gt;&amp;#34;cp&amp;#34;&lt;/span&gt; does not exist. Installing it now.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME: cp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;LAST DEPLOYED: Thu May &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:21:18 &lt;span class=&#34;m&#34;&gt;2023&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAMESPACE: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STATUS: deployed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REVISION: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TEST SUITE: None
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NOTES:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Thank you &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; installing the TSB Control Plane 1.5.11.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chart: controlplane
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version: 1.5.11
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;迁移数据平面&#34;&gt;迁移数据平面&lt;/h2&gt;
&lt;p&gt;这是最后一个平面，需要注释的资源较少：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-gateway label deployment tsb-operator-data-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-gateway annotate deployment tsb-operator-data-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=dp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-gateway annotate service tsb-operator-data-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=dp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-gateway annotate sa tsb-operator-data-plane &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=dp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl annotate clusterrole tsb-operator-data-plane-istio-gateway &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=dp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl annotate clusterrolebinding tsb-operator-data-plane-istio-gateway &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-name=dp&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;继续安装发布：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### 示例&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade dp tetrate-tsb-helm/dataplane --install --namespace istio-gateway --create-namespace --set image.registry&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --set image.tag&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TSB_VERSION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### 输出&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Release &lt;span class=&#34;s2&#34;&gt;&amp;#34;dp&amp;#34;&lt;/span&gt; does not exist. Installing it now.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME: dp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;LAST DEPLOYED: Thu May &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:29:11 &lt;span class=&#34;m&#34;&gt;2023&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAMESPACE: istio-gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STATUS: deployed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REVISION: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TEST SUITE: None
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NOTES:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Thank you &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; installing the TSB Data Plane 1.5.11.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chart: dataplane
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version: 1.5.11
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
  </channel>
</rss>
