<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> Kuberneteæ¦‚å¿µè§£æä¹‹Deployment - Cloud NativeğŸ¤˜Big Data</title>
  <meta name="description" content="Cloud NativeğŸ¤˜Big Data" />
  <meta property="og:title" content="Kuberneteæ¦‚å¿µè§£æä¹‹Deployment" />
  <meta name="twitter:title" content="Kuberneteæ¦‚å¿µè§£æä¹‹Deployment" />
  <meta name="description" content="ï¼ˆé¢˜å›¾ï¼šäº¬å¹¿æ¡¥@åŒ—äº¬å›½è´¸ Apr 30,2017ï¼‰ å‰è¨€ æœ¬æ–‡åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“kubernetes-handbookä¸­ã€‚ æœ¬æ–‡ç¿»è¯‘è‡ªkubern">
  <meta property="og:description" content="ï¼ˆé¢˜å›¾ï¼šäº¬å¹¿æ¡¥@åŒ—äº¬å›½è´¸ Apr 30,2017ï¼‰ å‰è¨€ æœ¬æ–‡åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“kubernetes-handbookä¸­ã€‚ æœ¬æ–‡ç¿»è¯‘è‡ªkubern">
  <meta name="twitter:description" content="ï¼ˆé¢˜å›¾ï¼šäº¬å¹¿æ¡¥@åŒ—äº¬å›½è´¸ Apr 30,2017ï¼‰ å‰è¨€ æœ¬æ–‡åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“kubernetes-handbookä¸­ã€‚ æœ¬æ–‡ç¿»è¯‘è‡ªkubern">
  <meta name="author" content="{Description { .Site.Author.name }}"/>
  <link href='https://jimmysong.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jimmysongio" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/posts/kubernetes-concept-deployment/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Jimmy Song" />

  <meta name="generator" content="Hugo 0.30-DEV" />
  <link rel="canonical" href="https://jimmysong.io/posts/kubernetes-concept-deployment/" />
  <link rel="alternate" href="https://jimmysong.io/index.xml" type="application/rss+xml" title="Jimmy Song">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://jimmysong.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  

<meta name="baidu-site-verification" content="g8IYR9SNLF" />
<script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

<link rel="stylesheet" href="https://jimmysong.io/css/prism.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jimmysong.io/">Jimmy Song</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Articles</a>
              <div class="navlinks-children">
                
                  <a href="/posts">Posts</a>
                
                  <a href="/tags">Tags</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Categories</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes">kubernetes</a>
                
                  <a href="/categories/cloud-native">Cloud Native</a>
                
                  <a href="/categories/github">Github</a>
                
                  <a href="/categories/devops">Devops</a>
                
                  <a href="/categories/docker">Docker</a>
                
                  <a href="/categories/code">Code</a>
                
                  <a href="/categories/architecture/">Architecture</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Books</a>
              <div class="navlinks-children">
                
                  <a href="/cloud-native-go">Cloud Native Go</a>
                
                  <a href="/posts/cloud-native-python">Cloud Native Python</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Projects</a>
              <div class="navlinks-children">
                
                  <a href="/kubernetes-handbook">Kubernetes handbook</a>
                
                  <a href="/spark-on-k8s">Spark on kubernetes</a>
                
                  <a href="/awesome-cloud-native">Awesome Cloud Native</a>
                
                  <a href="/migrating-to-cloud-native-application-architectures"> Migrating to Cloud native</a>
                
                  <a href="http://istio.doczh.cn">Istio service mesh</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Jimmy Song" href="https://jimmysong.io/">
            <img class="avatar-img" src="https://jimmysong.io/img/avatar-icon.png" alt="Jimmy Song" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
            
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="posts-heading">
                <h1 align="center">Kuberneteæ¦‚å¿µè§£æä¹‹Deployment</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Sat May 13, 2017</h4>
                </section>
                <h5 id="wc">12500 Words|Read in about 25 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/kubernetes">kubernetes</a> &nbsp;
                </h5>

            </div>
            <article role="main" class="blog-post">
                

<p><img src="https://res.cloudinary.com/jimmysong/image/upload/images/20170430008.jpg" alt="äº¬å¹¿æ¡¥" /></p>

<p><em>ï¼ˆé¢˜å›¾ï¼šäº¬å¹¿æ¡¥@åŒ—äº¬å›½è´¸ Apr 30,2017ï¼‰</em></p>

<h2 id="å‰è¨€">å‰è¨€</h2>

<p>æœ¬æ–‡åŒæ­¥æ›´æ–°åˆ°Githubä»“åº“<a href="https://github.com/rootsongjc/kubernetes-handbook">kubernetes-handbook</a>ä¸­ã€‚</p>

<p><a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md">æœ¬æ–‡ç¿»è¯‘è‡ªkuberneteså®˜æ–¹æ–‡æ¡£ - Deployement </a></p>

<p>æœ¬æ–‡ç« æ ¹æ®2017å¹´5æœˆ10æ—¥çš„<code>Commit 8481c02</code>ç¿»è¯‘ã€‚</p>

<p>Deploymentæ˜¯Kubernetesä¸­çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä»å®ƒå¼€å§‹æ˜¯äº†è§£kubernetesä¸­èµ„æºæ¦‚å¿µçš„ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ï¼Œçœ‹åˆ°ç½‘ä¸Šä¹Ÿæ²¡ä»€ä¹ˆè¯¦ç»†çš„è¯´æ˜æ–‡æ¡£ï¼Œæˆ‘å°±éšæ‰‹ç¿»è¯‘äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ˆGithubä¸­çš„æ–‡æ¡£ï¼‰ï¼Œkuberneteså®˜ç½‘ä¸Šçš„æ–‡æ¡£è¿˜æ²¡æœ‰è¿™ä¸ªæ–°ã€‚è¿™ç¯‡æ–‡ç« å¯¹Deploymentçš„æ¦‚å¿µè§£é‡Šçš„é¢é¢ä¿±åˆ°ååˆ†è¯¦å°½ã€‚</p>

<h2 id="deploymentæ˜¯ä»€ä¹ˆ">Deploymentæ˜¯ä»€ä¹ˆï¼Ÿ</h2>

<p>Deploymentä¸ºPodå’ŒReplica Setï¼ˆä¸‹ä¸€ä»£Replication Controllerï¼‰æä¾›å£°æ˜å¼æ›´æ–°ã€‚</p>

<p>ä½ åªéœ€è¦åœ¨Deploymentä¸­æè¿°ä½ æƒ³è¦çš„ç›®æ ‡çŠ¶æ€æ˜¯ä»€ä¹ˆï¼ŒDeployment controllerå°±ä¼šå¸®ä½ å°†Podå’ŒReplica Setçš„å®é™…çŠ¶æ€æ”¹å˜åˆ°ä½ çš„ç›®æ ‡çŠ¶æ€ã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå…¨æ–°çš„Deploymentï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ›¿æ¢æ—§çš„Deploymentã€‚</p>

<p>ä¸€ä¸ªå…¸å‹çš„ç”¨ä¾‹å¦‚ä¸‹ï¼š</p>

<ul>
<li>ä½¿ç”¨Deploymentæ¥åˆ›å»ºReplicaSetã€‚ReplicaSetåœ¨åå°åˆ›å»ºpodã€‚æ£€æŸ¥å¯åŠ¨çŠ¶æ€ï¼Œçœ‹å®ƒæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚</li>
<li>ç„¶åï¼Œé€šè¿‡æ›´æ–°Deploymentçš„PodTemplateSpecå­—æ®µæ¥å£°æ˜Podçš„æ–°çŠ¶æ€ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ReplicaSetï¼ŒDeploymentä¼šæŒ‰ç…§æ§åˆ¶çš„é€Ÿç‡å°†podä»æ—§çš„ReplicaSetç§»åŠ¨åˆ°æ–°çš„ReplicaSetä¸­ã€‚</li>
<li>å¦‚æœå½“å‰çŠ¶æ€ä¸ç¨³å®šï¼Œå›æ»šåˆ°ä¹‹å‰çš„Deployment revisionã€‚æ¯æ¬¡å›æ»šéƒ½ä¼šæ›´æ–°Deploymentçš„revisionã€‚</li>
<li>æ‰©å®¹Deploymentä»¥æ»¡è¶³æ›´é«˜çš„è´Ÿè½½ã€‚</li>
<li>æš‚åœDeploymentæ¥åº”ç”¨PodTemplateSpecçš„å¤šä¸ªä¿®å¤ï¼Œç„¶åæ¢å¤ä¸Šçº¿ã€‚</li>
<li>æ ¹æ®Deployment çš„çŠ¶æ€åˆ¤æ–­ä¸Šçº¿æ˜¯å¦hangä½äº†ã€‚</li>
<li>æ¸…æ¥šæ—§çš„ä¸å¿…è¦çš„ReplicaSetã€‚</li>
</ul>

<h2 id="åˆ›å»ºdeployment">åˆ›å»ºDeployment</h2>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªDeploymentç¤ºä¾‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªReplica Setæ¥å¯åŠ¨3ä¸ªnginx podã€‚</p>

<p>ä¸‹è½½ç¤ºä¾‹æ–‡ä»¶å¹¶æ‰§è¡Œå‘½ä»¤ï¼š</p>

<pre><code class="language-shell">$ kubectl create -f docs/user-guide/nginx-deployment.yaml --record
deployment &quot;nginx-deployment&quot; created
</code></pre>

<p>å°†kubectlçš„ <code>â€”record</code> çš„flagè®¾ç½®ä¸º <code>true</code>å¯ä»¥åœ¨annotationä¸­è®°å½•å½“å‰å‘½ä»¤åˆ›å»ºæˆ–è€…å‡çº§äº†è¯¥èµ„æºã€‚è¿™åœ¨æœªæ¥ä¼šå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹åœ¨æ¯ä¸ªDeployment revisionä¸­æ‰§è¡Œäº†å“ªäº›å‘½ä»¤ã€‚</p>

<p>ç„¶åç«‹å³æ‰§è¡Œ<code>get</code>Ã­å°†è·å¾—å¦‚ä¸‹ç»“æœï¼š</p>

<pre><code class="language-shell">$ kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         0         0            0           1s
</code></pre>

<p>è¾“å‡ºç»“æœè¡¨æ˜æˆ‘ä»¬å¸Œæœ›çš„repalicaæ•°æ˜¯3ï¼ˆæ ¹æ®deploymentä¸­çš„<code>.spec.replicas</code>é…ç½®ï¼‰å½“å‰replicaæ•°ï¼ˆ <code>.status.replicas</code>ï¼‰æ˜¯0, æœ€æ–°çš„replicaæ•°ï¼ˆ<code>.status.updatedReplicas</code>ï¼‰æ˜¯0ï¼Œå¯ç”¨çš„replicaæ•°ï¼ˆ<code>.status.availableReplicas</code>ï¼‰æ˜¯0ã€‚</p>

<p>è¿‡å‡ ç§’åå†æ‰§è¡Œ<code>get</code>å‘½ä»¤ï¼Œå°†è·å¾—å¦‚ä¸‹è¾“å‡ºï¼š</p>

<pre><code class="language-shell">$ kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         3         3            3           18s
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Deploymentå·²ç»åˆ›å»ºäº†3ä¸ªreplicaï¼Œæ‰€æœ‰çš„replicaéƒ½å·²ç»æ˜¯æœ€æ–°çš„äº†ï¼ˆåŒ…å«æœ€æ–°çš„pod templateï¼‰ï¼Œå¯ç”¨çš„ï¼ˆæ ¹æ®Deploymentä¸­çš„<code>.spec.minReadySeconds</code>å£°æ˜ï¼Œå¤„äºå·²å°±ç»ªçŠ¶æ€çš„podçš„æœ€å°‘ä¸ªæ•°ï¼‰ã€‚æ‰§è¡Œ<code>kubectl get rs</code>å’Œ<code>kubectl get pods</code>ä¼šæ˜¾ç¤ºReplica Setï¼ˆRSï¼‰å’ŒPodå·²åˆ›å»ºã€‚</p>

<pre><code class="language-shell">$ kubectl get rs
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-2035384211   3         3         0       18s
</code></pre>

<p>ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°Replica Setçš„åå­—æ€»æ˜¯<code>&lt;Deploymentçš„åå­—&gt;-&lt;pod templateçš„hashå€¼&gt;</code>ã€‚</p>

<pre><code class="language-shell">$ kubectl get pods --show-labels
NAME                                READY     STATUS    RESTARTS   AGE       LABELS
nginx-deployment-2035384211-7ci7o   1/1       Running   0          18s       app=nginx,pod-template-hash=2035384211
nginx-deployment-2035384211-kzszj   1/1       Running   0          18s       app=nginx,pod-template-hash=2035384211
nginx-deployment-2035384211-qqcnn   1/1       Running   0          18s       app=nginx,pod-template-hash=2035384211
</code></pre>

<p>åˆšåˆ›å»ºçš„Replica Setå°†ä¿è¯æ€»æ˜¯æœ‰3ä¸ªnginxçš„podå­˜åœ¨ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> ä½ å¿…é¡»åœ¨Deploymentä¸­çš„selectoræŒ‡å®šæ­£ç¡®pod template labelï¼ˆåœ¨è¯¥ç¤ºä¾‹ä¸­æ˜¯ <code>app = nginx</code>ï¼‰ï¼Œä¸è¦è·Ÿå…¶ä»–çš„controllerææ··äº†ï¼ˆåŒ…æ‹¬Deploymentã€Replica Setã€Replication Controllerç­‰ï¼‰ã€‚<strong>Kubernetesæœ¬èº«ä¸ä¼šé˜»æ­¢ä½ è¿™ä¹ˆåš</strong>ï¼Œå¦‚æœä½ çœŸçš„è¿™ä¹ˆåšäº†ï¼Œè¿™äº›controllerä¹‹é—´ä¼šç›¸äº’æ‰“æ¶ï¼Œå¹¶å¯èƒ½å¯¼è‡´ä¸æ­£ç¡®çš„è¡Œä¸ºã€‚</p>

<h2 id="æ›´æ–°deployment">æ›´æ–°Deployment</h2>

<p><strong>æ³¨æ„ï¼š</strong> Deploymentçš„rolloutå½“ä¸”ä»…å½“Deploymentçš„pod templateï¼ˆä¾‹å¦‚<code>.spec.template</code>ï¼‰ä¸­çš„labelæ›´æ–°æˆ–è€…é•œåƒæ›´æ”¹æ—¶è¢«è§¦å‘ã€‚å…¶ä»–æ›´æ–°ï¼Œä¾‹å¦‚æ‰©å®¹Deploymentä¸ä¼šè§¦å‘rolloutã€‚</p>

<p>å‡å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦è®©nginx podä½¿ç”¨<code>nginx:1.9.1</code>çš„é•œåƒæ¥ä»£æ›¿åŸæ¥çš„<code>nginx:1.7.9</code>çš„é•œåƒã€‚</p>

<pre><code class="language-shell">$ kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1
deployment &quot;nginx-deployment&quot; image updated
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>edit</code>å‘½ä»¤æ¥ç¼–è¾‘Deploymentï¼Œä¿®æ”¹ <code>.spec.template.spec.containers[0].image</code> ï¼Œå°†<code>nginx:1.7.9</code> æ”¹å†™æˆ <code>nginx:1.9.1</code>ã€‚</p>

<pre><code class="language-shell">$ kubectl edit deployment/nginx-deployment
deployment &quot;nginx-deployment&quot; edited
</code></pre>

<p>æŸ¥çœ‹rolloutçš„çŠ¶æ€ï¼Œåªè¦æ‰§è¡Œï¼š</p>

<pre><code class="language-shell">$ kubectl rollout status deployment/nginx-deployment
Waiting for rollout to finish: 2 out of 3 new replicas have been updated...
deployment &quot;nginx-deployment&quot; successfully rolled out
</code></pre>

<p>RolloutæˆåŠŸåï¼Œ<code>get</code> Deploymentï¼š</p>

<pre><code class="language-shell">$ kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         3         3            3           36s
</code></pre>

<p>UP-TO-DATEçš„replicaçš„æ•°ç›®å·²ç»è¾¾åˆ°äº†é…ç½®ä¸­è¦æ±‚çš„æ•°ç›®ã€‚</p>

<p>CURRENTçš„replicaæ•°è¡¨ç¤ºDeploymentç®¡ç†çš„replicaæ•°é‡ï¼ŒAVAILABLEçš„replicaæ•°æ˜¯å½“å‰å¯ç”¨çš„replicaæ•°é‡ã€‚</p>

<p>We can run <code>kubectl get rs</code> to see that the Deployment updated the Pods by creating a new Replica Set and scaling it up to 3 replicas, as well as scaling down the old Replica Set to 0 replicas.</p>

<p>æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ<code>kubectl get rs</code>å¯ä»¥çœ‹åˆ°Deploymentæ›´æ–°äº†Podï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„Replica Setå¹¶æ‰©å®¹äº†3ä¸ªreplicaï¼ŒåŒæ—¶å°†åŸæ¥çš„Replica Setç¼©å®¹åˆ°äº†0ä¸ªreplicaã€‚</p>

<pre><code class="language-shell">$ kubectl get rs
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-1564180365   3         3         0       6s
nginx-deployment-2035384211   0         0         0       36s
</code></pre>

<p>æ‰§è¡Œ <code>get pods</code>åªä¼šçœ‹åˆ°å½“å‰çš„æ–°çš„pod:</p>

<pre><code class="language-shell">$ kubectl get pods
NAME                                READY     STATUS    RESTARTS   AGE
nginx-deployment-1564180365-khku8   1/1       Running   0          14s
nginx-deployment-1564180365-nacti   1/1       Running   0          14s
nginx-deployment-1564180365-z9gth   1/1       Running   0          14s
</code></pre>

<p>ä¸‹æ¬¡æ›´æ–°è¿™äº›podçš„æ—¶å€™ï¼Œåªéœ€è¦æ›´æ–°Deploymentä¸­çš„podçš„templateå³å¯ã€‚</p>

<p>Deploymentå¯ä»¥ä¿è¯åœ¨å‡çº§æ—¶åªæœ‰ä¸€å®šæ•°é‡çš„Podæ˜¯downçš„ã€‚é»˜è®¤çš„ï¼Œå®ƒä¼šç¡®ä¿è‡³å°‘æœ‰æ¯”æœŸæœ›çš„Podæ•°é‡å°‘ä¸€ä¸ªçš„Podæ˜¯upçŠ¶æ€ï¼ˆæœ€å¤šä¸€ä¸ªä¸å¯ç”¨ï¼‰ã€‚</p>

<p>DeploymentåŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿åªåˆ›å»ºå‡ºè¶…è¿‡æœŸæœ›æ•°é‡çš„ä¸€å®šæ•°é‡çš„Podã€‚é»˜è®¤çš„ï¼Œå®ƒä¼šç¡®ä¿æœ€å¤šæ¯”æœŸæœ›çš„Podæ•°é‡å¤šä¸€ä¸ªçš„Podæ˜¯upçš„ï¼ˆæœ€å¤š1ä¸ªsurgeï¼‰ã€‚</p>

<p><strong>åœ¨æœªæ¥çš„Kuberentesç‰ˆæœ¬ä¸­ï¼Œå°†ä»1-1å˜æˆ25%-25%ï¼‰ã€‚</strong></p>

<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è‡ªå·±çœ‹ä¸‹ä¸Šé¢çš„Deploymentï¼Œä½ ä¼šå‘ç°ï¼Œå¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„Podï¼Œç„¶ååˆ é™¤ä¸€äº›æ—§çš„Podå†åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚å½“æ–°çš„Podåˆ›å»ºå‡ºæ¥ä¹‹å‰ä¸ä¼šæ€æ‰æ—§çš„Podã€‚è¿™æ ·èƒ½å¤Ÿç¡®ä¿å¯ç”¨çš„Podæ•°é‡è‡³å°‘æœ‰2ä¸ªï¼ŒPodçš„æ€»æ•°æœ€å¤š4ä¸ªã€‚</p>

<pre><code class="language-shell">$ kubectl describe deployments
Name:           nginx-deployment
Namespace:      default
CreationTimestamp:  Tue, 15 Mar 2016 12:01:06 -0700
Labels:         app=nginx
Selector:       app=nginx
Replicas:       3 updated | 3 total | 3 available | 0 unavailable
StrategyType:       RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
OldReplicaSets:     &lt;none&gt;
NewReplicaSet:      nginx-deployment-1564180365 (3/3 replicas created)
Events:
  FirstSeen LastSeen    Count   From                     SubobjectPath   Type        Reason              Message
  --------- --------    -----   ----                     -------------   --------    ------              -------
  36s       36s         1       {deployment-controller }                 Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-2035384211 to 3
  23s       23s         1       {deployment-controller }                 Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 1
  23s       23s         1       {deployment-controller }                 Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-2035384211 to 2
  23s       23s         1       {deployment-controller }                 Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 2
  21s       21s         1       {deployment-controller }                 Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-2035384211 to 0
  21s       21s         1       {deployment-controller }                 Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 3
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬åˆšå¼€å§‹åˆ›å»ºè¿™ä¸ªDeploymentçš„æ—¶å€™ï¼Œåˆ›å»ºäº†ä¸€ä¸ªReplica Setï¼ˆnginx-deployment-2035384211ï¼‰ï¼Œå¹¶ç›´æ¥æ‰©å®¹åˆ°äº†3ä¸ªreplicaã€‚</p>

<p>å½“æˆ‘ä»¬æ›´æ–°è¿™ä¸ªDeploymentçš„æ—¶å€™ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Replica Setï¼ˆnginx-deployment-1564180365ï¼‰ï¼Œå°†å®ƒæ‰©å®¹åˆ°1ä¸ªreplicaï¼Œç„¶åç¼©å®¹åŸå…ˆçš„Replica Setåˆ°2ä¸ªreplicaï¼Œæ­¤æ—¶æ»¡è¶³è‡³å°‘2ä¸ªPodæ˜¯å¯ç”¨çŠ¶æ€ï¼ŒåŒä¸€æ—¶åˆ»æœ€å¤šæœ‰4ä¸ªPodå¤„äºåˆ›å»ºçš„çŠ¶æ€ã€‚</p>

<p>æ¥ç€ç»§ç»­ä½¿ç”¨ç›¸åŒçš„rolling updateç­–ç•¥æ‰©å®¹æ–°çš„Replica Setå’Œç¼©å®¹æ—§çš„Replica Setã€‚æœ€ç»ˆï¼Œå°†ä¼šåœ¨æ–°çš„Replica Setä¸­æœ‰3ä¸ªå¯ç”¨çš„replicaï¼Œæ—§çš„Replica Setçš„replicaæ•°ç›®å˜æˆ0ã€‚</p>

<h3 id="rollover-å¤šä¸ªrolloutå¹¶è¡Œ">Rolloverï¼ˆå¤šä¸ªrolloutå¹¶è¡Œï¼‰</h3>

<p>æ¯å½“Deployment controllerè§‚æµ‹åˆ°æœ‰æ–°çš„deploymentè¢«åˆ›å»ºæ—¶ï¼Œå¦‚æœæ²¡æœ‰å·²å­˜åœ¨çš„Replica Setæ¥åˆ›å»ºæœŸæœ›ä¸ªæ•°çš„Podçš„è¯ï¼Œå°±ä¼šåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„Replica Setæ¥åšè¿™ä»¶äº‹ã€‚å·²å­˜åœ¨çš„Replica Setæ§åˆ¶labelåŒ¹é…<code>.spec.selector</code>ä½†æ˜¯templateè·Ÿ<code>.spec.template</code>ä¸åŒ¹é…çš„Podç¼©å®¹ã€‚æœ€ç»ˆï¼Œæ–°çš„Replica Setå°†ä¼šæ‰©å®¹å‡º<code>.spec.replicas</code>æŒ‡å®šæ•°ç›®çš„Podï¼Œæ—§çš„Replica Setä¼šç¼©å®¹åˆ°0ã€‚</p>

<p>å¦‚æœä½ æ›´æ–°äº†ä¸€ä¸ªçš„å·²å­˜åœ¨å¹¶æ­£åœ¨è¿›è¡Œä¸­çš„Deploymentï¼Œæ¯æ¬¡æ›´æ–°Deploymentéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Replica Setå¹¶æ‰©å®¹å®ƒï¼ŒåŒæ—¶å›æ»šä¹‹å‰æ‰©å®¹çš„Replica Setâ€”â€”å°†å®ƒæ·»åŠ åˆ°æ—§çš„Replica Setåˆ—è¡¨ï¼Œå¼€å§‹ç¼©å®¹ã€‚</p>

<p>ä¾‹å¦‚ï¼Œå‡å¦‚ä½ åˆ›å»ºäº†ä¸€ä¸ªæœ‰5ä¸ª<code>niginx:1.7.9</code> replicaçš„Deploymentï¼Œä½†æ˜¯å½“è¿˜åªæœ‰3ä¸ª<code>nginx:1.7.9</code>çš„replicaåˆ›å»ºå‡ºæ¥çš„æ—¶å€™ä½ å°±å¼€å§‹æ›´æ–°å«æœ‰5ä¸ª<code>nginx:1.9.1</code> replicaçš„Deploymentã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDeploymentä¼šç«‹å³æ€æ‰å·²åˆ›å»ºçš„3ä¸ª<code>nginx:1.7.9</code>çš„Podï¼Œå¹¶å¼€å§‹åˆ›å»º<code>nginx:1.9.1</code>çš„Podã€‚å®ƒä¸ä¼šç­‰åˆ°æ‰€æœ‰çš„5ä¸ª<code>nginx:1.7.9</code>çš„Podéƒ½åˆ›å»ºå®Œæˆåæ‰å¼€å§‹æ”¹å˜èˆªé“ã€‚</p>

<h2 id="å›é€€deployment">å›é€€Deployment</h2>

<p>æœ‰æ—¶å€™ä½ å¯èƒ½æƒ³å›é€€ä¸€ä¸ªDeploymentï¼Œä¾‹å¦‚ï¼Œå½“Deploymentä¸ç¨³å®šæ—¶ï¼Œæ¯”å¦‚ä¸€ç›´crash loopingã€‚</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œkubernetesä¼šåœ¨ç³»ç»Ÿä¸­ä¿å­˜å‰ä¸¤æ¬¡çš„Deploymentçš„rolloutå†å²è®°å½•ï¼Œä»¥ä¾¿ä½ å¯ä»¥éšæ—¶ä¼šé€€ï¼ˆä½ å¯ä»¥ä¿®æ”¹<code>revision history limit</code>æ¥æ›´æ”¹ä¿å­˜çš„revisionæ•°ï¼‰ã€‚ÃŸ</p>

<p><strong>æ³¨æ„ï¼š</strong>åªè¦Deploymentçš„rolloutè¢«è§¦å‘å°±ä¼šåˆ›å»ºä¸€ä¸ªrevisionã€‚ä¹Ÿå°±æ˜¯è¯´å½“ä¸”ä»…å½“Deploymentçš„Pod templateï¼ˆå¦‚<code>.spec.template</code>ï¼‰è¢«æ›´æ”¹ï¼Œä¾‹å¦‚æ›´æ–°templateä¸­çš„labelå’Œå®¹å™¨é•œåƒæ—¶ï¼Œå°±ä¼šåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„revisionã€‚</p>

<p>å…¶ä»–çš„æ›´æ–°ï¼Œæ¯”å¦‚æ‰©å®¹Deploymentä¸ä¼šåˆ›å»ºrevisionâ€”â€”å› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨æ‰©å®¹ã€‚è¿™æ„å‘³ç€å½“ä½ å›é€€åˆ°å†å²revisionæ˜¯ï¼Œç›´é‚®Deploymentä¸­çš„Pod templateéƒ¨åˆ†æ‰ä¼šå›é€€ã€‚</p>

<p>å‡è®¾æˆ‘ä»¬åœ¨æ›´æ–°Deploymentçš„æ—¶å€™çŠ¯äº†ä¸€ä¸ªæ‹¼å†™é”™è¯¯ï¼Œå°†é•œåƒçš„åå­—å†™æˆäº†<code>nginx:1.91</code>ï¼Œè€Œæ­£ç¡®çš„åå­—åº”è¯¥æ˜¯<code>nginx:1.9.1</code>ï¼š</p>

<pre><code class="language-shell">$ kubectl set image deployment/nginx-deployment nginx=nginx:1.91
deployment &quot;nginx-deployment&quot; image updated
</code></pre>

<p>Rolloutå°†ä¼šå¡ä½ã€‚</p>

<pre><code class="language-shell">$ kubectl rollout status deployments nginx-deployment
Waiting for rollout to finish: 2 out of 3 new replicas have been updated...
</code></pre>

<p>æŒ‰ä½Ctrl-Cåœæ­¢ä¸Šé¢çš„rolloutçŠ¶æ€ç›‘æ§ã€‚</p>

<p>ä½ ä¼šçœ‹åˆ°æ—§çš„replicasï¼ˆnginx-deployment-1564180365 å’Œ nginx-deployment-2035384211ï¼‰å’Œæ–°çš„replicas ï¼ˆnginx-deployment-3066724191ï¼‰æ•°ç›®éƒ½æ˜¯2ä¸ªã€‚</p>

<pre><code class="language-shell">$ kubectl get rs
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-1564180365   2         2         0       25s
nginx-deployment-2035384211   0         0         0       36s
nginx-deployment-3066724191   2         2         2       6s
</code></pre>

<p>çœ‹ä¸‹åˆ›å»ºPodï¼Œä½ ä¼šçœ‹åˆ°æœ‰ä¸¤ä¸ªæ–°çš„å‘ƒReplica Setåˆ›å»ºçš„Podå¤„äºImagePullBackOffçŠ¶æ€ï¼Œå¾ªç¯æ‹‰å–é•œåƒã€‚</p>

<pre><code class="language-shell">$ kubectl get pods
NAME                                READY     STATUS             RESTARTS   AGE
nginx-deployment-1564180365-70iae   1/1       Running            0          25s
nginx-deployment-1564180365-jbqqo   1/1       Running            0          25s
nginx-deployment-3066724191-08mng   0/1       ImagePullBackOff   0          6s
nginx-deployment-3066724191-eocby   0/1       ImagePullBackOff   0          6s
</code></pre>

<p>æ³¨æ„ï¼ŒDeployment controllerä¼šè‡ªåŠ¨åœæ­¢åçš„rolloutï¼Œå¹¶åœæ­¢æ‰©å®¹æ–°çš„Replica Setã€‚</p>

<pre><code class="language-shell">$ kubectl describe deployment
Name:           nginx-deployment
Namespace:      default
CreationTimestamp:  Tue, 15 Mar 2016 14:48:04 -0700
Labels:         app=nginx
Selector:       app=nginx
Replicas:       2 updated | 3 total | 2 available | 2 unavailable
StrategyType:       RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
OldReplicaSets:     nginx-deployment-1564180365 (2/2 replicas created)
NewReplicaSet:      nginx-deployment-3066724191 (2/2 replicas created)
Events:
  FirstSeen LastSeen    Count   From                    SubobjectPath   Type        Reason              Message
  --------- --------    -----   ----                    -------------   --------    ------              -------
  1m        1m          1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-2035384211 to 3
  22s       22s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 1
  22s       22s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-2035384211 to 2
  22s       22s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 2
  21s       21s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-2035384211 to 0
  21s       21s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 3
  13s       13s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-3066724191 to 1
  13s       13s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-1564180365 to 2
  13s       13s         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-3066724191 to 2
</code></pre>

<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å›é€€åˆ°ç¨³å®šçš„Deployment revisionã€‚</p>

<h3 id="æ£€æŸ¥deploymentå‡çº§çš„å†å²è®°å½•">æ£€æŸ¥Deploymentå‡çº§çš„å†å²è®°å½•</h3>

<p>é¦–å…ˆï¼Œæ£€æŸ¥ä¸‹Deploymentçš„revisionï¼š</p>

<pre><code class="language-shell">$ kubectl rollout history deployment/nginx-deployment
deployments &quot;nginx-deployment&quot;:
REVISION    CHANGE-CAUSE
1           kubectl create -f docs/user-guide/nginx-deployment.yaml --record
2           kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1
3           kubectl set image deployment/nginx-deployment nginx=nginx:1.91
</code></pre>

<p>å› ä¸ºæˆ‘ä»¬åˆ›å»ºDeploymentçš„æ—¶å€™ä½¿ç”¨äº†<code>â€”recored</code>å‚æ•°å¯ä»¥è®°å½•å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹æ¯æ¬¡revisonçš„å˜åŒ–ã€‚</p>

<p>æŸ¥çœ‹å•ä¸ªrevisionçš„è¯¦ç»†ä¿¡æ¯ï¼š</p>

<pre><code class="language-shell">$ kubectl rollout history deployment/nginx-deployment --revision=2
deployments &quot;nginx-deployment&quot; revision 2
  Labels:       app=nginx
          pod-template-hash=1159050644
  Annotations:  kubernetes.io/change-cause=kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1
  Containers:
   nginx:
    Image:      nginx:1.9.1
    Port:       80/TCP
     QoS Tier:
        cpu:      BestEffort
        memory:   BestEffort
    Environment Variables:      &lt;none&gt;
  No volumes.
</code></pre>

<h3 id="å›é€€åˆ°å†å²ç‰ˆæœ¬">å›é€€åˆ°å†å²ç‰ˆæœ¬</h3>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šå›é€€å½“å‰çš„rolloutåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼š</p>

<pre><code class="language-shell">$ kubectl rollout undo deployment/nginx-deployment
deployment &quot;nginx-deployment&quot; rolled back
</code></pre>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>--revision</code>å‚æ•°æŒ‡å®šæŸä¸ªå†å²ç‰ˆæœ¬ï¼š</p>

<pre><code class="language-shell">$ kubectl rollout undo deployment/nginx-deployment --to-revision=2
deployment &quot;nginx-deployment&quot; rolled back
</code></pre>

<p>ä¸rolloutç›¸å…³çš„å‘½ä»¤è¯¦ç»†æ–‡æ¡£è§<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/user-guide/kubectl/v1.6/#rollout">kubectl rollout</a>ã€‚</p>

<p>è¯¥Deploymentç°åœ¨å·²ç»å›é€€åˆ°äº†å…ˆå‰çš„ç¨³å®šç‰ˆæœ¬ã€‚å¦‚ä½ æ‰€è§ï¼ŒDeployment controlleräº§ç”Ÿäº†ä¸€ä¸ªå›é€€åˆ°revison 2çš„<code>DeploymentRollback</code>çš„eventã€‚</p>

<pre><code class="language-shell">$ kubectl get deployment
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         3         3            3           30m

$ kubectl describe deployment
Name:           nginx-deployment
Namespace:      default
CreationTimestamp:  Tue, 15 Mar 2016 14:48:04 -0700
Labels:         app=nginx
Selector:       app=nginx
Replicas:       3 updated | 3 total | 3 available | 0 unavailable
StrategyType:       RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
OldReplicaSets:     &lt;none&gt;
NewReplicaSet:      nginx-deployment-1564180365 (3/3 replicas created)
Events:
  FirstSeen LastSeen    Count   From                    SubobjectPath   Type        Reason              Message
  --------- --------    -----   ----                    -------------   --------    ------              -------
  30m       30m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-2035384211 to 3
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 1
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-2035384211 to 2
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 2
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-2035384211 to 0
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-3066724191 to 2
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-3066724191 to 1
  29m       29m         1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-1564180365 to 2
  2m        2m          1       {deployment-controller }                Normal      ScalingReplicaSet   Scaled down replica set nginx-deployment-3066724191 to 0
  2m        2m          1       {deployment-controller }                Normal      DeploymentRollback  Rolled back deployment &quot;nginx-deployment&quot; to revision 2
  29m       2m          2       {deployment-controller }                Normal      ScalingReplicaSet   Scaled up replica set nginx-deployment-1564180365 to 3
</code></pre>

<h3 id="æ¸…ç†policy">æ¸…ç†Policy</h3>

<p>ä½ å¯ä»¥é€šè¿‡è®¾ç½®<code>.spec.revisonHistoryLimit</code>é¡¹æ¥æŒ‡å®šdeploymentæœ€å¤šä¿ç•™å¤šå°‘revisonå†å²è®°å½•ã€‚é»˜è®¤çš„ä¼šä¿ç•™æ‰€æœ‰çš„revisionï¼›å¦‚æœå°†è¯¥é¡¹è®¾ç½®ä¸º0ï¼ŒDeploymentå°±ä¸å…è®¸å›é€€äº†ã€‚</p>

<h2 id="deploymentæ‰©å®¹">Deploymentæ‰©å®¹</h2>

<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰©å®¹Deploymentï¼š</p>

<pre><code class="language-shell">$ kubectl scale deployment nginx-deployment --replicas 10
deployment &quot;nginx-deployment&quot; scaled
</code></pre>

<p>å‡è®¾ä½ çš„é›†ç¾¤ä¸­å¯ç”¨äº†<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough">horizontal pod autoscaling</a>ï¼Œä½ å¯ä»¥ç»™Deploymentè®¾ç½®ä¸€ä¸ªautoscalerï¼ŒåŸºäºå½“å‰Podçš„CPUåˆ©ç”¨ç‡é€‰æ‹©æœ€å°‘å’Œæœ€å¤šçš„Podæ•°ã€‚</p>

<pre><code class="language-shell">$ kubectl autoscale deployment nginx-deployment --min=10 --max=15 --cpu-percent=80
deployment &quot;nginx-deployment&quot; autoscaled
</code></pre>

<h2 id="æ¯”ä¾‹æ‰©å®¹">æ¯”ä¾‹æ‰©å®¹</h2>

<p>RollingUpdate Deploymentæ”¯æŒåŒæ—¶è¿è¡Œä¸€ä¸ªåº”ç”¨çš„å¤šä¸ªç‰ˆæœ¬ã€‚å½“ä½ æ´»ç€autoscaleræ‰©å®¹RollingUpdate Deploymentçš„æ—¶å€™ï¼Œæ­£åœ¨ä¸­é€”çš„rolloutï¼ˆè¿›è¡Œä¸­æˆ–è€…å·²ç»æš‚åœçš„ï¼‰ï¼Œä¸ºäº†é™ä½é£é™©ï¼ŒDeployment controllerå°†ä¼šå¹³è¡¡å·²å­˜åœ¨çš„æ´»åŠ¨ä¸­çš„ReplicaSetsï¼ˆæœ‰Podçš„ReplicaSetsï¼‰å’Œæ–°åŠ å…¥çš„replicasã€‚è¿™è¢«ç§°ä¸ºæ¯”ä¾‹æ‰©å®¹ã€‚</p>

<p>ä¾‹å¦‚ï¼Œä½ æ­£åœ¨è¿è¡Œä¸­å«æœ‰10ä¸ªreplicaçš„Deploymentã€‚maxSurge=3ï¼ŒmaxUnavailable=2ã€‚</p>

<pre><code class="language-shell">$ kubectl get deploy
NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment     10        10        10           10          50s
</code></pre>

<p>ä½ æ›´æ–°äº†ä¸€ä¸ªé•œåƒï¼Œè€Œåœ¨é›†ç¾¤å†…éƒ¨æ— æ³•è§£æã€‚</p>

<pre><code class="language-shell">$ kubectl set image deploy/nginx-deployment nginx=nginx:sometag
deployment &quot;nginx-deployment&quot; image updated
</code></pre>

<p>é•œåƒæ›´æ–°å¯åŠ¨äº†ä¸€ä¸ªåŒ…å«ReplicaSet nginx-deployment-1989198191çš„æ–°çš„rolloutï¼Œä½†æ˜¯å®ƒè¢«é˜»å¡äº†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šé¢æåˆ°çš„maxUnavailableã€‚</p>

<pre><code class="language-shell">$ kubectl get rs
NAME                          DESIRED   CURRENT   READY     AGE
nginx-deployment-1989198191   5         5         0         9s
nginx-deployment-618515232    8         8         8         1m
</code></pre>

<p>ç„¶åå‘èµ·äº†ä¸€ä¸ªæ–°çš„Deploymentæ‰©å®¹è¯·æ±‚ã€‚autoscalerå°†Deploymentçš„repllicaæ•°ç›®å¢åŠ åˆ°äº†15ä¸ªã€‚Deployment controlleréœ€è¦åˆ¤æ–­åœ¨å“ªé‡Œå¢åŠ è¿™5ä¸ªæ–°çš„replicaã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰è°ç”¨æ¯”ä¾‹æ‰©å®¹ï¼Œæ‰€æœ‰çš„5ä¸ªreplicaéƒ½ä¼šåŠ åˆ°ä¸€ä¸ªæ–°çš„ReplicaSetä¸­ã€‚å¦‚æœä½¿ç”¨æ¯”ä¾‹æ‰©å®¹ï¼Œæ–°æ·»åŠ çš„replicaå°†ä¼ æ’­åˆ°æ‰€æœ‰çš„ReplicaSetä¸­ã€‚å¤§çš„éƒ¨åˆ†åŠ å…¥replicaæ•°æœ€å¤šçš„ReplicaSetä¸­ï¼Œå°çš„éƒ¨åˆ†åŠ å…¥åˆ°replicaæ•°å°‘çš„ReplciaSetä¸­ã€‚0ä¸ªreplicaçš„ReplicaSetä¸ä¼šè¢«æ‰©å®¹ã€‚</p>

<p>åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ3ä¸ªreplicaå°†æ·»åŠ åˆ°æ—§çš„ReplicaSetä¸­ï¼Œ2ä¸ªreplicaå°†æ·»åŠ åˆ°æ–°çš„ReplicaSetä¸­ã€‚rolloutè¿›ç¨‹æœ€ç»ˆä¼šå°†æ‰€æœ‰çš„replicaç§»åŠ¨åˆ°æ–°çš„ReplicaSetä¸­ï¼Œå‡è®¾æ–°çš„replicaæˆä¸ºå¥åº·çŠ¶æ€ã€‚</p>

<pre><code class="language-shell">$ kubectl get deploy
NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment     15        18        7            8           7m
$ kubectl get rs
NAME                          DESIRED   CURRENT   READY     AGE
nginx-deployment-1989198191   7         7         0         7m
nginx-deployment-618515232    11        11        11        7m
</code></pre>

<h2 id="æš‚åœå’Œæ¢å¤deployment">æš‚åœå’Œæ¢å¤Deployment</h2>

<p>ä½ å¯ä»¥åœ¨å‡ºå‘ä¸€æ¬¡æˆ–å¤šæ¬¡æ›´æ–°å‰æš‚åœä¸€ä¸ªDeploymentï¼Œç„¶åå†æ¢å¤å®ƒã€‚è¿™æ ·ä½ å°±èƒ½å¤šæ¬¡æš‚åœå’Œæ¢å¤Deploymentï¼Œåœ¨æ­¤æœŸé—´è¿›è¡Œä¸€äº›ä¿®å¤å·¥ä½œï¼Œè€Œä¸ä¼šå‡ºå‘ä¸å¿…è¦çš„rolloutã€‚</p>

<p>ä¾‹å¦‚ä½¿ç”¨åˆšåˆšåˆ›å»ºDeploymentï¼š</p>

<pre><code class="language-shell">$ kubectl get deploy
NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx     3         3         3            3           1m
[mkargaki@dhcp129-211 kubernetes]$ kubectl get rs
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   3         3         3         1m
</code></pre>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æš‚åœDeploymentï¼š</p>

<pre><code class="language-shell">$ kubectl rollout pause deployment/nginx-deployment
deployment &quot;nginx-deployment&quot; paused
</code></pre>

<p>ç„¶åæ›´æ–°Deplymentä¸­çš„é•œåƒï¼š</p>

<pre><code class="language-shell">$ kubectl set image deploy/nginx nginx=nginx:1.9.1
deployment &quot;nginx-deployment&quot; image updated
</code></pre>

<p>æ³¨æ„æ–°çš„rolloutå¯åŠ¨äº†ï¼š</p>

<pre><code class="language-shell">$ kubectl rollout history deploy/nginx
deployments &quot;nginx&quot;
REVISION  CHANGE-CAUSE
1   &lt;none&gt;

$ kubectl get rs
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   3         3         3         2m
</code></pre>

<p>ä½ å¯ä»¥è¿›è¡Œä»»æ„å¤šæ¬¡æ›´æ–°ï¼Œä¾‹å¦‚æ›´æ–°ä½¿ç”¨çš„èµ„æºï¼š</p>

<pre><code class="language-shell">$ kubectl set resources deployment nginx -c=nginx --limits=cpu=200m,memory=512Mi
deployment &quot;nginx&quot; resource requirements updated
</code></pre>

<p>Deploymentæš‚åœå‰çš„åˆå§‹çŠ¶æ€å°†ç»§ç»­å®ƒçš„åŠŸèƒ½ï¼Œè€Œä¸ä¼šå¯¹Deploymentçš„æ›´æ–°äº§ç”Ÿä»»ä½•å½±å“ï¼Œåªè¦Deploymentæ˜¯æš‚åœçš„ã€‚</p>

<p>æœ€åï¼Œæ¢å¤è¿™ä¸ªDeploymentï¼Œè§‚å¯Ÿå®Œæˆæ›´æ–°çš„ReplicaSetå·²ç»åˆ›å»ºå‡ºæ¥äº†ï¼š</p>

<pre><code class="language-shell">$ kubectl rollout resume deploy nginx
deployment &quot;nginx&quot; resumed
$ KUBECTL get rs -w
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   2         2         2         2m
nginx-3926361531   2         2         0         6s
nginx-3926361531   2         2         1         18s
nginx-2142116321   1         2         2         2m
nginx-2142116321   1         2         2         2m
nginx-3926361531   3         2         1         18s
nginx-3926361531   3         2         1         18s
nginx-2142116321   1         1         1         2m
nginx-3926361531   3         3         1         18s
nginx-3926361531   3         3         2         19s
nginx-2142116321   0         1         1         2m
nginx-2142116321   0         1         1         2m
nginx-2142116321   0         0         0         2m
nginx-3926361531   3         3         3         20s
^C
$ KUBECTL get rs
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   0         0         0         2m
nginx-3926361531   3         3         3         28s
</code></pre>

<p><strong>æ³¨æ„ï¼š</strong>åœ¨æ¢å¤Deploymentä¹‹å‰ä½ æ— æ³•å›é€€ä¸€ä¸ªæš‚åœäº†ä¸ªDeploymentã€‚</p>

<h2 id="deploymentçŠ¶æ€">DeploymentçŠ¶æ€</h2>

<p>Deploymentåœ¨ç”Ÿå‘½å‘¨æœŸä¸­æœ‰å¤šç§çŠ¶æ€ã€‚åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ReplicaSetçš„æ—¶å€™å®ƒå¯ä»¥æ˜¯ <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md#progressing-deployment">progressing</a> çŠ¶æ€ï¼Œ <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md#complete-deployment">complete</a> çŠ¶æ€ï¼Œæˆ–è€…<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md#failed-deployment">fail to progress</a>çŠ¶æ€ã€‚</p>

<h3 id="progressing-deployment">Progressing Deployment</h3>

<p>Kuberneteså°†æ‰§è¡Œè¿‡ä¸‹åˆ—ä»»åŠ¡ä¹‹ä¸€çš„Deploymentæ ‡è®°ä¸º*progressing*çŠ¶æ€ï¼š</p>

<ul>
<li>Deploymentæ­£åœ¨åˆ›å»ºæ–°çš„ReplicaSetè¿‡ç¨‹ä¸­ã€‚</li>
<li>Deploymentæ­£åœ¨æ‰©å®¹ä¸€ä¸ªå·²æœ‰çš„ReplicaSetã€‚</li>
<li>Deploymentæ­£åœ¨ç¼©å®¹ä¸€ä¸ªå·²æœ‰çš„ReplicaSetã€‚</li>
<li>æœ‰æ–°çš„å¯ç”¨çš„podå‡ºç°ã€‚</li>
</ul>

<p>ä½ å¯ä»¥ä½¿ç”¨<code>kubectl roullout status</code>å‘½ä»¤ç›‘æ§Deploymentçš„è¿›åº¦ã€‚</p>

<h3 id="complete-deployment">Complete Deployment</h3>

<p>Kuberneteså°†åŒ…æ‹¬ä»¥ä¸‹ç‰¹æ€§çš„Deploymentæ ‡è®°ä¸º*complete*çŠ¶æ€ï¼š</p>

<ul>
<li>Deploymentæœ€å°å¯ç”¨ã€‚æœ€å°å¯ç”¨æ„å‘³ç€Deploymentçš„å¯ç”¨replicaä¸ªæ•°ç­‰äºæˆ–è€…è¶…è¿‡Deploymentç­–ç•¥ä¸­çš„æœŸæœ›ä¸ªæ•°ã€‚</li>
<li>æ‰€æœ‰ä¸è¯¥Deploymentç›¸å…³çš„replicaéƒ½è¢«æ›´æ–°åˆ°äº†ä½ æŒ‡å®šç‰ˆæœ¬ï¼Œä¹Ÿå°±è¯´æ›´æ–°å®Œæˆã€‚</li>
<li>è¯¥Deploymentä¸­æ²¡æœ‰æ—§çš„Podå­˜åœ¨ã€‚</li>
</ul>

<p>ä½ å¯ä»¥ç”¨<code>kubectl rollout status</code>å‘½ä»¤æŸ¥çœ‹Deploymentæ˜¯å¦å®Œæˆã€‚å¦‚æœrolloutæˆåŠŸå®Œæˆï¼Œ<code>kubectl rollout status</code>å°†è¿”å›ä¸€ä¸ª0å€¼çš„Exit Codeã€‚</p>

<pre><code class="language-bash">$ kubectl rollout status deploy/nginx
Waiting for rollout to finish: 2 of 3 updated replicas are available...
deployment &quot;nginx&quot; successfully rolled out
$ echo $?
0
</code></pre>

<h3 id="failed-deployment">Failed Deployment</h3>

<p>ä½ çš„Deploymentåœ¨å°è¯•éƒ¨ç½²æ–°çš„ReplicaSetçš„æ—¶å€™å¯èƒ½å¡ä½ï¼Œç”¨äºä¹Ÿä¸ä¼šå®Œæˆã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºä»¥ä¸‹å‡ ä¸ªå› ç´ å¼•èµ·çš„ï¼š</p>

<ul>
<li>æ— æ•ˆçš„å¼•ç”¨</li>
<li>ä¸å¯è¯»çš„probe failure</li>
<li>é•œåƒæ‹‰å–é”™è¯¯</li>
<li>æƒé™ä¸å¤Ÿ</li>
<li>èŒƒå›´é™åˆ¶</li>
<li>ç¨‹åºè¿è¡Œæ—¶é…ç½®é”™è¯¯</li>
</ul>

<p>æ¢æµ‹è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹å¼æ˜¯ï¼Œåœ¨ä½ çš„Deployment specä¸­æŒ‡å®š<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md#progress-deadline-seconds"><code>spec.progressDeadlineSeconds</code></a>ã€‚<code>spec.progressDeadlineSeconds</code> è¡¨ç¤ºDeployment controllerç­‰å¾…å¤šå°‘ç§’æ‰èƒ½ç¡®å®šï¼ˆé€šè¿‡Deployment statusï¼‰Deploymentè¿›ç¨‹æ˜¯å¡ä½çš„ã€‚</p>

<p>ä¸‹é¢çš„<code>kubectl</code>å‘½ä»¤è®¾ç½®<code>progressDeadlineSeconds</code> ä½¿controlleråœ¨Deploymentåœ¨è¿›åº¦å¡ä½10åˆ†é’ŸåæŠ¥å‘Šï¼š</p>

<pre><code class="language-bash">$ kubectl patch deployment/nginx-deployment -p '{&quot;spec&quot;:{&quot;progressDeadlineSeconds&quot;:600}}'
&quot;nginx-deployment&quot; patched
</code></pre>

<p>Once the deadline has been exceeded, the Deployment controller adds a  with the following attributes to the Deployment&rsquo;s</p>

<p>å½“è¶…è¿‡æˆªæ­¢æ—¶é—´åï¼ŒDeployment controllerä¼šåœ¨Deploymentçš„ <code>status.conditions</code>ä¸­å¢åŠ ä¸€æ¡DeploymentConditionï¼Œå®ƒåŒ…æ‹¬å¦‚ä¸‹å±æ€§ï¼š</p>

<ul>
<li>Type=Progressing</li>
<li>Status=False</li>
<li>Reason=ProgressDeadlineExceeded</li>
</ul>

<p>æµè§ˆ <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md#typical-status-properties">Kubernetes API conventions</a> æŸ¥çœ‹å…³äºstatus conditionsçš„æ›´å¤šä¿¡æ¯ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>kubernetesé™¤äº†æŠ¥å‘Š<code>Reason=ProgressDeadlineExceeded</code>çŠ¶æ€ä¿¡æ¯å¤–ä¸ä¼šå¯¹å¡ä½çš„Deploymentåšä»»ä½•æ“ä½œã€‚æ›´é«˜å±‚æ¬¡çš„åè°ƒå™¨å¯ä»¥åˆ©ç”¨å®ƒå¹¶é‡‡å–ç›¸åº”è¡ŒåŠ¨ï¼Œä¾‹å¦‚ï¼Œå›æ»šDeploymentåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœä½ æš‚åœäº†ä¸€ä¸ªDeploymentï¼Œåœ¨æš‚åœçš„è¿™æ®µæ—¶é—´å†…kubernetnesä¸ä¼šæ£€æŸ¥ä½ æŒ‡å®šçš„deadlineã€‚ä½ å¯ä»¥åœ¨Deploymentçš„rollouté€”ä¸­å®‰å…¨çš„æš‚åœå®ƒï¼Œç„¶åå†æ¢å¤å®ƒï¼Œè¿™ä¸ä¼šè§¦å‘è¶…è¿‡deadlineçš„çŠ¶æ€ã€‚</p>

<p>ä½ å¯èƒ½åœ¨ä½¿ç”¨Deploymentçš„æ—¶å€™é‡åˆ°ä¸€äº›çŸ­æš‚çš„é”™è¯¯ï¼Œè¿™äº›å¯èƒ½æ˜¯ç”±äºä½ è®¾ç½®äº†å¤ªçŸ­çš„timeoutï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºå„ç§å…¶ä»–é”™è¯¯å¯¼è‡´çš„çŸ­æš‚é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ ä½¿ç”¨äº†æ— æ•ˆçš„å¼•ç”¨ã€‚å½“ä½ Describe Deploymentçš„æ—¶å€™å¯èƒ½ä¼šæ³¨æ„åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>

<pre><code class="language-bash">$ kubectl describe deployment nginx-deployment
&lt;...&gt;
Conditions:
  Type            Status  Reason
  ----            ------  ------
  Available       True    MinimumReplicasAvailable
  Progressing     True    ReplicaSetUpdated
  ReplicaFailure  True    FailedCreate
&lt;...&gt;
</code></pre>

<p>æ‰§è¡Œ <code>kubectl get deployment nginx-deployment -o yaml</code>ï¼ŒDeployement çš„çŠ¶æ€å¯èƒ½çœ‹èµ·æ¥åƒè¿™ä¸ªæ ·å­ï¼š</p>

<pre><code class="language-yaml">status:
  availableReplicas: 2
  conditions:
  - lastTransitionTime: 2016-10-04T12:25:39Z
    lastUpdateTime: 2016-10-04T12:25:39Z
    message: Replica set &quot;nginx-deployment-4262182780&quot; is progressing.
    reason: ReplicaSetUpdated
    status: &quot;True&quot;
    type: Progressing
  - lastTransitionTime: 2016-10-04T12:25:42Z
    lastUpdateTime: 2016-10-04T12:25:42Z
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: &quot;True&quot;
    type: Available
  - lastTransitionTime: 2016-10-04T12:25:39Z
    lastUpdateTime: 2016-10-04T12:25:39Z
    message: 'Error creating: pods &quot;nginx-deployment-4262182780-&quot; is forbidden: exceeded quota:
      object-counts, requested: pods=1, used: pods=3, limited: pods=2'
    reason: FailedCreate
    status: &quot;True&quot;
    type: ReplicaFailure
  observedGeneration: 3
  replicas: 2
  unavailableReplicas: 2
</code></pre>

<p>æœ€ç»ˆï¼Œä¸€æ—¦è¶…è¿‡Deploymentè¿›ç¨‹çš„deadlineï¼Œkuberentesä¼šæ›´æ–°çŠ¶æ€å’Œå¯¼è‡´ProgressingçŠ¶æ€çš„åŸå› ï¼š</p>

<pre><code class="language-Bash">Conditions:
  Type            Status  Reason
  ----            ------  ------
  Available       True    MinimumReplicasAvailable
  Progressing     False   ProgressDeadlineExceeded
  ReplicaFailure  True    FailedCreate
</code></pre>

<p>ä½ å¯ä»¥é€šè¿‡ç¼©å®¹Deploymentçš„æ–¹å¼è§£å†³é…é¢ä¸è¶³çš„é—®é¢˜ï¼Œæˆ–è€…å¢åŠ ä½ çš„namespaceçš„é…é¢ã€‚å¦‚æœä½ æ»¡è¶³äº†é…é¢æ¡ä»¶åï¼ŒDeployment controllerå°±ä¼šå®Œæˆä½ çš„Deployment rolloutï¼Œä½ å°†çœ‹åˆ°Deploymentçš„çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸçŠ¶æ€ï¼ˆ<code>Status=True</code>å¹¶ä¸”<code>Reason=NewReplicaSetAvailable</code>ï¼‰ã€‚</p>

<pre><code class="language-bash">Conditions:
  Type          Status  Reason
  ----          ------  ------
  Available     True    MinimumReplicasAvailable
  Progressing   True    NewReplicaSetAvailable
</code></pre>

<p><code>Type=Available</code>ã€ <code>Status=True</code> ä»¥ä¸ºè¿™ä½ çš„Deploymentæœ‰æœ€å°å¯ç”¨æ€§ã€‚ æœ€å°å¯ç”¨æ€§æ˜¯åœ¨Deploymentç­–ç•¥ä¸­æŒ‡å®šçš„å‚æ•°ã€‚<code>Type=Progressing</code> ã€ <code>Status=True</code>æ„å‘³ç€ä½ çš„Deployment æˆ–è€…åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œæˆ–è€…å·²ç»æˆåŠŸéƒ¨ç½²ï¼Œè¾¾åˆ°äº†æœŸæœ›çš„æœ€å°‘çš„å¯ç”¨replicaæ•°é‡ï¼ˆæŸ¥çœ‹ç‰¹å®šçŠ¶æ€çš„Reasonâ€”â€”åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­<code>Reason=NewReplicaSetAvailable</code> æ„å‘³ç€Deploymentå·²ç»å®Œæˆï¼‰ã€‚</p>

<p>ä½ å¯ä»¥ä½¿ç”¨<code>kubectl rollout status</code>å‘½ä»¤æŸ¥çœ‹Deploymentè¿›ç¨‹æ˜¯å¦å¤±è´¥ã€‚å½“Deploymentè¿‡ç¨‹è¶…è¿‡äº†deadlineï¼Œ<code>kubectl rollout status</code>å°†è¿”å›é0çš„exit codeã€‚</p>

<pre><code class="language-bash">$ kubectl rollout status deploy/nginx
Waiting for rollout to finish: 2 out of 3 new replicas have been updated...
error: deployment &quot;nginx&quot; exceeded its progress deadline
$ echo $?
1
</code></pre>

<h3 id="æ“ä½œå¤±è´¥çš„deployment">æ“ä½œå¤±è´¥çš„Deployment</h3>

<p>æ‰€æœ‰å¯¹å®Œæˆçš„Deploymentçš„æ“ä½œéƒ½é€‚ç”¨äºå¤±è´¥çš„Deploymentã€‚ä½ å¯ä»¥å¯¹å®ƒé˜”ï¼ç¼©å®¹ï¼Œå›é€€åˆ°å†å²ç‰ˆæœ¬ï¼Œä½ ç”šè‡³å¯ä»¥å¤šæ¬¡æš‚åœå®ƒæ¥åº”ç”¨Deployment pod templateã€‚</p>

<h2 id="æ¸…ç†policy-1">æ¸…ç†Policy</h2>

<p>ä½ å¯ä»¥è®¾ç½®Deploymentä¸­çš„ <code>.spec.revisionHistoryLimit</code> é¡¹æ¥æŒ‡å®šä¿ç•™å¤šå°‘æ—§çš„ReplicaSetã€‚ ä½™ä¸‹çš„å°†åœ¨åå°è¢«å½“ä½œåƒåœ¾æ”¶é›†ã€‚é»˜è®¤çš„ï¼Œæ‰€æœ‰çš„revisionå†å²å°±éƒ½ä¼šè¢«ä¿ç•™ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå°†ä¼šæ›´æ”¹ä¸º2ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>å°†è¯¥å€¼è®¾ç½®ä¸º0ï¼Œå°†å¯¼è‡´æ‰€æœ‰çš„Deploymentå†å²è®°å½•éƒ½ä¼šè¢«æ¸…é™¤ï¼Œè¯¥Deploynentå°±æ— æ³•å†å›é€€äº†ã€‚</p>

<h2 id="ç”¨ä¾‹">ç”¨ä¾‹</h2>

<h3 id="é‡‘ä¸é›€deployment">é‡‘ä¸é›€Deployment</h3>

<p>å¦‚æœä½ æƒ³è¦ä½¿ç”¨Deploymentå¯¹éƒ¨åˆ†ç”¨æˆ·æˆ–æœåŠ¡å™¨å‘å¸ƒrelaeseï¼Œä½ å¯ä»¥åˆ›å»ºå¤šä¸ªDeploymentï¼Œæ¯ä¸ªå¯¹ä¸€ä¸ªreleaseï¼Œå‚ç…§<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/cluster-administration/manage-deployment/#canary-deployments">managing resources</a> ä¸­å¯¹é‡‘ä¸é›€æ¨¡å¼çš„æè¿°ã€‚</p>

<h2 id="ç¼–å†™deployment-spec">ç¼–å†™Deployment Spec</h2>

<p>åœ¨æ‰€æœ‰çš„Kubernetesé…ç½®ä¸­ï¼ŒDeploymentä¹Ÿéœ€è¦<code>apiVersion</code>ï¼Œ<code>kind</code>å’Œ<code>metadata</code>è¿™äº›é…ç½®é¡¹ã€‚é…ç½®æ–‡ä»¶çš„é€šç”¨ä½¿ç”¨è¯´æ˜æŸ¥çœ‹<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/tutorials/stateless-application/run-stateless-application-deployment">éƒ¨ç½²åº”ç”¨</a>ï¼Œé…ç½®å®¹å™¨ï¼Œå’Œ<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/tutorials/object-management-kubectl/object-management">ä½¿ç”¨kubecltç®¡ç†èµ„æº</a>æ–‡æ¡£ã€‚</p>

<p>Deploymentä¹Ÿéœ€è¦ <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md#spec-and-status"><code>.spec</code> section</a>.</p>

<h3 id="pod-template">Pod Template</h3>

<p><code>.spec.template</code> æ˜¯ <code>.spec</code>ä¸­å”¯ä¸€è¦æ±‚çš„å­—æ®µã€‚</p>

<p><code>.spec.template</code> æ˜¯ <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/user-guide/replication-controller/#pod-template">pod template</a>. å®ƒè·Ÿ <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/user-guide/pods">Pod</a>æœ‰ä¸€æ¨¡ä¸€æ ·çš„schemaï¼Œé™¤äº†å®ƒæ˜¯åµŒå¥—çš„å¹¶ä¸”ä¸éœ€è¦<code>apiVersion</code> å’Œ <code>kind</code>å­—æ®µã€‚</p>

<p>å¦å¤–ä¸ºäº†åˆ’åˆ†Podçš„èŒƒå›´ï¼ŒDeploymentä¸­çš„pod templateå¿…é¡»æŒ‡å®šé€‚å½“çš„labelï¼ˆä¸è¦è·Ÿå…¶ä»–controlleré‡å¤äº†ï¼Œå‚è€ƒ<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md#selector">selector</a>ï¼‰å’Œé€‚å½“çš„é‡å¯ç­–ç•¥ã€‚</p>

<p><a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/pods/pod-lifecycle"><code>.spec.template.spec.restartPolicy</code></a> å¯ä»¥è®¾ç½®ä¸º <code>Always</code> , å¦‚æœä¸æŒ‡å®šçš„è¯è¿™å°±æ˜¯é»˜è®¤é…ç½®ã€‚</p>

<h3 id="replicas">Replicas</h3>

<p><code>.spec.replicas</code> æ˜¯å¯ä»¥é€‰å­—æ®µï¼ŒæŒ‡å®šæœŸæœ›çš„podæ•°é‡ï¼Œé»˜è®¤æ˜¯1ã€‚</p>

<h3 id="selector">Selector</h3>

<p><code>.spec.selector</code>æ˜¯å¯é€‰å­—æ®µï¼Œç”¨æ¥æŒ‡å®š <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/overview/working-with-objects/labels">label selector</a> ï¼Œåœˆå®šDeploymentç®¡ç†çš„podèŒƒå›´ã€‚</p>

<p>å¦‚æœè¢«æŒ‡å®šï¼Œ <code>.spec.selector</code> å¿…é¡»åŒ¹é… <code>.spec.template.metadata.labels</code>ï¼Œå¦åˆ™å®ƒå°†è¢«APIæ‹’ç»ã€‚å¦‚æœ <code>.spec.selector</code> æ²¡æœ‰è¢«æŒ‡å®šï¼Œ <code>.spec.selector.matchLabels</code> é»˜è®¤æ˜¯ <code>.spec.template.metadata.labels</code>ã€‚</p>

<p>åœ¨Podçš„templateè·Ÿ<code>.spec.template</code>ä¸åŒæˆ–è€…æ•°é‡è¶…è¿‡äº†<code>.spec.replicas</code>è§„å®šçš„æ•°é‡çš„æƒ…å†µä¸‹ï¼ŒDeploymentä¼šæ€æ‰labelè·Ÿselectorä¸åŒçš„Podã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>ä½ ä¸åº”è¯¥å†åˆ›å»ºå…¶ä»–labelè·Ÿè¿™ä¸ªselectoråŒ¹é…çš„podï¼Œæˆ–è€…é€šè¿‡å…¶ä»–Deploymentï¼Œæˆ–è€…é€šè¿‡å…¶ä»–Controllerï¼Œä¾‹å¦‚ReplicaSetå’ŒReplicationControllerã€‚å¦åˆ™è¯¥Deploymentä¼šè¢«æŠŠå®ƒä»¬å½“æˆéƒ½æ˜¯è‡ªå·±åˆ›å»ºçš„ã€‚Kubernetesä¸ä¼šé˜»æ­¢ä½ è¿™ä¹ˆåšã€‚</p>

<p>å¦‚æœä½ æœ‰å¤šä¸ªcontrollerä½¿ç”¨äº†é‡å¤çš„selectorï¼Œcontrollerä»¬å°±ä¼šäº’ç›¸æ‰“æ¶å¹¶å¯¼è‡´ä¸æ­£ç¡®çš„è¡Œä¸ºã€‚</p>

<h3 id="ç­–ç•¥">ç­–ç•¥</h3>

<p><code>.spec.strategy</code> æŒ‡å®šæ–°çš„Podæ›¿æ¢æ—§çš„Podçš„ç­–ç•¥ã€‚ <code>.spec.strategy.type</code> å¯ä»¥æ˜¯&rdquo;Recreate&rdquo;æˆ–è€…æ˜¯ &ldquo;RollingUpdate&rdquo;ã€‚&rdquo;RollingUpdate&rdquo;æ˜¯é»˜è®¤å€¼ã€‚</p>

<h4 id="recreate-deployment">Recreate Deployment</h4>

<p><code>.spec.strategy.type==Recreate</code>æ—¶ï¼Œåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„Podã€‚</p>

<h4 id="rolling-update-deployment">Rolling Update Deployment</h4>

<p><code>.spec.strategy.type==RollingUpdate</code>æ—¶ï¼ŒDeploymentä½¿ç”¨<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/tasks/run-application/rolling-update-replication-controller">rolling update</a> çš„æ–¹å¼æ›´æ–°Pod ã€‚ä½ å¯ä»¥æŒ‡å®š<code>maxUnavailable</code> å’Œ <code>maxSurge</code> æ¥æ§åˆ¶ rolling update è¿›ç¨‹ã€‚</p>

<h5 id="max-unavailable">Max Unavailable</h5>

<p><code>.spec.strategy.rollingUpdate.maxUnavailable</code> æ˜¯å¯é€‰é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨Podçš„æœ€å¤§æ•°é‡ã€‚è¯¥å€¼å¯ä»¥æ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼ˆä¾‹å¦‚5ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æœŸæœ›Podæ•°é‡çš„ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚10%ï¼‰ã€‚é€šè¿‡è®¡ç®—ç™¾åˆ†æ¯”çš„ç»å¯¹å€¼å‘ä¸‹å–æ•´ã€‚å¦‚æœ<code>.spec.strategy.rollingUpdate.maxSurge</code> ä¸º0æ—¶ï¼Œè¿™ä¸ªå€¼ä¸å¯ä»¥ä¸º0ã€‚é»˜è®¤å€¼æ˜¯1ã€‚</p>

<p>ä¾‹å¦‚ï¼Œè¯¥å€¼è®¾ç½®æˆ30%ï¼Œå¯åŠ¨rolling updateåæ—§çš„ReplicatSetå°†ä¼šç«‹å³ç¼©å®¹åˆ°æœŸæœ›çš„Podæ•°é‡çš„70%ã€‚æ–°çš„Pod readyåï¼Œéšç€æ–°çš„ReplicaSetçš„æ‰©å®¹ï¼Œæ—§çš„ReplicaSetä¼šè¿›ä¸€æ­¥ç¼©å®¹ï¼Œç¡®ä¿åœ¨å‡çº§çš„æ‰€æœ‰æ—¶åˆ»å¯ä»¥ç”¨çš„Podæ•°é‡è‡³å°‘æ˜¯æœŸæœ›Podæ•°é‡çš„70%ã€‚</p>

<h5 id="max-surge">Max Surge</h5>

<p><code>.spec.strategy.rollingUpdate.maxSurge</code> æ˜¯å¯é€‰é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®šå¯ä»¥è¶…è¿‡æœŸæœ›çš„Podæ•°é‡çš„æœ€å¤§ä¸ªæ•°ã€‚è¯¥å€¼å¯ä»¥æ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼ˆä¾‹å¦‚5ï¼‰æˆ–è€…æ˜¯æœŸæœ›çš„Podæ•°é‡çš„ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚10%ï¼‰ã€‚å½“<code>MaxUnavailable</code>ä¸º0æ—¶è¯¥å€¼ä¸å¯ä»¥ä¸º0ã€‚é€šè¿‡ç™¾åˆ†æ¯”è®¡ç®—çš„ç»å¯¹å€¼å‘ä¸Šå–æ•´ã€‚é»˜è®¤å€¼æ˜¯1ã€‚</p>

<p>ä¾‹å¦‚ï¼Œè¯¥å€¼è®¾ç½®æˆ30%ï¼Œå¯åŠ¨rolling updateåæ–°çš„ReplicatSetå°†ä¼šç«‹å³æ‰©å®¹ï¼Œæ–°è€Podçš„æ€»æ•°ä¸èƒ½è¶…è¿‡æœŸæœ›çš„Podæ•°é‡çš„130%ã€‚æ—§çš„Podè¢«æ€æ‰åï¼Œæ–°çš„ReplicaSetå°†ç»§ç»­æ‰©å®¹ï¼Œæ—§çš„ReplicaSetä¼šè¿›ä¸€æ­¥ç¼©å®¹ï¼Œç¡®ä¿åœ¨å‡çº§çš„æ‰€æœ‰æ—¶åˆ»æ‰€æœ‰çš„Podæ•°é‡å’Œä¸ä¼šè¶…è¿‡æœŸæœ›Podæ•°é‡çš„130%ã€‚</p>

<h3 id="progress-deadline-seconds">Progress Deadline Seconds</h3>

<p><code>.spec.progressDeadlineSeconds</code> æ˜¯å¯é€‰é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®šåœ¨ç³»ç»ŸæŠ¥å‘ŠDeploymentçš„<a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/controllers/deployment.md#failed-deployment">failed progressing</a> â€”â€”è¡¨ç°ä¸ºresourceçš„çŠ¶æ€ä¸­<code>type=Progressing</code>ã€<code>Status=False</code>ã€ <code>Reason=ProgressDeadlineExceeded</code>å‰å¯ä»¥ç­‰å¾…çš„Deploymentè¿›è¡Œçš„ç§’æ•°ã€‚Deployment controllerä¼šç»§ç»­é‡è¯•è¯¥Deploymentã€‚æœªæ¥ï¼Œåœ¨å®ç°äº†è‡ªåŠ¨å›æ»šåï¼Œ deployment controlleråœ¨è§‚å¯Ÿåˆ°è¿™ç§çŠ¶æ€æ—¶å°±ä¼šè‡ªåŠ¨å›æ»šã€‚</p>

<p>å¦‚æœè®¾ç½®è¯¥å‚æ•°ï¼Œè¯¥å€¼å¿…é¡»å¤§äº <code>.spec.minReadySeconds</code>ã€‚</p>

<h3 id="min-ready-seconds">Min Ready Seconds</h3>

<p><code>.spec.minReadySeconds</code>æ˜¯ä¸€ä¸ªå¯é€‰é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®šæ²¡æœ‰ä»»ä½•å®¹å™¨crashçš„Podå¹¶è¢«è®¤ä¸ºæ˜¯å¯ç”¨çŠ¶æ€çš„æœ€å°ç§’æ•°ã€‚é»˜è®¤æ˜¯0ï¼ˆPodåœ¨readyåå°±ä¼šè¢«è®¤ä¸ºæ˜¯å¯ç”¨çŠ¶æ€ï¼‰ã€‚è¿›ä¸€æ­¥äº†è§£ä»€ä¹ˆä»€ä¹ˆåPodä¼šè¢«è®¤ä¸ºæ˜¯readyçŠ¶æ€ï¼Œå‚é˜… <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/concepts/workloads/pods/pod-lifecycle/#container-probes">Container Probes</a>ã€‚</p>

<h3 id="rollback-to">Rollback To</h3>

<p><code>.spec.rollbackTo</code> æ˜¯ä¸€ä¸ªå¯ä»¥é€‰é…ç½®é¡¹ï¼Œç”¨æ¥é…ç½®Deploymentå›é€€çš„é…ç½®ã€‚è®¾ç½®è¯¥å‚æ•°å°†è§¦å‘å›é€€æ“ä½œï¼Œæ¯æ¬¡å›é€€å®Œæˆåï¼Œè¯¥å€¼å°±ä¼šè¢«æ¸…é™¤ã€‚</p>

<h4 id="revision">Revision</h4>

<p><code>.spec.rollbackTo.revision</code>æ˜¯ä¸€ä¸ªå¯é€‰é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®šå›é€€åˆ°çš„revisionã€‚é»˜è®¤æ˜¯0ï¼Œæ„å‘³ç€å›é€€åˆ°å†å²ä¸­æœ€è€çš„revisionã€‚</p>

<h3 id="revision-history-limit">Revision History Limit</h3>

<p>Deployment revision historyå­˜å‚¨åœ¨å®ƒæ§åˆ¶çš„ReplicaSetsä¸­ã€‚</p>

<p><code>.spec.revisionHistoryLimit</code> æ˜¯ä¸€ä¸ªå¯é€‰é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®šå¯ä»¥ä¿ç•™çš„æ—§çš„ReplicaSetæ•°é‡ã€‚è¯¥ç†æƒ³å€¼å–å†³äºå¿ƒDeploymentçš„é¢‘ç‡å’Œç¨³å®šæ€§ã€‚å¦‚æœè¯¥å€¼æ²¡æœ‰è®¾ç½®çš„è¯ï¼Œé»˜è®¤æ‰€æœ‰æ—§çš„Replicasetæˆ–ä¼šè¢«ä¿ç•™ï¼Œå°†èµ„æºå­˜å‚¨åœ¨etcdä¸­ï¼Œæ˜¯ç”¨<code>kubectl get rs</code>æŸ¥çœ‹è¾“å‡ºã€‚æ¯ä¸ªDeploymentçš„è¯¥é…ç½®éƒ½ä¿å­˜åœ¨ReplicaSetä¸­ï¼Œç„¶è€Œï¼Œä¸€æ—¦ä½ åˆ é™¤çš„æ—§çš„RepelicaSetï¼Œä½ çš„Deploymentå°±æ— æ³•å†å›é€€åˆ°é‚£ä¸ªrevisonäº†ã€‚</p>

<p>å¦‚æœä½ å°†è¯¥å€¼è®¾ç½®ä¸º0ï¼Œæ‰€æœ‰å…·æœ‰0ä¸ªreplicaçš„ReplicaSetéƒ½ä¼šè¢«åˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–°çš„Deployment rolloutæ— æ³•æ’¤é”€ï¼Œå› ä¸ºrevision historyéƒ½è¢«æ¸…ç†æ‰äº†ã€‚</p>

<h3 id="paused">Paused</h3>

<p><code>.spec.paused</code>æ˜¯å¯ä»¥å¯é€‰é…ç½®é¡¹ï¼Œbooleanå€¼ã€‚ç”¨æ¥æŒ‡å®šæš‚åœå’Œæ¢å¤Deploymentã€‚Pausedå’Œæ²¡æœ‰pausedçš„Deploymentä¹‹é—´çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œæ‰€æœ‰å¯¹paused deploymentä¸­çš„PodTemplateSpecçš„ä¿®æ”¹éƒ½ä¸ä¼šè§¦å‘æ–°çš„rolloutã€‚Deploymentè¢«åˆ›å»ºä¹‹åé»˜è®¤æ˜¯épausedã€‚</p>

<h2 id="alternative-to-deployments">Alternative to Deployments</h2>

<h3 id="kubectl-rolling-update">kubectl rolling update</h3>

<p><a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/docs/user-guide/kubectl/v1.6/#rolling-update">Kubectl rolling update</a> è™½ç„¶ä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼æ›´æ–°Podå’ŒReplicationControllerã€‚ä½†æ˜¯æˆ‘ä»¬æ¨èä½¿ç”¨Deploymentï¼Œå› ä¸ºå®ƒæ˜¯å£°æ˜å¼çš„ï¼Œå®¢æˆ·ç«¯ä¾§ï¼Œå…·æœ‰é™„åŠ ç‰¹æ€§ï¼Œä¾‹å¦‚åŠæ—¶æ»šåŠ¨å‡çº§ç»“æŸåä¹Ÿå¯ä»¥å›æ»šåˆ°ä»»ä½•å†å²ç‰ˆæœ¬ã€‚</p>

            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://jimmysong.io/posts/kubernetes-service-rolling-update/" data-toggle="tooltip" data-placement="top" title="Kubernetesä¸­çš„Rolling UpdateæœåŠ¡æ»šåŠ¨å‡çº§">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://jimmysong.io/posts/kubernetes-logstash/" data-toggle="tooltip" data-placement="top" title="ä½¿ç”¨Logstashæ”¶é›†Kubernetesçš„åº”ç”¨æ—¥å¿—">Next Post &rarr;</a>
                </li>
                
            </ul>
            <div>
                 
                <h2>See Also</h2>
                <ul>
                    
                    <li><a href="/posts/kubernetes-service-rolling-update/">Kubernetesä¸­çš„Rolling UpdateæœåŠ¡æ»šåŠ¨å‡çº§</a></li>
                    
                    <li><a href="/posts/kubernetes-edge-node-configuration/">Kubernetesçš„è¾¹ç¼˜èŠ‚ç‚¹é…ç½®</a></li>
                    
                    <li><a href="/posts/kubernetes-with-glusterfs/">åœ¨kubernetesä¸­ä½¿ç”¨glusterfsåšæŒä¹…åŒ–å­˜å‚¨</a></li>
                    
                    <li><a href="/posts/kubernetes-performance-test/">Kubernetesç½‘ç»œå’Œé›†ç¾¤æ€§èƒ½æµ‹è¯•</a></li>
                    
                    <li><a href="/posts/distributed-load-testing-using-kubernetes/">è¿ç”¨kubernetesè¿›è¡Œåˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯•</a></li>
                    
                </ul>
                
            </div>
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Sat May 13, 2017</h4>
                </section>
                <h5 id="wc">12500 Words|Read in about 25 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/kubernetes">kubernetes</a> &nbsp;
                </h5>
            </div>
            
            <aside id=comments>
                <div>
                    <h2> Comments </h2>
                </div>
                <div id="container"></div>
                <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
                <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
                <script>
                    var gitment = new Gitment({
                        owner: 'rootsongjc', 
                        repo: 'rootsongjc.github.io', 
                        oauth: {
                            client_id: '93a0df08e0f93ff0c8a3',
                            client_secret: '3bdbf0b42c525f78582600bd38cf7f722ee40541',
                        },
                    })
                    gitment.render('container')
                </script>
            </aside>

        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:rootsongjc@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/jimmysongio" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/rootsongjc" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/jimmysongio" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/jimmysongio" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017
          
            
              Jimmy Song
                      
          
          
          &nbsp;&bull;&nbsp;
          October 4,2017
          updated
          
            &nbsp;&bull;&nbsp;
            <a href="https://jimmysong.io/">Jimmy Song</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.30-DEV</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="https://jimmysong.io/js/main.js"></script>

<script> renderMathInElement(document.body); </script>

<script src="https://jimmysong.io/js/prism.js"></script>
<script src="https://jimmysong.io/js/load-photoswipe.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe-ui-default.min.js"></script>




  </body>
</html>

