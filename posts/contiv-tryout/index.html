<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½• - jimmysong.io</title>
  <meta name="description" content="jimmysong.io" />
  <meta property="og:title" content="Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½•" />
  <meta name="twitter:title" content="Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½•" />
  <meta name="description" content="(é¢˜å›¾ï¼šå±±ä¸œè£æˆæ»¨æµ·é£åŠ›å‘ç”µåœº Jan 31,2017ï¼‰ å…³äºcontivçš„ä»‹ç»è¯·çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« Contiv Introã€‚ å¼€å‘ç¯å¢ƒä½¿ç”¨Vagrantæ­">
  <meta property="og:description" content="(é¢˜å›¾ï¼šå±±ä¸œè£æˆæ»¨æµ·é£åŠ›å‘ç”µåœº Jan 31,2017ï¼‰ å…³äºcontivçš„ä»‹ç»è¯·çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« Contiv Introã€‚ å¼€å‘ç¯å¢ƒä½¿ç”¨Vagrantæ­">
  <meta name="twitter:description" content="(é¢˜å›¾ï¼šå±±ä¸œè£æˆæ»¨æµ·é£åŠ›å‘ç”µåœº Jan 31,2017ï¼‰ å…³äºcontivçš„ä»‹ç»è¯·çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« Contiv Introã€‚ å¼€å‘ç¯å¢ƒä½¿ç”¨Vagrantæ­">
  <meta name="author" content="{Description { .Site.Author.name }}"/>
  <link href='https://jimmysong.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jimmysongio" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/posts/contiv-tryout/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Jimmy Song" />

  <meta name="generator" content="Hugo 0.30-DEV" />
  <link rel="canonical" href="https://jimmysong.io/posts/contiv-tryout/" />
  <link rel="alternate" href="https://jimmysong.io/index.xml" type="application/rss+xml" title="Jimmy Song">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://jimmysong.io/css/main.css" />
  <link rel="stylesheet" href="https://jimmysong.io/css/search.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  

<meta name="baidu-site-verification" content="g8IYR9SNLF" />
<script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

<link rel="stylesheet" href="https://jimmysong.io/css/prism.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jimmysong.io/">Jimmy Song</a>
    </div>
    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Articles</a>
              <div class="navlinks-children">
                
                  <a href="/posts">Posts</a>
                
                  <a href="/tags">Tags</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Categories</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes">kubernetes</a>
                
                  <a href="/categories/cloud-native">Cloud Native</a>
                
                  <a href="/categories/github">Github</a>
                
                  <a href="/categories/devops">Devops</a>
                
                  <a href="/categories/docker">Docker</a>
                
                  <a href="/categories/code">Code</a>
                
                  <a href="/categories/architecture/">Architecture</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Books</a>
              <div class="navlinks-children">
                
                  <a href="/cloud-native-go">Cloud Native Go</a>
                
                  <a href="/posts/cloud-native-python">Cloud Native Python</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Projects</a>
              <div class="navlinks-children">
                
                  <a href="/kubernetes-handbook">Kubernetes handbook</a>
                
                  <a href="/spark-on-k8s">Spark on kubernetes</a>
                
                  <a href="/awesome-cloud-native">Awesome Cloud Native</a>
                
                  <a href="/migrating-to-cloud-native-application-architectures"> Migrating to Cloud native</a>
                
                  <a href="http://istio.doczh.cn">Istio service mesh</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        

        

        
        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Search</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
          
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Jimmy Song" href="https://jimmysong.io/">
            <img class="avatar-img" src="https://jimmysong.io/img/avatar-icon.png" alt="Jimmy Song" />
          </a>
        
      </div>
    </div>

  </div>
</nav>





  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search jimmysong.io</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>


<script src="https://jimmysong.io/js/algoliasearch.min.js"></script>
<script src="https://jimmysong.io/js/autocomplete.min.js"></script>

<script>
var client = algoliasearch("X4YB3WOBNV", "d2134c5a8d250e6d3246594240c45201");
var index = client.initIndex('rootsongjc-hugo');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            
            return '<span>' + '<a href="/' + suggestion._highlightResult.uri.value + '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
            
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="posts-heading">
                <h1 align="center">Contivå…¥å‘æŒ‡å—-è¯•ç”¨å…¨è®°å½•</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Thu Mar 9, 2017</h4>
                </section>
                <h5 id="wc">2500 Words|Read in about 5 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/docker">docker</a> &nbsp;
                    <a href="https://jimmysong.io//tags/network">network</a> &nbsp;
                    <a href="https://jimmysong.io//tags/sdn">sdn</a> &nbsp;
                </h5>

            </div>
            <article role="main" class="blog-post">
                

<p><img src="https://res.cloudinary.com/jimmysong/image/upload/images/2017013129.jpg" alt="é»„æ˜" /></p>

<p><em>(é¢˜å›¾ï¼šå±±ä¸œè£æˆæ»¨æµ·é£åŠ›å‘ç”µåœº  Jan 31,2017ï¼‰</em></p>

<p>å…³äºcontivçš„ä»‹ç»è¯·çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://jimmysong.io/post/contiv_guide/">Contiv Intro</a>ã€‚</p>

<p>å¼€å‘ç¯å¢ƒä½¿ç”¨<strong>Vagrant</strong>æ­å»ºï¼Œæ˜¨å¤©è¯•ç”¨äº†ä¸‹ï¼ŒçœŸä¸çŸ¥é“å®ƒä»¬æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œå³ç„¶æ˜¯dockeræ’ä»¶ä¸ºå•¥ä¸ç›´æ¥åœ¨dockerä¸­å¼€å‘å‘¢ï¼Œæˆ‘æœ‰ç¯‡æ–‡ç« ä»‹ç»<a href="https://jimmysong.io/post/docker-dev-env/">å¦‚ä½•æ­å»ºdockerå¼€å‘ç¯å¢ƒ</a>ï¼Œå¯ä»¥åœ¨dockerä¸­å¼€å‘dockerï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨æ¥å¼€å‘contivå•ŠğŸ˜„ï¼Œåªè¦ä¸‹è½½ä¸€ä¸ªdockeré•œåƒ<code>dockercore/docker:latest</code>å³å¯ï¼Œä¸è¿‡æœ‰ç‚¹å¤§2.31Gï¼Œä½¿ç”¨é˜¿é‡Œäº‘çš„mirrorä¸‹è½½å€’æ˜¯ä¹Ÿåˆ’ç®—ï¼Œæ€»æ¯”ä½ è‡ªå·±éƒ¨ç½²ä¸€ä¸ªå¼€å‘ç¯å¢ƒèŠ‚çœæ—¶é—´ã€‚</p>

<h3 id="contivæ¦‚å¿µè§£æ">Contivæ¦‚å¿µè§£æ</h3>

<p>Contivç”¨äºç»™å®¹å™¨åˆ›å»ºå’Œåˆ†é…ç½‘è·¯ï¼Œå¯ä»¥åˆ›å»ºç­–ç•¥ç®¡ç†å®¹å™¨çš„å®‰å…¨ã€å¸¦å®½ã€ä¼˜å…ˆçº§ç­‰ï¼Œç›¸å½“äºä¸€ä¸ªSDNã€‚</p>

<h4 id="group">Group</h4>

<p>æŒ‰å®¹å™¨æˆ–Podçš„åŠŸèƒ½ç»™å®¹å™¨åˆ†é…ç­–ç•¥ç»„ï¼Œé€šå¸¸æ˜¯æŒ‰ç…§å®¹å™¨/Podçš„<code>label</code>æ¥åˆ†ç»„ï¼Œåº”ç”¨ç»„è·Ÿcontivçš„networkä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¯ä»¥å¾ˆå¤šåº”ç”¨ç»„å±äºåŒä¸€ä¸ªnetworkæˆ–IP subnetã€‚</p>

<h4 id="polices">Polices</h4>

<p>ç”¨æ¥é™å®šgroupçš„è¡Œä¸ºï¼Œcontivæ”¯æŒä¸¤ç§ç±»å‹çš„policyï¼š</p>

<ul>
<li>Bandwidth é™å®šåº”ç”¨ç»„çš„èµ„æºä½¿ç”¨ä¸Šé™</li>
<li>Isolation èµ„æºç»„çš„è®¿é—®æƒé™</li>
</ul>

<p>Groupå¯ä»¥åŒæ—¶åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªpolicyï¼Œå½“æœ‰å®¹å™¨è°ƒåº¦åˆ°è¯¥groupé‡Œå°±ä¼šé€‚ç”¨è¯¥groupçš„policyã€‚</p>

<h4 id="network">Network</h4>

<p>IPv4æˆ–IPv6ç½‘ç»œï¼Œå¯ä»¥é…ç½®subnetå’Œgatewayã€‚</p>

<p><strong>Contivä¸­çš„ç½‘ç»œ</strong></p>

<p>åœ¨contivä¸­å¯ä»¥é…ç½®ä¸¤ç§ç±»å‹çš„ç½‘ç»œ</p>

<ul>
<li>application networkï¼šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œ</li>
<li>infrastructure networkï¼šhost namespaceçš„è™šæ‹Ÿç½‘ç»œï¼Œæ¯”å¦‚åŸºç¡€è®¾æ–½ç›‘æ§ç½‘ç»œ</li>
</ul>

<p><strong>ç½‘ç»œå°è£…</strong></p>

<p>Contivä¸­æœ‰ä¸¤ç§ç±»å‹çš„ç½‘ç»œå°è£…</p>

<ul>
<li>Routedï¼šoverlay topologyå’ŒL3-routed BGP topology</li>
<li>Bridgedï¼šlayer2 VLAN</li>
</ul>

<h4 id="tenant">Tenant</h4>

<p>Tenantæä¾›contivä¸­çš„namespaceéš”ç¦»ã€‚ä¸€ä¸ªtenantå¯ä»¥æœ‰å¾ˆå¤šä¸ªnetworkï¼Œæ¯ä¸ªnetworkéƒ½æœ‰ä¸ªsubnetã€‚è¯¥tenantä¸­çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒçš„ä»»æ„networkå’Œsubnetçš„IPã€‚</p>

<p>ç‰©ç†ç½‘ç»œä¸­çš„tenantç§°ä½œ<code>è™šæ‹Ÿè·¯ç”±è½¬å‘(VRF)</code>ã€‚Contivä½¿ç”¨VLANå’ŒVXLAN IDæ¥å®ç°å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œè¿™å–å†³ä½ ä½¿ç”¨çš„æ˜¯layer2ã€layer3è¿˜æ˜¯Cisco ACIã€‚</p>

<h3 id="contivä¸‹è½½">Contivä¸‹è½½</h3>

<p>Contivçš„ç¼–è¯‘å®‰è£…æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½githubä¸Šçš„<a href="[1.0.0-beta.3-03-08-2017.18-51-20.UTC](https://github.com/contiv/netplugin/releases/tag/1.0.0-beta.3-03-08-2017.18-51-20.UTC)">release-1.0.0-beta.3-03-08-2017.18-51-20.UTC</a>æ–‡ä»¶è§£å‹è·å¾—äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚</p>

<p><strong>æ³¨æ„</strong>ï¼š<a href="https://github.com/contiv/install/blob/master/README.md">è¿™ä¸ªå®˜æ–¹æ–‡æ¡£</a>å·²ç»è¿‡æ—¶ï¼Œä¸è¦çœ‹äº†ã€‚</p>

<p>å¦‚æœè¯•ç”¨å¯ä»¥çš„è¯ï¼Œæˆ‘ä¼šåç»­å†™contivå¼€å‘ç¯å¢ƒæ­å»ºçš„æ–‡ç« ã€‚</p>

<p>è¿™ä¸ªreleaseæ˜¯2017å¹´3æœˆ8æ—¥å‘å¸ƒçš„ï¼Œå°±åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„å‰ä¸€å¤©ã€‚æœ‰ä¸ª<strong>æœ€é‡è¦çš„æ›´æ–°</strong>æ˜¯<u>æ”¯æŒdocker1.13 swarm mode</u>ã€‚</p>

<p><a href="https://github.com/contiv/netplugin/blob/master/install/HowtoSetupContiv.md">å®˜æ–¹å®‰è£…æ–‡æ¡£</a></p>

<p>ä¸‹è½½è§£å‹åä¼šå¾—åˆ°å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>

<ul>
<li>contivk8s  k8sä¸“ç”¨çš„</li>
<li>contrib  æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸ª<code>netctl</code>çš„bashè„šæœ¬</li>
<li>netcontiv  è¿™ä¸ªå‘½ä»¤å°±ä¸€ä¸ª-versioné€‰é¡¹ç”¨æ¥æŸ¥çœ‹contivçš„ç‰ˆæœ¬ğŸ˜“</li>
<li>netctl  contivå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥é…ç½®ç½‘ç»œã€ç­–ç•¥ã€æœåŠ¡è´Ÿè½½å‡è¡¡ï¼Œ<a href="http://contiv.github.io/documents/reference/netctlcli.html">ä½¿ç”¨è¯´æ˜</a></li>
<li>netmaster  contivçš„ä¸»èŠ‚ç‚¹æœåŠ¡</li>
<li>netplugin</li>
</ul>

<p>ä¸‹é¢çš„å®‰è£…ä¸­ç”¨åˆ°çš„åªæœ‰netctlã€netmasterå’Œnetpluginè¿™ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>

<p>æˆ‘ä»¬å°†è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½copyåˆ°/usr/binç›®å½•ä¸‹ã€‚</p>

<p>æˆ‘ä»¬åœ¨docker17.03-ceä¸­å®‰è£…contivã€‚</p>

<h3 id="contivå®‰è£…ä¾èµ–">Contivå®‰è£…ä¾èµ–</h3>

<p>Contivä¾èµ–äºconsulæˆ–etcdï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨etcdï¼Œslacké‡Œçš„äººè¯´åªæ”¯æŒ2.3.xç‰ˆæœ¬ï¼Œå¯èƒ½ä¸æ”¯æŒ3.0+ç‰ˆæœ¬çš„å§ï¼Œè¿˜æ²¡å®é™…æµ‹è¿‡ï¼Œå…ˆä½¿ç”¨2.3.7ã€‚</p>

<p><code>contiv master</code>å¯åŠ¨åè‡ªåŠ¨å‘etcdä¸­æ³¨å†Œä¿¡æ¯ï¼š</p>

<pre><code class="language-bash">/contiv.io/oper
/contiv.io/oper/auto-vlan
/contiv.io/oper/auto-vlan/global
/contiv.io/oper/auto-vxlan
/contiv.io/oper/auto-vxlan/global
/contiv.io/oper/global
/contiv.io/oper/global/global
/contiv.io/oper/ovs-driver
/contiv.io/oper/ovs-driver/sz-pg-oam-docker-test-001.tendcloud.com
/contiv.io/master
/contiv.io/master/config
/contiv.io/master/config/global
/contiv.io/obj
/contiv.io/obj/modeldb
/contiv.io/obj/modeldb/global
/contiv.io/obj/modeldb/global/global
/contiv.io/obj/modeldb/tenant
/contiv.io/obj/modeldb/tenant/default
/contiv.io/lock
/contiv.io/lock/netmaster
/contiv.io/lock/netmaster/leader
/contiv.io/service
/contiv.io/service/netmaster
/contiv.io/service/netmaster/172.20.0.113:9999
/contiv.io/service/netmaster.rpc
/contiv.io/service/netmaster.rpc/172.20.0.113:9001
/contiv.io/state
/contiv.io/state/auto-vlan
/contiv.io/state/auto-vlan/global
/contiv.io/state/auto-vxlan
/contiv.io/state/auto-vxlan/global
/contiv.io/state/global
/contiv.io/state/global/global
</code></pre>

<h3 id="contivå¯åŠ¨">Contivå¯åŠ¨</h3>

<p><strong>å¯åŠ¨netmaster</strong></p>

<pre><code class="language-shell">$nohup netmaster -cluster-mode docker -cluster-store etcd://172.20.0.113:2379 -debug -listen-url 172.20.0.113:9999 -plugin-name netplugin &amp;
</code></pre>

<p>ä¸ºäº†çªå‡ºnetmasterå‘½ä»¤çš„ä½¿ç”¨ï¼Œæˆ‘æŠŠæ‰€æœ‰å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼çš„å‚æ•°éƒ½æ˜ç¡®çš„å†™å‡ºã€‚</p>

<p><code>netmaster</code>ç›‘å¬9999ç«¯å£ã€‚</p>

<p><strong>æŸ¥çœ‹å·²æœ‰çš„contivç½‘ç»œ</strong></p>

<pre><code class="language-bash">$netctl --netmaster http://172.20.0.113:9999 network ls
Tenant  Network  Nw Type  Encap type  Packet tag  Subnet   Gateway  IPv6Subnet  IPv6Gateway
------  -------  -------  ----------  ----------  -------  ------   ----------  -----------
</code></pre>

<p>ä¸ºäº†ä»¥åæ‰§è¡Œå‘½ä»¤æ–¹ä¾¿ï¼Œä¸ç”¨æ¥å›è¾“å…¥<code>$NETMASTER</code>åœ°å€ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡</p>

<p><code>export NETMASTER=&quot;http://172.20.0.113:9999&quot;</code></p>

<p><strong>æ³¨æ„</strong>ï¼šnetpluginéœ€è¦ä½¿ç”¨Open vSwitchï¼Œæ‰€ä»¥ä½ éœ€è¦å…ˆå®‰è£…<strong>Open vSwitch</strong>ã€‚å¦åˆ™ä½ ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜<a href="https://github.com/contiv/netplugin/issues/760">netplugin issue-760</a></p>

<h3 id="open-vswitchå®‰è£…">Open vSwitchå®‰è£…</h3>

<p><a href="http://supercomputing.caltech.edu/blog/index.php/2016/05/03/open-vswitch-installation-on-centos-7-2/">Open vSwitch installation on CentOS7.2</a></p>

<p>å‚è€ƒä¸Šé¢é“¾æ¥é‡Œçš„æ–¹æ³•ã€‚</p>

<pre><code class="language-shell">#!/bin/bash
yum -y install make gcc openssl-devel autoconf automake rpm-build redhat-rpm-config python-devel openssl-devel kernel-devel kernel-debug-devel libtool wget
mkdir -p ~/rpmbuild/SOURCES
cp openvswitch-2.5.1.tar.gz ~/rpmbuild/SOURCES/
tar xfz openvswitch-2.5.1.tar.gz
sed 's/openvswitch-kmod, //g' openvswitch-2.5.1/rhel/openvswitch.spec &gt; openvswitch-2.5.1/rhel/openvswitch_no_kmod.spec
rpmbuild -bb --nocheck ~/openvswitch-2.5.1/rhel/openvswitch_no_kmod.spec
</code></pre>

<p>ç¼–è¯‘å¥½çš„rpmåŒ…åœ¨<code>~/rpmbuild/RPMS/x86_64/openvswitch-2.5.1-1.x86_64.rpm</code>ç›®å½•ä¸‹ã€‚</p>

<p>å®‰è£…å¥½Open vSwitchåå°±å¯ä»¥å¯åŠ¨<strong>netplugin</strong>ã€‚</p>

<h3 id="åˆ›å»ºcontivç½‘ç»œ">åˆ›å»ºcontivç½‘ç»œ</h3>

<p><strong>å¯åŠ¨netplugin</strong></p>

<pre><code class="language-bash">nohup netplugin -cluster-store etcd://172.20.0.113:2379 &amp;
</code></pre>

<p><strong>åˆ›å»ºnetwork</strong></p>

<pre><code class="language-bash">netctl --netmaster http://172.20.0.113:9999 network create --subnet=10.1.2.0/24 contiv-net
</code></pre>

<p>è·å¾—ä»¥ä¸‹æŠ¥é”™ï¼š</p>

<p>ERRO[0000] Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode</p>

<p>ä½†æ˜¯æ‰§è¡Œç¬¬äºŒæ¬¡çš„æ—¶å€™å±…ç„¶æˆåŠŸäº†ï¼Œä¸è¿‡å½“æˆ‘æŸ¥çœ‹docker networkçš„æ—¶å€™æ ¹æœ¬å°±çœ‹ä¸åˆ°åˆšåˆšåˆ›å»ºçš„contiv-netç½‘ç»œã€‚*è¿™åªæ˜¯ä¸€åœºæ¸¸æˆä¸€åœºæ¢¦ã€‚ã€‚ã€‚*ğŸ˜¢</p>

<p>Creating network default:contiv-net</p>

<pre><code class="language-bash">$netctl network ls
Tenant   Network     Nw Type  Encap type  Packet tag  Subnet       Gateway  IPv6Subnet  IPv6Gateway
------   -------     -------  ----------  ----------  -------      ------   ----------  -----------
default  contiv-net  data     vxlan       0           10.1.2.0/24  
</code></pre>

<p>æŸ¥çœ‹åˆšåˆ›å»ºçš„contiv-netç½‘ç»œã€‚</p>

<pre><code class="language-Bash">$netctl network inspect contiv-net
Inspeting network: contiv-net tenant: default
{
  &quot;Config&quot;: {
    &quot;key&quot;: &quot;default:contiv-net&quot;,
    &quot;encap&quot;: &quot;vxlan&quot;,
    &quot;networkName&quot;: &quot;contiv-net&quot;,
    &quot;nwType&quot;: &quot;data&quot;,
    &quot;subnet&quot;: &quot;10.1.2.0/24&quot;,
    &quot;tenantName&quot;: &quot;default&quot;,
    &quot;link-sets&quot;: {},
    &quot;links&quot;: {
      &quot;Tenant&quot;: {
        &quot;type&quot;: &quot;tenant&quot;,
        &quot;key&quot;: &quot;default&quot;
      }
    }
  },
  &quot;Oper&quot;: {
    &quot;availableIPAddresses&quot;: &quot;10.1.2.1-10.1.2.254&quot;,
    &quot;externalPktTag&quot;: 1,
    &quot;pktTag&quot;: 1
  }
}
</code></pre>

<p>ä»<strong>netmaster</strong>æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>

<pre><code class="language-bash">time=&quot;Mar  9 21:44:14.746627381&quot; level=debug msg=&quot;NwInfra type is default, no ACI&quot; 
time=&quot;Mar  9 21:44:14.750278056&quot; level=info msg=&quot;Creating docker network: {CheckDuplicate:true Driver:netplugin EnableIPv6:false IPAM:0xc4204d8ea0 Internal:false Attachable:true Options:map[tenant:default encap:vxlan pkt-tag:1] Labels:map[]}&quot; 
time=&quot;Mar  9 21:44:14.752034749&quot; level=error msg=&quot;Error creating network contiv-net. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752067294&quot; level=error msg=&quot;Error creating network contiv-net.default in docker. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752102735&quot; level=error msg=&quot;Error creating network {&amp;{Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752129195&quot; level=error msg=&quot;NetworkCreate retruned error for: &amp;{Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752155973&quot; level=error msg=&quot;CreateNetwork error for: {Key:default:contiv-net Encap:vxlan Gateway: Ipv6Gateway: Ipv6Subnet: NetworkName:contiv-net NwType:data PktTag:0 Subnet:10.1.2.0/24 TenantName:default LinkSets:{EndpointGroups:map[] Servicelbs:map[] Services:map[]} Links:{Tenant:{ObjType: ObjKey:}}}. Err: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
time=&quot;Mar  9 21:44:14.752172138&quot; level=error msg=&quot;Handler for POST /api/v1/networks/default:contiv-net/ returned error: Error response from daemon: legacy plugin netplugin of type NetworkDriver is not supported in swarm mode&quot; 
</code></pre>

<h3 id="æ€»ç»“">æ€»ç»“</h3>

<p>ä»æ—¥å¿—ä¸­çœ‹åˆ°ä¸€ä¸ªä»¤äººæ‚²ç—›è¯­å¥çš„è¯*legacy plugin netplugin of type NetworkDriver is not supported in swarm mode*ï¼Œä½ ä»¬æ˜¨å¤©ä¸æ˜¯åˆšå‘çš„ç‰ˆæœ¬è¯´å·²ç»æ”¯æŒswarm modeå—ï¼Ÿ<a href="https://github.com/contiv/netplugin/commit/8afd1b7718c8424a876760d18484124e0aad3557"><code>commit-8afd1b7</code></a>ä¸æ˜¯ç™½çº¸é»‘å­—çš„å†™ç€å—ï¼Ÿ</p>

<p>æˆ‘æäº†ä¸ª<a href="https://github.com/contiv/netplugin/issues/776">issue-776</a>ï¼Œçœ‹çœ‹æ€æ ·è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦å¤–netpluginå‘½ä»¤æ€ä¹ˆç”¨ï¼Œæ–‡æ¡£ä¸Šæ²¡å†™å•Šï¼Ÿ</p>

<p><code>netplugin -h</code>å¯ä»¥ä¸­æœ‰ä¸¤ä¸ªé€‰é¡¹æˆ‘ä¸æ˜ç™½ï¼Œä¸çŸ¥é“æ€ä¹ˆè®¾ç½®ï¼Œæœ‰çŸ¥é“çš„äººè¯·å‘Šè¯‰æˆ‘ä¸€å£°ã€‚</p>

<pre><code class="language-bash">  -vlan-if value
    	VLAN uplink interface
  -vtep-ip string
    	My VTEP ip address
</code></pre>

<p>åŒæ—¶æˆ‘ä¼šç»§ç»­å…³æ³¨contivçš„slackå’Œgithub <a href="https://github.com/contiv/netplugin/issues/776">Issue-776</a>çš„è¿›å±•ã€‚</p>

            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://jimmysong.io/posts/contiv-guide/" data-toggle="tooltip" data-placement="top" title="æ€ç§‘å¼€æºdockerç½‘ç»œæ’ä»¶Contivç®€ä»‹">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://jimmysong.io/posts/contiv-v2plugin/" data-toggle="tooltip" data-placement="top" title="Contivå…¥å‘æŒ‡å—-v2plugin">Next Post &rarr;</a>
                </li>
                
            </ul>
            <div>
                 
                <h2>See Also</h2>
                <ul>
                    
                    <li><a href="/posts/contiv-guide/">æ€ç§‘å¼€æºdockerç½‘ç»œæ’ä»¶Contivç®€ä»‹</a></li>
                    
                    <li><a href="/posts/docker-tech-selection/">DockeræŠ€æœ¯é€‰å‹</a></li>
                    
                    <li><a href="/posts/docker-dev-env/">Dockeræºç ç¼–è¯‘å’Œå¼€å‘ç¯å¢ƒæ­å»º</a></li>
                    
                </ul>
                
            </div>
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Thu Mar 9, 2017</h4>
                </section>
                <h5 id="wc">2500 Words|Read in about 5 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/docker">docker</a> &nbsp;
                    <a href="https://jimmysong.io//tags/network">network</a> &nbsp;
                    <a href="https://jimmysong.io//tags/sdn">sdn</a> &nbsp;
                </h5>
            </div>
            
            
                
                 <aside id=comments>
    <div>
        <h2> Comments </h2>
    </div>
    <div id="container"></div>
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rootsongjc', 
            repo: 'rootsongjc.github.io', 
            oauth: {
                client_id: '93a0df08e0f93ff0c8a3',
                client_secret: '3bdbf0b42c525f78582600bd38cf7f722ee40541',
            },
        })
        gitment.render('container')
    </script>
</aside>

                
            
        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:rootsongjc@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/jimmysongio" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/rootsongjc" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/jimmysongio" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/jimmysongio" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017
          
            
              Jimmy Song
                      
          
          
          
            &nbsp;&bull;&nbsp;
            <a href="https://jimmysong.io/">Jimmy Song</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.30-DEV</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="https://jimmysong.io/js/main.js"></script>

<script> renderMathInElement(document.body); </script>

<script src="https://jimmysong.io/js/prism.js"></script>
<script src="https://jimmysong.io/js/load-photoswipe.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe-ui-default.min.js"></script>



  </body>
</html>

