<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> Kubernetesä¸­çš„Secreté…ç½®è¯¦è§£ - Cloud NativeğŸ¤˜Big Data</title>
  <meta name="description" content="Cloud NativeğŸ¤˜Big Data" />
  <meta property="og:title" content="Kubernetesä¸­çš„Secreté…ç½®è¯¦è§£" />
  <meta name="twitter:title" content="Kubernetesä¸­çš„Secreté…ç½®è¯¦è§£" />
  <meta name="description" content="Secret å¯¹è±¡ç±»å‹ç”¨æ¥ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh keyã€‚å°†è¿™äº›ä¿¡æ¯æ”¾åœ¨ secret ä¸­æ¯”æ”¾åœ¨ pod çš„å®šä¹‰ä¸­æˆ–è€… docker é•œåƒä¸­æ¥è¯´æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚å‚é˜… Secret è®¾è®¡">
  <meta property="og:description" content="Secret å¯¹è±¡ç±»å‹ç”¨æ¥ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh keyã€‚å°†è¿™äº›ä¿¡æ¯æ”¾åœ¨ secret ä¸­æ¯”æ”¾åœ¨ pod çš„å®šä¹‰ä¸­æˆ–è€… docker é•œåƒä¸­æ¥è¯´æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚å‚é˜… Secret è®¾è®¡">
  <meta name="twitter:description" content="Secret å¯¹è±¡ç±»å‹ç”¨æ¥ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh keyã€‚å°†è¿™äº›ä¿¡æ¯æ”¾åœ¨ secret ä¸­æ¯”æ”¾åœ¨ pod çš„å®šä¹‰ä¸­æˆ–è€… docker é•œåƒä¸­æ¥è¯´æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚å‚é˜… Secret è®¾è®¡">
  <meta name="author" content="{Description { .Site.Author.name }}"/>
  <link href='https://jimmysong.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jimmysongio" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/posts/kubernetes-secret-configuration/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Jimmy Song" />

  <meta name="generator" content="Hugo 0.30-DEV" />
  <link rel="canonical" href="https://jimmysong.io/posts/kubernetes-secret-configuration/" />
  <link rel="alternate" href="https://jimmysong.io/index.xml" type="application/rss+xml" title="Jimmy Song">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://jimmysong.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  

<meta name="baidu-site-verification" content="g8IYR9SNLF" />
<script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

<link rel="stylesheet" href="https://jimmysong.io/css/prism.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jimmysong.io/">Jimmy Song</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Articles</a>
              <div class="navlinks-children">
                
                  <a href="/posts">Posts</a>
                
                  <a href="/tags">Tags</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Categories</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes">kubernetes</a>
                
                  <a href="/categories/cloud-native">Cloud Native</a>
                
                  <a href="/categories/github">Github</a>
                
                  <a href="/categories/devops">Devops</a>
                
                  <a href="/categories/docker">Docker</a>
                
                  <a href="/categories/code">Code</a>
                
                  <a href="/categories/architecture/">Architecture</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Books</a>
              <div class="navlinks-children">
                
                  <a href="/cloud-native-go">Cloud Native Go</a>
                
                  <a href="/posts/cloud-native-python">Cloud Native Python</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Projects</a>
              <div class="navlinks-children">
                
                  <a href="/kubernetes-handbook">Kubernetes handbook</a>
                
                  <a href="/spark-on-k8s">Spark on kubernetes</a>
                
                  <a href="/awesome-cloud-native">Awesome Cloud Native</a>
                
                  <a href="/migrating-to-cloud-native-application-architectures"> Migrating to Cloud native</a>
                
                  <a href="http://istio.doczh.cn">Istio service mesh</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Jimmy Song" href="https://jimmysong.io/">
            <img class="avatar-img" src="https://jimmysong.io/img/avatar-icon.png" alt="Jimmy Song" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
            
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="posts-heading">
                <h1 align="center">Kubernetesä¸­çš„Secreté…ç½®è¯¦è§£</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Thu Sep 28, 2017</h4>
                </section>
                <h5 id="wc">5900 Words|Read in about 12 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/kubernetes">kubernetes</a> &nbsp;
                </h5>

            </div>
            <article role="main" class="blog-post">
                

<p><code>Secret</code> å¯¹è±¡ç±»å‹ç”¨æ¥ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh keyã€‚å°†è¿™äº›ä¿¡æ¯æ”¾åœ¨ <code>secret</code> ä¸­æ¯”æ”¾åœ¨ <code>pod</code> çš„å®šä¹‰ä¸­æˆ–è€… docker é•œåƒä¸­æ¥è¯´æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚å‚é˜… <a href="https://git.k8s.io/community/contributors/design-proposals/secrets.md">Secret è®¾è®¡æ–‡æ¡£</a> è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>

<h2 id="secret-æ¦‚è§ˆ">Secret æ¦‚è§ˆ</h2>

<p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€token æˆ– key çš„å¯¹è±¡ã€‚è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod spec ä¸­æˆ–è€…é•œåƒä¸­ï¼›å°†å…¶æ”¾åœ¨ä¸€ä¸ª secret å¯¹è±¡ä¸­å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å®ƒçš„ç”¨é€”ï¼Œå¹¶é™ä½æ„å¤–æš´éœ²çš„é£é™©ã€‚</p>

<p>ç”¨æˆ·å¯ä»¥åˆ›å»º secretï¼ŒåŒæ—¶ç³»ç»Ÿä¹Ÿåˆ›å»ºäº†ä¸€äº› secretã€‚</p>

<p>è¦ä½¿ç”¨ secretï¼Œpod éœ€è¦å¼•ç”¨ secretã€‚Pod å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼ä½¿ç”¨ secretï¼šä½œä¸º <a href="https://kubernetes.io/docs/concepts/storage/volumes">volume</a> ä¸­çš„æ–‡ä»¶è¢«æŒ‚è½½åˆ° pod ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨é‡Œï¼Œæˆ–è€…å½“ kubelet ä¸º pod æ‹‰å–é•œåƒæ—¶ä½¿ç”¨ã€‚</p>

<h3 id="å†…ç½®-secret">å†…ç½® secret</h3>

<h4 id="service-account-ä½¿ç”¨-api-å‡­è¯è‡ªåŠ¨åˆ›å»ºå’Œé™„åŠ -secret">Service Account ä½¿ç”¨ API å‡­è¯è‡ªåŠ¨åˆ›å»ºå’Œé™„åŠ  secret</h4>

<p>Kubernetes è‡ªåŠ¨åˆ›å»ºåŒ…å«è®¿é—® API å‡­æ®çš„ secretï¼Œå¹¶è‡ªåŠ¨ä¿®æ”¹æ‚¨çš„ pod ä»¥ä½¿ç”¨æ­¤ç±»å‹çš„ secretã€‚</p>

<p>å¦‚æœéœ€è¦ï¼Œå¯ä»¥ç¦ç”¨æˆ–è¦†ç›–è‡ªåŠ¨åˆ›å»ºå’Œä½¿ç”¨APIå‡­æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦çš„åªæ˜¯å®‰å…¨åœ°è®¿é—® apiserverï¼Œæˆ‘ä»¬æ¨èè¿™æ ·çš„å·¥ä½œæµç¨‹ã€‚</p>

<p>å‚é˜… <a href="https://kubernetes.io/docs/user-guide/service-accounts">Service Account</a> æ–‡æ¡£è·å–å…³äº Service Account å¦‚ä½•å·¥ä½œçš„æ›´å¤šä¿¡æ¯ã€‚</p>

<h3 id="åˆ›å»ºæ‚¨è‡ªå·±çš„-secret">åˆ›å»ºæ‚¨è‡ªå·±çš„ Secret</h3>

<h4 id="ä½¿ç”¨-kubectl-åˆ›å»º-secret">ä½¿ç”¨ kubectl åˆ›å»º Secret</h4>

<p>å‡è®¾æœ‰äº› pod éœ€è¦è®¿é—®æ•°æ®åº“ã€‚è¿™äº› pod éœ€è¦ä½¿ç”¨çš„ç”¨æˆ·åå’Œå¯†ç åœ¨æ‚¨æœ¬åœ°æœºå™¨çš„ <code>./username.txt</code> å’Œ <code>./password.txt</code> æ–‡ä»¶é‡Œã€‚</p>

<pre><code class="language-bash"># Create files needed for rest of example.
$ echo -n &quot;admin&quot; &gt; ./username.txt
$ echo -n &quot;1f2d1e2e67df&quot; &gt; ./password.txt
</code></pre>

<p><code>kubectl create secret</code> å‘½ä»¤å°†è¿™äº›æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ª Secret ä¸­å¹¶åœ¨ API server ä¸­åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚</p>

<pre><code class="language-bash">$ kubectl create secret generic db-user-pass --from-file=./username.txt --from-file=./password.txt
secret &quot;db-user-pass&quot; created
</code></pre>

<p>æ‚¨å¯ä»¥è¿™æ ·æ£€æŸ¥åˆšåˆ›å»ºçš„ secretï¼š</p>

<pre><code class="language-bash">$ kubectl get secrets
NAME                  TYPE                                  DATA      AGE
db-user-pass          Opaque                                2         51s

$ kubectl describe secrets/db-user-pass
Name:            db-user-pass
Namespace:       default
Labels:          &lt;none&gt;
Annotations:     &lt;none&gt;

Type:            Opaque

Data
====
password.txt:    12 bytes
username.txt:    5 bytes
</code></pre>

<p>è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>get</code> å’Œ <code>describe</code> å‘½ä»¤éƒ½ä¸ä¼šæ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å°† secret ä¸­çš„å†…å®¹è¢«æ„å¤–æš´éœ²ç»™ä»ç»ˆç«¯æ—¥å¿—è®°å½•ä¸­åˆ»æ„å¯»æ‰¾å®ƒä»¬çš„äººã€‚</p>

<p>è¯·å‚é˜… <a href="https://kubernetes.io/docs/concepts/configuration/secret.md#decoding-a-secret">è§£ç  secret</a> äº†è§£å¦‚ä½•æŸ¥çœ‹å®ƒä»¬çš„å†…å®¹ã€‚</p>

<h4 id="æ‰‹åŠ¨åˆ›å»º-secret">æ‰‹åŠ¨åˆ›å»º Secret</h4>

<p>æ‚¨ä¹Ÿå¯ä»¥å…ˆä»¥ json æˆ– yaml æ ¼å¼åœ¨æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ª secret å¯¹è±¡ï¼Œç„¶ååˆ›å»ºè¯¥å¯¹è±¡ã€‚</p>

<p>æ¯ä¸€é¡¹å¿…é¡»æ˜¯ base64 ç¼–ç ï¼š</p>

<pre><code class="language-bash">$ echo -n &quot;admin&quot; | base64
YWRtaW4=
$ echo -n &quot;1f2d1e2e67df&quot; | base64
MWYyZDFlMmU2N2Rm
</code></pre>

<p>ç°åœ¨å¯ä»¥åƒè¿™æ ·å†™ä¸€ä¸ª secret å¯¹è±¡ï¼š</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
</code></pre>

<p>æ•°æ®å­—æ®µæ˜¯ä¸€ä¸ªæ˜ å°„ã€‚å®ƒçš„é”®å¿…é¡»åŒ¹é… <a href="https://git.k8s.io/community/contributors/design-proposals/identifiers.md">DNS_SUBDOMAIN</a>ï¼Œå‰å¯¼ç‚¹ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™äº›å€¼å¯ä»¥æ˜¯ä»»æ„æ•°æ®ï¼Œä½¿ç”¨ base64 è¿›è¡Œç¼–ç ã€‚</p>

<p>ä½¿ç”¨ <a href="https://kubernetes.io/docs/user-guide/kubectl/v1.7/#create"><code>kubectl create</code></a> åˆ›å»º secretï¼š</p>

<pre><code class="language-bash">$ kubectl create -f ./secret.yaml
secret &quot;mysecret&quot; created
</code></pre>

<p><strong>ç¼–ç æ³¨æ„ï¼š</strong> secret æ•°æ®çš„åºåˆ—åŒ– JSON å’Œ YAML å€¼ä½¿ç”¨ base64 ç¼–ç æˆå­—ç¬¦ä¸²ã€‚æ¢è¡Œç¬¦åœ¨è¿™äº›å­—ç¬¦ä¸²ä¸­æ— æ•ˆï¼Œå¿…é¡»çœç•¥ã€‚å½“åœ¨Darwin/OS Xä¸Šä½¿ç”¨ <code>base64</code> å®ç”¨ç¨‹åºæ—¶ï¼Œç”¨æˆ·åº”é¿å…ä½¿ç”¨ <code>-b</code> é€‰é¡¹æ¥æ‹†åˆ†é•¿è¡Œã€‚å¦å¤–ï¼Œå¯¹äº Linuxç”¨æˆ·å¦‚æœ <code>-w</code> é€‰é¡¹ä¸å¯ç”¨çš„è¯ï¼Œåº”è¯¥æ·»åŠ é€‰é¡¹ <code>-w 0</code> åˆ° <code>base64</code> å‘½ä»¤æˆ–ç®¡é“ <code>base64 | tr -d '\n'</code> ã€‚</p>

<h4 id="è§£ç -secret">è§£ç  Secret</h4>

<p>å¯ä»¥ä½¿ç”¨ <code>kubectl get secret</code> å‘½ä»¤è·å– secretã€‚ä¾‹å¦‚ï¼Œè·å–åœ¨ä¸Šä¸€èŠ‚ä¸­åˆ›å»ºçš„ secretï¼š</p>

<pre><code class="language-bash">$ kubectl get secret mysecret -o yaml
apiVersion: v1
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
kind: Secret
metadata:
  creationTimestamp: 2016-01-22T18:41:56Z
  name: mysecret
  namespace: default
  resourceVersion: &quot;164619&quot;
  selfLink: /api/v1/namespaces/default/secrets/mysecret
  uid: cfee02d6-c137-11e5-8d73-42010af00002
type: Opaque
</code></pre>

<p>è§£ç å¯†ç å­—æ®µï¼š</p>

<pre><code class="language-bash">$ echo &quot;MWYyZDFlMmU2N2Rm&quot; | base64 --decode
1f2d1e2e67df
</code></pre>

<h3 id="ä½¿ç”¨-secret">ä½¿ç”¨ Secret</h3>

<p>Secret å¯ä»¥ä½œä¸ºæ•°æ®å·è¢«æŒ‚è½½ï¼Œæˆ–ä½œä¸ºç¯å¢ƒå˜é‡æš´éœ²å‡ºæ¥ä»¥ä¾› pod ä¸­çš„å®¹å™¨ä½¿ç”¨ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥è¢«ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨ï¼Œè€Œä¸ç›´æ¥æš´éœ²åœ¨ pod å†…ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¯ä»¥ä¿å­˜å‡­æ®ï¼Œç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†åº”è¯¥ç”¨å®ƒæ¥ä»£è¡¨æ‚¨ä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚</p>

<h4 id="åœ¨-pod-ä¸­ä½¿ç”¨-secret-æ–‡ä»¶">åœ¨ Pod ä¸­ä½¿ç”¨ Secret æ–‡ä»¶</h4>

<p>åœ¨ Pod ä¸­çš„ volume é‡Œä½¿ç”¨ Secretï¼š</p>

<ol>
<li><p>åˆ›å»ºä¸€ä¸ª secret æˆ–è€…ä½¿ç”¨å·²æœ‰çš„ secretã€‚å¤šä¸ª pod å¯ä»¥å¼•ç”¨åŒä¸€ä¸ª secretã€‚</p></li>

<li><p>ä¿®æ”¹æ‚¨çš„ pod çš„å®šä¹‰åœ¨ <code>spec.volumes[]</code> ä¸‹å¢åŠ ä¸€ä¸ª volumeã€‚å¯ä»¥ç»™è¿™ä¸ª volume éšæ„å‘½åï¼Œå®ƒçš„ <code>spec.volumes[].secret.secretName</code> å¿…é¡»ç­‰äº secret å¯¹è±¡çš„åå­—ã€‚</p></li>

<li><p>å°†ä¸‹é¢çš„é…ç½®</p>

<pre><code class="language-ini">spec.containers[].volumeMounts[]
</code></pre>

<p>â€‹   åŠ åˆ°éœ€è¦ç”¨åˆ°è¯¥ secret çš„å®¹å™¨ä¸­ã€‚æŒ‡å®šä¸‹é¢çš„é…ç½®</p>

<pre><code class="language-ini">spec.containers[].volumeMounts[].readOnly = true
</code></pre>

<p>â€‹   å¹¶è®¾ç½®</p>

<pre><code class="language-ini">spec.containers[].volumeMounts[].mountPath
</code></pre>

<p>â€‹   ä¸ºæ‚¨æƒ³è¦è¯¥ secret å‡ºç°çš„å°šæœªä½¿ç”¨çš„ç›®å½•ã€‚</p></li>

<li><p>ä¿®æ”¹æ‚¨çš„é•œåƒå¹¶ä¸”ï¼æˆ–è€…å‘½ä»¤è¡Œè®©ç¨‹åºä»è¯¥ç›®å½•ä¸‹å¯»æ‰¾æ–‡ä»¶ã€‚Secret çš„ <code>data</code> æ˜ å°„ä¸­çš„æ¯ä¸€ä¸ªé”®éƒ½æˆä¸ºäº† <code>mountPath</code> ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶åã€‚</p></li>
</ol>

<p>è¿™æ˜¯ä¸€ä¸ªåœ¨ pod ä¸­ä½¿ç”¨ volume æŒ‚åœ¨ secret çš„ä¾‹å­ï¼š</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: redis
    volumeMounts:
    - name: foo
      mountPath: &quot;/etc/foo&quot;
      readOnly: true
  volumes:
  - name: foo
    secret:
      secretName: mysecret
</code></pre>

<p>æ‚¨æƒ³è¦ç”¨çš„æ¯ä¸ª secret éƒ½éœ€è¦åœ¨ <code>spec.volumes</code> ä¸­æŒ‡æ˜ã€‚</p>

<p>å¦‚æœ pod ä¸­æœ‰å¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éƒ½éœ€è¦è‡ªå·±çš„ <code>volumeMounts</code> é…ç½®å—ï¼Œä½†æ˜¯æ¯ä¸ª secret åªéœ€è¦ä¸€ä¸ª <code>spec.volumes</code>ã€‚</p>

<p>æ‚¨å¯ä»¥æ‰“åŒ…å¤šä¸ªæ–‡ä»¶åˆ°ä¸€ä¸ª secret ä¸­ï¼Œæˆ–è€…ä½¿ç”¨çš„å¤šä¸ª secretï¼Œæ€æ ·æ–¹ä¾¿å°±æ€æ ·æ¥ã€‚</p>

<p><strong>å‘ç‰¹æ€§è·¯å¾„æ˜ å°„ secret å¯†é’¥</strong></p>

<p>æˆ‘ä»¬è¿˜å¯ä»¥æ§åˆ¶ Secret key æ˜ å°„åœ¨ volume ä¸­çš„è·¯å¾„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spec.volumes[].secret.items</code> å­—æ®µä¿®æ”¹æ¯ä¸ª key çš„ç›®æ ‡è·¯å¾„ï¼š</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: redis
    volumeMounts:
    - name: foo
      mountPath: &quot;/etc/foo&quot;
      readOnly: true
  volumes:
  - name: foo
    secret:
      secretName: mysecret
      items:
      - key: username
        path: my-group/my-username
</code></pre>

<p>å°†ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼š</p>

<ul>
<li><code>username</code> secret å­˜å‚¨åœ¨ <code>/etc/foo/my-group/my-username</code> æ–‡ä»¶ä¸­è€Œä¸æ˜¯ <code>/etc/foo/username</code> ä¸­ã€‚</li>
<li><code>password</code> secret æ²¡æœ‰è¢«å½±å°„</li>
</ul>

<p>å¦‚æœä½¿ç”¨äº† <code>spec.volumes[].secret.items</code>ï¼Œåªæœ‰åœ¨ <code>items</code> ä¸­æŒ‡å®šçš„ key è¢«å½±å°„ã€‚è¦ä½¿ç”¨ secret ä¸­æ‰€æœ‰çš„ keyï¼Œæ‰€æœ‰è¿™äº›éƒ½å¿…é¡»åˆ—åœ¨ <code>items</code> å­—æ®µä¸­ã€‚æ‰€æœ‰åˆ—å‡ºçš„å¯†é’¥å¿…é¡»å­˜åœ¨äºç›¸åº”çš„ secret ä¸­ã€‚å¦åˆ™ï¼Œä¸ä¼šåˆ›å»ºå·ã€‚</p>

<p><strong>Secret æ–‡ä»¶æƒé™</strong></p>

<p>æ‚¨è¿˜å¯ä»¥æŒ‡å®š secret å°†æ‹¥æœ‰çš„æƒé™æ¨¡å¼ä½æ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨ <code>0644</code>ã€‚æ‚¨å¯ä»¥ä¸ºæ•´ä¸ªä¿å¯†å·æŒ‡å®šé»˜è®¤æ¨¡å¼ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥è¦†ç›–æ¯ä¸ªå¯†é’¥ã€‚</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: redis
    volumeMounts:
    - name: foo
      mountPath: &quot;/etc/foo&quot;
  volumes:
  - name: foo
    secret:
      secretName: mysecret
      defaultMode: 256
</code></pre>

<p>ç„¶åï¼Œsecret å°†è¢«æŒ‚è½½åˆ° <code>/etc/foo</code> ç›®å½•ï¼Œæ‰€æœ‰é€šè¿‡è¯¥ secret volume æŒ‚è½½åˆ›å»ºçš„æ–‡ä»¶çš„æƒé™éƒ½æ˜¯ <code>0400</code>ã€‚</p>

<p>è¯·æ³¨æ„ï¼ŒJSON è§„èŒƒä¸æ”¯æŒå…«è¿›åˆ¶ç¬¦å·ï¼Œå› æ­¤ä½¿ç”¨ 256 å€¼ä½œä¸º 0400 æƒé™ã€‚å¦‚æœæ‚¨ä½¿ç”¨ yaml è€Œä¸æ˜¯ json ä½œä¸º podï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç¬¦å·ä»¥æ›´è‡ªç„¶çš„æ–¹å¼æŒ‡å®šæƒé™ã€‚</p>

<p>æ‚¨è¿˜å¯ä»¥æ˜¯ç”¨æ˜ å°„ï¼Œå¦‚ä¸Šä¸€ä¸ªç¤ºä¾‹ï¼Œå¹¶ä¸ºä¸åŒçš„æ–‡ä»¶æŒ‡å®šä¸åŒçš„æƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: redis
    volumeMounts:
    - name: foo
      mountPath: &quot;/etc/foo&quot;
  volumes:
  - name: foo
    secret:
      secretName: mysecret
      items:
      - key: username
        path: my-group/my-username
        mode: 511
</code></pre>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¼è‡´ <code>/etc/foo/my-group/my-username</code> çš„æ–‡ä»¶çš„æƒé™å€¼ä¸º <code>0777</code>ã€‚ç”±äº JSON é™åˆ¶ï¼Œå¿…é¡»ä»¥åè¿›åˆ¶æ ¼å¼æŒ‡å®šæ¨¡å¼ã€‚</p>

<p>è¯·æ³¨æ„ï¼Œå¦‚æœç¨åé˜…è¯»æ­¤æƒé™å€¼å¯èƒ½ä¼šä»¥åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºã€‚</p>

<p><strong>ä» Volume ä¸­æ¶ˆè´¹ secret å€¼</strong></p>

<p>åœ¨æŒ‚è½½çš„ secret volume çš„å®¹å™¨å†…ï¼Œsecret key å°†ä½œä¸ºæ–‡ä»¶ï¼Œå¹¶ä¸” secret çš„å€¼ä½¿ç”¨ base-64 è§£ç å¹¶å­˜å‚¨åœ¨è¿™äº›æ–‡ä»¶ä¸­ã€‚è¿™æ˜¯åœ¨ä¸Šé¢çš„ç¤ºä¾‹å®¹å™¨å†…æ‰§è¡Œçš„å‘½ä»¤çš„ç»“æœï¼š</p>

<pre><code class="language-bash">$ ls /etc/foo/
username
password
$ cat /etc/foo/username
admin
$ cat /etc/foo/password
1f2d1e2e67df
</code></pre>

<p>å®¹å™¨ä¸­çš„ç¨‹åºè´Ÿè´£ä»æ–‡ä»¶ä¸­è¯»å– secretã€‚</p>

<p><strong>æŒ‚è½½çš„ secret è¢«è‡ªåŠ¨æ›´æ–°</strong></p>

<p>å½“å·²ç»åœ¨ volume ä¸­æ¶ˆè¢«æ¶ˆè´¹çš„ secret è¢«æ›´æ–°æ—¶ï¼Œè¢«æ˜ å°„çš„ key ä¹Ÿå°†è¢«æ›´æ–°ã€‚</p>

<p>Kubelet åœ¨å‘¨æœŸæ€§åŒæ­¥æ—¶æ£€æŸ¥è¢«æŒ‚è½½çš„ secret æ˜¯ä¸æ˜¯æœ€æ–°çš„ã€‚ä½†æ˜¯ï¼Œå®ƒæ­£åœ¨ä½¿ç”¨å…¶åŸºäºæœ¬åœ° ttl çš„ç¼“å­˜æ¥è·å–å½“å‰çš„ secret å€¼ã€‚ç»“æœæ˜¯ï¼Œå½“ secret è¢«æ›´æ–°çš„æ—¶åˆ»åˆ°å°†æ–°çš„ secret æ˜ å°„åˆ° pod çš„æ—¶åˆ»çš„æ€»å»¶è¿Ÿå¯ä»¥ä¸ kubelet ä¸­çš„secret ç¼“å­˜çš„ kubelet sync period + ttl ä¸€æ ·é•¿ã€‚</p>

<h4 id="secret-ä½œä¸ºç¯å¢ƒå˜é‡">Secret ä½œä¸ºç¯å¢ƒå˜é‡</h4>

<p>å°† secret ä½œä¸º pod ä¸­çš„ç¯å¢ƒå˜é‡ä½¿ç”¨ï¼š</p>

<ol>
<li>åˆ›å»ºä¸€ä¸ª secret æˆ–è€…ä½¿ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„ secretã€‚å¤šä¸ª pod å¯ä»¥å¼•ç”¨åŒä¸€ä¸ª secretã€‚</li>
<li>åœ¨æ¯ä¸ªå®¹å™¨ä¸­ä¿®æ”¹æ‚¨æƒ³è¦ä½¿ç”¨ secret key çš„ Pod å®šä¹‰ï¼Œä¸ºè¦ä½¿ç”¨çš„æ¯ä¸ª secret key æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚æ¶ˆè´¹secret key çš„ç¯å¢ƒå˜é‡åº”å¡«å…… secret çš„åç§°ï¼Œå¹¶é”®å…¥ <code>env[x].valueFrom.secretKeyRef</code>ã€‚</li>
<li>ä¿®æ”¹é•œåƒå¹¶ï¼æˆ–è€…å‘½ä»¤è¡Œï¼Œä»¥ä¾¿ç¨‹åºåœ¨æŒ‡å®šçš„ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾å€¼ã€‚</li>
</ol>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: secret-env-pod
spec:
  containers:
  - name: mycontainer
    image: redis
    env:
      - name: SECRET_USERNAME
        valueFrom:
          secretKeyRef:
            name: mysecret
            key: username
      - name: SECRET_PASSWORD
        valueFrom:
          secretKeyRef:
            name: mysecret
            key: password
  restartPolicy: Never
</code></pre>

<p><strong>æ¶ˆè´¹ç¯å¢ƒå˜é‡é‡Œçš„ Secret å€¼</strong></p>

<p>åœ¨ä¸€ä¸ªæ¶ˆè€—ç¯å¢ƒå˜é‡ secret çš„å®¹å™¨ä¸­ï¼Œsecret key ä½œä¸ºåŒ…å« secret æ•°æ®çš„ base-64 è§£ç å€¼çš„å¸¸è§„ç¯å¢ƒå˜é‡ã€‚è¿™æ˜¯ä»ä¸Šé¢çš„ç¤ºä¾‹åœ¨å®¹å™¨å†…æ‰§è¡Œçš„å‘½ä»¤çš„ç»“æœï¼š</p>

<pre><code class="language-bash">$ echo $SECRET_USERNAME
admin
$ echo $SECRET_PASSWORD
1f2d1e2e67df
</code></pre>

<h4 id="ä½¿ç”¨-imagepullsecret">ä½¿ç”¨ imagePullSecret</h4>

<p>imagePullSecret æ˜¯å°†åŒ…å« Dockerï¼ˆæˆ–å…¶ä»–ï¼‰é•œåƒæ³¨å†Œè¡¨å¯†ç çš„ secret ä¼ é€’ç»™ Kubelet çš„ä¸€ç§æ–¹å¼ï¼Œå› æ­¤å¯ä»¥ä»£è¡¨æ‚¨çš„ pod æ‹‰å–ç§æœ‰é•œåƒã€‚</p>

<p><strong>æ‰‹åŠ¨æŒ‡å®š imagePullSecret</strong></p>

<p>imagePullSecret çš„ä½¿ç”¨åœ¨ <a href="https://kubernetes.io/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod">é•œåƒæ–‡æ¡£</a> ä¸­è¯´æ˜ã€‚</p>

<h3 id="å®‰æ’-imagepullsecrets-è‡ªåŠ¨é™„åŠ ">å®‰æ’ imagePullSecrets è‡ªåŠ¨é™„åŠ </h3>

<p>æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ›å»º imagePullSecretï¼Œå¹¶ä» serviceAccount å¼•ç”¨å®ƒã€‚ä½¿ç”¨è¯¥ serviceAccount åˆ›å»ºçš„ä»»ä½• pod å’Œé»˜è®¤ä½¿ç”¨è¯¥ serviceAccount çš„ pod å°†ä¼šå°†å…¶çš„ imagePullSecret å­—æ®µè®¾ç½®ä¸ºæœåŠ¡å¸æˆ·çš„ imagePullSecret å­—æ®µã€‚æœ‰å…³è¯¥è¿‡ç¨‹çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜… <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#adding-imagepullsecrets-to-a-service-account">å°† ImagePullSecrets æ·»åŠ åˆ°æœåŠ¡å¸æˆ·</a>ã€‚</p>

<h4 id="è‡ªåŠ¨æŒ‚è½½æ‰‹åŠ¨åˆ›å»ºçš„-secret">è‡ªåŠ¨æŒ‚è½½æ‰‹åŠ¨åˆ›å»ºçš„ Secret</h4>

<p>æ‰‹åŠ¨åˆ›å»ºçš„ secretï¼ˆä¾‹å¦‚åŒ…å«ç”¨äºè®¿é—® github å¸æˆ·çš„ä»¤ç‰Œï¼‰å¯ä»¥æ ¹æ®å…¶æœåŠ¡å¸æˆ·è‡ªåŠ¨é™„åŠ åˆ° podã€‚è¯·å‚é˜… <a href="https://kubernetes.io/docs/tasks/run-application/podpreset">ä½¿ç”¨ PodPreset å‘ Pod ä¸­æ³¨å…¥ä¿¡æ¯</a> ä»¥è·å–è¯¥è¿›ç¨‹çš„è¯¦ç»†è¯´æ˜ã€‚</p>

<h2 id="è¯¦ç»†">è¯¦ç»†</h2>

<h3 id="é™åˆ¶">é™åˆ¶</h3>

<p>éªŒè¯ secret volume æ¥æºç¡®ä¿æŒ‡å®šçš„å¯¹è±¡å¼•ç”¨å®é™…ä¸ŠæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸º Secret çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨ä¾èµ–äºå®ƒçš„ä»»ä½• pod ä¹‹å‰åˆ›å»ºä¸€ä¸ª secretã€‚</p>

<p>Secret API å¯¹è±¡é©»ç•™åœ¨å‘½åç©ºé—´ä¸­ã€‚å®ƒä»¬åªèƒ½ç”±åŒä¸€å‘½åç©ºé—´ä¸­çš„ pod å¼•ç”¨ã€‚</p>

<p>æ¯ä¸ª secret çš„å¤§å°é™åˆ¶ä¸º1MBã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢åˆ›å»ºéå¸¸å¤§çš„ secret ä¼šè€—å°½ apiserver å’Œ kubelet çš„å†…å­˜ã€‚ç„¶è€Œï¼Œåˆ›å»ºè®¸å¤šè¾ƒå°çš„ secret ä¹Ÿå¯èƒ½è€—å°½å†…å­˜ã€‚æ›´å…¨é¢å¾—é™åˆ¶ secret å¯¹å†…å­˜ä½¿ç”¨çš„æ›´å…¨é¢çš„é™åˆ¶æ˜¯è®¡åˆ’ä¸­çš„åŠŸèƒ½ã€‚</p>

<p>Kubelet ä»…æ”¯æŒä» API server è·å–çš„ Pod ä½¿ç”¨ secretã€‚è¿™åŒ…æ‹¬ä½¿ç”¨ kubectl åˆ›å»ºçš„ä»»ä½• podï¼Œæˆ–é—´æ¥é€šè¿‡ replication controller åˆ›å»ºçš„ podã€‚å®ƒä¸åŒ…æ‹¬é€šè¿‡ kubelet <code>--manifest-url</code> æ ‡å¿—ï¼Œå…¶ <code>--config</code> æ ‡å¿—æˆ–å…¶ REST API åˆ›å»ºçš„podï¼ˆè¿™äº›ä¸æ˜¯åˆ›å»º pod çš„å¸¸ç”¨æ–¹æ³•ï¼‰ã€‚</p>

<p>å¿…é¡»å…ˆåˆ›å»º secretï¼Œé™¤éå°†å®ƒä»¬æ ‡è®°ä¸ºå¯é€‰é¡¹ï¼Œå¦åˆ™å¿…é¡»åœ¨å°†å…¶ä½œä¸ºç¯å¢ƒå˜é‡åœ¨ pod ä¸­ä½¿ç”¨ä¹‹å‰åˆ›å»º secretã€‚å¯¹ä¸å­˜åœ¨çš„ secret çš„å¼•ç”¨å°†é˜»æ­¢å…¶å¯åŠ¨ã€‚</p>

<p>é€šè¿‡ <code>secretKeyRef</code> å¯¹ä¸å­˜åœ¨äºå‘½åçš„ key ä¸­çš„ key è¿›è¡Œå¼•ç”¨å°†é˜»æ­¢è¯¥å¯åŠ¨ã€‚</p>

<p>ç”¨äºé€šè¿‡ <code>envFrom</code> å¡«å……ç¯å¢ƒå˜é‡çš„ secretï¼Œè¿™äº›ç¯å¢ƒå˜é‡å…·æœ‰è¢«è®¤ä¸ºæ˜¯æ— æ•ˆç¯å¢ƒå˜é‡åç§°çš„ key å°†è·³è¿‡è¿™äº›é”®ã€‚è¯¥ pod å°†è¢«å…è®¸å¯åŠ¨ã€‚å°†ä¼šæœ‰ä¸€ä¸ªäº‹ä»¶ï¼Œå…¶åŸå› æ˜¯ <code>InvalidVariableNames</code>ï¼Œè¯¥æ¶ˆæ¯å°†åŒ…å«è¢«è·³è¿‡çš„æ— æ•ˆé”®çš„åˆ—è¡¨ã€‚è¯¥ç¤ºä¾‹æ˜¾ç¤ºä¸€ä¸ª podï¼Œå®ƒæŒ‡çš„æ˜¯åŒ…å«2ä¸ªæ— æ•ˆé”®ï¼Œ1badkey å’Œ 2alsobad çš„é»˜è®¤/mysecret ConfigMapã€‚</p>

<pre><code class="language-bash">$ kubectl get events
LASTSEEN   FIRSTSEEN   COUNT     NAME            KIND      SUBOBJECT                         TYPE      REASON
0s         0s          1         dapi-test-pod   Pod                                         Warning   InvalidEnvironmentVariableNames   kubelet, 127.0.0.1      Keys [1badkey, 2alsobad] from the EnvFrom secret default/mysecret were skipped since they are considered invalid environment variable names.
</code></pre>

<h3 id="secret-ä¸-pod-ç”Ÿå‘½å‘¨æœŸçš„è”ç³»">Secret ä¸ Pod ç”Ÿå‘½å‘¨æœŸçš„è”ç³»</h3>

<p>é€šè¿‡ API åˆ›å»ºçš„ Pod æ—¶ï¼Œä¸ä¼šæ£€æŸ¥åº”ç”¨çš„ secret æ˜¯å¦å­˜åœ¨ã€‚ä¸€æ—¦ Pod è¢«è°ƒåº¦ï¼Œkubelet å°±ä¼šå°è¯•è·å–è¯¥ secret çš„å€¼ã€‚å¦‚æœè·å–ä¸åˆ°è¯¥ secretï¼Œæˆ–è€…æš‚æ—¶æ— æ³•ä¸ API server å»ºç«‹è¿æ¥ï¼Œkubelet å°†ä¼šå®šæœŸé‡è¯•ã€‚Kubelet å°†ä¼šæŠ¥å‘Šå…³äº pod çš„äº‹ä»¶ï¼Œå¹¶è§£é‡Šå®ƒæ— æ³•å¯åŠ¨çš„åŸå› ã€‚ä¸€æ—¦è·å–çš„ secretï¼Œkubeletå°†åˆ›å»ºå¹¶è£…è½½ä¸€ä¸ªåŒ…å«å®ƒçš„å·ã€‚åœ¨å®‰è£…æ‰€æœ‰podçš„å·ä¹‹å‰ï¼Œéƒ½ä¸ä¼šå¯åŠ¨ pod çš„å®¹å™¨ã€‚</p>

<h2 id="ä½¿ç”¨æ¡ˆä¾‹">ä½¿ç”¨æ¡ˆä¾‹</h2>

<h3 id="ä½¿ç”¨æ¡ˆä¾‹-åŒ…å«-ssh-å¯†é’¥çš„-pod">ä½¿ç”¨æ¡ˆä¾‹ï¼šåŒ…å« ssh å¯†é’¥çš„ pod</h3>

<p>åˆ›å»ºä¸€ä¸ªåŒ…å« ssh key çš„ secretï¼š</p>

<pre><code class="language-bash">$ kubectl create secret generic ssh-key-secret --from-file=ssh-privatekey=/path/to/.ssh/id_rsa --from-file=ssh-publickey=/path/to/.ssh/id_rsa.pub
</code></pre>

<p><strong>å®‰å…¨æ€§æ³¨æ„äº‹é¡¹</strong>ï¼šå‘é€è‡ªå·±çš„ ssh å¯†é’¥ä¹‹å‰è¦ä»”ç»†æ€è€ƒï¼šé›†ç¾¤çš„å…¶ä»–ç”¨æˆ·å¯èƒ½æœ‰æƒè®¿é—®è¯¥å¯†é’¥ã€‚ä½¿ç”¨æ‚¨æƒ³è¦å…±äº« Kubernetes ç¾¤é›†çš„æ‰€æœ‰ç”¨æˆ·å¯ä»¥è®¿é—®çš„æœåŠ¡å¸æˆ·ï¼Œå¦‚æœå®ƒä»¬é­åˆ°å…¥ä¾µï¼Œå¯ä»¥æ’¤é”€ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä½¿ç”¨ ssh å¯†é’¥å¼•ç”¨ secret çš„podï¼Œå¹¶åœ¨ä¸€ä¸ªå·ä¸­ä½¿ç”¨å®ƒï¼š</p>

<pre><code class="language-yaml">kind: Pod
apiVersion: v1
metadata:
  name: secret-test-pod
  labels:
    name: secret-test
spec:
  volumes:
  - name: secret-volume
    secret:
      secretName: ssh-key-secret
  containers:
  - name: ssh-test-container
    image: mySshImage
    volumeMounts:
    - name: secret-volume
      readOnly: true
      mountPath: &quot;/etc/secret-volume&quot;
</code></pre>

<p>å½“å®¹å™¨ä¸­çš„å‘½ä»¤è¿è¡Œæ—¶ï¼Œå¯†é’¥çš„ç‰‡æ®µå°†å¯åœ¨ä»¥ä¸‹ç›®å½•ï¼š</p>

<pre><code class="language-Ini">/etc/secret-volume/ssh-publickey
/etc/secret-volume/ssh-privatekey
</code></pre>

<p>ç„¶åå®¹å™¨å¯ä»¥è‡ªç”±ä½¿ç”¨å¯†é’¥æ•°æ®å»ºç«‹ä¸€ä¸ª ssh è¿æ¥ã€‚</p>

<h3 id="ä½¿ç”¨æ¡ˆä¾‹-åŒ…å«-prod-test-å‡­æ®çš„-pod">ä½¿ç”¨æ¡ˆä¾‹ï¼šåŒ…å« prod/test å‡­æ®çš„ pod</h3>

<p>ä¸‹é¢çš„ä¾‹å­è¯´æ˜ä¸€ä¸ª pod æ¶ˆè´¹ä¸€ä¸ªåŒ…å« prod å‡­æ®çš„ secretï¼Œå¦ä¸€ä¸ª pod ä½¿ç”¨æµ‹è¯•ç¯å¢ƒå‡­æ®æ¶ˆè´¹ secretã€‚</p>

<p>åˆ›å»º secretï¼š</p>

<pre><code class="language-bash">$ kubectl create secret generic prod-db-secret --from-literal=username=produser --from-literal=password=Y4nys7f11
secret &quot;prod-db-secret&quot; created
$ kubectl create secret generic test-db-secret --from-literal=username=testuser --from-literal=password=iluvtests
secret &quot;test-db-secret&quot; created
</code></pre>

<p>åˆ›å»º pod ï¼š</p>

<pre><code class="language-yaml">apiVersion: v1
kind: List
items:
- kind: Pod
  apiVersion: v1
  metadata:
    name: prod-db-client-pod
    labels:
      name: prod-db-client
  spec:
    volumes:
    - name: secret-volume
      secret:
        secretName: prod-db-secret
    containers:
    - name: db-client-container
      image: myClientImage
      volumeMounts:
      - name: secret-volume
        readOnly: true
        mountPath: &quot;/etc/secret-volume&quot;
- kind: Pod
  apiVersion: v1
  metadata:
    name: test-db-client-pod
    labels:
      name: test-db-client
  spec:
    volumes:
    - name: secret-volume
      secret:
        secretName: test-db-secret
    containers:
    - name: db-client-container
      image: myClientImage
      volumeMounts:
      - name: secret-volume
        readOnly: true
        mountPath: &quot;/etc/secret-volume&quot;
</code></pre>

<p>è¿™ä¸¤ä¸ªå®¹å™¨å°†åœ¨å…¶æ–‡ä»¶ç³»ç»Ÿä¸Šæ˜¾ç¤ºä»¥ä¸‹æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªå®¹å™¨ç¯å¢ƒçš„å€¼ï¼š</p>

<pre><code class="language-Ini">/etc/secret-volume/username
/etc/secret-volume/password
</code></pre>

<p>è¯·æ³¨æ„ï¼Œä¸¤ä¸ª pod çš„ spec é…ç½®ä¸­ä»…æœ‰ä¸€ä¸ªå­—æ®µæœ‰æ‰€ä¸åŒï¼›è¿™æœ‰åŠ©äºä½¿ç”¨æ™®é€šçš„ pod é…ç½®æ¨¡æ¿åˆ›å»ºå…·æœ‰ä¸åŒåŠŸèƒ½çš„ podã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ª service account è¿›ä¸€æ­¥ç®€åŒ–åŸºæœ¬ pod specï¼šä¸€ä¸ªåä¸º <code>prod-user</code> æ‹¥æœ‰ <code>prod-db-secret</code> ï¼Œå¦ä¸€ä¸ªç§°ä¸º <code>test-user</code> æ‹¥æœ‰ <code>test-db-secret</code> ã€‚ç„¶åï¼Œpod spec å¯ä»¥ç¼©çŸ­ä¸ºï¼Œä¾‹å¦‚ï¼š</p>

<pre><code class="language-yaml">kind: Pod
apiVersion: v1
metadata:
  name: prod-db-client-pod
  labels:
    name: prod-db-client
spec:
  serviceAccount: prod-db-client
  containers:
  - name: db-client-container
    image: myClientImage
</code></pre>

<h3 id="ä½¿ç”¨æ¡ˆä¾‹-secret-å·ä¸­ä»¥ç‚¹å·å¼€å¤´çš„æ–‡ä»¶">ä½¿ç”¨æ¡ˆä¾‹ï¼šsecret å·ä¸­ä»¥ç‚¹å·å¼€å¤´çš„æ–‡ä»¶</h3>

<p>ä¸ºäº†å°†æ•°æ®â€œéšè—â€èµ·æ¥ï¼ˆå³æ–‡ä»¶åä»¥ç‚¹å·å¼€å¤´çš„æ–‡ä»¶ï¼‰ï¼Œç®€å•åœ°è¯´è®©è¯¥é”®ä»¥ä¸€ä¸ªç‚¹å¼€å§‹ã€‚ä¾‹å¦‚ï¼Œå½“å¦‚ä¸‹ secret è¢«æŒ‚è½½åˆ°å·ä¸­ï¼š</p>

<pre><code class="language-yaml">kind: Secret
apiVersion: v1
metadata:
  name: dotfile-secret
data:
  .secret-file: dmFsdWUtMg0KDQo=
---
kind: Pod
apiVersion: v1
metadata:
  name: secret-dotfiles-pod
spec:
  volumes:
  - name: secret-volume
    secret:
      secretName: dotfile-secret
  containers:
  - name: dotfile-test-container
    image: gcr.io/google_containers/busybox
    command:
    - ls
    - &quot;-l&quot;
    - &quot;/etc/secret-volume&quot;
    volumeMounts:
    - name: secret-volume
      readOnly: true
      mountPath: &quot;/etc/secret-volume&quot;
</code></pre>

<p><code>Secret-volume</code> å°†åŒ…å«ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œå«åš <code>.secret-file</code>ï¼Œ<code>dotfile-test-container</code> çš„ <code>/etc/secret-volume/.secret-file</code>è·¯å¾„ä¸‹å°†æœ‰è¯¥æ–‡ä»¶ã€‚</p>

<p><strong>æ³¨æ„</strong></p>

<p>ä»¥ç‚¹å·å¼€å¤´çš„æ–‡ä»¶åœ¨ <code>ls -l</code> çš„è¾“å‡ºä¸­è¢«éšè—èµ·æ¥äº†ï¼›åˆ—å‡ºç›®å½•å†…å®¹æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ <code>ls -la</code> æ‰èƒ½æŸ¥çœ‹å®ƒä»¬ã€‚</p>

<h3 id="ä½¿ç”¨æ¡ˆä¾‹-secret-ä»…å¯¹-pod-ä¸­çš„ä¸€ä¸ªå®¹å™¨å¯è§">ä½¿ç”¨æ¡ˆä¾‹ï¼šSecret ä»…å¯¹ pod ä¸­çš„ä¸€ä¸ªå®¹å™¨å¯è§</h3>

<p>è€ƒè™‘ä»¥ä¸‹ä¸€ä¸ªéœ€è¦å¤„ç† HTTP è¯·æ±‚çš„ç¨‹åºï¼Œæ‰§è¡Œä¸€äº›å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åä½¿ç”¨ HMAC ç­¾ç½²ä¸€äº›æ¶ˆæ¯ã€‚å› ä¸ºå®ƒå…·æœ‰å¤æ‚çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼Œæ‰€ä»¥åœ¨æœåŠ¡å™¨ä¸­å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªæœªè¢«æ³¨æ„çš„è¿œç¨‹æ–‡ä»¶è¯»å–æ¼æ´ï¼Œè¿™å¯èƒ½ä¼šå°†ç§é’¥æš´éœ²ç»™æ”»å‡»è€…ã€‚</p>

<p>è¿™å¯ä»¥åœ¨ä¸¤ä¸ªå®¹å™¨ä¸­åˆ†ä¸ºä¸¤ä¸ªè¿›ç¨‹ï¼šå‰ç«¯å®¹å™¨ï¼Œç”¨äºå¤„ç†ç”¨æˆ·äº¤äº’å’Œä¸šåŠ¡é€»è¾‘ï¼Œä½†æ— æ³•çœ‹åˆ°ç§é’¥ï¼›ä»¥åŠå¯ä»¥çœ‹åˆ°ç§é’¥çš„ç­¾åè€…å®¹å™¨ï¼Œå¹¶ä¸”å“åº”æ¥è‡ªå‰ç«¯çš„ç®€å•ç­¾åè¯·æ±‚ï¼ˆä¾‹å¦‚é€šè¿‡æœ¬åœ°ä¸»æœºç½‘ç»œï¼‰ã€‚</p>

<p>ä½¿ç”¨è¿™ç§åˆ†å‰²æ–¹æ³•ï¼Œæ”»å‡»è€…ç°åœ¨å¿…é¡»æ¬ºéª—åº”ç”¨ç¨‹åºæœåŠ¡å™¨æ‰èƒ½è¿›è¡Œä»»æ„çš„æ“ä½œï¼Œè¿™å¯èƒ½æ¯”ä½¿å…¶è¯»å–æ–‡ä»¶æ›´éš¾ã€‚</p>

<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

<h3 id="å®¢æˆ·ç«¯ä½¿ç”¨-secret-api">å®¢æˆ·ç«¯ä½¿ç”¨ secret API</h3>

<p>å½“éƒ¨ç½²ä¸ secret API äº¤äº’çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”ä½¿ç”¨è¯¸å¦‚ <a href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a> ä¹‹ç±»çš„ <a href="https://kubernetes.io/docs/admin/authorization/">æˆæƒç­–ç•¥</a> æ¥é™åˆ¶è®¿é—®ã€‚</p>

<p>Secret çš„é‡è¦æ€§é€šå¸¸ä¸å°½ç›¸åŒï¼Œå…¶ä¸­è®¸å¤šå¯èƒ½åªå¯¹ Kubernetes é›†ç¾¤å†…ï¼ˆä¾‹å¦‚ service account ä»¤ç‰Œï¼‰å’Œå¯¹å¤–éƒ¨ç³»ç»Ÿé€ æˆå½±å“ã€‚å³ä½¿ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥ç†è§£å…¶æœŸæœ›çš„ä¸ä¹‹äº¤äº’çš„ secret çš„æƒåŠ›ï¼Œä½†æ˜¯åŒä¸€å‘½åç©ºé—´ä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿è¿™äº›å‡è®¾æ— æ•ˆã€‚</p>

<p>ç”±äºè¿™äº›åŸå› ï¼Œåœ¨å‘½åç©ºé—´ä¸­ <code>watch</code> å’Œ <code>list</code> secret çš„è¯·æ±‚æ˜¯éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œåº”è¯¥é¿å…è¿™æ ·çš„è¡Œä¸ºï¼Œå› ä¸ºåˆ—å‡º secret å¯ä»¥è®©å®¢æˆ·ç«¯æ£€æŸ¥æ‰€æœ‰ secret æ˜¯å¦åœ¨è¯¥å‘½åç©ºé—´ä¸­ã€‚åœ¨ç¾¤é›†ä¸­<code>watch</code> å’Œ <code>list</code> æ‰€æœ‰ secret çš„èƒ½åŠ›åº”è¯¥åªä¿ç•™ç»™æœ€æœ‰ç‰¹æƒçš„ç³»ç»Ÿçº§ç»„ä»¶ã€‚</p>

<p>éœ€è¦è®¿é—® secrets API çš„åº”ç”¨ç¨‹åºåº”è¯¥æ ¹æ®ä»–ä»¬éœ€è¦çš„ secret æ‰§è¡Œ <code>get</code> è¯·æ±‚ã€‚è¿™å…è®¸ç®¡ç†å‘˜é™åˆ¶å¯¹æ‰€æœ‰ secret çš„è®¿é—®ï¼ŒåŒæ—¶è®¾ç½® <a href="https://kubernetes.io/docs/admin/authorization/rbac/#referring-to-resources">ç™½åå•è®¿é—®</a> åº”ç”¨ç¨‹åºéœ€è¦çš„å„ä¸ªå®ä¾‹ã€‚</p>

<p>ä¸ºäº†æé«˜å¾ªç¯è·å–çš„æ€§èƒ½ï¼Œå®¢æˆ·ç«¯å¯ä»¥è®¾è®¡å¼•ç”¨ secret çš„èµ„æºï¼Œç„¶å <code>watch</code> èµ„æºï¼Œåœ¨å¼•ç”¨æ›´æ”¹æ—¶é‡æ–°è¯·æ±‚ secretã€‚æ­¤å¤–ï¼Œè¿˜æå‡ºäº†ä¸€ç§ <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/bulk_watch.md">â€æ‰¹é‡ç›‘æ§â€œ API</a> æ¥è®©å®¢æˆ·ç«¯ <code>watch</code> æ¯ä¸ªèµ„æºï¼Œè¯¥åŠŸèƒ½å¯èƒ½ä¼šåœ¨å°†æ¥çš„ Kubernetes ç‰ˆæœ¬ä¸­æä¾›ã€‚</p>

<h2 id="å®‰å…¨å±æ€§">å®‰å…¨å±æ€§</h2>

<h3 id="ä¿æŠ¤">ä¿æŠ¤</h3>

<p>å› ä¸º <code>secret</code> å¯¹è±¡å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ <code>pod</code> è€Œåˆ›å»ºï¼Œæ‰€ä»¥åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ pod çš„æµç¨‹ä¸­ secret è¢«æš´éœ²çš„é£é™©è¾ƒå°ã€‚ç³»ç»Ÿè¿˜å¯ä»¥å¯¹ <code>secret</code> å¯¹è±¡é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œä¾‹å¦‚é¿å…å°†å…¶å†™å…¥åˆ°ç£ç›˜ä¸­å¯èƒ½çš„ä½ç½®ã€‚</p>

<p>åªæœ‰å½“èŠ‚ç‚¹ä¸Šçš„ pod éœ€è¦ç”¨åˆ°è¯¥ secret æ—¶ï¼Œè¯¥ secret æ‰ä¼šè¢«å‘é€åˆ°è¯¥èŠ‚ç‚¹ä¸Šã€‚å®ƒä¸ä¼šè¢«å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ tmpfs ä¸­ã€‚ä¸€æ—¦ä¾èµ–äºå®ƒçš„ pod è¢«åˆ é™¤ï¼Œå®ƒå°±è¢«åˆ é™¤ã€‚</p>

<p>åœ¨å¤§å¤šæ•° Kubernetes é¡¹ç›®ç»´æŠ¤çš„å‘è¡Œç‰ˆä¸­ï¼Œç”¨æˆ·ä¸ API server ä¹‹é—´çš„é€šä¿¡ä»¥åŠä» API server åˆ° kubelet çš„é€šä¿¡éƒ½å—åˆ° SSL/TLS çš„ä¿æŠ¤ã€‚é€šè¿‡è¿™äº›é€šé“ä¼ è¾“æ—¶ï¼Œsecret å—åˆ°ä¿æŠ¤ã€‚</p>

<p>èŠ‚ç‚¹ä¸Šçš„ secret æ•°æ®å­˜å‚¨åœ¨ tmpfs å·ä¸­ï¼Œå› æ­¤ä¸ä¼šä¼ åˆ°èŠ‚ç‚¹ä¸Šçš„å…¶ä»–ç£ç›˜ã€‚</p>

<p>åŒä¸€èŠ‚ç‚¹ä¸Šçš„å¾ˆå¤šä¸ª pod å¯èƒ½æ‹¥æœ‰å¤šä¸ª secretã€‚ä½†æ˜¯ï¼Œåªæœ‰ pod è¯·æ±‚çš„ secret åœ¨å…¶å®¹å™¨ä¸­æ‰æ˜¯å¯è§çš„ã€‚å› æ­¤ï¼Œä¸€ä¸ª pod ä¸èƒ½è®¿é—®å¦ä¸€ä¸ª Pod çš„ secretã€‚</p>

<p>Pod ä¸­æœ‰å¤šä¸ªå®¹å™¨ã€‚ä½†æ˜¯ï¼Œpod ä¸­çš„æ¯ä¸ªå®¹å™¨å¿…é¡»è¯·æ±‚å…¶æŒ‚è½½å·ä¸­çš„ secret å·æ‰èƒ½åœ¨å®¹å™¨å†…å¯è§ã€‚è¿™å¯ä»¥ç”¨äº <a href="https://kubernetes.io/docs/concepts/configuration/secret.md#use-case-secret-visible-to-one-container-in-a-pod">åœ¨ Pod çº§åˆ«æ„å»ºå®‰å…¨åˆ†åŒº</a>ã€‚</p>

<h3 id="é£é™©">é£é™©</h3>

<ul>
<li>API server çš„ secret æ•°æ®ä»¥çº¯æ–‡æœ¬çš„æ–¹å¼å­˜å‚¨åœ¨ etcd ä¸­ï¼›å› æ­¤ï¼š

<ul>
<li>ç®¡ç†å‘˜åº”è¯¥é™åˆ¶ admin ç”¨æˆ·è®¿é—® etcdï¼›</li>
<li>API server ä¸­çš„ secret æ•°æ®ä½äº etcd ä½¿ç”¨çš„ç£ç›˜ä¸Šï¼›ç®¡ç†å‘˜å¯èƒ½å¸Œæœ›åœ¨ä¸å†ä½¿ç”¨æ—¶æ“¦é™¤/ç²‰ç¢ etcd ä½¿ç”¨çš„ç£ç›˜</li>
</ul></li>
<li>å¦‚æœæ‚¨å°† secret æ•°æ®ç¼–ç ä¸º base64 çš„æ¸…å•ï¼ˆJSON æˆ– YAMLï¼‰æ–‡ä»¶ï¼Œå…±äº«è¯¥æ–‡ä»¶æˆ–å°†å…¶æ£€å…¥ä»£ç åº“ï¼Œè¿™æ ·çš„è¯è¯¥å¯†ç å°†ä¼šè¢«æ³„éœ²ã€‚ Base64 ç¼–ç ä¸æ˜¯ä¸€ç§åŠ å¯†æ–¹å¼ï¼Œä¸€æ ·ä¹Ÿæ˜¯çº¯æ–‡æœ¬ã€‚</li>
<li>åº”ç”¨ç¨‹åºåœ¨ä»å·ä¸­è¯»å– secret åä»ç„¶éœ€è¦ä¿æŠ¤ secret çš„å€¼ï¼Œä¾‹å¦‚ä¸ä¼šæ„å¤–è®°å½•æˆ–å‘é€ç»™ä¸ä¿¡ä»»æ–¹ã€‚</li>
<li>å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨ secret çš„ pod çš„ç”¨æˆ·ä¹Ÿå¯ä»¥çœ‹åˆ°è¯¥ secret çš„å€¼ã€‚å³ä½¿ API server ç­–ç•¥ä¸å…è®¸ç”¨æˆ·è¯»å– secret å¯¹è±¡ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è¿è¡Œæš´éœ² secret çš„ podã€‚</li>
<li>å¦‚æœè¿è¡Œäº†å¤šä¸ªå‰¯æœ¬ï¼Œé‚£ä¹ˆè¿™äº› secret å°†åœ¨å®ƒä»¬ä¹‹é—´å…±äº«ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œetcd ä¸èƒ½ä¿è¯ä¸ SSL/TLS çš„å¯¹ç­‰é€šä¿¡ï¼Œå°½ç®¡å¯ä»¥è¿›è¡Œé…ç½®ã€‚</li>
<li>ç›®å‰ï¼Œä»»ä½•èŠ‚ç‚¹çš„ root ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿ kubelet æ¥è¯»å– API server ä¸­çš„ä»»ä½• secretã€‚åªæœ‰å‘å®é™…éœ€è¦å®ƒä»¬çš„èŠ‚ç‚¹å‘é€ secret æ‰èƒ½é™åˆ¶å•ä¸ªèŠ‚ç‚¹çš„æ ¹æ¼æ´çš„å½±å“ï¼Œè¯¥åŠŸèƒ½è¿˜åœ¨è®¡åˆ’ä¸­ã€‚</li>
</ul>

<p><a href="https://github.com/rootsongjc/kubernetes.github.io/blob/master/docs/concepts/configuration/secret.md">æŸ¥çœ‹åŸæ–‡</a></p>

            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://jimmysong.io/posts/creating-comment-box-with-gitment/" data-toggle="tooltip" data-placement="top" title="ä½¿ç”¨gitmentä¸ºä½ çš„ç½‘ç«™æ·»åŠ è¯„è®ºæ¡†">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://jimmysong.io/posts/jimmysong-io-revision-20171001/" data-toggle="tooltip" data-placement="top" title="å–œè¿å›½åº†èŠ‚jimmysong.ioåšå®¢ç››è£…æ”¹ç‰ˆ">Next Post &rarr;</a>
                </li>
                
            </ul>
            <div>
                 
                <h2>See Also</h2>
                <ul>
                    
                    <li><a href="/posts/pod-lifecycle/">Kubernetesä¸­Podçš„ç”Ÿå‘½å‘¨æœŸ</a></li>
                    
                    <li><a href="/posts/docker-cli-to-kubectl/">dockerç”¨æˆ·è¿‡åº¦åˆ°kubectlå‘½ä»¤è¡ŒæŒ‡å—</a></li>
                    
                    <li><a href="/posts/creating-cloud-native-app-with-kubernetes/">å¦‚ä½•å¼€å‘éƒ¨ç½²kubernetes nativeåº”ç”¨</a></li>
                    
                    <li><a href="/posts/running-spark-with-kubernetes-native-scheduler/">è¿è¡Œæ”¯æŒkubernetesåŸç”Ÿè°ƒåº¦çš„sparkç¨‹åº-Spark on Kubernetes</a></li>
                    
                    <li><a href="/posts/3-things-every-cto-should-know-about-kubernetes/">æ¯ä½CTOéƒ½è¯¥çŸ¥é“çš„å…³äºkubernetesçš„ä¸‰ä»¶äº‹</a></li>
                    
                </ul>
                
            </div>
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Thu Sep 28, 2017</h4>
                </section>
                <h5 id="wc">5900 Words|Read in about 12 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/kubernetes">kubernetes</a> &nbsp;
                </h5>
            </div>
            
            <aside id=comments>
                <div>
                    <h2> Comments </h2>
                </div>
                <div id="container"></div>
                <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
                <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
                <script>
                    var gitment = new Gitment({
                        owner: 'rootsongjc', 
                        repo: 'rootsongjc.github.io', 
                        oauth: {
                            client_id: '93a0df08e0f93ff0c8a3',
                            client_secret: '3bdbf0b42c525f78582600bd38cf7f722ee40541',
                        },
                    })
                    gitment.render('container')
                </script>
            </aside>

        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:rootsongjc@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/jimmysongio" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/rootsongjc" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/jimmysongio" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/jimmysongio" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017
          
            
              Jimmy Song
                      
          
          
          &nbsp;&bull;&nbsp;
          October 4,2017
          updated
          
            &nbsp;&bull;&nbsp;
            <a href="https://jimmysong.io/">Jimmy Song</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.30-DEV</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="https://jimmysong.io/js/main.js"></script>

<script> renderMathInElement(document.body); </script>

<script src="https://jimmysong.io/js/prism.js"></script>
<script src="https://jimmysong.io/js/load-photoswipe.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe-ui-default.min.js"></script>




  </body>
</html>

