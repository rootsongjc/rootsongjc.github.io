<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> Linkerd ä½¿ç”¨æŒ‡å— - Cloud NativeğŸ¤˜Big Data</title>
  <meta name="description" content="Cloud NativeğŸ¤˜Big Data" />
  <meta property="og:title" content="Linkerd ä½¿ç”¨æŒ‡å—" />
  <meta name="twitter:title" content="Linkerd ä½¿ç”¨æŒ‡å—" />
  <meta name="description" content="å‰è¨€ è¯¥æ–‡ç« å·²å½’æ¡£åˆ° kubernetes-handbook ç¬¬äº”ç« ã€é¢†åŸŸåº”ç”¨ã€‘ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥ kubernetes-handbook ä¸ºå‡†ï¼Œè¯¥æ–‡æ¡£å¯èƒ½ä¸ä¼šåŠæ—¶æ›´æ–°ã€‚ ä»¥ä¸‹å†…å®¹å‚è€ƒï¼šA Service Mesh for Kubernetes Linkerd ä½œä¸ºä¸€æ¬¾ service mesh ä¸kubernet">
  <meta property="og:description" content="å‰è¨€ è¯¥æ–‡ç« å·²å½’æ¡£åˆ° kubernetes-handbook ç¬¬äº”ç« ã€é¢†åŸŸåº”ç”¨ã€‘ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥ kubernetes-handbook ä¸ºå‡†ï¼Œè¯¥æ–‡æ¡£å¯èƒ½ä¸ä¼šåŠæ—¶æ›´æ–°ã€‚ ä»¥ä¸‹å†…å®¹å‚è€ƒï¼šA Service Mesh for Kubernetes Linkerd ä½œä¸ºä¸€æ¬¾ service mesh ä¸kubernet">
  <meta name="twitter:description" content="å‰è¨€ è¯¥æ–‡ç« å·²å½’æ¡£åˆ° kubernetes-handbook ç¬¬äº”ç« ã€é¢†åŸŸåº”ç”¨ã€‘ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥ kubernetes-handbook ä¸ºå‡†ï¼Œè¯¥æ–‡æ¡£å¯èƒ½ä¸ä¼šåŠæ—¶æ›´æ–°ã€‚ ä»¥ä¸‹å†…å®¹å‚è€ƒï¼šA Service Mesh for Kubernetes Linkerd ä½œä¸ºä¸€æ¬¾ service mesh ä¸kubernet">
  <meta name="author" content="{Description { .Site.Author.name }}"/>
  <link href='https://jimmysong.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://jimmysong.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jimmysongio" />
  <meta name="twitter:creator" content="@jimmysongio" />
  <meta property="og:url" content="https://jimmysong.io/posts/linkerd-user-guide/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Jimmy Song" />

  <meta name="generator" content="Hugo 0.30-DEV" />
  <link rel="canonical" href="https://jimmysong.io/posts/linkerd-user-guide/" />
  <link rel="alternate" href="https://jimmysong.io/index.xml" type="application/rss+xml" title="Jimmy Song">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://jimmysong.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  

<meta name="baidu-site-verification" content="g8IYR9SNLF" />
<script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

<link rel="stylesheet" href="https://jimmysong.io/css/prism.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jimmysong.io/">Jimmy Song</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Articles</a>
              <div class="navlinks-children">
                
                  <a href="/posts">Posts</a>
                
                  <a href="/tags">Tags</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Categories</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes">kubernetes</a>
                
                  <a href="/categories/cloud-native">Cloud Native</a>
                
                  <a href="/categories/github">Github</a>
                
                  <a href="/categories/devops">Devops</a>
                
                  <a href="/categories/docker">Docker</a>
                
                  <a href="/categories/code">Code</a>
                
                  <a href="/categories/architecture/">Architecture</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Books</a>
              <div class="navlinks-children">
                
                  <a href="/cloud-native-go">Cloud Native Go</a>
                
                  <a href="/posts/cloud-native-python">Cloud Native Python</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Projects</a>
              <div class="navlinks-children">
                
                  <a href="/kubernetes-handbook">Kubernetes handbook</a>
                
                  <a href="/spark-on-k8s">Spark on kubernetes</a>
                
                  <a href="/awesome-cloud-native">Awesome Cloud Native</a>
                
                  <a href="/migrating-to-cloud-native-application-architectures"> Migrating to Cloud native</a>
                
                  <a href="http://istio.doczh.cn">Istio service mesh</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Jimmy Song" href="https://jimmysong.io/">
            <img class="avatar-img" src="https://jimmysong.io/img/avatar-icon.png" alt="Jimmy Song" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
            
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="posts-heading">
                <h1 align="center">Linkerd ä½¿ç”¨æŒ‡å—</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Tue Aug 1, 2017</h4>
                </section>
                <h5 id="wc">1700 Words|Read in about 4 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/kubernetes">kubernetes</a> &nbsp;
                    <a href="https://jimmysong.io//tags/cloud-native">cloud-native</a> &nbsp;
                    <a href="https://jimmysong.io//tags/service-mesh">service-mesh</a> &nbsp;
                </h5>

            </div>
            <article role="main" class="blog-post">
                

<h2 id="å‰è¨€">å‰è¨€</h2>

<p>è¯¥æ–‡ç« å·²å½’æ¡£åˆ° <a href="https://github.com/rootsongjc/kubernetes-handbook">kubernetes-handbook</a> ç¬¬äº”ç« ã€é¢†åŸŸåº”ç”¨ã€‘ä¸­ï¼Œä¸€åˆ‡å†…å®¹ä»¥ kubernetes-handbook ä¸ºå‡†ï¼Œè¯¥æ–‡æ¡£å¯èƒ½ä¸ä¼šåŠæ—¶æ›´æ–°ã€‚</p>

<p>ä»¥ä¸‹å†…å®¹å‚è€ƒï¼š<a href="https://cdn2.hubspot.net/hubfs/2818724/A%20Service%20Mesh%20for%20Kubernetes_Final.pdf">A Service Mesh for Kubernetes</a></p>

<p>Linkerd ä½œä¸ºä¸€æ¬¾ service mesh ä¸kubernetes ç»“åˆåä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•ï¼š</p>

<ol>
<li>ä½œä¸ºæœåŠ¡ç½‘å…³ï¼Œå¯ä»¥ç›‘æ§ kubernetes ä¸­çš„æœåŠ¡å’Œå®ä¾‹</li>
<li>ä½¿ç”¨ TLS åŠ å¯†æœåŠ¡</li>
<li>é€šè¿‡æµé‡è½¬ç§»åˆ°æŒç»­äº¤ä»˜</li>
<li>å¼€å‘æµ‹è¯•ç¯å¢ƒï¼ˆEat your own dog foodï¼‰ã€Ingress å’Œè¾¹ç¼˜è·¯ç”±</li>
<li>ç»™å¾®æœåŠ¡åš staging</li>
<li>åˆ†å¸ƒå¼ tracing</li>
<li>ä½œä¸º Ingress controller</li>
<li>ä½¿ç”¨ gRPC æ›´æ–¹ä¾¿</li>
</ol>

<p>ä»¥ä¸‹æˆ‘ä»¬ç€é‡è®²è§£åœ¨ kubernetes ä¸­å¦‚ä½•ä½¿ç”¨ linkerd ä½œä¸º kubernetes çš„ Ingress controllerï¼Œå¹¶ä½œä¸ºè¾¹ç¼˜èŠ‚ç‚¹ä»£æ›¿ <a href="https://traefik.io/">Traefik</a>çš„åŠŸèƒ½ï¼Œè¯¦è§ <a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/practice/edge-node-configuration.md">è¾¹ç¼˜èŠ‚ç‚¹çš„é…ç½®</a>ã€‚</p>

<h2 id="å‡†å¤‡">å‡†å¤‡</h2>

<p>å®‰è£…æµ‹è¯•æ—¶éœ€è¦ç”¨åˆ°çš„é•œåƒæœ‰ï¼š</p>

<pre><code class="language-ini">buoyantio/helloworld:0.1.4
buoyantio/jenkins-plus:2.60.1
buoyantio/kubectl:v1.4.0
buoyantio/linkerd:1.1.2
buoyantio/namerd:1.1.2
buoyantio/nginx:1.10.2
linkerd/namerctl:0.8.6
openzipkin/zipkin:1.20
tutum/dnsutils:latest
</code></pre>

<p>è¿™äº›é•œåƒå¯ä»¥ç›´æ¥é€šè¿‡ Docker Hub è·å–ï¼Œæˆ‘å°†å®ƒä»¬ä¸‹è½½ä¸‹æ¥å¹¶ä¸Šä¼ åˆ°äº†è‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“ <code>sz-pg-oam-docker-hub-001.tendcloud.com</code> ä¸­ï¼Œä¸‹æ–‡ä¸­ç”¨åˆ°çš„é•œåƒçš†æ¥è‡ªæˆ‘çš„ç§æœ‰é•œåƒä»“åº“ï¼Œyaml é…ç½®è§ <a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/manifests/linkerd">linkerd</a> ç›®å½•ï¼Œå¹¶åœ¨ä½¿ç”¨æ—¶å°†é…ç½®ä¸­çš„é•œåƒåœ°å€ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„ã€‚</p>

<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>

<p>é¦–å…ˆéœ€è¦å…ˆåˆ›å»º RBACï¼Œå› ä¸ºä½¿ç”¨ namerd å’Œ ingress æ—¶éœ€è¦ç”¨åˆ°ã€‚</p>

<pre><code class="language-bash">$ kubectl create -f linkerd-rbac-beta.yml
</code></pre>

<p>Linkerd æä¾›äº† Jenkins ç¤ºä¾‹ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>

<pre><code class="language-bash">$ kubectl create -f jenkins-rbac-beta.yml
$ kubectl create -f jenkins.yml
</code></pre>

<p>è®¿é—® <a href="http://jenkins.jimmysong.io/">http://jenkins.jimmysong.io</a></p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/linkerd-jenkins-pipeline.jpg"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/linkerd-jenkins-pipeline.jpg" alt="Jenkins pipeline" /></a></p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/linkerd-jenkins.jpg"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/linkerd-jenkins.jpg" alt="Jenkins config" /></a></p>

<p><strong>æ³¨æ„</strong>ï¼šè¦è®¿é—® Jenkins éœ€è¦åœ¨ Ingress ä¸­å¢åŠ é…ç½®ï¼Œä¸‹æ–‡ä¼šæåˆ°ã€‚</p>

<p>åœ¨ kubernetes ä¸­ä½¿ç”¨ Jenkins çš„æ—¶å€™éœ€è¦æ³¨æ„ Pipeline ä¸­çš„é…ç½®ï¼š</p>

<pre><code class="language-Ini">    def currentVersion = getCurrentVersion()
    def newVersion = getNextVersion(currentVersion)
    def frontendIp = kubectl(&quot;get svc l5d -o jsonpath=\&quot;{.status.loadBalancer.ingress[0].*}\&quot;&quot;).trim()
    def originalDst = getDst(getDtab())
</code></pre>

<p><code>frontendIP</code> çš„åœ°å€è¦é…ç½®æˆ service çš„ Cluster IP ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç”¨åˆ°LoadBalancerã€‚</p>

<p>éœ€è¦å®‰è£… namerdï¼Œnamerd è´Ÿè´£ dtab ä¿¡æ¯çš„å­˜å‚¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ etcdã€consulä¸­ã€‚dtab ä¿å­˜çš„æ˜¯è·¯ç”±è§„åˆ™ä¿¡æ¯ï¼Œæ”¯æŒé€’å½’è§£æï¼Œè¯¦è§ <a href="https://linkerd.io/in-depth/dtabs/">dtab</a>ã€‚</p>

<p>æµé‡åˆ‡æ¢ä¸»è¦æ˜¯é€šè¿‡ <a href="https://linkerd.io/in-depth/dtabs/">dtab</a> æ¥å®ç°çš„ï¼Œé€šè¿‡åœ¨ HTTP è¯·æ±‚çš„ header ä¸­å¢åŠ  <code>l5d-dtab</code> å’Œ <code>Host</code> ä¿¡æ¯å¯ä»¥å¯¹æµé‡åˆ†ç¦»åˆ° kubernetes ä¸­çš„ä¸åŒ service ä¸Šã€‚</p>

<p><strong>é‡åˆ°çš„é—®é¢˜</strong></p>

<p>Failed with the following error(s) Error signal dtab is already marked as being deployed!</p>

<p>å› ä¸ºè¯¥ dtab entry å·²ç»å­˜åœ¨ï¼Œéœ€è¦åˆ é™¤åå†è¿è¡Œã€‚</p>

<p>è®¿é—® <a href="http://namerd.jimmysong.io/">http://namerd.jimmysong.io</a></p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/namerd-internal.jpg"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/namerd-internal.jpg" alt="namerd" /></a></p>

<p>dtab ä¿å­˜åœ¨ namerd ä¸­ï¼Œè¯¥é¡µé¢ä¸­çš„æ›´æ”¹ä¸ä¼šç”Ÿæ•ˆï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ“ä½œã€‚</p>

<p>ä½¿ç”¨ <a href="https://github.com/linkerd/namerctl">namerctl</a> æ¥æ“ä½œã€‚</p>

<pre><code class="language-bash">$ namerctl --base-url http://namerd-backend.jimmysong.io dtab update internal file
</code></pre>

<p><strong>æ³¨æ„</strong>ï¼šupdate æ—¶éœ€è¦å°†æ›´æ–°æ–‡æœ¬å…ˆå†™å…¥æ–‡ä»¶ä¸­ã€‚</p>

<h2 id="éƒ¨ç½²-linkerd">éƒ¨ç½² Linkerd</h2>

<p>ç›´æ¥ä½¿ç”¨ yaml æ–‡ä»¶éƒ¨ç½²ï¼Œæ³¨æ„ä¿®æ”¹é•œåƒä»“åº“åœ°å€ã€‚</p>

<pre><code class="language-bash"># åˆ›å»º namerd
$ kubectl create -f namerd.yaml
# åˆ›å»º ingress
$ kubectl create -f linkerd-ingress.yml
# åˆ›å»ºæµ‹è¯•æœåŠ¡ hello-world
$ kubectl create -f hello-world.yml
# åˆ›å»º API æœåŠ¡
$ kubectl create -f api.yml
# åˆ›å»ºæµ‹è¯•æœåŠ¡ world-v2
$ kubectl create -f world-v2.yml
</code></pre>

<p>ä¸ºäº†åœ¨æœ¬åœ°è°ƒè¯• linkerdï¼Œæˆ‘ä»¬å°† linkerd çš„ service åŠ å…¥åˆ° ingress ä¸­ï¼Œè¯¦è§ <a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/usecases/practice/edge-node-configuration.md">è¾¹ç¼˜èŠ‚ç‚¹é…ç½®</a>ã€‚</p>

<p>åœ¨ Ingress ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<pre><code class="language-yaml">    - host: linkerd.jimmysong.io
      http:
        paths:
        - path: /
          backend:
            serviceName: l5d
            servicePort: 9990
    - host: linkerd-viz.jimmysong.io
      http:
        paths:
        - path: /
          backend:
            serviceName: linkerd-viz
            servicePort: 80
    - host: l5d.jimmysong.io
      http:
        paths:
        - path: /
          backend:
            serviceName: l5d
            servicePort: 4141
    - host: jenkins.jimmysong.io
      http:
        paths:
        - path: /
          backend:
            serviceName: jenkins
            servicePort: 80
</code></pre>

<p>åœ¨æœ¬åœ°<code>/etc/hosts</code>ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<pre><code class="language-Ini">172.20.0.119 linkerd.jimmysong.io
172.20.0.119 linkerd-viz.jimmysong.io
172.20.0.119 l5d.jimmysong.io
</code></pre>

<p><strong>æµ‹è¯•è·¯ç”±åŠŸèƒ½</strong></p>

<p>ä½¿ç”¨ curl ç®€å•æµ‹è¯•ã€‚</p>

<p>å•æ¡æµ‹è¯•</p>

<pre><code class="language-bash">$ curl -s -H &quot;Host: www.hello.world&quot; 172.20.0.120:4141
Hello (172.30.60.14) world (172.30.71.19)!!%  
</code></pre>

<p>è¯·æ³¨æ„è¯·æ±‚è¿”å›çš„ç»“æœï¼Œè¡¨ç¤ºè®¿é—®çš„æ˜¯ <code>world-v1</code> serviceã€‚</p>

<pre><code class="language-bash">$ for i in $(seq 0 10000);do echo $i;curl -s -H &quot;Host: www.hello.world&quot; 172.20.0.120:4141;done
</code></pre>

<p>ä½¿ç”¨ ab testã€‚</p>

<pre><code class="language-bash">$ ab -c 4 -n 10000  -H &quot;Host: www.hello.world&quot; http://172.20.0.120:4141/
This is ApacheBench, Version 2.3 &lt;$Revision: 1757674 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 172.20.0.120 (be patient)
Completed 1000 requests
Completed 2000 requests
Completed 3000 requests
Completed 4000 requests
Completed 5000 requests
Completed 6000 requests
Completed 7000 requests
Completed 8000 requests
Completed 9000 requests
Completed 10000 requests
Finished 10000 requests


Server Software:        
Server Hostname:        172.20.0.120
Server Port:            4141

Document Path:          /
Document Length:        43 bytes

Concurrency Level:      4
Time taken for tests:   262.505 seconds
Complete requests:      10000
Failed requests:        0
Total transferred:      2210000 bytes
HTML transferred:       430000 bytes
Requests per second:    38.09 [#/sec] (mean)
Time per request:       105.002 [ms] (mean)
Time per request:       26.250 [ms] (mean, across all concurrent requests)
Transfer rate:          8.22 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:       36   51  91.1     39    2122
Processing:    39   54  29.3     46     585
Waiting:       39   52  20.3     46     362
Total:         76  105  96.3     88    2216

Percentage of the requests served within a certain time (ms)
  50%     88
  66%     93
  75%     99
  80%    103
  90%    119
  95%    146
  98%    253
  99%    397
 100%   2216 (longest request)
</code></pre>

<h2 id="ç›‘æ§-kubernets-ä¸­çš„æœåŠ¡ä¸å®ä¾‹">ç›‘æ§ kubernets ä¸­çš„æœåŠ¡ä¸å®ä¾‹</h2>

<p>è®¿é—® <a href="http://linkerd.jimmysong.io/">http://linkerd.jimmysong.io</a> æŸ¥çœ‹æµé‡æƒ…å†µ</p>

<p>Outcoming</p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/linkerd-helloworld-outgoing.jpg"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/linkerd-helloworld-outgoing.jpg" alt="linkerdç›‘æ§" /></a></p>

<p>Incoming</p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/linkerd-helloworld-incoming.jpg"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/linkerd-helloworld-incoming.jpg" alt="linkerdç›‘æ§" /></a></p>

<p>è®¿é—® <a href="http://linkerd-viz.jimmysong.io/">http://linkerd-viz.jimmysong.io</a> æŸ¥çœ‹åº”ç”¨ metric ç›‘æ§</p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/linkerd-grafana.png"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/linkerd-grafana.png" alt="linkerdæ€§èƒ½ç›‘æ§" /></a></p>

<h2 id="æµ‹è¯•è·¯ç”±">æµ‹è¯•è·¯ç”±</h2>

<p>æµ‹è¯•åœ¨ http header ä¸­å¢åŠ  dtab è§„åˆ™ã€‚</p>

<pre><code class="language-bash">$ curl -H &quot;Host: www.hello.world&quot; -H &quot;l5d-dtab:/host/world =&gt; /srv/world-v2;&quot; 172.20.0.120:4141 
Hello (172.30.60.14) earth (172.30.94.40)!!
</code></pre>

<p>è¯·æ³¨æ„è°ƒç”¨è¿”å›çš„ç»“æœï¼Œè¡¨ç¤ºè°ƒç”¨çš„æ˜¯ <code>world-v2</code> çš„ serviceã€‚</p>

<p>å¦å¤–å†å¯¹æ¯” ab test çš„ç»“æœä¸ <code>linkerd-viz</code> é¡µé¢ä¸Šçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ç»“æœä¸€è‡´ã€‚</p>

<p>ä½†æ˜¯æˆ‘ä»¬å¯èƒ½ä¸æƒ³æŠŠè¯¥åŠŸèƒ½æš´éœ²ç»™æ‰€æœ‰äººï¼Œæ‰€ä»¥å¯ä»¥åœ¨å‰ç«¯éƒ¨ç½²ä¸€ä¸ª nginx æ¥è¿‡æ»¤ header ä¸­çš„ <code>l5d-dtab</code> æ‰“å¤´çš„å­—æ®µï¼Œå¹¶é€šè¿‡è®¾ç½® cookie çš„æ–¹å¼æ¥æ›¿ä»£ header é‡Œçš„ <code>l5d-dtab</code> å­—æ®µã€‚</p>

<pre><code class="language-bash">$ http_proxy=http://172.20.0.120:4141 curl -s http:/hello
Hello (172.30.60.14) world (172.30.71.19)!!
</code></pre>

<h2 id="å°†-linkerd-ä½œä¸º-ingress-controller">å°† Linkerd ä½œä¸º Ingress controller</h2>

<p>å°† Linkerd ä½œä¸º kubernetes ingress controller çš„æ–¹å¼è·Ÿå°† Treafik ä½œä¸º ingress controller çš„è¿‡ç¨‹è¿‡ç¨‹å®Œå…¨ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒ <a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/practice/edge-node-configuration.md">è¾¹ç¼˜èŠ‚ç‚¹é…ç½®</a>ã€‚</p>

<p>æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>

<p><a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/images/linkerd-ingress-controller.jpg"><img src="https://res.cloudinary.com/jimmysong/image/upload/images/linkerd-ingress-controller.jpg" alt="Linkerd ingress controller" /></a></p>

<p><em>(å›¾ç‰‡æ¥è‡ª A Service Mesh for Kubernetes - Buoyant.io)</em></p>

<p>å½“ç„¶å¯ä»¥ç»•è¿‡ kubernetes ingress controller ç›´æ¥ä½¿ç”¨ linkerd ä½œä¸ºè¾¹ç•Œè·¯ç”±ï¼Œé€šè¿‡ dtab å’Œ linkerd å‰é¢çš„ nginx æ¥è·¯ç”±æµé‡ã€‚</p>

<h2 id="åè®°">åè®°</h2>

<p>çœ‹äº† Linkerd çš„å®˜æ–¹ç¤ºä¾‹ <a href="https://github.com/linkerd/linkerd-examples/">linkerd-examples</a> å’Œ <a href="https://cdn2.hubspot.net/hubfs/2818724/A%20Service%20Mesh%20for%20Kubernetes_Final.pdf">A Service Mesh for Kubernetes</a> ä¸ªäººæ„Ÿè§‰ä¸¤è€…é…åˆèµ·æ¥è®²è§£çš„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæ¯ä¸ªç« èŠ‚ä¸æ˜¯ç‰¹åˆ«çš„ç‹¬ç«‹ï¼Œä¹Ÿä¸æ˜¯å¾ˆæœ‰é€»è¾‘æ€§ã€‚</p>

<p>Linkerd è·Ÿ Istio ä¸€æ ·éƒ½æ˜¯ service meshï¼Œå¯ä»¥åœ¨æœåŠ¡é—´åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯ istio ä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•çµæ´»ï¼Œä¸¤è€…çš„åŠŸèƒ½åŸºæœ¬ä¸€æ ·ï¼Œä¸è¿‡æˆ‘æ›´å€¾å‘äº Istioï¼Œå› ä¸ºå®ƒæ›´è½»é‡çº§ï¼Œä¸éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½éƒ¨ç½²ä¸€ä¸ª DaemonSetï¼Œå¹¶ä¸”ä½¿ç”¨ ingress ä¹Ÿæ›´æ–¹ä¾¿ä¸ kubernetes é›†æˆã€‚</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
<li><a href="https://github.com/linkerd/linkerd-examples/">https://github.com/linkerd/linkerd-examples/</a></li>
<li><a href="https://cdn2.hubspot.net/hubfs/2818724/A%20Service%20Mesh%20for%20Kubernetes_Final.pdf">A Service Mesh for Kubernetes</a></li>
<li><a href="https://linkerd.io/in-depth/dtabs/">dtab</a></li>
</ul>

            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://jimmysong.io/posts/migrating-to-cloud-native-architecture/" data-toggle="tooltip" data-placement="top" title="è¿ç§»åˆ°äº‘åŸç”Ÿåº”ç”¨æ¶æ„æŒ‡å—">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://jimmysong.io/posts/cloud-native-python/" data-toggle="tooltip" data-placement="top" title="Cloud Native Pythonâ€”ä½¿ç”¨Pythonå’ŒReactæ„å»ºäº‘åŸç”Ÿåº”ç”¨">Next Post &rarr;</a>
                </li>
                
            </ul>
            <div>
                 
                <h2>See Also</h2>
                <ul>
                    
                    <li><a href="/posts/linkerd-introduction/">äº‘åŸç”Ÿå¾®æœåŠ¡æ²»ç†æ¡†æ¶Linkerdç®€ä»‹</a></li>
                    
                    <li><a href="/posts/istio-overview/">å¾®æœåŠ¡ç®¡ç†æ¡†æ¶Istioç®€ä»‹</a></li>
                    
                    <li><a href="/posts/istio-installation/">å¾®æœåŠ¡ç®¡ç†æ¡†æ¶istioå®‰è£…ç¬”è®°</a></li>
                    
                    <li><a href="/posts/migrating-to-cloud-native-architecture/">è¿ç§»åˆ°äº‘åŸç”Ÿåº”ç”¨æ¶æ„æŒ‡å—</a></li>
                    
                    <li><a href="/posts/deploy-applications-in-kubernetes/">é€‚ç”¨äºkubernetesçš„åº”ç”¨å¼€å‘ä¸éƒ¨ç½²æµç¨‹è¯¦è§£</a></li>
                    
                </ul>
                
            </div>
            
            <div>
                <section id="datecount">
                    <h4 id="date"> Tue Aug 1, 2017</h4>
                </section>
                <h5 id="wc">1700 Words|Read in about 4 Min</h5>
                <h5 id="tags">Tags: 
                    <a href="https://jimmysong.io//tags/kubernetes">kubernetes</a> &nbsp;
                    <a href="https://jimmysong.io//tags/cloud-native">cloud-native</a> &nbsp;
                    <a href="https://jimmysong.io//tags/service-mesh">service-mesh</a> &nbsp;
                </h5>
            </div>
            
            <aside id=comments>
                <div>
                    <h2> Comments </h2>
                </div>
                <div id="container"></div>
                <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
                <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
                <script>
                    var gitment = new Gitment({
                        owner: 'rootsongjc', 
                        repo: 'rootsongjc.github.io', 
                        oauth: {
                            client_id: '93a0df08e0f93ff0c8a3',
                            client_secret: '3bdbf0b42c525f78582600bd38cf7f722ee40541',
                        },
                    })
                    gitment.render('container')
                </script>
            </aside>

        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:rootsongjc@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/jimmysongio" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/rootsongjc" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/jimmysongio" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/jimmysongio" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017
          
            
              Jimmy Song
                      
          
          
          &nbsp;&bull;&nbsp;
          October 4,2017
          updated
          
            &nbsp;&bull;&nbsp;
            <a href="https://jimmysong.io/">Jimmy Song</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.30-DEV</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="https://jimmysong.io/js/main.js"></script>

<script> renderMathInElement(document.body); </script>

<script src="https://jimmysong.io/js/prism.js"></script>
<script src="https://jimmysong.io/js/load-photoswipe.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.1/photoswipe-ui-default.min.js"></script>




  </body>
</html>

